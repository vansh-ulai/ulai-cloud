"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[11676],{258035:(e,t,o)=>{o.d(t,{CO:()=>ee,HL:()=>A,L5:()=>k,Pl:()=>ne,ph:()=>E});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(823215),o(354520),o(672577),o(430670),o(803949),o(581454),o(908872),o(737550);var n=()=>o(496603),r=()=>o(720665),a=()=>o(700500),i=()=>o(356246),s=()=>o(898244),l=()=>o(713998),d=()=>o(175482),c=()=>o(498140),p=()=>o(651124),u=()=>o(165358),m=()=>o(384813),f=()=>o(416845),h=()=>o(997769),g=()=>o(792071),C=()=>o(72135),I=()=>o(134025),b=()=>o(179034),v=()=>o(519831),y=()=>o(869558),w=()=>o(201980);const x="PartialMatch",_="FullMatch",N="ColumnCategory",S=(0,o(69708).YK)({titleColumnName:{id:"database.titleColumn.name",defaultMessage:"Title"},genericColumnName:{id:"database.genericColumn.name",defaultMessage:"Column {columnNumber}"}});function E(e){const{table:t,deps:{intl:o,randomShortID:r,isPhoneNumber:i},options:{useCsvAdaptiveSchema:l,addHeadersToCollectionEnabled:c}}=e,u=function(e,t,o,r,a=!1,i,s,l){var d;e=e.filter((e=>e.some((e=>Boolean((e.text||"").trim())))));const c=e.length>0?e[0].length:0,p=e.map(((e,t)=>({row:e,rowIndex:t}))).filter((({row:e})=>e.length!==c));if(p.length>0){const e=p[0];throw new(f().yI)("CsvImportError",{data:{},clientData:{type:"csv_import_inconsistent_columns",messageValues:{numTitleColumns:c,numBadRows:p.length,firstBadRowIndex:e.rowIndex+1,firstBadRow:JSON.stringify(e.row.map((e=>e.text))),firstBadRowLength:e.row.length}}})}const u=null===(d=e[0])||void 0===d?void 0:d.length;null==i||i.set(N,function(e){return e<50?"lessthan50":e<100?"lessthan100":e<500?"lessthan500":e<1e3?"lessthan1000":e<5e3?"lessthan5000":"greaterthan5000"}(u));const m=null==s?void 0:s.columnHeaders,h=void 0!==m&&m.length>0;let g=[];h?(g=m.flatMap((e=>e.doNotImport?[]:[e.headerName])),null!=s&&s.useFirstRowAsHeaders&&e.shift()):1===e.length||l?g=e[0].map(((e,o)=>t.formatMessage(S.genericColumnName,{columnNumber:o+1}))):e.length>1&&(g=e[0].map((e=>e.text)),e.shift());const C=e,{types:I,schema:b,pages:v}=h&&m?function(e){const{body:t,intl:o,randomShortID:r,headerTitles:a,headersMetadata:i,isPreTypedCSV:s,csvEvalContext:l}=e,d=performance.now(),{types:c,notToImportColumnIndex:p}=function(e){const{intl:t,columns:o,randomShortID:r}=e,a=[],i=o.flatMap(((e,o)=>{if(e.doNotImport)return a.push(o),[];let i=n().D_;"checkbox"===e.propertyType?i=e=>H(e):"number"===e.propertyType?i=e=>q(e):"date"===e.propertyType&&"format"in e?i=o=>V(o,t,e.format):"date"===e.propertyType&&(i=e=>V(e,t));return[{id:"title"===e.propertyType?"title":r(),schema:{name:e.headerName,type:e.propertyType},coerce:i}]}));return{types:i,notToImportColumnIndex:a}}({intl:o,columns:i,randomShortID:r}),u=performance.now()-d;null==l||l.set("columnTypeInferenceTimeTakenMS",u);const{pages:m,selectPropertyOptions:f}=T({body:t,types:c,isPreTypedCSV:s,notToImportColumnIndex:p});if(f)for(const n of c)!f[n.id]||"select"!==n.schema.type&&"multi_select"!==n.schema.type||(n.schema.options=L({randomShortID:r,optionValues:f[n.id],propertyType:n.schema.type}));const{schema:h}=D({body:t,intl:o,randomShortID:r,headers:a,types:c,isPreTypedCSV:s});return{types:c,schema:h,pages:m}}({body:C,intl:t,randomShortID:o,headerTitles:g,headersMetadata:m,isPreTypedCSV:h,csvEvalContext:i}):function(e){const{body:t,intl:o,randomShortID:n,isPhoneNumber:r,useCsvAdaptiveSchema:a,headers:i,isPreTypedCSV:s,csvEvalContext:l}=e,d=performance.now(),{types:c}=A({body:t,intl:o,randomShortID:n,isPhoneNumber:r,useCsvAdaptiveSchema:a,csvEvalContext:l}),p=performance.now()-d;null==l||l.set("columnTypeInferenceTimeTakenMS",p);const{schema:u}=D({body:t,intl:o,randomShortID:n,headers:i,types:c,isPreTypedCSV:s}),{pages:m}=T({body:t,types:c,isPreTypedCSV:s});return{types:c,schema:u,pages:m}}({body:C,intl:t,randomShortID:o,isPhoneNumber:r,useCsvAdaptiveSchema:a,headers:g,isPreTypedCSV:h,csvEvalContext:i});return{schema:b,types:I,pages:v}}(t,o,r,i,l,e.csvEvalContext,e.metadata,c);return function(e){const{actor:t,blockType:o,root:r,parent:i,name:l,format:c,deps:{randomID:u,spaceIdCreator:f,addFileIdsToBlock:h,createCollectionAsyncWithStatusLabel:C},options:{ignoreBlockCount:x,useCrdt:_},pages:N,schema:S,columnIds:E}=e,k=e.collectionId??(null==f?void 0:f.idInSavedSpace(v().Vl))??u(),A=e.collectionViewId??(null==f?void 0:f.idInSavedSpace(y().Gy))??u(),D=[],T=[],L=[],{operations:B}=g().WBy.create({id:k,parent:r.existing?r.record.pointer:{id:r.id,table:b().ev,spaceId:i.spaceId},space_id:i.spaceId,name:w().x9d(l),schema:S,format:{collection_page_properties:n().oE(E.map((e=>{if(e)return{visible:!0,property:e}}))),...C&&{sync_state:{syncing:!0,last_synced_at:Date.now()},static_import_collection_type:p().IE.CsvImport}},createdBy:t});D.push(...B);const O=r.existing?r.record.id:r.id,{model:P,operations:M}=g().zgg.create({id:O,type:o,collection_id:k,format:{collection_pointer:{table:v().Vl,id:k,spaceId:i.spaceId}},view_ids:[A],createdBy:t,parentPointer:i,space_id:i.spaceId},{useCrdt:_});r.existing?D.push(...d().mP({existingBlock:r.record,updatedBlock:P})):D.push(...M);if(C){const{operations:e}=g().lqf.create({id:A,type:"table",name:"Show All",parent:r.existing?r.record.pointer:{id:r.id,table:b().ev,spaceId:i.spaceId},space_id:i.spaceId,format:{collection_pointer:(0,s().Z8)({collectionId:k,spaceId:i.spaceId}),table_properties:n().oE(E.map((e=>{if(e)return{visible:!0,property:e}}))),...c},createdBy:t});D.push(...e)}const H=function(e){const{actor:t,collectionId:o,spaceId:n,pages:r,randomID:i,spaceIdCreator:s,options:l}=e;return r.map((r=>{const d=(null==s?void 0:s.idInSavedSpace(b().ev))??i(),{model:c,operations:p}=g().zgg.create({id:d,parentPointer:{id:o,table:v().Vl,spaceId:n},space_id:n,type:a().xd.page,createdBy:t,properties:r,...l.ignoreBlockCount?{ignore_block_count:!0}:void 0},{useCrdt:l.useCrdt}),u=[...p];if(e.addFileIdsToBlock){const e=(0,m().c)(c,"","").fileIds;e.length>0&&u.push(I().op.update({pointer:c.pointer,path:[],args:{file_ids:e.map((e=>e.id))}}))}return{id:d,operations:u}}))}({actor:t,collectionId:k,addFileIdsToBlock:h,spaceId:i.spaceId,pages:N,randomID:u,spaceIdCreator:f,options:{useCrdt:_,ignoreBlockCount:x}});for(const{operations:n}of H)T.push(...n);const{operations:F}=g().lqf.create({id:A,type:"table",name:"Show All",parent:r.existing?r.record.pointer:{id:r.id,table:b().ev,spaceId:i.spaceId},space_id:i.spaceId,format:{collection_pointer:(0,s().Z8)({collectionId:k,spaceId:i.spaceId}),table_properties:n().oE(E.map((e=>{if(e)return{visible:!0,property:e}}))),...c},page_sort:H.map((e=>e.id)).slice(0,s().WF),createdBy:t});if(T.push(...F),C){const e={table:v().Vl,id:k,spaceId:i.spaceId},t=I().op.update({pointer:e,path:["format","sync_state"],args:{syncing:!1,last_synced_at:Date.now()}});return L.push(t),{operations:T,createCollectionOperations:D,collectionFinishedOperations:L}}return{operations:[...D,...T]}}({...u,columnIds:u.types.map((e=>e.id)),...e})}function k(e){const{table:t,actor:o,parent:n,tableId:i,deps:{randomID:s,spaceIdCreator:l,randomShortID:d},options:{useCrdt:c,ignoreBlockCount:p,hasHeaderRow:u,hasHeaderColumn:m}}=e,f=[],h=t.length?t[0].map((e=>d())):[],C=t.map((e=>(null==l?void 0:l.idInSavedSpace(b().ev))??s()));f.push(...g().zgg.create({id:i,type:a().xd.table,content:C,format:{table_block_column_order:h,...u?{table_block_column_header:!0}:{},...m?{table_block_row_header:!0}:{}},properties:{},parentPointer:n,space_id:n.spaceId,createdBy:o,ignore_block_count:!!p||void 0},{useCrdt:c}).operations);const I=C.flatMap(((e,s)=>{const l=r().MU(h.flatMap(((e,o)=>{var n;const r=null===(n=t[s])||void 0===n||null===(n=n[o])||void 0===n?void 0:n.textValue;return r?[[e,r]]:[]})));return g().zgg.create({id:e,type:a().xd.tableRow,parentPointer:{id:i,table:b().ev,spaceId:n.spaceId},space_id:n.spaceId,properties:l,createdBy:o},{useCrdt:c}).operations}));return f.push(...I),{operations:f}}function A(e){const{body:t,intl:o,randomShortID:a,isPhoneNumber:i,useCsvAdaptiveSchema:s,csvEvalContext:l}=e,d=function(e){return[{test:Z.bind(null,e),sampledSchemaIsComplete:!0},{test:j,sampledSchemaIsComplete:!0},{test:$,sampledSchemaIsComplete:!0},{test:J,sampledSchemaIsComplete:!0},{test:z,sampledSchemaIsComplete:!0},{test:F,sampledSchemaIsComplete:!1},{test:G,sampledSchemaIsComplete:!1},{test:K,sampledSchemaIsComplete:!1},{test:X,sampledSchemaIsComplete:!0}]}(i),c=n().oE(n().sn(t).map((e=>e.length&&e[0].columnType?e[0].columnType:function(e,t,o,a,i,s){const l=t.filter((e=>Boolean(e)));if(0===l.length)return X(e,l);if(i){const n=l.length>1e3?function(e,t){const o=e.length,n=[];for(let r=0;r<t;r++){const t=Math.floor(Math.random()*o);n.push(e[t])}return n}(l,1e3):l;for(const i of a){const a=i.test(e,n,o);if(a){let o=a;if(!1===a.isFullMatch){u().log({level:"info",from:"csvHelper",type:"csvColumnTypes",data:{message:"Partial column type match detected, setting data type as string",columnType:a.schema.type,matchType:"Partial"}}),o=X(e,t);const n=(null==s?void 0:s.get(x))||0;(0,r().Et)(n)&&(null==s||s.set(x,n+1))}else u().log({level:"info",from:"csvHelper",type:"csvColumnTypes",data:{message:"Complete column type match detected",columnType:a.schema.type,matchType:"Full"}});const n=(null==s?void 0:s.get(_))||0;return(0,r().Et)(n)&&(null==s||s.set(_,n+1)),o}}}else{const t=l.filter((e=>!n().Im(e))).slice(0,100);for(const n of a){const a=n.test(e,t,o);if(a){const i=n.sampledSchemaIsComplete||t.length===l.length?a:n.test(e,l,o);if(i){if(!1===i.isFullMatch){u().log({level:"info",from:"csvHelper",type:"csvColumnTypes",data:{message:"Partial column type match detected, Potential data loss due to parsing failures",columnType:i.schema.type,matchType:"Partial"}});const e=(null==s?void 0:s.get(x))||0;(0,r().Et)(e)&&(null==s||s.set(x,e+1))}else{const e=(null==s?void 0:s.get(_))||0;(0,r().Et)(e)&&(null==s||s.set(_,e+1))}return i}}}}return X(e,[])}(o,e.map((e=>null==e?void 0:e.text)),a,d,s,l))));return{types:c}}function D(e){const{body:t,intl:o,randomShortID:n,headers:r,types:a,isPreTypedCSV:i}=e,s=r.map((()=>!1));if(!i)for(let c=0;c<r.length;c++)if("text"===a[c].schema.type)for(let e=0;e<t.length;e++){const o=t[e][c].textValue;if(o)for(const n of o)if(w().BEe(n)){s[c]=!0,e=t.length;break}}let l=!0;const d={title:{type:"title",name:o.formatMessage(S.titleColumnName)}};return r.forEach(((e,t)=>{const o=a[t];if(o)if("text"!==o.schema.type||!l||s[t]||i)if(i&&"title"===o.schema.type){const t=d.title;t&&(t.name=e)}else{const t=o.id??n();o.id||(o.id=t),d[t]={...o.schema,name:e}}else{l=!1,o.id="title",o.schema={type:"title",name:e};const t=d.title;t&&(t.name=e)}})),{schema:d}}function T(e){const{body:t,types:o,isPreTypedCSV:n,notToImportColumnIndex:r}=e,a={};return{pages:t.map((e=>{null!=r&&r.length&&(e=e.filter(((e,t)=>!r.includes(t))));const t={};return o.forEach(((o,r)=>{if(o){const{id:i,schema:s,coerce:d}=o,{type:c}=s;if(i){const o=e[r]||"";if("url"===c)t[i]=l().jw(o.text);else if("date"===c)t[i]=l().m5(d(o.text));else if("text"===c)t[i]=o.textValue||w().x9d(d(o.text));else if("file"===c)t[i]=o.textValue||[];else if("select"===c||"multi_select"===c){let e=[];if("multi_select"===c){e=o.text.split(",").map((e=>e.trim())).filter((e=>e.length>0)).filter(((e,t,o)=>o.findIndex((t=>t.toLowerCase()===e.toLowerCase()))===t))}else e=o.text.trim()?[o.text.trim()]:[];if(n)for(const t of e){if(!t||!t.trim())continue;const e=t.trim();a[i]||(a[i]=[]);a[i].find((t=>t.toLowerCase()===e.toLowerCase()))||a[i].push(e)}t[i]=w().x9d(d(o.text))}else t[i]=w().x9d(d(o.text))}}})),t})),selectPropertyOptions:n?a:void 0}}function L(e){const{randomShortID:t,optionValues:o,propertyType:n}=e;return("multi_select"===n?o.flatMap((e=>e.split(",").map((e=>e.trim())).filter((e=>e.length>0)))):o.map((e=>e.trim())).filter((e=>e.length>0))).filter(((e,t,o)=>o.findIndex((t=>t.toLowerCase()===e.toLowerCase()))===t)).map((e=>({id:t(),value:e,color:(0,s().Zd)([])})))}const B=["yes","Yes","true","True","checked"],O=["no","No","false","False","unchecked"];function P(e){return B.some((t=>e===t))||O.some((t=>e===t))}function M(e,t){return e.length===t.length}function H(e){return B.some((t=>e===t))?i().I1:i().oP}function F(e,t){if(t.every(P))return{schema:{type:"checkbox"},validate:P,coerce:e=>H(e)}}function q(e){const t=C().sA(e);return`${t?t.value:void 0}`}function j(e,t){const o=t.map(C().sA),n=o[0];if(n&&o.every((e=>Boolean(e&&e.format===n.format))))return{schema:{type:"number",number_format:n.format},validate(e){const t=C().sA(e);return!r().pN(t)&&t.format===n.format},coerce:e=>q(e)}}function U(e,t){if(parseInt(t)&&t.length<=6)return!1;const o=c().JC(t,e);return Boolean(o)}function V(e,t,o){return c().JC(e,t,o)}function z(e,t){const o=t.filter((t=>U(e,t)));if(o.length>=t.length/2)return{schema:{type:"date"},validate:t=>U(e,t),coerce:t=>V(t,e),isFullMatch:M(t,o)}}function W(e){return e.length<320&&e.includes("@")&&h().t6(e,"email")}function $(e,t){const o=t.filter(W);if(o.length>=t.length/2)return{schema:{type:"email"},validate:W,coerce:n().D_,isFullMatch:M(t,o)}}function R(e){return e.length<320&&h().t6(e,"url")}function J(e,t){const o=t.filter(R);if(o.length>=t.length/2)return{schema:{type:"url"},validate:R,coerce:n().D_,isFullMatch:M(t,o)}}function Q(e,t){return!String(t).match(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/)&&e(String(t))}function Z(e,t,o){const r=Q.bind(null,e),a=o.filter(r);if(a.length>=o.length/2)return{schema:{type:"phone_number"},validate:r,coerce:n().D_,isFullMatch:M(o,a)}}function G(e,t,o){const r=[];t.forEach((e=>e.split(",").forEach((e=>r.push(e.trim())))));const a=l().ki(r),i=new Set(a);if(d=a.length,c=r.length,p=t.length,c>p&&Y(d,c)){return{schema:{type:"multi_select",options:a.map(((e,t)=>({id:o(),value:e,color:(0,s().Zd)([])})))},validate:e=>i.has(e),coerce:n().D_}}var d,c,p}function Y(e,t){return e>0&&e**2<t}function K(e,t,o){const r=l().ki(t),a=new Set(r);if(Y(r.length,t.length)){return{schema:{type:"select",options:r.map(((e,t)=>({id:o(),value:e,color:(0,s().Zd)([])})))},validate:e=>a.has(e),coerce:n().D_}}}function X(e,t){return{schema:{type:"text"},validate:n().vF,coerce:n().D_}}function ee(e,t){t||(t=function(e,t){let o=",",n=0;const r=e.split(/\r?\n/).slice(0,10).join("\n");for(const a of t){const e=oe(r,a);if(e.length<=1)continue;const t=e.map((e=>e.length)),i=te(t),s=t.filter((e=>e===i)).length/t.length;if(i<=1||s<(i>=6?.6:.7))continue;const l=i,d=100*s+10*l-50*(e.flat().filter((e=>e.includes(a))).length/(e.length*l));d>n&&(n=d,o=a)}return o}(e,[",",";","\t","|"]));const o=[];let n=[],r="",a=!1;for(let i=0;i<e.length;i++){const s=e[i],l=e[i+1];if('"'===s)a&&'"'===l?(r+='"',i++):a=!a;else if(s!==t||a)if("\n"!==s&&("\r"!==s||"\n"===l)||a){if("\r"===s&&"\n"===l&&!a)continue;r+=s}else n.push(r),o.push(n),n=[],r="";else n.push(r),r=""}return(r||n.length>0)&&(n.push(r),o.push(n)),o}function te(e){var t;const o=e.reduce(((e,t)=>(e[t]=(e[t]||0)+1,e)),{});return Number((null===(t=Object.entries(o).sort(((e,t)=>t[1]-e[1]))[0])||void 0===t?void 0:t[0])||0)}function oe(e,t){const o=[];let n=[],r="",a=!1;for(let i=0;i<e.length;i++){const s=e[i],l=e[i+1];'"'===s?a&&'"'===l?(r+='"',i++):a=!a:s!==t||a?"\n"!==s&&"\r"!==s||a?r+=s:(n.push(r),n.length>0&&o.push(n),n=[],r="","\r"===s&&"\n"===l&&i++):(n.push(r),r="")}return(r||n.length>0)&&(n.push(r),o.push(n)),o.filter((e=>e.length>0&&e.some((e=>e.trim()))))}const ne=[{type:"title",name:"Title"},{type:"text",name:"Text"},{type:"number",name:"Number"},{type:"select",name:"Select"},{type:"multi_select",name:"Multi-select"},{type:"status",name:"Status"},{type:"date",name:"Date"},{type:"checkbox",name:"Checkbox"},{type:"url",name:"URL"},{type:"email",name:"Email"},{type:"phone_number",name:"Phone Number"},{type:"person",name:"Person"},{type:"dont_import",name:"Don't import"}]},911676:(e,t,o)=>{o.d(t,{N$:()=>H,aH:()=>Me,lc:()=>j,Hw:()=>He,HZ:()=>Fe});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(823215),o(354520),o(672577),o(430670),o(803949),o(581454),o(737550),o(814603),o(147566),o(198721);var n=()=>o(188835),r=o.n(o(43371)),a=()=>o(906745),i=()=>o(319625),s=()=>o(496603),l=()=>o(498212),d=()=>o(534177),c=()=>o(700500),p=()=>o(356246),u=()=>o(713998),m=()=>o(604995),f=()=>o(304740),h=()=>o(634201),g=()=>o(617871),C=()=>o(522419),I=()=>o(165358),b=()=>o(258035),v=()=>o(179034);var y=()=>o(513416),w=()=>o(792071),x=()=>o(134025),_=()=>o(979004),N=()=>o(519831),S=()=>o(343666),E=()=>o(197959),k=()=>o(798880),A=()=>o(201980);const D={CommentAuthor:"cma",CommentDiscussionId:"cmm"},T={a:!0,strong:!0,em:!0,code:!0,del:!0,s:!0,span:!0,time:!0},L={meta:!0,style:!0,script:!0,head:!0,title:!0},B="sourceCode",O=700,P=400,M=1e5,H="#maybeCitation:",F=new RegExp(`^${H}<(.*)>$`);function q(e){if(!e)return;const t=parseInt(e);return isNaN(t)?void 0:t}const j={[A().Ifu.Page]:"data-notion-page-id",[A().Ifu.Collection]:"data-notion-collection-id",spaceId:"data-notion-space-id",[A().Ifu.Highlight]:"data-notion-highlight",[A().Ifu.User]:"data-notion-user-id",[A().Ifu.Discussion]:"data-notion-block-discussion-id",[A().Ifu.Equation]:"data-notion-inline-equation",[A().Ifu.Comment]:"data-notion-block-comment-id",[D.CommentAuthor]:"data-notion-block-comment-author-id",[D.CommentDiscussionId]:"data-notion-block-comment-discussion-id",[c().xd.code]:"data-notion-code-syntax",[c().xd.callout]:"data-notion-callout",calloutIcon:"data-notion-callout-icon",calloutBackground:"data-notion-callout-background",[c().xd.tableOfContents]:"data-notion-toc",[c().xd.file]:"data-notion-file",fileAlias:"data-notion-file-alias",[c().xd.columnList]:"data-notion-column-list",[c().xd.column]:"data-notion-column-ratio",[c().xd.video]:"data-notion-video",[c().xd.audio]:"data-notion-audio",[c().xd.pdf]:"data-notion-pdf",[c().xd.equation]:"data-notion-equation",dateFormat:"data-notion-date-format",[c().xd.externalObjectInstance]:"data-notion-link-preview",[c().xd.embed]:"data-notion-embed"},U="Lucidchart",V="Jira",z="JiraDC";g().me,g().Fv,g().me,g().Fv,g().me,g().Fv;function W(e,t){return t&&t.nodeType===e.Node.ELEMENT_NODE}function $(e,t){return e.nodeType===t.Node.TEXT_NODE||e instanceof t.Element&&T[e.tagName.toLowerCase()]}function R(e,t,o,n=[]){var r;if(t&&1===e.nodeType&&e.hasAttribute(j[A().Ifu.Comment]))return n;if(o&&"pre"===(null===(r=e.tagName)||void 0===r?void 0:r.toLowerCase()))return n;n.push(e);for(const a of h().PE(e.childNodes))R(a,t,o,n);return n}function J(e){const t=[];if(!e.parentNode)return t;let o=e.parentNode;for(;o;)t.push(o),o=o.parentNode||void 0;return t}function Q(e,t){const o=J(e).filter((e=>e instanceof t.Element&&("ul"===e.tagName.toLowerCase()||"ol"===e.tagName.toLowerCase()))).length;return o}const Z=["•","◦","▪"],G=["h1","h2","h3","h4","h5","h6"].map((e=>`${e}:not(:first-child)`)).join(", ");function Y(e){const{node:t,window:o,stripText:n,stripSurroundingWhitespace:r,timeZone:i,ignoreComments:s,deps:d,ignoreCodeBlock:p,preserveLineBreaksInTableCellsEnabled:u}=e;if(!n){for(const e of Array.from(t.querySelectorAll("p:not(:first-child)")))e.prepend("\n");for(const e of Array.from(t.querySelectorAll(G)))e.prepend("\n");for(const e of Array.from(t.querySelectorAll("ul > li"))){const t=Q(e,o)-1,n=t%Z.length,r=Z[n],a="    ".repeat(t);e.prepend(`\n${a}${r} `)}for(const e of Array.from(t.querySelectorAll("ol"))){const t=Q(e,o),n="    ".repeat(t);for(let o=0;o<e.children.length;o+=1){e.children[o].prepend(`\n${n}${o+1}. `)}}for(const e of Array.from(t.querySelectorAll("pre")))e.parentNode&&e.parentNode.insertBefore(o.document.createTextNode("\n\n"),e)}const f=[],h=[],g=R(t,s,p);let C=!1;const I=g.filter((e=>e.nodeType!==o.Node.TEXT_NODE?!!(u&&e instanceof o.Element&&"br"===e.tagName.toLowerCase())&&(e.data="\n",C=!0,!0):!n||!/^( |\t)*(\n)+( |\t)*$/.test(e.data)));let b=!0;I.forEach(((e,s)=>{let p=e.data;n&&(p=p.replace(/\[ \] /g,""),p=p.replace(/\[x\] /g,""),p=p.replace(/^[\-\*\•]\s?/g,""),p=p.replace(/(\s)+/g,"$1")),!t.hasAttribute("confluenceTabSpaces")&&0===s&&r&&(p=p.trimStart()),p=A().xV3(p),s===I.length-1&&b&&r&&(p=p.trimEnd());const u=[],g=J(e);let C;!n&&g.some((e=>e instanceof o.Element&&("h1"===e.tagName.toLowerCase()||"h2"===e.tagName.toLowerCase()||"h3"===e.tagName.toLowerCase()||"h4"===e.tagName.toLowerCase()||"h5"===e.tagName.toLowerCase()||"h6"===e.tagName.toLowerCase())))&&u.push([A().Ifu.Bold]),g.some((e=>e instanceof o.Element&&"strong"===e.tagName.toLowerCase()))&&u.push([A().Ifu.Bold]),g.some((e=>e instanceof o.Element&&"em"===e.tagName.toLowerCase()))&&u.push([A().Ifu.Italic]),g.some((e=>e instanceof o.Element&&"u"===e.tagName.toLowerCase()))&&u.push([A().Ifu.Underline]),g.some((e=>e instanceof o.Element&&("code"===e.tagName.toLowerCase()||"pre"===e.tagName.toLowerCase())))&&u.push([A().Ifu.Code]),g.some((e=>e instanceof o.Element&&("del"===e.tagName.toLowerCase()||"strike"===e.tagName.toLowerCase()||"s"===e.tagName.toLowerCase())))&&u.push([A().Ifu.Strike]);const y=g.find((e=>{var t;return e instanceof o.Element&&(e.hasAttribute(j[A().Ifu.Highlight])||(null===(t=e.parentElement)||void 0===t?void 0:t.hasAttribute(j[A().Ifu.Highlight])))}));if(y&&y instanceof o.Element){var w;const e=y.getAttribute(j[A().Ifu.Highlight]),t=null===(w=y.parentElement)||void 0===w?void 0:w.getAttribute(j[A().Ifu.Highlight]),o=Ue(e&&"undefined"!==e?e||"":t||"");o&&u.push([A().Ifu.Highlight,o])}const x=g.find((e=>e instanceof o.Element&&"a"===e.tagName.toLowerCase()));if(x){const e=x.getAttribute(j[A().Ifu.Page]),t=x.getAttribute("notionUserId")||x.getAttribute(j[A().Ifu.User]),o=x.getAttribute(j.spaceId),n=x.getAttribute(j[A().Ifu.Comment]),r=x.getAttribute(j[A().Ifu.Collection]);if("string"==typeof e&&(0,l().uj)(e)&&"string"==typeof o&&(0,l().uj)(o))C=A().ld4(e,o);else if("string"==typeof r&&(0,l().uj)(r)&&"string"==typeof o&&(0,l().uj)(o))C=A().ETy({collectionId:r,spaceId:o,parentCvbId:void 0});else if(x.href){const e=F.exec(decodeURIComponent(x.hash));e?u.push(A().Sez(decodeURIComponent(e[1]))):u.push(A().Sez(x.href))}else"string"==typeof t&&(0,l().uj)(t)?(C=A().P4h(t),x.getAttribute("notionUserId")&&s===I.length-2&&(b=!1)):n&&o&&(0,l().uj)(n)&&(0,l().uj)(o)&&(C=A().hiQ(n,o))}const _=g.find((e=>!!(e instanceof o.Element&&e.getAttribute(j[A().Ifu.Discussion])))),N=t.classList.contains("page-comment");if(_&&!N){const e=_.getAttribute(j[A().Ifu.Discussion]);if(e){e.split(",").forEach((e=>u.push(A().aQj(e))))}}const S=g.find((e=>e instanceof o.Element&&"sub"===e.tagName.toLowerCase()));let E;"true"===(null==S?void 0:S.getAttribute("confluenceProcessableEquation"))&&(E=`_{${S.textContent}}`);const k=g.find((e=>e instanceof o.Element&&"sup"===e.tagName.toLowerCase()));let D;"true"===(null==k?void 0:k.getAttribute("confluenceProcessableEquation"))&&(D=`^{${k.textContent}}`);const T=g.find((e=>e instanceof o.Element&&e.hasAttribute(j[A().Ifu.Equation])));let L;null!=T&&T.textContent&&(L=T.textContent);const B=g.find((e=>e instanceof o.Element&&"time"===e.tagName.toLowerCase()));if(B){const e=B.getAttribute("datetime");if(e){const t=function(e,t){const o=a().c9.fromISO(e),n=o.toMillis();return n===o.startOf("day").toMillis()?m().C6.toPersistedDate(n,t):m().C6.toPersistedDateTime(n,t)}(e,i),o={...t};"relative"===B.getAttribute(j.dateFormat)&&(o.date_format="relative"),C=A().Ww9(o)}}const O=g.find((e=>!!(e instanceof o.Element&&e instanceof o.HTMLSpanElement&&e.getAttribute(j[c().xd.externalObjectInstance]))));if(C)f.push(A().wmz(C,u));else if(E)f.push(A().G0H(E,u));else if(D)f.push(A().G0H(D,u));else if(L)f.push(A().G0H(L,u));else if(O&&null!=d&&d.randomID){var P;const e=(null==d||null===(P=d.spaceIdCreator)||void 0===P?void 0:P.idInSavedSpace(v().ev))??d.randomID();f.push(A().wmz(A().bMp(e),u)),h.push(e)}else f.push(A().Ey_(p,u))}));const y=A().JG8(f,M),w=A().__s(y);if(C){const e=A().Ey_("",[[A().Ifu.Link,""]]);w.push(e)}return{titleTokens:w,linkMentionBlockIds:h}}function K(e,t){const o=["img[src]","a[download]",`a[${j[c().xd.file]}]`,`audio[${j[c().xd.audio]}]`,`video[${j[c().xd.video]}]`,"li"];t&&o.push("pre");const n=e.querySelectorAll(o.join(","));return h().PE(n)}function X(e){const{actor:t,parent:o,node:n,allOperations:r,deps:{importFileMap:a,window:i,intl:s,randomID:l,spaceIdCreator:d,randomShortID:c,isPhoneNumber:p},options:{useCrdt:u,ignoreBlockCount:m,considerCodeBlockAsNonTextItem:f,ignoreImages:h}}=e;return _e({actor:t,parent:o,nodes:K(n,f),allOperations:r,deps:{importFileMap:a,window:i,intl:s,randomID:l,spaceIdCreator:d,randomShortID:c,isPhoneNumber:p},options:{useCrdt:u,ignoreBlockCount:m,ignoreImages:h}})}function ee(e){const{actor:t,parent:o,node:n,type:r,allOperations:a,options:{useCrdt:i,ignoreBlockCount:s,stripText:l,stripSurroundingWhitespace:d,ignoreCodeBlock:p},deps:{window:u,randomID:m,spaceIdCreator:f}}=e,h=(null==f?void 0:f.idInSavedSpace(v().ev))??m(),{titleTokens:g,linkMentionBlockIds:C}=Y({node:n,window:u,stripText:l,stripSurroundingWhitespace:d,ignoreComments:!0,ignoreCodeBlock:p,deps:{randomID:m,spaceIdCreator:f}}),{operations:I}=w().zgg.create({id:h,type:r,properties:{title:g},parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!s||void 0},{useCrdt:i});if(a.push(...I),C.length){const e=n.querySelectorAll(`span[${j[c().xd.externalObjectInstance]}]`);for(const[n,r]of Array.from(e).entries())C[n]&&le({actor:t,parent:o,node:r,allOperations:a,deps:{randomID:m,spaceIdCreator:f},options:{useCrdt:i,ignoreBlockCount:s},blockId:C[n]})}return we({node:n,spaceId:o.spaceId,window:u,blockId:h,actor:t,allOperations:a}),h}function te(e){const{actor:t,parent:o,allOperations:n,deps:{randomID:r,spaceIdCreator:a},options:{useCrdt:i,ignoreBlockCount:s}}=e,l=(null==a?void 0:a.idInSavedSpace(v().ev))??r(),{operations:d}=w().zgg.create({id:l,type:c().xd.divider,parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!s||void 0},{useCrdt:i});return n.push(...d),l}function oe(e){const{actor:t,parent:o,source:n,allOperations:r,deps:{randomID:a,spaceIdCreator:i},options:{useCrdt:s,ignoreBlockCount:l,fallbackWidth:d},node:p}=e;let u;"image"===n.type&&n.width?u=Math.min(n.width,O):d&&(u=Math.min(d,O));const m=(null==i?void 0:i.idInSavedSpace(v().ev))??a(),f=p.getAttribute("alt"),h={source:A().x9d(n.secureS3UrlOrAlias)};f&&(h.alt_text=A().x9d(f));const g=p.getAttribute("data-caption");g&&(h.caption=A().x9d(g));const{model:C,operations:I}=w().zgg.create({id:m,type:c().xd.image,properties:h,format:{block_width:u},parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!l||void 0},{useCrdt:s});return r.push(...I,C.DEPRECATED_DONT_CALL_WILL_BE_REMOVED_IN_Q2_2025___getSecureFilesUpdate("","")),m}function ne(e){const{actor:t,parent:o,node:n,sourceUrl:r,allOperations:a,deps:{randomID:i,spaceIdCreator:s},options:{useCrdt:l,ignoreBlockCount:d}}=e,c=q(n.getAttribute("height")),p=q(n.getAttribute("width")),u=(null==s?void 0:s.idInSavedSpace(v().ev))??i();let m;try{m=new URL(r)}catch(C){m=r}const h=f().WT({url:r,baseUrl:m instanceof URL?m.origin:m,publicDomainName:""}),{operations:g}=w().zgg.create({id:u,type:h,properties:{source:A().x9d(r)},format:{block_width:p,block_height:c,block_full_width:!1,block_page_width:!(p||c),block_preserve_scale:!0},parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!d||void 0},{useCrdt:l});return a.push(...g),u}function re(e){const{actor:t,parent:o,source:n,allOperations:r,deps:{randomID:a,spaceIdCreator:i},options:{useCrdt:s,ignoreBlockCount:l}}=e,d=(null==i?void 0:i.idInSavedSpace(v().ev))??a(),c=f().WT({url:n.secureS3UrlOrAlias,baseUrl:n.secureS3UrlOrAlias,publicDomainName:""}),p="embed"===c?"file":c,{model:u,operations:m}=w().zgg.create({id:d,type:p,properties:{title:A().x9d((0,C().Jt)(n.secureS3UrlOrAlias)),source:[A().Ey_(n.secureS3UrlOrAlias,[A().Sez(n.secureS3UrlOrAlias)])]},format:{block_width:"image"===n.type&&n.width?Math.min(n.width,O):void 0,block_height:n.height?Math.min(n.height,P):void 0},parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!l||void 0},{useCrdt:s});return r.push(...m,u.DEPRECATED_DONT_CALL_WILL_BE_REMOVED_IN_Q2_2025___getSecureFilesUpdate("","")),d}function ae(e){return"#text"===e.nodeName?e.textContent?e.textContent:"":Array.from(e.childNodes).map((e=>{const t=e.nodeName.toLowerCase();return"br"===t?"\n":"div"===t?`${ae(e)}\n`:ae(e)})).map((e=>e.split("\n").map((e=>e.trimRight())).join("\n"))).join("")}function ie(e){const{actor:t,parent:o,node:n,allOperations:a,htmlParserErrors:i,deps:{importFileMap:s,window:l,intl:d,randomID:p,spaceIdCreator:u,randomShortID:m,isPhoneNumber:f},options:{useCrdt:g,ignoreBlockCount:C}}=e,I=(null==u?void 0:u.idInSavedSpace(v().ev))??p(),b=n.getAttribute(j.calloutBackground),y=b?Ue(b):void 0,x=n.getAttribute(j.calloutIcon),_=x&&x.match(r()())?x:void 0,{title:N,children:S}=function(e){const{node:t,window:o}=e,n=h().PE(t.childNodes),[r,...a]=n;if(!r)return{title:[]};if(function(e){return t=>!!(W(e,t)&&t instanceof e.HTMLParagraphElement)}(o)(r)){const{titleTokens:e}=Y({node:r,window:o,stripText:!1,stripSurroundingWhitespace:!0,ignoreComments:!0});return{title:e,children:a}}if($(r,o)){const{titleTokens:e}=Y({node:t,window:o,stripText:!1,stripSurroundingWhitespace:!0,ignoreComments:!0});return{title:e,children:void 0}}return{title:[],children:n}}({node:n,window:l}),E=Array.isArray(S)?_e({actor:t,parent:{table:v().ev,id:I,spaceId:o.spaceId},nodes:S,allOperations:a,htmlParserErrors:i,deps:{importFileMap:s,window:l,intl:d,randomID:p,spaceIdCreator:u,randomShortID:m,isPhoneNumber:f},options:{useCrdt:g,ignoreBlockCount:C}}):[],{operations:k}=w().zgg.create({id:I,type:c().xd.callout,content:E,properties:{title:N},format:{block_color:y,page_icon:_},parentPointer:{id:o.id,table:o.table,spaceId:o.spaceId},space_id:o.spaceId,createdBy:t,ignore_block_count:!!C||void 0},{useCrdt:g});return a.push(...k),we({node:n,spaceId:o.spaceId,window:l,blockId:I,actor:t,allOperations:a}),I}function se(e){const{actor:t,parent:o,node:n,allOperations:r,deps:{importFileMap:a,randomID:i,spaceIdCreator:s},options:{useCrdt:l,ignoreBlockCount:d}}=e,p=n.getAttribute(j[c().xd.file])||"",u=a[p]?a[p].secureS3UrlOrAlias:p;let m=n.getAttribute(j.fileAlias)||"";!m&&u.lastIndexOf("/")>=0&&(m=u.substring(u.lastIndexOf("/")+1));const f=(null==s?void 0:s.idInSavedSpace(v().ev))??i(),{model:h,operations:g}=w().zgg.create({createdBy:t,id:f,parentPointer:{id:o.id,table:o.table,spaceId:o.spaceId},space_id:o.spaceId,properties:{source:A().x9d(u),title:A().x9d(m)},type:c().xd.file,ignore_block_count:!!d||void 0},{useCrdt:l});return r.push(...g,h.DEPRECATED_DONT_CALL_WILL_BE_REMOVED_IN_Q2_2025___getSecureFilesUpdate("","")),f}function le(e){const{actor:t,parent:o,node:r,allOperations:a,deps:{randomID:i,spaceIdCreator:s},options:{useCrdt:l,ignoreBlockCount:d}}=e,p=e.blockId?e.blockId:(null==s?void 0:s.idInSavedSpace(v().ev))??i();let u;const m="true"===r.getAttribute("bot-connected"),f=r.getAttribute("href"),h=r.getAttribute(j[c().xd.externalObjectInstance]);if(I().log({level:"info",from:"htmlHelpers",type:"linkPreviewStatus",data:{miscDataToConvertToString:{linkPreviewUrl:f,linkPreviewIntegration:h,isBotConnected:m,unfurlMetadataStr:r.getAttribute("metadata"),domainName:f?n().parse(f).hostname:void 0}}}),!f||!h)return;const g=n().parse(f).hostname;if(!g)return;if(m){const e=r.getAttribute("metadata");if(e){let t;try{t=JSON.parse(e)}catch(b){}u=t&&t.uri&&t.external_object_id&&t.bot_id&&t.attributes?{original_url:t.uri,domain:g,external_object_id:t.external_object_id,bot_id:t.bot_id,uri:t.uri,attributes:t.attributes}:{original_url:f,domain:g,error:{status_code:y().xB.BAD_REQUEST}}}else u={original_url:f,domain:g,error:{status_code:y().xB.BAD_REQUEST}}}else u={original_url:f,domain:g};if(!u)return;const{operations:C}=w().zgg.create({createdBy:t,id:p,parentPointer:{id:o.id,table:"block",spaceId:o.spaceId},type:c().xd.externalObjectInstance,space_id:o.spaceId,format:u,ignore_block_count:!!d||void 0},{useCrdt:l});return a.push(...C),p}const de=/language-(\w+)/;function ce(e){let t=null;return null==e||e.forEach(((e,o,n)=>{if(t)return;if(_().fileExtensionToCodeLanguageMap.hasOwnProperty(e))return void(t=e);const r=e.match(de);r&&r.length>1&&_().fileExtensionToCodeLanguageMap.hasOwnProperty(r[1])&&(t=r[1])})),t}function pe(e){const{actor:t,parent:o,node:n,allOperations:r,deps:{randomID:a,spaceIdCreator:i,window:s},options:{useCrdt:l,ignoreBlockCount:p,codePreviewFormat:u}}=e,m=(null==i?void 0:i.idInSavedSpace(v().ev))??a();let f=n.getAttribute(j[c().xd.code]);if(!f){var h;f=ce(null===(h=n.querySelector("code"))||void 0===h||null===(h=h.parentElement)||void 0===h?void 0:h.classList)}if(!f){var g;f=ce(null===(g=n.querySelector("code"))||void 0===g?void 0:g.classList)}const C=f&&(0,d().O)(_().fileExtensionToCodeLanguageMap,f)?_().fileExtensionToCodeLanguageMap[f]:"Plain Text",{operations:I}=w().zgg.create({id:m,type:c().xd.code,properties:{title:A().x9d(ae(n)),language:[[C]]},format:{code_wrap:!0,code_preview_format:u},parentPointer:{id:o.id,table:o.table,spaceId:o.spaceId},space_id:o.spaceId,createdBy:t,ignore_block_count:!!p||void 0},{useCrdt:l});return r.push(...I),we({node:n,spaceId:o.spaceId,window:s,blockId:m,actor:t,allOperations:r}),m}function ue(e){const{actor:t,parent:o,node:n,allOperations:r,deps:{randomID:a,spaceIdCreator:i},options:{useCrdt:s,ignoreBlockCount:l}}=e,d=(null==i?void 0:i.idInSavedSpace(v().ev))??a(),{operations:p}=w().zgg.create({id:d,type:c().xd.equation,properties:{title:A().x9d(ae(n))},parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!l||void 0},{useCrdt:s});return r.push(...p),d}function me(e){const{actor:t,parent:o,allOperations:n,deps:{randomID:r,spaceIdCreator:a},options:{useCrdt:i,ignoreBlockCount:s}}=e,l=(null==a?void 0:a.idInSavedSpace(v().ev))??r(),{operations:d}=w().zgg.create({id:l,type:c().xd.tableOfContents,format:{block_color:"gray"},parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!s||void 0},{useCrdt:i});return n.push(...d),l}function fe(e){const{actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:l,randomID:d,spaceIdCreator:p,randomShortID:u,isPhoneNumber:m},options:{useCrdt:f,ignoreBlockCount:g}}=e,C=(null==p?void 0:p.idInSavedSpace(v().ev))??d(),[I,...b]=h().PE(n.childNodes),y=_e({actor:t,parent:{id:C,table:v().ev,spaceId:o.spaceId},nodes:b,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:l,randomID:d,spaceIdCreator:p,randomShortID:u,isPhoneNumber:m},options:{useCrdt:f,ignoreBlockCount:g}}),{operations:x}=w().zgg.create({id:C,type:c().xd.quote,properties:{title:A().x9d(null!=I&&I.textContent?I.textContent.trim():"")},content:y,parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!g||void 0},{useCrdt:f});return r.push(...x),we({node:n,spaceId:o.spaceId,blockId:C,actor:t,allOperations:r,window:s}),C}function he(e){const{actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:l,randomID:d,spaceIdCreator:p,randomShortID:u,isPhoneNumber:m},options:{useCrdt:f,ignoreBlockCount:g}}=e,C=(null==p?void 0:p.idInSavedSpace(v().ev))??d(),I=n.querySelector("summary"),b=h().PE(n.childNodes).filter((e=>e!==I)),y=I&&I.textContent&&(()=>{const{titleTokens:e}=Y({node:I,window:s,stripText:!1,stripSurroundingWhitespace:!0,ignoreComments:!0,deps:{randomID:d,spaceIdCreator:p}});return e})(),x=_e({actor:t,parent:{id:C,table:v().ev,spaceId:o.spaceId},nodes:b,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:l,randomID:d,spaceIdCreator:p,randomShortID:u,isPhoneNumber:m},options:{useCrdt:f,ignoreBlockCount:g}}),{operations:_}=w().zgg.create({id:C,type:c().xd.toggle,content:x,properties:{title:y||A().x9d("")},parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!g||void 0},{useCrdt:f});return r.push(..._),C}function ge(e){const{actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:l,randomID:d,spaceIdCreator:p,randomShortID:u,isPhoneNumber:m},options:{useCrdt:f,ignoreBlockCount:g}}=e,C=(null==p?void 0:p.idInSavedSpace(v().ev))??d(),I=h().PE(n.children).filter((e=>e.hasAttribute(j[c().xd.column]))).slice(0,8).map((e=>function(e){const{actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:l,randomID:d,spaceIdCreator:p,randomShortID:u,isPhoneNumber:m},options:{useCrdt:f,ignoreBlockCount:g}}=e,C=(null==p?void 0:p.idInSavedSpace(v().ev))??d(),I=n.getAttribute(j[c().xd.column]);let b;if(null!==I){const e=parseFloat(I);!Number.isNaN(e)&&e>0&&e<=1&&(b=e)}const y=_e({actor:t,parent:{id:C,table:v().ev,spaceId:o.spaceId},nodes:h().PE(n.children),allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:l,randomID:d,spaceIdCreator:p,randomShortID:u,isPhoneNumber:m},options:{useCrdt:f,ignoreBlockCount:g}}),{operations:x}=w().zgg.create({id:C,type:c().xd.column,format:{column_ratio:b},content:y,parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!g||void 0},{useCrdt:f});return r.push(...x),C}({actor:t,parent:{id:C,table:v().ev,spaceId:o.spaceId},node:e,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:l,randomID:d,spaceIdCreator:p,randomShortID:u,isPhoneNumber:m},options:{useCrdt:f,ignoreBlockCount:g}}))),{operations:b}=w().zgg.create({id:C,type:c().xd.columnList,content:I,parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!g||void 0},{useCrdt:f});return r.push(...b),C}const Ce=/^\[x\].*/,Ie=/^\[ \].*/,be=/^[-\*\•].*/;function ve(e){const{actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:l,randomID:d,spaceIdCreator:u,randomShortID:m,isPhoneNumber:f},options:{useCrdt:g,ignoreBlockCount:C}}=e,I=(null==u?void 0:u.idInSavedSpace(v().ev))??d(),b=s.document.createElement("span"),y=[];h().PE(n.childNodes).forEach(((e,t)=>{(function(e,t){return e instanceof t.Element&&"a"===e.tagName.toLowerCase()&&e.hasAttribute("data-confluence-web-image")})(e,s)||0===t&&function(e,t){return e instanceof t.Element&&"a"===e.tagName.toLowerCase()&&e.hasAttribute(j[c().xd.file])}(e,s)?y.push(e):0===t&&!(function(e,t){return e instanceof t.Element&&"img"===e.tagName.toLowerCase()}(e,s)||function(e,t){return e instanceof t.Element&&"video"===e.tagName.toLowerCase()}(e,s)||function(e,t){return e instanceof t.Element&&"audio"===e.tagName.toLowerCase()}(e,s))||$(e,s)?(b.appendChild(e),e instanceof s.Element&&K(e).forEach((e=>y.push(e)))):y.push(e)}));const x=_e({actor:t,parent:{id:I,table:v().ev,spaceId:o.spaceId},nodes:y,allOperations:r,htmlParserErrors:a,deps:{importFileMap:i,window:s,intl:l,randomID:d,spaceIdCreator:u,randomShortID:m,isPhoneNumber:f},options:{useCrdt:g,ignoreBlockCount:C}}),_=Ce.test(b.textContent||""),N=Ie.test(b.textContent||"");let S;S=_||N?c().xd.toDo:n.parentNode instanceof s.Element&&"ol"===n.parentNode.tagName.toLowerCase()?c().xd.numberedList:c().xd.bulletedList;let E=!1;S===c().xd.toDo&&_&&(E=!0);const{titleTokens:k}=Y({node:b,window:s,stripText:!0,stripSurroundingWhitespace:!0,ignoreComments:!0,deps:{randomID:d,spaceIdCreator:u}}),{operations:D}=w().zgg.create({id:I,type:S,content:x,properties:{title:k,checked:E?A().x9d(p().I1):void 0},parentPointer:o,space_id:o.spaceId,createdBy:t,ignore_block_count:!!C||void 0},{useCrdt:g});return r.push(...D),we({node:b,spaceId:o.spaceId,blockId:I,actor:t,allOperations:r,window:s}),I}function ye(e){const{node:t,spaceId:o,window:n,actor:r,discussionId:a,allOperations:i,deps:s,options:l}=e,d=Array.from(t.querySelectorAll(`span[${j[D.CommentDiscussionId]}="${a}"]`)),c=Date.now(),p=[];for(const u of d){if(null===u.textContent||0===u.textContent.trim().length)continue;const e=u.getAttribute(j[A().Ifu.Comment]);if(!e)continue;const{titleTokens:d}=Y({node:u,window:n,stripText:!0,stripSurroundingWhitespace:!0,ignoreComments:!1}),m=u.getAttribute(j[D.CommentAuthor]);p.push(e);const f=s&&l&&X({actor:r,parent:{table:S().SN,id:e,spaceId:o},node:t,allOperations:i,deps:s,options:l}),h={id:e,parent_id:a,parent_table:E().$Y,space_id:o,version:1,created_time:c,last_edited_time:c,text:d,created_by_table:k().oo,created_by_id:m||r.id,alive:!0,...f&&{content:f}};i.push(x().op.set({pointer:{table:S().SN,id:e,spaceId:o},path:[],args:h}))}return p}function we(e){const{node:t,spaceId:o,blockId:n,actor:r,allOperations:a,window:i}=e,s=Array.from(t.querySelectorAll(`span[${j[A().Ifu.Discussion]}]`)),l=new Map;for(const d of s){const e=d.getAttribute(j[A().Ifu.Discussion]);if(!e)continue;e.split(",").forEach((e=>{if(l.has(e)){var t;null===(t=l.get(e))||void 0===t||null===(t=t.context)||void 0===t||t.push([d.textContent??"",[[A().Ifu.Discussion,e]]])}else{const t={id:e,type:"default",parent_id:n,parent_table:v().ev,resolved:!1,context:[[d.textContent??"",[[A().Ifu.Discussion,e]]]],space_id:o,version:0};l.set(e,t)}}))}xe({node:t,spaceId:o,window:i,blockId:n,actor:r,discussionToTextMap:l,allOperations:a})}function xe(e){const{node:t,spaceId:o,window:n,blockId:r,actor:a,discussionToTextMap:i,allOperations:s,deps:l,options:d}=e;for(const[c,p]of i.entries()){const e=ye({node:t,spaceId:o,window:n,discussionId:c,actor:a,allOperations:s,deps:l,options:d});p.comments=e,s.push(x().op.set({pointer:{table:E().$Y,id:c,spaceId:o},path:[],args:p}),{pointer:{table:v().ev,id:r,spaceId:o},command:"listAfter",path:["discussions"],args:{id:c}})}}function _e(e){const{actor:t,parent:o,nodes:n,allOperations:r,deps:a,htmlParserErrors:i,options:l}=e;return s().KC(...n.map((e=>Ne({actor:t,parent:o,node:e,allOperations:r,deps:a,htmlParserErrors:i,options:l}))))}function Ne(e){const{actor:t,parent:o,node:n,allOperations:r,deps:a,htmlParserErrors:l,options:d}=e,{importFileMap:p,window:m,intl:g,randomID:C,spaceIdCreator:I,blockContentMaxSize:y}=a,{useCrdt:w,ignoreBlockCount:x,treatNestedCodeAsCodeBlocks:_,skipTableToCollectionConversion:k,preserveLineBreaksInTableCellsEnabled:D,addHeadersToCollectionEnabled:T,codePreviewFormat:L,ignoreImages:O}=d;if(n&&n instanceof m.Element){const e=n.tagName.toLowerCase();if("div"===e&&"page-comments"===n.getAttribute("class")){const e=function(e){var t;const{node:o,parent:n,actor:r,window:a,allOperations:i,deps:s,options:l}=e,d=o.getAttribute(j[A().Ifu.Discussion])||((null===(t=s.spaceIdCreator)||void 0===t?void 0:t.idInSavedSpace(E().$Y))??s.randomID()),c=new Map;return c.set(d,{type:"default",id:d,parent_id:n.id,parent_table:v().ev,resolved:!1,space_id:n.spaceId,version:1}),xe({node:o,spaceId:n.spaceId,window:a,blockId:n.id,discussionToTextMap:c,allOperations:i,actor:r,deps:s,options:l}),d}({node:n,window:m,actor:t,allOperations:r,parent:o,deps:a,options:d});return[e]}if("h1"===e)return[ee({actor:t,parent:o,node:n,type:c().xd.header,allOperations:r,deps:{window:m,randomID:C,spaceIdCreator:I},options:{useCrdt:w,ignoreBlockCount:x,stripText:!0,stripSurroundingWhitespace:!0}}),...X({actor:t,parent:o,node:n,allOperations:r,deps:a,options:{useCrdt:w,ignoreBlockCount:x}})];if("h2"===e)return[ee({actor:t,parent:o,node:n,type:c().xd.subHeader,allOperations:r,deps:{window:m,randomID:C,spaceIdCreator:I},options:{useCrdt:w,ignoreBlockCount:x,stripText:!0,stripSurroundingWhitespace:!0}}),...X({actor:t,parent:o,node:n,allOperations:r,deps:a,options:{useCrdt:w,ignoreBlockCount:x}})];if("hr"===e)return[te({actor:t,parent:o,allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{useCrdt:w,ignoreBlockCount:x}})];if("h"===e[0])return[ee({actor:t,parent:o,node:n,type:c().xd.subSubHeader,allOperations:r,deps:{window:m,randomID:C,spaceIdCreator:I},options:{useCrdt:w,ignoreBlockCount:x,stripText:!0,stripSurroundingWhitespace:!0}}),...X({actor:t,parent:o,node:n,allOperations:r,deps:a,options:{useCrdt:w,ignoreBlockCount:x}})];if("pre"===e||"code"===e||"div"===e&&n.className===B)return n.innerHTML.length&&y&&y>0&&n.innerHTML.length>y?[]:[pe({actor:t,parent:o,node:n,allOperations:r,deps:{randomID:C,spaceIdCreator:I,window:m},options:{useCrdt:w,ignoreBlockCount:x,codePreviewFormat:L}}),...X({actor:t,parent:o,node:n,allOperations:r,deps:a,options:{useCrdt:w,ignoreBlockCount:x}})];if(n.hasAttribute(j[c().xd.callout]))return[ie({actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:l,deps:a,options:{useCrdt:w,ignoreBlockCount:x}})];if("blockquote"===e)return[fe({actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:l,deps:a,options:{useCrdt:w,ignoreBlockCount:x}})];if("details"===e)return[he({actor:t,parent:o,node:n,allOperations:r,deps:a,htmlParserErrors:l,options:{useCrdt:w,ignoreBlockCount:x}})];if("table"===e){const{tableData:d,tableFiles:f,hasHeaderRow:h,hasHeaderColumn:C}=function(e){const{node:t,window:o,importFileMap:n,intl:r,preserveLineBreaksInTableCellsEnabled:a}=e,i=[],l=[],d=Array.from(t.querySelectorAll("tr")).filter((e=>e.closest("table")===t));let p=!1,m=!1;if(d.length>0){const e=d[0].querySelectorAll("td, th"),t=d[0].querySelectorAll("th");if(p=e.length>0&&t.length===e.length,m=d.every((e=>{const t=e.querySelector("td, th");return t&&"th"===t.tagName.toLowerCase()}))&&d.length>0,p&&m){const e=d[0].querySelector("td, th");if(!(e&&"th"===e.tagName.toLowerCase())){t.length>=d.filter((e=>{const t=e.querySelector("td, th");return t&&"th"===t.tagName.toLowerCase()})).length?m=!1:p=!1}}}for(const f of d){const e=[],t=[],d=Array.from(f.querySelectorAll("td, th")).filter((e=>e.closest("tr")===f));for(const r of d){const i=(r.textContent||"").trim(),l=Se(r.getAttribute("rowspan"),1),{titleTokens:d}=Y({node:r,window:o,stripText:!1,stripSurroundingWhitespace:!0,ignoreComments:!0,preserveLineBreaksInTableCellsEnabled:a});e.push({text:i,textValue:d,rowSpan:l});const p=Se(r.getAttribute("colspan"),1);for(let t=1;t<p;t++)e.push({text:"",rowSpan:l});const u=K(r);if(u.length){const e=s().oE(u.flatMap((e=>{var t;const o=e.getAttribute("src")||e.getAttribute(j[c().xd.file])||e.getAttribute(j[c().xd.audio])||e.getAttribute(j[c().xd.video]),r=e.getAttribute(j.fileAlias);return o?{name:r||o,url:(null===(t=n[o])||void 0===t?void 0:t.secureS3UrlOrAlias)||o}:void 0})));t.push(...e)}}e.length&&l.push(e);const p=u().eQ(t);i.push({text:r.formatMessage({id:"htmlHelpers.table.fileColumnName",defaultMessage:"Files"}),textValue:p})}for(let s=0;s<l.length;s++){const e=l[s];for(let t=0;t<e.length;t++){const o=e[t].rowSpan;if(o>1)for(let e=1;e<o&&!(s+e>=l.length);e++){l[s+e].splice(t,0,{text:"",rowSpan:1})}}}return{tableData:l,tableFiles:i,hasHeaderRow:p,hasHeaderColumn:m}}({node:n,window:m,importFileMap:p,intl:g,preserveLineBreaksInTableCellsEnabled:D});if(!k&&f.some((e=>{var t;return null===(t=e.textValue)||void 0===t?void 0:t.length})))for(let e=0;e<d.length;e++)d[e].push({text:f[e].text,textValue:f[e].textValue,columnType:{schema:{type:"file"},validate:s().vF,coerce:s().D_}});let I="table";if((n.hasAttribute("data-import-as-database")||!k&&f.some((e=>{var t;return null===(t=e.textValue)||void 0===t?void 0:t.length})))&&(I="collection"),0===s().rG(d).length)return[];if(o.table===N().Vl||o.table===S().SN)return[];const y={...o,table:o.table};try{const e=function(e){const{actor:t,parent:o,node:n,tableData:r,allOperations:a,deps:{intl:i,randomID:s,spaceIdCreator:l,randomShortID:d,isPhoneNumber:c,addFileIdsToBlock:p},options:{useCrdt:u,ignoreBlockCount:m,tableType:f,addHeadersToCollectionEnabled:h,hasHeaderRow:g,hasHeaderColumn:C}}=e,I=(null==l?void 0:l.idInSavedSpace(v().ev))??s();if("table"===f){const{operations:e}=(0,b().L5)({actor:t,tableId:I,parent:o,table:r,deps:{randomID:s,spaceIdCreator:l,randomShortID:d},options:{useCrdt:u,ignoreBlockCount:m,hasHeaderRow:g,hasHeaderColumn:C}});a.push(...e)}else if("collection"===f){const e=n.getAttribute("data-database-title")??"",{operations:f}=(0,b().ph)({actor:t,blockType:"collection_view",root:{existing:!1,id:I},parent:o,name:e,format:{table_wrap:!0},table:r,deps:{intl:i,randomID:s,spaceIdCreator:l,randomShortID:d,isPhoneNumber:c,addFileIdsToBlock:p??!1},options:{useCrdt:u,ignoreBlockCount:m,useCsvAdaptiveSchema:!0,addHeadersToCollectionEnabled:h}});a.push(...f)}return I}({actor:t,parent:y,node:n,tableData:d,allOperations:r,deps:a,options:{useCrdt:w,ignoreBlockCount:x,tableType:I,addHeadersToCollectionEnabled:T,hasHeaderRow:h,hasHeaderColumn:C}});return[e]}catch(P){const t=(0,i().A)(P);if(!l||"CsvImportError"!==t.message)throw P;const o=l.get(e)||0;return l.set(e,o+1),[]}}if("div"===e&&n.hasAttribute(j[c().xd.columnList]))return[ge({actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:l,deps:a,options:{useCrdt:w,ignoreBlockCount:x}})];if("nav"===e&&n.hasAttribute(j[c().xd.tableOfContents]))return[me({actor:t,parent:o,allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{useCrdt:w,ignoreBlockCount:x}}),...X({actor:t,parent:o,node:n,allOperations:r,deps:a,options:{useCrdt:w,ignoreBlockCount:x}})];if("ul"===e||"ol"===e)return s().KC(...Array.from(n.children).map((e=>Ne({actor:t,parent:o,node:e,allOperations:r,deps:a,options:{useCrdt:w,ignoreBlockCount:x}}))));if("li"===e||Ce.test(n.textContent||"")||Ie.test(n.textContent||"")||be.test(n.textContent||""))return[ve({actor:t,parent:o,node:n,allOperations:r,htmlParserErrors:l,deps:a,options:{useCrdt:w,ignoreBlockCount:x}})];if("img"===e){const e=n.getAttribute("src");if(e&&!O)return[oe({actor:t,parent:o,source:p[e]||{type:"unknown",secureS3UrlOrAlias:e},allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{useCrdt:w,ignoreBlockCount:x,fallbackWidth:n instanceof m.HTMLImageElement?n.width:void 0},node:n})]}if("a"===e&&n.getAttribute(j[c().xd.externalObjectInstance])){const e=le({actor:t,parent:o,node:n,allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{useCrdt:w,ignoreBlockCount:x}});return e?[e]:[]}if("a"===e&&n.getAttribute(j[c().xd.embed])){const e=n.getAttribute("href");if(e)return[re({actor:t,parent:o,source:{type:"unknown",secureS3UrlOrAlias:e,height:400},allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{useCrdt:w,ignoreBlockCount:x}})]}if("a"===e&&n.getAttribute(j[c().xd.file]))return[se({actor:t,parent:o,node:n,allOperations:r,deps:{importFileMap:p,randomID:C,spaceIdCreator:I},options:{useCrdt:w,ignoreBlockCount:x}})];if("a"===e&&0===h().PE(n.childNodes).length){const e=n.getAttribute("href");if(n.hasAttribute("download")&&e)return[re({actor:t,parent:o,source:p[e]||{type:"unknown",secureS3UrlOrAlias:e},allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{useCrdt:w,ignoreBlockCount:x}})]}if("video"===e){const e=n.querySelector("source");if(e){const n=e.getAttribute("src");if(n&&f().L_({url:n}))return[re({actor:t,parent:o,source:{type:"unknown",secureS3UrlOrAlias:n},allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{useCrdt:w,ignoreBlockCount:x}})]}}if("audio"===e){const e=n.querySelector("source");if(e){const n=e.getAttribute("src");if(n&&f().ck({url:n}))return[re({actor:t,parent:o,source:{type:"unknown",secureS3UrlOrAlias:n},allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{useCrdt:w,ignoreBlockCount:x}})]}}if("iframe"===e){const e=n.getAttribute("src");if(e)return[ne({actor:t,parent:o,node:n,sourceUrl:e,allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{useCrdt:w,ignoreBlockCount:x}})]}return"p"===e&&n.getAttribute("confluenceNewLine")?[ee({actor:t,parent:o,node:n,type:c().xd.text,allOperations:r,deps:{window:m,randomID:C,spaceIdCreator:I},options:{useCrdt:w,ignoreBlockCount:x,stripText:!0,stripSurroundingWhitespace:!0}})]:n.hasAttribute(j[c().xd.equation])?[ue({actor:t,parent:o,node:n,allOperations:r,deps:{randomID:C,spaceIdCreator:I},options:{useCrdt:w,ignoreBlockCount:x}})]:[.../^\s*$/g.test(n.textContent||"")?[]:[ee({actor:t,parent:o,node:n,type:c().xd.text,allOperations:r,deps:{window:m,randomID:C,spaceIdCreator:I},options:{useCrdt:w,ignoreBlockCount:x,stripText:!1,stripSurroundingWhitespace:!0,ignoreCodeBlock:_}})],...X({actor:t,parent:o,node:n,allOperations:r,deps:a,options:{useCrdt:w,ignoreBlockCount:x,considerCodeBlockAsNonTextItem:_,ignoreImages:O}})]}return[]}function Se(e,t){const o=null!==e?parseInt(e,10):t;return isFinite(o)?o:t}function Ee(e,t,o){const n=o.document.createElement(t);for(;e.firstChild;)n.appendChild(e.firstChild);for(let r=e.attributes.length-1;r>=0;--r){const t=e.attributes[r];n.setAttribute(t.name,t.value)}return e.parentNode&&e.parentNode.replaceChild(n,e),n}function ke(e,t,o){const n=o.document.createElement(t);for(;e.firstChild;)n.appendChild(e.firstChild);e.appendChild(n)}function Ae(e){const t=[];let o=e;for(;e.firstChild;){const n=e.firstChild;t.push(n),e.parentNode&&e.parentNode.insertBefore(n,o.nextSibling),o=n}const n=e.parentNode;return n&&(n.removeChild(e),n.normalize()),t}const De=1e4;function Te(e,t){!function(e,t){const o=Array.from(e.querySelectorAll("p"));for(const n of o){let e=n.firstChild,o=0;for(;e&&o<De;){let r=!1;if(e instanceof t.Element&&null!==e.textContent&&!e.textContent.trim()){const t=Array.from(e.querySelectorAll("br"));if(t.length>0){for(const o of t)n.insertBefore(o,e);r=!0}}const a=e.nextSibling;r&&n.removeChild(e),e=a,o+=1}}}(e,t);const o=Array.from(e.querySelectorAll("p"));for(let n=0;n<De;n++){const e=o.shift();if(!e||!e.parentNode)return;const n=e.querySelector("br");if(!n)continue;if(n.parentElement!==e)continue;const r=t.document.createElement("p");e.parentNode.insertBefore(r,e.nextSibling);let a=n.nextSibling;for(;a;){const e=a.nextSibling;r.appendChild(a),a=e}e.removeChild(n),o.unshift(r)}}function Le(e){const{window:t,nodes:o}=e;let n=e.node;if(n instanceof t.Element&&n.parentNode&&"google-sheets-html-origin"===n.tagName.toLowerCase()){const e=h().PE(n.childNodes);for(const t of e)n.parentNode.insertBefore(t,n);return o.unshift(...e),void n.remove()}if(n&&n.parentNode&&3===n.nodeType&&/^( |\t)*(\n)+( |\t)*$/.test(n.data))n.parentNode.removeChild(n);else if(n&&n instanceof t.Element&&n.parentNode&&L[n.tagName.toLowerCase()])n.parentNode.removeChild(n);else{if(n instanceof t.HTMLElement){const e=(r=n.style.fontSize||void 0)&&-1!==r.indexOf("px")||r&&-1!==r.indexOf("pt")?parseInt(r):void 0,o=function(e){if(e&&-1!==e.indexOf("em"))return parseInt(e)}(n.style.fontSize||void 0);(e&&e>=24||o&&o>2)&&(n=Ee(n,"h1",t))}var r;if(n instanceof t.HTMLElement&&("line-through"===n.style.textDecoration&&ke(n,"del",t),"italic"===n.style.fontStyle&&ke(n,"em",t),("bold"===n.style.fontWeight||n.style.fontWeight&&parseInt(n.style.fontWeight)>=500)&&ke(n,"strong",t)),n instanceof t.HTMLImageElement){const e=function(e){const t=e.match(/^([0-9]+)px$/i);if(t)return parseInt(t[1])}(n.style.width);!n.width&&e&&(n.width=e)}if(n instanceof t.HTMLElement&&("b"===n.tagName.toLowerCase()?n=Ee(n,"strong",t):"i"===n.tagName.toLowerCase()&&(n=Ee(n,"em",t))),n instanceof t.HTMLElement&&"strong"===n.tagName.toLowerCase()&&"normal"===n.style.fontWeight&&(n=Ee(n,"span",t)),n instanceof t.HTMLElement&&("section"===n.tagName.toLowerCase()||"article"===n.tagName.toLowerCase())&&(n=Ee(n,"div",t)),n instanceof t.HTMLElement&&"div"===n.tagName.toLowerCase()&&"inline"===n.style.display&&(n=Ee(n,"span",t)),n instanceof t.HTMLInputElement&&"input"===n.tagName.toLowerCase()&&"checkbox"===n.type){const e=n.checked,r=n.parentNode,a=t.document.createElement("span");return a.textContent=`[${e?"x":" "}] `,r&&(r.insertBefore(a,n),r.removeChild(n)),void o.push(a)}if(n instanceof t.HTMLElement&&"table"===n.tagName.toLowerCase()&&!n.classList.contains("simple-table")){const e=Array.from(n.querySelectorAll("tr")).map((e=>e.querySelectorAll("td, th")));if(e.every((e=>1===e.length))){const r=t.document.createDocumentFragment();for(const n of e){const e=n[0],a=e.childNodes.length;for(let t=0;t<a;t+=1){const n=e.childNodes[t];n&&(r.appendChild(n.cloneNode(!0)),o.push(n))}r.appendChild(t.document.createElement("hr"))}n.parentNode&&n.parentNode.replaceChild(r,n)}}if(n instanceof t.HTMLElement&&("ul"===n.tagName.toLowerCase()||"ol"===n.tagName.toLowerCase())&&n.parentNode instanceof t.HTMLElement&&("ul"===n.parentNode.tagName.toLowerCase()||"ol"===n.parentNode.tagName.toLowerCase())&&n.previousSibling instanceof t.HTMLElement&&"li"===n.previousSibling.tagName.toLowerCase()&&n.previousSibling.appendChild(n),n instanceof t.Element&&(n.removeAttribute("style"),n.removeAttribute("dir")),n instanceof t.Element&&"span"===n.tagName.toLowerCase()){var a;if("page-comment"===n.getAttribute("class")||null!==(a=n.getAttribute("class"))&&void 0!==a&&a.split(" ").includes("retain-span"))return;(n.hasAttribute(j[A().Ifu.Highlight])||n.hasAttribute(j[A().Ifu.Discussion])||n.hasAttribute(j[A().Ifu.Comment])||n.hasAttribute(j[A().Ifu.Equation])?Array.from(n.children):Ae(n)).forEach((e=>o.push(e)))}else if(n){h().PE(n.childNodes).forEach((e=>o.push(e)))}}}function Be(e){const{window:t,nodes:o}=e,n=e.node;if(Pe(n,t)&&s().Si(n.childNodes,(e=>e instanceof t.Element&&"h1"===e.tagName.toLowerCase()))){const e=t.document.createElement("h1");s().__(n.childNodes,(t=>{s().__(t.childNodes,(t=>{const o=t.cloneNode(!0);o&&e.appendChild(o)}))}));const r=n.parentNode;if(r){if("td"===n.tagName.toLowerCase()||"th"===n.tagName.toLowerCase()){const o=t.document.createElement(n.tagName.toLowerCase());o.appendChild(e),r.insertBefore(o,n)}else r.insertBefore(e,n);r.removeChild(n)}o.push(e)}else if(Pe(n,t)&&s().Si(n.childNodes,(e=>e instanceof t.Element&&"h2"===e.tagName.toLowerCase()))){const e=t.document.createElement("h2");s().__(n.childNodes,(t=>{s().__(t.childNodes,(t=>{const o=t.cloneNode(!0);o&&e.appendChild(o)}))}));const r=n.parentNode;if(r){if("td"===n.tagName.toLowerCase()||"th"===n.tagName.toLowerCase()){const o=t.document.createElement(n.tagName.toLowerCase());o.appendChild(e),r.insertBefore(o,n)}else r.insertBefore(e,n);r.removeChild(n)}o.push(e)}else if(n instanceof t.HTMLElement&&("div"===n.tagName.toLowerCase()||"span"===n.tagName.toLowerCase())&&n.parentNode&&0===n.childNodes.length)n.parentNode.removeChild(n);else if(!Pe(n,t)||"p"!==n.tagName.toLowerCase()&&"div"!==n.tagName.toLowerCase()&&"figure"!==n.tagName.toLowerCase()||!h().PE(n.childNodes).some((e=>e instanceof t.Element&&("p"===e.tagName.toLowerCase()||"div"===e.tagName.toLowerCase()||"img"===e.tagName.toLowerCase()||"ul"===e.tagName.toLowerCase()||"ol"===e.tagName.toLowerCase()||"table"===e.tagName.toLowerCase()||"hr"===e.tagName.toLowerCase()||"video"===e.tagName.toLowerCase()||"iframe"===e.tagName.toLowerCase())))){if(n&&n.childNodes){h().PE(n.childNodes).forEach((e=>o.push(e)))}}else{Ae(n).forEach((e=>o.push(e)))}}function Oe(e){const{rootNode:t,window:o,isInlineContent:n,emojiData:r}=e;!function(e){const{rootNode:t,window:o,emojiData:{emojiByName:n}}=e,r=Array.from(t.querySelectorAll("img[data-stringify-emoji]"));for(const a of r){const e=a.getAttribute("data-stringify-emoji")||"",t=e.match(/^:(.+):$/);if(!t||!a.parentNode)continue;const r=n[t[1]]||e;a.parentNode.replaceChild(o.document.createTextNode(r),a)}}({rootNode:t,window:o,emojiData:r}),t.normalize(),Te(t,o);const a=h().PE(t.childNodes);for(;a.length>0;){const e=a.shift();e&&Le({window:o,nodes:a,node:e})}for(h().PE(t.childNodes).forEach((e=>a.push(e)));a.length>0;){const e=a.shift();e&&Be({node:e,window:o,nodes:a})}t.normalize(),n||h().PE(t.childNodes).forEach((e=>{if(3===e.nodeType){const n=o.document.createElement("p");t.insertBefore(n,e),n.appendChild(e)}}))}function Pe(e,t){return e instanceof t.Element&&(0!==e.childNodes.length&&!(e.hasAttribute(j[c().xd.columnList])||e.hasAttribute(j[c().xd.column])||e.hasAttribute(j[c().xd.callout])))}function Me(e){const{actor:t,parent:o,rootNode:n,deps:r,htmlParserErrors:a,options:i}=e;Oe({rootNode:n,window:r.window,isInlineContent:!1,emojiData:r.emojiData});const s=[];return{allOperations:s,rootContentIds:_e({actor:t,parent:o,nodes:h().PE(n.children),allOperations:s,deps:r,htmlParserErrors:a,options:i})}}function He(e){const{node:t,window:o,stripText:n,stripSurroundingWhitespace:r,emojiData:a}=e;Oe({rootNode:t,window:o,isInlineContent:!0,emojiData:a});const{titleTokens:i}=Y({node:t,window:o,stripText:n,stripSurroundingWhitespace:r,ignoreComments:!0});return i}function Fe(e){const{node:t,window:o,emojiData:n}=e;return Oe({rootNode:t,window:o,isInlineContent:!1,emojiData:n}),je(t,o)}const qe=new Set(["span","div","p"]);function je(e,t){const o=e.tagName.toLowerCase();if(!qe.has(o))return!0;if("div"===o&&(e.className===B||e.hasAttribute(j[c().xd.columnList])))return!0;for(const n of Array.from(e.childNodes))if(W(t,n)&&je(n,t))return!0;return!1}function Ue(e){if("default"===e||"gray"===e||"brown"===e||"orange"===e||"yellow"===e||"teal"===e||"blue"===e||"purple"===e||"pink"===e||"red"===e||"gray_background"===e||"brown_background"===e||"orange_background"===e||"yellow_background"===e||"teal_background"===e||"blue_background"===e||"purple_background"===e||"pink_background"===e||"red_background"===e)return e}}}]);