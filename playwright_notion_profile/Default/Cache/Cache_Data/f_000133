"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[94562],{3259:(e,t,n)=>{n.d(t,{cZ:()=>x,qQ:()=>v,yN:()=>f});n(898992),n(823215),n(672577),n(581454),n(737550);var r=()=>n(763824),a=()=>n(534177),o=()=>n(696706),s=()=>n(179034),i=()=>n(437607),u=()=>n(798880),p=()=>n(247331),l=()=>n(662358),d=()=>n(696446),c=()=>n(349835),y=()=>n(239381),m=()=>n(628048);function*f(e,t){if(t.depth>p().FORMULA_MAX_DEPTH)throw new(c().I3)({type:c().uW.DepthExceeded});if(t.formulaTimeoutTimestampMs&&Date.now()>t.formulaTimeoutTimestampMs)throw t.logFormulaTimeoutFn&&t.logFormulaTimeoutFn(),new(c().I3)({type:c().uW.MaxEvaluationTimeExceeded});switch(e.kind){case c().NM.Number:return{type:"number",value:parseFloat(e.text)};case c().NM.String:return{type:"text",value:[[e.text]]};case c().NM.Boolean:return{type:"checkbox",value:"true"===e.text.toLowerCase()};case c().NM.NotionToken:{const n=e.token;switch(n.type){case p().FormulaTokenType.Checkbox:return{type:"checkbox",value:n.checked};case p().FormulaTokenType.BlockProperty:return yield*(0,l().ir)({node:e,token:n,context:t,evaluateAST:f});case p().FormulaTokenType.Block:return{type:"block",value:{table:s().ev,id:n.blockId,spaceId:n.spaceId}};case p().FormulaTokenType.ContextValue:return(0,l().ym)({node:e,token:n,context:t});case p().FormulaTokenType.Date:return{type:"date",value:n.date};case p().FormulaTokenType.Person:{const e=n.personInfo;return"user"===e.personTokenType?{type:"person",value:{table:u().oo,id:e.userId}}:"group"===e.personTokenType?{type:"person",value:{table:i().n,id:e.groupId,spaceId:e.spaceId}}:(0,a().HB)(e)}default:return(0,a().HB)(n)}}case c().NM.Identifier:{var n;const r=null===(n=t.values.find((t=>t.kind===p().FormulaContextValueKind.Binding&&t.id===e.text)))||void 0===n?void 0:n.value;if(void 0!==r)return r;if(m().LP.hasOwnProperty(e.text))return{type:"function",function:m().LP[e.text]};throw new(c().I3)({type:c().uW.IdentifierNotFound,node:e})}case c().NM.Array:return{type:"array",values:yield*(0,d().KZ)(e.elements.map((e=>f(e,t))))};case c().NM.Conditional:{const n=yield*f(e.condition,t);return(0,y().CL)(n)?yield*f(e.expIfTrue,t):yield*f(e.expIfFalse,t)}case c().NM.LogicalOr:return{type:"checkbox",value:(yield*(0,d().KZ)(e.elements.map((e=>f(e,t))))).map(y().CL).some((e=>e))};case c().NM.LogicalAnd:return{type:"checkbox",value:(yield*(0,d().KZ)(e.elements.map((e=>f(e,t))))).map(y().CL).every((e=>e))};case c().NM.Equality:{const[n,r]=yield*(0,d().KZ)([f(e.lhs,t),f(e.rhs,t)]),o=yield*(0,y().zV)(n,r,t),s=e.op;switch(s){case"==":return{type:"checkbox",value:o};case"!=":return{type:"checkbox",value:!o};default:return(0,a().HB)(s)}}case c().NM.Relational:{const[n,r]=yield*(0,d().KZ)([f(e.lhs,t),f(e.rhs,t)]);return yield*(0,l().MA)(e,n,r,t)}case c().NM.Additive:{const[n,r]=yield*(0,d().KZ)([f(e.lhs,t),f(e.rhs,t)]);return(0,l().LL)(e,n,r)}case c().NM.Multiplicative:{const[n,r]=yield*(0,d().KZ)([f(e.lhs,t),f(e.rhs,t)]);return(0,l().Rn)(e,n,r)}case c().NM.Exponentiation:{const[n,r]=yield*(0,d().KZ)([f(e.lhs,t),f(e.rhs,t)]);return(0,l().oj)(e,n,r)}case c().NM.Unary:{const n=yield*f(e.expression,t);return(0,l().If)(e,n)}case c().NM.Call:{const n=yield*f(e.expression,t);if("function"!==n.type)throw new(c().I3)({type:c().uW.CannotCallNonFunction,node:e,calleeType:n.type});const a=n.function,o=(0,y().ab)(a),s=void 0!==n.boundTarget?[n.boundTarget,...e.arguments]:e.arguments;if(s.length<o)throw new(c().I3)({type:c().uW.FunctionCallTooFewArguments,node:e,libraryFunction:a,numArguments:s.length});const i=yield*(0,d().KZ)(s.map(((n,r)=>function*(e,t,n,r,a){const o=(0,y().Pf)(r,n);if(void 0===o)throw new(c().I3)({type:c().uW.FunctionCallUnexpectedArgument,node:e,argument:t,libraryFunction:r,parameterIndex:n});if(!Array.isArray(o.type)&&"expression"===o.type.type)return t;const s=yield*f(t,a);return(0,l().qL)({value:s,callNode:e,argumentNode:t,parameterIndex:n,libraryFunction:r,expectedParameter:o})}(e,n,r,a,t))));try{return yield*a.eval(i,t)}catch(r){if(r instanceof c().I3)throw r;throw new(c().I3)({type:c().uW.LibraryFunctionExecutionError,node:e,libraryFunction:a,error:r})}}case c().NM.UnifiedFunctionProperty:if(m().LP.hasOwnProperty(e.name))return{type:"function",function:m().LP[e.name],boundTarget:e.expression};throw new(c().I3)({type:c().uW.UnifiedFunctionPropertyNotFound,node:e});case c().NM.MemberBlockProperty:{const n=yield*f(e.expression,t);if("undefined"===n.type)return{type:"undefined"};if("block"!==n.type)throw new(c().I3)({type:c().uW.AccessingPropertyOnNonBlock,node:e,expressionValue:n});const r=(yield{recordPointers:[n.value]}).getRecordModel(n.value);if(void 0===r)throw new(c().I3)({type:c().uW.MissingDataDependencyBlock,node:e,blockPointer:n.value});if(void 0===e.propertyToken.collection)return(0,y().ve)(r,e.propertyToken.property);const{collectionPointer:a,schema:s}=yield*(0,l().OH)(r,t);if(!a)throw new(c().I3)({type:c().uW.MissingDataDependencyBlock,node:e,blockPointer:r.pointer});if(!(0,o().Z2)(e.propertyToken.collection,a))throw new(c().I3)({type:c().uW.MemberPropertyMismatchCollection,node:e,blockCollection:a});const i=(0,y().Yi)(e.propertyToken.property),u=null==s?void 0:s[i];if(void 0===u||void 0===s)throw new(c().I3)({type:c().uW.MissingPropertyOnSchemaForMemberProperty,node:e});return yield*(0,l().PR)({block:r,property:i,parentCollectionPointer:a,schema:s,propertySchema:u,oldContext:t,evaluateAST:f})}case c().NM.RecoveryNode:throw new(c().I3)({type:c().uW.UnexpectedRecoveryNode,recovery:e});default:(0,a().HB)(e)}}function h(e,t){return"array"!==e.type?"undefined"===e.type||e.type===t.type:"array"===t.type&&e.values.every((e=>"array"===e.type?h(e,t):h(e,t.of)))}function v(e,t){return"undefined"===e.type||t.some((t=>h(e,t)))}async function x(e,t,n){return(0,l().dt)(n,(async()=>{t.formulaTimeoutTimestampMs=t.formulaTimeoutTimestampMs??Date.now()+l().qU;const n=performance.now();let a=0;const o=f(e,t);let s=o.next();for(;!s.done;){const e=t.handleDataRequest(s.value);let n;if((0,r().yL)(e)){const t=performance.now();n=await e,a+=performance.now()-t}else n=e;s=o.next(n)}if(t.allowedValueTypes&&!v(s.value,t.allowedValueTypes))throw new(c().I3)({allowedValueTypes:t.allowedValueTypes,expressionValue:s.value,type:c().uW.DisallowedValueType});const i=performance.now()-n-a;return{value:(0,l().rb)(s.value),formulaEvaluationStats:{syncEvaluationTimeMs:i}}}))}},44907:(e,t,n)=>{n.d(t,{Ps:()=>m,Q7:()=>c,TM:()=>p,_M:()=>d,p8:()=>u});n(16280),n(269479);var r=()=>n(303151),a=()=>n(496603),o=()=>n(247331),s=()=>n(349835),i=()=>n(239381);const u=a().Bj((()=>function(){const e=(0,r().Ey)({name:"AdditionOperator",pattern:r().JG.NA}),t=(0,r().Ey)({name:"UnaryOperator",pattern:r().JG.NA}),a=(0,r().Ey)({name:"Plus",pattern:/\+/,categories:e}),s=(0,r().Ey)({name:"Minus",pattern:/-/,categories:[e,t]}),u=(0,r().Ey)({name:"ExclamationPoint",pattern:/!/,categories:t}),p=(0,r().Ey)({name:"MultiplicationOperator",pattern:r().JG.NA}),l=(0,r().Ey)({name:"Multi",pattern:/\*/,categories:p}),d=(0,r().Ey)({name:"Div",pattern:/\//,categories:p}),c=(0,r().Ey)({name:"Modulo",pattern:/%/,categories:p}),y=(0,r().Ey)({name:"Caret",pattern:/\^/}),m=(0,r().Ey)({name:"BooleanLiteral",pattern:r().JG.NA}),f=(0,r().Ey)({name:"True",pattern:/true/i,categories:m}),h=(0,r().Ey)({name:"False",pattern:/false/i,categories:m}),v=(0,r().Ey)({name:"And",pattern:/and(?=\s)|&&/i}),x=(0,r().Ey)({name:"Or",pattern:/or(?=\s)|\|\|/i}),g=(0,r().Ey)({name:"Not",pattern:/not(?=\s)/i,categories:t}),b=(0,r().Ey)({name:"RelationalOperator",pattern:r().JG.NA}),k=(0,r().Ey)({name:"LessThan",pattern:/<=?/,categories:b}),T=(0,r().Ey)({name:"GreaterThan",pattern:/>=?/,categories:b}),M=(0,r().Ey)({name:"EqualityOperator",pattern:r().JG.NA}),w=(0,r().Ey)({name:"Equal",pattern:/==/,categories:M}),N=(0,r().Ey)({name:"NotEqual",pattern:/!=/,categories:M}),I=(0,r().Ey)({name:"LParen",pattern:/\(/}),E=(0,r().Ey)({name:"RParen",pattern:/\)/}),C=(0,r().Ey)({name:"LBracket",pattern:/\[/}),R=(0,r().Ey)({name:"RBracket",pattern:/\]/}),A=(0,r().Ey)({name:"Comma",pattern:/,/}),P=(0,r().Ey)({name:"Dot",pattern:/\./}),F=(0,r().Ey)({name:"QuestionMark",pattern:/\?/}),O=(0,r().Ey)({name:"Colon",pattern:/:/}),S=(0,r().Ey)({name:"StringLiteral",pattern:/"(?:[^\\"]|\\.)*"/,start_chars_hint:['"']}),L=(0,r().Ey)({name:"UnclosedStringLiteral",pattern:/"(?:[^\\"]|\\.)*/,start_chars_hint:['"']}),B=(0,r().Ey)({name:"NumberLiteral",pattern:/(0|[1-9]\d*)(\.\d+)?([eE][+-]?\d+)?/}),U=(0,r().Ey)({name:"Comment",pattern:/\/\*(?:[^*]|\*(?:[^\/]))*\*\//,group:r().JG.SKIPPED,start_chars_hint:["/*"]}),D=(0,r().Ey)({name:"UnclosedComment",pattern:/\/\*(?:[^*]|\*(?:[^\/]))*/,group:r().JG.SKIPPED,start_chars_hint:["/*"]}),_=(0,r().Ey)({name:"InputToken",pattern:{exec:(e,t)=>{if(!e.startsWith(o().FORMULA_TOKEN_PREFIX,t))return null;const r=e.substring(t),a=o().tokenBlockPropertyOptionalCollectionPattern.exec(r);if(null!==a){const e=[a[0]],t=(0,i().QE)(a[1]);let r;if(void 0!==a[2])r={type:o().FormulaTokenType.BlockProperty,property:t,collection:{table:n(519831).Vl,id:a[3],spaceId:a[4]}};else{if(!o().FormulaTokenSupportedBlockSystemPropertyList.includes(t))return null;r={type:o().FormulaTokenType.BlockProperty,property:t,collection:void 0}}return e.payload=r,e}const s=o().tokenBlockPropertyContextValueIdPattern.exec(r);if(null!==s){const e=[s[0]],t=(0,i().QE)(s[1]),n=(0,i().A$)(s[2]),r=(0,i().e2)(e[3]),a={contextValueId:n,property:t,type:o().FormulaTokenType.BlockProperty,valueSnapshot:r};return e.payload=a,e}const u=o().tokenBlockPattern.exec(r);if(null!==u){const e=[u[0]],t={type:o().FormulaTokenType.Block,blockId:u[1],spaceId:void 0!==u[2]?u[2].substring(1):void 0};return e.payload=t,e}const p=o().tokenPersonPatternForUser.exec(r);if(null!==p){const e=[p[0]],t={type:o().FormulaTokenType.Person,personInfo:{personTokenType:"user",userId:p[1]}};return e.payload=t,e}const l=o().tokenPersonPatternForGroup.exec(r);if(null!==l){const e=[l[0]],t={type:o().FormulaTokenType.Person,personInfo:{personTokenType:"group",groupId:l[1],spaceId:l[2]}};return e.payload=t,e}const d=o().tokenCheckboxPattern.exec(r);if(null!==d){const e=[d[0]],t={type:o().FormulaTokenType.Checkbox,checked:"true"===d[1]};return e.payload=t,e}const c=o().tokenContextValuePattern.exec(r);if(null!==c){const e=[c[0]],t=(0,i().A$)(c[1]),n={type:o().FormulaTokenType.ContextValue,valueId:t};return e.payload=n,e}const y=o().tokenDatePattern.exec(r);if(null!==y){const e=[y[0]],t={type:o().FormulaTokenType.Date,date:(0,i().P_)(y[1])};return e.payload=t,e}return null}},line_breaks:!1,start_chars_hint:[o().FORMULA_TOKEN_PREFIX]}),G=(0,r().Ey)({name:"IdentifierName",pattern:(q=/[\p{Letter}_][\p{Number}\p{Letter}_]*/u,(e,t)=>{const n=new RegExp(q.source,`${q.flags}y`);return n.lastIndex=t,n.exec(e)}),line_breaks:!1});var q;return{WhiteSpace:(0,r().Ey)({name:"WhiteSpace",pattern:/\s+/,group:r().JG.SKIPPED}),NumberLiteral:B,StringLiteral:S,UnclosedStringLiteral:L,Comment:U,UnclosedComment:D,InputToken:_,True:f,False:h,And:v,Or:x,Not:g,IdentifierName:G,Equal:w,NotEqual:N,Plus:a,Minus:s,ExclamationPoint:u,Multi:l,Div:d,Modulo:c,Caret:y,LParen:I,RParen:E,LBracket:C,RBracket:R,AdditionOperator:e,MultiplicationOperator:p,LessThan:k,GreaterThan:T,QuestionMark:F,Colon:O,Comma:A,Dot:P,UnaryOperator:t,EqualityOperator:M,RelationalOperator:b,BooleanLiteral:m}}()));const p=a().Bj((e=>new(r().JG)(function(e){return Object.values(e)}(e))));class l extends r().cA{constructor(e){super(Object.values(e),{recoveryEnabled:!0,nodeLocationTracking:"onlyOffset"}),this.formulaTokens=void 0,this.c1=void 0,this.expression=this.RULE("expression",(()=>{this.SUBRULE(this.conditionalExpression)})),this.primaryExpression=this.RULE("primaryExpression",(()=>{this.OR(this.c1||(this.c1=[{ALT:()=>this.SUBRULE(this.parenthesisExpression)},{ALT:()=>this.SUBRULE(this.arrayExpression)},{ALT:()=>this.CONSUME(this.formulaTokens.NumberLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.StringLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.UnclosedStringLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.BooleanLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.IdentifierName)},{ALT:()=>this.CONSUME(this.formulaTokens.InputToken)}]))})),this.conditionalExpression=this.RULE("conditionalExpression",(()=>{this.SUBRULE(this.logicalOrExpression,{LABEL:"condition"}),this.OPTION((()=>{this.CONSUME(this.formulaTokens.QuestionMark),this.SUBRULE2(this.logicalOrExpression,{LABEL:"expIfTrue"}),this.CONSUME(this.formulaTokens.Colon),this.SUBRULE3(this.logicalOrExpression,{LABEL:"expIfFalse"})}))})),this.logicalOrExpression=this.RULE("logicalOrExpression",(()=>{this.SUBRULE(this.logicalAndExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.Or),this.SUBRULE2(this.logicalAndExpression,{LABEL:"rhs"})}))})),this.logicalAndExpression=this.RULE("logicalAndExpression",(()=>{this.SUBRULE(this.equalityExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.And),this.SUBRULE2(this.equalityExpression,{LABEL:"rhs"})}))})),this.equalityExpression=this.RULE("equalityExpression",(()=>{this.SUBRULE(this.relationalExpression,{LABEL:"lhs"}),this.OPTION((()=>{this.CONSUME(this.formulaTokens.EqualityOperator),this.SUBRULE2(this.relationalExpression,{LABEL:"rhs"})}))})),this.relationalExpression=this.RULE("relationalExpression",(()=>{this.SUBRULE(this.additionExpression,{LABEL:"lhs"}),this.OPTION((()=>{this.CONSUME(this.formulaTokens.RelationalOperator),this.SUBRULE2(this.additionExpression,{LABEL:"rhs"})}))})),this.additionExpression=this.RULE("additionExpression",(()=>{this.SUBRULE(this.multiplicationExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.AdditionOperator),this.SUBRULE2(this.multiplicationExpression,{LABEL:"rhs"})}))})),this.multiplicationExpression=this.RULE("multiplicationExpression",(()=>{this.SUBRULE(this.exponentiationExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.MultiplicationOperator),this.SUBRULE2(this.exponentiationExpression,{LABEL:"rhs"})}))})),this.exponentiationExpression=this.RULE("exponentiationExpression",(()=>{this.SUBRULE(this.unaryExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.Caret),this.SUBRULE2(this.unaryExpression,{LABEL:"rhs"})}))})),this.unaryExpression=this.RULE("unaryExpression",(()=>{this.OPTION((()=>{this.CONSUME(this.formulaTokens.UnaryOperator)})),this.SUBRULE(this.primaryExpression),this.MANY((()=>{this.SUBRULE2(this.memberCallSubExpression)}))})),this.memberCallSubExpression=this.RULE("memberCallSubExpression",(()=>{this.OR([{ALT:()=>this.SUBRULE(this.dotMemberExpression)},{ALT:()=>this.SUBRULE(this.callArguments)}])})),this.dotMemberExpression=this.RULE("dotMemberExpression",(()=>{this.CONSUME(this.formulaTokens.Dot),this.OR([{ALT:()=>this.CONSUME(this.formulaTokens.IdentifierName)},{GATE:()=>{var e;const t=this.LA(1);return t.tokenType===this.formulaTokens.InputToken&&(null===(e=t.payload)||void 0===e?void 0:e.type)===o().FormulaTokenType.BlockProperty},ALT:()=>this.CONSUME(this.formulaTokens.InputToken)}])})),this.callArguments=this.RULE("callArguments",(()=>{this.CONSUME(this.formulaTokens.LParen),this.OPTION((()=>{this.SUBRULE(this.expression),this.MANY((()=>{this.CONSUME(this.formulaTokens.Comma),this.SUBRULE2(this.expression)}))})),this.CONSUME(this.formulaTokens.RParen)})),this.parenthesisExpression=this.RULE("parenthesisExpression",(()=>{this.CONSUME(this.formulaTokens.LParen),this.SUBRULE(this.expression),this.CONSUME(this.formulaTokens.RParen)})),this.arrayExpression=this.RULE("arrayExpression",(()=>{this.CONSUME(this.formulaTokens.LBracket),this.OPTION((()=>{this.SUBRULE(this.expression),this.MANY((()=>{this.CONSUME(this.formulaTokens.Comma),this.SUBRULE2(this.expression)}))})),this.CONSUME(this.formulaTokens.RBracket)})),this.formulaTokens=e,this.performSelfAnalysis()}}const d=a().Bj((e=>new l(e)));function c(e){const t=/unexpected character: ->(.+)<- at offset/.exec(e.message);if(null!==t)return{type:s().M9.InvalidCharacter,character:t[1],offset:e.offset};if("unclosed string literal"===e.message)return{type:s().M9.UnclosedStringLiteral,offset:e.offset};if("unclosed comment"===e.message)return{type:s().M9.UnclosedComment,offset:e.offset};throw new Error(`Unhandled chevrotain recognition error: ${e.message}`)}const y={RParen:")",RBracket:"]",Colon:":"};function m(e){const t=e.token.tokenType===r().LT?"eof":e.token.startOffset;switch(e.name){case"MismatchedTokenException":{const n=/Expecting token of type --> (.+) <-- but found/.exec(e.message);if(null!==n){const e=n[1],r=y[e];if(void 0!==r)return{type:s().M9.TokenExpected,token:r,offset:t}}break}case"NoViableAltException":{const n=e.context.ruleStack[e.context.ruleStack.length-1];switch(n){case"primaryExpression":return{type:s().M9.ExpressionExpected,offset:t};case"dotMemberExpression":return{type:s().M9.PropertyTokenOrFunctionExpected,offset:t}}throw new Error(`Unhandled unviable alt: ${n}`)}case"NotAllInputParsedException":return{type:s().M9.EndOfInputExpected,offset:t}}return{type:s().M9.UnexpectedError,error:new Error(`Unhandled chevrotain recognition error: ${e.name}`),offset:t}}},80979:(e,t,n)=>{n.r(t),n.d(t,{FormulaParsingInstrumentation:()=>p().nM,addTypesToFormulaAST:()=>s().y,addTypesToFormulaASTAsync:()=>s()._,analyzeFormula:()=>T,analyzeFormulaSync:()=>M,cleanFormulaTypecheckerErrors:()=>g,convertCollectionFormulaToFormula2:()=>y().Jb,convertFormulaCSTToAST:()=>l().f,createFormulaDataRequestSyncHandler:()=>i().zg,evaluateCollectionFormula2:()=>m().MC,evaluateCollectionFormula2WithoutCache:()=>m().kL,evaluateFormulaASTAsync:()=>d().cZ,evaluateFormulaProperty:()=>f().L7,evaluateRawCollectionFormula2:()=>m().UJ,executeFormulaAsync:()=>k,executeFormulaSync:()=>b,findFormulaTypecheckContextValue:()=>i().IV,formulaResultAndOldFormulaValueEqual:()=>i().bW,formulaValueToCollectionFormulaValue:()=>m().Y7,fromSerializedContextValueId:()=>i().y5,getFormula2Dependencies:()=>N,getFormula2ResultCache:()=>m().wr,getFormula2Thunk:()=>m().J6,getFormulaDependencies:()=>w,hasUniformType:()=>m().dA,isUniqueFormulaEvaluatorError:()=>i().R2,mapExecuteFormulaResult:()=>m().jA,parseFormulaInputToAst:()=>p().$t,parseFormulaInputToCst:()=>p().tP,primitiveFormulaValueFromPropertySchema:()=>m().LO,processFormulaInput:()=>c().kb,propertyToFormulaValue:()=>f().ws,propertyToFormulaValueAsString:()=>f().by,setFormula2ResultCache:()=>m().wZ,setFormula2Thunk:()=>m().rV,setFormulaParsingInstrumentation:()=>p().BC,textValueToFormulaTokens:()=>i().K5,timestampToFormulaValue:()=>f().NI});var r=()=>n(498212),a=()=>n(973647),o=()=>n(488660),s=()=>n(93152),i=()=>n(239381),u=()=>n(501053),p=()=>n(373907),l=()=>n(958970),d=()=>n(3259),c=()=>n(106714),y=()=>n(420062),m=()=>n(342581),f=()=>n(383969),h=(n(581454),()=>n(534177)),v=()=>n(349835);const x=Symbol("CleanedFormulaTypecheckerErrorInfo");function g(e){return e.map((e=>{return(0,h().GV)((t=e).type===v().IA.ThisRowTypeNotFound||t.type===v().IA.ThisRowNotBlockWithCollection?{type:t.type}:t.type===v().IA.ContextVariableNotBlockWithCollection?{type:t.type,token:t.token}:t.type===v().IA.MissingPropertyOnThisRow?{type:t.type,property:t.property}:t.type===v().IA.MissingPropertyOnContextVariable?{type:t.type,property:t.property,token:t.token}:t.type===v().IA.MissingContextVariable||t.type===v().IA.MissingBlock?{type:t.type,token:t.token}:t.type===v().IA.CallingNotFunction?{type:t.type,calleeKind:t.callee.kind}:t.type===v().IA.FunctionCallTooFewArguments?{type:t.type,libraryFunctionName:t.libraryFunction.name,numArguments:t.numArguments,minNumParameters:t.minNumParameters}:t.type===v().IA.FunctionCallUnexpectedArgument?{type:t.type,libraryFunctionName:t.libraryFunction.name,parameterIndex:t.parameterIndex}:t.type===v().IA.FunctionCallArgumentWrongType?{type:t.type,libraryFunctionName:t.libraryFunction.name,parameterName:t.expectedParameter.name}:t.type===v().IA.MemberPropertyMismatchCollection?{type:t.type,token:t.token.collection?t.token:{property:t.token.property}}:t.type===v().IA.MemberPropertyMissing?{type:t.type,textValproperty:t.property}:t.type===v().IA.MemberPropertyTargetNotBlock?{type:t.type,expressionKind:t.expression.kind}:t.type===v().IA.MemberPropertyTypeInvalid||t.type===v().IA.BlockPropertyTypeInvalid?{type:t.type,propertyName:t.propertyName,propertyType:t.propertyType}:t.type===v().IA.UndefinedIdentifier?{type:t.type,identifier:t.node}:t.type===v().IA.UnifiedFunctionCannotFindFunction?{type:t.type,name:t.name}:t.type===v().IA.UnifiedFunctionNoArguments?{type:t.type,libraryFunctionName:t.libraryFunction.name}:t.type===v().IA.UnifiedFunctionTargetWrongType?{type:t.type,libraryFunctionName:t.libraryFunction.name,expressionKind:t.expression.kind}:t.type===v().IA.CannotRelativelyCompareTypes?{type:t.type,lhsType:t.lhsType.type,rhsType:t.rhsType.type}:t.type===v().IA.CannotDoMathOnType?{type:t.type,nodeKind:t.node.kind,lhsType:t.lhsType.type,rhsType:t.rhsType.type}:t.type===v().IA.UnaryMinusOnNonNumber?{type:t.type,nodeKind:t.node.kind}:t.type===v().IA.IdentifierExpected?{type:t.type,startOffset:t.node.startOffset}:t.type===v().IA.FunctionCallExpected?{type:t.type,startOffset:t.node.startOffset,functionName:t.functionName}:t.type===v().IA.RenamedIdentifier?{type:t.type,identifier:t.identifier,renamedTo:t.renamedTo}:t.type===v().IA.RemovedFunction?{type:t.type,functionName:t.functionName,alternative:t.alternative}:t.type===v().IA.DisallowedReturnType?{type:t.type,startOffset:t.node.startOffset,returnType:t.returnType.type,allowedReturnTypes:t.allowedReturnTypes.map((e=>e.type))}:t.type===v().IA.CrossSpacePropertyNotSupported?{type:t.type,property:t.property}:t.type===v().IA.CalledFunctionOnEmptyValue?{type:t.type,startOffset:t.node.startOffset,functionName:(null===(n=t.libraryFunction)||void 0===n?void 0:n.name)??null}:t.type===v().IA.InvalidPropCall||t.type===v().IA.InvalidContextCall||t.type===v().IA.InvalidVariableCall?{type:t.type,name:t.name}:void(0,h().HB)(t),x);var t,n}))}function b(e,t){var n;const s=(0,p().$t)(e);if(a().Q.isFail(s))return s;const i=(0,r().Ay)(),u={...t,formulaEvaluationId:i},l=(0,o().Ox)(t),d=(0,o().PX)(l,s.value);if(a().Q.isFail(d))return d;const c=(0,o().YQ)(d.value,u);return null===(n=u.logFormulaStatsFn)||void 0===n||n.call(u,{formulaEvaluationId:i,commitPerRowStats:!0}),c}async function k(e,t){var n;const s=(0,p().$t)(e);if(a().Q.isFail(s))return s;const i=(0,r().Ay)(),u={...t,formulaEvaluationId:i},l=(0,o().Ox)(t),d=(0,o().PX)(l,s.value);if(a().Q.isFail(d))return d;const c=await(0,o().Xs)(d.value,u);return null===(n=u.logFormulaStatsFn)||void 0===n||n.call(u,{formulaEvaluationId:i,commitPerRowStats:!0}),c}async function T(e,t){const n=(0,p().$t)(e);if(a().Q.isFail(n))return{value:{parseErrors:[n.error]}};const r=await(0,s()._)(n.value,t),{node:o,errors:i}=r;return{value:{type:o.type,typeErrors:i}}}function M(e,t){const n=(0,p().$t)(e);if(a().Q.isFail(n))return{parseErrors:[n.error]};const r=(0,s().y)(n.value,t),{node:o,errors:i}=r;return{type:o.type,typeErrors:i}}function w(e){return"formula"!==e.type?[]:"v2"===e.version?e.formula2?N(e.formula2.code):[]:(0,u().kh)(e.formula)}function N(e){const t=(0,p().$t)(e);return a().Q.isFail(t)?[]:(0,i().Mu)(t.value)}},93152:(e,t,n)=>{n.d(t,{y:()=>Y,_:()=>H});n(944114),n(898992),n(354520),n(672577),n(430670),n(581454),n(737550);var r=()=>n(763824),a=()=>n(534177),o=()=>n(898244),s=()=>n(696706),i=()=>n(179034),u=()=>n(519831),p=()=>n(797809),l=(n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),()=>n(247331)),d=()=>n(349835),c=()=>n(239381);n(16280);function y(e,t){if(e.kind===d().NM.NotionToken&&e.token.type===l().FormulaTokenType.ContextValue)return`${e.token.valueId}:${t}`}function m(e,t){if(!e&&!t)return;if(!e)return t;if(!t)return e;const n=new Map;for(const[r,a]of e){const e=t.get(r);void 0!==e&&(a===e?n.set(r,a):"unknown"!==a&&"unknown"!==e||n.set(r,"unknown"))}return n.size>0?n:void 0}function f(e,t){if(!e&&!t)return;if(!e)return t;if(!t)return e;const n=new Map;for(const[r,a]of e)n.set(r,a);for(const[r,a]of t){const e=n.get(r);void 0!==e?e===a?n.set(r,e):n.set(r,"unknown"):n.set(r,a)}return n.size>0?n:void 0}function h(e){if(!e)return;const t=new Map;for(const[n,r]of e)"boolean"==typeof r?t.set(n,!r):t.set(n,r);return t.size>0?t:void 0}function v(e){if(e.kind===d().NM.NotionToken){const t=e.token;let n;if(t.type===l().FormulaTokenType.ContextValue?n=t.valueId:t.type===l().FormulaTokenType.BlockProperty&&(n=t.property),n){const e=new Map;return e.set(n,!0),e}}else if(e.kind===d().NM.MemberBlockProperty){const t=e.propertyToken.property,n=y(e.expression,t);if(n){const e=new Map;return e.set(n,!0),e}}}function x(e){if(e.kind!==d().NM.Identifier)throw new Error("Expected identifier node");return`let_var_${e.text}`}function g(e,t){var n;if(e.kind!==d().NM.Identifier)return;const r=x(e);return null===(n=t.variableConditionalGuarantees)||void 0===n?void 0:n.get(r)}function b(e,t,n){if(t.existenceGuarantees){const e=new Map(t.existenceGuarantees);if(!n)for(const[t,n]of e)"boolean"==typeof n&&e.set(t,!n);return e}return e}function k(e,t){const n=new Map(e),r=new Map(e);for(const[o,s]of t)n.set(o,s);const a=h(t);if(a)for(const[o,s]of a)r.set(o,s);return{trueGuarantees:n,falseGuarantees:r}}function T(e,t){const n=function(e,t){var n;if(e.kind!==d().NM.Identifier)return;const r=x(e);return null===(n=t.variableConditionalGuarantees)||void 0===n?void 0:n.get(r)}(t.node,e);if(n){const{trueGuarantees:t,falseGuarantees:r}=k(e.existenceGuarantees,n);return{trueGuarantees:t,falseGuarantees:r,directPropertyGuarantees:void 0}}if(t.existenceGuarantees){if(t.node.kind!==d().NM.Identifier){const{trueGuarantees:n,falseGuarantees:r}=k(e.existenceGuarantees,t.existenceGuarantees);return{trueGuarantees:n,falseGuarantees:r,directPropertyGuarantees:void 0}}{const n=x(t.node);if(!(1===t.existenceGuarantees.size&&t.existenceGuarantees.has(n))){const{trueGuarantees:n,falseGuarantees:r}=k(e.existenceGuarantees,t.existenceGuarantees);return{trueGuarantees:n,falseGuarantees:r,directPropertyGuarantees:void 0}}}}if(t.node.kind===d().NM.Identifier){const n=x(t.node),r=new Map;r.set(n,!0);const{trueGuarantees:a,falseGuarantees:o}=k(e.existenceGuarantees,r);return{trueGuarantees:a,falseGuarantees:o,directPropertyGuarantees:void 0}}const r=v(t.node);let a,o;return r?(a=r,o=h(r)):(a=b(e.existenceGuarantees,t,!0),o=b(e.existenceGuarantees,t,!1)),{trueGuarantees:a,falseGuarantees:o,directPropertyGuarantees:r}}function M(e,t,n,r,a){const o=a(e,r),{trueGuarantees:s,falseGuarantees:i,directPropertyGuarantees:u}=T(r,o),p=a(t,{...r,existenceGuarantees:s});if(!n)throw new Error("False branch is required for if() functions");return{conditionResult:o,trueBranchResult:p,falseBranchResult:a(n,{...r,existenceGuarantees:i}),directPropertyGuarantees:u}}function w(e,t,n){const r=[];let a=t;for(const o of e){const e=n(o,a);r.push(e);const s=v(e.node);if(s)a={...a,existenceGuarantees:s},e.existenceGuarantees=s;else{const n=g(o,t);if(n){const t=f(a.existenceGuarantees,n);a={...a,existenceGuarantees:t},e.existenceGuarantees=f(e.existenceGuarantees,n)}else if(e.existenceGuarantees){const t=f(a.existenceGuarantees,e.existenceGuarantees);a={...a,existenceGuarantees:t}}}}return r}function N(e,t,n){const r=[];let a=t;for(const o of e){const e=n(o,a);r.push(e);const s=v(e.node);if(s){const t=h(s);a={...a,existenceGuarantees:t},e.existenceGuarantees=s}else{const n=g(o,t);if(n){const t=h(n),r=f(a.existenceGuarantees,t);a={...a,existenceGuarantees:r},e.existenceGuarantees=f(e.existenceGuarantees,n)}else if(e.existenceGuarantees){const t=h(e.existenceGuarantees),n=f(a.existenceGuarantees,t);a={...a,existenceGuarantees:n}}}}return r}function I(e){var t;let n=null===(t=e[0])||void 0===t?void 0:t.existenceGuarantees;for(let r=1;r<e.length;r++)n=f(n,e[r].existenceGuarantees);return n}function E(e){var t;let n=null===(t=e[0])||void 0===t?void 0:t.existenceGuarantees;for(let r=1;r<e.length;r++)n=m(n,e[r].existenceGuarantees);return n}function C(e,t,n){const r="function"===t.type.type?t.type.libraryFunction:void 0;if((null==r?void 0:r.name)===n)return t.kind===d().NM.UnifiedFunctionProperty?[t.expression,...e.arguments]:t.kind===d().NM.Identifier?e.arguments:void 0}function R(e,t,n,r){return t.kind===d().NM.UnifiedFunctionProperty?{node:{...e,expression:{...t,expression:n[0].node},arguments:n.slice(1).map((e=>e.node)),exists:!0},errors:n.flatMap((e=>e.errors)),existenceGuarantees:r}:{node:{...e,expression:t,arguments:n.map((e=>e.node)),exists:!0},errors:n.flatMap((e=>e.errors)),existenceGuarantees:r}}function A(e){if(e.existenceGuarantees)return e.existenceGuarantees;const t=v(e.node);return t||void 0}function P(e){const t=(0,c().GH)(e);return"global"===(0,c().y5)(t).source||"unknown"}const F=new Set(["empty","not","and","or","ifs","if"]),O=new Set(["at","first","last","slice","reverse","sort","unique","includes","map","filter","find","findIndex","some","every","flat","count","length"]),S=[function(e,t,n,r){const a="function"===t.type.type?t.type.libraryFunction:void 0;if("empty"!==(null==a?void 0:a.name))return;const o=new Map(n.existenceGuarantees);let s;if(t.kind===d().NM.UnifiedFunctionProperty?s=t.expression:t.kind===d().NM.Identifier&&(s=e.arguments[0]),s){const e=g(s,n);if(e){const t=h(e);if(t)for(const[e,n]of t)o.set(e,n)}else if(s.kind===d().NM.NotionToken){if(s.token.type===l().FormulaTokenType.ContextValue)o.set(s.token.valueId,!1);else if(s.token.type===l().FormulaTokenType.BlockProperty){const e=s.token.property;o.set(e,!1)}}else if(s.kind===d().NM.MemberBlockProperty){const e=s.propertyToken.property,t=y(s.expression,e);t&&o.set(t,!1)}}const i=[];if(t.kind===d().NM.UnifiedFunctionProperty);else if(t.kind===d().NM.Identifier)for(const u of e.arguments){const e=r(u,n);i.push(e.node)}return{node:{...e,expression:t,arguments:i,exists:!0},errors:[],existenceGuarantees:o}},function(e,t,n,r){const a="function"===t.type.type?t.type.libraryFunction:void 0;if("not"===(null==a?void 0:a.name)){if(t.kind===d().NM.UnifiedFunctionProperty){const a=r(t.expression,n),o=g(a.node,n);let s;return s=h(o||a.existenceGuarantees),{node:{...e,expression:{...t,expression:a.node},exists:!0},errors:a.errors,existenceGuarantees:s}}if(t.kind===d().NM.Identifier&&1===e.arguments.length){const a=r(e.arguments[0],n),o=g(a.node,n);let s;return s=h(o||a.existenceGuarantees),{node:{...e,expression:t,arguments:[a.node],exists:!0},errors:a.errors,existenceGuarantees:s}}}},function(e,t,n,r){const a=C(e,t,"and");if(!a)return;const o=w(a,n,r);return R(e,t,o,I(o))},function(e,t,n,r){const a=C(e,t,"or");if(!a)return;const o=N(a,n,r);return R(e,t,o,E(o))},function(e,t,n,r){const a="function"===t.type.type?t.type.libraryFunction:void 0;if("ifs"!==(null==a?void 0:a.name))return;const o=[],s=[];let i;if(t.kind===d().NM.UnifiedFunctionProperty){o.push(t.expression);for(let t=0;t<e.arguments.length;t+=2)s.push(e.arguments[t]),t+1<e.arguments.length&&(t+2<e.arguments.length?o.push(e.arguments[t+1]):i=e.arguments[t+1])}else{if(t.kind!==d().NM.Identifier)return;for(let t=0;t<e.arguments.length;t+=2)t+1<e.arguments.length?(o.push(e.arguments[t]),s.push(e.arguments[t+1])):i=e.arguments[t]}const u=[],p=[];let l,c=n.existenceGuarantees;for(let d=0;d<o.length&&d<s.length;d++){const e=r(o[d],{...n,existenceGuarantees:c});p.push(...e.errors);const t=b(c,e,!0),a=r(s[d],{...n,existenceGuarantees:t});p.push(...a.errors),u.push({conditionResult:e,valueResult:a}),c=b(c,e,!1)}if(i&&(l=r(i,{...n,existenceGuarantees:c}),p.push(...l.errors)),t.kind===d().NM.UnifiedFunctionProperty){var y,m;const n=[];for(let e=0;e<u.length;e++)n.push(u[e].valueResult.node),e+1<u.length&&n.push(u[e+1].conditionResult.node);return l&&n.push(l.node),{node:{...e,expression:{...t,expression:(null===(y=u[0])||void 0===y?void 0:y.conditionResult.node)||t.expression},arguments:n,exists:!0},errors:p,existenceGuarantees:null===(m=u[0])||void 0===m?void 0:m.conditionResult.existenceGuarantees}}{var f;const n=[];for(let e=0;e<u.length;e++)n.push(u[e].conditionResult.node),n.push(u[e].valueResult.node);return l&&n.push(l.node),{node:{...e,expression:t,arguments:n,exists:!0},errors:p,existenceGuarantees:null===(f=u[0])||void 0===f?void 0:f.conditionResult.existenceGuarantees}}},function(e,t,n,r){const a=function(e,t){const n="function"===t.type.type?t.type.libraryFunction:void 0;if("if"===(null==n?void 0:n.name))return t.kind===d().NM.UnifiedFunctionProperty?{condition:t.expression,trueBranch:e.arguments[0],falseBranch:e.arguments[1],isUnifiedProperty:!0,expressionNode:t}:t.kind===d().NM.Identifier?{condition:e.arguments[0],trueBranch:e.arguments[1],falseBranch:e.arguments[2],isUnifiedProperty:!1,expressionNode:t}:void 0}(e,t);if(!a)return;const{conditionResult:o,trueBranchResult:s,falseBranchResult:i,directPropertyGuarantees:u}=M(a.condition,a.trueBranch,a.falseBranch,n,r),p=a.isUnifiedProperty?[s.node,i.node]:[o.node,s.node,i.node];return{node:{...e,expression:a.expressionNode,arguments:p,exists:!0},errors:[...o.errors,...s.errors,...i.errors],existenceGuarantees:u??o.existenceGuarantees}},function(e,t,n,r){const a=function(e,t){const n="function"===t.type.type?t.type.libraryFunction:void 0;if("let"!==(null==n?void 0:n.name)&&"lets"!==(null==n?void 0:n.name))return;if(e.arguments.length<3||e.arguments.length%2==0)return;const r=[];for(let a=0;a<e.arguments.length-1;a+=2){const t=e.arguments[a],n=e.arguments[a+1];if(t.kind!==d().NM.Identifier)return;r.push({variableName:t,valueExpression:n})}return{variableBindings:r,bodyExpression:e.arguments[e.arguments.length-1],expressionNode:t}}(e,t);if(a)return function(e,t,n,r,a){const{variableBindings:o,bodyExpression:s}=n;let i=r;const u=[],p=[];for(const c of o){const{variableName:e,valueExpression:t}=c,n=a(t,i);p.push(...n.errors);const r=x(e),o=new Map(i.existenceGuarantees);o.set(r,n.node.exists);const s=A(n),l=new Map(i.variableConditionalGuarantees);s&&l.set(r,s),i={...i,existenceGuarantees:o,variableConditionalGuarantees:l},u.push({variableName:e,valueResult:n})}const l=a(s,i);p.push(...l.errors);const d=[];for(const c of u)d.push({...c.variableName,exists:!0}),d.push(c.valueResult.node);return d.push(l.node),{node:{...e,expression:t,arguments:d,exists:!0},errors:p,existenceGuarantees:l.existenceGuarantees}}(e,t,a,n,r)}];function L(e,t){var n,r;switch(e.kind){case d().NM.Number:case d().NM.String:case d().NM.Boolean:return{node:{...e,exists:!0},errors:[]};case d().NM.NotionToken:const C=e.token;switch(C.type){case l().FormulaTokenType.Checkbox:return{node:{...e,exists:!0},errors:[]};case l().FormulaTokenType.BlockProperty:const o=C.property;let s=(null===(n=t.existenceGuarantees)||void 0===n?void 0:n.get(o))??"unknown";return"unknown"===s&&(s=!!(0,p().PJ)(o)||(0,c().lH)(e.type)),{node:{...e,exists:s},errors:[]};case l().FormulaTokenType.ContextValue:return{node:{...e,exists:(null===(r=t.existenceGuarantees)||void 0===r?void 0:r.get(C.valueId))??P(C.valueId)},errors:[]};case l().FormulaTokenType.Block:case l().FormulaTokenType.Person:case l().FormulaTokenType.Date:return{node:{...e,exists:!0},errors:[]};default:return(0,a().HB)(C)}case d().NM.Array:{const n=e.elements.map((e=>L(e,t)));return{node:{...e,elements:n.map((e=>e.node)),exists:!0},errors:n.flatMap((e=>e.errors))}}case d().NM.Identifier:{var o;const n=x(e);let r=null===(o=t.existenceGuarantees)||void 0===o?void 0:o.get(n);if(!(0,a().O9)(r)||"unknown"===r){var s;const e=null===(s=t.variableConditionalGuarantees)||void 0===s?void 0:s.get(n);if(e)for(const[n,o]of e)if("boolean"==typeof o&&!0===o){var i;const e=null===(i=t.existenceGuarantees)||void 0===i?void 0:i.get(n);if((0,a().O9)(e)){r=e;break}}}const u=!(0,a().O9)(r)||r;return{node:{...e,exists:u},errors:[],existenceGuarantees:t.existenceGuarantees}}case d().NM.Conditional:return function(e,t,n){const{conditionResult:r,trueBranchResult:a,falseBranchResult:o,directPropertyGuarantees:s}=M(e.condition,e.expIfTrue,e.expIfFalse,t,n);return{node:{...e,condition:r.node,expIfTrue:a.node,expIfFalse:null==o?void 0:o.node,exists:!0},errors:[...r.errors,...a.errors,...(null==o?void 0:o.errors)??[]],existenceGuarantees:s??r.existenceGuarantees}}(e,t,L);case d().NM.LogicalOr:return function(e,t,n){const r=N(e.elements,t,n),a=E(r);return{node:{...e,elements:r.map((e=>e.node)),exists:!0},errors:r.flatMap((e=>e.errors)),existenceGuarantees:a}}(e,t,L);case d().NM.LogicalAnd:return function(e,t,n){const r=w(e.elements,t,n),a=I(r);return{node:{...e,elements:r.map((e=>e.node)),exists:!0},errors:r.flatMap((e=>e.errors)),existenceGuarantees:a}}(e,t,L);case d().NM.Equality:case d().NM.Relational:case d().NM.Additive:case d().NM.Multiplicative:case d().NM.Exponentiation:return{node:{...e,exists:!0},errors:[]};case d().NM.Unary:return function(e,t,n){const r=n(e.expression,t),a=g(e.expression,t);let o;return o=h(a||r.existenceGuarantees),{node:{...e,expression:r.node,exists:!0},errors:r.errors,existenceGuarantees:o}}(e,t,L);case d().NM.Call:const{node:R,errors:A,existenceGuarantees:B}=L(e.expression,t),U=[...A],D="function"===R.type.type?R.type.libraryFunction:void 0,_=function(e,t,n,r){for(const a of S){const o=a(e,t,n,r);if(o)return o}}(e,R,t,L);if(_)return _;const G=(null==D?void 0:D.name)&&O.has(D.name),q="array"===R.type.type,V=G&&q,W=V;null==D||!D.name||F.has(D.name)||W||!0===R.exists||U.push({type:d().IA.CalledFunctionOnEmptyValue,node:e,expression:R,libraryFunction:D});let Z=(0,c().lH)(e.type);if(R.kind===d().NM.UnifiedFunctionProperty&&!0===R.exists){const e=O.has(R.name),n="array"===R.expression.type.type;if(e&&n){let e=!1;if(R.expression.kind===d().NM.MemberBlockProperty){var u;const n=R.expression.propertyToken.property,r=y(R.expression.expression,n);r&&!0===(null===(u=t.existenceGuarantees)||void 0===u?void 0:u.get(r))&&(e=!0)}else if(R.expression.kind===d().NM.NotionToken&&R.expression.token.type===l().FormulaTokenType.BlockProperty){var m;const n=R.expression.token.property;!0===(null===(m=t.existenceGuarantees)||void 0===m?void 0:m.get(n))&&(e=!0)}e&&(Z=R.exists)}}if(V&&["first","last"].includes(D.name)){let e=!1;if(R.kind===d().NM.MemberBlockProperty){var f;const n=R.propertyToken.property,r=y(R.expression,n);r&&!0===(null===(f=t.existenceGuarantees)||void 0===f?void 0:f.get(r))&&(e=!0)}else if(R.kind===d().NM.NotionToken&&R.token.type===l().FormulaTokenType.BlockProperty){var v;const n=R.token.property;!0===(null===(v=t.existenceGuarantees)||void 0===v?void 0:v.get(n))&&(e=!0)}e&&(Z=!0)}return{node:{...e,expression:R,exists:Z},errors:U,existenceGuarantees:B};case d().NM.UnifiedFunctionProperty:const $=L(e.expression,t),H=$.node,Y=[...$.errors],z=O.has(e.name),K="array"===H.type.type;let j;if(z&&K)if(["first","last"].includes(e.name)){let n=!1;if(H.kind===d().NM.MemberBlockProperty){var b;const e=H.propertyToken.property,r=y(H.expression,e);r&&!0===(null===(b=t.existenceGuarantees)||void 0===b?void 0:b.get(r))&&(n=!0)}else if(H.kind===d().NM.NotionToken&&H.token.type===l().FormulaTokenType.BlockProperty){var k;const e=H.token.property;!0===(null===(k=t.existenceGuarantees)||void 0===k?void 0:k.get(e))&&(n=!0)}j=!!n||(0,c().lH)(e.type)}else j=(0,c().lH)(e.type);else j=H.exists;return{node:{...e,expression:H,exists:j},errors:Y,existenceGuarantees:$.existenceGuarantees};case d().NM.MemberBlockProperty:const Q=L(e.expression,t);let J="unknown";const X=e.propertyToken.property;if(Q.node.kind===d().NM.NotionToken&&Q.node.token.type===l().FormulaTokenType.ContextValue){var T;const e=`${Q.node.token.valueId}:${X}`;J=(null===(T=t.existenceGuarantees)||void 0===T?void 0:T.get(e))??"unknown"}return"unknown"===J&&(J=!0!==Q.node.exists?"unknown":!!(0,p().PJ)(X)||(0,c().lH)(e.type)),{node:{...e,expression:Q.node,exists:J},errors:[...Q.errors],existenceGuarantees:Q.existenceGuarantees};case d().NM.RecoveryNode:return{node:{...e,exists:!0},errors:[]};default:return(0,a().HB)(e)}}var B=()=>n(420062),U=()=>n(563015),D=()=>n(696446),_=()=>n(106714),G=()=>n(628048);const q=[{name:l().FORMULA_PROP_WRAPPER,error:d().IA.InvalidPropCall},{name:l().FORMULA_CONTEXT_WRAPPER,error:d().IA.InvalidContextCall},{name:l().FORMULA_VARIABLE_WRAPPER,error:d().IA.InvalidVariableCall}];function*V(e,t){var n;const r=(yield{recordPointers:[e]}).getRecordModel(e);return r?r.getNormalizedSchema():e.id===(null===(n=t.publicPageDataCollection)||void 0===n?void 0:n.id)?null===(a=t.publicPageDataCollection)||void 0===a?void 0:a.schema:void 0;var a}function*W(e,t){const{valueTypes:n}=t;switch(e.kind){case d().NM.Number:return{node:{...e,type:{type:"number"},valueTypes:n},errors:[]};case d().NM.String:return{node:{...e,type:{type:"text"},valueTypes:n},errors:[]};case d().NM.Boolean:return{node:{...e,type:{type:"checkbox"},valueTypes:n},errors:[]};case d().NM.NotionToken:{const s=e.token;switch(s.type){case l().FormulaTokenType.Checkbox:return{node:{...e,type:{type:"checkbox"},valueTypes:n},errors:[]};case l().FormulaTokenType.BlockProperty:{var r;if((0,c().ix)(s)){const r=n.find((e=>e.kind===l().FormulaContextValueKind.ContextValue&&e.id===(0,c().GH)(s.contextValueId)));if(void 0===r)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.MissingContextVariable,node:e,token:s}]};const a=r.type;if("block"!==a.type)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.ContextVariableNotBlockWithCollection,node:e,token:s}]};if(void 0===a.collection){const r=(0,c().Yi)(s.property);if(p().PJ(r))return{node:{...e,type:l().FormulaTokenSupportedBlockSystemPropertyToType[r],valueTypes:n},errors:[]};{var y;const a=(null===(y=t.formulaPropertyNames)||void 0===y?void 0:y.get(r))??r;return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.MissingPropertyOnContextVariable,node:e,property:a,token:s}]}}}const o=(0,c().Yi)(s.property);if(p().PJ(o))return{node:{...e,type:l().FormulaTokenSupportedBlockSystemPropertyToType[o],valueTypes:n},errors:[]};const i=yield*V(a.collection,t),u=null==i?void 0:i[o];if(void 0===u||void 0===i){var m;const r=(null===(m=t.formulaPropertyNames)||void 0===m?void 0:m.get(o))??o;return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.MissingPropertyOnContextVariable,node:e,property:r,token:s}]}}const f=yield*(0,c().Df)(o,i,u);return{node:{...e,type:f??{type:"unknown"},valueTypes:n},errors:void 0===f?[{type:d().IA.BlockPropertyTypeInvalid,node:e,token:s,propertyName:u.name,propertyType:u.type}]:[]}}const a=null===(r=n.find((e=>e.kind===l().FormulaContextValueKind.ThisRow)))||void 0===r?void 0:r.type;if(void 0===a)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.ThisRowTypeNotFound,node:e}]};if("block"!==a.type||void 0===a.collection)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.ThisRowNotBlockWithCollection,node:e}]};if(void 0===s.collection)return{node:{...e,type:l().FormulaTokenSupportedBlockSystemPropertyToType[s.property],valueTypes:n},errors:[]};const i=yield*V(a.collection,t),u=(0,c().Yi)(s.property),v=null==i?void 0:i[u];var f,h;if(void 0===v||void 0===i)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.MissingPropertyOnThisRow,node:e,property:(null===(f=t.formulaPropertyNames)||void 0===f?void 0:f.get(u))??u}]};if((0,o().CH)(t.spaceId,v,i))return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.CrossSpacePropertyNotSupported,node:e,property:(null===(h=t.formulaPropertyNames)||void 0===h?void 0:h.get(u))??u}]};const x=yield*(0,c().Df)(u,i,v);return{node:{...e,type:x??{type:"unknown"},valueTypes:n},errors:void 0===x?[{type:d().IA.MemberPropertyTypeInvalid,node:e,token:s,propertyName:v.name,propertyType:v.type}]:[]}}case l().FormulaTokenType.ContextValue:{var v;const t=null===(v=n.find((e=>e.kind===l().FormulaContextValueKind.ContextValue&&e.id===(0,c().GH)(s.valueId))))||void 0===v?void 0:v.type;return void 0===t?{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.MissingContextVariable,node:e,token:s}]}:{node:{...e,type:t,valueTypes:n},errors:[]}}case l().FormulaTokenType.Block:{const t={table:i().ev,id:s.blockId,spaceId:s.spaceId},r=(yield{recordPointers:[t]}).getRecordModel(t);if(void 0===r)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:d().IA.MissingBlock,node:e,token:s}]};const a=r.getParentPointer(),o=a.table===u().Vl?a:void 0;return{node:{...e,type:{type:"block",collection:o},valueTypes:n},errors:[]}}case l().FormulaTokenType.Person:return{node:{...e,type:{type:"person"},valueTypes:n},errors:[]};case l().FormulaTokenType.Date:return{node:{...e,type:{type:"date"},valueTypes:n},errors:[]};default:return(0,a().HB)(s)}}case d().NM.Array:{const r=yield*(0,D().KZ)(e.elements.map((e=>W(e,t))));let a={type:"unknown"};if(r.length>0){a=r[0].node.type;for(let e=1;e<r.length;e++)if(!(0,c().Re)(a,r[e].node.type)){a={type:"unknown"};break}}return{node:{...e,elements:r.map((e=>e.node)),type:{type:"array",of:a},valueTypes:n},errors:r.flatMap((e=>e.errors))}}case d().NM.Identifier:{var x;const t=null===(x=n.find((t=>t.kind===l().FormulaContextValueKind.Binding&&t.id===e.text)))||void 0===x?void 0:x.type;if(void 0!==t)return{node:{...e,type:t,valueTypes:n},errors:[]};const r=G().LP.hasOwnProperty(e.text)?G().LP[e.text]:void 0;if(void 0===r){const t=[{type:d().IA.UndefinedIdentifier,node:e}];return B().sr.hasOwnProperty(e.text)?t.push({type:d().IA.RenamedIdentifier,node:e,identifier:e.text,renamedTo:B().sr[e.text]}):B().lg.hasOwnProperty(e.text)&&t.push({type:d().IA.RemovedFunction,node:e,functionName:e.text,alternative:B().lg[e.text]}),{node:{...e,type:{type:"unknown"},valueTypes:n},errors:t}}return{node:{...e,type:{type:"function",libraryFunction:r,calledFromUnifiedFunctionProperty:!1},valueTypes:n},errors:[]}}case d().NM.Conditional:{const r=yield*W(e.condition,t),a=yield*W(e.expIfTrue,t),o=void 0!==e.expIfFalse?yield*W(e.expIfFalse,t):void 0;let s={type:"unknown"};return void 0===a.node.type||void 0!==(null==o?void 0:o.node.type)&&!(0,c().Re)(a.node.type,o.node.type)||(s=a.node.type),{node:{...e,condition:r.node,expIfTrue:a.node,expIfFalse:null==o?void 0:o.node,type:s,valueTypes:n},errors:[...r.errors,...a.errors??[],...(null==o?void 0:o.errors)??[]]}}case d().NM.LogicalOr:case d().NM.LogicalAnd:const T=yield*(0,D().KZ)(e.elements.map((e=>W(e,t)))),M=T.flatMap((e=>e.errors));return{node:{...e,elements:T.map((e=>e.node)),type:{type:"checkbox"},valueTypes:n},errors:M};case d().NM.Equality:case d().NM.Relational:{const r=yield*W(e.lhs,t),a=yield*W(e.rhs,t),o=[...r.errors,...a.errors];if(e.kind===d().NM.Relational){const t=r.node.type,n=a.node.type;"unknown"===t.type||"unknown"===n.type||t.type===n.type&&["number","date","text","checkbox"].includes(t.type)||o.push({type:d().IA.CannotRelativelyCompareTypes,node:e,lhsType:t,rhsType:n})}return{node:{...e,lhs:r.node,rhs:a.node,type:{type:"checkbox"},valueTypes:n},errors:o}}case d().NM.Additive:case d().NM.Multiplicative:case d().NM.Exponentiation:{const r=yield*W(e.lhs,t),a=yield*W(e.rhs,t),o=[...r.errors,...a.errors];if("+"===e.op)return"number"===r.node.type.type&&"number"===a.node.type.type?{node:{...e,lhs:r.node,rhs:a.node,type:{type:"number"},valueTypes:n},errors:o}:{node:{...e,lhs:r.node,rhs:a.node,type:["unknown","number"].includes(r.node.type.type)&&["unknown","number"].includes(a.node.type.type??"unknown")?{type:"unknown"}:{type:"text"},valueTypes:n},errors:o};const s=function(e,t,n){const r=t.type,a=(null==n?void 0:n.type)??{type:"unknown"};if(!["unknown","number"].includes(r.type)||!["unknown","number"].includes(a.type))return{type:d().IA.CannotDoMathOnType,node:e,lhsType:r,rhsType:a}}(e,r.node,a.node);return void 0!==s&&o.push(s),{node:{...e,lhs:r.node,rhs:a.node,type:{type:"number"},valueTypes:n},errors:o}}case d().NM.Unary:{const r=yield*W(e.expression,t),o=[...r.errors];let s;switch(e.op){case"-":["number","unknown"].includes(r.node.type.type)||o.push({type:d().IA.UnaryMinusOnNonNumber,node:e,expression:r.node}),s={type:"number"};break;case"!":case"not":s={type:"checkbox"};break;default:(0,a().HB)(e)}return{node:{...e,expression:r.node,type:s,valueTypes:n},errors:o}}case d().NM.Call:{const{node:r,errors:a}=yield*W(e.expression,t),o=[...a];if(r.kind===d().NM.Identifier&&("lets"===r.text||"let"===r.text))return yield*function*(e,t,n){const r=[];let a=[...n.valueTypes];const o=[];for(let p=0;p<e.arguments.length-1;p+=2){const t=e.arguments[p],s=e.arguments[p+1];if(t.kind!==d().NM.Identifier){o.push({type:d().IA.IdentifierExpected,node:t});continue}const{node:i,errors:u}=yield*W(s,{...n,valueTypes:a});r[p+1]=i,o.push(...u);const c=t.text;a=[{kind:l().FormulaContextValueKind.Binding,id:c,name:c,type:i.type},...a],r[p]={...t,type:i.type,valueTypes:a}}const s=e.arguments[e.arguments.length-1];if(!s)return{node:{...e,expression:t,arguments:r,type:{type:"unknown"},valueTypes:a},errors:o};const{node:i,errors:u}=yield*W(s,{...n,valueTypes:a});return r[e.arguments.length-1]=i,o.push(...u),{node:{...e,expression:t,arguments:r,type:i.type,valueTypes:a},errors:o}}(e,r,t);["function","unknown"].includes(r.type.type)||o.push({type:d().IA.CallingNotFunction,node:e,callee:r});const s="function"===r.type.type?r.type.libraryFunction:void 0,i="function"===r.type.type?r.type.boundTargetType:void 0;if(void 0!==s){var g;null!==(g=t.featureGates)&&void 0!==g&&null!==(g=g.formulas_disabled_functions)&&void 0!==g&&g.includes(s.name)&&o.push({type:d().IA.UnifiedFunctionCannotFindFunction,node:e,name:s.name});const n=(0,c().ab)(s),a=e.arguments.length+(void 0!==i?1:0);a<n&&("function"===r.type.type&&r.type.calledFromUnifiedFunctionProperty?o.push({type:d().IA.FunctionCallTooFewArguments,node:e,libraryFunction:s,numArguments:a-1,minNumParameters:n-1}):o.push({type:d().IA.FunctionCallTooFewArguments,node:e,libraryFunction:s,numArguments:a,minNumParameters:n}))}const u=[],p=[];void 0!==i&&p.push(i);for(let m=0;m<e.arguments.length;m++){const r=e.arguments[m],a=void 0!==i?m+1:m,y=void 0!==s?(0,c().Pf)(s,a):void 0;if(void 0!==s&&void 0===y&&o.push({type:d().IA.FunctionCallUnexpectedArgument,node:e,libraryFunction:s,argument:r,parameterIndex:a}),void 0!==(null==y?void 0:y.augmentScope)){const e=u.map((e=>(null==e?void 0:e.type)??{type:"unknown"})),a=y.augmentScope(void 0!==i?[i,...e]:e),{node:s,errors:d}=yield*W(r,{...t,valueTypes:[...Object.entries(a).map((([e,t])=>({kind:l().FormulaContextValueKind.Binding,id:e,type:t}))),...n]});u[m]=s,p.push(s.type),o.push(...d)}else{const{node:n,errors:a}=yield*W(r,{...t});if(u[m]=n,void 0!==s&&void 0!==y){const t="id"===s.name&&"block"===n.type.type||(0,c().CM)(n.type,y.type);"boolean"==typeof t?(p.push(n.type),t||o.push({type:d().IA.FunctionCallArgumentWrongType,node:e,libraryFunction:s,argument:n,expectedParameter:y})):p.push(t)}else p.push(n.type);o.push(...a)}}let y=o;for(const t of q)if(r.kind===d().NM.Identifier&&r.text===t.name&&1===e.arguments.length&&e.arguments[0].kind===d().NM.String&&e.arguments[0].text.length>0){const n=e.arguments[0].text.replace(l().FORMULA_TOKEN_REGEX,"");y=y.filter((e=>!(e.type===d().IA.UndefinedIdentifier&&e.node.kind===d().NM.Identifier&&e.node.text===t.name))),y.push({type:t.error,node:e,name:n});break}if(r.kind===d().NM.UnifiedFunctionProperty)for(const t of q)if(r.name===t.name&&1===e.arguments.length&&e.arguments[0].kind===d().NM.String&&e.arguments[0].text.length>0){const n=e.arguments[0].text.replace(l().FORMULA_TOKEN_REGEX,"");y=y.filter((e=>!(e.type===d().IA.UnifiedFunctionCannotFindFunction&&e.node.kind===d().NM.UnifiedFunctionProperty&&e.node.name===t.name))),y.push({type:t.error,node:e,name:n});break}return{node:{...e,expression:r,arguments:u,type:void 0!==s?"function"==typeof s.returnType?s.returnType(p):s.returnType:{type:"unknown"},valueTypes:n},errors:y}}case d().NM.UnifiedFunctionProperty:{const r=G().LP.hasOwnProperty(e.name)?G().LP[e.name]:void 0,{node:a,errors:o}=yield*W(e.expression,t),s=[...o];let i={type:"unknown"};if(void 0===r)s.push({type:d().IA.UnifiedFunctionCannotFindFunction,node:e,name:e.name});else{const t=(0,c().Pf)(r,0);if(void 0===t)s.push({type:d().IA.UnifiedFunctionNoArguments,node:e,libraryFunction:r});else{const n="id"===r.name&&"block"===a.type.type||(0,c().CM)(a.type,t.type);"boolean"==typeof n?(i=a.type,n||s.push({type:d().IA.UnifiedFunctionTargetWrongType,node:e,expression:a,libraryFunction:r})):i=n}}return{node:{...e,expression:a,type:void 0!==r?{type:"function",boundTargetType:i,libraryFunction:r,calledFromUnifiedFunctionProperty:!0}:{type:"unknown"},valueTypes:n},errors:s}}case d().NM.MemberBlockProperty:{const{node:r,errors:a}=yield*W(e.expression,t),i=[...a];let u;if("block"===r.type.type)if(void 0===e.propertyToken.collection)u=l().FormulaTokenSupportedBlockSystemPropertyToType[e.propertyToken.property];else{const n=yield*V(e.propertyToken.collection,t),a=(0,c().Yi)(e.propertyToken.property),p=null==n?void 0:n[a];var b;if(void 0===p||void 0===n)i.push({type:d().IA.MemberPropertyMissing,node:e,property:(null===(b=t.formulaPropertyNames)||void 0===b?void 0:b[a])??a});else if(void 0!==r.type.collection){var k;if((0,o().CH)(t.spaceId,p,n))i.push({type:d().IA.CrossSpacePropertyNotSupported,node:e,property:(null===(k=t.formulaPropertyNames)||void 0===k?void 0:k.get(a))??a});if((0,s().Z2)(e.propertyToken.collection,r.type.collection)){const t=yield*(0,c().Df)(a,n,p);u=t,void 0===t&&i.push({type:d().IA.MemberPropertyTypeInvalid,node:e,token:e.propertyToken,propertyName:p.name,propertyType:p.type})}else i.push({type:d().IA.MemberPropertyMismatchCollection,node:e,token:e.propertyToken})}}else"unknown"!==r.type.type&&i.push({type:d().IA.MemberPropertyTargetNotBlock,node:e,expression:r});return{node:{...e,expression:r,type:u??{type:"unknown"},valueTypes:n},errors:i}}case d().NM.RecoveryNode:return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[]};default:(0,a().HB)(e)}}function Z(e,t){return"array"!==e.type?e.type===t.type:"array"===t.type&&("array"===e.of.type?Z(e.of,t):Z(e.of,t.of))}function $(e,t){return t.some((t=>Z(e,t)))}async function H(e,t,n){const a=W(e,t);let o=a.next();for(;!o.done;){const e=t.handleDataRequest(o.value);o=a.next((0,r().yL)(e)?await e:e)}if(t.allowedReturnTypes&&!$(o.value.node.type,t.allowedReturnTypes)&&o.value.errors.push({allowedReturnTypes:t.allowedReturnTypes,node:o.value.node,returnType:o.value.node.type,type:d().IA.DisallowedReturnType}),t.featureGates.formula_null_check&&0===o.value.errors.length){const{node:e,errors:n}=L(o.value.node,{...t,existenceGuarantees:new Map});o.value.node=e,o.value.errors.push(...n)}if(!n)return o.value;const s=o.value.errors.findIndex((e=>e.type===d().IA.InvalidPropCall));-1!==s&&(o.value.errors=o.value.errors.filter(((e,t)=>t===s||e.type!==d().IA.InvalidPropCall)));const i=o.value.errors.map((e=>{const t=(0,U().zf)(e);return{...e,node:(0,_().TW)(t,n)}}));return{node:o.value.node,errors:i}}function Y(e,t,n){const r=W(e,t);let a=r.next();for(;!a.done;){const e=t.handleDataRequest(a.value);a=r.next(e)}if(t.allowedReturnTypes&&!$(a.value.node.type,t.allowedReturnTypes)&&a.value.errors.push({allowedReturnTypes:t.allowedReturnTypes,node:a.value.node,returnType:a.value.node.type,type:d().IA.DisallowedReturnType}),t.featureGates.formula_null_check&&0===a.value.errors.length){const{node:e,errors:n}=L(a.value.node,{...t,existenceGuarantees:new Map});a.value.node=e,a.value.errors.push(...n)}if(!n)return a.value;const o=a.value.errors.map((e=>{const t=(0,U().zf)(e);return{...e,node:(0,_().TW)(t,n)}}));return{node:a.value.node,errors:o}}},96033:(e,t,n)=>{n.d(t,{F$:()=>s,VD:()=>a,nA:()=>o,o9:()=>i});n(16280);var r=()=>n(220719);class a extends Error{constructor(e){super(`Violated invariant in the formula compiler: ${e}`)}}function o(e){return"type"in e&&"compiledCode"===e.type}function s(e){if(null!==e&&"object"==typeof e&&"type"in e&&"compiledCode"===e.type)throw new a("unexpected compiled code");return e}function i(e,t="expected value to exist"){return r().o9(e,t,void 0,a)}},264435:(e,t,n)=>{n.d(t,{o4:()=>p,u:()=>s});n(944114),n(898992),n(803949);var r=()=>n(534177);const a={LLLL:"DDDD t",llll:void 0,LLL:"DDD t",lll:"DD t",LL:"DDD",ll:"DD",L:void 0,l:void 0,LT:"t",LTS:"tt",M:"L",Mo:void 0,MM:"LL",MMM:void 0,MMMM:void 0,Q:"q",Qo:void 0,D:"d",Do:void 0,DD:"dd",DDD:"o",DDDo:void 0,DDDD:"ooo",d:void 0,do:void 0,dd:void 0,ddd:void 0,dddd:"cccc",e:void 0,E:"c",w:void 0,wo:void 0,ww:void 0,W:"W",Wo:void 0,WW:"WW",YY:"yy",YYYY:"yyyy",YYYYYY:void 0,Y:"y",gg:"kk",gggg:"kkkk",GG:"kk",GGGG:"kkkk",A:"a",a:void 0,H:"H",HH:"HH",h:"h",hh:"hh",k:void 0,kk:void 0,m:"m",mm:"mm",s:"s",ss:"ss",S:"uuu",SS:"uu",SSS:"SSS",z:void 0,zz:void 0,Z:"ZZ",ZZ:"ZZZ",X:"X",x:"x"};const o=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|LTS|LT|LL?L?L?|l{1,4}|.)/g;function s(e,t){let n=[];const s=[],l=e.locale.substring(0,2),d=t=>{if(n.length>0){const t=n.join("");s.push(e.toFormat(t)),n=[]}t&&s.push(t)},c=t.match(o);return c?(c.forEach((t=>{if(a[t])n.push(a[t]);else if((o=t)in a&&void 0===a[o])switch(t){case"llll":"en"===l?n.push("ccc, DD t"):"ja"===l?n.push("DD(ccc) t"):"ko"===l?n.push("DD cccc t"):"de"===l?n.push("ccc., DD t"):n.push("ccc DD t");break;case"L":"ko"===l?n.push("yyyy.MM.dd."):d(e.toLocaleString({day:"2-digit",month:"2-digit",year:"numeric"}));break;case"l":"ja"===l?d(e.toLocaleString({day:"2-digit",month:"2-digit",year:"numeric"})):"ko"===l?n.push("yyyy.MM.dd."):"fr"===l?n.push("d/M/y"):n.push("D");break;case"MMM":"ja"===l?d(e.toLocaleString({month:"long"})):n.push("LLL");break;case"MMMM":"ja"===l?d(e.toLocaleString({month:"long"})):n.push("LLLL");break;case"e":if("fr"===l||"de"===l){d((e.weekday-1).toString());break}case"d":case"do":const o=7===e.weekday?0:e.weekday;if("do"===t){const e=p(l,o,"c");if(e){d(e);break}}d(o.toString());break;case"dd":d(e.weekdayShort.substring(0,2));break;case"ddd":"de"===l?n.push("ccc."):n.push("ccc");break;case"ww":if("fr"===l||"de"===l){n.push("WW");break}case"w":case"wo":const s=function(e,t){if("fr"===t||"de"===t)return e.weekNumber;const n=e.set({month:1,day:1});if(u(e,n)||u(e,n.set({year:e.year+1})))return 1;return i(e)}(e,l);if("wo"===t){const e=p(l,s,"W");if(e){d(e);break}}const c="ww"===t?s.toString().padStart(2,"0"):s.toString();d(c);break;case"YYYYYY":d(`+${e.year.toString().padStart(6,"0")}`);break;case"a":d(e.toFormat("a").toLowerCase());break;case"k":0===e.hour?d("24"):n.push("H");break;case"kk":0===e.hour?d("24"):n.push("HH");break;case"Mo":case"Qo":case"Do":case"DDDo":case"Wo":const y=a[t.replace("o","")],m=function(e,t,n){const r=t.toFormat(n),a=parseInt(r);if(isNaN(a))return;return p(e,a,n)}(l,e,y);m?d(m):n.push(y);break;case"z":case"zz":const f=e.zone.offsetName(e.toMillis(),{format:"short",locale:"en-US"});d(f);break;default:(0,r().HB)(t)}else/^S{4,9}/.test(t)?n.push("SSS"):/^\[.*\]$/.test(t)?d(t.substring(1,t.length-1)):d(t.replace(/\\/g,""));var o})),d(),s.join("")):e.toFormat(t)}function i(e){if(7===e.weekday)return i(e.plus({days:1}));const t=e.set({month:1,day:1}),n=e.set({month:1,day:4});if(t.weekNumber!==n.weekNumber){if(1!==(7===t.weekday?e.set({month:1,day:2}).weekNumber:t.weekNumber))return e.weekNumber+1}return e.weekNumber}function u(e,t){const n=7===e.weekday?e.plus({days:1}):e,r=7===t.weekday?t.plus({days:1}):t;return n.hasSame(r,"week")}function p(e,t,n){switch(e){case"en":case"en-GB":return l(t);case"fr":return function(e,t){switch(t){case"d":return e+(1===e?"er":"");case"W":return e+(1===e?"re":"e");default:return e+(1===e?"er":"e")}}(t,n);case"de":case"fi":case"da":case"no":return`${t}.`;case"ja":return function(e,t){switch(t){case"y":return 1===e?"":`${e}`;case"d":case"c":case"o":return`${e}`;default:return e.toString()}}(t,n);case"ko":return function(e,t){switch(t){case"d":case"c":case"o":return`${e}`;case"L":return`${e}`;case"W":return`${e}`;default:return e.toString()}}(t,n);case"ps":return`[!!!${l(t)}!!!]`;case"es":case"es-419":case"pt":return function(e,t){switch(t){case"d":case"c":case"o":return`${e}.`;case"W":return`${e}.`;default:return e.toString()}}(t,n);case"nl":return`${t}e`;case"sv":return`${t}`;case"zh":case"zh-TW":return function(e,t){switch(t){case"d":case"c":case"o":return`${e} `;case"L":return`${e} `;case"W":return`${e} `;case"y":return 1===e?"":`${e} `;default:return e.toString()}}(t,n);case"vi-VN":return function(e,t){switch(t){case"d":case"c":case"o":case"W":case"L":return`th ${e}`;default:return e.toString()}}(t,n);case"id-ID":return function(e,t){switch(t){case"d":case"c":case"o":case"W":case"L":return`ke-${e}`;default:return e.toString()}}(t,n);case"th-TH":return function(e,t){switch(t){case"d":case"c":case"o":case"W":case"L":return` ${e}`;default:return e.toString()}}(t,n);default:return}}function l(e){const t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}},307663:(e,t,n)=>{n.d(t,{xK:()=>U,Fd:()=>I,x3:()=>R,P7:()=>w,SU:()=>T,KN:()=>P,R:()=>A,Py:()=>K,HH:()=>X,Y2:()=>J,pC:()=>j,hq:()=>M,_2:()=>O,iZ:()=>F,sj:()=>Q,Hx:()=>$,kk:()=>B,tr:()=>Y,m8:()=>H,qs:()=>D,ZV:()=>G,fr:()=>q});n(18107),n(944114),n(967357),n(898992),n(823215),n(354520),n(672577),n(430670),n(803949),n(581454),n(737550);var r=n.n(n(794148)),a=()=>n(100622),o=()=>n(496603),s=()=>n(713998),i=()=>n(835195),u=(n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),()=>n(450648)),p=()=>n(201980);var l=()=>n(597777),d=()=>n(604995),c=()=>n(992437),y=()=>n(72135),m=()=>n(510916),f=()=>n(488660),h=()=>n(96033),v=()=>n(247331),x=()=>n(3259),g=()=>n(696446),b=()=>n(349835),k=()=>n(239381);function T(e,t,n){return{name:e,*eval(e,t){return{type:"number",value:n}},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:`${e}()`,output:n.toString()}]],syntax:[`${e}()`],description:t}}function M(e,t,n,a){const o=a.map((t=>({input:`${e}(${t})`,output:`${n(t)}`}))),s=a.map((t=>({input:`${t}.${e}()`,output:`${n(t)}`})));return{name:e,*eval(e,t){const[a]=e;return r()("number"===a.type),{type:"number",value:n(a.value)}},parameters:{expected:[{name:"input",type:{type:"number"}}]},returnType:{type:"number"},iconType:{type:"number"},examples:[o,s],syntax:[`${e}(number)`,`number.${e}()`],description:t}}function w(e,t,n,a){return{name:e,*eval(t,a){let[o,s]=t;if(v().TREAT_UNDEFINED_AS_ZERO_FNS.includes(e)){if("undefined"===o.type&&"undefined"===s.type)return{type:"number",value:0};"undefined"===o.type&&"number"===s.type?o={type:"number",value:0}:"undefined"===s.type&&"number"===o.type&&(s={type:"number",value:0})}return r()("number"===o.type&&"number"===s.type),{type:"number",value:n(o.value,s.value)}},parameters:{expected:[{name:"lhs",type:{type:"number"}},{name:"rhs",type:{type:"number"}}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:`${e}(5, 10)`,output:`${n(5,10)}`},{input:`5 ${a} 10`,output:`${n(5,10)}`}],[{input:`5.${e}(10)`,output:`${n(5,10)}`},{input:`5 ${a} 10`,output:`${n(5,10)}`}]],syntax:[`${e}(number, number)`,`number.${e}(number)`],description:t}}const N=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"];function*I(e,t,n){let r=yield*(0,k().o7)(e,t);if("s"!==r.at(-1)&&(r+="s"),!N.includes(r.toLowerCase()))throw new(b().x4)({type:b().v3.DateInvalidDurationUnit,invalidUnit:r,functionName:n});return r}const E=[...y().PA,"compact","bytes"],C={humanize:"compact",commas:"number_with_commas"};for(const[ee,te]of Object.entries(y().bH))C[ee.toLowerCase()]=te;function*R(e,t){const n=yield*(0,k().o7)(e,t),r=n.toLowerCase(),a=C[r]||r;if(!E.includes(a))throw new(b().x4)({type:b().v3.NumberFormatInvalid,invalidFormat:n});return a}function A(e,t){return function*(n,a){const[o,s,i]=n;r()("date"===o.type&&"number"===s.type&&"text"===i.type);const u="datetime"===o.value.type||"datetimerange"===o.value.type?o.value.time_zone:a.userTimeZone,p=(0,d().AA)(o.value,u),l=yield*I(i.value,a,t),c=e(p.start,s.value,l),y="hours"===l||"minutes"===l||"seconds"===l||"milliseconds"===l;return{type:"date",value:"date"!==o.value.type&&"daterange"!==o.value.type||y?(0,d().KQ)(c,u):(0,d().p6)(c,u)}}}function P(e){return function*(t,n){const[a]=t;r()("date"===a.type);const o=(0,d().kW)(a.value,n.userTimeZone);return{type:"number",value:e((0,d().AA)((0,l().j1)(o),n.userTimeZone,n.intl.locale).start)}}}function*F(e,t){try{return yield*function*(e,t){return(0,h().nA)(e)?yield*(0,f().RE)(e.instructions,t):yield*(0,x().yN)(e,t)}(e,t)}catch(n){if(n instanceof b().I3&&n.info.type===b().uW.DepthExceeded)throw n;return{type:"undefined"}}}function O(e,t,n){return(0,g().KZ)(e.map(((e,r)=>F(t,{...n,values:[{kind:v().FormulaContextValueKind.Binding,id:v().CURRENT_VALUE_NAME,value:e},{kind:v().FormulaContextValueKind.Binding,id:v().CURRENT_INDEX_NAME,value:{type:"number",value:r}},...n.values]}))))}const S={b:["b"],i:["i"],s:["s"],u:["_"],c:["c"]},L=["b","i","s","_","c","h"];function B(e){const t=[];return e.forEach((e=>{var n;const r=null==e||null===(n=e[0])||void 0===n?void 0:n[0].toLowerCase().split(",");for(const a of r){const e=_(a);if(e)t.push(e);else{const e=S[a];e&&t.push(e)}}})),t}function U(e,t){return e.map((e=>{const n=(0,p().uPN)(e);return(0,p().Ey_)((0,p().N8A)(e),[...n,...t])}))}function D(e,t){return e.map((e=>(0,p().Ey_)((0,p().N8A)(e),(0,p().uPN)(e).filter((e=>{const n=(0,p()._XS)(e);return!L.includes(n)||void 0!==t&&!t.some((t=>n===t[0]&&(void 0===t[1]||e[1]===t[1])))})))))}function _(e){const t=a().Wr.find((t=>t===e));return t?[p().Ifu.Highlight,t]:"green"===e?[p().Ifu.Highlight,"teal"]:"green_background"===e?[p().Ifu.Highlight,"teal_background"]:"grey"===e?[p().Ifu.Highlight,"gray"]:"grey_background"===e?[p().Ifu.Highlight,"gray_background"]:void 0}function*G(e,t){if(W(e))return e.sort(((e,n)=>Z({left:e,right:n,context:t})));const n=(0,o().oE)(e.flatMap((e=>(0,k().vu)(e)))),r=n.length?(yield{recordPointers:n}).getRecordModel:c().b.constant(void 0),a=e.map((e=>(0,i().R2)({result:e,getRecordModel:r,userTimeZone:t.userTimeZone,intl:t.intl,useImprovedSort:!0})));return(0,o().yU)(e,a).sort(((e,t)=>(0,i().a7)(e[1],t[1],{}))).map((([e])=>e))}function*q(e,t,n){const r=yield*O(e,t,n);if(W(r)){return(0,o().yU)(e,r).sort(((e,t)=>Z({left:e[1],right:t[1],context:n}))).map((([e])=>e))}const a=(0,o().oE)(r.flatMap((e=>(0,k().vu)(e)))),s=a.length?(yield{recordPointers:a}).getRecordModel:c().b.constant(void 0),u=r.map((e=>(0,i().R2)({result:e,getRecordModel:s,userTimeZone:n.userTimeZone,intl:n.intl,useImprovedSort:!0})));return(0,o().yU)(e,u).sort(((e,t)=>(0,i().a7)(e[1],t[1],{}))).map((([e])=>e))}const V=["number","date","checkbox","undefined"];function W(e){let t;return e.every((e=>"undefined"===e.type||(void 0===t?!!V.includes(e.type)&&(t=e.type,!0):t===e.type)))}function Z(e){const{left:t,right:n,context:r}=e;return"date"===t.type&&"date"===n.type?(0,k().i3)(t.value,n.value,r.userTimeZone):"number"===t.type&&"number"===n.type?t.value-n.value:"checkbox"===t.type&&"checkbox"===n.type?t.value===n.value?0:t.value?1:-1:"undefined"===t.type?"undefined"===n.type?0:1:"undefined"===n.type?-1:0}function $(e){const t=[];for(const n of e)if("array"===n.type){const e=$(n.values);t.push(...e)}else"number"===n.type&&t.push(n.value);return t}function H(e){const{timeZone:t,context:n}=e;if("text"===(null==t?void 0:t.type)){const e=(0,p().k4p)(t.value);if(e.startsWith("GMT")&&e.length>3){return`Etc/GMT${"-"===e[3]?"+":"-"}${e.slice(4)}`}return e}return n.userTimeZone}function*Y(e,t,n,r,a){const o=yield*z(e,a,{disableAnnotationPrefix:!1}),s=yield*z(n,a),i=Math.min(Math.floor(t),1e4),u=(0,p().AhH)(o);if(u>=t)return{type:"text",value:e};const l=(0,p().AhH)(s),d=i-u,c=l>0?Math.floor(d/l):0,y=d%l,m=[];"end"===r&&m.push(...e);for(let p=0;p<c;p++)m.push(...s);return y>0&&m.push(...(0,p().AI5)(s,0,y).tokensInsideRange),"start"===r&&m.push(...e),{type:"text",value:(0,p().__s)(m)}}function*z(e,t,n){const r=(0,s().dg)(e);return function(e){const{textValue:t,getRecordModel:n,userTimeZone:r,intl:a,seenBlocks:o=new Set,deterministic:s=!1,disableAnnotationPrefix:i=!1,disableInsertedAnnotations:l=!1,renderDateAnnotationsAsISO:d=!1,externalIntegrations:c}=e,y=[],m=i?"":"@",f=p().RQ(t);for(const h of f){const e=p().uPN(h);if(!e.length){y.push(h);continue}const i=(0,u().t2)({token:h,getRecordModel:n,userTimeZone:r,deterministic:s,intl:a,seenBlocks:o,prefix:m,disableInsertedAnnotations:l,renderDateAnnotationsAsISO:d,externalIntegrations:c}),f=(0,u().Px)(e,l);(null!=t&&t.length||f.length)&&y.push((0,p().Ey_)(i??"",f))}return y}({textValue:e,getRecordModel:r.length?(yield{recordPointers:r}).getRecordModel:c().b.constant(void 0),userTimeZone:t.userTimeZone,deterministic:!0,intl:t.intl,disableAnnotationPrefix:!0,...n})}function K(e){return(0,p().wmz)((0,p().ESw)({collection:void 0,name:e,property:e}))}function j(e){return(0,p().wmz)((0,p().ESw)({collection:void 0,name:(0,m().i)(e),property:e}))}function*Q(e,t){if(e.length<3||e.length%2!=1)throw new(b().x4)({type:b().v3.NotEnoughArguments});const n={...t};for(let a=0;a<e.length-1;a+=2){const t=e[a],r=e[a+1];if(t.kind!==b().NM.Identifier)throw new(b().x4)({type:b().v3.LetBindingNameNotIdentifier,node:t});const o=yield*F(r,n);n.values=[{kind:v().FormulaContextValueKind.Binding,id:t.text,value:o},...n.values]}const r=e[e.length-1];return yield*(0,x().yN)(r,n)}function J(e){return(0,p().wmz)((0,p().ESw)(e))}function X(e){return(0,p().wmz)((0,p().CA$)(e))}},342581:(e,t,n)=>{n.d(t,{J6:()=>w,LO:()=>N,MC:()=>f,UJ:()=>v,Y7:()=>b,dA:()=>k,jA:()=>g,kL:()=>h,rV:()=>M,wZ:()=>I,wr:()=>E});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(823215),n(354520),n(581454);var r=()=>n(496603),a=()=>n(973647),o=()=>n(835195),s=()=>n(632905),i=()=>n(869190),u=()=>n(236162),p=()=>n(792071),l=()=>n(247331),d=()=>n(80979),c=()=>n(349835),y=()=>n(239381),m=()=>n(383969);function f(e){const{block:t,property:n,getRecordModel:r,formula2Error:o,resultCache:s,logFormulaStatsFn:i}=e,d=performance.now(),y=E({resultCache:s,blockId:t.id,property:n});if(void 0!==y)return null==i||i({executionTimeMs:performance.now()-d,cachedCount:1}),b(y);const m=(0,u().zN)({block:t,getRecordModel:r}),f=p().Bj6.fromValue("collection",m);if(!f)return;const v=w({blockModel:t,collectionVersion:f.getVersion(),propertyId:n});if(v){"undefined"==typeof window&&(null==i||i({error:"collection_formula_evaluator_got_thunk_on_server"}));const e=v();if(e&&e!==l().FORMULA_LOADING)return a().Q.isFail(e)?(null==i||i({executionTimeMs:performance.now()-d,cachedCount:1,error:e.error.type}),void(null===(null==o?void 0:o.error)&&(0,c().Lc)(e.error)&&(o.error=new(c().I3)(e.error)))):e.value}const x=h({...e,logFormulaStatsFn:i});if(null==i||i({executionTimeMs:performance.now()-d,uncachedCount:1}),!x)return;const k=g(x);return a().Q.isFail(k)?(null==i||i({error:k.error.type}),void(null===(null==o?void 0:o.error)&&(0,c().Lc)(k.error)&&(o.error=new(c().I3)(k.error)))):k.value}function h(e){const t=x(e);if(t)return g(t)}function v(e){return x(e)}function x(e){const{block:t,formulaCode:r,property:a,getRecordModel:o,intl:s,userTimeZone:i,depth:u,visitedProperties:p,formulaTimeoutTimestampMs:c,logFormulaTimeoutFn:m,publicPageDataCollection:f,resultCache:h,regExpCache:v,formatDateCache:x,experimentService:g,collectionFeatureGates:b,spaceIdCreator:k,logFormulaStatsFn:T}=e;if(!n(80979))return;const M={values:[{kind:l().FormulaContextValueKind.ThisRow,value:{type:"block",value:t.pointer}}],handleDataRequest:(0,y().zg)(o),intl:s,userTimeZone:i,depth:u,visitedProperties:p,formulaTimeoutTimestampMs:c,logFormulaTimeoutFn:m,resultCache:h,regExpCache:v,formatDateCache:x,publicPageDataCollection:f,experimentService:g,spaceId:t.space_id,collectionFeatureGates:b,spaceIdCreator:k,logFormulaStatsFn:T},w=(0,d().executeFormulaSync)(r,M);return"value"in w&&I({resultCache:h,blockId:t.id,property:a,value:w.value}),w}function g(e){return a().Q.isFail(e)?e:{value:b(e.value)}}function b(e){if("function"===e.type)return{type:"undefined"};if("array"===e.type){var t;if(0===e.values.length)return{type:"undefined"};const n={type:"array",values:(0,y().U)(e).values.filter((e=>"undefined"!==e.type))};if(!k(n)){const e=r().oE(n.values.map((e=>{if("array"!==e.type)return{type:"text",value:(0,y().Ht)(e)}})));return{type:"array",values:e}}return"function"===(null===(t=n.values[0])||void 0===t?void 0:t.type)?{type:"undefined"}:n}return e}function k(e){return 0===e.values.length||e.values.every((t=>t.type===e.values[0].type))}const T=new WeakMap;function M(e){const{blockModel:t,collectionVersion:n,propertyId:r,thunkCallback:a}=e,o=T.get(t),s={collectionVersion:n,thunkCallback:a};void 0===o?T.set(t,{[r]:s}):o[r]=s}function w(e){const{blockModel:t,collectionVersion:n,propertyId:r}=e,a=T.get(t),o=null==a?void 0:a[r];return o?o.collectionVersion!==n?void delete a[r]:o.thunkCallback:void 0}function N({schema:e,property:t,blockModel:n,getRecordModel:r,intl:a,userTimeZone:s,depth:u,resultCache:p,regExpCache:l,formatDateCache:d,formulaTimeoutTimestampMs:c,visitedProperties:y,formula2Error:h,experimentService:v,shouldUsePersistedDates_ONLY_LEGACY_FORMULAS:x,collectionFeatureGates:g,spaceIdCreator:b}){const k=e[t];if("v2"===k.version){if(!k.formula2)return;const e=f({block:n,property:t,formulaCode:k.formula2.code,getRecordModel:r,intl:a,userTimeZone:s,depth:u,visitedProperties:y??new Set,formulaTimeoutTimestampMs:c,formula2Error:h,resultCache:p,regExpCache:l,formatDateCache:d,experimentService:v,collectionFeatureGates:g,spaceIdCreator:b});if(!e)return;return"date"===e.type?x?e.value:(0,i().ZF)({value:e.value,userTimeZone:s,intl:a,allowRelativeDates:!1}):(0,o().R2)({result:e,getRecordModel:r,userTimeZone:s,intl:a})}{const{formula:o}=k;if(o)return(0,m().L7)({schema:e,property:t,block:n,getRecordModel:r,collectionRequestContext:{userId:void 0,userTimeZone:s,depth:u,intl:a,resultCache:p,regExpCache:l,formatDateCache:d,visitedProperties:y??new Set,formulaTimeoutTimestampMs:c,experimentService:v,collectionFeatureGates:g},formula2Error:h,spaceIdCreator:b})}}function I({resultCache:e,blockId:t,property:n,value:r}){const a=e.get(t)??new Map;a.set(`${n}:${s().A.FormulaValue2}`,r),e.set(t,a)}function E({resultCache:e,blockId:t,property:n}){var r;return null===(r=e.get(t))||void 0===r?void 0:r.get(`${n}:${s().A.FormulaValue2}`)}},373907:(e,t,n)=>{n.d(t,{$t:()=>f,BC:()=>m,nM:()=>c,tP:()=>l});n(16280),n(944114),n(898992),n(354520);var r=()=>n(534177),a=()=>n(165358),o=()=>n(958970),s=()=>n(247331),i=()=>n(106714),u=()=>n(44907),p=()=>n(349835);function l(e,t){const n=(0,u().p8)(),r=(0,u().TM)(n).tokenize(e),o=[];for(const a of r.errors)o.push((0,u().Q7)(a));for(const a of r.tokens.filter((e=>e.tokenType===n.UnclosedStringLiteral||e.tokenType===n.UnclosedComment)))o.push({type:a.tokenType===n.UnclosedStringLiteral?p().M9.UnclosedStringLiteral:p().M9.UnclosedComment,offset:t?(0,i().c3)(t,a.startOffset,"left"):a.startOffset});for(const a of r.tokens.filter((e=>e.tokenType===n.StringLiteral)))s().FORMULA_TOKEN_REGEX.test(a.image)&&o.push({type:p().M9.StringLiteralContainsToken,offset:t?(0,i().c3)(t,a.startOffset,"left"):a.startOffset});try{const e=(0,u()._M)(n);e.input=r.tokens;const t=e.expression();for(const n of e.errors)o.push((0,u().Ps)(n));return[t,o]}catch(l){if(l instanceof RangeError&&"Maximum call stack size exceeded"===l.message)o.push({type:p().M9.TooDeeplyNested,offset:0});else{const e=l instanceof Error?l:new Error("Unknown parsing error");a().log({level:"error",from:"parseFormulaInputToCst",type:"formulaParserUnexpectedError",error:e}),o.push({type:p().M9.UnexpectedError,offset:0,error:e})}return[{name:"",children:{}},o]}}const d=new WeakMap;class c{constructor(){this.debug=!1}logCacheResult(e,t){this.incrMetric(t?"formulas.parsing.weak_map_cache.hit":"formulas.parsing.weak_map_cache.miss")}incrMetric(e){this.debug&&console.log(e),this.incrMetricImpl(e)}}let y;function m(e){y||(y=e())}function f(e){var t;let n=d.get(e);if(null===(t=y)||void 0===t||t.logCacheResult(e,(0,r().O9)(n)),void 0!==n)return n;const[a,s]=(0,i().kb)(e),[u,p]=l(a);return n=p.length>0?{error:p[0]}:(0,o().f)(u),(0,r().O9)(e)&&d.set(e,n),n}},383969:(e,t,n)=>{n.d(t,{L7:()=>g,NI:()=>w,by:()=>I,ws:()=>k});n(16280),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(581454);var r=()=>n(496603),a=()=>n(534177),o=()=>n(764880),s=()=>n(302322),i=()=>n(713998),u=()=>n(568063),p=()=>n(632905),l=()=>n(597777),d=()=>n(869190),c=()=>n(604995),y=()=>n(792071),m=()=>n(201980),f=()=>n(80979),h=()=>n(349835),v=()=>n(565775);const x=15;function g(e){const{schema:t,property:n,block:o,getRecordModel:s,collectionRequestContext:i,formula2Error:u,spaceIdCreator:d}=function(e){return"getRecordModel"in e?e:{...e,block:y().Bj6.fromBlock(e.block),getRecordModel:y().b4_.fromGetRecordValueFn(e.getRecordValue)}}(e),{depth:c,resultCache:m,visitedProperties:f,formulaTimeoutTimestampMs:v,logFormulaTimeoutFn:g}=i,k=t[n];if(!k||"formula"!==k.type||!k.formula)return;const{formula:T}=k;if(c>x)return void(null===(null==u?void 0:u.error)&&(u.error=new(h().I3)({type:h().uW.DepthExceeded})));const M=`${o.id}:${n}`;if(f.has(M))return void(null===(null==u?void 0:u.error)&&(u.error=new(h().I3)({type:h().uW.CycleDetected})));const w=function({resultCache:e,blockId:t,property:n}){var r;return null===(r=e.get(t))||void 0===r?void 0:r.get(`${n}:${p().A.FormulaValue}`)}({resultCache:m,blockId:o.id,property:n});if(void 0!==w)return w;if(v&&Date.now()>v)return g&&g(),void(null===(null==u?void 0:u.error)&&(u.error=new(h().I3)({type:h().uW.MaxEvaluationTimeExceeded})));const N=new Set(f);N.add(M);try{let e=b({formula:T,schema:t,block:o,getRecordModel:s,collectionRequestContext:{...i,visitedProperties:N},formula2Error:u,spaceIdCreator:d});if(!("date"!==T.result_type||(0,a().Gv)(e)&&(0,l().cW)(e.type)))return;if(r().Et(e)){if(!r().MI(e))return;e=r().LI(e,12)}return function({resultCache:e,blockId:t,property:n,value:r}){const a=e.get(t)??new Map;a.set(`${n}:${p().A.FormulaValue}`,r),e.set(t,a)}({resultCache:m,blockId:o.id,property:n,value:e}),e}catch(I){console.error(I)}}function b(e){const{formula:t,schema:n,block:r,getRecordModel:a,collectionRequestContext:o,formula2Error:s,spaceIdCreator:i}=function(e){return"getRecordModel"in e?e:{...e,block:y().Bj6.fromBlock(e.block),getRecordModel:y().b4_.fromGetRecordValueFn(e.getRecordValue)}}(e),{userTimeZone:u,intl:p}=o;if("conditional"===t.type)return b({formula:t.condition,schema:n,block:r,getRecordModel:a,collectionRequestContext:o,formula2Error:s,spaceIdCreator:i})?b({formula:t.true,schema:n,block:r,getRecordModel:a,collectionRequestContext:o,formula2Error:s,spaceIdCreator:i}):b({formula:t.false,schema:n,block:r,getRecordModel:a,collectionRequestContext:o,formula2Error:s,spaceIdCreator:i});if("constant"===t.type){const{value:e,value_type:n}=t;return"string"===n?e:"number"===n?parseFloat(e):"boolean"===n?Boolean(JSON.parse(e)):void 0}if("function"===t.type){const{args:e}=t,l=(e||[]).map((e=>b({formula:e,schema:n,block:r,getRecordModel:a,collectionRequestContext:o,formula2Error:s,spaceIdCreator:i}))),d=v().N9(t.name),c=v().F5(t.name);return d?d.apply(l,u,p,r):c?c.apply(l,u,p,r):void 0}if("property"===t.type)return k({property:t.id,schema:n,block:r,getRecordModel:a,collectionRequestContext:o,formula2Error:s,spaceIdCreator:i});if("operator"===t.type){const{args:e,name:l}=t,d=(e||[]).map((e=>b({formula:e,schema:n,block:r,getRecordModel:a,collectionRequestContext:o,formula2Error:s,spaceIdCreator:i}))),c=v().F5(l);if(!c)return;return c.apply(d,u,p,r)}if("symbol"===t.type){const{name:e}=t;if(e in v().AA)return v().AA[e].value}}function k(e){const t=function(e){return"getRecordModel"in e?e:{...e,block:y().Bj6.fromBlock(e.block),getRecordModel:y().b4_.fromGetRecordValueFn(e.getRecordValue)}}(e),{property:n,schema:r}=t,a=r[n];if(a)return N[a.type](t)}function T(e){const{property:t,block:n}=e,r=i().yQ(n,t)||[];return m().k4p(r)}function M(e){const{property:t,block:n}=e,r=i().yQ(n,t)||[];return i().MO(r)}function w(e){const{timestampType:t,block:n,userTimeZone:r}=e;if("created_time"===t){if(n.getCreatedTime())return c().KQ(n.getCreatedTime(),r)}else if("last_edited_time"===t){if(n.getLastEditedTime())return c().KQ(n.getLastEditedTime(),r)}else(0,a().HB)(t)}const N={title:T,text:T,url:M,email:M,phone_number:M,select:({property:e,schema:t,block:n})=>{const r=i().yQ(n,e)||[],a=t[e].options||[];return i().L3(r,a)},multi_select:({property:e,schema:t,block:n})=>{const r=i().yQ(n,e)||[],a=t[e].options||[];return i().o2(r,a).join(", ")},status:({property:e,schema:t,block:n})=>{const r=i().yQ(n,e)||[],a=t[e];return i().RZ(r,a)},checkbox:({property:e,block:t})=>{const r=i().yQ(t,e)||[];return(0,n(657970).w)(r)},date:({property:e,block:t})=>{const r=i().yQ(t,e)||[];return(0,n(187696).b)(r)},person:({property:e,block:t,getRecordModel:r,schema:a,collectionRequestContext:s})=>{const{intl:u}=s,p=i().yQ(t,e)||[],l=a[e],d=y().Bj6.fromBlock(t);return(0,n(363170).e)({textValue:p,propertySchema:l,blockCreatorPointer:d.getCreatedByPointer(),convertGroupPointersToBeComposite:!0}).map((e=>{if(e.table===n(437607).n){const t=r(e);return(0,n(914462).n)({intl:u,permissionGroupModel:t})}return(0,o().lR)(u,(0,o().xC)({pointer:e,getRecordModel:r}))})).join(", ")},relation:({property:e,block:t,getRecordModel:n,schema:r})=>{const a=i().yQ(t,e)||[],o=r[e];if(!o||"relation"!==o.type)return;return i().bG({relationValue:i().n(a),propertySchema:o,getRecordModel:n,includeNoAccess:!1}).map((e=>{const t=n(e);if(!t)return;const r=i().yQ(t,"title");return r?m().k4p(r):void 0})).join(", ")},rollup:e=>{const{property:t,schema:n,block:r,getRecordModel:o,collectionRequestContext:s,spaceIdCreator:i}=e,p=n[t];if(!p||"rollup"!==p.type||!p.aggregation||"show_unique"===p.aggregation)return u().I({property:t,schema:n,block:r,getRecordModel:o,collectionRequestContext:s,formulasModule:f(),spaceIdCreator:i});{const e=u().Pm({property:t,schema:n,block:r,getRecordModel:o,collectionRequestContext:s,formulasModule:f(),spaceIdCreator:i});if(void 0===e)return;if("text"===e.type)return e.value;if("number"===e.type)return e.value;if("date"===e.type)return e.value;(0,a().HB)(e)}},number:({property:e,block:t})=>{const n=i().yQ(t,e)||[];return(0,s().M)(n)},file:({property:e,block:t})=>{const n=i().yQ(t,e)||[];return i().pJ(n).map((({url:e})=>e)).join(", ")},formula:e=>{const{intl:t,userTimeZone:r,formulaTimeoutTimestampMs:a,depth:o,visitedProperties:s,collectionFeatureGates:i}=e.collectionRequestContext;return"v2"===e.schema[e.property].version?(0,n(342581).LO)({schema:e.schema,property:e.property,blockModel:e.block,getRecordModel:e.getRecordModel,intl:t,userTimeZone:r,depth:o+1,formulaTimeoutTimestampMs:a,visitedProperties:s,formula2Error:e.formula2Error,resultCache:e.collectionRequestContext.resultCache,regExpCache:e.collectionRequestContext.regExpCache,formatDateCache:e.collectionRequestContext.formatDateCache,experimentService:e.collectionRequestContext.experimentService,shouldUsePersistedDates_ONLY_LEGACY_FORMULAS:!0,collectionFeatureGates:i,spaceIdCreator:e.spaceIdCreator}):g({...e,collectionRequestContext:{...e.collectionRequestContext,depth:e.collectionRequestContext.depth+1}})},created_time:({block:e,collectionRequestContext:t})=>{const{userTimeZone:n}=t,r=y().Bj6.fromBlock(e);if(r.getCreatedTime())return c().KQ(r.getCreatedTime(),n)},last_edited_time:({block:e,collectionRequestContext:t})=>{const{userTimeZone:n}=t,r=y().Bj6.fromBlock(e);if(r.getLastEditedTime())return c().KQ(r.getLastEditedTime(),n)},created_by:({block:e,getRecordModel:t,collectionRequestContext:n})=>{const{intl:r}=n,a=y().Bj6.fromBlock(e).getCreatedByPointer();if(a)return(0,o().lR)(r,(0,o().xC)({pointer:a,getRecordModel:t}));const s=a&&t(a);return(0,o().lR)(r,s)},last_edited_by:({block:e,getRecordModel:t,collectionRequestContext:n})=>{const{intl:r}=n,a=y().Bj6.fromBlock(e).getLastEditedByPointer();if(a)return(0,o().lR)(r,(0,o().xC)({pointer:a,getRecordModel:t}))},button:()=>"",location:()=>"",last_visited_time:()=>"",auto_increment_id:({property:e,block:t})=>{const n=i().yQ(t,e)||[];return(0,s().M)(n)},verification:()=>{},place:T};function I(e){const{schema:t,property:n,collectionRequestContext:a}=e,{userTimeZone:o,intl:s}=a,i=k(e),u=t[n];if(!u)throw new Error("Property not found");if(r().Et(i)){if(!r().MI(i))return;return i.toString()}return"boolean"==typeof i?i.toString():l().kC(i)?"date"===u.type?(0,d().ZF)({value:i,userTimeZone:o,allowRelativeDates:!1,intl:s}):void 0:i}},420062:(e,t,n)=>{n.d(t,{Jb:()=>d,lg:()=>u,sr:()=>i});n(16280),n(581454);var r=()=>n(681873),a=()=>n(201980),o=()=>n(565775),s=()=>n(628048);const i={slice:"substring",start:"dateStart",end:"dateEnd"},u={unaryMinus:"-",unaryPlus:"+",larger:">",largerEq:">=",smaller:"<",smallerEq:"<="},p=["add","subtract","multiply","divide","pow","mod","equal","unequal","larger","largerEq","smaller","smallerEq"];function l(e,t,n){return r=e,a=d(e,t,n),"conditional"===r.type||"function"===r.type&&(p.includes(r.name)||["unaryPlus","unaryMinus"].includes(r.name))||"operator"===r.type&&void 0!==r.args&&r.args.length>=2?[["("],...a,[")"]]:a;var r,a}function d(e,t,n){switch(e.type){case"conditional":return[["if("],...l(e.condition,t,n),[", "],...l(e.true,t,n),[", "],...l(e.false,t,n),[")"]];case"constant":switch(e.value_type){case"number":return(0,a().x9d)(`${e.value}`);case"string":const t=e.value.replace(/\n/g,"\\n").replace(/"/g,'\\"').replace(/\t/g,"\\t");return(0,a().x9d)(`"${t}"`);case"boolean":return(0,a().x9d)(""+(e.value?"true":"false"));default:throw new Error(`unexpected constant type: ${e.value_type}`)}case"function":if(p.includes(e.name)){const r="equal"===e.name?"==":"concat"===e.name?"+":o().II[e.name].operator;return[...l(e.args[0],t,n),[` ${r} `],...l(e.args[1],t,n)]}switch(e.name){case"unaryMinus":return[["-"],...l(e.args[0],t,n)];case"unaryPlus":return[["toNumber("],...d(e.args[0],t,n),[")"]];case"month":return[["month("],...d(e.args[0],t,n),[") - 1"]];case"day":return[["day("],...d(e.args[0],t,n),[") % 7"]];case"concat":return[["("],...(0,r().G)((e.args??[]).map((e=>d(e,t,n))),(()=>[[" + "]])).flat(),[")"]];case"join":return[["join("],["["],...(0,r().G)((e.args??[]).slice(1).map((e=>d(e,t,n))),(()=>[[", "]])).flat(),["]"],[", "],...d(e.args[0],t,n),[")"]];default:if("id"===e.name)return(0,a().x9d)("id()");const o=i[e.name]??e.name;if(void 0===s().LP[o])throw new Error(`unexpected formula: ${o}`);return[[`${o}(`],...(0,r().G)((e.args??[]).map((e=>d(e,t,n))),(()=>[[", "]])).flat(),[")"]]}case"operator":var u,c;if(1===(null===(u=e.args)||void 0===u?void 0:u.length))switch(e.operator){case"not":return[["!"],...l(e.args[0],t,n)];case"+":return[["toNumber("],...d(e.args[0],t,n),[")"]];default:return[[`${e.operator}`],...l(e.args[0],t,n)]}if(2===(null===(c=e.args)||void 0===c?void 0:c.length))return[...l(e.args[0],t,n),[` ${e.operator} `],...l(e.args[1],t,n)];if("?"===e.operator)return[...l(e.args[0],t,n),[" ? "],...l(e.args[0],t,n),[" : "],...l(e.args[0],t,n)];throw new Error(`unhandled operator: ${e.operator}`);case"symbol":switch(e.name){case"pi":return(0,a().x9d)("pi()");case"e":return(0,a().x9d)("e()");case"true":return(0,a().x9d)("true");case"false":return(0,a().x9d)("false");default:throw new Error(`unexpected constant: ${e.name}`)}case"property":{const r=n[e.id];if(void 0===r)return[[e.name]];const o=(0,a().wmz)((0,a().ESw)({collection:t,property:e.id,name:r.name}));switch(r.type){case"person":case"relation":return[["join(map("],o,[', format(current)), ", ")']];case"rollup":return r.aggregation&&"show_unique"!==r.aggregation?[o]:[["join(map("],o,[', format(current)), ",")']];case"file":case"multi_select":return[["join("],o,[', ", ")']];case"auto_increment_id":return[o,[".split('-').last().toNumber()"]];default:return[o]}}case"error":throw new Error("unexpected formula error node")}}},488660:(e,t,n)=>{n.d(t,{PX:()=>g,Ox:()=>M,RE:()=>N,Xs:()=>E,YQ:()=>I});n(18107),n(944114),n(967357),n(898992),n(823215),n(672577),n(581454),n(737550);var r=()=>n(763824),a=()=>n(534177),o=()=>n(696706),s=()=>n(179034),i=()=>n(437607),u=()=>n(798880),p=()=>n(349835);function l(e){if(e.kind===p().NM.Boolean||e.kind===p().NM.LogicalAnd||e.kind===p().NM.LogicalOr||e.kind===p().NM.Relational||e.kind===p().NM.Equality)return"checkbox";if(e.kind===p().NM.Number||e.kind===p().NM.Additive||e.kind===p().NM.Exponentiation||e.kind===p().NM.Multiplicative)return"number";if(e.kind===p().NM.String)return"text";if(e.kind===p().NM.Array)return"array";if(e.kind===p().NM.Unary){if("-"===e.op)return"number";if("!"===e.op||"not"===e.op)return"checkbox";(0,a().HB)(e.op)}else{if(e.kind===p().NM.Call||e.kind===p().NM.Conditional||e.kind===p().NM.Identifier||e.kind===p().NM.MemberBlockProperty||e.kind===p().NM.NotionToken||e.kind===p().NM.UnifiedFunctionProperty||e.kind===p().NM.RecoveryNode)return"undefined";(0,a().HB)(e)}}var d=()=>n(96033),c=()=>n(247331),y=()=>n(3259),m=()=>n(662358),f=()=>n(239381),h=()=>n(628048);const v=new WeakMap;function x(e,t){const n=v.get(t);if(n)return n;const r=b(e,t);return v.set(t,r),r}function g(e,t){return(0,m().O9)(void 0,(()=>x(e,t)))}function b(e,t){switch(t.kind){case p().NM.Number:return[{type:"loadConstant",node:t,value:{type:"number",value:parseFloat(t.text)}}];case p().NM.String:return[{type:"loadConstant",node:t,value:{type:"text",value:[[t.text]]}}];case p().NM.Boolean:return[{type:"loadConstant",node:t,value:{type:"checkbox",value:"true"===t.text.toLowerCase()}}];case p().NM.NotionToken:{const e=t.token;switch(e.type){case c().FormulaTokenType.Checkbox:return[{type:"loadConstant",node:t,value:{type:"checkbox",value:e.checked}}];case c().FormulaTokenType.BlockProperty:return[{type:"loadToken",node:t,token:e}];case c().FormulaTokenType.Block:return[{type:"loadConstant",node:t,value:{type:"block",value:{table:s().ev,id:e.blockId,spaceId:e.spaceId}}}];case c().FormulaTokenType.ContextValue:return[{type:"loadToken",node:t,token:e}];case c().FormulaTokenType.Date:return[{type:"loadConstant",node:t,value:{type:"date",value:e.date}}];case c().FormulaTokenType.Person:{const n=e.personInfo;return"user"===n.personTokenType?[{type:"loadConstant",node:t,value:{type:"person",value:{table:u().oo,id:n.userId}}}]:"group"===n.personTokenType?[{type:"loadConstant",node:t,value:{type:"person",value:{table:i().n,id:n.groupId,spaceId:n.spaceId}}}]:(0,a().HB)(n)}default:return(0,a().HB)(e)}}case p().NM.Additive:return[...b(e,t.rhs),...b(e,t.lhs),{type:"add",node:t}];case p().NM.Multiplicative:return[...b(e,t.rhs),...b(e,t.lhs),{type:"multiply",node:t}];case p().NM.Equality:return[...b(e,t.rhs),...b(e,t.lhs),{type:"equality",node:t}];case p().NM.Relational:return[...b(e,t.rhs),...b(e,t.lhs),{type:"relational",node:t}];case p().NM.Exponentiation:return[...b(e,t.rhs),...b(e,t.lhs),{type:"exponentiation",node:t}];case p().NM.Unary:return[...b(e,t.expression),{type:"unary",node:t}];case p().NM.Array:{const n=[];for(const r of t.elements.slice().reverse())n.push(...b(e,r));return n.push({type:"makeArray",node:t,numberOfElements:t.elements.length}),n}case p().NM.LogicalAnd:{const n=[];for(const r of t.elements.slice().reverse())n.push(...b(e,r));return n.push({type:"logicalAnd",node:t,numberOfArguments:t.elements.length}),n}case p().NM.LogicalOr:{const n=[];for(const r of t.elements.slice().reverse())n.push(...b(e,r));return n.push({type:"logicalOr",node:t,numberOfArguments:t.elements.length}),n}case p().NM.Call:return function(e,t){const n=[];let r,a;if(t.expression.kind===p().NM.Identifier){if(!h().LP.hasOwnProperty(t.expression.text))throw new(p().I3)({type:p().uW.IdentifierNotFound,node:t.expression});r=t.expression.text,a=t.arguments}else{if(t.expression.kind!==p().NM.UnifiedFunctionProperty)throw new(p().I3)({type:p().uW.CannotCallNonFunction,node:t,calleeType:l(t.expression)});if(!h().LP.hasOwnProperty(t.expression.name))throw new(p().I3)({type:p().uW.UnifiedFunctionPropertyNotFound,node:t.expression});r=t.expression.name,a=[t.expression.expression,...t.arguments]}if("let"===r||"lets"===r)return function(e,t,n,r){if(r.length<3||r.length%2!=1)throw new(p().x4)({type:p().v3.NotEnoughArguments}).toFormulaEvaluatorError(n,h().LP[t]);for(let i=0;i<(r.length-1)/2;i++){const e=r[2*i];if(e.kind!==p().NM.Identifier)throw new(p().x4)({type:p().v3.LetBindingNameNotIdentifier,node:e}).toFormulaEvaluatorError(n,h().LP[t])}const a=[];for(let i=0;i<(r.length-1)/2;i++){const o=r[2*i],u=r[2*i+1];if(o.kind!==p().NM.Identifier)throw new(p().x4)({type:p().v3.LetBindingNameNotIdentifier,node:o}).toFormulaEvaluatorError(n,h().LP[t]);let l;try{l=b(e,u)}catch(s){C(s),l=[{type:"loadConstant",node:u,value:{type:"undefined"}}]}a.push([o.text,l])}const o=b(e,r.at(-1));return[{type:"runLets",node:n,body:o,bindings:a}]}(e,r,t,a);if("if"===r||"ifs"===r)return k(e,r,t,a);if(e.disabledFunctions.includes(r))throw t.expression.kind===p().NM.Identifier?new(p().I3)({type:p().uW.IdentifierNotFound,node:t.expression}):new(p().I3)({type:p().uW.UnifiedFunctionPropertyNotFound,node:t.expression});const o=h().LP[r],s=(0,f().ab)(o);if(a.length<s)throw new(p().I3)({type:p().uW.FunctionCallTooFewArguments,node:t,libraryFunction:o,numArguments:a.length});const i=a.map(((n,r)=>{const a=(0,f().Pf)(o,r);if(void 0===a)throw new(p().I3)({type:p().uW.FunctionCallUnexpectedArgument,node:t,argument:n,libraryFunction:o,parameterIndex:r});return Array.isArray(a.type)||"expression"!==a.type.type?b(e,n):[{type:"loadConstant",node:n,value:{type:"compiledCode",instructions:b(e,n)}}]}));return n.push(...i.reverse().flat()),n.push({type:"callLibraryFunction",node:t,libraryFunction:o,numberOfArguments:a.length,argumentNodes:a}),n}(e,t);case p().NM.Identifier:return[{type:"loadName",node:t,name:t.text}];case p().NM.Conditional:return k(e,"if",t,[t.condition,t.expIfTrue,(0,d().o9)(t.expIfFalse)]);case p().NM.UnifiedFunctionProperty:throw new(d().VD)("UnifiedFunctionProperty node should be wrapped in a Call node.");case p().NM.RecoveryNode:throw new(p().I3)({type:p().uW.UnexpectedRecoveryNode,recovery:t});case p().NM.MemberBlockProperty:return[...b(e,t.expression),{type:"loadMemberBlockProperty",node:t,propertyToken:t.propertyToken}];default:(0,a().HB)(t)}}function k(e,t,n,r){const a="if"===t?3:2;if(r.length<a)throw new(p().I3)({type:p().uW.FunctionCallTooFewArguments,node:n,libraryFunction:h().LP[t],numArguments:r.length});if("if"===t&&3!==r.length){const e=r.at(-1);throw new(p().I3)({type:p().uW.FunctionCallUnexpectedArgument,node:n,argument:e,libraryFunction:h().LP[t],parameterIndex:r.length-1})}return function t(r){r=[...r];const a=[];a.push(...b(e,(0,d().o9)(r.shift())));const o=b(e,(0,d().o9)(r.shift()));let s;return s=1===r.length?b(e,(0,d().o9)(r.shift())):0===r.length?[{node:n,type:"loadConstant",value:{type:"undefined"}}]:t(r),a.push({node:n,type:"relativeJumpIfTrue",offset:s.length+1}),a.push(...s),a.push({node:n,type:"relativeJump",offset:o.length}),a.push(...o),a}(r)}class T{constructor(){this.underlying=[]}push(e){this.underlying.push(e)}popValueOrCode(){return(0,d().o9)(this.underlying.pop())}popValue(){return(0,d().F$)(this.popValueOrCode())}}function M(e){var t;return{disabledFunctions:(null===(t=e.collectionFeatureGates)||void 0===t?void 0:t.formulas_disabled_functions)??[]}}function w(e,t){return N(x(M(t),e),t)}function*N(e,t){const n=new T;let r=0;for(;r<e.length;){const u=e[r];if(r++,"loadConstant"===u.type)n.push(u.value);else if("add"===u.type){const{node:e}=u,t=n.popValue(),r=n.popValue();n.push((0,m().LL)(e,t,r))}else if("multiply"===u.type){const{node:e}=u,t=n.popValue(),r=n.popValue();n.push((0,m().Rn)(e,t,r))}else if("equality"===u.type){const{node:e}=u,r=n.popValue(),o=n.popValue(),s=yield*(0,f().zV)(r,o,t),i=e.op;"=="===i?n.push({type:"checkbox",value:s}):"!="===i?n.push({type:"checkbox",value:!s}):(0,a().HB)(i)}else if("logicalAnd"===u.type){const e=[];for(let r=0;r<u.numberOfArguments;r++)e.push(n.popValue());const t=e.map(f().CL);n.push({type:"checkbox",value:t.every((e=>e))})}else if("logicalOr"===u.type){const e=[];for(let r=0;r<u.numberOfArguments;r++)e.push(n.popValue());const t=e.map(f().CL);n.push({type:"checkbox",value:t.some((e=>e))})}else if("makeArray"===u.type){const e=[];for(let t=0;t<u.numberOfElements;t++)e.push(n.popValue());n.push({type:"array",values:e})}else if("relational"===u.type){const{node:e}=u,r=n.popValue(),a=n.popValue();n.push(yield*(0,m().MA)(e,r,a,t))}else if("exponentiation"===u.type){const{node:e}=u,t=n.popValue(),r=n.popValue();n.push((0,m().oj)(e,t,r))}else if("unary"===u.type){const{node:e}=u,t=n.popValue();n.push((0,m().If)(e,t))}else if("callLibraryFunction"===u.type){const{libraryFunction:e}=u,r=[];for(let t=0;t<u.numberOfArguments;t++){let o=n.popValueOrCode();if("compiledCode"!==o.type){const n=(0,f().Pf)(e,t);(0,a().O9)(n)&&(o=(0,m().qL)({value:o,callNode:u.node,argumentNode:u.argumentNodes[t],parameterIndex:t,libraryFunction:e,expectedParameter:n}))}r.push(o)}try{n.push(yield*e.eval(r,t))}catch(i){if(i instanceof p().I3)throw i;throw new(p().I3)({type:p().uW.LibraryFunctionExecutionError,node:u.node,libraryFunction:e,error:i})}}else if("loadToken"===u.type){const{node:e,token:r}=u;r.type===c().FormulaTokenType.BlockProperty?n.push(yield*(0,m().ir)({node:e,token:r,context:t,evaluateAST:w})):r.type===c().FormulaTokenType.ContextValue?n.push((0,m().ym)({node:e,token:r,context:t})):(0,a().HB)(r)}else if("runLets"===u.type){const e={...t};for(const[t,n]of u.bindings){let r;try{r=yield*N(n,e)}catch(i){C(i),r={type:"undefined"}}e.values=[{kind:c().FormulaContextValueKind.Binding,id:t,value:r},...e.values]}n.push(yield*N(u.body,e))}else if("relativeJump"===u.type)r+=u.offset;else if("relativeJumpIfTrue"===u.type){const e=n.popValue();(0,f().CL)(e)&&(r+=u.offset)}else if("loadName"===u.type){var s;const{name:e,node:r}=u,a=null===(s=t.values.find((t=>t.kind===c().FormulaContextValueKind.Binding&&t.id===e)))||void 0===s?void 0:s.value;if(void 0!==a)n.push(a);else{if(!h().LP.hasOwnProperty(e))throw new(p().I3)({type:p().uW.IdentifierNotFound,node:r});n.push({type:"function",function:h().LP[e]})}}else if("loadMemberBlockProperty"===u.type){const{node:e,propertyToken:r}=u,a=n.popValue();if("undefined"===a.type)n.push({type:"undefined"});else{if("block"!==a.type)throw new(p().I3)({type:p().uW.AccessingPropertyOnNonBlock,node:e,expressionValue:a});{const s=(yield{recordPointers:[a.value]}).getRecordModel(a.value);if(void 0===s)throw new(p().I3)({type:p().uW.MissingDataDependencyBlock,node:e,blockPointer:a.value});if(void 0===r.collection)n.push((0,f().ve)(s,r.property));else{const{collectionPointer:a,schema:i}=yield*(0,m().OH)(s,t);if(!a)throw new(p().I3)({type:p().uW.MissingDataDependencyBlock,node:e,blockPointer:s.pointer});if(!(0,o().Z2)(r.collection,a))throw new(p().I3)({type:p().uW.MemberPropertyMismatchCollection,node:e,blockCollection:a});const u=(0,f().Yi)(r.property),l=null==i?void 0:i[u];if(void 0===l||void 0===i)throw new(p().I3)({type:p().uW.MissingPropertyOnSchemaForMemberProperty,node:e});n.push(yield*(0,m().PR)({block:s,property:u,parentCollectionPointer:a,schema:i,propertySchema:l,oldContext:t,evaluateAST:w}))}}}}else(0,a().HB)(u);if(t.depth>c().FORMULA_MAX_DEPTH)throw new(p().I3)({type:p().uW.DepthExceeded});if(t.formulaTimeoutTimestampMs&&Date.now()>t.formulaTimeoutTimestampMs)throw t.logFormulaTimeoutFn&&t.logFormulaTimeoutFn(),new(p().I3)({type:p().uW.MaxEvaluationTimeExceeded})}return n.popValue()}function I(e,t,n){return(0,m().O9)(n,(()=>{t.formulaTimeoutTimestampMs=t.formulaTimeoutTimestampMs??Date.now()+m().qU;const n=N(e,t);let r=n.next();for(;!r.done;){const e={...r.value,formulaEvaluationId:t.formulaEvaluationId},a=t.handleDataRequest(e);r=n.next(a)}if(t.allowedValueTypes&&!(0,y().qQ)(r.value,t.allowedValueTypes))throw new(p().I3)({allowedValueTypes:t.allowedValueTypes,expressionValue:r.value,type:p().uW.DisallowedValueType});return(0,m().rb)(r.value)}))}async function E(e,t,n){return(0,m().dt)(n,(async()=>{t.formulaTimeoutTimestampMs=t.formulaTimeoutTimestampMs??Date.now()+m().qU;const n=performance.now();let a=0;const o=N(e,t);let s=o.next();for(;!s.done;){const e={...s.value,formulaEvaluationId:t.formulaEvaluationId},n=t.handleDataRequest(e);let i;if((0,r().yL)(n)){const e=performance.now();i=await n,a+=performance.now()-e}else i=n;s=o.next(i)}if(t.allowedValueTypes&&!(0,y().qQ)(s.value,t.allowedValueTypes))throw new(p().I3)({allowedValueTypes:t.allowedValueTypes,expressionValue:s.value,type:p().uW.DisallowedValueType});const i=performance.now()-n-a;return{value:(0,m().rb)(s.value),formulaEvaluationStats:{syncEvaluationTimeMs:i}}}))}function C(e){if(e instanceof p().I3&&e.info.type===p().uW.DepthExceeded)throw e}},565775:(e,t,n)=>{n.d(t,{AA:()=>l,F5:()=>g,II:()=>k,N9:()=>T});n(898992),n(581454),n(737550);var r=()=>n(498212),a=()=>n(720665),o=()=>n(597777),s=()=>n(604995);const i=(0,n(69708).YK)({e:{id:"database.formula.constant.e.description",defaultMessage:"The base of the natural logarithm."},pi:{id:"database.formula.constant.pi.description",defaultMessage:"The ratio of a circles circumference to its diameter."},if:{id:"database.formula.operator.if.description",defaultMessage:"Switches between two options based on another value."},add:{id:"database.formula.operator.add.description",defaultMessage:"Adds two numbers and returns their sum, or concatenates two strings."},subtract:{id:"database.formula.operator.subtract.description",defaultMessage:"Subtracts two numbers and returns their difference."},multiply:{id:"database.formula.operator.multiply.description",defaultMessage:"Multiplies two numbers and returns their product."},divide:{id:"database.formula.operator.divide.description",defaultMessage:"Divides two numbers and returns their quotient."},pow:{id:"database.formula.operator.pow.description",defaultMessage:"Returns base to the exponent power, that is, baseexponent."},mod:{id:"database.formula.operator.mod.description",defaultMessage:"Divides two numbers and returns their remainder."},unaryMinus:{id:"database.formula.operator.unaryMinus.description",defaultMessage:"Negates a number."},unaryPlus:{id:"database.formula.operator.unaryPlus.description",defaultMessage:"Converts its argument into a number."},not:{id:"database.formula.operator.not.description",defaultMessage:"Returns the logical NOT of its argument."},and:{id:"database.formula.operator.and.description",defaultMessage:"Returns the logical AND of its two arguments."},or:{id:"database.formula.operator.or.description",defaultMessage:"Returns the logical OR of its two arguments."},equal:{id:"database.formula.operator.equal.description",defaultMessage:"Returns true if its arguments are equal, and false otherwise."},unequal:{id:"database.formula.operator.unequal.description",defaultMessage:"Returns false if its arguments are equal, and true otherwise."},larger:{id:"database.formula.operator.larger.description",defaultMessage:"Returns true if the first argument is larger than the second."},largerEq:{id:"database.formula.operator.largerEq.description",defaultMessage:"Returns true if the first argument is larger than or equal to than the second."},smaller:{id:"database.formula.operator.smaller.description",defaultMessage:"Returns true if the first argument is smaller than the second."},smallerEq:{id:"database.formula.operator.smallerEq.description",defaultMessage:"Returns true if the first argument is smaller than or equal to than the second."},concat:{id:"database.formula.function.concat.description",defaultMessage:"Concatenates its arguments and returns the result."},join:{id:"database.formula.function.join.description",defaultMessage:"Inserts the first argument between the rest and returns their concatenation."},slice:{id:"database.formula.function.slice.description",defaultMessage:"Extracts a substring from a string from the start index (inclusively) to the end index (optional and exclusively)."},length:{id:"database.formula.function.length.description",defaultMessage:"Returns the length of a string."},format:{id:"database.formula.function.format.description",defaultMessage:"Formats its argument as a string."},toNumber:{id:"database.formula.function.toNumber.description",defaultMessage:"Parses a number from text."},contains:{id:"database.formula.function.contains.description",defaultMessage:"Returns true if the second argument is found in the first."},replace:{id:"database.formula.function.replace.description",defaultMessage:"Replaces the first match of a regular expression with a new value."},replaceAll:{id:"database.formula.function.replaceAll.description",defaultMessage:"Replaces all matches of a regular expression with a new value."},test:{id:"database.formula.function.test.description",defaultMessage:"Tests if a string matches a regular expression."},empty:{id:"database.formula.function.empty.description",defaultMessage:"Tests if a value is empty."},abs:{id:"database.formula.function.abs.description",defaultMessage:"Returns the absolute value of a number."},cbrt:{id:"database.formula.function.cbrt.description",defaultMessage:"Returns the cube root of a number."},ceil:{id:"database.formula.function.ceil.description",defaultMessage:"Returns the smallest integer greater than or equal to a number."},exp:{id:"database.formula.function.exp.description",defaultMessage:"Returns E^x, where x is the argument, and E is Eulers constant (2.718), the base of the natural logarithm."},floor:{id:"database.formula.function.floor.description",defaultMessage:"Returns the largest integer less than or equal to a number."},ln:{id:"database.formula.function.ln.description",defaultMessage:"Returns the natural logarithm of a number."},log10:{id:"database.formula.function.log10.description",defaultMessage:"Returns the base 10 logarithm of a number."},log2:{id:"database.formula.function.log2.description",defaultMessage:"Returns the base 2 logarithm of a number."},max:{id:"database.formula.function.max.description",defaultMessage:"Returns the largest of zero or more numbers."},min:{id:"database.formula.function.min.description",defaultMessage:"Returns the smallest of zero or more numbers."},round:{id:"database.formula.function.round.description",defaultMessage:"Returns the value of a number rounded to the nearest integer."},sign:{id:"database.formula.function.sign.description",defaultMessage:"Returns the sign of the x, indicating whether x is positive, negative or zero."},sqrt:{id:"database.formula.function.sqrt.description",defaultMessage:"Returns the positive square root of a number."},start:{id:"database.formula.function.start.description",defaultMessage:"Returns the start of a date range."},end:{id:"database.formula.function.end.description",defaultMessage:"Returns the end of a date range."},now:{id:"database.formula.function.now.description",defaultMessage:"Returns the current date and time."},timestamp:{id:"database.formula.function.timestamp.description",defaultMessage:"Returns an integer number from a Unix millisecond timestamp, corresponding to the number of milliseconds since January 1, 1970."},fromTimestamp:{id:"database.formula.function.fromTimestamp.description",defaultMessage:"Returns a date constructed from a Unix millisecond timestamp, corresponding to the number of milliseconds since January 1, 1970."},dateAdd:{id:"database.formula.function.dateAdd.description",defaultMessage:"Add to a date. The last argument, unit, can be one of: years, quarters, months, weeks, days, hours, minutes, seconds, or milliseconds."},dateSubtract:{id:"database.formula.function.dateSubtract.description",defaultMessage:"Subtract from a date. The last argument, unit, can be one of: years, quarters, months, weeks, days, hours, minutes, seconds, or milliseconds."},dateBetween:{id:"database.formula.function.dateBetween.description",defaultMessage:"Returns the time between two dates. The last argument, unit, can be one of: years, quarters, months, weeks, days, hours, minutes, seconds, or milliseconds."},formatDate:{id:"database.formula.function.formatDate.description",defaultMessage:"Format a date using the Moment standard time format string."},minute:{id:"database.formula.function.minute.description",defaultMessage:"Returns an integer number, between 0 and 59, corresponding to minutes in the given date."},hour:{id:"database.formula.function.hour.description",defaultMessage:"Returns an integer number, between 0 and 23, corresponding to hour for the given date."},day:{id:"database.formula.function.day.description",defaultMessage:"Returns an integer number corresponding to the day of the week for the given date: 0 for Sunday, 1 for Monday, 2 for Tuesday, and so on."},date:{id:"database.formula.function.date.description",defaultMessage:"Returns an integer number, between 1 and 31, corresponding to day of the month for the given."},month:{id:"database.formula.function.month.description",defaultMessage:"Returns an integer number, between 0 and 11, corresponding to month in the given date according to local time. 0 corresponds to January, 1 to February, and so on."},year:{id:"database.formula.function.year.description",defaultMessage:"Returns a number corresponding to the year of the given date."},id:{id:"database.formula.function.id.description",defaultMessage:"Returns a unique string id for each entry."},properties:{id:"database.formula.category.properties",defaultMessage:"Properties"},constants:{id:"database.formula.category.constants",defaultMessage:"Constants"},operators:{id:"database.formula.category.operators",defaultMessage:"Operators"},functions:{id:"database.formula.category.functions",defaultMessage:"Functions"}});let u=function(e){return e[e.property=0]="property",e[e.constant=1]="constant",e[e.operator=2]="operator",e[e.function=3]="function",e}({});const p=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],l={e:{name:"e",value:Math.E,category:u.constant,descriptionMessage:i.e,resultType:"number",examples:["e == 2.718281828459045"]},pi:{name:"pi",value:Math.PI,category:u.constant,descriptionMessage:i.pi,resultType:"number",examples:["2 * pi == 6.283185307179586"]},true:{name:"true",value:!0,category:u.constant,descriptionMessage:void 0,resultType:"checkbox",examples:['true ? "yes" : "no" == "yes"']},false:{name:"false",value:!1,category:u.constant,descriptionMessage:void 0,resultType:"checkbox",examples:['false ? "yes" : "no" == "no"']}};function d(e){return{resultType:e,arity:[e,e]}}function c(e){return{resultType:e,arity:[e]}}const y=d("number"),m=d("checkbox"),f=c("number"),h=c("date"),v={resultType:"number",arity:["date"]},x=[{resultType:"checkbox",arity:["text","text"]},{resultType:"checkbox",arity:["checkbox","checkbox"]},{resultType:"checkbox",arity:["date","date"]},{resultType:"checkbox",arity:["number","number"]}];function g(e){if(k.hasOwnProperty(e))return k[e]}function b(e){return e.some((e=>"string"==typeof e))?e.map((e=>e||"")):e.map((e=>e||0))}const k={if:{name:"if",apply:e=>e[0]?e[1]:e[2],operator:"?",category:u.operator,descriptionMessage:i.if,signatures:[{resultType:"text",arity:["checkbox","text","text"]},{resultType:"number",arity:["checkbox","number","number"]},{resultType:"checkbox",arity:["checkbox","checkbox","checkbox"]},{resultType:"date",arity:["checkbox","date","date"]}],examples:["true ? 1 : -1 == 1",'if(false, "yes", "no") == "no"']},add:{name:"add",apply:e=>{const t=b(e);return t[0]+t[1]},operator:"+",category:u.operator,descriptionMessage:i.add,signatures:[y,{resultType:"text",arity:["text","text"]}],examples:["3 + 4 = 7","add(1, 3) == 4",'"add" + "text" == "addtext"']},subtract:{name:"subtract",apply:e=>{const t=b(e);return t[0]-t[1]},operator:"-",category:u.operator,descriptionMessage:i.subtract,signatures:[y],examples:["3 - 1 == 2","subtract(4, 5) == -1"]},multiply:{name:"multiply",apply:e=>{const t=b(e);return t[0]*t[1]},operator:"*",category:u.operator,descriptionMessage:i.multiply,signatures:[y],examples:["6 * 9 == 54","multiply(2, 10) == 20"]},divide:{name:"divide",apply:e=>{const t=b(e);return t[0]/t[1]},operator:"/",category:u.operator,descriptionMessage:i.divide,signatures:[y],examples:["12 / 4 == 3","divide(12, 3) == 4"]},pow:{name:"pow",apply:e=>{const t=b(e);return Math.pow(t[0],t[1])},operator:"^",category:u.operator,descriptionMessage:i.pow,signatures:[y],examples:["5 ^ 3 == 125","pow(2, 6) == 64"]},mod:{name:"mod",apply:e=>{const t=b(e);return t[0]%t[1]},operator:"%",category:u.operator,descriptionMessage:i.mod,signatures:[y],examples:["7 % 5 == 2","mod(3, 3) == 0"]},unaryMinus:{name:"unaryMinus",apply:e=>-b(e)[0],operator:"-",category:u.operator,descriptionMessage:i.unaryMinus,signatures:[f],examples:["-1 + 2 == 1","unaryMinus(42) == -42"]},unaryPlus:{name:"unaryPlus",apply:e=>{const t=b(e);return Number(t[0])},operator:"+",category:u.operator,descriptionMessage:i.unaryPlus,signatures:[f,{resultType:"number",arity:["text"]},{resultType:"number",arity:["checkbox"]}],examples:['+ "42" == 42',"unaryPlus(true) == 1"]},not:{name:"not",apply:e=>!e[0],operator:"not",category:u.operator,descriptionMessage:i.not,signatures:[{resultType:"checkbox",arity:["checkbox"]}],examples:["not true == false","not(false) == true"]},and:{name:"and",apply:e=>e[0]&&e[1],operator:"and",category:u.operator,descriptionMessage:i.and,signatures:[m],examples:["true and false == false","and(true, true) == true"]},or:{name:"or",apply:e=>e[0]||e[1],operator:"or",category:u.operator,descriptionMessage:i.or,signatures:[m],examples:["false or true == true","or(false, false) == false"]},equal:{name:"equal",apply:(e,t)=>{const[n,r]=e;return o().kC(n)&&o().kC(r)?s().AA(n,t).start.valueOf()===s().AA(r,t).start.valueOf():n===r},operator:"==",category:u.operator,descriptionMessage:i.equal,signatures:x,examples:["(3 * 5 == 15) == true","equal(false, not true) == true"]},unequal:{name:"unequal",apply:(e,t)=>{const[n,r]=e;return o().kC(n)&&o().kC(r)?s().AA(n,t).start.valueOf()!==s().AA(r,t).start.valueOf():n!==r},operator:"!=",category:u.operator,descriptionMessage:i.unequal,signatures:x,examples:["(6 * 9 != 42) == false","(true != not false) == false"]},larger:{name:"larger",apply:(e,t)=>{const[n,r]=e;return o().kC(n)&&o().kC(r)?s().AA(n,t).start.valueOf()>s().AA(r,t).start.valueOf():n>r},operator:">",category:u.operator,descriptionMessage:i.larger,signatures:x,examples:["5 > 3 == true"]},largerEq:{name:"largerEq",apply:(e,t)=>{const[n,r]=e;return o().kC(n)&&o().kC(r)?s().AA(n,t).start.valueOf()>=s().AA(r,t).start.valueOf():n>=r},operator:">=",category:u.operator,descriptionMessage:i.largerEq,signatures:x,examples:["5 >= 3 == true","4 >= 4 == true"]},smaller:{name:"smaller",apply:(e,t)=>{const[n,r]=e;return o().kC(n)&&o().kC(r)?s().AA(n,t).start.valueOf()<s().AA(r,t).start.valueOf():n<r},operator:"<",category:u.operator,descriptionMessage:i.smaller,signatures:x,examples:["10 < 8 == false"]},smallerEq:{name:"smallerEq",apply:(e,t)=>{const[n,r]=e;return o().kC(n)&&o().kC(r)?s().AA(n,t).start.valueOf()<=s().AA(r,t).start.valueOf():n<=r},operator:"<=",category:u.operator,descriptionMessage:i.smallerEq,signatures:x,examples:["10 <= 8 == false","8 <= 8 == true"]}};function T(e){if(M.hasOwnProperty(e))return M[e]}const M={concat:{name:"concat",apply:e=>e?e.join(""):void 0,category:u.function,descriptionMessage:i.concat,signatures:[{resultType:"text",variadic:"text"}],examples:['"dog" +"go" == "doggo"','concat("dog", "go") == "doggo"']},join:{name:"join",apply:e=>e?e.slice(1).join(e[0]):void 0,category:u.function,descriptionMessage:i.join,signatures:[{resultType:"text",variadic:"text"}],examples:['join("-", "a", "b", "c") == "a-b-c"']},slice:{name:"slice",apply:e=>e&&e[0]?e[0].slice(e[1],e[2]):void 0,category:u.function,descriptionMessage:i.slice,signatures:[{resultType:"text",arity:["text","number"]},{resultType:"text",arity:["text","number","number"]}],examples:['slice("Hello world", 1, 5) == "ello"','slice("notion", 3) == "ion"']},length:{name:"length",apply:e=>e[0]?e[0].length:0,category:u.function,descriptionMessage:i.length,signatures:[{resultType:"number",arity:["text"]}],examples:['length("Hello world") == 11']},format:{name:"format",apply:(e,t,r)=>{const a=e[0];return o().kC(a)?(0,n(869190).ZF)({value:a,userTimeZone:t,allowRelativeDates:!1,intl:r}):void 0!==a?a.toString():void 0},category:u.function,descriptionMessage:i.format,signatures:[{resultType:"text",arity:["number"]},{resultType:"text",arity:["checkbox"]},{resultType:"text",arity:["date"]},{resultType:"text",arity:["text"]}],examples:['format(42) == "42"','format(true) == "true"','format(now()) == "December 31, 1969 16:00 (PST)"']},toNumber:{name:"toNumber",apply:(e,t)=>{const n=e[0];if(o().kC(n))return s().AA(n,t).start.valueOf();if("boolean"==typeof n)return n?1:0;if("string"==typeof n){const e=parseFloat(n);return a().Et(e)?e:void 0}return a().Et(n)?n:void 0},category:u.function,descriptionMessage:i.toNumber,signatures:[{resultType:"number",arity:["text"]},{resultType:"number",arity:["number"]},{resultType:"number",arity:["checkbox"]},{resultType:"number",arity:["date"]}],examples:['toNumber("42") == 42',"toNumber(false) == 0"]},contains:{name:"contains",apply:e=>Boolean(e[0]&&e[0].includes(e[1])),category:u.function,descriptionMessage:i.contains,signatures:[{resultType:"checkbox",arity:["text","text"]}],examples:['contains("notion", "ion") == true']},replace:{name:"replace",apply:e=>{try{const t=e[0]?e[0].toString():"";return e[1]?t.replace(new RegExp(e[1]),e[2]||""):""}catch(t){return}},category:u.function,descriptionMessage:i.replace,signatures:[{resultType:"text",arity:["number","text","text"]},{resultType:"text",arity:["text","text","text"]},{resultType:"text",arity:["checkbox","text","text"]}],examples:['replace("1-2-3", "-", "!") == "1!2-3"']},replaceAll:{name:"replaceAll",apply:e=>{try{const t=e[0]?e[0].toString():"";return e[1]?t.replace(new RegExp(e[1],"g"),e[2]||""):""}catch(t){return}},category:u.function,descriptionMessage:i.replaceAll,signatures:[{resultType:"text",arity:["number","text","text"]},{resultType:"text",arity:["text","text","text"]},{resultType:"text",arity:["checkbox","text","text"]}],examples:['replaceAll("1-2-3", "-", "!") == "1!2!3"']},test:{name:"test",apply:e=>{try{const t=e[0]?e[0].toString():"";return new RegExp(e[1]).test(t)}catch(t){return}},category:u.function,descriptionMessage:i.test,signatures:[{resultType:"checkbox",arity:["number","text"]},{resultType:"checkbox",arity:["text","text"]},{resultType:"checkbox",arity:["checkbox","text"]}],examples:['test("1-2-3", "-") == true']},empty:{name:"empty",apply:e=>!Boolean(e[0]),category:u.function,descriptionMessage:i.empty,signatures:[{resultType:"checkbox",arity:["number"]},{resultType:"checkbox",arity:["text"]},{resultType:"checkbox",arity:["checkbox"]},{resultType:"checkbox",arity:["date"]}],examples:['empty("") == true']},abs:{name:"abs",apply:e=>Math.abs(e[0]),category:u.function,descriptionMessage:i.abs,signatures:[f],examples:["abs(-3) == 3"]},cbrt:{name:"cbrt",apply:e=>Math.cbrt(e[0]),category:u.function,descriptionMessage:i.cbrt,signatures:[f],examples:["cbrt(8) == 2"]},ceil:{name:"ceil",apply:e=>Math.ceil(e[0]),category:u.function,descriptionMessage:i.ceil,signatures:[f],examples:["ceil(4.2) == 5"]},exp:{name:"exp",apply:e=>Math.exp(e[0]),category:u.function,descriptionMessage:i.exp,signatures:[f],examples:["exp(1) == 2.718281828459045"]},floor:{name:"floor",apply:e=>Math.floor(e[0]),category:u.function,descriptionMessage:i.floor,signatures:[f],examples:["floor(2.8) == 2"]},ln:{name:"ln",apply:e=>Math.log(e[0]),category:u.function,descriptionMessage:i.ln,signatures:[f],examples:["ln(e) == 1"]},log10:{name:"log10",apply:e=>Math.log10(e[0]),category:u.function,descriptionMessage:i.log10,signatures:[f],examples:["log10(1000) == 3"]},log2:{name:"log2",apply:e=>Math.log2(e[0]),category:u.function,descriptionMessage:i.log2,signatures:[f],examples:["log2(64) == 6"]},max:{name:"max",apply:e=>Math.max.apply(void 0,e),category:u.function,descriptionMessage:i.max,signatures:[{resultType:"number",variadic:"number"}],examples:["max(5, 2, 9, 3) == 9"]},min:{name:"min",apply:e=>Math.min.apply(void 0,e),category:u.function,descriptionMessage:i.min,signatures:[{resultType:"number",variadic:"number"}],examples:["min(4, 1, 5, 3) == 1"]},round:{name:"round",apply:e=>Math.round(e[0]),category:u.function,descriptionMessage:i.round,signatures:[f],examples:["round(4.4) == 4","round(4.5) == 5"]},sign:{name:"sign",apply:e=>Math.sign(e[0]),category:u.function,descriptionMessage:i.sign,signatures:[f],examples:["sign(4) == 1","sign(-9) == -1","sign(0) == 0"]},sqrt:{name:"sqrt",apply:e=>Math.sqrt(e[0]),category:u.function,descriptionMessage:i.sqrt,signatures:[f],examples:["sqrt(144) == 12"]},start:{name:"start",apply:e=>{const t=e[0];if(o().kC(t)){if("daterange"===t.type){return{type:"date",start_date:t.start_date}}if("datetimerange"===t.type){return{type:"datetime",start_date:t.start_date,start_time:t.start_time,time_zone:t.time_zone}}return t}},category:u.function,descriptionMessage:i.start,signatures:[h],examples:['start(prop("Date")) == Feb 2, 1996']},end:{name:"end",apply:e=>{const t=e[0];if(o().kC(t)){if("daterange"===t.type){return{type:"date",start_date:t.end_date}}if("datetimerange"===t.type){return{type:"datetime",start_date:t.end_date,start_time:t.end_time,time_zone:t.time_zone,reminder:t.reminder}}return t}},category:u.function,descriptionMessage:i.end,signatures:[h],examples:['end(prop("Date")) == Feb 2, 1996']},now:{name:"now",apply:(e,t)=>s().T_(t),category:u.function,descriptionMessage:i.now,signatures:[{resultType:"date",arity:[]}],examples:["now() == Feb 2, 1996"]},timestamp:{name:"timestamp",apply:(e,t)=>{const n=e[0];if(o().kC(n))return s().AA(n,t).start.valueOf()},category:u.function,descriptionMessage:i.timestamp,signatures:[v],examples:["timestamp(now()) == 1512593154718"]},fromTimestamp:{name:"fromTimestamp",apply:(e,t)=>a().Et(e[0])?s().KQ(e[0],t):void 0,category:u.function,descriptionMessage:i.fromTimestamp,signatures:[{resultType:"date",arity:["number"]}],examples:["fromTimestamp(2000000000000) == Tue May 17 2033"]},dateAdd:{name:"dateAdd",apply:(e,t)=>{const[n,r,o]=e;if(!n||!a().Et(r)||p.indexOf(o)<0)return;const i=s().AA(n,t).start.plus({[o]:r}).valueOf();return"datetime"===n.type||"datetimerange"===n.type?s().KQ(i,n.time_zone):s().p6(i,t)},category:u.function,descriptionMessage:i.dateAdd,signatures:[{resultType:"date",arity:["date","number","text"]}],examples:p.map((e=>`dateAdd(date, amount, "${e}")`))},dateSubtract:{name:"dateSubtract",apply:(e,t)=>{const[n,r,o]=e;if(!n||!a().Et(r)||p.indexOf(o)<0)return;const i=s().AA(n,t).start.minus({[o]:r}).valueOf();return"datetime"===n.type||"datetimerange"===n.type?s().KQ(i,n.time_zone):s().p6(i,t)},category:u.function,descriptionMessage:i.dateSubtract,signatures:[{resultType:"date",arity:["date","number","text"]}],examples:p.map((e=>`dateSubtract(date, amount, "${e}")`))},dateBetween:{name:"dateBetween",apply:(e,t)=>{const[n,r,a]=e;if(!n||!r||p.indexOf(a)<0)return;const o=s().AA(n,t).start,i=s().AA(r,t).start;return Math.trunc(o.diff(i,a).get(a))},category:u.function,descriptionMessage:i.dateBetween,signatures:[{resultType:"number",arity:["date","date","text"]}],examples:p.map((e=>`dateBetween(date, date2, "${e}")`))},formatDate:{name:"formatDate",apply:(e,t,r)=>{const[a,o]=e;if(a&&o){const e=s().AA(a,t,r.locale).start;return(0,n(264435).u)(e,o)}},category:u.function,descriptionMessage:i.formatDate,signatures:[{resultType:"text",arity:["date","text"]}],examples:['formatDate(now(), "MMMM D YYYY, HH:mm") == March 30 2010, 12:00','formatDate(now(), "YYYY/MM/DD, HH:mm") == 2010/03/30, 12:00','formatDate(now(), "MM/DD/YYYY, HH:mm") == 03/30/2010, 12:00','formatDate(now(), "HH:mm A") == 12:00 PM','formatDate(now(), "M/D/YY") == 3/30/10']},minute:{name:"minute",apply:(e,t)=>{const n=e[0];if(o().kC(n))return s().AA(n,t).start.minute},category:u.function,descriptionMessage:i.minute,signatures:[v],examples:["minute(now()) == 45"]},hour:{name:"hour",apply:(e,t)=>{const n=e[0];if(o().kC(n))return s().AA(n,t).start.hour},category:u.function,descriptionMessage:i.hour,signatures:[v],examples:["hour(now()) == 17"]},day:{name:"day",apply:(e,t)=>{const n=e[0];if(o().kC(n))return s().bO(s().AA(n,t).start)},category:u.function,descriptionMessage:i.day,signatures:[v],examples:["day(now()) == 3"]},date:{name:"date",apply:(e,t)=>{const n=e[0];if(o().kC(n))return s().AA(n,t).start.day},category:u.function,descriptionMessage:i.date,signatures:[v],examples:["date(now()) == 13"]},month:{name:"month",apply:(e,t)=>{const n=e[0];if(o().kC(n))return s().AA(n,t).start.month-1},category:u.function,descriptionMessage:i.month,signatures:[v],examples:["month(now()) == 11"]},year:{name:"year",apply:(e,t)=>{const n=e[0];if(o().kC(n))return s().AA(n,t).start.year},category:u.function,descriptionMessage:i.year,signatures:[v],examples:["year(now()) == 1984"]},id:{name:"id",apply:(e,t,n,a)=>(0,r().Xw)(a.id),category:u.function,descriptionMessage:i.id,signatures:[{resultType:"text",arity:[]}],examples:[`id() == "${(0,r().Xw)(n(206267).JW())}"`]}}},628048:(e,t,n)=>{n.d(t,{u_:()=>L,LP:()=>A,bq:()=>F,Qi:()=>P,Ux:()=>E,MB:()=>C});n(16280),n(18107),n(944114),n(269479),n(967357),n(898992),n(823215),n(354520),n(672577),n(430670),n(803949),n(581454),n(908872),n(737550);var r=()=>n(598629),a=()=>n(906745),o=()=>n(498212),s=()=>n(534177),i=()=>n(764880),u=()=>n(597777),p=()=>n(604995),l=()=>n(498140),d=()=>n(264435),c=()=>n(416504),y=()=>n(437607),m=()=>n(201980),f=()=>n(96033),h=()=>n(247331),v=()=>n(3259),x=()=>n(696446),g=()=>n(145076),b=()=>n(349835),k=()=>n(239381),T=()=>n(307663);const M=(0,n(69708).YK)({if:{id:"database.formula2.operator.if.description",defaultMessage:"Returns the first value if the condition is true; otherwise, returns the second value."},ifs:{id:"database.formula2.operator.ifs.description",defaultMessage:"Returns the value that corresponds to the first true condition. This can be used as an alternative to multiple nested if() statements."},e:{id:"database.formula2.constant.e.description",defaultMessage:"Returns the base of the natural logarithm."},pi:{id:"database.formula2.constant.pi.description",defaultMessage:"Returns the ratio of a circles circumference to its diameter."},add:{id:"database.formula2.operator.add.description",defaultMessage:"Returns the sum of two numbers."},at:{id:"database.formula2.operator.at.description",defaultMessage:"Returns the value at the specified index in a list."},every:{id:"database.formula2.operator.every.description",defaultMessage:"Returns true if every item in the list satisfies the given condition, and false otherwise."},filter:{id:"database.formula2.operator.filter.description",defaultMessage:"Returns the values in the list for which the condition is true."},find:{id:"database.formula2.operator.find.description",defaultMessage:"Returns the first element in the list for which the condition returns true."},first:{id:"database.formula2.operator.first.description",defaultMessage:"Returns the first item in the list."},flat:{id:"database.formula2.operator.flat.description",defaultMessage:"Flattens a list of lists into a single list."},includes:{id:"database.formula2.operator.includes.description",defaultMessage:"Returns true if the list contains the specified value, and false otherwise."},last:{id:"database.formula2.operator.last.description",defaultMessage:"Returns the last item in the list."},map:{id:"database.formula2.operator.map.description",defaultMessage:"Returns the list populated with the results of calling the expression on every item in the input list."},reverse:{id:"database.formula2.operator.reverse.description",defaultMessage:"Returns the reversed list."},slice:{id:"database.formula2.operator.slice.description",defaultMessage:"Returns the items of the list from the provided start index (inclusive) to the end index (optional and exclusive)."},splice:{id:"database.formula2.operator.splice.description",defaultMessage:"Removes a specified number of elements from a list at the startIndex and optionally inserts new elements at that position. If deleteCount is not provided, it defaults to 0."},findIndex:{id:"database.formula2.operator.findIndex.description",defaultMessage:"Returns the index of the first item in the list for which the condition evaluates to true."},unique:{id:"database.formula2.operator.unique.description",defaultMessage:"Returns the list of unique values in the input list."},toPlainText:{id:"database.formula2.operator.toPlainText.description",defaultMessage:"Returns the plain text representation of the input text."},toText:{id:"database.formula2.operator.toText.description",defaultMessage:"Returns the text representation of the input value."},sort:{id:"database.formula2.operator.sort.description",defaultMessage:"Returns the list in sorted order. Optionally, a provided expression can be used to determine the sorting order."},some:{id:"database.formula2.operator.some.description",defaultMessage:"Returns true if any item in the list satisfies the given condition, and false otherwise."},let:{id:"database.formula2.operator.let.description",defaultMessage:"Assigns a value to a variable and evaluates the expression using that variable."},lets:{id:"database.formula2.operator.lets.description",defaultMessage:"Assigns values to multiple variables and evaluates the expression using those variables."},sum:{id:"database.formula2.operator.sum.description",defaultMessage:"Returns the sum of its arguments."},subtract:{id:"database.formula2.operator.subtract.description",defaultMessage:"Returns the difference of two numbers."},multiply:{id:"database.formula2.operator.multiply.description",defaultMessage:"Returns the product of two numbers."},divide:{id:"database.formula2.operator.divide.description",defaultMessage:"Returns the quotient of two numbers."},pow:{id:"database.formula2.operator.pow.description",defaultMessage:"Returns the result of a base number raised to an exponent power."},mod:{id:"database.formula2.operator.mod.description",defaultMessage:"Returns the first number modulo the second number."},equal:{id:"database.formula2.operator.equal.description",defaultMessage:"Returns true if both values are equal and false otherwise."},unequal:{id:"database.formula2.operator.unequal.description",defaultMessage:"Returns false if both values are equal and true otherwise."},concat:{id:"database.formula2.function.concat.description",defaultMessage:"Returns the concatenation of multiple lists."},join:{id:"database.formula2.function.join.description",defaultMessage:"Returns the values of the list with the joiner placed between each of the values."},split:{id:"database.formula2.function.split.description",defaultMessage:"Returns the list of values created by splitting a text by a separator."},substring:{id:"database.formula2.function.slice.description",defaultMessage:"Returns the substring of the text from the start index (inclusive) to the end index (optional and exclusive)."},length:{id:"database.formula2.function.length.description",defaultMessage:"Returns the length of the text or list value."},format:{id:"database.formula2.function.format.description",defaultMessage:"Returns the value formatted as text."},formatNumber:{id:"database.formula2.function.formatNumber.description",defaultMessage:"Returns the number value formatted as text.{br}{br}The format argument can be one of commas, percent, humanize, bytes, or a currency code (see below).{br}{br}Optionally specify how many decimal places to show (0-12) via the precision argument. If not specified, all significant digits are shown up to 12 decimal places.{br}{br}Supported currency codes: usd, aud, cad, sgd, eur, gbp, jpy, rub, inr, krw, cny, brl, try, idr, chf, hkd, nzd, sek, nok, mxn, zar, twd, dkk, pln, thb, huf, czk, ils, clp, php, aed, cop, sar, myr, ron, ars, uyu, pen."},style:{id:"database.formula2.function.style.description",defaultMessage:"Adds styles and colors to the text. Valid formatting styles: b (bold), u (underline), i (italics), c (code), or s (strikethrough). Valid colors: gray, brown, orange, yellow, green, blue, purple, pink, and red. Add _background to colors to set background colors."},unstyle:{id:"database.formula2.function.unstyle.description",defaultMessage:"Removes formatting styles from the text. If no styles are specified, all styles are removed."},link:{id:"database.formula2.function.link.description",defaultMessage:"Creates a hyperlink from the label text and the URL."},toNumber:{id:"database.formula2.function.toNumber.description",defaultMessage:"Parses a number from text."},contains:{id:"database.formula2.function.contains.description",defaultMessage:"Returns true if the search string is present in the value."},replace:{id:"database.formula2.function.replace.description",defaultMessage:"Replaces the first match of the regular expression with the replacement value."},replaceAll:{id:"database.formula2.function.replaceAll.description",defaultMessage:"Replaces all matches of the regular expression with the replacement value."},test:{id:"database.formula2.function.test.description",defaultMessage:"Returns true if the value matches the regular expression and false otherwise."},match:{id:"database.formula2.function.match.description",defaultMessage:"Returns all matches of the regular expression as a list."},empty:{id:"database.formula2.function.empty.description",defaultMessage:"Returns true if the value is empty. 0, , false, and [] are considered empty."},abs:{id:"database.formula2.function.abs.description",defaultMessage:"Returns the absolute value of the number."},cbrt:{id:"database.formula2.function.cbrt.description",defaultMessage:"Returns the cube root of the number."},ceil:{id:"database.formula2.function.ceil.description",defaultMessage:"Returns the smallest integer greater than or equal to the number."},exp:{id:"database.formula2.function.exp.description",defaultMessage:"Returns e^x, where x is the argument, and e is Eulers number (2.718), the base of the natural logarithm."},floor:{id:"database.formula2.function.floor.description",defaultMessage:"Returns the largest integer less than or equal to the number."},ln:{id:"database.formula2.function.ln.description",defaultMessage:"Returns the natural logarithm of the number."},log10:{id:"database.formula2.function.log10.description",defaultMessage:"Returns the base 10 logarithm of the number."},log2:{id:"database.formula2.function.log2.description",defaultMessage:"Returns the base 2 logarithm of the number."},max:{id:"database.formula2.function.max.description",defaultMessage:"Returns the largest number of the arguments."},min:{id:"database.formula2.function.min.description",defaultMessage:"Returns the smallest number of the arguments."},mean:{id:"database.formula2.function.mean.description",defaultMessage:"Returns the arithmetic average of its arguments."},median:{id:"database.formula2.function.median.description",defaultMessage:"Returns the middle value of its arguments."},mode:{id:"database.formula2.function.mode.description",defaultMessage:"Returns the most commonly occurring value of its arguments."},round:{id:"database.formula2.function.round.description",defaultMessage:"Returns the value of a number rounded to the nearest integer."},sign:{id:"database.formula2.function.sign.description",defaultMessage:"Returns 1 if the number is positive, -1 if it is negative, and 0 if it is zero."},sqrt:{id:"database.formula2.function.sqrt.description",defaultMessage:"Returns the positive square root of the number."},start:{id:"database.formula2.function.start.description",defaultMessage:"Returns the start of the date range."},end:{id:"database.formula2.function.end.description",defaultMessage:"Returns the end of the date range."},now:{id:"database.formula2.function.now.description",defaultMessage:"Returns the current date and time."},today:{id:"database.formula2.function.today.description",defaultMessage:"Returns the current date without the time."},timestamp:{id:"database.formula2.function.timestamp.description",defaultMessage:"Returns the current Unix timestamp, representing the number of milliseconds that have elapsed since January 1, 1970."},fromTimestamp:{id:"database.formula2.function.fromTimestamp.description",defaultMessage:"Returns the date from the given Unix timestamp. The timestamp represents the number of milliseconds that have elapsed since January 1, 1970. Note: the returned date will not retain the seconds & milliseconds."},dateAdd:{id:"database.formula2.function.dateAdd.description",defaultMessage:"Adds time to the date. The unit argument can be one of: years, quarters, months, weeks, days, hours, or minutes."},dateSubtract:{id:"database.formula2.function.dateSubtract.description",defaultMessage:"Subtracts time from the date. The unit argument can be one of: years, quarters, months, weeks, days, hours, or minutes."},dateBetween:{id:"database.formula2.function.dateBetween.description",defaultMessage:"Returns the difference between two dates. The unit argument can be one of: years, quarters, months, weeks, days, hours, or minutes."},formatDate:{id:"database.formula2.function.formatDate.description",defaultMessage:"Formats the date using a custom format string and optional timezone. The format string can contain the following text to represent parts of the date: YYYY for year, MM for month, DD for day, HH for hour, mm for minute."},date:{id:"database.formula2.function.date.description",defaultMessage:"Returns the day of the month from the date (1-31)."},day:{id:"database.formula2.function.day.description",defaultMessage:"Returns the day of the week of the date, between 1 (Monday) and 7 (Sunday)."},month:{id:"database.formula2.function.month.description",defaultMessage:"Returns the month of the date (1-12)."},week:{id:"database.formula2.function.week.description",defaultMessage:"Returns the ISO week of the year of the date (1-53)."},year:{id:"database.formula2.function.year.description",defaultMessage:"Returns the year of the date."},hour:{id:"database.formula2.function.hour.description",defaultMessage:"Returns the hour of the date (0-23)."},minute:{id:"database.formula2.function.minute.description",defaultMessage:"Returns the minute of the date (0-59)."},parseDate:{id:"database.formula2.function.parseDate.description",defaultMessage:"Returns the date parsed according to the ISO 8601 standard."},dateRange:{id:"database.formula2.function.dateRange.description",defaultMessage:"Returns a date range constructed from the start and end dates."},dateStart:{id:"database.formula2.function.dateStart.description",defaultMessage:"Returns the start of the date range."},dateEnd:{id:"database.formula2.function.dateEnd.description",defaultMessage:"Returns the end of the date range."},id:{id:"database.formula2.function.id.description",defaultMessage:"Returns the id of the page or person. If no page or person is provided, returns the id of the page the formula is on."},name:{id:"database.formula2.function.name.description",defaultMessage:"Returns the name of a person."},email:{id:"database.formula2.function.email.description",defaultMessage:"Returns the email address of a person."},lower:{id:"database.formula2.function.lower.description",defaultMessage:"Converts the text to lowercase."},upper:{id:"database.formula2.function.upper.description",defaultMessage:"Converts the text to uppercase."},trim:{id:"database.formula2.function.trim.description",defaultMessage:"Removes whitespace from the beginning and end of the text."},repeat:{id:"database.formula2.function.repeat.description",defaultMessage:"Repeats the text a given number of times."},padStart:{id:"database.formula2.function.padStart.description",defaultMessage:"Returns the text padded with the provided padding string at the start until the target length is reached."},padEnd:{id:"database.formula2.function.padEnd.description",defaultMessage:"Returns the text padded with the provided padding string at the end until the target length is reached."},_wait:{id:"database.formula2.function._wait.description",defaultMessage:"Waits for the specified amount of time, then returns the result."},_unsafeCastArray:{id:"database.formula2.function.unsafeCastArray.description",defaultMessage:"Casts an array of unknown type to the type of the second array parameter"},count:{id:"database.formula2.function.count.description",defaultMessage:"Returns the number of elements in a list for which the condition is true. If no condition is provided, returns the total number of elements (equivalent to length())."}});function w(e){if(!e)throw new Error("Assertion failed in formulaLibraryFunctions")}const N={type:"undefined"},I={name:"expression",type:{type:"expression"},augmentScope:e=>{var t;const n="array"===(null===(t=e[0])||void 0===t?void 0:t.type)?e[0].of:{type:"unknown"};return{[h().CURRENT_VALUE_NAME]:n,[h().CURRENT_INDEX_NAME]:{type:"number"}}}},E={expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}},I]},C={expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}},{...I,optional:!0}]},R={if:{name:"if",*eval(e,t){const[n,r,a]=e;return w("checkbox"===n.type),n.value?yield*(0,v().yN)((0,f().F$)(r),t):yield*(0,v().yN)((0,f().F$)(a),t)},parameters:{expected:[{name:"condition",type:{type:"checkbox"}},{name:"ifTrue",type:{type:"expression"}},{name:"ifFalse",type:{type:"expression"}}]},returnType:([e,t,n])=>void 0!==t&&void 0!==n&&(0,k().Re)(t,n)?t:{type:"unknown"},iconType:{type:"checkbox"},examples:[[{input:"if(true, 1, 2)",output:"1"},{input:"if(false, 1, 2)",output:"2"},{input:[(0,T().Py)("Checked"),[' == true ? "Complete" : "Incomplete"']]}],[{input:"true.if(1, 2)",output:"1"},{input:"false.if(1, 2)",output:"2"}]],syntax:["if(condition, ifTrue, ifFalse)","condition.if(ifTrue, ifFalse)"],description:M.if},ifs:{name:"ifs",parameters:{expected:[{name:"condition",type:{type:"checkbox"}},{name:"ifTrue",type:{type:"expression"}}],varargs:[{name:"rest",type:{type:"expression"}}]},returnType:e=>{if(e.length<2)return{type:"unknown"};const t=e[1];let n=2;for(;n<e.length-1;n+=2)if(!(0,k().Re)(e[n+1],t))return{type:"unknown"};if(n===e.length-1){const r=e[n];if(!(0,k().Re)(r,t))return{type:"unknown"}}return t},*eval(e,t){const n=e[0];if(w("checkbox"===n.type),n.value)return yield*(0,v().yN)((0,f().F$)(e[1]),t);for(let r=2;r<e.length-1;r+=2){const n=(0,f().F$)(e[r]);if((0,k().CL)(yield*(0,v().yN)(n,t)))return yield*(0,v().yN)((0,f().F$)(e[r+1]),t)}return e.length%2==1?yield*(0,v().yN)((0,f().F$)(e[e.length-1]),t):N},iconType:{type:"checkbox"},examples:[[{input:"ifs(true, 1, true, 2, 3)",output:"1"},{input:"ifs(false, 1, false, 2, 3)",output:"3"}],[{input:"true.ifs(1, true, 2, 3)",output:"1"},{input:"false.ifs(1, false, 2, 3)",output:"3"}]],syntax:["ifs(condition, ifTrue, condition2, ifTrue2, ..., else)","condition.ifs(ifTrue, condition2, ifTrue2, ..., else)"],description:M.ifs},and:{name:"and",*eval(e,t){return{type:"checkbox",value:e.every((e=>(0,k().CL)(e)))}},parameters:{varargs:[{name:"value",type:[{type:"unknown"}]}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:"and(true, true, true)",output:"true"},{input:"and(3 > 2, 2 < 3)",output:"false"}],[{input:"true.and(true, true)",output:"true"},{input:"(3 > 2).and(2 < 3)",output:"false"}]],syntax:["and(boolean, boolean, ...)","boolean.and(boolean, ...)"],description:g().Q$.and},or:{name:"or",*eval(e,t){return{type:"checkbox",value:e.some((e=>(0,k().CL)(e)))}},parameters:{varargs:[{name:"value",type:[{type:"unknown"}]}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:"or(true, false, false)",output:"true"},{input:"or(3 > 2, 2 < 3)",output:"true"}],[{input:"true.or(false, false)",output:"true"},{input:"(3 > 2).or(2 < 3)",output:"true"}]],syntax:["or(boolean, boolean, ...)","boolean.or(boolean, ...)"],description:g().Q$.or},not:{name:"not",*eval(e,t){const[n]=e;return{type:"checkbox",value:!(0,k().CL)(n)}},parameters:{varargs:[{name:"value",type:[{type:"unknown"}]}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:"not(true)",output:"false"},{input:"not(2 > 3)",output:"true"}],[{input:"true.not()",output:"false"},{input:"(2 > 3).not()",output:"true"}]],syntax:["not(boolean)","boolean.not()"],description:g().Q$.not},empty:{name:"empty",*eval(e,t){const[n]=e;return{type:"checkbox",value:"array"===n.type?0===n.values.length:!(0,k().CL)(n)}},parameters:{expected:[{name:"input",type:{type:"unknown"}}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:"empty(0)",output:"true"},{input:"empty([])",output:"true"}],[{input:"0.empty()",output:"true"},{input:"[].empty()",output:"true"}]],syntax:["empty(value)","value.empty()"],description:M.empty},length:{name:"length",*eval(e,t){const[n]=e;return"array"===n.type?{type:"number",value:n.values.length}:(w("text"===n.type),{type:"number",value:n.value.reduce(((e,t)=>e+(0,m().WWE)(t)),0)})},parameters:{expected:[{name:"input",type:[{type:"text"},{type:"array",of:{type:"unknown"}}]}]},returnType:{type:"number"},iconType:{type:"text"},examples:[[{input:'length("hello")',output:"5"},{input:"length([1, 2, 3])",output:"3"}],[{input:'"hello".length()',output:"5"},{input:"[1, 2, 3].length()",output:"3"}]],syntax:["length(value)","value.length()"],description:M.length},substring:{name:"substring",*eval(e,t){const[n,r,a]=e;w("text"===n.type&&"number"===r.type);return{type:"text",value:[[(yield*(0,k().o7)(n.value,t)).slice(r.value,"number"===(null==a?void 0:a.type)?a.value:void 0)]]}},parameters:{expected:[{name:"target",type:{type:"text"}},{name:"startIndex",type:{type:"number"}},{name:"endIndex",optional:!0,type:{type:"number"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'substring("Notion", 0, 3)',output:'"Not"'},{input:'substring("Notion", 3)',output:'"ion"'}],[{input:'"Notion".substring(0, 3)',output:'"Not"'},{input:'"Notion".substring(3)',output:'"ion"'}]],syntax:["substring(text, startIndex, endIndex?)","text.substring(startIndex, endIndex?)"],description:M.substring},contains:{name:"contains",*eval(e,t){const[n,r]=e;w("text"===n.type&&"text"===r.type);const[a,o]=yield*(0,k().h8)([n.value,r.value],t);return{type:"checkbox",value:a.includes(o)}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"search",type:{type:"text"}}]},returnType:{type:"checkbox"},iconType:{type:"text"},examples:[[{input:'contains("Notion", "ot")',output:"true"}],[{input:'"Notion".contains("ot")',output:"true"}]],syntax:["contains(value, search)","value.contains(search)"],description:M.contains},test:{name:"test",*eval(e,t){const[n,r]=e;w("text"===n.type&&"text"===r.type);const[a,o]=yield*(0,k().h8)([r.value,n.value],t);return{type:"checkbox",value:S({context:t,pattern:a}).test(o)}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"pattern",type:{type:"text"}}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:'test("Notion", "Not")',output:"true"},{input:'test("Notion", "\\d")',output:"false"}],[{input:'"Notion.test("Not")',output:"true"},{input:'"Notion".test("\\d")',output:"false"}]],syntax:["test(text, pattern)","text.test(pattern)"],description:M.test},match:{name:"match",*eval(e,t){const[n,r]=e;w("text"===n.type&&"text"===r.type);const[a,o]=yield*(0,k().h8)([n.value,r.value],t),s=S({context:t,pattern:o,flags:"g"}),i=a.match(s);return i?{type:"array",values:i.map((e=>({type:"text",value:(0,m().x9d)(e)})))}:{type:"array",values:[]}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"pattern",type:{type:"text"}}]},returnType:{type:"array",of:{type:"text"}},iconType:{type:"text"},examples:[[{input:'match("Notion Notion", "Not")',output:'["Not", "Not"]'},{input:'match("Notion 123 Notion 456", "\\d+")',output:'["123", "456"]'}],[{input:'"Notion Notion".match("Not")',output:'["Not", "Not"]'},{input:'"Notion 123 Notion 456".match("\\d+")',output:'["123", "456"]'}]],syntax:["match(text, pattern)","text.match(pattern)"],description:M.match},replace:{name:"replace",*eval(e,t){const[n,r,a]=e;w("text"===n.type&&"text"===r.type);const[o,s,i]=yield*(0,k().h8)([n.value,r.value,"text"===(null==a?void 0:a.type)?a.value:void 0],t),u=S({context:t,pattern:s});return{type:"text",value:(0,m().x9d)(o.replace(u,i))}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"pattern",type:{type:"text"}},{name:"replacement",optional:!0,type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'replace("Notion Notion", "N", "M")',output:'"Motion Notion"'}],[{input:'"Notion Notion".replace("N", "M")',output:'"Motion Notion"'}]],syntax:["replace(text, pattern, replacement?)","text.replace(pattern, replacement?)"],description:M.replace},replaceAll:{name:"replaceAll",*eval(e,t){const[n,r,a]=e;w("text"===n.type&&"text"===r.type);const[o,s,i]=yield*(0,k().h8)([n.value,r.value,"text"===(null==a?void 0:a.type)?a.value:void 0],t),u=S({context:t,pattern:s,flags:"g"});return{type:"text",value:(0,m().x9d)(o.replace(u,i))}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"pattern",type:{type:"text"}},{name:"replacement",optional:!0,type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'replaceAll("Notion Notion", "N", "M")',output:'"Motion Motion"'},{input:'replaceAll("Notion 123", "\\d", "")',output:'"Notion"'}],[{input:'"Notion Notion".replaceAll("N", "M")',output:'"Motion Motion"'},{input:'"Notion 123".replaceAll("\\d", "")',output:'"Notion"'}]],syntax:["replaceAll(text, pattern, replacement?)","text.replaceAll(pattern, replacement?)"],description:M.replaceAll},lower:{name:"lower",*eval(e){const[t]=e;w("text"===t.type);return{type:"text",value:t.value.map((e=>{const t=(0,m().uPN)(e),n=(0,m().N8A)(e);return(0,m().Ey_)(n.toLowerCase(),t)}))}},parameters:{expected:[{name:"text",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'lower("NOTION")',output:'"notion"'}],[{input:'"NOTION".lower()',output:'"notion"'}]],syntax:["lower(text)","text.lower()"],description:M.lower},upper:{name:"upper",*eval(e){const[t]=e;w("text"===t.type);return{type:"text",value:t.value.map((e=>{const t=(0,m().uPN)(e),n=(0,m().N8A)(e);return(0,m().Ey_)(n.toUpperCase(),t)}))}},parameters:{expected:[{name:"text",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'upper("notion")',output:'"NOTION"'}],[{input:'"notion".upper()',output:'"NOTION"'}]],syntax:["upper(text)","text.upper()"],description:M.upper},trim:{name:"trim",*eval(e){const[t]=e;return w("text"===t.type),{type:"text",value:(0,m().bBR)(t.value)}},parameters:{expected:[{name:"text",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'trim("  notion  ")',output:'"notion"'}],[{input:'"  notion  ".trim()',output:'"notion"'}]],syntax:["trim(text)","text.trim()"],description:M.trim},repeat:{name:"repeat",*eval(e){const[t,n]=e;w("text"===t.type),w("number"===n.type);const r=[],a=Math.min(n.value,1e4);for(let o=0;o<a;o++)r.push(...t.value);return{type:"text",value:r}},parameters:{expected:[{name:"text",type:{type:"text"}},{name:"count",type:{type:"number"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'repeat("0", 4)',output:'"0000"'},{input:'repeat("~=", 10).style("blue")',output:[['"'],["~=~=~=~=~=~=~=~=~=~=",[["h","blue"]]],['"']]}],[{input:'"0".repeat(4)',output:'"0000"'},{input:'"~=".repeat(10).style("blue")',output:[['"'],["~=~=~=~=~=~=~=~=~=~=",[["h","blue"]]],['"']]}]],syntax:["repeat(text, count)","text.repeat(count)"],description:M.repeat},padStart:{name:"padStart",*eval(e,t){const[n,r,a]=e;return w("text"===n.type&&"number"===r.type&&"text"===a.type),yield*(0,T().tr)(n.value,r.value,a.value,"start",t)},parameters:{expected:[{name:"text",type:{type:"text"}},{name:"targetLength",type:{type:"number"}},{name:"padString",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'padStart("A", 3, ".")',output:'"..A"'},{input:"padStart(123, 5, 0)",output:'"00123"'}],[{input:'"A".padStart(3, ".")',output:'"..A"'},{input:"123.padStart(5, 0)",output:'"00123"'}]],syntax:["padStart(text, targetLength, padString)","text.padStart(targetLength, padString)"],description:M.padStart},padEnd:{name:"padEnd",*eval(e,t){const[n,r,a]=e;return w("text"===n.type&&"number"===r.type&&"text"===(null==a?void 0:a.type)),yield*(0,T().tr)(n.value,r.value,a.value,"end",t)},parameters:{expected:[{name:"text",type:{type:"text"}},{name:"targetLength",type:{type:"number"}},{name:"padString",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'padEnd("A", 3, ".")',output:'"A.."'},{input:"padEnd(123, 5, 0)",output:'"12300"'}],[{input:'"A".padEnd(3, ".")',output:'"A.."'},{input:"123.padEnd(5, 0)",output:'"12300"'}]],syntax:["padEnd(text, targetLength, padString)","text.padEnd(targetLength, padString)"],description:M.padEnd},link:{name:"link",*eval(e){const[t,n]=e;return w("text"===t.type),w("text"===n.type),{type:"text",value:(0,m().lux)(t.value,(0,m().k4p)(n.value))}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"url",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'link("Notion", "https://notion.so")',output:[['"'],["Notion",[(0,m().Sez)("https://notion.so")]],['"']]}],[{input:'"Notion".link("https://notion.so")',output:[['"'],["Notion",[(0,m().Sez)("https://notion.so")]],['"']]}]],syntax:["link(text, url)","text.link(url)"],description:M.link},style:{name:"style",*eval(e){const[t,...n]=e;w("text"===t.type),n.forEach((e=>w("text"===e.type)));const r=n.length>0?(0,T().kk)(n.map((e=>(w("text"===e.type),e.value))).filter(s().O9)):[];return{type:"text",value:(0,T().xK)(t.value,r)}},parameters:{expected:[{name:"input",type:{type:"text"}}],varargs:[{name:"styles",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'style("Notion", "b", "u")',output:[['"'],["Notion",[["b"],["_"]]],['"']]},{input:'style("Notion", "blue", "gray_background")',output:[['"'],["Notion",[["h","blue"],["h","blue_background"]]],['"']]}],[{input:'"Notion".style("b", "u")',output:[['"'],["Notion",[["b"],["_"]]],['"']]},{input:'"Notion".style("blue", "blue_background")',output:[['"'],["Notion",[["h","blue"],["h","blue_background"]]],['"']]}]],syntax:["style(value, styles)","value.style(styles)"],description:M.style},unstyle:{name:"unstyle",*eval(e){const[t,...n]=e;w("text"===t.type);const r=n.length>0?(0,T().kk)(n.map((e=>(w("text"===e.type),e.value))).filter(s().O9)):void 0;return{type:"text",value:(0,T().qs)(t.value,r)}},parameters:{expected:[{name:"input",type:{type:"text"}}],varargs:[{name:"styles",optional:!0,type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:[['unstyle("'],["Text",[["b"],["c"]]],['")']],output:[['"Text"']]},{input:[['unstyle("'],["Text",[["h","blue"],["b"]]],['", "blue")']],output:[['"'],["Text",[["b"]]],['"']]}],[{input:[['"'],["Text",[["b"],["c"]]],['".unstyle()']],output:[['"Text"']]},{input:[['"'],["Text",[["h","blue"],["b"]]],['".unstyle("blue")']],output:[['"'],["Text",[["b"]]],['"']]}]],syntax:["unstyle(value, styles?)","value.unstyle(styles?)"],description:M.unstyle},format:{name:"format",*eval(e,t){const[n]=e,r=(0,k().Ht)(n);return{type:"text",value:(0,m().x9d)(yield*(0,k().o7)(r,t))}},parameters:{expected:[{name:"input",type:{type:"unknown"}}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:"format(1234)",output:'"1234"'},{input:"format(now())",output:[['"'],[(0,d().u)(a().c9.now(),"MMMM D, Y HH:mm")],['"']]}],[{input:"1234.format()",output:'"1234"'},{input:"now().format()",output:[['"'],[(0,d().u)(a().c9.now(),"MMMM D, Y HH:mm")],['"']]}]],syntax:["format(value)","value.format()"],description:M.format},formatNumber:{name:"formatNumber",*eval(e,t){const[r,a,o]=e;w("number"===r.type),w(void 0===a||"text"===(null==a?void 0:a.type));let s=null;if(void 0!==a){const e=yield*(0,T().x3)(a.value,t);w(void 0===o||"number"===(null==o?void 0:o.type)),s=(0,n(72135).ZV)(r.value,e,t.intl,void 0,null==o?void 0:o.value)}else s=yield*(0,k().o7)((0,k().Ht)(r),t);return{type:"text",value:(0,m().x9d)(s)}},parameters:{expected:[{name:"input",type:{type:"number"}},{name:"format",type:{type:"text"},optional:!0},{name:"precision",type:{type:"number"},optional:!0}]},returnType:{type:"text"},iconType:{type:"text"},examples:[[{input:'formatNumber(12.345, "usd")',output:'"$12.35"'},{input:'formatNumber(12.345, "usd", 0)',output:'"$12"'},{input:'formatNumber(1234567890, "commas")',output:'"1,234,567,890"'},{input:'formatNumber(1234567890, "humanize")',output:'"1.2B"'}],[{input:'12.345.formatNumber("usd")',output:'"$12.35"'},{input:'12.345.formatNumber("usd", 0)',output:'"$12"'},{input:'1234567890.formatNumber("commas")',output:'"1,234,567,890"'},{input:'1234567890.formatNumber("humanize")',output:'"1.2B"'}]],syntax:["formatNumber(value, format?, precision?)","value.formatNumber(format?, precision?)"],description:M.formatNumber},add:(0,T().P7)("add",M.add,((e,t)=>Number.isInteger(e)&&Number.isInteger(t)?e+t:new(r().Big)(e).plus(t).toNumber()),"+"),subtract:(0,T().P7)("subtract",M.subtract,((e,t)=>Number.isInteger(e)&&Number.isInteger(t)?e-t:new(r().Big)(e).minus(t).toNumber()),"-"),multiply:(0,T().P7)("multiply",M.multiply,((e,t)=>Number.isInteger(e)&&Number.isInteger(t)?e*t:new(r().Big)(e).mul(t).toNumber()),"*"),mod:(0,T().P7)("mod",M.mod,((e,t)=>Number.isInteger(t)?e%t:new(r().Big)(e).mod(t).toNumber()),"%"),pow:(0,T().P7)("pow",M.pow,((e,t)=>!Number.isInteger(e)&&Number.isInteger(t)?new(r().Big)(e).pow(t).toNumber():e**t),"^"),divide:{name:"divide",description:M.divide,*eval(e,t){const[n,a]=e;return w("number"===n.type&&"number"===a.type),0===a.value?N:{type:"number",value:new(r().Big)(n.value).div(a.value).toNumber()}},returnType:{type:"number"},iconType:{type:"number"},syntax:["divide(number, number)","number.divide(number)"],parameters:{expected:[{name:"lhs",type:{type:"number"}},{name:"rhs",type:{type:"number"}}]},examples:[[{input:"divide(5, 10)",output:"0.5"},{input:"5 / 10",output:"0.5"}],[{input:"5.divide(10)",output:"0.5"},{input:"5 / 10",output:"0.5"}]]},min:{name:"min",*eval(e,t){const n=e,r=(0,k().U)({type:"array",values:n});if(0===r.values.length)return N;if(r.values.every((e=>"date"===e.type))){const e=r.values.map((e=>{if("date"===e.type)return(0,p().ln)(e.value,t.userTimeZone)})).filter(s().O9);if(0===e.length)return N;const n=e.indexOf(Math.min(...e));return r.values[n]}{const e=r.values.map((e=>"number"===e.type?e.value:void 0)).filter(s().O9);if(0===e.length)return N;return{type:"number",value:Math.min(...e)}}},parameters:{varargs:[{name:"value",type:[{type:"number"},{type:"array",of:{type:"number"}}]}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"min(1, 2, 3)",output:"1"},{input:"min([1, 2, 3])",output:"1"}],[{input:"[1, 2, 3].min()",output:"1"}]],syntax:["min(list)","list.min()"],description:M.min},max:{name:"max",*eval(e,t){const n=e,r=(0,k().U)({type:"array",values:n});if(0===r.values.length)return N;if(r.values.every((e=>"date"===e.type))){const e=r.values.map((e=>{if("date"===e.type)return(0,p().ln)(e.value,t.userTimeZone)})).filter(s().O9);if(0===e.length)return N;const n=e.indexOf(Math.max(...e));return r.values[n]}{const e=r.values.map((e=>"number"===e.type?e.value:void 0)).filter(s().O9);if(0===e.length)return N;return{type:"number",value:Math.max(...e)}}},parameters:{varargs:[{name:"value",type:[{type:"number"},{type:"array",of:{type:"number"}}]}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"max(1, 2, 3)",output:"3"},{input:"max([1, 2, 3])",output:"3"}],[{input:"[1, 2, 3].max()",output:"3"}]],syntax:["max(list)","list.max()"],description:M.max},sum:{name:"sum",*eval(e,t){const n=e;return{type:"number",value:(0,T().Hx)(n).reduce(((e,t)=>e.plus(t)),new(r().Big)(0)).toNumber()}},parameters:{varargs:[{name:"value",type:[{type:"number"},{type:"array",of:{type:"number"}}]}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"sum(1, 2, 3)",output:"6"},{input:"sum([1, 2, 3], 4, 5)",output:"15"}],[{input:"[1, 2, 3].sum()",output:"6"},{input:"[1, 2, 3].sum(4, 5)",output:"15"}]],syntax:["sum(list)","list.sum()"],description:M.sum},median:{name:"median",*eval(e,t){const n=e,a=(0,T().Hx)(n).sort(((e,t)=>e-t));if(0===a.length)return N;if(a.length%2==0){const e=a[a.length/2-1],t=a[a.length/2];return{type:"number",value:new(r().Big)(e).plus(t).div(2).toNumber()}}return{type:"number",value:a[Math.floor(a.length/2)]}},parameters:{varargs:[{name:"value",type:[{type:"number"},{type:"array",of:{type:"number"}}]}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"median(1, 2, 4)",output:"2"},{input:"median([1, 2, 3], 4)",output:"2.5"}],[{input:"[1, 2, 4].median()",output:"2"},{input:"[1, 2, 3].median(4)",output:"2.5"}]],syntax:["median(list)","list.median()"],description:M.median},mean:{name:"mean",*eval(e,t){const n=e,a=(0,T().Hx)(n);if(0===a.length)return N;return{type:"number",value:a.reduce(((e,t)=>e.plus(t)),new(r().Big)(0)).div(a.length).toNumber()}},parameters:{varargs:[{name:"value",type:[{type:"number"},{type:"array",of:{type:"number"}}]}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"mean(1, 2, 3)",output:"2"},{input:"mean([1, 2, 3], 4, 5)",output:"3"}],[{input:"[1, 2, 3].mean()",output:"2"},{input:"[1, 2, 3].mean(4, 5)",output:"3"}]],syntax:["mean(list)","list.mean()"],description:M.mean},abs:(0,T().hq)("abs",M.abs,Math.abs,[10,-10]),round:{name:"round",*eval(e,t){const[n,r]=e;if(w("number"===n.type),void 0===r)return{type:"number",value:Math.round(n.value)};if(w("number"===r.type),0===r.value)return{type:"number",value:Math.round(n.value)};if(!Number.isInteger(r.value))throw new(b().x4)({type:b().v3.CannotRoundToNonInteger,precision:r.value});if(Math.abs(r.value)>12)throw new(b().x4)({type:b().v3.CannotRoundToTooManyDecimalPlaces,precision:r.value});const a=Math.pow(10,r.value);return{type:"number",value:Math.round(n.value*a)/a}},parameters:{varargs:[{name:"value",type:{type:"number"}},{name:"precision",type:{type:"number"}}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:"round(1.2345)",output:"1"}],[{input:"round(1.2345, 2)",output:"1.23"}]],syntax:["round(value, precision)","value.round(precision)"],description:M.round},ceil:(0,T().hq)("ceil",M.ceil,Math.ceil,[.4,-.6]),floor:(0,T().hq)("floor",M.floor,Math.floor,[.4,-.6]),sqrt:(0,T().hq)("sqrt",M.sqrt,Math.sqrt,[4,7]),cbrt:(0,T().hq)("cbrt",M.cbrt,Math.cbrt,[9,64]),exp:(0,T().hq)("exp",M.exp,Math.exp,[1,-1]),ln:(0,T().hq)("ln",M.ln,Math.log,[Math.E,10]),log10:(0,T().hq)("log10",M.log10,Math.log10,[10,1e5]),log2:(0,T().hq)("log2",M.log2,Math.log2,[4,1024]),sign:(0,T().hq)("sign",M.sign,Math.sign,[-10,10]),pi:(0,T().SU)("pi",M.pi,Math.PI),e:(0,T().SU)("e",M.e,Math.E),toNumber:{name:"toNumber",*eval(e,t){const[r]=e;switch(r.type){case"number":return r;case"checkbox":return{type:"number",value:r.value?1:0};case"text":{const e=yield*(0,k().o7)(r.value,t),a=/^0[xbo]/.test(e)?Number(e):parseFloat(e);return(0,n(720665).Et)(a)?{type:"number",value:a}:N}case"date":return{type:"number",value:(0,p().AA)(r.value,t.userTimeZone).start.valueOf()};case"array":throw new(b().x4)({type:b().v3.CannotUseToNumberOnList});default:return N}},parameters:{expected:[{name:"input",type:{type:"unknown"}}]},returnType:{type:"number"},iconType:{type:"number"},examples:[[{input:'toNumber("2")',output:"2"},{input:"toNumber(now())",output:(0,p().ln)((0,p().T_)((0,c().P)()),(0,c().P)()).toString()},{input:"toNumber(true)",output:"1"}],[{input:'"2".toNumber()',output:"2"},{input:"now().toNumber()",output:(0,p().ln)((0,p().T_)((0,c().P)()),(0,c().P)()).toString()},{input:"true.toNumber()",output:"1"}]],syntax:["toNumber(value)","value.toNumber()"],description:M.toNumber},now:{name:"now",*eval(e,t){return{type:"date",value:(0,p().T_)(t.userTimeZone)}},parameters:{},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:"now()",output:[(0,m().wmz)((0,m().Ww9)((0,p().T_)((0,c().P)())))]}]],syntax:["now()"],description:M.now},today:{name:"today",*eval(e,t){return{type:"date",value:(0,p().lN)((0,p().ah)(t.userTimeZone))}},parameters:{},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:"today()",output:[(0,m().wmz)((0,m().Ww9)((0,p().lN)((0,p().ah)((0,c().P)()))))]}]],syntax:["today()"],description:M.today},minute:{name:"minute",eval:(0,T().KN)((e=>e.minute)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'minute(parseDate("2023-07-10T17:35Z"))',output:"35"}],[{input:'parseDate("2023-07-10T17:35Z").minute()',output:"35"}]],syntax:["minute(date)","date.minute()"],description:M.minute},hour:{name:"hour",eval:(0,T().KN)((e=>e.hour)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'hour(parseDate("2023-07-10T17:35Z"))',output:"17"}],[{input:'parseDate("2023-07-10T17:35Z").hour()',output:"17"}]],syntax:["hour(date)","date.hour()"],description:M.hour},day:{name:"day",eval:(0,T().KN)((e=>e.weekday)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'day(parseDate("2023-07-10T17:35Z"))',output:"1"}],[{input:'parseDate("2023-07-10T17:35Z").day()',output:"1"}]],syntax:["day(date)","date.day()"],description:M.day},date:{name:"date",eval:(0,T().KN)((e=>e.day)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'date(parseDate("2023-07-10T17:35Z"))',output:"10"}],[{input:'parseDate("2023-07-10T17:35Z").date()',output:"10"}]],syntax:["date(date)","date.date()"],description:M.date},week:{name:"week",eval:(0,T().KN)((e=>e.weekNumber)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'week(parseDate("2023-01-02"))',output:"1"}],[{input:'parseDate("2023-01-02").week()',output:"1"}]],syntax:["week(date)","date.week()"],description:M.week},month:{name:"month",eval:(0,T().KN)((e=>e.month)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'month(parseDate("2023-07-10T17:35Z"))',output:"7"}],[{input:'parseDate("2023-07-10T17:35Z").month()',output:"7"}]],syntax:["month(date)","date.month()"],description:M.month},year:{name:"year",eval:(0,T().KN)((e=>e.year)),parameters:{expected:[{name:"date",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:"year(now())",output:a().c9.now().year.toString()}],[{input:"now().year()",output:a().c9.now().year.toString()}]],syntax:["year(date)","date.year()"],description:M.year},dateAdd:{name:"dateAdd",eval:(0,T().R)(((e,t,n)=>e.plus({[n]:t}).valueOf()),"dateAdd"),parameters:{expected:[{name:"input",type:{type:"date"}},{name:"num",type:{type:"number"}},{name:"unit",type:{type:"text"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:'dateAdd(now(), 1, "days")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.now().plus({days:1}))))]},{input:'dateAdd(now(), 2, "months")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.now().plus({months:2}))))]},{input:'dateAdd(now(), 3, "years")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.now().plus({years:3}))))]}],[{input:'now().dateAdd(1, "days")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.now().plus({days:1}))))]},{input:'now().dateAdd(2, "months")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.now().minus({months:2}))))]},{input:'now().dateAdd(3, "years")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.now().plus({years:3}))))]}]],syntax:["dateAdd(date, num, unit)","date.dateAdd(num, unit)"],description:M.dateAdd},dateSubtract:{name:"dateSubtract",eval:(0,T().R)(((e,t,n)=>e.minus({[n]:t}).valueOf()),"dateSubtract"),parameters:{expected:[{name:"input",type:{type:"date"}},{name:"num",type:{type:"number"}},{name:"unit",type:{type:"text"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:'dateSubtract(now(), 1, "days")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.now().minus({days:1}))))]},{input:'dateSubtract(now(), 2, "months")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.now().minus({months:2}))))]},{input:'dateSubtract(now(), 3, "years")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.now().minus({years:3}))))]}],[{input:'now().dateSubtract(1, "days")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.now().minus({days:1}))))]},{input:'now().dateSubtract(2, "months")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.now().minus({months:2}))))]},{input:'now().dateSubtract(3, "years")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.now().minus({years:3}))))]}]],syntax:["dateSubtract(date, num, unit)","date.dateSubtract(num, unit)"],description:M.dateSubtract},dateBetween:{name:"dateBetween",*eval(e,t){const[n,r,a]=e;w("date"===n.type&&"date"===r.type&&"text"===a.type);const o=(0,p().AA)(n.value,t.userTimeZone).start,s=(0,p().AA)(r.value,t.userTimeZone).start,i=yield*(0,T().Fd)(a.value,t,"dateBetween");return{type:"number",value:Math.trunc(o.diff(s,i).get(i))}},parameters:{expected:[{name:"left",type:{type:"date"}},{name:"right",type:{type:"date"}},{name:"unit",type:{type:"text"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:'dateBetween(now(), parseDate("2022-09-07"), "days")',output:Math.trunc(a().c9.now().diff(a().c9.fromISO("2022-09-07"),"days").days).toString()},{input:'dateBetween(parseDate("2030-01-01"), now(), "years")',output:Math.trunc(a().c9.fromISO("2030-01-01").diffNow("years").years).toString()}],[{input:'now().dateBetween(parseDate("2022-09-07"), "days")',output:Math.trunc(a().c9.now().diff(a().c9.fromISO("2022-09-07"),"days").days).toString()},{input:'parseDate("2030-01-01").dateBetween(now(), "years")',output:Math.trunc(a().c9.fromISO("2030-01-01").diffNow("years").years).toString()}]],syntax:["dateBetween(date, date, unit)","date.dateBetween(date, unit)"],description:M.dateBetween},dateRange:{name:"dateRange",*eval(e,t){const[n,r]=e;return w("date"===n.type&&"date"===r.type),"start_time"in n.value||"start_time"in r.value?{type:"date",value:{type:"datetimerange",start_date:n.value.start_date,start_time:"start_time"in n.value?n.value.start_time:"00:00",end_date:"end_date"in r.value?r.value.end_date:r.value.start_date,end_time:"end_time"in r.value?r.value.end_time:"start_time"in r.value?r.value.start_time:"23:59",time_zone:"time_zone"in n.value&&n.value.time_zone||"time_zone"in r.value&&r.value.time_zone||t.userTimeZone}}:{type:"date",value:{type:"daterange",start_date:n.value.start_date,end_date:"end_date"in r.value?r.value.end_date:r.value.start_date}}},parameters:{expected:[{name:"start",type:{type:"date"}},{name:"end",type:{type:"date"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:[["dateRange("],(0,T().Py)("Start Date"),[", "],(0,T().Py)("End Date"),[")"]],output:[(0,m().wmz)((0,m().Ww9)({type:"daterange",start_date:"2022-09-07",end_date:"2023-09-07"}))]}],[{input:[(0,T().Py)("Start Date"),[".dateRange("],(0,T().Py)("End Date"),[")"]],output:[(0,m().wmz)((0,m().Ww9)({type:"daterange",start_date:"2022-09-07",end_date:"2023-09-07"}))]}]],syntax:["dateRange(start, end)"],description:M.dateRange},dateStart:{name:"dateStart",*eval(e,t){const[n]=e;return w("date"===n.type),{type:"date",value:(0,u().j1)(n.value)}},parameters:{expected:[{name:"input",type:{type:"date"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:[["dateStart("],(0,T().Py)("Date Range"),[")"]],output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.fromISO("2022-09-07"))))]},{input:[["dateBetween(dateStart("],(0,T().Py)("Date Range"),["), dateEnd("],(0,T().Py)("Date Range"),['), "days")']],output:[["-365"]]}],[{input:[(0,T().Py)("Date Range"),[".dateStart()"]],output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.fromISO("2022-09-07"))))]},{input:[(0,T().Py)("Date Range"),[".dateStart().dateBetween("],(0,T().Py)("Date Range"),['.dateEnd(), "days")']],output:[["-365"]]}]],syntax:["dateStart(dateRange)","dateRange.dateStart()"],description:M.dateStart},dateEnd:{name:"dateEnd",*eval(e,t){const[n]=e;return w("date"===n.type),{type:"date",value:(0,u().mO)(n.value)}},parameters:{expected:[{name:"input",type:{type:"date"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:[["dateEnd("],(0,T().Py)("Date range"),[")"]],output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.fromISO("2023-09-07"))))]},{input:[["dateBetween(dateEnd("],(0,T().Py)("Date Range"),["), dateStart("],(0,T().Py)("Date Range"),['), "days")']],output:"365"}],[{input:[(0,T().Py)("Date Range"),[".dateEnd()"]],output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.fromISO("2023-09-07"))))]},{input:[(0,T().Py)("Date Range"),[".dateEnd().dateBetween("],(0,T().Py)("Date Range"),['.dateStart(), "days")']],output:"365"}]],syntax:["dateEnd(dateRange)","dataRange.dateEnd()"],description:M.dateEnd},timestamp:{name:"timestamp",*eval(e,t){const[n]=e;return w("date"===n.type),{type:"number",value:(0,p().ln)(n.value,t.userTimeZone)}},parameters:{expected:[{name:"input",type:{type:"date"}}]},returnType:{type:"number"},iconType:{type:"date"},examples:[[{input:"timestamp(now())",output:(0,p().ln)((0,p().T_)((0,c().P)()),(0,c().P)()).toString()}],[{input:"now().timestamp()",output:(0,p().ln)((0,p().T_)((0,c().P)()),(0,c().P)()).toString()}]],syntax:["timestamp(date)","date.timestamp()"],description:M.timestamp},fromTimestamp:{name:"fromTimestamp",*eval(e,t){const[n]=e;return w("number"===n.type),{type:"date",value:(0,p().KQ)(n.value,t.userTimeZone)}},parameters:{expected:[{name:"input",type:{type:"number"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:"fromTimestamp(1689024900000)",output:[(0,m().wmz)((0,m().Ww9)((0,p().KQ)(16890249e5,(0,c().P)())))]}],[{input:"1689024900000.fromTimestamp()",output:[(0,m().wmz)((0,m().Ww9)((0,p().KQ)(16890249e5,(0,c().P)())))]}]],syntax:["fromTimestamp(timestamp)","timestamp.fromTimestamp()"],description:M.fromTimestamp},formatDate:{name:"formatDate",*eval(e,t){const[n,r,a]=e;w("date"===(null==n?void 0:n.type)&&"text"===(null==r?void 0:r.type)),w(void 0===a||"text"===(null==a?void 0:a.type));const o=(0,T().m8)({timeZone:a,context:t});let s=(0,p().AA)((0,u().j1)(n.value),o,t.intl.locale).start;"datetime"!==n.value.type&&"datetimerange"!==n.value.type||(s=s.setZone(o));const i=yield*(0,k().o7)(r.value,t),l=`${Number(s)}:${o}:${t.intl.locale}:${i}`;let c=t.formatDateCache.get(l);return c||(c=(0,d().u)(s,i),t.formatDateCache.set(l,c)),{type:"text",value:(0,m().x9d)(c)}},parameters:{expected:[{name:"date",type:{type:"date"}},{name:"format",type:{type:"text"}},{name:"timezone",type:{type:"text"},optional:!0}]},returnType:{type:"text"},iconType:{type:"date"},examples:[[{input:'formatDate(now(), "MMMM D, Y")',output:[['"'],[(0,d().u)(a().c9.now(),"MMMM D, Y")],['"']]},{input:'formatDate(now(), "YYYY-MM-DD HH:mm")',output:[['"'],[(0,d().u)(a().c9.now(),"YYYY-MM-DD HH:mm")],['"']]},{input:'formatDate(now(), "h:mm A", "UTC+1")',output:[['"'],[(0,d().u)(a().c9.now().setZone("UTC+1"),"h:mm A")],['"']]}],[{input:'now().formatDate("MMMM D, Y")',output:[['"'],[(0,d().u)(a().c9.now(),"MMMM D, Y")],['"']]},{input:'now().formatDate("YYYY-MM-DD HH:mm")',output:[['"'],[(0,d().u)(a().c9.now(),"YYYY-MM-DD HH:mm")],['"']]},{input:'now().formatDate("h:mm A", "UTC+1")',output:[['"'],[(0,d().u)(a().c9.now().setZone("UTC+1"),"h:mm A")],['"']]}]],syntax:["formatDate(date, format, timezone?)","date.formatDate(format, timezone?)"],description:M.formatDate},parseDate:{name:"parseDate",*eval(e,t){const[n]=e;w("text"===n.type);const r=yield*(0,k().o7)(n.value,t),a=(0,l().zA)(r);return a?{type:"date",value:(0,l().pT)(a)}:N},parameters:{expected:[{name:"dateString",type:{type:"text"}}]},returnType:{type:"date"},iconType:{type:"date"},examples:[[{input:'parseDate("2022-01-01")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.fromISO("2022-01-01"))))]},{input:'parseDate("2022-01-01T00:00Z")',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.fromISO("2022-01-01T00:00Z"))))]}],[{input:'"2022-01-01".parseDate()',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.fromISO("2022-01-01"))))]},{input:'"2022-01-01T00:00Z".parseDate()',output:[(0,m().wmz)((0,m().Ww9)((0,l().pT)(a().c9.fromISO("2022-01-01T00:00Z"))))]}]],syntax:["parseDate(dateText)","dateText.parseDate()"],description:M.parseDate},name:{name:"name",*eval(e,t){const[n]=e;if(w("person"===n.type),(0,y().I6)(n.value)){const e=(0,y().S4)({spacePermissionGroupId:n.value.id,spaceId:n.value.spaceId}),r=(yield{recordPointers:[e]}).getRecordModel(e);if(!r)throw new(b().x4)({type:b().v3.UserNotFound});return{type:"text",value:(0,m().x9d)(r.getDisplayName(t.intl))}}if((0,i().Pu)(n.value)){const e=(yield{recordPointers:[n.value]}).getRecordModel(n.value);if(!e)throw new(b().x4)({type:b().v3.UserNotFound});return{type:"text",value:(0,m().x9d)(e.getDisplayName(t.intl))}}(0,s().HB)(n.value)},parameters:{expected:[{name:"person",type:{type:"person"}}]},returnType:{type:"text"},iconType:{type:"person"},examples:[[{input:[["name("],(0,T().pC)(h().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[")"]],isCopyable:!0},{input:[(0,T().Py)("Pioneers"),['.map(name(current)).join(", ")']],output:'"Grace Hopper, Ada Lovelace"'}],[{input:[(0,T().pC)(h().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[".name()"]],isCopyable:!0},{input:[(0,T().Py)("Pioneers"),['.map(current.name()).join(", ")']],output:'"Grace Hopper, Ada Lovelace"'}]],syntax:["name(person)","person.name()"],description:M.name},email:{name:"email",*eval(e,t){const[n]=e;if(w("person"===n.type),(0,y().I6)(n.value))return{type:"text",value:(0,m().x9d)("")};if((0,i().Pu)(n.value)){const e=(yield{recordPointers:[n.value]}).getRecordModel(n.value);if(!e)throw new(b().x4)({type:b().v3.UserNotFound});return e.isUser()?{type:"text",value:(0,m().x9d)(e.getEmail())}:N}(0,s().HB)(n.value)},parameters:{expected:[{name:"person",type:{type:"person"}}]},returnType:{type:"text"},iconType:{type:"person"},examples:[[{input:[["email("],(0,T().pC)(h().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[")"]],isCopyable:!0},{input:[(0,T().Py)("People"),['.map(email(current)).join(", ")']]}],[{input:[(0,T().pC)(h().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[".email()"]],isCopyable:!0},{input:[(0,T().Py)("People"),['.map(current.email()).join(", ")']]}]],syntax:["email(person)","person.email()"],description:M.email},at:{name:"at",*eval(e,t){const[n,r]=e;w("array"===n.type&&"number"===r.type);const a=n.values.at(r.value);return void 0!==a?a:N},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}},{name:"index",type:{type:"number"}}]},returnType:([e])=>"array"===(null==e?void 0:e.type)?e.of:{type:"unknown"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"at([1, 2, 3], 1)",output:"2"}],[{input:"[1, 2, 3].at(1)",output:"2"}]],syntax:["at(list, index)","list.at(index)"],description:M.at},first:{name:"first",*eval(e,t){const[n]=e;return w("array"===n.type),n.values.length>0?n.values[0]:N},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}}]},returnType:([e])=>"array"===(null==e?void 0:e.type)?e.of:{type:"unknown"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"first([1, 2, 3])",output:"1"}],[{input:"[1, 2, 3].first()",output:"1"},{input:"[].first()",output:"Empty"}]],syntax:["first(list)","list.first()"],description:M.first},last:{name:"last",*eval(e,t){const[n]=e;return w("array"===n.type),n.values.length>0?n.values[n.values.length-1]:N},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}}]},returnType:([e])=>"array"===(null==e?void 0:e.type)?e.of:{type:"unknown"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"last([1, 2, 3])",output:"3"}],[{input:"[1, 2, 3].last()",output:"3"}]],syntax:["last(list)","list.last()"],description:M.last},slice:{name:"slice",*eval(e,t){const[n,r,a]=e;return w("array"===n.type&&"number"===r.type),{type:"array",values:n.values.slice(r.value,"number"===(null==a?void 0:a.type)?a.value:void 0)}},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}},{name:"startIndex",type:{type:"number"}},{name:"endIndex",optional:!0,type:{type:"number"}}]},returnType:([e])=>"array"===(null==e?void 0:e.type)?e:{type:"array",of:{type:"unknown"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"slice([1, 2, 3], 1, 2)",output:"[2]"},{input:'slice(["a", "b", "c"], 1)',output:'["b", "c"]'}],[{input:"[1, 2, 3].slice(1, 2)",output:"[2]"},{input:'["a", "b", "c"].slice(1)',output:'["b", "c"]'}]],syntax:["slice(list, startIndex, endIndex?)","list.slice(startIndex, endIndex?)"],description:M.slice},splice:{name:"splice",*eval(e,t){const[n,r,a,...o]=e;w("array"===n.type&&"number"===r.type);const i=o.length>0?o.filter(s().O9):[],u=[...n.values];return u.splice(r.value,"number"===(null==a?void 0:a.type)?a.value:0,...i),{type:"array",values:u}},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}},{name:"startIndex",type:{type:"number"}},{name:"deleteCount",optional:!0,type:{type:"number"}}],varargs:[{name:"items",type:{type:"unknown"}}]},returnType:([e])=>"array"===(null==e?void 0:e.type)?e:{type:"array",of:{type:"unknown"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"splice([1, 2, 3], 1, 1)",output:"[1, 3]"},{input:'splice(["a", "b", "c"], 0, 1, "d")',output:'["d", "b", "c"]'}],[{input:"[1, 2, 3].splice(1, 1)",output:"[1, 3]"},{input:'["a", "b", "c"].splice(0, 1, "d")',output:'["d", "b", "c"]'}]],syntax:["splice(list, startIndex, deleteCount?, ...)","list.splice(startIndex, deleteCount?, ...)"],description:M.splice},concat:{name:"concat",*eval(e){return{type:"array",values:e.flatMap((e=>(w("array"===e.type),e.values.filter((e=>"undefined"!==e.type)))))}},parameters:{varargs:[{name:"arg",type:{type:"array",of:{type:"unknown"}}}]},returnType:e=>{const t=null==e?void 0:e[0];if(void 0===t)return{type:"array",of:{type:"unknown"}};for(let n=1;n<e.length;n++)if(void 0!==e[n]&&!(0,k().Re)(e[n],t))return{type:"array",of:{type:"unknown"}};return t},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"concat([1, 2], [3, 4])",output:"[1, 2, 3, 4]"},{input:'concat(["a", "b"], ["c", "d"])',output:'["a", "b", "c", "d"]'}],[{input:"[1, 2].concat([3, 4])",output:"[1, 2, 3, 4]"},{input:'["a", "b"].concat(["c", "d"])',output:'["a", "b", "c", "d"]'}]],syntax:["concat(list, list2, ...)","list.concat(list2, ...)"],description:M.concat},sort:{name:"sort",*eval(e,t){const[n,r]=e;w("array"===n.type);const a=n.values.filter((e=>"undefined"!==e.type));return{type:"array",values:void 0!==r?yield*(0,T().fr)(a,r,t):yield*(0,T().ZV)(a,t)}},parameters:C,returnType:([e])=>"array"===(null==e?void 0:e.type)?e:{type:"array",of:{type:"unknown"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"sort([3, 1, 2])",output:"[1, 2, 3]"},{input:"sort([1, 2, 3]).reverse()",output:"[3, 2, 1]"},{input:'sort(["Yash", "Stephen", "Paul", "Simon", "Ryo"])',output:'["Paul", "Ryo", "Simon", "Stephen", "Yash"]'},{input:[["sort("],(0,T().Py)("Task"),[", current."],(0,T().Py)("Date"),[")"]],isCopyable:!1}],[{input:"[3, 1, 2].sort()",output:"[1, 2, 3]"},{input:"[1, 2, 3].sort().reverse()",output:"[3, 2, 1]"},{input:'["Yash", "Stephen", "Paul", "Simon", "Ryo"].sort()',output:'["Paul", "Ryo", "Simon", "Stephen", "Yash"]'},{input:[(0,T().Py)("Task"),[".sort(current."],(0,T().Py)("Date"),[")"]],isCopyable:!1}]],syntax:["sort(list, expression?)","list.sort(expression?)"],description:M.sort},reverse:{name:"reverse",*eval(e,t){const[n]=e;w("array"===n.type);return{type:"array",values:[...n.values].reverse()}},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}}]},returnType:([e])=>"array"===(null==e?void 0:e.type)?e:{type:"array",of:{type:"unknown"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:'reverse(["green", "eggs", "ham"])',output:'["ham", "eggs", "green"]'}],[{input:'["green", "eggs", "ham"].reverse()',output:'["ham", "eggs", "green"]'}]],syntax:["reverse(list)","list.reverse()"],description:M.reverse},join:{name:"join",*eval(e,t){const[r,a]=e;w("array"===r.type&&"text"===a.type);const o=r.values.map((e=>(0,k().Ht)(e)));return{type:"text",value:(0,m().__s)((0,n(681873).G)(o,(()=>a.value)).flat())}},parameters:{expected:[{name:"input",type:{type:"array",of:{type:"unknown"}}},{name:"joiner",type:{type:"text"}}]},returnType:{type:"text"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:'join(["a", "b", "c"], ", ")',output:'"a, b, c"'},{input:'join(["dog", "go"], "")',output:'"doggo"'}],[{input:'["a", "b", "c"].join(", ")',output:'"a, b, c"'},{input:'["dog", "go"].join("")',output:'"doggo"'}]],syntax:["join(list, joiner)","list.join(joiner)"],description:M.join},split:{name:"split",*eval(e,t){const[n,r]=e;w("text"===n.type),w(void 0===r||"text"===r.type);const[a,o]=yield*(0,k().h8)([n.value,null==r?void 0:r.value],t);if(""===a)return{type:"array",values:[]};const s=" "===o||void 0===r,i=s?/\s+/:o;return{type:"array",values:a.split(i).filter((e=>!s||e.length>0)).map((e=>({type:"text",value:(0,m().x9d)(e)})))}},parameters:{expected:[{name:"input",type:{type:"text"}},{name:"separator",optional:!0,type:{type:"text"}}]},returnType:{type:"array",of:{type:"text"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:'split("apple,pear,orange", ",")',output:'["apple", "pear", "orange"]'}],[{input:'"apple,pear,orange".split(",")',output:'["apple", "pear", "orange"]'}]],syntax:["split(text, separator)","text.split(separator)"],description:M.split},unique:{name:"unique",*eval(e,t){const[n]=e;w("array"===n.type);const r=[];for(const a of n.values){(yield*(0,x().KZ)(r.map((e=>(0,k().zV)(e,a,t))))).some((e=>e))||r.push(a)}return{type:"array",values:r}},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}}]},returnType:([e])=>"array"===(null==e?void 0:e.type)?e:{type:"array",of:{type:"unknown"}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"unique([1, 1, 2])",output:"[1, 2]"}],[{input:"[1, 1, 2].unique()",output:"[1, 2]"}]],syntax:["unique(list)","list.unique()"],description:M.unique},includes:{name:"includes",*eval(e,t){const[n,r]=e;w("array"===n.type);for(const a of n.values){if(yield*(0,k().zV)(a,r,t))return{type:"checkbox",value:!0}}return{type:"checkbox",value:!1}},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}},{name:"needle",type:{type:"unknown"}}]},returnType:{type:"checkbox"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:'includes(["a", "b", "c"], "b")',output:"true"},{input:"includes([1, 2, 3], 4)",output:"false"}],[{input:'["a", "b", "c"].includes("b")',output:"true"},{input:"[1, 2, 3].includes(4)",output:"false"}]],syntax:["includes(list, search)","list.includes(search)"],description:M.includes},find:{name:"find",*eval(e,t){const[n,r]=e;let a,o;w("array"===n.type);for(let s=0;s<n.values.length;s++)if(a=n.values[s],o=yield*(0,T().iZ)(r,{...t,values:[...O(a,s),...t.values]}),(0,k().CL)(o))return a;return{type:"undefined"}},parameters:E,returnType:([e,t])=>"array"===(null==e?void 0:e.type)?e.of:{type:"unknown"},iconType:{type:"text"},examples:[[{input:'find(["a", "b", "c"], current == "b")',output:'"b"'},{input:"find([1, 2, 3], current > 100)",output:"Empty"}],[{input:'["a", "b", "c"].find(current == "b")',output:'"b"'},{input:"[1, 2, 3].find(current > 100)",output:"Empty"}]],syntax:["find(list, condition)","list.find(condition)"],description:M.find},findIndex:{name:"findIndex",*eval(e,t){const[n,r]=e;let a,o;w("array"===n.type);for(let s=0;s<n.values.length;s++)if(a=n.values[s],o=yield*(0,T().iZ)(r,{...t,values:[...O(a,s),...t.values]}),(0,k().CL)(o))return{type:"number",value:s};return{type:"number",value:-1}},parameters:E,returnType:{type:"number"},iconType:{type:"text"},examples:[[{input:'findIndex(["a", "b", "c"], current == "b")',output:"1"},{input:"findIndex([1, 2, 3], current > 100)",output:"-1"}],[{input:'["a", "b", "c"].findIndex(current == "b")',output:"1"},{input:"[1, 2, 3].findIndex(current > 100)",output:"-1"}]],syntax:["findIndex(list, condition)","list.findIndex(condition)"],description:M.findIndex},filter:{name:"filter",*eval(e,t){const[n,r]=e;w("array"===n.type);const a=yield*(0,T()._2)(n.values,r,t);return{type:"array",values:n.values.filter(((e,t)=>(0,k().CL)(a[t])))}},parameters:E,returnType:([e,t])=>"array"===(null==e?void 0:e.type)?e:{type:"unknown"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"filter([1, 2, 3], current > 1)",output:"[2, 3]"},{input:'filter(["a", "b", "c"], current == "a")',output:'["a"]'}],[{input:"[1, 2, 3].filter(current > 1)",output:"[2, 3]"},{input:'["a", "b", "c"].filter(current == "a")',output:'["a"]'}]],syntax:["filter(list, condition)","list.filter(condition)"],description:M.filter},some:{name:"some",*eval(e,t){const[n,r]=e;let a,o;w("array"===n.type);for(let s=0;s<n.values.length;s++)if(a=n.values[s],o=yield*(0,T().iZ)(r,{...t,values:[...O(a,s),...t.values]}),(0,k().CL)(o))return{type:"checkbox",value:!0};return{type:"checkbox",value:!1}},parameters:E,returnType:{type:"checkbox"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"some([1, 2, 3], current == 2)",output:"true"},{input:'some(["a", "b", "c"], current.length > 2)',output:"false"}],[{input:"[1, 2, 3].some(current == 2)",output:"true"},{input:'["a", "b", "c"].some(current.length > 2)',output:"false"}]],syntax:["some(list, expression)","list.some(expression)"],description:M.some},every:{name:"every",*eval(e,t){const[n,r]=e;let a,o;w("array"===n.type);for(let s=0;s<n.values.length;s++)if(a=n.values[s],o=yield*(0,T().iZ)(r,{...t,values:[...O(a,s),...t.values]}),!(0,k().CL)(o))return{type:"checkbox",value:!1};return{type:"checkbox",value:!0}},parameters:E,returnType:{type:"checkbox"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"every([1, 2, 3], current > 0)",output:"true"},{input:'every(["a", "b", "c"], current == "b")',output:"false"}],[{input:"[1, 2, 3].every(current > 0)",output:"true"},{input:'["a", "b", "c"].every(current == "b")',output:"false"}]],syntax:["every(list, condition)","list.every(condition)"],description:M.every},map:{name:"map",*eval(e,t){const[n,r]=e;return w("array"===n.type),{type:"array",values:yield*(0,T()._2)(n.values,r,t)}},parameters:E,returnType:([e,t])=>({type:"array",of:t??{type:"unknown"}}),iconType:{type:"array",of:{type:"text"}},examples:[[{input:"map([1, 2, 3], current + 1)",output:"[2, 3, 4]"},{input:"map([1, 2, 3], current + index)",output:"[1, 3, 5]"}],[{input:"[1, 2, 3].map(current + 1)",output:"[2, 3, 4]"},{input:"[1, 2, 3].map(current + index)",output:"[1, 3, 5]"}]],syntax:["map(list, expression)","list.map(expression)"],description:M.map},flat:{name:"flat",*eval(e,t){const[n]=e;w("array"===n.type);const r=[];for(const a of n.values)"array"===a.type?r.push(...a.values):r.push(a);return{type:"array",values:r}},parameters:{expected:[{name:"list",type:{type:"array",of:{type:"unknown"}}}]},returnType:([e])=>{let t={type:"unknown"};return"array"===(null==e?void 0:e.type)&&(t="array"===e.of.type?e.of.of:e.of),{type:"array",of:t}},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"flat([1, 2, 3])",output:"[1, 2, 3]"},{input:"flat([[1, 2], [3, 4]])",output:"[1, 2, 3, 4]"}],[{input:"[1, 2, 3].flat()",output:"[1, 2, 3]"},{input:"[[1, 2], [3, 4]].flat()",output:"[1, 2, 3, 4]"}]],syntax:["flat(list, list2?, ...)","list.flat(list2?, ...)"],description:M.flat},id:{name:"id",*eval(e,t){const[n]=e;if(!n){var r;const e=null===(r=t.values.find((e=>e.kind===h().FormulaContextValueKind.ThisRow)))||void 0===r?void 0:r.value;if("block"!==(null==e?void 0:e.type))throw new(b().x4)({type:b().v3.TryingToGetIdWithoutThisRow});return{type:"text",value:(0,m().x9d)((0,o().Xw)(e.value.id))}}return w("block"===n.type||"person"===n.type),{type:"text",value:(0,m().x9d)((0,o().Xw)(n.value.id))}},parameters:{expected:[{name:"value",type:[{type:"person"},{type:"block"}],optional:!0}]},returnType:{type:"text"},iconType:{type:"text"},syntax:["id(value?)","value.id()"],examples:[[{input:"id()"},{input:[["id("],(0,T().Py)("Relation"),[".first())"]]},{input:[["id("],(0,T().Py)("Person"),[".first())"]]}],[{input:[(0,T().Py)("Relation"),[".first().id()"]]},{input:[(0,T().Py)("Person"),[".first().id()"]]}]],description:M.id},equal:{name:"equal",*eval(e,t){const[n,r]=e;return{type:"checkbox",value:yield*(0,k().zV)(n,r,t)}},parameters:{expected:[{name:"lhs",type:{type:"unknown"}},{name:"rhs",type:{type:"unknown"}}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:"equal(1, 1)",output:"true"},{input:'"a" == "b"',output:"false"}],[{input:"1.equal(1)",output:"true"},{input:'"a" == "b"',output:"false"}]],syntax:["equal(value, value)","value.equal(value)"],description:M.equal},unequal:{name:"unequal",*eval(e,t){const[n,r]=e;return{type:"checkbox",value:!(yield*(0,k().zV)(n,r,t))}},parameters:{expected:[{name:"lhs",type:{type:"unknown"}},{name:"rhs",type:{type:"unknown"}}]},returnType:{type:"checkbox"},iconType:{type:"checkbox"},examples:[[{input:"unequal(1, 2)",output:"true"},{input:'"a" != "a"',output:"false"}],[{input:"1.unequal(2)",output:"true"},{input:'"a" != "a"',output:"false"}]],syntax:["unequal(value, value)","value.unequal(value)"],description:M.unequal},let:{name:"let",*eval(e,t){const n=e.map((e=>(0,f().F$)(e)));return yield*(0,T().sj)(n,t)},parameters:{varargs:[{name:"args",type:{type:"expression"}}]},returnType:([e,t,n])=>n??{type:"unknown"},iconType:{type:"text"},examples:[[{input:'let(name, "Doug Engelbart", "Hello, " + name + "!")',output:'"Hello, Doug Engelbart!"'},{input:"let(radius, 4, round(pi() * radius ^ 2))",output:"50"}],[{input:'name.let("Alan Kay", "Hello, " + name + "!")',output:'"Hello, Alan Kay!"'},{input:"radius.let(4, round(pi() * radius ^ 2)",output:"50"}]],syntax:["let(variable, value, expression)","variable.let(value, expression)"],description:M.let},lets:{name:"lets",*eval(e,t){const n=e.map((e=>(0,f().F$)(e)));return yield*(0,T().sj)(n,t)},parameters:{varargs:[{name:"args",type:{type:"expression"}}]},returnType:e=>e[e.length-1]??{type:"unknown"},iconType:{type:"text"},examples:[[{input:'lets(a, "Hello", b, "world", a + " " + b)',output:'"Hello world"'},{input:"lets(base, 3, height, 8, base * height / 2)",output:"12"}],[]],syntax:["lets(variable, value, variable2, value2, ..., expression)","variable.lets(value, variable2, value2, ..., expression)"],description:M.lets},_unsafeCastArray:{name:"_unsafeCastArray",description:M._unsafeCastArray,*eval(e,t){const[n,r]=e;return w("array"===n.type),w("array"===r.type),n},parameters:{expected:[{name:"arrayToConvert",type:{type:"array",of:{type:"unknown"}}},{name:"typeTemplate",type:{type:"array",of:{type:"unknown"}}}]},returnType:([e,t])=>t??{type:"unknown"},iconType:{type:"array",of:{type:"unknown"}},examples:[[{input:"_unsafeCastArray([1, 2, 3], [true, false])",output:"[1, 2, 3]"}]],syntax:["_unsafeCastArray(arrayToConvert, typeTemplate)"]},count:{name:"count",description:M.count,*eval(e,t){const[n,r]=e;if(w("array"===n.type),!(0,s().O9)(r))return{type:"number",value:n.values.length};let a=0;return yield*(0,x().KZ)(n.values.map((function*(e,n){const o=yield*(0,T().iZ)(r,{...t,values:[{kind:h().FormulaContextValueKind.Binding,id:h().CURRENT_VALUE_NAME,value:e},{kind:h().FormulaContextValueKind.Binding,id:h().CURRENT_INDEX_NAME,value:{type:"number",value:n}},...t.values]});(0,k().CL)(o)&&(a+=1)}))),{type:"number",value:a}},parameters:C,returnType:([e])=>"array"===(null==e?void 0:e.type)?{type:"number"}:{type:"unknown"},iconType:{type:"number"},examples:[[{input:"count([1, 2, 3, 4], current % 2 == 0)",output:"2"},{input:'count(["a", "b", "c"], current == "d")',output:"0"}],[{input:"[1, 2, 3, 4].count(current % 2 == 0)",output:"2"},{input:'["a", "b", "c"].count(current == "d")',output:"0"}]],syntax:["count(list, condition)","list.count(condition)"]}},A=(M._wait,R),P=["block","array","person"],F=["let","lets"];function O(e,t){return[{kind:h().FormulaContextValueKind.Binding,id:h().CURRENT_VALUE_NAME,value:e},{kind:h().FormulaContextValueKind.Binding,id:h().CURRENT_INDEX_NAME,value:{type:"number",value:t}}]}function S({context:e,pattern:t,flags:n}){const r=`${t}|${n}`,a=e.regExpCache.get(r);if(a)return a.lastIndex=0,a;let o;if("[^T]*$"===t)try{o=new RegExp("(?<=^|T)[^T]*$",n)}catch(s){o=new RegExp(t,n)}else o=new RegExp(t,n);return e.regExpCache.set(r,o),o}const L={if:"generic",ifs:"generic",let:"generic",lets:"generic",and:"generic",or:"generic",not:"generic",equal:"generic",unequal:"generic",empty:"generic",length:"generic",format:"generic",concat:"text",join:"text",split:"text",substring:"text",contains:"text",lower:"text",upper:"text",trim:"text",replace:"text",replaceAll:"text",test:"text",match:"text",link:"text",style:"text",unstyle:"text",padStart:"text",padEnd:"text",repeat:"text",add:"number",subtract:"number",multiply:"number",divide:"number",mod:"number",pow:"number",sum:"number",max:"number",min:"number",mean:"number",median:"number",abs:"number",round:"number",ceil:"number",floor:"number",sqrt:"number",cbrt:"number",exp:"number",ln:"number",log10:"number",log2:"number",sign:"number",pi:"number",e:"number",toNumber:"number",formatNumber:"number",now:"date",today:"date",minute:"date",hour:"date",day:"date",date:"date",month:"date",year:"date",week:"date",dateAdd:"date",dateSubtract:"date",dateBetween:"date",formatDate:"date",fromTimestamp:"date",timestamp:"date",dateStart:"date",dateEnd:"date",dateRange:"date",parseDate:"date",name:"people",email:"people",at:"list",first:"list",last:"list",slice:"list",splice:"list",reverse:"list",sort:"list",unique:"list",includes:"list",map:"list",filter:"list",find:"list",findIndex:"list",some:"list",every:"list",flat:"list",count:"list",id:"special",_unsafeCastArray:"internal",_wait:"internal"}},662358:(e,t,n)=>{n.d(t,{If:()=>V,LL:()=>D,MA:()=>G,O9:()=>H,OH:()=>S,PR:()=>L,Rn:()=>_,dt:()=>Y,ir:()=>W,oj:()=>q,qL:()=>$,qU:()=>O,rb:()=>B,ym:()=>Z});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(672577),n(430670),n(581454),n(737550);var r=n.n(n(598629)),a=()=>n(319625),o=()=>n(496603),s=()=>n(973647),i=()=>n(534177),u=()=>n(764880),p=()=>n(657970),l=()=>n(187696),d=()=>n(302322),c=()=>n(363170),y=()=>n(716016),m=()=>n(713998),f=()=>n(568063),h=()=>n(835195),v=()=>n(835243),x=()=>n(792071),g=()=>n(696706),b=()=>n(179034),k=()=>n(519831),T=()=>n(797809),M=()=>n(201980),w=()=>n(342581),N=()=>n(247331),I=()=>n(696446),E=()=>n(106714),C=()=>n(80979),R=()=>n(349835),A=()=>n(239381),P=()=>n(383969),F=()=>n(373907);const O=3e5;function*S(e,t){var n;const r=yield*(0,I().Xq)(e);if(r)return{collectionPointer:r.pointer,schema:r.getNormalizedSchema()};const a=e.getParentPointer();return a.table===k().Vl&&a.id===(null===(n=t.publicPageDataCollection)||void 0===n?void 0:n.id)?{collectionPointer:a,schema:t.publicPageDataCollection.schema}:{collectionPointer:void 0,schema:void 0}}function*L(e){const{block:t,property:n,parentCollectionPointer:r,schema:a,propertySchema:g,oldContext:T,evaluateAST:E}=e;if("rollup"===g.type){const e=`${t.id}:${n}`;if(T.visitedProperties.has(e))throw new(R().I3)({type:R().uW.CycleDetected,errorSource:{blockId:t.id,collectionId:r.id,propertyId:n}});const s=new Set(T.visitedProperties);s.add(e);const u=(0,w().wr)({resultCache:T.resultCache,blockId:t.id,property:n});if(void 0!==u)return u;const p={...T,visitedProperties:s,depth:T.depth+1};if(g.aggregation&&"show_unique"!==g.aggregation){var O;const e=yield*(0,I().OH)(n,a),{relation_property:o}=g;if(null==e||!e.targetCollectionPointer||!o)return{type:"undefined"};const s=(0,m().n)(null===(O=t.getProperties())||void 0===O?void 0:O[o]);if(void 0===s)return{type:"undefined"};s.push(e.targetCollectionPointer),s.push(t.pointer);const{getRecordModel:i}=yield{recordPointers:s,collectionBlockProperties:[{blockPointers:[t.pointer],collectionPointer:r,schema:a,property:n}]},u={error:null},l=(0,f().Pm)({property:n,schema:a,block:t,getRecordModel:i,collectionRequestContext:{...p,userId:void 0},formula2Error:u,formulasModule:C(),spaceIdCreator:T.spaceIdCreator});if(null!==u.error){if(!u.error.info.errorSource)throw new(R().I3)({...u.error.info,errorSource:{blockId:t.id,collectionId:r.id,propertyId:n}});throw u.error}if(void 0===l)return{type:"undefined"};const d=function(e){if(void 0===e.value)return{type:"undefined"};switch(e.type){case"text":return{type:"text",value:(0,M().x9d)(e.value)};case"number":return{type:"number",value:e.value};case"date":return{type:"date",value:e.value}}}(l);return(0,w().wZ)({resultCache:p.resultCache,blockId:t.id,property:n,value:d}),d}{var S;const e=yield*(0,I().OH)(n,a),{relation_property:r}=g;if(void 0===e||void 0===r)return{type:"undefined"};if("person"===e.rollupType)return{type:"undefined"};const{relationPropertySchema:s,targetCollectionSchema:u,targetCollectionModel:l,targetProperty:d}=e,c=(0,m().n)(null===(S=t.getProperties())||void 0===S?void 0:S[r]),y=yield*(0,I().Sp)(c,s);if(0===y.length){const e={type:"array",values:[]};return(0,w().wZ)({resultCache:p.resultCache,blockId:t.id,property:n,value:e}),e}const f=yield*(0,I().KZ)(y.flatMap((e=>{const t=u[d];if(void 0===t)return[];const n={kind:N().FormulaContextValueKind.ThisRow,value:{type:"block",value:e.pointer}};return p.values=[n],[L({block:e,property:d,parentCollectionPointer:l.pointer,schema:u,propertySchema:t,oldContext:p,evaluateAST:E})]}))),v=(0,A().U)({type:"array",values:f});if(v.values.length&&"show_unique"===g.aggregation){const e=(0,w().wr)({resultCache:T.resultCache,blockId:t.id,property:n});if(void 0!==e)return e;c.push(t.pointer);const r=v.values.map((e=>"block"===e.type?e.value:void 0)).filter(i().O9);c.push(...r);const{getRecordModel:a}=yield{recordPointers:c},{getRecordModel:s}=yield{recordPointers:r.map((e=>a(e))).filter(i().O9).flatMap((e=>(0,m().dg)(e.getProperty("title"))))},u=x().b4_.tryUntilFound(a,s),l=o().hS(v.values,(e=>(0,h().R2)({result:e,getRecordModel:u,userTimeZone:p.userTimeZone,intl:p.intl}))),d={type:"array",values:l};return(0,w().wZ)({resultCache:p.resultCache,blockId:t.id,property:n,value:d}),d}const b={type:"array",values:v.values};return(0,w().wZ)({resultCache:p.resultCache,blockId:t.id,property:n,value:b}),b}}if("formula"===g.type){const e=`${t.id}:${n}`;if(T.visitedProperties.has(e))throw new(R().I3)({type:R().uW.CycleDetected,errorSource:{blockId:t.id,collectionId:r.id,propertyId:n}});const o=new Set(T.visitedProperties);if("v2"===g.version){o.add(e);const r=(0,w().wr)({resultCache:T.resultCache,blockId:t.id,property:n});if(void 0!==r)return r}const i={...T,visitedProperties:o,depth:T.depth+1};if(void 0===g.version){const{getRecordModel:e}=yield{collectionBlockProperties:[{blockPointers:[t.pointer],collectionPointer:r,schema:a,property:n}]},o={error:null},s=(0,P().L7)({schema:a,property:n,block:t,getRecordModel:e,collectionRequestContext:{userId:void 0,userTimeZone:i.userTimeZone,intl:i.intl,depth:i.depth,resultCache:i.resultCache,regExpCache:i.regExpCache,formatDateCache:i.formatDateCache,logFormulaTimeoutFn:i.logFormulaTimeoutFn,visitedProperties:i.visitedProperties,experimentService:i.experimentService,collectionFeatureGates:i.collectionFeatureGates},formula2Error:o,spaceIdCreator:T.spaceIdCreator});if(null!==o.error){if(!o.error.info.errorSource)throw new(R().I3)({...o.error.info,errorSource:{blockId:t.id,collectionId:r.id,propertyId:n}});throw o.error}switch(typeof s){case"string":return{type:"text",value:(0,M().x9d)(s)};case"number":return{type:"number",value:s};case"boolean":return{type:"checkbox",value:s};case"object":return{type:"date",value:s};default:return{type:"undefined"}}}else{var B;const e=null===(B=g.formula2)||void 0===B?void 0:B.code;if(!e)return{type:"undefined"};const a=(0,w().wr)({resultCache:i.resultCache,blockId:t.id,property:n});if(void 0!==a)return a;const o=(0,F().$t)(e);if(s().Q.isFail(o)){if(i.throwOnDownstreamParseFailures)throw new(R().I3)({type:R().uW.DownstreamParseFailure,parserError:o.error,collectionId:r.id,property:n,errorSource:{blockId:t.id,collectionId:r.id,propertyId:n}});return{type:"undefined"}}const u={kind:N().FormulaContextValueKind.ThisRow,value:{type:"block",value:t.pointer}};i.values=[u];try{const e=yield*E(o.value,i);return(0,w().wZ)({resultCache:i.resultCache,blockId:t.id,property:n,value:e}),e}catch(q){if(q instanceof R().I3&&!q.info.errorSource)throw new(R().I3)({...q.info,errorSource:{blockId:t.id,collectionId:r.id,propertyId:n}});throw q}}}else if((0,i().Xk)(N().FormulaTokenSupportedBlockSystemPropertyList,g.type))return(0,A().ve)(t,g.type);const U=(0,m().xr)(t,n,a),D=yield{recordPointers:[r,...null!=U&&U.eoipPointer?[U.eoipPointer]:[]]},_=(0,m().yQ)(t,n,D.getRecordModel);if("status"===g.type){const e=(0,m().RZ)(_,g);return void 0===e?{type:"undefined"}:{type:"text",value:(0,M().x9d)(e)}}if("checkbox"===g.type&&void 0===_)return{type:"checkbox",value:!1};if(("relation"===g.type||"multi_select"===g.type)&&void 0===_)return{type:"array",values:[]};if("person"===g.type&&void 0===_){const e=t.getCreatedByPointer();return"created_by"===g.default&&void 0!==e&&(0,u().Pu)(e)?{type:"array",values:[{type:"person",value:e}]}:{type:"array",values:[]}}if(void 0===_)return{type:"undefined"};switch(g.type){case"title":case"text":case"url":case"email":case"place":return{type:"text",value:_};case"phone_number":return{type:"text",value:(0,M().x9d)((0,M().k4p)(_))};case"select":{const e=(0,m().L3)(_,g.options??[]);return void 0===e?{type:"undefined"}:{type:"text",value:(0,M().x9d)(e)}}case"multi_select":return{type:"array",values:(0,m().o2)(_,g.options??[]).map((e=>({type:"text",value:(0,M().x9d)(e)})))};case"checkbox":return{type:"checkbox",value:(0,p().w)(_)};case"date":{const e=(0,l().b)(_);return void 0===e?{type:"undefined"}:{type:"date",value:e}}case"person":return{type:"array",values:(0,c().e)({textValue:_,propertySchema:g,blockCreatorPointer:void 0}).map((e=>({type:"person",value:e})))};case"relation":return{type:"array",values:(yield*(0,I().Sp)((0,m().n)(_),g)).map((e=>({type:"block",value:{table:b().ev,id:e.id,spaceId:e.getSpaceId()}})))};case"number":const e=(0,d().M)(_);return"number"==typeof e?{type:"number",value:e}:{type:"undefined"};case"auto_increment_id":{var G;const e=yield*(0,I().Xq)(t);if(!e)return{type:"undefined"};const n=(0,v().aZ)({spaceId:t.getSpaceId(),parentTable:k().Vl,parentId:e.id}),{getRecordModel:r}=yield{recordPointers:[n]},a=null===(G=r(n))||void 0===G?void 0:G.getRecordKey(),o=(0,d().M)(_),s=(0,y().H4)(a,o);return void 0!==s?{type:"text",value:[[s]]}:{type:"undefined"}}case"file":return{type:"array",values:(0,m().pJ)(_).map((({url:e})=>({type:"text",value:(0,M().x9d)(e)})))};case"created_time":case"last_edited_time":case"created_by":case"last_edited_by":case"last_visited_time":case"button":case"location":case"verification":return{type:"undefined"};default:(0,i().HB)(g)}}function B(e){if("number"===e.type)return{type:"number",value:(0,o().LI)(e.value,12)};if("array"===e.type){return{type:"array",values:e.values.map((e=>"number"===e.type?{type:"number",value:(0,o().LI)(e.value,12)}:e))}}return e}function U(e,t,n){if("number"!==t.type&&"undefined"!==t.type)throw new(R().I3)({type:R().uW.CannotDoMathOnType,op:n,operand:e,valueType:t.type})}function D(e,t,n){if("undefined"===t.type&&"undefined"===n.type)return{type:"number",value:0};switch("undefined"===t.type&&"number"===n.type?t={type:"number",value:0}:"undefined"===n.type&&"number"===t.type&&(n={type:"number",value:0}),e.op){case"+":return"number"===t.type&&"number"===n.type?Number.isInteger(t.value)&&Number.isInteger(n.value)?{type:"number",value:t.value+n.value}:{type:"number",value:new(r())(t.value).add(n.value).toNumber()}:{type:"text",value:(0,M().__s)((0,A().Ht)(t).concat((0,A().Ht)(n)))};case"-":if(U(e.lhs,t,e.op),U(e.rhs,n,e.op),"number"===t.type&&"number"===n.type)return Number.isInteger(t.value)&&Number.isInteger(n.value)?{type:"number",value:t.value-n.value}:{type:"number",value:new(r())(t.value).minus(n.value).toNumber()}}return{type:"undefined"}}function _(e,t,n){if(U(e.lhs,t,e.op),U(e.rhs,n,e.op),"undefined"===t.type&&"undefined"===n.type)return{type:"number",value:0};switch("undefined"===t.type&&"number"===n.type?t={type:"number",value:0}:"undefined"===n.type&&"number"===t.type&&(n={type:"number",value:0}),e.op){case"*":if("number"===t.type&&"number"===n.type)return Number.isInteger(t.value)&&Number.isInteger(n.value)?{type:"number",value:t.value*n.value}:{type:"number",value:new(r())(t.value).mul(n.value).toNumber()};break;case"/":if("number"===t.type&&"number"===n.type)return 0===n.value?{type:"undefined"}:{type:"number",value:new(r())(t.value).div(n.value).toNumber()};break;case"%":if("number"===t.type&&"number"===n.type)return 0===n.value?{type:"undefined"}:Number.isInteger(n.value)?{type:"number",value:t.value%n.value}:{type:"number",value:new(r())(t.value).mod(n.value).toNumber()}}return{type:"undefined"}}function*G(e,t,n,r){if("undefined"===t.type||"undefined"===n.type)return{type:"checkbox",value:!1};if("date"===t.type&&"date"===n.type){const a=(0,A().i3)(t.value,n.value,r.userTimeZone);switch(e.op){case"<":return{type:"checkbox",value:a<0};case"<=":return{type:"checkbox",value:a<=0};case">":return{type:"checkbox",value:a>0};case">=":return{type:"checkbox",value:a>=0}}}if("text"===t.type&&"text"===n.type){const[a,o]=yield*(0,A().h8)([t.value,n.value],r);switch(e.op){case"<":return{type:"checkbox",value:a<o};case"<=":return{type:"checkbox",value:a<=o};case">":return{type:"checkbox",value:a>o};case">=":return{type:"checkbox",value:a>=o}}}if("number"===t.type&&"number"===n.type||"checkbox"===t.type&&"checkbox"===n.type)switch(e.op){case"<":return{type:"checkbox",value:t.value<n.value};case"<=":return{type:"checkbox",value:t.value<=n.value};case">":return{type:"checkbox",value:t.value>n.value};case">=":return{type:"checkbox",value:t.value>=n.value}}throw new(R().I3)({type:R().uW.CannotRelativelyCompareTypes,lhs:e.lhs,rhs:e.rhs,lhsType:t.type,rhsType:n.type})}function q(e,t,n){if(U(e.lhs,t,e.op),U(e.rhs,n,e.op),"^"===e.op)if("number"===t.type&&"number"===n.type)return!Number.isInteger(t.value)&&Number.isInteger(n.value)?{type:"number",value:new(r())(t.value).pow(n.value).toNumber()}:{type:"number",value:t.value**n.value};return{type:"undefined"}}function V(e,t){const n=e.op;switch(n){case"-":if("number"!==t.type)throw new(R().I3)({type:R().uW.UnaryMinusOnNonNumber,node:e.expression,expressionType:t.type});return{type:"number",value:-t.value};case"!":case"not":return{type:"checkbox",value:!(0,A().CL)(t)};default:return(0,i().HB)(n)}}function*W(e){const{node:t,token:n,context:r,evaluateAST:a}=e;if((0,A().ix)(n))return yield*function*(e){const{node:t,token:n,context:r,evaluateAST:a}=e,o=r.values.find((e=>e.kind===N().FormulaContextValueKind.ContextValue&&e.id===(0,A().GH)(n.contextValueId)));if(void 0===o)throw new(R().I3)({type:R().uW.MissingContextVariable,node:t,valueId:n.contextValueId});if("block"!==o.value.type)throw new(R().I3)({type:R().uW.ContextVariableWrongType,node:t,valueId:n.contextValueId,expectedType:"block",resultType:o.value.type});const s=o.value.value,i=(yield{recordPointers:[s]}).getRecordModel(s);if(void 0===i)throw new(R().I3)({type:R().uW.MissingDataDependencyBlock,node:t,blockPointer:s});const u=(0,A().Yi)(n.property),{collectionPointer:p,schema:l}=yield*S(i,r);if(!p){if(T().PJ(u))return(0,A().ve)(i,u);throw new(R().I3)({type:R().uW.MissingDataDependencyBlock,node:t,blockPointer:i.pointer})}if(T().PJ(u))return(0,A().ve)(i,u);const d=null==l?void 0:l[u];if(void 0===d||void 0===l)throw new(R().I3)({type:R().uW.MissingSchemaPropertyOnCollection,node:t,collectionId:i.getParentId(),property:u});return yield*L({block:i,parentCollectionPointer:p,property:u,schema:l,propertySchema:d,oldContext:r,evaluateAST:a})}({...e,token:n});const o=r.values.find((e=>e.kind===N().FormulaContextValueKind.ThisRow));if("block"!==(null==o?void 0:o.value.type))throw new(R().I3)({type:R().uW.MissingThisRow,node:t});const s=o.value.value,i=(yield{recordPointers:[s]}).getRecordModel(s);if(void 0===i)throw new(R().I3)({type:R().uW.MissingThisRow,node:t});if(void 0===n.collection)return(0,A().ve)(i,n.property);const{collectionPointer:u,schema:p}=yield*S(i,r);if(!u)throw new(R().I3)({type:R().uW.MissingDataDependencyBlock,node:t,blockPointer:i.pointer});if(!(0,g().Z2)(n.collection,u))throw new(R().I3)({type:R().uW.ThisRowBlockPropertyMismatchCollection,node:t,thisRowCollection:u});const l=(0,A().Yi)(n.property),d=null==p?void 0:p[l];if(void 0===d||void 0===p)throw new(R().I3)({type:R().uW.MissingSchemaPropertyOnThisRow,node:t,collectionId:i.getParentId(),property:l});return yield*L({block:i,parentCollectionPointer:u,property:l,schema:p,propertySchema:d,oldContext:r,evaluateAST:a})}function Z(e){var t;const{node:n,token:r,context:a}=e,o=null===(t=a.values.find((e=>e.kind===N().FormulaContextValueKind.ContextValue&&e.id===(0,A().GH)(r.valueId))))||void 0===t?void 0:t.value;if(void 0===o)throw new(R().I3)({type:R().uW.MissingContextVariable,node:n,valueId:r.valueId});return o}function $(e){const{value:t,callNode:n,argumentNode:r,parameterIndex:a,libraryFunction:o,expectedParameter:s}=e;if(!(0,A().Hz)(t,s.type)){if(Array.isArray(s.type)?s.type.some((e=>"checkbox"===e.type)):"checkbox"===s.type.type)return{type:"checkbox",value:(0,A().CL)(t)};if(Array.isArray(s.type)?s.type.some((e=>"text"===e.type)):"expression"!==s.type.type&&"text"===(0,A().JK)(s.type).type)return"array"===t.type&&(Array.isArray(s.type)?s.type.some((e=>"array"===e.type)):"array"===s.type.type)?{type:"array",values:t.values.map((e=>({type:"text",value:(0,A().Ht)(e)})))}:"array"===t.type&&0===t.values.length?{type:"text",value:[[""]]}:{type:"text",value:(0,A().Ht)(t)};if(!N().TREAT_UNDEFINED_AS_ZERO_FNS.includes(o.name)&&!N().FLATTENS_NUMBER_ARRAY_FNS.includes(o.name))throw new(R().I3)({type:R().uW.FunctionCallArgumentWrongType,node:n,argument:r,libraryFunction:o,parameterIndex:a,argumentType:t.type})}return t}function H(e,t){try{return{value:t()}}catch(n){return{error:z(e,n)}}}async function Y(e,t){try{return await t()}catch(n){return{error:z(e,n)}}}function z(e,t){if(t instanceof R().I3){const n=t.info;return e&&(0,A().li)(n)?{...n,node:(0,E().TW)(n.node,e)}:n}return{type:R().uW.UnexpectedError,error:(0,a().A)(t)}}},958970:(e,t,n)=>{n.d(t,{f:()=>l});n(16280),n(898992),n(672577),n(581454);var r=()=>n(319625),a=()=>n(247331),o=()=>n(44907),s=()=>n(349835),i=()=>n(239381);const u=new RegExp(/\\([\\nt"])/g);function p(e){return e.find((e=>void 0!==e&&!isNaN(e)))}function l(e){const t=function(){const e=(0,o().p8)(),t=(0,o()._M)(e).getBaseCstVisitorConstructor();return new class extends t{constructor(){super(),this.validateVisitor()}expression(e){return this.visit(e.conditionalExpression)}primaryExpression(e){if(void 0!==e.parenthesisExpression)return this.visit(e.parenthesisExpression);if(void 0!==e.arrayExpression)return this.visit(e.arrayExpression);if(void 0!==e.NumberLiteral)return{kind:s().NM.Number,text:e.NumberLiteral[0].image,startOffset:e.NumberLiteral[0].startOffset,endOffset:e.NumberLiteral[0].endOffset};if(void 0!==e.StringLiteral){const t=e.StringLiteral[0].image.slice(1,-1).replace(u,((e,t)=>{switch(t){case"n":return"\n";case"t":return"\t";default:return t}}));return{kind:s().NM.String,text:t,startOffset:e.StringLiteral[0].startOffset,endOffset:e.StringLiteral[0].endOffset}}return void 0!==e.UnclosedStringLiteral?{kind:s().NM.String,text:e.UnclosedStringLiteral[0].image.substring(1,e.UnclosedStringLiteral[0].image.length),startOffset:e.UnclosedStringLiteral[0].startOffset,endOffset:e.UnclosedStringLiteral[0].endOffset}:void 0!==e.BooleanLiteral?{kind:s().NM.Boolean,text:e.BooleanLiteral[0].image,startOffset:e.BooleanLiteral[0].startOffset,endOffset:e.BooleanLiteral[0].endOffset}:void 0!==e.InputToken?{kind:s().NM.NotionToken,token:e.InputToken[0].payload,startOffset:e.InputToken[0].startOffset,endOffset:e.InputToken[0].endOffset}:void 0!==e.IdentifierName?{kind:s().NM.Identifier,text:e.IdentifierName[0].image,startOffset:e.IdentifierName[0].startOffset,endOffset:e.IdentifierName[0].endOffset}:{kind:s().NM.RecoveryNode,startOffset:-1,endOffset:-1}}conditionalExpression(e){const t=this.visit(e.condition[0]);var n,r,a,o;return void 0!==e.QuestionMark?{kind:s().NM.Conditional,condition:t,expIfTrue:this.visit(e.expIfTrue[0]),expIfFalse:void 0!==(null===(n=e.expIfFalse)||void 0===n?void 0:n[0])?this.visit(e.expIfFalse[0]):void 0,startOffset:e.condition[0].location.startOffset,endOffset:p([null===(r=e.expIfFalse)||void 0===r||null===(r=r[0].location)||void 0===r?void 0:r.endOffset,null===(a=e.Colon)||void 0===a||null===(a=a[0])||void 0===a?void 0:a.endOffset,null===(o=e.expIfTrue[0].location)||void 0===o?void 0:o.endOffset,e.QuestionMark[0].endOffset])}:t}logicalOrExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.Or){var n,r;const a=(null===(n=e.rhs)||void 0===n?void 0:n.map((e=>this.visit(e))))??[];return{kind:s().NM.LogicalOr,elements:[t,...a],startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(r=e.rhs)||void 0===r||null===(r=r[e.rhs.length-1])||void 0===r||null===(r=r.location)||void 0===r?void 0:r.endOffset,e.Or[0].endOffset])}}return t}logicalAndExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.And){var n,r;const a=(null===(n=e.rhs)||void 0===n?void 0:n.map((e=>this.visit(e))))??[];return{kind:s().NM.LogicalAnd,elements:[t,...a],startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(r=e.rhs)||void 0===r||null===(r=r[e.rhs.length-1])||void 0===r||null===(r=r.location)||void 0===r?void 0:r.endOffset,e.And[0].endOffset])}}return t}equalityExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.EqualityOperator){var n;const r=e.rhs[0];return{kind:s().NM.Equality,op:e.EqualityOperator[0].image,lhs:t,rhs:this.visit(r),startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(n=r.location)||void 0===n?void 0:n.endOffset,e.EqualityOperator[0].endOffset])}}return t}relationalExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.RelationalOperator){var n;const r=e.rhs[0];return{kind:s().NM.Relational,op:e.RelationalOperator[0].image,lhs:t,rhs:this.visit(r),startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(n=r.location)||void 0===n?void 0:n.endOffset,e.RelationalOperator[0].endOffset])}}return t}additionExpression(e){let t=this.visit(e.lhs[0]);if(void 0!==e.AdditionOperator)for(let r=0;r<e.AdditionOperator.length;r++){var n;const a=e.rhs[r];t={kind:s().NM.Additive,op:e.AdditionOperator[r].image,lhs:t,rhs:this.visit(a),startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(n=a.location)||void 0===n?void 0:n.endOffset,e.AdditionOperator[r].endOffset])}}return t}multiplicationExpression(e){let t=this.visit(e.lhs[0]);if(void 0!==e.MultiplicationOperator)for(let r=0;r<e.MultiplicationOperator.length;r++){var n;const a=e.rhs[r];t={kind:s().NM.Multiplicative,op:e.MultiplicationOperator[r].image,lhs:t,rhs:this.visit(a),startOffset:e.lhs[0].location.startOffset,endOffset:p([null===(n=a.location)||void 0===n?void 0:n.endOffset,e.MultiplicationOperator[r].endOffset])}}return t}exponentiationExpression(e){let t;const n=this.visit(e.lhs[0]);if(void 0!==e.Caret){var r;const a=e.Caret.length-1;let o,i=null===(r=e.rhs[a].location)||void 0===r?void 0:r.endOffset;(void 0===i||isNaN(i))&&(i=e.Caret[a].endOffset);for(let n=e.Caret.length-1;n>=0;n--){const r=e.rhs[n];t=void 0===o?this.visit(r):{kind:s().NM.Exponentiation,op:o,lhs:this.visit(r),rhs:t,startOffset:r.location.startOffset,endOffset:i},o=e.Caret[n].image}return{kind:s().NM.Exponentiation,op:o,lhs:n,rhs:t,startOffset:e.lhs[0].location.startOffset,endOffset:i}}return n}unaryExpression(e){let t=this.visit(e.primaryExpression[0]),n=e.primaryExpression[0].location.startOffset;const r=void 0!==e.UnaryOperator&&"-"===e.UnaryOperator[0].image&&t.kind===s().NM.Number;var o;if(r&&(t={kind:s().NM.Unary,op:e.UnaryOperator[0].image.toLowerCase(),expression:t,startOffset:e.UnaryOperator[0].startOffset,endOffset:t.endOffset}),isNaN(n)&&(n=null===(o=e.memberCallSubExpression)||void 0===o?void 0:o[0].location.startOffset),void 0!==e.memberCallSubExpression)for(const d of e.memberCallSubExpression){const e=d.location.endOffset;if(void 0!==d.children.callArguments){var u,p,l;const r=d.children.callArguments[0].children;t={kind:s().NM.Call,expression:t,arguments:(null===(u=d.children.callArguments[0])||void 0===u||null===(u=u.children.expression)||void 0===u?void 0:u.map((e=>this.visit(e))))??[],lParenOffset:r.LParen[0].startOffset,rParenOffset:null===(p=r.RParen)||void 0===p?void 0:p[0].startOffset,commaOffsets:(null===(l=r.Comma)||void 0===l?void 0:l.map((e=>e.startOffset)))??[],startOffset:n,endOffset:e}}else if(void 0!==d.children.dotMemberExpression){const r=d.children.dotMemberExpression[0].children;if(void 0!==r.IdentifierName){const a=r.IdentifierName[0];t={kind:s().NM.UnifiedFunctionProperty,expression:t,name:a.image,nameStartOffset:a.startOffset,nameEndOffset:a.endOffset,startOffset:n,endOffset:e}}else if(void 0!==r.InputToken){const o=r.InputToken[0],u=o.payload;if(u.type===a().FormulaTokenType.BlockProperty){if((0,i().ix)(u))throw new Error("unexpected block property context value in unaryExpression");t={kind:s().NM.MemberBlockProperty,expression:t,propertyToken:void 0===u.collection?{property:u.property,collection:void 0}:{property:u.property,collection:u.collection},propertyStartOffset:o.startOffset,propertyEndOffset:o.endOffset,startOffset:n,endOffset:e}}}}}return void 0===e.UnaryOperator||r?t:{kind:s().NM.Unary,op:e.UnaryOperator[0].image.toLowerCase().trimEnd(),expression:t,startOffset:e.UnaryOperator[0].startOffset,endOffset:t.endOffset}}parenthesisExpression(e){return this.visit(e.expression[0])}arrayExpression(e){var t,n,r,a,o;return{kind:s().NM.Array,elements:(null===(t=e.expression)||void 0===t?void 0:t.map((e=>this.visit(e))))??[],lBracketOffset:e.LBracket[0].startOffset,rBracketOffset:null===(n=e.RBracket)||void 0===n?void 0:n[0].startOffset,commaOffsets:(null===(r=e.Comma)||void 0===r?void 0:r.map((e=>e.startOffset)))??[],startOffset:e.LBracket[0].startOffset,endOffset:p([null===(a=e.RBracket)||void 0===a?void 0:a[0].endOffset,null===(o=e.expression)||void 0===o||null===(o=o[e.expression.length-1])||void 0===o||null===(o=o.location)||void 0===o?void 0:o.endOffset,e.LBracket[0].endOffset])}}memberCallSubExpression(e){throw new Error("unexpected memberCallSubExpression")}dotMemberExpression(e){throw new Error("unexpected dotMemberExpression")}callArguments(e){throw new Error("unexpected callArguments")}}}();try{return{value:t.visit(e)}}catch(n){return{error:{type:s().M9.UnexpectedError,error:(0,r().A)(n),offset:0}}}}}}]);