(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[9294],{8870:(e,t,n)=>{"use strict";n.d(t,{K:()=>o,L:()=>r});var a=()=>n(206267);function o(){return{currentScreen:"none",status:"not_started",isBackendConnected:!1,externalSourceName:void 0,sessionId:a().JW(),analyticsFrom:"unknown",isConnected:!1,isPersonalAuthComplete:!1,isDisconnecting:!1,isLoaded:!1,isNotionMailProhibited:!1}}class s extends(()=>n(757695))().Store{getInitialState(){return o()}}const r=new s;(0,n(852832).exposeDebugValue)("notionMailAIConnectorStore",r)},24279:(e,t,n)=>{"use strict";n.d(t,{XO:()=>s,aR:()=>i,b1:()=>c,h7:()=>r,kO:()=>l,ox:()=>d,wc:()=>o,y8:()=>u});n(16280),n(898992),n(672577),n(430670);var a=()=>n(412412);function o(e){return"instructions"===e.type}function s(e){return"observation"===e.type&&"error"===e.observationType}function r(e){return"observation"===e.type&&"search"===e.observationType}function i(e){const t=new Error(e.value);return e.stack&&(t.stack=e.stack),t}function c(e){return"assistant"===e.type}function d(e){return"human"===e.type}function l(e){return"observation"===e.type&&"attachment"===e.observationType}function u(e){const t=(0,a().BD)(e.value.summary.value)[0];if(!t||"element"!==t.type)return"invalid summary node";const n=e.value.pages.flatMap((e=>(0,a().BD)(e.value))),o={...t,children:[...t.children??[],...n]};return(0,a()._o)(o)}},46657:(e,t,n)=>{"use strict";n.d(t,{W:()=>o});class a extends(()=>n(757695))().Store{getInitialState(){return{currentScreen:"none",status:"not_started",sessionId:n(206267).JW(),analyticsFrom:"unknown",authUrl:void 0,ingestionProgress:void 0,isConnected:!1,isDisconnecting:!1,isLoaded:!1,userAuthStatus:"not_required",externalUsername:void 0,externalSourceName:void 0,forceShowAuthNotificationTriggeredAt:void 0}}}const o=new a},92383:(e,t,n)=>{"use strict";n.d(t,{E:()=>r,F:()=>o});var a=()=>n(206267);function o(){return{currentScreen:"none",selection:{allSelected:!0,selectedDrives:[],excludedDrives:[],ingestNewDrives:!0},status:"not_started",sessionId:a().JW(),analyticsFrom:"unknown",authUrl:void 0,isConnected:!1,isPersonalAuthComplete:!1,isDisconnecting:!1,isSyncComplete:!1,isLoaded:!1,connectionDetails:void 0}}class s extends(()=>n(757695))().Store{getInitialState(){return o()}}const r=new s;(0,n(852832).exposeDebugValue)("sharepointAiConnectorStore",r)},96563:(e,t,n)=>{"use strict";n.d(t,{Lx:()=>b,pp:()=>v,vr:()=>y});var a=()=>n(902006),o=()=>n(370657),s=()=>n(206267),r=()=>n(534177),i=()=>n(209660),c=()=>n(235195),d=()=>n(300789),l=()=>n(765957),u=()=>n(453202),p=()=>n(430483),m=()=>n(991249),g=()=>n(329304),h=()=>n(656633),f=()=>n(576590);function y(e){if((0,o().rL)(e))switch(e){case"researcher":return"ai_research_mode";case"search":return"ai_unified_find_chat";case"markdown-chat":return"ai_chat_with_model";case"workflow":return"ai_agent";case"setup-generator":return"ai_limit_in_app";default:(0,r().HB)(e)}return"ai_limit_in_app"}function b(e){const{spaceId:t,userId:n,configType:a}=e,s=y(a);if((0,o().rL)(a))switch(a){case"researcher":return{pfaFeatureLoadArgs:{name:"ai_research_mode",spaceId:t,userId:n,amount:1},upsellFromForCheckoutBanner:s};case"search":case"markdown-chat":case"workflow":return{pfaFeatureLoadArgs:{name:"ai_usage",spaceId:t,userId:n,amount:1},upsellFromForCheckoutBanner:s};case"setup-generator":return{pfaFeatureLoadArgs:{name:"ai_app_builder",spaceId:t,userId:n,amount:1},upsellFromForCheckoutBanner:s};default:(0,r().HB)(a)}return{pfaFeatureLoadArgs:{name:"ai_usage",spaceId:t,userId:n,amount:0},upsellFromForCheckoutBanner:s}}function v(e){const{environment:t,connector:n,analyticsFrom:o,connectorsFeatureAvailability:y}=e;if(void 0===y)return;const b=l().default.state.sidebarSpaceStore;if(b)if((0,r().Xk)(a().YV,n)&&d().a(t,`ai_connector_${n}_sidebar_notification`),"generic"!==n&&(0,a().q1)(n)){const e=s().JW();(0,f().navigateToAIConnectorOnboarding)({connector:n,analyticsFrom:o,sessionId:e})}else if(b.canAdmin())(0,g().N9)(y,{available:()=>{if("generic"===n)return void i().Ow({openedFrom:o,currentTab:"ai",subtab:"workspace_connections"});if((0,a().n6)(n)){const e=l().default.state.sidebarSpaceStore;if("enterprise"!==(null==e?void 0:e.getSubscriptionTier())&&!p().zD.isEnterpriseAiConnectorBypassOn(n))return void i().Ow({openedFrom:o,currentTab:"ai",subtab:"workspace_connections"})}const e=s().JW();(0,f().navigateToAIConnectorOnboarding)({connector:n,analyticsFrom:o,sessionId:e})},unavailable:({upsell:e})=>{(0,h().vp)(t,b.id)?u().O.setState({open:!0,analyticsFrom:o,modal:"sales_assisted_admin_request",connector:n}):(m().K(t,{from:o,upsell:e}),"generic"!==n&&c().A.setState({...c().A.state,connectorTriggeringUpsell:n,upsellTriggeredAt:Date.now()}))}});else{if("generic"===n)return void i().Ow({openedFrom:o,currentTab:"ai",subtab:"workspace_connections"});const e=s().JW();(0,f().navigateToAIConnectorOnboarding)({connector:n,analyticsFrom:o,sessionId:e})}}},99254:(e,t,n)=>{"use strict";n.d(t,{L:()=>o,y:()=>r});var a=()=>n(206267);function o(){return{currentScreen:"none",analyticsFrom:"unknown",sessionId:a().JW(),jiraSiteId:"",jiraSiteUrl:"",jiraSyncState:"not_started",jiraSyncProgress:0,syncControl:{exclusionList:[],inclusionList:[],createdAt:Date.now(),updatedAt:Date.now()},missingUserAuth:!1,isDisconnecting:!1,isLoaded:!1,userConnected:!1}}class s extends(()=>n(757695))().Store{getInitialState(){return o()}isOldJiraConnected(){return"completed"===this.state.jiraSyncState}}const r=new s;(0,n(852832).exposeDebugValue)("jiraAIConnectionStore",r)},109954:(e,t,n)=>{"use strict";n.d(t,{X:()=>o});n(16280),n(944114),n(898992),n(672577),n(581454);var a=()=>n(902006);class o extends(()=>n(540192))().o{constructor(...e){super(...e),this.type="gmail",this.displayName="Gmail",this.requiresUserAuth=!1,this.featureGate="gmail_ai_connector",this.category="vectorless",this.parentOrganization="Google",this.fileTypes=[],this.qnaIngestionAIAppId="1724f2a1-f543-43a7-82af-8a0f85bda112",this.urlRegex=/https:\/\/mail\.google\.com\/mail\/.*[?&#](?:message_id|th)=([a-zA-Z0-9]+)/}getTitle(e){throw new Error("GmailDriver.getTitle() is not implemented")}getText(e){throw new Error("GmailDriver.getText() is not implemented")}getTranscriptAttributes(e){return{}}getSearchResultXMLTagName(){return"gmail-result"}addSearchResultToXML(e,t){if("gmail"!==e.type)throw new Error(`Expected gmail result, got result.type=${e.type}`);let n=t.find((t=>"gmail-result"===t.tagName&&t.attributes.id===e.pageId));n||(n={type:"element",tagName:"gmail-result",attributes:{id:e.pageId,title:e.title},children:[]},t.push(n)),n.children.push({type:"element",tagName:"email",attributes:{id:e.id,title:e.title,"last-edited-datetime":e.lastEdited},children:[{type:"text",value:e.text}]})}mapObservationResultNode(e){const{node:t,idMapper:n,idToCounter:o}=e;if("gmail-result"!==t.tagName)return t;const s=n.mapKeyToCounter({type:"gmail",key:(0,a().V9)(t.attributes.id)});return o[t.attributes.id]=s,{...t,attributes:{...t.attributes,id:s},children:t.children.map((e=>{const t=n.mapKeyToCounter({type:"gmail",key:(0,a().V9)(e.attributes.id)});return o[e.attributes.id]=t,{...e,attributes:{...e.attributes,id:t}}}))}}}},147427:(e,t,n)=>{"use strict";function a(e){return"text"===e.type&&!e.value.trim()}n.d(t,{A:()=>a})},162278:(e,t,n)=>{"use strict";n.d(t,{V8:()=>I,st:()=>k,vj:()=>w,zQ:()=>y});n(18107),n(944114),n(967357),n(898992),n(823215),n(354520),n(581454),n(737550);var a=()=>n(496603),o=()=>n(973647),s=()=>n(534177),r=()=>n(251582),i=()=>n(181856),c=()=>n(252050),d=()=>n(228803),l=()=>n(525704),u=()=>n(233364),p=()=>n(491810),m=()=>n(331119);function g(e){return r().p.mapResult((0,m().U5)("table"),(t=>{const n=(0,m().ke)({inputAttributes:t.attributes,definitions:{id:{required:!1,values:!0,mappingMode:"block_counter"}},tagName:t.tagName,validateRequiredAttributes:!1,mapCounterToKey:e.mapCounterToKey});if(o().Q.isFail(n))return n;const s=b(e,t.tagName,n.value);if(o().Q.isFail(s))return s;const i=s.value,c=(0,r().$d)((0,m().nx)(t.tagName,[f(e)]),t.children??[]);if(o().Q.isFail(c))return c;const d=Math.max(...c.value.map((e=>Object.keys(e.node.properties).length))),l=c.value.map((e=>{const t=Object.keys(e.node.properties).length;return t<d?{...e.node,properties:Object.fromEntries([...Object.entries(e.node.properties),...a().y1(t,d).map((e=>{const t=(e+1).toString();return[t,{tagName:"property-text",type:"property",attributes:{name:t},children:[]}]}))])}:e.node}));return{value:{tagName:"table",type:"block",attributes:{id:i,...c.value.length>0&&c.value.every((e=>e.firstChildIsHeader))?{"header-row":"true"}:{},...c.value.length>0&&c.value[0].allChildrenAreHeaders?{"header-column":"true"}:{}},persisted:e.persisted,text:[],children:l,properties:{},schemas:{},hasUncited:!1}}}))}function h(e){return r().p.mapResult(r().p.choice([(0,m().U5)("th"),(0,m().U5)("td")]),(t=>{const n=(0,r().$d)((0,m().nx)(t.tagName,[(0,d().Et)({inlineNodesAllowed:c().qI,textAllowed:!0,parentTagName:t.tagName,mapCounterToKey:e.mapCounterToKey})]),t.children??[]);return o().Q.isFail(n)?n:{value:{text:n.value,isHeader:"th"===t.tagName}}}))}function f(e){return r().p.mapResult((0,m().U5)("tr"),(t=>{var n;const a=(0,m().ke)({inputAttributes:t.attributes,definitions:{id:{required:!1,values:!0,mappingMode:"block_counter"}},tagName:t.tagName,validateRequiredAttributes:!1,mapCounterToKey:e.mapCounterToKey});if(o().Q.isFail(a))return a;const s=b(e,t.tagName,a.value);if(o().Q.isFail(s))return s;const i=s.value,c=(0,r().$d)((0,m().nx)(t.tagName,[h(e)]),t.children??[]);if(o().Q.isFail(c))return c;return{value:{node:{tagName:"tr",type:"block",attributes:{id:i},persisted:e.persisted,text:[],children:[],properties:Object.fromEntries(c.value.map(((e,t)=>{const n=(t+1).toString();return[n,{tagName:"property-text",type:"property",attributes:{name:n},children:e.text}]}))),schemas:{},hasUncited:!1},allChildrenAreHeaders:c.value.every((e=>e.isHeader)),firstChildIsHeader:Boolean(null===(n=c.value.at(0))||void 0===n?void 0:n.isHeader)}}}))}function y(e){return"unknown-block"===e}function b(e,t,n){return e.persisted?n.id?{value:n.id}:{error:new(i().oN)}:y(t)?n.id?{value:n.id}:{error:new(i().N8)}:n.id?{error:new(i().oS)}:{value:e.allocateIdFn()}}function v(e){const t=(0,s().s8)(c().sA,((n,a)=>{const h=function(e,t,n){const a=c().sA[e],{allowMove:g,allowUncited:h,persisted:f,mapCounterToKey:y}=t;let v=(0,m().U5)(e);return"page"===e&&(v=r().p.choice([v,(0,m().U5)("instructions-page")])),r().p.mapResult(v,(v=>{const I=(0,m().ke)({inputAttributes:v.attributes,definitions:{...a.attributes,id:{required:!1,values:!0,mappingMode:"block_counter"}},tagName:e,validateRequiredAttributes:!1,mapCounterToKey:y});if(o().Q.isFail(I))return I;if("synced-block-reference"===e&&!f&&v.children&&v.children.length>0)return{error:new(i().w5)};const w=b(t,e,I.value);if(o().Q.isFail(w))return w;const S=w.value,N=[];a.title&&N.push((0,d().Et)({inlineNodesAllowed:c().qI,textAllowed:!0,parentTagName:e,mapCounterToKey:y}));const T=a.schemas.map((e=>`schema-${e}`)),C=(0,p().D)({mapCounterToKey:y});N.push(...(0,s().WP)(C).filter((([e])=>T.includes(e))).map((([,e])=>e))),N.push(g?(0,l().Y)({mapCounterToKey:y}):_),h&&N.push(k());const x=[...a.properties];N.push(...(0,s().WP)((0,u().x)({mapCounterToKey:y})).filter((([e])=>(0,s().Xk)(x,e))).map((([,e])=>e)));for(const e of a.content)N.push(n(e));const A=(0,r().$d)((0,m().nx)(e,N),v.children??[]);if(o().Q.isFail(A))return A;const P=A.value.some((e=>"uncited"===e.type)),D=A.value.filter((e=>"uncited"!==e.type)),M=(0,m().t7)([["inline or text node",function(e){return"text"===e.type||"inline"===e.type}],["property node",function(e){return"property"===e.type}],["schema node",function(e){return"schema"===e.type}],["block node",function(e){return"block"===e.type||"move"===e.type}]],D);if(o().Q.isFail(M))return{error:new(i().SX)({foundNodeType:M.error.incorrectLabel,incorrectlyAfterType:M.error.lastLabel})};const[U,E,O,F]=M.value;if("tr"===e)for(const e of E)if(!/^-?\d+$/.test(e.attributes.name))return{error:new(i().dO)};return{value:{type:"block",tagName:e,attributes:{...I.value,id:S},persisted:f,text:U,children:F,properties:Object.fromEntries(E.map((e=>[e.attributes.name,e]))),schemas:Object.fromEntries(O.map((e=>[e.attributes.name,e]))),hasUncited:P}}}))}(a,e,(e=>t[e]));return"table"===a?r().p.choice([r().p.try(h),g(e)]):"tr"===a?r().p.choice([r().p.try(h),r().p.map(f(e),(e=>e.node))]):h}));return t}const _=r().p.mapResult((0,m().U5)("move"),(()=>({error:new(i().Qv)})));function k(){return r().p.mapResult((0,m().U5)("uncited"),(e=>({value:{type:"uncited"}})))}function I(e){return r().p.choice([...Object.values(v(e)),...e.allowMove?[]:[_],r().p.fail((e=>new(i().yc)({nodeType:"block",unexpectedNode:a().$1(e)})))])}function w(e){return r().p.choice([...Object.values(v(e)),(0,l().Y)({mapCounterToKey:e.persisted?void 0:e.mapCounterToKey}),r().p.fail((e=>new(i().yc)({nodeType:"block",unexpectedNode:a().$1(e)})))])}},174636:(e,t,n)=>{"use strict";n.d(t,{Q:()=>o,R:()=>r});var a=()=>n(206267);function o(){return{inProgress:!1,isPublicSync:!1,isPrivateSync:!1,selection:{allSelected:!0,selectedChannels:[],excludedChannels:[],joinFutureChannels:!0},isSyncCompleted:!1,currentScreen:"none",sessionId:a().JW(),analyticsFrom:"unknown",authUrl:void 0,canQuery:!0,connectedApps:void 0,noChannelsSelected:void 0,ingestionProgress:void 0,gridSetupUrl:void 0,isSlackGridAiConnectorEnabled:!1,isLoaded:!1,externalSourceName:void 0,forceShowAuthNotificationTriggeredAt:void 0,connectionVersion:void 0,errorCode:void 0}}class s extends(()=>n(757695))().Store{getInitialState(){return o()}isSlackUserConnectionCompleted(){var e;return(null===(e=this.state.connectedApps)||void 0===e?void 0:e.includes("slack"))??!1}isSlackV2AdminConnectionCompleted(){var e;return((null===(e=this.state.connectedApps)||void 0===e?void 0:e.includes("slack-admin"))&&this.state.isSyncCompleted&&2===this.state.connectionVersion)??!1}showUserConnectionNotification(){return this.isSlackV2AdminConnectionCompleted()&&!this.isSlackUserConnectionCompleted()&&!this.state.isPrivateSync}}const r=new s;(0,n(852832).exposeDebugValue)("slackUniversalQnAConnectionStore",r)},181856:(e,t,n)=>{"use strict";n.d(t,{GW:()=>c,HQ:()=>i,LN:()=>r,N8:()=>v,Qv:()=>I,RR:()=>d,S2:()=>T,SX:()=>g,TP:()=>S,Te:()=>o,Uc:()=>w,af:()=>x,dO:()=>h,gJ:()=>l,kT:()=>C,nD:()=>k,oN:()=>y,oS:()=>b,qW:()=>p,u7:()=>N,w5:()=>f,wL:()=>s,xU:()=>m,yc:()=>u,yd:()=>_});n(16280),n(581454);var a=()=>n(534177);class o extends Error{constructor(e,t,n){super(t),this.type=e,this.cause=n}getMetadata(){}}class s extends o{}class r extends s{constructor(e){let t=1===e.attributeNames.length?`Unexpected attribute for <${e.tagName}> tag: ${e.attributeNames[0]}`:`Unexpected attributes for <${e.tagName}> tag: ${e.attributeNames.join(", ")}`;e.attributeNames.includes("key")&&(t+="\n\nThe key attribute is not needed. You should omit it."),super("unexpected_attributes",t)}}class i extends s{constructor(e){super("missing_attribute",`The <${e.tagName}> tag is missing a ${e.attributeName} attribute. It should be specified as <${e.tagName} ${e.attributeName}="...">`)}}class c extends s{constructor(e){super("bad_attribute",`Attempted to set attribute ${e.attributeName} on a <${e.tagName}> tag to a value that is not allowed: ${e.receivedValue}`)}}class d extends s{constructor(e){const{tagName:t,unexpectedNode:n}=e;let a;a=n?"text"===n.type?`Plain text, whitespace, or newlines are not allowed inside a <${t}> tag. Make sure not to include any extra whitespace or newlines in your XML.`:`A <${n.tagName}> tag is not allowed inside a <${t}> tag`:`Encountered an invalid child inside a <${t}> tag.`,"set-title"===t||"set-property"===t?a+=`\nOnly inline elements and text are allowed inside <${t}>`:"insert-before"===t||"insert-after"===t||"insert-inside"===t||"chat"===t?(a+=`\nOnly block elements are allowed inside <${t}>`,"chat"===t&&(a+="\nWhen using <chat>, remember to wrap text in <text> tags.")):"create"===t&&(a+="\nWhen using <create>, remember to wrap in a <page> tag."),super("disallowed_child",a),this.tagName=void 0,this.unexpectedNode=void 0,this.tagName=t,this.unexpectedNode=n}}class l extends s{constructor(e){super("expected_tag_name",`Expected a <${e}> tag`)}}class u extends s{constructor(e){let t;(0,a().O9)(e.unexpectedNode)?"text"===e.unexpectedNode.type?t=`Text is not supported as a child for a ${e.nodeType} node`:"element"===e.unexpectedNode.type?t=`Unsupported ${e.nodeType} tag name: ${e.unexpectedNode.tagName}`:(0,a().HB)(e.unexpectedNode):t=`Unexpected value for a ${e.nodeType} node`,super("unsupported_node",t)}}class p extends s{constructor(e,t){super("unmapped_id",`Expected counter ID for attribute ${e}, instead received ${t}`)}}class m extends s{constructor(e){const{expectedIdType:t,receivedIdType:n,tagNameForErrorMessage:a,idValueForErrorMessage:o}=e;super("unexpected_id_type",a?`Expected ID ${o} in <${a}> to be of type '${t}', instead received ID of type '${n}'`:`Expected ID ${o} to be of type '${t}', instead received ID of type '${n}'`)}}class g extends s{constructor(e){super("out_of_order_node",`Encountered a ${e.foundNodeType} after a ${e.incorrectlyAfterType}. You should ensure that any ${e.foundNodeType}s come before ${e.incorrectlyAfterType}s.`)}}class h extends s{constructor(){super("table_row_property_name","Inside tr, the property-text name attribute must be a string which is an integer counter, starting from 1.")}}class f extends s{constructor(){super("synced_block_invalid_children","Cannot include content when writing a <synced-block-reference> tag")}}class y extends s{constructor(){super("must_provide_id","Block node is missing an id attribute")}}class b extends s{constructor(){super("cannot_provide_id","When creating new blocks, do not provide an id attribute.")}}class v extends s{constructor(){super("must_provide_unknown_block_id","When referencing unknown blocks, you must provide an id.")}}class _ extends s{constructor(){super("cannot_append_to_multiple_properties","Cannot append to multiple properties. Use multiple calls to <insert-inside> instead.")}}class k extends s{constructor(){super("cannot_remove_from_multiple_properties","Cannot remove from multiple properties. Use multiple calls to <delete> instead.")}}class I extends s{constructor(){super("move_disallowed","A <move> tag is not allowed in this context")}}class w extends s{constructor(){super("set_attribute_without_key","<set-attribute> is missing an attribute to set")}}class S extends s{constructor(e){super("unknown_api",`Unexpected API: ${e}. Make sure to use only the supported XML APIs, and ensure you are using this API in the right context.`)}}class N extends o{constructor(e,t){super("load_page_as_xml_failed",t),this.pageId=e}getMetadata(){return{pageId:this.pageId}}}class T extends o{constructor(e,t){super("load_database_as_xml_failed",t),this.databaseId=e}getMetadata(){return{databaseId:this.databaseId}}}class C extends o{constructor(){super("illegal_replace_page",'When calling <replace> on a page, you must provide a <page> tag as the single child, like this: <replace start="..." end="..."><page>...</page></replace>.')}}class x extends o{constructor(){super("out_of_order_replace","When calling <replace>, the start of the range must be AFTER the end of the range.")}}},208685:(e,t,n)=>{"use strict";n.d(t,{U7:()=>c,lm:()=>s,vZ:()=>i});var a=()=>n(534177);const o=["asana","gmail"];function s(e){return!!(0,a().Xk)(o,e)}const r=Object.freeze({asana:new(n(532058).v),gmail:new(n(109954).X)});function i(e){return r[e]}function c(e){for(const t of Object.values(r))if(t.getSearchResultXMLTagName()===e)return t}},228803:(e,t,n)=>{"use strict";n.d(t,{Et:()=>p});n(16280),n(944114),n(898992),n(354520);var a=()=>n(973647),o=()=>n(534177),s=()=>n(251582),r=()=>n(181856),i=()=>n(252050),c=()=>n(147427),d=(n(581454),()=>n(331119));const l=s().p.map(d().W6,(e=>({type:"text",value:e.value})));function u(e){const t=(0,o().s8)(i()._S,((t,n)=>function(e,t){const n=i()._S[e],{mapCounterToKey:o}=t;return s().p.mapResult((0,d().U5)(e),(t=>{const r=(0,d().ke)({inputAttributes:t.attributes,definitions:n.attributes,tagName:e,mapCounterToKey:o});if(a().Q.isFail(r))return r;let i=t.children??[];n.text||(i=i.filter((e=>!(0,c().A)(e))));const l=(0,s().$d)(s().p.manyTill(p({inlineNodesAllowed:n.inline,textAllowed:n.text,parentTagName:e,mapCounterToKey:o}),s().p.eof()),i);if(a().Q.isFail(l))return l;const u=l.value;return{value:{type:"inline",tagName:e,attributes:r.value,children:u}}}))}(n,e)));return t}function p(e){const{inlineNodesAllowed:t,textAllowed:n,parentTagName:a,mapCounterToKey:i}=e,c=[...t],d=[];for(const[s,r]of(0,o().WP)(u({mapCounterToKey:i})))(0,o().Xk)(c,s)&&d.push(r);return s().p.choice([...d,...n?[l]:[],s().p.fail((e=>e.length>0?new(r().RR)({tagName:a,unexpectedNode:e[0]}):new Error("No inline or text node")))])}},229533:(e,t,n)=>{"use strict";n.d(t,{$t:()=>O,F1:()=>x,HF:()=>F,LT:()=>E,UK:()=>B,YX:()=>P,_1:()=>S,al:()=>C,eA:()=>M,hA:()=>D,o5:()=>$,uD:()=>N,wM:()=>A,zM:()=>T});n(16280),n(18107),n(944114),n(967357);var a=()=>n(242422),o=()=>n(902006),s=()=>n(534177),r=()=>n(634877),i=()=>n(174636),c=()=>n(624820),d=()=>n(953911),l=()=>n(262246),u=()=>n(291075),p=()=>n(771624),m=()=>n(575922),g=()=>n(46657),h=()=>n(963702),f=()=>n(702327),y=()=>n(8870),b=()=>n(723771),v=()=>n(92383),_=()=>n(430483),k=()=>n(756315),I=()=>n(99254),w=()=>n(479350);const S=["slack_select_channels","slack_re_auth","slack_v2_user_connection","github_re_auth","jira_connection_pending","microsoft_teams_select_teams","sharepoint_select_sites","jira_connect_user","jira_select_projects","jira_migrate","slack_migrate","linear_re_auth","discord_re_auth","salesforce_re_auth","google_drive_connection_pending","asana_re_auth"];function N(e,t){const n=[];if("slack"===e){const{noChannelsSelected:e,ingestionProgress:a}=i().R.state;_().zD.isSlackV2AiConnectorEnabled()&&i().R.state.isSyncCompleted&&1===i().R.state.connectionVersion&&t&&n.push({type:"slack_migrate"}),!_().zD.isSlackV2AiConnectorEnabled()&&e&&void 0===a&&t&&n.push({type:"slack_select_channels"}),!_().zD.isSlackV2AiConnectorEnabled()&&C(i().R.state)&&n.push({type:"slack_re_auth"}),_().zD.isSlackV2AiConnectorEnabled()&&i().R.showUserConnectionNotification()&&n.push({type:"slack_v2_user_connection"})}else if("jira"===e){"pending_selection"===w().E.state.jiraSyncState&&n.push({type:"jira_select_projects"}),I().y.isOldJiraConnected()&&_().zD.isJiraForgeEnabled()&&!w().E.isJiraForgeConnectionDone()&&t&&n.push({type:"jira_migrate"});const{jiraSyncState:e}=I().y.state;a().default.checkGate({gateName:"install_from_jira_marketplace"})&&"pending_connection"===e&&t&&n.push({type:"jira_connection_pending"});a().default.checkGate({gateName:"jira_user_auth_flow"})&&I().y.state.missingUserAuth&&n.push({type:"jira_connect_user"})}else if("microsoft-teams"===e){const{connectionStatus:e}=h().F.state;"pending_selection"===e&&t&&n.push({type:"microsoft_teams_select_teams"})}else if("google-drive"===e)"pending_selection"===k().d.state.initialSyncState&&t&&n.push({type:"google_drive_connection_pending"});else if("sharepoint"===e){const{connectionDetails:e}=v().E.state;"pending_selection"===(null==e?void 0:e.status)&&t&&n.push({type:"sharepoint_select_sites"})}else"github"===e?x(u().o.state)&&n.push({type:"github_re_auth"}):"linear"===e&&M(e)&&n.push({type:`${e}_re_auth`});return n}function T(e){return"slack"===e?!i().R.state.canQuery:"github"===e?!u().o.state.isPersonalAuthComplete:"linear"===e?!!a().default.checkGate({gateName:"linear_user_auth_flow"})&&"pending"===g().W.state.userAuthStatus:"salesforce"===e&&"pending"===b().C.state.userAuthStatus}function C(e){const{isSlackGridAiConnectorEnabled:t,isSyncCompleted:n,ingestionProgress:a,canQuery:o}=e;return!(t||!n||void 0!==a||o)}function x(e){const{githubOrg:t,isPersonalAuthComplete:n,isDisconnecting:a,forceShowAuthNotificationTriggeredAt:o}=e;return!(!o&&(null==t||!t.isSyncComplete||n||a))}function A(e){const{connectionStatus:t,syncProgressPercentage:n}=e;return"in_progress"===t&&void 0===n}function P(e){const{connectionStatus:t,syncProgressPercentage:n}=e;return"in_progress"===t&&void 0===n}function D(e){if("linear"===e){if(!a().default.checkGate({gateName:"linear_user_auth_flow"}))return!1;const{userAuthStatus:e}=g().W.state;return"not_required"!==e}return!1}function M(e){if("linear"===e)return function(){if(!a().default.checkGate({gateName:"linear_user_auth_flow"}))return!1;const{isConnected:e,userAuthStatus:t,isDisconnecting:n}=g().W.state;return e&&"pending"===t&&!n}();throw new Error("isConnectedButAuthNeeded is not implemented for this connector")}function U(){const{jiraSyncState:e,jiraSyncProgress:t}=w().E.state;return"in_progress"===e||"editing"===e||"pending_installation"===e?{isInProgress:!0,ingestionProgress:t}:{isInProgress:!1}}function E(e){if("slack"===e){const{inProgress:e,ingestionProgress:t,isSlackGridAiConnectorEnabled:n}=i().R.state;return n?{isInProgress:!1}:e?{isInProgress:!0,ingestionProgress:t??0}:{isInProgress:!1}}if("google-drive"===e){const{ingestionProgress:e,isEditing:t}=k().d.state;return void 0!==e||t?{isInProgress:!0,ingestionProgress:e}:{isInProgress:!1}}if("github"===e){const{status:e}=u().o.state;return"in_progress"===e?{isInProgress:!0,ingestionProgress:void 0}:{isInProgress:!1}}if("jira"===e){if(_().zD.isJiraForgeEnabled()&&w().E.isJiraForgeConnectionDone())return U();if(_().zD.isJiraOldAiConnectorEnabled()){const{jiraSyncState:e,jiraSyncProgress:t}=I().y.state;if("in_progress"===e||"editing"===e)return{isInProgress:!0,ingestionProgress:t}}return U()}if("sharepoint"===e){const{connectionDetails:e}=v().E.state;return"in_progress"===(null==e?void 0:e.status)?{isInProgress:!0,ingestionProgress:null==e?void 0:e.progress}:{isInProgress:!1}}if("microsoft-teams"===e){const{connectionStatus:e,syncProgressPercentage:t}=h().F.state;return"in_progress"===e?{isInProgress:!0,ingestionProgress:t}:{isInProgress:!1}}if((0,o().Gb)(e))return{isInProgress:!1};if("linear"===e){const{status:e,ingestionProgress:t}=g().W.state;return"in_progress"===e?{isInProgress:!0,ingestionProgress:t}:{isInProgress:!1}}if("salesforce"===e){const{status:e,ingestionProgress:t}=b().C.state;return"in_progress"===e?{isInProgress:!0,ingestionProgress:t}:{isInProgress:!1}}if("discord"===e){const{connectionStatus:e,syncProgressPercentage:t}=l().l.state;return"in_progress"===e?{isInProgress:!0,ingestionProgress:t}:{isInProgress:!1}}if("asana"===e){const{connectionStatus:e,syncProgressPercentage:t}=c().P0.state;return"in_progress"===e?{isInProgress:!0,ingestionProgress:t}:{isInProgress:!1}}if("box"===e){const{status:e,ingestionProgress:t}=d().M.state;return"in_progress"===e?{isInProgress:!0,ingestionProgress:t}:{isInProgress:!1}}return(0,s().HB)(e)}function O(e){if("sharepoint"===e){const{connectionDetails:e}=v().E.state;return"disconnecting"===(null==e?void 0:e.status)}if("box"===e){const{status:e}=d().M.state;return"disconnecting"===e}if("linear"===e){const{status:e}=g().W.state;return"disconnecting"===e}if("jira"===e){if(_().zD.isJiraForgeEnabled()&&w().E.isJiraForgeConnectionDone())return"disconnecting"===w().E.state.jiraSyncState;if(_().zD.isJiraOldAiConnectorEnabled())return"disconnecting"===I().y.state.jiraSyncState}return Boolean(r().NT[e].state.isDisconnecting)}function F(e){const t=function(e){return N(e,!0)}(e),n=t.at(0),a=B(e);if(n)return{type:"action_required",action:n.type,externalSourceName:a};const o=E(e);return o.isInProgress?{type:"in_progress",ingestionProgress:o.ingestionProgress,externalSourceName:a}:O(e)?{type:"disconnecting",externalSourceName:a}:{type:"connected",externalSourceName:a}}function B(e){if("jira"===e){if(_().zD.isJiraForgeEnabled()&&w().E.isJiraForgeConnectionDone()){const{jiraSiteUrl:e}=w().E.state;return e}const{jiraSiteUrl:e}=I().y.state,t=/^https:\/\/([a-zA-Z0-9-]+)\.atlassian\.net/,n=e.match(t);return(null==n?void 0:n[1])||e}if("google-drive"===e){const{externalSourceName:e}=k().d.state;return e}if("github"===e){const{externalSourceName:e}=u().o.state;if(e)return e;const{githubOrg:t}=u().o.state;return null==t?void 0:t.name}if("linear"===e){const{externalSourceName:e}=g().W.state;return e}if("sharepoint"===e){const{connectionDetails:e}=v().E.state;return null==e?void 0:e.externalSourceName}if("slack"===e){const{externalSourceName:e}=i().R.state;return e}if("gmail"===e){const{externalSourceName:e}=p().XS.state;return e}if("google-calendar"===e){const{externalSourceName:e}=m().W.state;return e}if("notion-mail"===e){const{externalSourceName:e}=y().L.state;return e}if("notion-calendar"===e){const{externalSourceName:e}=f().g.state;return e}if("microsoft-teams"===e){const{externalSourceName:e}=h().F.state;return e}if("salesforce"===e){const{externalSourceName:e}=b().C.state;return e}if("box"===e){const{externalSourceName:e}=d().M.state;return e}}function $(e){if("linear"===e){const{externalUsername:e}=g().W.state;return e}}},233364:(e,t,n)=>{"use strict";n.d(t,{Q:()=>m,x:()=>p});n(898992),n(354520);var a=()=>n(496603),o=()=>n(973647),s=()=>n(534177),r=()=>n(251582),i=()=>n(181856),c=()=>n(252050),d=()=>n(147427),l=()=>n(228803),u=()=>n(331119);function p(e){return(0,s().s8)(c().GU,((t,n)=>function(e,t){const n=c().GU[e],{mapCounterToKey:a}=t;return r().p.mapResult((0,u().U5)(e),(t=>{const s=(0,u().ke)({inputAttributes:t.attributes,definitions:{...n.attributes,name:{required:!0,values:!0}},tagName:e,mapCounterToKey:a});if(o().Q.isFail(s))return s;let i=t.children??[];n.text||(i=i.filter((e=>!(0,d().A)(e))));const c=(0,r().$d)(r().p.manyTill((0,l().Et)({inlineNodesAllowed:n.inline,textAllowed:n.text,parentTagName:e,mapCounterToKey:a}),r().p.eof()),i);if(o().Q.isFail(c))return c;const p=c.value;return{value:{type:"property",tagName:e,attributes:s.value,children:p}}}))}(n,e)))}function m(e){return r().p.choice([...Object.values(p(e)),r().p.fail((e=>new(i().yc)({nodeType:"property",unexpectedNode:a().$1(e)})))])}},235195:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});class a extends(()=>n(757695))().Store{getInitialState(){return{connectorTriggeringUpsell:void 0,upsellTriggeredAt:void 0}}}const o=new a;(0,n(852832).exposeDebugValue)("aiConnectorsStore",o);const s=o},239666:(e,t,n)=>{"use strict";n.d(t,{NH:()=>o,Wy:()=>a});const a={type:"everything"},o={dateRangeFilter:{startDate:void 0,endDate:void 0},createdByFilter:[],excludeCreatedByFilter:[],titleOnlyFilter:!1,ancestorsFilter:[],teamspacesFilter:[]}},242634:()=>{},251582:(e,t,n)=>{"use strict";n.d(t,{$d:()=>r,AZ:()=>i,p:()=>d});n(16280),n(944114),n(581454);var a=()=>n(496603),o=()=>n(973647);class s extends Error{constructor(e){super(e)}}function r(e,t){const n=Array.isArray(t)?t:[t],[,a]=e(n);return a.status?{value:a.value}:{error:a.error}}function i(e,t){const n=r(e,t);if(o().Q.isFail(n))throw n.error;return n.value}const c=Symbol("ManyTillEndSentinel"),d={try:e=>t=>{const[n,a]=e(t);return a.status?[n,a]:[t,a]},any:()=>e=>e.length>0?[e.slice(1),{status:!0,value:e[0]}]:[[],{status:!1,error:new s("Reached end of input")}],eof:e=>t=>0===t.length?[[],{status:!0,value:void 0}]:[t,{status:!1,error:(null==e?void 0:e(t[0]))??new s("Expected end of input")}],map:(e,t)=>n=>{const[a,o]=e(n);return[a,o.status?{status:!0,value:t(o.value)}:o]},mapResult:(e,t)=>n=>{const[a,s]=d.map(e,t)(n);return s.status?o().Q.isFail(s.value)?[a,{status:!1,error:s.value.error}]:[a,{status:!0,value:s.value.value}]:[a,s]},andThen:(e,t)=>n=>{const[a,o]=e(n);return o.status?t(o.value)(a):[a,o]},sequence:function(e){return t=>{const n=[];for(const a of e){const[e,o]=a(t);if(!o.status)return[e,o];n.push(o.value),t=e}return[t,{status:!0,value:n}]}},satisfy:function(e){return d.try((t=>{const[n,a]=d.any()(t);return a.status&&!e(a.value)?[n,{status:!1,error:new s("Failed predicate")}]:[n,a]}))},filter:function(e,t){return d.try((n=>{const[a,o]=e(n);return[a,o.status?t(o.value)?o:{status:!1,error:new s("Failed predicate")}:o]}))},literal:e=>d.describe(d.satisfy((t=>a().n4(t,e))),(()=>new s(`Expected: ${JSON.stringify(e)}.`))),describe:(e,t)=>n=>{const[a,o]=e(n);return[a,o.status?o:{status:!1,error:t()}]},constant:e=>t=>[t,{status:!0,value:e}],choice:e=>0===e.length?d.fail((()=>new s("No parsers to choose from"))):t=>{let n=e[0](t);for(const o of e.slice(1)){const[e,s]=n;if(s.status||!a().n4(e,t))return n;n=o(t)}return n},fail:e=>t=>[t,{status:!1,error:e(t)}],many:e=>t=>{const n=[];for(;;){const[a,o]=d.try(e)(t);if(!o.status)return[a,{status:!0,value:n}];n.push(o.value),t=a}},manyTill:(e,t)=>n=>{const a=[];for(;;){const[o,s]=d.choice([d.map(t,(()=>c)),d.try(e)])(n);if(!s.status)return[o,s];if(s.value===c)return[o,{status:!0,value:a}];a.push(s.value),n=o}},many1:e=>d.map(d.sequence([e,d.many(e)]),(([e,t])=>[e,...t])),sepBy:(e,t)=>d.choice([d.sepBy1(e,t),d.constant([])]),sepBy1:(e,t)=>d.andThen(e,(n=>d.map(d.many(d.map(d.sequence([t,e]),(([,e])=>e))),(e=>[n,...e])))),lazy:e=>d.andThen(d.constant(void 0),e),lookAhead:e=>t=>[t,e(t)[1]]}},252050:(e,t,n)=>{"use strict";n.d(t,{BP:()=>c,Bt:()=>d,F6:()=>l,GU:()=>m,HV:()=>E,P8:()=>i,RD:()=>I,U4:()=>h,VB:()=>A,Y1:()=>D,_S:()=>p,aL:()=>M,ew:()=>C,g5:()=>O,gc:()=>U,qI:()=>u,sA:()=>N,sW:()=>T,sk:()=>b,wn:()=>x,z5:()=>P});n(581454);var a=n.n(n(625473)),o=()=>n(498212),s=()=>n(534177),r=()=>n(206267);const i={default:"default",gray:"gray",brown:"brown",orange:"orange",yellow:"yellow",teal:"green",blue:"blue",purple:"purple",pink:"pink",red:"red",default_background:"default-background",gray_background:"gray-background",brown_background:"brown-background",orange_background:"orange-background",yellow_background:"yellow-background",teal_background:"green-background",blue_background:"blue-background",purple_background:"purple-background",pink_background:"pink-background",red_background:"red-background"},c=Object.fromEntries(Object.entries(i).map((([e,t])=>[t,e]))),d=Object.values(i),l=["mention-page","mention-database","mention-person","mention-assistant","mention-date","mention-datetime","mention-date-range","mention-datetime-range","mention-link"],u=["b","i","code","s","u","a","h","e",...l],p={b:{attributes:{},inline:u,text:!0,isToken:!1},i:{attributes:{},inline:u,text:!0,isToken:!1},code:{attributes:{},inline:u,text:!0,isToken:!1},s:{attributes:{},inline:u,text:!0,isToken:!1},u:{attributes:{},inline:u,text:!0,isToken:!1},a:{attributes:{href:{required:!0,values:!0,description:"link URL. Do not link to any URLs that are not already in the current context.",mappingMode:"href_counter"},type:{required:!1,values:n(902006).PI,description:"universal source type"},"external-id":{required:!1,values:!0,description:"ID for loadable external resource",mappingMode:"external_id_counter"}},inline:u,text:!0,isToken:!1},h:{attributes:{color:{required:!0,values:d,description:"text color"}},inline:u,text:!0,isToken:!1},e:{attributes:{equation:{required:!0,values:!0,description:"LaTeX equation string"}},inline:[],text:!0,isToken:!0},"mention-page":{attributes:{"page-id":{required:!0,values:!0,description:"ID of page",mappingMode:"block_counter"}},inline:[],text:!0,isToken:!0},"mention-link":{attributes:{href:{required:!0,values:!0,description:"link URL. Do not link to any URLs that are not already in the current context."},title:{required:!1,values:!0,description:"Linked page title"},icon_url:{required:!1,values:!0,description:"Favicon. Do not edit this field."},description:{required:!1,values:!0,description:"Linked page description. Do not edit this field."}},inline:[],text:!0,isToken:!0},"mention-database":{attributes:{"database-id":{required:!0,values:!0,description:"ID of database",mappingMode:"collection_counter"}},inline:[],text:!0,isToken:!0},"mention-data-source":{attributes:{"data-source-id":{required:!0,values:!0,description:"ID of database",mappingMode:"collection_counter"}},inline:[],text:!0,isToken:!0},"mention-person":{attributes:{"person-id":{required:!0,values:!0,description:"ID of person",mappingMode:"person_counter"},"person-name":{required:!1,values:!0,description:"Name of person"}},inline:[],text:!0,isToken:!0},"find-person":{attributes:{name:{required:!0,values:!0,description:"Name of person"}},inline:[],text:!0,isToken:!0},"mention-assistant":{attributes:{},inline:[],text:!0,isToken:!0},"mention-date":{attributes:{date:{required:!0,values:!0,description:"Date in ISO 8601 (YYYY-MM-DD) format"}},inline:[],text:!1,isToken:!1},"mention-datetime":{attributes:{date:{required:!0,values:!0,description:"Date in ISO 8601 (YYYY-MM-DD) format"},time:{required:!0,values:!0,description:"Time in ISO 8601 (HH:MM) format"}},inline:[],text:!1,isToken:!1},"mention-date-range":{attributes:{"start-date":{required:!0,values:!0,description:"Start date in ISO 8601 (YYYY-MM-DD) format"},"end-date":{required:!0,values:!0,description:"End date in ISO 8601 (YYYY-MM-DD) format"}},inline:[],text:!1,isToken:!1},"mention-datetime-range":{attributes:{"start-date":{required:!0,values:!0,description:"Start date in ISO 8601 (YYYY-MM-DD) format"},"end-date":{required:!0,values:!0,description:"End date in ISO 8601 (YYYY-MM-DD) format"},"start-time":{required:!0,values:!0,description:"Start time in ISO 8601 (HH:MM) format"},"end-time":{required:!0,values:!0,description:"End time in ISO 8601 (HH:MM) format"}},inline:[],text:!1,isToken:!1},option:{attributes:{option:{values:!0,description:"Option name",required:!0}},inline:[],text:!1,isToken:!1},"option-category":{attributes:{category:{values:!0,description:"Status category",required:!0}},inline:[],text:!1,isToken:!1},"schema-option":{attributes:{option:{values:!0,description:"Option name",required:!0}},inline:[],text:!1,isToken:!1},"schema-option-category":{attributes:{category:{values:!0,description:"Status category",required:!0}},inline:["schema-option"],text:!1,isToken:!1}},m={"property-title":{text:!0,inline:l,attributes:{}},"property-text":{text:!0,inline:u,attributes:{}},"property-url":{text:!0,inline:[],attributes:{}},"property-email":{text:!0,inline:[],attributes:{}},"property-phone-number":{text:!0,inline:[],attributes:{}},"property-person":{text:!1,inline:["mention-person","find-person"],attributes:{}},"property-date":{text:!1,inline:["mention-date","mention-date-range","mention-datetime","mention-datetime-range"],attributes:{}},"property-created-time":{text:!1,inline:["mention-date","mention-datetime"],attributes:{}},"property-last-edited-time":{text:!1,inline:["mention-date","mention-datetime"],attributes:{}},"property-created-by":{text:!1,inline:["mention-person"],attributes:{}},"property-last-edited-by":{text:!1,inline:["mention-person"],attributes:{}},"property-checkbox":{text:!1,inline:[],attributes:{checked:{values:["true","false"],description:'checked state, either "true" or "false"',required:!0}}},"property-select":{text:!1,inline:["option"],attributes:{}},"property-multi-select":{text:!1,inline:["option"],attributes:{}},"property-relation":{text:!1,inline:["mention-page"],attributes:{"database-id":{values:!0,description:"The database ID the relation points to",required:!1,mappingMode:"collection_counter"}}},"property-status":{text:!1,inline:["option"],attributes:{}},"property-number":{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!1}}}},g=(0,s().uv)(m),h={"schema-property-title":{propertyTagName:"property-title",inline:[],attributes:{}},"schema-property-text":{propertyTagName:"property-text",inline:[],attributes:{}},"schema-property-url":{propertyTagName:"property-url",inline:[],attributes:{}},"schema-property-email":{propertyTagName:"property-email",inline:[],attributes:{}},"schema-property-phone-number":{propertyTagName:"property-phone-number",inline:[],attributes:{}},"schema-property-person":{propertyTagName:"property-person",inline:[],attributes:{limit:{values:["1","Infinity"],description:"The number of options that can be added",required:!0}}},"schema-property-date":{propertyTagName:"property-date",inline:[],attributes:{}},"schema-property-created-time":{propertyTagName:"property-created-time",inline:[],attributes:{}},"schema-property-last-edited-time":{propertyTagName:"property-last-edited-time",inline:[],attributes:{}},"schema-property-created-by":{propertyTagName:"property-created-by",inline:[],attributes:{}},"schema-property-last-edited-by":{propertyTagName:"property-last-edited-by",inline:[],attributes:{}},"schema-property-checkbox":{propertyTagName:"property-checkbox",inline:[],attributes:{}},"schema-property-select":{propertyTagName:"property-select",inline:["schema-option"],attributes:{}},"schema-property-multi-select":{propertyTagName:"property-multi-select",inline:["schema-option"],attributes:{}},"schema-property-relation":{propertyTagName:"property-relation",inline:["mention-page"],attributes:{limit:{values:["1","Infinity"],description:"The number of options that can be added",required:!0},"database-id":{values:!0,description:"The database ID the relation points to",required:!0,mappingMode:"collection_counter"},"synced-property-name":{required:!1,values:!0,description:"The symmetric relation property name in the database this relation points to"}}},"schema-property-status":{propertyTagName:"property-status",inline:["schema-option-category"],attributes:{}},"schema-property-number":{propertyTagName:"property-number",inline:[],attributes:{format:{values:!0,description:"Number format",required:!1}}}},f=["Count all"],y=["Count values","Count unique values","Count empty","Count not empty","Percent empty","Percent not empty","Show unique values"],b={"Count all":"count","Count values":"count_values","Count unique values":"unique","Count empty":"empty","Count not empty":"not_empty","Percent empty":"percent_empty","Percent not empty":"percent_not_empty","Show unique values":"show_unique","Count checked":"checked","Count unchecked":"unchecked","Percent checked":"percent_checked","Percent unchecked":"percent_unchecked","Count per group":"count_per_group","Percent per group":"percent_per_group",Sum:"sum",Average:"average",Median:"median",Min:"min",Max:"max",Range:"range","Earliest date":"earliest_date","Latest date":"latest_date","Date range":"date_range"},v={basic:[...f,...y],date:[...f,...y,"Earliest date","Latest date","Date range"],status:[...f,...y,"Count per group","Percent per group"],number:[...f,...y,"Sum","Average","Median","Min","Max","Range"],checkbox:[...f,"Count checked","Count unchecked","Percent checked","Percent unchecked"]};function _(e){return`the name of the ${e} property being aggregated`}function k(e){return`the method of aggregation for the ${e} property`}const I={"aggregation-property-title":{attributes:{name:{required:!0,values:!0,description:_("title")},aggregation:{values:v.basic,required:!0,description:k("title")}}},"aggregation-property-text":{attributes:{name:{required:!0,values:!0,description:_("text")},aggregation:{values:v.basic,required:!0,description:k("text")}}},"aggregation-property-url":{attributes:{name:{required:!0,values:!0,description:_("url")},aggregation:{values:v.basic,required:!0,description:k("url")}}},"aggregation-property-email":{attributes:{name:{required:!0,values:!0,description:_("email")},aggregation:{values:v.basic,required:!0,description:k("email")}}},"aggregation-property-phone-number":{attributes:{name:{required:!0,values:!0,description:_("phone_number")},aggregation:{values:v.basic,required:!0,description:k("phone_number")}}},"aggregation-property-date":{attributes:{name:{values:!0,required:!0,description:_("date")},aggregation:{values:v.date,required:!0,description:k("date")}}},"aggregation-property-created-time":{attributes:{name:{values:!0,required:!0,description:_("created-time")},aggregation:{values:v.date,required:!0,description:k("created-time")}}},"aggregation-property-last-edited-time":{attributes:{name:{values:!0,required:!0,description:_("last-edited-time")},aggregation:{values:v.date,required:!0,description:k("last-edited-time")}}},"aggregation-property-person":{attributes:{name:{values:!0,required:!0,description:_("person")},aggregation:{values:v.basic,required:!0,description:k("person")}}},"aggregation-property-created-by":{attributes:{name:{values:!0,required:!0,description:_("created-by")},aggregation:{values:v.basic,required:!0,description:k("created-by")}}},"aggregation-property-last-edited-by":{attributes:{name:{values:!0,required:!0,description:_("last-edited-by")},aggregation:{values:v.basic,required:!0,description:k("last-edited-by")}}},"aggregation-property-checkbox":{attributes:{name:{values:!0,required:!0,description:_("checkbox")},aggregation:{values:v.checkbox,required:!0,description:k("checkbox")}}},"aggregation-property-select":{attributes:{name:{values:!0,required:!0,description:_("select")},aggregation:{values:v.basic,required:!0,description:k("select")}}},"aggregation-property-multi-select":{attributes:{name:{values:!0,required:!0,description:_("multi-select")},aggregation:{values:v.basic,required:!0,description:k("multi-select")}}},"aggregation-property-relation":{attributes:{name:{values:!0,required:!0,description:_("relation")},aggregation:{values:v.basic,required:!0,description:k("relation")}}},"aggregation-property-number":{attributes:{name:{values:!0,required:!0,description:_("number")},aggregation:{values:v.number,required:!0,description:k("number")}}},"aggregation-property-status":{attributes:{name:{values:!0,required:!0,description:_("status")},aggregation:{values:v.status,required:!0,description:k("status")},group:{values:!0,required:!0,description:"then name of the status group being aggregated when aggregation is 'Count per group' or 'Percent per group'. For other aggregations, just provide any group name."}}}},w=["hr","h1","h2","h3","database","math-block","code-block","child-page","link-page","child-database","link-database","database-views","text","page","synced-block","synced-block-reference","uli","oli","toggle","quote","callout","todo","columns","table","unknown-block"],S={required:!1,values:d,description:"color for the block"},N={hr:{title:!1,content:[],attributes:{},properties:[],schemas:[]},h1:{title:!0,content:[],attributes:{color:S},properties:[],schemas:[]},h2:{title:!0,content:[],attributes:{color:S},properties:[],schemas:[]},h3:{title:!0,content:[],attributes:{color:S},properties:[],schemas:[]},database:{title:!1,content:[],attributes:{},properties:["property-title"],schemas:g},"math-block":{title:!0,content:[],attributes:{},properties:[],schemas:[]},"code-block":{title:!0,content:[],attributes:{language:{required:!1,values:n(15440).yz,description:"language of code"}},properties:[],schemas:[]},"child-page":{title:!1,content:[],attributes:{"page-id":{required:!0,values:!0,description:"ID of page, to be used in <load>",mappingMode:"block_counter"},"database-id":{required:!1,values:!0,description:"The ID of the database this page is within, if there is one",mappingMode:"collection_counter"},"has-content":{required:!1,values:["true","false"],description:'"true" if the page has content, "false" otherwise'}},properties:g,schemas:[]},"link-page":{title:!1,content:[],attributes:{"page-id":{required:!0,values:!0,description:"ID of page, to be used in <load>",mappingMode:"block_counter"},"database-id":{required:!1,values:!0,description:"The ID of the database this page is within, if there is one",mappingMode:"collection_counter"}},properties:g,schemas:[]},"child-database":{title:!1,content:[],attributes:{"database-id":{required:!0,values:!0,description:"ID of database. Make sure to use the value of this attribute as the id in query-database.",mappingMode:"block_counter"}},properties:["property-title"],schemas:g},"database-views":{title:!1,content:[],attributes:{},properties:["property-title"],schemas:g},"link-database":{title:!1,content:[],attributes:{"database-id":{required:!0,values:!0,description:"ID of database",mappingMode:"collection_counter"}},properties:["property-title"],schemas:g},text:{title:!0,content:w,attributes:{color:S},properties:[],schemas:[]},page:{title:!1,content:w,attributes:{"database-id":{required:!1,values:!0,description:"ID of the database this page belongs to. Use this to look up the schema for the page",mappingMode:"collection_counter"},"page-font":{required:!1,values:["default","serif","mono"],description:"Font used for the page"},"page-width":{required:!1,values:["default","full-width"],description:"Width of the page"},"page-font-size":{required:!1,values:["default","small"],description:"Font size for the page"}},properties:g,schemas:[]},uli:{title:!0,content:w,attributes:{color:S},properties:[],schemas:[]},oli:{title:!0,content:w,attributes:{color:S,index:{required:!1,values:!0,description:"Specify a custom index for the list item"}},properties:[],schemas:[]},toggle:{title:!0,content:w,attributes:{color:S,size:{required:!1,values:["h1","h2","h3"],description:"size of the toggle header, if the toggle is a header"}},properties:[],schemas:[]},quote:{title:!0,content:w,attributes:{color:S},properties:[],schemas:[]},todo:{title:!0,content:w,attributes:{checked:{required:!0,values:["true","false"],description:'checked state, either "true" or "false"'},color:S},properties:[],schemas:[]},callout:{title:!0,content:w,attributes:{color:S},properties:[],schemas:[]},"synced-block":{title:!1,content:w,attributes:{},properties:[],schemas:[]},"synced-block-reference":{title:!1,content:w,attributes:{"synced-block-id":{required:!0,values:!0,description:"The ID of the <synced-block> node that this references",mappingMode:"block_counter"}},properties:[],schemas:[]},columns:{title:!1,content:["column"],attributes:{},properties:[],schemas:[]},column:{title:!1,content:w,attributes:{},properties:[],schemas:[]},table:{title:!1,content:["tr"],attributes:{"header-row":{required:!1,values:["true","false"],description:'whether first <tr> is row header, either "true" or "false"'},"header-column":{required:!1,values:["true","false"],description:'whether first <td> in every <tr> is column header, either "true" or "false"'}},properties:[],schemas:["property-text"]},tr:{title:!1,content:[],attributes:{},properties:["property-text"],schemas:[]},"ai-block":{title:!0,content:w,attributes:{},properties:["property-text"],schemas:[]},transcript:{title:!0,content:w,attributes:{},properties:[],schemas:[]},"unknown-block":{title:!0,content:w,attributes:{type:{required:!1,values:Object.values(n(700500).xd),description:"the type of the unknown block"}},properties:[],schemas:[]}},T=Object.freeze((0,s().uv)({text:!0,toggle:!0,quote:!0,callout:!0,uli:!0,oli:!0,todo:!0,h1:!0,h2:!0,h3:!0}));function C(e){return e}function x(e){return e}function A(e){return e}function P(e){return e}function D(){return r().JW()}function M(e){return(0,o().gB)(a()(e))}function U(e){return"collectionView"===e.type}const E="search-notion-help";function O(e){return"synced-block-reference"===e||"ai-block"===e||"database-views"===e||"transcript"===e}},262246:(e,t,n)=>{"use strict";n.d(t,{l:()=>o});class a extends(()=>n(757695))().Store{getInitialState(){return{currentScreen:"none",connectionStatus:"not_started",sessionId:n(206267).JW(),analyticsFrom:"unknown",syncProgressPercentage:0,isLoaded:!1,isConnected:!1,isDisconnecting:!1,error:void 0,externalSourceName:void 0,forceShowAuthNotificationTriggeredAt:void 0}}}const o=new a},291657:(e,t,n)=>{"use strict";n.d(t,{t:()=>o,y:()=>r});var a=()=>n(206267);function o(){return{currentScreen:"none",status:"not_started",sessionId:a().JW(),analyticsFrom:"unknown",isConnected:!1,isPersonalAuthComplete:!1,isDisconnecting:!1,isLoaded:!1}}class s extends(()=>n(757695))().Store{getInitialState(){return o()}}const r=new s;(0,n(852832).exposeDebugValue)("outlookAIConnectorStore",r)},292722:(e,t,n)=>{"use strict";n.d(t,{A0:()=>r,Ld:()=>l,Os:()=>p,SH:()=>i,ag:()=>u,c9:()=>d,rk:()=>c});n(944114),n(898992),n(354520),n(581454);var a=()=>n(534177),o=()=>n(252050),s=()=>n(706461);function r(e){return e.replace(/<think>[\s\S]*?<\/think>/g,"").trim()}function i(e){return e.replace(/<lang[\s\S]*?\/?>/g,"").trim()}function c(e){return e.replaceAll(s().uS,"").replaceAll(s().dK,"")}function d(e){const{tagName:t,inputString:n}=e,a=new RegExp(`<${t}(?:\\s+[^>]*)?>([\\s\\S]*?)</${t}>`,"g");let o;const s=[];for(;null!==(o=a.exec(n));)s.push(o[1]);return s.join("\n")}function l(e){return(0,a().Xk)(o().F6,e.tagName)}function u(e){return(0,a().Xk)(o().qI,e.tagName)}function p(e){const t=[];for(const n of e.children)"collectionView"!==n.type&&(t.push(n),t.push(...p(n)));return t}},295118:(e,t,n)=>{"use strict";n.d(t,{Wh:()=>w,ZC:()=>I,jx:()=>S});var a=()=>n(902006),o=()=>n(208685),s=()=>n(763824),r=()=>n(534177),i=()=>n(993474),c=()=>n(174636),d=()=>n(262246),l=()=>n(291075),u=()=>n(575922),p=()=>n(46657),m=()=>n(963702),g=()=>n(702327),h=()=>n(8870),f=()=>n(723771),y=()=>n(92383),b=()=>n(765957),v=()=>n(756315),_=()=>n(99254),k=()=>n(231297);const I=new(n(178624).R)({key:"use_mock_connector_status",namespace:n(553737).cd,important:!1,trackingType:"preference"});function w(e,t,n){const a=b().default.state.sidebarSpaceViewStore;if(a&&k().createAndCommit({userAction:"mockConnectorStatusActions.setDebuggingConnectorStatus",environment:e,canUndo:!1,perform:e=>{a&&k().applyOperation({store:a,operation:{pointer:a.pointer,path:["settings"],command:"update",args:{...a.getSettings(),dismissed_slack_personal_auth_prompt:!1,dismissed_github_personal_auth_prompt:!1}},transaction:e})}}),"slack"===t)(0,r().O)(T,n)&&c().R.setState(T[n]);else if("google-drive"===t)(0,r().O)(x,n)&&v().d.setState(x[n]);else if("github"===t)(0,r().O)(P,n)&&l().o.setState(P[n]);else if("jira"===t)(0,r().O)(M,n)&&_().y.setState(M[n]);else if("sharepoint"===t)(0,r().O)(F,n)&&y().E.setState(F[n]);else if("microsoft-teams"===t)(0,r().O)(E,n)&&m().F.setState(E[n]);else if("notion-mail"===t)(0,r().O)($,n)&&h().L.setState($[n]);else if("google-calendar"===t)(0,r().O)(j,n)&&u().W.setState(j[n]);else if("notion-calendar"===t)(0,r().O)(L,n)&&g().g.setState(L[n]);else if("linear"===t)(0,r().O)(V,n)&&p().W.setState(V[n]);else if("salesforce"===t)(0,r().O)(J,n)&&f().C.setState(J[n]);else if("discord"===t)(0,r().O)(G,n)&&d().l.setState(G[n]);else if((0,o().lm)(t)){(0,i().K)(t).setDebuggingStatus(n)}else console.log("Connector not implemented",t)}async function S(e,t=2500){for(const n of Object.values(a().fl))if((0,r().O)(Y,n))for(const a of Object.keys(Y[n]))console.log("Setting mock connector status for",n,a),w(e,n,a),await(0,s().wR)(t)}const N=(0,c().Q)(),T={not_connected:N,no_channels_selected:{...N,noChannelsSelected:!0},cant_query_connection:{...N,canQuery:!1,isSyncCompleted:!0},in_progress:{...N,inProgress:!0,isSyncCompleted:!1,ingestionProgress:50},disconnecting:{...N,isSyncCompleted:!0,inProgress:!1,connectedApps:["slack-admin"],isDisconnecting:!0},connected:{...N,isSyncCompleted:!0,inProgress:!1,connectedApps:["slack-admin"]}},C=(0,v().s)(),x={not_connected:{...C},in_progress:{...C,initialSyncState:"in_progress",syncProgress:"initial_file_sync_in_progress",syncCurrent:50,syncTotal:100,ingestionProgress:50},disconnecting:{...C,syncProgress:"completed",initialSyncState:"completed",isDisconnecting:!0},connected:{...C,syncProgress:"completed",initialSyncState:"completed"}},A=(0,l().F)(),P={not_started:A,not_authenticated:{...A,isConnected:!0,isPersonalAuthComplete:!1,githubOrg:{id:1,installationId:1,isSyncComplete:!0,lastSyncedAt:1,name:"Test Org"},externalSourceName:"Test Org"},in_progress:{...A,status:"in_progress",externalSourceName:"Test Org"},disconnecting:{...A,isPersonalAuthComplete:!0,isConnected:!0,isDisconnecting:!0,externalSourceName:"Test Org"},connected:{...A,isPersonalAuthComplete:!0,isConnected:!0,externalSourceName:"Test Org"}},D=(0,_().L)(),M={not_started:{...D},in_progress:{...D,jiraSyncState:"in_progress",jiraSyncProgress:50},disconnecting:{...D,jiraSyncState:"completed",isDisconnecting:!0},connected:{...D,jiraSyncState:"completed"},jira_connection_pending:{...D,jiraSyncState:"pending_connection",jiraSyncProgress:0}},U=(0,m().G)(),E={not_started:U,in_progress:{...U,connectionStatus:"in_progress",syncProgressPercentage:50},disconnecting:{...U,connectionStatus:"completed",isDisconnecting:!0},connected:{...U,connectionStatus:"completed"}},O=(0,y().F)(),F={not_started:O,in_progress:{...O,connectionDetails:{status:"in_progress",progress:50,externalSourceName:"Notion Labs"}},disconnecting:{...O,isConnected:!0,connectionDetails:{status:"disconnecting",progress:100,externalSourceName:"Notion Labs"},isDisconnecting:!0},connected:{...O,isConnected:!0,connectionDetails:{status:"completed",progress:100,externalSourceName:"Notion Labs"}},sharepoint_select_sites:{...O,connectionDetails:{status:"pending_selection",progress:0,externalSourceName:"Notion Labs"}}},B=(0,h().K)(),$={not_started:B,connected:{...B,isConnected:!0,status:"authenticated"}},q=(0,u().R)(),j={not_started:q,connected:{...q,isConnected:!0,status:"authenticated"}},R=(0,g().V)(),L={not_started:R,connected:{...R,isConnected:!0,status:"authenticated"}},K=(0,n(291657).t)(),H={not_started:K,connected:{...K,isConnected:!0,status:"authenticated"}},W=p().W.getInitialState(),V={not_started:{...W},in_progress:{...W,status:"in_progress",ingestionProgress:50},disconnecting:{...W,isConnected:!0,status:"disconnecting",ingestionProgress:100,isDisconnecting:!0},connected:{...W,isConnected:!0,status:"completed",ingestionProgress:100}},z=f().C.getInitialState(),J={not_started:{...z},in_progress:{...z,status:"in_progress",connectionDetails:{status:"in_progress",progress:50,externalSourceName:"Notion Labs"}},disconnecting:{...z,isConnected:!0,status:"disconnecting",connectionDetails:{status:"disconnecting",progress:100,externalSourceName:"Notion Labs"},isDisconnecting:!0},connected:{...z,isConnected:!0,status:"completed",connectionDetails:{status:"completed",progress:100,externalSourceName:"Notion Labs"}}},Q=d().l.getInitialState(),G={not_started:{...Q},in_progress:{...Q,connectionStatus:"in_progress"},disconnecting:{...Q,isConnected:!0,connectionStatus:"disconnecting",isDisconnecting:!0},connected:{...Q,isConnected:!0,connectionStatus:"completed"}},Y={slack:T,"google-drive":x,github:P,jira:M,sharepoint:F,"microsoft-teams":E,outlook:H,linear:V,discord:G}},316581:(e,t,n)=>{"use strict";n.d(t,{_A:()=>u,nt:()=>l});n(16280),n(944114),n(898992),n(354520),n(672577),n(430670),n(803949),n(581454),n(908872),n(737550);var a=n.n(n(755373)),o=()=>n(496603),s=()=>n(534177),r=()=>n(902006),i=()=>n(208685),c=()=>n(832443),d=()=>n(252050);function l(e){const{searchResults:t,state:n}=e;for(const o of t){const e=c().tD.parseAssistantHref(o.id);if("slack"===o.type)o.messages.forEach(((e,t)=>{const s=c().tD.parseAssistantHref(e.messageId);if(!s||"slack"!==s.type)throw new Error(`HREF (${e.messageId}) could not be parsed as a Slack message result`);if(0===t&&s.threadTs){const e=(0,r().V9)(`slack://?${a().stringify({base_url:s.baseUrl,channel_id:s.channelId,message_id:s.threadTs,thread_ts:s.threadTs})}`);n.setUniversalResultPayload(e,{type:"slack",href:e,threadHref:e,title:o.title,text:o.text,user:"",lastEdited:o.lastEdited,domain:s.domain,baseUrl:s.baseUrl,channelId:s.channelId,messageId:s.threadTs,threadTs:s.threadTs,threadMessages:o.messages.map((e=>e.messageId))})}n.setUniversalResultPayload((0,r().V9)(e.messageId),{type:"slack",href:e.messageId,threadHref:e.threadId,title:o.title,text:e.text,user:e.user,lastEdited:e.lastEdited,domain:s.domain,baseUrl:s.baseUrl,channelId:s.channelId,messageId:s.messageId,threadTs:s.threadTs,threadMessages:o.messages.map((e=>e.messageId))})}));else if("helpdoc"===o.type){if(!e||"helpdoc"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a helpdoc result`);const t={type:"helpdoc",href:o.id,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};n.setUniversalResultPayload((0,r().h5)(o.id),t)}else if("helpdoc-section"===o.type){if(!e||"helpdoc-section"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a helpdoc-section result`);const t={type:"helpdoc-section",href:o.id,parentPageHref:e.parentPageHref,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};n.setUniversalResultPayload(e.href,t);const a=c().tD.parseAssistantHref(e.parentPageHref);if("helpdoc"!==(null==a?void 0:a.type))throw new Error(`HREF (${o.id}) could not be parsed as a helpdoc-section result because its parent page could not be parsed as a helpdoc`);n.setUniversalResultPayload(e.parentPageHref,{...t,type:"helpdoc",href:e.parentPageHref,title:o.path,text:"",lastEdited:o.lastEdited,url:a.url})}else if("webpage"===o.type){if(!e||"webpage"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a webpage result`);const t={type:"webpage",href:o.id,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};n.setUniversalResultPayload((0,r().RW)(o.id),t)}else if("gmail"===o.type){if(!e||"gmail"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a gmail result`);const t=(0,r().V9)(`gmail://?url=${encodeURIComponent(`https://mail.google.com/mail/?authuser=${o.emailAddress}#all/${o.pageId}`)}`),a={type:"gmail",href:o.id,threadHref:t,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};n.setUniversalResultPayload(e.href,a);const s=c().tD.parseAssistantHref(t);if("gmail"!==(null==s?void 0:s.type))throw new Error(`HREF (${o.id}) could not be parsed as a gmail result because its thread URL ${t} could not be parsed as gmail href`);n.setUniversalResultPayload(t,{...a,type:"gmail",href:t,title:o.path,text:o.text,lastEdited:o.lastEdited,url:s.url,threadHref:t})}else if("notion-mail"===o.type){if(!e||"notion-mail"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a notion-mail result`);const t=(0,r().V9)(`notion-mail://?url=${encodeURIComponent(`https://notion.so/mail/${o.pageId}`)}`),a={type:"notion-mail",href:o.id,threadHref:t,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};n.setUniversalResultPayload(e.href,a);const s=c().tD.parseAssistantHref(t);if("notion-mail"!==(null==s?void 0:s.type))throw new Error(`HREF (${o.id}) could not be parsed as a gmail result because its thread URL ${t} could not be parsed as gmail href`);n.setUniversalResultPayload(t,{...a,type:"notion-mail",href:t,title:o.path,text:o.text,lastEdited:o.lastEdited,url:s.url,threadHref:t})}else if("outlook"===o.type){if(!e||"outlook"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a outlook result`);const t=(0,r().V9)(`outlook://?url=${encodeURIComponent("https://outlook.live.com/mail/0/")}`),a={type:"outlook",href:o.id,threadHref:t,title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};n.setUniversalResultPayload(e.href,a);const s=c().tD.parseAssistantHref(t);if("outlook"!==(null==s?void 0:s.type))throw new Error(`HREF (${o.id}) could not be parsed as a outlook result because its thread URL ${t} could not be parsed as outlook href`);n.setUniversalResultPayload(t,{...a,type:"outlook",href:t,title:o.title,text:o.text,lastEdited:o.lastEdited,url:s.url,threadHref:t})}else if("microsoft-teams"===o.type){if(!e||"microsoft-teams"!==e.type)throw new Error(`HREF (${o.id}) could not be parsed as a microsoftTeams result`);o.messages.forEach(((e,t)=>{const s=c().tD.parseAssistantHref(e.messageId);if(!s||"microsoft-teams"!==s.type)throw new Error(`HREF (${e.messageId}) could not be parsed as a Slack message result`);if(0===t&&s.threadTs){const e={url:s.url,channel_id:s.channelId,message_id:s.threadTs,thread_ts:s.threadTs,message_type:s.messageType},t=(0,r().V9)(`microsoftTeams://?${a().stringify(e)}`);n.setUniversalResultPayload(t,{type:"microsoft-teams",href:t,threadHref:t,title:o.title,text:o.text,user:"",lastEdited:o.lastEdited,url:s.url,channelId:s.channelId,messageId:s.threadTs,threadTs:s.threadTs,messageType:s.messageType,threadMessages:o.messages.map((e=>e.messageId))})}n.setUniversalResultPayload((0,r().V9)(e.messageId),{type:"microsoft-teams",href:e.messageId,threadHref:e.threadId,title:o.title,text:e.text,user:e.user,lastEdited:e.lastEdited,url:s.url,channelId:s.channelId,messageId:s.messageId,threadTs:s.threadTs,messageType:s.messageType,threadMessages:o.messages.map((e=>e.messageId))})}))}else if((0,r().SC)(o.type)){if(!e||e.type!==o.type)throw new Error(`HREF (${o.id}) could not be parsed as a ${o.type} result`);const t={type:o.type,href:(0,r().V9)(o.id),title:o.title,text:o.text,lastEdited:o.lastEdited,url:e.url};n.setUniversalResultPayload((0,r().V9)(o.id),t)}else if("page"===o.type){const e={type:"page",id:o.id,highlight:o.highlight,title:o.title,text:o.text,lastEdited:o.lastEdited};n.setUniversalResultPayload((0,d().ew)(o.id),e)}else{if("block"===o.type||"properties"===o.type)continue;(0,s().HB)(o.type)}}}function u(e){const{searchResults:t,systemMessages:n,evaluationId:a,scope:c}=e;let d=!1;const l=t.filter((e=>"block"===e.type||"properties"===e.type)),u=function(e){return e.reduce(((e,t)=>{const n=e.find((e=>e.pageId===t.pageId));return n?(n.blocks.push(t),e):[...e,{pageId:t.pageId,title:t.title,path:t.path,lastEdited:t.lastEdited,blocks:[t]}]}),[])}(l),m=u.map((e=>(e.blocks.some((e=>e.isPrivate))&&(d=!0),{type:"element",tagName:"page",attributes:{id:e.pageId,title:e.title,...e.path&&{path:e.path},"last-edited-datetime":e.lastEdited},children:p(e.blocks).map((e=>({type:"element",tagName:"block",attributes:{id:e.id},children:[{type:"text",value:e.text}]})))}))),g=t.filter((e=>!("page"!==e.type&&"helpdoc"!==e.type&&"helpdoc-section"!==e.type&&"webpage"!==e.type&&!(0,r().SC)(e.type))||"block"!==e.type&&"properties"!==e.type&&(0,s().HB)(e.type))),h=[];for(const o of g){const{id:e,title:t,text:n,lastEdited:a}=o;if(o.isPrivate&&(d=!0),"slack"===o.type)h.push({type:"element",tagName:"slack-thread",attributes:{id:e,channel:o.channel||"","last-edited-datetime":a},children:o.messages.map((e=>({type:"element",tagName:"slack-message",attributes:{id:e.messageId,"last-edited-datetime":e.lastEdited,user:e.user},children:[{type:"text",value:e.text}]})))});else if("helpdoc"===o.type)h.push({type:"element",tagName:"helpdoc",attributes:{id:e,title:t,"last-edited-datetime":a},children:[{type:"element",tagName:"helpdoc-section",attributes:{id:e,title:t},children:[{type:"text",value:n}]}]});else if("helpdoc-section"===o.type){let s=h.find((e=>"helpdoc"===e.tagName&&e.attributes.id===o.pageId));s||(s={type:"element",tagName:"helpdoc",attributes:{id:o.pageId,title:o.path,"last-edited-datetime":a},children:[]},h.push(s)),s.children.push({type:"element",tagName:"helpdoc-section",attributes:{id:e,title:t},children:[{type:"text",value:n}]})}else if("google-drive"===o.type)h.push({type:"element",tagName:"google-drive-result",attributes:{id:e,title:t,"last-edited-datetime":a,...o.fileType&&{"file-type":o.fileType}},children:[{type:"text",value:n}]});else if("webpage"===o.type)h.push({type:"element",tagName:"webpage",attributes:{id:e,title:t,"updated-datetime":a},children:[{type:"text",value:n}]});else if("github"===o.type){const s=void 0===a||a.toLowerCase().includes("invalid");h.push({type:"element",tagName:"github-result",attributes:{id:e,title:t,...o.authorName&&{"author-username":o.authorName},...o.statusTag&&{status:o.statusTag},"repo-name":o.githubRepoName,...o.path&&{path:o.path},...!s&&{"last-edited-datetime":a},...o.fileType&&{"file-type":o.fileType}},children:[{type:"text",value:n}]})}else if("jira"===o.type)h.push({type:"element",tagName:"jira-result",attributes:{id:e,title:t,"last-edited-datetime":a,project:o.path},children:[{type:"text",value:n}]});else if("notion-mail"===o.type){let a=h.find((e=>"notion-mail-result"===e.tagName&&e.attributes.id===o.pageId));a||(a={type:"element",tagName:"notion-mail-result",attributes:{id:o.pageId,title:o.title},children:[]},h.push(a)),a.children.push({type:"element",tagName:"email",attributes:{id:e,title:t},children:[{type:"text",value:n}]})}else if("outlook"===o.type){let a=h.find((e=>"outlook-result"===e.tagName&&e.attributes.id===o.pageId));a||(a={type:"element",tagName:"outlook-result",attributes:{id:o.pageId,title:o.title},children:[]},h.push(a)),a.children.push({type:"element",tagName:"email",attributes:{id:e,title:t},children:[{type:"text",value:n}]})}else if("microsoft-teams"===o.type)h.push({type:"element",tagName:"microsoft-teams-thread",attributes:{id:e,channel:o.channel||"","last-edited-datetime":a},children:o.messages.map((e=>({type:"element",tagName:"microsoft-teams-message",attributes:{id:e.messageId,"last-edited-datetime":e.lastEdited,user:e.user},children:[{type:"text",value:e.text}]})))});else if("sharepoint"===o.type)h.push({type:"element",tagName:"sharepoint-result",attributes:{id:e,title:t,"last-edited-datetime":a,...o.fileType&&{"file-type":o.fileType}},children:[{type:"text",value:n}]});else if("page"===o.type)h.push({type:"element",tagName:"page-result",attributes:{id:e,title:t,path:o.path,"last-edited-datetime":a},children:[{type:"text",value:n}]});else if("linear"===o.type)h.push({type:"element",tagName:"linear-result",attributes:{id:e,title:t,name:o.name,"last-edited-datetime":a},children:[{type:"text",value:n}]});else if("google-calendar"===o.type)h.push({type:"element",tagName:"google-calendar-result",attributes:{id:e,title:t},children:[{type:"text",value:n}]});else if("notion-calendar"===o.type)h.push({type:"element",tagName:"notion-calendar-result",attributes:{id:e,title:t},children:[{type:"text",value:n}]});else if("salesforce"===o.type)h.push({type:"element",tagName:"salesforce-result",attributes:{id:e,title:t,"last-edited-datetime":a,...o.fileType&&{"file-type":o.fileType}},children:[{type:"text",value:n}]});else if("discord"===o.type)h.push({type:"element",tagName:"discord-result",attributes:{id:e,title:t,"channel-name":o.title,"last-edited-datetime":a,...o.messageType&&{"message-type":o.messageType}},children:[{type:"text",value:n}]});else if("box"===o.type)h.push({type:"element",tagName:"box-result",attributes:{id:e,title:t,"last-edited-datetime":a,...o.fileType&&{"file-type":o.fileType}},children:[{type:"text",value:n}]});else{(0,i().vZ)(o.type).addSearchResultToXML(o,h)}}const f={},y=o().hS(t.flatMap((e=>{const{id:t,pageId:n,type:a}=e;if(t&&n&&(f[t]={deIdentifiedId:n,type:a}),"block"===e.type||"properties"===e.type){const t=m.find((t=>t.attributes.id===e.pageId));return t?[t]:[]}if("page"===e.type||"helpdoc"===e.type||"webpage"===e.type||"helpdoc-section"===e.type||(0,r().SC)(e.type)){const t=h.find((t=>t.attributes.id===e.id||t.children.some((t=>"attributes"in t&&t.attributes.id===e.id))));return t?[t]:[]}(0,s().HB)(e.type)})),"attributes.id");return{type:"observation",observationType:"search",value:{type:"element",resultType:"universal",tagName:"search-results",attributes:{"current-results":y.length.toString()},children:y},containsNonSpaceSharedResults:d,systemMessages:n,idToDeIdentifiedIds:f,evaluationId:a,scope:c}}function p(e){const t=["numbered_list","bulleted_list","text"];let n=[];return e.reduce(((a,o,r)=>{const i=o.blockType,c=[...a],d=(0,s().Xk)(t,i),l=d&&n.length>0&&o.text.length<750&&(u=n,(p=o).spanIndex-u[0].spanIndex<=5&&p.spanIndex-u[0].spanIndex>=0);var u,p;n.length>0&&(!l||n.length>10)&&(1===n.length?c.push(n[0]):c.push(m(n)),n=[]);return d&&0===n.length&&o.text.length<500||l?(n.push(o),r===e.length-1&&(c.push(m(n)),n=[])):c.push(o),c}),[])}function m(e){const t=e[0];return{type:"block",id:t.id,text:e.map((e=>e.text)).join("\n"),path:t.path,isPrivate:t.isPrivate,pageId:t.pageId,title:t.title,lastEdited:t.lastEdited,blockType:t.blockType,spanIndex:t.spanIndex}}},331119:(e,t,n)=>{"use strict";n.d(t,{RB:()=>b,U5:()=>l,W6:()=>u,ke:()=>g,nx:()=>f,t7:()=>h,x3:()=>y});n(16280),n(18107),n(944114),n(898992),n(354520),n(672577),n(581454);var a=()=>n(496603),o=()=>n(973647),s=()=>n(534177),r=()=>n(251582),i=()=>n(181856),c=()=>n(832443);const d=r().p.satisfy((e=>"element"===e.type));function l(e){return r().p.describe(r().p.filter(d,(t=>t.tagName===e)),(()=>new(i().gJ)(e)))}const u=r().p.satisfy((e=>"text"===e.type)),p=r().p.satisfy((e=>"text"===e.type&&""===e.value.trim()));function m(e){const{prefixMappingMode:t,baseHref:n}=e;return"query_database_result_counter"===t?`query_database_result_counter:/${c().tD.blockIdToHref(n)}`:"href_counter"===t?n:void(0,s().HB)(t)}function g(e){const{inputAttributes:t={},definitions:n,tagName:r,validateRequiredAttributes:d=!0,mapCounterToKey:l}=e,u=Object.keys(t),p=Object.keys(n),g=a().R9(u,p);if(g.length>0)return{error:new(i().LN)({attributeNames:g,tagName:r})};if(d)for(const[a,o]of Object.entries(n))if(o.required&&!u.includes(a))return{error:new(i().HQ)({attributeName:a,tagName:r})};const h=a().o8(t);for(const[a,f]of Object.entries(t)){const e=n[a];if((0,s().O9)(e.mappingMode)){if("href_counter"!==e.mappingMode&&!(0,c().D4)(f))return{error:new(i().qW)(a,f)};if((0,s().O9)(l)&&"href_counter"===e.mappingMode){let e;const t=["href_counter","query_database_result_counter"];for(const n of t)if(e=c().tD.mapCounterToKeyInMode({mapCounterToKey:l},f,n,r),o().Q.isSuccess(e)){h[a]=m({prefixMappingMode:n,baseHref:e.value});break}if(o().Q.isFail(e))return{error:new(i().wL)("unmapped_id",e.error.message,e.error)}}else if((0,s().O9)(l)){const t=c().tD.mapCounterToKeyInMode({mapCounterToKey:l},f,e.mappingMode,r);if(o().Q.isFail(t))return{error:new(i().wL)("unmapped_id",t.error.message,t.error)};h[a]=t.value}}if(!0!==e.values&&!e.values.includes(f))return{error:new(i().GW)({attributeName:a,receivedValue:f,tagName:r})}}return{value:h}}function h(e,t){if(0===e.length)throw new Error("Must provide at least 1 label and type guard");const n=[...e],a=[[]];for(const s of t){const[t,r]=n[0];if(!r(s)){for(;n.length>0;){n.shift();const e=n[0];if(a.push([]),e&&e[1](s))break}if(0===n.length){var o;const n=null===(o=e.find((([,e])=>e(s))))||void 0===o?void 0:o[0];if(!n)throw new Error(`Item did not match any type guards: ${JSON.stringify(s)}`);return{error:{incorrectLabel:n,lastLabel:t}}}}a.at(-1).push(s)}for(;a.length<e.length;)a.push([]);return{value:a}}function f(e,t,n){const{allowUnmatchedText:o=!1}=n??{},s=r().p.manyTill(r().p.choice([...t,...o?[r().p.map(p,(e=>{}))]:[],r().p.fail((t=>new(i().RR)({tagName:e,unexpectedNode:a().$1(t)})))]),r().p.eof());return r().p.map(s,(e=>a().oE(e)))}function y(e){return e.children&&e.children.length>0?{error:new(i().RR)({tagName:e.tagName,unexpectedNode:e.children[0]})}:{value:void 0}}function b(e){const{tagName:t,attributeDefinitions:n,mapCounterToKey:a}=e;return r().p.mapResult(l(t),(e=>{const s=g({tagName:t,inputAttributes:e.attributes,definitions:n,mapCounterToKey:a});if(o().Q.isFail(s))return s;const r=y(e);return o().Q.isFail(r)?r:{value:{attributes:s.value}}}))}},353566:(e,t,n)=>{"use strict";n.d(t,{Mz:()=>g,Yf:()=>h,TE:()=>G,fw:()=>f,W6:()=>v,vr:()=>b,vt:()=>Y,et:()=>y,AR:()=>X,N:()=>w,p$:()=>we,Eo:()=>T,WH:()=>W,nc:()=>H,mK:()=>V,yK:()=>S,XD:()=>k,Hh:()=>R,WM:()=>j,cW:()=>B,qY:()=>x,UQ:()=>U,xR:()=>E,C1:()=>M,FO:()=>O,Dp:()=>F,b8:()=>$,wu:()=>A,iL:()=>q,TM:()=>D,uz:()=>P,Yh:()=>_,By:()=>C,ZL:()=>ue,zY:()=>N,__:()=>I,$P:()=>L,lo:()=>K,Bq:()=>J,oq:()=>ee,UO:()=>Q,D6:()=>z,F1:()=>Ie});n(16280),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(430670),n(803949),n(581454);var a=()=>n(906745),o=()=>n(496603),s=()=>n(534177),r=()=>n(902006),i=()=>n(251582),c=()=>n(181856),d=()=>n(252050),l=()=>n(165358);var u=()=>n(316581),p=()=>n(292722),m=()=>n(162278);const g=16,h=20;function f(e){var t;const n=e.children??[];return{type:"block",tagName:e.tagName,parent:null===(t=e.parent)||void 0===t?void 0:t.attributes.id,attributes:{...e.attributes},children:"database-views"===e.tagName?e.children:n.map((e=>e.attributes.id)),text:e.text,properties:e.properties,schemas:e.schemas,schemaId:e.schemaId,persisted:e.persisted}}function y(e){const t=new Map;for(const[o,s]of Object.entries(e))for(const e of s.children){var n;if("string"==typeof e)t.set(e,o);else if(null!==(n=e.attributes)&&void 0!==n&&n.id){var a;t.set(null===(a=e.attributes)||void 0===a?void 0:a.id,o)}}return t}function b(e){const{node:t,getBlockById:n,alreadyConvertedBlocks:a=new Map,childIdToParentIdMap:o,assistantLoggingData:r}=e,i=a.get(t.attributes.id);if(i)return i;let c;if(t.parent&&"object"==typeof t.parent)c=t.parent;else{let e;if(e=t.parent&&"string"==typeof t.parent?t.parent:null==o?void 0:o.get(t.attributes.id),e){const s=n(e);if(!s)return void(r&&function(e,t){const{spaceId:n,userId:a,sessionId:o}=e,{parentTagType:s,parentId:r}=t;l().log({level:"debug",from:"convertAssistantBlockToBlockNode",type:"parentNotFound",data:{userId:a,spaceId:n,sessionId:o,miscDataToConvertToString:{parentTagType:s,parentId:r}}})}(r,{parentTagType:t.tagName,parentId:t.attributes.id}));c=b({node:s,getBlockById:n,alreadyConvertedBlocks:a,childIdToParentIdMap:o})}}c&&a.set(c.attributes.id,c);const d={type:t.type,tagName:t.tagName,parent:c,attributes:{...t.attributes},text:t.text,properties:t.properties,schemas:t.schemas,children:[],persisted:t.persisted,schemaId:t.schemaId};return a.set(d.attributes.id,d),d.children=t.children.map((e=>{if("string"==typeof e){const s=n(e);if(!s){if("database-views"===t.tagName)return;return void(r&&function(e,t){const{spaceId:n,userId:a,sessionId:o}=e,{parentTagType:s,parentId:r,childBlockId:i}=t;l().log({level:"debug",from:"convertAssistantBlockToBlockNode",type:"childNotFound",data:{userId:a,spaceId:n,sessionId:o,miscDataToConvertToString:{parentTagType:s,childBlockId:i,parentId:r}}})}(r,{parentTagType:t.tagName,parentId:t.attributes.id,childBlockId:e}))}return b({node:s,getBlockById:n,alreadyConvertedBlocks:a,childIdToParentIdMap:o,assistantLoggingData:r})}return e})).filter(s().O9),d}function v(e){const{node:t,blockIdMap:n,childIdToParentIdMap:a,alreadyConvertedBlocks:o,assistantLoggingData:s}=e;return b({node:t,getBlockById:e=>n instanceof Map?n.get(e):n[e],childIdToParentIdMap:a,alreadyConvertedBlocks:o,assistantLoggingData:s})}const _={"load-page":A,search:L,"search-people":async function(e){const{state:t,observationNode:n}=e,{search:a}=n.attributes,o=await t.searchPeople(a),s={type:"element",tagName:"search-people-results",attributes:{"current-results":Math.min(6,o.results.length).toString(),"total-results":o.total.toString()},children:o.results.slice(0,6).map((e=>{const{id:t,name:n,email:a}=e;return{type:"element",tagName:"person",attributes:{"person-id":t},children:[{type:"element",tagName:"property-text",attributes:{name:"Name"},children:[{type:"text",value:n}]},{type:"element",tagName:"property-email",attributes:{name:"Email"},children:[{type:"text",value:a}]}]}}))};return t.appendNewSearchPeopleResult(o.results),[{type:"observation",observationType:"searchPeople",value:s}]},"load-database":x,load:R,"search-databases":K,"load-slack":D,"load-attachment":j,"load-web-page":P,"load-google-drive":M,"load-github":U,"load-github-code":E,"load-jira":O,"load-linear":F,"load-box":B,"load-microsoft-teams":$,"load-sharepoint":q};function k(e){return e.tagName in _}function I(e,t){return"load-page"===e.tagName||"search"===e.tagName||"search-people"===e.tagName||"load-database"===e.tagName||"search-databases"===e.tagName||"load-slack"===e.tagName||"load-attachment"===e.tagName||"load-web-page"===e.tagName||"load-google-drive"===e.tagName||"load-github"===e.tagName||"load-github-code"===e.tagName||"load-jira"===e.tagName||"load-linear"===e.tagName||"load-box"===e.tagName||"load-microsoft-teams"===e.tagName||"load-sharepoint"===e.tagName?_[e.tagName]({observationNode:e,state:t}):void(0,s().HB)(e)}const w={"insert-before":H,"insert-after":W,"insert-inside":V,delete:function(e){const{state:t,effectNode:n}=e,a=n.attributes.id;if("property"===n.deleteType){const e=t.getBlockFromBlockIdMap(a);if("child-page"!==e.tagName)throw new(c().Te)("delete_property_on_non_database_child_page","Cannot call delete on a non-database child-page.");const[o]=n.children;switch(o.tagName){case"property-relation":!function({parentBlock:e,relationPropertyName:t,relationPropertyUpdates:n,state:a}){var o;const s=new Set(ve({propertyChild:n,parentBlock:e,propertyName:t,action:"delete",state:a})),r=e.properties[t];if("property-relation"!==r.tagName)throw new(c().Te)("invalid_relation_property_child","Invalid property child when setting relation");const i=r.children.filter((e=>{const t=e.attributes["page-id"];return!s.has(t)})),d={...r,children:i};e.properties[t]=d,a.addOperation({command:"setBlockProperty",blockNode:e,parentBlockId:null===(o=e.parent)||void 0===o?void 0:o.attributes.id,property:d},void 0)}({parentBlock:e,relationPropertyName:o.attributes.name,relationPropertyUpdates:o,state:t});break;case"property-person":ce({parentBlock:e,personPropertyUpdate:o,state:t,action:"delete"});break;case"property-multi-select":de({parentBlock:e,multiSelectPropertyName:o.attributes.name,multiSelectPropertyUpdates:o,state:t,action:"delete"});break;default:(0,s().HB)(o)}}else if("block"===n.deleteType){ue({remove:[t.getBlockFromBlockIdMap(a)],state:t})}else"table-column"===n.deleteType?X({state:t,effectNode:n}):(0,s().HB)(n)},"set-title":z,"set-attribute":J,"set-tag-name":Q,"set-property":ee,chat:G,"chat-md":function(e){const{state:t,effectNode:n}=e,a=["","","","","","","","","",""];let o=n.text;const s=/\[([0-9])\]/g;let r,i=1;for(;null!==(r=s.exec(n.text));)o=o.replace(r[0],`[${a[i]}](${t.getIdMapper().mapCounterToKey(r[1]).key.replaceAll("-","")})`),i++;t.chatMd(o)},"persist-blocks":function(e){const{state:t,effectNode:n,useCrdt:a}=e,o=oe({parent:void 0,children:n.children,state:t});for(const s of o)se({block:s,state:t,useCrdt:a})},create:Y,"related-content":()=>[]};function S(e){return e.tagName in w}function N(e,t,n){return"chat"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:void 0}):"insert-after"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:n}):"delete"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:void 0}):"insert-before"===e.tagName||"insert-inside"===e.tagName||"persist-blocks"===e.tagName||"create"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:n}):"set-attribute"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:void 0}):"set-property"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:n}):"set-tag-name"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:void 0}):"set-title"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:n}):"chat-md"===e.tagName||"related-content"===e.tagName?w[e.tagName]({effectNode:e,state:t,useCrdt:void 0}):void(0,s().HB)(e)}const T=["load-database","load-page","load","search","search-people","chat","create","search-databases","load-slack","insert-before","insert-after","insert-inside","delete","set-title","set-attribute","set-tag-name","set-property","replace","create-page","replace"],C={search:3,"search-people":3,load:10,"load-page":10,"load-database":10,"search-databases":3};async function x(e){const{state:t,observationNode:n}=e,{attributes:{id:a}}=n,{databaseNode:s,relatedNodes:r}=await t.loadDatabase(a);t.markDatabaseAsLoaded(a),t.addCollectionToCollectionIdMap(a,s),t.setSchemaIdMapForSchema(s.schemaId,s.schemas);const i=[];for(const{node:o,shouldShowObservation:c}of r)t.markDatabaseAsLoaded(o.attributes.id),t.setSchemaIdMapForSchema(o.schemaId,o.schemas),t.addCollectionToCollectionIdMap(o.attributes.id,o),c&&i.push(o);return o().hS([s,...i],(e=>e.attributes.id)).map((e=>"block"===e.type?{type:"observation",observationType:"page",pageId:e.attributes.id,value:e}:{type:"observation",observationType:"database",databaseId:e.attributes.id,value:e}))}async function A(e){const{state:t,observationNode:n}=e,{id:a}=n.attributes,{pageBlockNode:s,relatedNodes:r,relatedDatabaseNodes:i,isNonSpaceShared:c}=await t.loadPage(a);t.markPageAsLoaded(a),te(t,s);const d=[];for(const{node:o,shouldShowObservation:l}of r)"block"===o.type&&(te(t,o),l&&d.push(o));for(const o of i??[]){const e=o.node;t.addCollectionToCollectionIdMap(e.attributes.id,e),t.setSchemaIdMapForSchema(e.schemaId,e.schemas)}return o().hS([s,...d],(e=>e.attributes.id)).map((e=>({type:"observation",observationType:"page",pageId:e.attributes.id,value:e,isNonSpaceShared:c})))}async function P(e){const{state:t,observationNode:n}=e,{id:a}=n.attributes,o=await t.loadWebPage(a);t.markUniversalIdAsLoaded(a);const s={type:"observation",observationType:"webpage",value:{tagName:"webpage",type:"webpage",attributes:{id:a,title:o.AssistantWebpageSearchResult.title,"updated-datetime":o.AssistantWebpageSearchResult.lastEdited},children:[{type:"text",value:o.AssistantWebpageSearchResult.text}]}};return ne(t,s.value),[s]}async function D(e){const{state:t,observationNode:n}=e,{id:a}=n.attributes;try{const e=(await t.loadSlack(a)).slackMessage;t.markUniversalIdAsLoaded(a);const n={type:"slackMessages",tagName:"slack-messages",attributes:{id:a,channel:e.channel},children:e.messages.map((e=>({type:"slackMessage",tagName:"message",attributes:{user:e.user.name},value:e.text})))};return ne(t,n),[{type:"observation",observationType:"slack",value:n}]}catch(o){return[{type:"observation",observationType:"slack",value:{type:"slackMessages",tagName:"slack-messages",attributes:{id:a,channel:"unable to load"},children:[]}}]}}async function M(e){const{state:t,observationNode:n}=e,{id:a}=n.attributes;try{const e=(await t.loadGoogleDrive(a)).googleDriveContent;t.markUniversalIdAsLoaded(a);const n={type:"googleDrive",tagName:"google-drive",attributes:{id:(0,r().V9)(e.fileId),fileType:e.fileType,title:e.title},children:e.blocks.map((e=>({type:"googleDriveBlock",tagName:"google-drive-block",value:e})))};return ne(t,n),[{type:"observation",observationType:"googleDrive",value:n}]}catch(o){return[{type:"observation",observationType:"googleDrive",value:{type:"googleDrive",tagName:"google-drive",attributes:{id:a,title:"unable to load",fileType:"unable to load"},children:[]}}]}}async function U(e){const{state:t,observationNode:n}=e,{id:a}=n.attributes;try{const e=(await t.loadGithub(a)).githubContent;t.markUniversalIdAsLoaded(a);const n={type:"github",tagName:"github",attributes:{id:(0,r().V9)(e.prNumber),orgName:e.orgName,repoName:e.repoName,title:e.title},children:e.blocks.map((e=>({type:"githubBlock",tagName:"github-block",value:e})))};return ne(t,n),[{type:"observation",observationType:"github",value:n}]}catch(o){return[{type:"observation",observationType:"github",value:{type:"github",tagName:"github",attributes:{id:a,title:"unable to load",repoName:"unable to load",orgName:"unable to load"},children:[]}}]}}async function E(e){const{state:t,observationNode:n}=e,{id:a}=n.attributes;try{const e=(await t.loadGithubCode(a)).githubCodeContent;t.markUniversalIdAsLoaded(a);const n={type:"githubCode",tagName:"github-code",attributes:{id:(0,r().V9)(e.codePath),...e}};return ne(t,n),[{type:"observation",observationType:"githubCode",value:n}]}catch(o){return[{type:"observation",observationType:"github",value:{type:"github",tagName:"github",attributes:{id:a,title:"unable to load",repoName:"unable to load",orgName:"unable to load"},children:[]}}]}}async function O(e){const{state:t,observationNode:n}=e,{id:a}=n.attributes;try{const e=(await t.loadJira(a)).jiraContent;t.markUniversalIdAsLoaded(a);const n={type:"jira",tagName:"jira",attributes:{id:a,title:e.title},children:[{type:"text",value:e.text}]};return ne(t,n),[{type:"observation",observationType:"jira",value:n}]}catch(o){return[{type:"observation",observationType:"jira",value:{type:"jira",tagName:"jira",attributes:{id:a,title:"unable to load"},children:[{type:"text",value:""}]}}]}}async function F(e){const{state:t,observationNode:n}=e,{id:a}=n.attributes;try{const e=(await t.loadLinear(a)).linearContent;t.markUniversalIdAsLoaded(a);const n={type:"linear",tagName:"linear",attributes:{id:a,title:e.title,name:e.title,"linear-organization-id":"",assignee:"",creator:"",project:"",cycle:"","due-date":"",team:""},children:[{type:"text",value:e.text}]};return ne(t,n),[{type:"observation",observationType:"linear",value:n}]}catch(o){return[{type:"observation",observationType:"linear",value:{type:"linear",tagName:"linear",attributes:{id:a,title:"unable to load",name:"unable to load","linear-organization-id":"",assignee:"",creator:"",project:"",cycle:"","due-date":"",team:""},children:[{type:"text",value:""}]}}]}}async function B(e){const{state:t,observationNode:n}=e,{id:a}=n.attributes;try{const e=(await t.loadBox(a)).boxContent;t.markUniversalIdAsLoaded(a);const n={type:"box",tagName:"box",attributes:{id:a,title:e.title,name:e.title,"file-id":e.fileId},children:[{type:"text",value:e.blocks.join("\n")}]};return ne(t,n),[{type:"observation",observationType:"box",value:n}]}catch(o){return[{type:"observation",observationType:"box",value:{type:"box",tagName:"box",attributes:{id:a,title:"unable to load",name:"unable to load","file-id":""},children:[{type:"text",value:""}]}}]}}async function $(e){const{state:t,observationNode:n}=e,{id:a}=n.attributes;try{const e=(await t.loadMicrosoftTeams(a)).microsoftTeamsContent;t.markUniversalIdAsLoaded(a);const n={type:"microsoftTeamsMessages",tagName:"microsoft-teams-messages",attributes:{id:a,channel:e.channel},children:e.messages.map((e=>({type:"microsoftTeamsMessage",tagName:"microsoft-teams-message",attributes:{user:e.user.name},value:e.text})))};return ne(t,n),[{type:"observation",observationType:"microsoft-teams",value:n}]}catch(o){return[{type:"observation",observationType:"microsoft-teams",value:{type:"microsoftTeamsMessages",tagName:"microsoft-teams-messages",attributes:{id:a,channel:"unable to load"},children:[]}}]}}async function q(e){const{state:t,observationNode:n}=e,{id:a}=n.attributes;try{const e=(await t.loadSharepoint(a)).sharepointContent;t.markUniversalIdAsLoaded(a);const n={type:"sharepoint",tagName:"sharepoint",attributes:{id:(0,r().V9)(e.driveItemId),fileType:e.fileType,title:e.title},children:e.blocks.map((e=>({type:"sharepointBlock",tagName:"sharepoint-block",value:e})))};return ne(t,n),[{type:"observation",observationType:"sharepoint",value:n}]}catch(o){return[{type:"observation",observationType:"sharepoint",value:{type:"sharepoint",tagName:"sharepoint",attributes:{id:a,title:"unable to load",fileType:"unable to load"},children:[]}}]}}async function j(e){const{state:t,observationNode:n}=e,{id:a}=n.attributes;if("pdf"===n.attributes.attachmentType)return t.markAttachmentAsLoaded(a),async function(e){const{state:t,observationNode:n}=e,{id:a}=n.attributes,{pdfContent:o}=await t.loadPdf(a),s={type:"attachment",tagName:"attachment",attributes:{id:a,attachmentType:"pdf"},children:o.textContent.map((e=>({type:"attachmentContent",tagName:"attachment-content",attributes:{assistantAttachmentContentId:(0,d().Y1)()},value:e})))};return[{type:"observation",observationType:"attachment",value:s}]}({state:t,observationNode:n});(0,s().HB)(n.attributes.attachmentType)}function R(e){const{observationNode:t,state:n}=e;return"load-page"===t.tagName?A({state:n,observationNode:t}):"load-database"===t.tagName?x({state:n,observationNode:t}):"load-slack"===t.tagName?D({state:n,observationNode:t}):"load-google-drive"===t.tagName?M({state:n,observationNode:t}):"load-github"===t.tagName?U({state:n,observationNode:t}):"load-github-code"===t.tagName?E({state:n,observationNode:t}):"load-attachment"===t.tagName?j({state:n,observationNode:t}):"load-web-page"===t.tagName?P({state:n,observationNode:t}):"load-jira"===t.tagName?O({state:n,observationNode:t}):"load-microsoft-teams"===t.tagName?$({state:n,observationNode:t}):"load-sharepoint"===t.tagName?q({state:n,observationNode:t}):"load-linear"===t.tagName?F({state:n,observationNode:t}):"load-box"===t.tagName?B({state:n,observationNode:t}):void(0,s().HB)(t)}async function L(e){const{state:t,observationNode:n}=e,{question:a,keywords:o,lookback:s}=n.attributes;return await async function(e){const{state:t,query:n}=e,a=await t.search(n);return(0,u().nt)({searchResults:a.searchResults,state:t}),[(0,u()._A)(a)]}({state:t,query:{question:a,keywords:o,lookback:s,questionIntl:n.attributes["question-intl"],database:n.attributes.database,channel:n.attributes.channel,sourcePreference:n.attributes.source,sort:n.attributes.sort,fileType:n.attributes["file-type"],contributor:n.attributes.contributor,repo:n.attributes.repo,maybeNotionHelp:"true"===n.attributes[d().HV]}})}async function K(e){const{state:t,observationNode:n}=e,{results:a,total:o}=await t.searchDatabases(n.attributes.search),s=a.map((e=>{const{id:t,title:n}=e;return{type:"collection",tagName:"database",parent:e.parentId,attributes:{id:t,title:n},persisted:!0,schemaId:e.parentId,schemas:{},properties:{}}})),r={type:"element",tagName:"search-databases-results",attributes:{"current-results":a.length.toString(),"total-results":o.toString()},children:s};return t.appendNewSearchDatabasesResult(s),[{type:"observation",observationType:"searchDatabases",value:r}]}function H(e){const{state:t,effectNode:n,useCrdt:a}=e,{id:o}=n.attributes,r=t.getBlockFromBlockIdMap(o),i=t.getIdMapper().mapKeyToCounter({type:"block",key:o});if("page"===r.tagName&&"block"===n.insertType){const e=r.children[0];return e?void H({state:t,effectNode:{type:"effect",tagName:"insert-before",insertType:"block",attributes:{id:e.attributes.id},children:n.children},useCrdt:a}):void V({state:t,effectNode:{type:"effect",tagName:"insert-inside",insertType:"block",attributes:{id:r.attributes.id},children:n.children},useCrdt:a})}if(!r.parent)throw new(c().Te)("block_has_no_parent",`Cannot <insert-before> block with id ${i} because it has no parent.`);if("block"===n.insertType){const e=r.parent,o=e.children.findIndex((e=>e.attributes.id===r.attributes.id)),s=oe({parent:e,children:n.children,state:t});if(o<0)throw new(c().Te)("block_not_found",`Cannot <insert-before> block with id ${i} as it no longer exists. Do not reference block with id ${i}.`);const{parentForOperation:d}=ie({parent:e,index:o,insert:s,state:t,useCrdt:a});for(const n of s)t.addOperation({command:"insertBlockBefore",parentId:d.attributes.id,insertBlockNode:n,beforeId:r.attributes.id},void 0),"page"===n.tagName&&(t.markPageAsLoaded(n.attributes.id),t.setBlockIdMapForBlock(n.attributes.id,n))}else if("table"===n.insertType){const{name:e}=n.attributes;if("table"!==r.tagName)throw new(c().Te)("insert_before_name_not_on_table",`Cannot <insert-before> block with id ${i} with name attribute only works on tables.`);const a=Number(e);if(!Number.isInteger(a)||a<1)throw new(c().Te)("insert_before_invalid_column_index",`Invalid column index: ${a}.`);for(const t of r.children){if(!t.properties[e])throw new(c().Te)("insert_before_property_does_not_exist",`Property ${e} does not exist on table row.`)}le({tableBlockNode:r,children:n.children,atZeroBasedIndex:a-1,state:t})}else(0,s().HB)(n)}function W(e){const{state:t,effectNode:n,useCrdt:a}=e,{id:o}=n.attributes,r=t.getIdMapper().mapKeyToCounter({type:"block",key:o}),i=t.getBlockFromBlockIdMap(o);if("page"===i.tagName&&"block"===n.insertType){const e=i.children[0];return e?void H({state:t,effectNode:{type:"effect",tagName:"insert-before",insertType:"block",attributes:{id:e.attributes.id},children:n.children},useCrdt:a}):void V({state:t,effectNode:{type:"effect",tagName:"insert-inside",insertType:"block",attributes:{id:i.attributes.id},children:n.children},useCrdt:a})}if(!i.parent)throw new(c().Te)("block_not_found",`Cannot <insert-after> block with id ${r} as it no longer exists. Do not reference block with id ${r}.`);if("block"===n.insertType){const e=i.parent,o=e.children.findIndex((e=>e.attributes.id===i.attributes.id)),s=oe({parent:e,children:n.children,state:t});if(o<0)throw new(c().Te)("block_not_found",`Cannot <insert-after> block with id ${r} as it no longer exists. Do not reference block with id ${r}.`);const{parentForOperation:d}=ie({parent:e,index:o+1,insert:s,state:t,useCrdt:a}),l=[...s].reverse();for(const n of l)t.addOperation({command:"insertBlockAfter",parentId:d.attributes.id,insertBlockNode:n,afterId:i.attributes.id},void 0),"page"===n.tagName&&(t.markPageAsLoaded(n.attributes.id),t.setBlockIdMapForBlock(n.attributes.id,n))}else if("table"===n.insertType){const{name:e}=n.attributes;if("table"!==i.tagName)throw new(c().Te)("insert_after_name_not_on_table",`Cannot <insert-after> block with id ${r} using name attribute as this only works on tables.`);const a=Number(e);if(!Number.isInteger(a)||a<1)throw new(c().Te)("insert_after_invalid_column_index",`Invalid column index: ${a}.`);for(const t of i.children){if(!t.properties[e])throw new(c().Te)("insert_after_property_does_not_exist",`Property ${e} does not exist on table row.`)}le({tableBlockNode:i,children:n.children,atZeroBasedIndex:a,state:t})}else(0,s().HB)(n)}function V(e){const{state:t,effectNode:n,useCrdt:a}=e;if("block"===n.insertType){const e=n.attributes.id,o=t.getBlockFromBlockIdMap(e),s=oe({parent:o,children:n.children,state:t}),r=o.children.length,{parentForOperation:i}=ie({parent:o,index:r,insert:s,state:t,useCrdt:a});for(const n of s)t.addOperation({command:"insertBlockAfter",parentId:i.attributes.id,insertBlockNode:n},void 0),"page"===n.tagName&&(t.markPageAsLoaded(n.attributes.id),t.setBlockIdMapForBlock(n.attributes.id,n))}else if("blockIntoDatabase"===n.insertType){const e=n.attributes.id,o=t.getCollectionFromCollectionIdMap(e);if(!o)throw new Error(`No database to insert block ${n.attributes.id}`);const s=oe({parent:void 0,children:n.children,state:t,databaseSchemaId:o.schemaId});for(const n of s)se({block:n,state:t,databaseSchemaId:o.schemaId,collectionId:o.attributes.id,useCrdt:a}),t.addOperation({command:"setBlockParent",parentId:o.schemaId,blockNode:n,collectionId:o.attributes.id},void 0),t.markPageAsLoaded(n.attributes.id),t.setBlockIdMapForBlock(n.attributes.id,n)}else if("property"===n.insertType){const e=n.attributes.id,a=t.getBlockFromBlockIdMap(e);if("child-page"!==a.tagName&&"page"!==a.tagName)throw new(c().Te)("append_properties_to_page_only","You can only append to properties on a page object.");const o=n.children[0];switch(o.tagName){case"property-relation":!function(e){var t;const{parentBlock:n,relationPropertyName:a,relationPropertyUpdates:o,state:r}=e,i=ve({propertyChild:o,parentBlock:n,propertyName:a,action:"append",state:r}),d=(0,s().O)(n.properties,a)?n.properties[a]:void 0;if("property-relation"!==(null==d?void 0:d.tagName))throw new(c().Te)("invalid_relation_property_child","Invalid property child when setting relation");for(const s of i){const e={type:"inline",tagName:"mention-page",attributes:{"page-id":s},children:[]};d.children.push(e)}r.addOperation({command:"setBlockProperty",blockNode:n,parentBlockId:null===(t=n.parent)||void 0===t?void 0:t.attributes.id,property:d},void 0)}({parentBlock:a,relationPropertyName:o.attributes.name,relationPropertyUpdates:o,state:t});break;case"property-person":ce({parentBlock:a,personPropertyUpdate:o,state:t,action:"append"});break;case"property-multi-select":de({parentBlock:a,multiSelectPropertyName:o.attributes.name,multiSelectPropertyUpdates:o,state:t,action:"append"});break;default:throw new(c().Te)("invald_child_tag_for_insert_inside","Invalid child tag for insert-inside")}}else(0,s().HB)(n)}function z(e){const{state:t,effectNode:n,useCrdt:a}=e,s=n.attributes.id,r=t.getBlockFromBlockIdMap(s),i=t.getIdMapper().mapKeyToCounter({type:"block",key:s});if(!d().sA[r.tagName].title&&"page"!==r.tagName)throw new(c().Te)("block_does_not_allow_title",`Block with id ${i} is a <${r.tagName}>, which does not allow title.`);const l=n.children;o().n4(r.text,l)||(t.addOperation({command:"setBlockText",blockNode:r,text:l},a),r.text=l)}function J(e){const{state:t,effectNode:n}=e,{id:a,attributes:o}=n,s=t.getBlockFromBlockIdMap(a),r=Object.fromEntries(Object.entries(d().sA[s.tagName].attributes).map((([e,{values:t}])=>[e,t])));for(const{key:i,value:d}of o){const e=r[i];if(!e)throw new(c().Te)("attempted_to_set_invalid_attribute",`Attempted to set an attribute on ID ${t.getIdMapper().mapKeyToCounter({type:"block",key:a})} that is not allowed: ${i}.`);if(!0!==e&&!e.includes(d))throw new(c().Te)("attempted_to_set_invalid_attribute_value",`Attempted to set attribute on ID ${t.getIdMapper().mapKeyToCounter({type:"block",key:a})} ${i} to value that is not allowed: ${d}.`);t.addOperation({command:"setBlockAttribute",blockNode:s,attribute:i,value:d},void 0),s.attributes[i]=d}}function Q(e){const{state:t,effectNode:n}=e,{id:a,newTagName:o}=n.attributes,s=t.getBlockFromBlockIdMap(a);s.tagName=o,t.addOperation({command:"setBlockTagName",blockNode:s,tagName:o},void 0)}function G({state:e,effectNode:t}){const{actionButtons:n,children:a,uncited:o}=t,s=oe({parent:void 0,children:a,state:e}),r=s.map((e=>e.attributes.id)),i=[...s,...s.flatMap((e=>(0,p().Os)(e)))].map((e=>({command:"createBlock",blockNode:e})));e.chat({blockIds:r,operations:i,actionButtons:n,uncited:o})}function Y(e){const{state:t,effectNode:n,useCrdt:a}=e,o=oe({parent:void 0,children:n.children,state:t});if(1!==o.length)throw new(c().Te)("create_effect_no_children","<create> must have a single page block.");for(const s of o){if("page"!==s.tagName)throw new(c().Te)("create_effect_must_have_page","<create> must have a single page block.");se({block:s,state:t,useCrdt:a}),t.addOperation({command:"addBlockToPage",blockNode:s},void 0),t.markPageAsLoaded(s.attributes.id)}}function X(e){const{state:t,effectNode:n}=e,a=n.attributes.id,o=t.getBlockFromBlockIdMap(a);if("table"!==o.tagName)throw new(c().Te)("delete_name_not_on_table","<delete> with name attribute can only be used on <table> blocks.");const s=n.attributes.name,r=Number(s);for(const i of o.children){const e=i.properties;if(1===Object.keys(e).length)throw new(c().Te)("cannot_delete_last_property",`Cannot delete property ${s} from row because it is the last property.`);if(!e[s])throw new(c().Te)("cannot_delete_nonexistent_property",`Cannot delete property ${s} from row because it does not exist.`);delete e[s];let t=r;for(;e[t+1];)e[t+1].attributes.name=t.toString(),t++}t.addOperation({command:"removeTableColumn",blockNode:o,columnIndex:r-1},void 0)}function Z(e){const{block:t,property:n}=e,a=n.attributes.name;if((0,s().O)(t.properties,a))return t.properties[a];if("property-title"===n.tagName)for(const o of(0,s().uv)(t.properties)){const e=t.properties[o];if("property-title"===e.tagName)return e}}function ee(e){const{state:t,effectNode:n}=e,a=n.attributes.id,o=n.children;for(const r of o){const e=t.getBlockFromBlockIdMap(a),n=r.attributes.name;if("tr"!==e.tagName){const o=Z({block:e,property:r});if(!o){let o=`Cannot set property '${n}' on block with id=${t.getIdMapper().mapKeyToCounter({type:"block",key:a})}.`;throw Object.keys(e.properties).length>0?o+=` These are properties that can be set: ${Object.keys(e.properties).join(",")}`:o+=" When setting the property of a page inside a database, you may need to <load> first.",new(c().Te)("cannot_set_property_on_block",o)}if(o.tagName!==r.tagName)throw new(c().Te)("cannot_set_property_to_different_type",`Attempted to set a property to a different tag name: ${o.tagName} -> ${r.tagName}.`)}var s;if("property-relation"===r.tagName)ae({block:e,propertyName:n,state:t,newPropertyValue:r});else"property-select"===r.tagName||"property-multi-select"===r.tagName||"property-status"===r.tagName?be({newPropertyValue:r,parentBlock:e,propertyName:n,state:t}):"property-number"===r.tagName?me({newPropertyValue:r}):"property-date"===r.tagName&&ye({newPropertyValue:r}),e.properties[n]=r,t.addOperation({command:"setBlockProperty",blockNode:e,parentBlockId:null===(s=e.parent)||void 0===s?void 0:s.attributes.id,property:r},void 0)}}function te(e,t){const n=[t],a=new Set;let o;for(;o=n.pop();)a.has(o.attributes.id)||(e.setSchemaIdMapForSchemaIfNotExists(o.schemaId,o.schemas),e.setBlockIdMapForBlock(o.attributes.id,o),"database-views"!==o.tagName&&n.push(...o.children),a.add(o.attributes.id))}function ne(e,t){e.setUniversalIdMapForUniversalNode(t.attributes.id,t)}function ae(e){var t;const{block:n,propertyName:a,state:o,newPropertyValue:s}=e;ve({propertyChild:s,parentBlock:n,propertyName:a,state:o,action:"overwrite"}),n.properties[a]=s,o.addOperation({command:"setBlockProperty",blockNode:n,parentBlockId:null===(t=n.parent)||void 0===t?void 0:t.attributes.id,property:s},void 0)}function oe(e){const{state:t,children:n,databaseSchemaId:a,parent:o}=e;return n.map((e=>ke({state:t,parsedBlock:e,parent:o,databaseSchemaId:a})))}function se(e){const{block:t,state:n,databaseSchemaId:a,collectionId:o,useCrdt:s}=e;if(!t.persisted&&"database-views"!==t.tagName){a&&o?n.addOperation({command:"createBlock",blockNode:t,databaseSchemaId:a,collectionId:o},s):n.addOperation({command:"createBlock",blockNode:t},s),t.persisted=!0;for(const e of t.children)se({block:e,state:n,useCrdt:s})}}function re(e){const{parent:t,state:n}=e;if("synced-block-reference"===t.tagName){if(!t.attributes["synced-block-id"])throw new(c().Te)("invalid_synced_block_reference","Synced block reference missing synced-block-id!");return n.getBlockFromBlockIdMap(t.attributes["synced-block-id"])}return t}function ie(e){const{parent:t,index:n,insert:a,state:o,useCrdt:s}=e,r=Array.isArray(a)?a:[a],i=re({parent:t,state:o}),l=d().sA[i.tagName].content,u=r.map((e=>e.tagName));for(const d of u)if(!l.includes(d)){if("child-page"===t.tagName)throw new(c().Te)("invalid_insert",`You attempted to insert a ${d} inside a child-page, which is invalid. You may have wanted to insert this ${d} in a database instead.`);throw new(c().Te)("invalid_insert",`You attempted to insert a ${d} inside ${t.tagName}. ${l.length>0?`${t.tagName} allows only children of type ${l.join(", ")}`:`${t.tagName} is not allowed children of any type.`}`)}for(let d=r.length-1;d>=0;d--){const e=r[d];if("block"!==e.type)throw new(c().Te)("cannot_insert_non_block_node","Cannot insert a non-block node.");e.parent=i,i.children.splice(n,0,e),se({block:e,state:o,useCrdt:s})}return{parentForOperation:i}}function ce(e){var t;const{parentBlock:n,personPropertyUpdate:a,state:r,action:i}=e,d=a.attributes.name,l=(0,s().O)(n.properties,d)?n.properties[d]:void 0;if("property-person"!==(null==l?void 0:l.tagName))throw new(c().Te)("invalid_person_property_child","Invalid property child when appending to person property");const u=function(e){const{propertyChild:t,parentBlock:n,propertyName:a,state:r,action:i}=e,d=t.children.filter((e=>"mention-person"===e.tagName)).map((e=>e.attributes["person-id"])),l=r.getSchemaFromSchemaIdMapIfExists(n.schemaId);if(!l)throw new(c().Te)("schema_not_found",`Database ${n.schemaId} was not found. You may need to use load-database to load it first.`);if(!(0,s().O)(l,a))throw new(c().Te)("cannot_update_nonexistent_property","Invalid schema for person property");const u=l[a];if("schema-property-person"!==u.tagName)throw new(c().Te)("invalid_schema_for_person_property","Invalid property schema for property person");const p=u.attributes.limit;switch(i){case"overwrite":if(d.length>1&&"1"===p)throw new(c().Te)("cannot_set_too_many_people_for_person_property","Tried to set too many people for person property with limit 1");return d;case"append":{const e=n.properties[a].children.filter((e=>"mention-person"===e.tagName)).map((e=>e.attributes["person-id"])),t=o().sb([...d,...e]);if(t.length>1&&"1"===p)throw new(c().Te)("cannot_set_too_many_people_for_person_property","Tried to set too many people for person property with limit 1");return t}case"delete":{const e=n.properties[a].children.filter((e=>"mention-person"===e.tagName)).map((e=>e.attributes["person-id"]));return o().R9(e,d)}default:(0,s().HB)(i)}}({propertyChild:a,parentBlock:n,propertyName:d,state:r,action:i}),p=[];for(const o of u){const e={type:"inline",tagName:"mention-person",attributes:{"person-id":o,"person-name":void 0},children:[]};p.push(e)}l.children=p,r.addOperation({command:"setBlockProperty",blockNode:n,parentBlockId:null===(t=n.parent)||void 0===t?void 0:t.attributes.id,property:l},void 0)}function de({parentBlock:e,multiSelectPropertyName:t,multiSelectPropertyUpdates:n,state:a,action:i}){var d;const l=function(e){const{propertyChild:t,parentBlock:n,propertyName:a,action:r}=e,i=t.children.map((e=>e.attributes.option));switch(r){case"overwrite":return i;case"append":{if(!(0,s().O)(n.properties,a))throw new(c().Te)("cannot_append_to_nonexistent_property",`"${a}" missing from properties`);const e=n.properties[a].children.map((e=>e.attributes.option));return o().sb([...i,...e])}case"delete":{if(!(0,s().O)(n.properties,a))throw new(c().Te)("cannot_delete_from_nonexistent_property",`"${a}" missing from properties`);const e=n.properties[a].children.map((e=>e.attributes.option));return o().R9(e,i)}default:(0,s().HB)(r)}}({propertyChild:n,parentBlock:e,propertyName:t,action:i}),u=[];for(const o of l){const e={type:"inline",tagName:"option",attributes:{option:(0,r().V9)(o)},children:[]};u.push(e)}const p=(0,s().O)(e.properties,t)?e.properties[t]:void 0;if("property-multi-select"!==(null==p?void 0:p.tagName))throw new(c().Te)("invalid_multi_select_property_child","Invalid property child when updating multi-select");p.children=u,be({state:a,propertyName:t,newPropertyValue:p,parentBlock:e}),a.addOperation({command:"setBlockProperty",blockNode:e,parentBlockId:null===(d=e.parent)||void 0===d?void 0:d.attributes.id,property:p},void 0)}function le(e){const{tableBlockNode:t,children:n,atZeroBasedIndex:a,state:o}=e;let r=a+1;const i=[];for(const l of n){if("move"===l.type){const e=l.attributes.name;if(!e)throw new(c().Te)("move_inside_insert_requires_name_attribute","<move> inside <insert-X> with name attribute requires name attribute.");for(const n of t.children){if((0,d().gc)(n))throw new Error(`Invalid table operation for block node: ${n.tagName}`);const t=n.properties;if(!(0,s().O)(t,e))throw new(c().Te)("move_inside_insert_property_does_not_exist",`Property ${e} does not exist on table row.`)}if(i.includes(e))throw new(c().Te)("cannot_move_property_more_than_once",`Cannot move property ${e} more than once.`);i.push(e)}else if("schema"===l.type){if(l.attributes.name!==r.toString())throw new(c().Te)("insert_inside_insert_requires_properties_in_order","<insert-X> with name attribute requires properties to be in order.")}else(0,s().HB)(l);r++}for(const l of t.children){if((0,d().gc)(l))throw new Error(`Invalid table operation for block node: ${l.tagName}`);const e=Object.values(l.properties).filter((e=>!i.includes(e.attributes.name))).sort(((e,t)=>Number(e.attributes.name)-Number(t.attributes.name))),t=e.map((e=>Number(e.attributes.name))),o=t.indexOf(Math.max(...t.filter((e=>e<a+1))))+1,r=Object.fromEntries([...e.slice(0,o),...n.map((e=>{if("move"===e.type){if((0,s().O)(l.properties,e.attributes.name))return l.properties[e.attributes.name];throw new(c().Te)("property_missing_in_table_row",`"${e.attributes.name}" was missing in table row node properties`)}if("schema"===e.type){return{type:"property",tagName:"property-text",attributes:{name:e.attributes.name},children:[]}}(0,s().HB)(e)})),...e.slice(o)].map(((e,t)=>{const n=t+1;return[n,{...e,attributes:{...e.attributes,name:n.toString()}}]})));l.properties=r}o.addOperation({command:"insertOrMoveTableColumns",blockNode:t,atIndex:a,insertOrMoves:n},void 0)}function ue(e){const{remove:t,state:n}=e;for(const a of t){if(!a.parent)throw new(c().Te)("cannot_remove_block_without_parent",`Cannot remove block with id=${n.getIdMapper().mapKeyToCounter({type:"block",key:a.attributes.id})} because it has no parent.`);const e=re({parent:a.parent,state:n});if("child-page"===a.tagName&&"database-views"===a.parent.tagName)n.addOperation({command:"removeBlock",parentId:e.attributes.id,removeBlockNode:a},void 0);else{const t=e.children.findIndex((e=>e.attributes.id===a.attributes.id));if(t<0)throw new(c().Te)("cannot_remove_block_without_parent",`Cannot remove block with id=${n.getIdMapper().mapKeyToCounter({type:"block",key:a.attributes.id})} because it has no parent.`);n.addOperation({command:"removeBlock",parentId:e.attributes.id,removeBlockNode:a},void 0),a.parent.children.splice(t,1)}}}const pe=/^\s*[+-]?(\d+|\d*\.\d+|\d+\.\d*)([Ee][+-]?\d+)?\s*$/;function me(e){const{newPropertyValue:t}=e;if(t.attributes.number&&!pe.test(t.attributes.number))throw new(c().Te)("invalid_number_format","Invalid value for number property")}const ge=/\d{4}-\d{2}-\d{2}/,he=/\d{2}:\d{2}/;function fe(e){const{date:t,time:n}=e;if(!ge.test(t))throw new(c().Te)("invalid_date_format","Invalid date for date property: incorrect format");if(n&&!he.test(n))throw new(c().Te)("invalid_time_format","Invalid time for date property: incorrect format");let o;const s=e.timeZone?{zone:e.timeZone}:void 0;if(o=n?a().c9.fromFormat(`${t}T${n}`,"yyyy-MM-dd'T'HH:mm",s):a().c9.fromFormat(`${t}`,"yyyy-MM-dd"),!o.isValid)throw new(c().Te)("invalid_date_format","Invalid date for date property");return o}function ye(e){const{newPropertyValue:t}=e;if(0===t.children.length)return;if(t.children.length>1)throw new(c().Te)("invalid_date_format","Invalid value for date property. Expected only 1 child.");const[n]=t.children;if("mention-date"===n.tagName)fe({date:n.attributes.date});else if("mention-datetime"===n.tagName)fe({date:n.attributes.date,time:n.attributes.time});else if("mention-date-range"===n.tagName){const e=fe({date:n.attributes["start-date"]}),t=fe({date:n.attributes["end-date"]});if(e.valueOf()>t.valueOf())throw new(c().Te)("invalid_date_range","Invalid date range: start must be before end")}else if("mention-datetime-range"===n.tagName){const e=fe({date:n.attributes["start-date"],time:n.attributes["start-time"]}),t=fe({date:n.attributes["end-date"],time:n.attributes["end-time"]});if(e.valueOf()>t.valueOf())throw new(c().Te)("invalid_date_range","Invalid date range: start must be before end")}else(0,s().HB)(n)}function be(e){const{newPropertyValue:t,parentBlock:n,propertyName:a,state:o}=e,s=o.getSchemaFromSchemaIdMapIfExists(n.schemaId);if(!s)throw new(c().Te)("schema_not_found",`Database ${n.schemaId} was not found. You may need to use load-database to load it first.`);const r=s[a];if(!r||r.tagName!==`schema-${t.tagName}`)throw new(c().Te)("invalid_schema_for_property","Invalid schema for block. You may need to use load-database to load the database schema first.");const i=new Set;for(const c of r.children)if("schema-option"===c.tagName&&i.add(c.attributes.option),"schema-option-category"===c.tagName)for(const e of c.children)i.add(e.attributes.option);for(const d of t.children)if(!i.has(d.attributes.option))throw new(c().Te)("invalid_option_value",`Invalid option value: ${d.attributes.option}`);if("property-multi-select"!==t.tagName&&t.children.length>1)throw new(c().Te)("invalid_option_value","Invalid option value: limited to 1 option")}function ve(e){const{propertyChild:t,parentBlock:n,propertyName:a,state:o,action:r}=e,i=o.getSchemaFromSchemaIdMapIfExists(n.schemaId);if(!i)throw new(c().Te)("schema_not_found",`Database ${n.schemaId} was not found. You may need to use load-database to load it first.`);const d=t.children.map((e=>e.attributes["page-id"]));if("page"!==n.tagName&&"child-page"!==n.tagName)throw new(c().Te)("cannot_set_relation_property_on_non_page","Attempted to set relation property on a block that isn't a page");const l=n.properties[a];if(!l)throw new(c().Te)("cannot_set_relation_property_on_nonexistent_property",`There is no relation property named ${a}`);if("property-relation"!==l.tagName)throw new(c().Te)("cannot_set_relation_property_on_non_relation_property",`The ${a} property is not a relation`);const u=l.attributes["database-id"];if(!u)throw new(c().Te)("cannot_set_relation_property_on_nonexistent_database","Attempted to set relation property on a page that's not in a database");const p=i[a];if(!p||"schema-property-relation"!==p.tagName)throw new(c().Te)("invalid_schema_for_property","Invalid schema for block");const m=o.getCollectionFromCollectionIdMap(u);if("database"!==(null==m?void 0:m.tagName))throw new(c().Te)("ivalid_database_id_for_relation_property","Invalid database id for relation property");const g=o.getPageIdToBlockIdMap();for(const s of d){const e=g.get(s);if(!e)throw new(c().Te)("invalid_page_id_for_mention",`Invalid page id: ${s}`);if(o.getBlockFromBlockIdMap(e).schemaId!==m.schemaId)throw new(c().Te)("invalid_page_id_for_relation","Invalid page id for relation")}switch(r){case"overwrite":if("1"===p.attributes.limit&&d.length>1)throw new(c().Te)("cannot_set_too_many_pages_for_relation_property","Too many mentioned page ids for a relation field with limit 1");return d;case"append":{const e=n.properties[a];if("property-relation"!==e.tagName)throw new(c().Te)("invalid_relation_property_child","Invalid property child when setting relation");const t=new Set(e.children.map((e=>e.attributes["page-id"])));if(d.forEach(t.add,t),t.size>1&&"1"===p.attributes.limit)throw new(c().Te)("cannot_set_too_many_pages_for_relation_property",`Too many mentioned page ids for a relation field with limit ${p.attributes.limit}`);return d}case"delete":{const e=n.properties[a];if("property-relation"!==e.tagName)throw new(c().Te)("invalid_relation_property_child","Invalid property child when setting relation");const t=new Set(e.children.map((e=>e.attributes["page-id"])));for(const n of d)if(!t.has(n))throw new(c().Te)("cannot_delete_page_id_not_in_relation","Attempting to delete pageId not contained in relation.");return d}default:(0,s().HB)(r)}}function _e(e){const{parsedBlock:t,persisted:n,parent:a,databaseSchemaId:o}=e;return(0,d().g5)(t.tagName),{tagName:t.tagName,type:"block",persisted:n,attributes:t.attributes,text:t.text,properties:t.properties,schemas:t.schemas,children:[],parent:a,schemaId:o??t.attributes.id}}function ke(e){const{state:t,parsedBlock:n,parent:a,databaseSchemaId:o}=e;if("move"===n.type){const e=t.getBlockFromBlockIdMap(n.attributes.id);if(!a)throw new(c().Te)("cannot_move_block_without_parent","Parentless move node");return function(e){const{move:t,state:n,moveToParent:a}=e;for(const o of t){const e=n.getBlockFromBlockIdMap(o.attributes.id),t=n.getIdMapper().mapKeyToCounter({type:"block",key:e.attributes.id});if(!o.parent)throw new(c().Te)("cannot_move_block_without_parent",`Cannot move block without parent on block with id=${t}.`);n.addOperation({command:"moveBlock",parentId:a.attributes.id,oldParentId:o.parent.attributes.id,blockNode:o},void 0);const s=re({parent:o.parent,state:n}).children.findIndex((e=>e.attributes.id===o.attributes.id));if(s<0)throw new(c().Te)("cannot_move_block_without_parent",`Cannot move block without parent on block with id=${t}.`);o.parent.children.splice(s,1),o.parent=a}}({move:[e],state:t,moveToParent:a}),e}if(t.doesBlockIdMapHaveBlock(n.attributes.id)&&!(0,m().zQ)(n.tagName))return t.getBlockFromBlockIdMap(n.attributes.id);const s=_e({parsedBlock:n,persisted:!1,parent:a,databaseSchemaId:o});for(const r of n.children)s.children.push(ke({state:t,parsedBlock:r,parent:s,databaseSchemaId:o}));return t.setBlockIdMapForBlock(s.attributes.id,s),t.setSchemaIdMapForSchema(s.schemaId,s.schemas),s}function Ie(e){const{node:t,mapCounterToKey:n}=e;return function e(t,n){const a=_e({parsedBlock:t,parent:n,persisted:!0,databaseSchemaId:void 0});for(const o of t.children){if("move"===o.type)throw new(c().Te)("unexpected_move_node","Unexpected move node");a.children.push(e(o,a))}return a}((0,i().AZ)((0,m().V8)({allowMove:!1,allowUncited:!0,persisted:!0,mapCounterToKey:n}),t),void 0)}const we={version:g,context:{mode:"shared","available-commands":T},selection:void 0,loadedPageIds:[],schemaIdMap:{},peopleIdMap:{},blockIdMap:{},idMapper:{keyMap:[]},collectionIdMap:{},loadedDatabaseIds:[],loadedUniversalIds:[],universalIdMap:{},universalSearchResultPayloadMap:{},loadedAttachmentIds:[]}},370657:(e,t,n)=>{"use strict";n.d(t,{Ke:()=>v,RD:()=>y,Vf:()=>g,_z:()=>p,bz:()=>i,cZ:()=>k,d7:()=>w,dL:()=>f,hx:()=>r,iC:()=>_,jx:()=>h,lA:()=>b,qG:()=>m,rL:()=>l,s8:()=>I,vW:()=>c});n(898992),n(354520);var a=()=>n(496603),o=()=>n(534177);const s={search:{type:"search",scopeForNextSearch:{type:"everything"},filtersForNextSearch:n(239666).NH,searchSessionId:void 0,useWebSearch:!1},researcher:{type:"researcher",searchScope:{type:"everything"},useWebSearch:!0},"setup-generator":{type:"setup-generator"},workflow:{type:"workflow"},"markdown-chat":{type:"markdown-chat",model:"openai-gpt-4.1"},"fast-researcher":{type:"fast-researcher"}},r=["search","researcher","setup-generator","workflow","markdown-chat","fast-researcher"].map((e=>s[e]));function i(e){return s[e]}const c={maxIterations:8,multiturnIterations:1,thinkingTokens:1024,filterToSpaceSharedResults:!1,sectionReportWriting:!1},d=["search","researcher","setup-generator"];function l(e){return!(!(0,o().Xk)(d,e)&&"markdown-chat"!==e&&"workflow"!==e)}const u=["workflow","setup-generator","fast-researcher"],p=["markdown-chat","search","researcher","workflow","setup-generator"];function m(e){const{agentEnabled:t}=e,n=a().oE([...d,t?"workflow":void 0]);return r.filter((e=>n.includes(e.type)))}const g=[{type:"route-inference-transcript",configs:r.filter((e=>p.includes(e.type)))},...r.filter((e=>u.includes(e.type)))];function h(e){const{uploadedFileData:t,id:n}=e;if("application/pdf"===t.contentType){return{id:n,type:"attachment",fileUrl:t.originalFileUrl,fileName:t.fileName,contentType:t.contentType,base64EncodedFileUrl:t.base64EncodedFileUrl,permissionRecord:t.permissionRecord,metadata:e.metadata?{numPages:e.metadata.numPages}:void 0}}if("image/png"===t.contentType||"image/jpeg"===t.contentType||"image/gif"===t.contentType||"image/webp"===t.contentType||"image/heic"===t.contentType){return{id:n,type:"attachment",fileUrl:t.originalFileUrl,fileName:t.fileName,contentType:t.contentType,permissionRecord:t.permissionRecord}}if("text/csv"===t.contentType){return{id:n,type:"attachment",fileUrl:t.originalFileUrl,fileName:t.fileName,contentType:t.contentType,base64EncodedFileUrl:t.base64EncodedFileUrl,permissionRecord:t.permissionRecord}}(0,o().HB)(t.contentType)}n(902006).fl;const f="searchAgent",y="unifiedFindAgent",b="readingAgent",v="taskAgent",_="databaseAgent",k="databaseBulkReadContentAgent";const I={originalOutput:[],feedback:"",testTitle:"",inputSummary:"",promptFeedback:"",testInstructions:"",originalOutputPassesTest:!1,originalOutputTestResults:[],correctedOutputs:[],verified:!1,isOptional:!1},w=["Eval","Prompt"];"\n'Chat with AI':\n\nRouting Instructions:\n- If this mode is selected, the user will receive an AI response without a search being conducted.\n- Route to this mode when the user asks for general knowledge, chatting, or writing content that does not require additional information not already in the context.\n- Do NOT route to this mode when the query requires current statistics, facts, or up-to-date information.\n- Do NOT route to this mode when the query requires searching the user's workspace.\n- Do NOT route to this mode when the user wants to build a specific system or application in Notion.\n\nExamples:\n<example>\nINPUT: Tell me a bedtime story about a robot who learns to dream.\nOUTPUT: 0\n</example>\n<example>\nINPUT: What are some key ideas behind design thinking?\nOUTPUT: 0\n</example>\n<example>\nINPUT: largest mammal\nOUTPUT: 0\n</example>\n<example>\nINPUT: write a haiku about the first snowfall\nOUTPUT: 0\n</example>\n<example>\nINPUT: Who was Joan of Arc?\nOUTPUT: 0\n</example>\n<example>\nINPUT: create a plan for an 80th birthday party\nOUTPUT: 0\n</example>\n".trim(),"\n'Quick search':\n\nRouting Instructions:\n- If this mode is selected, a single search will be conducted and an AI response will be provided that takes the search results into consideration.\n- Route to this mode if you need to find information across the Notion workspace, Slack, Google Drive, Github, or Jira to handle the user's request.\n- Route to this mode when the query seeks a single, specific fact, definition, or data point, or when the user needs current or time-sensitive information.\n- Route to this mode if the user seems to be searching for a specific document in their workspace.\n- Route to this mode if the user needs support: e.g. if they are mentioning getting support, requesting help, asking for customer service, reporting a problem with the product, or requesting a feature - we may be able to find some relevant content in the Notion Help Center\n- Do NOT route to this mode when the request requires synthesizing multiple pieces of information or generating a detailed research report.\n- Do NOT route to this mode when the user wants to build a specific system or application in Notion.\n\nExamples:\n<example>\nINPUT: automated checkout PRD\nOUTPUT: 1\n</example>\n<example>\nINPUT: Who leads the podiatry dept?\nOUTPUT: 1\n</example>\n<example>\nINPUT: overnight parking policy\nOUTPUT: 1\n</example>\n<example>\nINPUT: When are we going to release our documentary about polar bears in the Arctic?\nOUTPUT: 1\n</example>\n<example>\nINPUT: Find my PR that enables dynamic builds.\nOUTPUT: 1\n</example>\n".trim(),"\n'Research Mode':\n\nRouting Instructions:\n- Route to this mode when the query explicitly requests research, analysis, or in-depth exploration.\n- Route to this mode when the query requires conducting multiple searches or synthesizing information from multiple sources or on multiple topics.\n- Do NOT route to this mode when the query can be answered with a single search.\n- Do NOT route to this mode when the user wants to build a specific system or application in Notion.\n\nExamples:\n<example>\nINPUT: Whose work is most UX focused between Amy, Paula, and Xochitl?\nOUTPUT: 2\n</example>\n<example>\nINPUT: Write profiles for 10 of our biggest north African customers.\nOUTPUT: 2\n</example>\n<example>\nINPUT: Can you put together some recommendations for how to move forward with the Lumi deal? Check our recent Slack discussions for context. Write your recommendations in a similar style to how I have written them in the past.\nOUTPUT: 2\n</example>\n<example>\nINPUT: detailed comparison of the healthcare systems of Canada, the UK, Germany, and Singapore in terms of efficiency and accessibility\nOUTPUT: 2\n</example>\n<example>\nINPUT: What are the trends and geopolitical implications of the global semiconductor supply chain?\nOUTPUT: 2\n</example>\n\n".trim(),"\n'App builder':\n\nRouting Instructions:\n- Route to this mode when the query explicitly asks to build an app or system, or when the request involves automating processes within Notion or external tools.\n- Do NOT route to this mode when the user is seeking information rather than building a system or when the request is for creative content or general conversation.\n\nExamples:\n<example>\nINPUT: Create a task management app with deadlines and team assignments.\nOUTPUT: 3\n</example>\n<example>\nINPUT: Develop a CRM that tracks client interactions and schedules follow-ups.\nOUTPUT: 3\n</example>\n<example>\nINPUT: design an invoice system that sends payment reminders\nOUTPUT: 3\n</example>\n<example>\nINPUT: could you build a knowledge base that categorizes notes by topic automatically?\nOUTPUT: 3\n</example>\n<example>\nINPUT: Set up a content calendar for social media posts\nOUTPUT: 3\n</example>\n<example>\nINPUT: Create a recruitment pipeline for interview stages.\nOUTPUT: 3\n</example>\n<example>\nINPUT: I want a dashboard for visualizing Notion database metrics\nOUTPUT: 3\n</example>\n<example>\nINPUT: a way to process and categorize customer feedback automatically\nOUTPUT: 3\n</example>\n".trim(),"\n<example>\nINPUT: Create a database to track my job applications\nOUTPUT: 3\n</example>\n<example>\nINPUT: I need a way to organize my project tasks and deadlines\nOUTPUT: 3\n</example>\n<example>\nINPUT: Help me keep track of my fitness progress over time\nOUTPUT: 3\n</example>\n<example>\nINPUT: I want to build a system for managing my inventory\nOUTPUT: 3\n</example>\n<example>\nINPUT: I need something to organize all my recipes and ingredients\nOUTPUT: 3\n</example>\n<example>\nINPUT: Can you help me set up a customer relationship management system?\nOUTPUT: 3\n</example>\n<example>\nINPUT: [pasted CSV or similar structured data]\nOUTPUT: 3\n</example>\n<example>\nINPUT: I need to organize my collection of books\nOUTPUT: 3\n</example>\n".trim()},412412:(e,t,n)=>{"use strict";n.d(t,{BD:()=>i,PJ:()=>r,_o:()=>s});n(581454);var a=()=>n(736192),o=(a(),()=>n(496603));function s(e,t=!1,n=0,a=!1){let r="";if(t){r+="\n";for(let e=0;e<n;e++)r+="\t"}if("text"===e.type)r+=a?o().ih(e.value):e.value;else{r+=`<${e.tagName}`;for(const[t,n]of Object.entries(e.attributes||{}))r+=` ${t}="${n}"`;if(e.children&&e.children.length>0){r+=">";for(const o of e.children)r+=s(o,t,n+1,a);if(t){r+="\n";for(let e=0;e<n;e++)r+="\t"}r+=`</${e.tagName}>`}else r+="/>"}return r}function r(e){return e.map((e=>s(e))).join("")}function i(e,t=!1,n){const s=(0,a().parse)(e,n);return o().oE(s.childNodes.map((e=>c(e,t))))}function c(e,t=!1){if(e&&"object"==typeof e&&"nodeType"in e){if(e.nodeType===a().NodeType.TEXT_NODE){if(!("textContent"in e)||"string"!=typeof e.textContent)return;return{type:"text",value:t?o().x4(e.textContent):e.textContent}}if(e.nodeType===a().NodeType.ELEMENT_NODE){if(!("tagName"in e)||"string"!=typeof e.tagName)return;const n=e.attributes,a=e.childNodes;return{type:"element",tagName:e.tagName.toLowerCase(),attributes:n||{},children:o().oE(null==a?void 0:a.map((e=>c(e,t))))||[]}}}}},419447:(e,t,n)=>{"use strict";n.d(t,{qR:()=>a});const a="/workflows/oauth/connect"},450528:(e,t,n)=>{"use strict";n.d(t,{H5:()=>o,NV:()=>s,ZP:()=>r,dV:()=>i});n(898992),n(354520),n(737550);var a=()=>n(724639);function o(e,t){return(r(e)??[]).some((e=>e.type===t))}function s(e){return"ai-block"===e.type?e.useWebSearch??!1:(0,a().H0)({config:e,modules:[]})}function r(e){return"ai-block"===e.type?e.searchScopes:(0,a().n_)({config:e,modules:[]})??[]}function i(e,t,n,a){if("workflow"!==e.type&&"ai-block"!==e.type)return e;const o=r(e);if(o.some((e=>e.type===t))===n)return e;let s;return s=n?[...o,a()]:o.filter((e=>e.type!==t)),{...e,searchScopes:s}}},453202:(e,t,n)=>{"use strict";n.d(t,{O:()=>o});class a extends(()=>n(757695))().Store{getInitialState(){return{open:!1}}}const o=new a;(0,n(852832).exposeDebugValue)("AssistantConnectorProgressModalStore",o)},479350:(e,t,n)=>{"use strict";n.d(t,{E:()=>o});class a extends(()=>n(757695))().Store{getInitialState(){return{currentScreen:"none",analyticsFrom:"unknown",sessionId:n(206267).JW(),jiraSiteUrl:"",jiraSyncState:"not_started",jiraSyncProgress:0,syncControl:{excludedProjects:[],includedProjects:[],includeFutureProjects:!0,allProjects:!1},isDisconnecting:!1,isLoaded:!1}}isJiraForgeConnectionDone(){return"not_started"!==this.state.jiraSyncState}}const o=new a;(0,n(852832).exposeDebugValue)("jiraAIConnectionV2Store",o)},491810:(e,t,n)=>{"use strict";n.d(t,{D:()=>d});var a=()=>n(973647),o=()=>n(534177),s=()=>n(251582),r=()=>n(252050),i=()=>n(228803),c=()=>n(331119);function d(e){const t=(0,o().s8)(r().U4,((t,n)=>function(e,t){const n=r().U4[e],{mapCounterToKey:o}=t;return s().p.mapResult((0,c().U5)(e),(t=>{const r=(0,c().ke)({inputAttributes:t.attributes,definitions:{...n.attributes,name:{required:!0,values:!0},description:{required:!1,values:!0}},tagName:e,mapCounterToKey:o});if(a().Q.isFail(r))return r;const d=(0,s().$d)(s().p.manyTill((0,i().Et)({inlineNodesAllowed:n.inline,textAllowed:!1,parentTagName:e,mapCounterToKey:o}),s().p.eof()),t.children??[]);if(a().Q.isFail(d))return d;const l=d.value;return{value:{type:"schema",tagName:e,attributes:r.value,children:l}}}))}(n,e)));return t}},510818:(e,t,n)=>{"use strict";n.d(t,{MJ:()=>y,Mw:()=>h,Pm:()=>g,WF:()=>_,dR:()=>I,e_:()=>m,rf:()=>k,sX:()=>b,tm:()=>f,vb:()=>N});n(16280),n(18107),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(967357),n(898992),n(823215),n(354520),n(672577),n(430670),n(803949),n(581454);var a=()=>n(496603),o=()=>n(973647),s=()=>n(534177),r=()=>n(939768),i=()=>n(412412),c=()=>n(179034),d=()=>n(798880),l=()=>n(201980),u=()=>n(24279),p=()=>n(252050);function m(e){const t=[],n=/<\/?([a-zA-Z0-9_-]+)(?:\s[^>]*)?>/g;let a,o=e.replace(/<[^>]+$/,"").replace(/<[^>]+\/$/,"");for(;a=n.exec(o);){const e=a[1],n=a[0];n.startsWith("</")?t.length>0&&t[t.length-1]===e&&t.pop():n.endsWith("/>")||t.push(e)}for(;t.length;)o+=`</${t.pop()}>`;return o}function g(e,t=!1){return e.replace(/[<>]/g,(e=>{switch(e){case"<":return"&lt;";case">":return"&gt;";case'"':return t?"&quot;":e;case"'":return t?"&apos;":e;case"&":return t?"&amp;":e;default:throw new Error(`Invalid match: "${e}"`)}}))}function h(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">")}a().Bj((()=>[...n(353566).Eo,...Object.keys(p().sA),...Object.keys(p()._S),...Object.keys(p().GU),...Object.keys(p().U4),...Object.keys(p().RD)]));function f(e){return e.replace(/<(code|code-block)(?:\s([^>]*))?>([\s\S]*?)<\/\1>/g,((e,t,n,a)=>`<${t}${n?` ${n}`:""}>${a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}</${t}>`))}function y(e){const t=[],n=[...e];let a;for(;a=n.pop();){if("collection"===a.type)for(const e of Object.values(a.schemas))if("schema-property-relation"===e.tagName){const n=e.attributes["database-id"];t.push(n)}if("child-page"===a.tagName){for(const e of Object.values(a.properties))if("property-relation"===e.tagName){const n=e.attributes["database-id"];(0,s().O9)(n)&&t.push(n)}}else if("child-database"===a.tagName||"database"===a.tagName){for(const e of Object.values(a.schemas))if("schema-property-relation"===e.tagName){const n=e.attributes["database-id"];t.push(n)}}else if(a.children)for(const e of a.children)(0,p().gc)(e)||n.push(e)}return t}function b(e){const t=[],n=[e];let a;for(;a=n.pop();){if("synced-block-reference"===a.tagName){if(!a.attributes["synced-block-id"])throw new Error("Synced block reference missing synced-block-id");t.push(a.attributes["synced-block-id"])}if(a.children)for(const e of a.children)(0,p().gc)(e)||n.push(e)}return t}function v(e,t){if(t(e),"block"===e.type){if(e.text)for(const n of e.text)v(n,t);if(e.children)for(const n of e.children)v(n,t)}else if("inline"===e.type){if(e.children)for(const n of e.children)v(n,t)}else if("property"===e.type&&e.children)for(const n of e.children)v(n,t)}function _(e){const t=e.getTranscript().filter(u().h7),n=e.state.getIdMapper();return t.flatMap((e=>{const t=(0,i().BD)(e.value)[0];return"element"===(null==t?void 0:t.type)&&"search-results"===t.tagName&&t.children?a().oE(t.children.map((e=>{var t;if("element"===e.type&&"page"===e.tagName&&null!==(t=e.attributes)&&void 0!==t&&t.id)return o().Q.unwrap(n.mapCounterToKeyInMode(e.attributes.id,"block_counter"))}))):[]}))}async function k(e){const{value:t,loadRecordModel:n}=e,a=(0,l().RQ)(t);let o="";for(const s of a){const e=s[0],t=(0,l().uPN)(s);e===l().Sj||(0,l().GiG)(s)||(o+=e);for(const a of t){if((0,l().rie)(a)){const e=(0,l().NcG)(a),t=await n({table:d().oo,id:e});o+=null==t?void 0:t.getName()}if((0,l().qsB)(a))o+=(0,l().YhW)(a);else if((0,l().sh$)(a)){const e=(0,l().cQR)(a),t=r().qg(e);o+=` ${t.hostname||""}${t.pathname||""} `}else if((0,l().gir)(a))o+=(0,l().U35)(a);else if((0,l().jIt)(a)){const e=(0,l().v55)(a),t=await n({table:c().ev,id:e});o+=(0,l().k4p)(null==t?void 0:t.getProperties().title)}}}return o}function I(e){const{pageIds:t,evaluator:n,loadInlineDatabases:o}=e,s=Array.from(n.state.getLoadedDatabaseIds()),r=a().sb(t.flatMap((e=>{const t=n.state.getBlockFromBlockIdMap(e);if(t&&"database-views"===t.tagName){const e=t.children.find((e=>"database-view"===e.tagName));if(e&&e.attributes["database-id"])return[e.attributes["database-id"]]}const a=new Set,s=o?3:0;return v(t,(e=>{if(!(a.size>=s)&&"database-view"===e.tagName){const t=e.attributes["database-id"];t&&a.add(t)}})),[...a]})));return a().R9(r,s)}const w="dateRangeFilter";function S(e,t){if(!(0,s().O)(e,t))return!0;const n=e[t];if(!n)return!0;if(Array.isArray(n)&&0===n.length)return!0;if(t===w&&void 0!==e[w]){const t=e[w];return void 0===t.startDate&&void 0===t.endDate}return!1}function N(e,t){const n=new Set([...(0,s().uv)(e),...(0,s().uv)(t)]);return Array.from(n).every((n=>!(!S(e,n)||!S(t,n))||!(!(0,s().O)(e,n)||!(0,s().O)(t,n))&&a().n4(e[n],t[n])))}},525704:(e,t,n)=>{"use strict";n.d(t,{M:()=>r,Y:()=>s});n(581454);var a=()=>n(251582),o=()=>n(331119);function s(e){return a().p.map((0,o().RB)({tagName:"move",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"move",tagName:"move",attributes:e,children:[]})))}function r(e){return a().p.map((0,o().RB)({tagName:"move",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"block_counter"},name:{required:!0,values:!0}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"move",tagName:"move",attributes:e,children:[]})))}},532058:(e,t,n)=>{"use strict";n.d(t,{v:()=>a});n(16280),n(944114);class a extends(()=>n(540192))().o{constructor(...e){super(...e),this.type="asana",this.displayName="Asana",this.requiresUserAuth=!0,this.featureGate="asana_qna",this.category="vector",this.parentOrganization=null,this.fileTypes=["task","project"],this.qnaIngestionAIAppId="4f25cc1a-6b2e-4e94-a67b-8e4d7f2c9abc",this.urlRegex=/https:\/\/app\.asana\.com\/0\/(?<projectId>\d+)\/(?<taskId>\d+)/}getTitle(e){if("asana"!==e.type)throw new Error(`Expected asana resource, got resource.type=${e.type}`);return e.title}getText(e){if("asana"!==e.type)throw new Error(`Expected asana resource, got resource.type=${e.type}`);return`<mentioned-asana type="${e.type}" title="${e.title}" timestamp="${e.timestamp}">\n${e.blocks.join("\n")}\n</mentioned-asana>`}getTranscriptAttributes(e){return"asana"!==e.type?{}:{assignee:e.assignee,team:e.team,workspace:e.workspace,projectId:e.projectId,taskId:e.taskId}}getSearchResultXMLTagName(){return"asana-result"}addSearchResultToXML(e,t){if("asana"!==e.type)throw new Error(`Expected asana result, got result.type=${e.type}`);t.push({type:"element",tagName:this.getSearchResultXMLTagName(),attributes:{id:e.id,title:e.title,"last-edited-datetime":e.lastEdited,"task-id":e.taskId,"project-id":e.projectId},children:[{type:"text",value:e.text}]})}mapObservationResultNode(e){const{node:t,idMapper:a,idToCounter:o}=e;if("asana-result"!==t.tagName)return t;const s=a.mapKeyToCounter({type:"asana",key:(0,n(902006).V9)(t.attributes.id)});return o[t.attributes.id]=s,{...t,attributes:{...t.attributes,id:s}}}}},540192:(e,t,n)=>{"use strict";n.d(t,{o:()=>a});class a{buildCitationInfo(e){const{searchResult:t,searchResultUnmappedId:a,searchResultWithExtraInfo:o,number:s}=e,r=n(832443).tD.parseAssistantHref(a);if(!r)return;const i=t.text,c=t.title;return"webpage"===r.type&&(o.url=r.url),{searchResultWithExtraInfo:o,citationType:"universal_search",target:this.type,href:a,title:c,text:i,number:s,...r}}}},575922:(e,t,n)=>{"use strict";n.d(t,{R:()=>o,W:()=>r});var a=()=>n(206267);function o(){return{currentScreen:"none",status:"not_started",sessionId:a().JW(),analyticsFrom:"unknown",isConnected:!1,isPersonalAuthComplete:!1,isDisconnecting:!1,connectionConflictSpaceId:void 0,externalSourceName:void 0,isLoaded:!1}}class s extends(()=>n(757695))().Store{getInitialState(){return o()}}const r=new s;(0,n(852832).exposeDebugValue)("googleCalendarAIConnectorStore",r)},576590:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addNotionInfoForJiraAIConnection:()=>le,connectSpaceToJiraSite:()=>$e,disconnectConnector:()=>Be,disconnectConnectorPersonalAuth:()=>Fe,disconnectJiraUserConnection:()=>qe,getAiConnectorOnboardingMomentInSettings:()=>Ke,getConnectorStatus:()=>je,getGithubStatus:()=>ne,getJiraAIConnectionStatusAction:()=>fe,getJiraSyncControlAction:()=>ye,getLinearConnectorStatus:()=>Oe,getListAIConnectorsPromise:()=>Re,getMicrosoftTeamsAIConnectorStatusAction:()=>Se,getMicrosoftTeamsSyncControlsAction:()=>Ne,getMicrosoftTeamsTeamsAction:()=>Te,getSharepointConnectorDetails:()=>Me,maybeMarkAiConnectorOnboardingSurveyMomentInSettings:()=>He,maybeTrackSprigAiConnectorOnboardingSurvey:()=>Ve,navigateToAIConnectorOnboarding:()=>Y,navigateToAIConnectorSettingsScreen:()=>G,navigateToDiscordUniversalScreen:()=>Ee,navigateToGoogleDriveUniversalScreen:()=>z,navigateToJiraUniversalScreen:()=>J,navigateToLinearUniversalScreen:()=>Ue,navigateToMicrosoftTeamsUniversalScreen:()=>Q,navigateToSharepointUniversalScreen:()=>De,openAuthNeededModal:()=>Ie,openConnectorInProgressModal:()=>ke,resetAiConnectorStatus:()=>X,resetAllAiConnectors:()=>Z,setAiConnectorOnboardingSurveyMomentInSettings:()=>We,setAssistantOnboardingPhase:()=>H,setLastExposedToQnaAtToCurrentTimestamp:()=>W,setLastUsedAIWriterAtToCurrentTimestamp:()=>V,setMicrosoftTeamsSyncControlsAction:()=>Ce,setQnaOnboardingPhase:()=>K,startJiraBulkIngestionAction:()=>be,startJiraEditFlow:()=>ve,startMicrosoftTeamsBulkIngestionAction:()=>xe,updateAsanaAIConnectorStatus:()=>Je,updateBoxAIConnectorStatus:()=>me,updateDiscordAIConnectorStatus:()=>ze,updateGithubAIConnectorStatus:()=>oe,updateGithubConnectionStatus:()=>ae,updateGmailAIConnectorStatus:()=>se,updateGoogleCalendarAIConnectorStatus:()=>ie,updateGoogleDriveConnectionStatus:()=>re,updateGoogleDriveQnAConnectionState:()=>_e,updateJiraAIConnectionStatus:()=>ge,updateJiraAIV2ConnectionStatus:()=>he,updateLinearAIConnectorStatus:()=>ue,updateMicrosoftTeamsAIConnectorStatusAction:()=>we,updateNotionCalendarAIConnectorStatus:()=>de,updateNotionMailAIConnectorStatus:()=>ce,updateOutlookAIConnectorStatus:()=>Ae,updateSalesforceAIConnectorStatus:()=>pe,updateSharepointAiConnectorStatus:()=>Pe,updateSlackConnectionStatus:()=>ee,updateSlackQnAConnectionState:()=>te});n(16280),n(944114),n(898992),n(672577),n(803949);var a=()=>n(906745),o=()=>n(564884),s=()=>n(836095),r=()=>n(242422),i=()=>n(902006),c=()=>n(206267),d=()=>n(386164),l=()=>n(116225),u=()=>n(559506),p=()=>n(471995),m=()=>n(231297),g=()=>n(755199),h=()=>n(993474),f=()=>n(650829),y=()=>n(604018),b=()=>n(174636),v=()=>n(733848),_=()=>n(972435),k=()=>n(267652),I=()=>n(694926),w=()=>n(646623),S=()=>n(953911),N=()=>n(262246),T=()=>n(291075),C=()=>n(575922),x=()=>n(46657),A=()=>n(963702),P=()=>n(702327),D=()=>n(8870),M=()=>n(291657),U=()=>n(723771),E=()=>n(92383),O=()=>n(765957),F=()=>n(453202),B=()=>n(430483),$=()=>n(756315),q=()=>n(99254),j=()=>n(479350),R=()=>n(634877);const L=(0,n(69708).YK)({linearUserDisconnected:{id:"linearAIConnector.userAuth.disconnected",defaultMessage:"Linear user account disconnected."},discordUserDisconnected:{id:"discordAIConnector.userAuth.disconnected",defaultMessage:"Discord user account disconnected."},salesforceUserDisconnected:{id:"salesforceAIConnector.userAuth.disconnected",defaultMessage:"Salesforce user account disconnected."},asanaUserDisconnected:{id:"asanaAIConnector.userAuth.disconnected",defaultMessage:"Asana user account disconnected."}});function K(e,t){const{phase:n,transactionUserAction:a,userSettingsStore:o}=t;m().createAndCommit({environment:e,userAction:a,canUndo:!0,perform:e=>{g().mJ({userSettingsStore:o,transaction:e,data:{ai_qna_intro_onboarding_phase:n}})}})}function H(e,t){const{phase:n,transactionUserAction:a,userSettingsStore:o}=t;m().createAndCommit({environment:e,userAction:a,canUndo:!0,perform:e=>{g().mJ({userSettingsStore:o,transaction:e,data:{ai_assistant_onboarding_phase:n,ai_assistant_onboarding_phase_last_set_at:Date.now()}})}})}function W(e,t){const{userSettingsStore:n}=t;m().createAndCommit({environment:e,userAction:"aiQnaActions.setLastExposedToQnaAtToCurrentTimestamp",canUndo:!1,perform:e=>{g().mJ({userSettingsStore:n,transaction:e,data:{last_exposed_to_ai_qna_at:Date.now()}})}})}function V(e,t){const{userSettingsStore:n}=t;m().createAndCommit({environment:e,userAction:"aiQnaActions.setLastUsedAIWriterAtToCurrentTimestamp",canUndo:!0,perform:e=>{g().mJ({userSettingsStore:n,transaction:e,data:{last_used_ai_writer_at:Date.now()}})}})}function z(e){const{screenToShow:t,analyticsFrom:n}=e,a=e.sessionId??c().JW();$().d.setState({...$().d.state,analyticsFrom:n,sessionId:a,currentScreen:t})}function J(e){const{analyticsFrom:t,screenToShow:n}=e,a=e.sessionId??c().JW();q().y.setState({...q().y.state,analyticsFrom:t,currentScreen:n,sessionId:a})}function Q(e){const{currentScreen:t,analyticsFrom:n,sessionId:a}=e;A().F.setState({...A().F.state,currentScreen:t,analyticsFrom:n??A().F.state.analyticsFrom,sessionId:a??A().F.state.sessionId})}function G(e){const{connector:t,...n}=e;if("jira"===t&&B().zD.isJiraOldAiConnectorEnabled()&&q().y.isOldJiraConnected())return void q().y.setState({...q().y.state,...n,currentScreen:"settings"});const a=R().NT[t];a.setState({...a.state,...n,currentScreen:"settings"})}function Y(e){const{connector:t,...n}=e;if("google-drive"===t){const e=$().d.state.initialSyncState;if("pending_selection"===e)return void z({...n,screenToShow:"connection_complete_screen"});"not_started"!==e&&"none"!==e||z({...n,screenToShow:"introduction"})}else if("microsoft-teams"===t)["not_started","pending_selection"].includes(A().F.state.connectionStatus)&&Q({...n,currentScreen:"not_started"===A().F.state.connectionStatus?"introduction":"connection_complete_screen"});else{const e=R().NT[t];e.setState({...e.state,...n,currentScreen:"introduction"})}}function X(e){"jira"===e&&B().zD.isJiraOldAiConnectorEnabled()&&q().y.isOldJiraConnected()?q().y.reset():R().NT[e].reset()}function Z(){i().fl.forEach((e=>{X(e)}))}async function ee(e){const{environment:t,spaceId:n}=e,a=await je({environment:t,spaceId:n,connector:"slack"});if("failed"===a)return{status:"failed"};if(a){var o,s,r;const e=a.details.connectionDetails,t=[];null!==(o=a.details.userConnectionDetails)&&void 0!==o&&o.isEnabledForPrivateSync&&t.push("slack"),null!=e&&e.external_source_name&&t.push("slack-admin"),b().R.setState({...b().R.state,canQuery:(null===(s=a.details.userConnectionDetails)||void 0===s?void 0:s.isAvailableForUser)??!0,isPrivateSync:(null===(r=a.details.userConnectionDetails)||void 0===r?void 0:r.isPrivateSync)??!1,ingestionProgress:(null==e?void 0:e.progress)>=100||"completed"===(null==e?void 0:e.status)?void 0:(null==e?void 0:e.progress)??0,isPublicSync:(null==e?void 0:e.isPublicSync)??!1,externalSourceName:(null==e?void 0:e.external_source_name)??"",inProgress:"in_progress"===(null==e?void 0:e.status),isSyncCompleted:"completed"===(null==e?void 0:e.status),isEditing:"editing"===(null==e?void 0:e.status),isDisconnecting:"disconnecting"===(null==e?void 0:e.status),connectedApps:t,isSlackGridAiConnectorEnabled:(null==e?void 0:e.isGridAiConnectorEnabled)??!1,isLoaded:!0,connectionVersion:null==e?void 0:e.connection_version})}else b().R.setState({...b().R.state,isDisconnecting:!1,isSyncCompleted:!1,inProgress:!1,ingestionProgress:void 0,isPublicSync:!1,externalSourceName:"",connectedApps:[],isLoaded:!0});return{status:"success"}}async function te(e){const{environment:t,spaceId:n}=e;return ee({environment:t,spaceId:n})}function ne(e){var t;return null!==(t=e.githubOrg)&&void 0!==t&&t.isSyncComplete?"completed":e.isConnected?"in_progress":"not_started"}async function ae(e){const{environment:t,spaceId:n}=e,a=await je({environment:t,spaceId:n,connector:"github"});if("failed"===a)return{status:"failed"};if(a){const e=a.details.connectionDetails;T().o.setState({...T().o.state,status:ne({githubOrg:{isSyncComplete:"completed"===e.status||"disconnecting"===e.status},isConnected:!0}),isConnected:!1,githubOrg:{id:(null==e?void 0:e.orgId)??0,installationId:Number((null==e?void 0:e.installationId)??0),name:(null==e?void 0:e.external_source_name)??"",isSyncComplete:"completed"===(null==e?void 0:e.status)},isPersonalAuthComplete:"completed"!==(null==e?void 0:e.status)||a.details.userConnectionDetails.isPersonalAuthComplete,isDisconnecting:"disconnecting"===(null==e?void 0:e.status),isLoaded:!0,externalSourceName:null==e?void 0:e.external_source_name})}else T().o.setState({...T().o.state,status:"not_started",isConnected:!1,githubOrg:void 0,isPersonalAuthComplete:!1,isDisconnecting:!1,isLoaded:!0,externalSourceName:void 0});return{status:"success"}}async function oe(e){const{environment:t,spaceId:n}=e;if(r().default.checkGate({gateName:"ai_connector_unification_github"}))return ae({environment:t,spaceId:n});const a=await u().callApi({eventName:"getGithubAIConnectorStatus",environment:t,data:{spaceId:n}});return"success"!==a.type?{status:"failed"}:(T().o.setState({...T().o.state,status:ne(a.data),isConnected:a.data.isConnected,githubOrg:a.data.githubOrg,isPersonalAuthComplete:a.data.isPersonalAuthComplete,isDisconnecting:a.data.isDisconnecting,isLoaded:!0,externalSourceName:a.data.externalSourceName}),{status:"success"})}async function se(e){const{environment:t,spaceId:n}=e;return(0,h().K)("gmail").updateConnectorStatus({environment:t,spaceId:n})}async function re(e){const{environment:t,spaceId:n}=e,a=await je({environment:t,spaceId:n,connector:"google-drive"});if("failed"===a)return{status:"failed"};if(a){const e=a.details.connectionDetails,t=(e=>{switch(e){case"completed":return"completed";case"disconnecting":return"disconnecting";case"in_progress":return"initial_file_sync_in_progress";case"pending_selection":return"pending_selection";default:return"not_started"}})((null==e?void 0:e.status)||"in_progress");return $().d.setState({...$().d.state,initialSyncState:(0,y().HB)(t),isDisconnecting:"disconnecting"===(null==e?void 0:e.status),isEditing:!1,syncProgress:t,ingestionProgress:(null==e?void 0:e.progress)>=100||"completed"===(null==e?void 0:e.status)?void 0:(null==e?void 0:e.progress)??0,isLoaded:!0,externalSourceName:null==e?void 0:e.external_source_name}),{status:"success"}}return $().d.setState({...$().d.state,initialSyncState:"none",isDisconnecting:!1,isEditing:!1,syncProgress:"not_started",ingestionProgress:void 0,isLoaded:!0,externalSourceName:void 0}),{status:"success"}}async function ie(e){const{environment:t,spaceId:n}=e,a=await je({environment:t,spaceId:n,connector:"google-calendar"});if(!a||"failed"===a)return C().W.setState({...C().W.state,status:"not_started",isPersonalAuthComplete:!1,isConnected:!1,isLoaded:!0}),{status:"success"};const o=a.details.connectionDetails;return C().W.setState({...C().W.state,externalSourceName:o.external_source_name,status:"completed"===o.status?"authenticated":"not_started",isConnected:"completed"===o.status,isLoaded:!0,isPersonalAuthComplete:!0}),{status:"success"}}async function ce(e){const{environment:t,spaceId:n}=e,a=await(0,I().$)({environment:t}),o=await u().callApi({eventName:"getIsMailUser",environment:t,data:{}}),s="success"===o.type&&o.data.isMailUser,r=await je({environment:t,spaceId:n,connector:"notion-mail"});if(!r||"failed"===r)return D().L.setState({...D().L.state,status:"not_started",isBackendConnected:s,isConnected:!1,isPersonalAuthComplete:!1,isNotionMailProhibited:a,externalSourceName:void 0,isLoaded:!0}),{status:"success"};const i=r.details.connectionDetails;return D().L.setState({...D().L.state,status:"completed"===i.status?"authenticated":"not_started",isBackendConnected:s,isConnected:"completed"===i.status,isPersonalAuthComplete:"completed"===i.status,isNotionMailProhibited:a,externalSourceName:i.external_source_name,isLoaded:!0}),{status:"success"}}async function de(e){const{environment:t,spaceId:n}=e,a=(0,v().fM)(t);if(!a)return{status:"failed"};const o=(0,k().X)(a)??!1,s=await je({environment:t,spaceId:n,connector:"notion-calendar"});if(!s||"failed"===s)return P().g.setState({...P().g.state,status:"not_started",isBackendConnected:!1,isConnected:!1,isPersonalAuthComplete:!1,isNotionCalendarProhibited:o,externalSourceName:void 0,isLoaded:!0}),{status:"success"};const r=s.details.connectionDetails;return P().g.setState({...P().g.state,status:"completed"===r.status?"authenticated":"not_started",isBackendConnected:!1,isConnected:"completed"===r.status,isPersonalAuthComplete:"completed"===r.status,isNotionCalendarProhibited:o,externalSourceName:r.external_source_name,isLoaded:!0}),{status:"success"}}async function le(e){const{environment:t,spaceId:n}=e;return"success"!==(await u().callApi({eventName:"addNotionInfoForJiraAIConnection",environment:t,data:{spaceId:n}})).type?{status:"failed"}:{status:"success"}}async function ue(e){const{environment:t,spaceId:n}=e,a=await je({environment:t,spaceId:n,connector:"linear"});if(!a||"failed"===a)return x().W.setState({...x().W.state,isConnected:!1,isLoaded:!0}),{status:"success"};const o=null==a?void 0:a.details.connectionDetails,s=null==a?void 0:a.details.userConnectionDetails;return x().W.setState({...x().W.state,isConnected:"completed"===(null==o?void 0:o.status)||"disconnecting"===(null==o?void 0:o.status),isLoaded:!0,ingestionProgress:null==o?void 0:o.progress,status:null==o?void 0:o.status,userAuthStatus:(null==s?void 0:s.userAuthStatus)??"not_required",externalUsername:null==s?void 0:s.externalUsername,externalSourceName:o.external_source_name}),{status:"success"}}async function pe(e){const{environment:t,spaceId:n}=e,a=await je({environment:t,spaceId:n,connector:"salesforce"});if(!a||"failed"===a)return U().C.setState({...U().C.state,isConnected:!1,isLoaded:!0}),{status:"success"};const o=null==a?void 0:a.details.connectionDetails,s=null==a?void 0:a.details.userConnectionDetails;return U().C.setState({...U().C.state,isConnected:"completed"===(null==o?void 0:o.status)||"disconnecting"===(null==o?void 0:o.status),isLoaded:!0,ingestionProgress:(null==o?void 0:o.progress)??0,status:null==o?void 0:o.status,externalSourceName:null==o?void 0:o.external_source_name,userAuthStatus:(null==s?void 0:s.userAuthStatus)??"not_required"}),{status:"success"}}async function me(e){const{environment:t,spaceId:n}=e,a=await je({environment:t,spaceId:n,connector:"box"});if(!a||"failed"===a)return S().M.setState({...S().M.state,isConnected:!1,isLoaded:!0}),{status:"success"};const o=null==a?void 0:a.details.connectionDetails;return S().M.setState({...S().M.state,isConnected:"completed"===(null==o?void 0:o.status)||"disconnecting"===(null==o?void 0:o.status),isLoaded:!0,ingestionProgress:(null==o?void 0:o.progress)??0,status:null==o?void 0:o.status,externalSourceName:null==o?void 0:o.external_source_name}),{status:"success"}}async function ge(e){return fe(e).then((e=>e?{status:"success"}:{status:"failed"}))}async function he(e){const{environment:t,spaceId:n}=e;if(B().zD.isJiraOldAiConnectorEnabled()&&await ge(e),!B().zD.isJiraForgeEnabled())return{status:"success"};const a=await je({environment:t,spaceId:n,connector:"jira"});if("failed"===a)return{status:"failed"};if(!a)return j().E.setState({...j().E.state,jiraSyncState:"not_started",isLoaded:!0}),{status:"success"};const o=null==a?void 0:a.details.connectionDetails;return j().E.setState({...j().E.state,jiraSyncState:null==o?void 0:o.status,jiraSyncProgress:null==o?void 0:o.progress,isLoaded:!0,jiraSiteUrl:(null==o?void 0:o.external_source_name)||"",isDisconnecting:"disconnecting"===(null==o?void 0:o.status)}),{status:"success"}}async function fe(e){const{environment:t,spaceId:n}=e,a=await u().callApi({eventName:"getJiraAIConnectionStatus",environment:t,data:{spaceId:n},headers:(0,d().WS)({spaceId:n})});if("success"===a.type)return q().y.setState({...q().y.state,jiraSiteId:a.data.jiraSiteId??"",jiraSyncState:a.data.connectionState.status,jiraSyncProgress:a.data.connectionState.percentageComplete,jiraSiteUrl:a.data.jiraSiteUrl??"",isDisconnecting:"disconnecting"===a.data.connectionState.status,isLoaded:!0,missingUserAuth:"missing"===a.data.userAuth,userConnected:"connected"===a.data.userAuth}),a.data}async function ye(e){const{environment:t,spaceId:n,jiraSiteId:a}=e,o=await u().callApi({eventName:"getSyncControlsForJiraConnector",environment:t,data:{spaceId:n,jiraSiteId:a}});if("success"===o.type)return q().y.setState({...q().y.state,syncControl:o.data.syncControl}),o}async function be(e){const{environment:t,spaceId:n,jiraSiteId:a,sessionId:o,exclusionList:s,inclusionList:r}=e,i=await u().callApi({eventName:"startJiraBulkIngestion",environment:t,data:{spaceId:n,jiraSiteId:a,sessionId:o,exclusionList:s,inclusionList:r}});if("success"===i.type)return p().D6({label:_().A.getIntl().formatMessage({defaultMessage:"Jira sync started. This can take up to 36 hours.",id:"jira.sync.started"}),position:"bottom"}),q().y.setState({...q().y.state,jiraSyncState:"in_progress",jiraSyncProgress:1}),i;p().D6({label:_().A.getIntl().formatMessage({defaultMessage:"Something went wrong. Please try again.",id:"jira.sync.failed"}),position:"bottom"})}async function ve(e){const{environment:t,spaceId:n,jiraSiteId:a,exclusionList:o,inclusionList:s}=e,r=await u().callApi({eventName:"startJiraEditBulkIngestion",environment:t,data:{spaceId:n,jiraSiteId:a,inclusionList:s,exclusionList:o}});if("success"===r.type)return r.data.patchSuccess?(q().y.setState({...q().y.state,jiraSyncState:"editing",jiraSyncProgress:100}),p().D6({label:_().A.getIntl().formatMessage({defaultMessage:"Project sync list updated, sync started in background.",id:"jira.edit.success"}),position:"bottom"})):p().D6({label:_().A.getIntl().formatMessage({defaultMessage:"No changes were detected.",id:"jira.edit.noChanges"}),position:"bottom"}),r;p().D6({label:_().A.getIntl().formatMessage({defaultMessage:"Something went wrong. Please try again.",id:"jira.edit.failed"}),position:"bottom"})}async function _e(e){var t;const{environment:n,spaceId:a,showSnackbarOnError:o}=e;if(r().default.checkGate({gateName:"ai_connector_unification_google_drive"}))return re({environment:n,spaceId:a});const s=await u().callApi({eventName:"getGoogleDriveSyncProgress",environment:n,data:{spaceId:a},headers:(0,d().WS)({spaceId:a})});return"success"!==s.type?o?s.status>=400&&s.status<500?((0,R().Rl)(),{status:"failed"}):((0,R().NK)(),{status:"failed"}):{status:"failed"}:($().d.setState({...$().d.state,initialSyncState:(0,y().HB)(s.data.status),isDisconnecting:"disconnecting"===s.data.status,isEditing:"editing"===s.data.status,syncProgress:s.data.status,syncCurrent:s.data.current,syncTotal:s.data.total,ingestionProgress:s.data.ingestionProgress,isLoaded:!0,externalSourceName:null===(t=s.data.connectionDetails)||void 0===t?void 0:t.domainName}),{status:"success"})}function ke(e){const{environment:t,connector:n,from:a}=e;F().O.setState({...F().O.state,open:!0,modal:"progress",connector:n}),f().assistantDependency.load().then((({assistantAnalyticsActions:e})=>{e.trackConnectorInProgressModalOpened({environment:t,connector:n,from:a})}))}function Ie(e){const{environment:t,connector:n,from:a}=e;F().O.setState({...F().O.state,open:!0,modal:"auth_needed",connector:n}),f().assistantDependency.load().then((({assistantAnalyticsActions:e})=>{e.trackConnectorAuthNeededModalOpened({environment:t,connector:n,from:a})}))}async function we(e){return Se(e).then((e=>e?{status:"success"}:{status:"failed"}))}async function Se(e){const{environment:t,spaceId:n,sessionId:a=A().F.state.sessionId}=e,o=await je({environment:t,spaceId:n,connector:"microsoft-teams"});if(!o||"failed"===o)return A().F.setState({...A().F.state,connectionStatus:"not_started",syncProgressPercentage:0,isLoaded:!0,isDisconnecting:!1,error:void 0,externalSourceName:void 0}),A().F.getState();const s=o.details.connectionDetails;return A().F.setState({...A().F.state,connectionStatus:(null==s?void 0:s.status)??"not_started",syncProgressPercentage:(null==s?void 0:s.progress)??0,isLoaded:!0,isDisconnecting:"disconnecting"===(null==s?void 0:s.status),error:void 0,externalSourceName:null==s?void 0:s.external_source_name}),A().F.getState()}async function Ne(e){const{environment:t,spaceId:n}=e,a=await u().callApi({eventName:"getMicrosoftTeamsSyncControls",environment:t,data:{spaceId:n},headers:(0,d().WS)({spaceId:n})});if("success"===a.type)return a.data}async function Te(e){const{environment:t,spaceId:n,cursor:a}=e,o=await u().callApi({eventName:"getMicrosoftTeamsTeams",environment:t,data:{spaceId:n,cursor:a}});if("success"===o.type)return o.data}async function Ce(e){const{environment:t,spaceId:n,syncControls:a}=e,o=await u().callApi({eventName:"setMicrosoftTeamsSyncControls",environment:t,data:{spaceId:n,syncControls:a},headers:(0,d().WS)({spaceId:n})});if("success"===o.type)return await Se({environment:t,spaceId:n}),o.data}async function xe(e){const{environment:t,spaceId:n,sessionId:a}=e,o=await u().callApi({eventName:"startMicrosoftTeamsBulkIngestion",environment:t,data:{spaceId:n,sessionId:a}});if("success"===o.type)return p().D6({label:_().A.getIntl().formatMessage({defaultMessage:"Microsoft Teams sync started. This can take up to 36 hours.",id:"microsoftTeams.sync.started"}),position:"bottom"}),await Se({environment:t,spaceId:n}),o;p().D6({label:_().A.getIntl().formatMessage({defaultMessage:"Something went wrong. Please try again.",id:"microsoftTeams.sync.failed"}),position:"bottom"})}async function Ae(e){const{environment:t,spaceId:n}=e,a=await je({environment:t,spaceId:n,connector:"outlook"});if(!a||"failed"===a)return M().y.setState({...M().y.state,status:"not_started",isPersonalAuthComplete:!1,isConnected:!1,isLoaded:!0}),{status:"success"};const o=a.details.connectionDetails;return M().y.setState({...M().y.state,status:"completed"===o.status?"authenticated":"not_started",isConnected:"completed"===o.status,isLoaded:!0,isPersonalAuthComplete:!0}),{status:"success"}}async function Pe(e){const{environment:t,spaceId:n}=e,a=await je({environment:t,spaceId:n,connector:"sharepoint"});if(!a||"failed"===a)return E().E.setState({...E().E.state,isConnected:!1,isLoaded:!0,connectionDetails:void 0}),{status:"success"};const o=null==a?void 0:a.details.connectionDetails;return E().E.setState({...E().E.state,isConnected:void 0!==a,isLoaded:!0,connectionDetails:{status:null==o?void 0:o.status,progress:null==o?void 0:o.progress,externalSourceName:null==o?void 0:o.external_source_name}}),{status:"success"}}function De(e){const{currentScreen:t}=e;E().E.setState({...E().E.state,currentScreen:t})}async function Me(e){const{environment:t,spaceId:n}=e,a=await je({environment:t,spaceId:n,connector:"sharepoint"});if(!a||"failed"===a)return{status:"not_started",externalSourceName:void 0};const o=a.details.connectionDetails;return{status:o.status,externalSourceName:o.external_source_name}}function Ue(e){const{currentScreen:t}=e;x().W.setState({...x().W.state,currentScreen:t})}function Ee(e){N().l.setState({...N().l.state,currentScreen:e})}async function Oe(e){const{environment:t,spaceId:n}=e,a=await je({environment:t,spaceId:n,connector:"linear"});if(!a||"failed"===a)return"not_started";return a.details.connectionDetails.status}async function Fe(e){const{environment:t,sidebarSpaceViewStore:n,connector:a}=e,r=null==n?void 0:n.getSpaceId();if(r){if("slack"===a)throw new Error("Slack connector personal auth disconnect not implemented");if("github"===a){(0,o().u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"user_auth_disconnect",integration_type:"github",setup_session_id:T().o.state.sessionId,from:T().o.state.analyticsFrom}}});const e=await u().callApi({eventName:"disconnectGithub",environment:t,data:{spaceId:r,disconnectUserAuth:!0}});m().createAndCommit({userAction:"githubAIConnector.onboarding.dismissPersonalAuthPrompt",environment:t,canUndo:!0,perform:e=>{n&&m().applyOperation({store:n,operation:{pointer:n.pointer,path:["settings"],command:"update",args:{...n.getSettings(),dismissed_github_personal_auth_prompt:!0}},transaction:e})}}),T().o.setState({...T().o.state,isPersonalAuthComplete:!1}),"success"===e.type&&e.data.redirectUrl&&(t.device.isElectron?(0,s().P)(e.data.redirectUrl):window.open(e.data.redirectUrl,"_blank"))}else if("linear"===a){const e=x().W;(0,o().u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"user_auth_disconnect",integration_type:a,setup_session_id:e.state.sessionId,from:e.state.analyticsFrom}}}),await u().callApi({eventName:"disconnectAiConnector",environment:t,data:{spaceId:r,connector:a,disconnectionType:"user"}}),e.setState({...e.state,userAuthStatus:"pending",externalUsername:void 0}),p().D6({label:_().A.getIntl().formatMessage(L[`${a}UserDisconnected`]),position:"bottom"})}else if("discord"===a){const e=N().l;(0,o().u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"user_auth_disconnect",integration_type:a,setup_session_id:e.state.sessionId,from:e.state.analyticsFrom}}}),await u().callApi({eventName:"disconnectAiConnector",environment:t,data:{spaceId:r,connector:a,disconnectionType:"user"}}),e.setState({...e.state,isConnected:!1,connectionStatus:"not_started",syncProgressPercentage:0}),p().D6({label:_().A.getIntl().formatMessage(L[`${a}UserDisconnected`]),position:"bottom"})}else{if("salesforce"!==a){return(0,h().K)(a).disconnectConnectorPersonalAuth({environment:t,spaceId:r})}{const e=R().NT[a];(0,o().u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"user_auth_disconnect",integration_type:a,setup_session_id:e.state.sessionId,from:e.state.analyticsFrom}}});if("success"!==(await u().callApi({eventName:"disconnectAiConnector",environment:t,data:{spaceId:r,connector:a,disconnectionType:"user"}})).type)return;e.setState({...e.state,userAuthStatus:"pending"}),p().D6({label:_().A.getIntl().formatMessage(L[`${a}UserDisconnected`]),position:"bottom"})}}}}async function Be(e){const{connector:t,spaceId:n,environment:a,disconnectReason:o}=e;let s;if("google-drive"===t)s=await u().callApi({eventName:"disconnectGoogleDriveAIIngestion",environment:a,data:{spaceId:n,disconnectReason:o}});else if("github"===t)s=await u().callApi({eventName:"disconnectGithub",environment:a,data:{spaceId:n}});else if("google-calendar"===t)s=await u().callApi({eventName:"disconnectAiConnector",environment:a,data:{spaceId:n,connector:"google-calendar"}}),s={type:"success"};else if("jira"===t)s=B().zD.isJiraOldAiConnectorEnabled()?await u().callApi({eventName:"disconnectJiraConnector",environment:a,data:{spaceId:n,jiraSiteId:q().y.state.jiraSiteId}}):{type:"success"};else if("sharepoint"===t)s=await u().callApi({eventName:"disconnectAiConnector",environment:a,data:{spaceId:n,connector:"sharepoint"}});else if("microsoft-teams"===t)s=await u().callApi({eventName:"disconnectAiConnector",environment:a,data:{spaceId:n,connector:"microsoft-teams"}});else if("salesforce"===t)s=await u().callApi({eventName:"disconnectAiConnector",environment:a,data:{spaceId:n,connector:"salesforce"}});else if("slack"===t)s=await u().callApi({eventName:"disconnectSlackIngestion",environment:a,data:{spaceId:n,disconnectForWorkspace:!1}});else if("linear"===t)s=await u().callApi({eventName:"disconnectAiConnector",environment:a,data:{spaceId:n,connector:"linear"}});else if("outlook"===t)s=await u().callApi({eventName:"disconnectAiConnector",environment:a,data:{spaceId:n,connector:"outlook"}});else if("notion-mail"===t)s=await u().callApi({eventName:"disconnectAiConnector",environment:a,data:{spaceId:n,connector:"notion-mail"}});else if("notion-calendar"===t)s=await u().callApi({eventName:"disconnectAiConnector",environment:a,data:{spaceId:n,connector:"notion-calendar"}});else if("salesforce"===t)s=await u().callApi({eventName:"disconnectAiConnector",environment:a,data:{spaceId:n,connector:"salesforce"}});else if("discord"===t)s=await u().callApi({eventName:"disconnectAiConnector",environment:a,data:{spaceId:n,connector:"discord"}}),s={type:"success"};else{if("box"!==t){return(0,h().K)(t).disconnectConnector({environment:a,spaceId:n})}s=await u().callApi({eventName:"disconnectAiConnector",environment:a,data:{spaceId:n,connector:"box"}})}const r=R().NT[t];return r.setState({...r.state,isDisconnecting:!0}),s}async function $e(e){const{environment:t,spaceId:n}=e,{sidebarSpaceViewStore:a}=O().default.getState();if(void 0===a)return!1;const o=await u().callApi({eventName:"connectJiraSiteToSpace",environment:t,data:{spaceId:n,siteId:q().y.state.jiraSiteId}});return!("success"!==o.type||!o.data.connectionSuccess)&&(q().y.setState({...q().y.state,currentScreen:"connection_complete_screen",jiraSiteId:o.data.siteData.siteId,jiraSiteUrl:o.data.siteData.siteUrl,jiraSyncState:"pending_selection"}),m().createAndCommit({userAction:"jiraAIConnector.onboarding.dismissPersonalAuthPrompt",environment:t,canUndo:!0,perform:e=>{m().applyOperation({store:a,operation:{pointer:a.pointer,path:["settings"],command:"update",args:{...a.getSettings(),dismissed_jira_installation_pending_prompt:null}},transaction:e})}}),!0)}async function qe(e){const{environment:t,spaceId:n}=e,a=await u().callApi({eventName:"disconnectJiraUserConnection",environment:t,data:{spaceId:n}});return"success"===a.type&&!0===a.data.disconnected&&(q().y.setState({...q().y.state,userConnected:!1,missingUserAuth:!0}),!0)}async function je(e){const{environment:t,spaceId:n,connector:a}=e,o=await Re({environment:t,spaceId:n});if("success"!==o.type)return"failed";if("connectedConnectors"in o.data){return o.data.connectedConnectors.find((e=>e.id===a))}}async function Re(e){const{environment:t,spaceId:n}=e;if(w().q.state.listAIConnectorsPromise&&w().q.state.spaceId===n)return w().q.state.listAIConnectorsPromise;const a=u().callApi({eventName:"listAIConnectors",environment:t,data:{spaceId:n}}).then((e=>(setTimeout((()=>{w().q.setState({listAIConnectorsPromise:void 0,spaceId:n})}),100),e))).catch((e=>e));return w().q.setState({listAIConnectorsPromise:a,spaceId:n}),a}const Le={started:"ai_connector_onboarding_started_at",finished:"ai_connector_onboarding_completed_at",survey_triggered:"ai_connector_onboarding_survey_triggered_at"};function Ke(e){var t;const{connector:n,moment:a}=e,{sidebarSpaceViewStore:o}=O().default.getState();if(!o)return;const s=Le[a];return null===(t=o.getSettings())||void 0===t||null===(t=t[s])||void 0===t?void 0:t[n]}function He(e){const{environment:t,connector:n,moment:a}=e,{sidebarSpaceViewStore:o}=O().default.getState();o&&void 0===Ke({connector:n,moment:a})&&We({environment:t,currentSpaceViewStore:o,connector:n,moment:a,timestamp:Date.now()})}function We(e){const{environment:t,currentSpaceViewStore:n,connector:a,moment:o,timestamp:s}=e,r=Le[o];m().createAndCommit({environment:t,userAction:`aiConnector.onboarding.${o}`,canUndo:!0,perform:e=>{var t;m().applyOperation({store:n,operation:{pointer:n.pointer,path:["settings"],command:"update",args:{...n.getSettings(),[r]:{...null===(t=n.getSettings())||void 0===t?void 0:t[r],[a]:s}}},transaction:e})}})}function Ve(e){const{environment:t,connector:n,connectedApps:o}=e,s=Ke({connector:n,moment:"started"}),r=Ke({connector:n,moment:"finished"});if(!s||r)return;if(s>a().c9.now().minus({days:5}).toMillis())return;if(o.includes(n))return;Ke({connector:n,moment:"survey_triggered"})||(l().u4({name:`${n}_ai_connector_dropoff_survey`}),He({environment:t,connector:n,moment:"survey_triggered"}))}async function ze(e){const{environment:t,spaceId:n}=e,a=await je({environment:t,spaceId:n,connector:"discord"});if(!a||"failed"===a)return N().l.setState({...N().l.state,isConnected:!1,isLoaded:!0}),{status:"success"};const o=null==a?void 0:a.details.connectionDetails;return N().l.setState({...N().l.state,isConnected:"completed"===(null==o?void 0:o.status)||"disconnecting"===(null==o?void 0:o.status),isLoaded:!0,syncProgressPercentage:(null==o?void 0:o.progress)??0,connectionStatus:(null==o?void 0:o.status)??"not_started",externalSourceName:null==o?void 0:o.external_source_name}),{status:"success"}}async function Je(e){const{environment:t,spaceId:n}=e;return(0,h().K)("asana").updateConnectorStatus({environment:t,spaceId:n})}},604018:(e,t,n)=>{"use strict";n.d(t,{A7:()=>F,HB:()=>A,Nr:()=>D,XY:()=>P,bp:()=>B,kB:()=>M,uM:()=>O,wd:()=>E,yc:()=>U});n(898992),n(354520);var a=()=>n(484714),o=()=>n(56366),s=()=>n(902006),r=()=>n(534177),i=()=>n(634877),c=()=>n(229533),d=()=>n(624820),l=()=>n(953911),u=()=>n(262246),p=()=>n(291075),m=()=>n(771624),g=()=>n(575922),h=()=>n(46657),f=()=>n(963702),y=()=>n(702327),b=()=>n(8870),v=()=>n(291657),_=()=>n(723771),k=()=>n(92383),I=()=>n(765957),w=()=>n(430483),S=()=>n(756315),N=()=>n(99254),T=()=>n(479350),C=()=>n(329304),x=()=>n(174636);function A(e){return"completed"===e?"completed":"not_started"===e?"not_started":"pending_selection"===e?"pending_selection":"in_progress"}function P(e){if("google-drive"===e)return"pending_selection"===S().d.state.initialSyncState?"in_progress":S().d.state.initialSyncState;if("jira"===e){const e=T().E.state.jiraSyncState;return"not_started"===e||"pending_connection"===e?"not_started":"in_progress"===e||"pending_selection"===e?"in_progress":"completed"}if("github"===e)return"authenticated"===p().o.state.status?"in_progress":p().o.state.status;if("gmail"===e)return"authenticated"===m().XS.state.status?"completed":"not_started";if("google-calendar"===e)return"authenticated"===g().W.state.status?"completed":"not_started";if("notion-mail"===e)return"authenticated"===b().L.state.status?"completed":b().L.state.isBackendConnected?"in_progress":"not_started";if("notion-calendar"===e)return"authenticated"===y().g.state.status?"completed":y().g.state.isBackendConnected?"in_progress":"not_started";if("outlook"===e)return"authenticated"===v().y.state.status?"completed":"not_started";if("microsoft-teams"===e)switch(f().F.state.connectionStatus){case"completed":return"completed";case"in_progress":return"in_progress";default:return"not_started"}if("slack"===e)return x().R.state.noChannelsSelected?"not_started":x().R.state.isSyncCompleted?"completed":"in_progress";var t,n;if("sharepoint"===e)switch(null===(t=k().E.state.connectionDetails)||void 0===t?void 0:t.status){case"completed":return"completed";case"in_progress":return"in_progress";default:return"not_started"}if("linear"===e)switch(h().W.state.status){case"completed":return"completed";case"in_progress":return"in_progress";default:return"not_started"}if("salesforce"===e)switch(null===(n=_().C.state.connectionDetails)||void 0===n?void 0:n.status){case"completed":return"completed";case"in_progress":return"in_progress";default:return"not_started"}if("box"===e){switch(l().M.state.status){case"completed":return"completed";case"in_progress":return"in_progress";default:return"not_started"}}if("discord"===e){const e=u().l.state.connectionStatus;return"not_started"===e?"not_started":"in_progress"===e||"pending_selection"===e?"in_progress":"completed"}if("asana"===e){const e=d().P0.state.connectionStatus;return"not_started"===e?"not_started":"in_progress"===e?"in_progress":"completed"}return(0,r().HB)(e)}function D(){return M().filter((e=>{if("slack"===e){return!(x().R.state.connectedApps||[]).includes("slack-admin")}return"google-drive"===e?"none"===S().d.state.initialSyncState||"not_started"===S().d.state.initialSyncState:"github"===e?"not_started"===p().o.state.status:"jira"===e?"not_started"===T().E.state.jiraSyncState:"sharepoint"===e?!k().E.state.connectionDetails:"gmail"===e?"not_started"===m().XS.state.status:"google-calendar"===e?"not_started"===g().W.state.status:"notion-mail"===e?"not_started"===b().L.state.status:"notion-calendar"===e?"not_started"===y().g.state.status:"outlook"===e?"not_started"===v().y.state.status:"microsoft-teams"===e?"not_started"===f().F.state.connectionStatus:"linear"===e?"not_started"===h().W.state.status:"salesforce"===e?"not_started"===(null===(t=_().C.state.connectionDetails)||void 0===t?void 0:t.status):"discord"===e?"not_started"===u().l.state.connectionStatus:"box"===e?"not_started"===l().M.state.status:"asana"===e?"not_started"===d().P0.state.connectionStatus:(0,r().HB)(e);var t}))}function M(){return U.filter((e=>w().zD.canUseAiConnectorSearchScope(e)))}const U=[...s().i9,...n(496603).Ul(s().fl.filter((e=>!(0,s().r9)(e))),(e=>n(987267).w0[e]))];function E({includeConnectorsWithAuthNeeded:e=!1}={}){return U.filter((t=>"slack"===t?w().zD.isConnectedToSlackUniversalQnA(x().R.state)||e&&(0,c().al)(x().R.state):"google-drive"===t?w().zD.isConnectedToGoogleDriveUniversalQnA(x().R.state):"github"===t?w().zD.isConnectedToGithubUniversalQnA(p().o.state)||e&&(0,c().F1)(p().o.state):"jira"===t?w().zD.isConnectedToJiraUniversalQnA(N().y.state,T().E.state):"gmail"===t?w().zD.isConnectedToGmailUniversalQnA(m().XS.state):"google-calendar"===t?w().zD.isConnectedToGoogleCalendarUniversalQnA(g().W.state):"notion-mail"===t?w().zD.isConnectedToNotionMailUniversalQnA(b().L.state):"notion-calendar"===t?w().zD.isConnectedToNotionCalendarUniversalQnA(y().g.state):"outlook"===t?w().zD.isConnectedToOutlookUniversalQnA(v().y.state):"sharepoint"===t?w().zD.isConnectedIsSharepointAiConnector(k().E.state):"microsoft-teams"===t?w().zD.isConnectedToMicrosoftTeamsUniversalQnA(f().F.state):"linear"===t?w().zD.isConnectedToLinearUniversalQnA(h().W.state):"salesforce"===t?w().zD.isConnectedIsSalesforceAiConnector(_().C.state):"discord"===t?w().zD.isConnectedToDiscordAiConnector(u().l.state):"box"===t?w().zD.isConnectedToBoxAiConnector(l().M.state):"asana"===t?w().zD.isConnectedToAsanaAiConnector(d().P0.state):(0,r().HB)(t)))}function O(){return E().filter((e=>(0,c().LT)(e).isInProgress))}function F(e){return"jira"===e&&w().zD.isJiraOldAiConnectorEnabled()&&N().y.isOldJiraConnected()?N().y.state.isLoaded:i().NT[e].state.isLoaded}function B(){const e=(0,a().v3)(),t=(0,o().O$)(I().AppStoreSidebarSpaceStore),n=(0,C().P9)({name:"ai_connectors",spaceId:null==t?void 0:t.id,userId:e.currentUser.id})??!1;return(0,o().K8)((()=>{var e;return!(!t||!n)&&!Boolean(null===(e=t.getSettings())||void 0===e?void 0:e.embedding_index_is_live)}),[t,n])}},624820:(e,t,n)=>{"use strict";n.d(t,{P0:()=>o});class a extends(()=>n(757695))().Store{getInitialState(){return{connectionStatus:"not_started",syncProgressPercentage:0,isLoaded:!1,isDisconnecting:!1,isEditing:!1,error:void 0,externalSourceName:void 0,currentScreen:"none",sessionId:n(206267).JW(),analyticsFrom:"unknown",isConnected:!1,forceShowAuthNotificationTriggeredAt:void 0}}}const o=new a},634877:(e,t,n)=>{"use strict";n.d(t,{NK:()=>T,NT:()=>k,Rl:()=>N,getAiConnectorRefreshFunction:()=>_,hP:()=>I,nB:()=>S,ts:()=>w});n(898992),n(354520),n(581454);var a=n(296540),o=()=>n(242422),s=()=>n(484714),r=()=>n(56366),i=()=>n(718827),c=()=>n(187174),d=()=>n(69708),l=()=>n(763824),u=()=>n(534177),p=()=>n(559506),m=()=>n(295118),g=()=>n(471995),h=()=>n(604018),f=()=>n(152197),y=()=>n(576590),b=n(474848);const v={slack:y().updateSlackQnAConnectionState,"google-drive":y().updateGoogleDriveQnAConnectionState,jira:y().updateJiraAIV2ConnectionStatus,github:y().updateGithubAIConnectorStatus,sharepoint:y().updateSharepointAiConnectorStatus,"microsoft-teams":y().updateMicrosoftTeamsAIConnectorStatusAction,gmail:y().updateGmailAIConnectorStatus,linear:y().updateLinearAIConnectorStatus,outlook:y().updateOutlookAIConnectorStatus,"notion-mail":y().updateNotionMailAIConnectorStatus,"google-calendar":y().updateGoogleCalendarAIConnectorStatus,"notion-calendar":y().updateNotionCalendarAIConnectorStatus,salesforce:y().updateSalesforceAIConnectorStatus,discord:y().updateDiscordAIConnectorStatus,asana:y().updateAsanaAIConnectorStatus,box:y().updateBoxAIConnectorStatus};function _(e){return async t=>m().ZC.state?{status:"success"}:v[e](t)}const k={slack:n(174636).R,"google-drive":n(756315).d,jira:n(479350).E,github:n(291075).o,sharepoint:n(92383).E,"microsoft-teams":n(963702).F,gmail:n(771624).XS,linear:n(46657).W,outlook:n(291657).y,"notion-mail":n(8870).L,"google-calendar":n(575922).W,"notion-calendar":n(702327).g,salesforce:n(723771).C,discord:n(262246).l,asana:n(624820).P0,box:n(953911).M};function I(e){return(0,r().K8)((()=>o().default.getConfigKey("ingestion",e)),[e])}function w(e,t){const n=(0,s().v3)(),o=(0,f().r)(),i=(0,r().K8)(h().kB,[]),d=(0,a.useRef)(!1),p=(0,r().K8)((()=>i.filter((e=>!(0,h().A7)(e)||t)).filter((t=>!(0,u().O9)(e)||e.includes(t)))),[i,e,t]);(0,c().Yb)((async()=>{if(!o||d.current||0===p.length)return;const e=p.map((e=>_(e)));d.current=!0,await(0,l().lX)(e,10,(e=>e({environment:n,spaceId:o}))),d.current=!1}),[n,o,p]);return{isLoading:(0,r().K8)((()=>{if(m().ZC.state)return!1;return p.filter((e=>!(0,h().A7)(e))).length>0}),[p])}}function S(e){const{connector:t,authorizationType:n,existingAuthorizationUrl:o,openAuthUrl:r}=e,i=(0,s().v3)(),d=(0,f().r)(),[l,u]=(0,a.useState)(o);return(0,c().Yb)((async()=>{if(!d||l||r)return;const e=await p().callApi({eventName:"getAIConnectorAuthorizationUrl",environment:i,data:{connector:t,authorizationType:n,spaceId:d,sessionId:k[t].state.sessionId,client:i.device.isElectron?"desktop":"web"}});if("success"!==e.type)return;const a=e.data.authorizationUrl;u(a)}),[i,d,t,n,l,r]),l}function N(){g().D6({label:(0,b.jsx)(d().sA,{id:"universalSearch.googleDriveIngestion.googleDriveButton.accessDeniedSnackbar",defaultMessage:"You do not have access to Google Drive Universal QnA."}),position:"bottom",style:{width:"600px",display:"flex",justifyContent:"space-between"},right:(0,b.jsx)(i().Ay,{onClick:g().N2,children:(0,b.jsx)(d().sA,{id:"universalSearch.googleDriveIngestion.googleDriveButton.closeErrorSnackbar",defaultMessage:"Close"})})})}function T(){g().D6({label:(0,b.jsx)(d().sA,{id:"universalSearch.googleDriveIngestion.googleDriveButton.showTryAgainSnackbar",defaultMessage:"There was problem processing your request. Please try again."}),position:"bottom",style:{width:"600px",display:"flex",justifyContent:"space-between"},right:(0,b.jsx)(i().Ay,{onClick:g().N2,children:(0,b.jsx)(d().sA,{id:"universalSearch.googleDriveIngestion.googleDriveButton.closeErrorSnackbar",defaultMessage:"Close"})})})}},646623:(e,t,n)=>{"use strict";n.d(t,{q:()=>o});class a extends(()=>n(757695))().Store{getInitialState(){return{listAIConnectorsPromise:void 0,spaceId:void 0}}}const o=new a;(0,n(852832).exposeDebugValue)("aiConnectorsStore",o)},656633:(e,t,n)=>{"use strict";n.d(t,{vp:()=>s});var a=()=>n(134217);const o={isSalesAssisted:void 0};function s(e,t){return o.isSalesAssisted??(0,a().e9)(e,t)}(0,n(466103).exposeDebugEnvironmentValue)("getAssistantOnboardingDebugInfo",(e=>()=>{const{currentUserSettingsStore:t,sidebarSpaceStore:a}=n(765957).default.state,o=null==t?void 0:t.getSettings();if(!o||!a)return;const{ai_qna_intro_onboarding_phase:r,ai_assistant_onboarding_phase:i,ai_assistant_onboarding_phase_last_set_at:c,ai_assistant_tooltips_onboarding_phase:d,ai_sales_assisted_extra_notification_seen_at:l,last_exposed_to_ai_qna_at:u,qna_reminders_shown_at:p}=o;return{isSalesAssisted:s(e,a.id),relevantUserSettings:{ai_qna_intro_onboarding_phase:r,ai_assistant_onboarding_phase:i,ai_assistant_tooltips_onboarding_phase:d,ai_assistant_onboarding_phase_last_set_at:c,ai_sales_assisted_extra_notification_seen_at:l,last_exposed_to_ai_qna_at:u,qna_reminders_shown_at:p}}}))},694926:(e,t,n)=>{"use strict";n.d(t,{$:()=>o});var a=()=>n(559506);async function o(e){const{environment:t}=e,n=await a().callApi({eventName:"getEmailDomainSettings",environment:t,data:{}});return"failed"===n.type||Boolean(n.data.settings.disable_notion_mail)}},702327:(e,t,n)=>{"use strict";n.d(t,{V:()=>o,g:()=>r});var a=()=>n(206267);function o(){return{currentScreen:"none",status:"not_started",isBackendConnected:!1,externalSourceName:void 0,sessionId:a().JW(),analyticsFrom:"unknown",isConnected:!1,isPersonalAuthComplete:!1,isDisconnecting:!1,isLoaded:!1,isNotionCalendarProhibited:!1}}class s extends(()=>n(757695))().Store{getInitialState(){return o()}}const r=new s;(0,n(852832).exposeDebugValue)("notionCalendarAIConnectorStore",r)},706461:(e,t,n)=>{"use strict";n.d(t,{dK:()=>i,sD:()=>u,uS:()=>r});n(16280),n(944114),n(898992),n(430670),n(803949);var a=()=>n(496603),o=()=>n(534177),s=()=>n(252050);const r="\x3c!--<selection>--\x3e",i="\x3c!--</selection>--\x3e";function c(e){const{node:t,selection:n,path:u,onlyAllowPropertyTypes:p,namespace:m}=e;if(u.includes(t))throw new Error("Circular reference detected!");const g=[...u,t],h=[];if("text"===t.type)for(const f of t.value)h.push(f);else{let y="";y+=`<${t.tagName}`;for(const[v,_]of Object.entries(t.attributes||{}))void 0!==_&&(y+=` ${v}="${_}"`);const b=`</${t.tagName}>`;if("block"===t.type){const k="block"===t.type&&"block"===(null==n?void 0:n.type)&&n.blockIds[0]===t.attributes.id,I="block"===t.type&&"block"===(null==n?void 0:n.type)&&n.blockIds[n.blockIds.length-1]===t.attributes.id,w="block"===t.type&&"text"===(null==n?void 0:n.type)&&(n.start.blockId===t.attributes.id||n.end.blockId===t.attributes.id);k&&h.push(r);if(0===t.text.length&&0===Object.values(t.properties).length&&0===Object.values(t.schemas).length&&0===t.children.length&&!w)h.push(`${y}/>`);else{h.push(`${y}>`);const S=[];if(t.text)for(const C of t.text){const x=c({node:C,selection:n,path:g,onlyAllowPropertyTypes:p,namespace:m});for(const A of x)S.push(A)}let N,T;"text"===(null==n?void 0:n.type)&&n.start.blockId===t.attributes.id&&(N=n.start.index),"text"===(null==n?void 0:n.type)&&n.end.blockId===t.attributes.id&&(T=n.end.index);for(let P=0;P<S.length;P++){const D=S[P];let M="";(0,o().O9)(n)&&P===N&&(M+=r),(0,o().O9)(n)&&P===T&&(M+=i),M+=D,h.push(M)}if((0,o().O9)(n)&&N===S.length&&h.push(r),(0,o().O9)(n)&&T===S.length&&h.push(i),"end_to_end"!==m&&"tr"===t.tagName){a().Ul(Object.values(t.properties),(e=>Number(e.attributes.name))).forEach(((e,a)=>{const o=t.parent&&"table"===t.parent.tagName?t.parent:void 0,s=o&&o.attributes["header-row"],r=o&&"table"===o.tagName&&o.attributes["header-column"],i=o&&0===o.children.indexOf(t),d=s&&0===a||r&&i?"th":"td";h.push(`<${d}>`),h.push(...e.children.flatMap((e=>c({node:e,selection:n,path:g,onlyAllowPropertyTypes:p,namespace:m})))),h.push(`</${d}>`)}))}else{const U=function(e){const{tagName:t,properties:n}=e;if("tr"===t)return n;const a=[];for(const o of n){const e=l(o),n="page"===t;("property-title"===o.tagName||!e||n&&a.length<d)&&a.push(o)}return a}({tagName:t.tagName,properties:Object.values(t.properties)});for(const E of U)p&&!p.includes(E.tagName)||h.push(...c({node:E,selection:n,path:g,onlyAllowPropertyTypes:p,namespace:m}))}for(const O of Object.values(t.schemas))h.push(...c({node:O,selection:n,path:g,onlyAllowPropertyTypes:p,namespace:m}));if(t.children)for(const F of t.children){const B=c({node:F,selection:n,path:g,onlyAllowPropertyTypes:p,namespace:m});for(const $ of B)h.push($)}h.push(b)}(0,o().O9)(n)&&I&&h.push(i)}else if("collection"===t.type){h.push(`${y}>`);for(const q of Object.values(t.properties))p&&!p.includes(q.tagName)||h.push(...c({node:q,selection:n,path:g,onlyAllowPropertyTypes:p,namespace:m}));for(const j of Object.values(t.schemas))h.push(...c({node:j,selection:n,path:g,onlyAllowPropertyTypes:p,namespace:m}));h.push(b)}else{function R(e){return"collection"===e.type||"collectionView"===e.type}if(R(t)||0===t.children.length)h.push(`${y}/>`);else{const L=[];if(!R(t)&&t.children)for(const K of t.children){const H=c({node:K,selection:n,path:g,onlyAllowPropertyTypes:p,namespace:m});for(const W of H)L.push(W)}if(L.length<=1||(0,o().O)(s()._S,t.tagName)&&s()._S[t.tagName].isToken)h.push(`${y}>${L.join("")}${b}`);else for(let V=0;V<L.length;V++){const z=L[V];0===V?h.push(`${y}>${z}`):V===L.length-1?h.push(z+b):h.push(z)}}}}return h}const d=20;function l(e){return"property-checkbox"!==e.tagName&&("property-number"===e.tagName?!e.attributes.number:0===e.children.length)}function u(e){const{node:t,selection:n,onlyAllowPropertyTypes:a,namespace:o}=e;return c({node:t,selection:n,path:[],onlyAllowPropertyTypes:a,namespace:o}).join("")}},723771:(e,t,n)=>{"use strict";n.d(t,{C:()=>o});class a extends(()=>n(757695))().Store{getInitialState(){return{currentScreen:"none",selection:{allObjects:!0,includedObjects:[],excludedObjects:[],includeFutureObjects:!0},status:"not_started",sessionId:n(206267).JW(),analyticsFrom:"unknown",authUrl:void 0,isConnected:!1,isPersonalAuthComplete:!1,isDisconnecting:!1,isSyncComplete:!1,isLoaded:!1,connectionDetails:void 0,externalSourceName:void 0,ingestionProgress:0,userAuthStatus:"not_required",forceShowAuthNotificationTriggeredAt:void 0}}}const o=new a;(0,n(852832).exposeDebugValue)("salesforceAiConnectorStore",o)},724639:(e,t,n)=>{"use strict";n.d(t,{$A:()=>b,Cu:()=>x,EM:()=>T,H0:()=>S,Lw:()=>N,P0:()=>k,VB:()=>v,kI:()=>I,n7:()=>_,n_:()=>w,nc:()=>C,nh:()=>y});n(16280),n(944114),n(898992),n(354520),n(430670),n(581454),n(737550),n(814603),n(147566),n(198721);var a=n.n(n(625473)),o=()=>n(973647),s=()=>n(534177),r=()=>n(638681),i=()=>n(206267),c=()=>n(651784),d=()=>n(234459),l=()=>n(743246),u=()=>n(758256),p=()=>n(760342),m=()=>n(188924),g=()=>n(419447),h=()=>n(789296),f=()=>n(915671);function y(e,t){const n=Object.fromEntries(Object.entries(e).filter((([e,t])=>Boolean(t))));return`${t}${g().qR}?${new URLSearchParams(n).toString()}`}r().union([r().object({optional:{callbackType:r().literals(...c().Bi),moduleSpecific:r().string(),redirectToAuth:r().literal("true"),transcriptId:r().string(),workflowId:r().string()},required:{moduleId:r().string(),spaceId:r().string(),type:r().literal("workflow"),userId:r().string()}}),r().object({optional:{callbackType:r().literals(...c().Bi),moduleSpecific:r().string(),redirectToAuth:r().literal("true")},required:{integrationId:r().string(),spaceId:r().string(),transcriptId:r().string(),type:r().literal("agent"),userId:r().string()}})]);function b(e){const t={...e};delete t.examples,delete t.memories,delete t.annotation,"transcript"in e&&Array.isArray(e.transcript)&&(t.transcript=e.transcript.map((e=>({...e,id:void 0,traceId:void 0}))));const n=(o=t,a()(o,s?{space:"  "}:void 0));var o,s;return(0,i().gB)(n)}function v(e){var t;const n=null===(t=e.state)||void 0===t?void 0:t.type;if(!n||!e.state)return!1;const a=(0,m().Tc)(n);return!a||a.isTriggerConfigured(e.state)}function _(e,t){var n;const a=null===(n=e.state)||void 0===n?void 0:n.type,o=e.state;if(!a||!o)return!0;const s=(0,m().Tc)(a);if(!s||!s.fields)return!0;const r=s.fields[t];return!r||(!r.required(o)||r.isConfigured(o))}function k(e){return"workflow-operation"===(null==e?void 0:e.type)}function I(e){const{spaceId:t,id:n,table:a}=e;return a===l().C0?{spaceId:t,workflowId:n}:a===d().To?{spaceId:t,transcriptId:n}:a===u().U6?{spaceId:t,artifactId:n}:void(0,s().HB)(a)}function w(e){const{config:t,modules:n}=e;if(t)switch(t.type){case"workflow":return t.isCustomAgent&&n?(0,p().Ad)(n):t.searchScopes??f().R2;case"researcher":return t.searchScope?[t.searchScope]:void 0;case"search":return t.scopeForNextSearch?[t.scopeForNextSearch]:void 0;default:return}}function S(e){const{config:t,modules:n}=e;if(!t)return!1;if("workflow"===t.type){if(void 0!==t.useWebSearch)return t.useWebSearch;const e=w({config:t,modules:n});return!!e&&e.some((e=>"web"===e.type||"everything"===e.type))}return("researcher"===t.type||"search"===t.type)&&(t.useWebSearch??!1)}function N(e){const{config:t}=e;return!!t&&("workflow"===t.type&&void 0!==t.useResearchMode&&t.useResearchMode)}function T(e){const t=e.flatMap((e=>{var t,n;return"context"===e.type&&null!==(t=e.value)&&void 0!==t&&t.workflowId?[e.value.workflowId]:((0,h().OA)(e)||(0,h().LO)(e))&&null!==(n=e.result)&&void 0!==n&&n.workflowId?[e.result.workflowId]:[]}));return t[t.length-1]}class C extends Error{constructor(e,t){super(e),this.reasons=t,this.name="WorkflowValidationError"}}function x(e){const t=[];return(!e.instructions||Array.isArray(e.instructions)&&0===e.instructions.length)&&t.push({type:"missing_field",fieldName:"instructions"}),t.length>0?o().Q.fail(t):o().Q.success(void 0)}},733848:(e,t,n)=>{"use strict";n.d(t,{Cb:()=>i,fM:()=>c});n(16280),n(898992),n(672577);var a=()=>n(534177),o=()=>n(562031),s=()=>n(765957),r=()=>n(466088);function i(e){return"assistantChat"===e.type?1===e.operations.length&&"createBlock"===e.operations[0].command&&"text"===e.operations[0].blockNode.tagName&&0===e.operations[0].blockNode.text.length:"assistantChatText"===e.type?0===e.text.length:void(0,a().HB)(e)}function c(e){return(0,r().w)(e)?(0,o().nT)():s().default.state.sidebarSpaceStore}},760342:(e,t,n)=>{"use strict";n.d(t,{Ad:()=>s,BI:()=>r,ve:()=>o});n(944114),n(898992),n(672577),n(737550);var a=()=>n(71621);function o(e,t){return{type:"workflow",workflowId:e,isCustomAgent:!0,enableCustomAgents:!0,enableAgentAutomations:!0,enableAgentIntegrations:!0,enableExperimentalIntegrations:!0,enableTpmThrottle:!0,enableDatabaseAgents:null==t?void 0:t.enableDatabaseAgents}}function s(e){const t=[{type:"notion"}],n=null==e?void 0:e.find((e=>"notion"===e.type));(0,a().gk)(null==n?void 0:n.permissions)&&t.push({type:"web"}),(0,a().eR)(null==n?void 0:n.permissions)&&t.push({type:"helpdocs"});return(null==e?void 0:e.some((e=>"slack"===e.type)))&&t.push({type:"slack"}),t}function r(e){return"workflow"===(null==e?void 0:e.type)&&e.workflowId&&e.isCustomAgent?e.workflowId:void 0}},762282:(e,t,n)=>{"use strict";n.d(t,{CD:()=>i,Qz:()=>r,Y7:()=>c,YV:()=>d,o0:()=>s,uI:()=>l});n(18107),n(967357),n(898992),n(354520),n(581454);var a=()=>n(534177),o=()=>n(252050);class s{constructor(){this.didModify=!1}modified(){return this.didModify}markModified(){this.didModify=!0}resetModified(){this.didModify=!1}apply(e,t){return this.resetModified(),this.applyImpl(e,t)}trimLeadingAndTrailingWhitespace(e){if(0===e.length)return e;const t=[...e],n=t[0];if("text"===n.type){const e=(a=n.value)!==a.trimStart()&&""!==a.trimStart()&&" "===a[0]?` ${a.trimStart()}`:a.trimStart();""===e?(this.markModified(),t.shift()):e!==n.value&&(this.markModified(),t[0]={type:"text",value:e})}var a;const o=t.at(-1);if("text"===(null==o?void 0:o.type)){const e=function(e){return e!==e.trimEnd()&&""!==e.trimEnd()&&" "===e[e.length-1]?`${e.trimEnd()} `:e.trimEnd()}(o.value);""===e?(this.markModified(),t.pop()):e!==o.value&&(this.markModified(),t[t.length-1]={type:"text",value:e})}return t}}function r(e){return"text"===e.type||Boolean(o()._S[e.tagName])}function i(e){return"element"===e.type&&Boolean(o().sA[e.tagName])}function c(e){if("element"!==e.type)return!1;const t=o().sA[e.tagName];return void 0!==t&&!0===t.title}function d(e){return"element"===e.type&&e.tagName in o().GU}function l(e,t){const n=t(e);return"element"===n.type?{...n,children:n.children.map((e=>l(e,t))).filter(a().O9)}:n}},771624:(e,t,n)=>{"use strict";n.d(t,{XS:()=>o});class a extends(()=>n(757695))().Store{getInitialState(){return{currentScreen:"none",status:"not_started",externalSourceName:void 0,sessionId:n(206267).JW(),analyticsFrom:"unknown",isConnected:!1,isPersonalAuthComplete:!1,isDisconnecting:!1,connectionConflictSpaceId:void 0,isLoaded:!1}}}const o=new a;(0,n(852832).exposeDebugValue)("gmailAIConnectorStore",o)},832443:(e,t,n)=>{"use strict";n.d(t,{D4:()=>p,V6:()=>m,tD:()=>g});n(16280),n(944114),n(581454);var a=n.n(n(625473)),o=()=>n(496603),s=()=>n(973647),r=()=>n(534177),i=()=>n(939768),c=()=>n(933528),d=()=>n(902006),l=()=>n(181856);const u=/^\d+$/;function p(e){return!!u.test(e)}class m extends Error{constructor(e){super(`Tried to use an ID that doesn't exist: ${e}`)}}class g{generateSerializedKey(e){return a()(e)}constructor(e){if(this.counter=0,this.keyToCounterMap=new Map,this.counterToKeyMap=new Map,this.mapCounterToKeyInModeOrThrow=(e,t,n)=>s().Q.unwrap(this.mapCounterToKeyInMode(e,t,n)),this.mapCounterToKeyInMode=(e,t,n)=>g.mapCounterToKeyInMode(this,e,t,n),this.utilitiesForTests={removeKey:this.removeKey.bind(this),setCounterValueForKey:this.setCounterValueForKey.bind(this)},e){const t=[];for(const{key:a,counter:o}of e.keyMap)this.keyToCounterMap.set(this.generateSerializedKey(a),o),this.counterToKeyMap.set(o,a),t.push(parseInt(o));const n=o().T9(t);this.counter="number"==typeof n?n+1:0}}serialize(){return{keyMap:Array.from(this.counterToKeyMap.entries()).map((([e,t])=>({key:o().mg(t),counter:e})))}}inheritFrom(e){for(const[t,n]of e.keyToCounterMap.entries())this.keyToCounterMap.set(t,n);for(const[t,n]of e.counterToKeyMap.entries())this.counterToKeyMap.set(t,n)}mapKeyToCounter(e){const t=this.generateSerializedKey(e);if(!this.keyToCounterMap.has(t)){const n=this.counter.toString();this.keyToCounterMap.set(t,n),this.counterToKeyMap.set(n,e),this.counter++}return this.keyToCounterMap.get(t)}mapNodeKeyToCounter(e){if("block"===e.type){const t={...e},n=this.mapNodeAttributesKeyToCounter(e.attributes);t.attributes=n;const a=e.text.map((e=>this.mapNodeKeyToCounter(e)));t.text=a;const o=e.children.map((e=>{const n=this.mapNodeKeyToCounter(e);return n.parent=t,n}));t.children=o;const s={};for(const[e,c]of Object.entries(t.properties))s[e]=this.mapNodeKeyToCounter(c);t.properties=s;const r={};for(const[e,c]of Object.entries(t.schemas))r[e]=this.mapNodeKeyToCounter(c);t.schemas=r;const i=this.mapKeyToCounter({key:e.schemaId,type:"block"});return t.schemaId=i,t}if("property"===e.type||"schema"===e.type||"inline"===e.type){const t={...e};return t.attributes=this.mapNodeAttributesKeyToCounter(t.attributes),t.children=t.children.map((e=>this.mapNodeKeyToCounter(e))),t}if("instructions"===e.type){const t={...e};return t.children=t.children.map((e=>this.mapNodeKeyToCounter(e))),t}if("text"===e.type)return{...e};if("collection"===e.type){const t={...e,schemaId:this.mapKeyToCounter({type:"block",key:e.schemaId}),attributes:{...e.attributes,id:this.mapKeyToCounter({type:"collection",key:e.attributes.id})}},n=Object.fromEntries(Object.entries(t.properties).map((([e,t])=>[e,this.mapNodeKeyToCounter(t)])));t.properties=n;const a=Object.fromEntries(Object.entries(t.schemas).map((([e,t])=>[e,this.mapNodeKeyToCounter(t)])));return t.schemas=a,t}if("collectionView"===e.type)return{...e,schemaId:this.mapKeyToCounter({type:"block",key:e.schemaId}),attributes:{...e.attributes,id:this.mapKeyToCounter({type:"collection-view",key:e.attributes.id}),"database-id":this.mapKeyToCounter({type:"collection",key:e.attributes["database-id"]})}};if("slackMessages"===e.type){return{...e,attributes:{...e.attributes,id:this.mapKeyToCounter({type:"universal",key:e.attributes.id})}}}if("microsoftTeamsMessages"===e.type){return{...e,attributes:{...e.attributes,id:this.mapKeyToCounter({type:"universal",key:e.attributes.id})}}}if("attachment"===e.type){return{...e,attributes:{...e.attributes,id:this.mapKeyToCounter({type:"attachment",key:e.attributes.id,attachmentType:e.attributes.attachmentType})}}}throw new Error(`Unknown node type ${e}`)}mapNodeAttributesKeyToCounter(e){if(!e)return e;const t={...e};for(const[a,o]of Object.entries(g.attributesToMap)){if(!o)continue;const e=t[a];if(e)if("href"===a){let o;const s=i().qg(e),r=i().Jf({str:s.href,allowNoProtocol:!0});r&&(o=n(201980).lXo({url:r,baseUrl:s.protocol?`${s.protocol}//${s.host}`:`https://${s.host??"www.notion.so"}`,publicDomainName:s.host??"www.notion.so"})),t[a]=o?this.mapKeyToCounter({type:"block",key:o}):e}else t[a]="person-id"===a?this.mapKeyToCounter({type:"person",key:e}):"database-id"===a||"data-source-id"===a?this.mapKeyToCounter({type:"collection",key:e}):this.mapKeyToCounter({type:"block",key:e})}return t}doesIdMapperContainMappedKey(e){return this.counterToKeyMap.has(e)}doesIdMapperContainKey(e){return this.keyToCounterMap.has(this.generateSerializedKey(e))}getIdForMappedKeyIfExists(e){const t=this.counterToKeyMap.get(e);return null==t?void 0:t.key}mapCounterToKey(e){const t=this.counterToKeyMap.get(e);if(!t)throw new m(e);return t}mapAssistantContextCounterToKey(e){const{"instructions-page-id":t,"current-page-id":n,"current-person-id":a,"current-background-page-id":o,...s}=e;return{...s,...e["instructions-page-id"]?{"instructions-page-id":this.mapCounterToKeyInModeOrThrow(e["instructions-page-id"],"block_counter")}:{},...e["current-page-id"]?{"current-page-id":this.mapCounterToKeyInModeOrThrow(e["current-page-id"],"block_counter")}:{},...e["current-background-page-id"]?{"current-background-page-id":this.mapCounterToKeyInModeOrThrow(e["current-background-page-id"],"block_counter")}:{},...e["current-thread-id"]?{"current-thread-id":this.mapCounterToKeyInModeOrThrow(e["current-thread-id"],"thread_counter")}:{},...e["current-person-id"]?{"current-person-id":this.mapCounterToKeyInModeOrThrow(e["current-person-id"],"person_counter")}:{}}}mapAssistantContextKeyToCounter(e){const{"instructions-page-id":t,"current-page-id":n,"current-person-id":a,"current-background-page-id":o,...s}=e;return{...s,...e["instructions-page-id"]?{"instructions-page-id":this.mapKeyToCounter({type:"block",key:e["instructions-page-id"]})}:{},...e["current-page-id"]?{"current-page-id":this.mapKeyToCounter({type:"block",key:e["current-page-id"]})}:{},...e["current-background-page-id"]?{"current-background-page-id":this.mapKeyToCounter({type:"block",key:e["current-background-page-id"]})}:{},...e["current-thread-id"]?{"current-thread-id":this.mapKeyToCounter({type:"slack-thread",key:(0,d().V9)(e["current-thread-id"])})}:{},...e["current-person-id"]?{"current-person-id":this.mapKeyToCounter({type:"person",key:e["current-person-id"]})}:{}}}mapAssistantSelectionKeyToCounter(e){return"block"===e.type?{type:"block",blockIds:e.blockIds.map((e=>this.mapKeyToCounter({type:"block",key:e})))}:"text"===e.type?{type:"text",start:{...e.start,blockId:this.mapKeyToCounter({type:"block",key:e.start.blockId})},end:{...e.end,blockId:this.mapKeyToCounter({type:"block",key:e.end.blockId})}}:void(0,r().HB)(e)}static mapCounterToKeyInMode(e,t,n,a){if("block_counter"===n||"person_counter"===n||"thread_counter"===n||"collection_counter"===n||"collection_view_counter"===n||"query_database_result_counter"===n||"external_id_counter"===n||"attachment_id_counter"===n){const o=(0,s().j)((()=>e.mapCounterToKey(t)));if(s().Q.isFail(o))return o;const i=o.value;let c;return"block_counter"===n?c="block":"person_counter"===n?c="person":"thread_counter"===n?c="slack-thread":"collection_counter"===n?c="collection":"collection_view_counter"===n?c="collection-view":"query_database_result_counter"===n?c="query-database-result":"external_id_counter"===n?c="universal":"attachment_id_counter"===n?c="attachment":(0,r().HB)(n),i.type!==c?{error:new(l().xU)({receivedIdType:i.type,expectedIdType:c,tagNameForErrorMessage:a,idValueForErrorMessage:t})}:{value:i.key}}if("href_counter"===n){const n=g.getMappedTypeFromCounterIfExists(t,e);return"query-database-result"===n?{error:new(l().xU)({receivedIdType:n,expectedIdType:"href",tagNameForErrorMessage:a,idValueForErrorMessage:t})}:{value:g.mapHrefCounterToUrl(e,t)}}(0,r().HB)(n)}getTypeKeyFromCounter(e){return g.getMappedTypeFromCounterIfExists(e,this)}static getMappedTypeFromCounterIfExists(e,t){let n;try{n=t.mapCounterToKey(e)}catch(a){if(a instanceof m)return;throw a}return n.type}static blockKeyToHref(e){return`/${e.key.split("/")[0].replaceAll("-","")}`}static blockIdToHref(e){return`/${e.split("/")[0].replaceAll("-","")}`}static mapHrefCounterToUrl(e,t){let n;try{n=e.mapCounterToKey(t)}catch(a){if(a instanceof m)return t;throw a}if("block"===n.type)return g.blockKeyToHref(n);if("url"===n.type||"slack-message"===n.type||"slack-thread"===n.type||"webpage"===n.type||"helpdoc"===n.type||"helpdoc-section"===n.type||"microsoft-teams-message"===n.type||"microsoft-teams-thread"===n.type||"discord-message"===n.type||(0,d().SC)(n.type))return n.key;if("collection"===n.type||"collection-view"===n.type||"person"===n.type)return d().Py;if("query-database-result"===n.type||"skill"===n.type)throw new Error(`Invalid URL type: ${n.type}`);return"universal"===n.type||"attachment"===n.type?n.key:void(0,r().HB)(n.type)}removeKey(e){const t=this.generateSerializedKey(e),n=this.keyToCounterMap.get(t);if(n)return this.keyToCounterMap.delete(t),this.counterToKeyMap.delete(n),n}setCounterValueForKey(e,t){const n=this.generateSerializedKey(e);this.keyToCounterMap.set(n,t),this.counterToKeyMap.set(t,e)}}g.attributesToMap={id:!0,"page-id":!0,"database-id":!0,"data-source-id":!0,"person-id":!0,"person-name":!1,href:!0,category:!1,option:!1,format:!1,number:!1,date:!1,time:!1,"start-date":!1,"start-time":!1,"end-date":!1,"end-time":!1,"synced-property-name":!1,"synced-block-id":!0,"external-id":!0,index:!1,title:!1,icon_url:!1,description:!1,name:!1,equation:!1},g.parseAssistantHref=c().f9,g.databaseQueryHrefToDatabaseQueryResultsId=c().uP,g.blockHrefToAssistantBlockId=c().Gp},915671:(e,t,n)=>{"use strict";n.d(t,{R2:()=>i,bZ:()=>r,rz:()=>c});var a=()=>n(496603),o=()=>n(498212),s=()=>n(71621);function r(){return{modules:[{id:(0,o().Ay)(),type:"notion",name:"Notion",version:s().IN.latestVersion,permissions:[]}]}}const i=[{type:"everything"}];function c(e){for(const t of i)if(a().n4(e,t))return!0;return!1}},953911:(e,t,n)=>{"use strict";n.d(t,{M:()=>o});class a extends(()=>n(757695))().Store{getInitialState(){return{currentScreen:"none",status:"not_started",sessionId:n(206267).JW(),analyticsFrom:"unknown",authUrl:void 0,isConnected:!1,isSyncComplete:!1,isLoaded:!1,externalSourceName:void 0,ingestionProgress:0}}}const o=new a;(0,n(852832).exposeDebugValue)("boxAiConnectorStore",o)},963702:(e,t,n)=>{"use strict";n.d(t,{F:()=>r,G:()=>o});var a=()=>n(206267);function o(){return{currentScreen:"none",connectionStatus:"not_started",sessionId:a().JW(),analyticsFrom:"unknown",syncProgressPercentage:0,isLoaded:!1,isDisconnecting:!1,error:void 0,externalSourceName:void 0}}class s extends(()=>n(757695))().Store{getInitialState(){return o()}}const r=new s},993474:(e,t,n)=>{"use strict";n.d(t,{K:()=>f});n(16280);var a=()=>n(902006),o=()=>n(510818),s=()=>n(201980),r=()=>n(69708),i=()=>n(534177),c=()=>n(559506),d=()=>n(96563),l=()=>n(229533),u=()=>n(430483),p=(n(898992),n(672577),()=>n(450528)),m=()=>n(646623);class g{createSearchScope(){return{type:this.base.type}}isEligible(e){return u().zD.canUseAiConnectorSearchScope(this.base.type)}isLoading(){return!(0,n(604018).A7)(this.base.type)}isInProgress(){return(0,l().LT)(this.base.type).isInProgress}isDisconnecting(){return(0,l().$t)(this.base.type)}isEnabled(e){return(0,p().H5)(e,this.base.type)}setEnabled(e,t,n){return this.isAvailable(n??{})?(0,p().dV)(e,this.base.type,t,(()=>this.createSearchScope())):e}toSearchScopeModule(){return{type:this.base.type,displayName:this.base.displayName,icon:this.icon,isEligible:e=>this.isEligible(e),isLoading:()=>this.isLoading(),isAvailable:e=>this.isAvailable(e),needsAuth:()=>this.needsAuth(),createSearchScope:()=>this.createSearchScope(),isEnabled:e=>this.isEnabled(e),setEnabled:(e,t,n)=>this.setEnabled(e,t,n),isInProgress:()=>this.isInProgress(),isDisconnecting:()=>this.isDisconnecting(),isConnected:e=>this.isConnected(e),connect:e=>this.connect(e)}}async authenticate(e){const{environment:t,spaceId:a,onAuthSuccess:o}=e,s=n(634877).NT[this.base.type].state,r=await c().callApi({eventName:"getAIConnectorAuthorizationUrl",environment:t,data:{connector:this.base.type,authorizationType:"user",spaceId:a,sessionId:s.sessionId,client:t.device.isElectron?"desktop":"web"}});"success"===r.type&&(t.device.isElectron?(0,n(836095).P)(r.data.authorizationUrl):(n(383466).P(t,{width:800,height:600,url:r.data.authorizationUrl,titleMessage:this.messages.oauthPopupTitleMessage}),null==o||o()))}async getConnectorStatus(e){const{environment:t,spaceId:n}=e,a=await this.getListAIConnectorsPromise({environment:t,spaceId:n});if("success"!==a.type)return"failed";if("connectedConnectors"in a.data){return a.data.connectedConnectors.find((e=>e.id===this.base.type))}}async getListAIConnectorsPromise(e){const{environment:t,spaceId:n}=e;if(m().q.state.listAIConnectorsPromise&&m().q.state.spaceId===n)return m().q.state.listAIConnectorsPromise;const a=c().callApi({eventName:"listAIConnectors",environment:t,data:{spaceId:n}}).then((e=>(setTimeout((()=>{m().q.setState({listAIConnectorsPromise:void 0,spaceId:n})}),100),e))).catch((e=>e));return m().q.setState({listAIConnectorsPromise:a,spaceId:n}),a}}const h=Object.freeze({asana:new class extends g{constructor(...e){super(...e),this.base=new(n(532058).v),this.store=n(624820).P0,this.icon=n(756374).X,this.messages=(0,r().YK)({oauthPopupTitleMessage:{id:"asanaAIConnector.oauthPopup.title",defaultMessage:"Asana Authentication"},connectorScopedSearchTooltipMessage:{id:"assistantScopedSearchMenu.asanaItem.tooltip",defaultMessage:"Find in your Asana tasks and projects"},userDisconnectedMessage:{id:"asanaAIConnector.userAuth.disconnected",defaultMessage:"Asana user account disconnected."}}),this.alreadyConnectedConfig={analyticsFrom:"asana_already_connected",primedTextInput:"Search for tasks in Asana",contentType:"tasks"}}getCitationAnnotationFromParsedHref(e){if("asana"!==e.parsedData.type)throw new Error(`Expected asana parsed data, got ${e.parsedData.type}`);return(0,s().X$)({type:this.base.type,href:e.parsedData.href,url:e.parsedData.url,messageId:e.parsedData.url})}getCitationAnnotationFromSearchResult(e){if("asana"!==e.result.type)throw new Error(`Expected asana result, got ${e.result.type}`);return(0,s().X$)({type:this.base.type,href:e.result.href,url:e.result.url,messageId:e.result.url,resultId:e.result.id,positionWithinSource:e.result.positionWithinSource,traceId:e.result.traceId})}getPayloadDataForHrefCallback(e){const{context:t,parsedData:n}=e;if(t.searchSourceType===this.base.type&&n.type===this.base.type)return{...n,type:this.base.type,url:n.url,title:t.title,text:"",lastEdited:t.lastEdited,href:(0,a().V9)(n.href)}}async updateConnectorStatus(e){const{environment:t,spaceId:n}=e,a=await this.getConnectorStatus({environment:t,spaceId:n});if(!a||"failed"===a)return this.store.setState({...this.store.state,isConnected:!1,isLoaded:!0}),{status:"success"};const o=null==a?void 0:a.details.connectionDetails;return this.store.setState({...this.store.state,isConnected:"completed"===(null==o?void 0:o.status)||"disconnecting"===(null==o?void 0:o.status),isLoaded:!0,syncProgressPercentage:(null==o?void 0:o.progress)??0,connectionStatus:(null==o?void 0:o.status)??"not_started",externalSourceName:null==o?void 0:o.external_source_name}),{status:"success"}}async disconnectConnector(e){const{environment:t,spaceId:n}=e;await c().callApi({eventName:"disconnectAiConnector",environment:t,data:{spaceId:n,connector:this.base.type}});return{type:"success"}}async disconnectConnectorPersonalAuth(e){const{environment:t,spaceId:a}=e;(0,n(564884).u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"user_auth_disconnect",integration_type:this.base.type,setup_session_id:this.store.state.sessionId,from:this.store.state.analyticsFrom}}}),await c().callApi({eventName:"disconnectAiConnector",environment:t,data:{spaceId:a,connector:this.base.type,disconnectionType:"user"}}),this.store.setState({...this.store.state,connectionStatus:"not_started",isConnected:!1}),this.messages.userDisconnectedMessage&&n(471995).D6({label:n(972435).A.getIntl().formatMessage(this.messages.userDisconnectedMessage),position:"bottom"})}setDebuggingStatus(e){const t=this.getTestableStatuses();return!!(0,i().O)(t,e)&&(this.store.setState(t[e]),!0)}generateRenderableResults(e){const{result:t,parsedHref:n}=e;if("asana"===t.type){if("asana"!==n.type)throw new Error(`Expected asana result, but got ${n.type}`);return[{type:"asana",href:t.id,id:t.pageId,title:t.title,text:(0,o().Mw)(t.text),lastEdited:t.lastEdited,url:n.url,highlight:t.highlight}]}}getDismissedAuthPromptKey(){return"dismissed_asana_personal_auth_prompt"}isConnected(e){return u().zD.isConnectedToAsanaAiConnector(this.store.state)}needsAuth(){return(0,l().YX)(this.store.state)}isAvailable(e){return this.isConnected(e)}connect(e){if(!e)return;const{environment:t,connectorsFeatureAvailability:n}=e;(0,d().pp)({environment:t,connector:"asana",analyticsFrom:"multi_search_scope_menu",connectorsFeatureAvailability:n})}getTestableStatuses(){const e=this.store.getInitialState();return{not_started:{...e},in_progress:{...e,connectionStatus:"in_progress",syncProgressPercentage:50},disconnecting:{...e,isConnected:!0,connectionStatus:"disconnecting",isDisconnecting:!0},connected:{...e,isConnected:!0,connectionStatus:"completed",syncProgressPercentage:100}}}},gmail:new class extends g{constructor(...e){super(...e),this.base=new(n(109954).X),this.store=n(771624).XS,this.icon=n(474998).l,this.messages=(0,r().YK)({oauthPopupTitleMessage:{id:"gmailAIConnector.oauthPopup.title",defaultMessage:"Gmail Authentication"},connectorScopedSearchTooltipMessage:{id:"assistantScopedSearchMenu.gmailItem.tooltip",defaultMessage:"Find in your emails"}}),this.alreadyConnectedConfig={analyticsFrom:"gmail_already_connected",primedTextInput:"Search for emails in Gmail",contentType:"emails"}}getCitationAnnotationFromParsedHref(e){if("gmail"!==e.parsedData.type)throw new Error(`Expected gmail parsed data, got ${e.parsedData.type}`);return(0,s().X$)({type:this.base.type,href:e.parsedData.href,url:e.parsedData.url,messageId:e.parsedData.url})}getCitationAnnotationFromSearchResult(e){if("gmail"!==e.result.type)throw new Error(`Expected gmail result, got ${e.result.type}`);return(0,s().X$)({type:this.base.type,href:e.result.href,url:e.result.url,messageId:e.result.id,resultId:e.result.id,positionWithinSource:e.result.positionWithinSource,traceId:e.result.traceId})}getPayloadDataForHrefCallback(e){const{context:t,parsedData:n}=e;if(t.searchSourceType===this.base.type&&"gmail"===n.type)return{...n,type:"gmail",url:n.url,title:t.title,text:"",lastEdited:t.lastEdited,href:(0,a().V9)(n.href),threadHref:(0,a().V9)(n.href)}}async updateConnectorStatus(e){const{environment:t,spaceId:n}=e,a=await this.getConnectorStatus({environment:t,spaceId:n});if(!a||"failed"===a)return this.store.setState({...this.store.state,status:"not_started",isPersonalAuthComplete:!1,isConnected:!1,isLoaded:!0}),{status:"success"};const o=a.details.connectionDetails;return this.store.setState({...this.store.state,externalSourceName:o.external_source_name,status:"completed"===o.status?"authenticated":"not_started",isConnected:"completed"===o.status,isLoaded:!0,isPersonalAuthComplete:!0}),{status:"success"}}async disconnectConnector(e){const{environment:t,spaceId:n}=e;await c().callApi({eventName:"disconnectAiConnector",environment:t,data:{spaceId:n,connector:this.base.type}});return{type:"success"}}async disconnectConnectorPersonalAuth(e){return Promise.reject(new Error("GmailClientDriver.disconnectConnectorPersonalAuth() is not implemented"))}generateRenderableResults(e){const{result:t,parsedHref:n}=e;if("gmail"===t.type){if("gmail"!==n.type)throw new Error(`Expected gmail result, but got ${n.type}`);return[{type:"gmail",href:t.id,id:t.pageId,title:t.title,text:(0,o().Mw)(t.text),lastEdited:t.lastEdited,emailAddress:t.emailAddress,url:n.url}]}}getDismissedAuthPromptKey(){}isConnected(e){return u().zD.isConnectedToGmailUniversalQnA(this.store.state)}needsAuth(){return!1}isAvailable(e){return this.isConnected(e)}connect(e){if(!e)return;const{environment:t,connectorsFeatureAvailability:n}=e;(0,d().pp)({environment:t,connector:"gmail",analyticsFrom:"multi_search_scope_menu",connectorsFeatureAvailability:n})}setDebuggingStatus(e){const t=this.getTestableStatuses();return!!(0,i().O)(t,e)&&(this.store.setState(t[e]),!0)}getTestableStatuses(){const e=this.store.getInitialState();return{not_started:e,connected:{...e,isConnected:!0,status:"authenticated"}}}}});function f(e){return h[e]}}}]);