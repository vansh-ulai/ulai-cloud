"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[2752],{198688:(e,t,r)=>{r.d(t,{A:()=>n});r(296540);var o=r(474848);const n=function(){const e=(0,r(401497).IS)((e=>({separator:{height:14,width:1,marginInlineStart:6,marginInlineEnd:6,background:e.darkDividerColor}})),[]);return(0,o.jsx)("div",{style:e.separator})}},389657:(e,t,r)=>{r.d(t,{A:()=>j});var o=r(296540),n=()=>r(484714),a=()=>r(56366),i=()=>r(401497),s=()=>r(718827),c=()=>r(252291),l=()=>r(30537),d=()=>r(471095),u=()=>r(701751),p=r(474848);const g={viewBox:"0 0 20 20",fittedViewBox:"3.97 1.95 14.91 15.65",svg:(0,p.jsx)("path",{d:"M11.92 5.43a3.48 3.48 0 0 1 6.96 0v2.095a.625.625 0 1 1-1.25 0V5.43a2.23 2.23 0 1 0-4.46 0v1.92h.43a2.425 2.425 0 0 1 2.425 2.425v5.4A2.425 2.425 0 0 1 13.6 17.6H6.4a2.425 2.425 0 0 1-2.425-2.425v-5.4A2.425 2.425 0 0 1 6.4 7.35h5.52zm-1.357 7.373a1.35 1.35 0 1 0-1.126 0v1.247a.563.563 0 0 0 1.126 0z"})},f=(0,r(340498).wt)("lockOpenFill",g);var h=()=>r(105819),m=()=>r(798880),v=()=>r(695608),k=()=>r(69708),y=()=>r(314529);function C(e,t){(0,y().DO_NOT_USE_trackLegacy)(e,"edit_lock_toggle",t)}var b=()=>r(896628),S=()=>r(231297),_=()=>r(544198),I=()=>r(722872),P=()=>r(455425),w=()=>r(712505),R=()=>r(870092),x=()=>r(575143),M=()=>r(406699),A=()=>r(404277),O=()=>r(939740),L=()=>r(89924),B=()=>r(859428),F=()=>r(198688);const j=function({store:e,disableTooltip:t,hideText:r,isInlineCollection:o,buttonStyle:a}){const{isMobile:i}=(0,n().Y0)();return i?(0,p.jsx)(W,{store:e,hideText:r}):(0,p.jsx)(U,{store:e,disableTooltip:t,hideText:r,isMobile:i,isInlineCollection:o,buttonStyle:a})};function T(e,t,r){return{display:"flex",alignItems:"center",whiteSpace:"nowrap",gap:4,fontSize:e?12:14,borderRadius:4,padding:"0 6px",marginInlineEnd:2,height:24,marginTop:e?1:0,marginInlineStart:e?0:-5,...t&&{marginInlineStart:e?8:12,marginInlineEnd:0},...r}}function E(e,t,r,o,n){return{...T(e,o,n),color:r.text.tertiary,fill:r.icon.tertiary}}function q(e,t,r,o,n){return{...T(e,o,n),paddingInlineStart:5,border:`1px solid ${r.blue.border.accentPrimary}`,color:r.blue.text.accentPrimary,fill:r.blue.icon.accentPrimary}}function D({store:e}){const t=(0,i().DP)(),r=(0,a().K8)((()=>e.getFormat().block_locked_by),[e]),o=(0,k().tz)(),n=(0,a().K8)((()=>r&&(0,v().c6)(o,R().L.createChildStore(e,{table:m().oo,id:r}).getModel())),[r,o,e]);return r?(0,p.jsx)("div",{children:(0,p.jsx)(k().sA,{defaultMessage:"Locked by {lockedByPerson}{br}to prevent accidental editing.{br}<prompttext>Click to unlock</prompttext>",id:"pageLockIndicator.lockedTooltip",values:{lockedByPerson:(0,p.jsx)("b",{children:n}),br:(0,p.jsx)("br",{}),prompttext:e=>(0,p.jsx)("span",{style:{color:t.text.inverseSecondary},children:e})}})}):null}function V(e,t){P().$.relockBlock({userId:t.userId,blockId:t.id});const r=t.getType();if(r){const{collectionId:o,ownedCollectionCount:n,linkedCollectionCount:a}=(0,_().P)(t,{skipPages:!0});C(e,{from:"topbar",block_type:r,locked:!0,collection_id:o,owned_collection_count:n,linked_collection_count:a})}}function N({store:e,close:t}){const r=(0,n().v3)(),a=(0,o.useCallback)((()=>{!function(e,t){P().$.temporarilyUnlockBlock({userId:t.userId,blockId:t.id});const r=t.getType();if(r){const{collectionId:o,ownedCollectionCount:n,linkedCollectionCount:a}=(0,_().P)(t,{skipPages:!0});C(e,{from:"topbar",block_type:r,locked:!1,collection_id:o,owned_collection_count:n,linked_collection_count:a})}}(r,e),t()}),[r,e,t]),i=(0,o.useCallback)((()=>{!function(e,t){S().createAndCommit({userAction:"PageLockTopbarIndicator.handlePermanentUnlockClick",environment:e,canUndo:!0,perform:r=>{b()._l({environment:e,store:t,isLocked:!1,transaction:r})}});const r=t.getType();if(r){const{collectionId:o,ownedCollectionCount:n,linkedCollectionCount:a}=(0,_().P)(t,{skipPages:!0});C(e,{from:"topbar",block_type:r,locked:!1,collection_id:o,owned_collection_count:n,linked_collection_count:a})}}(r,e),t()}),[r,e,t]),s=[{key:"temp_unlock",render:e=>(0,p.jsx)(x().A,{...e,svg:h().pencilLineIcon,title:(0,p.jsx)(k().sA,{defaultMessage:"Unlock for me",id:"pageLockIndicator.temporaryUnlockOption.label"})}),action:()=>{a()}},{key:"perm_unlock",render:e=>(0,p.jsx)(x().A,{...e,svg:u().p,title:(0,p.jsx)(k().sA,{defaultMessage:"Unlock for everyone",id:"pageLockIndicator.permanentUnlockOption.label"})}),action:()=>{i()}}];return(0,p.jsx)(A().A,{menuType:I().gu.Popup,children:(0,p.jsx)(O().Ay,{type:O().Oh.Vertical,onAccept:t,sections:[{key:"unlock_options",render:e=>(0,p.jsx)(L().A,{...e}),items:s}],initialFocus:void 0})})}function U({store:e,disableTooltip:t,hideText:r,isMobile:u,isInlineCollection:g,buttonStyle:h}){const m=(0,i().DP)(),v=(0,n().v3)(),y=(0,o.useCallback)((()=>V(v,e)),[v,e]),C=(0,a().K8)((()=>e.isLockedForAllUsers()),[e]),b=(0,a().K8)((()=>P().$.isTemporarilyUnlocked({userId:e.userId,blockId:e.id})),[e.id,e.userId]),S=(0,a().K8)((()=>w().default.state.open&&w().default.state.targetStore.id===e.id),[e.id]);return C?b?(0,p.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[S?(0,p.jsx)(F().A,{}):void 0,(0,p.jsxs)(s().Ay,{style:q(u,0,m,g,h),onClick:y,hoveredStyle:{background:m.outlineBlueButtonHoveredBackground},pressedStyle:{background:m.outlineBlueButtonPressedBackground},children:[(0,p.jsx)(c().I,{icon:f}),r?void 0:(0,p.jsx)("div",{style:{lineHeight:1},children:(0,p.jsx)(k().sA,{defaultMessage:"Re-lock",id:"pageLockIndicator.relockButton.label"})})]})]}):(0,p.jsx)(B().A,{renderTooltip:()=>(0,p.jsx)(D,{store:e}),disableTooltip:t,render:t=>(0,p.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[S?(0,p.jsx)(F().A,{}):void 0,(0,p.jsx)(M().A,{popupType:l().n.Popup,renderOrigin:({onClick:e})=>(0,p.jsxs)(s().Ay,{style:E(u,0,m,g,h),onClick:e,...t,children:[(0,p.jsx)(c().I,{icon:d().i}),r?void 0:(0,p.jsx)("div",{style:{lineHeight:1},children:(0,p.jsx)(k().sA,{defaultMessage:"Locked",id:"pageLockIndicator.lockedButton.label"})})]}),render:({close:t})=>(0,p.jsx)(N,{store:e,close:t})})]})}):null}function W({store:e,hideText:t}){const r=(0,i().DP)(),u=(0,n().v3)(),g=(0,o.useCallback)((()=>V(u,e)),[u,e]),h=(0,a().K8)((()=>e.isLockedForAllUsers()),[e]),m=(0,a().K8)((()=>P().$.isTemporarilyUnlocked({userId:e.userId,blockId:e.id})),[e.id,e.userId]),{WindowSizeStore:v}=u,y=(0,a().K8)((()=>v.getSafePaddingLeftCSS(10)),[v]),C=(0,a().K8)((()=>v.getSafePaddingRightCSS(14)),[v]);return h?m?(0,p.jsxs)(s().Ay,{onClick:g,style:{display:"flex",alignItems:"center",width:"100%",height:"100%",gap:6,paddingInlineStart:y,paddingInlineEnd:C,color:r.blue.text.accentPrimary,fill:r.blue.icon.accentPrimary},children:[(0,p.jsx)(c().I,{icon:f}),t?void 0:(0,p.jsx)("div",{children:(0,p.jsx)(k().sA,{defaultMessage:"Re-lock",id:"pageLockIndicator.mobileRelockButton.label"})})]}):(0,p.jsx)(M().A,{popupType:l().n.Popup,renderOrigin:({onClick:e})=>(0,p.jsxs)(s().Ay,{onClick:e,style:{display:"flex",alignItems:"center",gap:6,height:"100%",paddingInlineStart:y,paddingInlineEnd:C},children:[(0,p.jsx)(c().I,{icon:d().i}),t?void 0:(0,p.jsx)("div",{children:(0,p.jsx)(k().sA,{defaultMessage:"Locked",id:"pageLockIndicator.mobileLockedButton.label"})})]}),render:({close:t})=>(0,p.jsx)(N,{store:e,close:t})}):null}},482099:(e,t,r)=>{r.d(t,{p:()=>p,t:()=>g});var o=r(296540),n=()=>r(726637),a=()=>r(484714),i=()=>r(56366),s=()=>r(449412),c=()=>r(319625),l=()=>r(614949),d=()=>r(974233),u=()=>r(765957);function p(){const e=(0,a().v3)(),t=(0,o.useRef)(!1),r=(0,i().K8)((()=>u().default.state.renderPhase),[]),n=window.CLIENT_LOAD_TAG;(0,o.useEffect)((()=>{if(n&&!t.current&&"rendered"===r){t.current=!0;const{shouldShowError:r}=(0,l().X)(e);f({environment:e,isRedirect:!1,isShowingError:r})}}),[n,r,e])}function g(e){window.CLIENT_LOAD_TAG&&f({environment:e,isRedirect:!0,isShowingError:!1})}async function f(e){const t=window.CLIENT_LOAD_TAG;try{await(0,d().default)({data:{tag:t,isRedirect:e.isRedirect,isShowingError:e.isShowingError,version:n().A.version},environment:e.environment,format:"json",keepAlive:!0,method:"POST",url:"/api/v3/recordClientLoadComplete"})}catch(r){const e=(0,c().A)(r);(0,s().Fg)(e)}}},527580:(e,t,r)=>{r.d(t,{TK:()=>s,YC:()=>i,ui:()=>a});var o=()=>r(645873);const n={pageVerification:new(o().O2)("pageVerification",(()=>Promise.all([r.e(55753),r.e(91598),r.e(48046),r.e(61505),r.e(50775),r.e(94891)]).then(r.bind(r,80826)))),pageVerificationBadge:new(o().O2)("pageVerificationBadge",(()=>Promise.all([r.e(55162),r.e(71003),r.e(55753),r.e(28866),r.e(74562),r.e(47160),r.e(91598),r.e(48046),r.e(42056),r.e(76677),r.e(43223),r.e(15517),r.e(61505),r.e(94300),r.e(50775),r.e(79421),r.e(41412)]).then(r.bind(r,422283)))),pageVerificationMenuRenderer:new(o().O2)("pageVerificationMenuRenderer",(()=>Promise.all([r.e(55162),r.e(71003),r.e(55753),r.e(28866),r.e(74562),r.e(47160),r.e(91598),r.e(48046),r.e(42056),r.e(76677),r.e(43223),r.e(15517),r.e(61505),r.e(94300),r.e(50775),r.e(79421),r.e(26207)]).then(r.bind(r,196770))))},a=(0,o()._h)(n.pageVerification,(e=>e.PageAddVerificationButton)),i=(0,o()._h)(n.pageVerificationBadge,(e=>e.PageVerificationBadge)),s=(0,o()._h)(n.pageVerificationMenuRenderer,(e=>e.PageVerificationMenuRenderer))},551780:(e,t,r)=>{r.d(t,{DA:()=>a,F4:()=>n});var o=()=>r(645873);const n=(0,o()._h)(new(o().O2)("topbar",(()=>Promise.all([r.e(87403),r.e(53179)]).then(r.bind(r,873892)))),(e=>e.TopbarSubmitPostButton)),a=((0,o()._h)(new(o().O2)("topbar",(()=>Promise.all([r.e(87403),r.e(53179)]).then(r.bind(r,487146)))),(e=>e.TopbarFavoriteButton)),(0,o()._h)(new(o().O2)("offlineDownloadIndicator",(()=>r.e(71739).then(r.bind(r,1294)))),(e=>e.OfflineDownloadIndicator)))},629537:(e,t,r)=>{r.d(t,{V:()=>i});r(296540);var o=()=>r(56366),n=()=>r(851240),a=r(474848);function i(e){const{render:t,...r}=e,i=(0,n().A)(r);return(0,a.jsx)(a.Fragment,{children:(0,o().K8)((()=>t(i)),[t,i],{silenceRerenderDefender:!0})})}},679192:(e,t,r)=>{r.d(t,{w:()=>a});var o=()=>r(645873);const n={UncollectibleExperienceOverlay:new(o().O2)("UncollectibleExperienceOverlay",(async()=>r.e(36432).then(r.bind(r,134673))))},a=(0,o()._h)(n.UncollectibleExperienceOverlay,(e=>e.UncollectibleExperienceOverlay))},701751:(e,t,r)=>{r.d(t,{p:()=>a});r(296540);var o=r(474848);const n={viewBox:"0 0 20 20",fittedViewBox:"3.97 1.94 14.91 15.66",svg:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("path",{d:"M10.55 12.808a1.35 1.35 0 1 0-1.1 0v1.242a.55.55 0 1 0 1.1 0z"}),(0,o.jsx)("path",{d:"M15.4 1.95a3.48 3.48 0 0 0-3.48 3.48v1.92H6.4a2.425 2.425 0 0 0-2.425 2.425v5.4A2.425 2.425 0 0 0 6.4 17.6h7.2a2.425 2.425 0 0 0 2.425-2.425v-5.4A2.425 2.425 0 0 0 13.6 7.35h-.43V5.43a2.23 2.23 0 1 1 4.46 0v2.095a.625.625 0 1 0 1.25 0V5.43a3.48 3.48 0 0 0-3.48-3.48M5.225 9.775c0-.649.526-1.175 1.175-1.175h7.2c.649 0 1.175.526 1.175 1.175v5.4c0 .649-.526 1.175-1.175 1.175H6.4a1.175 1.175 0 0 1-1.175-1.175z"})]})},a=(0,r(340498).wt)("lockOpen",n)},745803:(e,t,r)=>{r.d(t,{t:()=>C});var o=r(296540),n=()=>r(564884),a=()=>r(59226),i=()=>r(484714),s=()=>r(56366),c=()=>r(401497),l=()=>r(699143),d=()=>r(406094),u=()=>r(90907),p=()=>r(762433),g=()=>r(69708),f=()=>r(209660),h=()=>r(511393),m=()=>r(176983),v=()=>r(369955),k=()=>r(324561),y=r(474848);function C(){const e=(0,i().v3)(),t=(0,c().IS)((e=>({content:{position:"absolute",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:16,textAlign:"center",fontSize:14,gap:16,zIndex:2,top:"50%",insetInlineStart:"50%",transform:"translate(calc(var(--direction, 1) * -50%), -50%)",maxWidth:282,lineHeight:"20px"},blurContainer:{position:"fixed",backdropFilter:"blur(18px)",height:"100%",width:"100%",zIndex:1},lockedIcon:{fill:e.icon.primary,width:24,height:24},buttonWrapper:{paddingInlineStart:"10px",paddingInlineEnd:"12px"},opacityContainer:{position:"fixed",opacity:.4,zIndex:1,background:e.white,height:"100%",width:"100%"},secondaryMessage:{color:e.text.secondary,textAlign:"center",fontSize:12,lineHeight:"16px"}})),[]),r=function(){var e;const t=(0,a().X)("blur_missing_name_spaces"),r=(0,v().L)(),o=(0,k()._3)({spaceId:null==r?void 0:r.id}),n=(0,p().Fq)(o)&&!(0,p().Qx)(null==o?void 0:o.subscription),i=Boolean(null==o||null===(e=o.address)||void 0===e?void 0:e.name),s=(0,m().J)(),c=null==o?void 0:o.provider,l="app_store"===c||"play_store"===c;return t&&s&&n&&!i&&!l}(),C=(0,s().K8)((()=>(0,h().h)(e)),[e]);return(0,o.useEffect)((()=>{r&&(0,n().u)({environment:e,event:{eventName:"missing_name_blur_overlay_displayed",eventProperties:{}}})}),[r,e]),r?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{style:t.content,children:[(0,u().h)(t.lockedIcon),(0,y.jsxs)(l().Y1,{gap:12,children:[(0,y.jsx)("div",{children:C?(0,y.jsx)(g().sA,{defaultMessage:"Access to Notion is limited because we need your billing name",id:"missingNameBlurExperience.missingNameBlurOverlay.messageContent"}):(0,y.jsx)(g().sA,{defaultMessage:"Access to Notion is limited",id:"missingNameBlurExperience.missingNameBlurOverlay.memberMessageContent"})}),(0,y.jsx)("div",{style:t.secondaryMessage,children:C?void 0:(0,y.jsx)(g().sA,{defaultMessage:"Contact a workspace owner to update your workspaceâ€™s billing name",id:"missingNameBlurExperience.missingNameBlurOverlay.memberSecondaryLabel"})})]}),(0,y.jsx)("div",{style:t.buttonWrapper,children:(0,y.jsx)(d().A,{style:{gap:4},size:"lg",onClick:()=>{(0,n().u)({environment:e,event:{eventName:"missing_name_blur_overlay_cta_clicked",eventProperties:{is_workspace_owner:C}}}),C?f().Ow({currentTab:"billing",subtab:"address"}):f().Ow()},children:C?(0,y.jsx)(g().sA,{defaultMessage:"Update billing name",id:"missingNameBlurExperience.missingNameBlurOverlay.buttonLabel"}):(0,y.jsx)(g().sA,{defaultMessage:"View workspace owner",id:"missingNameBlurExperience.missingNameBlurOverlay.memberButtonLabel"})})})]}),(0,y.jsx)("div",{style:t.blurContainer}),(0,y.jsx)("div",{style:t.opacityContainer})]}):null}},773582:(e,t,r)=>{r.d(t,{I:()=>n,O:()=>a});var o=()=>r(143197);function n(e){const{cursors:t,rootStore:r}=e,n={};for(const o of t)for(const e of o.stack)for(const t of e)n[t.id]=t.index;o().A.setLimitParents(r,n)}function a(e){o().A.removeLimitParents(e.rootStore)}},851240:(e,t,r)=>{r.d(t,{A:()=>ie});r(16280),r(944114),r(898992),r(354520),r(672577),r(430670),r(964979),r(814603),r(147566),r(198721);var o=r.n(r(625473)),n=r(296540),a=()=>r(242422),i=()=>r(726637),s=()=>r(17022),c=()=>r(908006),l=()=>r(484714),d=()=>r(56366),u=()=>r(105751),p=()=>r(929219),g=()=>r(165358),f=()=>r(591779),h=()=>r(386164),m=()=>r(388821),v=()=>r(179034),k=()=>r(161479),y=()=>r(449412),C=()=>r(319625),b=()=>r(496603),S=()=>r(763824),_=()=>r(498212),I=()=>r(534177),P=()=>r(787172),w=()=>r(915086),R=()=>r(773582),x=()=>r(466721),M=()=>r(898714),A=()=>r(666144),O=()=>r(614555),L=()=>r(255460),B=()=>r(865454),F=()=>r(374026),j=()=>r(866654),T=()=>r(53798),E=(r(581454),()=>r(700500)),q=()=>r(651124),D=()=>r(519831),V=()=>r(559506),N=()=>r(267584);async function U(e){if(!(0,N().vL)())return;if("all_views"===e.viewType){if(!a().default.checkGate({gateName:"jira_linked_views_resync_on_load"}))return;const t=e.recordMap,r=((null==t?void 0:t.getByTable(D().Vl).filter((({value:e})=>{var t;return(null==e||null===(t=e.value)||void 0===t||null===(t=t.format)||void 0===t?void 0:t.external_collection_type)===q().uO.Jira})))||[]).map((({value:e})=>(null==e?void 0:e.value)&&{id:e.value.parent_id,table:v().ev,spaceId:e.value.space_id})).filter(I().O9);for(const o of r)await V().callApi({eventName:"resyncJiraCollection",environment:e.environment,data:{pagePointer:o}});return}const t=e.pageStore,r=t.getType(),o=t.getFormat();r&&(0,E().Ef)(r)&&(0,N().MP)(null==o?void 0:o.app_config_uri)&&await V().callApi({eventName:"resyncJiraCollection",environment:e.environment,data:{pagePointer:t.pointer}})}var W=()=>r(303626),K=()=>r(865085),z=()=>r(715854),H=()=>r(495074),$=()=>r(406792),G=()=>r(695625),J=()=>r(92136),Q=()=>r(792415),Y=()=>r(765957),X=()=>r(83573),Z=()=>r(961581),ee=()=>r(606932),te=()=>r(865688),re=()=>r(482099);function oe(e){performance.mark(`OPFS:useLoadPage:${e}`)}function ne(e,t,r){return performance.measure(`OPFS:useLoadPage:${e}`,`OPFS:useLoadPage:${t}`,`OPFS:useLoadPage:${r}`)}let ae=!1;function ie(e){return function(e){!function(e){const{pageStore:t,store:r}=e,{initialRequestCompleted:o,error:a}=(0,d().K8)((()=>({initialRequestCompleted:r.state.initialRequestCompleted,error:r.state.error})),[r]);(0,n.useEffect)((()=>{if(o&&!a)return H().A.trackPage(t),()=>{H().A.untrackPage(t)}}),[o,a,t])}(e);const{isCollectionInPage:t,updateIsCollectionInPage:r}=function(){const e=(0,l().v3)(),[t,r]=(0,n.useState)(!1),o=(0,n.useCallback)((r=>{var o;const{page:n,recordMap:a,inMemoryRecordCache:i}=r;if(t)return!0;const s=null===(o=i.getRecord({pointer:{table:"block",id:n.id,spaceId:n.spaceId},userId:e.currentUser.id}))||void 0===o?void 0:o.value;if(s)for(const e of a.getByTable("block")){var c,l,d;if(("collection_view"===(null===(c=e.value)||void 0===c||null===(c=c.value)||void 0===c?void 0:c.type)||"collection_view_page"===(null===(l=e.value)||void 0===l||null===(l=l.value)||void 0===l?void 0:l.type))&&s.parent_id!==(null===(d=e.value)||void 0===d||null===(d=d.value)||void 0===d?void 0:d.collection_id))return!0}return!1}),[e,t]);return{isCollectionInPage:t,updateIsCollectionInPage:(0,n.useCallback)((e=>{r(o(e))}),[o])}}(),o=(0,n.useRef)(null);(function(e){const{store:t,pageStore:r,observer:o}=e,f=(0,l().v3)(),{loading:v,endOfResultsReached:k,initialRequestCompleted:y,error:b}=(0,d().K8)((()=>({loading:t.state.loading,endOfResultsReached:t.state.endOfResultsReached,initialRequestCompleted:t.state.initialRequestCompleted,error:t.state.error})),[t]),_=le(e),R=function(e){const{pageStore:t}=e,r=(0,l().v3)(),o=(0,l().Y0)(),a=K().OPFSBootupRegistry.isEnabled,s=ce(e),c=se(e),d=function(e){const{pageStore:t}=e,r=(0,l().v3)();return(0,n.useCallback)((async e=>{const{request:o,userId:n,abortSignal:a}=e;let i,s;oe("load-opfs-page-cache.start");try{if(K().OPFSBootupRegistry.preProcessFirstChunk){const e=await async function(e){const{userId:t,pageId:r,abortSignal:o}=e,n=(0,z().getOPFSPageCacheInstance)();if(!n)return;if(!p().A.state.online)return;const a=K().OPFSBootupRegistry.getPrefetchedPageRequest(r);if(a&&"hit"===a.status)return{result:a.result,firstChunk:a.firstChunk};if(a&&"miss"===a.status)return{result:void 0,firstChunk:void 0};if(a&&"pending"===a.status){return{result:await a.promise,firstChunk:a.firstChunk}}const i=await n.readBuffer(t,r,o);return{result:i,firstChunk:i.iterator.next().value??void 0}}({userId:n,pageId:o.page.id,abortSignal:a});i=null==e?void 0:e.result,s=null==e?void 0:e.firstChunk}else{var c;const e=await async function(e){const{userId:t,pageId:r,abortSignal:o}=e,n=(0,z().getOPFSPageCacheInstance)();if(!n)return;if(!p().A.state.online)return;const a=K().OPFSBootupRegistry.getPrefetchedPageRequest(r);if(a&&"hit"===a.status)return a.result;if(a&&"miss"===a.status)return;if(a&&"pending"===a.status)return a.promise;return n.readBuffer(t,r,o)}({userId:n,pageId:o.page.id,abortSignal:a});i=e,s=null===(c=i)||void 0===c?void 0:c.iterator.next().value}}catch(b){i=void 0,s=void 0,b instanceof DOMException&&b.name}oe("load-opfs-page-cache.end");ne("load-opfs-page-cache","load-opfs-page-cache.start","load-opfs-page-cache.end");if(null!=a&&a.aborted)throw new Error("Abort signal received");if(!i)throw new Error("No OPFS RecordMap found");if(!i.buffer||0===i.buffer.byteLength)throw new Error("No Valid OPFS RecordMap found");if(!s)throw new Error("Failed to extract first chunk from buffer");const l=m().RecordMapWithRole.create(s);return A()._O({environment:r,inMemoryRecordCache:t.inMemoryRecordCache,recordMap:l,debugSource:"PageLoadingContainer.OPFSPageCache"}),{source:"local",localSource:"opfs",recordMap:l,iterator:i.iterator,metadata:i.metadata,metrics:i.metrics,isLast:1===i.metadata.totalChunks}}),[r,t])}(e),f=le(e);return(0,n.useCallback)((async()=>{const e={page:{id:t.id,spaceId:t.getSpaceId()},cursor:{stack:[]},verticalColumns:Boolean(i().A.isMobile)},n=$().default.mark("required_redirect_metadata_duration"),l=await(0,u().getHtmlStreamQueueEntry)("requiredRedirectMetadata");if(l&&l.pageId===t.id){if(l.requiresRedirect&&l.redirectUrl){$().default.measure(n,{environment:r,data:{requires_redirect:!0,redirect_url:l.redirectUrl}}),(0,re().t)(r);const e=new URL(l.redirectUrl);e.hash||(e.hash=window.location.hash),e.search||(e.search=window.location.search),window.location.href=e.toString(),await new Promise((()=>{}))}}else $().default.measure(n,{environment:r,data:{requires_redirect:!1}});try{return{firstPageChunkResult:await s({request:e,mode:"inMemoryOnly",isFirstChunk:!0})}}catch(b){}if(await(0,u().getHtmlStreamQueueEntry)("serverSidePrefetchDataPending")){const e=await async function(e){const{environment:t,pageId:r}=e,o=await(0,u().getHtmlStreamQueueEntry)("serverSidePrefetchData");if(o&&o.pageId===r){(0,P().s)({environment:t,eventName:"loadCachedPageChunkV2",response:o,userId:t.currentUser.id});const e=m().RecordMapWithRole.create(o.recordMap);return{source:"server",cursors:o.cursors,recordMap:e}}}({environment:r,pageId:t.id});if(e)return{firstPageChunkResult:e}}const p=fe(e),v=p?r.prefetchCache.getPrefetchStatus(p):void 0,k=Boolean(r.defaultRecordCache.persistedRecordCache)&&"success"!==v,y=new AbortController,C=new AbortController,S=new AbortController,_=[];a&&r.currentUser.id&&_.push(d({request:e,userId:r.currentUser.id,abortSignal:S.signal})),k&&_.push(s({request:e,mode:o.isAndroid?"inMemoryAndDiskCache":"inMemoryAndDiskCacheWithInexactPreload",isFirstChunk:!0,abortSignal:y.signal})),_.push(c({request:e,headers:(0,h().WS)({recordId:t.id,spaceId:t.getSpaceId()}),abortSignal:C.signal})),f.concurrentlyWithAsyncRequests();const w=await Promise.any(_);let R="",x="";return"local"===w.source?(R=`${w.source}-${w.localSource} won`,"disk"===w.localSource?(C.abort(R),S.abort(R),x="remoteAbortController, opfsAbortController"):"opfs"===w.localSource&&(y.abort(R),C.abort(R),x="remoteAbortController, diskAbortController")):"remote"===w.source||"remoteV2"===w.source||"server"===w.source?(R=`${w.source} won`,y.abort(R),S.abort(R),x="diskAbortController, opfsAbortController"):(0,I().HB)(w),g().logWithSampleRate({logMessage:{level:"info",from:"useLoadFirstPageChunk",type:"loserAborted",data:{spaceId:t.getSpaceId(),pageId:t.id,userId:r.currentUser.id,reason:R,miscDataToConvertToString:{abortedControllers:x,permissionRole:w.recordMap.getRole({table:"block",id:t.id,spaceId:t.getSpaceId()})}}},samplePercentage:10}),{firstPageChunkResult:w}}),[f,o.isAndroid,s,c,d,t,r,a])}(e),x=function(e){const{pageStore:t}=e,r=(0,l().v3)(),o=ce(e),a=se(e),s=le(e);return(0,n.useCallback)((async e=>{const{firstPageChunkResult:n,dedupeSessionId:c}=e;if(ge(n)){let e=1;const o=n.iterator;let a=o.next();for(;!a.done;){e++;const i=a.value,c=m().RecordMapWithRole.create(i);await A()._O({environment:r,inMemoryRecordCache:t.inMemoryRecordCache,recordMap:c,debugSource:"PageLoadingContainer.OPFSPageCache"}),s.afterEachChunk({source:"local",localSource:"opfs",metadata:n.metadata,metrics:n.metrics,recordMap:c,iterator:o,isLast:n.metadata.totalChunks===e}),a=o.next()}return{chunkCount:n.metadata.totalChunks-1}}{let e=0,r=de(n);for(;r&&r.length>0;){r=(await S().lX(r,10,(async r=>{const l={page:{id:t.id,spaceId:t.getSpaceId()},cursor:r,verticalColumns:Boolean(i().A.isMobile)};let d;try{d="local"===n.source?await o({request:l,mode:"inMemoryAndDiskCache",isFirstChunk:!1}):await a({request:l,headers:(0,h().WS)({cellId:"cellId"in r?r.cellId:void 0}),dedupeSessionId:c})}catch(b){d=pe(n)?{source:"remoteV2",cursors:[],recordMap:m().RecordMapWithRole.create({}),dedupeSessionId:c}:"remote"===n.source?{source:n.source,cursor:{stack:[]},recordMap:m().RecordMapWithRole.create({})}:{source:n.source,localSource:n.localSource,cursor:{stack:[]},recordMap:m().RecordMapWithRole.create({})}}return s.afterEachChunk(d),e++,d}))).flatMap((e=>de(e)??[]))}return{chunkCount:e}}}),[r,s,o,a,t])}(e);if(v||k||y&&b)return;async function M(){t.setState({...t.state,loading:!0}),ee().A.markRequestFirstChunkStart();const e=performance.now();let n,i=!1;Z().A.state.initialRenderCompleted||(i=!0,w().setSubMetric({name:"render_end_to_await_page_chunk_start",startTime:e=>{var t;return null===(t=e.render_start_to_render_end)||void 0===t?void 0:t.endTime},endTime:e}));try{if(n=function(e){if(K().OPFSBootupRegistry.isEnabled){const t=K().OPFSBootupRegistry.getPrefetchedPageRequest(e);if(t&&"hit"===t.status&&t.result&&t.firstChunk){return{source:"local",localSource:"opfs",recordMap:m().RecordMapWithRole.create(t.firstChunk),iterator:t.result.iterator,metadata:t.result.metadata,metrics:t.result.metrics,isLast:1===t.result.metadata.totalChunks}}}}(r.id),n)A()._O({environment:f,inMemoryRecordCache:r.inMemoryRecordCache,recordMap:n.recordMap,debugSource:"PageLoadingContainer.OPFSPageCache"});else{n=(await R()).firstPageChunkResult}}catch(b){return void B(b)}finally{J().y.deletePrefetchPageRequest(r.id)}const s="dedupeSessionId"in n?n.dedupeSessionId:void 0,l="string"==typeof s;if(Z().A.state.initialRenderCompleted||Z().A.setState({...Z().A.state,isDeduplicatingLcpc:l}),!Z().A.state.initialRenderCompleted){w().setSubMetric({name:"await_page_chunk_start_to_await_page_chunk_end",startTime:e=>{var t;return null===(t=e.render_end_to_await_page_chunk_start)||void 0===t?void 0:t.endTime},endTime:performance.now()}),w().updateOPFSMetadata({bootupRegistry:K().OPFSBootupRegistry.opfsBootupRegistryMetadata}),"local"===n.source&&"opfs"===n.localSource&&(w().updateOPFSMetadata({preProcessFirstChunk:K().OPFSBootupRegistry.preProcessFirstChunk}),w().updateOPFSMetricData({get_handle_duration:n.metrics.getHandle,get_file_duration:n.metrics.getFile,load_content_duration:n.metrics.getBuffer,read_duration:n.metrics.total,file_size:n.metrics.fileSize}));const e=f.prefetchCache;w().updateMetricData({page_chunk_source:n.source,local_source:"local"===n.source?n.localSource:void 0,page_chunk_prefetch:"server"===n.source?{type:"hit-server"}:e.getPrefetchAnalytic(`loadCachedPageChunk(${r.id})`)})}const d={chunkSource:n.source,chunkLocalSource:"local"===n.source?n.localSource:void 0,isDeduplicatingLcpc:l};"local"===n.source&&"opfs"===n.localSource&&ee().A.updateOPFSMetrics({get_handle_duration:n.metrics.getHandle,get_file_duration:n.metrics.getFile,load_content_duration:n.metrics.getBuffer,read_duration:n.metrics.total,file_size:n.metrics.fileSize}),ee().A.markRequestFirstChunkEnd(d),"local"===n.source&&"opfs"===n.localSource&&(ee().A.updateOPFSMetadata({preProcessFirstChunk:K().OPFSBootupRegistry.preProcessFirstChunk}),ee().A.updateOPFSMetrics({get_handle_duration:n.metrics.getHandle,get_file_duration:n.metrics.getFile,load_content_duration:n.metrics.getBuffer,read_duration:n.metrics.total})),null==o||o.startRecording(d),O(),a().default.checkGate({gateName:"load_page_flush"})?await c().default.flush():await c().default.afterNextFlush(),_.afterEachChunk(n);let u=1;try{u+=(await x({firstPageChunkResult:n,dedupeSessionId:s})).chunkCount}catch(b){return void B(b)}const p={metricName:"load_all_page_chunks",startTime:e,endTime:performance.now()};L(),_.afterAllChunks({isInitialRender:i,loadAllPageChunksMetric:p,pageChunkSource:n.source,isDeduplicatingLcpc:l,chunkCount:u})}function O(){t.setState({...t.state,initialRequestCompleted:!0})}function L(){t.setState({initialRequestCompleted:!0,ready:!0,loading:!1,endOfResultsReached:!0,error:void 0})}function B(e){t.setState({ready:!0,initialRequestCompleted:!0,loading:!1,endOfResultsReached:!1,error:(0,C().A)(e)})}s().e.withListenerIgnored((()=>{M().finally((()=>{K().OPFSBootupRegistry.deletePrefetchedPageRequest(r.id)}))}))})({...e,updateIsCollectionInPage:r,scrollerRef:o}),function(e){const{store:t,scrollToBlockIds:r,onReady:o,onDone:a,pageStore:i}=e,s=(0,l().v3)();(0,n.useEffect)((()=>{let e;const n=b().Oo((()=>{r&&o&&(e=async function(e,t,r){t&&await L().NH(e,r,t)}(s,r,i))})),l=b().Oo((()=>{o&&c().default.afterNextFlush((()=>{c().default.afterNextFlush((async()=>{if(e){const t=performance.now();await(0,S().Vq)(e,5e3),Z().A.state.initialRenderCompleted||w().updateMetricData({scroll_to_blocks_wait_time:performance.now()-t})}o()}))}))})),d=b().Oo((()=>{null==a||a()})),u=()=>{t.state.loading&&n(),t.state.ready&&l(),(t.state.endOfResultsReached||t.state.error)&&d()};return t.addListener(u),()=>{t.removeListener(u)}}),[a,o,i,r,t,s])}(e),function(e){const{store:t}=e,r=(0,d().K8)((()=>t.state.error),[t]),o=(0,d().O$)(p().e),a=(0,f().ZC)(o),i=void 0!==a&&(o&&!a);(0,n.useEffect)((()=>{i&&r&&t.reset()}),[i,t,r])}(e),function(){const e=(0,l().v3)(),t=(0,d().K8)((()=>{var e;return null===(e=Y().default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.id}),[]),r=(0,d().K8)((()=>Y().default.state.currentUserRootStore),[]),o=(0,d().O$)(p().e),a=(0,f().ZC)(o),i=void 0!==a&&(o&&!a);(0,n.useEffect)((()=>{async function o(){const{route:o}=e.RouterStore.state,n=await M().Ty({environment:e,request:{...o,type:"block-space",blockId:t,spaceId:"spaceId"in o?o.spaceId:void 0,slug:"slug"in o?o.slug:void 0,spaceDomain:"spaceDomain"in o?o.spaceDomain:void 0,requestedOnPublicDomain:"requestedOnPublicDomain"in o?o.requestedOnPublicDomain:void 0,isBot:!1}});if("failed"===n.type)return;const a=n.data;if(Q().A.setState({publicPageData:a}),a.spaceId&&r){const e=r.getSpaceViewStores().find((e=>e.getSpaceId()===a.spaceId));e&&Y().default.setState({...Y().default.state,sidebarSpaceStore:e.getSpaceStore(),sidebarSpaceViewStore:e})}}i&&t&&o()}),[i,e,t,r])}();const{store:v}=e;return(0,d().K8)((()=>({ready:v.state.ready,error:v.state.error,initialRequestCompleted:v.state.initialRequestCompleted,endOfResultsReached:v.state.endOfResultsReached,isCollectionInPage:t,scrollerRef:o})),[v,t,o])}({...e,store:(0,d().uB)(e.store,te().A)})}function se(e){const{pageStore:t}=e,r=(0,l().v3)();return(0,n.useCallback)((async e=>{const{request:o,headers:n,abortSignal:a,dedupeSessionId:i}=e,s=j().JQ(t),c=await j().Vn({environment:r,request:{...o,...s?{omitExistingRecordVersions:s}:{},...i?{dedupeSessionId:i}:{}},abortSignal:a,prefetchCacheKey:fe(o),headers:n});if(null!=a&&a.aborted)throw new Error("Abort signal received");if("success"===c.type){const e=m().RecordMapWithRole.create(c.data.recordMap),t=c.data;return{recordMap:e,cursors:t.cursors,dedupeSessionId:t.dedupeSessionId,source:"remoteV2"}}throw y().O8(c.error,{from:"useLoadRemotePageChunk",type:"pageLoadingError",data:{pageId:t.id,miscDataToConvertToString:{offline:c.offline,status:c.status,body:c.body}}}),new Error("No successful load result found.")}),[r,t])}function ce(e){const{pageStore:t}=e,r=(0,l().v3)();return(0,n.useCallback)((async e=>{const{request:o,mode:n,isFirstChunk:a,abortSignal:i}=e;if("inMemoryOnly"!==n){const e=J().y.getPrefetchPageRequest(o.page.id);if(e&&"hit"===e.status&&e.response)return{source:"local",localSource:"inMemoryOnly"===e.response.mode?"memory":"disk",cursor:e.response.result.cursor,recordMap:m().RecordMapWithRole.create(e.response.result.recordMap)};if(e&&"pending"===e.status){const t=await e.promise;return{source:"local",localSource:"inMemoryOnly"===t.mode?"memory":"disk",cursor:t.result.cursor,recordMap:m().RecordMapWithRole.create(t.result.recordMap)}}}const s=(0,B().L2)(r),c=s.isPreviewingRecord({table:v().ev,id:o.page.id,spaceId:o.page.spaceId},r.currentUser.id);oe("localLoadPageChunk.start");const l=await W().N.measure("localLoadPageChunk",o.page.id,(()=>j().s4({mode:n,environment:r,request:o,isFirstChunk:a,abortSignal:i,inMemoryRecordCache:c?s.getInMemoryRecordCache():void 0})));oe("localLoadPageChunk.end");ne("localLoadPageChunk","localLoadPageChunk.start","localLoadPageChunk.end");if(null!=i&&i.aborted)throw new Error("Abort signal received");const d=m().RecordMapWithRole.create(l.recordMap);return c||A()._O({environment:r,inMemoryRecordCache:t.inMemoryRecordCache,recordMap:d,debugSource:"PageLoadingContainer.performLocalLoadPageChunk"}),{source:"local",localSource:"inMemoryOnly"===n?"memory":"disk",cursor:l.cursor,recordMap:d}}),[r,t])}function le(e){const{pageStore:t,store:r,scrollToDiscussionId:o,scrollerRef:a,scrollToPosition:i,scrollToBlockIds:s,updateIsCollectionInPage:d,pageVisitStore:u,disableSideEffects:p,observer:g}=e,f=(0,l().v3)(),h=(0,n.useCallback)((()=>{p||x().Ds(f,{blockStore:t,pageVisitStore:u,incremental:!1}).catch((()=>{}))}),[p,f,t,u]),m=(0,n.useCallback)((e=>{if(p)return;const n=function(e){return ge(e)?e.isLast:0===de(e).length}(e),l=ge(e)?void 0:de(e);n||c().default.afterNextFlush((()=>{if(r.state.ready)return;const e=!o||(t=o,Boolean((0,F().V)({discussionId:t})));var t;const n=!0===function(e){const{scrollerRef:t,scrollToPosition:r}=e;if(null===t.current)return;const o=(0,T().NM)(t.current);return!o||!b().Et(r)||r<=o.scrollHeight-o.clientHeight}({scrollerRef:a,scrollToPosition:i})&&function(e){return!e||G().T.findSelectablesFromIds(e).length===e.length}(s)&&e;n&&r.setState({...r.state,ready:!0})})),d({page:{id:t.id,spaceId:t.getSpaceId()},recordMap:e.recordMap,inMemoryRecordCache:t.inMemoryRecordCache}),f.currentUser.isLoggedIn()&&(X().A.addFromRecordMapWithRole(e.recordMap),X().A.isEmpty()||O().l({environment:f})),f.currentUser.isLoggedIn()&&U({environment:f,recordMap:e.recordMap,viewType:"all_views"}),l&&R().I({rootStore:t,cursors:l})}),[p,f,t,s,o,i,a,r,d]),v=(0,n.useCallback)((e=>{p||("personal_home_page"!==t.getType()&&async function(e){const{blockPointer:t,environment:r}=e;r.LocalBacklinkStore.initializeBacklinks({block:{id:t.id,spaceId:(0,k().e)(t.spaceId)},currentUserId:r.currentUser.id,environment:r});try{await r.LocalBacklinkStore.awaitLoaded(t.id)}catch(o){}}({environment:f,blockPointer:t.pointer}),f.currentUser.isLoggedIn()&&U({environment:f,pageStore:t,viewType:"collection_view_full_page"}),null==g||g.onLastChunkLoaded(f),$().default.measure(e.loadAllPageChunksMetric,{environment:f,data:{load_type:e.isInitialRender?"initial":"navigation",page_type:t.getType()||"undefined",page_chunk_source:e.pageChunkSource,is_deduplicating_lcpc:e.isDeduplicatingLcpc,chunk_count:1===e.chunkCount?"1":"2_or_more",chunk_count_raw:e.chunkCount}}))}),[p,f,t,g]);return(0,n.useMemo)((()=>({concurrentlyWithAsyncRequests:h,afterEachChunk:m,afterAllChunks:v})),[h,m,v])}function de(e){return pe(e)?e.cursors.filter((e=>!ue(e))):[e.cursor].filter((e=>!ue(e)))}function ue(e){return!e||0===e.stack.length}function pe(e){return"remoteV2"===e.source||"server"===e.source}function ge(e){return"local"===e.source&&"opfs"===e.localSource}function fe(e){if(function(e){return!e.cursor||0===e.cursor.stack.length}(e))return`loadCachedPageChunk(${e.page.id})`;{const t=(0,_().gB)(o()(e.cursor));return`loadCachedPageChunk(${e.page.id})-${t}`}}(0,r(852832).exposeDebugValue)("toggleLogLocalPageLoadFailures",(()=>{ae=!ae,console.info(ae?"Local page load error logging enabled":"Local page load error logging disabled")}))},879526:(e,t,r)=>{r.r(t),r.d(t,{iconDefinition:()=>o,infoCircleFillIcon:()=>n});r(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.26 15.25",svg:(0,r(474848).jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M8.65 8.25a.625.625 0 1 0 0 1.25h.725v3.25H8.65a.625.625 0 1 0 0 1.25h2.7a.625.625 0 1 0 0-1.25h-.725V8.875A.625.625 0 0 0 10 8.25zM10.7 6.3a.8.8 0 1 0-1.6 0 .8.8 0 0 0 1.6 0"})},n=(0,r(340498).wt)("infoCircleFill",o)},885962:(e,t,r)=>{r.d(t,{x:()=>a});var o=()=>r(645873);const n=new(o().O2)("BannersRenderer",(async()=>Promise.all([r.e(75134),r.e(9304),r.e(9773),r.e(36556),r.e(40537),r.e(96346),r.e(92845),r.e(4422),r.e(42660),r.e(58636),r.e(78405),r.e(3165),r.e(31842),r.e(83627),r.e(31276),r.e(25700),r.e(22114),r.e(87403),r.e(29120),r.e(40551),r.e(6346),r.e(87584),r.e(94153)]).then(r.bind(r,601409)))),a=(0,o()._h)(n,(e=>e.BannersRenderer))}}]);