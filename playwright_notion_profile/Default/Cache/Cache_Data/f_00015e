"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[51444],{15154:(e,t,n)=>{n.d(t,{_:()=>i});n(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 13.76 13.76",svg:(0,n(474848).jsx)("path",{d:"M4.75 3.125c-.897 0-1.625.728-1.625 1.625v10.5c0 .898.728 1.625 1.625 1.625H7.5c.897 0 1.625-.727 1.625-1.625V4.75c0-.897-.728-1.625-1.625-1.625zM4.375 4.75c0-.207.168-.375.375-.375H7.5c.207 0 .375.168.375.375v10.5a.375.375 0 0 1-.375.375H4.75a.375.375 0 0 1-.375-.375zM12.5 3.125c-.898 0-1.625.728-1.625 1.625v10.5c0 .898.727 1.625 1.625 1.625h2.75c.898 0 1.625-.727 1.625-1.625V4.75c0-.897-.727-1.625-1.625-1.625zm-.375 1.625c0-.207.168-.375.375-.375h2.75c.207 0 .375.168.375.375v10.5a.375.375 0 0 1-.375.375H12.5a.375.375 0 0 1-.375-.375z"})},i=(0,n(340498).wt)("mediaPause",o)},20604:(e,t,n)=>{n.d(t,{v:()=>si});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(803949),n(581454);var o=n(296540),i=()=>n(564884),r=()=>n(242422),a=()=>n(726637),s=()=>n(787470),l=()=>n(484714),d=()=>n(852507),u=()=>n(118884),c=()=>n(56366),p=()=>n(401497),m=()=>n(998531),f=()=>n(563015),y=()=>n(106714),g=()=>n(239381),h=()=>n(416504),x=()=>n(591779),b=()=>n(201980),v=()=>n(69708),k=()=>n(496603),S=()=>n(973647),I=()=>n(534177),C=()=>n(884107),M=()=>n(749804),w=()=>n(901444),T=()=>n(72159),A=()=>n(862292),j=()=>n(909470),P=()=>n(847743),E=()=>n(557155),B=()=>n(991114),F=()=>n(645873),R=()=>n(346923),D=()=>n(792415),_=()=>n(765957),L=()=>n(178624);class H extends L().R{constructor(){super({key:"formula_assistant_visible",namespace:"formula_editor",important:!0,trackingType:"necessary"})}getIsAssistantVisible(){return this.state??!0}toggleAssistant(){this.setState(!this.getIsAssistantVisible())}}const N=new H;var Y=()=>n(693202),V=()=>n(164891),K=()=>n(158489),z=()=>n(898244),U=()=>n(713998),W=()=>n(638681);const O=W().union([W().object({required:{type:W().literal("formula"),formula:W().string()},optional:{format:W().union([W().literal("number"),W().literal("bar"),W().literal("ring")])},exact:!0}),W().object({required:{type:W().literal("chat"),message:W().string()},optional:{},exact:!0}),W().object({required:{type:W().literal("retry")},optional:{},exact:!0})]);var G=()=>n(388821),$=()=>n(450648),q=()=>n(179034),Q=()=>n(519831),J=()=>n(155792),Z=()=>n(798880),X=()=>n(720665),ee=()=>n(671593),te=()=>n(450859),ne=()=>n(319975),oe=()=>n(231297),ie=()=>n(348869),re=()=>n(594794),ae=()=>n(229552);const{MAX_RECURSION_DEPTH:se,MAX_RECORDS_PER_COLLECTION:le,MAX_TOTAL_COLLECTIONS:de}={MAX_RECURSION_DEPTH:3,MAX_RECORDS_PER_COLLECTION:3,MAX_TOTAL_COLLECTIONS:10};async function ue(e){const{environment:t,collectionStore:n,recordMap:o,collectionModel:i,visitedCollections:r,depth:a=0}=e;if(a>=se||r.has(i.id)||r.size>=de)return;r.add(i.id),o.addModel(i);const s=i.getNormalizedSchema(),l=[],d=[];for(const[m,f]of Object.entries(s))if(f&&"relation"===f.type){const e=(0,z().Nv)(f);if(!e)continue;const t=n.getRecordModel(e);t&&(l.push(m),d.push(t))}const u=await async function(e){const{collectionModel:t,collectionStore:n,environment:o}=e,i=t.getSpaceShardedPointer(),r=await te().mA(o,{source:"assistant",parentRecordStore:n,collectionPointer:i,limit:le});if(S().Q.isFail(r))return[];const a=r.value.blockIds.slice(0,le),s=[];for(const l of a){const e=n.getRecordModel({table:q().ev,id:l});e&&s.push(e)}return s}({collectionModel:i,collectionStore:n,environment:t});for(const m of u)o.addModel(m);const c=function(e){const{blockModels:t,collectionSchema:n,collectionStore:o}=e;if(!t||0===t.length)return[];const i=[];for(const r of t){const e=r.getProperties();for(const[t,r]of Object.entries(n)){if(!r||"person"!==r.type||!e[t])continue;const n=(0,b().Fbh)(e[t]);for(const e of n){const t=o.getRecordModel({table:Z().oo,id:e});t&&i.push(t)}}}return i}({blockModels:u,collectionSchema:s,collectionStore:n});for(const m of c)o.addModel(m);const p=function(e){const{collectionStore:t,relationPropertyIds:n,blockModels:o}=e,i=[];for(const r of o){const e=r.getProperties();for(const t of n){const n=e[t];n&&i.push(...(0,U().n)(n))}}return i.map((e=>t.getRecordModel(e))).filter((e=>void 0!==e))}({collectionStore:n,relationPropertyIds:l,blockModels:u});for(const m of p)o.addModel(m);for(const m of d){if(r.size>=de)break;await ue({environment:t,collectionStore:n,recordMap:o,collectionModel:m,visitedCollections:r,depth:a+1})}}async function ce(e){const{environment:t,spaceId:n,userPrompt:o,formulaErrors:i,existingFormula:r,typecheckContext:a,formulaResult:s,returnType:l}=e,d=G().RecordMap.create(),u={formulas_use_compiler_2:a.featureGates.formulas_use_compiler_2??void 0,formulas_count_function:a.featureGates.formulas_count_function??!1,formula_null_check:a.featureGates.formula_null_check??!1,formula_compiler_diff_rate:0,collection_subitems_restricted_relations:a.featureGates.collection_subitems_restricted_relations??!1,formulas_disabled_functions:a.featureGates.formulas_disabled_functions??[],collection_use_oldest_block_as_cycle_representative:a.featureGates.collection_use_oldest_block_as_cycle_representative??!1};let c;for(const p of a.valueTypes)"block"===p.type.type&&p.type.collection&&(c=p.type.collection.id);if(c){const e={table:Q().Vl,id:c,spaceId:n},o=new(ae().y)(t,e),i=o.getModel();i&&await ue({environment:t,collectionStore:o,recordMap:d,collectionModel:i,visitedCollections:new Set,depth:0})}return[{id:(0,re().Z1)({environment:t,table:J().mS,spaceId:n}),type:"config",value:{type:"formulas",formulaErrors:i,existingFormula:r,valueTypes:a.valueTypes,sourceProperty:a.sourceProperty,collectionFeatureGates:u,formulaResult:s,returnType:l,collectionId:c}},{id:(0,re().Z1)({environment:t,table:J().mS,spaceId:n}),type:"agent-record-map",threadRecordMap:(0,K().he)(d)},{id:(0,re().Z1)({environment:t,table:J().mS,spaceId:n}),type:"user",value:[[o]],userId:t.currentUser.id??""}]}var pe=()=>n(699143),me=()=>n(493552),fe=()=>n(190033),ye=()=>n(108184),ge=()=>n(103975),he=()=>n(921855),xe=()=>n(792540),be=()=>n(949305),ve=()=>n(301421),ke=()=>n(321843),Se=()=>n(329304),Ie=()=>n(135221),Ce=()=>n(710149),Me=()=>n(895432),we=()=>n(712855),Te=()=>n(953418);const Ae=5;function je({scrollableRef:e,environment:t}){const[n,i]=(0,o.useState)(!0),[r,a]=(0,o.useState)(!0),s=(0,o.useCallback)((()=>{const t=e.current;if(!t)return;const n=t.scrollHeight-t.scrollTop-t.clientHeight<Ae;i(n),!n&&r&&a(!1),n&&!r&&a(!0)}),[e,r]);(0,o.useEffect)((()=>{const t=e.current;if(!t)return;t.addEventListener("scroll",s);const n=new MutationObserver((()=>{s(),r&&(t.scrollTop=t.scrollHeight)}));return n.observe(t,{childList:!0,subtree:!0,characterData:!0}),s(),()=>{t.removeEventListener("scroll",s),n.disconnect()}}),[s,e,r]);const l=(0,o.useCallback)(((n="smooth")=>{const o=e.current;o&&Te().VG({element:o,environment:t,options:{top:o.scrollHeight,behavior:n}})}),[e,t]),d=(0,o.useCallback)((()=>{l(),a(!0)}),[l]);return{isScrolledToBottom:n,shouldAutoScroll:r,scrollToBottom:l,scrollToBottomAndSetAutoscroll:d}}var Pe=()=>n(312788),Ee=()=>n(246760),Be=()=>n(765974),Fe=()=>n(284371),Re=()=>n(145214),De=()=>n(285790),_e=()=>n(460292),Le=()=>n(859428),He=n(474848);const Ne=(0,v().YK)({learnMore:{id:"infoBanner.learnMore",defaultMessage:"Learn more"}});function Ye(e){const{navigate:t}=(0,o.useContext)(Pe().E),{upsellMessage:n,isInferenceDown:i}=e,r=(0,l().v3)(),a=(0,v().tz)(),s=(0,o.useMemo)((()=>{if(i)return()=>{t({environment:r,url:"https://www.notion-status.com",openInNew:"tab"})}}),[i,r,t]),d=(0,o.useMemo)((()=>i?(0,He.jsx)(v().sA,{...ke().$.cannotSubmitMessageSeeStatusPage}):n),[i,n]),u=Boolean(n)||i,c=(0,p().IS)((e=>({inlineErrorContainer:{marginBottom:-12,position:"relative",display:"flex",flexDirection:"column",zIndex:-1},inlineError:{backgroundColor:i?e.red.background.primary:e.background.secondary,color:i?e.red.text.primary:e.text.secondary,fontWeight:Fe().Wy.medium,borderStartStartRadius:10,borderStartEndRadius:10,borderEndEndRadius:0,borderEndStartRadius:0,paddingTop:8,paddingInlineEnd:16,paddingBottom:18,paddingInlineStart:16,display:"flex",alignItems:"center",fontSize:"12px",width:"100%",border:"none",justifyContent:"space-between",position:"relative",overflow:"hidden"},inlineErrorContent:{display:"flex",alignItems:"center",gap:8,flex:1},warningIcon:{width:16,height:16,fill:i?e.red.text.primary:e.text.secondary},messageAndInfoWrapper:{display:"flex",alignItems:"center",gap:8,flex:1},inlineErrorText:{textWrap:"pretty"},learnMoreIcon:{fill:i?e.red.text.primary:e.text.secondary},inlineErrorExtension:{position:"absolute",bottom:0,insetInlineStart:0,insetInlineEnd:0,height:32,zIndex:-1}})),[i]),m=(0,o.useMemo)((()=>({visible:u,initial:{opacity:0,translateY:40},animate:{opacity:u?1:0,translateY:u?0:40},exit:{opacity:0,translateY:40},config:{duration:300}})),[u]);return(0,He.jsx)(Re().A,{visible:m.visible,initial:m.initial,animate:m.animate,exit:m.exit,config:m.config,children:(0,He.jsx)("div",{style:c.inlineErrorContainer,children:(0,He.jsxs)("div",{style:c.inlineError,children:[(0,He.jsxs)("div",{style:c.inlineErrorContent,children:[i?(0,Be().exclamationMarkTriangleFillIcon)(c.warningIcon):null,(0,He.jsxs)("div",{style:c.messageAndInfoWrapper,children:[(0,He.jsx)("div",{style:c.inlineErrorText,children:d}),s?(0,He.jsx)(Le().A,{renderTooltip:()=>a.formatMessage(Ne.learnMore),render:e=>(0,He.jsx)(De().A,{onClick:s,icon:()=>(0,He.jsx)(_e().Q,{iconGroup:Ee().G,variantName:"large",colorVariant:"secondary",style:c.learnMoreIcon}),ariaLabel:a.formatMessage(Ne.learnMore),size:"xs",...e})}):void 0]})]}),(0,He.jsx)("div",{style:c.inlineErrorExtension})]})})})}var Ve=()=>n(718827),Ke=()=>n(613601),ze=()=>n(340498),Ue=()=>n(322972),We=()=>n(557943),Oe=()=>n(559506),Ge=()=>n(471995),$e=()=>n(532945),qe=()=>n(687681),Qe=()=>n(623580),Je=()=>n(347063),Ze=()=>n(107683),Xe=()=>n(342461);const et=(0,v().YK)({feedbackModalTitleThumbsDown:{id:"formulaAssistant.feedbackModal.titleThumbsDown",defaultMessage:"How can we improve this result?"},feedbackModalTitleThumbsUp:{id:"formulaAssistant.feedbackModal.titleThumbsUp",defaultMessage:"What was good about this result?"},feedbackModalDescription:{id:"formulaAssistant.feedbackModal.description",defaultMessage:"Your feedback helps Notion AI improve. Your prompt, formula, relevant database information, and feedback will be shared with Notion."},sendFeedbackButton:{id:"formulaAssistant.sendFeedbackButton",defaultMessage:"Send feedback"},feedbackPlaceholder:{id:"formulaAssistant.feedbackPlaceholder",defaultMessage:"Share your feedback"},submitSuccess:{id:"formulaAssistant.submitSuccess",defaultMessage:"Your feedback has been submitted, thanks!"}});function tt(e){const{onSubmit:t,feedbackType:n}=e,i=(0,v().tz)(),[r,a]=(0,o.useState)(""),s=(0,o.useCallback)((()=>{t({feedback:r,submitted:!0}),Ge().D6({label:i.formatMessage(et.submitSuccess)})}),[r,i,t]);return(0,He.jsx)(Je().tf,{header:(0,He.jsx)(Je().YA,{iconAndTitle:(0,He.jsx)("div",{style:{padding:"0 24px"},children:(0,He.jsx)(Je().ZQ,{iconGroup:qe().u,title:i.formatMessage("thumbs_up"===n?et.feedbackModalTitleThumbsUp:et.feedbackModalTitleThumbsDown)})}),description:i.formatMessage(et.feedbackModalDescription)}),footer:(0,He.jsx)(Je().aO,{layout:"vertical",primaryButtons:[{label:i.formatMessage(et.sendFeedbackButton),onClick:s}]}),children:(0,He.jsx)(pe().Y1,{padding:2,children:(0,He.jsx)(Qe().A,{placeholder:i.formatMessage(et.feedbackPlaceholder),textarea:!0,focusAfterAnimation:!0,value:r,onChange:e=>a(e.target.value),textareaSubmitOnEnter:!0,onSubmit:e=>{e.preventDefault(),e.stopPropagation(),s()}})})})}const nt=(0,v().YK)({feedbackSuccess:{id:"formulaInferenceFeedback.success",defaultMessage:"Thank you for your feedback!"}});function ot(e){const{traceId:t,spaceId:n}=e??{},i=(0,c().K8)((()=>t?$e().A.state[t]??void 0:void 0),[t]),r=(0,v().tz)(),a=(0,l().v3)(),s=(0,o.useCallback)((async e=>{if(!t||!n)return;if(void 0===e)return void $e().A.update((e=>({...e,[t]:void 0})));let o="";const i=await async function(e){return await(0,Xe().showAsyncModal)((t=>(0,He.jsx)(Ze().s,{isOpen:t.isOpen,onDismiss:t.onDismiss,onClosed:t.onClosed,areaConstraint:{width:{type:"fixed",length:400}},render:()=>(0,He.jsx)(tt,{onSubmit:t.resolve,feedbackType:e})})))}(e);i&&i.submitted&&(o=i.feedback,$e().A.update((n=>({...n,[t]:e}))),Ge().D6({label:r.formatMessage(nt.feedbackSuccess)}),Oe().callApi({eventName:"saveInferenceTranscriptFeedback",environment:a,data:{spaceId:n,type:"formulas",traceId:t,feedbackType:e,userComment:o}}))}),[a,n,t,r]);return[i,s]}function it(e){const{spaceId:t,traceId:n}=e,[i,r]=ot({spaceId:t,traceId:n}),a=(0,p().IS)((e=>({feedbackButtons:{gap:2,display:"flex",color:e.icon.secondary},thumbsUpIcon:{width:ze().Ev.sm,height:ze().Ev.sm},thumbsDownIcon:{width:ze().Ev.sm,height:ze().Ev.sm,transform:"rotate(180deg)"}})),[]),s=(0,v().tz)(),l=(0,o.useCallback)((()=>{r("thumbs_down"===i?void 0:"thumbs_down")}),[i,r]),d=(0,o.useCallback)((()=>{r("thumbs_up"===i?void 0:"thumbs_up")}),[i,r]);return(0,He.jsxs)("div",{style:a.feedbackButtons,children:[(0,He.jsx)(De().A,{icon:"thumbs_up"===i?Ue().P:We().s,iconStyle:a.thumbsUpIcon,size:"sm",ariaLabel:s.formatMessage({id:"formula.feedback.thumbsUp",defaultMessage:"This formula is helpful"}),onClick:e=>{e.stopPropagation(),d()}}),(0,He.jsx)(De().A,{icon:"thumbs_down"===i?Ue().P:We().s,iconStyle:a.thumbsDownIcon,size:"sm",ariaLabel:s.formatMessage({id:"formula.feedback.thumbsDown",defaultMessage:"This formula is not helpful"}),onClick:e=>{e.stopPropagation(),l()}})]})}var rt=()=>n(102777),at=()=>n(286088),st=()=>n(35392);function lt(e){const t=(0,v().tz)(),{onSubmit:n,canSend:o}=e,i=(0,at().q2)(),r=(0,l().WS)(),a=t.formatMessage({id:"completions.CompletionMenuActionBar.sendTooltip",defaultMessage:"Send to AI"});return(0,He.jsx)(Le().A,{renderTooltip:()=>(0,He.jsxs)("div",{children:[a,(0,He.jsx)(st().A,{style:i.keyboardShortcutInverted,name:"enter"})]}),placement:"bottom",render:e=>(0,He.jsx)(De().A,{icon:rt().b,onClick:n,colorPalette:o?"blue":void 0,colorVariant:o?"accentPrimary":"secondary",disabled:!o,iconStyle:{height:r?24:20,width:r?24:20},ariaLabel:a,style:{pointerEvents:"auto",height:r?24:20,width:r?24:20},...e})})}function dt(e){const{assistantState:t,spaceId:n,canSubmit:o,hasModifiedFormula:i,onStop:r,onBack:a,onRevert:s,onSubmit:l}=e;switch(t.type){case"input":return(0,He.jsxs)(He.Fragment,{children:[i?(0,He.jsx)(mt,{onUndo:s}):void 0,t.latestTraceId?(0,He.jsx)(it,{spaceId:n,traceId:t.latestTraceId}):void 0,(0,He.jsx)(ct,{onSubmit:l,isEnabled:o})]});case"generating":return(0,He.jsx)(ut,{onStop:r});case"refused":return t.isGenerating?(0,He.jsx)(ut,{onStop:r}):(0,He.jsxs)(He.Fragment,{children:[(0,He.jsx)(it,{spaceId:n,traceId:t.latestTraceId}),(0,He.jsx)(pt,{onBack:a})]});case"error":return(0,He.jsxs)(He.Fragment,{children:[(0,He.jsx)(it,{spaceId:n,traceId:t.latestTraceId}),(0,He.jsx)(pt,{onBack:a})]});default:(0,I().HB)(t)}}function ut(e){const{onStop:t}=e,n=(0,v().tz)(),o=(0,p().IS)((e=>({lightweightButton:{display:"flex",alignItems:"center",justifyContent:"center",padding:"2px 6px",borderRadius:6,height:26},cancelText:{fontSize:14,color:e.text.secondary},escText:{textTransform:"uppercase",fontWeight:Fe().Wy.medium,fontSize:11,marginInlineStart:6,color:e.text.tertiary,display:a().A.isMobile?"none":"inline",lineHeight:"normal"}})),[]);return(0,He.jsx)(m().N,{debugName:"FormulaAssistantInput_CancelButton",capture:!a().A.isMobile,onEsc:t,priority:1,children:(0,He.jsx)(pe().Y1,{width:"hug",align:"center",children:(0,He.jsxs)(Ve().Ay,{style:o.lightweightButton,onClick:t,children:[(0,He.jsx)("span",{style:o.cancelText,children:n.formatMessage(ft.cancelText)}),(0,He.jsx)("span",{style:o.escText,children:n.formatMessage(ft.escText)})]})})})}function ct(e){const{isEnabled:t,onSubmit:n}=e;return(0,He.jsx)(pe().Y1,{width:24,height:24,align:"center",style:{marginInlineStart:2},children:(0,He.jsx)(lt,{onSubmit:n,canSend:t})})}function pt(e){const{onBack:t}=e,n=(0,v().tz)(),o=(0,p().IS)((e=>({backButtonStyle:{boxSizing:"border-box",display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",padding:"4px 8px",gap:4,background:a().A.isMobile?e.background.primary:"transparent",boxShadow:a().A.isMobile?e.inputBoxShadow:void 0,border:a().A.isMobile?`1px solid ${e.border.primary}`:void 0,borderRadius:6,cursor:"pointer",fontSize:14,fontWeight:Fe().Wy.medium,lineHeight:"20px",textAlign:"center",color:e.text.secondary,whiteSpace:"nowrap"}})),[]);return(0,He.jsx)(m().N,{debugName:"FormulaAssistantInput_BackButton",capture:!0,onEsc:t,priority:1,children:(0,He.jsx)(Le().A,{renderTooltip:()=>(0,He.jsx)("div",{children:n.formatMessage(ft.backButtonTooltip)}),placement:"bottom",render:e=>(0,He.jsx)(pe().Y1,{width:"hug",height:24,align:"center",children:(0,He.jsx)(Ve().Ay,{style:o.backButtonStyle,onClick:t,...e,children:n.formatMessage(ft.backButton)})})})})}function mt(e){const{onUndo:t}=e,n=(0,v().tz)(),o=(0,p().IS)((e=>({iconStyle:{width:ze().Ev.sm,height:ze().Ev.sm},buttonStyle:{width:24,height:24}})),[]);return(0,He.jsx)(De().A,{colorVariant:"secondary",size:"sm",iconStyle:o.iconStyle,style:o.buttonStyle,onClick:t,ariaLabel:n.formatMessage(ft.undoMessage),icon:Ke().arrowUTurnUpLeftSmallIcon})}const ft=(0,v().YK)({cancelText:{id:"formulaAssistantInput.cancelText",defaultMessage:"Cancel"},escText:{id:"formulaAssistantInput.escText",defaultMessage:"esc"},backButton:{id:"formulaAssistantInput.backMobile",defaultMessage:"Back"},backButtonTooltip:{id:"formulaAssistantInput.backButtonTooltip",defaultMessage:"Press ESC to go back"},undoMessage:{id:"formulaAssistantInput.undo",defaultMessage:"Undo"}}),yt=10,gt=20+2*yt,ht=32,xt=(gt-ht)/2,bt=10,vt=Object.freeze({property:!0});function kt(e){const{assistantState:t,store:n,onSubmit:i,onChange:r,onBlur:a,onFocus:s,onBack:d}=e,u=(0,v().tz)(),c=(0,o.useMemo)((()=>{const e={thinking:[Ct.assistantIsThinking,Ct.assistantIsPondering,Ct.assistantIsReasoning],writing:[Ct.assistantIsWriting,Ct.assistantIsGenerating],fixing:[Ct.assistantIsFixing,Ct.assistantIsRepairing]},t={thinking:e.thinking[Math.floor(Math.random()*e.thinking.length)],writing:e.writing[Math.floor(Math.random()*e.writing.length)],fixing:e.fixing[Math.floor(Math.random()*e.fixing.length)]};return e=>{switch(e){case"thinking":return t.thinking;case"writing":return t.writing;case"fixing":return t.fixing;case"reading-errors":return Ct.assistantIsReadingErrors;default:(0,I().HB)(e)}}}),[]),m=(0,p().IS)((e=>({textContainer:{fontSize:14,lineHeight:"20px",color:e.text.primary,maxHeight:180,overflow:"auto",width:"100%"}})),[]),f=(0,o.useRef)(null);switch(je({scrollableRef:f,environment:(0,l().v3)()}),t.type){case"input":return(0,He.jsx)("div",{ref:f,style:m.textContainer,children:(0,He.jsx)(we().A,{disabled:!1,pasteBehavior:"plaintext",inPageFind:xe().Os.none,store:n,placeholder:u.formatMessage(Ct.assistantPlaceholder),placeholderStyle:{cursor:"text"},disableEnter:!1,onEnter:i,onChange:r,onEsc:a,onBlur:a,onFocus:s,disableRichTextActions:!0,disableSlashCommands:!0,disableEmbedMenu:!0,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableMobileActionBar:!0,disableInsertedDeletedAnnotations:!0,disableSuggestEdit:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disabledMentionTypes:vt})});case"generating":return(0,He.jsxs)(He.Fragment,{children:[(0,He.jsx)(Me().N,{styleKey:"Body/Regular",colorVariant:"secondary",animate:!0,text:u.formatMessage(c(t.generatingStep))}),(0,He.jsx)(Ie().A,{isTriColored:!0})]});case"refused":return(0,He.jsx)(me().D,{styleKey:"Body/Regular",colorVariant:"secondary",onClick:d,children:t.refusalMessage});case"error":return(0,He.jsx)(me().D,{styleKey:"Body/Regular",colorVariant:"secondary",onClick:d,children:u.formatMessage(Ct.genericErrorMessage)});default:(0,I().HB)(t)}}function St(e){const{isLoading:t}=e;return t?(0,He.jsx)(Mt,{}):(0,He.jsx)(It,{...e})}function It(e){const{formulaAssistantStore:t,onStop:n,onSubmit:r,setFormulaValue:a,spaceId:s,currentFormulaTextValue:d,sessionId:u}=e,m=(0,l().v3)(),[f,y]=(0,o.useState)(!1),{store:g}=(0,P().AI)({initialValue:void 0,source:"formula"}),h=(0,c().O$)(t),x=(0,Se()._X)({name:"ai_formulas",spaceId:s,userId:m.currentUser.id,amount:1}),{upsellMessage:b}=(0,be().x)({featureAvailability:x,upgradeRequestAnalyticsEntrypoint:"ai_formulas",upgradeRequestEntrypoint:"ai_formulas",upsellFrom:"ai_formulas",showOptimisticUpsell:!1}),v=null!==h.formulaBeforeLatestRequest&&h.formulaBeforeLatestRequest!==d,k=(0,c().K8)((()=>{var e;const t=null===(e=_().default.state.currentUserStore)||void 0===e?void 0:e.getModel();return!(!t||!ke().R.isInferenceTranscriptConfigTypeDown({configType:"formulas",spaceId:s,actor:t}))}),[s]),S=(0,c().K8)((()=>"input"===h.type&&h.prompt.trim().length>0&&!k&&!b),[h,k,b]),C=(0,o.useCallback)((()=>{requestAnimationFrame((()=>{const e=ve().n.findNodeFromStore(g);e&&(e.focus(),(0,fe().z)({store:g}))}))}),[g]),w=(0,o.useCallback)((()=>{y(!0),C()}),[y,C]),T=(0,o.useCallback)((()=>{y(!1),(0,M().I)({environment:m})}),[y,m]),A=(0,o.useCallback)((()=>{"input"===h.type&&null!==h.formulaBeforeLatestRequest&&(a(h.formulaBeforeLatestRequest),(0,i().u)({environment:m,event:{eventName:"formula_assistant_rejected",eventProperties:{formula_assistant_session_id:u}}}))}),[h,a,m,u]),j=(0,o.useCallback)((()=>{const e=(0,he().r4)(g.getValue(),g);t.setPrompt(e)}),[t,g]),E=(0,o.useCallback)((async()=>{S&&(await r(h.prompt),C(),(0,ye().maybeUpdateAiEligibility)(m,s))}),[h.prompt,S,r,C,s,m]),B=(0,o.useCallback)((()=>{t.resetToInitial(),C()}),[t,C]),F=(0,o.useCallback)((()=>{n(),t.resetToInitial(),C(),(0,i().u)({environment:m,event:{eventName:"formula_assistant_stopped",eventProperties:{formula_assistant_session_id:u,assistant_state:"generating"===h.type?h.generatingStep:void 0}}})}),[n,C,m,u,h,t]),R=(0,p().IS)((e=>({outerContainer:{boxSizing:"border-box",width:"100%",background:e.background.elevated,boxShadow:e.shadowXS,minHeight:gt,borderRadius:bt,position:"relative",paddingInline:8,display:"flex",gap:6},outerContainerFocused:{boxShadow:e.inputBlueFocusRing},buttonContainer:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-end",height:ht,gap:2,marginTop:xt}})),[]),D=(0,c().K8)((()=>{switch(h.type){case"generating":switch(h.generatingStep){case"thinking":return"thinking";case"writing":case"fixing":case"reading-errors":return"writing";default:return(0,I().HB)(h.generatingStep)}case"error":return"error";case"refused":case"input":return"idle";default:(0,I().HB)(h)}}),[h]);return(0,He.jsxs)(pe().Y1,{direction:"vertical",width:"fill",style:{minWidth:0},children:[(0,He.jsx)(Ye,{upsellMessage:b,isInferenceDown:k}),(0,He.jsxs)("div",{style:{...R.outerContainer,...f&&R.outerContainerFocused},tabIndex:0,onFocus:w,children:[(0,He.jsx)(pe().Y1,{width:"hug",height:ht,align:"center",style:{marginTop:xt},children:(0,He.jsx)(ge().M,{variant:"xsmall_plus",highLevelState:D,includeBoxShadow:!0})}),(0,He.jsx)(pe().Y1,{direction:"horizontal",gap:8,width:"fill",align:"center-left",style:{paddingTop:yt,paddingBottom:yt},children:(0,He.jsx)(kt,{assistantState:h,store:g,onBlur:T,onFocus:w,onChange:j,onBack:B,onSubmit:E})}),(0,He.jsx)("div",{role:"button",tabIndex:0,style:R.buttonContainer,onMouseDown:e=>{e.preventDefault()},children:(0,He.jsx)(dt,{assistantState:h,spaceId:s,canSubmit:S,onStop:F,onRevert:A,onBack:B,onSubmit:E,hasModifiedFormula:v})})]})]})}const Ct=(0,v().YK)({assistantPlaceholder:{id:"formulaAssistantInput.assistantPlaceholder",defaultMessage:"Write, fix, or explain a formula..."},assistantIsReadingErrors:{id:"formulaAssistantInput.assistantIsReadingErrors",defaultMessage:"Reading errors"},assistantIsThinking:{id:"formulaAssistantInput.assistantIsThinking",defaultMessage:"Thinking"},assistantIsPondering:{id:"formulaAssistantInput.assistantIsPondering",defaultMessage:"Pondering"},assistantIsReasoning:{id:"formulaAssistantInput.assistantIsReasoning",defaultMessage:"Reasoning"},assistantIsGenerating:{id:"formulaAssistantInput.assistantIsGenerating",defaultMessage:"Generating"},assistantIsWriting:{id:"formulaAssistantInput.assistantIsWriting",defaultMessage:"Writing"},assistantIsFixing:{id:"formulaAssistantInput.assistantIsFixing",defaultMessage:"Fixing"},assistantIsRepairing:{id:"formulaAssistantInput.assistantIsRepairing",defaultMessage:"Repairing"},genericErrorMessage:{id:"formulaAssistantInput.genericErrorMessage",defaultMessage:"Failed to respond. Please try again!"}});function Mt(){const e=(0,p().IS)((e=>({skeletonContainer:{boxSizing:"border-box",width:"100%",background:e.background.elevated,boxShadow:e.shadowXS,borderRadius:bt,position:"relative",paddingInline:8,display:"flex",alignItems:"center",gap:6}})),[]);return(0,He.jsxs)("div",{style:e.skeletonContainer,children:[(0,He.jsx)(pe().Y1,{width:"hug",height:ht,align:"center",children:(0,He.jsx)(Ce().A,{emphasized:!0,style:{width:24,height:24,borderRadius:12}})}),(0,He.jsx)(pe().Y1,{width:"fill",height:gt,align:"center-left",children:(0,He.jsx)(Ce().A,{emphasized:!0,style:{height:14,borderRadius:3,width:"60%"}})}),(0,He.jsx)(pe().Y1,{width:24,height:24,align:"center",children:(0,He.jsx)(Ce().A,{emphasized:!0,style:{width:18,height:18,borderRadius:9}})})]})}var wt=()=>n(757695);class Tt extends wt().Store{constructor(...e){super(...e),this.setPrompt=e=>{this.update((t=>({...t,prompt:e})))},this.startGeneratingState=e=>{this.update((t=>({...t,type:"generating",generatingStep:e})))},this.setTraceId=e=>{this.update((t=>({...t,latestTraceId:e})))},this.setFormulaBeforeLatestRequest=e=>{this.update((t=>({...t,formulaBeforeLatestRequest:e})))},this.updateGeneratingState=e=>{this.update((t=>({...t,generatingStep:e})))},this.resetToInitial=()=>{this.update((e=>({...e,type:"input"})))},this.setRefusalMessage=e=>{this.update((t=>({...t,type:"refused",refusalMessage:e,isGenerating:!0})))},this.setFinalRefusedState=e=>{this.update((t=>({...t,type:"refused",refusalMessage:e,isGenerating:!1})))},this.setError=()=>{this.update((e=>({...e,type:"error"})))}}getInitialState(){return{type:"input",prompt:"",latestTraceId:"",formulaBeforeLatestRequest:null}}}n(18107),n(967357);var At=()=>n(852424),jt=()=>n(247331),Pt=()=>n(66529),Et=()=>n(349835),Bt=()=>n(145076),Ft=()=>n(307663);const Rt={true:{name:"true",type:{type:"checkbox"},description:Bt().Q$.true,examples:[{input:"true"},{input:[(0,Ft().Py)("Checked"),[" == true"]]}]},false:{name:"false",type:{type:"checkbox"},description:Bt().Q$.false,examples:[{input:"false"},{input:[(0,Ft().Py)("Checked"),[" == false"]]}]},and:{name:"and",type:{type:"checkbox"},description:Bt().Q$.and,examples:[{input:"3 > 2 and 2 > 3",output:"false"},{input:[(0,Ft().Py)("Naughty"),[" && "],(0,Ft().Py)("Nice")]}]},or:{name:"or",type:{type:"checkbox"},description:Bt().Q$.or,examples:[{input:"3 > 2 or 2 > 3",output:"true"},{input:[(0,Ft().Py)("Naughty"),[" || "],(0,Ft().Py)("Nice")]}]},not:{name:"not",type:{type:"checkbox"},description:Bt().Q$.not,examples:[{input:"not true",output:"false"},{input:"not (2 > 3)",output:"true"},{input:[["!"],(0,Ft().Py)("Checked")]}]},"+":{name:"+",type:{type:"number"},description:Bt().Q$["+"],examples:[{input:"3 + 2",output:"5"},{input:"add(-1, 2)",output:"1"}]},"-":{name:"-",type:{type:"number"},description:Bt().Q$["-"],examples:[{input:"3 - 2",output:"1"},{input:"subtract(-1, 2)",output:"-3"}]},"*":{name:"*",type:{type:"number"},description:Bt().Q$["*"],examples:[{input:"3 * 2",output:"6"},{input:"multiply(-1, 2)",output:"-2"}]},"/":{name:"/",type:{type:"number"},description:Bt().Q$["/"],examples:[{input:"3 / 2",output:"1.5"},{input:"divide(-1, 2)",output:"-0.5"}]},"%":{name:"%",type:{type:"number"},description:Bt().Q$["%"],examples:[{input:"3 % 2",output:"1"},{input:"mod(-1, 2)",output:"-1"}]},"^":{name:"^",type:{type:"number"},description:Bt().Q$["^"],examples:[{input:"3 ^ 2",output:"9"},{input:"pow(-1, 2)",output:"1"}]},"==":{name:"==",type:{type:"checkbox"},description:Bt().Q$["=="],examples:[{input:"3 == 2",output:"false"},{input:'equal("A", "A")',output:"true"}]},"!=":{name:"!=",type:{type:"checkbox"},description:Bt().Q$["!="],examples:[{input:"3 != 2",output:"true"},{input:'unequal("A", "A")',output:"false"}]},">":{name:">",type:{type:"checkbox"},description:Bt().Q$[">"],examples:[{input:"3 > 2",output:"true"},{input:'now() > parseDate("2040-01-01")',output:"false"}]},"<":{name:"<",type:{type:"checkbox"},description:Bt().Q$["<"],examples:[{input:"3 < 2",output:"false"},{input:'now() < parseDate("2040-01-01")',output:"true"}]},">=":{name:">=",type:{type:"checkbox"},description:Bt().Q$[">="],examples:[{input:"3 >= 2",output:"true"},{input:'now() >= parseDate("2040-01-01")',output:"false"}]},"<=":{name:"<=",type:{type:"checkbox"},description:Bt().Q$["<="],examples:[{input:"3 <= 2",output:"false"},{input:'now() <= parseDate("2040-01-01")',output:"true"}]}};var Dt=()=>n(628048),_t=()=>n(406533),Lt=()=>n(722872),Ht=()=>n(970585),Nt=()=>n(736767),Yt=()=>n(760217),Vt=()=>n(406699),Kt=()=>n(404277),zt=()=>n(939740),Ut=()=>n(45552),Wt=()=>n(89924),Ot=()=>n(338381),Gt=()=>n(67657);const $t=(0,v().YK)({property:{id:"formula2Input.propertyHelper.descriptionGeneric",defaultMessage:"Database property."},titlePropertyDescription:{id:"formulaLibrary.property.title.description",defaultMessage:"Title property."},textPropertyDescription:{id:"formulaLibrary.property.text.description",defaultMessage:"Text property."},urlPropertyDescription:{id:"formulaLibrary.property.url.description",defaultMessage:"URL property."},emailPropertyDescription:{id:"formulaLibrary.property.email.description",defaultMessage:"Email property."},phoneNumberPropertyDescription:{id:"formulaLibrary.property.phoneNumber.description",defaultMessage:"Phone number property."},selectPropertyDescription:{id:"formulaLibrary.property.select.description",defaultMessage:"Select property."},multiSelectPropertyDescription:{id:"formulaLibrary.property.multiSelect.description",defaultMessage:"Multi-select property, list."},statusPropertyDescription:{id:"formulaLibrary.property.status.description",defaultMessage:"Status property."},checkboxPropertyDescription:{id:"formulaLibrary.property.checkbox.description",defaultMessage:"Checkbox property."},datePropertyDescription:{id:"formulaLibrary.property.date.description",defaultMessage:"Date property."},personPropertyDescription:{id:"formulaLibrary.property.person.description",defaultMessage:"Person property, list."},relationPropertyDescription:{id:"formulaLibrary.property.relation.description",defaultMessage:"Relation property, list."},rollupPropertyDescriptionList:{id:"formulaLibrary.property.rollup.description",defaultMessage:"Rollup property, list."},rollupPropertyDescription:{id:"formulaLibrary.property.rollup.descriptionWithList",defaultMessage:"Rollup property."},numberPropertyDescription:{id:"formulaLibrary.property.number.description",defaultMessage:"Number property."},formulaPropertyDescription:{id:"formulaLibrary.property.formula.description",defaultMessage:"Formula property."},formulaPropertyDescriptionList:{id:"formulaLibrary.property.formula.descriptionWithList",defaultMessage:"Formula property, list."},createdTimePropertyDescription:{id:"formulaLibrary.property.createdTime.description",defaultMessage:"Created time property."},lastEditedTimePropertyDescription:{id:"formulaLibrary.property.lastEditedTime.description",defaultMessage:"Last edited time property."},createdByPropertyDescription:{id:"formulaLibrary.property.createdBy.description",defaultMessage:"Created by property."},lastEditedByPropertyDescription:{id:"formulaLibrary.property.lastEditedBy.description",defaultMessage:"Last edited by property."},filePropertyDescription:{id:"formulaLibrary.property.file.description",defaultMessage:"File property, list."},autoincrementIdDescription:{id:"formulaLibrary.property.autoincrementId.description",defaultMessage:"ID property."}}),qt={title:{name:"title",type:{type:"text"},description:$t.titlePropertyDescription,examples:e=>e?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[(0,Ft().Y2)(e),['.style("b")']],isCopyable:!0},{input:[(0,Ft().Py)("Full Name"),['.split(" ").at(0)']]}]:[{input:[(0,Ft().Py)("Title")]},{input:[(0,Ft().Py)("Title"),['.style("b")']]},{input:[(0,Ft().Py)("Name"),['.split(" ").at(0)']]}]},text:{name:"text",type:{type:"text"},description:$t.textPropertyDescription,examples:e=>e?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[["upper("],(0,Ft().Y2)(e),[")"]],isCopyable:!0},{input:[(0,Ft().Y2)(e),['.style("b", "red")']],isCopyable:!0}]:[{input:[["upper("],(0,Ft().Py)("Name"),[")"]]},{input:[(0,Ft().Py)("Name"),['.style("b", "red")']]}]},url:{name:"url",type:{type:"text"},description:$t.urlPropertyDescription,examples:e=>e?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[(0,Ft().Y2)(e),[' ? link("Link", '],(0,Ft().Y2)(e),[').style("green") : ""']],isCopyable:!0}]:[{input:[(0,Ft().Py)("URL"),[' ? link("Link", '],(0,Ft().Py)("URL"),[').style("green") : ""']]}]},email:{name:"email",type:{type:"text"},description:$t.emailPropertyDescription,examples:e=>e?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[(0,Ft().Y2)(e),[' ? link("Email", "mailto:" + '],(0,Ft().Y2)(e),[').style("blue") : ""']],isCopyable:!0}]:[{input:[(0,Ft().Py)("Email"),[' ? link("Email", "mailto:" + '],(0,Ft().Py)("Email"),[').style("blue") : ""']]}]},phone_number:{name:"phone_number",type:{type:"text"},description:$t.phoneNumberPropertyDescription,examples:e=>e?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[(0,Ft().Y2)(e),[' ? link("Call", "tel:" + '],(0,Ft().Y2)(e),[').style("blue") : ""']],isCopyable:!0}]:[{input:[(0,Ft().Py)("Email"),[' ? link("Call", "tel:" + '],(0,Ft().Py)("Email"),[').style("blue") : ""']]}]},number:{name:"number",type:{type:"number"},description:$t.numberPropertyDescription,examples:e=>e?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[(0,Ft().Y2)(e),[" / 2"]],isCopyable:!0},{input:[["pi() * "],(0,Ft().Y2)(e),[" ^ 2"]],isCopyable:!0}]:[{input:[(0,Ft().Py)("Cost"),[" / "],(0,Ft().Py)("Total Units")]},{input:[["pi() * "],(0,Ft().Py)("Radius"),[" ^ 2"]]}]},select:{name:"select",type:{type:"text"},description:$t.selectPropertyDescription,examples:e=>{const t=[{input:[(0,Ft().Py)("Priority"),[' == "High"']]},{input:[['["Feature", "Bug"].includes('],(0,Ft().Py)("Task Type"),[")"]]}];return e&&t.unshift({input:[(0,Ft().Y2)(e)],isCopyable:!0}),t}},multi_select:{name:"select",type:{type:"array",of:{type:"text"}},description:$t.multiSelectPropertyDescription,examples:e=>e?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[(0,Ft().Y2)(e),[".length()"]],isCopyable:!0},{input:[(0,Ft().Py)("Tags"),['.includes("Finance")']]}]:[{input:[(0,Ft().Py)("Tags"),[".length()"]]},{input:[(0,Ft().Py)("Tags"),['.includes("Finance")']]}]},status:{name:"status",type:{type:"text"},description:$t.statusPropertyDescription,examples:e=>"Status"===(null==e?void 0:e.name)?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[(0,Ft().Y2)(e),[' == "Done"']],isCopyable:!0},{input:[['["Not started", "In progress"].includes('],(0,Ft().Y2)(e),[")"]],isCopyable:!0}]:[{input:[(0,Ft().Py)("Status"),[' == "Done"']]},{input:[['["Not started", "In progress"].includes('],(0,Ft().Py)("Status"),[")"]]}]},checkbox:{name:"checkbox",type:{type:"checkbox"},description:$t.checkboxPropertyDescription,examples:e=>e?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[["not "],(0,Ft().Y2)(e)],isCopyable:!0},{input:[(0,Ft().Py)("Signed"),[" and "],(0,Ft().Py)("Sealed"),[" and "],(0,Ft().Py)("Delivered")]}]:[{input:[["not"],(0,Ft().Py)("Done")]},{input:[(0,Ft().Py)("Signed"),[" and "],(0,Ft().Py)("Sealed"),[" and "],(0,Ft().Py)("Delivered")]}]},date:{name:"date",type:{type:"date"},description:$t.datePropertyDescription,examples:e=>e?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[(0,Ft().Y2)(e),[" > now()"]],isCopyable:!0},{input:[(0,Ft().Y2)(e),['.dateAdd(1, "weeks")']],isCopyable:!0},{input:[["dateBetween("],(0,Ft().Y2)(e),[', now(), "days")']],isCopyable:!0}]:[{input:[(0,Ft().Py)("Due Date"),[" > now()"]]},{input:[["formatDate("],(0,Ft().Py)("Date"),[', "YYYY/MM/DD HH:mm")']]},{input:[["dateBetween("],(0,Ft().Py)("Birthday"),[', now(), "days")']]}]},person:{name:"person",type:{type:"array",of:{type:"text"}},description:$t.personPropertyDescription,examples:e=>e?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[(0,Ft().Y2)(e),[".length()"]],isCopyable:!0},{input:[(0,Ft().Y2)(e),[".at(0)"]],isCopyable:!0},{input:[(0,Ft().Y2)(e),[".map(current.email())"]],isCopyable:!0},{input:[(0,Ft().Y2)(e),['.some(current.name() == "Alice")']]}]:[{input:[(0,Ft().Py)("Participants"),[".at(0)"]]},{input:[(0,Ft().Py)("Participants"),[".length()"]]},{input:[(0,Ft().Py)("Participants"),['.some(current.name() == "Alice")']]}]},relation:{name:"relation",type:{type:"array",of:{type:"block"}},description:$t.relationPropertyDescription,examples:e=>e?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[(0,Ft().Y2)(e),[".length()"]],isCopyable:!0},{input:[(0,Ft().Py)("Tasks"),[".filter(current."],(0,Ft().Py)("Status"),[' != "Done")']]}]:[{input:[(0,Ft().Py)("Tasks"),[".length()"]]},{input:[(0,Ft().Py)("Tasks"),[".filter(current."],(0,Ft().Py)("Status"),[' != "Done")']]}]},rollup:{name:"rollup",type:e=>{if("rollup"===(null==e?void 0:e.type)&&("show_unique"===e.aggregation||void 0===e.aggregation))return{type:"array",of:{type:"unknown"}};if(e&&"aggregation"in e&&void 0!==e.aggregation){return{type:(0,Gt().ou)((0,Gt().ZP)(e.aggregation))}}return{type:"unknown"}},description:e=>"rollup"!==(null==e?void 0:e.type)||"show_unique"!==e.aggregation&&void 0!==e.aggregation?$t.rollupPropertyDescription:$t.rollupPropertyDescriptionList,examples:(e,t)=>{let n;return n=!t||"rollup"!==(null==t?void 0:t.type)||"show_unique"!==t.aggregation&&void 0!==t.aggregation?[{input:[(0,Ft().Py)("Average cost"),[" * 12"]]},{input:[(0,Ft().Py)("Sum of customers"),[" > 100"]]}]:[void 0!==e?{input:[(0,Ft().Y2)(e),[".length()"]],isCopyable:!0}:{input:[(0,Ft().Py)("Purchases"),[".length()"]]},{input:[["sum("],(0,Ft().Py)("Purchases"),[".map(current."],(0,Ft().Py)("Cost"),["))"]]}],e&&n.unshift({input:[(0,Ft().Y2)(e)],isCopyable:!0}),n}},file:{name:"file",type:{type:"array",of:{type:"text"}},description:$t.filePropertyDescription,examples:e=>e?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[(0,Ft().Y2)(e),[".length()"]],isCopyable:!0},{input:[(0,Ft().Y2)(e),['.filter(current.match(".pdf$"))']],isCopyable:!0},{input:[(0,Ft().Y2)(e),['.map(link("File", current))']],isCopyable:!0}]:[{input:[(0,Ft().Py)("Attachments"),[".length()"]]},{input:[(0,Ft().Py)("Attachments"),['.filter(current.match(".pdf$"))']]},{input:[(0,Ft().Py)("Attachments"),['.map(link("File", current))']]}]},formula:{name:"formula",type:e=>{var t,n,o;return e&&"formula2"in e&&null!==(t=e.formula2)&&void 0!==t&&null!==(t=t.result_type)&&void 0!==t&&t.type?e.formula2.result_type:e&&"formula"in e&&null!==(n=e.formula)&&void 0!==n&&n.result_type?{type:null===(o=e.formula)||void 0===o?void 0:o.result_type}:{type:"unknown"}},description:e=>{var t;return e&&"formula2"in e&&"array"===(null===(t=e.formula2)||void 0===t||null===(t=t.result_type)||void 0===t?void 0:t.type)?$t.formulaPropertyDescriptionList:$t.formulaPropertyDescription},examples:(e,t)=>{var n,o;let i={type:"unknown"};if(t&&"formula2"in t&&null!==(n=t.formula2)&&void 0!==n&&null!==(n=n.result_type)&&void 0!==n&&n.type)i=t.formula2.result_type;else if(t&&"formula"in t&&null!==(o=t.formula)&&void 0!==o&&o.result_type){var r;i={type:null===(r=t.formula)||void 0===r?void 0:r.result_type}}if(!e)return[];const a=[{input:[(0,Ft().Y2)(e)],isCopyable:!0}];switch(i.type){case"array":switch(a.push({input:[(0,Ft().Y2)(e),[".length()"]],isCopyable:!0}),i.of.type){case"text":a.push({input:[(0,Ft().Y2)(e),['.join("\\n")']],isCopyable:!0});break;case"number":a.push({input:[(0,Ft().Y2)(e),[".sum()"]],isCopyable:!0});break;case"date":a.push({input:[(0,Ft().Y2)(e),['.map(dateBetween(now(), current, "days"))']],isCopyable:!0});break;case"person":a.push({input:[(0,Ft().Y2)(e),[".map(current.name())"]],isCopyable:!0}),a.push({input:[(0,Ft().Y2)(e),[".some(current.name() == 'Alice')"]],isCopyable:!0});break;case"checkbox":a.push({input:[(0,Ft().Y2)(e),[".every(current == true)"]],isCopyable:!0});break;case"block":a.push({input:[(0,Ft().Py)("Primary Tasks"),[".filter(current."],(0,Ft().Py)("Status"),[' == "Done")']]})}break;case"number":a.push({input:[(0,Ft().Y2)(e),[" * 2 > 100"]],isCopyable:!0});break;case"text":a.push({input:[(0,Ft().Y2)(e),[".upper()"]],isCopyable:!0});break;case"date":a.push({input:[(0,Ft().Y2)(e),[" > now()"]],isCopyable:!0});break;case"person":a.push({input:[(0,Ft().Y2)(e),[".name()"]],isCopyable:!0});break;case"checkbox":a.push({input:[["not "],(0,Ft().Y2)(e)],isCopyable:!0});break;case"block":a.push({input:[(0,Ft().Y2)(e),[".map(current."],(0,Ft().pC)(jt().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[")"]]})}return a}},created_time:{name:"created_time",type:{type:"date"},description:$t.createdTimePropertyDescription,examples:e=>e?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[(0,Ft().Y2)(e),['.dateAdd(1, "weeks")']],isCopyable:!0},{input:[(0,Ft().Y2)(e),[' > dateSubtract(now(), 1, "years")']],isCopyable:!0}]:[{input:[(0,Ft().pC)(jt().FormulaTokenSupportedBlockSystemProperty.CreatedTime),['.dateAdd(1, "weeks")']]},{input:[(0,Ft().pC)(jt().FormulaTokenSupportedBlockSystemProperty.CreatedTime),[' > dateSubtract(now(), 1, "years")']]}]},last_edited_time:{name:"last_edited_time",type:{type:"date"},description:$t.lastEditedTimePropertyDescription,examples:e=>e?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[(0,Ft().Y2)(e),['.dateAdd(1, "weeks")']],isCopyable:!0},{input:[(0,Ft().Y2)(e),[' > dateSubtract(now(), 1, "month")']],isCopyable:!0}]:[{input:[(0,Ft().pC)(jt().FormulaTokenSupportedBlockSystemProperty.LastEditedTime),['.dateAdd(1, "weeks")']]},{input:[(0,Ft().pC)(jt().FormulaTokenSupportedBlockSystemProperty.LastEditedTime),[' > dateSubtract(now(), 1, "month")']]}]},created_by:{name:"created_by",type:{type:"person"},description:$t.createdByPropertyDescription,examples:e=>e?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[(0,Ft().Y2)(e),[".name()"]],isCopyable:!0},{input:[(0,Ft().Y2)(e),[".email()"]],isCopyable:!0}]:[{input:[(0,Ft().pC)(jt().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[".name()"]]},{input:[(0,Ft().pC)(jt().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[".email()"]]}]},last_edited_by:{name:"last_edited_by",type:{type:"person"},description:$t.lastEditedByPropertyDescription,examples:e=>e?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[(0,Ft().Y2)(e),[".name()"]],isCopyable:!0},{input:[(0,Ft().Y2)(e),[".email()"]],isCopyable:!0}]:[{input:[(0,Ft().pC)(jt().FormulaTokenSupportedBlockSystemProperty.LastEditedBy),[".name()"]]},{input:[(0,Ft().pC)(jt().FormulaTokenSupportedBlockSystemProperty.LastEditedBy),[".email()"]]}]},auto_increment_id:{name:"auto_increment_id",type:{type:"number"},description:$t.autoincrementIdDescription,examples:e=>e?[{input:[(0,Ft().Y2)(e)],isCopyable:!0},{input:[(0,Ft().Y2)(e),['.split("-").first() /* Prefix */']],isCopyable:!0},{input:[(0,Ft().Y2)(e),['.split("-").last().toNumber() /* ID */']],isCopyable:!0}]:[{input:[(0,Ft().Py)("ID Code")]},{input:[(0,Ft().Py)("Task ID"),['.split("-").first() /* Prefix */']],output:'"TASK"'},{input:[(0,Ft().Py)("Task ID"),['.split("-").last().toNumber() /* ID */']],output:"123"}]},button:null,location:null,last_visited_time:null,verification:null,place:null},Qt={text:{examples:e=>e?[{input:[(0,Ft().HH)({id:e.id})]},{input:[["upper("],(0,Ft().HH)({id:e.id}),[")"]]},{input:[(0,Ft().HH)({id:e.id}),['.style("b", "red")']]}]:[]},number:{examples:e=>e?[{input:[(0,Ft().HH)(e)],isCopyable:!0},{input:[(0,Ft().HH)(e),[" / 2"]],isCopyable:!0},{input:[["pi() * "],(0,Ft().HH)(e),[" ^ 2"]],isCopyable:!0}]:[]},checkbox:{examples:e=>e?[{input:[(0,Ft().HH)(e)]},{input:[["not "],(0,Ft().HH)(e)]}]:[]},date:{examples:e=>e?[{input:[(0,Ft().HH)(e)]},{input:[(0,Ft().HH)(e),[" > now()"]]},{input:[(0,Ft().HH)(e),['.dateAdd(1, "weeks")']]},{input:[["dateBetween("],(0,Ft().HH)(e),[', now(), "days")']]}]:[]},block:{examples:e=>e?[{input:[(0,Ft().HH)(e)]},{input:[(0,Ft().HH)(e),[".format()"]]},{input:[(0,Ft().HH)(e),["."],(0,Ft().pC)(jt().FormulaTokenSupportedBlockSystemProperty.CreatedBy)]}]:[]},person:{examples:e=>e?[{input:[(0,Ft().HH)(e)]},{input:[(0,Ft().HH)(e),[".email()"]]},{input:[(0,Ft().HH)(e),['.name() == "Alice"']]}]:[]},array:{examples:e=>e?[{input:[(0,Ft().HH)(e)]},{input:[(0,Ft().HH)(e),[".length()"]]},{input:[(0,Ft().HH)(e),[".at(0).format()"]]}]:[]},select:null,function:null,unknown:null};var Jt=()=>n(627503),Zt=()=>n(979004),Xt=()=>n(969842),en=()=>n(354584),tn=()=>n(712030),nn=()=>n(267419),on=()=>n(972435),rn=()=>n(141768),an=()=>n(152197);function sn({style:e}){const t=(0,p().IS)((t=>({helper:{display:"flex",flexDirection:"column",fontSize:12,height:"auto",width:"100%",gap:8,overflow:"auto",textWrap:"wrap",...e},nameContainer:{display:"flex",alignItems:"center",fontSize:14,fontWeight:600},skeletonIcon:{width:14,height:14,borderRadius:7,flexShrink:0,marginInlineEnd:6},skeletonName:{height:15,borderRadius:3,width:"40%",marginTop:3,marginBottom:3},skeletonDescription:{height:18,borderRadius:3,width:"30%"},skeletonExample:{height:30.5,borderRadius:5,margin:"0 -4px",padding:"0 6px",border:`1px solid ${t.border.secondary}`,display:"flex",alignItems:"center"},skeletonExampleTextShort:{height:16.5,borderRadius:3,width:"40%"},skeletonExampleTextMedium:{height:16.5,borderRadius:3,width:"60%"},skeletonExampleTextLong:{height:16.5,borderRadius:3,width:"80%"},examples:{display:"flex",flexDirection:"column",gap:4}})),[e]);return(0,He.jsxs)("div",{style:t.helper,children:[(0,He.jsxs)("div",{style:t.nameContainer,children:[(0,He.jsx)(Ce().A,{style:t.skeletonIcon}),(0,He.jsx)(Ce().A,{style:t.skeletonName})]}),(0,He.jsx)(Ce().A,{style:t.skeletonDescription}),(0,He.jsxs)("div",{style:t.examples,children:[(0,He.jsx)("div",{style:t.skeletonExample,children:(0,He.jsx)(Ce().A,{style:t.skeletonExampleTextShort})}),(0,He.jsx)("div",{style:t.skeletonExample,children:(0,He.jsx)(Ce().A,{style:t.skeletonExampleTextMedium})}),(0,He.jsx)("div",{style:t.skeletonExample,children:(0,He.jsx)(Ce().A,{style:t.skeletonExampleTextLong})})]})]})}function ln({infoHelper:e,getRecordModel:t,typecheckContextValues:n,style:o,isLoading:i}){if(i)return(0,He.jsx)(sn,{style:o});const r=e;if(void 0===(null==r?void 0:r.kind))return null;switch(r.kind){case jt().FormulaEditorInfoCompletionKind.Token:return(0,He.jsx)(cn,{completion:r,getRecordModel:t,style:o,typecheckContextValues:n});case jt().FormulaEditorInfoCompletionKind.LibraryFunction:{const n=Boolean(null==e?void 0:e.calledFromUnifiedFunctionProperty),i=function(e,t){if(t&&void 0!==e.syntax[1])return e.syntax[1];return e.syntax[0]}(r.libraryFunction,n),a=function(e,t){if(t&&void 0!==e.examples[1])return e.examples[1];return e.examples[0]}(r.libraryFunction,n),s=r.libraryFunction.returnType;return(0,He.jsx)(un,{icon:wn("function"==typeof s?s([]).type:s.type),name:i,description:(0,He.jsx)(v().sA,{...r.libraryFunction.description,values:{br:(0,He.jsx)("br",{})}}),examples:a.length>0?a.map(((e,n)=>(0,He.jsx)(dn,{example:e,getRecordModel:t},n))):void 0,style:o})}case jt().FormulaEditorInfoCompletionKind.Binding:var a;return r.text===jt().CURRENT_VALUE_NAME?(0,He.jsx)(un,{icon:wn(r.type.type),name:r.text,description:on().A.formatMessage(gn.currentValueDescription),style:o}):r.text===jt().CURRENT_INDEX_NAME?(0,He.jsx)(un,{icon:wn(r.type.type),name:r.text,description:on().A.formatMessage(gn.currentIndexDescription),style:o}):(0,He.jsx)(un,{icon:wn(r.type.type),name:r.text,description:on().A.formatMessage("array"===(null==r||null===(a=r.type)||void 0===a?void 0:a.type)?gn.listVariableType:gn.variableType),style:o});case jt().FormulaEditorInfoCompletionKind.Builtin:{const e=Rt[r.builtin];return(0,He.jsx)(un,{icon:wn(e.type.type),name:e.name,description:on().A.formatMessage(e.description),examples:e.examples.length>0?e.examples.map(((e,n)=>(0,He.jsx)(dn,{example:e,getRecordModel:t},n))):void 0,style:o})}default:return(0,I().HB)(r)}}function dn({example:e,getRecordModel:t,typecheckContextValues:n}){const i=(0,F().fJ)(en().y),s=(0,tn().Ol)(),d=(0,l().v3)(),{device:u}=d,m=(0,an().r)(),f=(0,p().DP)(),y=(0,v().tz)(),g=(0,nn()._)(),x=(0,c().K8)((()=>{var o;const l=document.createElement("div"),c="string"!=typeof e.input?b().q4_(e.input):e.input,p=(null===(o=i.value)||void 0===o?void 0:o.highlight(`${c}`,i.value.languages[Zt().PrismLanguages.notion],Zt().PrismLanguages.notion))??"";l.innerHTML=rn().bi(p);const x=k().oE(Array.from(l.childNodes).map(fn)),v="string"==typeof e.input?[[e.input],[" = "]]:e.input.concat([[" = "]]),S=rn().YH(v,k().oE(x)),I=v.map(b().uPN).map(((e,n)=>(0,Xt().sT)({annotations:e,theme:f,getRecordModel:t,spaceId:m,isSafariOrIOS:u.isSafari||u.isIOS})));return S.map(((e,o)=>{const i=I[e.textTokenIndex],l=v[e.textTokenIndex];return b().qXl(l)?(0,Xt().Au)({args:{textValue:{value:v,spaceId:m},getRecordModel:t,getRecordRole:()=>{},disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disableLinks:!1,userTimeZone:(0,h().P)(),disabled:!1,isAndroid:u.isAndroid,isSafariOrIOS:u.isSafari||u.isIOS,isFirefox:u.isFirefox,isWindows:u.isWindows,showEmojiInline:u.isWindows,emojiType:s,highlightDiscussionId:void 0,theme:f,intl:y,renderedPageBlockId:void 0,parentBlockId:void 0,katex:void 0,isClient:!0,baseUrl:a().A.domainBaseUrl,publicDomainName:a().A.publicDomainName,currentUserId:d.currentUser.id,getPublicBaseUrlForPageOrCollection:void 0,externalIntegrations:[],formulaValueTypes:n??[],emojiData:g,isMobileNative:u.isMobileNative,isMobileNativeExternalLinkFixEnabled:r().default.checkGate({gateName:"mobile_native_external_link_fix"}),displayInUserTimezone:!0},style:i.style,classNames:i.classNames,index:o,token:l,tokenValue:b().N8A(l),tokenAnnotations:b().uPN(l)}):(0,He.jsx)("span",{className:[e.classNames||"",...i.classNames].join(" "),style:i.style,"data-token-index":e.textTokenIndex,children:e.value},o)}))}),[e.input,i.value,f,t,m,u.isAndroid,u.isSafari,u.isFirefox,u.isIOS,u.isWindows,u.isMobileNative,s,y,d.currentUser.id,n,g]),S=(0,c().K8)((()=>Array.isArray(e.output)?(0,Xt().S5)({textValue:{value:e.output,spaceId:m},getRecordModel:t,getRecordRole:()=>{},disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disableLinks:!1,userTimeZone:(0,h().P)(),disabled:!1,isAndroid:u.isAndroid,isSafariOrIOS:u.isSafari||u.isIOS,isFirefox:u.isFirefox,isWindows:u.isWindows,showEmojiInline:u.isWindows,emojiType:s,theme:f,intl:y,katex:void 0,isClient:!0,baseUrl:a().A.domainBaseUrl,publicDomainName:a().A.publicDomainName,currentUserId:d.currentUser.id,getPublicBaseUrlForPageOrCollection:void 0,externalIntegrations:[],formulaValueTypes:[],emojiData:g,isMobileNative:u.isMobileNative,isMobileNativeExternalLinkFixEnabled:r().default.checkGate({gateName:"mobile_native_external_link_fix"}),displayInUserTimezone:!0}):e.output),[u.isAndroid,u.isIOS,u.isSafari,u.isFirefox,u.isWindows,u.isMobileNative,g,s,d.currentUser.id,e.output,t,y,m,f]),I=!1!==e.isCopyable&&("string"==typeof e.input||!0===e.isCopyable),M=(0,o.useCallback)((async()=>{if(I){const n=(Array.isArray(e.input)?(0,$().r4)({intl:y,textValue:e.input,getRecordModel:t,userTimeZone:(0,h().P)()}):e.input).replaceAll(/\/\*.*\*\//g,"").trim();(await C().R.clipboardActions.load()).copyString({stringValue:n,environment:d,copiedMessage:yn.copiedExampleMessage})}}),[d,e.input,t,y,I]),w=(0,p().IS)((e=>({code:{fontFamily:"monospace",whiteSpaceCollapse:"preserve",fontSize:11,borderRadius:5,border:`1px solid ${e.border.secondary}`,margin:"0 -4px",padding:"0 6px",pointerEvents:"none",opacity:.95,display:"flex",flexDirection:"row",alignItems:"center",tabSize:2},left:{flexGrow:1,padding:"6px 0"},right:{alignSelf:"center"},copyButton:{height:22,width:22,pointerEvents:"auto"},copyButtonIcon:{height:ze().Ev.xs,width:ze().Ev.xs}})),[]);return(0,He.jsxs)("div",{style:w.code,dir:"ltr",children:[(0,He.jsxs)("div",{style:w.left,children:[(0,He.jsx)("div",{children:x}),S?(0,He.jsxs)("div",{children:["= ",S]}):null]}),I?(0,He.jsx)("div",{style:w.right,children:(0,He.jsx)(Le().A,{renderTooltip:()=>y.formatMessage(yn.copyToClipboard),render:e=>(0,He.jsx)(De().A,{ariaLabel:y.formatMessage(yn.copyToClipboard),onClick:M,icon:Jt().a,style:w.copyButton,iconStyle:w.copyButtonIcon,disallowTabbing:!0,...e})})}):null]})}function un({name:e,icon:t,description:n,examples:o,style:i}){const r=(0,p().IS)((e=>({helper:{display:"flex",flexDirection:"column",fontSize:12,height:"auto",width:"100%",gap:8,overflow:"auto",textWrap:"wrap",...i},name:{fontSize:14,fontWeight:600,display:"flex",alignItems:"center"},description:{color:e.text.secondary},iconStyle:{height:ze().Ev.sm,width:ze().Ev.sm,fill:e.icon.secondary,display:"inline",marginInlineEnd:6},examples:{display:"flex",flexDirection:"column",gap:4}})),[i]);return(0,He.jsxs)("div",{style:r.helper,children:[(0,He.jsxs)("span",{style:r.name,children:[void 0!==t?t(r.iconStyle):void 0,e]}),void 0!==n?(0,He.jsx)("span",{style:r.description,children:n}):void 0,void 0!==o?(0,He.jsx)("div",{style:r.examples,children:o}):void 0]})}function cn({completion:e,getRecordModel:t,style:n,typecheckContextValues:o}){const{name:i,description:r,icon:a,examples:s}=(0,c().K8)((()=>{if(!t)return{};if(e.token.type===jt().FormulaTokenType.BlockProperty){var n;if((0,g().ix)(e.token))return{};if(jt().FormulaTokenSupportedBlockSystemPropertyList.includes(e.token.property)&&!e.token.collection){var i;const n=null===(i=jt().FormulaTokenSupportedBlockSystemPropertyToType[e.token.property])||void 0===i?void 0:i.type,o=n?At().LE[n]:void 0,r=qt[e.token.property],a="function"==typeof(null==r?void 0:r.description)?r.description():null==r?void 0:r.description,s=e.name??e.token.property;return{name:s,icon:o,description:a?on().A.formatMessage(a):void 0,examples:null!==r?pn(r,t,{collection:e.token.collection,property:e.token.property,name:s},{name:s,type:e.token.property}):void 0}}if(!e.token.collection)return{};const o=(0,g().Yi)(e.token.property),r=t(e.token.collection),a=null==r||null===(n=r.getNormalizedSchema())||void 0===n?void 0:n[o];if(!a)return{};const s=qt[a.type];return s?{name:e.name,icon:At().LE[a.type],description:on().A.formatMessage("function"==typeof s.description?s.description(a):s.description),examples:pn(s,t,{collection:e.token.collection,property:o,name:e.name},a)}:{}}if(e.token.type===jt().FormulaTokenType.ContextValue){const n=(0,g()._H)(o,(0,g().GH)(e.token.valueId));if(!n||n.kind!==jt().FormulaContextValueKind.ContextValue)return{};const i=n.type.type,r=Qt[i];return{name:n.name,description:n.description??n.tooltipName,icon:wn(n.type.type),examples:null!=r&&r.examples?mn(r,t,o,n):void 0}}if(e.token.type===jt().FormulaTokenType.Block||e.token.type===jt().FormulaTokenType.Checkbox||e.token.type===jt().FormulaTokenType.Date||e.token.type===jt().FormulaTokenType.Person)return{};(0,I().HB)(e.token)}),[e.name,e.token,t,o]);return void 0===i?null:(0,He.jsx)(un,{name:i,icon:a,description:r,examples:s,style:n})}function pn(e,t,n,o){const i=e.examples;let r=[];return r="function"==typeof i?i(n,o).map(((e,n)=>(0,He.jsx)(dn,{example:e,getRecordModel:t},n))):i.map(((e,n)=>(0,He.jsx)(dn,{example:e,getRecordModel:t},n))),r.length>0?r:void 0}function mn(e,t,n,o){const i=e.examples;let r=[];return r="function"==typeof i?i(o).map(((e,o)=>(0,He.jsx)(dn,{example:e,getRecordModel:t,typecheckContextValues:n},o))):i.map(((e,o)=>(0,He.jsx)(dn,{example:e,getRecordModel:t,typecheckContextValues:n},o))),r.length>0?r:void 0}function fn(e){return Ot().KH(e)?[e.data]:Ot().vq(e)?[e.textContent||"",e.className]:void 0}const yn=(0,v().YK)({copiedExampleMessage:{id:"formula2Input.helperText.copiedExampleMessage",defaultMessage:"Copied example to clipboard!"},copyToClipboard:{defaultMessage:"Copy to Clipboard",id:"database.copyButton.copyToClipboard"}}),gn=(0,v().YK)({currentValueDescription:{id:"formula2Input.helperText.currentValueDescription",defaultMessage:"Returns the value of the current item in the list function."},currentIndexDescription:{id:"formula2Input.helperText.currentIndexDescription",defaultMessage:"Returns the index of the current item in the list function, starting from 0."},variableType:{id:"formula2Input.variableHelper.description",defaultMessage:"User-defined variable."},listVariableType:{id:"formula2Input.variableHelper.descriptionWithList",defaultMessage:"User-defined variable, list."}}),hn=(0,v().YK)({showDocumentation:{id:"formulas.autocompleteMenu.showDocumentation",defaultMessage:"Show documentation"}}),xn=["generic","conditional","text","number","date","people","list","variable","special"];function bn(){const e=(0,p().IS)((()=>({menu:{top:0,insetInlineStart:0,insetInlineEnd:0,bottom:0,position:"absolute",marginBottom:2},menuSection:{paddingTop:6,paddingBottom:2},sectionTitle:{height:12,borderRadius:3,width:"30%",marginTop:6,marginBottom:a().A.isMobile?12:6,marginInlineStart:8},skeletonIcon:{width:ze().Ev.sm,height:ze().Ev.sm,margin:3,borderRadius:8,flexShrink:0},skeletonTitle:{height:16.8,borderRadius:3,width:"80%"}})),[]);let t;t=a().A.isMobile?{menuType:Lt().gu.Modal,forceFullScreenSlideUp:!0,hideMobileTopbar:!0}:{menuType:Lt().gu.Popup,width:228,minWidth:228,maxWidth:228};const n=[{key:"skeleton-properties",render:t=>(0,He.jsxs)(Wt().A,{...t,style:e.menuSection,disableMobileBorders:!0,children:[(0,He.jsx)(Ce().A,{style:e.sectionTitle}),Array.from({length:a().A.isMobile?6:3},((t,n)=>(0,He.jsx)(Yt().A,{focused:!1,disabled:!0,icon:(0,He.jsx)(Ce().A,{style:e.skeletonIcon}),title:(0,He.jsx)(Ce().A,{style:e.skeletonTitle})},`skeleton-property-${n}`)))]}),items:[]},{key:"skeleton-functions",render:t=>(0,He.jsxs)(Wt().A,{...t,style:e.menuSection,disableMobileBorders:!0,children:[(0,He.jsx)(Ce().A,{style:e.sectionTitle}),Array.from({length:a().A.isMobile?6:3},((t,n)=>(0,He.jsx)(Yt().A,{focused:!1,disabled:!0,icon:(0,He.jsx)(Ce().A,{style:e.skeletonIcon}),title:(0,He.jsx)(Ce().A,{style:e.skeletonTitle})},`skeleton-function-${n}`)))]}),items:[]},{key:"skeleton-functions-2",render:t=>(0,He.jsxs)(Wt().A,{...t,style:e.menuSection,disableMobileBorders:!0,children:[(0,He.jsx)(Ce().A,{style:e.sectionTitle}),Array.from({length:a().A.isMobile?6:3},((t,n)=>(0,He.jsx)(Yt().A,{focused:!1,disabled:!0,icon:(0,He.jsx)(Ce().A,{style:e.skeletonIcon}),title:(0,He.jsx)(Ce().A,{style:e.skeletonTitle})},`skeleton-function-${n}`)))]}),items:[]}];return(0,He.jsx)(Kt().A,{...t,scrollerStyle:e.menu,children:(0,He.jsx)(zt().Ay,{type:zt().Oh.Vertical,initialFocus:0,priority:1,store:(0,c().uB)(void 0,Ht().A),sections:n})})}function vn(e){const{isLoading:t,isAssistantGenerating:n,setInfoHelper:i}=e;return(0,o.useEffect)((()=>{t&&i(void 0)}),[t,n,i]),t?(0,He.jsx)(bn,{}):(0,He.jsx)(kn,{...e})}function kn(e){const{store:t,selection:n,cursorEditorInfo:i,cursorEditorInfoRef:r,context:s,onChange:l,getRecordModel:d,setInfoHelper:u,isAssistantGenerating:m}=e,f=(0,v().tz)(),y=(0,p().IS)((()=>({menu:{top:0,insetInlineStart:0,insetInlineEnd:0,bottom:0,position:"absolute",marginBottom:2},menuSection:{paddingTop:6,paddingBottom:2}})),[]),g=(0,c().uB)(void 0,Ht().A),{sections:h,orderedCompletions:x}=(0,o.useMemo)((()=>{const e=k().$z((null==i?void 0:i.completions)??[],"kind"),o=[],a=[];let c=0;return Object.entries(e).forEach((([e,i])=>{if(e===jt().FormulaEditorInfoCompletionKind.LibraryFunction.toString()){const e={};for(const t of i){const n=t.kind===jt().FormulaEditorInfoCompletionKind.LibraryFunction&&Dt().u_[t.libraryFunction.name]||"generic";e[n]||(e[n]=[]),e[n].push(t)}(0,I().uv)(e).filter((e=>"internal"!==e)).sort(((e,t)=>{const n=xn.indexOf(e),o=xn.indexOf(t);return-1!==n&&-1!==o?n-o:-1!==n?-1:-1!==o?1:e.localeCompare(t)})).forEach((i=>{const p=c++,h=e[i],x=(null==h?void 0:h.map(((e,o)=>{const c=a.length;return a.push(e),{key:`${i}-${o}`,render:t=>(0,He.jsx)(Sn,{...t,completion:e,context:s,getRecordModel:d,menuListStore:g,indexGlobal:c,section:p,indexLocal:o,cursorEditorInfoRef:r,setInfoHelper:u,isAssistantGenerating:m}),action:()=>{var o;m||void 0!==e&&r.current&&(u({...e,calledFromUnifiedFunctionProperty:"member dot receiver"===(null===(o=r.current.completionsInfo)||void 0===o?void 0:o.type)}),An({completion:e,store:t,selection:n,onChange:l,cursorEditorInfo:r.current}))}}})))||[];o.push({key:`function-${i}`,render:e=>(0,He.jsx)(Wt().A,{...e,style:y.menuSection,title:f.formatMessage(Bn[i])}),items:x})}))}else{const p=c++,h=i.map(((o,i)=>{const c=a.length;return a.push(o),{key:`${e}-${i}`,render:e=>(0,He.jsx)(Sn,{...e,completion:o,context:s,getRecordModel:d,menuListStore:g,indexGlobal:c,section:p,indexLocal:i,cursorEditorInfoRef:r,setInfoHelper:u,isAssistantGenerating:m}),action:()=>{var e;m||void 0!==o&&r.current&&(u({...o,calledFromUnifiedFunctionProperty:"member dot receiver"===(null===(e=r.current.completionsInfo)||void 0===e?void 0:e.type)}),An({completion:o,store:t,selection:n,onChange:l,cursorEditorInfo:r.current}))}}}));o.push({key:e,render:t=>(0,He.jsx)(Wt().A,{...t,style:y.menuSection,title:f.formatMessage(Pn[e])}),items:h})}})),{sections:o,orderedCompletions:a}}),[s,null==i?void 0:i.completions,r,d,f,m,g,l,n,u,t,y.menuSection]),b=(0,o.useCallback)((e=>{var t;a().A.isMobile||u({...e,calledFromUnifiedFunctionProperty:"member dot receiver"===(null===(t=r.current)||void 0===t||null===(t=t.completionsInfo)||void 0===t?void 0:t.type)})}),[r,u]),S=(0,o.useCallback)((e=>{if(a().A.isMobile)return;const t=void 0!==e.indexGlobal?x[e.indexGlobal]:void 0;t&&b(t)}),[x,b]),C=(0,c().K8)((()=>g.state.focus.indexGlobal),[g]);let M;return(0,o.useEffect)((()=>{var e,t,n,o;if(a().A.isMobile)return;const r=void 0!==C?x[C]:void 0;if(r)return void b(r);const s="function"===(null==i||null===(e=i.callParameter)||void 0===e||null===(e=e.expression)||void 0===e||null===(e=e.type)||void 0===e?void 0:e.type)?null===(t=i.callParameter.expression)||void 0===t?void 0:t.type:void 0;void 0!==s&&void 0!==(null==i||null===(n=i.callParameter)||void 0===n?void 0:n.parameterIndex)&&(null==i||null===(o=i.callParameter)||void 0===o?void 0:o.parameterIndex)>-1&&u({kind:jt().FormulaEditorInfoCompletionKind.LibraryFunction,libraryFunction:s.libraryFunction,calledFromUnifiedFunctionProperty:s.calledFromUnifiedFunctionProperty})}),[i,C,x,b,u]),(0,o.useEffect)((()=>{h.length>0&&g.update((e=>({focus:{...e,section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})))}),[h.length,g,u]),M=a().A.isMobile?{menuType:Lt().gu.Modal,forceFullScreenSlideUp:!0,hideMobileTopbar:!0}:{menuType:Lt().gu.Popup,width:228,minWidth:228,maxWidth:228},(0,He.jsx)(Kt().A,{...M,scrollerStyle:y.menu,children:(0,He.jsx)(zt().Ay,{type:zt().Oh.Vertical,initialFocus:0,store:g,onKeyboardArrow:S,disableCommandEnter:!0,disableInitialScroll:!0,sections:k().oE([...h,0===h.length&&{key:"no-results",render:e=>(0,He.jsx)(Wt().A,{...e,disableDesktopPadding:!0,style:y.menuSection,children:(0,He.jsx)(Tn,{})}),items:[]}])})})}const Sn=o.forwardRef((function(e,t){const{completion:i,context:r,getRecordModel:s,menuListStore:l,indexGlobal:d,section:u,indexLocal:m,cursorEditorInfoRef:f,setInfoHelper:y,isAssistantGenerating:h,onMouseEnter:x,...b}=e,k=(0,p().IS)((e=>({icon:{width:ze().Ev.sm,fill:e.icon.secondary},mobileQuestionMarkIcon:{width:28,height:28,fill:e.icon.tertiary},lightParentheses:{color:e.text.tertiary},text:{color:h?e.text.secondary:e.text.primary},menuItem:{cursor:h?"default":"pointer",direction:"ltr"}})),[h]),S=(0,o.useCallback)((e=>{a().A.isMobile||l.update((()=>({focus:{indexGlobal:d,indexLocal:m,section:u,footerFocused:!1}}))),null==x||x(e)}),[d,m,u,l,x]),C=e=>{e.preventDefault()},M=(0,c().K8)((()=>l.state.focus.indexGlobal===d),[l,d]),w=(0,v().tz)(),T=(0,o.useMemo)((()=>a().A.isMobile?(0,He.jsx)(Vt().A,{popupType:Vt().z.BottomSheet,renderOrigin:e=>(0,He.jsx)(De().A,{...e,ariaLabel:w.formatMessage(hn.showDocumentation),iconStyle:k.mobileQuestionMarkIcon,style:{width:32,height:32},icon:e=>(0,_t().questionMarkCircleIcon)(e)}),render:e=>{var t;let o;return o=a().A.isMobile?{menuType:Lt().gu.Modal,title:(0,He.jsx)(v().sA,{defaultMessage:"Documentation",id:"database.formulaPropertyEntryMenuItem.title"}),right:(0,He.jsx)(Ut().DoneMenuText,{}),onClickRight:e.close}:{menuType:Lt().gu.Popup},(0,He.jsx)(Kt().A,{...o,children:(0,He.jsx)(Wt().A,{children:(0,He.jsx)(n(678553).Ay,{title:(0,He.jsx)(ln,{infoHelper:{...i,calledFromUnifiedFunctionProperty:"member dot receiver"===(null==f||null===(t=f.current)||void 0===t||null===(t=t.completionsInfo)||void 0===t?void 0:t.type)},getRecordModel:s,style:{padding:4},typecheckContextValues:r.valueTypes,isLoading:!1}),style:{paddingTop:16,paddingBottom:16}})})})}}):(0,He.jsx)(In,{visible:M&&!h})),[i,r.valueTypes,f,s,M,h,k.mobileQuestionMarkIcon,w]),A=(0,c().K8)((()=>{var e;if(i.kind!==jt().FormulaEditorInfoCompletionKind.Token||i.token.type!==jt().FormulaTokenType.BlockProperty||!s)return;if(jt().FormulaTokenSupportedBlockSystemPropertyList.includes(i.token.property))return i.token.property;if((0,g().ix)(i.token)||!i.token.collection)return;const t=(0,g().Yi)(i.token.property),n=s(i.token.collection);return null==n||null===(e=n.getNormalizedSchema())||void 0===e||null===(e=e[t])||void 0===e?void 0:e.type}),[i,s]);if(i.kind===jt().FormulaEditorInfoCompletionKind.Token){if(i.token.type===jt().FormulaTokenType.Checkbox)return null;if(i.token.type===jt().FormulaTokenType.BlockProperty)return(0,He.jsx)(Yt().A,{...b,icon:A?At().LE[A](k.icon):(0,He.jsx)(Cn,{type:"unknown"}),title:(0,He.jsx)("span",{style:k.text,children:i.name??i.token.property}),right:T,onMouseEnter:S,onMouseDown:C,style:k.menuItem,ref:t});if(i.token.type===jt().FormulaTokenType.ContextValue){const e=(0,g().IV)(r.valueTypes,(0,g().GH)(i.token.valueId));return e?(0,He.jsx)(Yt().A,{...b,icon:(0,He.jsx)(Mn,{contextValue:e}),title:(0,He.jsx)("div",{style:{display:"flex"},children:(0,He.jsx)("span",{style:k.text,children:e.name})}),right:T,onMouseEnter:S,style:k.menuItem,ref:t}):null}if(i.token.type===jt().FormulaTokenType.Date)return null;if(i.token.type===jt().FormulaTokenType.Block)return null;if(i.token.type===jt().FormulaTokenType.Person)return null;(0,I().HB)(i.token)}else{if(i.kind===jt().FormulaEditorInfoCompletionKind.LibraryFunction){const e=i.libraryFunction.returnType;return(0,He.jsx)(Yt().A,{...b,icon:(0,He.jsx)(Cn,{type:"function"==typeof e?e([]).type:e.type}),title:(0,He.jsxs)(He.Fragment,{children:[(0,He.jsx)("span",{style:k.text,children:i.libraryFunction.name}),(0,He.jsx)("span",{style:k.lightParentheses,children:"()"})]}),right:T,onMouseEnter:S,style:k.menuItem,ref:t})}if(i.kind===jt().FormulaEditorInfoCompletionKind.Builtin)return(0,He.jsx)(Yt().A,{...b,title:(0,He.jsx)("span",{style:k.text,children:i.builtin}),icon:(0,He.jsx)(Cn,{type:Rt[i.builtin].type.type}),right:T,onMouseEnter:S,style:k.menuItem,ref:t});if(i.kind===jt().FormulaEditorInfoCompletionKind.Binding)return(0,He.jsx)(Yt().A,{...b,title:(0,He.jsx)("span",{style:k.text,children:i.text}),icon:(0,He.jsx)(Cn,{type:i.type.type}),right:T,onMouseEnter:S,style:k.menuItem,ref:t});(0,I().HB)(i)}})),In=o.memo((function({visible:e}){const t=(0,p().IS)((t=>({icon:{width:14,fill:t.icon.secondary,transition:"opacity 50ms 200ms",visibility:e?"visible":"hidden",opacity:e?1:0}})),[e]);return(0,n(871114).o)(t.icon)})),Cn=o.memo((function({type:e}){var t;const n=(0,p().IS)((e=>({icon:{width:ze().Ev.sm,fill:e.icon.secondary,transition:"transform .3s ease"}})),[]);return null===(t=wn(e))||void 0===t?void 0:t(n.icon)}));function Mn(e){const{contextValue:t}=e,o=(0,p().IS)((e=>({stepNumber:{color:e.icon.secondary}})),[]);return(0,I().O9)(t.stepNumberForDisplay)?(0,He.jsx)(n(931077).Q,{size:n(494379).H.Small,number:t.stepNumberForDisplay,style:o.stepNumber}):(0,He.jsx)(Cn,{type:t.type.type})}function wn(e){return"text"===e?At().LE.text:"number"===e?At().LE.number:"checkbox"===e?At().LE.checkbox:"date"===e?At().LE.date:"block"===e?At().LE.relation:"person"===e?At().LE.person:"select"===e?At().LE.select:"array"===e?At().LE.multi_select:"function"===e||void 0===e||"unknown"===e?At().LE.formula:void(0,I().HB)(e)}function Tn(){return(0,He.jsx)(Nt().A,{caption:(0,He.jsx)(v().sA,{defaultMessage:"No results",id:"FormulaAutocompleteMenu.noResults.message"})})}function An(e){var t,n;const{completion:o,store:i,selection:r,onChange:a,cursorEditorInfo:s}=e,l=(null==r?void 0:r.startIndex)||0,d=(null==r?void 0:r.endIndex)||0,u=l!==d,c="member dot receiver"===(null===(t=s.completionsInfo)||void 0===t?void 0:t.type),p=(s.nodePath??[]).at(-1),m=(0,Pt().canAcceptAutocompletionsWithoutDot)({nodeAtPosition:p,dotMemberExpression:c}),f=(null===(n=s.completionsInfo)||void 0===n?void 0:n.prefix)||"",y="overridePrefixLength"in o?o.overridePrefixLength??0:f.length,h=u?l:d-y,x=i.getValue();if(o.kind===jt().FormulaEditorInfoCompletionKind.Token)if(o.token.type===jt().FormulaTokenType.Checkbox);else if(o.token.type===jt().FormulaTokenType.BlockProperty){if((0,g().ix)(o.token))return;const e=(0,b().lzV)(x,h,d),t=o.token.collection?(0,g().Yi)(o.token.property):o.token.property,n=(0,b().wmz)((0,b().ESw)({collection:o.token.collection,property:t,name:o.name})),i=h+(m?1:0)+1;a({newValue:(0,b().xym)(e,m?[["."],n]:[n],h),newSelection:{startIndex:i,endIndex:i}})}else if(o.token.type===jt().FormulaTokenType.ContextValue){const e=(0,b().lzV)(x,h,d),t=(0,g().GH)(o.token.valueId),n=(0,b().wmz)((0,b().CA$)({id:t}));a({newValue:(0,b().xym)(e,m?[["."],n]:[n],h),newSelection:{startIndex:h+1,endIndex:h+1}})}else o.token.type===jt().FormulaTokenType.Date||o.token.type===jt().FormulaTokenType.Block||o.token.type===jt().FormulaTokenType.Person||(0,I().HB)(o.token);else if(o.kind===jt().FormulaEditorInfoCompletionKind.LibraryFunction){var v,k,S;const e=(0,b().lzV)(x,h,d),t=(0,b().Ey_)(`${o.libraryFunction.name}()`,[]),n=(0,b().xym)(e,m?[["."],t]:[t],h);let i=h+o.libraryFunction.name.length+1;m&&(i+=1),void 0===(null===(v=o.libraryFunction)||void 0===v||null===(v=v.parameters)||void 0===v?void 0:v.varargs)&&(null===(k=o.libraryFunction)||void 0===k||null===(k=k.parameters)||void 0===k||null===(k=k.expected)||void 0===k||!k.length||1===(null===(S=o.libraryFunction)||void 0===S||null===(S=S.parameters)||void 0===S||null===(S=S.expected)||void 0===S?void 0:S.length)&&c)&&(i+=1);a({newValue:n,newSelection:{startIndex:i,endIndex:i}})}else if(o.kind===jt().FormulaEditorInfoCompletionKind.Binding||o.kind===jt().FormulaEditorInfoCompletionKind.Builtin){const e=(0,b().lzV)(x,h,d);let t="";o.kind===jt().FormulaEditorInfoCompletionKind.Binding?t=o.text:o.kind===jt().FormulaEditorInfoCompletionKind.Builtin?(t=o.builtin,((null==p?void 0:p.kind)!==Et().NM.Call||c)&&(void 0!==p&&p.kind!==Et().NM.RecoveryNode&&(t=" "+t),t+=" ")):(0,I().HB)(o);const n=(0,b().Ey_)(t,[]),i=(0,b().xym)(e,[n],h),r=h+t.length;a({newValue:i,newSelection:{startIndex:r,endIndex:r}})}else(0,I().HB)(o)}const jn=(0,v().YK)({[jt().FormulaEditorInfoCompletionKind.Token]:{defaultMessage:"Properties",id:"formulaAutocompleteMenu.token.message"},[jt().FormulaEditorInfoCompletionKind.LibraryFunction]:{defaultMessage:"Functions",id:"formulaAutocompleteMenu.function.message"},[jt().FormulaEditorInfoCompletionKind.Binding]:{defaultMessage:"Variables",id:"formulaAutocompleteMenu.variables.message"},[jt().FormulaEditorInfoCompletionKind.Builtin]:{defaultMessage:"Built-ins",id:"formulaAutocompleteMenu.builtin.message"}}),Pn={[jt().FormulaEditorInfoCompletionKind.Token]:jn[jt().FormulaEditorInfoCompletionKind.Token],[jt().FormulaEditorInfoCompletionKind.LibraryFunction]:jn[jt().FormulaEditorInfoCompletionKind.LibraryFunction],[jt().FormulaEditorInfoCompletionKind.Binding]:jn[jt().FormulaEditorInfoCompletionKind.Binding],[jt().FormulaEditorInfoCompletionKind.Builtin]:jn[jt().FormulaEditorInfoCompletionKind.Builtin]},En=(0,v().YK)({conditional:{defaultMessage:"Conditional",id:"formulaAutocompleteMenu.category.conditional.message"},text:{defaultMessage:"Text",id:"formulaAutocompleteMenu.category.text.message"},number:{defaultMessage:"Number",id:"formulaAutocompleteMenu.category.number.message"},date:{defaultMessage:"Date",id:"formulaAutocompleteMenu.category.date.message"},people:{defaultMessage:"People",id:"formulaAutocompleteMenu.category.people.message"},list:{defaultMessage:"List",id:"formulaAutocompleteMenu.category.list.message"},generic:{defaultMessage:"General",id:"formulaAutocompleteMenu.category.generic.message"},variable:{defaultMessage:"Variable",id:"formulaAutocompleteMenu.category.variable.message"},special:{defaultMessage:"Special",id:"formulaAutocompleteMenu.category.special.message"},internal:{defaultMessage:"Internal",id:"formulaAutocompleteMenu.category.internal.message"}}),Bn={conditional:En.conditional,text:En.text,number:En.number,date:En.date,people:En.people,list:En.list,generic:En.generic,variable:En.variable,special:En.special,internal:En.internal};n(823215);var Fn=()=>n(970236),Rn=()=>n(708685),Dn=()=>n(784892),_n=()=>n(971003),Ln=()=>n(968021);const Hn=new(L().R)({key:"formulas_show_structure",namespace:n(553737).Bq,important:!0,trackingType:"preference"});var Nn=()=>n(581369),Yn=()=>n(956394),Vn=()=>n(648747);function Kn({value:e,withComma:t,blockStore:n,formulaSchema:i,renderWrapper:r,shouldTruncate:a,showNestedStructure:s}){const[l,d]=(0,c().K8)((()=>{var t;if(!e)return[[],"text"];if("undefined"===e.type&&s)return[[Yn().Or],"empty"];let o=(0,Vn().O)(e,n.getRecordModel,(0,h().P)());s&&(o=function(e){return e.map((e=>{if("text"===e.type&&e.value){const t=e.value.map((e=>{if((0,b().bHQ)(e)){return[Un((0,b().N8A)(e))]}if((0,b().BEe)(e)){return[Un((0,b().N8A)(e)),e[1]]}return e}));return{...e,value:t}}return e}))}(o));return[o,(null===(t=o[0])||void 0===t?void 0:t.type)??"text"]}),[n.getRecordModel,e,s]),u=(0,p().IS)((e=>({rightBracket:{marginInlineStart:2},leftBracket:{marginInlineEnd:2},comma:{marginInlineEnd:2},formulaPreview:{color:e.text.secondary,fontSize:s?Fe().J.UISmall.desktop:Fe().J.UIRegular.desktop,fontFamily:s?Fe().Tf.githubMono:void 0,display:"inline-flex",alignItems:"center",gap:s?0:6,...a?Fe().RC:{}},typeIndicator:{opacity:.5,marginInlineStart:4,fontSize:8},wrapperDiv:{display:"inline-flex",alignItems:"center",justifyContent:"center",textWrap:"wrap",wordBreak:"break-word"}})),[a,s]);let m;if("array"===e.type)m=(0,He.jsxs)("span",{style:u.formulaPreview,children:[s?(0,He.jsxs)(He.Fragment,{children:[(0,He.jsx)("span",{style:u.leftBracket,children:"["}),e.values.map(((t,o)=>(0,He.jsx)(Kn,{value:t,withComma:o<e.values.length-1,blockStore:n,formulaSchema:i,renderWrapper:!1,shouldTruncate:a,showNestedStructure:s},o))),(0,He.jsx)("span",{style:u.rightBracket,children:"]"}),(0,He.jsx)("span",{style:u.typeIndicator,children:`list(${e.values.length})`})]}):(0,He.jsx)(He.Fragment,{children:e.values.map(((t,o)=>(0,He.jsx)(Kn,{value:t,withComma:o<e.values.length-1,blockStore:n,formulaSchema:i,renderWrapper:!1,shouldTruncate:a,showNestedStructure:s},o)))}),t?(0,He.jsx)("span",{style:u.comma,children:", "}):void 0]});else{const e=t&&!s&&(0,Yn().GL)(d,i);m=null==l?void 0:l.map(((r,l)=>(0,He.jsxs)(o.Fragment,{children:[(0,He.jsxs)("span",{style:u.formulaPreview,children:[(0,He.jsx)(Yn().yZ,{token:r,targetPropertySchema:i,blockStore:n,withComma:e,numberRightAlign:!1,disableLinks:!1,shouldTruncate:a}),s&&zn(r)?(0,He.jsx)("span",{style:u.typeIndicator,children:zn(r)}):null]}),s&&t?(0,He.jsx)("span",{style:u.comma,children:", "}):null]},`${r.id}-${l}`)))}return r?(0,He.jsx)(Yn().Ye,{propertyType:d,rootPropertySchema:i,numberRightAlign:!1,children:m}):(0,He.jsx)("div",{style:u.wrapperDiv,children:m})}function zn(e){switch(e.type){case"text":case"url":case"email":case"phone_number":return`text(${(0,b().AhH)(e.value)})`;case"select":return`text(${e.value})`;case"number":return"num";case"date":return"date";case"checkbox":case"person":case"empty":case"relation":case"file":case"error":return null;default:return(0,I().HB)(e)}}function Un(e){return e.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r")}var Wn=()=>n(252291),On=()=>n(631524),Gn=()=>n(187174),$n=()=>n(324254),qn=()=>n(915019),Qn=()=>n(106628),Jn=()=>n(148832),Zn=()=>n(255043),Xn=()=>n(619133),eo=()=>n(419357),to=()=>n(417392),no=()=>n(125565);const oo=(0,v().YK)({pickPageToPreview:{id:"formulas.editor.pickPageToPreview",defaultMessage:"Preview a pages formula result"},searchPlaceholder:{id:"formulas.editor.searchPlaceholder",defaultMessage:"Search"},noResults:{id:"formulas.editor.noResults",defaultMessage:"No results"},newPage:{id:"formulas.editor.newPage",defaultMessage:"New page"},selectPagePlaceholder:{id:"formulas.editor.selectPagePlaceholder",defaultMessage:"Select a page"}});function io(e,t){const n=e.getModel(),o=!n||n.isEmptyPage(),i=n?e.getProperties():void 0,r=i?(0,he().r4)(i.title,e):"";return{menuTitle:r||t.formatMessage(oo.newPage),icon:(0,He.jsx)(Xn().A,{size:16,isEmptyPage:o,role:"reader"})}}function ro({intl:e,events:t,currentOptionFull:n}){const o=(0,p().IS)((e=>({selectorButton:{padding:4,opacity:1,backgroundColor:"transparent",justifyContent:"flex-start",alignItems:"center",gap:2,fontSize:Fe().J.UISmall.desktop,color:e.text.secondary,fontWeight:500,height:24,maxWidth:200,...Fe().RC},selectorButtonText:{textOverflow:"ellipsis",color:e.text.primary}})),[]);return(0,He.jsxs)(On().p,{...t,style:o.selectorButton,children:[(0,He.jsx)(no().A,{style:o.selectorButtonText,children:n?(0,He.jsx)(Zn().O,{name:n.menuTitle,icon:n.icon,isSmall:!0}):(0,He.jsx)(Zn().O,{name:e.formatMessage(oo.selectPagePlaceholder),isSmall:!0})}),(0,He.jsx)(Wn().I,{icon:$n().arrowChevronSingleDownSmallIcon,size:"xs"})]})}function ao(e){const{setSelectedBlockStore:t,selectedBlockStore:n,menuProps:i,inputProps:r,collectionStore:s}=e,d=(0,l().v3)(),[u,p]=(0,o.useState)(""),m=(0,c().K8)((()=>s.id),[s]),f=(0,c().K8)((()=>s.getSpaceId()),[s]),y=(0,v().tz)(),[{value:g}]=(0,Gn().Yb)((async()=>{if(!m)return{results:[]};const e=await Qn().T.searchActions.load();return await e.searchPagesInCollection({environment:d,query:u,collectionId:m,spaceId:f,excludeTemplates:!0,source:"formula_editor_page_picker",limit:20,includePublicPagesWithoutExplicitAccess:!1,boostRecentlyViewedPages:!0})}),[d,u,m,f],{debounce:300,debugName:"FormulaResultDropdownMenu_searchPages"}),h=(0,c().K8)((()=>g&&s?g.results.map((e=>Jn().B.createChildStore(s,{table:q().ev,id:e}))).filter((e=>null!==e)).map((e=>e)):[]),[g,s]),x=(0,c().K8)((()=>h.map((e=>function(e,t,n,o){const{menuTitle:i,icon:r}=io(t,e);return{key:t.id,keywords:[i],action:()=>{o(t)},render:e=>(0,He.jsx)(qn().A,{store:t,render:o=>(0,He.jsx)("div",{...o,children:(0,He.jsx)(Yt().A,{...e,title:(0,He.jsx)(Zn().O,{name:i,icon:r,isSmall:!0}),shouldWrapCaption:!0,isChecked:(null==n?void 0:n.id)===t.id})}),delayThreshold:0,placement:"right"})}}(y,e,n,t)))),[h,n,t,y]),b=h.length>0,k=(0,c().K8)((()=>n?io(n,y):void 0),[n,y]);return(0,He.jsx)(Vt().A,{popupType:a().A.isMobile?to().nl.BottomSheet:to().nl.Popup,bottomSheetInitialState:a().A.isMobile?"half":void 0,placementToOrigin:"bottom",renderOrigin:e=>(0,He.jsx)(ro,{intl:y,events:e,currentOptionFull:k}),render:e=>{const t=(0,He.jsx)(eo().Ay,{style:{width:"100%",paddingTop:8,paddingBottom:2,marginBottom:8},placeholder:y.formatMessage(oo.searchPlaceholder),onChange:e=>p(e.target.value),value:u,...r});let n;return n=a().A.isMobile?{menuType:Lt().gu.Modal,title:y.formatMessage(oo.pickPageToPreview),right:(0,He.jsx)(Ut().DoneMenuText,{}),onClickRight:()=>e.close(),minWidth:260,header:(0,He.jsx)(Wt().A,{children:t}),...i}:{menuType:Lt().gu.Popup,width:260,maxHeight:240,header:t,...i},(0,He.jsx)(Kt().A,{...n,children:b?(0,He.jsx)(zt().Ay,{type:zt().Oh.Vertical,sections:[{key:"dropdown.menuList",render:e=>(0,He.jsx)(Wt().A,{...e}),items:x}],initialFocus:0,onAccept:(t,n)=>{t.action(n),e.close()},style:{fontSize:a().A.isMobile?16:void 0,marginBottom:a().A.isMobile?16:void 0}}):(0,He.jsx)(pe().Y1,{padding:8,children:(0,He.jsx)(no().A,{isSmall:!0,children:y.formatMessage(oo.noResults)})})})}})}function so({isLoading:e,shouldShowErrors:t,debouncedErrorMessagesWithRange:n,formulaResult:o,returnType:i,formulaSchema:r,collectionStore:a,selectedBlockStore:s,setSelectedBlockStore:l}){const d=(0,p().IS)((e=>({outputContainerWrapper:{display:"flex",flexDirection:"column",zIndex:1,width:"100%",textWrap:"nowrap",gap:8,padding:16,borderTop:`1px solid ${e.border.primary}`},contentContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"center",zIndex:1,minHeight:24,width:"100%",gap:4},headerContainer:{display:"flex",flexDirection:"row",alignItems:"center",gap:2,opacity:.8,minHeight:24}})),[]);return(0,He.jsxs)("div",{style:d.outputContainerWrapper,children:[(0,He.jsx)("div",{style:d.headerContainer,children:e?(0,He.jsx)(go,{showDropdown:void 0!==a}):(0,He.jsx)(uo,{collectionStore:a,selectedBlockStore:s,setSelectedBlockStore:l})}),(0,He.jsx)("div",{style:d.contentContainer,children:e?(0,He.jsx)(yo,{}):(0,He.jsx)(lo,{selectedBlockStore:s,shouldShowErrors:t,debouncedErrorMessagesWithRange:n,formulaResult:o,returnType:i,formulaSchema:r})})]})}function lo({selectedBlockStore:e,shouldShowErrors:t,debouncedErrorMessagesWithRange:n,formulaResult:i,returnType:r,formulaSchema:a}){const s=(0,p().IS)((e=>({outputContainer:{display:"flex",justifyContent:"space-between",gap:6,position:"relative",width:"100%",overflow:"hidden"},badgeStyle:{display:"flex",height:20,padding:"2px 5px",justifyContent:"center",alignItems:"center",borderRadius:6,background:e.gray.background.secondaryTranslucent,marginInlineStart:0}})),[]),l=(0,v().tz)(),d=l.formatMessage({id:"formulas.editor.type",defaultMessage:"Type: "}),u=l.formatMessage({id:"formulas.editor.valid",defaultMessage:"Valid"}),c=(0,o.useMemo)((()=>r?(0,Rn().getHumanReadableType)(r):Bt().qY.unknown),[r]);return t?n.length>0?(0,He.jsx)(mo,{errorMessagesWithRange:n}):(0,He.jsx)(yo,{}):(0,He.jsxs)("div",{style:s.outputContainer,children:[e&&a?(0,He.jsx)(co,{formulaResult:i,formulaSchema:a,selectedBlockStore:e}):(0,He.jsx)("div",{children:(0,He.jsx)(me().D,{as:"span",styleKey:"Body/Regular",colorPalette:"green",colorVariant:"secondary",children:u})}),(0,He.jsx)(Fn().E,{content:(0,He.jsxs)(me().D,{styleKey:"Caption/Regular",colorVariant:"secondary",children:[d,(0,He.jsx)(v().sA,{...c})]}),style:s.badgeStyle})]})}function uo({collectionStore:e,selectedBlockStore:t,setSelectedBlockStore:n}){const o=(0,v().tz)(),i=o.formatMessage({id:"formulas.editor.syntaxValidation",defaultMessage:"Syntax validation"}),r=o.formatMessage({id:"formulas.editor.previewWith",defaultMessage:"Preview with"}),a=(0,p().IS)((()=>({headerContent:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",gap:8},leftSection:{display:"flex",alignItems:"center",gap:2}})),[]);return(0,He.jsxs)("div",{style:a.headerContent,children:[(0,He.jsxs)("div",{style:a.leftSection,children:[(0,He.jsx)(me().D,{styleKey:"Caption/Medium",colorVariant:"secondary",children:e?r:i}),e?(0,He.jsx)(ao,{selectedBlockStore:t,setSelectedBlockStore:n,collectionStore:e}):void 0]}),e?(0,He.jsx)(ho,{}):void 0]})}function co({formulaResult:e,formulaSchema:t,selectedBlockStore:n}){const i=(0,v().tz)().formatMessage({id:"formulas.editor.empty",defaultMessage:"No output"}),r=(0,c().K8)((()=>function e(t){if(!t||"undefined"===t.type)return!0;if("text"===t.type){return 0===(0,he().r4)(t.value,n).trim().length}return"array"===t.type&&(0===t.values.length||t.values.every(e))}(e)),[e,n]),a=(0,c().K8)((()=>Hn.state??!1),[]),s=(0,o.useMemo)((()=>({baseStyles:{sizing:"small",tokenFormat:Dn().NY.Medium,tokenWrapStyle:{display:"flex",flexWrap:"wrap",overflow:"hidden",...Ln().Cn[Dn().NY.Medium]},textStyle:{overflow:"hidden"}},store:n,isEmptyStore:wt().Store.createValue(!1),canEdit:!1,disabled:!1,shouldRenderTooltip:!0,shouldWrap:!0,collectionContextStore:void 0,templateVariableContext:void 0,property:void 0,propertyFormat:void 0,propertySchema:t,trackEditBlockProperty:()=>{},surface:"table",containerRef:null,collectionSchemaStore:wt().Store.createValue(void 0)})),[n,t]);return!e||r?(0,He.jsx)("div",{children:(0,He.jsx)(me().D,{as:"span",styleKey:"Body/Regular",colorVariant:"tertiary",children:i})}):(0,He.jsx)("div",{style:{maxWidth:"100%",position:"relative",overflow:"hidden",display:"flex",alignItems:"center",gap:8},children:(0,He.jsx)(_n().L8.Provider,{value:s,children:(0,He.jsx)(Kn,{showNestedStructure:a,value:e,withComma:!1,blockStore:n,formulaSchema:t,renderWrapper:!0,shouldTruncate:!0})})})}const po=a().A.isMobile?2:3;function mo({errorMessagesWithRange:e}){return(0,He.jsx)(He.Fragment,{children:e.slice(0,po).map(((e,t)=>(0,He.jsx)(fo,{errorMessageWithRange:e},t)))})}function fo({errorMessageWithRange:e}){const{msg:t,range:n}=e,o=n?` [${n.startIndex},${n.endIndex}]`:"";return(0,He.jsxs)("div",{children:[(0,He.jsx)(me().D,{as:"span",styleKey:"Body/Regular",colorPalette:"red",colorVariant:"accentPrimary",children:t}),(0,He.jsx)(me().D,{as:"span",styleKey:"Body/Regular",colorPalette:"red",colorVariant:"secondary",children:o})]})}function yo(){const e=(0,p().IS)((e=>({outputContainer:{display:"flex",justifyContent:"space-between",gap:6,position:"relative",width:"100%",overflow:"hidden"},lineContainer:{display:"flex",alignItems:"center",justifyContent:"center",width:"50%"},lineSkeleton:{height:16,borderRadius:4,flex:1},badgeSkeleton:{height:20,width:80,borderRadius:6}})),[]);return(0,He.jsxs)("div",{style:e.outputContainer,children:[(0,He.jsx)("div",{style:e.lineContainer,children:(0,He.jsx)(Ce().A,{style:e.lineSkeleton})}),(0,He.jsx)(Ce().A,{style:e.badgeSkeleton})]})}function go({showDropdown:e}){const t=(0,p().IS)((e=>({headerContainer:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",gap:8,opacity:.8,height:24},leftSection:{display:"flex",alignItems:"center",gap:2},textSkeleton:{height:14,width:80,borderRadius:4},dropdownSkeleton:{height:16,width:80,borderRadius:6},advancedModeContainer:{display:"flex",alignItems:"center",gap:6},toggleSkeleton:{height:16,width:32,borderRadius:8},advancedModeLabelSkeleton:{height:16,width:90,borderRadius:4}})),[]);return(0,He.jsxs)("div",{style:t.headerContainer,children:[(0,He.jsxs)("div",{style:t.leftSection,children:[(0,He.jsx)(Ce().A,{style:t.textSkeleton}),e?(0,He.jsx)(Ce().A,{style:t.dropdownSkeleton}):void 0]}),e?(0,He.jsxs)("div",{style:t.advancedModeContainer,children:[(0,He.jsx)(Ce().A,{style:t.toggleSkeleton}),(0,He.jsx)(Ce().A,{style:t.advancedModeLabelSkeleton})]}):void 0]})}function ho(){const e=(0,c().K8)((()=>Hn.state??!1),[]),t=(0,v().tz)().formatMessage({id:"formulas.editor.showTypes",defaultMessage:"Show types"}),n=(0,p().IS)((()=>({toggleContainer:{display:"flex",alignItems:"center",gap:6}})),[]);return(0,He.jsxs)("div",{style:n.toggleContainer,children:[(0,He.jsx)(Nn().A,{on:e,onClick:()=>{Hn.setState(!e)},"aria-label":t}),(0,He.jsx)(me().D,{styleKey:"Caption/Regular",colorVariant:"secondary",children:t})]})}var xo=()=>n(160432),bo=()=>n(251057),vo=()=>n(232930);const ko=(0,v().YK)({undoMessage:{defaultMessage:"Undo",id:"database.formula.undoFormulaInput.tooltip"},doneHint:{defaultMessage:"Close",id:"database.formula.closeFormulaInput.tooltip"},cancel:{defaultMessage:"Cancel",id:"formulas.formulaInputHeader.cancel"},close:{id:"formula2Input.close",defaultMessage:"Done"},save:{id:"formula2Input.save",defaultMessage:"Save"},formulaHeader:{id:"formula2Input.EditFormula",defaultMessage:"Edit formula"},learnTooltip:{id:"formula2Input.learnAboutFormulas",defaultMessage:"Learn about formulas!"},discardAllChanges:{id:"formula2Input.discardAllChanges",defaultMessage:"Discard all changes"},revertTooltip:{id:"formula2Input.revertTooltip",defaultMessage:"Reverts to the original formula when first opened."},startLoading:{id:"formula2Input.startLoading",defaultMessage:"Start loading"},stopLoading:{id:"formula2Input.stopLoading",defaultMessage:"Stop loading"}});function So(e){const{disabled:t,onClickCancel:n,onClickRevert:o,onClickClose:i,onClickUndo:r,setIsLoading:s,autosave:l=!0,isEdited:d=!1}=e,u=(0,p().IS)((e=>({headerRow:{display:"flex",flexDirection:"row",alignItems:"center",paddingTop:0,paddingInlineEnd:0,paddingBottom:0,paddingInlineStart:6,gap:3,height:24,flex:"none",flexGrow:1}})),[]);return(0,He.jsxs)(pe().Y1,{direction:"horizontal",style:u.headerRow,children:[n&&!t&&a().A.isMobile?(0,He.jsxs)(He.Fragment,{children:[(0,He.jsx)(pe().Y1,{width:"hug",children:(0,He.jsx)(Io,{onClick:n})}),(0,He.jsx)(pe().Y1,{width:"fill"})]}):(0,He.jsx)(pe().Y1,{width:"hug",children:(0,He.jsx)(Mo,{setIsLoading:s})}),(0,He.jsx)(pe().Y1,{width:"fill"}),(0,He.jsxs)(pe().Y1,{width:"hug",direction:"horizontal",gap:6,align:"center-right",children:[r&&!t?(0,He.jsx)(wo,{onClick:r}):void 0,o&&!t?(0,He.jsx)(To,{onClick:o}):void 0,(0,He.jsx)(Co,{onClick:i,autosave:l,isEdited:d})]})]})}function Io(e){const{onClick:t}=e,n=(0,v().tz)();return(0,He.jsx)(On().p,{colorPalette:"gray",size:"sm",onClick:t,children:n.formatMessage(ko.cancel)})}function Co(e){const{onClick:t,autosave:n=!0,isEdited:o=!1}=e,i=(0,v().tz)(),r=(0,l().v3)(),a=(0,p().IS)((e=>({doneButton:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",padding:8,gap:6,width:52,height:28,borderRadius:6,flex:"none",flexGrow:0},doneButtonCommandHint:{color:e.text.inverseSecondary}})),[]);return(0,He.jsx)(Le().A,{renderTooltip:()=>(0,He.jsxs)("span",{children:[i.formatMessage(ko.doneHint)," ",(0,He.jsx)("span",{style:a.doneButtonCommandHint,children:(0,bo()._w)({environment:r}).esc})]}),render:e=>(0,He.jsx)(xo().A,{colorPalette:"blue",onClick:t,style:a.doneButton,...e,children:i.formatMessage(!o||n?ko.close:ko.save)})})}function Mo(e){const{setIsLoading:t}=e,n=(0,v().tz)(),[i,r]=o.useState(!1),[a,s]=o.useState(!1),l=(0,p().IS)((()=>({headerTitle:{display:"flex",alignItems:"center",gap:4},helpButton:{width:24,height:24,flex:"none",flexGrow:0},helpButtonIcon:{width:ze().Ev.sm,height:ze().Ev.sm},loadingToggleButton:{width:24,height:24,flex:"none",flexGrow:0},loadingToggleIcon:{width:ze().Ev.sm,height:ze().Ev.sm}})),[]);return(0,He.jsxs)("div",{style:l.headerTitle,onMouseEnter:()=>{r(!0)},onMouseLeave:()=>{r(!1)},children:[(0,He.jsx)(me().D,{styleKey:"Body-lg/Semibold",colorVariant:"primary",children:n.formatMessage(ko.formulaHeader)}),(0,He.jsx)(Le().A,{placement:"top",render:e=>(0,He.jsx)(De().A,{...e,ariaLabel:n.formatMessage(ko.learnTooltip),icon:_t().questionMarkCircleIcon,href:(0,vo().x)("guides.formulas"),external:!0,style:l.helpButton,iconStyle:l.helpButtonIcon}),renderTooltip:()=>n.formatMessage(ko.learnTooltip)}),void 0]})}function wo(e){const{onClick:t}=e,n=(0,v().tz)(),o=(0,p().IS)((e=>({undoButton:{display:"none",height:28,padding:"0px 8px",justifyContent:"center",alignItems:"center",gap:6,color:e.text.primary}})),[]);return(0,He.jsx)(On().p,{colorPalette:"gray",size:"sm",style:o.undoButton,onClick:t,children:n.formatMessage(ko.undoMessage)})}function To(e){const{onClick:t}=e,n=(0,v().tz)(),o=(0,p().IS)((e=>({revertButton:{display:"flex",height:28,padding:"0px 8px",justifyContent:"center",alignItems:"center",gap:6,color:e.text.primary}})),[]);return(0,He.jsx)(Le().A,{placement:"top",render:e=>(0,He.jsx)(On().p,{...e,"aria-label":n.formatMessage(ko.revertTooltip),colorPalette:"gray",size:"sm",style:o.revertButton,onClick:t,children:n.formatMessage(ko.discardAllChanges)}),renderTooltip:()=>n.formatMessage(ko.revertTooltip)})}n(737550);var Ao=()=>n(634201),jo=()=>n(803960),Po=()=>n(558842),Eo=()=>n(495262),Bo=()=>n(315097),Fo=()=>n(675925),Ro=()=>n(659602),Do=()=>n(335722),_o=()=>n(792002),Lo=()=>n(406792),Ho=()=>n(562800),No=()=>n(477450),Yo=()=>n(805751),Vo=()=>n(140992);const Ko=Ln().gJ,zo=a().A.isMobile?6:4,Uo=a().A.isMobile?12:14,Wo=24+Ln().Yu*zo,Oo=24+Ln().Yu*Uo;var Go=()=>n(529099);const $o=(0,v().YK)({aiToggleTooltip:{id:"formulas.aiToggleTooltip",defaultMessage:"Toggle formula assistant"}});function qo({isAssistantVisible:e,onToggleAssistant:t}){const[n,i]=(0,o.useState)(!1),r=(0,v().tz)(),s=(0,p().IS)((e=>({toggleButton:{display:"none",position:"absolute",bottom:4,insetInlineStart:4,width:16,height:16,borderRadius:4,alignItems:"center",justifyContent:"center",zIndex:20,cursor:"pointer",transition:"all 0.2s ease",opacity:.7,background:n?e.buttonHoveredBackground:"transparent"},toggleIcon:{width:a().A.isMobile?16:12,height:a().A.isMobile?16:12,color:e.icon.secondary}})),[n]);return(0,He.jsx)(Le().A,{placement:"top",alignment:"center",delayThreshold:500,renderTooltip:()=>(0,He.jsx)(me().D,{styleKey:"Caption/Medium",colorVariant:"inversePrimary",children:r.formatMessage($o.aiToggleTooltip)}),render:n=>(0,He.jsx)("div",{...n,style:{...s.toggleButton},onClick:e=>{e.preventDefault(),e.stopPropagation(),t()},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onFocus:e=>{e.preventDefault(),e.stopPropagation()},onMouseEnter:e=>{var t;i(!0),null===(t=n.onMouseEnter)||void 0===t||t.call(n,e)},onMouseLeave:e=>{var t;i(!1),null===(t=n.onMouseLeave)||void 0===t||t.call(n,e)},role:"button","aria-pressed":e,"aria-label":r.formatMessage($o.aiToggleTooltip),tabIndex:0,children:(0,Go().aiFaceIcon)({...s.toggleIcon})})})}var Qo=()=>n(509144);const Jo={borderRadius:4,flexGrow:1,flexShrink:1,fontFamily:Fe().vc(n(662303).locale).githubMono,fontSize:Ko,height:"100%",width:"100%",minHeight:"1em",padding:12,tabSize:2,textAlign:"start",whiteSpace:"pre-wrap",wordBreak:"break-all",unicodeBidi:"inherit"},Zo=(0,v().YK)({formulaPlaceholder:{id:"formulas.formulaPlaceholder",defaultMessage:"Your formula"}});function Xo(e){const{analyticsContext:t,clipboardActions:n,disabled:i,errorRanges:r,formulasModule:a,handleClose:s,markdownLinkifyIt:u,parentSpaceId:m,Prism:f,store:y,tinyMceMicrosoftWordPasteFilter:g,valueTypes:h,isAssistantVisible:x,onToggleAssistant:v,setIsLoading:S}=e;(0,o.useEffect)((()=>{S(!1)}),[S]);const I=(0,o.useRef)(null),C=(0,p().DP)(),M=(0,l().v3)(),w=(0,c().K8)((()=>y.getValue()||[]),[y],{debugName:"FormulaInputTextImpl.textValueStore"}),A=(0,o.useRef)(null),{isScrolledToBottom:j,scrollToBottomAndSetAutoscroll:P,scrollToBottom:B}=je({scrollableRef:A,environment:M}),F=function({scrollableRef:e,textValue:t}){const[n,i]=(0,o.useState)(0),[r,a]=(0,o.useState)(Wo);return(0,o.useLayoutEffect)((()=>{const t=e.current;if(!t)return;const o=t.scrollHeight;n!==o&&i(o),o!==r?Wo>o?r!==Wo&&a(Wo):o>Oo?r!==Oo&&a(Oo):void 0!==r&&a(void 0):n&&n>o&&o===Oo&&a(void 0)}),[t,r,e,n]),r}({scrollableRef:A,textValue:w}),[R,D]=(0,o.useState)(!0),_=(0,p().IS)((e=>({default:{boxSizing:"border-box",width:"100%",height:F,background:e.background.secondary,boxShadow:e.inputBoxShadow,borderRadius:10,position:"relative"},scrollableInner:{width:"100%",height:"100%",overflow:"auto",scrollbarWidth:"thin",scrollbarColor:`${e.icon.secondary} transparent`,WebkitScrollbar:{width:8,height:8},WebkitScrollbarTrack:{background:"transparent"},WebkitScrollbarThumb:{backgroundColor:e.icon.secondary,borderRadius:4,border:"none"},WebkitScrollbarThumbHover:{backgroundColor:e.icon.primary}},focused:{boxShadow:e.inputBlueFocusRing},scrollToBottomButton:{position:"absolute",insetInlineStart:"50%",bottom:12,marginInlineStart:-16,zIndex:20,padding:6,borderRadius:20,backgroundColor:e.primaryBlack,border:"none",transition:"opacity 150ms ease-out",opacity:0,pointerEvents:"none"},scrollToBottomButtonVisible:{opacity:.7,pointerEvents:"auto"},chevronDownIcon:{width:16,height:16,fill:e.white}})),[F]),L=(0,o.useCallback)((()=>{var e;return(null===(e=I.current)||void 0===e?void 0:e.getNode())||void 0}),[I]),H=(0,c().K8)((()=>{var e;const t=Y().default.state;return"editing"===t.mode&&(null===(e=(0,E().H)(t.multiSelection))||void 0===e?void 0:e.store)===y}),[y]),N=(0,o.useCallback)((()=>{var e;return null===(e=L())||void 0===e?void 0:e.blur()}),[L]),K=(0,o.useCallback)((()=>{const e=Ao().PE(b().q4_(w));return{endIndex:e.length,startIndex:e.length}}),[w]),z=(0,o.useCallback)((()=>{if(H)return(0,_o().Do)(y)}),[H,y]),U=(0,o.useCallback)((e=>{he().HP({canEdit:!i,editorNode:L(),environment:M,event:e,store:y,textValue:w})}),[M,w,L,y,i]),W=(0,o.useCallback)((e=>{if(i)return;const t=Y().default.state;"editing"===t.mode&&t.multiSelection.start.store===y&&oe().createAndCommit({userAction:"FormulaInputTextImpl.handleDelete",environment:M,canUndo:!0,perform:o=>{Bo().wT({environment:M,multiSelection:t.multiSelection,deleteForwards:!0,transaction:o,event:e,editorMode:"default"}),o.postEnqueueActions.push((()=>{oe().createAndCommit({userAction:"FormulaInputTextImpl.normalizeTextValue",environment:M,canUndo:!0,perform:e=>{ne().wu({clipboardActions:n,formulasModule:a,store:y,transaction:e})}})}))}})}),[i,M,y,n,a]),O=(0,o.useCallback)((e=>{if(i)return;const t=Y().default.state;if("editing"===t.mode&&t.multiSelection.start.store===y){if(Bo().CZ({device:M.device,event:e,multiSelection:t.multiSelection}))return;oe().createAndCommit({userAction:"FormulaInputTextImpl.handleBackspace",environment:M,canUndo:!0,perform:o=>{Bo().wT({environment:M,multiSelection:t.multiSelection,deleteForwards:!1,transaction:o,event:e,editorMode:"default"}),o.postEnqueueActions.push((()=>{oe().createAndCommit({userAction:"FormulaInputTextImpl.normalizeTextValue",environment:M,canUndo:!0,perform:e=>{ne().wu({clipboardActions:n,formulasModule:a,store:y,transaction:e})}})}))}})}}),[i,M,y,n,a]),G=(0,o.useCallback)((e=>{var t,n,o;if(i)return;if(null===(t=e.preventDefault)||void 0===t||t.call(e),I.current&&I.current.isComposing())return;const r=Y().default.state,a="editing"===r.mode&&(0,E().H)(r.multiSelection);if(!a)return;const s=Ao().PE(b().q4_(w)),l=null===(n=s.slice(0,a.selection.startIndex).join("").split("\n"))||void 0===n?void 0:n.at(-1),d=(null==l||null===(o=l.match(/^\t*/))||void 0===o?void 0:o[0].length)||0,u=(null==l?void 0:l.split("").reverse())||[];let c=0;const p=u.some((e=>{if(")"===e)c++;else if("("===e){if(0===c)return!0;c--}return!1}))?d+1:d;let m="\t".repeat(p);const f=")"===s[a.selection.endIndex],g=Boolean(null==l?void 0:l.endsWith("("))&&f;g&&(m+=`\n${"\t".repeat(p-1)}`),oe().createAndCommit({userAction:"FormulaInputTextImpl.handleShiftEnter",environment:M,canUndo:!0,perform:e=>{ne().$D({environment:M,editorMode:"default",store:y,string:`\n${m}`,selection:a.selection,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:e}),g&&(0,T().t)({store:y,selection:{startIndex:a.selection.startIndex+p+1,endIndex:a.selection.startIndex+p+1}})}})}),[i,M,y,w]),$=(0,o.useCallback)((e=>{var t;const o=window.getSelection();null!=o&&o.anchorNode&&null!==(t=L())&&void 0!==t&&t.contains(o.anchorNode)&&n.copy({environment:M,event:e,markdownLinkifyIt:u})}),[M,L,u,n]),q=(0,o.useCallback)((e=>{!i&&H?n.cutWithMaybeConfirmation({environment:M,event:e,markdownLinkifyIt:u}):e.preventDefault()}),[i,M,u,n,H]),Q=(0,o.useCallback)((e=>{i||!H||function(e){if(!e.clipboardData)return!1;for(const t of Array.from(e.clipboardData.items))if(t.getAsFile())return!0;return!1}(e)?e.preventDefault():oe().createAndCommit({userAction:"FormulaInputTextImpl.handlePaste",environment:M,canUndo:!0,perform:t=>{(0,Fo().o)(M,{action:"paste",block_type:"equation",from:"formula_editor"},(o=>{n.paste({environment:M,event:e,disableEmbedMenu:!0,transaction:t,onPasteFiles:n.pasteFilesForBlocks,formulasModule:a,markdownLinkifyIt:u,tinyMceMicrosoftWordPasteFilter:g}),o()}))}})}),[i,M,u,g,a,n,H]),J=(0,o.useCallback)((e=>{he().sp({environment:M,event:e,textValue:w,editorNode:L(),store:y,canEdit:!i})}),[M,w,L,y,i]),Z=(0,o.useCallback)((e=>{he().W5({environment:M,event:e,textValue:w,editorNode:L(),store:y,canEdit:!i})}),[M,w,L,y,i]),X=(0,o.useCallback)((e=>{i||e.preventDefault()}),[i]),ee=(0,o.useCallback)((e=>{oe().createAndCommit({userAction:"FormulaInputTextImpl.handleMoveUp",environment:M,canUndo:!0,perform:e=>{ne().$P({environment:M,transaction:e,direction:"up"})}})}),[M]),te=(0,o.useCallback)((e=>{oe().createAndCommit({userAction:"FormulaInputTextImpl.handleMoveDown",environment:M,canUndo:!0,perform:e=>{ne().$P({environment:M,transaction:e,direction:"down"})}})}),[M]),ie=(0,o.useCallback)((e=>{var t;e.preventDefault&&e.preventDefault();const n=Eo().li();(null==n||null===(t=n.getFirstStore())||void 0===t?void 0:t.id)===y.id&&Eo().tN({environment:M})}),[M,y.id]),re=(0,o.useCallback)((e=>{var t;e.preventDefault&&e.preventDefault();const n=Eo().Bl();(null==n||null===(t=n.getFirstStore())||void 0===t?void 0:t.id)===y.id&&Eo().ZS({environment:M})}),[M,y.id]),ae=(0,o.useCallback)((e=>{if(i)return;e.preventDefault();const t=Y().default.state,n="editing"===t.mode&&(0,E().H)(t.multiSelection);if(n){const{selection:e}=n,t=e.startIndex===e.endIndex;oe().createAndCommit({userAction:"FormulaInputTextImpl.handleTab",environment:M,canUndo:!0,perform:n=>{t?ne().$D({environment:M,editorMode:"default",store:y,string:"\t",selection:e,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,disableFilters:!0,transaction:n}):ne().RJ({environment:M,store:y,editorMode:"default",selection:e,transaction:n,shouldStripTokens:!1,disableFilters:!0})}})}}),[i,M,y]),se=(0,o.useCallback)((e=>{if(i)return;e.preventDefault();const t=Y().default.state,n="editing"===t.mode&&(0,E().H)(t.multiSelection);if(n){const{selection:e}=n,t=e.startIndex===e.endIndex;oe().createAndCommit({userAction:"FormulaInputTextImpl.handleUntab",environment:M,canUndo:!0,perform:n=>{if(t){const t=b().q4_(y.getValue()||[]),o=Ao().PE(t),i=o[e.startIndex-1];if("\t"===i)ne().jQ({environment:M,store:y,selection:{startIndex:e.startIndex-1,endIndex:e.startIndex},transaction:n});else if(" "===i){const t=" "===o[e.startIndex-2]?2:1;ne().jQ({environment:M,store:y,selection:{startIndex:e.startIndex-t,endIndex:e.startIndex},transaction:n})}}else ne().Ye({environment:M,store:y,editorMode:"default",selection:e,transaction:n,shouldStripTokens:!1,disableFilters:!0})}})}}),[i,M,y]),le=(0,o.useCallback)((e=>{const{newValue:o}=e;Lo().default.measureAfterNextFlush({metricName:"formulas_typing_lag",startTime:performance.now()},{environment:M,getData:()=>t}),oe().createAndCommit({userAction:"FormulaInputTextImpl.handleMutation",environment:M,canUndo:!0,perform:e=>{ne().dw({environment:M,editorMode:"default",store:y,newValue:o,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,disableFilters:!0,transaction:e}),e.postEnqueueActions.push((()=>{oe().createAndCommit({userAction:"FormulaInputTextImpl.normalizeTextValue",environment:M,canUndo:!0,perform:e=>{ne().wu({clipboardActions:n,formulasModule:a,store:y,transaction:e})}})}))}})}),[t,M,a,y,n]),de=(0,o.useCallback)((({leafRef:e,wrapperRef:t,...n},o)=>{const{device:a}=M,s=w.length>0;return(0,He.jsxs)("div",{ref:t,...n,role:"textbox",tabIndex:0,onKeyDown:e=>"Enter"===e.key&&e.shiftKey?(e.preventDefault(),e.stopPropagation(),void G(e.nativeEvent)):"Tab"===e.key?(e.preventDefault(),e.stopPropagation(),void(e.shiftKey?se(e.nativeEvent):ae(e.nativeEvent))):void(null==n||n.onKeyDown(e)),style:{flexGrow:1,display:"table",position:"relative",width:"100%",height:"100%",direction:"ltr"},children:[(0,He.jsx)(ni,{hasText:s}),(0,He.jsx)(No().A,{leafRef:(0,Po().Px)(I,e),style:Jo,isDisabled:i,debugName:"FormulaInputTextImpl",store:y,getHtml:()=>(0,Qo()._)({currentUserId:M.currentUser.id,errorRanges:r,getPublicBaseUrlForPage:Ho().tN(M),isAndroid:a.isAndroid,isMobileNative:a.isMobileNative,isSafariOrIOS:a.isSafari||a.isIOS,isFirefox:a.isFirefox,isWindows:a.isWindows,parentSpaceId:m,Prism:f,store:y,textValue:w,theme:C,valueTypes:h}),getSelection:z,onMutation:le,spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",onSelect:o,onMouseOver:J,onMouseOut:Z,suppressNewlineEvents:!1,expandSelectionOnTripleClick:!0,placeholder:" "})]})}),[M,i,y,z,le,J,Z,r,m,f,w,C,h,ae,se,G]);return(0,d().w)((()=>{(0,fe().z)({store:y}),B("instant")})),(0,He.jsxs)("div",{style:{..._.default,...R&&_.focused},onFocus:()=>{D(!0);const e=L();e&&e.focus(),(0,fe().z)({store:y})},onBlur:()=>{D(!1),N()},children:[(0,He.jsx)("div",{style:_.scrollableInner,ref:A,children:(0,He.jsxs)(Yo().A,{debugName:"FormulaInputTextImpl",capture:H,allowEnter:!0,allowTabUntab:!0,allowUndo:!0,allowEsc:!0,allowCopyPaste:!0,children:[" ",(0,He.jsx)(Vo().F,{store:y,disabled:i,clearBrowserSelection:N,getEndSelection:K,onBlur:N,onClick:U,onDelete:W,onBackspace:O,onShiftEnter:G,onCommandShiftEnter:k().D_,onTab:ae,onUntab:se,onToggleBold:X,onToggleItalics:X,onToggleUnderline:X,onToggleStrike:X,onToggleCode:k().D_,onCopy:$,onCut:q,onPaste:Q,onMoveUp:ee,onMoveDown:te,onUndo:ie,onRedo:re,onEsc:s,render:de,disableStyleAnnotations:!0,disableMentions:!0,disableSlashCommands:!0,canSelectAllBlocks:!1,canInsertText:!0,canSelectionDrag:!0,disableMobileActionBar:!0,topBottomPadding:40,pasteBehavior:"inline"})]})}),(0,He.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),P()},style:{..._.scrollToBottomButton,...!j&&_.scrollToBottomButtonVisible},children:(0,jo().arrowChevronSingleDownIcon)(_.chevronDownIcon)}),v?(0,He.jsx)(V().y,{experimentId:"formula_assistant",groups:{on:i?null:(0,He.jsx)(qo,{isAssistantVisible:x,onToggleAssistant:v}),control:null}}):null]})}function ei(){const e=(0,p().IS)((e=>({container:{boxSizing:"border-box",width:"100%",height:Wo,background:e.background.secondary,boxShadow:e.inputBoxShadow,borderRadius:6,position:"relative"},scrollableInner:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:6,paddingTop:11,paddingInlineEnd:12,paddingBottom:10,paddingInlineStart:12}})),[]);return(0,He.jsx)("div",{style:e.container,children:(0,He.jsxs)("div",{style:e.scrollableInner,children:[(0,He.jsx)(Ce().A,{emphasized:!0,style:{height:14,borderRadius:3,width:"100%"}}),(0,He.jsx)(Ce().A,{emphasized:!0,style:{height:14,borderRadius:3,width:"50%"}})]})})}function ti(e){const{value:t}=(0,F().fJ)(en().y),{value:n}=(0,F().fJ)(Ro().g),{value:o}=(0,F().fJ)(Do().S),{value:i}=(0,F().fJ)(A().T.formulas),{value:r}=(0,F().fJ)(C().R.clipboardActions);return t&&i&&r?(0,He.jsx)(Xo,{...e,Prism:t,clipboardActions:r,formulasModule:i,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:o}):(0,He.jsx)(ei,{})}function ni(e){const{hasText:t}=e,n=(0,v().tz)();return(0,He.jsx)(pe().Y1,{direction:"horizontal",gap:8,padding:"10px 12px",style:{position:"absolute",inset:0,pointerEvents:"none",userSelect:"none"},children:t?null:(0,He.jsx)(pe().Y1,{height:20,align:"center-left",children:(0,He.jsx)(me().D,{colorVariant:"disabled",styleKey:"Body/Regular",children:n.formatMessage(Zo.formulaPlaceholder)})})})}Xo.displayName="FormulaInputTextImpl";const oi=!1,ii=400,ri=100,ai=[];function si(e){const{initialCode:t,parentSpaceId:n,disabled:L,typecheckContext:H,formulas:K,handleCancel:z,onCodeChange:U,onTypeChange:W,parentCollectionStore:G,handleClose:q,getRecordModel:Q,autosave:Z=!0,formulaSchema:te,collectionStore:ae,blockStore:se}=e,[le,de]=(0,o.useState)(se),[ue,pe]=(0,o.useState)(!0),me=(0,v().tz)(),fe=(0,l().v3)(),[ye]=(0,o.useState)((()=>crypto.randomUUID()));(0,d().w)((()=>{(0,i().u)({environment:fe,event:{eventName:"formula_editor_open",eventProperties:{formula_assistant_session_id:ye,has_existing_formula:Boolean(t&&t.length>0),collection_id:null==G?void 0:G.id}}})}));const ge=(0,o.useRef)(0),he=(0,o.useRef)(0),xe=(0,o.useRef)(0),be=(0,o.useRef)({parseErrors:[],typeErrors:[],evaluationErrors:[]}),[ve,ke]=(0,o.useState)(),{value:Se}=(0,F().fJ)(A().T.formulaEditor),{value:Ie}=(0,F().fJ)(A().T.formulas),Ce=(0,R().l)(H.valueTypes),Me=(0,o.useMemo)((()=>{const e={};return G&&(e.collection_id=[[G.id]]),e.value_types=[[JSON.stringify(Ce)]],e}),[G,Ce]),{store:we,setValue:Te}=(0,P().AI)({initialValue:t,onChange:U,source:"formula",properties:Me}),Ae=(0,o.useCallback)((e=>{const{newValue:t,newSelection:n}=e;Te(t);const{startIndex:o,endIndex:i}=n,r={start:{store:we,index:o},end:{store:we,index:i}};(0,w().setMultiSelection)({multiSelection:r})}),[Te,we]),je=(0,c().K8)((()=>{var e;const t=Y().default.state;if("editing"===t.mode&&(null===(e=(0,E().H)(t.multiSelection))||void 0===e?void 0:e.store)===we)return{startIndex:t.multiSelection.start.index,endIndex:t.multiSelection.end.index}}),[we],{useDeepEqual:!0}),Pe=(0,c().K8)((()=>we.getValue()),[we]),Ee=(0,o.useMemo)((()=>!k().n4(Pe,t)),[Pe,t]),Be=(0,x().lW)(Pe,ri,Object.is),Fe=(0,B().C)(),Re=(0,c().K8)((()=>D().A.state.publicPageData),[]),[De,_e]=(0,o.useState)([]),Le=(0,c().K8)((()=>{_e(ai);const e=null==le?void 0:le.getModel();if(!e||!Be||P().Pe||!Ie)return;const t=Ie.evaluateRawCollectionFormula2({block:e,property:H.sourceProperty??"formula",formulaCode:Be,getRecordModel:Q,intl:me,userTimeZone:(0,h().P)(),depth:0,visitedProperties:new Set,formulaTimeoutTimestampMs:Date.now()+Fe,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map,publicPageDataCollection:{id:null==Re?void 0:Re.collectionId,schema:null==Re?void 0:Re.collectionSchema},experimentService:r().default,collectionFeatureGates:(0,j().i)(),spaceIdCreator:fe.idCreator.getSpaceIdCreatorSync(n)});if(t){if(!S().Q.isFail(t))return t.value;(0,f().eJ)(t.error)&&_e([t.error])}}),[le,Be,Ie,me,Fe,null==Re?void 0:Re.collectionId,null==Re?void 0:Re.collectionSchema,H.sourceProperty,Q,n,fe]),[Ne,Ye]=(0,c().K8)((()=>!Pe||P().Pe?[void 0,void 0]:K.processFormulaInput(Pe)),[Pe,K]),Ve=(0,c().K8)((()=>{if(Ne)return K.parseFormulaInputToCst(Ne,Ye)}),[Ne,K,Ye]),Ke=(0,c().K8)((()=>{if(Ve)return K.convertFormulaCSTToAST(Ve[0])}),[K,Ve]),[ze,Ue]=(0,o.useState)(void 0);(0,o.useEffect)((()=>{!async function(){if(Ke&&H&&S().Q.isSuccess(Ke)){const e=await K.addTypesToFormulaASTAsync(Ke.value,H,Ye);Ue(e);const t=e.node.type;ke(t),null==W||W(t)}else Ue(void 0),ke(void 0)}()}),[Ke,H,Ye,Ve,K,W]);const We=(0,o.useMemo)((()=>void 0!==ze?[...(0,g().KH)(ze.node,!1),...ze.errors]:[]),[ze]),Oe=(0,o.useMemo)((()=>({parseErrors:(null==Ve?void 0:Ve[1])??[],typeErrors:We,evaluationErrors:De})),[De,Ve,We]);(0,o.useEffect)((()=>{be.current=Oe}),[Oe]);const Ge=(0,x().lW)(Oe,ii,Object.is),$e=!(0===(0,b().q4_)(Pe).trim().length)&&Oe.parseErrors.length+Oe.typeErrors.length+Oe.evaluationErrors.length>0,qe=(0,c().K8)((()=>function(e){const{errors:t,intl:n,codeLength:o,formulas:i}=e,{parseErrors:r,typeErrors:a,evaluationErrors:s}=t,l=[];a&&a.length>0?a.forEach((e=>{const t=(0,f().ew)((0,f().rA)(n,e));l.push({msg:n.formatMessage(...t),range:{startIndex:e.node.startOffset,endIndex:e.node.endOffset+1}})})):s&&s.length>0&&s.forEach((e=>{const t=(0,f().ew)((0,f().yI)(n,e));l.push({msg:n.formatMessage(...t),range:i.isUniqueFormulaEvaluatorError(e)?{startIndex:e.node.startOffset,endIndex:e.node.endOffset+1}:void 0})}));r&&r.forEach((e=>{const t=(0,f().ew)((0,f().ml)(e));l.push({msg:n.formatMessage(...t),range:"eof"===e.offset?{startIndex:o-1,endIndex:o}:{startIndex:e.offset,endIndex:e.offset+1}})}));return l}({errors:Ge,codeLength:Ye?(0,y().sE)(Ye):(0,b().q4_)(Pe).length,formulas:K,intl:me})),[Pe,Ge,K,me,Ye]),Qe=(0,o.useMemo)((()=>qe.map((e=>e.range)).filter(I().O9)),[qe]),[Je,Ze]=(0,o.useState)(void 0),Xe=(0,o.useRef)(void 0),[et,tt]=(0,o.useState)(void 0),nt=(0,o.useRef)(1);(0,o.useEffect)((()=>{nt.current++;const e=nt.current;!async function(){if(Se){const t=await Se.getFormulaEditorInfoAtPosition({formula:Pe??[],inputPosition:je&&je.startIndex===je.endIndex?je.startIndex:0,context:H,includeDeprecatedCompletions:!1});S().Q.isSuccess(t)&&nt.current===e&&(Xe.current=t.value,Ze(t.value))}}()}),[je,Se,H,Pe]);const ot=(0,o.useCallback)((()=>{Te(t)}),[t,Te]),it=(0,c().uB)(void 0,Tt),rt=(0,c().O$)(it),at=(0,c().K8)((()=>null!==rt.formulaBeforeLatestRequest&&rt.formulaBeforeLatestRequest!==Pe),[rt,Pe]),st=(0,o.useCallback)((()=>{"input"===rt.type&&null!==rt.formulaBeforeLatestRequest&&Te(rt.formulaBeforeLatestRequest)}),[rt,Te]),lt=(0,c().K8)((()=>"generating"===rt.type),[rt]),dt=(0,o.useMemo)((()=>qe.map((e=>{if("string"==typeof e.msg)return e.range?`${e.msg} [${e.range.startIndex},${e.range.endIndex}]`:e.msg})).filter(I().O9)),[qe]),ut=(0,c().K8)((()=>{var e;return Boolean(null===(e=_().default.state.sidebarSpaceStore)||void 0===e?void 0:e.isAiEnabledOnSpace())}),[]),ct=(0,c().K8)((()=>N.getIsAssistantVisible()),[]),pt=(0,o.useCallback)((()=>{N.toggleAssistant()}),[]),mt=(0,o.useRef)(null),ft=(0,o.useCallback)((async e=>{var o;const r=we.getValue(),a=n,s=await C().R.clipboardActions.load();let l=!1;null===(o=mt.current)||void 0===o||o.abort();const d=new AbortController;mt.current=d;const u=await async function(e){const{environment:t,spaceId:n,getRecordModel:o,userPrompt:i,formulaErrors:r,typecheckContext:a,handleFormulaStream:s,formulaAssistantStore:l,abortSignal:d,existingFormulaTextValue:u,intl:c,formulaResult:p,returnType:m}=e,f=(0,re().Z1)({environment:t,table:J().mS,spaceId:n});l.startGeneratingState("thinking");let y=(0,$().r4)({textValue:u,intl:c,getRecordModel:o,userTimeZone:(0,h().P)(),valueTypes:a.valueTypes});const g=await ce({environment:t,spaceId:n,userPrompt:i,formulaErrors:r,existingFormula:y,typecheckContext:a,formulaResult:p,returnType:m});if(!g)return l.setError(),{type:"error",traceId:f};let x=!1,b="",v="",k=0;return await(0,ie().g)({environment:t,data:{generateTitle:!1,traceId:f,transcript:g,spaceId:n},onResponse:e=>{if("generate-formula"!==e.type)return;const t=(0,X().$l)(e.value);if(!(0,ee().Xj)(O,t))return;if(l.state.latestTraceId!==f&&l.setTraceId(f),"retry"===t.type)return y=b,l.updateGeneratingState("reading-errors"),x=!0,void(k+=1);if("chat"===t.type?(l.setRefusalMessage(t.message),v=t.message):"formula"===t.type&&(b=t.formula),y.startsWith(b))return;const n=l.state;"generating"!==n.type||"writing"===n.generatingStep||x||(l.updateGeneratingState("writing"),l.setFormulaBeforeLatestRequest(u)),"generating"===n.type&&"fixing"!==n.generatingStep&&x&&l.updateGeneratingState("fixing"),s(b)},abortSignal:d}),null!=d&&d.aborted?{type:"aborted",traceId:f}:(b.length>0&&y.includes(b)&&s(b),v?l.setFinalRefusedState(v):b.length>0?l.resetToInitial():l.setError(),{type:"success",formula:b,traceId:f,completionType:b?"formula":"refusal",retryCount:k})}({environment:fe,spaceId:a,getRecordModel:Q,userPrompt:e,formulaErrors:dt,existingFormulaTextValue:r,typecheckContext:H,handleFormulaStream:e=>{l||((0,T().t)({store:we}),l=!0),function(e){const{clipboardActions:t,environment:n,formulasModule:o,formulaString:i,store:r}=e;oe().createAndCommit({userAction:"FormulaInputText.handleMutation",environment:n,canUndo:!0,perform:e=>{ne().kE({environment:n,store:r,newValue:i,editorMode:"default",disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,disableFilters:!0,transaction:e}),e.postEnqueueActions.push((()=>{oe().createAndCommit({userAction:"FormulaInputText.normalizeTextValue",environment:n,canUndo:!0,perform:e=>{ne().wu({clipboardActions:t,formulasModule:o,store:r,transaction:e})}})}))}})}({environment:fe,clipboardActions:s,formulasModule:K,formulaString:e,store:we})},formulaAssistantStore:it,abortSignal:d.signal,intl:me,formulaResult:Le,returnType:ve});ge.current+=1,"success"===u.type&&("formula"===u.completionType?(he.current+=1,(0,i().u)({environment:fe,event:{eventName:"formula_assistant_prompt",eventProperties:{formula_assistant_session_id:ye,trace_id:u.traceId,response_type:"formula",retry_count:u.retryCount,had_existing_formula:Boolean(t&&t.length>0)}}})):"refusal"===u.completionType?(xe.current+=1,(0,i().u)({environment:fe,event:{eventName:"formula_assistant_prompt",eventProperties:{formula_assistant_session_id:ye,trace_id:u.traceId,response_type:"refusal",had_existing_formula:Boolean(t&&t.length>0)}}})):(0,I().HB)(u.completionType)),(0,M().I)({environment:fe}),mt.current=null}),[it,n,H,dt,fe,K,we,me,Q,ye,t,Le,ve]),yt=(0,o.useCallback)((()=>{var e;null===(e=mt.current)||void 0===e||e.abort(),mt.current=null}),[]),gt=(0,o.useCallback)((()=>{const e=L?t:we.getValue();q(e)}),[q,L,t,we]);(0,u().X)((()=>{const e=ge.current,n=xe.current,o=he.current,r={eventName:"formula_assistant_session",eventProperties:{formula_assistant_session_id:ye,total_prompts:e,generated_formula_count:o,refusal_count:n,had_existing_formula:Boolean(t&&t.length>0)}};e>0&&(0,i().u)({environment:fe,event:r})}));const ht=(0,c().K8)((()=>{const e=rt;return ue||"generating"===e.type&&("fixing"===e.generatingStep||"writing"===e.generatingStep)}),[ue,rt]);oi&&console.log("FormulaInput",{currentValue:Pe,cursorEditorInfo:Je,infoHelper:et,errorMessagesWithRange:qe,errorRanges:Qe,astWithTypes:ze});const xt=(0,p().IS)((e=>({container:{display:"flex",flexDirection:"column",alignItems:"flex-start",isolation:"isolate",height:"100%",background:e.popoverBackground,boxShadow:e.shadowMD,borderRadius:12,position:"relative"},topSection:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",padding:12,gap:12},headerWrapper:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:8,height:28,flex:"none",alignSelf:"stretch",flexGrow:0},inputText:{width:"100%",position:"relative",direction:"ltr"},bottomSection:{display:"flex",flexDirection:"row",height:a().A.isMobile?"100%":240,maxHeight:a().A.isMobile?void 0:"calc(90vh - 38px - 31px - 38px - 30px)",borderTop:`1px solid ${e.border.primary}`,width:"100%"},leftColumn:{position:"relative",borderInlineEnd:`1px solid ${e.border.primary}`,width:a().A.isMobile?"100%":void 0},rightColumn:{display:"flex",flexDirection:"column",flexGrow:1},infoHelper:{padding:"12px 14px"}})),[]);return(0,o.useEffect)((()=>{const e=e=>{(0,s().A)(fe,e,"command+enter")&&(e.preventDefault(),gt())};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[gt,fe]),(0,He.jsx)(m().N,{debugName:"FormulaInput",capture:!a().A.isMobile,onPaste:k().D_,children:(0,He.jsxs)("div",{style:xt.container,children:[(0,He.jsxs)("div",{style:xt.topSection,children:[(0,He.jsx)("div",{style:xt.headerWrapper,children:(0,He.jsx)(So,{setIsLoading:pe,disabled:L,onClickCancel:z,onClickClose:gt,onClickRevert:Ee&&!lt?ot:void 0,onClickUndo:at&&!lt?st:void 0,autosave:Z,isEdited:Ee})}),(0,He.jsx)(V().y,{experimentId:"formula_assistant",groups:{on:!L&&ut&&ct?(0,He.jsx)(St,{setFormulaValue:Te,formulaAssistantStore:it,onStop:yt,onSubmit:ft,spaceId:n,isLoading:ue,currentFormulaTextValue:Pe,sessionId:ye}):null,control:null}}),(0,He.jsx)("div",{style:xt.inputText,children:(0,He.jsx)(ti,{setIsLoading:pe,store:we,disabled:L||lt,parentSpaceId:n,valueTypes:H.valueTypes,errorRanges:Qe,handleClose:gt,analyticsContext:{restrict_unaccessible_properties:H.restrictUnaccessibleProperties},onToggleAssistant:ut?pt:void 0,isAssistantVisible:ct},"input")})]}),(0,He.jsx)(so,{isLoading:ht,shouldShowErrors:$e,debouncedErrorMessagesWithRange:qe,formulaResult:Le,returnType:ve,formulaSchema:te,collectionStore:ae,selectedBlockStore:le,setSelectedBlockStore:de}),L?void 0:(0,He.jsxs)("div",{style:xt.bottomSection,children:[(0,He.jsx)("div",{style:xt.leftColumn,children:(0,He.jsx)(vn,{store:we,context:H,selection:je,cursorEditorInfo:Je,cursorEditorInfoRef:Xe,onChange:Ae,getRecordModel:e.getRecordModel,setInfoHelper:tt,isLoading:ue,isAssistantGenerating:lt})}),a().A.isMobile?void 0:(0,He.jsx)("div",{style:xt.rightColumn,children:(0,He.jsx)(ln,{infoHelper:et,getRecordModel:e.getRecordModel,style:xt.infoHelper,typecheckContextValues:H.valueTypes,isLoading:ue})})]})]})})}},141768:(e,t,n)=>{n.d(t,{YH:()=>l,bi:()=>a});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(803949),n(581454),n(908872);var o=()=>n(338381),i=()=>n(201980),r=()=>n(496603);function a(e){let t="";const n=document.createElement("div");n.innerHTML=e;const i=o().zn(n);for(const o of i){const e=r().ih(o.data);if(null!==o.parentElement&&o.parentElement!==n){t+=`<span class="${s({parent:o.parentElement,root:n}).join(" ")}">${e}</span>`}else t+=e}return t}function s(e){const{parent:t,root:n}=e,o=new Set;let i=t;for(;i&&i!==n;)i.classList.forEach((e=>{o.add(e)})),i=i.parentElement??void 0;return Array.from(o)}function l(e,t){const n={text:d(e),syntax:d(t)},o=function(e){let t=0;return e.reduce(((e,n)=>(e.push([t,n]),t+=n,e)),[])}(function(e,t){const n=e.slice(),o=t.slice(),i=[];let r=0,a=0;for(;r<n.length&&a<o.length;){const e=n[r],t=o[a];e===t?(i.push(e),r+=1,a+=1):e<t?(i.push(e),r+=1,o[a]-=e):(i.push(t),n[r]-=t,a+=1)}return i}(n.text,n.syntax)),r={text:0,syntax:0},a={text:0,syntax:0},s=[],l=e.map(i().N8A).join("");for(const[i,d]of o){const e=i+d,o=t[r.syntax],c={value:l.substring(i,e),textTokenIndex:r.text,classNames:(u=o,u&&u[1])};s.push(c);const p=n.text[r.text],m=n.syntax[r.syntax];e>=a.text+p&&(r.text+=1,a.text+=p),e>=a.syntax+m&&(r.syntax+=1,a.syntax+=m)}var u;return s}function d(e){return e.map((e=>e[0].length))}},164891:(e,t,n)=>{n.d(t,{y:()=>r});var o=()=>n(242422),i=()=>n(56366);function r(e){const{experimentId:t,groups:n,disableExposureLogging:r}=e,a=function(e){const{experimentId:t,disableExposureLogging:n,defaultGroup:r}=e;return(0,i().K8)((()=>o().default.getEligibleGroup({experimentId:t,defaultGroup:r??"control",disableExposureLogging:n})),[t,n,r])}({experimentId:t,disableExposureLogging:r});return n[a]}},509144:(e,t,n)=>{n.d(t,{_:()=>x});n(581454);var o=n(296540),i=()=>n(242422),r=()=>n(726637),a=()=>n(338381),s=()=>n(416504),l=()=>n(379632),d=()=>n(201980),u=()=>n(969842),c=()=>n(496603),p=()=>n(267419),m=()=>n(972435),f=()=>n(141768),y=()=>n(562800),g=()=>n(53137),h=n(474848);function x(e){const{currentUserId:t,errorRanges:n,getPublicBaseUrlForPage:a,isAndroid:x,isMobileNative:v,isSafariOrIOS:k,isFirefox:S,isWindows:I,parentSpaceId:C,Prism:M,store:w,theme:T,valueTypes:A,textValue:j}=e,P=d().q4_(j),E="notion",B=M.languages[E],F=document.createElement("div"),R=M.highlight(P,B,E);F.innerHTML=f().bi(R);const D=c().oE(Array.from(F.childNodes).map(b));let _=j;for(const o of n)_=d().Mwp({annotation:[d().Ifu.FormulaError],selection:o,textValue:_});const L=function({syntaxTokens:e,textValue:t,store:n,parentSpaceId:o,valueTypes:a,theme:l,isAndroid:c,isSafariOrIOS:x,isFirefox:b,isWindows:v,isMobileNative:k,currentUserId:S,getPublicBaseUrlForPage:I,errorRanges:C}){const M=f().YH(t,e),w=t.map(d().uPN).map(((e,t)=>(0,u().sT)({annotations:e,theme:l,getRecordModel:n.getRecordModel,spaceId:o,isSafariOrIOS:x})));let T=0;return M.map(((e,f)=>{const I=t[e.textTokenIndex],M=w[e.textTokenIndex],A=e.value.length,j=T,P=T+A;T=P;let E=!1;if(C)for(const t of C){const{startIndex:e,endIndex:n}=t;void 0!==e&&void 0!==n&&j<n&&P>e&&(E=!0)}if(d().qXl(I)){const e=[...M.classNames||[],...E?["formula-error-underline"]:[]];return(0,u().Au)({args:{textValue:{value:t,spaceId:o},getRecordModel:n.getRecordModel,getRecordRole:n.getRecordRole,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disableLinks:!1,userTimeZone:(0,s().P)(),disabled:!1,isAndroid:c,isSafariOrIOS:x,isFirefox:b,isWindows:v,showEmojiInline:v,emojiType:"raw",highlightDiscussionId:void 0,theme:l,intl:m().A.getIntl(),renderedPageBlockId:void 0,parentBlockId:void 0,katex:void 0,isClient:!0,baseUrl:r().A.domainBaseUrl,publicDomainName:r().A.publicDomainName,currentUserId:S,getPublicBaseUrlForPageOrCollection:y().d6,externalIntegrations:g().A.integrations.state,formulaValueTypes:a,emojiData:p().A.state,isMobileNative:k,isMobileNativeExternalLinkFixEnabled:i().default.checkGate({gateName:"mobile_native_external_link_fix"}),displayInUserTimezone:!0},style:M.style,classNames:e,index:f,token:I,tokenValue:d().N8A(I),tokenAnnotations:d().uPN(I)})}{const t=[e.classNames||"",...M.classNames||[],...E?["formula-error-underline"]:[]];return(0,h.jsx)("span",{className:t.join(" ").trim(),style:M.style,"data-token-index":e.textTokenIndex,children:e.value},f)}}))}({store:w,parentSpaceId:C,valueTypes:A,syntaxTokens:c().oE(D),textValue:j,theme:T,isAndroid:x,isSafariOrIOS:k,isFirefox:S,isWindows:I,isMobileNative:v,getPublicBaseUrlForPage:a,currentUserId:t,errorRanges:n}),H=(0,h.jsxs)(o.Fragment,{children:[L,(0,h.jsx)("span",{children:"\n"})]});return l().A.renderToStaticMarkup(H)}function b(e){return a().KH(e)?[e.data]:a().vq(e)?[e.textContent||"",e.className]:void 0}},655923:(e,t,n)=>{n.r(t),n.d(t,{arrowStraightDownIcon:()=>i,iconDefinition:()=>o});n(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"3.97 2.37 12.06 15.26",svg:(0,n(474848).jsx)("path",{d:"M10.625 3a.625.625 0 1 0-1.25 0v12.491l-4.333-4.333a.625.625 0 1 0-.884.884l5.4 5.4a.62.62 0 0 0 .884 0l5.4-5.4a.625.625 0 0 0-.884-.884l-4.333 4.333z"})},i=(0,n(340498).wt)("arrowStraightDown",o)},687681:(e,t,n)=>{n.d(t,{u:()=>o});const o=(0,n(340498).xh)("pencilLine",{default:{loader:()=>n.e(92668).then(n.bind(n,105819))},small:{loader:()=>n.e(92668).then(n.bind(n,523389))},fill:{loader:()=>n.e(92668).then(n.bind(n,71287))},fillSmall:{loader:()=>n.e(92668).then(n.bind(n,396654))}},["compose","edit","write","create"])},688311:(e,t,n)=>{n.d(t,{h:()=>i});n(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 13.76 13.76",svg:(0,n(474848).jsx)("path",{d:"M12.718 4.625H6.313a3 3 0 0 0 0 6h7.562a1.75 1.75 0 1 1 0 3.5H7.282a2.126 2.126 0 1 0 0 1.25h6.593a3 3 0 1 0 0-6H6.313a1.75 1.75 0 1 1 0-3.5h6.405a2.126 2.126 0 1 0 0-1.25m1.157.625a.875.875 0 1 1 1.75 0 .875.875 0 0 1-1.75 0"})},i=(0,n(340498).wt)("pathRoundEnds",o)},780514:(e,t,n)=>{n.d(t,{q:()=>i});n(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"4.12 2.89 12.78 14.21",svg:(0,n(474848).jsx)("path",{d:"M5.375 14.972a.875.875 0 0 0 1.316.756l8.523-4.972a.875.875 0 0 0 0-1.512L6.69 4.272a.875.875 0 0 0-1.316.756zm1.946 1.835c-1.417.827-3.196-.195-3.196-1.835V5.028c0-1.64 1.78-2.662 3.196-1.835l8.523 4.971c1.406.82 1.406 2.851 0 3.672z"})},i=(0,n(340498).wt)("mediaPlay",o)},828973:(e,t,n)=>{n.d(t,{A:()=>y});n(898992),n(672577),n(581454);var o=n(296540),i=()=>n(726637),r=()=>n(56366),a=()=>n(496603),s=()=>n(284371),l=()=>n(760217),d=()=>n(939740),u=()=>n(417392),c=()=>n(89924),p=()=>n(722872),m=()=>n(553965),f=n(474848);const y=function({icon:e,iconStyle:t,title:y,selectedKey:g,onChange:h,onClick:x,popupStyle:b,menuItemOptionsStyle:v,menuStyle:k,disabled:S,collectionContextStore:I,openButtonPopup:C,hideCheck:M,children:w,disableParentClose:T,inputPlaceholder:A,renderSelectedKey:j,variant:P,...E}){const B="options"in E?E.options:a().Bq(E.sections),F=B.find((e=>a().n4(e.key,g))),R=(0,r().uB)(void 0,n(463830).A),D=(0,r().O$)(R).open;(0,o.useEffect)((()=>{I&&C&&(R.setState({...R.state,open:C}),I.settingsStore.setState({...I.settingsStore.state,openButtonPopup:void 0})),F||n(165358).log({level:"error",from:"CollectionSettingsPickListMenuItem",type:"InvalidSelectedItem",error:(0,n(229833).convertErrorToLog)("Selected key is invalid.")})}));const _=(0,n(401497).IS)((e=>({fullWidthButton:{backgroundColor:e.background.secondary,border:`1px solid ${e.gray.border.secondaryTranslucent}`,alignItems:"center",color:e.text.primary,fontWeight:s().Wy.regular},fullWidthButtonHover:{backgroundColor:(0,n(606712).R)({color:e.background.secondary,mode:e.mode})},popupWrapper:{margin:"12px 16px"},heading:{fontSize:i().A.isMobile?s().J.UISmall.mobile:s().J.UISmall.desktop,fontWeight:s().Wy.medium,color:e.text.secondary,marginBottom:12}})),[]),L=(0,f.jsx)(n(406699).A,{popupType:i().A.isMobile?u().nl.BottomSheet:u().nl.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",style:b,originGap:0,buttonPopupStore:R,disabled:S,onClick:x,renderOrigin:o=>{const i=function(e){const{renderSelectedKey:t,selectedKey:n,selectedOption:o}=e;return t?t(n):"input"===(null==o?void 0:o.type)?o.inputValue:"button"===(null==o?void 0:o.type)?o.title:void 0}({renderSelectedKey:j,selectedKey:g,selectedOption:F});return"fullWidth"===P?(0,f.jsx)(l().A,{icon:null==e?void 0:e({}),focused:!1,disabled:S,title:i,buttonStyle:{width:"100%",justifyContent:"space-between",..._.fullWidthButton},hoveredStyle:_.fullWidthButtonHover,right:S?void 0:(0,f.jsx)(n(252291).I,{icon:n(324254).arrowChevronSingleDownSmallIcon,size:"sm",colorVariant:"tertiary"}),...(0,m().A)(o,E)}):(0,f.jsx)(n(497222).A,{title:y,showChevron:!0,right:i,rotateChevron:D,disabled:S,icon:e,iconStyle:t,...(0,m().A)(o,E)})},render:e=>{let t;t=i().A.isMobile?{menuType:p().gu.ActionSheet}:{menuType:p().gu.Popup,width:250,...k};const o=(t,o)=>{if(t.hideOption)return null;let i;return i="input"===t.type?{key:o,render:o=>(0,f.jsx)(n(419357).Ay,{...o,style:{width:"100%",paddingTop:4,paddingBottom:4},value:t.inputValue??"",onChange:e=>{var n;null===(n=t.onChange)||void 0===n||n.call(t,e.target.value)},onSubmit:n=>{var o;null===(o=t.onSubmit)||void 0===o||o.call(t,t.key,e,t.inputValue),e.close()},placeholder:A,isChecked:!M&&a().n4(t.key,g)}),action:()=>{}}:{key:o,render:e=>(0,f.jsx)(l().A,{...e,disabled:!1,title:t.title,icon:t.icon,caption:t.caption,captionStyle:t.captionStyle,inline:t.captionInline,spacerStyle:t.inlineSpacerStyle,body:t.body,style:v,isChecked:!M&&a().n4(t.key,g)}),action:()=>{h(t.key,e),T||e.close()}},i},r="sections"in E?E.sections.map(((e,t)=>({key:t,render:e=>(0,f.jsx)(c().A,{enableActionSheetTitle:!0,topBorder:t>0,...e}),items:a().oE(e.map(o))}))):[{key:0,render:e=>(0,f.jsx)(c().A,{enableActionSheetTitle:!0,...e}),items:a().oE(B.map(o))}];return(0,f.jsxs)(n(404277).A,{...t,children:[(0,f.jsx)(d().Ay,{type:d().Oh.Vertical,sections:r,initialFocus:0,resetFocusOnMouseOut:!0}),w||null]})}});return"fullWidth"===P?(0,f.jsxs)("div",{style:_.popupWrapper,children:[(0,f.jsx)("div",{style:_.heading,children:y}),L]}):L}},871114:(e,t,n)=>{n.d(t,{o:()=>i});n(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"2.12 4.12 15.76 12.16",directional:!0,svg:(0,n(474848).jsx)("path",{d:"M16.625 8A2.625 2.625 0 0 0 14 5.375h-1.42a.625.625 0 1 1 0-1.25H14a3.875 3.875 0 0 1 0 7.75H4.259l3.333 3.333a.625.625 0 0 1-.884.884l-4.4-4.4a.625.625 0 0 1 0-.884l4.4-4.4a.625.625 0 0 1 .884.884l-3.333 3.333H14A2.625 2.625 0 0 0 16.625 8"})},i=(0,n(340498).wt)("arrowUTurnDownLeft",o)},915019:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(296540),i=n(474848);function r({store:e,...t}){const r=(0,o.useCallback)((t=>(0,i.jsx)(n(877349).y,{store:e,events:t})),[e]);return(0,i.jsx)(n(859428).A,{noStyle:!0,delayThreshold:400,placement:"bottom",alignment:"start",renderTooltip:r,...t})}const a=o.memo(r)},931077:(e,t,n)=>{n.d(t,{Q:()=>s});n(296540);var o=()=>n(484714),i=()=>n(401497),r=()=>n(494379),a=n(474848);function s(e){const{isMobile:t}=(0,o().Y0)(),n=(0,i().DP)();return(0,a.jsx)(r().Q,{...e,theme:n,isMobile:t})}}}]);