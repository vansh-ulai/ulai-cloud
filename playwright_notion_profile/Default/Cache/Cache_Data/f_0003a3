"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[70593,94814],{5580:(e,t,n)=>{n.d(t,{n:()=>i});var a=()=>n(56366),r=()=>n(209199),o=()=>n(765957);function i(){return(0,a().K8)((()=>{var e;const t=(null===(e=o().default.state.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.preferred_locale)??r().q;return(0,r().o_)(t)}),[])}},22634:(e,t,n)=>{n.d(t,{O:()=>o});n(296540);var a=n(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"4.42 3.97 12.16 12.06",directional:!0,svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"m5.492 4.158 5.4 5.4a.625.625 0 0 1 0 .884l-5.4 5.4a.625.625 0 1 1-.884-.884L9.566 10 4.608 5.042a.625.625 0 1 1 .884-.884"}),(0,a.jsx)("path",{d:"m16.392 10.442-5.4 5.4a.625.625 0 0 1-.884-.884L15.066 10l-4.958-4.958a.625.625 0 0 1 .884-.884l5.4 5.4a.625.625 0 0 1 0 .884"})]})},o=(0,n(340498).wt)("arrowChevronDoubleForward",r)},45313:(e,t,n)=>{n.d(t,{d:()=>r});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"2.27 4.37 15.45 11.25",directional:!0,svg:(0,n(474848).jsx)("path",{d:"M2.9 4.375a.625.625 0 0 0 0 1.25h14.2a.625.625 0 1 0 0-1.25zm0 3.333a.625.625 0 0 0 0 1.25h9.457a.625.625 0 1 0 0-1.25zM2.275 15c0-.345.28-.625.625-.625h9.457a.625.625 0 1 1 0 1.25H2.9A.625.625 0 0 1 2.275 15m.625-3.958a.625.625 0 1 0 0 1.25h14.2a.625.625 0 0 0 0-1.25z"})},r=(0,n(340498).wt)("textAlignLeft",a)},75318:(e,t,n)=>{n.d(t,{j:()=>o});n(296540);var a=n(474848);const r={viewBox:"0 0 16 16",fittedViewBox:"1.95 1.94 12.11 12.1",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M10 7.45a.55.55 0 1 1 0 1.1H6a.55.55 0 1 1 0-1.1z"}),(0,a.jsx)("path",{d:"M8 1.95a6.05 6.05 0 1 1 0 12.1 6.05 6.05 0 0 1 0-12.1m0 1.1a4.95 4.95 0 1 0 0 9.9 4.95 4.95 0 0 0 0-9.9"})]})},o=(0,n(340498).wt)("minusCircleSmall",r)},90244:(e,t,n)=>{n.d(t,{O:()=>o});n(296540);var a=n(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"0.73 3.36 18.53 13.28",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M13.004 6.123a3.588 3.588 0 0 1 6.175.032.624.624 0 1 1-1.079.63 2.338 2.338 0 0 0-4.024-.02L9.264 14.8l3.682.596a.626.626 0 0 1-.2 1.235l-4.591-.744a.625.625 0 0 1-.436-.939zm-8.269 6.688a.625.625 0 1 1 0 1.25H1.36a.625.625 0 0 1 0-1.25zM6.079 9.53a.625.625 0 0 1 0 1.25H1.36a.625.625 0 0 1 0-1.25z"}),(0,a.jsx)("path",{d:"M14.146 8.918a1.061 1.061 0 1 1 2.095.34 1.061 1.061 0 0 1-2.095-.34m-5.59-.906a1.061 1.061 0 1 1 2.095.34 1.061 1.061 0 0 1-2.095-.34M5.235 6.249a.625.625 0 1 1 0 1.25H1.36a.625.625 0 0 1 0-1.25zm2.188-1.974a3.59 3.59 0 0 1 5.104.325.625.625 0 0 1-.944.82 2.34 2.34 0 0 0-3.326-.213.625.625 0 0 1-.834-.932"})]})},o=(0,n(340498).wt)("aiDescription",r)},94701:(e,t,n)=>{n.r(t),n.d(t,{checkmarkFillIcon:()=>r,iconDefinition:()=>a});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"3.66 3.66 12.68 12.68",svg:(0,n(474848).jsx)("path",{d:"M15.913 3.787a.875.875 0 0 1 .3 1.2L9.658 15.914a.875.875 0 0 1-1.415.119l-4.37-5.098a.875.875 0 0 1 1.329-1.14l3.58 4.177 5.93-9.884a.875.875 0 0 1 1.2-.3"})},r=(0,n(340498).wt)("checkmarkFill",a)},126912:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>a,xMarkCircleFillSmallIcon:()=>r});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"1.95 1.94 12.11 12.1",svg:(0,n(474848).jsx)("path",{d:"M8 1.95a6.05 6.05 0 1 0 0 12.1 6.05 6.05 0 0 0 0-12.1m2.289 3.761a.55.55 0 0 1 0 .778L8.778 8l1.511 1.511a.55.55 0 0 1-.778.778l-1.51-1.511-1.512 1.51a.55.55 0 1 1-.778-.777L7.222 8l-1.51-1.511a.55.55 0 1 1 .777-.778L8 7.222l1.511-1.51a.55.55 0 0 1 .778 0"})},r=(0,n(340498).wt)("xMarkCircleFillSmall",a)},135428:(e,t,n)=>{n.d(t,{Vj:()=>s,ax:()=>l,iI:()=>d,iw:()=>i,u3:()=>o,uJ:()=>c});n(898992),n(354520),n(581454),n(737550);var a=()=>n(906745),r=()=>n(604995);const o="–",i=" ";function s({start:e,end:t,locale:n,timeZone:r}){const s=a().c9.fromISO(e),d=a().c9.fromISO(t),c=function({start:e,end:t}){const n=t.diff(e);if(n.as("hours")>12)return!0;const a=e.hour<12,r=t.hour<12;return a!==r}({start:s,end:d}),u=l({time:s,showAmPm:c,locale:n,timeZone:r}),g=l({time:d,showAmPm:!0,locale:n,timeZone:r});return`${u}${i}${o}${i}${g}`}function l({time:e,showAmPm:t,locale:n,timeZone:o}){const s=d(n),l=0!==e.minute||!s,c={...a().c9.TIME_SIMPLE,hour:"numeric",minute:l?"2-digit":void 0,timeZone:(0,r().lW)(o)};return s&&!t?e.setLocale(n).toLocaleParts(c).filter((e=>"dayPeriod"!==e.type)).map((e=>e.value.trim())).join(""):e.toLocaleString({...c,hour12:s},{locale:n}).replace(" ",i)}const d=(0,n(496603).Bj)((function(e){return a().c9.fromObject({hour:13}).setLocale(e).toLocaleParts(a().c9.TIME_SIMPLE).some((e=>"dayPeriod"===e.type))}));function c({time:e,locale:t,timeZone:n}){const o=d(t);return e.toLocaleString({...a().c9.DATETIME_MED,hour:"numeric",minute:"2-digit",year:void 0,month:void 0,day:void 0,timeZone:(0,r().lW)(n),hour12:o},{locale:t}).replaceAll(" ",i)}},155382:(e,t,n)=>{n.d(t,{$5:()=>A,I:()=>w,PA:()=>S,WM:()=>x,eb:()=>M,ji:()=>I,pg:()=>j,yX:()=>y});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(581454);var a=n(296540),r=()=>n(56366),o=()=>n(401497),i=()=>n(365646),s=()=>n(687249),l=()=>n(800204),d=()=>n(395797),c=()=>n(179034),u=()=>n(519831),g=()=>n(155792),p=()=>n(743246),h=()=>n(496603),m=()=>n(534177),f=()=>n(369955),v=()=>n(531550);function y(e,t){const n=[];for(const a of e){const e=x(a.toolType),r=S(a,t);if(e)for(const t of r)t.table===c().ev&&n.push({recordPointer:t,agentAction:e})}return n}function S(e,t){if(!e||!e.result||!(0,h().Qd)(e.result))return[];const{result:n}=e;if("appId"in n&&"string"==typeof n.appId)return[{table:c().ev,id:n.appId}];if("pageId"in n&&"string"==typeof n.pageId)return[{table:c().ev,id:n.pageId}];if("collectionViewBlockId"in n&&"string"==typeof n.collectionViewBlockId)return[{table:c().ev,id:n.collectionViewBlockId}];if("pageIds"in n&&Array.isArray(n.pageIds))return n.pageIds.map((e=>({table:c().ev,id:e})));if("workflowId"in n&&"string"==typeof n.workflowId&&t)return[{table:p().C0,id:n.workflowId,spaceId:t}];if("entities"in n){return function(e){const t=[];for(const n of e){const e=(0,s().dw)(n);e&&t.push(e)}return h().hS(t,(e=>`${e.table}-${e.id}`))}(n.entities)}return(0,i().gY)(e,"query-data-sources")&&e.result.collectionIds?e.result.collectionIds.map((e=>({id:e,table:u().Vl}))):[]}function x(e){switch(e){case"create-database":case"create-pages":case"create-agent":return"create";case"update-database":case"update-database-data-sources":case"update-database-views":case"update-database-triggers":case"update-page":case"update-user-integrations":case"toggle-user-integration-tools":case"update-agent":return"update";case"delete-pages":case"delete-agent":return"delete";case"search":case"view":case"view-version-history":case"view-database-files":case"query-data-sources":case"error":case"result":case"edit-json":case"spawn-agent":case"query-salesforce-tool":case"mcpServer.getPrompt":case"mcpServer.listPrompts":case"mcpServer.listResources":case"mcpServer.readResource":case"mcpServer.runTool":case"slack.addReactionToMessage":case"slack.createThreadInChannel":case"slack.createThreadInDirectMessage":case"slack.findUserByEmail":case"slack.getThreadsInChannelSince":case"slack.getUser":case"slack.parseSlackMessageUrlToId":case"slack.queryChannels":case"slack.removeReactionFromMessage":case"slack.replyInThread":case"slack.updateMessage":case"pipedream.action":case"github.getPullRequest":case"github.getUser":case"github.listPullRequests":case"github.listOrganizationRepositories":case"github.parseGithubUrlToParts":case"notion.addCommentToDiscussion":case"notion.addCommentToPage":case"notion.getPageDiscussions":case"notion.sendNotification":case"codegen.run":case"codegen.runStatus":case"calendar.runTool":case"calendar.fetchPlaybook":case"mail.runTool":case"mail.getPrompt":case"files.getFileContent":case"files.getFileName":case"files.getFileUrl":case"zendesk.addComment":case"zendesk.addTicket":case"zendesk.getComments":case"zendesk.getTicket":case"zendesk.updateTicket":return;default:(0,m().HB)(e)}}const b=new Set,C={operationsToUndo:n(415622).Pc,hasUndoneOperations:!1,stepsWithOperationsToUndo:b};function I({diffResultSteps:e,threadStore:t}){var n;const a=Boolean((0,f().L)()),o=null===(n=(0,f().L)())||void 0===n?void 0:n.id;return(0,r().K8)((()=>{if(!a||!o)return C;const n=[],r=new Map;for(const a of e.slice().reverse()){if(!a)continue;const e=v().X.createChildStore(t,{table:g().mS,id:a.id,spaceId:o});for(const t of e.getThreadOperationStores())n.push(t),r.set(t,a)}if(0===n.length)return C;const i=[],s=new Set;let l=!1;for(const e of n){const t=e.getKeyValue("userAction"),n=e.getKeyValue("invertedOperations")??[];if("undo"===t)l=!0;else{i.push(...n);const t=r.get(e);t&&s.add(t)}}return 0!==i.length||l||0!==s.size?{operationsToUndo:i,hasUndoneOperations:l,stepsWithOperationsToUndo:s}:C}),[e,a,o,t],{useDeepEqual:!0})}function w({runningInference:e,toolResultStep:t,isLastTurn:n}){return!!e&&(t?!(0,d().nP)(t):n)}function M(e){return Boolean(e.error)&&e.error!==l().p9}function A(e){return(0,o().IS)((t=>({animationStyle:{opacity:e?1:0,transition:"opacity 800ms ease-in-out"}})),[e]).animationStyle}const k=100;function j({numItems:e,animateIndexOffset:t=0,disableAnimation:n=!1,onAllAnimationsComplete:r}){const[o,i]=(0,a.useState)(new Set),s=(0,a.useMemo)((()=>[...Array(e).keys()]),[e]);return(0,a.useEffect)((()=>{if(n)return i(new Set(s)),void(r&&r());for(const n of s){setTimeout((()=>{i((t=>{const a=new Set(t).add(n);return a.size===e&&r&&setTimeout(r,100),a}))}),(n+t)*k+200)}}),[t,s,n,e,r]),o}},157188:(e,t,n)=>{n.d(t,{g:()=>S,M:()=>x});var a=n(296540),r=()=>n(484714),o=()=>n(56366),i=()=>n(401497),s=()=>n(878456),l=()=>n(607567),d=n(474848);const c={viewBox:"0 0 20 20",fittedViewBox:"3.37 0.43 13.25 16.44",svg:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("path",{d:"M10.417.62a.625.625 0 0 0-.884 0l-2.5 2.5a.625.625 0 1 0 .884.884l1.458-1.458V11a.625.625 0 1 0 1.25 0V2.596l1.408 1.408a.625.625 0 1 0 .884-.883z"}),(0,d.jsx)("path",{d:"M8.125 5.125H5.5A2.125 2.125 0 0 0 3.375 7.25v7.5c0 1.174.951 2.125 2.125 2.125h9a2.125 2.125 0 0 0 2.125-2.125v-7.5A2.125 2.125 0 0 0 14.5 5.125h-2.625V11a1.875 1.875 0 0 1-3.75 0z"})]})};(0,n(340498).wt)("squareAndArrowUpFill",c);var u=()=>n(69708),g=()=>n(231297),p=()=>n(107527),h=()=>n(118078),m=()=>n(285790),f=()=>n(859428),v=()=>n(46986),y=()=>n(441912);function S(e){const{clientStore:t,aiChatFeatureController:n}=e,s=(0,u().tz)(),c=(0,r().v3)(),g=(0,a.useCallback)((()=>{const e=!t.state.showDebug;!0===e&&(0,h().ensureChatSidebarSupportsDebugMode)(c),t.setState({...t.state,showDebug:e})}),[t,c]),p=(0,o().K8)((()=>(0,v().Ke)()),[]),y="agent_mobile"===n.aiChatType,S=(0,o().K8)((()=>t.state.showDebug),[t]),x=(0,i().IS)((e=>({icon:{fill:S?e.blue.icon.accentPrimary:e.icon.primary}})),[S]);return!p||y?null:(0,d.jsx)(f().A,{renderTooltip:()=>(0,d.jsx)(u().sA,{id:"aiChatView.debugTooltip",defaultMessage:"Debug"}),render:e=>(0,d.jsx)(m().A,{...e,icon:l().Z,iconStyle:{width:20,height:20,...x.icon},colorPalette:S?"blue":void 0,ariaLabel:s.formatMessage({id:"aiInferenceTranscript.debug",defaultMessage:"Debug"}),onClick:g})})}function x(e){const{threadStore:t,aiChatFeatureController:n}=e,i=(0,r().v3)(),l=((0,u().tz)(),(0,o().K8)((()=>{var e;return(null==t||null===(e=t.getData())||void 0===e?void 0:e.shared_with_space)??!1}),[t]));(0,a.useCallback)((()=>{t&&g().createAndCommit({userAction:"AgentChatDebugButtons.toggleShareWithSpace",environment:i,canUndo:!0,perform:e=>{(0,p().g6)({threadStore:t,transaction:e})}})}),[t,i]),(0,o().K8)((()=>t&&!t.canEdit()),[t]),(0,o().K8)((()=>(0,s().q1)((null==t?void 0:t.getTranscript())??[])),[t]),(0,y().useIconButtonStyles)({shape:n.headerButtonShape,active:l,aiChatFeatureController:n});return null}},170350:(e,t,n)=>{n.r(t),n.d(t,{filterIcon:()=>r,iconDefinition:()=>a});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.87 15.25 10.25",svg:(0,n(474848).jsx)("path",{d:"M3 4.875a.625.625 0 1 0 0 1.25h14a.625.625 0 1 0 0-1.25zm2.125 5.742h9.75a.625.625 0 1 0 0-1.25h-9.75a.625.625 0 1 0 0 1.25m1.5 3.883c0-.345.28-.625.625-.625h5.5a.625.625 0 1 1 0 1.25h-5.5a.625.625 0 0 1-.625-.625"})},r=(0,n(340498).wt)("filter",a)},200582:(e,t,n)=>{n.d(t,{m:()=>r});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"4.62 1.77 10.75 15.98",svg:(0,n(474848).jsx)("path",{d:"M11.633 1.812c.263.096.43.354.41.632l-.392 5.51h3.099a.625.625 0 0 1 .506.992l-6.18 8.54a.625.625 0 0 1-1.13-.412l.402-5.5H5.25a.625.625 0 0 1-.507-.99l6.17-8.55a.625.625 0 0 1 .72-.222m-5.161 8.513H9.02a.625.625 0 0 1 .623.67l-.29 3.976 4.173-5.766H10.98a.625.625 0 0 1-.623-.67l.284-3.987z"})},r=(0,n(340498).wt)("lightning",a)},205557:(e,t,n)=>{n.d(t,{Q:()=>r});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"3.96 1.38 8.07 13.24",svg:(0,n(474848).jsx)("path",{d:"M8 1.385c-2.23 0-4.035 1.793-4.035 3.985 0 .782.193 1.525.56 2.147.09.161.181.312.281.473.454.725.86 1.386.86 2.08a.63.63 0 0 0 .624.625.63.63 0 0 0 .625-.625c.01-1.064-.553-1.972-1.041-2.75l-.27-.448a3 3 0 0 1-.389-1.512C5.215 3.853 6.46 2.625 8 2.625s2.785 1.228 2.785 2.735c0 .558-.137 1.084-.39 1.512l-.269.449-.01.016c-.475.773-1.03 1.675-1.03 2.723a.63.63 0 0 0 .55.62v.015h.074a.63.63 0 0 0 .625-.625c0-.684.406-1.355.859-2.08v-.002l.001-.001q.067-.117.139-.233t.141-.237c.367-.622.56-1.365.56-2.147 0-2.202-1.815-3.985-4.035-3.985m-1.6 10.19a.63.63 0 0 0-.625.625.63.63 0 0 0 .625.625h3.2a.63.63 0 0 0 .625-.625.63.63 0 0 0-.625-.625zm.8 1.8a.63.63 0 0 0-.625.625.63.63 0 0 0 .625.625h1.6A.63.63 0 0 0 9.425 14a.63.63 0 0 0-.625-.625z"})},r=(0,n(340498).wt)("lightBulbBrightSmall",a)},256499:(e,t,n)=>{n.r(t),n.d(t,{ChatSidebarModeButton:()=>R,ChatSidebarModeButtonPopupContents:()=>P,getChatSidebarModeOptions:()=>_});n(944114),n(581454);var a=n(296540),r=()=>n(59226),o=()=>n(726637),i=()=>n(484714),s=()=>n(56366),l=()=>n(252291),d=()=>n(419942),c=()=>n(69708),u=()=>n(496603),g=()=>n(36951),p=()=>n(441912),h=()=>n(760217),m=()=>n(406699),f=()=>n(285790),v=()=>n(404277),y=()=>n(939740),S=()=>n(417392),x=()=>n(89924),b=()=>n(859428),C=()=>n(722872),I=()=>n(369955),w=()=>n(118078),M=()=>n(890754),A=()=>n(817343),k=()=>n(590027),j=n(474848);const T=(0,c().YK)({switchMode:{id:"chatSidebar.switchMode.button",defaultMessage:"Switch chat mode"},fullscreen:{id:"chatSidebar.fullscreen.button",defaultMessage:"Full screen"}});function R(e){const{aiChatFeatureController:t}=e,n=(0,c().tz)(),a=(0,s().K8)((()=>k().MU.state.chatSidebarMode),[]),r=_(),o=(0,p().useIconButtonStyles)({shape:t.headerButtonShape,aiChatFeatureController:t});return t.supportsChatSidebarModes?(0,j.jsx)(m().A,{popupType:S().nl.Popup,alignmentToOrigin:"center",placementToOrigin:"bottom",style:{minWidth:190},originGap:0,renderOrigin:e=>(0,j.jsx)(b().A,{renderTooltip:()=>(0,j.jsx)(c().sA,{...T.switchMode}),render:t=>(0,j.jsx)(f().A,{...e,...t,icon:()=>(0,j.jsx)(l().I,{icon:(0,A().Nq)(a)}),style:o.iconButton,ariaLabel:n.formatMessage(T.switchMode),testId:"switch-chat-mode-button"})}),render:e=>(0,j.jsx)(P,{parent:e,options:r})}):null}function P(e){const{options:t,parent:n,onSelectMode:p}=e,m=(0,i().v3)(),f=(0,I().L)(),S=(0,s().K8)((()=>k().MU.state.chatSidebarMode),[]);let b;b=o().A.isMobile?{menuType:C().gu.ActionSheet}:{menuType:C().gu.Popup,width:220};const A=(0,a.useCallback)((e=>{(0,w().setChatSidebarMode)({environment:m,chatSidebarMode:e,trackAnalytics:!0,saveUserPreference:!0}),n.close(),requestAnimationFrame((()=>{null==p||p(e)}))}),[n,p,m]),R=(0,c().tz)(),P=(0,r().X)("agent_popup_fs"),_=(0,s().K8)((()=>t.map(((e,t)=>{const n=e.key,a={key:t,render:t=>(0,j.jsx)(h().A,{...t,disabled:!1,title:e.title,icon:e.icon,isChecked:u().n4(e.key,S)}),action:()=>A(n)};return a}))),[t,S,A]),E=(0,s().K8)((()=>{const e=(0,M().getChatSidebarRouteData)(m),t=f&&e?(0,M().threadStoreGivenRouteData)({spaceStore:f,chatSidebarRouteData:e}):void 0;return{key:0,render:e=>(0,j.jsx)(h().A,{...e,disabled:!1,title:R.formatMessage(T.fullscreen),icon:(0,j.jsx)(l().I,{icon:d().o}),isChecked:!1}),action:()=>{(0,g().VK)({environment:m,oldThreadStore:t,newThreadStore:t}),n.close()}}}),[R,n,m,f]),D=(0,a.useMemo)((()=>{const e=[{key:"panel",render:e=>(0,j.jsx)(x().A,{enableActionSheetTitle:!0,...e}),items:_}];return P&&e.push({key:"fullscreen",render:e=>(0,j.jsx)(x().A,{topBorder:!0,...e}),items:[E]}),e}),[P,_,E]);return(0,j.jsx)(v().A,{...b,children:(0,j.jsx)(y().Ay,{type:y().Oh.Vertical,sections:D,initialFocus:0})})}function _(){return["sidebar","popup"].map((e=>({key:e,type:"button",title:(0,A().zc)(e),icon:(0,j.jsx)(l().I,{icon:(0,A().Nq)(e)})})))}},300985:(e,t,n)=>{n.d(t,{Z:()=>r});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"2.49 2.37 15.01 15.25",svg:(0,n(474848).jsx)("path",{d:"M7.154 3.625h1.23a.625.625 0 1 0 0-1.25h-1.23A2.625 2.625 0 0 0 4.529 5v2.069c0 .9-.508 1.722-1.313 2.124l-.317.159a.725.725 0 0 0 0 1.297l.317.158a2.38 2.38 0 0 1 1.313 2.124V15a2.625 2.625 0 0 0 2.625 2.625h1.23a.625.625 0 1 0 0-1.25h-1.23c-.76 0-1.375-.616-1.375-1.375v-2.069c0-1.17-.564-2.256-1.492-2.931a3.63 3.63 0 0 0 1.492-2.931V5c0-.76.615-1.375 1.375-1.375m5.692 12.75h-1.23a.625.625 0 1 0 0 1.25h1.23A2.625 2.625 0 0 0 15.471 15v-2.069c0-.9.508-1.722 1.313-2.124l.317-.159a.725.725 0 0 0 0-1.296l-.317-.159a2.38 2.38 0 0 1-1.313-2.124V5a2.625 2.625 0 0 0-2.625-2.625h-1.23a.625.625 0 1 0 0 1.25h1.23c.76 0 1.375.616 1.375 1.375v2.069c0 1.17.564 2.256 1.492 2.931a3.63 3.63 0 0 0-1.492 2.931V15c0 .76-.615 1.375-1.375 1.375"})},r=(0,n(340498).wt)("curlyBraces",a)},310818:(e,t,n)=>{n.d(t,{Sn:()=>s,aG:()=>i});var a=n(296540),r=n(474848);const o=(0,a.createContext)(void 0);function i({children:e,store:t}){return(0,r.jsx)(o.Provider,{value:t,children:e})}function s(){return(0,a.useContext)(o)}o.displayName="AgentThreadListContext"},370910:(e,t,n)=>{n.r(t),n.d(t,{AgentChatActions:()=>Z});var a=n(296540),r=()=>n(401497),o=()=>n(859384),i=()=>n(69708),s=()=>n(285790),l=()=>n(35392),d=()=>n(859428),c=()=>n(157188),u=(n(16280),n(898992),n(823215),n(354520),n(672577),n(803949),n(581454),()=>n(366326)),g=()=>n(59226),p=()=>n(248140),h=()=>n(484714),m=()=>n(56366),f=()=>n(252291),v=()=>n(631524),y=()=>n(493552),S=()=>n(81986),x=()=>n(165358),b=()=>n(24126),C=()=>n(589222),I=()=>n(236262),w=()=>n(728272),M=()=>n(563452),A=()=>n(496603),k=()=>n(229833),j=()=>n(812182),T=()=>n(760217),R=()=>n(404277),P=()=>n(678553),_=()=>n(939740),E=()=>n(460292),D=()=>n(89924),B=()=>n(574036),z=()=>n(381678),L=()=>n(722872),F=()=>n(765957),U=()=>n(449851),V=()=>n(945109),O=()=>n(791256),W=()=>n(160992),N=()=>n(236690),K=()=>n(441912),H=()=>n(586988),$=n(474848);const Y={action:()=>{},key:"agent_integration_no_integrations",render:e=>(0,$.jsx)(P().Ay,{...e,title:(0,$.jsx)(i().sA,{id:"AgentChatSettingsMenu.AgentChatModulesSection.NoIntegrationsTitle",defaultMessage:"No integrations"})})};new(n(178624).R)({key:"agent_experimental_features_dismissed",namespace:n(553737).Bq,important:!1,trackingType:"preference"});function q(e){const{aiChatFeatureController:t,threadStore:n}=e,o=(0,K().useIconButtonStyles)({shape:t.headerButtonShape,aiChatFeatureController:t}),[l,c,g,h]=((0,r().IS)((e=>({container:{minWidth:240}})),[]),function(e){const t=(0,a.useContext)(u().p);if(!t)throw new Error("useFeatureGate must be used within a FeatureGateContextProvider");const n=G((0,W().K)(),e),{menuSection:r}=(0,H().r$)(),o=(0,a.useCallback)(((e,t)=>{if(e.featureGates.forEach((e=>{p().A.updateLocalOverrideGate(e,!t)})),!t)if("agent_automations"===e.id){const e=S().QT.find((e=>"custom_agents"===e.id));e&&e.featureGates.forEach((e=>{p().A.updateLocalOverrideGate(e,!0)}))}else if("experimental_integrations"===e.id){const e=S().QT.find((e=>"agent_integrations"===e.id));e&&e.featureGates.forEach((e=>{p().A.updateLocalOverrideGate(e,!0)}))}}),[]),s=S().QT.filter((e=>"default"===e.group)),l=(0,m().K8)((()=>s.map(((e,n)=>{const a=(0,S().MI)(e,(e=>t.withoutExposureLogging(e,!1)));return{action:()=>{},key:`agent_feature_gate_${n}`,render:t=>(0,$.jsx)(B().A,{...t,on:a,onClick:()=>o(e,a),title:e.label})}}))),[s,t,o]),d=S().QT.filter((e=>"advanced"===e.group)),c=(0,m().K8)((()=>d.map(((e,n)=>{const a=(0,S().MI)(e,(e=>t.withoutExposureLogging(e,!1)));return{action:()=>{},key:`agent_feature_gate_${n}`,render:t=>(0,$.jsx)(B().A,{...t,on:a,onClick:()=>o(e,a),title:e.label})}}))),[d,t,o]),g={items:l,key:"agent_feature_gates_default",render:e=>(0,$.jsx)(D().A,{...e,title:(0,$.jsx)(i().sA,{id:"AgentChatSettingsMenu.AgentFeatureGatesSection.Title",defaultMessage:"Experiments"})})},h={items:c,key:"agent_feature_gates_advanced",render:e=>(0,$.jsx)(D().A,{...e,loading:!1,title:(0,$.jsx)(i().sA,{id:"AgentChatSettingsMenu.AgentFeatureGatesSection.WildWestTitle",defaultMessage:"Wild west"})})};return[g,n,h,r]}(n)),f=((0,a.useCallback)((()=>{const e=(0,A().oE)([l,c,g,h]);return(0,$.jsx)(R().A,{menuType:L().gu.Popup,children:(0,$.jsx)(_().Ay,{initialFocus:void 0,sections:e,type:_().Oh.Vertical})})}),[l,c,g,h]),(0,i().tz)());(0,a.useCallback)((e=>(0,$.jsx)(d().A,{renderTooltip:()=>(0,$.jsx)(i().sA,{id:"agentChatView.experimentalSettingsTooltip",defaultMessage:"Experimental settings"}),render:t=>(0,$.jsx)(s().A,{...e,...t,icon:b().c,style:o.iconButton,iconStyle:o.iconButtonIcon,ariaLabel:f.formatMessage({id:"agentChatView.experimentalSettings",defaultMessage:"Experimental settings"})})})),[f,o.iconButton,o.iconButtonIcon]);return null}function G(e,t){const n=(0,i().tz)(),r=(0,h().v3)(),o=(0,m().K8)((()=>(0,z()._)(r)),[r]),l=(0,m().O$)(F().AppStoreSidebarSpaceStore),d=(0,m().O$)(F().AppStoreSidebarSpaceViewStore),[c,u]=(0,a.useState)(!1),[p,S]=(0,a.useState)(!1),b=(0,m().K8)((()=>!(0,O().OT)(t)),[t]),R=(0,m().K8)((()=>{const e=null==t?void 0:t.getTranscript();if(e){const{activeIntegrationPointers:t}=(0,M().It)(e);return t}}),[t]),_=(0,a.useMemo)((()=>R?new(w().d)(R):new(w().d)),[R]),L=(0,a.useCallback)((n=>()=>{d&&t&&o&&l&&n.isDefined()&&((0,V().Tn)({environment:r,spaceStore:l,spaceViewStore:d,threadStore:t,userStore:o,workflowModuleStore:n}),e.length<=1&&u(!1))}),[e.length,o,r,l,d,t]),W=(0,a.useCallback)((e=>n=>{if(!(d&&t&&o&&l&&e.isDefined()))return;const a=_.has(e.pointer);try{if(a)(0,V().lT)({environment:r,spaceStore:l,threadStore:t,userStore:o,workflowModuleModels:[e.getModel()]});else{const n=e.getModel();(0,V().TF)({environment:r,spaceStore:l,threadStore:t,userStore:o,workflowModuleModels:[n]})}}catch(i){x().log({from:"AgentChatExperimentalSettings",type:"toggleIntegrationError",level:"error",error:(0,k().convertErrorToLog)(i),data:{miscDataToConvertToString:{workflowModuleId:e.pointer.id}}})}}),[o,_,r,l,d,t]),K=(0,a.useCallback)((()=>{S(!0)}),[]),H=(0,m().K8)((()=>(0,A().oE)(e.map((e=>{const{workflowModuleStore:t}=e;if(!t.isDefined())return;const a=t.getDataStore().getKeyValue("name")??(0,$.jsx)(i().sA,{id:"AgentChatSettingsMenu.AgentChatModulesSection.UnknownModuleTitle",defaultMessage:"Unknown module"}),r=U().d.getIcon(t.getModuleType()),o=_.has(t.pointer);return{action:()=>{},key:`agent_integration_${e.workflowModuleStore.pointer.id}`,render:e=>c?(0,$.jsx)(P().Ay,{...e,icon:(0,$.jsx)(f().I,{icon:r}),right:(0,$.jsx)(s().A,{ariaLabel:n.formatMessage({defaultMessage:"Delete {moduleName} integration",id:"AgentChatSettingsMenu.AgentChatModulesSection.DeleteButtonTitle"},{moduleName:a}),icon:I().trashIcon,hasBackground:!0,onClick:L(t)}),title:a}):(0,$.jsx)(B().A,{...e,disabled:b,icon:(0,$.jsx)(f().I,{icon:r}),on:o,onClick:e=>{b?j().HK({title:n.formatMessage({id:"AgentChatSettingsMenu.IntegrationsSection.StartChatFirst",defaultMessage:"Start a conversation first"}),message:n.formatMessage({id:"AgentChatSettingsMenu.IntegrationsSection.StartChatFirstMessage",defaultMessage:"Send a message to the AI before enabling integrations"}),variant:"default",presentationType:"transient"}):W(t)(e)},title:a})}})))),[e,_,L,W,n,c,b]),q=(0,g().X)("workflows_mcp_server_module_available")?{action:K,key:"agent_change_module_add",render:e=>(0,$.jsx)(T().A,{...e,icon:(0,$.jsx)(E().Q,{colorPalette:"gray",colorVariant:"accentPrimary",iconGroup:C().h,variantName:"small"}),title:(0,$.jsx)(i().sA,{id:"AgentChatSettingsMenu.AgentChatModulesSection.AddModuleButtonTitle",defaultMessage:"Add MCP integration"})})}:void 0,G=(0,a.useCallback)((()=>{u((e=>!e))}),[]),X=H.length>0;if(!(0,g().X)("agent_integrations"))return;const Q=b?{action:()=>{},key:"agent_integration_help_text",render:e=>(0,$.jsx)(P().Ay,{...e,disabled:!0,title:(0,$.jsx)(y().D,{styleKey:"Caption/Regular",color:"secondary",children:(0,$.jsx)(i().sA,{id:"AgentChatSettingsMenu.IntegrationsSection.HelpText",defaultMessage:"Start a chat to toggle integrations"})})})}:void 0;return{items:(0,A().oE)([...X?[...H,q]:[Y,q],Q]),key:"agent_integrations",render:e=>(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(D().A,{...e,title:"Integrations",right:X?(0,$.jsx)(v().p,{colorPalette:"blue",size:"xs",onClick:G,children:c?(0,$.jsx)(i().sA,{id:"AgentChatSettingsMenu.AgentChatModulesSection.DoneButtonTitle",defaultMessage:"Done"}):(0,$.jsx)(i().sA,{id:"AgentChatSettingsMenu.AgentChatModulesSection.EditButtonTitle",defaultMessage:"Edit"})}):null}),p&&o&&d?(0,$.jsx)(N().x,{isOpen:p,onClose:()=>S(!1),spaceViewStore:d,currentUserPointer:o.pointer}):void 0]})}}const X=35,Q=28;function Z(e){const{threadStore:t,clientStore:n,aiChatFeatureController:r,onThreadChange:o,showOnHover:i}=e,[s,l]=a.useState(!1),d=r.supportsTallChatHeader?X:Q,u=i?{opacity:s?1:0,transition:"opacity 0.2s ease-in-out",pointerEvents:s?"auto":"none",height:d,display:"flex",alignItems:"center",gap:2}:{height:d,display:"flex",alignItems:"center",gap:2},g=(0,a.useCallback)((()=>{r.supportsChatActionsOnHover&&l(!0)}),[r.supportsChatActionsOnHover]),p=(0,a.useCallback)((()=>{r.supportsChatActionsOnHover&&l(!1)}),[r.supportsChatActionsOnHover]);return(0,$.jsxs)("div",{onMouseEnter:g,onMouseLeave:p,style:{display:"flex",alignItems:"center",gap:2},children:[(0,$.jsxs)("div",{style:u,children:[(0,$.jsx)(c().g,{aiChatFeatureController:r,clientStore:n}),(0,$.jsx)(q,{aiChatFeatureController:r,threadStore:t}),(0,$.jsx)(c().M,{aiChatFeatureController:r,threadStore:t})]}),(0,$.jsx)(J,{aiChatFeatureController:r,onNewChat:()=>o(void 0)})]})}function J(e){const{aiChatFeatureController:t,onNewChat:n}=e,a=(0,i().tz)(),c=(0,K().useIconButtonStyles)({shape:t.headerButtonShape,aiChatFeatureController:t}),u=(0,r().IS)((e=>({shortcutContainer:{display:"flex",alignItems:"center",gap:8},shortcut:{color:e.text.inverseSecondary}})),[]);return(0,$.jsx)(d().A,{renderTooltip:()=>(0,$.jsxs)("div",{style:u.shortcutContainer,children:[(0,$.jsx)(i().sA,{id:"aiChatView.newChatTooltip",defaultMessage:"New AI chat"}),(0,$.jsx)(l().A,{style:u.shortcut,name:"createAIChatThread"})]}),render:e=>(0,$.jsx)(s().A,{...e,icon:o().M,iconStyle:c.iconButtonIcon,style:c.iconButton,ariaLabel:a.formatMessage({id:"aiInferenceTranscript.newChat",defaultMessage:"New AI chat"}),onClick:n})})}},391435:(e,t,n)=>{n.d(t,{Z:()=>w});n(944114),n(898992),n(354520),n(581454);var a=n(296540),r=()=>n(564884),o=()=>n(484714),i=()=>n(401497),s=()=>n(529324),l=()=>n(644161),d=()=>n(185078),c=()=>n(69708),u=()=>n(778078),g=()=>n(722872),p=()=>n(760217),h=()=>n(419357),m=()=>n(404277),f=()=>n(939740),v=()=>n(64e3),y=()=>n(460292),S=()=>n(89924),x=()=>n(662971),b=n(474848);const C=1,I=(0,c().YK)({sourceLanguage:{id:"translation.languageMenuList.sourceLanguage",defaultMessage:"From"},selectLanguage:{id:"translation.languageMenuList.selectLanguage",defaultMessage:"To"},detectedLanguage:{id:"translation.languageMenuList.detectedLanguage",defaultMessage:"Detected language"},preferredLanguage:{id:"translation.languageMenuList.preferredLanguage",defaultMessage:"Preferred language"},languageSearchPlaceholder:{id:"translation.languageMenuList.languageSearchPlaceholder",defaultMessage:"Search languages…"}});function w(e){const{onSelectTargetLanguage:t,onSelectSourceLanguage:n,editorModeConfigTranslateState:s,sourceLanguage:d,detectedPageLanguage:u,preferredLanguage:g,subMenuPlacement:h,subMenuAlignment:m,pageId:v}=e,y=(0,o().v3)(),w=(0,c().tz)(),j="loading"===s.status,T=M(j),R=(0,i().IS)((e=>({menuItemSectionBottomBorder:{boxShadow:`${e.regularDividerColor} 0px 1px 0px`},...T})),[T]);(0,a.useEffect)((()=>{if("pre_activation"===s.status){const e=setTimeout((()=>{(0,r().u)({environment:y,event:{eventName:"translate_page_interaction",eventProperties:{type:"action_menu_rendered",page_id:v}}})}),750);return()=>clearTimeout(e)}}),[s.status,v,y]);const P=s.targetLanguage,_=k({disabled:j,filter:e=>d!==e,currentSelectedLanguage:s.targetLanguage,onSelectLanguage:e=>{t({targetLanguage:e})}});return(0,b.jsx)(f().Ay,{initialFocus:C,type:f().Oh.Vertical,disableInitialScroll:!0,sections:[{key:"sourceLanguage",render:e=>(0,b.jsx)(S().A,{...e,title:w.formatMessage(I.sourceLanguage),desktopTitleStyle:{marginInlineStart:2,marginInlineEnd:2},style:R.menuItemSectionBottomBorder}),items:[{key:d,render:(e,{onFocus:t})=>(0,b.jsx)(x().A,{...e,onFocus:t,disableDefaultClick:!0,placementToOrigin:h,alignmentToOrigin:m,renderOrigin:(e,t)=>(0,b.jsx)(p().A,{...e,disabled:j,buttonStyle:R.button,ref:t,title:w.formatMessage((0,l().Bj)(d)),caption:d===u?w.formatMessage(I.detectedLanguage):d===g?w.formatMessage(I.preferredLanguage):void 0}),renderExtension:e=>(0,b.jsx)(A,{disabled:j,extensionPopupButtonEvents:e,currentTargetLanguage:P,sourceLanguage:d,onSelectSourceLanguage:n})}),action:()=>{}}]},{key:"selectLanguage",render:e=>(0,b.jsx)(S().A,{...e,title:w.formatMessage(I.selectLanguage),desktopTitleStyle:{marginInlineStart:2,marginInlineEnd:2}}),items:_}]})}function M(e){return(0,i().IS)((t=>({button:{color:e?t.text.tertiary:t.text.primary}})),[e])}function A(e){const{extensionPopupButtonEvents:t,currentTargetLanguage:n,disabled:a,sourceLanguage:r,onSelectSourceLanguage:i}=e,{isMobile:s}=(0,o().Y0)(),l=k({disabled:a,filter:e=>e!==n,currentSelectedLanguage:r,onSelectLanguage:e=>{i({sourceLanguage:e})}}),d=s?{menuType:g().gu.ActionSheet,...t}:{menuType:g().gu.Popup,width:200,height:380,...t};return(0,b.jsx)(m().A,{...d,onClick:e=>{e.preventDefault()},children:(0,b.jsx)(f().Ay,{initialFocus:void 0,type:f().Oh.Vertical,sections:[{key:"originalLanguage",render:e=>(0,b.jsx)(S().A,{...e}),items:l}]})})}function k(e){const{disabled:t,filter:n,currentSelectedLanguage:r,onSelectLanguage:o}=e,i=(0,c().tz)(),[g,m]=(0,a.useState)(""),f=M(t),S=(0,a.useMemo)((()=>({key:"language-search-input",render:e=>(0,b.jsx)(h().Ay,{...e,disabled:t,placeholder:i.formatMessage(I.languageSearchPlaceholder),value:g,onChange:e=>m(e.target.value),focus:!0,inputLeft:(0,b.jsx)(y().Q,{iconGroup:s().C,colorPalette:"gray",colorVariant:"accentPrimary",variantName:"default"})}),action:()=>{}})),[g,t,i]),x=(0,a.useMemo)((()=>({key:"no-results",render:()=>(0,b.jsx)(v().A,{title:(0,b.jsx)(c().sA,{defaultMessage:"No results found",id:"TranslationLanguageMenuList.noResults"})}),action:()=>{}})),[]),C=(0,a.useMemo)((()=>{const e=[];for(const t of d().hr)if(n(t)){const n=i.formatMessage((0,l().Bj)(t));e.push({languageCode:t,languageName:n})}return e.sort(((e,t)=>e.languageName.localeCompare(t.languageName)))}),[n,i]),w=(0,a.useMemo)((()=>(0,u().Ay)(g,C,(({languageName:e})=>e.toLowerCase()))),[g,C]),A=(0,a.useMemo)((()=>w.map((({languageCode:e,languageName:n})=>({key:e,render:a=>(0,b.jsx)(p().A,{...a,buttonStyle:f.button,disabled:t,title:n,isChecked:r===e}),action:()=>{t||o(e)}})))),[w,t,r,o,f.button]);return 0===A.length?[S,x]:[S,...A]}},408580:(e,t,n)=>{n.d(t,{Hj:()=>r,Lc:()=>l,OZ:()=>i,d_:()=>s,rW:()=>o,uE:()=>a});const a=4,r=2,o=4,i=20,s=4,l=6},441912:(e,t,n)=>{n.r(t),n.d(t,{AgentChatView:()=>ln,useIconButtonStyles:()=>hn});n(16280),n(410838),n(944114),n(898992),n(823215),n(354520),n(672577),n(581454);var a=()=>n(203066),r=n(296540),o=()=>n(59226),i=()=>n(726637),s=()=>n(312788),l=()=>n(484714),d=()=>n(56366),c=()=>n(401497),u=()=>n(75435),g=()=>n(988083),p=()=>n(699143),h=()=>n(631524),m=()=>n(493552),f=()=>n(22634),v=()=>n(626466),y=()=>n(811525),S=()=>n(340498),x=()=>n(696706),b=()=>n(427704),C=()=>n(96689),I=()=>n(234459),w=()=>n(743246),M=()=>n(201980),A=()=>n(711059),k=()=>n(760342),j=()=>n(496703),T=()=>n(69708),R=()=>n(534177),P=()=>n(944584),_=()=>n(910302),E=()=>n(384944),D=()=>n(778417),B=()=>n(231297),z=()=>n(108184),L=()=>n(118078),F=()=>n(965454),U=()=>n(256499),V=()=>n(590027),O=()=>n(410930),W=()=>n(285790),N=()=>n(35392),K=()=>n(710149),H=()=>n(859428),$=()=>n(584535),Y=()=>n(581495),q=()=>n(200562),G=()=>n(112995),X=()=>n(650843),Q=()=>n(594794),Z=()=>n(475133),J=()=>n(272053),ee=()=>n(953418),te=()=>n(644914),ne=()=>n(765957),ae=()=>n(77246),re=()=>n(712505),oe=()=>n(177097),ie=()=>n(622936),se=(n(737550),()=>n(90244)),le=()=>n(607567),de=()=>n(551222),ce=()=>n(425940),ue=()=>n(671089),ge=n(474848);const pe={viewBox:"0 0 20 20",svg:(0,ge.jsxs)(ge.Fragment,{children:[(0,ge.jsx)("path",{d:"M8.04761 1.40332L8.29565 1.41797C9.5354 1.51917 10.7877 2.05748 11.5691 3.03418C12.4248 4.10414 12.576 5.59336 12.2527 6.84082C12.1648 7.17964 12.0368 7.51547 11.8699 7.83496C12.4573 7.95393 13.014 8.1496 13.5232 8.44336C14.1514 8.80586 14.6705 9.29599 15.0779 9.90723C15.4453 9.55352 15.8874 9.31134 16.3923 9.24805H16.3933C17.0674 9.16392 17.7001 9.43393 18.1248 9.95508C18.5282 10.4502 18.698 11.1051 18.698 11.79C18.698 12.8535 18.6409 14.7357 17.2517 16.2207C15.8442 17.7246 13.3476 18.5467 9.17065 18.2373C7.03585 18.0791 5.40971 17.5784 4.25854 16.792C3.08147 15.9878 2.43669 14.9037 2.28296 13.7256C2.05362 11.9659 2.93173 10.2243 4.21851 9.04883C3.75332 9.08904 3.22319 9.06701 2.60327 9.00293H2.60229C2.07328 8.94808 1.55858 8.78222 1.15112 8.47656L0.983154 8.33691C0.529882 7.91784 0.255671 7.2623 0.478271 6.55469C0.679436 5.91656 1.20941 5.4862 1.77222 5.2207C2.19407 5.0218 2.70477 4.87921 3.29761 4.79395C3.48184 4.15662 3.79961 3.54947 4.24194 3.01855C5.2426 1.81786 6.70976 1.35719 8.04761 1.40332Z",fill:"white",stroke:"white",strokeWidth:"1.2"}),(0,ge.jsx)("path",{d:"M2.71145 7.95867C0.896282 7.771 0.784523 5.97447 4.07815 5.7696C4.79543 6.02556 6.62315 6.09221 5.94924 6.85552C5.10685 7.80966 4.8839 8.18328 2.71145 7.95867Z",fill:"white",stroke:"black",strokeWidth:"1"}),(0,ge.jsx)("path",{d:"M9.24829 17.1903C1.14829 16.5903 2.64829 10.8903 5.94829 9.09026C3.84832 7.89022 3.66342 5.35224 5.04832 3.69029C6.54832 1.89022 9.54832 2.19024 10.7483 3.69024C11.9483 5.19024 11.3483 8.19021 9.24829 8.79026C12.2483 8.49026 14.3483 9.39026 14.9483 12.3903C15.5483 9.69026 17.6483 9.69019 17.6483 11.7902C17.6483 13.8902 17.3483 17.7903 9.24829 17.1903Z",fill:"#FFB110",stroke:"black",strokeWidth:"1",strokeLinejoin:"round"}),(0,ge.jsx)("path",{d:"M5.76867 6.1671C5.52984 5.87387 5.90069 4.67884 6.46816 5.14099C7.11453 5.6674 6.37472 6.91121 5.76867 6.1671Z",fill:"black"})]})},he=(0,S().wt)("duck",pe);var me=()=>n(876544),fe=()=>n(170350),ve=()=>n(212727),ye=()=>n(200582),Se=()=>n(594088),xe=()=>n(105819),be=()=>n(158469),Ce=()=>n(824375),Ie=()=>n(45313),we=()=>n(877235),Me=()=>n(42583),Ae=()=>n(421559),ke=()=>n(299545),je=()=>n(201718);const Te=(0,T().YK)({search:{defaultMessage:"Search for anything",id:"AgentSuggestedActions.search"},analyzePdfsOrImages:{defaultMessage:"Analyze PDFs or images",id:"AgentSuggestedActions.analyzePdfsOrImages"},summarizeCurrentProjects:{defaultMessage:"Summarize my current projects",id:"AgentSuggestedActions.summarizeProjects"},planATrip:{defaultMessage:"Help me plan a trip",id:"AgentSuggestedActions.planATrip"},draftProjectPlan:{defaultMessage:"Draft a project plan",id:"AgentSuggestedActions.draftProjectPlan"},translateThisPage:{defaultMessage:"Translate this page",id:"AgentSuggestedActions.translateThisPage"},summarizeThisPage:{defaultMessage:"Summarize this page",id:"AgentSuggestedActions.summarizeThisPage"},findActionItems:{defaultMessage:"Find action items",id:"AgentSuggestedActions.findActionItems"},makeMoreConcise:{defaultMessage:"Make this page shorter",id:"AgentSuggestedActions.makeMoreConcise"},createTaskTracker:{defaultMessage:"Create a task tracker",id:"AgentSuggestedActions.createTaskTracker"},brainstormWritingIdeas:{defaultMessage:"Brainstorm writing ideas",id:"AgentSuggestedActions.brainstormWritingIdeas"},writeMeetingAgenda:{defaultMessage:"Write meeting agenda",id:"AgentSuggestedActions.writeMeetingAgenda"},analyzePageForInsights:{defaultMessage:"Analyze for insights",id:"AgentSuggestedActions.analyzeForInsights"},analyzeDataForInsights:{defaultMessage:"Analyze data for insights",id:"AgentSuggestedActions.analyzeDataForInsights"},createChart:{defaultMessage:"Create a chart",id:"AgentSuggestedActions.createChart"},filterAndSortData:{defaultMessage:"Filter and sort data",id:"AgentSuggestedActions.filterAndSortData"},helpMeSetUpThisDatabase:{defaultMessage:"Help me set up this database",id:"AgentSuggestedActions.helpMeSetUpThisDatabase"},generateSampleRows:{defaultMessage:"Generate sample rows",id:"AgentSuggestedActions.generateSampleRows"},addEmojiTriggerToSlack:{defaultMessage:"Add an emoji trigger to Slack",id:"AgentSuggestedActions.addEmojiTriggerToSlack"},scheduleRecurringReport:{defaultMessage:"Schedule a recurring report",id:"AgentSuggestedActions.scheduleRecurringReport"},helpMeUpdateInstructions:{defaultMessage:"Help me update instructions",id:"AgentSuggestedActions.helpMeUpdateInstructions"},whatsNewInAgent:{defaultMessage:"What’s new in Notion AI",id:"AgentSuggestedActions.whatsNewInAgent"},personalizeYourNotionAI:{defaultMessage:"Personalize your Notion AI",id:"AgentSuggestedActions.personalizeYourNotionAI"},summarizeDiscussions:{defaultMessage:"Summarize page comments",id:"AgentSuggestedActions.summarizeDiscussions"}}),Re={search:{message:Te.search,icon:n(207207).J},summarize_current_projects:{message:Te.summarizeCurrentProjects,icon:Ie().d},plan_a_trip:{message:Te.planATrip,icon:ce().a},draft_project_plan:{message:Te.draftProjectPlan,icon:xe().pencilLineIcon},translate:{message:Te.translateThisPage,icon:we().textTranslateIcon},summarize:{message:Te.summarizeThisPage,icon:Ie().d},add_action_items:{message:Te.findActionItems,icon:ce().a},brainstorm_ideas:{message:Te.brainstormWritingIdeas,icon:Ce().sparklesIcon},make_more_concise:{message:Te.makeMoreConcise,icon:xe().pencilLineIcon},create_task_tracker:{message:Te.createTaskTracker,icon:ue().checkmarkCircleIcon},write_meeting_agenda:{message:Te.writeMeetingAgenda,icon:se().O},analyze_page_for_insights:{message:Te.analyzePageForInsights,icon:be().f},analyze_database_for_insights:{message:Te.analyzeDataForInsights,icon:be().f},visualize_with_a_chart:{message:Te.createChart,icon:de().q},filter_and_sort_data:{message:Te.filterAndSortData,icon:fe().filterIcon},help_me_set_up_this_database:{message:Te.helpMeSetUpThisDatabase,icon:ve().gearIcon},generate_sample_rows:{message:Te.generateSampleRows,icon:Se().A},add_emoji_trigger_to_slack:{message:Te.addEmojiTriggerToSlack,icon:ye().m},schedule_recurring_report:{message:Te.scheduleRecurringReport,icon:de().q},help_me_update_instructions:{message:Te.helpMeUpdateInstructions,icon:xe().pencilLineIcon},whats_new_in_agent:{message:Te.whatsNewInAgent,icon:n(680209).R},summarize_discussions:{message:Te.summarizeDiscussions,icon:n(107620).y}};function Pe(e){return Re[e]}function _e({store:e,hasCollectionContent:t,loadAttachmentData:n,handlePromptSubmit:a,intl:r,canShowPersonalizationSettingsModal:o,openFaceCustomizationModal:i,isAiLandingPage:s,enableWhatsNewEducationAction:l,agentCommentsEnabled:d}){if(e instanceof je().N)return function({handlePromptSubmit:e,intl:t}){return[{message:Te.addEmojiTriggerToSlack,icon:ye().m,prebuiltPromptType:"add_emoji_trigger_to_slack"},{message:Te.scheduleRecurringReport,icon:Me().D,prebuiltPromptType:"schedule_recurring_report"},{message:Te.helpMeUpdateInstructions,icon:xe().pencilLineIcon,prebuiltPromptType:"help_me_update_instructions"}].map((({message:n,icon:a,prebuiltPromptType:r})=>{const o=t.formatMessage(n);return{type:r,suggestedAction:o,icon:a,handleClick:()=>e({text:o,prebuiltPromptType:r})}}))}({handlePromptSubmit:a,intl:r});const c=s?Ee:null!=e&&e.isCollectionView()?function({hasCollectionContent:e}){if(e)return["search","analyze_database_for_insights","visualize_with_a_chart","filter_and_sort_data"];return["search","load_attachment","help_me_set_up_this_database","generate_sample_rows"]}({hasCollectionContent:t}):function({pageStore:e,agentCommentsEnabled:t}){if(function(e){if(void 0===e||e.isType("personal_home_page"))return!1;const t=e.getContentStores();if(0===t.length)return!1;return t.some((e=>!e.isEmptyTitle()||e.hasContent()))}(e)){const n=["summarize","translate","analyze_page_for_insights","create_task_tracker"];return t&&function(e){if(void 0===e)return!1;const t=ke().Bw(e,{recursivelyLoadAllDiscussions:!0});return t.length>0}(e)?["summarize","summarize_discussions","translate","create_task_tracker"]:n}return["search","write_meeting_agenda","load_attachment","create_task_tracker"]}({pageStore:e,agentCommentsEnabled:d}),u=c.map((e=>{if("load_attachment"===e)return function({loadAttachmentData:e,intl:t}){return e?{type:"load_attachment",suggestedAction:t.formatMessage(Te.analyzePdfsOrImages),icon:Be(Te.analyzePdfsOrImages),handleClick:()=>{e.uploadFiles()}}:void 0}({loadAttachmentData:n,intl:r});const{message:t,icon:o}=Pe(e),i=r.formatMessage(t);return{type:e,suggestedAction:i,icon:o,handleClick:()=>a({text:i,prebuiltPromptType:e}),isNew:De(e)}})).filter(R().O9);if(!s&&o&&i&&!function(){var e,t;const{sidebarSpaceViewStore:n}=ne().default.state,a=null==n||null===(e=n.getSettings())||void 0===e?void 0:e.agent_personalization_settings;return Boolean((null==a?void 0:a.name)||(null==a||null===(t=a.customization_items)||void 0===t?void 0:t.length))}()&&u.length>0&&(u[0]={type:"change_my_look",suggestedAction:r.formatMessage(Te.personalizeYourNotionAI),icon:he,handleClick:i,isNew:!0}),!s&&l&&u.length>0){const{message:e,icon:t}=Pe("whats_new_in_agent"),n=r.formatMessage(e),o={type:"whats_new_in_agent",suggestedAction:n,icon:t,handleClick:()=>a({text:n,prebuiltPromptType:"whats_new_in_agent"}),isNew:De("whats_new_in_agent")};u[u.length-1]=o}return u}const Ee=["whats_new_in_agent","write_meeting_agenda","load_attachment","create_task_tracker"];function De(e){switch(e){case"create_task_tracker":case"analyze_page_for_insights":case"analyze_database_for_insights":case"visualize_with_a_chart":case"filter_and_sort_data":case"help_me_set_up_this_database":case"generate_sample_rows":case"summarize_current_projects":case"plan_a_trip":case"draft_project_plan":case"whats_new_in_agent":case"summarize_discussions":return!0;case"search":case"summarize":case"translate":case"add_action_items":case"brainstorm_ideas":case"make_more_concise":case"write_meeting_agenda":case"load_attachment":case"add_emoji_trigger_to_slack":case"schedule_recurring_report":case"help_me_update_instructions":return!1;default:(0,R().HB)(e)}}function Be(e){switch(e.id){case"AgentSuggestedActions.analyzePdfsOrImages":return me().U;case"AgentSuggestedActions.summarizeThisPage":default:return Ie().d;case"AgentSuggestedActions.findActionItems":return ce().a;case"AgentSuggestedActions.makeMoreConcise":case"AgentSuggestedActions.helpMeUpdateInstructions":return xe().pencilLineIcon;case"AgentSuggestedActions.createTaskTracker":return ue().checkmarkCircleIcon;case"AgentSuggestedActions.brainstormWritingIdeas":return Ce().sparklesIcon;case"AgentSuggestedActions.writeMeetingAgenda":return se().O;case"AgentSuggestedActions.analyzeDataForInsights":return be().f;case"AgentSuggestedActions.createChart":return de().q;case"AgentSuggestedActions.enrichWithWebSearch":return le().Z;case"AgentSuggestedActions.filterAndSortData":return fe().filterIcon;case"AgentSuggestedActions.helpMeSetUpThisDatabase":return ve().gearIcon;case"AgentSuggestedActions.generateSampleRows":return Se().A;case"AgentSuggestedActions.customizeDatabaseViews":return Ae().T;case"AgentSuggestedActions.addEmojiTriggerToSlack":return ye().m;case"AgentSuggestedActions.scheduleRecurringReport":return Me().D}}var ze=()=>n(46986),Le=()=>n(704338),Fe=()=>n(107527),Ue=()=>n(36951),Ve=()=>n(600434),Oe=()=>n(791256),We=()=>n(555102),Ne=()=>n(160992),Ke=()=>n(144222);var He=()=>n(395797),$e=()=>n(890754),Ye=()=>n(865454);var qe=()=>n(235564),Ge=()=>n(837980),Xe=()=>n(701499),Qe=()=>n(557336),Ze=()=>n(370910),Je=()=>n(219348),et=()=>n(761894),tt=()=>n(601751),nt=()=>n(80294),at=()=>n(554283);function rt(e){const{aiChatFeatureController:t}=e,n=(0,l().v3)(),a=t.supportsUpdatingExistingPersonalizationSettings(),o=(0,r.useCallback)((e=>{e.stopPropagation(),a&&(0,Je().cP)({store:tt().r,from:"agent_chat_face",shouldSetSeenPersonalizationSettingsModal:!0,environment:n})}),[a,n]),[i,s]=(0,at().B)(),u=(0,c().IS)((()=>({faceContainer:{width:24,height:24,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",marginInlineStart:2,marginInlineEnd:4,transition:"transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1)"},hoveredFaceContainer:{transform:"scale(1.1)"}})),[]),g=(0,d().O$)(ne().AppStoreSidebarSpaceViewStore),p=(0,Je().DV)(g),h=(0,d().K8)((()=>{var e;if(!g)return;const t=null===(e=g.getSettings())||void 0===e?void 0:e.agent_personalization_settings;return(null==t?void 0:t.name)??void 0}),[g]),m=(0,r.useMemo)((()=>{const e=(0,nt().N)(p,h);return e||(0,ge.jsx)(T().sA,{id:"AgentChatHeader.personalize",defaultMessage:"Personalize"})}),[p,h]);return(0,ge.jsx)("div",{ref:i,style:{...u.faceContainer,...s?u.hoveredFaceContainer:{}},onClick:o,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),o(e))},role:"button",tabIndex:0,children:(0,ge.jsx)(H().A,{placement:"left",renderTooltip:()=>m,render:e=>(0,ge.jsx)(et().x,{variant:"xsmall_plus",accessory:p,...e})})})}var ot=()=>n(380801),it=()=>n(278589),st=()=>n(145214),lt=()=>n(155382),dt=()=>n(124092),ct=()=>n(687681),ut=()=>n(460292);const gt=(0,T().YK)({customizeTooltip:{id:"agentEmptyState.customizeTooltip",defaultMessage:"Personalize"}});function pt(e){const{aiChatFeatureController:t,selectedAccessory:n,isHoveringContainer:a}=e,[o,i]=(0,r.useState)(!1),s="single_line"===t.agentEmptyStateFormat,l="compact"===t.agentEmptyStateFormat,d="full_page"===t.agentChatFormFactor,u=s?32:l?40:d?64:50,g=s?"medium":l?"medium_large":"full_page"===t.agentChatFormFactor?"large_plus":"large",p=(0,c().IS)((e=>({faceWrapper:{position:"relative",display:"inline-block"},welcomeMessageFace:{width:u,height:u,borderRadius:"50%",backgroundColor:e.background.elevated,boxShadow:e.shadowSM,paddingInline:0,userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",pointerEvents:"auto",WebkitUserDrag:"none",userDrag:"none",touchAction:"manipulation",WebkitTouchAction:"manipulation"},customizeButton:{position:"absolute",bottom:4,insetInlineStart:"100%",marginInlineStart:-10,width:"auto",maxWidth:o?200:26,overflow:"hidden",height:26,borderRadius:13,backgroundColor:e.background.elevated,boxShadow:e.shadowMDPrimaryOutline,display:"flex",alignItems:"center",justifyContent:"start",opacity:a?1:0,transition:"all 200ms cubic-bezier(0.5, 1, 0.89, 1)",pointerEvents:a?"auto":"none",cursor:"pointer",paddingInlineStart:6,paddingInlineEnd:10,...s&&{maxWidth:20,width:20,height:20,bottom:2,marginInlineStart:-8,borderRadius:10,paddingInlineStart:4,paddingInlineEnd:4}},customizeIcon:{width:s?12:14,height:s?12:14,color:e.text.secondary},customizeText:{transition:"opacity 200ms ease-in-out",marginInlineStart:6,fontSize:12,color:e.text.secondary,whiteSpace:"nowrap"}})),[a,o,s,u]),h=t.supportsUpdatingExistingPersonalizationSettings(),m=(0,r.useCallback)((()=>{h&&Je().cP({store:tt().r,from:t.aiChatType,shouldSetSeenPersonalizationSettingsModal:!1})}),[h,t.aiChatType]),f=(0,r.useCallback)((e=>{e.preventDefault()}),[]),v=(0,r.useCallback)((e=>{e.stopPropagation()}),[]),y=(0,r.useCallback)((e=>{e.preventDefault(),e.stopPropagation()}),[]);return(0,ge.jsxs)("div",{style:p.faceWrapper,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[(0,ge.jsx)(dt().p,{style:p.welcomeMessageFace,onClick:m,onContextMenu:f,onTouchStart:v,onTouchEnd:y,disabled:!h,"aria-label":"Open personalization settings",children:(0,ge.jsx)(et().x,{accessory:n,variant:g})}),h?(0,ge.jsxs)("div",{style:p.customizeButton,onClick:m,role:"button",tabIndex:0,"aria-label":"Personalize assistant",children:[(0,ge.jsx)(ut().Q,{iconGroup:ct().u,variantName:"small",style:p.customizeIcon}),s?null:(0,ge.jsx)("div",{style:p.customizeText,children:(0,ge.jsx)(T().sA,{...gt.customizeTooltip})})]}):void 0]})}const ht=(0,T().YK)({welcomeMessage:{id:"agentChatView.welcomeMessageTitle",defaultMessage:"How can I help you today?"},safetyHatWelcomeMessage:{id:"agentChatView.safetyHatWelcomeMessage",defaultMessage:"Ready to work! Let me know what you need."},mustacheWelcomeMessage:{id:"agentChatView.mustacheWelcomeMessage",defaultMessage:"How may I be of service?"},headphoneWelcomeMessage:{id:"agentChatView.headphoneWelcomeMessage",defaultMessage:"How can I help you today?"},flowerWelcomeMessage:{id:"agentChatView.flowerWelcomeMessage",defaultMessage:"What can I brighten up for you today?"},pencilWelcomeMessage:{id:"agentChatView.pencilWelcomeMessage",defaultMessage:"What are we sketching out first?"},paprikaWelcomeMessage:{id:"agentChatView.paprikaWelcomeMessage",defaultMessage:"Spice it up — what do you need?"},duckWelcomeMessage:{id:"agentChatView.duckWelcomeMessage",defaultMessage:"Quack! What’s the plan?"},catWelcomeMessage:{id:"agentChatView.catWelcomeMessage",defaultMessage:"Meow… what’s your request?"},crownWelcomeMessage:{id:"agentChatView.crownWelcomeMessage",defaultMessage:"What royal service do you require?"},cowboyWelcomeMessage:{id:"agentChatView.cowboyWelcomeMessage",defaultMessage:"What can I wrangle up for ya?"},leafWelcomeMessage:{id:"agentChatView.leafWelcomeMessage",defaultMessage:"What’s our quest today?"},magicianWelcomeMessage:{id:"agentChatView.magicianWelcomeMessage",defaultMessage:"What magic shall we make happen?"},bowWelcomeMessage:{id:"agentChatView.bowWelcomeMessage",defaultMessage:"What can I tie up nicely for you?"},cherryWelcomeMessage:{id:"agentChatView.cherryWelcomeMessage",defaultMessage:"How can I help you today?"},propellerWelcomeMessage:{id:"agentChatView.propellerWelcomeMessage",defaultMessage:"Where are we off to first?"},firefighterWelcomeMessage:{id:"agentChatView.firefighterWelcomeMessage",defaultMessage:"On call and ready, how can I help?"},scarfWelcomeMessage:{id:"agentChatView.scarfWelcomeMessage",defaultMessage:"What can I do for you?"},seasonalOctober25WelcomeMessage:{id:"agentChatView.seasonalOctober25WelcomeMessage",defaultMessage:"What shall I conjure for you?"}});function mt(e){const{selectedAccessory:t,agentEmptyStateFormat:n,textSize:a="default"}=e,o="centered"===n,i="single_line"===n,s="compact"===n,l=(0,c().IS)((()=>({welcomeMessageTitle:{fontSize:17,lineHeight:1.3,fontWeight:600,paddingInline:8,...i&&{textAlign:"start",flexShrink:0},...o&&{textAlign:"center"}},welcomeMessageTitleLarge:{fontSize:30,lineHeight:1.2,fontWeight:600,paddingInline:8,...i&&{textAlign:"start",flexShrink:0},...o&&{textAlign:"center"}}})),[o,i]),d=(0,r.useMemo)((()=>{if(!t)return(0,ge.jsx)(T().sA,{...ht.welcomeMessage});switch(t){case"safety-hat":return(0,ge.jsx)(T().sA,{...ht.safetyHatWelcomeMessage});case"mustache":return(0,ge.jsx)(T().sA,{...ht.mustacheWelcomeMessage});case"headphone":return(0,ge.jsx)(T().sA,{...ht.headphoneWelcomeMessage});case"flower":return(0,ge.jsx)(T().sA,{...ht.flowerWelcomeMessage});case"pencil":return(0,ge.jsx)(T().sA,{...ht.pencilWelcomeMessage});case"paprika":return(0,ge.jsx)(T().sA,{...ht.paprikaWelcomeMessage});case"duck":return(0,ge.jsx)(T().sA,{...ht.duckWelcomeMessage});case"cat":return(0,ge.jsx)(T().sA,{...ht.catWelcomeMessage});case"crown":return(0,ge.jsx)(T().sA,{...ht.crownWelcomeMessage});case"cowboy":return(0,ge.jsx)(T().sA,{...ht.cowboyWelcomeMessage});case"leaf":return(0,ge.jsx)(T().sA,{...ht.leafWelcomeMessage});case"magician":return(0,ge.jsx)(T().sA,{...ht.magicianWelcomeMessage});case"bow":return(0,ge.jsx)(T().sA,{...ht.bowWelcomeMessage});case"cherry":return(0,ge.jsx)(T().sA,{...ht.cherryWelcomeMessage});case"propeller":return(0,ge.jsx)(T().sA,{...ht.propellerWelcomeMessage});case"firefighter":return(0,ge.jsx)(T().sA,{...ht.firefighterWelcomeMessage});case"scarf":return(0,ge.jsx)(T().sA,{...ht.scarfWelcomeMessage});case"seasonal-bat":case"seasonal-demon":case"seasonal-frankenstein":case"seasonal-pumpkin":return(0,ge.jsx)(T().sA,{...ht.seasonalOctober25WelcomeMessage});default:return(0,ge.jsx)(T().sA,{...ht.welcomeMessage})}}),[t]);return s?null:(0,ge.jsx)("div",{style:"large"===a?l.welcomeMessageTitleLarge:l.welcomeMessageTitle,children:d})}function ft(e){const{aiChatFeatureController:t,startedAgentChatThread:n,onWelcomeAnimationsComplete:a}=e,o="centered"===t.agentEmptyStateFormat,i="single_line"===t.agentEmptyStateFormat,s="default"===t.agentEmptyStateFormat,l="compact"===t.agentEmptyStateFormat,[u,g]=(0,r.useState)(!1),h=(0,d().O$)(ne().AppStoreSidebarSpaceViewStore),f=(0,Je().DV)(h),v=(0,d().K8)((()=>{var e;const{sidebarSpaceViewStore:t}=ne().default.state;return null==t||null===(e=t.getSettings())||void 0===e||null===(e=e.agent_personalization_settings)||void 0===e?void 0:e.name}),[]),y=(0,r.useMemo)((()=>{const e="full_page"===t.agentChatFormFactor?"large_plus":"large",n=(0,it().N)(e),a=Math.round(1.5625*n);return Math.ceil((a-n)/2)}),[t.agentChatFormFactor]),S=(0,c().IS)((()=>({hoverContainer:{width:"100%",display:"flex",alignItems:"center",justifyContent:o||i?"center":"flex-start",paddingTop:16,paddingBottom:16,marginTop:-16,marginBottom:-16},welcomeMessageTitle:{paddingInline:8,...i&&{textAlign:"start",flexShrink:0,fontSize:20,lineHeight:1.2},...o&&{paddingInline:0,textAlign:"center"}},container:{display:"flex",flexDirection:"column",flex:1,justifyContent:"flex-end",alignItems:"stretch",maxWidth:t.chatInputWidth,width:"100%",pointerEvents:"auto",alignSelf:"center",...i&&{maxWidth:"auto",width:"100%",alignItems:"center",justifyContent:"center"},...o&&{alignItems:"center",paddingBottom:32},paddingTop:y},inlineContainer:{display:"flex",alignItems:"center",justifyContent:"center",gap:20,width:"auto",flexShrink:0,padding:"8px"}})),[t.chatInputWidth,o,i,y]),x=(0,r.useCallback)((()=>{g(!0)}),[]),b=(0,r.useCallback)((()=>{g(!1)}),[]),C=(0,r.useCallback)((e=>{const{key:n,fullWidthHoverContainer:a=!1}=e,r=(0,ge.jsx)(pt,{aiChatFeatureController:t,selectedAccessory:f,isHoveringContainer:u});return a?(0,ge.jsx)("div",{style:S.hoverContainer,onMouseEnter:x,onMouseLeave:b,children:r},n):(0,ge.jsx)("div",{children:r},n)}),[t,f,u,S.hoverContainer,x,b]),I=(0,r.useMemo)((()=>n||!s?i?[(0,ge.jsxs)("div",{style:S.inlineContainer,onMouseEnter:x,onMouseLeave:b,children:[C({key:"face-inline",fullWidthHoverContainer:!1}),(0,ge.jsx)(mt,{selectedAccessory:f,personalizedName:v,agentEmptyStateFormat:t.agentEmptyStateFormat})]},"inline-container")]:[C({key:"face",fullWidthHoverContainer:!0}),(0,ge.jsx)(mt,{selectedAccessory:f,personalizedName:v,agentEmptyStateFormat:t.agentEmptyStateFormat,textSize:s?"default":"large"},"welcome-message")]:[(0,ge.jsx)("div",{style:S.hoverContainer,onMouseEnter:x,onMouseLeave:b,children:(0,ge.jsx)(st().A,{visible:!0,initial:{transform:"scale(0)"},animate:{transform:"scale(1)"},style:{marginBottom:8},config:{duration:1200,timingFunction:"cubic-bezier(0.34, 1.56, 0.64, 1)"},children:C({key:"face-inner",fullWidthHoverContainer:!1})})},"face-animated-container"),(0,ge.jsx)(m().D,{styleKey:"Title-sm/Semibold",style:S.welcomeMessageTitle,children:(0,ge.jsx)(T().sA,{id:"agentChatView.welcomeMessageTitleFirstUse",defaultMessage:"Your improved Notion AI"})},"title"),(0,ge.jsx)(m().D,{styleKey:"Body/Regular",style:S.welcomeMessageTitle,children:(0,ge.jsx)(T().sA,{id:"agentChatView.welcomeMessageDescriptionFirstUse",defaultMessage:"Here are a few things I can do, or ask me anything!"})},"description")]),[S.inlineContainer,S.welcomeMessageTitle,S.hoverContainer,n,C,i,s,x,b,t.agentEmptyStateFormat,v,f]),w=n,M=(0,r.useCallback)((()=>{a&&requestAnimationFrame((()=>a()))}),[a]);(0,r.useEffect)((()=>{w&&a&&I.length>0&&requestAnimationFrame((()=>a()))}),[w,a,I.length]);const A=(0,lt().pg)({numItems:I.length,disableAnimation:w,onAllAnimationsComplete:w?void 0:M}),k=(0,r.useMemo)((()=>i?"0":l?"0px 16px 0px 20px":"16px 16px 0 16px"),[i,l]);return(0,ge.jsx)("div",{style:S.container,children:(0,ge.jsx)(p().Y1,{direction:"vertical",gap:12,padding:k,children:I.map(((e,t)=>(0,ge.jsx)(vt,{visible:A.has(t),disableAnimation:w,children:e},`welcome-message-${t}`)))})})}function vt({visible:e,children:t,disableAnimation:n}){const a=(0,lt().$5)(e);return(0,ge.jsx)("div",{style:n?{}:a,children:t})}var yt=()=>n(153321),St=()=>n(242422),xt=()=>n(718827),bt=()=>n(252291),Ct=()=>n(970236),It=()=>n(529099),wt=()=>n(995847),Mt=()=>n(402390),At=()=>n(755199),kt=()=>n(799832),jt=()=>n(760217),Tt=()=>n(404277),Rt=()=>n(939740),Pt=()=>n(89924),_t=()=>n(383814),Et=()=>n(722872),Dt=()=>n(477293),Bt=()=>n(929219),zt=()=>n(30537),Lt=()=>n(5580),Ft=()=>n(514799),Ut=()=>n(406699),Vt=()=>n(391435),Ot=()=>n(430483),Wt=()=>n(463830),Nt=()=>n(148832);const Kt=(0,T().YK)({translateThisPage:{id:"AgentSuggestedActions.translateThisPage",defaultMessage:"Translate this page"}});function Ht({menuListItemProps:e,isLoading:t,variant:n="list"}){const a=(0,l().v3)(),o=(0,T().tz)(),i=(0,d().uB)(void 0,Wt().A),s=(0,l().WS)(),u=(0,d().K8)((()=>{const e=(0,_t().G)(a);if(e&&e instanceof Nt().B)return e}),[a]),g=(0,d().K8)((()=>Ot().zD.isFullPageTranslateEnabled()),[]),{detectedLanguage:p}=(0,Ft().H)({pageStore:u,enabled:Boolean(u)&&g}),h=(0,Lt().n)(),[f,v]=(0,r.useState)(void 0),y=f??p??h,S=(0,d().K8)((()=>{if(!u)return{mode:"translate_unlocked",status:"pre_activation",sourceLanguage:y};const e=ae().Uv.getTranslateModeForBlock(u.id);return e||{mode:"translate_unlocked",status:"pre_activation",sourceLanguage:y}}),[u,y]),x=!(0,d().O$)(Bt().e),b=(0,r.useCallback)((e=>{const{sourceLanguage:t}=e;v(t)}),[]),C=(0,r.useCallback)((e=>{if(!u)return;const{targetLanguage:t}=e;_().Z9({pageStore:u,environment:a}),_().Ww({pageStore:u,targetLanguage:t,sourceLanguage:y,environment:a,triggeredFrom:"action_menu"}),i.reset()}),[u,y,a,i]),I=(0,d().K8)((()=>V().MU.state.chatSidebarMode),[]),w=(0,c().IS)((e=>({actionItemStyle:{width:"100%",minHeight:"unset",padding:"8px 8px"},actionItemButtonStyle:{marginBottom:"1px",marginTop:"1px",borderRadius:"popup"===I?"16px":"6px",display:"flex",justifyContent:"space-between",height:32},pillButton:{display:"flex",alignItems:"center",height:28,padding:"4px 10px",borderRadius:16,cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap",color:e.text.secondary,backgroundColor:e.gray.background.primaryTranslucent},hoveredPillButton:{backgroundColor:e.gray.background.tertiary},pillShimmer:{height:16,width:140,borderRadius:16}})),[I]),M=s?Et().gu.ActionSheet:Et().gu.Popup,A=(0,r.useCallback)((()=>{const e=M===Et().gu.ActionSheet?void 0:400;return(0,ge.jsx)(Tt().A,{menuType:M,width:e,height:e,children:(0,ge.jsx)(Vt().Z,{onSelectTargetLanguage:C,onSelectSourceLanguage:b,editorModeConfigTranslateState:S,sourceLanguage:y,detectedPageLanguage:p,preferredLanguage:h,subMenuPlacement:"left",pageId:(null==u?void 0:u.id)??""})})}),[M,C,b,S,y,p,h,null==u?void 0:u.id]);return!u||x?null:"pill"===n?t?(0,ge.jsx)(K().A,{style:w.pillShimmer}):(0,ge.jsx)(Ut().A,{buttonPopupStore:i,popupType:zt().n.Popup,placementToOrigin:"top",originGap:4,renderOrigin:e=>(0,ge.jsx)(xt().Ay,{...e,disabled:t,style:w.pillButton,hoveredStyle:w.hoveredPillButton,children:o.formatMessage(Kt.translateThisPage)}),render:A}):e?(0,ge.jsx)(Ut().A,{buttonPopupStore:i,popupType:zt().n.Popup,placementToOrigin:"top",originGap:4,renderOrigin:n=>(0,ge.jsx)(jt().A,{...e,...n,title:(0,ge.jsx)(m().D,{styleKey:"Body/Regular",children:o.formatMessage(Kt.translateThisPage)}),left:t?null:(0,ge.jsx)(bt().I,{icon:we().textTranslateIcon,colorVariant:"primary"}),leftStyle:{margin:0},disabled:t,buttonStyle:w.actionItemButtonStyle,style:w.actionItemStyle,dontShrinkTitle:!0,ignoreLocalHoverState:!1}),render:A}):null}const $t=[{toolName:"create-pages",action:"Summarize this page"},{toolName:"create-database",action:"Create a tasks tracker"},{toolName:"search",action:"Generate ideas for this page"},{toolName:"update-page",action:"Make this page more detailed"},{toolName:"create-pages",action:"Create an action plan"}];var Yt=()=>n(206267),qt=()=>n(559506);const Gt=(0,T().YK)({getStarted:{id:"agentSuggestedActions.getStarted",defaultMessage:"Get started"},dismissButton:{id:"agentSuggestedActions.dismissButton",defaultMessage:"Dismiss"}}),Xt=[140,180,160,150],Qt=4,Zt=5,Jt=400;function en({loadAttachmentData:e,handlePromptSubmit:t,readyToAnimate:n=!0,disableAnimation:a,variant:r="list",aiChatFeatureController:o,chatLoaded:i}){const s=(0,Dt().r)("agent_suggested_actions"),u=(0,c().IS)((()=>({wrapper:{display:"flex",flexDirection:"column",alignItems:"center",maxWidth:"number"==typeof o.chatInputWidth?o.chatInputWidth:void 0,width:"100%",alignSelf:"center",margin:"0 auto",..."card"===r?{paddingTop:16}:o.suggestedActionsContainerPadding}})),[o.chatInputWidth,o.suggestedActionsContainerPadding,r]),g=(0,l().v3)();return(0,d().K8)((()=>"ai"===g.RouterStore.state.route.name),[g])&&!i?null:"model"===s?(0,ge.jsx)("div",{style:u.wrapper,children:(0,ge.jsx)(nn,{handlePromptSubmit:t,readyToAnimate:n,disableAnimation:a,variant:r})}):"prebuilt_prompts"===s?(0,ge.jsx)("div",{style:u.wrapper,children:(0,ge.jsx)(tn,{loadAttachmentData:e,handlePromptSubmit:t,readyToAnimate:n,disableAnimation:a,variant:r})}):"control"===s?null:void(0,R().HB)(s)}function tn({loadAttachmentData:e,handlePromptSubmit:t,readyToAnimate:n,disableAnimation:a,variant:s="list"}){const c=(0,T().tz)(),u=(0,l().v3)(),g=(0,d().K8)((()=>(0,_t().G)(u)),[u]),p=(0,d().K8)((()=>{if(g&&!(g instanceof je().N))return(0,kt().U)(g)}),[g]),h=(0,d().K8)((()=>{var e;if(!p)return{isLoading:!1,hasContent:!1};const t=p.isLoadedStore.state,n=p.isEmptyStore.state,a=(null===(e=p.collectionStore())||void 0===e?void 0:e.isPageTreeCollection())??!1,r=!(g instanceof je().N)&&((null==g?void 0:g.isCollectionView())??!1)&&!a;return{isLoading:!t&&r,hasContent:t&&!n}}),[p,g]),m=h.isLoading,f=h.hasContent,v=(0,d().K8)((()=>(0,Mt().H)(c)),[c]),y=(0,d().K8)((()=>{var e;const{sidebarSpaceViewStore:t}=ne().default.state;return(null==t||null===(e=t.getSettings())||void 0===e||null===(e=e.agent_personalization_settings)||void 0===e?void 0:e.has_already_seen_personalization_settings_modal)??!1}),[]),S=(0,o().X)("agent_whats_new_education_action"),x=(0,r.useCallback)((()=>{Je().cP({store:tt().r,from:"agent_suggested_actions",shouldSetSeenPersonalizationSettingsModal:!0,environment:u})}),[u]),b=(0,d().K8)((()=>"ai"===u.RouterStore.state.route.name),[u]),C=(0,d().K8)((()=>{var e;return!(0,R().O9)(null===(e=ne().default.state.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.whats_new_in_agent_suggestion_last_interacted_at)&&S||b}),[S,b]),I=(0,d().K8)((()=>St().default.checkGate({gateName:"agent_comments",disableExposureLogging:!0})),[]),w=(0,d().K8)((()=>_e({store:g,hasCollectionContent:f,loadAttachmentData:e,handlePromptSubmit:({text:e,prebuiltPromptType:n})=>{"whats_new_in_agent"===n&&At().Me({environment:u}),t({type:"prebuilt-prompt",text:e,promptType:n,locale:v})},intl:c,canShowPersonalizationSettingsModal:!i().A.isMobile&&!y,openFaceCustomizationModal:x,isAiLandingPage:b,enableWhatsNewEducationAction:C,agentCommentsEnabled:I}).slice(0,b?Zt:Qt)),[g,f,e,c,y,x,b,C,t,v,u,I]);return(0,ge.jsx)(an,{suggestedActionInfos:w,readyToAnimate:n,isLoading:m,disableAnimation:a,variant:s})}function nn({handlePromptSubmit:e,readyToAnimate:t,disableAnimation:n,variant:a="list"}){const o=(0,l().v3)(),i=(0,d().K8)((()=>(0,_t().G)(o)),[o]),[s,c]=(0,r.useState)([]),[u,g]=(0,r.useState)(!1);(0,r.useEffect)((()=>{(async()=>{if(i&&!(i instanceof je().N)){g(!0);try{const e=await async function(e){const{environment:t,data:n}=e;try{const e=await qt().callApi({eventName:"getAgentSuggestedActions",environment:t,data:n});return"failed"===e.type?{actions:$t}:e.data}catch(a){return{actions:$t}}}({environment:o,data:{blockPointer:{table:"block",id:i.id,spaceId:i.getSpaceId()},aiSessionId:Yt().JW(),numActions:Qt}});e.actions&&e.actions.length>0&&c(e.actions.map((e=>e.action)))}finally{g(!1)}}})()}),[o,i]);const p=(0,r.useCallback)((t=>{e({type:"string",text:t})}),[e]),h=s.slice(0,Qt).map((e=>({type:e,suggestedAction:e,icon:It().aiFaceIcon,handleClick:()=>{p(e)}})));return(0,ge.jsx)(an,{suggestedActionInfos:h,readyToAnimate:t,isLoading:u,disableAnimation:n,variant:a})}function an({suggestedActionInfos:e,readyToAnimate:t,isLoading:n,disableAnimation:a,variant:o="list"}){const[i,s]=(0,r.useState)(!1),u=(0,T().tz)(),g=(0,l().v3)(),p=(0,d().O$)(ne().AppStoreCurrentUserSettingsStore),[h,f]=(0,r.useState)(4),v=(0,r.useRef)(null),y=(0,r.useRef)(void 0),S=a||t,x=(0,lt().pg)({numItems:S?e.length:0,animateIndexOffset:0,disableAnimation:a});(0,r.useEffect)((()=>{if("card"!==o||!v.current)return;const e=e=>e>690?4:e>340?2:1,t=new ResizeObserver((t=>{for(const n of t){const t=n.contentRect.width,a=e(t);f(a)}}));return t.observe(v.current),()=>{t.disconnect()}}),[o]);const b=(0,r.useCallback)((()=>{p&&At().t0({environment:g,userSettingsStore:p,dismissed:!0})}),[p,g]);(0,r.useEffect)((()=>()=>{y.current&&(b(),clearTimeout(y.current))}),[b]);const C=[{key:"agent-suggested-actions",items:e.map(((e,t)=>({key:`suggested-action-${t}`,render:r=>(0,ge.jsx)(rn,{suggestedActionInfo:e,menuListItemProps:r,visible:x.has(t),isLoading:n,index:t,disableAnimation:a,variant:o}),action:()=>e.handleClick()}))),render:e=>(0,ge.jsx)(Pt().A,{style:I.actionSectionItem,...e})}],I=(0,c().IS)((()=>({actionSection:{width:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start"},actionSectionItem:{width:"100%",padding:"4px 0"},pillContainer:{display:"flex",flexDirection:"row",flexWrap:"wrap",width:"100%",rowGap:12,columnGap:8,justifyContent:"center"},cardContainer:{width:"100%",display:"grid",gridTemplateColumns:`repeat(${h}, 1fr)`,gap:16,justifyContent:"center",marginBottom:i?0:16,maxHeight:i?0:200,opacity:i?0:1,transform:i?"translateY(-20px)":"translateY(0)",transition:`margin-bottom ${Jt}ms ease-out, max-height ${Jt}ms ease-out, opacity ${Jt}ms ease-out, transform ${Jt}ms ease-out`,overflow:"hidden"},getStartedContainer:{gridColumn:"1 / -1",display:"flex",alignItems:"center",justifyContent:"space-between",paddingInlineStart:8,marginBottom:-8},dismissButton:{borderRadius:"50%",width:24,height:24,display:"flex",alignItems:"center",justifyContent:"center"}})),[h,i]),w=(0,r.useCallback)((()=>{s(!0),y.current&&clearTimeout(y.current),y.current=setTimeout((()=>{b(),y.current=void 0}),Jt)}),[b]),M=(0,d().K8)((()=>{if("card"!==o)return!1;if(!p)return!0;const e=p.getSettings();return!(null!=e&&e.dismissed_agent_get_started_banner)}),[p,o]);return"pill"===o||"card"===o?"card"!==o||M?(0,ge.jsxs)("div",{ref:"card"===o?v:void 0,style:"card"===o?I.cardContainer:I.pillContainer,children:["card"===o?(0,ge.jsxs)("div",{style:I.getStartedContainer,children:[(0,ge.jsx)(m().D,{styleKey:"Caption/Regular",colorVariant:"secondary",children:(0,ge.jsx)(T().sA,{...Gt.getStarted})}),(0,ge.jsx)(W().A,{icon:wt().xMarkSmallIcon,style:I.dismissButton,colorPalette:"gray",ariaLabel:u.formatMessage(Gt.dismissButton),onClick:w})]}):void 0,e.map(((e,t)=>(0,ge.jsx)(rn,{suggestedActionInfo:e,menuListItemProps:void 0,visible:x.has(t),isLoading:n,index:t,disableAnimation:a,variant:o},`suggested-action-${t}`)))]}):null:(0,ge.jsx)(Tt().A,{menuType:Et().gu.Popup,disableScroller:!0,height:"auto",maxHeight:220,width:"100%",children:(0,ge.jsx)(Rt().Ay,{type:Rt().Oh.Vertical,sections:C,initialFocus:void 0,disableInitialScroll:!0,resetFocusOnMouseOut:!0,captureKeyboardOnlyWhenFocused:!0,style:I.actionSection})})}function rn({suggestedActionInfo:e,menuListItemProps:t,visible:n,isLoading:a,index:o,disableAnimation:i,variant:s="list"}){const[l,u]=(0,r.useState)(!1);(0,r.useEffect)((()=>{if(i)u(!0);else if(n&&e.isNew&&!a){const e=setTimeout((()=>{u(!0)}),300);return()=>clearTimeout(e)}}),[n,e.isNew,a,i]);const g=(0,d().K8)((()=>V().MU.state.chatSidebarMode),[]),p=(0,ge.jsx)(Ct().E,{color:"blue",content:(0,ge.jsx)(m().D,{styleKey:"Caption/Regular",colorPalette:"blue",children:(0,ge.jsx)(T().sA,{id:"AgentSuggestedActions.newBadge",defaultMessage:"New"})})}),h=(0,lt().$5)(n),f=(0,c().IS)((e=>({animatedItem:{...i?{}:h},actionItemStyle:{width:"100%",minHeight:"unset",padding:"8px 8px",...i?{}:h},actionItemButtonStyle:{marginBottom:"1px",marginTop:"1px",borderRadius:"popup"===g?"16px":"6px",display:"flex",justifyContent:"space-between",height:32},actionItemRightStyles:{marginInlineStart:0},shimmerItem:{width:"100%",height:16,padding:"8px 8px",borderRadius:"popup"===g?16:6},pillButton:{display:"flex",alignItems:"center",height:32,padding:"4px 10px",borderRadius:16,cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap",color:e.text.primary,backgroundColor:e.gray.background.primaryTranslucent,...i?{}:h},pillIcon:{marginInlineEnd:6},hoveredPillButton:{backgroundColor:e.gray.background.tertiary},pillShimmerItem:{height:16,borderRadius:16},cardButton:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:10,padding:12,borderRadius:16,cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap",color:e.text.secondary,backgroundColor:e.gray.background.primaryTranslucent,flexBasis:0,flexGrow:1,...i?{}:h},cardText:{fontSize:12,fontWeight:400,lineHeight:1.2,width:"100%",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"normal"},hoveredCardButton:{backgroundColor:e.gray.background.tertiary},cardShimmerItem:{height:16,borderRadius:16}})),[h,i,g]);if("translate"===e.type){const e="card"===s?"pill":s;return(0,ge.jsx)("div",{style:f.animatedItem,children:(0,ge.jsx)(Ht,{menuListItemProps:t,isLoading:a,variant:e})})}return"pill"===s?(0,ge.jsx)(xt().Ay,{disabled:a,onClick:()=>e.handleClick(),style:f.pillButton,hoveredStyle:f.hoveredPillButton,children:a?(0,ge.jsx)(K().A,{style:{...f.pillShimmerItem,width:Xt[o]}},o):(0,ge.jsxs)(ge.Fragment,{children:[(0,ge.jsx)(bt().I,{style:f.pillIcon,icon:e.icon,colorVariant:"primary"}),(0,ge.jsx)(m().D,{styleKey:"Body/Regular",children:e.suggestedAction})]})}):"card"===s?(0,ge.jsx)(xt().Ay,{disabled:a,onClick:()=>e.handleClick(),style:f.cardButton,hoveredStyle:f.hoveredCardButton,children:a?(0,ge.jsx)(K().A,{style:{...f.cardShimmerItem,width:"100%"}},o):(0,ge.jsxs)(ge.Fragment,{children:[(0,ge.jsx)(bt().I,{icon:e.icon,colorVariant:"secondary"}),(0,ge.jsx)("div",{style:f.cardText,children:e.suggestedAction})]})}):t?(0,ge.jsx)(jt().A,{...t,disabled:a,onClick:()=>e.handleClick(),title:a?(0,ge.jsx)(K().A,{style:{...f.shimmerItem,width:Xt[o]}},o):(0,ge.jsx)(m().D,{styleKey:"Body/Regular",children:e.suggestedAction}),dontShrinkTitle:!0,focused:t.focused,left:a?null:(0,ge.jsx)(bt().I,{icon:e.icon,colorVariant:"primary"}),leftStyle:{margin:0},buttonStyle:f.actionItemButtonStyle,style:f.actionItemStyle,right:e.isNew&&l?i?p:(0,ge.jsx)(yt().P.span,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{delay:.12*o,duration:.3,type:"spring",damping:25},children:p}):null,rightStyle:f.actionItemRightStyles,ignoreLocalHoverState:!1}):null}(0,n(466103).exposeDebugEnvironmentValue)("resetAgentGetStartedBanner",(e=>()=>{const{currentUserSettingsStore:t}=ne().default.state;return t?(At().t0({environment:e,userSettingsStore:t,dismissed:!1}),"Agent get started banner dismissal state has been reset. Refresh the page to see it again."):"No user settings store found"}));var on=()=>n(596048),sn=()=>n(500761);function ln(e){const{aiChatFeature:t,clientStore:n,config:s,onAutoSubmitHandlerReady:u,onEsc:h,onThreadChange:f,parentStore:y,threadStore:S,threadStoreState:x="ready",transcript:b}=e,A=(0,Ve().K7)(t),k=(0,l().v3)(),j=(0,o().X)("agent_integrations"),{isTablet:U}=(0,l().Y0)(),[W,N]=(0,r.useState)(S),K=(0,d().K8)((()=>(null==W?void 0:W.getParentTable())===I().To),[W]),H=(0,d().K8)((()=>{const e=null==W?void 0:W.getParentStore();if(e&&e.table===w().C0)return e}),[W]),[$,Y]=(0,r.useState)(void 0),q=(0,d().K8)((()=>{var e;return(null===(e=ne().default.state.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.started_agent_chat_thread)??!1}),[]);(0,r.useEffect)((()=>{N(S),ht(q)}),[S,q]);const Z=(0,d().K8)((()=>{const{device:e}=k,t=A.aiChatType;return(e.isMobileNative||e.isTablet)&&("agent"===t||"agent_full_page"===t)?(0,J().y)(k,g().A.state.estimatedKeyboardWebViewOverlap,g().A.state.nativeBottomBarHeight):0}),[k,A.aiChatType]),te=(0,o().X)("agent_partial_transcript"),ie=(0,d().K8)((()=>n.state.showDebug),[n]),se=(0,r.useRef)(null),le=(0,r.useRef)(0),de=(0,r.useRef)(null),[ce,ue]=(0,r.useState)(!1),[pe,he]=(0,r.useState)(!0),[me,fe]=(0,r.useState)(!0),[ve,ye]=(0,r.useState)(!1),Se=(0,d().K8)((()=>{if(!W)return;const e=W.getTranscript().reverse().find((e=>"config"===e.type));return null==e?void 0:e.value.type}),[W]),xe=(0,ze().i7)(),be=(0,d().K8)((()=>(0,Oe().OT)(W)),[W]),Ce=(0,d().K8)((()=>!W||W.inMemoryRecordCache!==k.defaultRecordCache.inMemoryRecordCache||!!W.isReady()&&W.getMessageStores().every((e=>e.isReady()))),[k.defaultRecordCache.inMemoryRecordCache,W]),Ie=!be&&"loading"!==x&&Ce,we=(0,c().IS)((e=>({twoColumnContainer:{minHeight:0,flex:1,pointerEvents:"auto"},chatColumn:{pointerEvents:"auto",flex:1,display:"flex",flexDirection:"column",minHeight:0,maxWidth:"100%",position:"relative"},chatContainer:{flex:1,position:"relative",scrollbarGutter:"stable",overflowY:"auto",maskImage:`linear-gradient(to bottom,\n\t\t\t\t\t\t${ce?"black 0px":"transparent 0px"},\n\t\t\t\t\t\tblack 32px,\n\t\t\t\t\t\tblack calc(100% - 32px),\n\t\t\t\t\t\ttransparent 100%),\n\t\t\t\t\t\tlinear-gradient(black, black)`,maskSize:"calc(100% - 16px) 100%, 16px 100%",maskPosition:"0 0, 100% 0",maskRepeat:"no-repeat, no-repeat",WebkitMaskImage:`linear-gradient(to bottom,\n\t\t\t\t\t\t${ce?"black 0px":"transparent 0px"},\n\t\t\t\t\t\tblack 32px,\n\t\t\t\t\t\tblack calc(100% - 32px),\n\t\t\t\t\t\ttransparent 100%),\n\t\t\t\t\t\tlinear-gradient(black, black)`,WebkitMaskSize:"calc(100% - 16px) 100%, 16px 100%",WebkitMaskPosition:"0 0, 100% 0",WebkitMaskRepeat:"no-repeat, no-repeat"},contentContainer:{margin:"0 auto",width:"100%",maxWidth:A.chatInputWidth,paddingTop:16,paddingInlineEnd:16,paddingBottom:0,paddingInlineStart:16,marginInlineStart:"auto"},emptyContainer:{display:"flex",flexDirection:"column",height:"100%",paddingBottom:A.emptyContainerBottomPadding},emptySpacer:{flex:1},transcript:{display:"flex",flexDirection:"column",marginBottom:16,gap:8},inputWrapper:{flex:"0 0 auto",position:"relative",backgroundColor:A.hasAgentBackground?e.background.primary:void 0,backgroundImage:A.hasAgentBackground?"linear-gradient(to right, rgba(0, 0, 0, 0.008), rgba(0, 0, 0, 0) 32px), linear-gradient(to right, rgba(0, 0, 0, 0.01), rgba(0, 0, 0, 0) 72px)":void 0,padding:A.chatInputContainerPadding},scrollToBottomButton:{position:"absolute",insetInlineStart:"50%",bottom:"100%",transform:"translate(-50%, -8px)",zIndex:2,padding:6,borderRadius:20,backgroundColor:"dark"===e.mode?"#fff":"#000",border:"none",cursor:"pointer",fontWeight:500,boxShadow:"dark"===e.mode?`0px 0px 0px 0.5px ${e.border.primary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.12), 0px 4px 16px -2px rgba(0, 0, 0, 0.6)`:`0px 0px 0px 0.5px ${e.border.primary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.02), 0px 4px 16px -2px rgba(0, 0, 0, 0.1)`,transition:"opacity 150ms ease-out, transform 150ms ease-out",opacity:0,pointerEvents:"none"},scrollToBottomButtonVisible:{opacity:1,transform:"translate(-50%, -16px)",pointerEvents:"auto"},inputContainer:{display:"flex",flexDirection:"column",gap:8,margin:"0 auto",width:"100%",maxWidth:A.chatInputWidth,padding:A.chatInputPadding,marginInlineStart:"auto",flex:"0 0 auto",paddingBottom:Z},chevronDownIcon:{width:20,height:20,fill:"dark"===e.mode?"#000":e.white,transform:"translateY(1px)"}})),[A.hasAgentBackground,A.chatInputContainerPadding,A.chatInputWidth,A.chatInputPadding,A.emptyContainerBottomPadding,ce,Z]);(0,r.useEffect)((()=>{const e=se.current;if(!e)return ue(!0),he(!0),void fe(!0);if("search"===Se)return void fe(!1);const t=setTimeout((()=>{e.scrollTop=e.scrollHeight,fe(!0)}),100);return()=>clearTimeout(t)}),[Se]);const Me=(0,r.useCallback)((e=>{de.current=e}),[]),Ae=(0,r.useCallback)(((e="smooth")=>{const t=se.current;if(!t)return;const n=Math.max(0,t.scrollHeight-t.clientHeight);ee().VG({element:t,environment:k,options:{top:n,behavior:e}})}),[k]),ke=(0,r.useCallback)(((e="smooth")=>{Ae(e),fe(!0)}),[Ae]),je=(0,r.useCallback)((()=>{D().IU({environment:k})}),[k]),{checkScrollPosition:Te}=function({scrollableRef:e,enabled:t,scrollToBottom:n,dismissKeyboard:a}){const o=(0,r.useRef)(0),i=(0,r.useRef)(0),s=(0,r.useRef)(0),l=(0,r.useRef)(0),c=(0,r.useRef)(!1),u=(0,r.useCallback)((()=>{const n=e.current;if(!n)return;const r=n.scrollTop,d=performance.now(),u=d-s.current,g=r-o.current,p=g<0,h=u>10&&Math.abs(g)>0?Math.abs(g)/u:0;if(i.current=h,t&&p&&(ee().WZ(n)??0)>0){const e=Math.abs(g),t=h>1,n=e>20,o=r<=50;d-l.current>1e3&&(t&&o&&n||h>2&&e>50)&&(l.current=d,c.current=!0,a())}o.current=r,s.current=d}),[t,a,e]),p=(0,d().K8)((()=>g().A.state.phase),[]);return(0,r.useEffect)((()=>{if(t)if(p===g().i.shown){if(c.current)return void(c.current=!1);setTimeout((()=>{const t=e.current;if(!t)return;const a=t.scrollHeight-t.scrollTop-t.clientHeight;n(a>500?"instant":"smooth")}),400)}else p!==g().i.hidden&&p!==g().i.willHide||setTimeout((()=>{const t=e.current;if(t)if(t.scrollHeight-t.scrollTop-t.clientHeight<100)n("instant");else{const e=Math.max(0,t.scrollHeight-t.clientHeight);t.scrollTop>e&&n("instant")}}),200)}),[p,n,t,e]),(0,r.useEffect)((()=>{if(!t)return;const a=()=>{const t=e.current;t&&t.scrollTop<500&&setTimeout((()=>{n("instant")}),100)};return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)}),[n,t,e]),(0,r.useEffect)((()=>{0===s.current&&(s.current=performance.now())}),[]),{checkScrollPosition:u}}({scrollableRef:se,enabled:Boolean(i().A.isMobile)&&!U,scrollToBottom:ke,dismissKeyboard:je}),Re=(0,r.useCallback)((()=>{const e=se.current;if(!e)return;const t=e.scrollTop,n=t-le.current<0,a=e.scrollHeight-e.scrollTop-e.clientHeight<50,r=0===t;le.current=t,ue(r),he(a),n&&!a&&me&&fe(!1),"search"!==Se&&a&&!me&&fe(!0),Te()}),[me,Se,Te]);(0,r.useEffect)((()=>{const e=se.current;if(!e)return;e.addEventListener("scroll",Re);const t=new MutationObserver((()=>{me&&(e.scrollTop=e.scrollHeight),setTimeout(Re,100)}));return t.observe(e,{childList:!0,subtree:!0,characterData:!0}),setTimeout(Re,100),()=>{e.removeEventListener("scroll",Re),t.disconnect()}}),[Re,me]);const _e=(0,d().K8)((()=>{const e=V().MU.state;if("open"===e.chatSidebarVisibility)return e.chatSidebarMode}),[]);(0,r.useEffect)((()=>{_e&&ke("instant")}),[_e,ke]);const Ee=(0,d().O$)(ne().AppStoreMainEditorCurrentBlockStore),De=(0,d().O$)(re().default.peekTargetStore),Be=(0,Qe().q)({threadStore:W,clientAiChatStore:n,setThreadStore:N,aiChatFeatureController:A,config:s});!function(e){const{environment:t,clientStore:n}=e,a=(0,$e().useThreadStoreFromCurrentRoute)(),o=(0,Fe().Cx)(),i=(0,d().K8)((()=>o?(0,Oe().A3)({threadStore:a,clientStore:n}).steps.filter((e=>"agent-tool-result"===e.type)).filter((e=>!(0,He().nP)(e)&&"delete-pages"!==e.toolName&&!e.error)):[]),[a,n,o]);(0,r.useEffect)((()=>{const e=(0,Ye().L2)(t);0!==i.length?e.enter({environment:t,steps:i,transactionActions:B(),applyOperation:(n,a)=>{(0,Fe().Hp)({environment:t,operation:a,recordCache:e.getInMemoryRecordCache(),transaction:n})}}):e.exit(t)}),[t,i]),(0,r.useEffect)((()=>()=>{(0,Ye().L2)(t).exit(t)}),[t])}({environment:k,clientStore:n});const Ze=(0,d().O$)(We().bX),Je=(0,Ne().K)(),et=(0,F().AD)(),tt=(0,T().tz)(),nt=(0,d().K8)((()=>(0,ae().vE)([Ee,De].filter(R().O9))),[Ee,De]),{handleChatSubmissionError:at}=(0,Ke().yG)({}),rt=(0,r.useCallback)((async e=>{try{var t;const{prompt:a,config:r}=e,o=function(e){const{prompt:t}=e,n=t.type;return"string"===n?{suggestedPrompt:{promptKey:"string_prompt",promptDescription:t.text}}:"text-value"===n?void 0!==t.text?{suggestedPrompt:{promptKey:"text_value_prompt",promptDescription:(0,M().q4_)(t.text)}}:void 0:"prebuilt-prompt"===n?{suggestedPrompt:{promptKey:t.promptType,promptDescription:t.text}}:void(0,R().HB)(n)}({prompt:a});if("prebuilt-prompt"===a.type&&A.supportsClearSelectionOnSubmit&&D().IU({environment:k}),n.setState({...n.state,userSelectedConfig:!0}),!Ze)throw new Error("No inference context");const{spaceStore:i,userStore:s,spaceViewStore:l}=Ze;if(!y)throw new Error("No parent store");nt&&_().DL({pageStore:nt,environment:k,triggeredFrom:"agent"}),(0,z().maybeUpdateAiEligibility)(k,y.id);const d=(null===(t=et.persistTemporaryThreadStoreIfExists())||void 0===t?void 0:t.threadStore)??W,c=function({environment:e,spaceStore:t,userStore:n,prompt:a,intl:r}){const{type:o}=a;if("string"===o||"text-value"===o){if(!a.text||0===a.text.length)return;return(0,We().Kf)({environment:e,spaceStore:t,userStore:n,value:"string"==typeof a.text?(0,M().x9d)(a.text):a.text})}if("prebuilt-prompt"===o){const o=(0,M().x9d)(r.formatMessage(Pe(a.promptType).message));return(0,We().Jv)({environment:e,spaceStore:t,userStore:n,promptType:a.promptType,locale:a.locale,value:o})}(0,R().HB)(o)}({environment:k,spaceStore:i,userStore:s,prompt:a,intl:tt});if(!c)return;const u=null==d?void 0:d.getTranscript().findLast((e=>"context"===e.type)),g=(null==d?void 0:d.id)||(0,Q().Z1)({environment:k,table:I().To,spaceId:i.id}),p=[],h=n.getOrCreateClientAIChatThreadStore(g),m=h.getStagedMentionPointers(),v=(0,We().BX)({environment:k,spaceId:i.id,pointers:m});v&&p.push(v);const S=null==h?void 0:h.getAndClearStagedAssistantAttachmentSteps();if(S&&p.push(...S),!d||(0,Oe().av)(d)){const e=(0,Oe().hw)({config:r,hasAgentIntegrationsFeatureFlag:j})?await(0,Oe().oE)({agentChatIntegrations:Je,environment:k,spaceStore:i,spaceViewStore:l}):void 0,t=(0,We().Xd)({environment:k,inferenceContext:Ze,config:r,addSteps:[e,...p,c],surface:A.contextStepSurface});if(d)await(0,oe().addStepsToExistingThreadAndRun)({environment:k,clientStore:n,spaceStore:i,userStore:s,threadStore:d,addSteps:t,waitForServerCommit:!0,sendPartialTranscript:te,temporaryAiThreadManager:et,analyticsArgs:o}),f(d);else{const e=(0,oe().addTranscriptToNewThreadAndRun)({environment:k,spaceStore:i,transcript:t});f(e)}$&&$.length>0&&(h.updateMentionedStagedData(dn({inputMentionPointers:$,stagedMentionPointers:m})),Y([]))}else{(0,Fe().kh)({threadStore:W,config:r,environment:k});const e=[];((null==u?void 0:u.value.collectionViewBlockId)??(null==u?void 0:u.value.blockId))!==(null==Ee?void 0:Ee.id)&&e.push((0,We().WM)({environment:k,inferenceContext:Ze,surface:A.contextStepSurface,config:r})),S&&e.push(...S),v&&e.push(v),e.push(c),await(0,oe().addStepsToExistingThreadAndRun)({environment:k,clientStore:n,spaceStore:i,userStore:s,threadStore:d,addSteps:e,waitForServerCommit:!0,sendPartialTranscript:te,temporaryAiThreadManager:et,analyticsArgs:o}),$&&$.length>0&&(h.updateMentionedStagedData(dn({inputMentionPointers:$,stagedMentionPointers:m})),Y([])),Ae()}}catch(a){at(a,"AgentChatView.handleSubmit",{threadExists:Boolean(W),spaceId:null==y?void 0:y.id,configType:null==s?void 0:s.type})}}),[n,Ze,y,nt,k,et,W,tt,j,Je,A.contextStepSurface,$,te,f,null==Ee?void 0:Ee.id,Ae,at,null==s?void 0:s.type,A.supportsClearSelectionOnSubmit]),it=(0,d().K8)((()=>(0,Oe().Ft)({threadStore:W,clientStore:n})),[W,n]),st=(0,d().K8)((()=>(0,ze().Ke)()),[]),lt=(0,d().K8)((()=>s??(0,Ue().YM)({spaceId:null==y?void 0:y.id})),[s,null==y?void 0:y.id]);(0,r.useEffect)((()=>{if(u){u((async e=>{de.current&&await de.current({prompt:(0,M().x9d)(e),config:lt})}))}}),[u,lt]);const dt=(0,r.useCallback)((async e=>{await rt({prompt:e,config:lt,actionCardId:e.text,prebuiltPromptType:"prebuilt-prompt"===e.type?e.promptType:void 0});try{const t="workflow"===lt.type?lt.model:void 0;P().trackPillsClicked({environment:k,prompt:e,model:t,aiModule:"ai_module"===A.contextStepSurface})}catch(t){}}),[rt,lt,k,A.contextStepSurface]),ct=(0,r.useCallback)((()=>{ke("smooth")}),[ke]),ut=(0,r.useCallback)((()=>{ye(!0)}),[]),gt=xe?s:lt,[pt,ht]=(0,r.useState)(q);(0,r.useEffect)((()=>{const e=ne().default.state.currentUserSettingsStore;e&&!q&&be&&B().createAndCommit({environment:k,userAction:"AgentChatView.setStartedAgentChatThread",canUndo:!1,perform:t=>{E().zv({store:e,data:{settings:{...e.getSettings(),started_agent_chat_thread:!0}},transaction:t})}})})),(0,r.useEffect)((()=>{const e=null==W?void 0:W.id;A.recordLastOpenState&&be&&e&&!H&&(0,L().setChatLastOpenedState)(e)}),[be,null==W?void 0:W.id,A.recordLastOpenState,H]);const mt=(0,r.useCallback)((()=>ht(!0)),[]),vt="loading"!==x;return(0,ge.jsx)(a().N,{mode:"popLayout",children:(0,ge.jsxs)(p().Y1,{direction:"vertical",width:"fill",height:"hug",style:{flex:1,minHeight:0,...A.chatViewMinWidth&&{minWidth:A.chatViewMinWidth}},children:[A.supportsChatHeader?(0,ge.jsx)(cn,{aiChatFeatureController:A,threadStore:W,workflowStore:H,clientStore:n,onThreadChange:f,parentStore:y,threadStoreState:x,config:s,hideThreadPicker:e.hideThreadPicker,hideActions:e.hideActions,hideAgentName:e.hideAgentName,shouldShowEmptyState:Ie}):void 0,(0,ge.jsxs)(p().Y1,{direction:"horizontal",style:we.twoColumnContainer,children:[A.supportsCollapsiblePanel&&st?(0,ge.jsx)(O().z,{config:ie?{mode:"resizable",min:300,max:900,defaultSize:515,userOverride:void 0}:{mode:"closed"},anchorToSide:"left",children:(0,ge.jsx)(qe().m,{clientStore:n,threadStore:W})}):null,(0,ge.jsxs)("div",{style:we.chatColumn,children:[(0,ge.jsx)("div",{style:we.chatContainer,ref:se,children:(0,ge.jsx)(G().K,{from:"AgentChatView",fallback:({error:e,errorId:t})=>(0,ge.jsx)(X().LargeSurfaceRenderError,{error:e,errorId:t}),children:Ie?(0,ge.jsxs)("div",{style:we.emptyContainer,children:[(0,ge.jsx)("div",{style:we.emptySpacer}),(0,ge.jsx)(ft,{aiChatFeatureController:A,startedAgentChatThread:q,onWelcomeAnimationsComplete:mt}),A.shouldShowSuggestedActions&&"above"===A.agentSuggestedActionsPlacementRelativeToChat?(0,ge.jsx)(en,{loadAttachmentData:Be,handlePromptSubmit:dt,readyToAnimate:pt,disableAnimation:q,variant:A.agentSuggestedActionsDisplay,aiChatFeatureController:A}):null]}):vt?(0,ge.jsx)("div",{style:we.contentContainer,children:W?(0,ge.jsx)("div",{style:we.transcript,children:(0,ge.jsx)(m().D,{styleKey:"Body/Regular",children:(0,ge.jsx)(sn().Z,{transcript:b||[],spaceStore:y,threadStore:W,clientStore:n,configType:null==s?void 0:s.type,runningInference:it,showDebugOverride:ie,aiChatFeatureController:A})})}):void 0}):void 0})}),(0,ge.jsxs)("div",{style:we.inputWrapper,children:[(0,ge.jsx)("button",{onClick:()=>ke("smooth"),tabIndex:pe?-1:0,style:{...we.scrollToBottomButton,...!pe&&we.scrollToBottomButtonVisible},children:(0,v().arrowChevronSingleDownFillIcon)(we.chevronDownIcon)}),K?void 0:(0,ge.jsxs)("div",{style:we.inputContainer,children:[(0,ge.jsx)(ot().Xg,{}),(0,ge.jsx)(Le().q,{clientStore:n,threadStore:W,userStore:void 0}),H&&y&&y.table===C().NX?(0,ge.jsx)(Ge().D,{spaceStore:y,workflowStore:H,environment:k}):null,(0,ge.jsx)(Xe().UnifiedChatInputProvider,{aiChatFeatureController:A,clientStore:n,threadStore:W,transcript:b,onEsc:h,onThreadChange:f,nextConfig:gt,onLoaded:ut,onWillSubmit:ct,onSubmitHandlerReady:Me}),ve||"ai_module"!==A.aiChatType?null:(0,ge.jsx)(mn,{contentWidth:"number"==typeof A.chatInputWidth?A.chatInputWidth:600})]})]}),A.shouldShowSuggestedActions&&"below"===A.agentSuggestedActionsPlacementRelativeToChat?(0,ge.jsx)(en,{loadAttachmentData:Be,handlePromptSubmit:dt,readyToAnimate:pt,disableAnimation:q,variant:A.agentSuggestedActionsDisplay,aiChatFeatureController:A,chatLoaded:ve}):null]})]})]})})}function dn({inputMentionPointers:e,stagedMentionPointers:t}){const n=e.map((e=>x().L3.toKey(e)));return t.filter((e=>!n.includes(x().L3.toKey(e))))}function cn(e){const{navigate:t}=(0,r.useContext)(s().E),{aiChatFeatureController:n,onThreadChange:a,clientStore:i,threadStore:g,workflowStore:f,parentStore:v,threadStoreState:y,config:S,shouldShowEmptyState:x}=e,C=(0,l().v3)(),I=(0,d().K8)((()=>{const{device:e,WindowSizeStore:t}=C,a="agent"===n.aiChatType;return(e.isMobileNative||e.isTablet)&&a?t.getSafePaddingTopPx(0):function(e){if(!e.isIOS)return!1;const t=(0,Z().getMobileNativeDeviceInfo)();if(!t.mobileNativeSystemVersion)return!1;const n=t.mobileNativeSystemVersion.split(".").map((e=>parseInt(e,10))),a=[26,0];return(0,A().isGreaterThanOrEqualToVersion)(n,a)}(e)?t.getSafePaddingTopPx(8):0}),[C,n.aiChatType]),w=(0,r.useContext)(Y().eh),{isElectronWindows:M,isTablet:T}=(0,l().Y0)(),R=(0,r.useCallback)((()=>{if(!f)return;const e=(0,j().L)({workflowId:f.id,params:{workflowViewType:"chat"}});t({environment:C,url:e})}),[f,C,t]),P=(0,d().K8)((()=>{var e;return null==f||null===(e=f.getData())||void 0===e?void 0:e.icon}),[f]),_=(0,r.useCallback)((async e=>{(0,Fe().Wq)({environment:C,clientStore:i}),e&&await e.load(),f&&!e?R():a(e)}),[C,i,f,R,a]),E=(0,o().X)("agent_sidebar_only_agent_threads")||n.onlyShowAgentThreads,D=(0,d().O$)(u().b),B=(0,d().K8)((()=>!(0,te().KB)(C)),[C]),z=!x&&!e.hideThreadPicker,L="pill"===n.headerButtonShape,F=(0,r.useCallback)((()=>{f?R():t({environment:C,url:b().JZ.ai})}),[f,R,C,t]),V=(0,d().K8)((()=>{let e="Notion AI";if(f){const t=f.getData();null!=t&&t.name&&(e=t.name)}if("Notion AI"===e&&ne().AppStoreSidebarSpaceViewStore.state){var t;const n=null===(t=ne().AppStoreSidebarSpaceViewStore.state.getSettings())||void 0===t?void 0:t.agent_personalization_settings;null!=n&&n.name&&(e=n.name)}return e}),[f]),O=(0,c().IS)((e=>({agentName:{flexShrink:0,paddingInlineStart:6,paddingInlineEnd:6,minHeight:"unset"},separator:{color:e.text.disabled,paddingInlineStart:2,paddingInlineEnd:2}})),[]),W=(0,ge.jsxs)(p().Y1,{direction:"horizontal",width:"hug",align:"center-left",style:{pointerEvents:"auto",minWidth:0},children:[!D&&B&&n.supportsNotionSidebarButton?(0,ge.jsx)(q().z,{}):null,z?f?(0,ge.jsx)(h().p,{onClick:R,style:{marginInlineStart:2,marginInlineEnd:4,display:"flex",alignItems:"center",justifyContent:"center",paddingInline:0},children:(0,ge.jsx)(ie().AgentIcon,{agentIcon:P,workflowStore:f,size:24})}):(0,ge.jsx)(rt,{aiChatFeatureController:n}):void 0,e.hideAgentName?null:(0,ge.jsx)(h().p,{onClick:F,style:O.agentName,children:(0,ge.jsx)(m().D,{styleKey:"Body/Regular",style:{fontSize:14,cursor:"pointer",textDecoration:"none"},children:V})}),e.hideThreadPicker?null:(0,ge.jsxs)(ge.Fragment,{children:[e.hideAgentName?null:(0,ge.jsx)("span",{style:O.separator,children:"/"}),(0,ge.jsx)(on().AgentThreadHistoryMenu,{aiChatFeatureController:n,buttonShape:n.headerButtonShape,workflowId:S?(0,k().BI)(S):void 0,onThreadChange:_,parentStore:v,threadStore:g,threadStoreState:y,types:E?["workflow"]:void 0})]})]});return(0,ge.jsx)(p().Y1,{direction:"vertical",width:"fill",style:{pointerEvents:"none"},children:(0,ge.jsx)(p().Y1,{direction:"vertical",padding:L?`${8+I}px 8px 8px 8px`:`${8+I}px 12px 8px 12px`,width:"fill",gap:4,children:(0,ge.jsxs)(p().Y1,{direction:"horizontal",align:"center",gap:"auto",minGap:16,children:[W,e.hideActions?void 0:(0,ge.jsxs)(p().Y1,{direction:"horizontal",width:"hug",align:"center-right",gap:2,style:{flexShrink:0,pointerEvents:"auto"},children:[(0,ge.jsx)(Ze().AgentChatActions,{threadStore:g,clientStore:i,aiChatFeatureController:n,onThreadChange:_,showOnHover:n.supportsChatActionsOnHover}),n.supportsChatSidebarModeButton&&!T?(0,ge.jsx)(U().ChatSidebarModeButton,{aiChatFeatureController:n}):null,w?(0,ge.jsx)(un,{aiChatFeatureController:n,onClick:w}):null]}),M?(0,ge.jsx)($().K,{}):void 0]})})})}function un(e){const{aiChatFeatureController:t,onClick:n}=e,a="sidebar"===t.agentChatFormFactor,r=(0,T().tz)(),o=hn({shape:t.headerButtonShape,aiChatFeatureController:t}),i=(0,c().IS)((e=>({shortcutContainer:{display:"flex",alignItems:"center",gap:8},shortcut:{color:e.text.inverseSecondary},minimizeIcon:{...o.iconButtonIcon}})),[o.iconButtonIcon]);return(0,ge.jsx)(H().A,{renderTooltip:()=>(0,ge.jsxs)("div",{style:i.shortcutContainer,children:[(0,ge.jsx)(T().sA,{id:"chatSidebar.minimize",defaultMessage:"Minimize"}),(0,ge.jsx)(N().A,{style:i.shortcut,name:"commandJ"})]}),render:e=>(0,ge.jsx)(W().A,{...e,icon:a?f().O:y().h,iconStyle:a?o.iconButtonIcon:i.minimizeIcon,style:o.iconButton,ariaLabel:r.formatMessage({id:"chatSidebar.minimize",defaultMessage:"Minimize"}),onClick:n,testId:"agent-chat-view-minimize-button"})})}const gn=40,pn=28;function hn(e){const{active:t,shape:n,aiChatFeatureController:a}=e;return(0,c().IS)((e=>{const r=null!=a&&a.supportsTallChatHeader?gn:pn,o=null!=a&&a.supportsTallChatHeader?S().lD.default:S().Ev.default;return{iconButton:{width:r,height:r,..."pill"===n?{borderRadius:50}:{}},iconButtonIcon:{width:o,height:o,fill:t?e.blue.icon.accentPrimary:e.icon.primary}}}),[t,n,null==a?void 0:a.supportsTallChatHeader])}function mn({contentWidth:e}){const t=(0,c().IS)((t=>({mockAgentChatInputWrap:{width:e,maxWidth:"100%",height:120,boxShadow:`0px 0px 0px 0.5px ${t.border.primary}, 0px 4px 12px -2px rgba(0, 0, 0, 0.08)`,backgroundColor:"dark"===t.mode?t.background.elevated:t.background.primary,borderRadius:12,position:"relative"},placeholderShimmer:{position:"absolute",insetInlineStart:16,top:16,borderRadius:6,height:20,width:Math.min(400,e-32)},modeShimmer:{position:"absolute",insetInlineStart:16,bottom:16,borderRadius:6,width:Math.min(180,.4*(e-32)),height:24},sourcesShimmer:{position:"absolute",insetInlineEnd:16,bottom:16,borderRadius:6,width:Math.min(160,.35*(e-32)),height:24}})),[e]);return(0,ge.jsxs)("div",{style:t.mockAgentChatInputWrap,children:[(0,ge.jsx)(K().A,{style:t.placeholderShimmer}),(0,ge.jsx)(K().A,{style:t.modeShimmer}),(0,ge.jsx)(K().A,{style:t.sourcesShimmer})]})}},450424:(e,t,n)=>{n.r(t),n.d(t,{checkmarkCircleFillSmallIcon:()=>r,iconDefinition:()=>a});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"1.94 1.95 12.11 12.11",svg:(0,n(474848).jsx)("path",{d:"M1.95 8a6.05 6.05 0 1 1 12.1 0 6.05 6.05 0 0 1-12.1 0m8.444-1.623a.55.55 0 0 0-.944-.566L7.443 9.156 6.339 7.87a.55.55 0 1 0-.835.716l1.6 1.867a.55.55 0 0 0 .89-.075z"})},r=(0,n(340498).wt)("checkmarkCircleFillSmall",a)},500761:(e,t,n)=>{n.d(t,{Z:()=>Kr});n(18107),n(813451),n(967357),n(898992),n(354520),n(581454),n(737550);var a=n(296540),r=()=>n(484714),o=()=>n(56366),i=()=>n(699143),s=()=>n(534177),l=()=>n(13679),d=()=>n(618425),c=(n(944114),()=>n(496603));var u=()=>n(616878),g=(n(803949),()=>n(878456));const p={config:"user-turn",context:"user-turn",attachment:"user-turn","user-specified-context":"user-turn",user:"user-turn","agent-prebuilt-prompt":"user-turn","agent-inference":"agent-turn","agent-tool-result":"agent-turn",error:"agent-turn","agent-debug-error":"agent-turn","eval-result":"agent-turn","agent-integration":"agent-turn","agent-trigger":"agent-turn","agent-route-trigger":"agent-turn","agent-transcript-summary":"agent-turn","premium-feature-unavailable":"agent-turn","agent-search-query-generation":"agent-turn"};function h(e){return"user-turn"===e.type}function m(e){const{transcript:t,isRunningInference:n}=e,a=[];let r,o,i;const s=[];let l,d=0;for(const c of t){const e=p[c.type];e&&("user-turn"===e?u(c):g(c))}function u(e){switch(m(),r||(r={type:"user-turn"}),e.type){case"config":!function(e){var t;null!==(t=r)&&void 0!==t&&t.userInitiatedStep&&h();r||(r={type:"user-turn"});r.configStep=e}(e);break;case"user":case"agent-prebuilt-prompt":!function(e){var t;null!==(t=r)&&void 0!==t&&t.userInitiatedStep&&h();r||(r={type:"user-turn"});r.userInitiatedStep=e}(e);break;case"user-specified-context":!function(e){var t,n,a;null!==(t=r)&&void 0!==t&&t.userInitiatedStep&&h();r||(r={type:"user-turn"});const o=s.length>0&&(0,c().n4)(null===(n=s[s.length-1])||void 0===n||null===(n=n.value)||void 0===n?void 0:n.pointers,null===(a=e.value)||void 0===a?void 0:a.pointers);o||(s.push(e),r.userSpecifiedContextStep=e)}(e);break;case"attachment":!function(e){var t;null!==(t=r)&&void 0!==t&&t.userInitiatedStep&&h();r||(r={type:"user-turn"});r.attachmentsStep=[...r.attachmentsStep??[],e]}(e);break;case"context":!function(e){i||(i=e.id,r||(r={type:"user-turn"}),r.contextStep=e)}(e)}}function g(e){h(),o?(o.steps.push(e),o.lastStepId=e.id,"agent-inference"===e.type&&(o.hasAgentInferenceStep=!0)):o={type:"agent-turn",steps:[e],hasAgentInferenceStep:"agent-inference"===e.type,lastStepId:e.id}}function h(){r&&(a.push(r),r=void 0)}function m(){if(!o)return;const e={...o,feedbackComponentIndex:o.steps.length>0?d:-1,previousStepId:l};a.push(e),o.steps.length>0&&(d++,l=o.lastStepId),o=void 0}h(),m();const f=a.at(-1);return n&&"agent-turn"!==(null==f?void 0:f.type)&&a.push({type:"agent-turn",steps:[],feedbackComponentIndex:d,previousStepId:l,hasAgentInferenceStep:!1,lastStepId:void 0}),a}var f=()=>n(107527),v=n(474848);const y=(0,a.createContext)({confirmToolUse:()=>{},rejectToolUse:()=>{}});function S(){return(0,a.useContext)(y)}function x({threadStore:e,clientStore:t,environment:n,sendPartialTranscript:r,children:o}){const i=(0,a.useCallback)((a=>{e&&f().WE({environment:n,clientStore:t,threadStore:e,confirmToolStepIds:a,stepIdsToInclude:r?a:void 0})}),[e,t,n,r]),s=(0,a.useCallback)((()=>{e&&f().WE({environment:n,clientStore:t,threadStore:e,confirmToolStepIds:[],stepIdsToInclude:r?[]:void 0})}),[e,t,n,r]),l=(0,a.useMemo)((()=>({confirmToolUse:i,rejectToolUse:s})),[i,s]);return(0,v.jsx)(y.Provider,{value:l,children:o})}y.displayName="ToolUseConfirmationContext";var b=()=>n(59226),C=()=>n(401497),I=()=>n(395797),w=()=>n(981928),M=()=>n(118626),A=()=>n(774952),k=()=>n(588104);function j(e){const{step:t}=e,r=(0,C().IS)((e=>({container:{padding:8,marginBottom:20},icon:{width:16,height:16,fill:e.errorText},codeBlock:{padding:12,borderRadius:8,backgroundColor:e.codeBlockBackground}})),[]),o=(0,a.useMemo)((()=>JSON.stringify(t,null,2)),[t]),i=(0,c().oE)([t.fromInferenceContextType?`prompt=${t.fromInferenceContextType}`:void 0,t.fromToolName?`tool=${t.fromToolName}`:void 0]).join(", ");return(0,v.jsx)(k().Q,{style:r.container,children:(0,v.jsx)(n(562936).b,{label:`Error ${t.errorType}: ${i}`.trim(),icon:n(750559).f,iconStyle:r.icon,children:(0,v.jsx)("div",{style:r.codeBlock,children:(0,v.jsx)(w().O,{value:o,language:"json"})})})})}n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698);function T(e){var t;const{step:n}=e,{evalResult:r,braintrustInfo:o,evaluatedAt:i}=n,[s,l]=(0,a.useState)(new Set),[d,c]=(0,a.useState)(new Set),u=(e,t,n=0)=>{if(Array.isArray(e))return(0,v.jsx)("div",{children:e.map(((e,a)=>(0,v.jsxs)("div",{style:{marginBottom:4},children:[(0,v.jsxs)("strong",{children:["[",a,"]"]}),": ",u(e,`${t}[${a}]`,n)]},a)))});if("object"==typeof e&&void 0!==e&&!Array.isArray(e)){const a=d.has(t),r=Object.entries(e);return(0,v.jsxs)("div",{children:[(0,v.jsxs)("button",{style:{...g.toggleButton,marginInlineStart:8*n},onClick:()=>(e=>{c((t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n}))})(t),type:"button",children:[a?"▼":"▶"," Object (",r.length," ",1===r.length?"key":"keys",")"]}),a?(0,v.jsx)("div",{style:{...g.nestedObject,marginInlineStart:16*(n+1)},children:r.map((([e,a])=>(0,v.jsxs)("div",{style:g.nestedItem,children:[(0,v.jsx)("strong",{children:e}),": ",u(a,`${t}.${e}`,n+1)]},e)))}):void 0]})}return String(e)},g=(0,C().IS)((e=>({container:{backgroundColor:"rgba(0, 150, 255, 0.1)",border:"1px solid rgba(0, 150, 255, 0.3)",borderRadius:8,padding:12,margin:"8px 0",fontSize:12},header:{fontWeight:"bold",color:"#0096ff",marginBottom:8},braintrustInfo:{marginBottom:6,color:"#666"},section:{marginBottom:6},indentedContent:{marginInlineStart:12,marginTop:4},scoreItem:{marginBottom:2},scoreValue:{fontWeight:"bold"},scoreHeader:{display:"flex",alignItems:"center",gap:4},toggleButton:{background:"none",border:"none",cursor:"pointer",fontSize:10,color:"#666",padding:0,marginInlineStart:4},scoreMetadata:{marginInlineStart:16,marginTop:4,padding:4,backgroundColor:"rgba(0, 0, 0, 0.05)",borderRadius:4,fontSize:11,color:"#555"},nestedObject:{marginTop:4,padding:4,backgroundColor:"rgba(0, 0, 0, 0.03)",borderInlineStart:"2px solid rgba(0, 0, 0, 0.1)",borderRadius:2},nestedItem:{marginBottom:2},timestamp:{fontSize:10,color:"#999",marginTop:8}})),[]),p=null===(t=r.metadata)||void 0===t?void 0:t.scoreMetadata;return(0,v.jsxs)("div",{style:g.container,children:[(0,v.jsx)("div",{style:g.header,children:"📊 Evaluation Results"}),o.project?(0,v.jsxs)("div",{style:g.braintrustInfo,children:[(0,v.jsx)("strong",{children:"Project:"})," ",o.project,(0,v.jsx)("br",{}),(0,v.jsx)("strong",{children:"Dataset:"})," ",o.dataset,(0,v.jsx)("br",{}),(0,v.jsx)("strong",{children:"ID:"})," ",o.originalInferenceId]}):void 0,Object.keys(r.scores).length>0?(0,v.jsxs)("div",{style:g.section,children:[(0,v.jsx)("strong",{children:"Scores:"}),(0,v.jsx)("div",{style:g.indentedContent,children:Object.entries(r.scores).map((([e,t])=>{var n;let a;p&&"object"==typeof p&&void 0!==p&&(a=p);const r=null===(n=a)||void 0===n?void 0:n[e],o=r&&"object"==typeof r&&void 0!==r,i=s.has(e);return(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{style:g.scoreItem,children:(0,v.jsxs)("div",{style:g.scoreHeader,children:[(0,v.jsxs)("span",{children:[e,": ",(0,v.jsx)("span",{style:g.scoreValue,children:t.toFixed(3)})]}),o?(0,v.jsx)("button",{style:g.toggleButton,onClick:()=>{return t=e,void l((e=>{const n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n}));var t},type:"button",children:i?"▼":"▶"}):void 0]})}),o&&i?(0,v.jsx)("div",{style:g.scoreMetadata,children:Object.entries(r).map((([t,n])=>(0,v.jsxs)("div",{children:[(0,v.jsx)("strong",{children:t}),": ",u(n,`${e}.${t}`)]},t)))}):void 0]},e)}))})]}):void 0,(0,v.jsxs)("div",{style:g.timestamp,children:["Evaluated at: ",new Date(i).toLocaleString()]})]})}var R=()=>n(493552),P=()=>n(69708);const _=(0,P().YK)({agentSkippedTitle:{id:"aiInferenceTranscript.agentRouteTriggerStepRenderer.agentSkippedTitle",defaultMessage:"Skipped task"},agentSkippedDescription:{id:"aiInferenceTranscript.agentRouteTriggerStepRenderer.agentSkippedDescription",defaultMessage:"This task was skipped because the trigger conditions were not met."}});function E(e){const{step:t}=e,a=(0,C().IS)((e=>({container:{borderRadius:6,padding:12,marginBlock:8},iconContainer:{width:24,height:24,display:"grid",placeItems:"center"},icon:{width:16,height:16,color:e.icon.secondary},textContainer:{display:"flex",flexDirection:"column",gap:12,minWidth:0,flex:1}})),[]);return t.passed?null:(0,v.jsx)("div",{style:a.container,children:(0,v.jsxs)(i().Y1,{direction:"horizontal",gap:8,width:"fill",align:"top-left",children:[(0,v.jsx)("div",{style:a.iconContainer,children:(0,n(75318).j)(a.icon)}),(0,v.jsxs)("div",{style:a.textContainer,children:[(0,v.jsx)(R().D,{styleKey:"Body/Regular",colorVariant:"secondary",style:{lineHeight:"24px"},children:(0,v.jsx)(P().sA,{..._.agentSkippedTitle})}),(0,v.jsx)(R().D,{styleKey:"Body/Regular",colorVariant:"secondary",children:(0,v.jsx)(P().sA,{..._.agentSkippedDescription})})]})]})})}var D=()=>n(252291),B=()=>n(369955),z=()=>n(759113),L=()=>n(631524),F=()=>n(222334),U=()=>n(97889),V=()=>n(340498);const O={viewBox:"0 0 16 16",fittedViewBox:"3.28 3.22 9.44 9.45",svg:(0,v.jsx)("path",{d:"M12.487 3.457a.804.804 0 0 0-1.13 0l-.553.552a.075.075 0 0 0 0 .106l1.03 1.03a.075.075 0 0 0 .106 0l.547-.546a.1.1 0 0 0 .019-.032.804.804 0 0 0-.019-1.11m-2.247 1.22a.075.075 0 0 0-.105 0l-6.337 6.326a1.1 1.1 0 0 0-.237.393l-.269.87v.002c-.063.232.153.466.388.383l.863-.267q.222-.061.398-.239l6.331-6.331a.075.075 0 0 0 0-.106z"})},W=(0,V().wt)("pencilSmall",O);var N=()=>n(743246),K=()=>n(684537),H=()=>n(285790),$=()=>n(859428),Y=()=>n(201718),q=()=>n(177097),G=()=>n(531012),X=()=>n(310818),Q=()=>n(781317);const Z=(0,P().YK)({editTrigger:{id:"agentStepHeader.editTrigger",defaultMessage:"Edit trigger"},reRun:{id:"agentStepHeader.reRun",defaultMessage:"Re-run"}});function J(e){const{isExpanded:t,isBusy:n=!1,canExpand:s,onToggleExpanded:l,onTitleClicked:d,icon:c,title:u,hideIcon:g,children:p,triggerStep:h,threadStore:m}=e,f=(0,r().v3)(),y=(0,B().L)(),S=(0,X().Sn)(),x=(0,P().tz)(),b=(0,o().K8)((()=>{if(y&&null!=h&&h.workflowId)return Y().N.createChildStore(y,{table:N().C0,id:h.workflowId,spaceId:y.id})}),[y,null==h?void 0:h.workflowId]),I=(0,a.useCallback)((async()=>{h&&b&&await(0,G().B)({workflowOrArtifactStore:b,triggerId:h.triggerId,appearance:"editTrigger",intl:x})}),[h,b,x]),w=(0,a.useCallback)((async()=>{h&&b&&y&&m&&(await(0,q().reRunWorkflowFromThread)({environment:f,spaceStore:y,workflowStore:b,threadId:m.id}),await(null==S?void 0:S.refreshThreads()))}),[h,b,y,f,m,S]),M=(0,C().IS)((e=>({button:{width:"100%",height:"auto",paddingBlock:8,paddingInline:12,textAlign:"start",borderEndStartRadius:t?0:void 0,borderEndEndRadius:t?0:void 0,display:"flex",flexDirection:"column",gap:4,alignItems:"start"},chevron:{marginInlineStart:"auto",transform:t?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s ease-in-out"},iconContainer:{display:"flex",alignItems:"center",justifyContent:"center",height:20,width:20,opacity:n?.3:1},title:{color:e.text.secondary,minWidth:0,flexGrow:1,...(0,K().d)("Body/Regular")},icon:{width:16,height:16},actionButtons:{display:"flex",gap:2}})),[t,n]);return(0,v.jsxs)(L().p,{disabled:n||!s&&!d,onClick:d||l,style:M.button,children:[(0,v.jsxs)(i().Y1,{direction:"horizontal",gap:8,width:"fill",height:"hug",align:"center",children:[!g&&c?(0,v.jsx)("div",{style:M.iconContainer,children:n?(0,v.jsx)(Q().J,{}):(0,v.jsx)(D().I,{icon:c,colorVariant:"secondary"})}):void 0,(0,v.jsx)("span",{style:M.title,children:u}),(0,v.jsxs)("div",{style:M.actionButtons,children:[h&&b?(0,v.jsx)($().A,{renderTooltip:()=>x.formatMessage(Z.reRun),render:e=>(0,v.jsx)(H().A,{...e,icon:U().C,iconStyle:M.icon,onClick:w,size:"md",ariaLabel:x.formatMessage(Z.reRun)})}):void 0,h&&b?(0,v.jsx)($().A,{renderTooltip:()=>x.formatMessage(Z.editTrigger),render:e=>(0,v.jsx)(H().A,{...e,icon:W,iconStyle:M.icon,onClick:I,size:"md",ariaLabel:x.formatMessage(Z.editTrigger)})}):void 0]}),s?(0,v.jsx)(D().I,{icon:F().arrowChevronSingleRightIcon,colorVariant:"tertiary",size:"default",style:M.chevron}):void 0]}),p]})}var ee=()=>n(203066),te=()=>n(153321);function ne(e){const{origin:t,content:n,isExpanded:a,shouldSkipContentPadding:r,disableInitialAnimation:o,hideOrigin:i}=e,s=(0,C().IS)((()=>({container:{display:"flex",flexDirection:"column",minWidth:0}})),[]);return i&&n?(0,v.jsx)("div",{style:s.container,children:(0,v.jsx)("div",{children:n})}):n?(0,v.jsxs)("div",{style:s.container,children:[t,(0,v.jsx)(ee().N,{children:a?(0,v.jsx)(te().P.div,{initial:!o&&{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2,ease:"easeInOut"},style:{overflow:"hidden",padding:1,margin:-1},children:(0,v.jsx)("div",{style:{paddingTop:r?0:10},children:n})}):void 0})]}):(0,v.jsx)("div",{style:s.container,children:t})}const ae=(0,P().YK)({taskTriggered:{id:"agentTrigger.taskTriggered",defaultMessage:"Task triggered"}});function re(e){const{step:t,threadStore:r}=e,i=(0,P().tz)(),[s,l]=(0,a.useState)(!1),d=(0,a.useMemo)((()=>(0,z().getSpecificWorkflowTrigger)({workflowData:t.workflow,triggerId:t.triggerId})),[t.workflow,t.triggerId]),c=(0,a.useMemo)((()=>(0,z().getTriggerDefinitionBySpecificTrigger)(d)),[d]),u=(0,C().IS)((e=>({wrapper:{borderRadius:10,overflow:"hidden",boxShadow:e.shadow2XS,transition:"box-shadow 0.15s ease-in-out"},border:{height:1,backgroundColor:e.border.secondary},content:{paddingTop:0,paddingInlineEnd:12,paddingBottom:10,paddingInlineStart:12},titleContainer:{display:"flex",flexDirection:"column",gap:4,flex:1,minWidth:0,overflow:"hidden",maxWidth:400},titleText:{display:"flex",flexDirection:"row",overflow:"hidden",minWidth:0},triggerPill:{display:"flex",flexDirection:"row",alignItems:"center",gap:4,borderRadius:100,height:28,paddingInline:12,width:"fit-content",backgroundColor:e.background.tertiary,color:e.text.secondary},triggerPillLine:{height:15,width:1.5,backgroundColor:e.border.secondary,marginInlineStart:20}})),[]),g=(0,B().L)(),p=(0,o().K8)((()=>{if(!t.workflowId||!g)return;return{table:"workflow",id:t.workflowId,spaceId:g.id}}),[t.workflowId,g]),h=(0,a.useMemo)((()=>null!=c&&c.TriggerOrRunTitle&&d&&p?(0,v.jsx)(c.TriggerOrRunTitle,{trigger:d,data:t.data,moduleId:d.moduleId??"notion",workflowDefinitionPointer:p,titleContext:"trigger"}):i.formatMessage({defaultMessage:"Trigger",id:"agentTranscript.triggerStep.label"})),[c,d,i,t.data,p]),m=(0,a.useMemo)((()=>t.data&&null!=c&&c.TriggerContent&&d&&d.moduleId&&p?(0,v.jsx)(c.TriggerContent,{trigger:d,data:t.data,moduleId:d.moduleId,workflowDefinitionPointer:p}):null),[t.data,c,d,p]);return(0,a.useEffect)((()=>{Boolean(m)&&l(!0)}),[m]),(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",{style:u.triggerPill,children:[(0,v.jsx)(D().I,{icon:n(199483).o,size:"sm",colorVariant:"secondary"}),(0,v.jsx)(P().sA,{...ae.taskTriggered})]}),(0,v.jsx)("div",{style:u.triggerPillLine}),(0,v.jsx)("div",{style:u.wrapper,children:(0,v.jsx)(ne,{isExpanded:s,origin:(0,v.jsx)(J,{isExpanded:s,canExpand:!1,onToggleExpanded:()=>l(!s),title:(0,v.jsx)("div",{style:u.titleContainer,children:(0,v.jsx)("div",{style:u.titleText,children:(0,v.jsx)(R().D,{styleKey:"Body/Regular",colorVariant:"secondary",textOverflow:"ellipsis",children:h})})}),icon:null==c?void 0:c.icon,triggerStep:t,threadStore:r}),content:m?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{style:u.border}),(0,v.jsx)("div",{style:u.content,children:m})]}):void 0,shouldSkipContentPadding:!0})})]})}n(823215);var oe=()=>n(778417),ie=()=>n(975366);function se(e){const{chatPartData:t,aiChatFeatureController:n}=e;return(0,v.jsx)(i().Y1,{direction:"vertical",padding:"0 4px",children:(0,v.jsx)(ie().h,{markdown:t.markdown,citationContext:t.citationContext,aiChatFeatureController:n})})}n(672577);var le=()=>n(944584),de=()=>n(155382),ce=()=>n(621594),ue=()=>n(383894),ge=(n(16280),()=>n(365646)),pe=()=>n(800204),he=()=>n(506391),me=()=>n(671593),fe=()=>n(638681),ve=()=>n(66757),ye=()=>n(449851),Se=()=>n(923803);function xe(e){for(const t of ve().zP){const n=ve().JN[t];for(const a of n.effectsArray)if(a===e)return t}throw new Error(`Did not find effect key ${e} in any module`)}function be(e){const t=xe(e),n=Se().y[t].effect[e];if(!n)throw new Error(`Did not find effect definition for ${e}`);return n}function Ce({intl:e,state:t,numResults:n,toolName:a,toolResultStep:r,isMultiDatabaseMode:o,includeToolNoun:i,isReferencingContextPage:l}){switch(a){case"search":switch(t){case"loading":case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.search.loading.withQuery",defaultMessage:"Searching"});case"done":return e.formatMessage({id:"AgentInferenceStepRenderer.search.done",defaultMessage:"Searched"})}break;case"view":switch(t){case"loading":case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.view.loading",defaultMessage:"Viewing"});case"done":if(r&&(0,ge().gY)(r,"view")){var d;const t=(null===(d=r.result)||void 0===d?void 0:d.entities)??[];if(t.length<=1)return 1===t.length&&"webpage"===t[0].type?e.formatMessage({id:"AgentInferenceStepRenderer.view.done.singleWebpage",defaultMessage:"Viewed {website}"},{website:(0,he().Wo)(t[0].url)}):e.formatMessage({id:"AgentInferenceStepRenderer.view.done",defaultMessage:"Viewed"});const n=new Map;for(const e of t){let t=e.type;"collection"!==t&&"database"!==t||(t="database"),n.set(t,(n.get(t)??0)+1)}if(1!==n.size)return e.formatMessage({id:"AgentInferenceStepRenderer.view.doneMultiple.items",defaultMessage:"Viewed {count} items"},{count:t.length});{const[a,r]=Array.from(n.entries())[0];switch(a){case"page":return e.formatMessage({id:"AgentInferenceStepRenderer.view.doneMultiple.pages",defaultMessage:"Viewed {count} pages"},{count:r});case"database":return e.formatMessage({id:"AgentInferenceStepRenderer.view.doneMultiple.databases",defaultMessage:"Viewed {count} databases"},{count:r});case"user":return e.formatMessage({id:"AgentInferenceStepRenderer.view.doneMultiple.users",defaultMessage:"Viewed {count} users"},{count:r});case"file":return e.formatMessage({id:"AgentInferenceStepRenderer.view.doneMultiple.files",defaultMessage:"Viewed {count} files"},{count:r});case"webpage":return e.formatMessage({id:"AgentInferenceStepRenderer.view.doneMultiple.websites",defaultMessage:"Viewed {count} websites"},{count:r});default:return e.formatMessage({id:"AgentInferenceStepRenderer.view.doneMultiple.unknownType",defaultMessage:"Viewed {count} items"},{count:t.length})}}}return e.formatMessage({id:"AgentInferenceStepRenderer.view.done",defaultMessage:"Viewed"})}break;case"view-version-history":switch(t){case"loading":case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.viewVersionHistory.loading",defaultMessage:"Viewing version history"});case"done":if(r&&(0,ge().gY)(r,"view-version-history")){var c;const t=(null===(c=r.result)||void 0===c?void 0:c.entities)??[];if(t.length<=1)return e.formatMessage({id:"AgentInferenceStepRenderer.viewVersionHistory.done",defaultMessage:"Viewed version history"});const n=new Map;for(const e of t){const t=e.type;n.set(t,(n.get(t)??0)+1)}if(1!==n.size)return e.formatMessage({id:"AgentInferenceStepRenderer.viewVersionHistory.doneMultiple.items",defaultMessage:"Viewed {count} items' version histories"},{count:t.length});{const[a,r]=Array.from(n.entries())[0];switch(a){case"page":return e.formatMessage({id:"AgentInferenceStepRenderer.viewVersionHistory.doneMultiple.pages",defaultMessage:"Viewed {count} pages' version histories"},{count:r});case"database":return e.formatMessage({id:"AgentInferenceStepRenderer.viewVersionHistory.doneMultiple.databases",defaultMessage:"Viewed {count} databases' version histories"},{count:r});default:return e.formatMessage({id:"AgentInferenceStepRenderer.viewVersionHistory.doneMultiple.unknownType",defaultMessage:"Viewed {count} items' version histories"},{count:t.length})}}}return e.formatMessage({id:"AgentInferenceStepRenderer.viewVersionHistory.done",defaultMessage:"Viewed version history"})}break;case"view-database-files":switch(t){case"loading":case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.viewDatabaseFiles.loading",defaultMessage:"Viewing code"});case"done":return e.formatMessage({id:"AgentInferenceStepRenderer.viewDatabaseFiles.done",defaultMessage:"Viewed code"})}break;case"create-database":switch(t){case"loading":return e.formatMessage({id:"AgentInferenceStepRenderer.createDatabase.loading",defaultMessage:"Creating database"});case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.createDatabase.undone",defaultMessage:"Create database"});case"done":return i?e.formatMessage({id:"AgentInferenceStepRenderer.createDatabase.doneWithNoun",defaultMessage:"Created database"}):e.formatMessage({id:"AgentInferenceStepRenderer.createDatabase.done",defaultMessage:"Created"})}break;case"update-database":return"loading"===t?i?e.formatMessage({id:"AgentInferenceStepRenderer.updateDatabase.loadingWithNoun",defaultMessage:"Updating database"}):e.formatMessage({id:"AgentInferenceStepRenderer.updateDatabase.loading",defaultMessage:"Updating"}):"reverted"===t?e.formatMessage({id:"AgentInferenceStepRenderer.updateDatabase.undone",defaultMessage:"Update database"}):i?e.formatMessage({id:"AgentInferenceStepRenderer.updateDatabase.doneWithNoun",defaultMessage:"Updated database"}):e.formatMessage({id:"AgentInferenceStepRenderer.updateDatabase.done",defaultMessage:"Updated"});case"query-data-sources":{var u;const n=r&&(0,ge().gY)(r,"query-data-sources")?(null===(u=r.result)||void 0===u?void 0:u.collectionIds)??[]:[];switch(t){case"loading":case"reverted":return n.length&&!i?e.formatMessage({id:"AgentInferenceStepRenderer.queryDataSources.loading.withSourceIncluded",defaultMessage:"Searching"}):o?e.formatMessage({id:"AgentInferenceStepRenderer.queryDataSources.loading",defaultMessage:"Searching data sources"}):e.formatMessage({id:"AgentInferenceStepRenderer.queryDatabases.loading",defaultMessage:"Searching databases"});case"done":return n.length&&!i?e.formatMessage({id:"AgentInferenceStepRenderer.queryDataSources.done.withSourceIncluded",defaultMessage:"Searched"}):o?e.formatMessage({id:"AgentInferenceStepRenderer.queryDataSources.done",defaultMessage:"Searched data sources"}):e.formatMessage({id:"AgentInferenceStepRenderer.queryDatabases.done",defaultMessage:"Searched databases"})}break}case"update-database-triggers":switch(t){case"loading":return e.formatMessage({id:"AgentInferenceStepRenderer.updateDatabaseTriggers.loading",defaultMessage:"Updating triggers"});case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.updateDatabaseTriggers.undone",defaultMessage:"Update triggers"});case"done":return e.formatMessage({id:"AgentInferenceStepRenderer.updateDatabaseTriggers.done",defaultMessage:"Updated triggers"})}break;case"error":return e.formatMessage({id:"AgentInferenceStepRenderer.error",defaultMessage:"Error"});case"create-pages":switch(t){case"loading":return e.formatMessage({id:"AgentInferenceStepRenderer.createPages.loading",defaultMessage:"Creating pages"});case"reverted":return n<=1?e.formatMessage({id:"AgentInferenceStepRenderer.createPages.undone",defaultMessage:"Create page"}):e.formatMessage({id:"AgentInferenceStepRenderer.createPages.undonePlural",defaultMessage:"Create {numResults} pages"},{numResults:n});case"done":return n<=1?i?e.formatMessage({id:"AgentInferenceStepRenderer.createPages.doneWithNoun",defaultMessage:"Created page"}):e.formatMessage({id:"AgentInferenceStepRenderer.createPages.done",defaultMessage:"Created"}):e.formatMessage({id:"AgentInferenceStepRenderer.createPages.donePlural",defaultMessage:"Created {numResults} pages"},{numResults:n})}break;case"delete-pages":switch(t){case"loading":return e.formatMessage({id:"AgentInferenceStepRenderer.deletePage.loading",defaultMessage:"Deleting pages"});case"reverted":return n<=1?e.formatMessage({id:"AgentInferenceStepRenderer.deletePage.undone",defaultMessage:"Delete page"}):e.formatMessage({id:"AgentInferenceStepRenderer.deletePage.undonePlural",defaultMessage:"Delete {numResults} pages"},{numResults:n});case"done":return n<=1?i?e.formatMessage({id:"AgentInferenceStepRenderer.deletePage.doneWithNoun",defaultMessage:"Deleted page"}):e.formatMessage({id:"AgentInferenceStepRenderer.deletePage.done",defaultMessage:"Deleted"}):e.formatMessage({id:"AgentInferenceStepRenderer.deletePage.donePlural",defaultMessage:"Deleted {numResults} pages"},{numResults:n})}break;case"update-page":if(l)switch(t){case"loading":return e.formatMessage({id:"AgentInferenceStepRenderer.updatePage.loadingInstructions",defaultMessage:"Updating instructions"});case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.updatePage.undoneInstructions",defaultMessage:"Update instructions"});case"done":return e.formatMessage({id:"AgentInferenceStepRenderer.updatePage.doneInstructions",defaultMessage:"Updated instructions"})}switch(t){case"loading":return i?e.formatMessage({id:"AgentInferenceStepRenderer.updatePage.loadingWithNoun",defaultMessage:"Updating page"}):e.formatMessage({id:"AgentInferenceStepRenderer.updatePage.loading",defaultMessage:"Updating"});case"reverted":return n<=1?e.formatMessage({id:"AgentInferenceStepRenderer.updatePage.undone",defaultMessage:"Update page"}):e.formatMessage({id:"AgentInferenceStepRenderer.updatePage.undonePlural",defaultMessage:"Update {numResults} pages"},{numResults:n});case"done":return n<=1?i?e.formatMessage({id:"AgentInferenceStepRenderer.updatePage.doneWithNoun",defaultMessage:"Updated page"}):e.formatMessage({id:"AgentInferenceStepRenderer.updatePage.done",defaultMessage:"Updated"}):e.formatMessage({id:"AgentInferenceStepRenderer.updatePage.donePlural",defaultMessage:"Updated {numResults} pages"},{numResults:n})}break;case"update-database-data-sources":switch(t){case"loading":case"reverted":return o?e.formatMessage({id:"AgentInferenceStepRenderer.updateDataSources.loading",defaultMessage:"Updating data sources"}):e.formatMessage({id:"AgentInferenceStepRenderer.updateDatabases.loading",defaultMessage:"Updating databases"});case"done":return o?e.formatMessage({id:"AgentInferenceStepRenderer.updateDataSources.done",defaultMessage:"Updated data sources"}):e.formatMessage({id:"AgentInferenceStepRenderer.updateDatabases.done",defaultMessage:"Updated databases"})}break;case"update-database-views":switch(t){case"loading":case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.updateViews.loading",defaultMessage:"Updating views"});case"done":return e.formatMessage({id:"AgentInferenceStepRenderer.updateViews.done",defaultMessage:"Updated views"})}break;case"result":switch(t){case"loading":case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.asyncSuccess.loading",defaultMessage:"Finishing task"});case"done":return e.formatMessage({id:"AgentInferenceStepRenderer.asyncSuccess.done",defaultMessage:"Finished task"})}break;default:if((0,pe().og)(a))return function(e,{intl:t,isLoading:n,toolResultStep:a}){return be(e).getDescription({intl:t,isLoading:n,toolResultStep:a})}(a,{intl:e,isLoading:"loading"===t,toolResultStep:r});if("update-user-integrations"===a)switch(t){case"loading":case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.updateIntegrations.loading",defaultMessage:"Updating integrations"});case"done":return e.formatMessage({id:"AgentInferenceStepRenderer.updateIntegrations.done",defaultMessage:"Updated integrations"})}else if("toggle-user-integration-tools"===a){if(r&&(0,ge().gY)(r,"toggle-user-integration-tools"))return function(e){const{intl:t,state:n,toolResultStep:a}=e;if(!a||!(0,ge().gY)(a,"toggle-user-integration-tools"))return"loading"===n?t.formatMessage({id:"AgentInferenceStepRenderer.updateIntegrations.loading",defaultMessage:"Updating integrations"}):t.formatMessage({id:"AgentInferenceStepRenderer.updateIntegrations.done",defaultMessage:"Updated integrations"});const r=a.result,o=(e,t)=>!(!e||!e.toLowerCase().includes("mail")&&!e.toLowerCase().includes("calendar")&&"Notion Mail"!==e&&"Notion Calendar"!==e)||!(!t||!(t.includes("mail")||t.includes("calendar")||t.includes(":6010")||t.includes(":5001"))),i=e=>{var t;if(!e||null===(t=a.threadRecordMap)||void 0===t||!t.recordMap)return[];const n=[],r=a.threadRecordMap.recordMap;for(const a of e){if(!we(a))continue;const e=r.workflow_module;if(!e)continue;const t=e[a.id];if(!t)continue;let i,s=!1;if(je(t)){const e=t.value.data;e&&(i=e.name||e.serverUrl,s=o(e.name,e.serverUrl))}else if(Te(t)){const e=t.data;e&&(i=e.name||e.serverUrl,s=o(e.name,e.serverUrl))}s||i&&n.push(i)}return n},l=null==r?void 0:r.activeIntegrationPointers,d=null==r?void 0:r.inactiveIntegrationPointers,c=e=>{var t;if(!e||null===(t=a.threadRecordMap)||void 0===t||!t.recordMap)return 0;let n=0;const r=a.threadRecordMap.recordMap;for(const a of e){if(!we(a))continue;const e=r.workflow_module;if(!e)continue;const t=e[a.id];if(!t)continue;let i=!1;if(je(t)){const e=t.value.data;e&&(i=o(e.name,e.serverUrl))}else if(Te(t)){const e=t.data;e&&(i=o(e.name,e.serverUrl))}i||n++}return n},u=c(l),g=c(d),p=i(l),h=i(d),m=e=>0===e.length?"":1===e.length?e[0]:2===e.length?`${e[0]} and ${e[1]}`:`${e.slice(0,-1).join(", ")}, and ${e[e.length-1]}`;let f="";if((0,s().O9)(u)&&u>0){const e=m(p);f=e?"loading"===n?t.formatMessage({defaultMessage:"{numberOfIntegrations, plural, one {Activating {integrationNames} integration} other {Activating {integrationNames} integrations}}",id:"AgentInferenceStepRenderer.activateIntegrationsWithNames.loading"},{numberOfIntegrations:u,integrationNames:e}):t.formatMessage({defaultMessage:"{numberOfIntegrations, plural, one {Activated {integrationNames} integration} other {Activated {integrationNames} integrations}}",id:"AgentInferenceStepRenderer.activateIntegrationsWithNames.done"},{numberOfIntegrations:u,integrationNames:e}):"loading"===n?t.formatMessage({defaultMessage:"{numberOfIntegrations, plural, one {Activating {numberOfIntegrations} integration} other {Activating {numberOfIntegrations} integrations}}",id:"AgentInferenceStepRenderer.activateIntegrations.loading"},{numberOfIntegrations:u}):t.formatMessage({defaultMessage:"{numberOfIntegrations, plural, one {Activated {numberOfIntegrations} integration} other {Activated {numberOfIntegrations} integrations}}",id:"AgentInferenceStepRenderer.activateIntegrations.done"},{numberOfIntegrations:u})}let v="";if((0,s().O9)(g)&&g>0){const e=m(h);v=e?"loading"===n?t.formatMessage({defaultMessage:"{numberOfIntegrations, plural, one {Deactivating {integrationNames} integration} other {Deactivating {integrationNames} integrations}}",id:"AgentInferenceStepRenderer.deactivateIntegrationsWithNames.loading"},{numberOfIntegrations:g,integrationNames:e}):t.formatMessage({defaultMessage:"{numberOfIntegrations, plural, one {Deactivated {integrationNames} integration} other {Deactivated {integrationNames} integrations}}",id:"AgentInferenceStepRenderer.deactivateIntegrationsWithNames.done"},{numberOfIntegrations:g,integrationNames:e}):"loading"===n?t.formatMessage({defaultMessage:"{numberOfIntegrations, plural, one {Deactivating {numberOfIntegrations} integration} other {Deactivating {numberOfIntegrations} integrations}}",id:"AgentInferenceStepRenderer.deactivateIntegrations.loading"},{numberOfIntegrations:g}):t.formatMessage({defaultMessage:"{numberOfIntegrations, plural, one {Deactivated {numberOfIntegrations} integration} other {Deactivated {numberOfIntegrations} integrations}}",id:"AgentInferenceStepRenderer.deactivateIntegrations.done"},{numberOfIntegrations:g})}if(f&&v)return t.formatList([f,v.toLocaleLowerCase()],{style:"long",type:"conjunction"});if(f)return f;if(v)return v;{var y,S;const e=(null==r||null===(y=r.activeIntegrationPointers)||void 0===y?void 0:y.length)||0,a=(null==r||null===(S=r.inactiveIntegrationPointers)||void 0===S?void 0:S.length)||0;return e>0||a>0?"":"loading"===n?t.formatMessage({id:"AgentInferenceStepRenderer.updateIntegrations.loading",defaultMessage:"Updating integrations"}):t.formatMessage({id:"AgentInferenceStepRenderer.updateIntegrations.done",defaultMessage:"Updated integrations"})}}({intl:e,state:t,toolResultStep:r});switch(t){case"loading":case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.updateIntegrations.loading",defaultMessage:"Updating integrations"});case"done":return e.formatMessage({id:"AgentInferenceStepRenderer.updateIntegrations.done",defaultMessage:"Updated integrations"})}}else{if("edit-json"===a)throw new Error("edit-json tool should not be used in the UI");if("codegen.run"===a)switch(t){case"loading":case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.codegenRun.loading",defaultMessage:"Running codegen"});case"done":return e.formatMessage({id:"AgentInferenceStepRenderer.codegenRun.done",defaultMessage:"Ran codegen"})}else if("codegen.runStatus"===a)switch(t){case"loading":case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.codegenRunStatus.loading",defaultMessage:"Checking codegen status"});case"done":return e.formatMessage({id:"AgentInferenceStepRenderer.codegenRunStatus.done",defaultMessage:"Checked codegen status"})}else if("spawn-agent"===a){if(r&&(0,ge().gY)(r,"spawn-agent")){let e;const t=null==r?void 0:r.result;if(("progress"===(null==t?void 0:t.type)||"done"===(null==t?void 0:t.type))&&(e=t.taskSummary),e)return e}switch(t){case"loading":case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.spawnAgent.loading",defaultMessage:"Task received"});case"done":return e.formatMessage({id:"AgentInferenceStepRenderer.spawnAgent.done",defaultMessage:"Task completed"})}}else if("create-agent"===a)switch(t){case"loading":return e.formatMessage({id:"AgentInferenceStepRenderer.createAgent.loading",defaultMessage:"Creating agent"});case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.createAgent.undone",defaultMessage:"Create agent"});case"done":return e.formatMessage({id:"AgentInferenceStepRenderer.createAgent.done",defaultMessage:"Created agent"})}else if("update-agent"===a)switch(t){case"loading":return e.formatMessage({id:"AgentInferenceStepRenderer.updateAgent.loading",defaultMessage:"Updating agent"});case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.updateAgent.undone",defaultMessage:"Update agent"});case"done":return e.formatMessage({id:"AgentInferenceStepRenderer.updateAgent.done",defaultMessage:"Updated agent"})}else if("delete-agent"===a)switch(t){case"loading":return e.formatMessage({id:"AgentInferenceStepRenderer.deleteAgent.loading",defaultMessage:"Deleting agent"});case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.deleteAgent.undone",defaultMessage:"Delete agent"});case"done":return e.formatMessage({id:"AgentInferenceStepRenderer.deleteAgent.done",defaultMessage:"Deleted agent"})}else if("query-salesforce-tool"===a){if(r&&(0,ge().gY)(r,"query-salesforce-tool")){var g,p,h,m,f,v;if("runQuery"===(null==r||null===(g=r.result)||void 0===g?void 0:g.mode)&&null!=r&&null!==(p=r.result)&&void 0!==p&&p.query)return`${null==r||null===(f=r.result)||void 0===f?void 0:f.query}`;if("requiresUserAuthentication"===(null==r||null===(h=r.result)||void 0===h?void 0:h.mode)&&null!=r&&null!==(m=r.result)&&void 0!==m&&m.requiresUserAuthentication)return`${null==r||null===(v=r.result)||void 0===v?void 0:v.message}`}switch(t){case"loading":case"reverted":return e.formatMessage({id:"AgentInferenceStepRenderer.search.loading.withQuery",defaultMessage:"Searching"});case"done":return e.formatMessage({id:"AgentInferenceStepRenderer.search.done",defaultMessage:"Searched"})}}else(0,s().HB)(a)}}}const Ie=fe().object({required:{table:fe().literal("workflow_module"),id:fe().string()},optional:{}});function we(e){return!!(0,me().Xj)(Ie,e)}const Me=fe().object({required:{},optional:{name:fe().string(),serverUrl:fe().string()}}),Ae=fe().object({required:{},optional:{data:Me,module_type:fe().string()}}),ke=fe().object({required:{value:Ae},optional:{spaceId:fe().string()}});function je(e){return!!(0,me().Xj)(ke,e)}function Te(e){return!!(0,me().Xj)(Ae,e)}function Re({toolName:e,variant:t="default"}){const n=(0,P().tz)(),a=(0,b().X)("agent_multidb_creation");return(0,v.jsx)(ue().N,{icon:ce().exclamationMarkCircleSmallIcon,variant:t,title:(0,v.jsx)(R().D,{styleKey:"Body/Regular",colorVariant:"secondary",children:(0,v.jsx)(P().sA,{id:"AgentToolError.message",defaultMessage:"Oops! Something went wrong while {toolName}",values:{toolName:(0,v.jsx)("span",{style:{textTransform:"lowercase"},children:Ce({toolName:e,state:"loading",numResults:1,intl:n,isMultiDatabaseMode:a,includeToolNoun:!0})})}})})})}var Pe=()=>n(98126),_e=()=>n(505121);function Ee(e,t){if(null==e)return(0,v.jsx)("span",{style:{color:t.text.tertiary},children:"null"});if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return(0,v.jsx)("span",{style:{color:t.text.primary},children:String(e)});if(Array.isArray(e))return(0,v.jsx)("div",{style:{paddingInlineStart:16},children:e.map(((e,n)=>(0,v.jsxs)("div",{style:{marginBlockEnd:4},children:[(0,v.jsx)("span",{style:{color:t.text.tertiary},children:`[${n}]`}),(0,v.jsx)("span",{style:{marginInlineStart:8},children:Ee(e,t)})]},n)))});if("object"==typeof e){const n=Object.entries(e);return(0,v.jsx)("div",{children:n.map((([e,n],a)=>(0,v.jsxs)("div",{style:{marginBlockEnd:8},children:[(0,v.jsx)("span",{style:{color:t.text.secondary,fontFamily:"monospace",fontSize:13},children:`${e}:`}),(0,v.jsx)("span",{style:{marginInlineStart:8,fontFamily:"monospace",fontSize:13,color:t.text.primary},children:Ee(n,t)})]},e)))})}return(0,v.jsx)(_e().Z,{data:e})}function De(e){if("object"==typeof e&&null!==e)return Array.isArray(e)?e.map((e=>{if("object"==typeof e&&null!==e&&"type"in e&&"string"==typeof e.type){if("text"===e.type&&"text"in e&&"string"==typeof e.text)try{const t=JSON.parse(e.text);return{...e,text:t}}catch{return e}if("resource"===e.type&&"resource"in e&&"object"==typeof e.resource&&null!==e.resource&&"text"in e.resource&&"string"==typeof e.resource.text)try{const t=JSON.parse(e.resource.text);return{...e,resource:{...e.resource,text:t}}}catch{return e}return e}if(Array.isArray(e))return De(e);if("string"==typeof e)try{return JSON.parse(e)}catch{return e}return e})):e;if("string"==typeof e)try{return JSON.parse(e)}catch{return e}return e}function Be(e){const{serverName:t,toolName:r,input:o,output:i,state:s,error:l,isExpandable:d=!0,onApprove:c,onReject:u,onToggle:g}=e,[p,h]=(0,a.useState)(!1),[m,f]=(0,a.useState)("input"),[y,S]=(0,a.useState)(!1),x=(0,P().tz)(),b=(0,C().DP)(),I=(0,C().IS)((e=>({container:{borderRadius:10,overflow:"hidden",boxShadow:`0 0 0 1px ${e.border.secondary}, 0px 1px 2px rgba(0, 0, 0, 0.04)`,transition:"box-shadow 0.15s ease-in-out"},header:{display:"flex",alignItems:"center",padding:12,cursor:d?"pointer":"default",backgroundColor:e.background.primary,gap:8,userSelect:"none"},headerContent:{display:"flex",alignItems:"center",flex:1,gap:8},headerText:{flex:1,fontWeight:500,color:e.text.primary},statusIndicator:{display:"flex",alignItems:"center",marginInlineStart:"auto"},content:{borderTop:`1px solid ${e.border.secondary}`,backgroundColor:e.background.primary},tabs:{display:"flex",gap:4,padding:4,backgroundColor:e.background.secondary,borderRadius:20,marginTop:12,marginBottom:12,marginInlineStart:12,marginInlineEnd:12},tab:{flex:1,padding:"6px 16px",cursor:"pointer",transition:"all 0.15s ease",color:e.text.tertiary,fontSize:13,fontWeight:500,backgroundColor:"transparent",border:"none",borderRadius:16,outline:"none","&:hover":{backgroundColor:e.background.tertiary},"&:focus-visible":{outline:`2px solid ${e.blue.text.accentPrimary}`,outlineOffset:"1px"}},activeTab:{backgroundColor:e.background.primary,color:e.text.primary,boxShadow:e.shadow.base.sm},tabContent:{padding:"12px 16px",maxHeight:400,overflowY:"auto",overflowX:"hidden"},loadingState:{display:"flex",alignItems:"center",justifyContent:"center",padding:40,color:e.text.tertiary},errorState:{padding:16,backgroundColor:e.red.background.secondaryTranslucent,borderInlineStart:`3px solid ${e.red.text.accentPrimary}`},errorText:{color:e.red.text.accentPrimary,fontSize:14},approvalButtons:{display:"flex",gap:8,padding:12,borderTop:`1px solid ${e.border.secondary}`,backgroundColor:e.background.primary},approveButton:{backgroundColor:e.blue.background.secondaryTranslucent,color:e.blue.text.accentPrimary,padding:"6px 12px",borderRadius:4,fontSize:14,fontWeight:500},rejectButton:{backgroundColor:e.background.secondary,color:e.text.primary,padding:"6px 12px",borderRadius:4,fontSize:14,fontWeight:500},chevronIcon:{transition:"transform 0.2s ease"},chevronExpanded:{transform:"rotate(90deg)"},showAllButton:{marginTop:8,padding:"4px 8px",fontSize:13,color:e.blue.text.accentPrimary,backgroundColor:e.blue.background.secondaryTranslucent,borderRadius:4,border:"none",cursor:"pointer","&:hover":{backgroundColor:e.blue.background.tertiaryTranslucent}}})),[d]),w=(0,a.useMemo)((()=>`${t.includes("MCP")?t:`${t} MCP`} ${"calling"===s?x.formatMessage({id:"mcpTool.calling",defaultMessage:"calling"}):"error"===s?x.formatMessage({id:"mcpTool.failed",defaultMessage:"Failed to call"}):"waiting_approval"===s?x.formatMessage({id:"mcpTool.waitingApproval",defaultMessage:"Waiting for approval:"}):x.formatMessage({id:"mcpTool.called",defaultMessage:"called"})} ${r}`),[t,r,s,x]),M=(0,a.useCallback)((()=>{if(d){const e=!p;h(e),null==g||g(e)}}),[p,d,g]),A=(0,a.useCallback)((e=>{f(e)}),[]),k=(0,a.useMemo)((()=>{switch(s){case"calling":default:return null;case"error":return{icon:n(765974).exclamationMarkTriangleFillIcon};case"called":return{icon:n(29037).checkmarkIcon};case"waiting_approval":return{icon:n(274570).clockIcon}}}),[s]);return(0,v.jsxs)("div",{style:I.container,children:[(0,v.jsxs)("div",{style:I.header,onClick:M,role:"button",tabIndex:d?0:void 0,"aria-expanded":p,onKeyDown:e=>{!d||"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),M())},children:[(0,v.jsxs)("div",{style:I.headerContent,children:[d?(0,F().arrowChevronSingleRightIcon)({width:16,height:16,...I.chevronIcon,...p?I.chevronExpanded:{}}):void 0,(0,v.jsx)(R().D,{style:I.headerText,children:w})]}),(0,v.jsxs)("div",{style:I.statusIndicator,children:["calling"===s?(0,v.jsx)(Pe().k,{size:"default"}):void 0,k?k.icon({width:16,height:16,fill:"error"===s?b.red.text.accentPrimary:"called"===s?b.green.text.accentPrimary:b.yellow.text.accentPrimary}):void 0]})]}),p?(0,v.jsxs)("div",{style:I.content,children:["waiting_approval"===s&&c&&u?(0,v.jsxs)("div",{style:I.approvalButtons,children:[(0,v.jsx)(L().p,{onClick:c,style:I.approveButton,children:(0,v.jsx)(P().sA,{id:"mcpTool.approve",defaultMessage:"Approve"})}),(0,v.jsx)(L().p,{onClick:u,style:I.rejectButton,children:(0,v.jsx)(P().sA,{id:"mcpTool.reject",defaultMessage:"Reject"})})]}):void 0,(0,v.jsxs)("div",{style:I.tabs,role:"tablist",children:[(0,v.jsx)("button",{role:"tab","aria-selected":"input"===m,"aria-controls":"mcp-tab-input",style:{...I.tab,..."input"===m?I.activeTab:{}},onClick:()=>A("input"),children:(0,v.jsx)(P().sA,{id:"mcpTool.inputTab",defaultMessage:"Input"})}),(0,v.jsx)("button",{role:"tab","aria-selected":"response"===m,"aria-controls":"mcp-tab-response",style:{...I.tab,..."response"===m?I.activeTab:{}},onClick:()=>A("response"),children:(0,v.jsx)(P().sA,{id:"mcpTool.responseTab",defaultMessage:"Response"})})]}),(0,v.jsxs)("div",{style:I.tabContent,children:["input"===m?(0,v.jsx)("div",{id:"mcp-tab-input",role:"tabpanel","aria-labelledby":"mcp-input-tab",children:Ee(o,b)}):void 0,"response"===m?(0,v.jsx)("div",{id:"mcp-tab-response",role:"tabpanel","aria-labelledby":"mcp-response-tab",children:"error"===s&&l?(0,v.jsx)("div",{style:I.errorState,children:(0,v.jsx)(R().D,{style:I.errorText,children:l})}):void 0!==i?(()=>{const e=De(i),t=Array.isArray(e)?e.length>100:!(!e||"object"!=typeof e)&&Object.keys(e).length>100;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(_e().Z,{data:e,shouldExpandNode:(e,t,n)=>n<3,collectionLimit:y||!t?void 0:100}),t&&!y?(0,v.jsx)("button",{style:I.showAllButton,onClick:()=>S(!0),children:(0,v.jsx)(P().sA,{id:"mcpTool.showAllData",defaultMessage:"Show all data"})}):t&&y?(0,v.jsx)("button",{style:I.showAllButton,onClick:()=>S(!1),children:(0,v.jsx)(P().sA,{id:"mcpTool.showLessData",defaultMessage:"Show less"})}):null]})})():"calling"===s?(0,v.jsxs)("div",{style:I.loadingState,children:[(0,v.jsx)(Pe().k,{size:"default"}),(0,v.jsx)(R().D,{styleKey:"Caption/Regular",colorVariant:"tertiary",style:{marginInlineStart:8},children:(0,v.jsx)(P().sA,{id:"mcpTool.waitingForResponse",defaultMessage:"Waiting for response..."})})]}):(0,v.jsx)("div",{style:I.loadingState,children:(0,v.jsx)(R().D,{styleKey:"Caption/Regular",colorVariant:"tertiary",children:(0,v.jsx)(P().sA,{id:"mcpTool.noResponse",defaultMessage:"No response available"})})})}):void 0]})]}):void 0]})}const ze=a.memo((function(e){const{mcpToolUsePartData:t,runningInference:n,aiChatFeatureController:o,turnSteps:i,onExpandedChange:s}=e,l=(0,r().v3)(),{confirmToolUse:d}=S(),{serverName:c,mcpToolName:u,toolUse:g,toolResultStep:p}=t,h=(0,a.useMemo)((()=>{if(!g)return{callingStep:void 0,calledStep:void 0,errorStep:void 0,isCalling:!1};const e=i.find((e=>"workflow-effect-calling"===e.type)),t=i.find((e=>"workflow-effect-called"===e.type)),n=i.find((e=>"workflow-effect-error"===e.type));return{callingStep:e,calledStep:t,errorStep:n,isCalling:Boolean(e&&!t&&!n)}}),[g,i]),m=(0,a.useCallback)((e=>{le().trackToggleToolCard({environment:l,stepId:t.step.id,showResults:e,from:"mcp_tool_card",toolCardType:"mcpServer.runTool"}),null==s||s(e)}),[l,t.step.id,s]),f=n&&(!p||!(0,I().nP)(p)),y=p&&(0,I().I6)(p);if(!g||p&&(0,de().eb)(p))return(0,v.jsx)(Re,{toolName:"mcpServer.runTool",variant:"agent_mobile"===o.aiChatType?"large":"default"});const{callingStep:x,calledStep:b,errorStep:C,isCalling:w}=h,M=(null==x?void 0:x.toolName)||(null==b?void 0:b.toolName)||(null==C?void 0:C.toolName)||u;let A,k;if(null!=p&&p.result){const e=p.result;if("object"==typeof e&&null!==e&&"content"in e){k=Object.fromEntries(Object.entries(e)).content}else k=e}let j=null==p?void 0:p.error;if(C)A="error",j=j||C.error;else if(b){if(A="called",b.output){const e=b.output;if("object"==typeof e&&null!==e&&"content"in e){k=Object.fromEntries(Object.entries(e)).content}else k=e}}else A=w||f&&(null==p||!p.result)?"calling":y?"waiting_approval":null!=p&&p.error?"error":"called";return(0,v.jsx)(Be,{serverName:c,toolName:M,input:(null==x?void 0:x.input)||(null==p?void 0:p.input),output:k,state:A,error:j,isExpandable:!0,onToggle:m,onApprove:y&&p?()=>{d([p.id])}:void 0,onReject:y&&p?()=>{}:void 0})}));var Le=()=>n(205557),Fe=()=>n(100622),Ue=()=>n(895432);n(908872);function Ve(e){if(!e)return"";const t={};let n=0;const a=e.replace(/\[([^\]]*)\]\(([^)]*)\)/g,(e=>{const a=`__LINK_PLACEHOLDER_${n++}__`;return t[a]=e,a})),r=(0,g().h6)(a).replace(/\[\^([^\]]*)\]/g,(e=>{const a=`__CITATION_PLACEHOLDER_${n++}__`;return t[a]=e,a})).replace(/{{(\^?)([^{}]+)}}/g,((e,t,n)=>`[^${n}]`));return Object.entries(t).reduce(((e,[t,n])=>e.replace(t,n)),r)}const Oe=(0,P().YK)({thinking:{id:"aiInferenceTranscript.thinkingStepTitle.pending",defaultMessage:"Thinking..."}});var We=()=>n(726637),Ne=()=>n(718827);const Ke=(0,V().xh)("arrowChevronSingleRight",{default:{loader:()=>Promise.resolve().then(n.bind(n,222334))},small:{loader:()=>Promise.resolve().then(n.bind(n,906380))},fill:{loader:()=>Promise.resolve().then(n.bind(n,944924))},fillSmall:{loader:()=>Promise.resolve().then(n.bind(n,158115))}},["chevron","right","arrow","direction","forward"]);var He=()=>n(460292);function $e({icon:e,title:t,content:n,isExpandable:r,isExpandedOverride:o,onExpandedChange:s,onNonExpandableClick:l,toolRunning:d,variant:c="default",hideOrigin:u}){const[g,p]=(0,a.useState)(o??!1),[h,m]=(0,a.useState)(!1),f=h?"primary":"secondary",y=(0,a.useMemo)((()=>d?(0,v.jsx)(Q().J,{style:{opacity:.3}}):e),[d,e]),S=(0,a.useCallback)((()=>{p((e=>{const t=!e;return null==s||s(t),t}))}),[s]);(0,a.useEffect)((()=>{void 0!==o&&(p(o),null==s||s(o))}),[o,s]);const x=(0,C().IS)((e=>({expandedIndicator:{flexShrink:0,transition:"transform 0.15s ease-in-out",transform:g?"rotate(90deg)":"rotate(0deg)",fill:e.icon.tertiary},button:{width:"fit-content",maxWidth:"100%",borderRadius:6,overflow:"hidden"},buttonHovered:{background:"transparent"},buttonPressed:{background:"transparent"},titleText:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,minWidth:0}})),[g]),b=We().A.isMobile?{onTouchEnd:()=>m(!1),onTouchStart:()=>m(!0)}:{onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1)};return(0,v.jsx)(ne,{isExpanded:!!r&&g,shouldSkipContentPadding:u,origin:u?void 0:r||l?(0,v.jsx)(Ne().Ay,{onClick:r?S:l,style:x.button,hoveredStyle:x.buttonHovered,pressedStyle:x.buttonPressed,...b,children:(0,v.jsx)(ue().N,{icon:y,colorVariant:f,variant:c,title:r?(0,v.jsxs)(i().Y1,{direction:"horizontal",align:"center",gap:4,children:[(0,v.jsx)(R().D,{styleKey:"Body/Regular",style:x.titleText,children:t}),(0,v.jsx)(He().Q,{iconGroup:Ke,colorVariant:h?"primary":"secondary",variantName:"large"===c?"default":"small",style:x.expandedIndicator})]}):t})}):(0,v.jsx)("div",{style:x.button,children:(0,v.jsx)(ue().N,{icon:y,colorVariant:f,title:t})}),content:n})}function Ye(e){const{thinkingPartData:t,aiChatFeatureController:n,runningInference:r,onExpandedChange:o}=e,i=(0,P().tz)(),s=(0,C().eP)(),l=(0,Fe().O4)({theme:s}),{content:d,isLastThinkingPart:c}=t,u=c&&r,[g,p]=(0,a.useState)(!1),[h,m]=(0,a.useState)(!1),[f,y]=(0,a.useState)(!1),S=(0,a.useRef)(null),x=(0,a.useCallback)((e=>{y(e),null==o||o(e)}),[o]),b=(0,a.useMemo)((()=>function(e,t){const n=t.formatMessage(Oe.thinking);if(!e||0===e.length)return{title:n,isExpandedOverride:void 0};if(!e.slice(0,20).includes("**"))return{title:n,isExpandedOverride:!0};const a=/(?:^|\n)\s*\*\*([^*\n][^\n]*?)\*\*\s*(?:\n|$)/g;let r,o=null;for(;null!==(r=a.exec(e));)o=r[1].trim();return o?{title:o,isExpandedOverride:void 0}:{title:n,isExpandedOverride:void 0}}(d,i)),[d,i]),I=(0,a.useCallback)((()=>{const e=S.current;if(!e)return;const{scrollTop:t,scrollHeight:n,clientHeight:a}=e,r=n>a,o=n-t-a<=0;p(r&&!(t<=0)),m(r&&!o)}),[]),w="popup"===n.agentChatFormFactor,M=(0,C().IS)((e=>{const t=w&&"dark"===e.mode?"rgba(32,32,32, 1)":"rgba(25,25,25, 1)";return{container:{position:"relative",maxHeight:175,paddingInlineStart:32},scrollContainer:{overflowY:"auto",maxHeight:"inherit"},topGradient:{display:g?"block":"none",position:"absolute",top:0,insetInlineStart:0,insetInlineEnd:0,height:24,background:"dark"===e.mode?`linear-gradient(to bottom, ${t}, transparent)`:"linear-gradient(to bottom, rgba(255,255,255, 1), transparent)",pointerEvents:"none",zIndex:1},bottomGradient:{display:h?"block":"none",position:"absolute",bottom:0,insetInlineStart:0,insetInlineEnd:0,height:24,background:"dark"===e.mode?`linear-gradient(to top, ${t}, transparent)`:"linear-gradient(to top, rgba(255,255,255, 1), transparent)",pointerEvents:"none",zIndex:1}}}),[g,h,w]);(0,a.useEffect)((()=>{const e=S.current;if(e)return I(),e.addEventListener("scroll",I,{passive:!0}),()=>{e.removeEventListener("scroll",I)}}),[I,f]),(0,a.useEffect)((()=>{const e=S.current;if(!e)return;const t=e.scrollHeight-e.scrollTop-e.clientHeight<=100;requestAnimationFrame((()=>{t&&(e.scrollTop=e.scrollHeight),I()}))}),[d,I,f]);const A=u?(0,v.jsx)(Ue().N,{styleKey:"Body/Regular",colorVariant:"secondary",animate:!0,text:b.title}):(0,v.jsx)(P().sA,{id:"AgentInferenceThinkingPart.thought",defaultMessage:"Thought"});return(0,v.jsx)($e,{isExpandable:void 0!==d,isExpandedOverride:u&&b.isExpandedOverride,icon:u?(0,v.jsx)(Q().J,{strokeColor:l.text.tertiary}):Le().Q,title:A,onExpandedChange:x,content:(0,v.jsxs)("div",{style:M.container,children:[(0,v.jsx)("div",{style:M.topGradient}),(0,v.jsx)("div",{style:M.bottomGradient}),(0,v.jsx)("div",{style:M.scrollContainer,ref:S,children:(0,v.jsx)(R().D,{styleKey:"Body/Regular",colorVariant:"secondary",children:(0,v.jsx)(ie().h,{markdown:Ve(d)})})})]}),variant:"agent_mobile"===n.aiChatType?"large":"default"})}var qe=()=>n(611648),Ge=()=>n(412237),Xe=()=>n(62616),Qe=()=>n(300985),Ze=()=>n(207207),Je=()=>n(523389),et=()=>n(617668),tt=()=>n(863330),nt=()=>n(259476),at=()=>n(637433),rt=()=>n(179034),ot=()=>n(519831),it=()=>n(798880),st=()=>n(939740),lt=()=>n(2143),dt=()=>n(765957),ct=()=>n(970585),ut=()=>n(148832),gt=()=>n(543665),pt=()=>n(870092),ht=()=>n(438632),mt=()=>n(792071),ft=()=>n(476158),vt=()=>n(142748),yt=()=>n(728272),St=()=>n(201980);function xt(e){const{recordMap:t,operations:n}=e,a=new(yt().d),r=t.clone();return n.map((e=>e.pointer)).filter((e=>e.table===rt().ev)).forEach((e=>a.add(e))),(0,ft().applyOperationsToRecordMap)({recordMap:r,operations:n,updateOnly:!1}),function(e){const{pointers:t,originalRecordMap:n,updatedRecordMap:a}=e;return{type:"block",diffs:t.map((e=>function(e){const{pointer:t,originalRecordMap:n,updatedRecordMap:a}=e;if(t.table!==rt().ev)return;const r=n.getModel(t),o=a.getModel(t),i=null==r?void 0:r.getProperties(),s=null==o?void 0:o.getProperties(),l=!!r&&(0,vt()._n)(t,mt().b4_.fromRecordMap(n)),d=!!o&&(0,vt()._n)(t,mt().b4_.fromRecordMap(a));if(r&&null!=i&&i.title&&!d)return{titleDiff:St().ITd((0,ht().hl)({before:i.title,after:[],insertionAnnotation:[St().Ifu.Inserted],deletionAnnotation:[St().Ifu.Deleted]}).diffValue),type:"delete",pointer:t,isPage:r.isNavigableBlock()};if(null!=s&&s.title&&!l)return{titleDiff:St().ITd((0,ht().hl)({before:[],after:s.title,insertionAnnotation:[St().Ifu.Inserted],deletionAnnotation:[St().Ifu.Deleted]}).diffValue),pointer:t,type:"create"};if(l&&d&&null!=i&&i.title&&null!=s&&s.title&&!(0,c().n4)(i.title,s.title))return{titleDiff:St().ITd((0,ht().hl)({before:i.title,after:s.title,insertionAnnotation:[St().Ifu.Inserted],deletionAnnotation:[St().Ifu.Deleted]}).diffValue),type:"update",pointer:t}}({pointer:e,originalRecordMap:n,updatedRecordMap:a}))).filter(s().O9)}}({pointers:Array.from(a),originalRecordMap:e.recordMap,updatedRecordMap:r})}var bt=()=>n(158489),Ct=()=>n(584262),It=()=>n(381175);const wt={"create-pages":!0,"delete-pages":!0,"create-database":!0};function Mt({toolName:e,operation:t}){const n=[],a=wt[e]??!1;if("set"===t.command&&t.path.some((e=>"schema"===e)))n.push({agentAction:"create",propertySchema:t.args,hideBadge:a});else if("update"===t.command){const e=Object.values(t.args).map((e=>function(e){if("object"==typeof e&&null!==e&&"type"in e&&"name"in e)return e}(e))).filter(s().O9);t.path.some((e=>"deleted_schema"===e))?n.push(...e.map((e=>({agentAction:"delete",propertySchema:e,hideBadge:a})))):t.path.some((e=>"schema"===e))&&n.push(...e.map((e=>({agentAction:"update",propertySchema:e,hideBadge:a}))))}return n}var At=()=>n(284371),kt=()=>n(857783),jt=()=>n(187820),Tt=()=>n(16006),Rt=()=>n(877349),Pt=()=>n(921855),_t=()=>n(970236),Et=()=>n(760217),Dt=()=>n(89924);const Bt=20;function zt({menuListItemProps:e,title:t,icon:n,agentAction:a,disabled:r,hideActionBadge:o=!1,onMouseEnter:s,onMouseLeave:l,onClick:d,aiChatFeatureController:c}){const u=(0,C().IS)((e=>({menuItem:{padding:"6px 8px",borderBottom:"none",borderColor:"transparent",marginTop:0,marginBottom:0}})),[]);return(0,v.jsx)("div",{onMouseEnter:s,onMouseLeave:l,style:{width:"100%"},children:(0,v.jsx)(Et().A,{...e,style:u.menuItem,title:(0,v.jsxs)(i().Y1,{direction:"horizontal",gap:8,children:[(0,v.jsx)(R().D,{styleKey:"Body/Regular",colorVariant:"secondary",children:t}),o?null:(0,v.jsx)(Lt,{agentAction:a})]}),left:n,leftStyle:c.agentToolDiffRowIconContainerStyles,disabled:r,onClick:d})})}function Lt({agentAction:e}){const t=(0,C().IS)((()=>({badge:{margin:0}})),[]);switch(e){case"create":return(0,v.jsx)(_t().E,{content:(0,v.jsx)(P().sA,{id:"AgentActionBadge.new",defaultMessage:"New"}),color:"blue",style:t.badge});case"update":return(0,v.jsx)(_t().E,{content:(0,v.jsx)(P().sA,{id:"AgentActionBadge.update",defaultMessage:"Update"}),color:"yellow",style:t.badge});case"delete":return(0,v.jsx)(_t().E,{content:(0,v.jsx)(P().sA,{id:"AgentActionBadge.delete",defaultMessage:"Delete"}),color:"red",style:t.badge});default:return(0,s().HB)(e)}}function Ft(e){return(0,v.jsx)(Dt().A,{style:{padding:"4px"},...e})}function Ut({theme:e,toolType:t,recordDiffInfos:n,spaceStore:a,intl:r,environment:o,toolResultStep:i,aiChatFeatureController:l}){var d;const c=new Map;if(i&&(0,ge().gY)(i,"create-pages")&&null!==(d=i.result)&&void 0!==d&&d.pages)for(const s of i.result.pages)c.set(s.pointer.id,s);const u=n.map(((n,i)=>function({recordDiffInfo:e,index:t,spaceStore:n,intl:a,environment:r,hideActionBadge:o=!1,serverPage:i,theme:s,aiChatFeatureController:l}){const{recordPointer:d,agentAction:c}=e,u=ut().B.createChildStore(n,d),g=u.getIcon()??(null!=i&&i.icon?{icon:i.icon,pointer:i.pointer}:void 0),p=u.isEmptyPage(),h=u.getRenderTitle({userTimeZone:a.locale,intl:a})??(null!=i&&i.title?(0,Pt().S5)({environment:r,textValue:{value:i.title,spaceId:n.id},parentStore:n,disableHover:!0,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disableLinks:!1,disabled:!1,emojiType:"raw",theme:s,katex:void 0,formulaValueTypes:[]}):void 0);if(void 0===h)return;const m=(0,v.jsx)("span",{style:At().RC,children:h}),f=e=>{kt().uK({environment:r,store:u,pageVisitSource:Ct().y8.AIChat,openInNew:(0,It().V)(e)})};return{key:`${u.id}-${t}`,action:()=>{},render:e=>(0,v.jsx)(Vt,{menuListItemProps:e,store:u,title:m,agentAction:c,hideActionBadge:o,icon:g,isEmptyPage:p,disabledHover:!u.isDefined(),onClick:f,aiChatFeatureController:l})}}({recordDiffInfo:n,index:i,spaceStore:a,intl:r,environment:o,hideActionBadge:!!t&&(wt[t]??!1),serverPage:c.get(n.recordPointer.id),theme:e,aiChatFeatureController:l}))).filter(s().O9);if(0!==u.length)return{key:"agent-tool-preview-diff-pages",items:u,render:e=>(0,v.jsx)(Ft,{...e})}}function Vt(e){const{menuListItemProps:t,store:n,title:r,agentAction:i,hideActionBadge:s,icon:l,isEmptyPage:d,disabledHover:c,onClick:u,aiChatFeatureController:g}=e,p=(0,o().K8)((()=>(0,jt().Te)(n)),[n]),h=(0,a.useCallback)((e=>(0,v.jsx)(Rt().y,{store:n,events:e})),[n]);return(0,v.jsx)($().A,{noStyle:!0,delayThreshold:0,placement:"left",alignment:"center",originGap:24,disableTooltip:c,renderTooltip:h,render:e=>(0,v.jsx)(zt,{menuListItemProps:t,title:n.isDefined()?(0,v.jsx)(Tt().A,{store:n}):r,icon:(0,v.jsx)(jt().B6,{icon:l,isEmptyPage:d,size:Bt,disabled:!0,iconRecordCategory:p}),agentAction:i,hideActionBadge:s,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onClick:u,aiChatFeatureController:g})})}function Ot(e){const{resultStep:t,threadStore:a,step:i,aiChatFeatureController:l}=e,d=(0,r().v3)(),c=(0,P().tz)(),u=(0,C().DP)(),g=(0,o().O$)(dt().AppStoreSidebarSpaceStore),p=(0,o().K8)((()=>{var e;if(t&&(0,ge().gY)(t,"update-page")&&null!==(e=t.result)&&void 0!==e&&e.threadDiff)return t.result.threadDiff}),[t]),h=(0,o().K8)((()=>{if(p)return p.diffs;if(!(0,n(379439).P)(t)||!t.threadOperations)return[];const e=a.getTranscript();if(!e)return[];const r=e.findIndex((e=>e.id===i.id));if(-1===r)return[];const o=e.slice(0,r);return xt({recordMap:(0,bt().YO)({transcript:o}),operations:t.threadOperations.map((e=>e.operation))}).diffs}),[p,t,i.id,a]);return(0,o().K8)((()=>{if(!g||!h)return;const e=Ut({recordDiffInfos:h.filter((e=>"delete"===e.type&&e.isPage)).map((e=>{if(e.pointer.table!==rt().ev)return;return ut().B.createChildStore(g,e.pointer).isNavigableBlock()?{recordPointer:e.pointer,agentAction:"delete"}:void 0})).filter(s().O9),spaceStore:g,intl:c,environment:d,toolType:null==t?void 0:t.toolType,toolResultStep:t,theme:u,aiChatFeatureController:l}),r=h.map((e=>{const t=ut().B.createChildStore(g,e.pointer),r=(0,n(492414).Ay)({store:t,fullyQualified:!1,pageVisitSource:Ct().y8.LinkInPage,chatThreadId:a.id});return{key:`${i.id}-${n(696706).L3.toKey(e.pointer)}`,action:()=>{},render:t=>(0,v.jsx)(Et().A,{...t,shouldWrapTitle:!0,title:(0,v.jsx)(n(296798).A,{href:r,disabled:"delete"===e.type,children:Pt().S5({environment:d,textValue:{value:e.titleDiff,spaceId:g.id},parentStore:g,disableHover:!0,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disableLinks:!0,disabled:!0,emojiType:"raw",theme:u,katex:void 0,formulaValueTypes:[]})})})}})).filter(s().O9),o=r.length?{key:"block-diffs",items:r,render:e=>(0,v.jsx)(Dt().A,{...e})}:void 0;return e||o?[e,o].filter(s().O9):void 0}),[l,h,d,c,t,g,i.id,u,a.id])}var Wt=()=>n(27579);function Nt({environment:e,url:t}){if(Boolean(t)&&(0,s().O9)(t))return()=>{(0,Wt().L)({environment:e,url:t,targetSelf:!1})}}n(430670),n(814603),n(147566),n(198721);var Kt=()=>n(362750);var Ht=()=>n(450424),$t=()=>n(742852),Yt=()=>n(126912),qt=()=>n(651784),Gt=()=>n(498212),Xt=()=>n(678553),Qt=()=>n(125565);const Zt="calendar-";var Jt=()=>n(577142),en=()=>n(453697);function tn(e){var t;const{coworker:n}=e,a=(0,C().IS)((e=>({container:{position:"sticky",top:0,background:e.background.primary,zIndex:2,boxShadow:`${e.background.primary} 0 4px 4px`}})),[]),r=n.coworkerEmail,o=null===(t=n.profile)||void 0===t?void 0:t.displayName;return r?(0,v.jsx)(i().Y1,{direction:"horizontal",align:"center-left",gap:10,padding:"8px 12px 8px 0",style:a.container,children:(0,v.jsx)(en().A,{type:o?"avatar-name-email":"avatar-name",avatar:{email:r,name:o||r},size:16})}):null}var nn=()=>n(868859),an=()=>n(719147),rn=()=>n(447587);function on(e){const{children:t,maxLines:n}=e,a=(0,C().IS)((e=>({moreButtonWrapper:{color:e.text.tertiary,display:"block",pointerEvents:"auto"}})),[]);return t?(0,v.jsx)(rn().A,{maxLines:n,moreElement:(0,v.jsx)(R().D,{styleKey:"Caption/Regular",children:(0,v.jsxs)(an().A,{disableUnderline:!0,style:a.moreButtonWrapper,hoverColor:"blue",children:["…"," ",(0,v.jsx)("span",{children:(0,v.jsx)(P().sA,{id:"comment.truncated.showMoreLabel",defaultMessage:"more"})})]})}),children:(0,v.jsx)(R().D,{styleKey:"Caption/Regular",colorVariant:"secondary",children:t})}):null}function sn(e){const{calendarEvent:t,showAll:n}=e,r=function(e){return(0,c().My)((null==e?void 0:e.filter((e=>!e.isSelf&&"declined"!==e.responseStatus&&(e.email||e.displayName))))||[],[e=>e.isOrganizer?0:1,e=>"accepted"===e.responseStatus?0:"tentative"===e.responseStatus?1:"needsAction"===e.responseStatus?2:3,e=>e.isOptional?1:0,e=>e.displayName?0:1],["asc","asc","asc","asc"])}(null==t?void 0:t.attendees);return null!=r&&r.length?(0,v.jsx)(on,{maxLines:n?void 0:1,children:r.map(((e,t)=>(0,v.jsxs)(a.Fragment,{children:[t>0?", ":void 0,(0,v.jsx)(ln,{attendee:e})]},t)))}):null}function ln(e){const{attendee:t}=e,n=(0,C().IS)((e=>({link:{color:e.text.secondary,textDecoration:"none"}})),[]),a=t.displayName||t.email;return a?t.email?(0,v.jsx)("a",{style:n.link,href:`mailto:${t.email}`,children:a}):(0,v.jsx)("span",{children:a}):null}var dn=()=>n(906745),cn=()=>n(135428);function un(e){const{calendarEvent:t}=e,n=(0,P().tz)();if(null==t||!t.period)return null;const a=function(e){const{period:t,intl:n}=e,[a,r]="DATE"===t.type?[dn().c9.fromISO(t.start.date),dn().c9.fromISO(t.end.date)]:[dn().c9.fromISO(t.start.dateTime),dn().c9.fromISO(t.end.dateTime)];if(!a.isValid||!r.isValid)return;const o=a.year===r.year,i=a.toISODate()===r.toISODate();let s;s="DATE"===t.type?i?[gn({dateTime:a,intl:n})]:[gn({dateTime:a,intl:n,noYear:o}),gn({dateTime:r,intl:n})]:[pn({dateTime:a,intl:n}),pn({dateTime:r,intl:n,noYear:o,noDate:i})];return s.join(`${cn().iw}${cn().u3}${cn().iw}`).replaceAll(" ",cn().iw)}({period:t.period,intl:n});return a?(0,v.jsx)(R().D,{styleKey:"Caption/Regular",colorVariant:"secondary",children:a}):null}function gn(e){const{dateTime:t,intl:n,noYear:a}=e;return t.toLocaleString({...dn().c9.DATE_MED_WITH_WEEKDAY,...a||dn().c9.now().year===t.year?{year:void 0}:void 0},{locale:n.locale})}function pn(e){const{dateTime:t,intl:n,noYear:a,noDate:r}=e,o=(0,cn().iI)(n.locale),i=0!==t.minute||!o;return t.toLocaleString({...r?dn().c9.TIME_SIMPLE:dn().c9.DATE_MED_WITH_WEEKDAY,...a||dn().c9.now().year===t.year?{year:void 0}:void 0,hour:"numeric",minute:i?"2-digit":void 0,hour12:o},{locale:n.locale})}function hn(e){var t,n,a,r,o;const{calendarEvent:s,detailed:l}=e,d=(0,C().DP)(),c=(0,nn().Mr)({titleStartY:0,titleEndY:0,eventIndex:0,event:{isAllDay:!1,eventType:s.eventType,responseStatus:s.responseStatus,hasParticipants:Boolean(null===(t=s.attendees)||void 0===t?void 0:t.length),color:void 0},calendarColor:{type:"custom",colorHexes:{light:{backgroundPrimary:(null===(n=s.colors)||void 0===n?void 0:n.background)||(null===(a=s.colors)||void 0===a?void 0:a.foreground)||d.text.uiRedSecondary},dark:{backgroundPrimary:(null===(r=s.colors)||void 0===r?void 0:r.background)||(null===(o=s.colors)||void 0===o?void 0:o.foreground)||d.text.uiRedSecondary}}}});return(0,v.jsxs)(i().Y1,{direction:"horizontal",align:"center-left",gap:10,padding:"8px 12px",borderRadius:10,children:[(0,v.jsx)(i().Y1,{style:c,height:"fill",width:"hug"}),(0,v.jsxs)(i().Y1,{width:"fill",direction:"vertical",gap:4,padding:"4px 0px",children:[s.summary?(0,v.jsx)(R().D,{styleKey:"Body/Medium",children:s.summary}):void 0,(0,v.jsx)(un,{calendarEvent:s}),(0,v.jsx)(sn,{calendarEvent:s,showAll:l}),(0,v.jsx)(on,{maxLines:l?void 0:1,children:s.location}),(0,v.jsx)(on,{maxLines:2,children:s.description})]})]})}function mn(e,t){return"DATE"===e.type?e[t].date:e[t].dateTime}function fn(e){var t;const{resultStep:n,environment:a}=e,r=function(e){const{toolName:t,...n}=e;try{switch(t){case"listEvents":return function(e){const{environment:t,result:n}=e;if(!n)return;if(null==n||!n.events||!Array.isArray(n.events))return;return yn({environment:t,calendarEvents:n.events,detailed:!1})}(n);case"createEvents":return function(e){const{environment:t,input:n,result:a}=e;if(Array.isArray(null==a?void 0:a.createdEvents))return yn({environment:t,calendarEvents:a.createdEvents,detailed:!1});if(Array.isArray(null==n?void 0:n.events))return yn({environment:t,calendarEvents:n.events,detailed:!0})}(n);case"updateEvents":return function(e){const{environment:t,result:n}=e;if(!n)return;if(null==n||!n.updatedEvents||!Array.isArray(n.updatedEvents))return;return yn({environment:t,calendarEvents:n.updatedEvents,detailed:!1})}(n);case"listCoworkersEvents":return function(e){const{environment:t,result:n}=e;if(!n)return;if(null==n||!n.coworkers||!Array.isArray(n.coworkers))return;const a=[];for(const{events:r,coworker:o}of n.coworkers){const e=vn({coworker:o,environment:t});e&&a.push(e,...yn({environment:t,calendarEvents:r,detailed:!1})||[])}return a}(n)}}catch{}}({environment:a,toolName:(o=n.toolName,o.substring(Zt.length)),input:n.input,result:null===(t=n.result)||void 0===t?void 0:t.structuredContent});var o;if(null!=r&&r.length)return[{key:n.id,render:e=>(0,v.jsx)(Dt().A,{...e}),items:r}]}function vn(e){const{coworker:t}=e;if(null!=t&&t.coworkerEmail)return{key:`coworker-${t.coworkerEmail}`,action(){},render:e=>(0,v.jsx)(tn,{coworker:t})}}function yn(e){const{calendarEvents:t,environment:n,detailed:a}=e;if(Array.isArray(t)&&t.length)return function(e){return(0,c().My)(e,[({period:e})=>mn(e,"start"),({period:e})=>mn(e,"end")],["asc","desc"])}(t).map((e=>function(e){const{calendarEvent:t,environment:n,detailed:a}=e,{eventId:r,webUrl:o,calendar:i}=t;return{key:`${JSON.stringify(i)}:${r||JSON.stringify(t)}`,action(){o&&(0,Jt().navigate)({environment:n,url:o,openInNew:"tab"})},render:e=>(0,v.jsx)(hn,{calendarEvent:t,detailed:a})}}({environment:n,calendarEvent:e,detailed:a}))).filter((e=>void 0!==e))}var Sn=()=>n(129852);function xn(e){const{from:t,to:n,subject:r,text:o}=e,i=(0,C().IS)((e=>({container:{paddingTop:12,paddingBottom:24,backgroundColor:e.background.primary,width:"100%",overflow:"hidden",gap:12,display:"flex",flexDirection:"column"},fieldRow:{display:"flex",alignItems:"flex-start",padding:"0 16px",gap:6},fieldLabel:{color:e.text.tertiary,width:60,flexShrink:0,fontWeight:400,display:"flex",alignItems:"center",gap:4},recipientDisplayName:{color:e.text.primary,fontWeight:400,flexShrink:0},recipientAddressWithoutName:{color:e.text.primary,fontWeight:400,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},recipientAddressWithName:{color:e.text.secondary,fontWeight:400,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},fieldValueContainer:{display:"flex",flexDirection:"column",alignSelf:"stretch",flex:1,minWidth:0},fieldValue:{display:"flex",gap:4,minWidth:0},subjectValue:{color:e.text.primary,flex:1,fontWeight:400},fieldEmptyValue:{color:e.text.tertiary,flex:1,fontWeight:400},bodyPreview:{padding:"0 16px",fontSize:14,color:e.blue.text.accentPrimary,whiteSpace:"pre-wrap",wordWrap:"break-word",boxSizing:"border-box"},lineHighlight:{display:"inline",backgroundColor:e.blue.background.secondaryTranslucent,padding:"0 4px",boxDecorationBreak:"clone",WebkitBoxDecorationBreak:"clone"},bodySeparator:{borderTop:`1px solid ${e.border.secondary}`},warningIcon:{height:14,width:14,color:e.yellow.icon.accentPrimary}})),[]);return(0,v.jsxs)("div",{style:i.container,children:[null!=t&&t.address?(0,v.jsxs)("div",{style:i.fieldRow,children:[(0,v.jsx)("div",{style:i.fieldLabel,children:"From"}),(0,v.jsxs)("div",{style:i.fieldValue,children:[Boolean(t.name)?(0,v.jsx)("div",{style:i.recipientDisplayName,children:t.name}):void 0,(0,v.jsx)("div",{style:Boolean(t.name)?i.recipientAddressWithName:i.recipientAddressWithoutName,children:t.address})]})]}):void 0,n&&n.length>0?(0,v.jsxs)("div",{style:i.fieldRow,children:[(0,v.jsx)("div",{style:i.fieldLabel,children:"To"}),(0,v.jsx)("div",{style:i.fieldValueContainer,children:n.map(((e,t)=>(0,v.jsx)("div",{style:i.fieldValue,children:(0,v.jsxs)("div",{style:i.fieldValue,children:[Boolean(e.name)?(0,v.jsx)("div",{style:i.recipientDisplayName,children:e.name}):void 0,(0,v.jsx)("div",{style:Boolean(e.name)?i.recipientAddressWithName:i.recipientAddressWithoutName,children:e.address})]})},`${e.address}-${t}`)))})]}):(0,v.jsxs)("div",{style:i.fieldRow,children:[(0,v.jsxs)("div",{style:i.fieldLabel,children:["To",(0,Sn().exclamationMarkCircleIcon)(i.warningIcon)]}),(0,v.jsx)("div",{style:i.fieldEmptyValue,children:"Missing recipient"})]}),(0,v.jsxs)("div",{style:i.fieldRow,children:[(0,v.jsx)("div",{style:i.fieldLabel,children:"Subject"}),Boolean(r)?(0,v.jsx)("div",{style:i.subjectValue,children:r}):(0,v.jsx)("div",{style:i.fieldEmptyValue,children:"(No subject)"})]}),Boolean(o)?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{style:i.bodySeparator}),(0,v.jsx)("div",{style:i.bodyPreview,children:(o||"").split("\n").map(((e,t,n)=>(0,v.jsxs)(a.Fragment,{children:[e.trim().length>0?(0,v.jsx)("span",{style:i.lineHighlight,children:e}):void 0,t<n.length-1?"\n":void 0]},`${e.slice(0,10)}-${t}`)))})]}):void 0]})}var bn=()=>n(714732);const Cn=(0,P().YK)({statusSuccess:{id:"agentInference.status.success",defaultMessage:"Successfully finished task"},statusFailed:{id:"agentInference.status.failed",defaultMessage:"Failed to finish task"}});function In(e){const t="<lang ",n=/<lang[^>]*\/?>/i,a=(r=e,r.replace(/\{\{([^{}]+)\}\}/g,((e,t)=>{const n=t.match(/^\[prefix=([^\]]+)\](.+)$/);return n?n[2]:t}))).split(/\n\n\n+/);var r;const o=[];let i="";for(let s=0;s<a.length;s++){const e=i+a[s].trim();if(i="",e.startsWith(t)||t.startsWith(e)){if(e.match(n)){const t=e.replace(n,"").trim();t&&o.push(t)}else i=e}else e&&o.push(e)}return{processedParts:o,buffer:i}}function wn(e){const{step:t,toolResultsForStep:n,threadStore:a,runningInference:r}=e,o=[...(t.previousAttemptValues??[]).flatMap(Kt().lH).filter((e=>"tool_use"!==e.type)),...(0,Kt().lH)(t.value)],i=[],l=function(e){const{threadStore:t}=e,n=t.getMessageStores().map((e=>e.getStep())).filter(s().O9),a=(0,bn().P)({transcript:n}),r=function(e){const{transcript:t}=e,n={};return t.map((e=>{"agent-tool-result"===(null==e?void 0:e.type)&&e.result&&"object"==typeof e.result&&"citationContext"in e.result&&Object.assign(n,e.result.citationContext)})),n}({transcript:n}),o={...a,...r};return o}({threadStore:a}),d=function({chunks:e,toolResultsForStep:t}){const n=[];for(let a=0;a<e.length;a++){const r=e[a];if("thinking"===r.type){r.content.trim()&&n.push({type:"thinking",content:r.content.trim(),isLastThinkingPart:a===e.length-1,startedAt:r.startedAt,finishedAt:r.finishedAt})}else if("text"===r.type){r.content.trim()&&n.push({type:"text",content:r.content.trim()})}else if("tool_use"===r.type){const e=t.find((e=>e.toolCallId===r.id));n.push({type:"tool_use",toolUse:r,toolResultStep:e,id:r.id})}}return n}({chunks:o,toolResultsForStep:n});for(const[s,c]of d.entries())if("thinking"===c.type){const{isLastThinkingPart:e,content:n,startedAt:a,finishedAt:r}=c,o={type:"thinking",key:`thinking-${s}`,content:n,isLastThinkingPart:e,step:t,isFinished:!e,durationMs:!e&&r&&a?r-a:void 0};i.push(o)}else if("text"===c.type){const{content:e}=c,{processedParts:n}=In(e);n.forEach(((e,n)=>{const a={type:"chat",key:`text-${s}-${n}`,markdown:e,citationContext:l,step:t,isFinished:!0};i.push(a)}))}else if("tool_use"===c.type){const e=Mn({toolUse:c.toolUse,step:t,toolResultStep:c.toolResultStep,runningInference:r});e&&i.push(e)}return i}function Mn(e){var t;const{runningInference:n,step:a,toolResultStep:r,toolUse:o}=e;if(!n&&r&&!(0,I().nP)(r)&&!(0,I().I6)(r))return;if(!((0,pe().U3)(o.name)||r&&(0,pe().og)(r.toolType)))return;const i=(0,pe().U3)(o.name)?o.name:r&&(0,pe().og)(r.toolType)?r.toolType:o.name,s=Boolean(r&&(0,I().nP)(r));if("search"===i)return{type:"search-tool-use",key:`search-tool-${o.id}`,toolName:i,toolUse:o,toolResultStep:r,step:a,isFinished:s};if("mcpServer.runTool"===i&&"mcpServer"===(null==r||null===(t=r.moduleInfo)||void 0===t?void 0:t.type)){if("mail.runTool"===r.toolType)return{type:"tool-use",key:`tool-use-${o.id}`,toolName:"mail.runTool",toolUse:o,toolResultStep:r,step:a,isFinished:s};if("calendar.runTool"===r.toolType)return{type:"tool-use",key:`tool-use-${o.id}`,toolName:"calendar.runTool",toolUse:o,toolResultStep:r,step:a,isFinished:s};const e=r.moduleInfo.name||"MCP Server",t=r.toolTitle||"tool";return{type:"mcp-tool-use",key:`mcp-tool-${o.id}`,toolName:"mcpServer.runTool",serverName:e,mcpToolName:t,toolUse:o,toolResultStep:r,step:a,isFinished:s}}return{type:"tool-use",key:`tool-use-${o.id}`,toolName:i,toolUse:o,toolResultStep:r,step:a,isFinished:s}}function An(e){var t;const{environment:a,spaceStore:r,toolResultStep:o}=e;if(o)switch(o.toolType){case"query-data-sources":if(!(0,ge().gY)(o,"query-data-sources"))return;const e=null===(t=o.result)||void 0===t||null===(t=t.results)||void 0===t?void 0:t.map((e=>function(e){if("object"!=typeof e||!e)return;if("id"in e&&"string"==typeof e.id&&(0,Gt().uj)(e.id))return e.id;if("url"in e&&"string"==typeof e.url){const t=(0,qt().bn)(e.url);return(0,Gt().uj)(t)?t:(0,Gt().parseUUIDWithoutDashes)(t)}}(e))).map(((e,t)=>e?(0,n(124972).L)({index:t,environment:a,spaceStore:r,blockId:e}):void 0)).filter(s().O9);if(null==e||!e.length)return;return[{key:`${o.id}-results`,render:e=>(0,v.jsx)(Dt().A,{...e}),items:e}];case"result":if(!(0,ge().gY)(o,"result"))return;return function({result:e}){if(!e.result)return[];const{success:t,message:n}=e.result,a=[];return a.push({key:"result-status",render:a=>(0,v.jsx)(Xt().Ay,{...a,title:(0,v.jsx)(Qt().A,{isSecondaryColor:!0,style:{height:24,display:"flex",alignItems:"center"},children:(0,v.jsx)(P().sA,{...t?Cn.statusSuccess:Cn.statusFailed})}),caption:(0,v.jsx)(Qt().A,{isSecondaryColor:!0,style:{fontSize:14},children:(0,v.jsx)(ie().h,{markdown:n||""})}),shouldWrapCaption:kn(e.toolType),icon:(0,v.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24},children:t?(0,v.jsx)(D().I,{icon:Ht().checkmarkCircleFillSmallIcon,size:"sm",colorPalette:"green",colorVariant:"accentPrimary"}):(0,v.jsx)(D().I,{icon:Yt().xMarkCircleFillSmallIcon,size:"sm",colorPalette:"red",colorVariant:"accentPrimary"})}),desktopIconStyle:{marginTop:0,minWidth:void 0,minHeight:void 0},style:{padding:0},captionStyle:{marginTop:8}}),action:()=>{}}),[{key:"result",render:e=>(0,v.jsx)(Dt().A,{...e,disableDesktopPadding:!0}),items:a}]}({result:o});case"search":case"view":case"view-version-history":case"view-database-files":case"create-database":case"update-database":case"update-database-data-sources":case"update-database-views":case"update-database-triggers":case"error":case"create-pages":case"update-page":case"delete-pages":case"create-agent":case"update-agent":case"delete-agent":case"toggle-user-integration-tools":case"update-user-integrations":case"edit-json":case"spawn-agent":case"query-salesforce-tool":case"mcpServer.getPrompt":case"mcpServer.listPrompts":case"mcpServer.listResources":case"mcpServer.readResource":case"mcpServer.runTool":case"slack.addReactionToMessage":case"slack.createThreadInChannel":case"slack.createThreadInDirectMessage":case"slack.findUserByEmail":case"slack.getThreadsInChannelSince":case"slack.getUser":case"slack.parseSlackMessageUrlToId":case"slack.queryChannels":case"slack.removeReactionFromMessage":case"slack.replyInThread":case"slack.updateMessage":case"pipedream.action":case"github.getPullRequest":case"github.getUser":case"github.listOrganizationRepositories":case"github.listPullRequests":case"github.parseGithubUrlToParts":case"notion.addCommentToDiscussion":case"notion.addCommentToPage":case"notion.getPageDiscussions":case"notion.sendNotification":case"mail.getPrompt":case"files.getFileContent":case"files.getFileName":case"files.getFileUrl":case"zendesk.addComment":case"zendesk.addTicket":case"zendesk.getComments":case"zendesk.getTicket":case"zendesk.updateTicket":case"calendar.fetchPlaybook":return;case"mail.runTool":if(!(0,ge().gY)(o,"mail.runTool"))return;return function(e){const{toolResultStep:t}=e;if(t&&(0,ge().gY)(t,"mail.runTool")&&t.input&&"mail-compose_email"===t.toolName){const e=t.input,n=null==e?void 0:e.subject,a=null==e?void 0:e.to,r=null==e?void 0:e.from,o=[],i=Array.isArray(r)&&r.length>0?r[0]:r&&"object"==typeof r&&"address"in r?r:void 0,s=Array.isArray(a)&&a.length>0?a:void 0,l=n,d=null==e?void 0:e.text;return o.push({key:`mail-compose-${t.id}`,render:e=>(0,v.jsx)(xn,{from:i,to:s,subject:l,text:d}),action:()=>{}}),[{key:`mail-run-tool-${t.id}`,render:e=>(0,v.jsx)(Dt().A,{...e,disableDesktopPadding:!0}),items:o}]}}({environment:a,spaceStore:r,toolResultStep:o});case"calendar.runTool":if(!(0,ge().gY)(o,"calendar.runTool"))return;return fn({environment:a,resultStep:o});case"codegen.run":if(!(0,ge().gY)(o,"codegen.run"))return;return function(e){const{resultStep:t}=e;if(!t.result)return;const n=t.result,a=n.id,r=n.status,o=n.webUrl,i=n.createdAt,s=[];s.push({key:`codegen-run-status-${a}`,render:e=>(0,v.jsx)(Xt().Ay,{...e,title:`Status: ${r}`,caption:`Run ID: ${a} • Created: ${i}`,icon:(0,Qe().Z)({width:20,height:20})}),action:()=>{}}),o&&s.push({key:`codegen-run-url-${a}`,render:e=>(0,v.jsx)(Et().A,{...e,title:"View Codegen Run",caption:o.toString(),href:o.toString(),icon:(0,$t().linkIcon)({width:20,height:20}),external:!0}),action:()=>{}});return[{key:`codegen-run-${a}`,render:e=>(0,v.jsx)(Dt().A,{...e}),items:s}]}({environment:a,spaceStore:r,resultStep:o});case"codegen.runStatus":if(!(0,ge().gY)(o,"codegen.runStatus"))return;return function(e){const{resultStep:t}=e;if(!t.result)return;const n=t.result,a=n.id,r=n.status,o=n.webUrl,i=n.createdAt,s=[];s.push({key:`codegen-run-status-${a}`,render:e=>(0,v.jsx)(Xt().Ay,{...e,title:`Status: ${r}`,caption:`Run ID: ${a} • Created: ${i}`,icon:(0,Qe().Z)({width:20,height:20})}),action:()=>{}}),o&&s.push({key:`codegen-run-status-url-${a}`,render:e=>(0,v.jsx)(Et().A,{...e,title:"View Codegen Run",caption:o.toString(),href:o.toString(),icon:(0,$t().linkIcon)({width:20,height:20}),external:!0}),action:()=>{}});return[{key:`codegen-run-status-${a}`,render:e=>(0,v.jsx)(Dt().A,{...e}),items:s}]}({environment:a,spaceStore:r,resultStep:o});default:(0,s().HB)(o.toolType)}}function kn(e){return"result"===e}var jn=()=>n(96689);function Tn(e){const{toolName:t,toolResultStep:l,aiChatFeatureController:d}=e,c=(0,P().tz)(),u=(0,r().v3)(),g=(0,C().IS)((e=>({container:{borderRadius:10,overflow:"hidden",boxShadow:e.shadow2XS,border:`1px solid ${e.border.secondary}`},content:{padding:"10px 12px"},iconContainer:{display:"flex",alignItems:"center",justifyContent:"center",height:20,width:20},permissionDetail:{marginTop:4}})),[]),p=(0,a.useMemo)((()=>Ce({toolName:t,state:"loading",numResults:0,intl:c,isMultiDatabaseMode:!1,toolResultStep:l})),[t,c,l]),h=(0,o().K8)((()=>function(e,t){const n=null==e?void 0:e.insufficientPermissionsDetails;if(!n)return{action:"write",resourceType:"unknown",resourceStore:void 0};let a,r="unknown";if(n.recordPointer){const{table:e,id:o}=n.recordPointer;try{if(e===rt().ev)r="page",a=new(ut().B)(t,{table:rt().ev,id:o});else if(e===ot().Vl){r="database";const e=new(gt().m)(t,{table:ot().Vl,id:o}),n=e.getParentPointer();a=n&&n.table===rt().ev?new(ut().B)(t,n):e}else e===jn().NX&&(r="workspace")}catch(i){}}return{action:(o=n.requiredAccess,"reader"===o?"read":"write"),resourceType:r,resourceStore:a};var o}(l,u)),[l,u]);return d.supportsRenderingPermissionError?(0,v.jsx)("div",{style:g.container,children:(0,v.jsx)("div",{style:g.content,children:(0,v.jsxs)(i().Y1,{direction:"horizontal",gap:8,align:"top-left",children:[(0,v.jsx)("div",{style:g.iconContainer,children:(0,v.jsx)(D().I,{icon:n(471095).i,size:"default"})}),(0,v.jsxs)(i().Y1,{direction:"vertical",gap:2,width:"fill",children:[(0,v.jsxs)(R().D,{styleKey:"Body/Regular",textOverflow:"ellipsis",children:[p," • ",(0,v.jsx)(P().sA,{id:"AgentToolUsePermissionError.status",defaultMessage:"Permission required"})]}),h?(0,v.jsx)("div",{style:g.permissionDetail,children:(0,v.jsx)(R().D,{styleKey:"Caption/Regular",textOverflow:"ellipsis",children:(()=>{if(!h)return null;const{action:e,resourceType:t,resourceStore:a}=h,r=a?(0,v.jsx)(n(761652).A,{store:a,useInvertedColors:!1,iconSize:14}):t;return"read"===e?(0,v.jsx)(P().sA,{id:"AgentToolUsePermissionError.needsPermissionToRead",defaultMessage:"Needs permission to read {resource}",values:{resource:r}}):"write"===e?(0,v.jsx)(P().sA,{id:"AgentToolUsePermissionError.needsPermissionToWrite",defaultMessage:"Needs permission to write to {resource}",values:{resource:r}}):void(0,s().HB)(e)})()})}):void 0]})]})})}):null}var Rn=()=>n(852424),Pn=()=>n(697650),_n=()=>n(972435);function En({toolType:e,toolResultStep:t,theme:n,aiChatFeatureController:a}){const r=t.threadOperations;let o;var i;((0,ge().gY)(t,"create-database")||(0,ge().gY)(t,"update-database"))&&(o=null===(i=t.result)||void 0===i?void 0:i.propertyDiff);o||(o=function({toolName:e,operations:t}){const n={};for(const a of t){if(a.pointer.table!==ot().Vl)continue;const t=Mt({toolName:e,operation:a});if(0===t.length)continue;const r=a.pointer.id;n[r]||(n[r]=[]),n[r].push(...t)}return n}({toolName:e,operations:(0,bt().tr)(r)}));const l=Object.keys(o);if(0!==l.length){if(1===l.length){const e=l[0];return function({collectionId:e,propertyChangeInfos:t,theme:n,aiChatFeatureController:a}){const r=t.map(((e,t)=>function({propertyChangeInfo:e,index:t,theme:n,aiChatFeatureController:a}){const{agentAction:r,propertySchema:o,hideBadge:i}=e;return{key:`${r}-${o.name}-${t}`,action:()=>{},render:e=>(0,v.jsx)(zt,{menuListItemProps:e,title:o.name,icon:(0,v.jsx)(Rn().zB,{type:o.type,icon:void 0,size:V().Ev.sm,theme:n}),agentAction:r,disabled:!0,hideActionBadge:i,aiChatFeatureController:a})}}({propertyChangeInfo:e,index:t,theme:n,aiChatFeatureController:a}))).filter(s().O9);if(0===r.length)return;return{key:e,items:r,render:e=>(0,v.jsx)(Ft,{...e})}}({collectionId:e,propertyChangeInfos:o[e],theme:n,aiChatFeatureController:a})}return function({collectionIds:e,collectionIdToPropertyChangeInfos:t,theme:n,aiChatFeatureController:a}){const r=dt().default.state.sidebarSpaceStore;if(!r)return;const o=[];for(const i of e){const e=gt().m.createChildStore(r,{table:ot().Vl,id:i,spaceId:r.id}),s=(0,Pn().getCollectionNameOrDefault)({intl:_n().A.getIntl(),collectionStore:e}),l=t[i];0!==l.length&&o.push({key:i,action:()=>{},render:e=>(0,v.jsx)(Dn,{menuListItemProps:e,collectionId:i,collectionName:s,propertyChangeInfos:l,theme:n,aiChatFeatureController:a})})}if(0===o.length)return;return{key:e.join(","),items:o,render:e=>(0,v.jsx)(Ft,{...e})}}({collectionIds:l,collectionIdToPropertyChangeInfos:o,theme:n,aiChatFeatureController:a})}}function Dn({menuListItemProps:e,collectionId:t,collectionName:n,propertyChangeInfos:r,theme:o,aiChatFeatureController:i}){const[s,l]=(0,a.useState)(!0),d=(0,a.useCallback)((()=>{l(!s)}),[s]),c=(0,a.useMemo)((()=>({key:t,items:r.map(((e,n)=>{const{agentAction:a,propertySchema:r,hideBadge:s}=e;return{key:`${t}-${a}-${r.name}-${n}`,action:()=>{},render:e=>(0,v.jsx)(zt,{menuListItemProps:e,title:r.name,icon:(0,v.jsx)(Rn().zB,{type:r.type,icon:void 0,size:V().Ev.sm,theme:o}),agentAction:a,disabled:!0,hideActionBadge:s,aiChatFeatureController:i},`${t}-${a}-${r.name}-${n}`)}})),render:e=>(0,v.jsx)(Ft,{...e})})),[t,r,o,i]),u=(0,C().IS)((()=>({menuList:{marginInlineStart:22},icon:{flexShrink:0,transition:"transform 0.15s ease-in-out",transform:s?"rotate(90deg)":"rotate(0deg)",opacity:.5}})),[s]);return(0,v.jsx)(ne,{isExpanded:s,shouldSkipContentPadding:!0,disableInitialAnimation:!0,origin:(0,v.jsx)(zt,{menuListItemProps:e,title:n,icon:(0,v.jsx)(He().Q,{iconGroup:Ke,colorVariant:"secondary",variantName:"small",style:u.icon}),agentAction:"update",disabled:!1,hideActionBadge:!0,onClick:d,aiChatFeatureController:i}),content:(0,v.jsx)(st().Ay,{type:st().Oh.Vertical,initialFocus:void 0,sections:[c],style:u.menuList,disableKeyboard:!0})})}var Bn=()=>n(908268);const zn=a.memo((function(e){var t,i;const{toolUsePartData:l,threadStore:d,runningInference:c,aiChatFeatureController:u,isLastTurn:g,onExpandedChange:p}=e,{step:h,toolName:m,toolResultStep:f}=l,y=(0,de().I)({runningInference:c,toolResultStep:f,isLastTurn:g}),S=Boolean(f&&(0,I().I6)(f)),x=(0,B().L)(),w=(0,P().tz)(),M=(0,r().v3)(),k=(0,C().DP)(),j=(0,o().K8)((()=>(0,de().yX)([f].filter(s().O9),(null==x?void 0:x.id)??"")),[null==x?void 0:x.id,f]),T=(0,b().X)("agent_multidb_creation"),{subtitle:_}=function(e,t,n){return(0,a.useMemo)((()=>{if("spawn-agent"===e&&t&&(0,ge().gY)(t,"spawn-agent")){const e=null==t?void 0:t.result;if("progress"===(null==e?void 0:e.type)){const t=e.messages.at(-1)||"Processing...",a=e.progress||0,r=e.total||1,o=Math.min(Math.floor(a/r*100),100),i=(0,v.jsx)("div",{style:{width:"100%",height:4,backgroundColor:n.border.secondary,borderRadius:2,overflow:"hidden",marginTop:6,marginBottom:2},children:(0,v.jsx)("div",{style:{width:`${o}%`,height:4,backgroundColor:n.icon.secondary,borderRadius:2,transition:"width 0.3s ease-in-out"}})});return{subtitle:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(R().D,{styleKey:"Caption/Regular",colorVariant:"tertiary",textOverflow:"ellipsis",children:t}),i]}),isInProgress:!0}}if("done"===(null==e?void 0:e.type))return{subtitle:(0,v.jsx)(R().D,{styleKey:"Caption/Regular",colorVariant:"tertiary",textOverflow:"ellipsis",children:e.resultSummary}),isInProgress:!1}}return{subtitle:void 0,isInProgress:!1}}),[e,t,n])}(m,f,k),{titleStore:E,isTitleStoreReady:D}=function(e){const{toolResultStep:t}=e,n=(0,P().tz)(),a=(0,B().L)(),r=(0,o().K8)((()=>{if(!a)return;const e=(0,de().PA)(t,a.id);if(1!==e.length)return;const n=e[0];return n.table===rt().ev?ut().B.createChildStore(a,n):n.table===ot().Vl?gt().m.createChildStore(a,n):n.table===it().oo?pt().L.createChildStore(a,n):n.table===N().C0?Y().N.createChildStore(a,n):void 0}),[a,t]),i=(0,o().K8)((()=>{if(r instanceof pt().L)return r.isReady();if(r instanceof Y().N)return void 0!==r.getDraftData();return void 0!==(null==r?void 0:r.getRenderTitle({userTimeZone:n.locale,intl:n}))}),[r,n]);return{titleStore:r,isTitleStoreReady:i}}({toolName:m,toolResultStep:f}),z=(0,de().WM)(m),L=(0,o().K8)((()=>{var e;return null===(e=dt().default.state.sidebarSpaceViewStore)||void 0===e||null===(e=e.getSettings())||void 0===e||null===(e=e.agent_personalization_settings)||void 0===e?void 0:e.context_page_id}),[]),F=(0,o().K8)((()=>{if(!x||!f||!L)return!1;const e=(0,de().PA)(f,x.id);return 1===e.length&&e[0].table===rt().ev&&e[0].id===L}),[f,L,x]),U=(0,a.useMemo)((()=>{var e;return"spawn-agent"===m&&f&&(0,ge().gY)(f,"spawn-agent")&&"done"===(null===(e=f.result)||void 0===e?void 0:e.type)?n(671089).checkmarkCircleIcon:Fn({toolName:m,agentAction:z,isReferencingContextPage:F})}),[z,m,f,F]),V=(0,o().K8)((()=>{if(x&&f)return"create-database"===m||"update-database"===m?En({toolResultStep:f,theme:k,toolType:m,aiChatFeatureController:u}):Ut({spaceStore:x,intl:w,environment:M,recordDiffInfos:j,toolType:m,toolResultStep:f,theme:k,aiChatFeatureController:u})}),[x,f,m,w,M,j,k,u]),O=Ot({threadStore:d,step:h,resultStep:f,aiChatFeatureController:u}),W=[...(0,o().K8)((()=>{if(x)return An({environment:M,spaceStore:x,toolResultStep:f})}),[M,x,f])??[],...(Un[m]?O??[]:[V]).filter(s().O9)].filter(s().O9),K=W.length>0,H=(0,o().uB)(void 0,ct().A),{hasUndoneOperations:$}=(0,de().ji)({diffResultSteps:[f].filter(s().O9),threadStore:d}),q=f?(0,I().rk)(f):void 0,G=y||S,X=$||"confirmation:rejected"===q?"reverted":G?"loading":"done",Q=Ce({toolName:m,state:X,numResults:j.length,intl:w,isMultiDatabaseMode:T,toolResultStep:f,isReferencingContextPage:F}),Z=(0,a.useMemo)((()=>(0,v.jsx)(Bn().n,{title:Q,subtitle:_,hasUndoneOperations:$,titleSuffixStore:E,isTitleSuffixStoreReady:D,state:q})),[Q,_,$,E,D,q]),J=function({state:e,toolName:t,toolResultStep:n,environment:a}){switch(t){case"slack.createThreadInChannel":var r;if("done"===e)return Nt({url:n&&(0,ge().gY)(n,"slack.createThreadInChannel")?null===(r=n.result)||void 0===r?void 0:r.url:void 0,environment:a});break;case"slack.createThreadInDirectMessage":var o;if("done"===e)return Nt({url:n&&(0,ge().gY)(n,"slack.createThreadInDirectMessage")?null===(o=n.result)||void 0===o?void 0:o.url:void 0,environment:a});break;case"slack.replyInThread":var i;if("done"===e)return Nt({url:n&&(0,ge().gY)(n,"slack.replyInThread")?null===(i=n.result)||void 0===i?void 0:i.url:void 0,environment:a});break;case"slack.updateMessage":var s;if("done"===e)return Nt({url:n&&(0,ge().gY)(n,"slack.updateMessage")?null===(s=n.result)||void 0===s?void 0:s.url:void 0,environment:a})}}({toolName:m,state:X,toolResultStep:f,environment:M}),ee=("create-pages"===m||"delete-pages"===m)&&1===j.length,te=K&&!$&&!ee,ne="result"===m&&"done"===X,ae=(0,a.useCallback)((e=>{try{le().trackToggleToolCard({environment:M,stepId:h.id,showResults:e,from:"tool_card",toolCardType:m})}catch(t){}null==p||p(e)}),[M,m,h.id,p]),re="mail.runTool"===m&&"mail-compose_email"===(null==f?void 0:f.toolName)||"calendar.runTool"===m&&G,oe=(0,C().IS)((e=>({scrollerStyle:{maxHeight:re?void 0:200},minimalToolWrapper:{borderRadius:10,overflow:"hidden",boxShadow:`0 0 0 1px ${e.border.secondary}, 0px 1px 2px rgba(0, 0, 0, 0.04)`,transition:"box-shadow 0.15s ease-in-out",marginInline:u.toolUsePartMarginInline,...ne&&{borderRadius:0,marginInline:0,boxShadow:void 0}}})),[re,u.toolUsePartMarginInline,ne]);return null!=f&&f.insufficientPermissions?u.supportsRenderingPermissionError?(0,v.jsx)(Tn,{toolName:m,toolResultStep:f,aiChatFeatureController:u}):null:f&&(0,de().eb)(f)?(0,v.jsx)(Re,{toolName:m,variant:"agent_mobile"===u.aiChatType?"large":"default"}):!y||S||K||0!==j.length?"toggle-user-integration-tools"===m&&""===Q&&f&&(0,ge().gY)(f,"toggle-user-integration-tools")&&(((null===(t=f.result)||void 0===t||null===(t=t.activeIntegrationPointers)||void 0===t?void 0:t.length)??0)>0||((null===(i=f.result)||void 0===i||null===(i=i.inactiveIntegrationPointers)||void 0===i?void 0:i.length)??0)>0)||"calendar.fetchPlaybook"===m?null:(0,v.jsx)($e,{hideOrigin:ne,isExpandable:te??!1,icon:U,toolRunning:y,isExpandedOverride:"loading"===X||S||Ln(m),onNonExpandableClick:J,onExpandedChange:ae,title:ne?void 0:Z,content:ne?(0,v.jsx)(st().Ay,{type:st().Oh.Vertical,initialFocus:void 0,resetFocusOnMouseOut:!0,sections:W,store:H,disableKeyboard:!0,style:{paddingBlock:0,paddingInline:0,marginBottom:8}}):(0,v.jsx)(lt().H,{type:qe().A.Y,style:{...oe.scrollerStyle,...oe.minimalToolWrapper},children:(0,v.jsx)(st().Ay,{type:st().Oh.Vertical,initialFocus:void 0,resetFocusOnMouseOut:!0,sections:W,store:H,disableKeyboard:!0})}),variant:"agent_mobile"===u.aiChatType?"large":"default"}):(0,v.jsx)("div",{children:(0,v.jsx)(A().c,{message:Q,animationType:"scrolling-squiggle"})})}));function Ln(e){return"result"===e||"create-agent"===e}function Fn({toolName:e,agentAction:t,isReferencingContextPage:a}){if(t)return function(e,t){switch(e){case"create":return tt().plusSmallIcon;case"update":return t?Ge().aiFaceSmallIcon:Je().pencilLineSmallIcon;case"delete":return nt().trashSmallIcon;default:(0,s().HB)(e)}}(t,a);if((0,pe().og)(e))return function(e){const t=xe(e);return be(e).icon??ye().d.getIcon(t)}(e);switch(e){case"search":case"query-data-sources":return Ze().J;case"view":case"view-version-history":return n(670371).eyeSmallIcon;case"view-database-files":return Qe().Z;case"create-database":case"create-pages":return et().plusIcon;case"update-database-data-sources":case"update-database":return Xe().c;case"update-database-views":return n(167170)._;case"update-database-triggers":return n(200582).m;case"error":return at().xMarkCircleFillIcon;case"delete-pages":return n(236262).trashIcon;case"update-page":return n(105819).pencilLineIcon;case"edit-json":throw new Error("edit-json tool should not be used in the UI");case"result":case"toggle-user-integration-tools":case"update-user-integrations":case"spawn-agent":case"create-agent":case"update-agent":case"delete-agent":return n(529099).aiFaceIcon;case"query-salesforce-tool":return n(769145).salesforceIcon;default:(0,s().HB)(e)}}const Un={"update-page":!0,search:!1,view:!1,"view-version-history":!1,"view-database-files":!1,"create-database":!1,"update-database":!1,"update-database-data-sources":!1,"update-database-views":!1,"query-data-sources":!1,"update-database-triggers":!1,error:!1,"create-pages":!1,"delete-pages":!1,result:!1,"update-user-integrations":!1,"edit-json":!1,"spawn-agent":!1,"mcpServer.getPrompt":!1,"mcpServer.listPrompts":!1,"mcpServer.listResources":!1,"mcpServer.readResource":!1,"mcpServer.runTool":!1,"slack.addReactionToMessage":!1,"slack.createThreadInChannel":!1,"slack.createThreadInDirectMessage":!1,"slack.findUserByEmail":!1,"slack.getThreadsInChannelSince":!1,"slack.getUser":!1,"slack.parseSlackMessageUrlToId":!1,"slack.queryChannels":!1,"slack.removeReactionFromMessage":!1,"slack.replyInThread":!1,"slack.updateMessage":!1,"pipedream.action":!1,"toggle-user-integration-tools":!1,"github.getPullRequest":!1,"github.listPullRequests":!1,"github.parseGithubUrlToParts":!1,"github.listOrganizationRepositories":!1,"github.getUser":!1,"notion.addCommentToDiscussion":!1,"notion.addCommentToPage":!1,"notion.getPageDiscussions":!1,"notion.sendNotification":!1,"codegen.run":!1,"codegen.runStatus":!1,"calendar.runTool":!1,"calendar.fetchPlaybook":!1,"mail.runTool":!1,"mail.getPrompt":!1,"files.getFileContent":!1,"files.getFileName":!1,"files.getFileUrl":!1,"zendesk.addComment":!1,"zendesk.addTicket":!1,"zendesk.getComments":!1,"zendesk.getTicket":!1,"zendesk.updateTicket":!1,"create-agent":!1,"update-agent":!1,"delete-agent":!1,"query-salesforce-tool":!1};var Vn=()=>n(344417),On=()=>n(188158),Wn=()=>n(717465),Nn=()=>n(143016),Kn=()=>n(112995),Hn=()=>n(650843),$n=()=>n(813679),Yn=()=>n(980319),qn=()=>n(804773),Gn=()=>n(96563),Xn=()=>n(604018),Qn=()=>n(406699),Zn=()=>n(404277),Jn=()=>n(828634),ea=()=>n(722872),ta=()=>n(773363),na=()=>n(152197),aa=()=>n(329304);function ra({agentSearchResultsBySourceType:e,selectedSourceType:t,onChange:n,aiChatFeatureController:s}){const l=(0,r().v3)(),d=(0,na().r)(),c=(0,P().tz)(),u=(0,a.useId)(),g=(0,b().X)("notion_ai_workspace_settings"),p=(0,o().K8)((()=>(0,Xn().Nr)().length>0),[]),h="agent_mobile"===s.aiChatType,m=g&&p&&!h,f=(0,aa()._X)({name:"ai_connectors",spaceId:d,userId:l.currentUser.id}),y=(0,a.useCallback)((()=>{(0,Gn().pp)({environment:l,connector:"generic",analyticsFrom:"ai_chat_search_results_tab",connectorsFeatureAvailability:f})}),[f,l]),S=(0,a.useRef)(null),[x,C]=(0,a.useState)(0);(0,Jn().tK)(S,(()=>{S.current&&C(S.current.clientWidth)}));const I=(0,a.useRef)(null),[w,M]=(0,a.useState)(0);(0,a.useEffect)((()=>{I.current&&M(I.current.clientWidth)}),[I]);const A=(0,a.useMemo)((()=>Array.from(e.keys())),[e]),k=(0,o().K8)((()=>{const e=new Map;for(const t of A)e.set(t,"top-results"===t?c.formatMessage({id:"AgentSearchSourceTabs.topResults",defaultMessage:"Top results"}):(0,Yn().$b)({searchSourceType:t,environment:l,intl:c}));return e}),[A,l,c]),j=(0,a.useMemo)((()=>new(ta().k)({style:{fontFamily:"system-ui, sans-serif"}})),[]),T=(0,a.useMemo)((()=>function({availableSourceTypes:e,availableWidth:t,selectedSourceType:n,agentSearchResultsBySourceType:a,sourceTypeToLabel:r,widthEstimator:o,moreButtonWidth:i}){const s=[];let l=0;const d=new Map;for(const g of e){var c;const e=r.get(g)??"",t=(null===(c=a.get(g))||void 0===c?void 0:c.length)??0,n=o.measure(e).width+o.measure(`${t}`).width+oa;l+=n,d.set(g,n)}let u=0;l>t&&(u+=i);for(const g of e){const e=d.get(g)??0;if(u+e>t)break;s.push(g),u+=e}if(!s.includes(n)){const e=d.get(n)??0;for(;s.length>0;){const n=s.pop();if(!n)break;if(u-=d.get(n)??0,u+e<=t)break}s.push(n)}return s}({availableSourceTypes:A,availableWidth:x,selectedSourceType:t,agentSearchResultsBySourceType:e,sourceTypeToLabel:k,widthEstimator:j,moreButtonWidth:w})),[A,x,t,e,k,j,w]),R=(0,a.useMemo)((()=>A.filter((e=>!T.includes(e)))),[A,T]);return(0,v.jsx)(qn().Y,{direction:"horizontal",children:(0,v.jsx)("div",{role:"tablist","aria-label":c.formatMessage({id:"agentSearchSourceTabs.accessibilityLabel",defaultMessage:"Search source tabs"}),id:u,style:{padding:8},children:(0,v.jsxs)(i().Y1,{ref:S,direction:"horizontal",gap:1,align:"center-left",children:[T.map((a=>{const r=e.get(a),o=(null==r?void 0:r.length)??0;return(0,v.jsx)(ia,{sourceType:a,sourceLabel:k.get(a),count:o,isSelected:a===t,onChange:n,tabListId:u},a)})),R.length>0?(0,v.jsx)(da,{moreButtonRef:I,tabListId:u,overflowSourceTypes:R,sourceTypeToLabel:k,selectedSourceType:t,onChange:n,agentSearchResultsBySourceType:e,showConnectMore:m,onConnectMore:y}):m?(0,v.jsx)(la,{onConnectMore:y}):null]})})})}const oa=60;const ia=(0,a.memo)((function({sourceType:e,sourceLabel:t,count:n,isSelected:r,onChange:o,tabListId:s}){const l=(0,Yn().dM)(e),d=(0,a.useCallback)((()=>{o(e)}),[o,e]);return(0,v.jsx)(sa,{tabListId:s,isSelected:r,onClick:d,children:(0,v.jsxs)(i().Y1,{direction:"horizontal",gap:8,align:"center",children:[l?(0,v.jsx)($n().$x,{iconGroup:l,iconSize:"sm"}):null,(0,v.jsx)(R().D,{styleKey:"Body/Regular",colorVariant:r?"primary":"secondary",children:t}),(0,v.jsx)(R().D,{styleKey:"Caption/Medium",colorVariant:r?"secondary":"tertiary",children:n})]})})}));function sa({tabListId:e,isSelected:t,onClick:n,children:a}){const{isTabbable:r,itemRef:o,onKeyDown:i,onFocus:s}=(0,qn().e)(),l=(0,C().IS)((e=>({button:{...t&&{background:e.background.tertiaryTranslucent}}})),[t]);return(0,v.jsx)(L().p,{ref:o,size:"lg",shape:"pill",onClick:n,onKeyDown:i,onFocus:s,style:l.button,"aria-selected":t,"aria-controls":e,role:"tab",disallowTabbing:!r,children:a})}function la({onConnectMore:e}){const t=(0,P().tz)().formatMessage({id:"AgentSearchSourcePicker.connectMoreTabLabel",defaultMessage:"Connect apps"});return(0,v.jsx)($().A,{placement:"top",renderTooltip:()=>t,render:t=>(0,v.jsx)(L().p,{size:"lg",shape:"pill",onClick:e,...t,children:(0,v.jsx)(D().I,{icon:tt().plusSmallIcon,size:"sm"})})})}function da({tabListId:e,overflowSourceTypes:t,sourceTypeToLabel:n,selectedSourceType:a,onChange:r,agentSearchResultsBySourceType:o,showConnectMore:s,onConnectMore:l,moreButtonRef:d}){return(0,v.jsx)(Qn().A,{alignmentToOrigin:"start",placementToOrigin:"bottom",originGap:4,popupType:Qn().z.Popup,renderOrigin:n=>(0,v.jsx)("div",{ref:d,children:(0,v.jsx)(sa,{tabListId:e,isSelected:!1,onClick:()=>n.onClick(),children:(0,v.jsxs)(i().Y1,{direction:"horizontal",gap:8,align:"center",children:[(0,v.jsx)(R().D,{styleKey:"Body/Regular",colorVariant:"secondary",children:(0,v.jsx)(P().sA,{id:"AgentSearchSourcePicker.more",defaultMessage:"More"})}),(0,v.jsx)(R().D,{styleKey:"Caption/Medium",colorVariant:"tertiary",children:t.length})]})})}),render:()=>(0,v.jsx)(Zn().A,{menuType:ea().gu.Popup,width:220,children:(0,v.jsxs)(Dt().A,{children:[t.map((e=>(0,v.jsx)(ca,{sourceType:e,sourceLabel:n.get(e),agentSearchResultsBySourceType:o,selectedSourceType:a,onSelect:()=>{r(e)}},e))),s?(0,v.jsx)(Et().A,{focused:!1,onClick:()=>{l()},icon:(0,v.jsx)(D().I,{size:"sm",colorVariant:"secondary",icon:tt().plusSmallIcon}),title:(0,v.jsx)(P().sA,{id:"AgentSearchSourcePicker.connectMore",defaultMessage:"Connect apps"})}):null]})})})}function ca({sourceType:e,sourceLabel:t,agentSearchResultsBySourceType:n,selectedSourceType:a,onSelect:r}){const o=n.get(e),i=(null==o?void 0:o.length)??0,s=(0,Yn().dM)(e);return(0,v.jsx)(Et().A,{focused:!1,onClick:r,icon:s?(0,v.jsx)($n().$x,{iconGroup:s,iconSize:"sm"}):void 0,title:t,right:i>0?(0,v.jsx)(R().D,{styleKey:"Caption/Regular",colorVariant:"tertiary",children:i}):void 0,isChecked:e===a})}function ua(e){const t=(0,r().v3)(),n=(0,B().L)(),l=(0,P().tz)(),d=(0,b().X)("agent_search_cohere_ranking"),{toolUsePartData:c,threadStore:u,clientStore:g,runningInference:p,isLastTurn:h,aiChatFeatureController:m,onExpandedChange:f}=e,{toolResultStep:y}=c,S=null==y?void 0:y.id,x=(0,a.useMemo)((()=>{try{return g.getOrCreateClientAIChatThreadStore(u.id)}catch(e){return null}}),[g,u.id]),w=(0,o().K8)((()=>{var e;if(!S||!x)return;const t=null===(e=x.state.agentSearchResultsByToolResultStepId)||void 0===e?void 0:e[S];return null==t?void 0:t.results}),[x,S]),[M,k]=(0,a.useState)(void 0),j=(0,a.useRef)(null),T=(0,o().uB)(void 0,Nn().D);(0,On().c2)({containerRef:j,citationHoverStore:T,parentStore:n,evaluatorState:void 0});const _=(0,de().I)({runningInference:p,toolResultStep:y,isLastTurn:h}),E=Boolean(y&&(0,I().I6)(y)),D=(0,a.useMemo)((()=>{const e=new Map;if(!y||!(0,ge().gY)(y,"search"))return e;const t=(0,Yn().iY)({isCohereRankingEnabled:d,resultStep:y,overrideResults:w});if(d&&t.size>1){const n=(0,Yn().w_)(t);e.set("top-results",n)}for(const[n,a]of t)e.set(n,a);return e}),[d,y,w]),z=Array.from(D.keys());(0,a.useEffect)((()=>{const e=z[0];e&&!M&&k(e)}),[D,M,z]);const L=(0,a.useMemo)((()=>M?D.get(M)??[]:[]),[D,M]),F=(0,a.useMemo)((()=>L.reduce(((e,t)=>(e[t.id]=t,e)),{})),[L]),U=(0,Yn().be)({citationContext:F}),V=(0,a.useMemo)((()=>{let e=0;for(const t of D.values())e+=t.length;return e}),[D]),O=(0,o().K8)((()=>n?L.map(((e,a)=>(0,Yn().eL)({index:a,result:e,environment:t,spaceStore:n,hoverStore:T}))).filter(s().O9):[]),[L,t,n,T]),W=(0,a.useMemo)((()=>0===O.length?[]:[{key:`search-results-${M}`,render:e=>(0,v.jsx)(Dt().A,{...e}),items:O}]),[O,M]),N=W.length>0,K=(0,o().uB)(void 0,ct().A),H=y?(0,I().rk)(y):void 0,$=Ce({toolName:"search",state:"confirmation:rejected"===H?"reverted":_||E?"loading":"done",numResults:V,intl:l,isMultiDatabaseMode:!1,toolResultStep:y}),Y=(0,a.useMemo)((()=>{var e,t,n,a;if(y&&(0,ge().gY)(y,"search")&&y.input)return null!==(e=y.input)&&void 0!==e&&null!==(e=e.default)&&void 0!==e&&e.questions.length?y.input.default.questions[0]:null!==(t=y.input)&&void 0!==t&&null!==(t=t.internal)&&void 0!==t&&t.questions.length?y.input.internal.questions[0]:null!==(n=y.input)&&void 0!==n&&null!==(n=n.web)&&void 0!==n&&n.queries.length?y.input.web.queries[0]:null!==(a=y.input)&&void 0!==a&&null!==(a=a.users)&&void 0!==a&&a.queries.length?y.input.users.queries[0]:void 0}),[y]),q=Boolean(Y&&Y.length>0),G=l.formatMessage({id:"agentSearchToolUsePart.toolNameMessage",defaultMessage:"{toolName} for"},{toolName:$}),X=(0,a.useMemo)((()=>(0,v.jsx)(Bn().n,{title:q?G:$,titleSuffix:q?`"${Y}"`:void 0,subtitle:void 0,hasUndoneOperations:!1,state:H})),[q,Y,$,G,H]),Q=y&&(0,I().nP)(y)?N&&V>0:void 0,Z=(0,a.useMemo)((()=>N&&M&&n?(0,v.jsxs)(v.Fragment,{children:[D.size>1?(0,v.jsx)(ra,{agentSearchResultsBySourceType:D,selectedSourceType:M,onChange:k,aiChatFeatureController:m}):null,(0,v.jsxs)(Kn().K,{from:"AgentSearchToolUsePart",fallback:({errorId:e,error:t})=>(0,v.jsx)(Hn().LargeSurfaceRenderError,{errorId:e,error:t}),children:[(0,v.jsx)(lt().H,{type:qe().A.Y,style:{maxHeight:200},children:(0,v.jsx)(st().Ay,{type:st().Oh.Vertical,initialFocus:void 0,resetFocusOnMouseOut:!0,sections:W,store:K,disableKeyboard:!0})}),(0,v.jsx)(Wn().cE,{containerRef:j,hoverStore:T,parentStore:n,isSearchChat:!1,getPayloadDataForHref:U})]})]}):null),[D,N,K,W,M,k,n,T,U,m]),J=(0,C().IS)((e=>({titleContainer:{flex:1,minWidth:0,overflow:"hidden"},resultWrapper:{borderRadius:10,overflow:"hidden",boxShadow:`0 0 0 1px ${e.border.secondary}, 0px 1px 2px rgba(0, 0, 0, 0.04)`,transition:"box-shadow 0.15s ease-in-out"}})),[]);return n?y&&(0,de().eb)(y)?(0,v.jsx)(Re,{toolName:"search",variant:"agent_mobile"===m.aiChatType?"large":"default"}):!_||E||N||0!==V?0===V?null:(0,v.jsx)($e,{isExpandable:Q??!1,icon:Vn().u,onExpandedChange:f,title:(0,v.jsxs)(i().Y1,{direction:"horizontal",gap:4,align:"center",children:[(0,v.jsx)(R().D,{styleKey:"Body/Regular",style:{marginInlineEnd:4},children:(0,v.jsx)(P().sA,{id:"agentSearchToolUsePart.searchResultsCount",defaultMessage:"{count} results",values:{count:V}})}),(0,v.jsx)(ga,{sourceTypes:z})]}),content:(0,v.jsxs)("div",{style:J.resultWrapper,ref:j,children:[(0,v.jsx)("div",{style:{...J.titleContainer,paddingTop:12,paddingBottom:4,paddingInlineEnd:14,paddingInlineStart:14},children:X}),Z]}),variant:"agent_mobile"===m.aiChatType?"large":"default"}):(0,v.jsx)("div",{children:(0,v.jsx)(A().c,{message:q?`${G} "${Y}"`:$,animationType:"scrolling-squiggle"})}):null}function ga({sourceTypes:e}){return(0,v.jsx)(v.Fragment,{children:e.filter((e=>"top-results"!==e)).map((e=>{const t=(0,Yn().dM)(e);return t?(0,v.jsx)($n().$x,{iconGroup:t,iconSize:"xs"},e):null}))})}function pa(e){const{partData:t,aiChatFeatureController:n,threadStore:o,clientStore:i,runningInference:l,isLastTurn:d,turnSteps:c,blurOnExpand:u}=e,g=(0,r().v3)(),p=(0,a.useCallback)((e=>{u&&e&&oe().IU({environment:g})}),[u,g]);switch(t.type){case"thinking":return(0,v.jsx)(Ye,{thinkingPartData:t,aiChatFeatureController:n,onExpandedChange:p,runningInference:l});case"chat":return(0,v.jsx)(se,{chatPartData:t,aiChatFeatureController:n});case"search-tool-use":return(0,v.jsx)(ua,{toolUsePartData:t,threadStore:o,clientStore:i,runningInference:l,isLastTurn:d,aiChatFeatureController:n,onExpandedChange:p});case"tool-use":return(0,v.jsx)(zn,{toolUsePartData:t,threadStore:o,runningInference:l,aiChatFeatureController:n,isLastTurn:d,onExpandedChange:p});case"mcp-tool-use":{const e=(c??[]).filter((e=>"workflow-effect-calling"===e.type||"workflow-effect-called"===e.type||"workflow-effect-error"===e.type));return(0,v.jsx)(ze,{mcpToolUsePartData:t,threadStore:o,runningInference:l,aiChatFeatureController:n,isLastTurn:d,turnSteps:e,onExpandedChange:p})}default:(0,s().HB)(t)}}function ha(e){const{step:t,turn:n,hasMoreAgentSteps:a,isLastTurn:r,runningInference:o,threadStore:s,spaceStore:l,aiChatFeatureController:d,items:c,blurOnExpand:u,clientStore:g}=e,p=n.steps.filter((t=>"agent-tool-result"===t.type&&t.agentStepId===e.step.id)),h=function(e){const{toolResultsForStep:t,hasMoreAgentSteps:n,isLastTurn:a,runningInference:r}=e;return t.length>0&&t.every(I().nP)&&!n&&a&&r&&!t.some(I().I6)}({toolResultsForStep:p,hasMoreAgentSteps:a,isLastTurn:r,runningInference:o});return(0,v.jsxs)(i().Y1,{direction:"vertical",gap:20,children:[c.map(((e,t)=>(0,v.jsx)(pa,{partData:e,threadStore:s,clientStore:g,spaceStore:l,aiChatFeatureController:d,runningInference:o,isLastTurn:r,turnSteps:n.steps,blurOnExpand:u},`${e.step.id}-${t}`))),h?(0,v.jsx)("div",{children:(0,v.jsx)(A().c,{message:(0,A().U)(t.id),animationType:"scrolling-squiggle"},`thinking-after-tools-${t.id}`)}):void 0]})}var ma=()=>n(160432),fa=()=>n(373009),va=()=>n(997274),ya=()=>n(108715);const Sa="https://www.notion.com/help/notion-ai-security-practices";function xa(e){const{urls:t,onConfirm:n,onCancel:r}=e,o=(0,C().DP)(),[s,l]=(0,a.useState)(!1),d=(0,C().IS)((e=>({wrapper:{boxShadow:e.shadow2XS,borderRadius:10,backgroundColor:e.background.elevated,padding:"16px 20px"},description:{marginBottom:"2px"},urlContainer:{backgroundColor:e.background.secondary,borderRadius:"6px",padding:"0px 2px",wordBreak:"break-all"},urlText:{fontFamily:"monospace",fontSize:"13px",color:e.text.secondary,whiteSpace:"pre-wrap",...s?{}:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"}},showAllLink:{fontSize:"13px",marginTop:"-8px",marginBottom:"8px",display:"flex",justifyContent:"flex-end",width:"100%"},agentSecurityImage:{width:"32px",height:"32px"},learnMoreLink:{color:e.blue.text.accentPrimary},hostnameHighlight:{backgroundColor:e.yellow.background.secondaryTranslucent,padding:"2px 2px",borderRadius:"4px"}})),[s]),u=a.useMemo((()=>(0,c().sb)(t.map((e=>{try{return new URL(e).hostname}catch{return(0,va().xv)(e,50)}})))),[t]),g=a.useMemo((()=>u.map(((e,t)=>(0,v.jsxs)(a.Fragment,{children:[(0,v.jsx)("span",{style:d.hostnameHighlight,children:e}),t<u.length-1?", ":null]},t)))),[u,d.hostnameHighlight]),p=a.useMemo((()=>0===t.length?"":s?t.join("\n\n"):t[0]),[t,s]),h=t.length>1,m=p.length>120,f=h||m;return(0,v.jsxs)(i().Y1,{direction:"vertical",width:"fill",align:"top-left",style:d.wrapper,gap:8,children:[(0,v.jsx)("img",{src:ya(),alt:"Security",style:d.agentSecurityImage}),(0,v.jsx)(R().D,{styleKey:"Body/Medium",colorVariant:"primary",children:(0,v.jsx)(P().sA,{id:"UnsafeUrlConfirmationDialog.title",defaultMessage:"Do you trust {hostnames}?",values:{hostnames:g}})}),(0,v.jsx)(R().D,{styleKey:"Body/Regular",style:d.description,children:(0,v.jsx)(P().sA,{id:"UnsafeUrlConfirmationDialog.description",defaultMessage:"Allowing Notion AI to access untrusted URLs can be a security risk. {learnMoreLink}",values:{learnMoreLink:(0,v.jsx)(an().A,{hoverColor:"blue",style:d.learnMoreLink,href:Sa,external:!0,disableUnderline:!0,children:(0,v.jsx)(P().sA,{id:"unifiedChatFileConfirmationBanner.learnMore",defaultMessage:"Learn more"})})}})}),(0,v.jsx)("div",{style:d.urlContainer,children:(0,v.jsx)("div",{style:d.urlText,children:p})}),f?(0,v.jsx)("div",{style:d.showAllLink,children:(0,v.jsx)(an().A,{onClick:()=>{l(!s)},hoverColor:"blue",color:o.text.secondary,disableUnderline:!0,children:s?(0,v.jsx)(P().sA,{id:"UnsafeUrlConfirmationDialog.showLess",defaultMessage:"Show less"}):(0,v.jsx)(P().sA,{id:"UnsafeUrlConfirmationDialog.showAll",defaultMessage:"Show all"})})}):void 0,(0,v.jsxs)(i().Y1,{direction:"horizontal",gap:12,children:[(0,v.jsx)(fa().E,{onClick:r,children:(0,v.jsx)(P().sA,{id:"UnsafeUrlConfirmationDialog.cancel",defaultMessage:"Cancel"})}),(0,v.jsx)(fa().E,{onClick:n,children:(0,v.jsx)(P().sA,{id:"UnsafeUrlConfirmationDialog.allowAccess",defaultMessage:"Allow access"})})]})]})}function ba(e){const{resultStepIdsToConfirm:t,variant:n={type:"continue"}}=e,{confirmToolUse:r,rejectToolUse:o}=S(),s=(0,C().IS)((e=>({wrapper:{boxShadow:e.shadow2XS,borderRadius:10,backgroundColor:e.background.elevated,padding:"10px 12px"}})),[]),l=(0,a.useCallback)((()=>{r(t)}),[r,t]),d=(0,a.useMemo)((()=>{switch(n.type){case"deletePages":return(0,v.jsx)(ma().A,{onClick:l,colorPalette:"red",children:(0,v.jsx)(P().sA,{id:"AgentToolUseFull.deletePagesButton",defaultMessage:"Delete pages"})});case"continue":return(0,v.jsx)(ma().A,{onClick:l,colorPalette:"blue",children:(0,v.jsx)(P().sA,{id:"AgentToolUseFull.continueButton",defaultMessage:"Continue"})})}}),[l,n.type]),c=(0,a.useMemo)((()=>{switch(n.type){case"deletePages":return(0,v.jsx)(P().sA,{id:"AgentToolUseFull.deletePages",defaultMessage:"Delete {count, plural, one {# page} other {# pages}}?",values:{count:n.pageCount}});case"continue":return(0,v.jsx)(P().sA,{id:"AgentToolUseFull.confirmChanges",defaultMessage:"Confirm changes"})}}),[n]);return"viewPotentiallyUnsafeUrl"===n.type?(0,v.jsx)(xa,{urls:n.urls,onConfirm:l,onCancel:o}):(0,v.jsxs)(i().Y1,{direction:"horizontal",width:"fill",align:"center",style:s.wrapper,children:[(0,v.jsxs)(i().Y1,{direction:"vertical",width:"fill",gap:2,children:[(0,v.jsx)(R().D,{styleKey:"Body/Medium",colorVariant:"primary",children:c}),(0,v.jsx)(Ue().N,{styleKey:"Caption/Regular",colorVariant:"secondary",text:(0,v.jsx)(P().sA,{id:"AgentToolUseFull.waitingForConfirmation",defaultMessage:"Waiting for confirmation"}),animate:!0})]}),(0,v.jsxs)(i().Y1,{direction:"horizontal",gap:8,width:"hug",children:[(0,v.jsx)(fa().E,{onClick:o,children:(0,v.jsx)(P().sA,{id:"AgentToolUseFull.cancel",defaultMessage:"Cancel"})}),d]})]})}var Ca=()=>n(148307);const Ia=(0,P().YK)({title:{id:"AgentUpsellStep.title",defaultMessage:"You’ve run out of free Notion AI credits"},subtitle:{id:"AgentUpsellStep.subtitle",defaultMessage:"Upgrade to continue using Notion AI to automate and simplify your work."},bannerImageAlt:{id:"AgentUpsellStep.bannerImageAlt",defaultMessage:"Image of a couple of hand drawn blocks"}});function wa(e){const t=(0,P().tz)(),{step:a}=e,{featureAvailability:r}=a,o=(0,C().eP)(),{actionButtonMsg:i,actionForFeatureAvailability:s}=(0,n(949305).x)({featureAvailability:r,upgradeRequestAnalyticsEntrypoint:"ai_agent",upgradeRequestEntrypoint:"ai_agent",upsellFrom:"ai_agent"}),l=(0,C().IS)((e=>({container:{paddingTop:0,paddingInline:20,paddingBottom:20,marginBottom:20,maxWidth:500},title:{fontSize:16,fontWeight:600,color:e.text.primary,marginBottom:8},subtitle:{fontSize:14,color:e.text.secondary,marginBottom:20,lineHeight:1.5},buttonContainer:{display:"flex",gap:12},image:{width:100}})),[]);return(0,v.jsxs)(k().Q,{style:l.container,children:[(0,v.jsx)("img",{style:l.image,alt:t.formatMessage(Ia.bannerImageAlt),src:"dark"===o?Ca().A.images.agent.upsellBannerDarkPng:Ca().A.images.agent.upsellBannerLightPng}),(0,v.jsx)("div",{style:l.title,children:(0,v.jsx)(P().sA,{...Ia.title})}),(0,v.jsx)("div",{style:l.subtitle,children:(0,v.jsx)(P().sA,{...Ia.subtitle})}),(0,v.jsx)("div",{style:l.buttonContainer,children:i?(0,v.jsx)(ma().A,{colorPalette:"blue",onClick:s,iconLeading:{icon:n(911259).arrowInCircleUpIcon,size:"sm"},children:i}):void 0})]})}n(410838);var Ma=()=>n(908006),Aa=()=>n(510818),ka=()=>n(820579),ja=()=>n(449445),Ta=()=>n(454503),Ra=()=>n(613601),Pa=()=>n(349679),_a=()=>n(764781),Ea=()=>n(627503),Da=()=>n(406533),Ba=()=>n(721479),za=()=>n(599813),La=()=>n(995847),Fa=()=>n(234459),Ua=()=>n(148024),Va=()=>n(884107),Oa=()=>n(44729),Wa=()=>n(384944),Na=()=>n(471995),Ka=()=>n(319975),Ha=()=>n(231297),$a=()=>n(994877),Ya=()=>n(876098),qa=()=>n(576727),Ga=()=>n(140022),Xa=()=>n(571851),Qa=()=>n(118078),Za=()=>n(890754),Ja=()=>n(906537),er=()=>n(124749),tr=()=>n(548527),nr=()=>n(599412),ar=()=>n(732797),rr=()=>n(796977),or=()=>n(155792),ir=()=>n(531550);function sr({transaction:e,threadStore:t,step:n,userAction:a}){const r=t.getSpaceId();if(!r)return;const o=ir().X.createChildStore(t,{table:or().mS,id:n.id,spaceId:r});for(const i of o.getThreadOperationStores())Wa().zv({store:i,data:{userAction:a},transaction:e})}var lr=()=>n(555102),dr=()=>n(305425);const cr={default:"Caption/Medium",large:"Caption/Medium"},ur={default:V().Ev.sm,large:V().lD.default},gr=(0,P().YK)({responseCopied:{id:"aiInferenceTranscript.agentActionsRow.copiedToClipboard",defaultMessage:"Response copied to clipboard"},saveToPage:{id:"aiInferenceTranscript.agentActionsRow.saveToPage",defaultMessage:"Save to private pages"},defaultPageTitle:{id:"inferenceTranscript.AIStepFollowupAction.defaultPageTitle",defaultMessage:"AI Summary"}});function pr(e){const{isHovered:t,runningInference:n,turn:s,threadStore:l,configType:d,spaceStore:p,isLastTurn:h,parts:m,threadId:y,previousUserPromptKey:S,variant:x}=e,w=(0,r().v3)(),M=(0,a.useMemo)((()=>function(e){if("agent-turn"!==e.type)return"";const t=[];return e.steps.forEach((e=>{if("agent-inference"===e.type&&e.value){const n=(0,g().ie)(e),a=("string"==typeof n.value?[{type:"text",content:n.value}]:n.value).filter((e=>"text"===e.type)).map((e=>e.content)).join("");a&&t.push(a)}})),t.join("\n\n")}(s)),[s]),[A,k]=(0,a.useState)(!1),{undoableToolResults:j,modifiedRecords:T,feedbackStep:R,feedbackTraceId:P}=function(e){const{turn:t,parts:n,spaceStore:r}=e,i=(0,a.useMemo)((()=>n.filter((e=>"tool-use"===e.type)).map((e=>e.toolResultStep)).filter((e=>null!=e)).filter((e=>!(0,I().I6)(e)&&!(0,I().dB)(e)&&ge().MV.some((t=>t===e.toolName))))),[n]),s=(0,o().K8)((()=>(0,de().yX)(i,(null==r?void 0:r.id)??"")),[i,null==r?void 0:r.id]),l=(0,a.useMemo)((()=>{const e=t.steps.findLast((e=>"error"===e.type)),a=i.at(-1),r=n.findLast((e=>e.isFinished)),o="tool-use"===(null==r?void 0:r.type)?r:null,s=null==o?void 0:o.toolResultStep;return e||a||s||(r?r.step:t.steps.at(-1))}),[n,i,t.steps]),d=l&&"traceId"in l?l.traceId:void 0;return{undoableToolResults:i,modifiedRecords:s,feedbackStep:l,feedbackTraceId:d}}({turn:s,parts:m,spaceStore:p}),{operationsToUndo:_,stepsWithOperationsToUndo:E,hasUndoneOperations:D}=(0,de().ji)({diffResultSteps:j,threadStore:l}),{handleUndo:z}=function(e){const{operationsToUndo:t,stepsWithOperationsToUndo:n}=e,o=(0,r().v3)(),i=(0,B().L)(),s=(0,Za().useThreadStoreFromCurrentRoute)(),l=(0,er().$)(),d=(0,a.useCallback)((()=>{const e=function(e){const t=(0,c().mg)(e);for(const n of t)void 0===n.path&&(n.path=[]),void 0===n.args&&(n.args={});return t}(t),{serverCommitResult:a}=Ha().createAndCommit({userAction:"GroupStepRenderer.handleUndo",environment:o,canUndo:!1,isUndoTransaction:!0,perform:t=>{for(const n of e)(0,f().Hp)({transaction:t,operation:n,recordCache:null==i?void 0:i.inMemoryRecordCache,environment:o});for(const e of n)s&&sr({transaction:t,threadStore:s,step:e,userAction:"undo"});if(s&&i&&l){const e=Array.from(n).map((e=>({name:e.toolName,id:e.toolCallId}))),a=(0,lr().Xw)({environment:o,spaceId:i.id,message:`The user has undone the following tools:\n${e.map((e=>`- ${e.name}${e.id?` ({{[prefix=tool]${e.id}}})`:""}`)).join("\n")}`,notificationType:"info",metadata:{action:"undo",tools:e}});(0,f().Vn)({threadStore:s,environment:o,spaceStore:i,userStore:l,addSteps:[a],transaction:t})}}});return a}),[i,o,s,l,t,n]);return{handleUndo:d}}({operationsToUndo:_,stepsWithOperationsToUndo:E}),L=function(e){const{hasUndoneOperations:t,operationsToUndo:n}=e;return(0,a.useMemo)((()=>t?"reverted":n.length>0?"undo":"none"),[t,n])}({hasUndoneOperations:D,operationsToUndo:_}),F=(0,o().K8)((()=>{const e=u().f.getState().statuses;for(let t=e.length-1;t>=0;t--)if("undo"===e[t])return t}),[]),U=(0,b().X)("agent_contact_help_button"),V=(0,a.useMemo)((()=>s.steps.some((e=>"agent-search-query-generation"===e.type&&e.queries.some((e=>e.maybeNotionHelp))))),[s.steps]);(0,a.useEffect)((()=>{u().f.updateStatus({threadId:y,index:s.feedbackComponentIndex,status:L,previousStepId:s.previousStepId})}),[s.feedbackComponentIndex,L,y,s.previousStepId]);const O=s.steps.length>0,W=m.some((e=>e.isFinished))||0===m.length&&O,N=m.some((e=>{var t;return"tool-use"===e.type&&"requested"===(null===(t=e.toolResultStep)||void 0===t?void 0:t.userConfirmation)})),K=(W||0===m.length)&&!N&&!n&&Boolean(s.lastStepId),H=Boolean(R)&&Boolean(P)&&Boolean(l)&&K,$=T.length>0&&"undo"===L&&F===s.feedbackComponentIndex&&(K||A),Y=T.length>0&&"reverted"===L&&K,q=!n&&(t||h&&K),G=t||h&&$,X=(0,C().IS)((()=>({hoverDependentActions:{opacity:q?1:0,transition:"opacity 0.2s ease"},undoActions:{opacity:G?1:0,transition:"opacity 0.2s ease"}})),[q,G]),Q=(0,a.useCallback)((()=>{try{const e=le().calculateMetricsFromTranscript(Array.from(E));le().trackUndoClicked({environment:w,from:"undo_button",undoneToolTypes:e.toolTypes})}catch(e){}z(),k(!1)}),[w,z,E]),Z=s.steps.some((e=>"agent-inference"===e.type));return(0,v.jsx)(i().Y1,{direction:"horizontal",width:"fill",height:48,style:{paddingTop:"large"===x?12:8},align:"top-left",children:(0,v.jsxs)(i().Y1,{direction:"horizontal",align:"center-left",style:X.hoverDependentActions,gap:"large"===x?4:void 0,children:["error"!==(null==R?void 0:R.type)&&Z?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(mr,{runningInference:n,variant:x,agentResponseMarkdown:M,spaceStore:p,threadStore:l,configType:d}),(0,v.jsx)(hr,{agentResponseMarkdown:M,runningInference:n,variant:x,threadStore:l,configType:d})]}):null,R&&P&&l&&H?(0,v.jsx)(fr,{step:R,traceId:P,threadStore:l,previousUserPromptKey:S,variant:x}):void 0,!n&&U&&V?(0,v.jsx)(xr,{turn:s,threadId:y,variant:x}):void 0,$?(0,v.jsxs)(i().Y1,{direction:"horizontal",align:"center-left",gap:"large"===x?void 0:4,style:X.undoActions,children:[(0,v.jsx)(yr,{isConfirmingUndo:A,onClick:()=>k(!A),variant:x}),A?(0,v.jsx)(Sr,{onClick:Q,variant:x}):void 0]}):void 0,Y?(0,v.jsx)(vr,{}):void 0]})})}function hr(e){const{runningInference:t,variant:n,agentResponseMarkdown:i,threadStore:s,configType:l}=e,d=(0,P().tz)(),c=(0,r().v3)(),u=(0,b().X)("agent_save_turn_to_page"),g=(0,a.useMemo)((()=>i.trim()),[i]),p=(0,o().K8)((()=>{const e=s.getTranscript().find((e=>"title"===e.type));return null==e?void 0:e.value}),[s]),h=(0,a.useCallback)((e=>{const t="chat"===c.RouterStore.state.route.name;kt().uK({environment:c,store:e,pageVisitSource:Ct().y8.AIQna,...t?{}:{openInSidePeek:!0}})}),[c]),m=(0,a.useCallback)((async()=>{var e;if(!g)return;const t=null===(e=c.currentUser)||void 0===e?void 0:e.id;if(!t)return;const n=await(0,nr().M)({environment:c,from:"ai_agent",pageVisitSource:Ct().y8.AIQna,navigateOnCreate:!1});if(!n)return;const a=n.getSpaceId(),r=(0,dr().a9)({markdown:g,pageId:n.id,spaceId:a,idCreator:c.idCreator.getSpaceIdCreatorSync(a),actorPointer:{table:it().oo,id:t},citationFormat:"link"});Ha().createAndCommit({userAction:"AgentTranscript.saveTurnToPage",environment:c,canUndo:!1,perform:e=>{var t,a;const o=(0,dr().HS)({environment:c,transaction:e,rootStore:n,blockOperations:r}),i="header"===(null===(t=o[0])||void 0===t?void 0:t.getType())?o[0]:void 0,s=null==i||null===(a=i.getTitleStore())||void 0===a?void 0:a.getValue(),l=void 0!==s?s:void 0!==p?St().x9d(p):St().x9d(d.formatMessage(gr.defaultPageTitle));Ka().R9({environment:c,store:n.getBlockTitleStore(),value:l,transaction:e}),i&&(Oa().zz({parentStore:n,childStore:i,transaction:e}),Wa().zv({store:i,data:{alive:!1},transaction:e}))}}),h(n)}),[c,d,h,p,g]);if(!u||!g)return null;const f=d.formatMessage(gr.saveToPage);return(0,v.jsx)($().A,{renderTooltip:()=>(0,v.jsx)(P().sA,{...gr.saveToPage}),render:e=>(0,v.jsx)(H().A,{icon:"large"===n?ka().arrowLineDownIcon:ja().arrowLineDownSmallIcon,size:"md",iconStyle:{width:ur[n],height:ur[n]},ariaLabel:f,onClick:()=>{le().trackAgentFollowUpAction({environment:c,threadId:s.id,mode:l,action:"save_as_page"}),m()},disabled:t,...e})})}function mr(e){const{runningInference:t,variant:n,agentResponseMarkdown:o,spaceStore:i,threadStore:s,configType:l}=e,d=(0,P().tz)(),c=(0,r().v3)(),u=(0,dr().nM)({markdown:o,citationFormat:"link",spaceStore:i}),g=(0,a.useRef)(null),p=(0,a.useCallback)((async()=>{if(!u)return;le().trackAgentFollowUpAction({environment:c,threadId:s.id,mode:l,action:"copy"}),oe().td({environment:c,stores:[...u.getContentStores()]}),await Ma().default.afterNextFlush();const e=await Va().R.clipboardActions.load(),t=g.current;t&&c.device.isSafari?(Ja().setOnNode(t,c.device),e.triggerBrowserCopy(),Ja().clear(c)):e.triggerBrowserCopy(),Na().D6({label:d.formatMessage(gr.responseCopied)})}),[l,c,d,u,s]),h=d.formatMessage({id:"aiInferenceTranscript.agentActionsRow.copyResponse",defaultMessage:"Copy response"});return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)($().A,{renderTooltip:()=>h,render:e=>(0,v.jsx)(H().A,{icon:"large"===n?_a().V:Ea().a,size:"md",iconStyle:{width:ur[n],height:ur[n]},ariaLabel:h,onClick:()=>{p()},disabled:t,...e})}),(0,v.jsx)("span",{ref:g,style:{height:"1px",width:"1px",position:"absolute"}})]})}function fr(e){const{step:t,traceId:n,threadStore:a,previousUserPromptKey:r,variant:o}=e;return(0,v.jsxs)(v.Fragment,{children:["error"!==t.type?(0,v.jsx)(M().zg,{step:t,traceId:n,feedbackType:"thumbs_up",threadStore:a,iconColorVariant:"secondary",mode:"feedback-positive",promptKey:r,variant:o}):void 0,(0,v.jsx)(M().zg,{step:t,traceId:n,feedbackType:"thumbs_down",threadStore:a,iconColorVariant:"secondary",variant:o,promptKey:r,label:"error"===t.type?(0,v.jsx)(R().D,{styleKey:cr[o],colorVariant:"secondary",children:(0,v.jsx)(P().sA,{id:"AgentUserFeedbackActions.errorFeedbackText",defaultMessage:"Share feedback"})}):void 0})]})}function vr(){const e=(0,C().IS)((()=>({revertedText:{marginInlineStart:6,display:"flex",alignItems:"center"}})),[]);return(0,v.jsx)("div",{style:e.revertedText,children:(0,v.jsx)(R().D,{styleKey:"Body/Regular",colorVariant:"secondary",children:(0,v.jsx)(P().sA,{id:"AgentUserFeedbackActions.changesReverted",defaultMessage:"Changes reverted"})})})}function yr(e){const{isConfirmingUndo:t,onClick:n,variant:a}=e,r=(0,P().tz)(),o=(0,P().YK)({labelCancel:{id:"AgentUserFeedbackActions.cancel",defaultMessage:"Cancel"},labelUndo:{id:"AgentUserFeedbackActions.undo",defaultMessage:"Undo"}}),i=(0,C().IS)((e=>({buttonIcon:{width:ur[a],height:ur[a],color:e.icon.secondary},button:{borderRadius:6}})),[a]);return t?(0,v.jsx)(H().A,{ariaLabel:r.formatMessage(o.labelCancel),size:"md",onClick:n,colorVariant:"secondary",icon:"large"===a?za().xMarkIcon:La().xMarkSmallIcon,style:i.button,iconStyle:i.buttonIcon,caption:(0,v.jsx)(R().D,{styleKey:cr[a],colorVariant:"secondary",style:{textTransform:"none",letterSpacing:"normal"},children:(0,v.jsx)(P().sA,{...o.labelCancel})})},"cancel"):(0,v.jsx)(H().A,{ariaLabel:r.formatMessage(o.labelUndo),size:"md",onClick:n,colorVariant:"secondary",icon:"large"===a?Ta().arrowUTurnUpLeftIcon:Ra().arrowUTurnUpLeftSmallIcon,style:i.button,iconStyle:i.buttonIcon,caption:(0,v.jsx)(R().D,{styleKey:cr[a],colorVariant:"secondary",style:{textTransform:"none",letterSpacing:"normal"},children:(0,v.jsx)(P().sA,{...o.labelUndo})})},"undo")}function Sr(e){const{onClick:t,variant:n}=e,a=(0,P().tz)(),r=(0,P().YK)({labelConfirmUndo:{id:"AgentUserFeedbackActions.confirmUndo",defaultMessage:"Confirm Undo"}}),o=(0,C().IS)((e=>({button:{borderRadius:6,background:e.red.background.secondaryTranslucent},buttonIcon:{width:ur[n],height:ur[n]},buttonHovered:{background:(0,Ne().i)({color:e.red.background.secondaryTranslucent,mode:e.mode})},buttonPressed:{background:(0,Ne().yZ)({color:e.red.background.secondaryTranslucent,mode:e.mode})}})),[n]);return(0,v.jsx)(H().A,{ariaLabel:a.formatMessage(r.labelConfirmUndo),icon:Pa().checkmarkSmallIcon,iconStyle:o.buttonIcon,size:"md",colorPalette:"red",colorVariant:"accentPrimary",onClick:t,style:o.button,hoveredStyle:o.buttonHovered,pressedStyle:o.buttonPressed,caption:(0,v.jsx)(R().D,{styleKey:cr[n],colorPalette:"red",colorVariant:"accentPrimary",style:{textTransform:"none",letterSpacing:"normal"},children:(0,v.jsx)(P().sA,{...r.labelConfirmUndo})})})}function xr(e){const{turn:t,variant:n,threadId:i}=e,s=(0,P().tz)(),{isMobileNative:l}=(0,r().Y0)(),d=(0,P().YK)({labelGetHelp:{id:"AgentUserFeedbackActions.getHelp",defaultMessage:"Contact Notion support"}}),c=(0,C().IS)((e=>({buttonIcon:{width:ur[n],height:ur[n],color:e.icon.secondary},button:{borderRadius:6}})),[n]),u=(0,r().v3)(),g=(0,o().K8)((()=>(0,Ya().Q)()&&qa().default.state.isZendeskEnabled),[]),[p,h]=(0,tr().P)(1),m=(0,a.useRef)(!1);(0,a.useEffect)((()=>{h&&!m.current&&(m.current=!0,le().trackGetHelpButtonImpression({environment:u,threadId:i}))}),[h,u,i]);const f=(0,a.useCallback)((async()=>{if(Ua().VX(u,{qnaSessionId:i,from:"qna_modal_chat"}),(0,Ga().trackAiDetectedGetSupportPillClick)(u,{sessionId:i}),g){(0,Qa().dismissChatSidebar)();const e=await async function(e,t){const n=dt().default.state.sidebarSpaceStore;if(!n)return;const a=rr().E.createChildStore(n,{table:Fa().To,id:t,spaceId:n.id}),r=a.getTranscript(),o=r.findIndex((t=>t.id===e.id)),i=r.slice(0,o).find((e=>"user"===e.type));if(i)return await(0,Aa().rf)({value:i.value,loadRecordModel:n.loadRecordModel})}(t.steps[0],i);$a().SI({environment:u,from:"ai_assistant_pill",prepopulatedContent:e})}else l?ar().A.setState({...ar().A.state,open:!0}):Xa().assistantMenuActions.openCornerChatHelp()}),[g,t.steps,u,i,l]);return(0,v.jsx)(H().A,{ref:p,ariaLabel:s.formatMessage(d.labelGetHelp),size:"md",onClick:f,colorVariant:"secondary",icon:"large"===n?Da().questionMarkCircleIcon:Ba().questionMarkCircleSmallIcon,style:c.button,iconStyle:c.buttonIcon,caption:(0,v.jsx)(R().D,{styleKey:cr[n],colorVariant:"secondary",style:{textTransform:"none",letterSpacing:"normal"},children:(0,v.jsx)(P().sA,{...d.labelGetHelp})})},"get-help")}const br=a.memo((function(e){const{turn:t,previousUserTurn:l,isLastTurn:d,configType:u,spaceStore:g,threadStore:p,clientStore:h,runningInference:m,showDebug:f,aiChatFeatureController:y}=e,S=(0,r().v3)(),x=(0,b().X)("agent_multidb_creation"),k=(0,a.useMemo)((()=>{const e=null==l?void 0:l.userInitiatedStep;if("agent-prebuilt-prompt"===(null==e?void 0:e.type))return e.promptType}),[l]),R=(0,b().X)("custom_agent_show_error_details")&&y.supportsDetailedError,[P,_]=a.useState(!1),D=(0,C().IS)((e=>({agentTurn:{...f&&{boxShadow:"calc(var(--direction, 1) * -4px) 0 0 0 rgba(255,0,0,0.3)"}},codeBlock:{padding:12,borderRadius:8,backgroundColor:e.codeBlockBackground}})),[f]),B=(0,a.useCallback)((()=>{_(!0)}),[]),z=(0,a.useCallback)((()=>{_(!1)}),[]),{stepPartsByStepId:L,allParts:F,allToolResults:U}=function(e){const{turn:t,environment:n,spaceStore:r,threadStore:i,clientStore:l,runningInference:d,isMultiDatabaseMode:u}=e,g=(0,a.useRef)(new Map),p=(0,a.useMemo)((()=>t.steps.filter((e=>"agent-tool-result"===e.type))),[t.steps]),h=(0,o().K8)((()=>{const e=g.current,a=new Map;let o=!1;return t.steps.forEach((t=>{if("agent-inference"===t.type){const g=p.filter((e=>e.agentStepId===t.id)),h=wn({environment:n,step:t,toolResultsForStep:g,spaceStore:r,threadStore:i,clientStore:l,runningInference:d,isMultiDatabaseMode:u}).filter(s().O9),m=e.get(t.id);m&&(0,c().n4)(m,h)?a.set(t.id,m):(o=!0,a.set(t.id,h))}})),o||e.size!==a.size?(g.current=a,a):e}),[t.steps,n,p,r,i,l,d,u]),m=(0,a.useMemo)((()=>{const e=[];for(const t of h.values())e.push(...t);return e}),[h]);return{stepPartsByStepId:h,allParts:m,allToolResults:p}}({turn:t,environment:S,spaceStore:g,threadStore:p,clientStore:h,runningInference:m,isMultiDatabaseMode:x}),V=t.steps.map(((e,a)=>{if("agent-inference"===e.type){const n=L.get(e.id)??[],r=t.steps.slice(a+1).some((e=>"agent-inference"===e.type));return(0,v.jsx)(M().uQ,{step:e,threadStore:p,clientStore:h,children:(0,v.jsx)(ha,{step:e,turn:t,hasMoreAgentSteps:r,isLastTurn:d,runningInference:m,threadStore:p,spaceStore:g,aiChatFeatureController:y,items:n,blurOnExpand:y.supportsBlurOnToolExpand,clientStore:h})},e.id)}return"error"===e.type?(0,v.jsxs)(M().uQ,{step:e,threadStore:p,clientStore:h,children:[f?(0,v.jsx)(M().ze,{step:e}):(0,v.jsx)(n(807253).P,{errorStep:e,configType:"workflow"}),R?(0,v.jsx)("div",{style:D.codeBlock,children:(0,v.jsx)(w().O,{value:JSON.stringify(e,null,2),language:"json"})}):void 0]},e.id):"agent-debug-error"===e.type?(0,v.jsx)(M().uQ,{step:e,threadStore:p,clientStore:h,children:(0,v.jsx)(j,{step:e})},e.id):"agent-trigger"===e.type?(0,v.jsx)(M().uQ,{step:e,threadStore:p,clientStore:h,children:(0,v.jsx)(re,{step:e,threadStore:p})},e.id):"agent-route-trigger"===e.type?(0,v.jsx)(M().uQ,{step:e,threadStore:p,clientStore:h,children:(0,v.jsx)(E,{step:e})},e.id):"eval-result"===e.type?(0,v.jsx)(M().uQ,{step:e,threadStore:p,clientStore:h,children:(0,v.jsx)(T,{step:e},e.id)},e.id):"premium-feature-unavailable"===e.type?(0,v.jsx)(M().uQ,{step:e,threadStore:p,clientStore:h,children:(0,v.jsx)(wa,{threadStore:p,step:e})},e.id):"agent-tool-result"===e.type&&function(e,t){return e.insufficientPermissions&&!t.steps.some((t=>"agent-inference"===t.type&&t.id===e.agentStepId))}(e,t)?(0,v.jsx)(M().uQ,{step:e,threadStore:p,clientStore:h,children:(0,v.jsx)(Tn,{toolName:e.toolType,toolResultStep:e,aiChatFeatureController:y})},e.id):f?(0,v.jsx)(M().uQ,{step:e,threadStore:p,clientStore:h},e.id):void 0})).filter(s().O9),O=d&&!t.hasAgentInferenceStep&&m,{resultStepIdsToConfirm:W,confirmationVariant:N}=(0,a.useMemo)((()=>{const e=[];let t,n,a=0;return U.filter((e=>(0,I().I6)(e))).forEach((n=>{if(e.push(n.id),n.threadOperations&&n.threadOperations.forEach((e=>{e.deletesPage&&a++})),"view"===n.toolType&&n.result){const e=n.result;"pendingUnsafeUrls"in e&&Array.isArray(e.pendingUnsafeUrls)&&(t=e.pendingUnsafeUrls)}if(("update-page"===n.toolType||"create-pages"===n.toolType)&&n.result){const e=n.result;"unsafeUrls"in e&&Array.isArray(e.unsafeUrls)&&(t=e.unsafeUrls)}})),t?n={type:"viewPotentiallyUnsafeUrl",urls:t}:a>0?n={type:"deletePages",pageCount:a}:e.length>0&&(n={type:"continue"}),{resultStepIdsToConfirm:e,confirmationVariant:n}}),[U]),K=W.length>0,H=V.length>0||O,$=!K&&(H||d);return(0,v.jsxs)("div",{onMouseEnter:B,onMouseLeave:z,style:D.agentTurn,children:[H?(0,v.jsxs)(i().Y1,{direction:"vertical",gap:20,children:[V,O?(0,v.jsx)("div",{style:{padding:"0 4px"},children:(0,v.jsx)(A().c,{message:(0,A().U)(t.previousStepId),animationType:"scrolling-squiggle"})}):null,!m&&K?(0,v.jsx)(ba,{resultStepIdsToConfirm:W,variant:N}):void 0]}):null,$?(0,v.jsx)(pr,{isHovered:P,runningInference:m,turn:t,threadStore:p,configType:u,spaceStore:g,isLastTurn:d,parts:F,threadId:p.id,previousUserPromptKey:k,variant:"agent_mobile"===y.aiChatType?"large":"default"}):void 0]})}));var Cr=()=>n(17022),Ir=()=>n(221844),wr=()=>n(467273),Mr=()=>n(209969),Ar=()=>n(722101),kr=()=>n(901444),jr=()=>n(712030),Tr=()=>n(962845),Rr=()=>n(502438),Pr=()=>n(791256),_r=()=>n(803078);function Er(e){const{step:t,clientStore:i,threadStore:l,disableUserMessageEditing:d}=e,c=(0,r().v3)(),u=(0,P().tz)(),g=t.userId===c.currentUser.id,p=(0,o().K8)((()=>{const{sidebarSpaceStore:e}=dt().default.state;if(e&&t.userId)return pt().L.createChildStore(e,{table:it().oo,id:t.userId})}),[t.userId]),h=(0,o().K8)((()=>null==p?void 0:p.getDisplayName(u)),[p,u]),m=(0,o().K8)((()=>{var e;return"search"===(null===(e=(0,Pr().Ns)(l))||void 0===e?void 0:e.type)}),[l]),y=(0,o().K8)((()=>{var e;return"researcher"===(null===(e=(0,Pr().Ns)(l))||void 0===e?void 0:e.type)}),[l]),S=(0,o().K8)((()=>{var e;return"markdown-chat"===(null===(e=(0,Pr().Ns)(l))||void 0===e?void 0:e.type)}),[l]),[x,I]=(0,a.useState)(!1),w=(0,a.useRef)(null),M=(0,a.useRef)(null),{store:A,setValue:k}=(0,n(847743).AI)({initialValue:t.value}),j=(0,b().X)("agent_partial_transcript"),T=(0,b().X)("agent_patch_streaming"),R=(0,a.useCallback)((()=>{I(!1),k(t.value)}),[t.value,k,I]),_=function(e){const{step:t,clientStore:n,threadStore:r,environment:o,textRef:i,setIsEditing:l,mockTextStore:d,sendPartialTranscript:c,sendPatchResponse:u}=e,g=(0,a.useCallback)((()=>{l(!0),setTimeout((()=>{var e;null===(e=i.current)||void 0===e||e.focus()}),1)}),[l,i]),p=(0,a.useCallback)((e=>{l(!1),function(e){const{environment:t,threadStore:n,clientStore:a,step:r,newValue:o,sendPartialTranscript:i,sendPatchResponse:l}=e,d=n.getTranscript().find(wr().z),c=(null==d?void 0:d.id)===r.id,{serverCommitResult:u}=Ha().createAndCommit({userAction:"AgentUserStep.saveUserStepChanges",environment:t,canUndo:!0,perform:e=>{const{type:t}=r;"agent-prebuilt-prompt"===t?(0,f().ki)({threadStore:n,stepId:r.id,newValue:o,transaction:e}):"user"===t?(0,f().D7)({threadStore:n,step:r,newValue:o,transaction:e}):(0,s().HB)(t),(0,f().Pz)({threadStore:n,stepId:r.id,transaction:e})}});(0,f().WE)({environment:t,threadStore:n,clientStore:a,forceRegenerateTitle:c,stepIdsToInclude:Boolean(i)?[r.id]:void 0,waitBeforeSending:u,sendPatchResponse:l})}({environment:o,threadStore:r,clientStore:n,step:t,newValue:e,sendPartialTranscript:c,sendPatchResponse:u})}),[o,r,n,t,l,c,u]),h=(0,a.useCallback)((()=>{const e=d.getValue();e&&0!==e.length&&p(d.getValue()||[])}),[p,d]);return{handleEditClick:g,saveEdit:h}}({step:t,clientStore:i,threadStore:l,environment:c,textRef:w,setIsEditing:I,mockTextStore:A,sendPartialTranscript:j,sendPatchResponse:T});(0,a.useEffect)((()=>{if(!x)return;const e=e=>{M.current&&!M.current.contains(e.target)&&R()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[x,R]);const E=(0,C().IS)((e=>({container:{position:"relative",display:"flex",flexDirection:"column",alignItems:g?"flex-end":"flex-start"},userLabelContainer:{display:"flex",alignItems:"center",gap:12,paddingBottom:8,paddingInlineStart:4,paddingInlineEnd:4},userLabel:{color:e.text.secondary}})),[g]),D=t.value||[],B=0===D.length,z=function(e){const{threadStore:t,textValue:n}=e,a=(0,r().v3)(),i=(0,C().DP)();return(0,o().K8)((()=>{const e=t.getSpaceId();return e?(0,Pt().S5)({environment:a,textValue:{value:n,spaceId:e},parentStore:t,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disabled:!0,disableLinks:!1,theme:i,emojiType:(0,jr().FN)(a),katex:a.KatexStore.getKatex(),formulaValueTypes:[]}):null}),[t,a,n,i])}({threadStore:l,textValue:D});return(0,v.jsxs)("div",{style:E.container,ref:M,children:[g?void 0:(0,v.jsxs)("div",{style:E.userLabelContainer,children:[(0,v.jsx)(Br,{userStore:p,isCurrentUser:g}),(0,v.jsx)("div",{style:E.userLabel,children:h})]}),B?void 0:(0,v.jsx)(Fr,{isCurrentUser:g,userStore:p,isEditing:x,renderedText:z,mockTextStore:A,textRef:w,onSaveEdit:_.saveEdit,onEditClick:_.handleEditClick,disableUserMessageEditing:d,isSearchConfig:m,isResearcherConfig:y,isMarkdownChatConfig:S,step:t,threadStore:l}),(0,v.jsx)(Vr,{isCurrentUser:g,isEditing:x,onCancelEdit:R,onSaveEdit:_.saveEdit,mockTextStore:A})]})}function Dr(e){const{renderedText:t,onClick:n,clickable:r}=e,o=(0,P().tz)(),i=(0,C().IS)((e=>({bubble:{paddingTop:6,paddingBottom:6,paddingInlineStart:14,paddingInlineEnd:14,borderRadius:16,backgroundColor:e.background.tertiaryTranslucent,whiteSpace:"pre-wrap",wordWrap:"break-word",wordBreak:"break-word",transition:"background-color 0.1s ease",...r?{cursor:"pointer"}:{}}})),[r]),s=(0,a.useCallback)((e=>{r&&n&&("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n()))}),[r,n]);return(0,v.jsx)("div",{style:i.bubble,onClick:r?n:void 0,onKeyDown:r?s:void 0,role:r?"button":void 0,tabIndex:r?0:void 0,"aria-label":r?o.formatMessage(Wr.editMessage):void 0,children:(0,v.jsx)("div",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",wordBreak:"break-word"},children:t})})}function Br(e){const{userStore:t,isCurrentUser:n}=e;return n||!t?null:(0,v.jsx)(en().A,{userStore:t,size:16})}function zr(e){const{step:t,threadStore:n,isVisible:o}=e,i=(0,r().v3)(),s=(0,P().tz)(),l=(0,a.useRef)(null),d=(0,a.useMemo)((()=>t.value??[]),[t.value]),c=function(e){const{threadStore:t,textValue:n}=e,o=(0,r().v3)(),i=o.defaultRecordCache.inMemoryRecordCache,s=(0,a.useRef)(void 0),l=(0,a.useMemo)((()=>{const e=s.current;if(e&&(e.removeCacheFallback(i),s.current=void 0),0===n.length)return;const a=t.getSpaceId();if(!a)return;const r=new(Ir().A)({name:"AgentUserInitiatedStep.copy",isTemporaryData:!0}),l=Cr().e.withListenerIgnored((()=>{const e=o.idCreator.getSpaceIdCreatorSync(a);return Ha().createAndCommit({userAction:"AgentUserInitiatedStep.createTemporaryCopyBlocks",environment:o,canUndo:!1,perform:t=>{const i=Wa().Wv({environment:o,type:"page",id:e.idInSavedSpace(rt().ev),inMemoryRecordCache:r,transaction:t,spaceId:a,format:{page_small_text:!0}}),s=i.getContentStore(),l=Wa().Wv({environment:o,type:"text",inMemoryRecordCache:r,transaction:t,spaceId:a,properties:{title:n}});return Ar().BC({parentStore:s,appendStore:l,transaction:t}),i}}).performResult}));return l?(r.addCacheFallback(i),s.current=r,l):void 0}),[i,o,t,n]);return(0,a.useEffect)((()=>()=>{const e=s.current;e&&(e.removeCacheFallback(i),s.current=void 0)}),[i]),l}({threadStore:n,textValue:d}),u=(0,a.useCallback)((async()=>{const e=await Va().R.clipboardActions.load(),t=(null==c?void 0:c.getContentStores())??[];if(t.length>0){const n=t.map((e=>e.getBlockTitleStore())),a=n[0],r=n[n.length-1];if(a&&r){const e=(0,St().AhH)(r.getValue()||[]),n=(0,Tr().hn)({store:a,index:0},{store:r,index:e});(0,kr().setMultiSelection)({multiSelection:n}),oe().td({environment:i,stores:t,phase:Rr().SelectionPhase.Editing,pivot:t[0]})}else oe().td({environment:i,stores:t});await Ma().default.afterNextFlush();const o=l.current;return o&&i.device.isSafari?(Ja().setOnNode(o,i.device),e.triggerBrowserCopy(),Ja().clear(i)):e.triggerBrowserCopy(),void Na().D6({label:s.formatMessage(e.clipboardMessages.copiedToClipboard)})}await e.copyString({environment:i,stringValue:(0,Pt().r4)(d,n),copiedMessage:e.clipboardMessages.copiedToClipboard})}),[i,s,d,n,c]),g=(0,C().IS)((()=>({copyButton:{opacity:o?1:0,transition:"opacity 0.1s ease"}})),[o]);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)($().A,{placement:"top",delayThreshold:300,renderTooltip:()=>s.formatMessage({id:"aiInferenceTranscript.userStep.copyText",defaultMessage:"Copy text"}),render:e=>(0,v.jsx)(H().A,{...e,onClick:u,icon:Ea().a,colorVariant:"secondary",style:g.copyButton,iconStyle:{width:V().Ev.sm,height:V().Ev.sm},ariaLabel:s.formatMessage({id:"aiInferenceTranscript.userStep.copyTextAriaLabel",defaultMessage:"Copy text"})})}),(0,v.jsx)("span",{ref:l,style:{height:"1px",width:"1px",position:"absolute"}})]})}function Lr(e){const{onCancel:t,onSave:n,saveDisabled:a}=e,r=(0,P().tz)();return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(H().A,{onClick:t,icon:at().xMarkCircleFillIcon,colorVariant:"secondary",style:{borderRadius:"50%"},iconStyle:{width:V().Ev.default,height:V().Ev.default},ariaLabel:r.formatMessage({id:"aiInferenceTranscript.userStep.cancel",defaultMessage:"Cancel"})}),(0,v.jsx)(H().A,{onClick:n,icon:Mr().checkmarkCircleFillIcon,colorPalette:"blue",colorVariant:"accentPrimary",disabled:a,style:{borderRadius:"50%"},iconStyle:{width:V().Ev.default,height:V().Ev.default},ariaLabel:r.formatMessage({id:"aiInferenceTranscript.userStep.save",defaultMessage:"Save"})})]})}function Fr(e){const{isCurrentUser:t,isEditing:n,renderedText:r,mockTextStore:o,textRef:i,onSaveEdit:s,onEditClick:l,disableUserMessageEditing:d,isSearchConfig:c,isResearcherConfig:u,isMarkdownChatConfig:g,step:p,threadStore:h}=e,[m,f]=(0,a.useState)(!1),y=(0,C().IS)((()=>({messageRow:{display:"flex",alignItems:"start",paddingBottom:20,gap:8,width:"100%",justifyContent:t?"flex-end":"flex-start"},bubbleContainer:{maxWidth:"95%",display:"flex",...n?{width:"100%"}:{},gap:6},stagingAndInputWrap:{borderRadius:16,padding:c?"6px 14px":"2px 14px 32px 14px",paddingBottom:n?48:"6px",minHeight:32,minWidth:68},textContainer:c?{paddingTop:0,paddingBottom:0}:{}})),[t,c,n]),S=t&&!n&&!d,x=Boolean(We().A.isMobile);return(0,v.jsx)("div",{style:y.messageRow,onMouseEnter:()=>f(!0),onMouseOver:()=>f(!0),onMouseLeave:()=>f(!1),children:(0,v.jsxs)("div",{style:y.bubbleContainer,children:[t?(0,v.jsx)(Ur,{isRowHovered:m,isEditing:n,step:p,threadStore:h,onEditClick:S&&!x?l:void 0,canEdit:S&&!x}):void 0,(0,v.jsx)("div",{style:{flex:1},children:n?(0,v.jsx)(_r().k,{onSubmit:s,store:o,textRef:i,fontSize:c||u||g?16:void 0,stagingAndInputWrapStyle:y.stagingAndInputWrap,textContainerStyle:y.textContainer,testId:"agent-edit-message-input"}):(0,v.jsx)(Dr,{renderedText:r,onClick:S&&x?l:void 0,clickable:S&&x})}),t?void 0:(0,v.jsx)(Ur,{step:p,threadStore:h,isRowHovered:m,isEditing:n})]})})}function Ur(e){const{isRowHovered:t,isEditing:n,step:a,threadStore:r,onEditClick:o,canEdit:i}=e,s=(0,C().IS)((()=>({bubbleActionsContainer:{display:"flex",alignItems:"end",padding:"6px 0"}})),[]);return n?null:(0,v.jsxs)("div",{style:s.bubbleActionsContainer,children:[i?(0,v.jsx)(Or,{onClick:o,isVisible:t}):void 0,(0,v.jsx)(zr,{step:a,threadStore:r,isVisible:t})]})}function Vr(e){const{isEditing:t,onCancelEdit:n,onSaveEdit:a,mockTextStore:r}=e,i=0===(0,o().K8)((()=>r.getValue()||[]),[r]).length,s=(0,C().IS)((()=>({actionsRow:{position:"absolute",bottom:22,insetInlineEnd:8,display:t?"flex":"none",gap:2,alignItems:"center",zIndex:10}})),[t]);return t?(0,v.jsx)("div",{style:s.actionsRow,children:(0,v.jsx)(Lr,{onCancel:n,onSave:a,saveDisabled:i})}):null}function Or(e){const{onClick:t,isVisible:n}=e,a=(0,P().tz)(),r=(0,C().IS)((()=>({editButton:{opacity:n?1:0,transition:"opacity 0.1s ease"}})),[n]);return(0,v.jsx)($().A,{placement:"top",delayThreshold:300,renderTooltip:()=>a.formatMessage(Wr.editMessage),render:e=>(0,v.jsx)(H().A,{...e,onClick:t,icon:Je().pencilLineSmallIcon,colorVariant:"secondary",style:r.editButton,iconStyle:{width:V().Ev.sm,height:V().Ev.sm},ariaLabel:a.formatMessage(Wr.editMessage)})})}const Wr=(0,P().YK)({editMessage:{id:"aiInferenceTranscript.agentUserStep.editMessage",defaultMessage:"Edit message"}});const Nr=a.memo((function(e){var t,a;const{turn:r,spaceStore:s,threadStore:l,clientStore:d,showDebug:c,disableUserMessageEditing:u,aiChatFeatureController:g}=e,p=(0,o().K8)((()=>l.getSpaceId()||""),[l]),h=(0,C().IS)((()=>({userTurn:{...c&&{boxShadow:"calc(var(--direction, 1) * -4px) 0 0 0 rgba(0,0,255,0.3)"}},attachmentCarousel:{overflowX:"scroll",overscrollBehaviorX:"contain",scrollSnapType:"x proximity",scrollbarWidth:"none",gap:"inherit",gridColumn:"full",display:"grid",gridTemplateColumns:"inherit",alignItems:"self-start"}})),[c]);return(0,v.jsx)("div",{style:h.userTurn,children:(0,v.jsxs)(i().Y1,{direction:"vertical",gap:8,children:[r.configStep?(0,v.jsx)(M().uQ,{step:r.configStep,threadStore:l,clientStore:d},r.configStep.id):null,r.contextStep?(0,v.jsx)(M().uQ,{step:r.contextStep,threadStore:l,clientStore:d,children:(0,v.jsx)(n(65590).E,{step:r.contextStep,displayMode:"date"})},r.contextStep.id):null,r.userSpecifiedContextStep?(0,v.jsx)(M().uQ,{step:r.userSpecifiedContextStep,threadStore:l,clientStore:d,children:(0,v.jsx)(n(639162).H,{spaceStore:s,pointers:(null===(t=r.userSpecifiedContextStep.value)||void 0===t?void 0:t.pointers)??[]})},r.userSpecifiedContextStep.id):null,r.attachmentsStep&&r.attachmentsStep.length>0?(0,v.jsx)("div",{style:h.attachmentCarousel,children:(0,v.jsx)(i().Y1,{direction:"horizontal",align:"center-right",gap:{column:8,row:0},padding:"1px",children:null===(a=r.attachmentsStep)||void 0===a?void 0:a.map((e=>(0,v.jsx)(M().uQ,{step:e,threadStore:l,clientStore:d,children:(0,v.jsx)(i().Y1,{direction:"horizontal",align:"center-right",children:(0,v.jsx)(n(28070).kp,{uploadProgress:{status:"complete",fileUrl:e.fileUrl,fileName:e.fileName,contentType:e.contentType},permissionRecordOverride:{table:Fa().To,id:l.id,spaceId:p},showImagePreview:!0,aiChatFeatureController:g})})},e.id)))})}):null,r.userInitiatedStep?(0,v.jsx)(M().uQ,{step:r.userInitiatedStep,threadStore:l,clientStore:d,children:(0,v.jsx)(Er,{clientStore:d,threadStore:l,step:r.userInitiatedStep,disableUserMessageEditing:u})},r.userInitiatedStep.id):null]})})}));function Kr(e){const{transcript:t,spaceStore:n,threadStore:g,clientStore:p,configType:f,runningInference:y,showDebugOverride:S,aiChatFeatureController:b}=e,C=(0,r().v3)(),I=(0,o().K8)((()=>p.state.showDebug),[p])||Boolean(S),w=function(e,t=c().n4){const[n,r]=(0,a.useReducer)(((e,t)=>{const{input:n,isEqualFn:a}=t;let r=n.length!==e.length;const o=[];for(let i=0;i<n.length;i++){const t=n[i],s=e[i];a(t,s)?o.push(s):(o.push(t),r=!0)}return r?o:e}),e);return(0,a.useEffect)((()=>{r({input:e,isEqualFn:t})}),[e,t]),n}((0,a.useMemo)((()=>m({transcript:t,isRunningInference:y})),[t,y])),M=w.findLastIndex((e=>"user-turn"===e.type)),A=(0,o().K8)((()=>u().f.getState().statuses),[]);return(0,v.jsx)(x,{threadStore:g,clientStore:p,environment:C,children:(0,v.jsx)(d().wJ,{surfaceName:"ai_chat",children:(0,v.jsx)(l().A,{store:g,render:()=>(0,v.jsx)(i().Y1,{direction:"vertical",gap:I?12:0,children:w.map(((e,t)=>{switch(e.type){case"user-turn":{const a=w.slice(0,t).filter((e=>"agent-turn"===e.type)).length,r=A.slice(a).some((e=>"undo"===e)),o=t!==M||r;return(0,v.jsx)(Nr,{turn:e,spaceStore:n,threadStore:g,clientStore:p,runningInference:y,showDebug:I,disableUserMessageEditing:o,aiChatFeatureController:b},`user-turn-${t}`)}case"agent-turn":{const a=w.slice(0,t).filter(h).at(-1);return(0,v.jsx)(br,{turn:e,previousUserTurn:a,isLastTurn:t===w.length-1,configType:f,spaceStore:n,threadStore:g,clientStore:p,runningInference:y,showDebug:I,aiChatFeatureController:b},`agent-turn-${t}`)}default:(0,s().HB)(e)}}))})})})})}},514799:(e,t,n)=>{n.d(t,{H:()=>s});var a=()=>n(484714),r=()=>n(56366),o=()=>n(185078),i=()=>n(910302);function s(e){const{detectedLanguage:t,canSuggestInConfidence:n}=function(e){const{pageStore:t,enabled:n,forceUpdate:o=!1}=e,s=(0,a().v3)();return(0,r().K8)((()=>n&&t?i().bY({pageStore:t,environment:s,enabled:n,forceUpdate:o}):{detectedLanguage:void 0,canSuggestInConfidence:!1}),[t,s,n,o])}(e);return t&&!(0,o().cE)(t)?{detectedLanguage:void 0,canSuggestInConfidence:!1}:{detectedLanguage:t,canSuggestInConfidence:n}}},529324:(e,t,n)=>{n.d(t,{C:()=>a});const a=(0,n(340498).xh)("magnifyingGlass",{default:{loader:()=>n.e(1827).then(n.bind(n,901827))},small:{loader:()=>n.e(41805).then(n.bind(n,741805))},mini:{loader:()=>n.e(20283).then(n.bind(n,420283))},large:{loader:()=>n.e(61969).then(n.bind(n,861969))}})},551222:(e,t,n)=>{n.d(t,{q:()=>r});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 13.75 13.75",svg:(0,n(474848).jsx)("path",{d:"M13.125 4.25c0-.621.504-1.125 1.125-1.125h1.5c.621 0 1.125.504 1.125 1.125v11.5c0 .621-.504 1.125-1.125 1.125h-1.5a1.125 1.125 0 0 1-1.125-1.125zm1.25.125v11.25h1.25V4.375zm-6.25 6.375c0-.621.504-1.125 1.125-1.125h1.5c.621 0 1.125.504 1.125 1.125v5c0 .621-.504 1.125-1.125 1.125h-1.5a1.125 1.125 0 0 1-1.125-1.125zm1.25.125v4.75h1.25v-4.75zM4.25 5.625c-.621 0-1.125.504-1.125 1.125v9c0 .621.504 1.125 1.125 1.125h1.5c.621 0 1.125-.504 1.125-1.125v-9c0-.621-.504-1.125-1.125-1.125zm.125 10v-8.75h1.25v8.75z"})},r=(0,n(340498).wt)("chartBarXAxis",a)},577466:(e,t,n)=>{n.d(t,{B:()=>o});var a=()=>n(59226),r=()=>n(401497);function o(e){const t=(0,a().X)("more_rounded_block_container");return(0,r().IS)((e=>({wrapper:{background:e.background.secondary,borderRadius:t?10:5,padding:"8px 12px",userSelect:"none",pointerEvents:"auto",width:"100%"}})),[t])}},596048:(e,t,n)=>{n.r(t),n.d(t,{AgentThreadHistoryMenu:()=>U});n(944114),n(898992),n(354520),n(672577),n(803949),n(581454),n(908872);var a=n(296540),r=()=>n(59226),o=()=>n(484714),i=()=>n(56366),s=()=>n(401497),l=()=>n(252291),d=()=>n(98126),c=()=>n(340498),u=()=>n(234459),g=()=>n(69708),p=()=>n(939740),h=()=>n(89924),m=()=>n(722872),f=()=>n(765957),v=()=>n(796977);n(737550),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698);class y extends(()=>n(769985))().u{constructor(){super({getInitialState:()=>({completedThreads:new Set,userStartedThreads:new Set,threadInferenceIds:new Map,currentThreadId:void 0}),effect:()=>(this.startMonitoring(),()=>{this.stopMonitoring()}),debugName:"ThreadGeneratingIndicatorStore"}),this.monitoringInterval=null,this.transcripts=void 0}startMonitoring(){this.monitoringInterval||(this.checkForCompletions(),this.monitoringInterval=setInterval((()=>{this.checkForCompletions()}),1e3))}stopMonitoring(){this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null)}checkForCompletions(){n(17022).e.withListenerIgnored((()=>{const e=(0,n(702459).qM)();if(!e||!this.transcripts)return;const t=new Map,a=new Set(this.state.userStartedThreads);this.transcripts.forEach((n=>{const r=v().E.createChildStore(e,{table:u().To,id:n.id,spaceId:e.id}).getCurrentInferenceId();t.set(n.id,r);const o=this.state.threadInferenceIds.get(n.id);void 0!==r&&void 0===o&&a.add(n.id),void 0!==o&&void 0===r&&this.markThreadCompleted(n.id)})),this.setState({...this.state,threadInferenceIds:t,userStartedThreads:a})}))}setMonitoringData(e){this.transcripts=e,this.monitoringInterval&&this.checkForCompletions()}markThreadCompleted(e){if(this.state.userStartedThreads.has(e)&&e!==this.state.currentThreadId){const t=new Set(this.state.completedThreads);t.add(e),this.setState({...this.state,completedThreads:t})}}markThreadVisited(e){const t=new Set(this.state.completedThreads);t.delete(e),this.setState({...this.state,completedThreads:t})}setCurrentThreadId(e){const t=new Set(this.state.completedThreads);e&&t.delete(e),this.setState({...this.state,currentThreadId:e,completedThreads:t})}isThreadGenerating(e){return void 0!==this.state.threadInferenceIds.get(e)}hasThreadCompleted(e){return this.state.completedThreads.has(e)}getCompletedThreadIds(){return Array.from(this.state.completedThreads)}}const S=new y;(0,n(852832).exposeDebugValue)("threadGeneratingIndicatorStore",S);var x=()=>n(717895),b=()=>n(145214),C=n(474848);function I(){const e=(0,s().IS)((()=>({container:{display:"inline-flex",alignItems:"center"},dotIcon:{width:20,height:20}})),[]);return(0,C.jsx)(b().A,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},config:{duration:300,timingFunction:"ease-out"},style:e.container,children:(0,C.jsx)(l().I,{icon:x().K,colorVariant:"accentPrimary",colorPalette:"blue",style:e.dotIcon})})}var w=()=>n(925193),M=()=>n(427704),A=()=>n(363497),k=()=>n(577142),j=()=>n(150984),T=()=>n(156008),R=()=>n(571851),P=()=>n(44971),_=()=>n(295169),E=()=>n(170519);var D=()=>n(94701),B=()=>n(781317);function z(e){const{chatItem:t,isThreadGenerating:n,isCurrentThread:a,isNotCurrentThreadAndHasFinishedGenerating:o}=e,d=(0,s().IS)((()=>({checkIcon:{width:14,height:14},scrollingSquiggle:{width:14,height:12,opacity:"0.4",transform:"scale(1.5)"},dotIcon:{width:14,height:14,transform:"scale(2)"}})),[]),c=(0,r().X)("agent_conversation_list_generation_status");switch((0,i().K8)((()=>"thread"!==t.type?"none":a(t.id)?"isCurrentThread":c?n(t.id)?"threadGenerating":o(t.id)?"threadCompleted":"none":"none"),[t.id,t.type,n,a,o,c])){case"isCurrentThread":return(0,C.jsx)(l().I,{icon:D().checkmarkFillIcon,style:d.checkIcon});case"threadGenerating":return(0,C.jsx)(B().J,{style:d.scrollingSquiggle});case"threadCompleted":return(0,C.jsx)(l().I,{icon:x().K,colorVariant:"accentPrimary",colorPalette:"blue",style:d.dotIcon});default:return null}}const L=(0,g().YK)({new_chat_title:{id:"WorkflowEditorTranscript.historyDropdown.newChatTitle",defaultMessage:"New AI chat"},previousChats:{id:"AgentThreadHistoryMenu.previousChats",defaultMessage:"Previous chats"}});function F(e){const{buttonShape:t="roundrect",workflowId:y,onThreadChange:x,parentStore:b,threadStore:D,threadStoreState:B,types:F,aiChatFeatureController:U}=e,V=(0,g().tz)(),O=(0,o().v3)(),W=(0,o().Y0)(),N=(0,n(124749).$)(),K=(0,i().O$)(f().AppStoreSidebarSpaceStore),H=(0,r().X)("agent_conversation_list_generation_status"),$=(0,a.useMemo)((()=>{const e=1===(null==F?void 0:F.length)&&"workflow"===F[0],t=Boolean(y);return!e&&!t}),[F,y]),Y=(0,i().K8)((()=>{var e;if("new"===B)return V.formatMessage(L.new_chat_title);const t=null==D||null===(e=D.getData())||void 0===e?void 0:e.title;return t||V.formatMessage(L.new_chat_title)}),[V,D,B]),q="pill"===t,{status:G,value:X,isLoadingMore:Q,loadMore:Z,hasMore:J}=(0,n(918052).s)({parentStore:b,threadStore:D,workflowId:y,enableInfiniteScroll:!0,pageSize:50,userId:null==N?void 0:N.id,types:F}),ee=(0,i().K8)((()=>null!=D&&D.id?D.id:function(){const e=_().default.getActiveSession();return null==e?void 0:e.sessionId}()),[D]),te=function(e){const{transcripts:t,currentSessionId:n}=e;return(0,a.useEffect)((()=>{S.setMonitoringData(t)}),[t]),(0,a.useEffect)((()=>{S.setCurrentThreadId(n)}),[n]),{isThreadGenerating:(0,i().K8)((()=>e=>S.isThreadGenerating(e)),[]),isCurrentThread:(0,a.useCallback)((e=>n===e),[n]),hasThreadCompletedAndIsNotCurrent:(0,i().K8)((()=>e=>Boolean(n&&n!==e&&S.hasThreadCompleted(e))),[n]),areAnyThreadsCompletedAndNotCurrent:(0,i().K8)((()=>!!n&&S.getCompletedThreadIds().some((e=>e!==n))),[n])}}({transcripts:X,currentSessionId:ee}),ne=(0,s().IS)((e=>({chevronDownIcon:{width:Boolean(null==U?void 0:U.supportsTallChatHeader)?c().lD.sm:c().Ev.sm,height:Boolean(null==U?void 0:U.supportsTallChatHeader)?c().lD.sm:c().Ev.sm,marginInlineStart:te.areAnyThreadsCompletedAndNotCurrent?0:6,fill:e.icon.secondary,flexShrink:0},loadingStateContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",gap:8,padding:32},clockIcon:{width:24,opacity:.2},threadTitleButton:{flexShrink:1,...q?{borderRadius:50,paddingInline:8}:{paddingInline:6}},threadTitleInDropdown:{maxWidth:"250px",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",flexShrink:1}})),[q,null==U?void 0:U.supportsTallChatHeader,te.areAnyThreadsCompletedAndNotCurrent]);(0,n(370964).J)($);const ae=(0,i().K8)((()=>{return $?(e=K)?P().A.getSessionsForSpace(e.id).map((({id:t})=>E().g.createChildStore(e,{id:t,table:A().TF,spaceId:e.id}))):[]:[];var e}),[K,$]),[{value:re,status:oe}]=(0,n(187174).Yb)((async()=>K&&$?await async function(e){const{chatHistorySessionStores:t,intl:n,environment:a}=e,r=await(0,T().oT)({chatHistorySessionStores:t,intl:n,environment:a});return t.map((e=>({id:(0,w().pg)(e.id),title:e.getTitleOrFallback({intl:n}),description:r.get(e.id)??"",createdTime:e.getCreatedTime(),store:e,type:"assistant"})))}({chatHistorySessionStores:ae,intl:V,environment:O}):[]),[$,K,ae,V,O]),ie=n(631611).wy.fullPage,se=(0,a.useCallback)((()=>(0,C.jsx)("div",{style:ne.loadingStateContainer,children:(0,C.jsx)(d().A,{})})),[ne.loadingStateContainer]),le=(0,a.useCallback)((()=>(0,C.jsx)("div",{style:ne.loadingStateContainer,children:(0,n(274570).clockIcon)(ne.clockIcon)})),[ne.loadingStateContainer,ne.clockIcon]),de=(0,a.useCallback)((e=>{if("pending"===G||"pending"===oe)return[{key:"loading",render:e=>(0,C.jsx)(h().A,{...e,title:V.formatMessage(L.previousChats),shouldShowBottomDivider:!1,extraPadding:!0,topBorder:!1}),items:[{key:"loading-item",action:()=>{},render:()=>(0,C.jsx)(se,{})}]}];let t=[];if(X&&X.forEach((e=>{t.push({id:e.id,title:e.title||V.formatMessage(L.new_chat_title),createdTime:new Date(e.created_at).getTime(),type:"thread",threadType:e.type})})),re&&$&&re.forEach((e=>{t.push({id:e.id,title:e.title,description:e.description,createdTime:e.createdTime,type:"assistant"})})),$||(t=t.filter((e=>"thread"===e.type))),t.sort(((e,t)=>t.createdTime-e.createdTime)),0===t.length)return[{key:"empty",render:e=>(0,C.jsx)(h().A,{...e,title:V.formatMessage(L.previousChats),extraPadding:!0,topBorder:!1}),items:[{key:"empty-item",action:()=>{},render:()=>(0,C.jsx)(le,{})}]}];const a=[];let r=!0;const o=t.reduce(((e,t)=>{const n=new Date(t.createdTime),a=new Date;a.setHours(0,0,0,0);const r=new Date(a);r.setDate(r.getDate()-1);const o=new Date(a);o.setDate(o.getDate()-7);const i=new Date(a);let s;return i.setDate(i.getDate()-30),s=n>=a?"today":n>=r?"yesterday":n>=o?"previous7days":n>=i?"previous30days":"older",e[s]||(e[s]=[]),e[s].push(t),e}),{});return[{key:"today",label:V.formatMessage({id:"aiInferenceTranscript.today",defaultMessage:"Today"})},{key:"yesterday",label:V.formatMessage({id:"aiInferenceTranscript.yesterday",defaultMessage:"Yesterday"})},{key:"previous7days",label:V.formatMessage({id:"aiInferenceTranscript.previous7days",defaultMessage:"Previous 7 days"})},{key:"previous30days",label:V.formatMessage({id:"aiInferenceTranscript.previous30days",defaultMessage:"Previous 30 days"})},{key:"older",label:V.formatMessage({id:"aiInferenceTranscript.older",defaultMessage:"Older"})}].forEach((({key:t,label:i})=>{const s=o[t];if(null==s||!s.length)return;const l=!r;r=!1,a.push({key:`history-${t}`,render:e=>(0,C.jsx)(h().A,{...e,title:i,topBorder:l,extraPadding:!0}),items:s.map((t=>({key:t.id,action:()=>{const a=f().default.state.sidebarSpaceStore;if(a)if("thread"===t.type){S.markThreadVisited(t.id);const r=v().E.createChildStore(a,{table:u().To,id:t.id,spaceId:a.id});"workflow"===t.threadType||(0,n(720665).pN)(t.threadType)||W.isPhone?(x(r),e.close()):(0,n(36951).VK)({environment:O,oldThreadStore:void 0,newThreadStore:r})}else{const n=null==re?void 0:re.find((e=>e.id===t.id));n&&(!function(e){const{environment:t,chatStore:n,assistantSurface:a}=e;(0,j().performSecondarySidebarAction)({environment:t,action:()=>{(0,T().bl)({environment:t,chatStore:n,onRestoreChatSession:()=>{R().assistantMenuStore.setState({...R().assistantMenuStore.state,currentView:"chat",open:!0}),(0,k().navigate)({environment:t,url:M().JZ.chat})},assistantSurface:a})}})}({environment:O,chatStore:n.store,assistantSurface:ie}),e.close())}},render:e=>{const a="string"==typeof t.title?t.title:V.formatMessage(L.new_chat_title);return(0,C.jsx)(n(760217).A,{...e,title:a,right:(0,C.jsx)(z,{chatItem:t,isThreadGenerating:te.isThreadGenerating,isCurrentThread:te.isCurrentThread,isNotCurrentThreadAndHasFinishedGenerating:te.hasThreadCompletedAndIsNotCurrent})})}})))})})),a}),[G,oe,X,re,se,le,x,V,O,ie,$,W.isPhone,te]),ce=(0,a.useCallback)((()=>{Z&&J&&!Q&&Z()}),[Z,J,Q]),ue=(0,a.useCallback)((()=>{n(778417).IU({environment:O})}),[O]);return Y?(0,C.jsx)(n(406699).A,{popupType:(null==U?void 0:U.adaptiveMenuPopupType)??n(30537).n.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",bottomSheetDisableDrag:!1,renderOrigin:e=>(0,C.jsxs)(n(631524).p,{"aria-label":"history",...e,onClick:t=>{var n;ue(),null===(n=e.onClick)||void 0===n||n.call(e,t)},size:"md",style:ne.threadTitleButton,children:[(0,C.jsx)(n(493552).D,{styleKey:"Body/Regular",style:ne.threadTitleInDropdown,children:Y}),H&&te.areAnyThreadsCompletedAndNotCurrent?(0,C.jsx)(I,{}):void 0,(0,C.jsx)(l().I,{icon:n(324254).arrowChevronSingleDownSmallIcon,style:ne.chevronDownIcon,size:"sm"})]}),render:e=>(0,C.jsxs)(n(404277).A,{menuType:(null==U?void 0:U.adaptiveMenuType)??m().gu.Popup,hideMobileTopbar:!0,width:(null==U?void 0:U.adaptiveMenuType)===m().gu.Modal?void 0:300,children:[(0,C.jsx)(p().Ay,{type:p().Oh.Vertical,initialFocus:void 0,sections:de(e)}),Q?(0,C.jsx)("div",{style:ne.loadingStateContainer,children:(0,C.jsx)(d().k,{size:"default"})}):void 0,(0,C.jsx)(n(958846).A,{onLoadMore:ce,loading:Boolean(Q),loadMoreOffsetThreshold:100})]})}):null}const U=(0,a.memo)(F,((e,t)=>e.workflowId===t.workflowId&&e.parentStore===t.parentStore&&e.threadStore===t.threadStore&&e.threadStoreState===t.threadStoreState&&e.buttonShape===t.buttonShape&&JSON.stringify(e.types)===JSON.stringify(t.types)))},607567:(e,t,n)=>{n.d(t,{Z:()=>o});n(296540);var a=n(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.12 16.74 14.99",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M4.5 4.125A2.125 2.125 0 0 0 2.375 6.25v7.5c0 1.174.951 2.125 2.125 2.125h5.702a4.7 4.7 0 0 1-.2-1.25H4.5a.875.875 0 0 1-.875-.875V7.5h12.75v2.535a4.7 4.7 0 0 1 1.25.684V6.25A2.125 2.125 0 0 0 15.5 4.125zm.758 1.684a.625.625 0 1 1-1.25 0 .625.625 0 0 1 1.25 0m1.375-.625a.625.625 0 1 1 0 1.25.625.625 0 0 1 0-1.25m2.625.625a.625.625 0 1 1-1.25 0 .625.625 0 0 1 1.25 0"}),(0,a.jsx)("path",{d:"M17.7 16.607a3.625 3.625 0 1 0-.893.878l1.223 1.427a.625.625 0 0 0 .94-.823zM12.375 14.5a2.375 2.375 0 1 1 4.75 0 2.375 2.375 0 0 1-4.75 0"})]})},o=(0,n(340498).wt)("browserMagnifyingGlass",r)},650843:(e,t,n)=>{n.r(t),n.d(t,{LargeSurfaceRenderError:()=>s});n(296540);var a=()=>n(167355),r=()=>n(840071),o=()=>n(113414),i=n(474848);function s(e){return(0,i.jsx)(r().L,{...e,iconGroup:a().F,children:(0,i.jsx)(o().g,{})})}},670371:(e,t,n)=>{n.r(t),n.d(t,{eyeSmallIcon:()=>o,iconDefinition:()=>r});n(296540);var a=n(474848);const r={viewBox:"0 0 16 16",fittedViewBox:"0.7 3.26 14.6 9.48",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M8 5.372a2.626 2.626 0 0 1 2.625 2.626l-.014.269A2.626 2.626 0 0 1 8 10.624l-.269-.014A2.626 2.626 0 0 1 5.39 8.267l-.014-.269A2.626 2.626 0 0 1 8 5.372m0 1.75a.875.875 0 1 0 0 1.75.875.875 0 0 0 0-1.75"}),(0,a.jsx)("path",{d:"M8 3.26c3.125 0 5.857 1.673 7.152 4.141l.065.144c.11.293.11.617 0 .91l-.065.145c-1.295 2.468-4.027 4.14-7.152 4.14-3.027 0-5.685-1.57-7.026-3.912L.848 8.6a1.29 1.29 0 0 1 0-1.199l.126-.228C2.314 4.83 4.972 3.26 8 3.26m0 1.252c-2.6 0-4.833 1.345-5.941 3.281l-.104.19a.04.04 0 0 0 0 .036l.104.189c1.108 1.935 3.34 3.281 5.941 3.281 2.684 0 4.976-1.434 6.045-3.47L14.05 8l-.005-.018c-1.069-2.036-3.36-3.47-6.045-3.47"})]})},o=(0,n(340498).wt)("eyeSmall",r)},680209:(e,t,n)=>{n.d(t,{R:()=>o});n(296540);var a=n(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"1 0.12 17.94 19.75",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M7.733.203a.626.626 0 0 1 .87.286l2.567 5.583 1.41.777 1.722-2.257a.55.55 0 0 1 .874.668l-1.624 2.125 3.87 2.135c.198.11.322.32.322.547v5.648a.63.63 0 0 1-.323.547l-6.408 3.535a.63.63 0 0 1-.604 0l-6.407-3.535a.63.63 0 0 1-.323-.547V10.58L1.054 4.534a.625.625 0 0 1 .271-.795zM4.929 15.346l5.232 2.887v-4.307L4.93 11.04zm6.332-1.42v4.307l5.233-2.887v-4.307zM5.519 10.11l5.192 2.864 5.192-2.864-3.117-1.72-1.75 2.295a.55.55 0 0 1-.875-.668l1.652-2.164-1.102-.608zM2.426 4.557l2.042 4.705 5.419-2.99-2.14-4.65zm14.706.177 1.364.314a.55.55 0 1 1-.248 1.071l-1.364-.314a.55.55 0 0 1 .248-1.071"}),(0,a.jsx)("path",{d:"M12.873 1.548a.55.55 0 0 1 .753.192l.684 1.15a.55.55 0 0 1-.946.561l-.683-1.149a.55.55 0 0 1 .192-.754m3.802-.041a.55.55 0 0 1 .889.649l-.871 1.193a.55.55 0 0 1-.89-.649z"})]})},o=(0,n(340498).wt)("boxOpenSparkle",r)},687681:(e,t,n)=>{n.d(t,{u:()=>a});const a=(0,n(340498).xh)("pencilLine",{default:{loader:()=>n.e(92668).then(n.bind(n,105819))},small:{loader:()=>n.e(92668).then(n.bind(n,523389))},fill:{loader:()=>n.e(92668).then(n.bind(n,71287))},fillSmall:{loader:()=>n.e(92668).then(n.bind(n,396654))}},["compose","edit","write","create"])},704338:(e,t,n)=>{n.d(t,{q:()=>o});var a=()=>n(645873);const r=new(a().O2)("WorkflowSetupInstructions",(async()=>await Promise.all([n.e(75134),n.e(9773),n.e(36556),n.e(40537),n.e(55373),n.e(36192),n.e(71562),n.e(96346),n.e(44711),n.e(53321),n.e(90825),n.e(16471),n.e(37353),n.e(29151),n.e(87248),n.e(67539),n.e(87249),n.e(71621),n.e(88924),n.e(92845),n.e(56369),n.e(5834),n.e(48486),n.e(2411),n.e(89296),n.e(46414),n.e(9294),n.e(11676),n.e(91256),n.e(40563),n.e(67494),n.e(44584),n.e(53141),n.e(4422),n.e(4330),n.e(55162),n.e(71003),n.e(55753),n.e(28866),n.e(22001),n.e(71386),n.e(4351),n.e(6331),n.e(69144),n.e(42660),n.e(55997),n.e(40828),n.e(12341),n.e(96402),n.e(84166),n.e(70359),n.e(29595),n.e(16448),n.e(10442),n.e(16434),n.e(45769),n.e(46080),n.e(75902),n.e(99809),n.e(58636),n.e(78405),n.e(33675),n.e(47160),n.e(34442),n.e(31276),n.e(35738),n.e(91347),n.e(97132)]).then(n.bind(n,543130)))),o=(0,a()._h)(r,(e=>e.WorkflowSetupInstructions))},717895:(e,t,n)=>{n.d(t,{K:()=>r});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"7 7 6 6",svg:(0,n(474848).jsx)("path",{d:"M10 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6"})},r=(0,n(340498).wt)("dotFill",a)},750559:(e,t,n)=>{n.d(t,{f:()=>r});n(296540);var a=n(474848);const r=(0,n(340498).wt)("genericError",{viewBox:"0 0 32 32",svg:(0,a.jsx)("path",{d:"M16.0242 29.0485c7.1251 0 13.0243-5.8992 13.0243-13.0243C29.0485 8.91198 23.1365 3 16.0115 3 8.89922 3 3 8.91198 3 16.0242c0 7.1251 5.91198 13.0243 13.0242 13.0243zm-.0127-11.1089c-.6768 0-1.0471-.3959-1.0726-1.0726l-.1788-6.3078c-.0255-.70232.5108-1.20031 1.2386-1.20031.7151 0 1.2769.51076 1.2514 1.21301l-.1916 6.2951c-.0255.6895-.3958 1.0726-1.047 1.0726zm0 4.6989c-.7406 0-1.4301-.5874-1.4301-1.379 0-.7917.6767-1.3791 1.4301-1.3791.7533 0 1.4301.5746 1.4301 1.3791 0 .8044-.6895 1.379-1.4301 1.379z"})})},817343:(e,t,n)=>{n.d(t,{gc:()=>g,Nq:()=>p,zc:()=>u});n(296540);var a=n(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.12 15.25 11.75",directional:!0,svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M11.93 9.125a.5.5 0 0 0-.5.5v3.75a.5.5 0 0 0 .5.5h3.145a.5.5 0 0 0 .5-.5v-3.75a.5.5 0 0 0-.5-.5z"}),(0,a.jsx)("path",{d:"M4.5 4.125A2.125 2.125 0 0 0 2.375 6.25v7.5c0 1.174.951 2.125 2.125 2.125h11a2.125 2.125 0 0 0 2.125-2.125v-7.5A2.125 2.125 0 0 0 15.5 4.125zM3.625 6.25c0-.483.392-.875.875-.875h11c.483 0 .875.392.875.875v7.5a.875.875 0 0 1-.875.875h-11a.875.875 0 0 1-.875-.875z"})]})},o=(0,n(340498).wt)("peekCorner",r);var i=()=>n(177256),s=()=>n(69708),l=()=>n(972435);const d=(0,s().YK)({sidebar:{defaultMessage:"Sidebar",id:"chatSidebar.mode.sidebar"},popup:{defaultMessage:"Floating",id:"chatSidebar.mode.popup"},full:{defaultMessage:"Full",id:"chatSidebar.mode.full"}}),c=(0,s().YK)({sidebar:{defaultMessage:"Chat appears as a sidebar on the right",id:"chatSidebar.mode.description.sidebar"},popup:{defaultMessage:"Chat appears as a floating popup",id:"chatSidebar.mode.description.popup"},full:{defaultMessage:"Full",id:"chatSidebar.mode.full"}});function u(e){switch(e){case"sidebar":return l().A.formatMessage(d.sidebar);case"popup":return l().A.formatMessage(d.popup);case"full":return l().A.formatMessage(d.full)}}function g(e){switch(e){case"sidebar":return l().A.formatMessage(c.sidebar);case"popup":return l().A.formatMessage(c.popup);case"full":return l().A.formatMessage(c.full)}}function p(e){switch(e){case"sidebar":return i().A;case"popup":case"full":return o}}},837980:(e,t,n)=>{n.d(t,{D:()=>f});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(803949),n(581454),n(737550);var a=n(296540),r=()=>n(56366),o=()=>n(401497),i=()=>n(68263),s=()=>n(798880),l=()=>n(69708),d=()=>n(187820),c=()=>n(859428),u=()=>n(994006),g=()=>n(453697),p=()=>n(625247),h=()=>n(870092),m=n(474848);function f(e){const{spaceStore:t,workflowStore:n,environment:f}=e,v=(0,r().K8)((()=>{var e;if(!n.isDefined())return!1;const t=n.getPermissionItems();return 1===t.length&&"user_permission"===t[0].type&&(null===(e=f.currentUser)||void 0===e?void 0:e.id)===t[0].user_id}),[n,f]),y=(0,r().K8)((()=>{if(!n.isDefined())return!1;return n.getPermissionItems().some((e=>"space_permission"===e.type&&(0,i().lg)(e.role)))}),[n]),S=(0,r().K8)((()=>{if(t)return t.getName()}),[t]),x=(0,r().K8)((()=>{if(t)return(0,p().c)(f,t)}),[t,f]),b=(0,r().K8)((()=>{if(!t||!n.isDefined())return[];const e=n.getPermissionItems(),a=new Set;return e.forEach((e=>{"user_permission"===e.type&&e.user_id&&(0,i().lg)(e.role)&&a.add(e.user_id)})),Array.from(a).map((e=>h().L.createChildStore(t,{table:s().oo,id:e,spaceId:t.id})))}),[t,n]),C=(0,a.useMemo)((()=>b.slice(0,3)),[b]),I=(0,o().IS)((e=>({container:{display:"flex",gap:6,flexDirection:"row",alignItems:"center",color:e.text.secondary,minHeight:20,paddingInline:12},avatarsContainer:{marginInlineStart:8,display:"flex",flexDirection:"row-reverse"},avatarWrapper:{marginInlineStart:-8},avatarDropdownWrapper:{display:"flex",alignContent:"flex-end",minWidth:140,width:"100%",marginTop:4,marginBottom:4},label:{fontSize:12},workspaceIconContainer:{display:"flex",alignItems:"center",marginInlineEnd:2}})),[]);return v?null:y&&S?(0,m.jsxs)("div",{style:I.container,children:[x?(0,m.jsx)("div",{style:I.workspaceIconContainer,children:(0,m.jsx)(d().B6,{icon:x,size:18,disabled:!0,isEmptyPage:!1})}):void 0,(0,m.jsx)("div",{style:I.label,children:(0,m.jsx)(l().sA,{id:"AgentPage.everyoneAtWorkspaceCanViewChats",defaultMessage:"Everyone at {workspace} can view chats",values:{workspace:S}})})]}):(0,m.jsxs)("div",{style:I.container,children:[(0,m.jsx)(c().A,{placement:"bottom",renderTooltip:()=>b.map((e=>(0,m.jsx)("div",{style:I.avatarDropdownWrapper,children:(0,m.jsx)(u().A,{userStore:e,avatarSize:18,style:{flexGrow:1}})},`${e.id}--tooltip`))),render:e=>(0,m.jsx)("div",{style:I.avatarsContainer,...e,children:C.map((e=>(0,m.jsx)("div",{style:I.avatarWrapper,children:(0,m.jsx)(g().A,{userStore:e,size:18})},e.id)))})}),(0,m.jsx)("div",{style:I.label,children:(0,m.jsx)(l().sA,{id:"AgentPage.adminsCanViewChats",defaultMessage:"Admins can view chats"})})]})}},840071:(e,t,n)=>{n.d(t,{L:()=>s});n(296540);var a=()=>n(699143),r=()=>n(577466),o=()=>n(434663),i=n(474848);function s({backgroundColor:e,children:t,...n}){const s=(0,r().B)(e),l={wrapper:{...s.wrapper,background:e?s.wrapper.background:"initial",height:"100%",padding:"20px 12px"}};return(0,i.jsx)(a().Y1,{style:l.wrapper,align:"center",children:(0,i.jsx)(o().r,{...n,direction:"vertical",overrideSize:()=>48,children:t})})}},868859:(e,t,n)=>{n.d(t,{Ay:()=>f,Mr:()=>h,TN:()=>m});var a=n(296540),r=()=>n(401497),o=()=>n(751735),i=()=>n(534177),s=()=>n(338931),l=()=>n(569243),d=()=>n(408580),c=n(474848);const u=4,g=10;function p({event:e,squashedEventIndex:t,titleStartY:a,titleEndY:r}){const o=(0,n(56366).K8)((()=>{if("emptyTodayEventPlaceholder"===e)return;const t=n(379560).A.getCalendar(e);return null==t?void 0:t.color}),[e],{useDeepEqual:!0}),i=h({event:e,eventIndex:t,calendarColor:o,titleStartY:a,titleEndY:r});return i?(0,c.jsx)("div",{style:i}):null}function h(e){const{event:t,eventIndex:n,calendarColor:a,titleStartY:o,titleEndY:i}=e,s=(0,r().IS)((e=>{const r={background:e.gray.background.accentSecondary},s="emptyTodayEventPlaceholder"===t?r:function({event:e,eventIndex:t,color:n,titleStartY:a,titleEndY:r}){const o=m({event:e,color:n});if(!e.isAllDay)return o;const i=`radial-gradient(\n\t\tcircle ${g}px at ${-(d().Hj-1.5)}px ${g/2}px,\n\t\ttransparent ${(g+1)/2}px,\n\t\tpurple 0\n\t)`;return{borderRadius:"50%",marginTop:(r-a-g)/2,alignSelf:"flex-Start",marginInlineStart:(u-g)/2,marginInlineEnd:(u-g)/2,width:g,height:g,background:n,...0!==t&&{WebkitMaskImage:i,maskImage:i},...o}}({event:t,eventIndex:n,color:(0,l().Sk)({theme:e,calendarColor:a,eventColor:t.color}),titleStartY:o,titleEndY:i});return{container:{width:u,borderRadius:3,...s}}}),[a,t,n,i,o]);if(a||"emptyTodayEventPlaceholder"===t)return s.container}function m({event:e,color:t}){const n=(0,o().X4)(t,e.isAllDay?.2:.1),a=`\n\t\trepeating-linear-gradient(\n\t\t\t-45deg,\n\t\t\t${t},\n\t\t\t${t} 2px,\n\t\t\t${n} 2px,\n\t\t\t${n} ${e.isAllDay?3.5:4}px\n\t\t)`;if("outOfOffice"===e.eventType)return{background:n};switch(e.responseStatus){case"accepted":return{background:(0,s().vZ)(e)?a:t};case"tentative":return{background:a};case"needsAction":return{border:`1px dashed ${t}`,background:n};case"declined":return{background:n};case void 0:return{background:e.hasParticipants?n:t};default:(0,i().HB)(e.responseStatus)}}const f=a.memo(p)},911259:(e,t,n)=>{n.r(t),n.d(t,{arrowInCircleUpIcon:()=>o,iconDefinition:()=>r});n(296540);var a=n(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.26 15.25",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M13.042 9.554a.625.625 0 0 1-.884 0l-1.533-1.533v5.466a.625.625 0 1 1-1.25 0V8.021L7.842 9.554a.625.625 0 0 1-.884-.883l2.6-2.6a.625.625 0 0 1 .884 0l2.6 2.6a.625.625 0 0 1 0 .883"}),(0,a.jsx)("path",{d:"M17.625 10a7.625 7.625 0 1 1-15.25 0 7.625 7.625 0 0 1 15.25 0M10 16.375a6.375 6.375 0 1 0 0-12.75 6.375 6.375 0 0 0 0 12.75"})]})},o=(0,n(340498).wt)("arrowInCircleUp",r)},997274:(e,t,n)=>{n.d(t,{vo:()=>r,xv:()=>a});n(898992),n(354520),n(581454);function a(e,t=140){if(e.length<=t)return e;const n=e.substring(0,t).trim(),a=n.split(" ");return a.length>1&&" "!==n.charAt(n.length-1)?(a.pop(),`${a.map((e=>e.trim())).join(" ")}...`):`${n.substring(0,t-3)}...`}function r(e){return/[\"\']/.test(e)}}}]);