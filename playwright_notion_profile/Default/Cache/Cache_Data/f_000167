"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[28058],{92423:(t,e,o)=>{o.d(e,{l:()=>h});o(898992),o(803949);var n=o(296540),r=()=>o(484714),i=()=>o(56366),a=()=>o(401497),l=()=>o(30537),s=o(474848);const c=(0,o(340498).wt)("filter",{viewBox:"0 0 16 16",svg:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 4C2 3.58579 2.33579 3.25 2.75 3.25H13.25C13.6642 3.25 14 3.58579 14 4C14 4.41421 13.6642 4.75 13.25 4.75H2.75C2.33579 4.75 2 4.41421 2 4Z"}),(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.75 8C3.75 7.58579 4.08579 7.25 4.5 7.25H11.5C11.9142 7.25 12.25 7.58579 12.25 8C12.25 8.41421 11.9142 8.75 11.5 8.75H4.5C4.08579 8.75 3.75 8.41421 3.75 8Z"}),(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.5 12C5.5 11.5858 5.83579 11.25 6.25 11.25H9.75C10.1642 11.25 10.5 11.5858 10.5 12C10.5 12.4142 10.1642 12.75 9.75 12.75H6.25C5.83579 12.75 5.5 12.4142 5.5 12Z"})]})});var u=()=>o(69708),d=()=>o(284371),p=()=>o(436696),m=()=>o(712257),S=()=>o(59400),g=()=>o(147503),f=()=>o(527438),v=()=>o(417392),x=()=>o(942125),y=()=>o(253579),C=()=>o(56394);function h({collectionContextStore:t,collectionSettingsStore:e}){const o=(0,r().v3)(),[a,c]=(0,i().K8)((()=>[e.state.open,t.currentCombinatorFilterStore.state]),[t,e]),u=(0,n.useCallback)((()=>(0,s.jsx)(S().m$,{context:f().Bd.FilterBar,collectionContextStore:t,collectionSettingsStore:e,hideDesktopHeader:!0})),[t,e]),d=(0,n.useCallback)((n=>{var r;n&&(0,y().Rp)(n.target)||(g().os({collectionSettingsStore:e}),c&&0===(null===(r=c.filters)||void 0===r?void 0:r.length)&&m().IU({environment:o,collectionContextStore:t,temporaryState:{...t.temporaryStateStore.state,combinatorFilter:{value:void 0}}}))}),[t,e,o,c]);return(0,n.useEffect)((()=>()=>g().os({collectionSettingsStore:e})),[]),(0,s.jsx)(v().Ay,{popupType:o.device.isMobile?l().n.SlideUp:l().n.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",open:a,origin:(0,s.jsx)(b,{collectionContextStore:t,collectionSettingsStore:e}),onDismiss:d,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:u})}function b({collectionContextStore:t,collectionSettingsStore:e}){var o;const l=(0,r().v3)(),m=(0,a().IS)((t=>({icon:{width:void 0,height:l.device.isMobile?14:12,fill:t.blue.icon.accentPrimary,marginInlineEnd:6},title:{maxWidth:180,...d().RC}})),[l.device]),[S,f]=(0,i().K8)((()=>[Boolean((0,x().Ml)(t,"normalized").combinatorFilter),t.currentCombinatorFilterStore.state]),[t]),v=(0,n.useCallback)((()=>{if(!f)return;t.currentPropertyFiltersStore.state.forEach((e=>{const o=t.getFilterOptionsItemSettingsStore(e);g().os({collectionSettingsStore:o})})),g().R8({collectionSettingsStore:e,item:{type:"filter"}}),(0,p().X)({environment:l,collectionContextStore:t,action:"click_combinator_filter"})}),[t,e,l,f]);return f?(0,s.jsx)(C().A,{icon:c(m.icon),title:(0,s.jsx)("span",{style:m.title,children:(0,s.jsx)(u().sA,{defaultMessage:"{ruleCount, plural, one {{ruleCount} rule} other {{ruleCount} rules}}",id:"database.filterBar.advancedFilterRulesCount.title",values:{ruleCount:(null===(o=f.filters)||void 0===o?void 0:o.length)||0}})}),on:!0,hasDiff:S,onClick:v},"combinator"):null}},166292:(t,e,o)=>{o.d(e,{S:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"2.96 1.99 14.08 15.13",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M6.75 2.545a.55.55 0 0 1 .55-.55h5.4a.55.55 0 0 1 0 1.1H7.3a.55.55 0 0 1-.55-.55m-1.25 1.7a.55.55 0 1 0 0 1.1h9a.55.55 0 0 0 0-1.1zm7.036 5.847a.625.625 0 1 0-1.072-.643l-1.953 3.256-1.036-1.208a.625.625 0 1 0-.95.813l1.6 1.867a.625.625 0 0 0 1.011-.085z"}),(0,n.jsx)("path",{d:"M5.088 6.42a2.125 2.125 0 0 0-2.125 2.125v6.45c0 1.174.951 2.125 2.125 2.125h9.825a2.125 2.125 0 0 0 2.125-2.125v-6.45a2.125 2.125 0 0 0-2.125-2.125zm-.875 2.125c0-.483.392-.875.875-.875h9.825c.483 0 .875.392.875.875v6.45a.875.875 0 0 1-.875.875H5.088a.875.875 0 0 1-.875-.875z"})]})},i=(0,o(340498).wt)("checkStack",r)},392459:(t,e,o)=>{o.d(e,{N9:()=>$,aV:()=>q,he:()=>X});o(898992),o(354520),o(672577),o(803949),o(581454);var n=o(296540),r=()=>o(484714),i=()=>o(118884),a=()=>o(56366),l=()=>o(401497),s=()=>o(611648),c=()=>o(150669),u=()=>o(631524),d=()=>o(199734),p=()=>o(863330),m=()=>o(69708),S=()=>o(496603),g=()=>o(436696),f=()=>o(778417),v=()=>o(749804),x=()=>o(712257),y=()=>o(59400),C=()=>o(147503),h=()=>o(527438),b=()=>o(145214),k=()=>o(439264),j=()=>o(417392),_=()=>o(2143),A=()=>o(59822),w=()=>o(942125),I=()=>o(253579),M=()=>o(658199),T=()=>o(876077),B=()=>o(463830),F=()=>o(404779),R=()=>o(177618),V=()=>o(427537),P=()=>o(92423),D=()=>o(602141),O=()=>o(252291),z=()=>o(30537),K=()=>o(886358),L=()=>o(107023),N=()=>o(513402),U=()=>o(284371),H=()=>o(56394),E=o(474848);function W({collectionContextStore:t,collectionSettingsStore:e}){const{device:o}=(0,r().v3)(),i=(0,a().K8)((()=>e.state.open),[e]),l=(0,n.useCallback)((t=>{t&&(0,I().Rp)(t.target)||C().os({collectionSettingsStore:e})}),[e]),s=(0,n.useCallback)((()=>(0,E.jsx)(y().m$,{context:h().Bd.FilterBar,collectionContextStore:t,collectionSettingsStore:e,hideDesktopHeader:!0})),[t,e]);return(0,n.useEffect)((()=>()=>C().os({collectionSettingsStore:e})),[]),(0,E.jsx)(j().Ay,{popupType:o.isMobile?z().n.SlideUp:z().n.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",open:i,origin:(0,E.jsx)(J,{collectionContextStore:t,collectionSettingsStore:e}),onDismiss:l,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:s})}function J({collectionContextStore:t,collectionSettingsStore:e}){const o=(0,r().v3)(),[i,s,c,u]=(0,a().K8)((()=>[t.currentSortsStore.state,(0,w().Ml)(t,"normalized"),t.normalizedSchemaStore.state,t.permissionScopesStore.state]),[t]),d=(0,a().K8)((()=>(0,V().b)(t)),[t]),p=u.canConfigureBlock||d,S=i[0],f=S?c[S.property]:void 0,v=(0,n.useCallback)((()=>{(0,g().X)({environment:o,collectionContextStore:t,action:"click_sort"}),C().R8({collectionSettingsStore:e,item:{type:"sort"}})}),[t,e,o]),x=(0,l().IS)((()=>({title:{marginTop:-1,maxWidth:220,...U().RC}})),[]);let y;return y=1===i.length?S&&"descending"===S.direction?K().arrowStraightDownFillSmallIcon:L().arrowStraightUpFillSmallIcon:N().arrowUpDownSmallIcon,(0,E.jsx)(H().A,{on:!0,hasDiff:Boolean(p&&s.sorts),icon:(0,E.jsx)(O().I,{icon:y,size:1===i.length?"xs":"sm",colorPalette:"blue",colorVariant:"accentPrimary",style:{marginInlineEnd:4}}),title:(0,E.jsx)("span",{style:x.title,children:1===i.length&&f?f.name:(0,E.jsx)(m().sA,{defaultMessage:"{sortCount} sorts",id:"database.filterBar.sorts.label",values:{sortCount:i.length}})}),onClick:v})}let q=function(t){return t[t.FilterBar=0]="FilterBar",t[t.SettingsFilters=1]="SettingsFilters",t}({});const G=o(757695).Store.createClass({open:!1,stack:[]},{name:"CreateFilterSettingsStore"});function $({collectionContextStore:t,showHoverActionsStore:e,createFilterSettingsStore:o,saveControlMoreActionsButtonPopupStore:u}){var d;const p=(0,r().WS)(),m=(0,a().uB)(u,B().A),S=(0,a().uB)(o,G),g=(0,a().K8)((()=>(0,w().y_)(t)),[t]),f=(0,a().K8)((()=>{const e=t.filterBarFlashTriggerStore.state;return(0,T().t)(e)}),[t.filterBarFlashTriggerStore]);(0,i().X)((()=>{t.filterBarFlashTriggerStore.setState(0)}));const v=(0,a().O$)(t.currentPropertyFiltersStore),x=(0,a().K8)((()=>t.currentSortsStore.state.length),[t.currentSortsStore]),y=(0,a().K8)((()=>t.filterBarSortSettingsStore.state.open),[t]),C="map"!==(0,a().K8)((()=>{var e;return null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()}),[t])&&(x>0||y),h=(0,a().O$)(t.isUnlistedViewStore),b=(0,a().K8)((()=>(0,V().H)(t)?t.currentCombinatorFilterStore.state:void 0),[t]),k=(0,a().uB)(void 0,c().A),j=null===(d=(0,R().Oz)(t))||void 0===d?void 0:d.background,I=(0,n.useCallback)((e=>{t.filtersBarOpenStore.setState(!0)}),[t]),F=(0,l().IS)((t=>({border:{width:"100%",borderTop:h?"none":`1px solid ${t.tableDividerColor}`,marginTop:4,zIndex:86},container:{width:"100%",zIndex:86,borderRadius:"4px",...h&&{paddingInlineStart:16,paddingInlineEnd:16}}})),[h]);return(0,E.jsx)("div",{style:F.border,children:(0,E.jsxs)("div",{style:F.container,className:f,onClick:I,tabIndex:0,role:"button",children:[(0,E.jsxs)("div",{style:{display:"flex",paddingTop:4},children:[(0,E.jsxs)("div",{style:{position:"relative",flexGrow:0,overflow:"hidden"},children:[(0,E.jsx)(_().H,{store:k,type:s().A.X,style:{display:"flex",alignItems:"center",paddingTop:8,paddingBottom:8},children:p?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(et,{collectionContextStore:t}),C?(0,E.jsx)(Z,{collectionContextStore:t}):void 0,C&&!p?(0,E.jsx)(X,{}):void 0,b?(0,E.jsx)(Y,{collectionContextStore:t}):void 0,(0,E.jsx)(tt,{collectionContextStore:t,propertyFilters:v,createFilterSettingsStore:S}),(0,E.jsx)(rt,{collectionContextStore:t,showHoverActionsStore:e,createFilterSettingsStore:S})]}):(0,E.jsxs)(E.Fragment,{children:[C?(0,E.jsx)(Z,{collectionContextStore:t}):void 0,C&&!p?(0,E.jsx)(X,{}):void 0,b?(0,E.jsx)(Y,{collectionContextStore:t}):void 0,(0,E.jsx)(tt,{collectionContextStore:t,createFilterSettingsStore:S,propertyFilters:v}),(0,E.jsx)(rt,{collectionContextStore:t,showHoverActionsStore:e,createFilterSettingsStore:S})]})}),p?void 0:(0,E.jsx)(A().A,{store:k,backgroundColor:j})]}),(0,E.jsxs)("div",{style:{display:"flex",alignItems:"start",paddingTop:6,marginInlineStart:"auto",flexShrink:0},children:[!p&&g?(0,E.jsx)(ot,{collectionContextStore:t,showHoverActionsStore:e,saveControlMoreActionsButtonPopupStore:m}):void 0,p?void 0:(0,E.jsx)(M().A,{collectionContextStore:t})]})]}),p?(0,E.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[g?(0,E.jsx)(ot,{collectionContextStore:t,showHoverActionsStore:e,saveControlMoreActionsButtonPopupStore:m}):void 0,(0,E.jsx)(M().A,{collectionContextStore:t})]}):void 0]})})}function Y({collectionContextStore:t}){return(0,E.jsx)(P().l,{context:q.FilterBar,collectionSettingsStore:t.filterBarCombinatorFilterSettingsStore,collectionContextStore:t})}function Z({collectionContextStore:t}){return(0,E.jsx)(W,{collectionContextStore:t,collectionSettingsStore:t.filterBarSortSettingsStore},"sort")}function Q({filter:t,collectionContextStore:e,onClick:o}){const n=(0,a().K8)((()=>e.getFilterBarItemSettingsStore(t)),[e,t]);return(0,E.jsx)(D().A,{id:t.id,context:q.FilterBar,collectionContextStore:e,collectionSettingsStore:n,onClick:o},t.id)}function X(){const t=(0,l().DP)();return(0,E.jsx)("div",{style:{borderInlineEnd:`1px solid ${t.regularDividerColor}`,height:24,marginInlineEnd:12,marginInlineStart:8}})}function tt({propertyFilters:t,collectionContextStore:e,createFilterSettingsStore:o}){const i=(0,r().v3)(),l=(0,a().O$)(e.canConfigureBlockStore),[s]=(0,a().K8)((()=>[e.currentPropertyFiltersStore.state]),[e]),c=(0,n.useCallback)((t=>{C().os({collectionSettingsStore:o}),C().os({collectionSettingsStore:e.filterBarSortSettingsStore}),C().os({collectionSettingsStore:e.filterBarCombinatorFilterSettingsStore}),s.filter((e=>!t||e.id!==t)).forEach((t=>{const o=e.getFilterBarItemSettingsStore(t);C().os({collectionSettingsStore:o})}))}),[e,o,s]);if(l){const o=t.map((t=>t.id));return(0,E.jsx)(k().Ay,{direction:"horizontal",keys:o,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:o=>{const n=t.find((t=>t.id===o));if(n)return(0,E.jsx)(Q,{collectionContextStore:e,filter:n,onClick:c})},style:{display:"flex",flexShrink:0},onDrop:t=>function(t,e,o){if(!o.collectionViewBlockStore())return;const n=o.currentPropertyFiltersStore.state,r=S().oE(t.map((t=>n.find((e=>e.id===t)))));x().IU({environment:e,collectionContextStore:o,temporaryState:{...o.temporaryStateStore.state,propertyFilters:{value:r}}}),(0,g().X)({environment:e,collectionContextStore:o,action:"reorder_filters"})}(t,i,e)})}return(0,E.jsx)(E.Fragment,{children:t.map((t=>(0,E.jsx)(Q,{filter:t,collectionContextStore:e,onClick:c},t.id)))})}function et({collectionContextStore:t}){const e=(0,r().v3)(),o=(0,a().K8)((()=>t.getViewType()),[t]),i=(0,l().IS)((t=>({wrapStyle:{display:"flex",alignItems:"center"},innerStyle:{border:"none"},icon:{width:16,fill:t.icon.secondary}})),[]),s=(0,n.useCallback)((()=>{!function(t,e){(0,v().I)({environment:t}),f().IU({environment:t}),(0,F().y)(),e.searchOpenStore.setState(!0),e.searchQueryStore.setState(""),(0,g().X)({environment:t,collectionContextStore:e,action:"click_mobile_search"})}(e,t)}),[e,t]);return"chart"===o?null:(0,E.jsx)(H().A,{wrapStyle:i.wrapStyle,innerStyle:i.innerStyle,icon:(0,d().U)(i.icon),hideChevron:!0,onClick:s},"search")}function ot({collectionContextStore:t,showHoverActionsStore:e,saveControlMoreActionsButtonPopupStore:o}){return(0,E.jsx)(y()._Q,{context:"FilterBar",collectionContextStore:t,showHoverActionsStore:e,moreActionsButtonPopupStore:o})}function nt({collectionContextStore:t,createFilterSettingsStore:e}){return(0,E.jsx)(y().m$,{context:h().Bd.FilterBar,collectionContextStore:t,collectionSettingsStore:e,hideDesktopHeader:!0})}function rt({collectionContextStore:t,showHoverActionsStore:e,createFilterSettingsStore:o}){const i=(0,r().v3)(),l=(0,n.useCallback)((t=>function(t,e){t&&"click"===t.type&&(0,I().Rp)(t.target)||C().os({collectionSettingsStore:e})}(t,o)),[o]),s=(0,n.useCallback)((()=>(0,E.jsx)(nt,{collectionContextStore:t,createFilterSettingsStore:o})),[t,o]),c=(0,n.useCallback)((()=>function(t,e,o){(0,g().X)({environment:t,collectionContextStore:e,action:"click_new_filter"}),C().R8({collectionSettingsStore:o,item:{type:"createFilter"}})}(i,t,o)),[i,t,o]),d=(0,a().K8)((()=>o.state.open),[o]),S=(0,a().K8)((()=>e.state||d),[e,d]);return(0,E.jsx)(j().Ay,{open:d,placementToOrigin:"bottom",alignmentToOrigin:"start",popupType:i.device.isMobile?j().nl.BottomSheet:j().nl.Popup,bottomSheetInitialState:"half",origin:(0,E.jsx)(b().A,{tag:u().p,visible:S,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},iconLeading:{icon:p().plusSmallIcon,size:"xs"},size:"sm",colorPalette:"gray",colorVariant:"tertiary",hovered:d,onClick:c,style:{fontSize:14,borderRadius:12,paddingInlineStart:5,paddingInlineEnd:9,marginInlineEnd:12},children:(0,E.jsx)(m().sA,{defaultMessage:"Filter",id:"database.filterBar.addButton.title"})}),render:s,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,onDismiss:l})}},427537:(t,e,o)=>{function n(t){var e;const o=Boolean(null===(e=function(t){var e,o;if(!t.isInViewTabLayout())return;if("page"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()))return;return null===(o=t.collectionViewStore())||void 0===o?void 0:o.getCollectionStore()}(t))||void 0===e?void 0:e.canEditCollection());return t.permissionScopesStore.state.canConfigureBlock||t.isEphemeralView()||o}function r(t){var e;return!!t.isInViewTabLayout()&&(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.canEdit())}o.d(e,{H:()=>n,b:()=>r})},443191:(t,e,o)=>{o.d(e,{J:()=>r});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.39 15.26 15.21",svg:(0,o(474848).jsx)("path",{d:"m10.775 2.583 2.475 2.475a.625.625 0 0 1 0 .884l-2.475 2.475a.625.625 0 1 1-.884-.884l1.408-1.408H4.8c-.649 0-1.175.526-1.175 1.175v5.975a.625.625 0 1 1-1.25 0V7.3A2.425 2.425 0 0 1 4.8 4.875h6.499L9.891 3.467a.625.625 0 0 1 .884-.884M17 6.1c.345 0 .625.28.625.625V12.7a2.425 2.425 0 0 1-2.425 2.425H8.7l1.408 1.408a.625.625 0 1 1-.884.884L6.75 14.942a.625.625 0 0 1 0-.884l2.475-2.475a.625.625 0 1 1 .884.884l-1.408 1.408H15.2c.649 0 1.175-.526 1.175-1.175V6.725c0-.345.28-.625.625-.625"})},r=(0,o(340498).wt)("arrowSquareLeftRight",n)},497222:(t,e,o)=>{o.d(e,{A:()=>m});o(296540);var n=()=>o(804773),r=()=>o(401497),i=()=>o(252291),a=()=>o(906380),l=()=>o(30626),s=()=>o(284371),c=()=>o(760217),u=()=>o(612900),d=()=>o(700251),p=o(474848);function m(t){const{icon:e,iconStyle:o,title:m,caption:S,right:g,rightStyle:f,isRed:v,isGray:x,isOrange:y,onClick:C,onMouseDown:h,onMouseEnter:b,onMouseLeave:k,disabled:j,showChevron:_,chevronStyle:A,rotateChevron:w,showDragHandle:I,focused:M,textWrapperStyle:T,shouldWrapCaption:B,desktopIconStyle:F,buttonStyle:R,desktopTitleStyle:V,source:P,menuListItemProps:D,isPulsing:O}=t,z=(0,d().y$)(),K=(0,r().IS)((t=>({style:{...(t=>x?{color:t.text.secondary,fill:t.icon.secondary}:y?{color:t.orange.icon.accentPrimary,fill:t.orange.icon.accentPrimary}:{color:t.text.primary,fill:t.icon.primary})(t),opacity:j?.4:void 0,...R},leftIconStyle:{width:z,height:z,...e===l()._&&{height:3},...o},rightStyle:{display:"flex",alignItems:"center",color:j?t.text.primary:t.text.tertiary,fill:j?t.icon.primary:t.icon.tertiary,flexShrink:0,...f},rightChevronStyle:{marginInlineStart:"tableHeaderMenu"===P?0:6,transition:"transform 200ms ease-in-out",...w&&{transform:"rotate(90deg)"},...A}})),[x,y,j,o,e,A,f,R,z,w,P]),{itemRef:L,isTabbable:N,onKeyDown:U,onFocus:H}=(0,n().e)(),E=(0,p.jsx)(c().A,{ref:L,role:"menuitem",icon:null==e?void 0:e(K.leftIconStyle),focused:M||!1,disabled:j,title:m,caption:S,shouldWrapCaption:B,desktopTitleStyle:{flexGrow:1,flexShrink:1,...V},onKeyDown:U,onFocus:H,disallowTabbing:!N,showDragHandle:I,buttonStyle:K.style,rightStyle:K.rightStyle,isRedOnHover:v,ignoreLocalHoverState:!!j||void 0,right:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{style:{...s().RC,display:"flex"},children:g}),!j&&_?(0,p.jsx)(i().I,{icon:a().arrowChevronSingleRightSmallIcon,size:"sm",colorVariant:"tableHeaderMenu"===P?"secondary":"tertiary",style:K.rightChevronStyle}):null]}),onClick:C,onMouseDown:h,onMouseEnter:b,onMouseLeave:k,textWrapperStyle:T,desktopIconStyle:F,reducedPadding:t.reducedPadding,...D});return O?(0,p.jsx)(u().u,{borderRadius:6,shape:"square",children:E}):E}},521855:(t,e,o)=>{o.d(e,{B:()=>g});var n=o(296540),r=()=>o(484714),i=()=>o(56366),a=()=>o(541235),l=()=>o(564884);var s=()=>o(73223),c=()=>o(739135);const u=new Map;var d=()=>o(765957),p=()=>o(594607),m=()=>o(953006),S=o(474848);function g({tutorialId:t,tutorialStepId:e,onPrimaryButtonClick:o,displayStore:g,calloutId:f,enableTracking:v=!1,...x}){const y=(0,r().v3)(),C=function(t){const e=!u.get(t),o=(0,n.useRef)(e);return o.current&&u.set(t,!0),(0,n.useEffect)((()=>()=>{o.current&&u.set(t,!1)}),[t]),o.current}(`${t}.${e}`),{currentStep:h,isLoading:b}=(0,i().K8)((()=>{var e;return{isLoading:!(null!==(e=d().default.state.currentUserSettingsStore)&&void 0!==e&&e.getSettings()),currentStep:(0,c().gt)(d().default.state.currentUserSettingsStore,t)}}),[t]);if((0,n.useEffect)((()=>{b||h!==e||!C?null==g||g.setState(!1):null==g||g.setState(!0)}),[b,h,e,C,g]),b||h!==e||!C)return null;const k=a().c$[t],j=k.steps.findIndex((t=>t.id===e)),_=k.steps.length,A=o=>{v&&function(t,e){(0,l().u)({environment:t,event:{eventName:"tutorial_tooltip_action",eventProperties:e}})}(y,{step:j+1,total_steps:_,tutorial_id:t,tutorial_step_id:e,action_type:o})},w=(0,S.jsx)(m().k,{onCloseClick:()=>{s().dismissTutorial(y,t),A("dismiss")},onPrimaryButtonClick:e=>{s().tutorialGoToNextStep(y,t),null==o||o(e),A("next")},onBackButtonClick:()=>{s().tutorialGoToPrevStep(y,t),A("back")},numSteps:_,currStepIndex:j,...x});return f?(0,S.jsx)(p().B,{calloutId:f,shouldShow:!0,children:w}):w}},532564:(t,e,o)=>{o.d(e,{V:()=>l,Z:()=>a});o(16280);var n=o(296540),r=o(474848);const i=n.createContext(void 0);function a(t){return(0,r.jsx)(i.Provider,{value:t.value,children:t.children})}function l(){const t=n.useContext(i);if(!t)throw new Error("useChartStore must be used within a ChartContextProvider");return t}i.displayName="ChartContext"},602141:(t,e,o)=>{o.d(e,{A:()=>m});o(898992),o(354520),o(672577);var n=o(296540),r=()=>o(56366),i=()=>o(30537),a=()=>o(69708),l=()=>o(284371),s=()=>o(147503),c=()=>o(859428),u=()=>o(932704),d=o(474848);function p({id:t,context:e,collectionContextStore:l,collectionSettingsStore:p,onClick:m}){const g=(0,o(484714).v3)(),f=(0,o(401497).DP)(),{filter:v,isReadOnly:x}=(0,r().K8)((()=>{const e=function(t,e){const o=e.currentPropertyFiltersStore.state;return o.find((e=>e.id===t))}(t,l);return{filter:e,isReadOnly:Boolean(e&&(0,o(790515).vu)(e.id))}}),[l,t]),y=(0,r().K8)((()=>{const e=(0,o(942125).Ml)(l,"normalized");return e.filters.updated.includes(t)||e.filters.added.includes(t)}),[l,t]),C=(0,r().K8)((()=>l.collectionViewStore()),[l]),h=(0,r().O$)(l.normalizedSchemaStore),b=(0,r().K8)((()=>p.state.open),[p]),k=(null==v?void 0:v.id)===u().O||(null==v?void 0:v.id)===u().j,j=(0,n.useCallback)((t=>{t&&(0,o(253579).Rp)(t.target)||s().os({collectionSettingsStore:p})}),[p]),_=(0,n.useCallback)((()=>{var t;m&&m(null==v?void 0:v.id),v&&(p.state.open?s().os({collectionSettingsStore:p}):s().R8({collectionSettingsStore:p,item:{type:"filter"}}),(0,o(436696).X)({environment:g,collectionContextStore:l,action:"click_property_filter",original_view_type:void 0,property_type:null==l||null===(t=l.collectionStore())||void 0===t||null===(t=t.getSchema()[v.filter.property])||void 0===t?void 0:t.type}))}),[l,p,g,v,m]),A=(0,n.useCallback)(((t,e)=>{if(!C||!v)return null;const n=v.filter,r=!(0,o(214388).t_)(n),i=h[n.property],a=(null==i?void 0:i.icon)&&(0,o(278238).T8)(i.icon),l=(0,o(700251).xI)({size:"sm",type:a?"custom":"system",isMobile:g.device.isMobile});return(0,d.jsx)(o(56394).A,{icon:i&&(0,d.jsx)(o(852424).zB,{type:i.type,icon:i.icon,size:l,theme:f,style:{fill:"currentColor",marginInlineEnd:5}}),title:r?(0,d.jsx)(o(704452).Ay,{propertyFilter:n,schema:h,style:S(),parentStore:C}):(0,d.jsx)("span",{style:S(),children:null==i?void 0:i.name}),on:r,hasDiff:y,disabled:e,hideChevron:e,onClick:_,...t},v.id)}),[C,g,v,_,y,h,f]),w=(0,n.useCallback)((()=>k?(0,d.jsx)(c().A,{placement:"bottom",render:t=>A(t,!0),renderTooltip:()=>(0,d.jsx)(a().sA,{id:"database.filterBarPropertyFilter.cannotConfigureSubitemDisplayMode",defaultMessage:"To modify this filter, first change the subitem display mode."})}):(0,d.jsx)(c().A,{placement:"bottom",render:t=>A(t,!0),renderTooltip:()=>(0,d.jsx)(a().sA,{id:"database.filterBarPropertyFilter.cannotConfigure",defaultMessage:"This filter cannot be modified on this view."})})),[A,k]),I=(0,n.useCallback)((()=>C&&v?(0,d.jsx)(o(866913).q,{collectionContextStore:l,collectionSettingsStore:p,collectionViewStore:C,context:e,filter:v,schema:h}):null),[l,p,C,e,v,h]);return x?w():(0,d.jsx)(o(417392).Ay,{popupType:g.device.isMobile?i().n.SlideUp:i().n.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",open:b,origin:x?w():A(void 0,!1),onDismiss:j,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:I,trapFocus:!0})}const m=n.memo(p,o(821062).A);function S(){return{maxWidth:180,...l().RC}}},658199:(t,e,o)=>{o.d(e,{A:()=>oe});var n=o(296540),r=()=>o(56366),i=()=>o(484714),a=()=>o(401497),l=()=>o(406094),s=()=>o(69708),c=()=>o(284371),u=()=>o(73223),d=(o(898992),o(354520),o(581454),()=>o(725252)),p=()=>o(757695),m=()=>o(252291),S=()=>o(631524),g=()=>o(160432),f=()=>o(584262),v=()=>o(66689),x=()=>o(784892),y=()=>o(597777),C=()=>o(869190),h=()=>o(324254),b=()=>o(740689),k=()=>o(617668),j=()=>o(995847),_=()=>o(696706),A=()=>o(179034),w=()=>o(864779),I=()=>o(201980),M=()=>o(100622),T=()=>o(496603),B=()=>o(534177),F=()=>o(720665),R=()=>o(857783),V=()=>o(813297),P=()=>o(599806),D=()=>o(304681),O=()=>o(862292),z=()=>o(476492),K=()=>o(722872),L=()=>o(71304),N=()=>o(685889),U=()=>o(645873),H=()=>o(778708),E=()=>o(314529);function W(t,e){(0,E().DO_NOT_USE_trackLegacy)(t,"complete_sprint_action",e)}var J=()=>o(765957),q=()=>o(148832),G=()=>o(760217),$=()=>o(406699),Y=()=>o(285790),Z=()=>o(710149),Q=()=>o(404277),X=()=>o(939740),tt=()=>o(45552),et=()=>o(187820),ot=()=>o(16006),nt=()=>o(89924),rt=()=>o(427711),it=()=>o(641514),at=()=>o(719147),lt=()=>o(881690),st=o(474848);const ct=(0,s().YK)({completedPercentSummary:{id:"completeAutomationSprintModal.sprintSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} total tasks"},selectNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectNextSprintLabel",defaultMessage:"Next sprint"},selectDatesForNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectDatesForNextSprintLabel",defaultMessage:"Start and end dates"},nextSprintDatesLabel:{id:"completeAutomationSprintModal.sprintSummary.nextSprintDatesLabel",defaultMessage:"Next sprint dates"},cancelButton:{id:"completeAutomationSprintModal.sprintSummary.cancel",defaultMessage:"Cancel"},fallbackSprintName:{id:"completeAutomationSprintModal.sprintName.placeholder",defaultMessage:"Sprint"}});function ut({onDismiss:t,...e}){const{isOpen:o}=e,r=(0,i().v3)(),a=(0,n.useId)(),l=o=>{t();let n=!1;(0,B().Gv)(o)&&(0,B().O9)(o.clickedCancel)&&(n=!0===o.clickedCancel),W(r,{...(0,z().sl)(e.taskCollectionContextStore),action:n?"cancel_modal":"dismiss_modal"})};return(0,st.jsx)(it().A,{ariaLabelledBy:a,isOpen:o,onDismiss:()=>l(),render:()=>(0,st.jsx)(dt,{...e,onDismiss:l,titleAriaId:a})})}function dt(t){var e;const{completeSprintAutomationContext:o,setIsLoading:a,taskCollectionContextStore:l,onDismiss:c,completeSprintAutomationState:u,onAutomationComplete:m,titleAriaId:f}=t,{currentSprintId:v,querySprintsResult:x,currentSprintTaskSummary:C}=u,h=(0,s().tz)(),b=(0,i().v3)(),{isMobile:k}=(0,i().Y0)(),{value:j}=(0,U().fJ)(O().T.formulas),{value:_}=(0,U().fJ)(V().QV.automationTypecheck),{value:I}=(0,U().fJ)(V().QV.automationActionRegistry),M=(0,r().O$)(J().AppStoreCurrentUserSettingsStore),T=(0,r().K8)((()=>o.sprintCollectionStore),[o]),B=(0,r().K8)((()=>{var t;const e=null===(t=o.automationContext)||void 0===t?void 0:t.automationStore;return null==e?void 0:e.getRecurrence()}),[o]),R=(0,r().K8)((()=>{var t;return(null===(t=o.automationContext)||void 0===t||null===(t=t.automationActionStore.getConfig())||void 0===t?void 0:t.complete_sprint_action)??"complete_sprint_and_move_incomplete_tasks_to_next_sprint"}),[null===(e=o.automationContext)||void 0===e?void 0:e.automationActionStore]),P=(0,r().K8)((()=>T.getSpaceId()),[T]),D=(0,r().K8)((()=>{if(v)return q().B.createChildStore(T,{id:v,table:A().ev,spaceId:T.getSpaceId()})}),[v,T]),z=(0,r().K8)((()=>D?(0,L().tS)({intl:h,environment:b,store:D,untitledFallback:ct.fallbackSprintName}):h.formatMessage(ct.fallbackSprintName)),[D,h,b]),K=(0,r().K8)((()=>vt({sprintBlockStore:D,sprintCollectionStore:T})),[D,T]),N=(0,r().K8)((()=>xt({sprintDateRange:K,intl:h})),[K,h]),[H,E]=n.useState(),W=(0,r().K8)((()=>p().Store.createValue(R)),[R]),G=n.useMemo((()=>{if(!B||null==K||!K.end_date)return;const t=(0,w().Vv)(B);return t?(0,w().Z3)({currentSprintEndDate:K.end_date,sprintSchedule:t}):void 0}),[B,null==K?void 0:K.end_date]),$=(0,r().K8)((()=>{if("pointer"!==(null==H?void 0:H.type))return;return vt({sprintBlockStore:q().B.createChildStore(T,H.pointer),sprintCollectionStore:T})}),[H,T]),[Y,Z]=n.useState(void 0),Q=n.useMemo((()=>{if(Y&&(0,y().oM)(Y))return Y}),[Y]),X=n.useMemo((()=>{if(!x)return;const{nextSprintIds:t,futureSprintIds:e}=x;return t.length>0?t:e}),[x]),tt=(0,r().K8)((()=>{if(void 0===X)return;const t=X[0];return t?{type:"pointer",pointer:{id:t,table:A().ev,spaceId:P}}:{type:"actionId"}}),[X,P]),et=(0,r().K8)((()=>{var t;return!Boolean(null==M||null===(t=M.getSettings())||void 0===t?void 0:t.seen_sprint_settings_engagement_banner)}),[M]);n.useEffect((()=>{tt&&E(tt)}),[tt,E]),n.useEffect((()=>{Z($??G)}),[$,G,Z]);const ot=n.useCallback((async()=>{if(c(),!(j&&_&&I&&H&&Q&&o.automationContext))return;a(!0);const t=0===(null==C?void 0:C.incompleteTaskCount)?"complete_sprint":W.state;if(!o.automationContext)return;const e={type:"recurrence",recurrence:{type:"completeSprint",completeSprintActionType:t,nextSprintDateRange:Q},automationStore:o.automationContext.automationStore,intl:h,parentRecordStore:o.currentCollectionViewBlockStore,formulasModule:j,isLoggedIn:b.currentUser.isLoggedIn(),automationTypecheckModule:_,automationActionRegistryModule:I},n=()=>{m()},{automationExecutionActions:r}=await V().QV.automations.load();await r.executeClientAutomation({environment:b,clientContext:e,onUndo:()=>{a(!0),n(),a(!1)}}),n(),a(!1)}),[c,j,H,Q,o.automationContext,o.currentCollectionViewBlockStore,_,I,a,null==C?void 0:C.incompleteTaskCount,W,h,b,m]),nt=St({isMobile:k}),{status:rt}=(0,d().L)({value:u,validateLoaded:t=>!1===t.isLoading,waitTimeInMs:Number(F().Xb)});if("pending"!==rt&&u.isLoading)return(0,st.jsx)(pt,{titleAriaId:f,onDismiss:c,sprintCollectionStore:T});if(u.isLoading)return(0,st.jsx)(mt,{titleAriaId:f,onDismiss:c});const{incompleteTaskCount:it}=u.currentSprintTaskSummary,at=Boolean(H)&&Boolean(Q),lt=void 0!==X&&X.length>0;return(0,st.jsxs)("div",{style:nt.modalContainer,children:[(0,st.jsx)("div",{style:nt.header,id:f,children:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.title",defaultMessage:"{sprintName} summary",values:{sprintName:z}})}),(0,st.jsx)(ft,{currentSprintFormattedDateRange:N,currentSprintTaskSummary:C}),et?(0,st.jsx)(gt,{collectionContextStore:l,userSettingsStore:M,onDismissModal:c}):void 0,lt?(0,st.jsxs)("div",{style:nt.flexRow,children:[h.formatMessage(ct.selectNextSprintLabel),(0,st.jsx)(kt,{nextSprintInput:H,setNextSprintInput:E,completeSprintAutomationContext:o,sprintPageIds:X})]}):void 0,(0,st.jsxs)("div",{style:nt.flexRow,children:[lt?h.formatMessage(ct.selectDatesForNextSprintLabel):h.formatMessage(ct.nextSprintDatesLabel),(0,st.jsx)(_t,{sprintDateRange:Y,setSprintDateRange:Z})]}),it>0?(0,st.jsxs)("div",{style:nt.flexRow,children:[(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksLabel",defaultMessage:"{incompleteTaskCount, plural, one {{incompleteTaskCount} incomplete task} other {{incompleteTaskCount} incomplete tasks}}",values:{incompleteTaskCount:it}}),(0,st.jsx)(Ct,{actionTypeStore:W})]}):void 0,(0,st.jsx)(g().A,{colorPalette:"blue",disabled:!at,onClick:()=>{ot()},style:nt.button,children:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButton",defaultMessage:"Complete {sprintName}",values:{sprintName:z}})}),(0,st.jsx)(S().p,{onClick:()=>c({clickedCancel:!0}),style:nt.button,children:h.formatMessage(ct.cancelButton)})]})}function pt(t){const{onDismiss:e,sprintCollectionStore:o,titleAriaId:n}=t,a=(0,i().v3)(),l=(0,s().tz)(),{isMobile:c}=(0,i().Y0)(),u=(0,r().K8)((()=>o.getParentBlockStore()),[o]),d=St({isMobile:c});return(0,st.jsxs)("div",{style:d.modalContainer,children:[(0,st.jsx)("div",{style:d.header,id:n,children:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.missingCurrentSprint.title",defaultMessage:"No current sprint found"})}),(0,st.jsx)(g().A,{colorPalette:"blue",onClick:()=>{u&&R().uK({environment:a,store:u,pageVisitSource:f().y8.LinkInPage})},style:{...d.button,marginTop:24},children:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.missingCurrentSprint.navigateToSprintsDatabase",defaultMessage:"Fix in Sprints database"})}),(0,st.jsx)(S().p,{onClick:e,style:d.button,children:l.formatMessage(ct.cancelButton)})]})}function mt(t){const{onDismiss:e,titleAriaId:o}=t,n=(0,s().tz)(),{isMobile:r}=(0,i().Y0)(),a=St({isMobile:r});return(0,st.jsxs)("div",{style:a.modalContainer,children:[(0,st.jsx)("div",{style:a.header,id:o,children:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.titlePlaceholder",defaultMessage:"Sprint summary"})}),(0,st.jsx)("div",{style:a.subheader,children:(0,st.jsx)(Z().A,{style:a.subheaderShimmer})}),(0,st.jsxs)("div",{style:a.flexRow,children:[n.formatMessage(ct.selectNextSprintLabel),(0,st.jsx)(Z().A,{style:a.flexRowShimmerBox1})]}),(0,st.jsxs)("div",{style:a.flexRow,children:[n.formatMessage(ct.selectDatesForNextSprintLabel),(0,st.jsx)(Z().A,{style:a.flexRowShimmerBox2})]}),(0,st.jsxs)("div",{style:a.flexRow,children:[(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksPlaceholder",defaultMessage:"Incomplete tasks"}),(0,st.jsx)(Z().A,{style:a.flexRowShimmerBox3})]}),(0,st.jsx)(g().A,{colorPalette:"blue",disabled:!0,onClick:T().lQ,style:a.button,children:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButtonPlaceholder",defaultMessage:"Complete sprint"})}),(0,st.jsx)(S().p,{onClick:e,style:a.button,children:n.formatMessage(ct.cancelButton)})]})}function St({isMobile:t}){return(0,a().IS)((e=>{const o={height:44,borderRadius:8,display:"flex",alignItems:"center",width:void 0},n={...o,marginTop:12,marginBottom:18};return{modalContainer:{width:400,display:"flex",fontSize:t?c().J.UIRegular.mobile:c().J.UIRegular.desktop,flexDirection:"column",justifyContent:"center",padding:20},header:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:t?18:16,fontWeight:c().Wy.semibold},subheader:{display:"flex",alignItems:"center",justifyContent:"center",color:e.text.tertiary,marginBottom:16,gap:8},separator:{height:2,width:2,borderRadius:2,backgroundColor:e.icon.tertiary},flexRow:{display:"flex",...t?{flexDirection:"column",fontSize:14,color:e.text.secondary}:{justifyContent:"space-between",alignItems:"center",height:24,marginBottom:16}},completedTaskGroup:{display:"flex",gap:4},button:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:8,...t&&o},subheaderShimmer:{borderRadius:4,marginTop:6,width:200,height:16,...t&&{height:22}},flexRowShimmerBox1:{borderRadius:4,width:60,height:16,...t&&n},flexRowShimmerBox2:{borderRadius:4,width:80,height:16,...t&&n},flexRowShimmerBox3:{borderRadius:4,width:140,height:16,...t&&n},dropdownButton:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:4,...t&&{...n,border:`1px solid ${e.border.secondary}`,justifyContent:"space-between"}},dropdownChevronIcon:{color:e.icon.tertiary,width:12,height:"auto"}}}),[t])}function gt(t){const e=(0,s().tz)(),{collectionContextStore:o,userSettingsStore:n,onDismissModal:r}=t,l=(0,i().v3)(),u=(0,a().IS)((t=>({banner:{width:"100%",display:"flex",alignItems:"start",backgroundColor:t.blue.background.secondaryTranslucent,borderRadius:4,padding:12,marginBottom:12,fontSize:12,lineHeight:1.5,gap:8},bannerContent:{flex:"1 1 auto",color:t.text.primary},bannerTitle:{fontWeight:c().Wy.regular},repeatIcon:{flex:"0 0 auto",marginBlockStart:3},closeButton:{marginTop:-3,borderRadius:"50%"},link:{color:t.blue.text.accentPrimary}})),[]);return(0,st.jsxs)("div",{style:u.banner,children:[(0,st.jsx)("div",{style:u.repeatIcon,children:(0,st.jsx)(m().I,{icon:b().o,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"})}),(0,st.jsx)("div",{style:u.bannerContent,children:(0,st.jsx)("div",{style:u.bannerTitle,children:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.turnOnAutomaticSprints.banner.title",defaultMessage:"Complete your sprints automatically. Turn on Automated sprints in <linkToSprintSettings>Settings</linkToSprintSettings>.",values:{linkToSprintSettings:(...t)=>(0,st.jsx)(at().A,{onClick:()=>{n&&(r(),H().cJ({environment:l,userSettingsStore:n}),H().Dl(o))},disableUnderline:!0,style:u.link,children:t})}})})}),(0,st.jsx)(Y().A,{icon:j().xMarkSmallIcon,ariaLabel:e.formatMessage({id:"completeAutomationSprintModal.dismissBannerButton",defaultMessage:"Dismiss banner button"}),style:u.closeButton,onClick:()=>{n&&H().cJ({environment:l,userSettingsStore:n})}})]})}function ft(t){const{currentSprintFormattedDateRange:e,currentSprintTaskSummary:o}=t,{isMobile:n}=(0,i().Y0)(),r=(0,s().tz)(),a=St({isMobile:n}),l=o?r.formatMessage(ct.completedPercentSummary,{completedTaskCount:o.completedTaskCount,totalTaskCount:o.totalTaskCount}):void 0,c=e&&o?(0,st.jsxs)(st.Fragment,{children:[e,(0,st.jsx)("div",{style:a.separator}),l]}):e||l;return void 0===c?null:(0,st.jsx)("div",{style:a.subheader,children:c})}function vt(t){const{sprintBlockStore:e,sprintCollectionStore:o}=t;if(!e)return;const n=o.getPropertyMapping(),r=null==n?void 0:n[v().Hx.Dates];if(!r)return;const i=e.getPropertyValue(r);if(!i)return;const a=(0,I().Cok)(i)[0];return a?(0,y().HB)(a):void 0}function xt(t){const{sprintDateRange:e,intl:o}=t;if(e&&(0,y().oM)(e))return(0,C().ZF)({value:e,allowRelativeDates:!1,shortenDateAndRange:!0,displayInUserTimezone:!0,intl:o})}const yt={complete_sprint_and_move_incomplete_tasks_to_next_sprint:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.moveToNextSprintOption",defaultMessage:"Move to next sprint"}),complete_sprint_and_move_incomplete_tasks_to_backlog:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.moveToBacklogOption",defaultMessage:"Move to backlog"}),complete_sprint:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.keepInThisSprintOption",defaultMessage:"Keep in current sprint"})};function Ct(t){const{actionTypeStore:e}=t,{isMobile:o}=(0,i().Y0)(),n=(0,r().O$)(e),a=St({isMobile:o});return(0,st.jsx)($().A,{popupType:o?$().z.SlideUp:$().z.Popup,alignmentToOrigin:"start",placementToOrigin:"bottom",render:t=>(0,st.jsx)(bt,{actionTypeStore:e,buttonPopupParent:t}),renderOrigin:t=>(0,st.jsxs)(S().p,{...t,style:a.dropdownButton,children:[yt[n],(0,st.jsx)(m().I,{icon:h().arrowChevronSingleDownSmallIcon,size:"sm",colorVariant:"tertiary"})]})})}const ht=["complete_sprint_and_move_incomplete_tasks_to_next_sprint","complete_sprint_and_move_incomplete_tasks_to_backlog","complete_sprint"];function bt(t){const{actionTypeStore:e,buttonPopupParent:o}=t,{isMobile:n}=(0,i().Y0)(),a=(0,r().K8)((()=>ht.map((t=>{const n=t===e.state;return{key:t,action:()=>{e.setState(t),o.close()},render:e=>(0,st.jsx)(G().A,{...e,title:yt[t],isChecked:n})}}))),[e,o]);let l;return l=n?{menuType:K().gu.ActionSheet}:{menuType:K().gu.Popup,maxHeight:"50vh",minWidth:230},(0,st.jsx)(Q().A,{...l,children:(0,st.jsx)(X().Ay,{type:X().Oh.Vertical,initialFocus:0,sections:[{key:"sprint_automations",items:a,render:t=>(0,st.jsx)(nt().A,{...t})}]})})}function kt(t){const{nextSprintInput:e,completeSprintAutomationContext:o,setNextSprintInput:n,sprintPageIds:l}=t,{sprintCollectionStore:c}=o,{isMobile:u}=(0,i().Y0)(),d=(0,i().v3)(),p=(0,s().tz)(),g=(0,r().K8)((()=>{if(void 0===e)return(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSelect.empty",defaultMessage:"Select sprint"});if("actionId"===e.type)return(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSelect.newSprint",defaultMessage:"New sprint"});if("pointer"===e.type){const t=q().B.createChildStore(c,e.pointer);return(0,L().tS)({intl:p,environment:d,store:t,untitledFallback:ct.fallbackSprintName})}(0,B().HB)(e)}),[e,p,c,d]),f=St({isMobile:u}),v=(0,a().IS)((t=>({button:{...void 0===e&&{color:t.text.tertiary}}})),[e]),x={...f.dropdownButton,...v.button};return 0===l.length||1===l.length?(0,st.jsx)(S().p,{style:x,disabled:!0,children:g}):(0,st.jsx)($().A,{popupType:u?$().z.SlideUp:$().z.Popup,alignmentToOrigin:"start",placementToOrigin:"bottom",render:t=>(0,st.jsx)(jt,{buttonPopupParent:t,completeSprintAutomationContext:o,sprintPageIds:l,nextSprintInput:e,setNextSprintInput:n}),renderOrigin:t=>(0,st.jsxs)(S().p,{...t,style:x,children:[g,(0,st.jsx)(m().I,{icon:h().arrowChevronSingleDownSmallIcon,size:"sm",colorVariant:"tertiary"})]})})}function jt(t){const{sprintPageIds:e,completeSprintAutomationContext:o,buttonPopupParent:l,nextSprintInput:c,setNextSprintInput:u}=t,{sprintCollectionStore:d}=o,{isMobile:p}=(0,i().Y0)(),S=(0,r().K8)((()=>d.getSpaceId()),[d]),g=(0,r().K8)((()=>(0,N().B7)({collectionStore:o.taskCollectionStore,property:v().yx.TaskToSprintRelation}).filter((t=>t.visible&&("title"===t.property||o.sprintCollectionSchema[t.property])))),[o]),f=(0,r().K8)((()=>new(D().A)),[]),y=(0,a().IS)((t=>({plusIcon:{color:t.icon.tertiary,width:12,height:"auto"},createSprintRow:{display:"flex",gap:4},sprintRow:{display:"flex",maxHeight:22,alignItems:"center"},recordTitle:{...p&&{marginInlineEnd:12}}})),[p]),C="purple",h=(0,a().DP)(),b=(0,M().LD)(h,C),j=n.useMemo((()=>{const t="actionId"===(null==c?void 0:c.type);return{key:"new_sprint",action:()=>{u({type:"actionId"}),l.close()},render:e=>(0,st.jsx)(G().A,{...e,icon:(0,st.jsx)(m().I,{icon:k().plusIcon}),title:(0,st.jsxs)("div",{style:y.createSprintRow,children:[(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.selectSprintDropdown.createNew",defaultMessage:"New sprint"}),(0,st.jsx)(lt().A,{isRound:!0,showRemoveButton:!1,value:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.selectSprintDropdown.createNewToken",defaultMessage:"Next"}),format:x().NY.Medium,isSingle:!0,color:b.textColor,backgroundColor:b.backgroundColor,showColoredDot:C})]}),isChecked:t})}}),[c,l,u,y,b]),w=(0,r().K8)((()=>e.map((t=>{const e={id:t,table:A().ev,spaceId:S},o=q().B.createChildStore(d,e),n=o.getIcon(),r="pointer"===(null==c?void 0:c.type)&&_().L3.isEqual(c.pointer,e);return{key:t,action:()=>{u({type:"pointer",pointer:e}),l.close()},render:t=>(0,st.jsx)(G().A,{...t,icon:n&&(0,st.jsx)(et().B6,{disabled:!0,icon:n,isEmptyPage:!1,size:20}),title:(0,st.jsx)("div",{style:y.sprintRow,children:g.map((t=>"title"===t.property?(0,st.jsx)(ot().A,{store:o,style:y.recordTitle},"title"):(0,st.jsx)(P().q,{store:o,property:t.property,disabled:!1,locked:!1,surface:"relation",tableWrap:!1,blockPropertyValueOverlayStore:f,collectionStore:d},t.property))).filter(B().O9)}),isChecked:r})}}))),[d,f,l,c,g,S,u,y,e]),I=[{key:"sprints",items:n.useMemo((()=>w.length>0?w:[j]),[w,j]),render:t=>(0,st.jsx)(nt().A,{...t})}];let T;return T=p?{menuType:K().gu.ActionSheet}:{menuType:K().gu.Popup,maxHeight:"50vh",minWidth:230},(0,st.jsx)(Q().A,{...T,children:(0,st.jsx)(X().Ay,{type:X().Oh.Vertical,initialFocus:0,sections:I})})}function _t(t){const{sprintDateRange:e,setSprintDateRange:o}=t,r=(0,s().tz)(),{isMobile:l}=(0,i().Y0)(),c=n.useMemo((()=>xt({sprintDateRange:e,intl:r})),[e,r]),u=St({isMobile:l}),d=(0,a().IS)((t=>({button:{...!c&&{color:t.text.tertiary}}})),[c]),p=(0,n.useMemo)((()=>c||(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.nextSprintDate.placeholder",defaultMessage:"Select dates"})),[c]);return(0,st.jsx)($().A,{popupType:l?$().z.SlideUp:$().z.Popup,alignmentToOrigin:"start",placementToOrigin:"bottom",render:t=>(0,st.jsx)(At,{sprintDateRange:e,setSprintDateRange:o,onDismiss:()=>{t.close()}}),renderOrigin:t=>(0,st.jsxs)(S().p,{...t,style:{...u.dropdownButton,...d.button},children:[p,(0,st.jsx)(m().I,{icon:h().arrowChevronSingleDownSmallIcon,size:"sm",colorVariant:"tertiary"})]})})}function At(t){const{sprintDateRange:e,setSprintDateRange:o,onDismiss:r}=t,{isMobile:a}=(0,i().Y0)(),l=n.useMemo((()=>({starting:null!=e&&e.start_date?{type:"date",start_date:e.start_date}:void 0,ending:null!=e&&e.end_date?{type:"date",start_date:e.end_date}:void 0})),[e]);let c;return c=a?{menuType:K().gu.Modal,right:(0,st.jsx)(tt().DoneMenuText,{}),onClickRight:r}:{menuType:K().gu.Popup,maxHeight:"50vh",paddingTop:6},(0,st.jsxs)(Q().A,{...c,children:[(0,st.jsx)(nt().A,{children:(0,st.jsx)(rt().A,{title:void 0,disableMenuWrap:!0,allowRelativeRangeFilter:!0,value:l,onUpdate:t=>{var e,n;if(t.error)return;const r={...l,...t.value},i=null===(e=r.starting)||void 0===e?void 0:e.start_date,a=null===(n=r.ending)||void 0===n?void 0:n.start_date;o({type:"daterange",start_date:i,end_date:a})},onDismiss:r})}),(0,st.jsx)(nt().A,{topBorder:!0,children:(0,st.jsx)(G().A,{focused:!1,onClick:()=>{o(void 0)},title:(0,st.jsx)(s().sA,{id:"completeAutomationSprintModal.sprintSummary.datePicker.clear",defaultMessage:"Clear"})})})]})}o(672577);var wt=()=>o(416504),It=()=>o(187174),Mt=()=>o(799829),Tt=()=>o(559506),Bt=()=>o(950914),Ft=()=>o(374562);function Rt(t){if(!t)return;if("aggregation"!==t.type)return;if("text"!==t.aggregationResult.type)return;const e=t.aggregationResult.value,o=null==e?void 0:e.split("/");if(!o||2!==o.length)return;const n=Number(o[0]),r=Number(o[1]);return{completedTaskCount:n,incompleteTaskCount:r-n,totalTaskCount:r,completedTaskPercent:0===r?0:n/r}}function Vt(t){if(!t)return;const e=t.getPropertyMapping(),o=null==e?void 0:e[v().yx.TaskToSprintRelation];if(!o)return;return Ft().jj.filter.property=o,{...Ft().jj.filter,property:o}}function Pt(t,e){if(!e)return;const o=e.getPropertyMapping(),n=Vt(e);if(!n)return;const r=null==o?void 0:o[v().yx.Status];if(!r)return;const i=e.getSchema()[r];if(!i||"status"!==i.type)return;const a=(0,Bt().Q6)(t,i);return a?{type:"aggregation",filter:{operator:"and",filters:[n]},aggregation:{aggregator:{operator:"count_per_group",groupName:a},property:r}}:void 0}class Dt extends p().Store{getInitialState(){return{isLoading:!0,currentSprintId:void 0,querySprintsResult:void 0,currentSprintTaskSummary:void 0}}updateCurrentSprint(t){const{querySprintsResult:e,currentSprintTaskSummary:o}=this.state;void 0!==t&&void 0!==e&&void 0!==o?this.setState({isLoading:!1,currentSprintId:t,querySprintsResult:e,currentSprintTaskSummary:o}):t?this.setState({...this.state,currentSprintId:t}):this.setState({...this.state,isLoading:!0,currentSprintId:t})}updateNextAndFutureSprints(t){const{currentSprintId:e,currentSprintTaskSummary:o}=this.state;void 0!==e&&void 0!==t&&void 0!==o?this.setState({isLoading:!1,currentSprintId:e,querySprintsResult:t,currentSprintTaskSummary:o}):t?this.setState({...this.state,querySprintsResult:t}):this.setState({...this.state,isLoading:!0,querySprintsResult:t})}updateCurrentSprintTaskSummary(t){const{currentSprintId:e,querySprintsResult:o}=this.state;void 0!==e&&void 0!==o&&void 0!==t?this.setState({isLoading:!1,currentSprintId:e,querySprintsResult:o,currentSprintTaskSummary:t}):t?this.setState({...this.state,currentSprintTaskSummary:t}):this.setState({...this.state,isLoading:!0,currentSprintTaskSummary:t})}}const Ot=Dt;function zt(t){const{taskCollectionContextStore:e,completeSprintAutomationContext:o,children:a,isModalOpen:l}=t,{sprintCollectionStore:c}=o,u=c.id,d=(0,i().v3)(),p=(0,r().K8)((()=>new Ot),[]),m=(0,r().O$)(p),S=(0,r().K8)((()=>{var t;const o=e.relativeVariableStore.state;return null==o||null===(t=o[u])||void 0===t?void 0:t.current}),[u,e]);n.useEffect((()=>{p.updateCurrentSprint(S)}),[S,p]);const[{value:g}]=(0,It().Yb)((async()=>await async function(t){var e;const{environment:o,completeSprintAutomationContext:n}=t,{sprintCollectionStore:r}=n,i=function(t){var e,o;const{sprintCollectionStore:n,sprintCollectionSchema:r}=t,i=n.getPropertyMapping(),a=null==i?void 0:i[v().Hx.StatusV2];if(!a)return;const l=r[a];if(!l||"status"!==l.type)return;const s=null===(e=l.options)||void 0===e||null===(e=e.find((t=>t.id===v().tO)))||void 0===e?void 0:e.value,c=null===(o=l.options)||void 0===o||null===(o=o.find((t=>t.id===v().Jd)))||void 0===o?void 0:o.value;if(!s||!c)return;const u=Mt().n$[v().av].next.reducer.getCombinatorFilter(r);if(!u)return;const d={type:"results",filter:u,limit:Kt},p={type:"results",filter:{operator:"and",filters:[{property:a,filter:{operator:"status_is",value:{type:"is_option",value:c}}}]},limit:Kt};return{[v().tO]:d,[v().Jd]:p}}(n),a=r.getPropertyMapping(),l=null==a?void 0:a[v().Hx.Dates],s=null==a?void 0:a[v().Hx.UniqueId];if(!i||!l||!s)return;const c={userId:o.currentUser.id,userTimeZone:(0,wt().P)(),searchQuery:void 0,sort:[{property:l,direction:"ascending"},{property:s,direction:"ascending"}],reducers:i},u=null===(e=r.getParentBlockStore())||void 0===e?void 0:e.getCollectionViewStores()[0],d=r.getSpaceId();if(!u)return;const p=await Tt().callApi({eventName:"queryCollection",environment:o,data:{source:{type:"collection",id:r.id,spaceId:d},collectionView:{id:u.id,spaceId:d},loader:c},tracking:{src:"complete_sprint_modal_sprint_picker"}});if("success"!==p.type)return;const m=p.data.result.reducerResults[v().tO],S=p.data.result.reducerResults[v().Jd];if("results"!==m.type||"results"!==S.type)return;const g=m.blockIds,f=S.blockIds;return{nextSprintIds:g,futureSprintIds:f}}({environment:d,completeSprintAutomationContext:o})),[S,d,o]);n.useEffect((()=>{p.updateNextAndFutureSprints(g)}),[g,p]);const f=(0,s().tz)(),[{value:x}]=(0,It().Yb)((async()=>await async function(t){var e;const{environment:o,completeSprintAutomationContext:n,intl:r}=t,{taskCollectionStore:i}=n,a=Pt(r,i);if(!a)return;const l=Vt(i);if(!l)return;const s={filter:{operator:"and",filters:[l]},userId:o.currentUser.id,userTimeZone:(0,wt().P)(),searchQuery:"",sort:[],reducers:{completed_tasks_in_current_sprint:a}},c=null===(e=i.getParentBlockStore())||void 0===e?void 0:e.getCollectionViewStores()[0],u=i.getSpaceId();if(!c)return;const d=await Tt().callApi({eventName:"queryCollection",environment:o,data:{source:{type:"collection",id:i.id,spaceId:u},collectionView:{id:c.id,spaceId:u},loader:s},tracking:{src:"complete_sprint_modal_sprint_picker"}});if("success"!==d.type)return;return Rt(d.data.result.reducerResults.completed_tasks_in_current_sprint)}({intl:f,environment:d,completeSprintAutomationContext:o})),[S,d,o,l]);return n.useEffect((()=>{p.updateCurrentSprintTaskSummary(x)}),[x,p]),(0,st.jsx)(st.Fragment,{children:a({completeSprintAutomationState:m,onAutomationComplete:()=>{p.reset()}})})}const Kt=5;var Lt=()=>o(739135),Nt=()=>o(152197),Ut=()=>o(765101),Ht=()=>o(101981),Et=()=>o(942125),Wt=()=>o(67775);function Jt(t){const{percentage:e}=t;return(0,st.jsx)(Wt().l,{numberValue:e,numberFormat:void 0,numberPrecision:void 0,numberShowAs:{type:"ring",maxValue:1,color:"blue",showValue:!1},shouldRenderTooltip:!1,progressSize:15})}const qt=function(t){const{isLoading:e,taskSummary:n,styles:r}=t;return(0,st.jsx)("div",{style:{width:16,height:"auto",...r},children:e?(0,st.jsx)(o(98126).k,{}):(0,st.jsx)(Jt,{percentage:(null==n?void 0:n.completedTaskPercent)??0})})};function Gt(t){const{taskCollectionContextStore:e,children:o}=t,n=(0,r().K8)((()=>(0,Et().y_)(e)),[e]),i=(0,r().K8)((()=>e.collectionStore()),[e]),a=(0,s().tz)(),l=(0,r().K8)((()=>Pt(a,i)),[i,a]);return!l||n?null:(0,st.jsx)(Ht().A,{id:"completed_tasks_in_current_sprint_view",collectionContextStore:e,reducer:l,render:t=>{const e=Rt(t.state);return e?(0,st.jsxs)(st.Fragment,{children:[(0,st.jsx)($t,{currentSprintTasksInView:e}),o(e)]}):null}})}function $t(t){const{currentSprintTasksInView:e}=t,o=(0,a().IS)((t=>({summary:{display:"flex",alignItems:"center",justifyContent:"center",columnGap:5,color:t.text.tertiary,fontSize:c().J.UIRegular.desktop,fontWeight:c().Wy.regular,whiteSpace:"nowrap"}})),[]),{isPhone:n}=(0,i().Y0)();return n?null:(0,st.jsxs)("div",{style:o.summary,children:[(0,st.jsx)(qt,{styles:{paddingTop:1},isLoading:!1,taskSummary:e}),(0,st.jsx)(s().sA,{id:"completeAutomationSprintAutomation.inlineSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} tasks",values:{completedTaskCount:e.completedTaskCount,totalTaskCount:e.totalTaskCount}})]})}function Yt(t){const{collectionContextStore:e,completeSprintAutomationContext:o}=t,a=(0,i().v3)(),[l,s]=n.useState(!1),[c,d]=n.useState(!1),p=n.useCallback((()=>{d(!1)}),[d]),m=(0,r().K8)((()=>o.permissionsContext.canEdit),[o.permissionsContext.canEdit]),S=(0,r().O$)(J().AppStoreCurrentUserSettingsStore),g=()=>{d(!0);"complete-sprint-button-tooltip"===(0,Lt().gt)(S,"sprints-onboarding")&&u().tutorialGoToNextStep(a,"sprints-onboarding"),W(a,{...(0,z().sl)(e),action:"open_modal"})};return m?(0,st.jsxs)(st.Fragment,{children:[(0,st.jsx)(zt,{completeSprintAutomationContext:o,taskCollectionContextStore:e,isModalOpen:c,children:({completeSprintAutomationState:t,onAutomationComplete:n})=>(0,st.jsx)(ut,{completeSprintAutomationContext:o,isOpen:c,onDismiss:p,setIsLoading:s,taskCollectionContextStore:e,completeSprintAutomationState:t,onAutomationComplete:n})}),(0,st.jsx)(Gt,{taskCollectionContextStore:e,children:()=>(0,st.jsx)(Zt,{taskCollectionContextStore:e,onClick:g,isLoading:l})})]}):null}function Zt(t){const{taskCollectionContextStore:e,onClick:o,isLoading:u}=t,{isPhone:d}=(0,i().Y0)(),p=n.useRef(null),m=function(t){const{isPhone:e}=t;return(0,a().IS)((t=>({button:{height:26,marginInlineStart:8,fontWeight:c().Wy.medium,...e&&{flexGrow:1,borderRadius:8,height:44}}})),[e])}({isPhone:d}),S=(0,r().K8)((()=>e.collectionViewBlockStore()),[e]),g=(0,Nt().r)(),f=(0,r().K8)((()=>null==S?void 0:S.getSpaceId()),[S]);if(!S)return(0,st.jsx)(st.Fragment,{});const v=f===g;return(0,st.jsxs)(st.Fragment,{children:[(0,st.jsx)(l().A,{size:"lg",ref:p,onClick:o,style:m.button,disabled:u,disabledFeedback:u,children:(0,st.jsx)(s().sA,{defaultMessage:"Complete sprint",id:"completeSprintAutomationButton.label"})}),v?(0,st.jsx)(Ut().rY,{origin:p}):void 0]})}var Qt=()=>o(906745),Xt=()=>o(443191);function te(t){var e;const{collectionContextStore:o,sprintAutomationContext:n}=t,l=(0,a().IS)((t=>({summary:{display:"flex",alignItems:"center",justifyContent:"center",marginInlineStart:17,columnGap:5,color:t.text.tertiary,fontSize:c().J.UIRegular.desktop,fontWeight:c().Wy.regular,whiteSpace:"nowrap"},icon:{width:16,height:"auto",paddingTop:2}})),[]),{isPhone:s}=(0,i().Y0)(),u=(0,r().K8)((()=>{var t;const e=null===(t=n.automationContext)||void 0===t?void 0:t.automationStore.getRunAt();if(!e)return;const o=Qt().c9.fromMillis(e,{zone:"utc"}).toLocal().startOf("day"),r=Qt().c9.now().startOf("day"),i=o.diff(r,"days").days;return i<1?"soon":1===i?"today":2===i?"tomorrow":i-1}),[null===(e=n.automationContext)||void 0===e?void 0:e.automationStore]);return u?(0,st.jsx)(Gt,{taskCollectionContextStore:o,children:()=>s?null:(0,st.jsxs)("div",{style:l.summary,children:[(0,Xt().J)(l.icon),(0,st.jsx)(ee,{daysRemaining:u})]})}):null}function ee(t){const{daysRemaining:e}=t;return"soon"===e?(0,st.jsx)(s().sA,{id:"completeAutomationSprintAutomation.inlineSummary.endingSoon",defaultMessage:"Ending soon"}):"today"===e?(0,st.jsx)(s().sA,{id:"completeAutomationSprintAutomation.inlineSummary.endsToday",defaultMessage:"Ends today"}):"tomorrow"===e?(0,st.jsx)(s().sA,{id:"completeAutomationSprintAutomation.inlineSummary.endsTomorrow",defaultMessage:"Ends tomorrow"}):(0,st.jsx)(s().sA,{id:"completeAutomationSprintAutomation.inlineSummary.daysRemaining",defaultMessage:"Ends in {daysRemaining} days",values:{daysRemaining:e}})}const oe=function(t){var e;const{collectionContextStore:o}=t,n=(0,r().K8)((()=>o.completeSprintButtonContextStore.state),[o]),i=(0,r().K8)((()=>{var t;return Boolean(null==n||null===(t=n.automationContext)||void 0===t?void 0:t.automationStore.isActive())}),[null==n||null===(e=n.automationContext)||void 0===e?void 0:e.automationStore]);return n?i?(0,st.jsx)(te,{collectionContextStore:o,sprintAutomationContext:n}):(0,st.jsx)(Yt,{collectionContextStore:o,completeSprintAutomationContext:n}):null}},704452:(t,e,o)=>{o.d(e,{Ay:()=>R,C3:()=>z,tl:()=>D});o(898992),o(354520),o(581454),o(296540);var n=()=>o(56366),r=()=>o(799288),i=()=>o(335452),a=()=>o(343462),l=()=>o(927826),s=()=>o(478367),c=()=>o(662149),u=()=>o(214388),d=()=>o(597777),p=()=>o(681873),m=()=>o(799829),S=()=>o(179034),g=()=>o(824862),f=()=>o(519831),v=()=>o(437607),x=()=>o(798880),y=()=>o(695608),C=()=>o(69708),h=()=>o(496603),b=()=>o(534177),k=()=>o(284371),j=()=>o(649746),_=()=>o(16006),A=()=>o(654734),w=()=>o(148832),I=()=>o(258836),M=()=>o(543665),T=()=>o(764353),B=()=>o(870092),F=o(474848);const R=function({schema:t,propertyFilter:e,parentStore:r,valueOnly:l,style:s}){const c=(0,n().K8)((()=>{const n=t[e.property];if(n&&(0,o(898244).nC)(n))return(0,o(685889).LQ)(n,r)}),[t,e,r]),{filter:d}=e,p=(0,u().s1)(d)?d.subfilter:d,m=(0,a().M)(p)&&!(0,u().fZ)(d),S={...s,maxWidth:void 0};return(0,F.jsx)("span",{style:(0,i().n)(p)?S:s,children:(0,F.jsx)(C().sA,{defaultMessage:"{propertyName}{colonSeparator} {filterOperator} {propertyValue}",id:"database.filterBarFilterValue.title",values:{propertyName:l?void 0:(0,F.jsx)(P,{propertyFilter:e,schema:t}),colonSeparator:l||m?void 0:":",filterOperator:(0,F.jsx)(D,{propertyFilter:e}),propertyValue:(0,F.jsx)(z,{propertyFilter:e,schema:t,parentStore:r,relatedCollectionAppConfigUri:c})}})})};function V(){return(0,F.jsx)(C().sA,{defaultMessage:"Not",id:"database.filterBarFilterValue.notOperator"})}function P({propertyFilter:t,schema:e}){const o=e[t.property];return o?(0,F.jsx)("span",{style:{fontWeight:k().Wy.medium},children:o.name}):null}function D({propertyFilter:t}){const{filter:e}=t,o=(0,u().s1)(e)?e.subfilter:e;if((0,c().Y)(o))return"string_contains"===o.operator||"string_is"===o.operator?null:"string_does_not_contain"===o.operator||"string_is_not"===o.operator?(0,F.jsx)(V,{}):(0,F.jsx)(F.Fragment,{children:(0,j().J)(o.operator)});if((0,a().M)(o))return(0,F.jsx)(F.Fragment,{children:(0,j().J)(o.operator)});if((0,u().Ui)(o)){if("checkbox_is_not"===o.operator)return(0,F.jsx)(V,{})}else{if((0,u().v0)(o))return"enum_is"===o.operator?null:"enum_is_not"===o.operator?(0,F.jsx)(V,{}):(0,F.jsx)(F.Fragment,{children:(0,j().J)(o.operator)});if((0,u().as)(o))return"enum_contains"===o.operator?null:"enum_does_not_contain"===o.operator?(0,F.jsx)(V,{}):"enum_contains_all"===o.operator?null:(0,F.jsx)(F.Fragment,{children:(0,j().J)(o.operator)});if((0,u().H$)(o))return"status_is"===o.operator?null:"status_is_not"===o.operator?(0,F.jsx)(V,{}):(0,F.jsx)(F.Fragment,{children:(0,j().J)(o.operator)});if((0,u().Pq)(o))return"relation_contains"===o.operator?null:"relation_does_not_contain"===o.operator?(0,F.jsx)(V,{}):(0,F.jsx)(F.Fragment,{children:(0,j().J)(o.operator)});if((0,s().I)(o))return"person_contains"===o.operator?null:"person_does_not_contain"===o.operator?(0,F.jsx)(V,{}):(0,F.jsx)(F.Fragment,{children:(0,j().J)(o.operator)});if((0,u().G)(o)){if("location_is"===o.operator)return null;if("location_is_not"===o.operator)return(0,F.jsx)(V,{})}else if((0,i().n)(o)){if("date_is"===o.operator)return null;if("date_is_after"===o.operator)return(0,F.jsx)(C().sA,{defaultMessage:"After",id:"database.filterValue.dateType.dateIsAfter.title"});if("date_is_before"===o.operator)return(0,F.jsx)(C().sA,{defaultMessage:"Before",id:"database.filterValue.dateType.dateIsBefore.title"});if("date_is_on_or_after"===o.operator)return(0,F.jsx)(C().sA,{defaultMessage:"On or after",id:"database.filterValue.dateType.dateIsOnOrAfter.title"});if("date_is_on_or_before"===o.operator)return(0,F.jsx)(C().sA,{defaultMessage:"On or before",id:"database.filterValue.dateType.dateIsOnOrBefore.title"});if(!(0,u().Cw)(o))return(0,F.jsx)(F.Fragment,{children:(0,j().J)(o.operator)});{const t=o.value;if(!t.value||"exact"!==t.type||!(0,d().jS)(t.value))return(0,F.jsx)(F.Fragment,{children:(0,j().kz)(t)});if(t.value.start_date&&t.value.end_date)return null;if(t.value.start_date)return(0,F.jsx)(C().sA,{defaultMessage:"Starting",id:"database.filterValue.dateType.starting.title"});if(t.value.end_date)return(0,F.jsx)(C().sA,{defaultMessage:"Ending",id:"database.filterValue.dateType.ending.title"})}}else{if((0,u().uU)(o))return"verification_is"===o.operator?null:"verification_is_not"===o.operator?(0,F.jsx)(V,{}):(0,F.jsx)(F.Fragment,{children:(0,j().J)(o.operator)});(0,b().HB)(o)}}return null}function O({index:t}){return(0,F.jsx)("span",{style:{whiteSpace:"pre"},children:(0,F.jsx)(C().sA,{defaultMessage:", ",id:"database.filterValue.commaSeparator"})},t)}function z({propertyFilter:t,schema:e,parentStore:o,relatedCollectionAppConfigUri:n}){const{filter:r}=t,l=(0,u().s1)(r)?r.subfilter:r;if(!(0,u().gc)(l))return null;if((0,c().Y)(l)||(0,a().M)(l)){const t=l.value.value;if(void 0!==t)return(0,F.jsx)("span",{children:t})}else if((0,u().Ui)(l)){const t=l.value.value;if(!0===t)return(0,F.jsx)("span",{children:(0,F.jsx)(C().sA,{defaultMessage:"Checked",id:"database.filterValue.checkboxType.checked.title"})});if(!1===t)return(0,F.jsx)("span",{children:(0,F.jsx)(C().sA,{defaultMessage:"Unchecked",id:"database.filterValue.checkboxType.unchecked.title"})})}else{if((0,u().v0)(l)||(0,u().as)(l)){const t=(0,u().v0)(l)?(0,u().Zl)(l):(0,u().SM)(l),e=h().oE(t.map((({value:t})=>t)));return 0===e.length?null:(0,F.jsx)("span",{children:(0,p().G)(e,(t=>(0,F.jsx)(O,{index:t})))})}if((0,u().H$)(l)){const t=(0,u().V6)(l),e=h().oE(t.map((({value:t})=>t)));return 0===e.length?null:(0,F.jsx)("span",{children:(0,p().G)(e,(t=>(0,F.jsx)(O,{index:t})))})}if((0,u().Pq)(l)){const t=(0,u().Rh)(l),e=h().oE(t.map(((t,e)=>{if(!t.value)return null;const r=t.type;if("exact"===r){const e=w().B.createChildStore(o,{table:S().ev,id:t.value});return(0,F.jsx)(_().A,{style:{display:"inline"},store:e},t.value)}if("relative"===r){var i;if("builtin"===t.value.type)return n?(0,F.jsx)("span",{children:(0,F.jsx)(C().sA,{...null===(i=m().n$[n])||void 0===i||null===(i=i[t.value.variable])||void 0===i?void 0:i.messageDescriptor})},e):null;if("current_page_in_related_collection"===t.value.type)return(0,F.jsx)("span",{children:(0,F.jsx)(C().sA,{defaultMessage:"This page",id:"database.filterAndSort.currentPagePropertyValue.title"})},e)}else(0,b().HB)(r)})));return(0,F.jsx)(F.Fragment,{children:(0,p().G)(e,(t=>(0,F.jsx)(O,{index:t})))})}if((0,s().I)(l))return(0,F.jsx)(K,{useFilter:l,parentStore:o});if((0,u().G)(l)){const t=(0,u().GK)(l),e=h().oE(t.map((t=>{if(t.value){const e=t.value,n=M().m.createChildStore(o,{table:f().Vl,id:e});return(0,F.jsx)(_().A,{style:{display:"inline"},store:n},e)}})));return(0,F.jsx)(F.Fragment,{children:(0,p().G)(e,(t=>(0,F.jsx)(O,{index:t})))})}if((0,i().n)(l)){const o=e[t.property],n=(o&&"date"===o.type?o.date_format:void 0)||d().vz;let r;if("exact"===l.value.type){const t=l.value;if(t.value)if((0,d().$P)(t.value))r=t.value;else if((0,d().jS)(t.value)){const e=(0,d().dq)(t.value);e&&(r=e.value)}}else if(!(0,u().Cw)(l))return(0,F.jsx)(F.Fragment,{children:(0,j().RR)(l.value)});if(r)return(0,F.jsx)(A().A,{style:{display:"inline"},value:r,dateFormat:n,shortenDateAndRange:!0})}else{if((0,u().uU)(l)){const t=(0,u().ms)(l).filter((({value:t})=>Boolean(t))).map(j().w0);return 0===t.length?null:(0,F.jsx)("span",{children:(0,p().G)(t,(t=>(0,F.jsx)(O,{index:t})))})}(0,b().HB)(l)}}return null}function K({parentStore:t,useFilter:e}){const o=(0,C().tz)(),i=(0,l().W)(e),a=(0,n().K8)((()=>h().oE(i.map(((e,n)=>{if("relative"===e.type)return(0,F.jsx)("span",{children:(0,F.jsx)(C().sA,{defaultMessage:"Me",id:"database.filterValue.personType.firstPersonPropertyValue.title"})},n);if(e.value){const a=e.value;if(a.table===x().oo){const e=B().L.createChildStore(t,{table:a.table,id:a.id});return(0,F.jsx)("span",{children:(0,y().c6)(o,e.getModel())},n)}if(a.table===g().GP){const e=I().v.createChildStore(t,{table:a.table,id:a.id});return(0,F.jsx)("span",{children:(0,r().Hg)(e.getModel())},n)}if(a.table===v().n){var i;const e=T().C.createChildStore(t,{table:a.table,id:(0,v().gK)({spaceId:a.spaceId,spacePermissionGroupId:a.id}),spaceId:a.spaceId});return(0,F.jsx)("span",{children:null===(i=e.getModel())||void 0===i?void 0:i.getName()},n)}}})))),[i,t,o]);return(0,F.jsx)(F.Fragment,{children:(0,p().G)(a,(t=>(0,F.jsx)(O,{index:t})))})}},712257:(t,e,o)=>{o.d(e,{Hs:()=>F,B$:()=>R,m:()=>N,x1:()=>U,RQ:()=>V,RZ:()=>K,H2:()=>P,IU:()=>D,Ms:()=>L,Aq:()=>z,LS:()=>O});o(898992),o(354520),o(672577),o(581454),o(296540);var n=()=>o(908006),r=()=>o(214388),i=()=>o(62371),a=()=>o(206267),l=()=>o(792071),s=()=>o(496603),c=()=>o(534177),u=()=>o(885110),d=()=>o(471995),p=()=>o(231297),m=()=>o(755199),S=()=>o(447453),g=()=>o(467676),f=()=>o(914701),v=()=>o(763884),x=()=>o(764670);var y=()=>o(180762),C=()=>o(314660),h=()=>o(484714),b=()=>o(69708),k=()=>o(495262),j=()=>o(104012),_=o(474848);function A(){return(0,_.jsx)(b().sA,{defaultMessage:"Changes saved for everyone.",id:"database.filterBar.saved.title"})}function w(t){const{collectionContextStore:e,temporaryState:o}=t,n=(0,h().v3)();return(0,_.jsx)(j().Ag,{onClick:()=>{k().tN({environment:n,preventSelectText:!0}),d().N2(),D({environment:n,collectionContextStore:e,temporaryState:o})},children:(0,_.jsx)(b().sA,{defaultMessage:"Undo",id:"database.filterBar.undo.title"})})}var I=()=>o(942125),M=()=>o(588703),T=()=>o(765957),B=()=>o(790515);let F=function(t){return t[t.All=0]="All",t[t.Filters=1]="Filters",t[t.Sorts=2]="Sorts",t}({});function R(t){const{environment:e,collectionContextStore:o,targetCollectionViewStore:n,preventSnackbarNotification:r,type:i,transaction:a}=t,l=o.temporaryStateStore.state,s=o.currentPropertyFiltersStore.state,c=n.getPropertyFiltersStore(),u=(0,I().Ml)(o,"persisted");if(i===F.All||i===F.Filters){u.combinatorFilter&&(0,C().f)({collectionViewStore:n,update:{filter:u.combinatorFilter.value||null},transaction:a});for(const t of u.filters.removed)p().applyOperation({store:c,operation:{pointer:c.pointer,command:"keyedObjectListRemove",path:c.path,args:{remove:{id:t}}},transaction:a});for(const{id:t,beforeId:e}of u.filters.moveOps){const o=s.find((e=>e.id===t));o&&(e?p().applyOperation({store:c,operation:{pointer:c.pointer,command:"keyedObjectListBefore",path:c.path,args:{before:{id:e},value:o}},transaction:a}):p().applyOperation({store:c,operation:{pointer:c.pointer,command:"keyedObjectListAfter",path:c.path,args:{value:o}},transaction:a}))}for(const t of u.filters.updated){const e=s.find((e=>e.id===t));e&&p().applyOperation({store:c,operation:{pointer:c.pointer,command:"keyedObjectListUpdate",path:c.path,args:{value:e}},transaction:a})}}i!==F.All&&i!==F.Sorts||!u.sorts||(0,C().f)({collectionViewStore:n,update:{sort:u.sorts.value||null},transaction:a}),O({environment:e,collectionContextStore:o,temporaryState:i===F.All?void 0:i===F.Filters?{...l,combinatorFilter:void 0,propertyFilters:void 0}:{...l,sorts:void 0}}),r||d().D6({label:(0,_.jsx)(A,{}),right:(0,_.jsx)(w,{collectionContextStore:o,temporaryState:l})})}function V(t){const{environment:e,intl:o,collectionContextStore:r,transaction:i}=t,a=r.collectionViewStore(),l=r.isFullScreenStore.state,s=r.isRootChildStore.state,c=r.isInPeekRendererStore.state;if(!a)return;const d=r.collectionViewBlockStore(),p=(0,g().t)({environment:e,collectionViewBlockStore:d,collectionViewStore:a,intl:o,transaction:i});p&&(R({environment:e,type:F.All,collectionContextStore:r,targetCollectionViewStore:p,transaction:i}),p&&("chart"===p.getType()&&u().Z({environment:e,collectionContextStore:r,collectionViewId:p.id,from:"filter_save_as_new_view"}),(0,y().t)({environment:e,collectionContextStore:r,collectionViewId:p.id,isFullScreen:l,isRootChild:s,isInPeekRenderer:c}),n().default.afterNextFlush((()=>{(0,S().O)({collectionContextStore:r,collectionSettingsStore:r.settingsStore,selectViewNameInitial:!0})}))))}function P(t){const{environment:e,collectionContextStore:o}=t,n=o.currentPropertyFiltersStore.state,i=(0,I().Ml)(o,"normalized").filters.added,a=n.filter((t=>!(i.includes(t.id)&&(0,r().t_)(t.filter))));O({environment:e,collectionContextStore:o,temporaryState:{...o.temporaryStateStore.state,propertyFilters:{value:a}}})}function D(t){O(t),function(t){const{environment:e,collectionContextStore:o}=t,n=o.collectionViewStore(),r=o.collectionViewBlockStore();if(!n||!r)return;(o.isUnlistedViewStore.state&&o.isInlineViewStore.state||(0,M().r)({environment:e,store:r})&&o.permissionScopesStore.state.canConfigureBlock)&&p().createAndCommit({userAction:"collectionFilterActions.applyTemporaryStateIfPrivate",environment:e,canUndo:!0,perform:t=>{R({environment:e,collectionContextStore:o,type:F.All,targetCollectionViewStore:n,preventSnackbarNotification:!0,transaction:t})}})}(t)}function O(t){var e;const{environment:o,collectionContextStore:n,temporaryState:r}=t,i=n.collectionViewStore();if(!i)return;const a=o.currentUser.id;n.temporaryStateStore.setState(r||{}),function({currentUserId:t,collectionViewId:e,viewsModuleCurrentPageId:o,temporaryState:n}){const r=(0,x().l)({collectionViewId:e,viewsModuleCurrentPageId:o});n?v().K.set({userId:t,key:r,value:JSON.stringify(n)}):v().K.remove({userId:t,key:r})}({currentUserId:a,collectionViewId:i.id,viewsModuleCurrentPageId:n.viewsModuleContextStore.isInLayoutBuilder()||null===(e=n.viewsModuleContextStore.currentPageStore())||void 0===e?void 0:e.id,temporaryState:r}),n.groupsStore.resetAllLimits()}function z(t){const{environment:e,seen:o}=t,{currentUserSettingsStore:n}=T().default.state;n&&p().createAndCommit({userAction:"collectionFilterActions.setSeenFiltersIntroTooltip",environment:e,canUndo:!0,perform:t=>{m().mJ({userSettingsStore:n,transaction:t,data:{seen_filters_tooltip:o}})}})}function K({transaction:t,newGroups:e,collectionContextStore:o,environment:n}){var a;const l=o.collectionViewStore(),u=o.currentCombinatorFilterStore.state,d=(0,s().mg)(u),p=null==d||null===(a=d.filters)||void 0===a?void 0:a.find(r().B9),m=(0,I().I6)(o);if(!(l&&d&&d.filters&&p))return;const S=p.filter.value.filter((t=>"exact"===t.type)).map((t=>t.value)).filter(c().O9),g=e.map((t=>t.value)).filter(i().D1).map((t=>t.value)).filter(i().WO).map((t=>t.id)),f=(0,s().FF)(g,...S);0!==f.length&&(p.filter.value=[...p.filter.value,...f.map((t=>({type:"exact",value:t})))],O({environment:n,collectionContextStore:o,temporaryState:{...o.temporaryStateStore.state,combinatorFilter:{value:d}}}),m||R({environment:n,collectionContextStore:o,type:F.Filters,targetCollectionViewStore:l,preventSnackbarNotification:!0,transaction:t}))}function L(t){var e;const o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.id,n=t.getCurrentUserId();o&&n&&((0,f().E)({userId:n,collectionViewId:o,isOpen:!1}),t.filtersBarOpenStore.setState(!1))}function N(t){var e,o,n;const{collectionContextStore:r,environment:i,property:s,schema:c}=t,u=r.currentPropertyFiltersStore.state,d=u.find((t=>t.filter.property===s));if(d)return d;const p=(null===(e=r.collectionViewBlockStore())||void 0===e?void 0:e.getRecordModel)??l().b4_.constant(void 0),m=i.idCreator.getSpaceIdCreatorSync((null===(o=r.collectionViewStore())||void 0===o||null===(o=o.pointer)||void 0===o?void 0:o.spaceId)??""),S=(0,B().SO)({property:s,schema:c,getRecordModel:p,spaceIdCreator:m,collectionSource:null===(n=r.collectionViewStore())||void 0===n?void 0:n.getCollectionSource()});if(!S)return;const g={id:a().JW(),filter:S};return D({environment:i,collectionContextStore:r,temporaryState:{...r.temporaryStateStore.state,propertyFilters:{value:[...u,g]}}}),g}function U(t){const{collectionContextStore:e,environment:o}=t,n=e.currentCombinatorFilterStore.state;if(n)return n;const i=r().Lx;return D({environment:o,collectionContextStore:e,temporaryState:{...e.temporaryStateStore.state,combinatorFilter:{value:i}}}),i}},740689:(t,e,o)=>{o.d(e,{o:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"1.77 1.79 12.45 12.42",svg:(0,o(474848).jsx)("path",{d:"M8.709 1.978a.625.625 0 0 0-.884.884l.913.913H3.84c-1.14 0-2.065.925-2.065 2.065v4.78a.625.625 0 0 0 1.25 0V5.84c0-.45.365-.815.815-.815h4.898l-.913.913a.625.625 0 0 0 .884.884l1.98-1.98a.625.625 0 0 0 0-.884zM13.6 4.755a.625.625 0 0 0-.625.625v4.78c0 .45-.365.815-.815.815H7.263l.913-.913a.625.625 0 1 0-.884-.884l-1.98 1.98a.625.625 0 0 0 0 .884l1.98 1.98a.625.625 0 1 0 .884-.884l-.913-.913h4.897c1.14 0 2.065-.924 2.065-2.065V5.38a.625.625 0 0 0-.625-.625"})},r=(0,o(340498).wt)("arrowSquareLeftRightSmall",n)},765101:(t,e,o)=>{o.d(e,{Ni:()=>l,U7:()=>a,rY:()=>s});o(296540);var n=()=>o(69708),r=()=>o(521855),i=o(474848);function a({origin:t}){return(0,i.jsx)(r().B,{origin:t,placementToOrigin:"bottom",style:{minWidth:240},tutorialId:"sprints-onboarding",tutorialStepId:"current-sprint-view-tooltip",header:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.SprintBoardView.header",defaultMessage:"Manage the current sprint"}),content:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.SprintBoardView.content",defaultMessage:"Add tasks and update task status as your team makes progress during the sprint."})})}function l({origin:t}){return(0,i.jsx)(r().B,{origin:t,placementToOrigin:"bottom",tutorialId:"sprints-onboarding",tutorialStepId:"sprint-task-tooltip",header:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.SprintBoardItem.header",defaultMessage:"Change tasks status"}),content:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.SprintBoardItem.content",defaultMessage:"Drag this task to In progress."})})}function s({origin:t}){return(0,i.jsx)(r().B,{origin:t,placementToOrigin:"bottom",style:{minWidth:240},tutorialId:"sprints-onboarding",tutorialStepId:"complete-sprint-button-tooltip",header:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.CompleteSprintButton.header",defaultMessage:"Complete this sprint"}),content:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.CompleteSprintButton.content",defaultMessage:"Click the button when youre done with this sprint."})})}},778708:(t,e,o)=>{o.d(e,{Dl:()=>ot,U2:()=>Y,Zk:()=>nt,_R:()=>J,bE:()=>rt,c:()=>X,cJ:()=>et,eN:()=>tt,e_:()=>G,g4:()=>$,qy:()=>Q});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(803949),o(581454),o(737550);var n=()=>o(906745),r=()=>o(584262),i=()=>o(66689),a=()=>o(890409),l=()=>o(898244),s=()=>o(597777),c=()=>o(604995),u=()=>o(206267),d=()=>o(273900),p=()=>o(912720),m=()=>o(199378),S=()=>o(179034),g=()=>o(519831),f=()=>o(96689),v=()=>o(854150),x=()=>o(950914),y=()=>o(864779),C=()=>o(201980),h=()=>o(908447),b=()=>o(966759),k=()=>o(559506),j=()=>o(873039),_=()=>o(896628),A=()=>o(384944),w=()=>o(867201),I=()=>o(231297),M=()=>o(345913),T=()=>o(755199),B=()=>o(479788),F=()=>o(374562),R=()=>o(235059),V=()=>o(813297),P=()=>o(465364),D=()=>o(147503),O=()=>o(496592),z=()=>o(654062),K=()=>o(601734),L=()=>o(594794),N=()=>o(972435),U=()=>o(111379),H=()=>o(148832),E=()=>o(543665);const W="week";function J(t){const{environment:e,transaction:o,tasksBlockStore:n,sprintsBlockStore:r}=t,i=r.getCollectionPointerIfSingleSource(),a=n.getCollectionPointerIfSingleSource();if(!i||!a)return;const l=E().m.createChildStore(r,i),s=l.getRole()??"none";if(!(0,d().q_)(s,"editor"))return;l.getAutomationStores().some((t=>t.isCompleteSprintAutomation()))||q({environment:e,transaction:o,sprintCollectionStore:l,taskCollectionStore:E().m.createChildStore(n,a),sprintSettingsConfig:x().AL})}function q(t){const{environment:e,sprintSettingsConfig:o,transaction:n,sprintCollectionStore:r,taskCollectionStore:i}=t,a=r.getSpaceId(),l=(0,L().Z1)({environment:e,table:p().yB,spaceId:a}),s=(0,L().Z1)({environment:e,table:m().SC,spaceId:a});A().eC({environment:e,table:p().yB,inMemoryRecordCache:r.inMemoryRecordCache,value:{id:l,parent_id:r.id,parent_table:r.table,alive:!0,space_id:a,status:o.autoCompleteSprints?"active":"disabled",trigger:{id:u().JW(),type:"recurrence",recurrence:at(o)},action_ids:[s]},transaction:n}),_().zA({stores:[r],update:{automation_ids:[...r.getFormat().automation_ids??[],l]},transaction:n}),A().vt({environment:e,table:m().SC,inMemoryRecordCache:r.inMemoryRecordCache,transaction:n,args:{id:s,version:1,parent_id:l,parent_table:p().yB,type:"complete_sprint",alive:!0,space_id:a,config:{sprint_collection:r.getSpaceShardedPointer(),task_collection:i.getSpaceShardedPointer(),complete_sprint_action:o.actionConfig.complete_sprint_action}}})}function G(t){const{environment:e,automationStore:o,transaction:n,newDuration:r,currentSprintBlockStore:i}=t;A().zv({store:o.getTriggerStore().getKeyStore("recurrence"),data:{interval:r},transaction:n}),Z({environment:e,transaction:n,automationStore:o,currentSprintBlockStore:i})}function $(t){const{environment:e,automationStore:o,transaction:n,newWeekday:r,currentSprintBlockStore:i}=t;A().zv({store:o.getTriggerStore().getKeyStore("recurrence"),data:{weekdays:[r]},transaction:n}),Z({environment:e,transaction:n,automationStore:o,currentSprintBlockStore:i})}function Y(t){const{environment:e,actionStore:o,automationStore:n,transaction:r,newAutocompleteStatus:i,currentSprintBlockStore:l}=t;A().zv({store:n,data:{status:i?"active":"disabled"},transaction:r}),Z({environment:e,transaction:r,automationStore:n,currentSprintBlockStore:l});const s=n.getParentPointer();if(!s||s.table!==g().Vl)return;const c=(0,B().Q)(e),u={automation_id:n.id,automation_actions:[{automation_action_id:o.id,type:"complete_sprint"}],automation_triggers:[{type:"recurrence"}],collection_id:s.id};i?(0,a().Ah)(c,u):(0,a().vN)(c,u)}function Z(t){const{automationStore:e,currentSprintBlockStore:o,transaction:r,environment:a}=t;if(!e.isActive())return;const l=e.getRecurrence();if(!l)return;const c=(0,y().Vv)(l);if(!c)return;const u=o.getPropertyValue(i().Hx.Dates);if(!u)return;const d=(0,C().Cok)(u)[0];if(!d||"daterange"!==d.type)return;const p=d.start_date,{start_date:m,end_date:S}=(0,y().Me)({currentSprintStartDate:p,sprintSchedule:c});A().zv({store:e.getTriggerStore().getKeyStore("recurrence"),data:{start_date:(0,s().Rz)(n().c9.fromISO(m).plus({minutes:1}).toJSDate())},transaction:r}),P().D5({store:o,propertyId:i().Hx.Dates,transaction:r,environment:a,type:"dateValue",dateValue:{type:"daterange",start_date:p,end_date:S}})}function Q(t){const{transaction:e,newRemainingTasksBehavior:o,actionStore:n}=t;A().zv({store:n.getConfigStore(),data:{complete_sprint_action:o},transaction:e})}async function X(t){var e;const{appTemplatesSetupActions:o,appTemplatesSprintBoardActions:n,appConfigs:a}=await K().Aw.load(),{environment:l,collectionContextStore:s,from:c}=t,u=s.collectionStore(),d=null==u?void 0:u.getParentCollectionViewBlockStore(),p=null==d?void 0:d.getParentStore(),m=null==u||null===(e=u.getFormat())||void 0===e?void 0:e.app_config_uri,g=m&&(0,R().l)(a(),m),x=u?(0,U().k)(u.getSpaceId()):void 0;if(!u||!d||!p||!x||p.table!==f().NX&&p.table!==S().ev&&p.table!==v().yK||!g)return;const y=d.getFormat().app_id,C=y?await k().callApi({eventName:"getCollectionViewBlocksByAppId",environment:l,data:{spaceId:d.getSpaceId(),appId:y}}):void 0,b="success"===(null==C?void 0:C.type)&&C.data.result.length?C.data.result.map((t=>H().B.createChildStore(p,{table:S().ev,id:t.blockId,spaceId:d.getSpaceId()}))):[d];await it({environment:l,taskCollectionStore:u,executeFn:()=>{const t=I().createAndCommit({userAction:"sprintSettingsActions.handleTurnOnSprints",environment:l,canUndo:!0,perform:t=>{const e=(0,F().We)(),r=o.applyTypedFeatures({environment:l,spaceViewStore:x,appParentStore:p,appUri:g.uri,features:[{type:"simple",featureUri:e.uri}],transaction:t,createOrModify:"modify",appCollectionViewBlockStores:b}),a=n.createSprintPage({environment:l,spaceViewStore:x,appParentStore:p,transaction:t,blockStores:r,creationEntryPoint:{type:"sprint_settings"}});D().os({collectionSettingsStore:s.settingsStore});const u=c?{feature:{id:i().yx.TaskToSprintRelation,from:c,type:"notion://projects/tasks_with_sprints_feature"}}:{};return(0,h().Z)({environment:l,collectionContextStore:s,from:"view_settings",property:i().yx.TaskToSprintRelation,property_type:"relation",is_suggested_property:!0,property_id:i().yx.TaskToSprintRelation,...u}),a}});t.serverCommitResult.then((()=>{const e=t.performResult;e&&w().Y({environment:l,store:e,pageVisitSource:r().y8.Create})}))}})}async function tt(t){const{environment:e,collectionContextStore:o,sprintSettingsContext:n,sprintBoardViewBlockIds:a}=t,{sprintCollectionStore:l,automationContext:s,currentCollectionViewBlockStore:c,sprintCollectionViewBlockStore:u,taskCollectionStore:d,taskCollectionViewBlockStore:p}=n;if(!l||!u||!s)return;const m=p.getSpaceId(),g=[...u.getCollectionPointerIfSingleSource()?[u]:[],...a.map((t=>new(H().B)(e,{id:t,table:S().ev,spaceId:m})))];c.id===p.id?D().os({collectionSettingsStore:o.settingsStore}):w().Y({environment:e,store:p,pageVisitSource:r().y8.LeaveOrRemove});const{automationActions:f}=await V().QV.automations.load(),{automationStore:v}=s;await it({environment:e,taskCollectionStore:d,executeFn:()=>{I().createAndCommit({userAction:"sprintSettingsActions.handleTurnOffSprints",environment:e,canUndo:!0,perform:t=>{p.id===u.id&&(0,O().removeCollectionFromCollectionViewBlock)({collectionViewBlockStore:p,collectionStore:l,transaction:t}),function(t){const{transaction:e,blocksToDelete:o,environment:n,taskCollectionStore:r,sprintCollectionStore:a}=t;A().zv({store:a,transaction:e,data:{alive:!1}}),(0,j().B)({environment:n,collectionStore:r,schema:r.getSchema(),property:i().yx.TaskToSprintRelation,transaction:e,permanentlyDelete:!0}),M().oD({environment:n,blocks:o,transaction:e,permanentlyDelete:!0})}({environment:e,transaction:t,blocksToDelete:g,sprintCollectionStore:l,taskCollectionStore:d}),f.disableAutomation({automationStore:v,environment:e,transaction:t}),f.deleteAutomation({automationStore:v,environment:e,transaction:t})}}),(0,b().i)({environment:e,collectionContextStore:o,property_type:"relation",from:"view_settings",property:i().yx.TaskToSprintRelation})}})}function et(t){const{environment:e,userSettingsStore:o}=t;I().createAndCommit({userAction:"sprintSettingsActions.handleSeenSprintsEngagementBanner",environment:e,canUndo:!0,perform:t=>{T().mJ({userSettingsStore:o,data:{seen_sprint_settings_engagement_banner:!0},transaction:t})}})}function ot(t){t.settingsStore.setState({open:!0,stack:[{type:"main"},{type:"sprintSettings"}]})}function nt(t){const{environment:e,collectionContextStore:o,currentViewBlockStore:n,taskCollectionViewBlockStore:r}=t,a=o.collectionViewStore();if(!a)return;const l=a.getFormat(),s=a.getRawQuery();I().createAndCommit({userAction:"sprintSettingsActions.handleManageSprintFromThisView",environment:e,canUndo:!0,perform:t=>{if((0,z().F)({collectionViewStore:a,transaction:t,update:{name:N().A.formatMessage(F().DZ.tasksCurrentSprintV2ViewName),query2:{...s,filter:void 0},format:{...l,collection_view_icon:"/icons/playback-play-button_gray.svg",property_filters:F().Wo,app_config_uri:i().Lu,hide_linked_collection_name:!0}}}),n.id===r.id){var e;const o=(null===(e=n.getFormat())||void 0===e?void 0:e.app_uri_map)??{},s=l.app_config_uri;s&&delete o[s],_().zA({stores:[r],update:{app_uri_map:{...o,[i().Lu]:a.id}},transaction:t})}}})}function rt(t){const{environment:e,sprintSettingsContext:o}=t;if(!o)return;const n=o.sprintCollectionStore,r=(null==n?void 0:n.getRole())??"none";n&&(0,d().q_)(r,"editor")&&o.automationContextLoaded&&!o.automationContext&&I().createAndCommit({userAction:"sprintSettingsActions.ensureCompleteSprintAutomation",environment:e,canUndo:!0,perform:t=>{q({environment:e,transaction:t,sprintCollectionStore:n,taskCollectionStore:o.taskCollectionStore,sprintSettingsConfig:x().AL})}})}async function it(t){const{executeFn:e,environment:o,taskCollectionStore:n}=t;await async function(t){var e;const{environment:o,taskCollectionStore:n}=t,r=n.getFormat().app_uri_map,a=i().yx.TaskToSprintRelation,s=n.getSchema(),c=(null==r?void 0:r[a])??a,u=s[c];if(!u||!(0,l().nC)(u))return;const d=null===(e=(0,l().Nv)(u))||void 0===e?void 0:e.id;if(!d)return;const p=new Set([c]);Object.entries(s).forEach((([t,e])=>{var o;e&&(0,l().nC)(e)&&(null===(o=(0,l().Nv)(e))||void 0===o?void 0:o.id)===d&&p.add(t)}));const{serverCommitResult:m}=I().createAndCommit({userAction:"sprintSettingsActions.clearSprintRelationDataFromTaskCollection",environment:o,canUndo:!0,perform:t=>{for(const e of p)(0,j().B)({environment:o,transaction:t,permanentlyDelete:!0,collectionStore:n,schema:s,property:e});null==r||delete r[a],r&&_().zA({stores:[n],transaction:t,update:{app_uri_map:r}})}});await m}({environment:o,taskCollectionStore:n}),e()}function at(t){return{frequency:W,interval:t.recurrenceConfig.interval,weekdays:t.recurrenceConfig.weekdays,start_date:(0,s().Rz)(n().c9.local().set({hour:0,minute:0,second:0,millisecond:0}).toJSDate()),timezone:(0,c().dB)(),hour:0,minute:0}}},866913:(t,e,o)=>{o.d(e,{q:()=>d});o(898992),o(354520),o(581454);var n=o(296540),r=()=>o(56366),i=()=>o(436696),a=()=>o(712257),l=()=>o(249947),s=()=>o(147503),c=()=>o(406792),u=o(474848);const d=n.memo((function(t){const{collectionContextStore:e,collectionSettingsStore:d,collectionViewStore:p,context:m,filter:S,schema:g}=t,f=(0,o(484714).v3)(),v=(0,r().K8)((()=>(0,o(427537).H)(e)),[e]),x=(0,r().K8)((()=>{var t;return S?null==e||null===(t=e.collectionStore())||void 0===t||null===(t=t.getSchema()[S.filter.property])||void 0===t?void 0:t.type:void 0}),[e,S]),y=(0,n.useCallback)((()=>{o(726637).A.isMobile&&a().H2({environment:f,collectionContextStore:e}),s().os({collectionSettingsStore:d})}),[e,d,f]),C=(0,n.useCallback)((t=>{var n;if(!S)return;const r=null===(n=e.remoteResultStore.state)||void 0===n?void 0:n.sizeHint,l=c().default.DO_NOT_USE_markLegacy("collections.update_filter_lag");c().default.DO_NOT_USE_measureAfterNextFlushLegacy(l,{environment:f,getData:()=>o(476492).K6({from:"property_filter",property_type:x,collectionContextStore:e,sizeHintAtStart:r})});const s=S.filter,u=e.currentPropertyFiltersStore.state.map((e=>{if(e.id===S.id){return{...S,filter:{...s,filter:t}}}return e}));a().IU({environment:f,collectionContextStore:e,temporaryState:{...e.temporaryStateStore.state,propertyFilters:{value:u}}}),(0,i().X)({environment:f,collectionContextStore:e,action:"update_property_filter",original_view_type:void 0,property_type:x})}),[e,f,S,x]),h=(0,o(395361).Y)(C,250),b=(0,n.useCallback)((()=>{var t;if(!S)return;const o=e.currentPropertyFiltersStore.state.filter((t=>t.id!==S.id));a().IU({environment:f,collectionContextStore:e,temporaryState:{...e.temporaryStateStore.state,propertyFilters:{value:o}}}),(0,i().X)({environment:f,collectionContextStore:e,action:"delete_property_filter",original_view_type:void 0,property_type:null==e||null===(t=e.collectionStore())||void 0===t||null===(t=t.getSchema()[S.filter.property])||void 0===t?void 0:t.type})}),[e,f,S]),k=(0,n.useCallback)((()=>{var t;if(!S)return;const{combinatorFilter:n,propertyFilters:r}=(0,o(790515).$4)(e,S);a().IU({environment:f,collectionContextStore:e,temporaryState:{...e.temporaryStateStore.state,propertyFilters:{value:r},combinatorFilter:{value:n}}});const l=m===o(392459).aV.FilterBar?e.filterBarCombinatorFilterSettingsStore:e.filterOptionsCombinatorFilterSettingsStore;s().R8({collectionSettingsStore:l,item:{type:"filter"}}),(0,i().X)({environment:f,collectionContextStore:e,action:"merge_filter_into_combinator",property_type:null==e||null===(t=e.collectionStore())||void 0===t||null===(t=t.getSchema()[S.filter.property])||void 0===t?void 0:t.type})}),[e,m,f,S]);return(0,u.jsx)(l().td,{collectionViewId:p.id,propertyFilter:S.filter,schema:g,parentStore:p,onChange:C,onChangeDebounced:h,onClose:y,onDelete:b,onAddToCombinatorFilter:k,context:l().mL.PropertyFilter,userCanConfigureFilters:v,allowRelativeDateFilter:!0,allowRelativePersonFilter:!0,collectionContextStore:e})}))},876077:(t,e,o)=>{o.d(e,{t:()=>r});var n=()=>o(38337);function r(t){return t<=0?"":t%2==0?n().nhj:n().ueJ}},914701:(t,e,o)=>{o.d(e,{E:()=>i});var n=()=>o(763884),r=()=>o(540022);function i(t){const e=(0,r().N)(t.collectionViewId);n().K.set({userId:t.userId,key:e,value:t.isOpen})}}}]);