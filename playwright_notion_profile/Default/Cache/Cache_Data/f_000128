"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[10442],{88061:(e,t,r)=>{r.r(t),r.d(t,{ENGLISH_PERSONAL_PRONOUNS:()=>Fe,TEST_ONLY__getVisibleSpaceUserIds:()=>Re,checkIsTrashEmpty:()=>Ie,getLocalCacheFromAppState:()=>he,getSpaceBotIds:()=>Ce,isPersonalPronoun:()=>Ve,searchActorsById:()=>Le,searchBots:()=>Be,searchCollections:()=>be,searchCollectionsWithRecents:()=>_e,searchEmailUser:()=>ze,searchInstallableIntegrations:()=>qe,searchLocalNavigableBlocks:()=>we,searchMentionablePages:()=>We,searchPageIds:()=>ye,searchPageIdsInAncestor:()=>ve,searchPagesInCollection:()=>ge,searchPagesInSpace:()=>Se,searchPublicPages:()=>He,searchSpaceActorIds:()=>Oe,searchSpaceActors:()=>Me,searchSpaceBots:()=>ke,searchSpaceGroups:()=>Pe,searchSpaceUsers:()=>Ee,searchTeams:()=>De,searchUsers:()=>Te,searchUsersByNameWithNoSpaces:()=>Ue,searchVisibleSpaceUsers:()=>Ne});r(16280),r(944114),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(354520),r(672577),r(430670),r(581454);var s=r.n(r(844751)),a=()=>r(564884),n=()=>r(242422),o=()=>r(929219),i=()=>r(799288),c=()=>r(313491),l=()=>r(842599),d=()=>r(617871),u=()=>r(165358),p=()=>r(792071),m=()=>r(142748),h=()=>r(936802),S=()=>r(68263),y=()=>r(388821),g=()=>r(179034),f=()=>r(824862),v=()=>r(519831),I=()=>r(96689),b=()=>r(848538),_=()=>r(798880),w=()=>r(620333),P=()=>r(245241),k=()=>r(468006),C=()=>r(201980),B=()=>r(695608),q=()=>r(778078),A=()=>r(496603),T=()=>r(763824),U=()=>r(973647),E=()=>r(534177),N=()=>r(720665),x=()=>r(559506),V=()=>r(908928),F=()=>r(518362),R=()=>r(288782),M=()=>r(47373),O=()=>r(569028),z=()=>r(227894),L=()=>r(422366),W=()=>r(315004),G=()=>r(847585),H=()=>r(329443),D=()=>r(825972),K=()=>r(780865),j=()=>r(698449),Q=()=>r(406792),X=()=>r(696746),J=()=>r(765957),Y=()=>r(605402),$=()=>r(21735),Z=()=>r(977870),ee=()=>r(968172),te=()=>r(20199),re=()=>r(558407),se=()=>r(148832),ae=()=>r(258836),ne=()=>r(543665),oe=()=>r(870092),ie=()=>r(271084),ce=()=>r(224701),le=()=>r(134217),de=()=>r(749240);function ue({environment:e,localSearchAnalytics:t,eventProperties:r}){t&&(0,a().u)({environment:e,event:{eventName:"relation_property_menu_local_search_bug",eventProperties:{search_session_id:t.searchSessionId,...r}}})}var pe=()=>r(690978),me=()=>r(448433);async function he({environment:e,localSearchAnalytics:t}){const{sidebarSpaceStore:r,sidebarSpaceViewStore:s,currentUserSettingsStore:a,currentUserStore:o}=J().default.state;if(!r)return;const i=n().default.checkGate({gateName:"search_use_local_search_cache",enableEventTrailLogging:!0}),c=n().default.checkGate({gateName:"timeout_for_local_searchable_blocks_cache",enableEventTrailLogging:!0});if(i){if(ue({environment:e,localSearchAnalytics:t,eventProperties:{search_step:"use_local_search_cache_before"}}),te().A.state.localSearchableBlocksCache)return ue({environment:e,localSearchAnalytics:t,eventProperties:{search_step:"use_local_search_cache_already_loaded"}}),te().A.state.localSearchableBlocksCache;if(ue({environment:e,localSearchAnalytics:t,eventProperties:{search_step:"use_local_search_cache_before_loading"}}),c)try{await Promise.race([te().A.waitUntil((()=>Boolean(te().A.state.localSearchableBlocksCache))),new Promise(((e,t)=>setTimeout((()=>t(new Error("Cache load timeout"))),2e3)))])}catch(l){return void ue({environment:e,localSearchAnalytics:t,eventProperties:{search_step:"use_local_search_cache_timed_out"}})}else await te().A.waitUntil((()=>Boolean(te().A.state.localSearchableBlocksCache)));return ue({environment:e,localSearchAnalytics:t,eventProperties:{search_step:"use_local_search_cache_after_loading"}}),te().A.state.localSearchableBlocksCache}return ue({environment:e,localSearchAnalytics:t,eventProperties:{search_step:"get_searchable_blocks_before"}}),await(0,me().h)({environment:e,sidebarSpaceStore:r,sidebarSpaceViewStore:s,localSearchAnalytics:t,currentUserSettingsStore:a,currentUserStore:o})}async function Se(e){const{environment:t,query:r,limit:s,currentPageId:a,searchSessionId:n,searchSessionFlowNumber:o,recentlyMentionedPageIds:i,spaceId:c,requireEditPermissions:l,excludeTemplates:d,source:u,boostRecentlyViewedPages:p,ignoresHighlight:m,filterOverrides:h,spaceStore:S,peopleBlocksToInclude:g}=e,f={results:[],recordMap:y().RecordMapWithRole.create().toJson(),total:0,trackEventProperties:void 0};if(!S)return f;const v=await he({environment:t}),I=P().N2({isDeletedOnly:!1,navigableBlockContentOnly:!0,excludeTemplates:d,requireEditPermissions:l||void 0,...h}),b=await t.idCreator.getSpaceIdCreator(c),{filters:_,excludedBlockIds:k}=(0,w().CT)({peopleBlocksToInclude:g,spaceIdCreator:b,filters:I,excludedBlockIds:void 0}),C={field:"relevance"};if(!r&&v){const e=(0,pe().searchAndRerankLocalPages)({query:{query:{text:r,filters:_,sort:C},limit:s},localCachedPages:v,userId:t.currentUser.id,environment:t,spaceStore:S});return e||f}const B=await x().callApi({eventName:"search",environment:t,data:{type:P().Vz.BlocksInSpace,query:r,spaceId:c,currentPageId:a,searchSessionId:n,searchSessionFlowNumber:o,recentlyMentionedPageIds:i,limit:s,filters:_,sort:C,source:u,recentPagesForBoosting:p?(0,D().cs)(ee().A.getWithoutSubscribing(c)):void 0,ignoresHighlight:m,excludedBlockIds:k}});if("failed"===B.type)throw B.error;return B.data}async function ye(e){const t=await Se(e);return{results:t.results.map((e=>e.id)),recordMap:t.recordMap}}async function ge(e){const{environment:t,query:r,collectionId:s,limit:a,spaceId:n,excludeTemplates:o,source:i,includePublicPagesWithoutExplicitAccess:c,boostRecentlyViewedPages:l,ignoresHighlight:d,localSearchAnalytics:u}=e,p=new Array;if(u){const e=JSON.stringify(localStorage).length/1024;ue({environment:t,localSearchAnalytics:u,eventProperties:{search_step:"load_records_before",local_storage_size_kb:Math.trunc(e)}})}const m=await he({environment:t,localSearchAnalytics:u});ue({environment:t,localSearchAnalytics:u,eventProperties:{search_step:"load_records_after"}});const h=P().N2({isDeletedOnly:!1,navigableBlockContentOnly:!0,includePublicPagesWithoutExplicitAccess:c,excludeTemplates:o}),S={field:"relevance"},y=x().callApi({eventName:"search",environment:t,data:{type:P().Vz.BlocksInCollection,query:r,spaceId:n,collectionId:s,limit:a,filters:h,sort:S,source:i,recentPagesForBoosting:l?(0,D().cs)(ee().A.getWithoutSubscribing(n)):void 0,ignoresHighlight:d}});if(m){const e={table:v().Vl,id:s,spaceId:n},o=new(ne().m)(t,e);await o.load();const i=(0,pe().searchAndRerankLocalPages)({query:{query:{text:r,filters:o.isPageTreeCollection()?{...h,ancestors:[s]}:{...h,parentId:s},sort:S},limit:a},localCachedPages:m,userId:t.currentUser.id,environment:t,spaceStore:o.getSpaceStore()});i&&p.push(...i.results)}const g=await y;if("failed"===g.type){if(0===p.length)throw g.error}else{let e=g.data.results;r||(e=K().Fj({sort:S,batchSize:a,currentUserId:t.currentUser.id,unsorted:e})),p.push(...e)}return{results:A().oE(A().sb(p.map((e=>e.id))))}}async function fe(e){const{environment:t,query:r,ancestorId:s,limit:a,excludeTemplates:n,source:o,currentPageId:i,searchSessionId:c,searchSessionFlowNumber:l,recentlyMentionedPageIds:d,ignoresHighlight:u,includePublicPagesWithoutExplicitAccess:p,spaceId:m,peopleBlocksToInclude:h}=e,S=P().N2({navigableBlockContentOnly:!0,excludeTemplates:n,includePublicPagesWithoutExplicitAccess:p});let y,g=S;if(m){const e=await t.idCreator.getSpaceIdCreator(m),r=(0,w().CT)({peopleBlocksToInclude:h,spaceIdCreator:e,filters:S,excludedBlockIds:void 0});g=r.filters,y=r.excludedBlockIds}const f=await x().callApi({eventName:"search",environment:t,data:{type:P().Vz.BlocksInAncestor,query:r,ancestorId:s,filters:g,sort:{field:"relevance"},limit:a,source:o,spaceId:m,currentPageId:i,searchSessionId:c,searchSessionFlowNumber:l,recentlyMentionedPageIds:d,ignoresHighlight:u,excludedBlockIds:y}});if("failed"===f.type)throw f.error;return f.data}async function ve(e){return{results:(await fe(e)).results.map((e=>e.id))}}async function Ie(e){const{sidebarSpaceStore:t,currentUserStore:r}=J().default.state;if(!t||!r)return!1;const s=await async function(e){const{environment:t,query:r,limit:s,spaceId:a}=e,n=0===r.trim().length?{field:"lastEdited",direction:"desc"}:{field:"relevance"},o=P().N2({isDeletedOnly:!0,navigableBlockContentOnly:!0,excludeTemplates:!1,editedBy:e.editedByIds||[],ancestors:e.ancestorIds||[],inTeams:e.teamspaceIds||[]}),i=await t.idCreator.getSpaceIdCreator(a),{filters:c,excludedBlockIds:l}=(0,w().CT)({peopleBlocksToInclude:"none",spaceIdCreator:i,filters:o,excludedBlockIds:void 0}),d=x().callApi({eventName:"search",environment:t,data:{type:P().Vz.BlocksInSpace,query:r,filters:c,sort:n,limit:s,spaceId:a,source:"trash",excludedBlockIds:l}}),u=await d;if("failed"===u.type)throw u.error;{const{results:e,recordMap:t,total:r}=u.data;return{results:e.map((e=>e.id)),recordMap:y().RecordMapWithRole.create(t),endOfResultsReached:r===e.length}}}({environment:e,query:"",limit:1,spaceId:t.id,ancestorIds:[],editedByIds:[],teamspaceIds:[]});return 0===s.results.length}async function be(e,t){const{query:r,limit:s,source:a,requireEditPermissions:n,databaseType:o,spaceStore:i,searchSessionId:c,peopleBlocksToInclude:l}=t;if(!i)return{results:[],total:0};const d=i.id,u=P().N2({excludeTemplates:!0,requireEditPermissions:n,databaseType:o}),p=await e.idCreator.getSpaceIdCreator(d),{filters:m,excludedBlockIds:h}=(0,w().CT)({peopleBlocksToInclude:l,spaceIdCreator:p,filters:u,excludedBlockIds:void 0}),[S,y]=await Promise.all([Ke(e,{...t,spaceId:d,requireEditPermissions:n,databaseType:o,parentStore:i,excludedBlockIds:h}),x().callApi({eventName:"search",environment:e,data:{type:P().Vz.CollectionsInSpace,query:r,spaceId:d,limit:s,filters:m,sort:{field:"relevance"},source:a,recentPagesForBoosting:(0,D().cs)(ee().A.get(d)),searchSessionId:c,excludedBlockIds:h}})]),g=A().KC("success"===y.type?A().oE(y.data.results.map((e=>e.collectionId))):[],S).slice(0,s);return{results:g,total:"success"===y.type?y.data.total:g.length}}async function _e(e){const{environment:t,collectionViewBlockStore:r,spaceStore:s,parentStore:a,query:n,limit:o,requireEditPermissions:i,databaseType:c,searchSessionId:l,peopleBlocksToInclude:d}=e;let u=[],p=0;if(!n){const e=t.currentUser.id;if(s){const r=t.idCreator.getSpaceIdCreatorSync(s.id),n=(0,h().FS)({spaceIdCreator:r}),o=(0,F().F)({currentUserId:e,spaceId:s.id});let i;switch(d){case"none":case"person_profiles":i=o.filter((e=>e!==n));break;case"all":case"collection_view_page":i=o;break;default:(0,E().HB)(d)}u=i.map((e=>ne().m.createChildStore(a,{table:v().Vl,id:e})))}u=[...A().oE(null==r?void 0:r.getCollectionViewStores().map((e=>e.getCollectionStore()))),...u],c&&(u=u.filter((e=>{const t=e.getDatabaseType();return!!t&&c.includes(t)}))),u=A().hS(u,(e=>e.id)).filter((e=>!i||e.canEdit()))}const m=await be(t,{query:n,limit:o,source:"collection_settings_source",requireEditPermissions:i,databaseType:c,spaceStore:s,searchSessionId:l,peopleBlocksToInclude:d});return u=[...u,...m.results.map((e=>ne().m.createChildStore(a,{table:v().Vl,id:e})))],p=m.total,u=u.filter((e=>!(0,G().z)(e)&&e.canRead())),await Promise.all(u.map((async e=>{await e.load()}))),{results:A().hS(u,(e=>e.id)).slice(0,o).map((e=>e.id)),total:p}}async function we(e){const{environment:t,searchQuery:r,blockTypes:s,sidebarSpaceStore:a,sidebarSpaceViewStore:n,currentUserSettingsStore:i,currentUserStore:c,limit:l,parentId:d}=e,u=await(0,me().h)({environment:t,sidebarSpaceStore:a,sidebarSpaceViewStore:n,currentUserSettingsStore:i,currentUserStore:c}),p={query:{text:r,filters:(0,P().N2)({requireEditPermissions:!1,isDeletedOnly:!1,excludeTemplates:!0,navigableBlockContentOnly:!0,blockTypes:s,parentId:d}),sort:{field:"relevance"}},limit:l},m=(0,pe().getLocalFrecencyRankedSearchResultsWithStore)({query:p,localCachedPages:u,parentStore:a,spaceStore:a,isOnline:o().A.state.online,environment:t,shouldLimitLocalResultsWhenOnline:!1,applyScoreThresholdWhenOnline:!0,canUseLtr:!1});return m&&U().Q.isSuccess(m)?m.value.results.filter((e=>e.store.pathIsAccessibleAndAlive())):[]}function Pe(e){const{query:t,intl:r,limit:s}=e,a=Y().A.state.permissionGroupsAndMemberCounts.map((e=>e.group));if(0===a.length)return[];return(t?(0,q().Ay)(t,a,(e=>(0,j().Pf)({intl:r,groupName:e.name})),{normalizeFuzzyScore:!0}):a).slice(0,s)}async function ke(e){const{query:t,limit:r}=e,{sidebarSpaceStore:s}=J().default.state;if(!s)return[];return Be({parentStore:s,query:t,botIds:await Ce(e)}).slice(0,r)}async function Ce(e){const{environment:t}=e,{sidebarSpaceStore:r}=J().default.state;if(!r)return[];const s=r.id,a=await V().Ju({environment:t,table:I().NX,id:s,type:"guest"});return A().sb(a.botIds)}function Be(e){const{parentStore:t,query:r,botIds:s}=e,a=A().oE(s.map((e=>{const r=ae().v.createChildStore(t,{table:f().GP,id:e});if(r.getAlive())return r.getValue()})));return r?(0,q().Ay)(r,a,i().tb):a}async function qe(e){const{query:t,environment:r,spaceId:s,botSettings:a}=e;if(!s)return[];const n=await x().callApi({eventName:"searchIntegrations",environment:r,data:{query:t}});if("success"===n.type){const e=n.data.integrationIds,t=a&&a.integration_approval_statuses?Object.keys(a.integration_approval_statuses):[],r=Boolean(null==a?void 0:a.integration_restrictions),s=Boolean("approved_or_built_by_notion"===(null==a?void 0:a.integration_restrictions));return r?e.filter((e=>s?t.includes(e)||(0,d().CX)({integrationId:e}):t.includes(e))):e}if("failed"===n.type)throw n.error;(0,E().HB)(n)}const Ae=new Set(["gmail.com","yahoo.com","hotmail.com","outlook.com","icloud.com","aol.com"]);async function Te({environment:e,parentStore:t,query:r,userIds:s,minFuzzyScore:o,placeSelfFirst:i}){var c;const d=Q().default.mark("user_search_latency"),p=n().default.checkGate({gateName:"search_batch_load_users"}),m=T().lX(s,p?300:Math.max(s.length,1),(async e=>{const r=oe().L.createChildStore(t,{table:_().oo,id:e});return await r.load(),r.getValue()}));(await(0,T().nQ)(1e4,[m])).timeout&&(u().log({level:"error",from:"searchActions.searchUsers",type:"UserStoreLoadTimeoutV1",error:{message:"The UserStore.load()'s took longer than 10 seconds"},data:{searchedUserIdCount:s.length,queryLength:r.length,parentStoreLoaded:t.isReady(),documentVisibilityState:document.visibilityState}}),(0,a().u)({environment:e,event:{eventName:"user_search_timeout",eventProperties:{searchedUserIdCount:s.length,queryLength:r.length,parentStoreLoaded:t.isReady(),documentVisibilityState:document.visibilityState}}}));const h=A().oE(await m);let S;const y=null===(c=J().default.state.currentUserStore)||void 0===c?void 0:c.userId;if(i&&y){const e=h.findIndex((e=>y===e.id));e>-1&&(S=h[e],h.splice(e,1))}const g=ie().k.state??{},f=Math.max(...Object.values(g));function v(e){var t;return e===(null===(t=J().default.state.currentUserRootStore)||void 0===t?void 0:t.userId)?f+1e-5:g[e]??0}const I=A().Im(g)?h:h.sort(((e,t)=>{const r=v(e.id);return v(t.id)-r})),b=new Set(t.getEmailDomains()),w=r?(0,q().Ay)(r,I,B().T2,{minThreshold:o,getSortScore:e=>{const{original:t,score:r}=e,s=t.email&&(0,l().zN)(t.email),a=S&&(0,l().zN)(S.email),n=s&&b.has(s),o=a===s,i=a&&Ae.has(a);return r*(n||o&&!i?-2:-1)}}):h;return Q().default.measure(d,{environment:e}),S?[S,...w]:w}async function Ue(e){const{environment:t,query:r,membersOnly:s,shouldUseEdgeCacheRollout:a}=e;if(a&&$().A.state.shouldUseEdgeCache){const e=J().default.state.sidebarSpaceStore;if(!e)return[];const a=n().default.getConfigKey("email_alias_migration","mode"),o=await x().callApi({eventName:"listUsers",environment:t,data:{cursor:void 0,membershipFilter:s?"members":void 0,limit:1,uniqueNameWithoutSpaces:r,spaceId:e.id,includeAliasSearch:(0,c().K)(a)}});if("success"!==o.type||0===o.data.users.length)return[];const i=oe().L.createChildStore(e,{table:_().oo,id:o.data.users[0].id});await i.load();const l=i.getModel();return l?[l]:[]}return(await Ne({environment:t,query:r,membersOnly:s})).map((e=>p().Bj6.fromValue(_().oo,e)))}async function Ee(e){const t=e.shouldUseEdgeCacheRollout&&$().A.state.shouldUseEdgeCache;return Z().c.state.wasGetVisibleUsersCalled||u().log({level:"error",from:"searchSpaceUsers",type:"getVisibleUsersNotCalled",data:{routeName:e.environment.RouterStore.state.route.name}}),t?async function(e){const{environment:t,membersOnly:r,minFuzzyScore:s=1e3,placeSelfFirst:a,limit:o}=e,{sidebarSpaceStore:i,mainEditorCurrentBlockStore:l,currentUserStore:d}=J().default.state;if(!i)return[];const u=e.query.startsWith("@")?e.query.slice(1):e.query,p=ie().k.getSortedUserIds().slice(0,100),m=l&&!r?(0,H().i0)(l).flatMap((({permissionItem:e})=>(0,S().B2)(e)?[e.user_id]:[])):[],h=await Te({environment:e.environment,parentStore:i,query:u,userIds:A().sb([...A().oE([null==d?void 0:d.userId]),...p,...m]),minFuzzyScore:s,placeSelfFirst:a});if(o&&h.length>=o)return h.slice(0,o);const y=n().default.getConfigKey("email_alias_migration","mode"),g=await x().callApi({eventName:"listUsers",environment:t,data:{cursor:void 0,membershipFilter:r?"members":void 0,limit:o?o-h.length:100,query:u,spaceId:i.id,includeAliasSearch:(0,c().K)(y)}});if("success"!==g.type||0===g.data.users.length)return h;const f=g.data.users.sort(((e,t)=>{var r,s;const a=(null===(r=ie().k.state)||void 0===r?void 0:r[e.id])??0;return((null===(s=ie().k.state)||void 0===s?void 0:s[t.id])??0)-a})),v=await(0,T().lX)(f,f.length,(async e=>{const t=oe().L.createChildStore(i,{table:_().oo,id:e.id});return await t.load(),t.getValue()}));return A().hS([...h,...A().oE(v)],(e=>e.id))}(e):Ne(e)}async function Ne(e){const{sidebarSpaceStore:t}=J().default.state;if(!t)return[];const r=e.query.startsWith("@")?e.query.slice(1):e.query,s=await xe(e);return(await Te({environment:e.environment,parentStore:t,query:r,userIds:s,minFuzzyScore:e.minFuzzyScore,placeSelfFirst:e.placeSelfFirst})).slice(0,e.limit)}async function xe(e){const{environment:t,membersOnly:r}=e,{sidebarSpaceStore:s}=J().default.state;if(!s)return[];await ce().iV({environment:t,spaceId:s.id});const a=de().subscriptionDataStoreInstance.state;if(!a)return[];const n=(0,le().Be)(a).filter((e=>!(r&&!(0,b().MN)(e.membershipType)))),{mainEditorCurrentBlockStore:o,currentUserStore:i}=J().default.state,c=o&&!r?(0,H().i0)(o).flatMap((({permissionItem:e})=>(0,S().B2)(e)?[e.user_id]:[])):[],l=(0,M().Qd)()&&o?function(e,t){const r=(0,L().U)(e);if(r){const e=new Set((0,k().gm)({membership:r.getRawMembership()}));return t.filter((t=>"none"!==t.membershipType||t.isPageGuest||t.isTeamGuest&&e.has(t.userId)))}return t.filter((e=>"none"!==e.membershipType||e.isPageGuest))}(o,n):n,d=l.map((e=>e.userId));return A().sb([...A().oE([null==i?void 0:i.userId]),...c,...d])}function Ve(e,t){return!(!t.startsWith("en-")||!Fe.has(e.toLowerCase()))}const Fe=new Set(["me","you","i"]),Re=xe;async function Me(e){const{query:t}=e,[r,s]=await Promise.all([Ee({...e,placeSelfFirst:""===t||Ve(t,e.userLocale)}),ke(e)]);return{users:r,bots:s}}async function Oe(e){const[t,r]=await Promise.all([xe(e),Ce(e)]);return{userIds:t,botIds:r}}async function ze(e,t){const r=(0,l().qh)(t);if((0,l().DT)(r)&&r){const t=await x().callApi({eventName:"findUser",environment:e,data:{email:r}});if("failed"===t.type)throw t.error;const s=t.data;return s.value?{user:s.value.value}:{email:r}}return{}}async function Le(e){const{query:t,userIds:r,botIds:s,store:a,environment:n}=e;let o=a;if(!o){const{sidebarSpaceStore:e}=J().default.state;if(!e)return{users:[],bots:[]};o=e}return{users:await Te({environment:n,parentStore:o,query:t,userIds:r}),bots:Be({parentStore:o,query:t,botIds:s})}}async function We(e){const{nearBlock:t,environment:r,query:s,source:a,searchSessionId:n,searchSessionFlowNumber:o}=e,{sidebarSpaceStore:i}=J().default.state,c=(0,R().s)(),l="collection_view_page",d=t&&(0,H().i0)(t).find((({permissionItem:e})=>(0,S().FP)(e))),u=re().A.getMentionedIds(r.currentUser.id);if(i){return Ge(await Se({environment:r,query:s,limit:20,spaceId:i.id,currentPageId:c,searchSessionId:n,searchSessionFlowNumber:o,recentlyMentionedPageIds:u,requireEditPermissions:!1,excludeTemplates:!0,source:a,boostRecentlyViewedPages:!0,ignoresHighlight:!0,spaceStore:i,peopleBlocksToInclude:l}))}if(d&&d.from.table===g().ev){return Ge(await fe({environment:r,query:s,limit:20,ancestorId:d.from.blockId,excludeTemplates:!0,source:a,currentPageId:c,searchSessionId:n,searchSessionFlowNumber:o,recentlyMentionedPageIds:u,ignoresHighlight:!0,peopleBlocksToInclude:l}))}return[]}function Ge(e){const{trackEventProperties:t,results:r}=e,s=(0,N().MU)((0,E().WP)(t).map((([e,t])=>[`server-${e}`,t])));return r.map((e=>({...e,serverEventProperties:s})))}async function He(e){const{environment:t,query:r,source:s,limit:a}=e,{sidebarSpaceStore:n}=J().default.state;if(!n)return[];return(await Se({environment:t,query:r,limit:a||20,spaceId:n.id,requireEditPermissions:!0,excludeTemplates:!0,source:s,boostRecentlyViewedPages:!1,spaceStore:n,peopleBlocksToInclude:"none"})).results.filter((e=>{const t=se().B.createChildStore(n,{table:g().ev,id:e.id}),r=(0,O().E)(t);return(0,m().ot)(r)}))}async function De({spaceViewStore:e,query:t,teamStores:r}){const s=A().oE(await Promise.all(r.map((async e=>(await e.load(),e.getValue()))))),a=e.getTeamsStores(),n=new Set(a.map((e=>e.id)));return t?(0,q().Ay)(t,s,(e=>e.name),{getSortScore:e=>{const{original:t,score:r}=e;return r*(n.has(t.id)?-2:-1)}}):s}function Ke(e,t){const{query:r,limit:a,spaceId:n,requireEditPermissions:o,databaseType:i,excludedBlockIds:c}=t,l=[];if(a>0){const d=new AbortController;e.defaultRecordCache.inMemoryRecordCache.forEachRecord(e.currentUser.id,(({model:e,role:u})=>{if(e.table===v().Vl){const p=e.space_id===n,m=!o||(0,S().p2)(u);if(!p||!m||(0,X().Nh)(e.getParentId()))return;const h=e.getDatabaseType();if(!(!i||h&&i.includes(h)))return;const y=(0,C().q4_)(e.getName());if(!s().test(r,y))return;const g=ne().m.createChildStore(t.parentStore,e.pointer),f=(0,z().g)(g);if(!(0,W().y)(f))return;const v=e.getParentPointer();if(c.includes(v.id))return;l.push(e.pointer.id),l.length>=a&&d.abort()}}),d.signal)}return l}}}]);