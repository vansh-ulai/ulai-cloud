"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[56369,92754],{295434:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>i,zendeskIcon:()=>r});o(296540);const i={viewBox:"0 0 20 20",fittedViewBox:"1 3.14 18.01 13.71",svg:(0,o(474848).jsx)("path",{fill:"#000",d:"M9.298 6.778v10.073H1zm0-3.633a4.16 4.16 0 0 1-4.17 4.17C2.817 7.315 1 5.457 1 3.145zm1.363 13.665a4.16 4.16 0 0 1 4.17-4.17A4.16 4.16 0 0 1 19 16.81zm0-3.592V3.145H19z"})},r=(0,o(340498).wt)("zendesk",i)},433519:(e,t,o)=>{o.d(t,{i:()=>p});o(581454);var i=o.n(o(794148)),r=()=>o(534177);var a=()=>o(192845),n=()=>o(165358),d=()=>o(792071),l=()=>o(696706),c=()=>o(912720),s=()=>o(199378);function p(e){var t,o;const{originalRecord:p,duplicateRecord:u,mapper:_,options:m,actor:f}=e,v=l().L3.fromSpaceShardRecordId({id:p.id,spaceId:p.space_id},c().yB);u.copied_from_pointer=v;const g=(null===(t=_({requested:l().L3.fromPointerLike({table:u.parent_table,id:u.parent_id,spaceId:u.space_id}),requester:v}))||void 0===t?void 0:t.id)??u.parent_id;u.parent_id=g;const b=(u.action_ids??[]).map((e=>{var t;return(null===(t=_({requested:l().L3.fromPointerLike({table:s().SC,id:e,spaceId:u.space_id}),requester:v}))||void 0===t?void 0:t.id)??e}));u.action_ids=b;const I=Date.now();u.created_time=I,u.last_edited_time=I,u.last_executed_time=void 0,u.last_failed_time=void 0,u.last_failed_reason=void 0,(0,r().O9)(null===(o=u.properties)||void 0===o?void 0:o.schedule_id)&&(u.properties.schedule_id=void 0),(0,r().O9)(f)&&(u.created_by_id=f.id,u.created_by_table=f.table,u.last_edited_by_id=f.id,u.last_edited_by_table=f.table),"recurrence"===u.trigger.type&&m.shouldDisableRecurrenceAutomation&&(u.status="disabled_duplication"),function(e){return"event"===e.trigger.type}(u)&&function(e){var t;const{duplicateRecord:o,mapper:r,originalRecord:l}=e,s=d().Bj6.fromAutomation(o);i()(s.isEventType());const p={id:l.id,spaceId:l.space_id,table:c().yB},{value:u}=(0,a().n)({automationModel:s,visitors:{visitCollectionProperty:void 0,visitRecordPointer:e=>{const t=r({requested:e,requester:p});if(t){const e=t.spaceId??o.space_id;return e!==o.space_id?{type:"replace",value:void 0}:{type:"replace",value:{...t,spaceId:e}}}return{type:"replace",value:void 0}}}});i()(u.isEventType());const _=u.getTrigger();o.trigger=_;const m={sourceAutomationParentId:l.parent_id,sourceAutomationId:l.id,sourceAutomationName:(null===(t=l.properties)||void 0===t?void 0:t.name)??""};o.trigger.event.source||(n().log({data:{miscDataToConvertToString:m},from:"duplicateHelpers.duplicateAutomationEventValueHelper",level:"info",type:"duplicateAutomationMissingTriggerSource"}),o.status="disabled")}({duplicateRecord:u,mapper:_,originalRecord:p})}},522328:(e,t,o)=>{o.d(t,{I:()=>v});o(898992),o(354520),o(581454),o(737550);var i=()=>o(534177),r=()=>o(496603),a=()=>o(239381),n=()=>o(792071),d=()=>o(696706),l=()=>o(199378),c=()=>o(519831),s=()=>o(192845);function p(e){const{duplicatedAction:t,mapper:o,options:p,originOptions:u,sourceSpaceId:_}=e,m=n().Bj6.fromAutomationAction(t),f=m.pointer;const v=({requested:e,requester:t})=>{return i=e.id,Boolean((null==p?void 0:p.isTemplateInstantiation)&&p.sourceBlockIds.has(i))?e:o({requested:e,requester:t});var i};function g(e){const t=(0,a().y5)(e);if("action"===t.source){var o;const e=d().L3.fromSpaceShardRecordId({id:t.action_id,spaceId:m.space_id},l().SC),i=(null===(o=v({requested:e,requester:f}))||void 0===o?void 0:o.id)??t.action_id;return(0,a().$y)({...t,action_id:i})}if("global"===t.source)return e;(0,i().HB)(t)}const b=m.pointer,{remappedRecordPointers:I,value:y}=(0,s().G)({automationActionModel:m,baseUrl:u.baseUrl,preventClearingConfig:!1,publicDomainName:u.publicDomainName,sourceSpaceId:_,visitors:{visitCollectionProperty:void 0,visitCollectionPropertyPointer:e=>{const o=v({requested:e,requester:b});if(o){const i=o.spaceId??t.space_id;return i!==t.space_id||o.table!==c().Vl?{type:"replace",value:void 0}:{type:"replace",value:{...o,propertyId:e.propertyId,spaceId:i}}}return(e.spaceId??t.space_id)!==t.space_id?{type:"replace",value:void 0}:{type:"keep"}},visitFormulaContextValue:e=>({type:"replace",value:g(e)}),visitFormulaPageProperty:e=>{if("collection"in e&&e.collection){const o=v({requested:e.collection,requester:f});if(o&&o.table===c().Vl){const i=o.spaceId??t.space_id;return i!==t.space_id?{type:"replace",value:void 0}:{type:"replace",value:{...e,collection:{...o,spaceId:i}}}}}else if("contextValueId"in e&&e.contextValueId)return{type:"replace",value:{...e,contextValueId:g(e.contextValueId)}};return{type:"keep"}},visitRecordPointer:e=>{const o=v({requested:e,requester:b});if(o){const e=o.spaceId??t.space_id;return e!==t.space_id?{type:"replace",value:void 0}:{type:"replace",value:{...o,spaceId:e}}}return(e.spaceId??t.space_id)!==t.space_id?{type:"replace",value:void 0}:{type:"keep"}}}}),k=y.getConfig();if(t.config=k,!(0,r().Im)(k))return I}var u=()=>o(537012),_=()=>o(273900),m=()=>o(813690),f=()=>o(179034);function v(e){const{originalRecord:t,duplicateRecord:o,mapper:r,getRecordRole:a,options:n,originOptions:c,duplicateBlocks:s=!0}=e,v=t.space_id!==o.space_id,g={table:l().SC,id:t.id,spaceId:t.space_id},b=r({requested:d().L3.fromPointerLike({table:o.parent_table,id:o.parent_id,spaceId:o.space_id}),requester:g}),I=p({duplicatedAction:o,mapper:r,options:n.resolveAutomationConfig,originOptions:c,sourceSpaceId:t.space_id});let y=a;I&&(y=m().Oj.tryUntilFound(...Array.from(I).map((e=>m().Oj.constantForPointer(e,"editor"))),y));const k=(null==b?void 0:b.id)??o.parent_id;if(o.parent_id=k,v&&"http_request"===o.type&&o.config){o.config.url=void 0;for(const e of o.config.customHeaders??[])e.value=""}const q=(0,u().Mn)(o);if(q){q.some((e=>{const t=y(e.pointer);return!t||!(0,_().q_)(t,e.minimumRequiredRole)}))&&(o.config={})}const C=(o.blocks??[]).map((e=>{var t;return null===(t=r({requested:d().L3.fromPointerLike({table:f().ev,id:e,spaceId:o.space_id}),requester:g}))||void 0===t?void 0:t.id})).filter(i().O9);o.blocks=C.length>0?C:void 0,s||(o.blocks=void 0)}},824438:(e,t,o)=>{o.d(t,{j:()=>we});o(944114),o(898992),o(908872);var i=()=>o(726637),r=()=>o(175482),a=(o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(803949),o(581454),o(737550),()=>o(496603)),n=()=>o(534177),d=()=>o(700500),l=()=>o(898244),c=()=>o(641007),s=()=>o(206267),p=()=>o(792071),u=()=>o(134025),_=()=>o(912720),m=()=>o(199378),f=()=>o(179034),v=()=>o(201980);function g(e){var t;const{blockValue:o,factoryButtonDeprecationContext:i,source:r}=e,a=function(e){return p().Bj6.fromValue(f().ev,e).getCreatedByPointer()??{id:c().rb.id,table:c().rb.table}}(o),n=o.space_id,d=s().JW(),l=s().JW(),u=i.isRootBlockFactoryBlock&&i.isCurrentBlockRootBlock?i.rootTextContainerId:s().JW(),g=function(e){const{automationActionId:t,textContainerBlockId:o,creatorPointer:i,originalBlockValue:r,spaceId:a,blockContent:n}=e;return{table:f().ev,value:{id:o,space_id:a,alive:!0,parent_table:m().SC,parent_id:t,type:"text",version:0,content:n,created_time:r.created_time,created_by_table:i.table,created_by_id:i.id}}}({automationActionId:l,textContainerBlockId:u,creatorPointer:a,originalBlockValue:o,blockContent:"duplication"===r?null===(t=o.content)||void 0===t?void 0:t.map((t=>e.pointerMapper({id:t,table:f().ev}).id)):o.content,spaceId:n}),b=function(e){const{automationId:t,automationActionId:o,spaceId:i,textContainerBlockId:r}=e;return{table:m().SC,value:{id:o,space_id:i,alive:!0,parent_table:_().yB,parent_id:t,type:"duplicate_blocks",blocks:[r],version:0,config:void 0}}}({automationActionId:l,automationId:d,creatorPointer:a,originalBlockValue:o,spaceId:n,textContainerBlockId:u}),I=function(e){var t;const{creatorPointer:o,automationActionId:i,originalBlockValue:r,spaceId:a,automationId:n}=e,d=s().JW(),l=Date.now();return{table:_().yB,value:{id:n,space_id:a,alive:!0,trigger:{id:d,type:"button"},parent_id:r.id,parent_table:f().ev,action_ids:[i],status:"active",properties:{name:(0,v().q4_)(null===(t=r.properties)||void 0===t?void 0:t.title)},created_by_id:o.id,created_by_table:o.table,created_time:r.created_time??l,last_edited_time:r.last_edited_time??l,version:0,last_edited_by_id:r.last_edited_by_id??o.id,last_edited_by_table:r.last_edited_by_table??o.table}}}({automationActionId:l,automationId:d,creatorPointer:a,originalBlockValue:o,spaceId:n});return{textContainerBlock:g,automation:I,automationAction:b}}o(354520);class b{constructor(e,t,i){this.childToParentMap=new Map,this.unmappedContentIds=new Set,this.extraTranscludedChildren=new(o(99895).G)((()=>new Set)),this.logWarning=t,this.createCopyIndicator=i;for(const{model:o}of e)if(o instanceof p().zgg)for(const t of o.getContentPointers()){e.getModel(t)?this.childToParentMap.has(t.id)?this.extraTranscludedChildren.get(t.id).add(o.id):this.childToParentMap.set(t.id,o.pointer.id):this.unmappedContentIds.add(t.id)}!this.createCopyIndicator&&this.logWarning&&this.logWarning({type:"multiReferencedContentIds",contentIds:Array.from(this.extraTranscludedChildren.keys())})}remapDuplicateBlockParent(e){const{originalBlockPointer:t,duplicateMapper:o}=e,i=this.childToParentMap.get(t.id);if(!i)return;const r=o({requested:{table:f().ev,id:i},requester:t});return r&&r.table===f().ev?r:void 0}createCopyIndicatorBlockValue(e){const{type:t,targetSpaceId:i,sourceBlockId:r,duplicateParentId:a,createdBy:n,createOptions:l,additionalRecordsToMutate:c}=e,{model:u}=p().zgg.create({id:(0,s().JW)(),type:d().xd.copyIndicator,space_id:i,parentPointer:{id:a,table:f().ev,spaceId:i},createdBy:n},{useCrdt:o(807427).I()}),_=u.__IM_SORRY__getValue();return l.onCreate({type:t,duplicateBlockId:_.id,sourceBlockId:r,duplicateParentId:a}),c.push({table:f().ev,value:_}),_.id}remapDuplicateBlockContent(e){const{originalBlockPointer:t,duplicateMapper:o,originalBlockContent:i,originalCreatedBy:r,duplicateBlockId:a,targetSpaceId:d}=e,l=[];return{content:i.map((e=>{if(this.createCopyIndicator&&this.extraTranscludedChildren.has(e)&&this.extraTranscludedChildren.get(e).has(t.id))return this.createCopyIndicatorBlockValue({type:"multi-transcluded-content",targetSpaceId:d,sourceBlockId:e,duplicateParentId:a,createdBy:r,createOptions:this.createCopyIndicator,additionalRecordsToMutate:l});const i=o({requested:{table:f().ev,id:e},requester:t});return i?i.id:this.isUnmappedContentId(e)?this.createCopyIndicator?this.createCopyIndicatorBlockValue({type:"unmapped-content",targetSpaceId:d,sourceBlockId:e,duplicateParentId:a,createdBy:r,createOptions:this.createCopyIndicator,additionalRecordsToMutate:l}):void(null===(n=this.logWarning)||void 0===n||n.call(this,{type:"unmappedContentId",block:t,contentId:e})):e;var n})).filter(n().O9),additionalRecords:l}}isUnmappedContentId(e){return this.unmappedContentIds.has(e)}}var I=()=>o(728396);function y(e,t,o){if((0,I().A8)(e)||(0,I().Jc)(e))return[];const i=[];return o&&i.push(...o),null!=t&&t.previousViewsMainCollectionViewBlockPointer&&i.push(t.previousViewsMainCollectionViewBlockPointer.id),i}var k=()=>o(142748),q=()=>o(813690),C=()=>o(388821),B=()=>o(696706),h=()=>o(519831),R=()=>o(869558),w=()=>o(37165),P=()=>o(144081),T=()=>o(161479),x=()=>o(123382),S=()=>o(743246);o(16280);function M(e){const{mapper:t,requested:o,requester:i,table:r}=e,a=V({mapper:t,requested:o,requester:i});if(!(0,B().Yt)(a,r))throw new Error(`Expected mapped duplicate for ${o.table} ${o.id} to be a ${r}, but it is a ${a.table} (while duplicating ${i.table} ${i.id})`);return a}function V(e){const{mapper:t,requested:o,requester:i}=e,r=t({requested:o,requester:i});if(!r)throw new Error(`Unable to find mapped duplicate for ${o.table} ${o.id} while duplicating ${i.table} ${i.id}`);return r}var O=()=>o(522328),L=()=>o(433519),D=()=>o(498212),A=()=>o(973647),U=()=>o(720665),j=()=>o(189141),F=()=>o(612740),E=()=>o(31503);const N="415fc269-e68f-4da0-b3e3-b1273b741a7f";var W=()=>o(651124),z=()=>o(68263),G=()=>o(651784),$=()=>o(824862),J=()=>o(665344);var H=()=>o(931075);function Q(e){return e.type!==d().xd.collectionViewPage&&(!e.content||0===e.content.length)}var Y=()=>o(457671),K=()=>o(142406);function Z({originalSpaceId:e,duplicateSpaceId:t,requester:o,collectionPointer:i,mapper:r}){const a=e===t,n=r({requested:i,requester:o})??(a?i:void 0);if(n){if(n.table!==h().Vl)throw new Error(`Collection pointer for duplicate collection is invalid: ${JSON.stringify(n)}`);return n}}function X(e){var t,o,i,r,l,s,u,m,b,I,y,k,q,C,B,w,P,x;const{originalBlock:M,duplicateBlock:V,mapper:O,options:L,originOptions:X,rewiredUriMap:ee,typedCollectionViewBlocks:te,actor:oe,helperRecordMap:ie,factoryButtonDeprecationContext:re,legacyTransclusionFixer:ae,installationImprint:ne,shouldExcludeBlocksFromLimit:de=!1}=e,le={table:f().ev,id:M.id,spaceId:M.space_id};if(null!==(t=M.format)&&void 0!==t&&t.app_config_uri&&null!==(o=V.format)&&void 0!==o&&o.app_config_uri)if((0,W().Sn)(M.format.app_config_uri))V.format.app_config_uri=void 0;else{if((0,d().Ef)(V.type)&&(te.push({table:f().ev,id:V.id,spaceId:V.space_id}),V.format.app_id)){const e=O({requested:{table:f().ev,id:V.format.app_id,spaceId:V.space_id},requester:le,generateDeterministicId:!0});e&&(V.format.app_id=e.id)}ee[M.id]=V.id}if(null!==(i=M.format)&&void 0!==i&&i.app_uri_map&&null!==(r=V.format)&&void 0!==r&&r.app_uri_map)for(const[a,n]of Object.entries(M.format.app_uri_map)){const e=O({requested:{id:n,table:f().ev,spaceId:V.space_id},requester:le});e&&(V.format.app_uri_map[a]=e.id??n,e.id&&(ee[e.id]=V.id))}const ce=[];if(V.crdt_data&&delete V.crdt_data,V.crdt_format_version&&delete V.crdt_format_version,null!==(l=V.format)&&void 0!==l&&l.site_id&&delete V.format.site_id,null!==(s=V.format)&&void 0!==s&&s.marketplace_listing_id&&delete V.format.marketplace_listing_id,null!==(u=V.format)&&void 0!==u&&u.slug&&delete V.format.slug,null!==(m=V.format)&&void 0!==m&&m.trigger_id_to_schedule_id&&delete V.format.trigger_id_to_schedule_id,null!==(b=V.format)&&void 0!==b&&b.duplication_job_ids&&delete V.format.duplication_job_ids,"factory"===V.type&&re){const{automation:e,automationAction:t,textContainerBlock:o}=g({blockValue:V,source:"duplication",pointerMapper:e=>O({requested:e,requester:le})??e,factoryButtonDeprecationContext:re});ce.push(e,t,o),re.factoryBlockIdToNewTextContainerIdMap.set(M.id,{id:o.value.id,table:f().ev});const i=V;i.type="button",i.content=[],i.format={...i.format,automation_id:e.value.id}}let se;if((0,D().uj)(M.id)&&(V.format||(V.format={}),V.format.copied_from_pointer={table:f().ev,id:M.id,spaceId:M.space_id},V.copied_from=M.id),M.parent_table===f().ev&&(se=null==re?void 0:re.factoryBlockIdToNewTextContainerIdMap.get(M.parent_id)),se??=(null==ae?void 0:ae.remapDuplicateBlockParent({originalBlockPointer:le,duplicateMapper:O}))??O({requested:{table:V.parent_table,id:V.parent_id,spaceId:V.space_id},requester:le}),se&&(V.parent_id=se.id,V.parent_table!==se.table&&(0,F().LA)(se)&&(V.parent_table=se.table)),null!==(I=V.format)&&void 0!==I&&I.ai_instructions_page_pointer&&(V.format.ai_instructions_page_pointer=O({requested:V.format.ai_instructions_page_pointer,requester:le})),null!==(y=V.format)&&void 0!==y&&y.ai_skill_pointer&&(V.format.ai_skill_pointer=O({requested:V.format.ai_skill_pointer,requester:le})),null!==(k=V.format)&&void 0!==k&&k.ai_block_configuration_menu){const e=(0,j().p8)(V.format.ai_block_configuration_menu);if(A().Q.isSuccess(e)){const t={...e.value};if("context"in t){const e=(t.context??[]).map((e=>{const t=M.space_id===V.space_id;if("slack"!==e.type||t){if("page"===e.type||"currentPage"===e.type){var o;const i=null===(o=O({requested:{table:f().ev,id:e.pageId,spaceId:V.space_id},requester:le}))||void 0===o?void 0:o.id;if(!i)return t?e:void 0;return{type:e.type,pageId:i}}if("collection"===e.type){var i,r;const o=null===(i=O({requested:{table:f().ev,id:e.pageId,spaceId:V.space_id},requester:le}))||void 0===i?void 0:i.id;if(!o)return t?e:void 0;const a=null===(r=O({requested:{table:h().Vl,id:e.collectionId,spaceId:V.space_id},requester:le}))||void 0===r?void 0:r.id;return a?{type:"collection",pageId:o,collectionId:a}:t?e:void 0}return e}})).filter(n().O9);t.context=e}V.format.ai_block_configuration_menu=t}}const pe=V;pe.view_ids&&(pe.view_ids=pe.view_ids.map((e=>{var t;return(null===(t=O({requested:{table:R().Gy,id:e,spaceId:pe.space_id},requester:le}))||void 0===t?void 0:t.id)||e})));const ue=p().Bj6.fromBlock(pe).getCollectionPointers(),_e=[];for(const a of ue){var me;const e=null==ie?void 0:ie.getValue(a);if(!Boolean(null==e||null===(me=e.format)||void 0===me?void 0:me.bot_id)){const e=Z({originalSpaceId:M.space_id,duplicateSpaceId:V.space_id,requester:le,collectionPointer:a,mapper:O});if(!e)continue;_e.push(e)}}_e.length>0?(pe.collection_id=_e[0].id,pe.format={...pe.format,collection_pointer:_e[0],collection_pointers:_e}):(pe.collection_id=void 0,pe.format={...pe.format,collection_pointer:void 0,collection_pointers:void 0}),null!==(q=V.format)&&void 0!==q&&q.form_layout_pointer&&(V.format.form_layout_pointer=O({requested:V.format.form_layout_pointer,requester:le})),null!==(C=V.format)&&void 0!==C&&C.suggestions&&delete V.format.suggestions,V.discussions&&delete V.discussions,V.permissions&&(L.duplicatePermissions?V.permissions=function(e){const{block:t,targetSpaceSettings:o,targetTeamSettings:i}=e;return(t.permissions||[]).filter((e=>!((0,z().P3)(e)||(0,z().Ds)(e)||(!i&&o.disablePublicAccess||i&&i.disable_public_access)&&(0,z().FP)(e)||(!i&&o.disableGuests||i&&i.disable_guests)&&(0,z().B2)(e)&&!o.memberUserIds.includes(e.user_id))))}({block:V,targetSpaceSettings:L.duplicatePermissions.targetSpaceSettings,targetTeamSettings:L.duplicatePermissions.targetTeamSettings}):(delete V.permissions,"form"===V.type&&(V.permissions=(0,E().eb)()))),V.content_classification&&delete V.content_classification,V.moved&&delete V.moved,V.properties||(V.properties={});for(const a in V.properties)V.properties[a]=v().Uee(V.properties[a],{removeSuggestionAnnotationsAndText:!0,removeSuggestionAnnotations:!0,removeDiscussions:!0});if(de&&Q(V)?V.ignore_block_count=!0:V.ignore_block_count&&delete V.ignore_block_count,V.properties){for(const e of Object.keys(V.properties)){const t=V.properties[e];t&&(V.properties[e]=(0,K().R)({...X,text:{value:t,spaceId:(0,T().e)(V.space_id)},mapper:O,requester:le,resolveTemplateVariables:L.resolveTemplateVariables||!1}))}if(!0!==L.preserveVerification)for(const e of[H()._e.Verification,"verifier"])e in V.properties&&(V.properties[e]=[]);"title"in V.properties&&(V.properties.title=v().ooo(V.properties.title))}if("transclusion_reference"===V.type&&L.deepCopyTransclusionContainers){const e=V;if(e.format&&e.format.transclusion_reference_pointer){const t=e.format.transclusion_reference_pointer,o=O({requested:t,requester:le});o&&(e.format.transclusion_reference_pointer=o)}}if((0,d().$I)(V.type)&&L.shallowCopyNavigableBlock){const e=V;e.type="text";const t=v().ld4(M.id,M.space_id),o=[v().wmz(t)];e.properties={title:o},e.content=[]}if("transclusion_container"===V.type&&!L.deepCopyTransclusionContainers){const e=V;e.type="transclusion_reference",e.content=void 0;const t=e.format||{};t.transclusion_reference_pointer=le,e.format=t}if("alias"===V.type&&V.format&&V.format.alias_pointer){const e=V.format.alias_pointer,t=O({requested:e,requester:le});t&&(V.format.alias_pointer=t)}if("image"===V.type){var fe;const e=null===(fe=V.format)||void 0===fe?void 0:fe.image_hyperlink;if(V.format&&e){const[t]=(0,G().Jq)({url:e,isMobile:!1,baseUrl:"",publicDomainName:"",protocol:void 0,currentUrl:void 0});if(t){const e=(0,Y().D)({route:t,targetSpaceId:V.space_id,mapper:O,requester:le});e&&(V.format.image_hyperlink=e)}}}if(ve=V,(0,d().p7)(ve.type)&&V.format)if(ne)V.format.installation_imprint={pointer:ne};else if(V.format.installation_imprint){const e=O({requested:V.format.installation_imprint.pointer,requester:le});e&&(V.format.installation_imprint={pointer:{id:e.id,table:J()._i}})}var ve,ge,be,Ie;if((V.type===d().xd.externalObjectInstancePage&&(V.type=d().xd.externalObjectInstance),V.type===d().xd.externalObjectInstance)&&(null!==(ge=V.format)&&void 0!==ge&&ge.related_external_object_uris_to_instance_ids&&(V.format.related_external_object_uris_to_instance_ids=(0,U().MU)((0,n().WP)(V.format.related_external_object_uris_to_instance_ids).map((([e,t])=>{var o;return[e,(null===(o=O({requested:{table:f().ev,id:t,spaceId:pe.space_id},requester:le}))||void 0===o?void 0:o.id)||t]})))),L.convertExternalObjectInstancesToPlaceholders&&(null===(be=V.format)||void 0===be||!be.is_placeholder)&&null!==(Ie=V.format)&&void 0!==Ie&&Ie.bot_id)){const e=null==ie?void 0:ie.getValue({table:$().GP,id:V.format.bot_id}),t=null==e?void 0:e.integration_id;if(t){const e={is_placeholder:!0,integration_id:t};V.format=e}}V.file_ids&&function(e){var t;const o=JSON.stringify(e.properties);e.file_ids=null==e||null===(t=e.file_ids)||void 0===t?void 0:t.filter((t=>{var i,r,a,n,d,l;return!(null===(i=e.format)||void 0===i||!i.display_source||-1===(null===(r=e.format)||void 0===r||null===(r=r.display_source)||void 0===r?void 0:r.indexOf(t)))||!(null===(a=e.format)||void 0===a||!a.page_cover||-1===(null===(n=e.format)||void 0===n||null===(n=n.page_cover)||void 0===n?void 0:n.indexOf(t)))||!(null===(d=e.format)||void 0===d||!d.page_icon||-1===(null===(l=e.format)||void 0===l||null===(l=l.page_icon)||void 0===l?void 0:l.indexOf(t)))||-1!==o.indexOf(t)}))}(V);const ye=M,ke=V;if(ke.format&&(null!==(B=ye.format)&&void 0!==B&&B.original_source||null!==(w=ye.format)&&void 0!==w&&w.image_edit_metadata)&&(ke.format.original_source=void 0,ke.format.image_edit_metadata=void 0),null!==(P=V.format)&&void 0!==P&&P.automation_id){const e=O({requested:{table:_().yB,id:V.format.automation_id,spaceId:V.space_id},requester:le});e&&(V.format.automation_id=e.id)}var qe;null!==(x=V.format)&&void 0!==x&&x.workflow_id&&(V.format.workflow_id=null===(qe=O({requested:{table:S().C0,id:V.format.workflow_id,spaceId:V.space_id},requester:le}))||void 0===qe?void 0:qe.id);if(V.type===d().xd.transcription&&V.format){var Ce,Be,he,Re;if(V.format.transcription_notes_id)V.format.transcription_notes_id=null===(Be=O({requested:{table:f().ev,id:V.format.transcription_notes_id,spaceId:V.space_id},requester:le}))||void 0===Be?void 0:Be.id;if(V.format.transcription_transcript_id)V.format.transcription_transcript_id=null===(he=O({requested:{table:f().ev,id:V.format.transcription_transcript_id,spaceId:V.space_id},requester:le}))||void 0===he?void 0:he.id;if(V.format.transcription_summary_id)V.format.transcription_summary_id=null===(Re=O({requested:{table:f().ev,id:V.format.transcription_summary_id,spaceId:V.space_id},requester:le}))||void 0===Re?void 0:Re.id;const e=null===(Ce=V.format.transcription_state)||void 0===Ce?void 0:Ce.state;"transcribing"!==e&&"summarizing"!==e||(V.format.transcription_state={state:"paused"})}if("collection"===M.parent_table&&M.type===d().xd.copyIndicator&&V.properties&&(0,n().uv)(V.properties).length>0&&(V.type=d().xd.page),!L.preserveSourceMetadataTimestamps){const e=Date.now();V.created_time=e,V.last_edited_time=e}oe&&(V.last_edited_by_id=oe.id,V.last_edited_by_table=oe.table,V.created_by_id=oe.id,V.created_by_table=oe.table),V.non_content_children&&(V.non_content_children=V.non_content_children.map((e=>{var t;return(null===(t=O({requested:{table:f().ev,id:e,spaceId:V.space_id},requester:le}))||void 0===t?void 0:t.id)||e})));const we=V;if(we.content){var Pe;if(ae){const e=ae.remapDuplicateBlockContent({originalBlockPointer:le,duplicateMapper:O,originalBlockContent:we.content,originalCreatedBy:oe||c().TI.pointer,duplicateBlockId:we.id,targetSpaceId:V.space_id});we.content=e.content,ce.push(...e.additionalRecords)}else we.content=we.content.map((e=>{var t;return(null===(t=O({requested:{table:f().ev,id:e},requester:le}))||void 0===t?void 0:t.id)||e}));if(V.space_id===N&&null!==(Pe=V.properties)&&void 0!==Pe&&Pe.title){var Te,xe,Se;const e=(0,v().RQ)(null===(Te=V.properties)||void 0===Te?void 0:Te.title);e&&e.length>0&&e[0].length>0&&null!==(xe=e[0][0])&&void 0!==xe&&null!==(xe=xe.trim())&&void 0!==xe&&xe.startsWith("ðŸŽ²")&&null!==(Se=e[0][0])&&void 0!==Se&&null!==(Se=Se.trim())&&void 0!==Se&&Se.endsWith("ðŸŽ²")&&(we.content=a().k4(we.content))}}return{duplicateRecord:V,additionalRecords:ce}}var ee=()=>o(713998),te=()=>o(443881);function oe({originalCollection:e,duplicateCollection:t,mapper:o,originOptions:i,rewiredUriMap:r,isTemplateInstantiation:a,options:d,actor:c}){var s,p,u,m,v;const g={table:h().Vl,id:e.id,spaceId:e.space_id};if(function(e,t,o){var i;if(null===(i=e.format)||void 0===i||!i.compound_workflow_template_instances)return;const r={table:h().Vl,id:e.id,spaceId:e.space_id};t.format||(t.format={});t.format.compound_workflow_template_instances=e.format.compound_workflow_template_instances.map((e=>({...e,instance_pointers:e.instance_pointers.map((e=>{const i=t.space_id;if("property"===e.type)return e;const a=e.type,n=M({table:a,mapper:o,requested:{table:a,id:e.id,spaceId:i},requester:r});return{type:n.table,id:n.id}}))})))}(e,t,o),null!==(s=e.format)&&void 0!==s&&s.app_config_uri&&(r[e.id]=t.id),t.template_pages&&(t.template_pages=t.template_pages.map((e=>{var t;return(null===(t=o({requested:{table:f().ev,id:e},requester:g}))||void 0===t?void 0:t.id)||e}))),(0,D().uj)(e.id)){if(t.format||(t.format={}),t.format.copied_from_pointer={table:h().Vl,id:e.id,spaceId:e.space_id},void 0!==t.format.collection_default_template&&"empty"!==t.format.collection_default_template){var b;const e=o({requested:{table:f().ev,id:t.format.collection_default_template.template_page_id},requester:g});e&&null!==(b=t.template_pages)&&void 0!==b&&b.includes(e.id)?t.format.collection_default_template={template_page_id:e.id}:t.format.collection_default_template="empty"}if(t.format.layout_pointer){const e=o({requested:t.format.layout_pointer,requester:g});e&&(0,B().Yt)(e,P().zx)?t.format.layout_pointer=e:t.format.layout_pointer=void 0}t.copied_from=e.id}const I=o({requested:{table:t.parent_table,id:t.parent_id},requester:g});I&&(t.parent_id=I.id);const y=l().Dp(t);for(const n in y){const r=y[n];if(r&&"relation"===r.type&&l().Nv(r)){const e=o({requested:l().Nv(r),requester:g});e?(r.collection_id=e.id,r.collection_pointer={id:e.id,table:h().Vl,spaceId:(0,T().e)(e.spaceId)}):r.property&&(r.property=void 0)}var k;if(r&&"title"===r.type&&t.name&&(t.name=(0,K().R)({...i,text:{value:t.name,spaceId:t.space_id},mapper:o,requester:g,resolveTemplateVariables:!1})),r&&"button"===r.type&&r.automation_id)r.automation_id=(null===(k=o({requested:{id:r.automation_id,spaceId:e.space_id,table:_().yB},requester:g}))||void 0===k?void 0:k.id)??r.automation_id;r&&l().DQ(r)&&r.options&&(r.options=(0,ee().ki)(r.options))}if(t.description&&(t.description=(0,K().R)({...i,text:{value:t.description,spaceId:t.space_id},mapper:o,requester:g,resolveTemplateVariables:!1})),!d.preserveSourceMetadataTimestamps){const e=Date.now();t.created_time=e,t.last_edited_time=e}c&&(t.last_edited_by_id=c.id,t.last_edited_by_table=c.table,t.created_by_id=c.id,t.created_by_table=c.table),null!==(p=t.format)&&void 0!==p&&p.metadata_copied_from&&(t.format.metadata_copied_from=void 0);for(const n in y){const e=y[n];if(!e||"formula"!==e.type||"v2"!==e.version||!e.formula2)continue;const{value:r}=(0,te().RI)({baseUrl:i.baseUrl,formula:e.formula2.code,publicDomainName:i.publicDomainName,spaceId:t.space_id,visitors:{visitFormulaContextValue:void 0,visitFormulaPageProperty:e=>{if("collection"in e&&e.collection){const t=o({requested:e.collection,requester:g});if(t&&t.table===h().Vl)return{type:"replace",value:{...e,collection:t}}}return{type:"keep"}},visitRecordPointer:void 0}});e.formula2.code=r}if(null!==(u=t.format)&&void 0!==u&&u.collection_mode&&"page_tree"===t.format.collection_mode.type){var q;const e=t.format.collection_mode.root_page_pointer,i=(null===(q=o({requested:B().L3.fromPointerLike({table:"block",id:e.id,spaceId:t.space_id}),requester:g}))||void 0===q?void 0:q.id)||e.id;t.format.collection_mode={type:"page_tree",root_page_pointer:{id:i,table:"block",spaceId:t.space_id}}}null!==(m=t.format)&&void 0!==m&&m.related_external_object_uris_to_instance_ids&&(t.format.related_external_object_uris_to_instance_ids=(0,U().MU)((0,n().WP)(t.format.related_external_object_uris_to_instance_ids).map((([e,i])=>{var r;return[e,(null===(r=o({requested:{table:h().Vl,id:i,spaceId:t.space_id},requester:g}))||void 0===r?void 0:r.id)||i]})))),delete t.deleted_schema,null!==(v=t.format)&&void 0!==v&&v.automation_ids&&(t.format.automation_ids=t.format.automation_ids.map((e=>{var i;return null===(i=o({requested:{id:e,table:_().yB,spaceId:t.space_id},requester:g}))||void 0===i?void 0:i.id})).filter(n().O9)),e.permissions&&(t.permissions=function(e,t,o){return e.filter((e=>!!(0,z().tb)(e)&&(t||o)))}(e.permissions,a,d.duplicateOnlyCollectionSchema))}var ie=()=>o(62371),re=()=>o(300525);var ae=()=>o(691678),ne=()=>o(976618);o(672577);var de=()=>o(188924);const le={block:!0,collection:!0,collection_view:!0,automation:!0,automation_action:!0,skill:!0,layout:!0,form_question:!0,workflow:!0};function ce(e){return e.table in le}function se(e){const{sourceBlockId:t,targetBlockPointer:o,recordMap:i,options:r,baseUrl:n,publicDomainName:d,actor:l,getRecordRole:c,mapper:u,preventLegacyTransclusions:_,createLegacyTransclusionCopyIndicator:m,logWarning:v,spaceIdCreator:g,installationImprint:I,isTemplateInstantiation:B}=e,h=[],R=e.recordPointerMap||C().RecordMapPolymorphic.create(),w={table:f().ev,id:t};for(const{pointer:a}of i){if(a.id===t){R.set(a,o);continue}let e=R.get(a);!e&&u&&(e=u({requested:a,requester:w})),e||(e={spaceId:o.spaceId,table:a.table,id:(null==g?void 0:g.idInSavedSpace(a.table))??s().Dt()}),R.set(a,e)}let T;_&&(T=new b(i,v,m??!1));const x=C().RecordMap.create(),S=({requested:e})=>R.get(e),M={},V=[],O=new Set,L=i.getModel({id:t,table:f().ev}),D=L?function(e){const t="duplication",o=new Map;let i;return"factory"===e.type?(i={type:t,isRootBlockFactoryBlock:!0,isCurrentBlockRootBlock:!1,factoryBlockIdToNewTextContainerIdMap:o,rootTextContainerId:s().JW()},i.factoryBlockIdToNewTextContainerIdMap.set(e.id,{id:i.rootTextContainerId,table:f().ev})):i={type:t,isRootBlockFactoryBlock:!1,factoryBlockIdToNewTextContainerIdMap:o},i}(L):void 0;for(const{pointer:a,model:s}of i){if(void 0===s)continue;if(!ce(s))continue;const e=Boolean((null==r?void 0:r.resolveTemplateVariables)&&_e({rootSourceBlockIds:[t],childSourcePointer:a,getSourceRecordValue:q().xb.fromRecordMap(i)}))?{...r,resolveTemplateVariables:!1}:r;if(s.table===P().zx){const e=y(s.getRawModules(),s.getFormat(),s.getBlocks());for(const t of e)O.add(t)}null!=D&&D.isRootBlockFactoryBlock&&(D.isCurrentBlockRootBlock=s.id===t);const{duplicateRecord:p,additionalRecords:u}=ue({table:s.table,record:s.__IM_SORRY__getValue(),mapper:S,options:e,rewiredUriMap:M,typedCollectionViewBlocks:V,originOptions:{baseUrl:n,publicDomainName:d},actor:l,getRecordRole:c,factoryButtonDeprecationContext:D,legacyTransclusionFixer:T,installationImprint:I,layoutCollectionViewBlocksToRemove:O});if(void 0!==p){if(s.table===f().ev&&p.id===o.id){const e=p;delete e.parent_id,delete e.parent_table,delete e.alive}B&&s.table===f().ev&&s.autoGenerateOnTemplateDuplication()&&h.push({table:f().ev,id:p.id,spaceId:p.space_id}),pe({duplicateRecordMap:x,duplicateRecordResult:{duplicateRecord:p,additionalRecords:u,duplicateRecordTable:s.table}})}}!function(e){const{rewiredUriMap:t,typedCollectionViewBlocks:o,duplicateRecordMap:i}=e;if(a().Im(t)||0===o.length)return;const r=a().oE(o.map((e=>i.getValue(e))));r.forEach((e=>{var o;const i=null==e||null===(o=e.format)||void 0===o?void 0:o.app_uri_map;i&&Object.entries(i).forEach((([e,o])=>{i[e]=t[o]}))}));const n=r.reduce(((e,t)=>{var o;const i=null==t||null===(o=t.format)||void 0===o?void 0:o.app_id;return i&&(e[i]=e[i]?[...e[i],t]:[t]),e}),{});Object.entries(n).forEach((([e,t])=>{const o=s().JW();t.forEach((e=>{var t;null!=e&&null!==(t=e.format)&&void 0!==t&&t.app_id&&(e.format.app_id=o)}))}))}({rewiredUriMap:M,typedCollectionViewBlocks:V,duplicateRecordMap:x});const A=function(e,t,o,i){if(0===e.size)return t;const r=new Set;for(const c of e){const e=o({requested:{id:c,table:f().ev},requester:i});r.add((null==e?void 0:e.id)||c)}const a=t.clone(),n=p().b4_.fromRecordMap(a);function d(e){return(0,k().Yn)(e.pointer,n).some(((e,t)=>r.has(e.id)))}const l=[];for(const{pointer:c,model:s}of a)s&&!d(s)||l.push(c);return l.forEach((e=>a.delete(e))),a}(O,x,S,w);return{duplicateRecordMap:A,originalToDuplicate:R,aiBlocksToAutoGenerate:h}}function pe(e){const{duplicateRecordResult:t,duplicateRecordMap:o}=e,{additionalRecords:i,duplicateRecord:r,duplicateRecordTable:a}=t;o.setValue(B().L3.fromPointerLike({table:a,id:r.id,spaceId:r.space_id}),r);for(const n of i)o.setValue(B().L3.fromPointerLike({id:n.value.id,table:n.table,spaceId:n.value.space_id}),n.value)}function ue(e){const{table:t,record:o,mapper:i,options:r,originOptions:d,actor:l,helperRecordMap:c,getRecordRole:s,rewiredUriMap:p,typedCollectionViewBlocks:u,factoryButtonDeprecationContext:v,legacyTransclusionFixer:g,installationImprint:b,isTemplateInstantiation:I,shouldExcludeBlocksFromLimit:y,targetBlockIds:k,layoutCollectionViewBlocksToRemove:q}=e,C=a().mg(o),D=V({mapper:i,requested:B().L3.fromPointerLike({table:t,id:o.id,spaceId:o.space_id}),requester:B().L3.fromPointerLike({table:t,id:o.id})});C.id=D.id,C.space_id=(0,T().e)(D.spaceId);const A=[];if(t===f().ev){const e=C,{additionalRecords:t}=X({originalBlock:o,duplicateBlock:e,mapper:i,options:r??{},rewiredUriMap:p,typedCollectionViewBlocks:u,originOptions:d,actor:l,helperRecordMap:c,factoryButtonDeprecationContext:v,legacyTransclusionFixer:g,installationImprint:b,shouldExcludeBlocksFromLimit:y});A.push(...t)}else if(t===h().Vl){oe({originalCollection:o,duplicateCollection:C,mapper:i,originOptions:d,rewiredUriMap:p,isTemplateInstantiation:I,options:r??{},actor:l})}else if(t===R().Gy){!function(e,t,o,i,r,a,n){var d,l,c,s,p,u,_,m,v;const g={table:R().Gy,id:e.id,spaceId:e.space_id};if(null!==(d=e.format)&&void 0!==d&&d.app_config_uri&&null!==(l=t.format)&&void 0!==l&&l.app_config_uri&&((0,W().Sn)(e.format.app_config_uri)?t.format.app_config_uri=void 0:i[e.id]=t.id),null!==(c=e.format)&&void 0!==c&&c.app_uri_map&&null!==(s=t.format)&&void 0!==s&&s.app_uri_map)for(const[B,h]of Object.entries(e.format.app_uri_map)){const r=o({requested:{id:h,table:f().ev,spaceId:e.space_id},requester:g});r&&(t.format.app_uri_map[B]=r.id??h,r.id&&(i[r.id]=t.id))}const b=null===(p=t.format)||void 0===p?void 0:p.collection_pointer;if(b){const i=null==r?void 0:r.getModel(b);if(!Boolean(null==i?void 0:i.isSyncedCollection())){const i=Z({originalSpaceId:e.space_id,duplicateSpaceId:t.space_id,requester:g,collectionPointer:b,mapper:o});t.format={...t.format,collection_pointer:i}}}if(t.format){var I;const e=null===(I=t.format.collection_groups)||void 0===I?void 0:I.map((e=>"relation"===e.value.type&&(0,ie().WO)(e.value.value)&&e.value.value?{...e,value:{type:"relation",value:o({requested:e.value.value,requester:g})}}:e));t.format.collection_groups=e;const i=t.format.collection_view_default_template;if(void 0!==i&&"empty"!==i){const e=o({requested:{table:f().ev,id:i.template_page_id},requester:g});e&&(a&&(n?null==n?void 0:n.includes(e.id):e)||(t.format.collection_view_default_template={template_page_id:e.id}))}}const y=o({requested:{table:t.parent_table,id:t.parent_id,spaceId:t.space_id},requester:g});if(y&&(t.parent_id=y.id),t.page_sort&&(t.page_sort=t.page_sort.map((e=>{var i;return(null===(i=o({requested:{table:f().ev,id:e,spaceId:t.space_id},requester:g}))||void 0===i?void 0:i.id)||e}))),"page"===t.type&&null!==(u=t.format)&&void 0!==u&&u.page_pointer){var k;const e=t.format.page_pointer,i=(null===(k=o({requested:B().L3.fromPointerLike({table:"block",id:e.id,spaceId:t.space_id}),requester:g}))||void 0===k?void 0:k.id)||e.id;t.format.page_pointer={table:"block",id:i,spaceId:t.space_id}}if(null!==(_=t.format)&&void 0!==_&&_.property_filters){const e=t.format.property_filters;for(const t of e)t.filter&&(0,re().w)(t.filter,(e=>{var t;return null===(t=o({requested:e,requester:g}))||void 0===t?void 0:t.id}))}if(null!==(m=t.format)&&void 0!==m&&m.filters2){const e=t.format.filters2;for(const t of e)t.filter&&(0,re().w)(t.filter,(e=>{var t;return null===(t=o({requested:e,requester:g}))||void 0===t?void 0:t.id}))}const q=t.query2;var C;q&&q.filter&&(0,re().w)(q.filter,(e=>{var t;return null===(t=o({requested:e,requester:g}))||void 0===t?void 0:t.id})),null!==(v=t.format)&&void 0!==v&&v.form_block_pointer&&(t.format.form_block_pointer=o({requested:null===(C=t.format)||void 0===C?void 0:C.form_block_pointer,requester:g}))}(o,C,i,p,c,I,k)}else t===_().yB?(0,L().i)({originalRecord:o,duplicateRecord:C,mapper:i,options:r??{},actor:l}):t===m().SC?(0,O().I)({originalRecord:o,duplicateRecord:C,mapper:i,getRecordRole:s,options:r??{},originOptions:d}):t===S().C0?function(e){const{original:t,duplicate:o,mapper:i}=e,r={table:S().C0,id:t.id,spaceId:t.space_id},a=i({requested:{table:f().ev,id:t.parent_id,spaceId:t.space_id},requester:r});if(a&&(o.parent_id=a.id),o.space_id=(null==a?void 0:a.spaceId)??t.space_id,o.data){o.data.runtime_actor_pointer=void 0;for(const e of(null===(n=o.data)||void 0===n?void 0:n.modules)??[]){var n;if(!e.state)continue;const t=(0,de().jK)(e.type);null!=t&&t.stateDuplicator&&(e.state=t.stateDuplicator({original:e.state,mapper:i,requester:r}))}for(const e of o.data.triggers??[]){if(e.enabled=!1,!e.state)continue;const t=(o.data.modules??[]).find((t=>t.id===e.moduleId));if(!t)throw new Error(`Unable to find module with key "${e.moduleId}"`);if(!(0,de().jK)(t.type))continue;const a=(0,de().C7)(t.type,e.state.type);if(!a)throw new Error(`Unable to find trigger definition for "${e.state.type}" in module "${t.type}"`);e.state=a.triggerDuplicator({original:e.state,mapper:i,requester:r})}}}({original:o,duplicate:C,mapper:i,originOptions:d}):t===x().MC?function({original:e,duplicate:t,mapper:o,originOptions:i}){const r={table:x().MC,id:e.id,spaceId:e.space_id},a=o({requested:B().L3.fromPointerLike({table:t.parent_table,id:t.parent_id,spaceId:t.space_id}),requester:r});a&&(t.parent_id=a.id)}({original:o,duplicate:C,mapper:i,originOptions:d}):t===P().zx?function({original:e,duplicate:t,mapper:o,layoutCollectionViewBlocksToRemove:i}){var r,a;const n={table:P().zx,id:e.id,spaceId:e.space_id};t.parent_id=V({mapper:o,requested:B().L3.fromPointerLike({table:t.parent_table,id:t.parent_id,spaceId:t.space_id}),requester:n}).id,t.format||(t.format={}),t.format.copied_from_pointer={table:P().zx,id:e.id,spaceId:e.space_id},t.modules=(0,ae().Pe)(t.modules);const d=(0,ne().E)(t.modules,(e=>"views"===e.type||"viewsMain"===e.type?{type:e.type,id:e.id,collection_view_block_pointer:{...M({table:f().ev,mapper:o,requested:B().L3.fromPointerLike(e.collection_view_block_pointer),requester:n}),spaceId:t.space_id}}:"formQuestion"===e.type?{type:"formQuestion",id:e.id,formQuestionId:{...M({table:w().lo,mapper:o,requested:B().L3.fromPointerLike({table:w().lo,id:e.formQuestionId,spaceId:t.space_id}),requester:n}),spaceId:t.space_id}.id,parentModuleId:e.parentModuleId,parentConditionalGroupId:e.parentConditionalGroupId,conditionalGroups:e.conditionalGroups}:"placeholder"===e.type?{type:"placeholder",id:e.id,parentModuleId:e.parentModuleId,parentConditionalGroupId:e.parentConditionalGroupId}:e)),l=Object.fromEntries(Object.entries(d.form_conditional_modules??{}).filter((e=>{const[t,o]=e;return"formQuestion"===o.type||"placeholder"===o.type})));t.modules={...d,form_conditional_modules:l},null!==(r=t.format)&&void 0!==r&&r.previousViewsMainCollectionViewBlockPointer&&null!=i&&i.has(t.format.previousViewsMainCollectionViewBlockPointer.id)&&delete t.format.previousViewsMainCollectionViewBlockPointer;const c=null===(a=e.blocks)||void 0===a?void 0:a.filter((e=>!(null!=i&&i.has(e))));c&&(t.blocks=c.map((e=>V({mapper:o,requested:{table:f().ev,id:e,spaceId:t.space_id},requester:n}).id)))}({original:o,duplicate:C,mapper:i,layoutCollectionViewBlocksToRemove:q}):t===w().lo?function(e){const{original:t,duplicate:o,mapper:i}=e,r={table:w().lo,id:t.id,spaceId:t.space_id},a=i({requested:B().L3.fromPointerLike({table:o.parent_table,id:o.parent_id,spaceId:o.space_id}),requester:r});a&&(o.parent_id=a.id)}({original:o,duplicate:C,mapper:i,originOptions:d}):(0,n().HB)(t);return{duplicateRecord:C,additionalRecords:A}}function _e(e){const{rootSourceBlockIds:t,childSourcePointer:o,getSourceRecordValue:i}=e;for(const r of(0,k()._N)(o,i))if(me({rootSourceBlockIds:t,recordWithTable:r}))return!0;return!1}function me(e){const{recordWithTable:t,rootSourceBlockIds:o}=e;if(t.table!==f().ev)return t.table===m().SC;if(o.includes(t.value.id))return!1;if(p().Bj6.fromBlock(t.value).isTemplateVariableContainerBlock())return!0}var fe=()=>o(583835),ve=()=>o(165358),ge=()=>o(416504),be=()=>o(416845),Ie=()=>o(798880),ye=()=>o(439180),ke=()=>o(357625),qe=()=>o(384944),Ce=()=>o(231297),Be=()=>o(518736),he=()=>o(148832),Re=()=>o(878710);function we(e){const{environment:t,sourceBlockId:o,sourceBlockSubtree:r,targetBlockPointer:a,targetRecordCache:n,transaction:d,deepCopyTransclusionContainers:l,resolveTemplateVariables:c,recordPointerMap:s,preventLegacyTransclusions:p,createLegacyTransclusionCopyIndicator:u,spaceIdCreator:_,installationImprint:m,templateInstallationMetadata:f,isTemplateInstantiation:v,appendContentOnly:g}=e,b=t.currentUser.id;let I=!1;("onboarding"===(null==f?void 0:f.source)||"team_home"===(null==f?void 0:f.source)||null!=f&&f.isFirstPartyPaidTemplate)&&(I=!0);const{duplicateRecordMap:y,originalToDuplicate:k,aiBlocksToAutoGenerate:q}=se({sourceBlockId:o,targetBlockPointer:a,recordMap:r,recordPointerMap:s,options:{deepCopyTransclusionContainers:l,resolveTemplateVariables:!!c&&{currentUserId:b,currentTimeZone:(0,ge().P)()}},baseUrl:i().A.domainBaseUrl,publicDomainName:i().A.publicDomainName,actor:b?{table:Ie().oo,id:b}:void 0,getRecordRole:n.makeGetRecordRoleFn(b),preventLegacyTransclusions:p,createLegacyTransclusionCopyIndicator:u,installationImprint:m,logWarning:Pe,spaceIdCreator:_,isTemplateInstantiation:Boolean(v)}),C=new(he().B)(t,a,{inMemoryRecordCache:n});d.postPerformAssertions.push((function(){if(d.isLocal)return;if(!C.getParentStore())throw new(be().yI)(`Initialized template was not given a parent before being committed in transaction ${d.getUserActionForAnalyticsPurposesOnly()}`)}));const B=C.getSpaceStore(),h=(0,Be().D8)(B);for(const{model:i}of y)i&&Te({transaction:d,model:i,rootStore:C,currentUserId:b,targetBlockPointer:a,targetRecordCache:n,isTemplateInstantiation:v,shouldExcludeBlocksFromLimit:I,appendContentOnly:g,useCrdt:h});q.length>0&&d.postSubmitCallbacks.push((async()=>{await async function(e){const{environment:t,aiBlockPointers:o,parentPageId:i}=e,r=(0,fe().Dv)("generateAiBlockTask");for(const a of o)for await(const e of(0,ke().UT)(t,r,{blockId:a.id,spaceId:a.spaceId,parentPageId:i},{spaceIds:[]}));}({environment:t,aiBlockPointers:q,parentPageId:C.id})}));return{targetBlockStore:C,originalToDuplicate:k,subtreeSize:y.getSize()}}function Pe(e){"unmappedContentId"===e.type||("multiReferencedContentIds"===e.type?ve().log({level:"warning",from:"createBlockActions",type:"multiReferencedContentIds",data:{ids:e.contentIds}}):(0,n().HB)(e))}function Te(e){const{transaction:t,model:o,rootStore:i,targetBlockPointer:a,currentUserId:d,targetRecordCache:l,isTemplateInstantiation:c,shouldExcludeBlocksFromLimit:s,appendContentOnly:p,useCrdt:v}=e;if(o.table===f().ev)return void function(e){var t,o;const{transaction:i,model:a,rootStore:d,targetBlockPointer:l,currentUserId:c,targetRecordCache:s,isTemplateInstantiation:p,shouldExcludeBlocksFromLimit:_,appendContentOnly:m,useCrdt:f}=e,v=a.__IM_SORRY__getValue(),g=he().B.createChildStore(d,a.pointer);a.id===l.id&&p&&v.is_template&&(v.is_template=!1,v.format&&delete v.format.automation_id);_&&Q(v)&&(v.ignore_block_count=!0);const b=a.getFormat(),I=(null===(t=s.getRecord({pointer:a.pointer,userId:c}))||void 0===t||null===(t=t.value)||void 0===t?void 0:t.format)??{},y=u().op.update({pointer:a.pointer,path:["format"],args:(0,n().uv)(I).reduce(((e,t)=>t in b&&void 0!==b[t]?e:{...e,[t]:null}),{})}),k=a.pointer.table===l.table&&a.pointer.id===l.id?null===(o=s.getRecord({pointer:a.pointer,userId:c}))||void 0===o?void 0:o.value:void 0;k&&(delete v.created_by_id,delete v.created_by_table,delete v.created_time);if(k&&m&&a.id===d.id){const e=d.getContentIds()??[],t=a.getContentIds()??[];return void Ce().applyOperation({store:g,operation:u().op.update({args:{content:[...e,...t]},pointer:a.pointer,path:[]}),transaction:i})}const q=k?r().mP({existingBlock:k,updatedBlock:v}).concat([y]):r().VC({block:v,useCrdt:f});for(const r of q)(0,ye().ph)(r)?Ce().applyCrdtTextOperation({store:g,operation:r,invertedOperation:void 0,transaction:i}):Ce().applyOperation({store:g,operation:r,transaction:i})}({transaction:t,model:o,rootStore:i,targetBlockPointer:a,currentUserId:d,targetRecordCache:l,isTemplateInstantiation:c,shouldExcludeBlocksFromLimit:s,appendContentOnly:p,useCrdt:v});if(c){var g;if(o.table===_().yB&&o.parent_id===a.id)return;if(o.table===m().SC&&o.isType("create_page")&&(null===(g=o.getConfig())||void 0===g?void 0:g.template_page_id)===a.id)return}const b=(0,Re().v3)(i,o.pointer),I=o.__IM_SORRY__getValue();qe().KY({store:b,value:I,transaction:t})}}}]);