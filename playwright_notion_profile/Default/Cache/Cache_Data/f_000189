"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[35564],{235564:(e,t,n)=>{n.d(t,{m:()=>Ne});n(16280),n(944114),n(898992),n(354520),n(672577),n(581454);var r=n(296540),a=()=>n(242422),i=()=>n(484714),s=()=>n(56366),o=()=>n(401497),l=()=>n(699143),d=()=>n(729108),c=()=>n(98126),p=()=>n(631524),u=()=>n(370657),g=()=>n(218602),m=()=>n(878456),h=()=>n(187174),x=()=>n(973238),f=()=>n(465505),y=()=>n(703778),v=()=>n(863330),b=()=>n(870054),j=()=>n(724639),k=()=>n(69708),C=()=>n(532659),S=()=>n(496603),T=()=>n(559506),I=()=>n(760217),w=()=>n(406699),A=()=>n(285790),M=()=>n(623580),O=()=>n(404277),R=()=>n(939740),N=()=>n(89924),B=()=>n(859428),D=()=>n(722872),L=()=>n(981928),P=()=>n(562936),$=()=>n(459129),z=()=>n(791256),F=(n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),()=>n(30537));var E=()=>n(800204),K=()=>n(236262),W=n(474848);function q(e){const t=(0,k().tz)(),{expectations:n,onChange:a,transcript:i,toolNames:s}=e,[l,d]=(0,r.useState)(new Map),[u,g]=(0,r.useState)(new Set),m=i?i.filter((e=>e.type.includes("inference"))).map(((e,t)=>({index:t,id:e.id}))):[],h=(0,r.useMemo)((()=>Array.from(new Set([...s??[],...E().yu]))),[s]),x=(0,o().IS)((e=>({container:{padding:12,marginTop:16,border:`1px solid ${e.regularDividerColor}`,borderRadius:8,backgroundColor:e.background.primary},section:{marginBottom:16},sectionTitle:{fontSize:14,fontWeight:600,marginBottom:12,color:e.text.primary},topbar:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,marginBottom:12},expectationItem:{display:"flex",flexDirection:"column",gap:4,marginBottom:8,padding:6,backgroundColor:e.background.primary,border:`1px solid ${e.regularDividerColor}`,borderRadius:4},expectationItemHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4},formRow:{display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"},formField:{display:"flex",alignItems:"center",gap:3,minWidth:"fit-content"},formLabel:{fontSize:13,color:e.darkTextColor,fontWeight:500,minWidth:30,flexShrink:0},select:{padding:"4px 8px",borderRadius:3,border:`1px solid ${e.regularDividerColor}`,backgroundColor:e.background.primary,color:e.text.primary,fontSize:13,minWidth:80},numberInput:{padding:"4px 8px",borderRadius:3,border:`1px solid ${e.regularDividerColor}`,backgroundColor:e.background.primary,color:e.text.primary,fontSize:13,width:50},textInput:{padding:"4px 8px",borderRadius:3,border:`1px solid ${e.regularDividerColor}`,backgroundColor:e.background.primary,color:e.text.primary,fontSize:13,width:"100%",minWidth:120},descriptionRow:{display:"flex",alignItems:"center",gap:3,width:"100%"},testButton:{display:"flex",alignItems:"center",gap:4},addButton:{display:"flex",alignItems:"center",gap:4},emptyState:{fontSize:12,color:e.darkTextColor,fontStyle:"italic",padding:8},testResultsPopup:{padding:12,width:400,minWidth:400,maxWidth:"none",maxHeight:300,overflowY:"auto"},testResultItem:{marginBottom:16,fontSize:13,color:e.darkTextColor,whiteSpace:"pre-wrap"},testResultTitle:{fontWeight:600,marginBottom:8,fontSize:14},failedTestButton:{backgroundColor:"#ffebee",color:"#d32f2f",padding:"4px 8px",borderRadius:4},successTestButton:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"4px 8px",borderRadius:4}})),[]),f=r.useMemo((()=>[...n.expect||[]]),[n.expect]),y=(0,r.useCallback)((()=>{const e={...n,expect:[...f,{toolType:"search",minTimes:0,maxTimes:void 0,description:""}]};a(e)}),[n,a,f]),v=(0,r.useCallback)((e=>{const t=[...f];t.splice(e,1);const r={...n,expect:t.length>0?t:void 0};a(r)}),[n,a,f]),b=(0,r.useCallback)(((e,t,r)=>{const i=[...f];i[e]={...i[e],[t]:r};const s={...n,expect:i};a(s)}),[n,a,f]),j=(0,r.useCallback)((e=>{if(!i||!n.expect||0===n.expect.length||e<0||e>=n.expect.length)return;const t=n.expect[e];let r=i;t.stepId&&(r=i.filter((e=>e.id===t.stepId))),g((t=>new Set(t).add(e))),d((t=>{const n=new Map(t);return n.delete(e),n}));try{const n=function(e,t){if(!e.expect||0===e.expect.length)return;const n={};for(const r of t)if("agent-inference"===r.type)for(const e of r.value)if("object"==typeof e&&"tool_use"===e.type&&e.name){const t=e.name;n[t]=(n[t]||0)+1}return function(e,t){let n=0,r=0;const a=[];for(const i of e.expect){const e=t[i.toolType]||0,s=i.minTimes??0,o=i.maxTimes;n++;let l=!1;if(l=0===o?0===e:!(void 0!==o&&s>o)&&e>=s&&(void 0===o||e<=o),l)r++;else{let t;t=0===o?"never":void 0!==o?`${s}-${o} times`:`at least ${s} times`,a.push(`Expected ${i.toolType} ${t}, got ${e}${i.description?` (${i.description})`:""}`)}}return{score:r/n,maxScore:1,totalExpectations:n,metExpectations:r,violations:a,toolCounts:t}}(e,n)}({expect:[t]},r);n&&d((t=>new Map(t).set(e,n)))}catch(a){}finally{g((t=>{const n=new Set(t);return n.delete(e),n}))}}),[n,i]);return(0,W.jsxs)("div",{style:x.container,children:[(0,W.jsx)("div",{style:x.sectionTitle,children:"Expected Tools Editor"}),(0,W.jsx)("div",{style:x.topbar,children:(0,W.jsx)(p().p,{onClick:y,style:x.addButton,children:"Add Expected"})}),(0,W.jsx)(P().b,{label:"Visual editor",defaultOpen:!0,children:(0,W.jsx)("div",{style:x.section,children:f&&f.length>0?f.map(((e,n)=>(0,W.jsxs)("div",{style:x.expectationItem,children:[(0,W.jsxs)("div",{style:x.expectationItemHeader,children:[(0,W.jsxs)("div",{style:x.formField,children:[(0,W.jsx)("div",{style:x.formLabel,children:"Tool:"}),(0,W.jsx)("select",{style:x.select,value:e.toolType,onChange:e=>{const t=e.target.value;b(n,"toolType",t)},children:[...h].sort().map((e=>(0,W.jsx)("option",{value:e,children:e},e)))})]}),(0,W.jsxs)("div",{style:{display:"flex",gap:4,alignItems:"center"},children:[i?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(p().p,{onClick:()=>j(n),style:x.testButton,disabled:u.has(n),children:u.has(n)?(0,W.jsx)(c().k,{}):"Test"}),l.has(n)?(0,W.jsx)(w().A,{renderOrigin:e=>(0,W.jsx)(p().p,{...e,style:1===l.get(n).score?x.successTestButton:x.failedTestButton,children:1===l.get(n).score?"✅":"❌"}),popupType:F().n.Popup,placementToOrigin:"bottom",render:()=>{const e=l.get(n);return(0,W.jsxs)("div",{style:x.testResultsPopup,children:[(0,W.jsx)("div",{style:x.testResultTitle,children:"Test Results"}),(0,W.jsxs)("div",{style:x.testResultItem,children:[(0,W.jsx)("strong",{children:"Score: "}),`${e.score.toFixed(2)} (${e.metExpectations}/${e.totalExpectations} expectations met)`]}),e.violations.length>0?(0,W.jsxs)("div",{style:x.testResultItem,children:[(0,W.jsx)("strong",{children:"Violations:"}),"\n",e.violations.map((e=>`• ${e}\n`)).join("")]}):void 0,(0,W.jsxs)("div",{style:x.testResultItem,children:[(0,W.jsx)("strong",{children:"Tool Counts:"}),"\n",Object.entries(e.toolCounts).length>0?Object.entries(e.toolCounts).map((([e,t])=>`${e}: ${t}`)).join(", "):"none"]})]})}}):void 0]}):void 0,(0,W.jsx)(A().A,{icon:K().trashIcon,onClick:()=>v(n),ariaLabel:t.formatMessage({id:"aiInferenceTranscript.agentToolExpectationsEditor.removeExpectation",defaultMessage:"Remove tool expectation"})})]})]}),(0,W.jsxs)("div",{style:x.formRow,children:[(0,W.jsxs)("div",{style:x.formField,children:[(0,W.jsx)("div",{style:x.formLabel,children:"Min:"}),(0,W.jsx)("input",{type:"number",style:x.numberInput,value:e.minTimes??"",placeholder:"0",onChange:e=>b(n,"minTimes",e.target.value?parseInt(e.target.value):void 0)})]}),(0,W.jsxs)("div",{style:x.formField,children:[(0,W.jsx)("div",{style:x.formLabel,children:"Max:"}),(0,W.jsx)("input",{type:"number",style:x.numberInput,value:e.maxTimes??"",placeholder:"∞",onChange:e=>b(n,"maxTimes",e.target.value?parseInt(e.target.value):void 0)})]})]}),(0,W.jsxs)("div",{style:x.descriptionRow,children:[(0,W.jsx)("div",{style:x.formLabel,children:"Desc:"}),(0,W.jsx)("input",{type:"text",style:x.textInput,value:e.description??"",placeholder:"Description (optional)",onChange:e=>b(n,"description",e.target.value)})]}),m&&m.length>0?(0,W.jsx)("div",{style:x.formRow,children:(0,W.jsxs)("div",{style:x.formField,children:[(0,W.jsx)("div",{style:x.formLabel,children:"stepId:"}),(0,W.jsxs)("select",{style:x.select,value:e.stepId??"all",onChange:e=>{const t=e.target.value,r=m.find((e=>e.id===t));b(n,"stepId",null==r?void 0:r.id)},children:[(0,W.jsx)("option",{value:"all",children:"all"},-1),m.map((e=>(0,W.jsx)("option",{value:e.id,children:`${e.index}: ...${e.id.slice(-8)}`},e.index)))]})]})}):void 0]},n))):(0,W.jsx)("div",{style:x.emptyState,children:"No tool expectations defined. Click 'Add Expectation' to add one."})})}),(0,W.jsx)(P().b,{label:"JSON editor",defaultOpen:!1,children:(0,W.jsx)(L().X,{language:"json",value:JSON.stringify({...n,expect:f.length>0?f:void 0},null,2)})})]})}n(430670);var _=()=>n(627503),G=()=>n(12956),V=()=>n(10521),J=()=>n(884107),U=()=>n(452558),H=()=>n(553965);const X=(0,k().YK)({copy:{id:"aiInferenceTranscript.debug.copy",defaultMessage:"Copy"},copyTooltip:{id:"aiInferenceTranscript.debug.copyTooltip",defaultMessage:"Copy..."},input:{id:"aiInferenceTranscript.debug.copyInput",defaultMessage:"Input"},output:{id:"aiInferenceTranscript.debug.copyOutput",defaultMessage:"Output"},metadata:{id:"aiInferenceTranscript.debug.copyMetadata",defaultMessage:"Metadata"},tool:{id:"aiInferenceTranscript.debug.copyTool",defaultMessage:"Tool input"}});function Y(e){const{inference:t}=e,n=(0,i().v3)(),a=(0,k().tz)(),s="transcript"in t.input&&Array.isArray(t.input.transcript)?t.input.transcript:void 0,o=(0,r.useMemo)((()=>S().oE(null==s?void 0:s.flatMap((e=>{if("agent-inference"===e.type&&Array.isArray(e.value))return e.value.filter((e=>"tool_use"===e.type)).map((e=>({tool:e.name,input:e.content})))})))),[s]),l=async e=>{const t=await J().R.clipboardActions.load();t.copyString({environment:n,stringValue:e,copiedMessage:t.clipboardMessages.copiedToClipboard})},d=[(0,V().gy)({key:"copy",render:e=>(0,W.jsx)(N().A,{...e}),actions:S().oE([(0,V().Ls)({key:"input",displayName:X.input,analyticsName:X.input.defaultMessage,action:()=>l(JSON.stringify(t.input,null,2)),validators:[],closeParentMenu:!0,render:e=>(0,W.jsx)(I().A,{...e,title:a.formatMessage(X.input)})}),(0,V().Ls)({key:"output",displayName:X.output,analyticsName:X.output.defaultMessage,action:()=>l(JSON.stringify(t.expected,null,2)),validators:[],closeParentMenu:!0,render:e=>(0,W.jsx)(I().A,{...e,title:a.formatMessage(X.output)})}),(0,V().Ls)({key:"metadata",displayName:X.metadata,analyticsName:X.metadata.defaultMessage,action:()=>l(JSON.stringify(t.metadata,null,2)),validators:[],closeParentMenu:!0,render:e=>(0,W.jsx)(I().A,{...e,title:a.formatMessage(X.metadata)})}),o.length>0&&(0,G().u)({key:"tools",displayName:X.tool,analyticsName:"tools",validators:[],initialFocus:void 0,subActions:()=>[(0,V().gy)({key:"tools",render:e=>(0,W.jsx)(N().A,{...e}),actions:o.map((e=>({key:e.tool,displayName:e.tool,searchName:e.tool,shortcuts:void 0,analyticsName:e.tool,action:()=>l(e.input),validators:[],closeParentMenu:!0,render:t=>(0,W.jsx)(I().A,{...t,title:e.tool})})))})]})])})];return(0,W.jsx)(w().A,{popupType:w().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",renderOrigin:e=>(0,W.jsx)(B().A,{renderTooltip:()=>(0,W.jsx)("div",{children:a.formatMessage(X.copyTooltip)}),placement:"top",render:t=>(0,W.jsx)(A().A,{...(0,H().A)(e,t),icon:_().a,ariaLabel:a.formatMessage(X.copy)})}),render:e=>(0,W.jsx)(O().A,{menuType:D().gu.Popup,minWidth:220,children:(0,W.jsx)(U().A,{context:{blocks:[],environment:n,publicEditMode:void 0},sections:d,initialFocus:void 0})})})}var Z=()=>n(493552),Q=()=>n(29037),ee=()=>n(589407),te=()=>n(101927),ne=()=>n(209269);const re=(0,k().YK)({debugOptions:{id:"aiInferenceTranscript.debugOverrides.title",defaultMessage:"Debug options"},showAssistantDebugBar:{id:"aiInferenceTranscript.debugOverrides.showAssistantDebugBar",defaultMessage:"Show assistant debug bar"},showErrors:{id:"aiInferenceTranscript.debugOverrides.showErrors",defaultMessage:"Show errors"},showFullAgentSteps:{id:"aiInferenceTranscript.debugOverrides.showFullAgentSteps",defaultMessage:"Emit full agent steps"},skipFunctionTests:{id:"aiInferenceTranscript.debugOverrides.skipFunctionTests",defaultMessage:"Skip function tests"},promptCache:{id:"aiInferenceTranscript.debugOverrides.promptCache",defaultMessage:"Prompt cache"},none:{id:"aiInferenceTranscript.debugOverrides.none",defaultMessage:"None"},redis:{id:"aiInferenceTranscript.debugOverrides.redis",defaultMessage:"Redis"},s3:{id:"aiInferenceTranscript.debugOverrides.s3",defaultMessage:"S3"},embeddingModelOverride:{id:"aiInferenceTranscript.debugOverrides.embeddingModelOverride",defaultMessage:"Embedding model override"},default:{id:"aiInferenceTranscript.debugOverrides.default",defaultMessage:"Default"},bgeM3:{id:"aiInferenceTranscript.debugOverrides.bgeM3",defaultMessage:"BGE-M3"},e5:{id:"aiInferenceTranscript.debugOverrides.e5",defaultMessage:"E5"},bge1024:{id:"aiInferenceTranscript.debugOverrides.bge1024",defaultMessage:"BGE-1024"},bge4096:{id:"aiInferenceTranscript.debugOverrides.bge4096",defaultMessage:"BGE-4096"}});function ae(e){const{clientStore:t}=e,n=(0,i().v3)(),a=(0,k().tz)(),l=(0,o().IS)((e=>({iconButton:{width:20,height:20,fill:e.icon.primary}})),[]),d=(0,s().K8)((()=>t.state.debugOverrides),[t]),c=(0,s().K8)((()=>{var e;return(null===(e=ne().A.state)||void 0===e?void 0:e.showDebugBar)??!1}),[]),p=(0,r.useCallback)((()=>{(0,te().c6)(!c)}),[c]),u=(0,r.useCallback)((()=>{t.setState({...t.state,debugOverrides:{...t.state.debugOverrides,emitDebugErrors:!t.state.debugOverrides.emitDebugErrors}})}),[t]),g=(0,r.useCallback)((()=>{t.setState({...t.state,debugOverrides:{...t.state.debugOverrides,emitFullAgentSteps:!t.state.debugOverrides.emitFullAgentSteps}})}),[t]),m=(0,r.useCallback)((()=>{t.setState({...t.state,debugOverrides:{...t.state.debugOverrides,fastWorkflowBuilds:!t.state.debugOverrides.fastWorkflowBuilds}})}),[t]),h=(0,r.useCallback)((e=>{t.setState({...t.state,debugOverrides:{...t.state.debugOverrides,usePromptCache:"none"===e?void 0:e}})}),[t]),x=(0,r.useCallback)((e=>{t.setState({...t.state,debugOverrides:{...t.state.debugOverrides,embeddingModelOverride:"default"===e?void 0:e}})}),[t]),f=d.usePromptCache||"none",y=d.embeddingModelOverride||"default",v=[(0,V().gy)({key:"debug",render:e=>(0,W.jsx)(N().A,{...e}),actions:[(0,V().Ls)({key:"showAssistantDebugBar",displayName:re.showAssistantDebugBar,analyticsName:re.showAssistantDebugBar.defaultMessage,action:()=>p(),validators:[],closeParentMenu:!1,render:e=>(0,W.jsx)(I().A,{...e,title:a.formatMessage(re.showAssistantDebugBar),right:c&&(0,Q().checkmarkIcon)({width:12,height:12})})}),(0,V().Ls)({key:"emitDebugErrors",displayName:re.showErrors,analyticsName:re.showErrors.defaultMessage,action:()=>u(),validators:[],closeParentMenu:!1,render:e=>(0,W.jsx)(I().A,{...e,title:a.formatMessage(re.showErrors),right:d.emitDebugErrors&&(0,Q().checkmarkIcon)({width:12,height:12})})}),(0,V().Ls)({key:"emitFullAgentSteps",displayName:re.showFullAgentSteps,analyticsName:re.showFullAgentSteps.defaultMessage,action:()=>g(),validators:[],closeParentMenu:!1,render:e=>(0,W.jsx)(I().A,{...e,title:a.formatMessage(re.showFullAgentSteps),right:d.emitFullAgentSteps&&(0,Q().checkmarkIcon)({width:12,height:12})})}),(0,V().Ls)({key:"fastWorkflowBuilds",displayName:re.skipFunctionTests,analyticsName:re.skipFunctionTests.defaultMessage,action:()=>m(),validators:[],closeParentMenu:!1,render:e=>(0,W.jsx)(I().A,{...e,title:a.formatMessage(re.skipFunctionTests),right:d.fastWorkflowBuilds&&(0,Q().checkmarkIcon)({width:12,height:12})})}),(0,G().u)({key:"promptCache",displayName:re.promptCache,analyticsName:"promptCache",validators:[],initialFocus:void 0,right:(0,W.jsx)(Z().D,{colorVariant:"tertiary",children:"none"===f?(0,W.jsx)(k().sA,{...re.none}):"redis"===f?(0,W.jsx)(k().sA,{...re.redis}):(0,W.jsx)(k().sA,{...re.s3})}),subActions:()=>[(0,V().gy)({key:"cache",render:e=>(0,W.jsx)(N().A,{...e}),actions:[(0,V().Ls)({key:"none",displayName:re.none,analyticsName:re.none.defaultMessage,action:()=>h("none"),validators:[],closeParentMenu:!1,render:e=>(0,W.jsx)(I().A,{...e,title:a.formatMessage(re.none),right:"none"===f&&(0,Q().checkmarkIcon)({width:12,height:12})})}),(0,V().Ls)({key:"redis",displayName:re.redis,analyticsName:re.redis.defaultMessage,action:()=>h("redis"),validators:[],closeParentMenu:!1,render:e=>(0,W.jsx)(I().A,{...e,title:a.formatMessage(re.redis),right:"redis"===f&&(0,Q().checkmarkIcon)({width:12,height:12})})}),(0,V().Ls)({key:"s3",displayName:re.s3,analyticsName:re.s3.defaultMessage,action:()=>h("s3"),validators:[],closeParentMenu:!1,render:e=>(0,W.jsx)(I().A,{...e,title:a.formatMessage(re.s3),right:"s3"===f&&(0,Q().checkmarkIcon)({width:12,height:12})})})]})]}),(0,G().u)({key:"embeddingModelOverride",displayName:re.embeddingModelOverride,analyticsName:"embeddingModelOverride",validators:[],initialFocus:void 0,right:(0,W.jsx)(Z().D,{colorVariant:"tertiary",children:"default"===y?(0,W.jsx)(k().sA,{...re.default}):"bge-m3"===y?(0,W.jsx)(k().sA,{...re.bgeM3}):"bge-1024"===y?(0,W.jsx)(k().sA,{...re.bge1024}):"bge-4096"===y?(0,W.jsx)(k().sA,{...re.bge4096}):(0,W.jsx)(k().sA,{...re.e5})}),subActions:()=>[(0,V().gy)({key:"embeddingModels",render:e=>(0,W.jsx)(N().A,{...e}),actions:[(0,V().Ls)({key:"default",displayName:re.default,analyticsName:re.default.defaultMessage,action:()=>x("default"),validators:[],closeParentMenu:!1,render:e=>(0,W.jsx)(I().A,{...e,title:a.formatMessage(re.default),right:"default"===y&&(0,Q().checkmarkIcon)({width:12,height:12})})}),(0,V().Ls)({key:"bge-m3",displayName:re.bgeM3,analyticsName:re.bgeM3.defaultMessage,action:()=>x("bge-m3"),validators:[],closeParentMenu:!1,render:e=>(0,W.jsx)(I().A,{...e,title:a.formatMessage(re.bgeM3),right:"bge-m3"===y&&(0,Q().checkmarkIcon)({width:12,height:12})})}),(0,V().Ls)({key:"bge-1024",displayName:re.bge1024,analyticsName:re.bge1024.defaultMessage,action:()=>x("bge-1024"),validators:[],closeParentMenu:!1,render:e=>(0,W.jsx)(I().A,{...e,title:a.formatMessage(re.bge1024),right:"bge-1024"===y&&(0,Q().checkmarkIcon)({width:12,height:12})})}),(0,V().Ls)({key:"bge-4096",displayName:re.bge4096,analyticsName:re.bge4096.defaultMessage,action:()=>x("bge-4096"),validators:[],closeParentMenu:!1,render:e=>(0,W.jsx)(I().A,{...e,title:a.formatMessage(re.bge4096),right:"bge-4096"===y&&(0,Q().checkmarkIcon)({width:12,height:12})})}),(0,V().Ls)({key:"e5",displayName:re.e5,analyticsName:re.e5.defaultMessage,action:()=>x("e5"),validators:[],closeParentMenu:!1,render:e=>(0,W.jsx)(I().A,{...e,title:a.formatMessage(re.e5),right:"e5"===y&&(0,Q().checkmarkIcon)({width:12,height:12})})})]})]})]})];return(0,W.jsx)(w().A,{popupType:w().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",renderOrigin:e=>(0,W.jsx)(B().A,{renderTooltip:()=>(0,W.jsx)("div",{children:"Debug options"}),placement:"top",render:t=>(0,W.jsx)(A().A,{...(0,H().A)(e,t),icon:ee().ellipsisIcon,iconStyle:l.iconButton,ariaLabel:a.formatMessage(re.debugOptions)})}),render:e=>(0,W.jsx)(O().A,{menuType:D().gu.Popup,minWidth:220,children:(0,W.jsx)(U().A,{context:{blocks:[],environment:n,publicEditMode:void 0},sections:v,initialFocus:void 0})})})}n(803949);var ie=n(440961),se=()=>n(805751);function oe(e){const{collapseAll:t,collapseAgentMessages:n,uncollapseAll:r,allMessagesCollapsed:a,agentMessagesCollapsed:i,hasCollapsedMessages:s}=e,o=e=>({padding:"4px 8px",border:"1px solid #ddd",backgroundColor:e?"#f5f5f5":"white",color:e?"#999":"#666",borderRadius:4,fontSize:11,cursor:e?"not-allowed":"pointer",userSelect:"none",opacity:e?.6:1});return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("button",{style:o(a),onClick:a?void 0:t,type:"button",title:a?"All messages are already collapsed":"Collapse all messages",disabled:a,children:"Collapse all"}),(0,W.jsx)("button",{style:o(i),onClick:i?void 0:n,type:"button",title:i?"All agent messages are already collapsed":"Collapse only agent and tool messages",disabled:i,children:"Collapse agent messages"}),(0,W.jsx)("button",{style:o(!s),onClick:s?r:void 0,type:"button",title:s?"Expand all messages":"No messages are collapsed",disabled:!s,children:"Uncollapse all"})]})}n(737550);function le(e){const{messages:t}=e,[n,a]=(0,r.useState)((()=>{const e=new Set;return t.forEach(((t,n)=>{if("user"!==t.type.toLowerCase()&&e.add(n),"content"in t&&Array.isArray(t.content)){t.content.some((e=>"tool_result"===e.type||"tool_use"===e.type))&&e.add(n)}})),e})),i=(0,r.useCallback)((e=>{a((t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n}))}),[]),s=(0,r.useCallback)((()=>{const e=new Set;t.forEach(((t,n)=>{e.add(n)})),a(e)}),[t]),l=(0,r.useCallback)((()=>{const e=new Set;t.forEach(((t,n)=>{const r=t.type.toLowerCase();if("assistant"!==r&&"system"!==r||e.add(n),"content"in t&&Array.isArray(t.content)){t.content.some((e=>"tool_result"===e.type||"tool_use"===e.type))&&e.add(n)}})),a(e)}),[t]),d=(0,r.useCallback)((()=>{a(new Set)}),[]),c=n.size>0,p=(0,r.useMemo)((()=>t.some(((e,t)=>!n.has(t)))),[t,n]),u=(0,r.useMemo)((()=>{let e=!1,r=!1;return t.forEach(((t,a)=>{const i=t.type.toLowerCase(),s="assistant"===i||"system"===i,o="content"in t&&Array.isArray(t.content)&&t.content.some((e=>"tool_result"===e.type||"tool_use"===e.type)),l=s||o,d=n.has(a);l&&!d&&(e=!0),!l&&d&&(r=!0)})),e||r}),[t,n]),{onCollapseStateChange:g}=e;r.useEffect((()=>{g&&g({collapseAll:s,collapseAgentMessages:l,uncollapseAll:d,allMessagesCollapsed:!p,agentMessagesCollapsed:!u,hasCollapsedMessages:c})}),[g,s,l,d,p,u,c]);const m=(0,o().IS)((e=>({chatContainer:{display:"flex",flexDirection:"column",gap:12,height:"100%",overflow:"visible",padding:12},messageContainer:{display:"flex",flexDirection:"column",gap:4},messageHeader:{display:"flex",alignItems:"center",gap:8,fontSize:12,fontWeight:600,cursor:"pointer",padding:"4px 0",borderRadius:4},messageHeaderClickable:{background:"none",border:"none",padding:0,margin:0,display:"flex",alignItems:"center",gap:8,cursor:"pointer",width:"100%",textAlign:"start"},messageRole:{padding:"2px 6px",borderRadius:4,fontSize:10,fontWeight:600,textTransform:"uppercase",cursor:"pointer",userSelect:"none"},systemRole:{backgroundColor:e.regularDividerColor,color:e.text.secondary},userRole:{backgroundColor:"#2563eb",color:"white"},assistantRole:{backgroundColor:"#16a34a",color:"white"},toolResultRole:{backgroundColor:"#ea580c",color:"white"},toolUseRole:{backgroundColor:"#eab308",color:"white"},unknownRole:{backgroundColor:e.text.secondary,color:e.background.primary},toolName:{fontWeight:"bold",marginInlineStart:8,color:e.text.primary},messageContent:{fontSize:13,lineHeight:1.4,color:e.text.primary,whiteSpace:"pre-wrap",backgroundColor:e.background.primary,border:`1px solid ${e.regularDividerColor}`,borderRadius:4,padding:8,overflow:"scroll"},cacheIndicator:{fontSize:10,color:e.text.secondary,fontStyle:"italic"},collapsedIndicator:{fontSize:10,color:e.text.secondary,fontStyle:"italic",marginInlineStart:8,background:"none",border:"none",padding:0,cursor:"pointer"},multiContentItem:{display:"flex",flexDirection:"column",gap:4,marginBottom:8},contentType:{fontSize:10,color:e.text.secondary,fontFamily:"monospace"}})),[]),h=(e,t=!1,n)=>{if(t&&n)switch(n){case"tool_result":return{...m.messageRole,...m.toolResultRole};case"tool_use":return{...m.messageRole,...m.toolUseRole};default:return{...m.messageRole,...m.unknownRole}}switch(e.toLowerCase()){case"system":return{...m.messageRole,...m.systemRole};case"user":return{...m.messageRole,...m.userRole};case"assistant":return{...m.messageRole,...m.assistantRole};default:return{...m.messageRole,...m.unknownRole}}},x=e=>{try{if("tool_use"===e.type)return JSON.stringify(JSON.parse(e.content),null,2)}catch(t){}return"content"in e?e.content:JSON.stringify(e,null,2)};return t&&0!==t.length?(0,W.jsxs)("div",{style:m.chatContainer,children:[t.map(((e,t)=>{var a,s,o;const l=n.has(t),d=function(e){const{type:t}=e;if(t&&"toolName"in e&&e.toolName)return{type:t,name:e.toolName};if(t&&"name"in e&&e.name)return{type:t,name:e.name};if(t&&"content"in e&&Array.isArray(e.content)){const n=e.content.filter((e=>"tool_result"===e.type||"tool_use"===e.type)).map((e=>({type:e.type,name:"name"in e&&e.name||"toolName"in e&&e.toolName||void 0})));if(n.length>0)return{type:t,toolItems:n}}return{type:t}}(e);return(0,W.jsxs)("div",{style:m.messageContainer,children:[(0,W.jsx)("button",{style:m.messageHeaderClickable,onClick:()=>i(t),type:"button",children:(0,W.jsxs)("div",{style:m.messageHeader,children:[null!==(a=d.toolItems)&&void 0!==a&&a.length?void 0:(0,W.jsx)("span",{style:{...h(d.type),border:"none"},children:d.type}),!d.name||null!==(s=d.toolItems)&&void 0!==s&&s.length?void 0:(0,W.jsx)("span",{style:m.toolName,children:d.name}),null===(o=d.toolItems)||void 0===o?void 0:o.map(((e,t)=>(0,W.jsxs)(r.Fragment,{children:[(0,W.jsx)("span",{style:{...h("",!0,e.type),border:"none",marginInlineStart:t>0?8:0},children:"tool_result"===e.type?"Tool result":"Tool use"}),e.name?(0,W.jsx)("span",{style:m.toolName,children:e.name}):void 0]},t))),e.do_cache?(0,W.jsx)("span",{style:m.cacheIndicator,children:"• cached"}):void 0,l?(0,W.jsx)("span",{style:m.collapsedIndicator,children:"Collapsed"}):void 0]})}),l?void 0:(c=e.content,"string"==typeof c?(0,W.jsx)("div",{style:m.messageContent,children:c}):Array.isArray(c)?(0,W.jsx)("div",{style:m.messageContent,children:c.map(((e,t)=>(0,W.jsxs)("div",{style:m.multiContentItem,children:[(0,W.jsxs)("div",{style:m.contentType,children:["Type: ",e.type,"name"in e?`: ${e.name}`:"","toolName"in e?`: ${e.toolName}`:""]}),(0,W.jsx)("div",{children:x(e)})]},t)))}):(0,W.jsx)("div",{style:m.messageContent,children:"Invalid content format"}))]},t);var c})),(0,W.jsx)("div",{style:{height:24},children:" "})]}):(0,W.jsx)("div",{style:m.chatContainer,children:(0,W.jsx)("div",{style:{color:"#666",fontStyle:"italic"},children:"No messages to display - currently not supported for live transcripts, you may need to load from a log"})})}function de(e){var t,n,a,i,s;const{inference:l,trigger:d}=e,[c,p]=(0,r.useState)(!1),u=(0,r.useRef)(null),[m,h]=(0,r.useState)(void 0),x=(0,r.useCallback)((()=>p(!0)),[]),f=(0,r.useCallback)((()=>p(!1)),[]);(0,r.useEffect)((()=>{if(!c)return;const e=e=>{"Escape"===e.key&&f()};return document.addEventListener("keydown",e),u.current&&u.current.focus(),()=>{document.removeEventListener("keydown",e)}}),[c,f]);const y=(0,o().IS)((e=>({backdrop:{position:"fixed",top:0,insetInlineStart:0,insetInlineEnd:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:999,display:"flex",alignItems:"center",justifyContent:"center",padding:20},dialogContainer:{width:"95vw",maxWidth:1400,height:"90vh",backgroundColor:e.background.primary,border:`1px solid ${e.regularDividerColor}`,borderRadius:8,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},header:{padding:"16px 20px",borderBottom:`1px solid ${e.regularDividerColor}`,fontSize:16,fontWeight:600,color:e.text.primary,display:"flex",alignItems:"center",justifyContent:"space-between"},headerTitle:{flex:"0 0 auto"},headerControls:{display:"flex",gap:8,alignItems:"center"},content:{display:"flex",height:"100%",overflow:"hidden"},leftPanel:{flex:"0 0 60%",display:"flex",flexDirection:"column",borderInlineEnd:`1px solid ${e.regularDividerColor}`,minWidth:0},rightPanel:{flex:"0 0 40%",display:"flex",flexDirection:"column",overflow:"auto",padding:"16px 20px",gap:16,minWidth:0},transcriptContainer:{flex:1,overflow:"auto",padding:"16px 20px",minHeight:0},section:{display:"flex",flexDirection:"column",gap:8},sectionTitle:{fontSize:14,fontWeight:600,color:e.text.primary,borderBottom:`1px solid ${e.regularDividerColor}`,paddingBottom:4},toggle:{border:"none",padding:0,margin:0},metadataGrid:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"8px 16px",fontSize:12,fontFamily:"monospace"},metadataKey:{color:e.text.secondary,fontWeight:600},metadataValue:{color:e.text.primary,wordBreak:"break-all"},braintrustLink:{color:e.text.primary,textDecoration:"underline",cursor:"pointer",wordBreak:"break-all"},toolsList:{display:"flex",flexDirection:"column",gap:2}})),[]),v=(0,r.useMemo)((()=>l.metadata||{}),[l.metadata]),b=(0,r.useMemo)((()=>{if(v.renderedPrompt&&Array.isArray(v.renderedPrompt)){const t=[...v.renderedPrompt];return l.expected&&t.push({type:"assistant",content:(e=l.expected,"string"==typeof e||Array.isArray(e)?e:JSON.stringify(e,null,2)),name:"Output"}),t}var e;return null}),[v,l.expected]),j=(0,r.useMemo)((()=>v.tools||[]),[v]),k=(0,r.useCallback)((e=>`https://www.braintrust.dev/app/Notion/p/${(0,g().W)({environmentName:"production",suffix:"workflow"})}/logs?r=${e}`),[]),C=(0,r.useCallback)((e=>{const t=k(e);window.open(t,"_blank")}),[k]),S=(0,r.useMemo)((()=>{const e="transcript"in l.input&&Array.isArray(l.input.transcript)?l.input.transcript:void 0,t=new Map;return null==e||e.forEach((e=>{"agent-tool-result"===e.type&&e.toolName&&t.set(e.toolName,(t.get(e.toolName)||0)+1)})),t}),[l.input]),T=c?(0,W.jsx)("div",{style:y.backdrop,onClick:e=>{e.target===e.currentTarget&&f()},role:"presentation",children:(0,W.jsx)(se().A,{debugName:"InferenceMetadataDialog",capture:!0,allowEsc:!0,allowSearch:!1,children:(0,W.jsxs)("div",{ref:u,style:y.dialogContainer,role:"dialog","aria-label":"Inference Details",tabIndex:-1,children:[(0,W.jsxs)("div",{style:y.header,children:[(0,W.jsx)("div",{style:y.headerTitle,children:"Inference Details"}),(0,W.jsx)("div",{style:y.headerControls,children:m?(0,W.jsx)(oe,{collapseAll:m.collapseAll,collapseAgentMessages:m.collapseAgentMessages,uncollapseAll:m.uncollapseAll,allMessagesCollapsed:m.allMessagesCollapsed,agentMessagesCollapsed:m.agentMessagesCollapsed,hasCollapsedMessages:m.hasCollapsedMessages}):void 0})]}),(0,W.jsxs)("div",{style:y.content,children:[(0,W.jsx)("div",{style:y.leftPanel,children:(0,W.jsx)("div",{style:y.transcriptContainer,children:(0,W.jsx)(le,{messages:b??[],onCollapseStateChange:h})})}),(0,W.jsxs)("div",{style:y.rightPanel,children:[(0,W.jsxs)("div",{style:y.section,children:[(0,W.jsx)("div",{style:y.sectionTitle,children:"Basic Information"}),(0,W.jsxs)("div",{style:y.metadataGrid,children:[(0,W.jsx)("div",{style:y.metadataKey,children:"ID:"}),(0,W.jsx)("div",{style:y.metadataValue,children:l.id||"N/A"}),(0,W.jsx)("div",{style:y.metadataKey,children:"Input Type:"}),(0,W.jsx)("div",{style:y.metadataValue,children:(null===(t=l.input)||void 0===t?void 0:t.type)||"N/A"}),null!=v&&v.aiSessionId?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("div",{style:y.metadataKey,children:"AI Session ID:"}),(0,W.jsx)("div",{style:y.metadataValue,children:String(v.aiSessionId)})]}):void 0,null!=v&&v.aiTraceId?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("div",{style:y.metadataKey,children:"AI Trace ID:"}),(0,W.jsx)("button",{style:{...y.braintrustLink,background:"none",border:"none",padding:0,textAlign:"start",font:"inherit"},onClick:()=>C(String(v.aiTraceId)),title:"Click to open in Braintrust",type:"button",children:String(v.aiTraceId)})]}):void 0,null!=v&&v.modelInfo?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("div",{style:y.metadataKey,children:"Model:"}),(0,W.jsx)("div",{style:y.metadataValue,children:(null===(n=v.modelInfo)||void 0===n?void 0:n.notionName)||(null===(a=v.modelInfo)||void 0===a?void 0:a.vendorName)||"N/A"})]}):void 0,null!=v&&null!==(i=v.completionMetrics)&&void 0!==i&&i.tokens?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("div",{style:y.metadataKey,children:"Input Tokens:"}),(0,W.jsx)("div",{style:y.metadataValue,children:String(v.completionMetrics.tokens.inputTokens)||"N/A"}),(0,W.jsx)("div",{style:y.metadataKey,children:"Output Tokens:"}),(0,W.jsx)("div",{style:y.metadataValue,children:String(v.completionMetrics.tokens.outputTokens)||"N/A"})]}):void 0,null!=v&&null!==(s=v.completionMetrics)&&void 0!==s&&s.finishReason?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("div",{style:y.metadataKey,children:"Finish Reason:"}),(0,W.jsx)("div",{style:y.metadataValue,children:(e=>{const t=String(v.completionMetrics.finishReason),n=null==v||null===(e=v.completionMetrics)||void 0===e?void 0:e.toolName;return"tool_use"===t&&n?`${t}: ${n}`:t})()})]}):void 0]})]}),j&&j.length>0?(0,W.jsxs)("div",{style:y.section,children:[(0,W.jsx)("div",{style:y.sectionTitle,children:"Tools"}),(0,W.jsx)("div",{style:y.toolsList,children:j.map(((e,t)=>{const n=(null==e?void 0:e.name)||`Tool ${t+1}`,r=S.get(n)||0;return(0,W.jsx)(P().b,{label:n,right:r>0?(0,W.jsx)("span",{style:{fontSize:10,fontWeight:"bold",color:"#666"},children:1===r?"(ran)":`(ran x${r})`}):void 0,style:y.toggle,defaultOpen:!1,children:(0,W.jsx)(L().X,{language:"json",value:JSON.stringify(e,null,2)})},t)}))})]}):void 0,(0,W.jsxs)("div",{style:y.section,children:[(0,W.jsx)("div",{style:y.sectionTitle,children:"Raw Values"}),(0,W.jsx)(P().b,{label:"Input",style:y.toggle,defaultOpen:!1,children:(0,W.jsx)(L().X,{language:"json",value:JSON.stringify(l.input,null,2)})}),l.expected?(0,W.jsx)(P().b,{label:"Output",style:y.toggle,defaultOpen:!1,children:(0,W.jsx)(L().X,{language:"json",value:JSON.stringify(l.expected,null,2)})}):void 0,v&&Object.keys(v).length>0?(0,W.jsx)(P().b,{label:"Raw Metadata",style:y.toggle,defaultOpen:!1,children:(0,W.jsx)(L().X,{language:"json",value:JSON.stringify(v,null,2)})}):void 0]})]})]})]})})}):null;return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("button",{onClick:x,style:{cursor:"pointer",background:"none",border:"none",padding:0,margin:0,flexGrow:1,textAlign:"start",display:"flex"},type:"button","aria-label":"Open inference metadata dialog",children:d}),T?(0,ie.createPortal)(T,document.body):void 0]})}n(823215),n(908872);var ce=()=>n(749804),pe=()=>n(297872);function ue(e){const[t,n]=(0,r.useState)(!1),a=(0,i().v3)(),{onFocus:s,onBlur:o,...l}=e,d=e=>{(0,ce().I)({environment:a}),n(!0),null==s||s(e)},c=e=>{n(!1),null==o||o(e)};return(0,W.jsx)(pe().A,{capture:t,render:e=>(0,W.jsx)(M().A,{...l,...e,onFocus:d,onBlur:c})})}function ge(e){const t=(0,k().tz)(),{request:n,memories:a,clientStore:s,onChange:l}=e,d=(0,i().v3)(),[u,g]=(0,r.useState)(!1),[m,h]=(0,r.useState)(0),x=(0,o().IS)((e=>({topbar:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},status:{marginInlineEnd:2},formContainer:{display:"flex",flexDirection:"column",gap:12,padding:"12px 0"},formRow:{display:"flex",flexDirection:"column",gap:4},formLabel:{fontSize:12,color:e.darkTextColor,fontWeight:500},popupContent:{padding:16,minWidth:300},buttonRow:{display:"flex",gap:8},container:{padding:12,marginTop:16,border:`1px solid ${e.regularDividerColor}`,borderRadius:8,backgroundColor:e.background.primary},sectionTitle:{fontSize:14,fontWeight:600,marginBottom:12,color:e.text.primary},testResultsPopup:{padding:12,width:400,minWidth:400,maxWidth:"none",maxHeight:300,overflowY:"auto"},testResultItem:{marginBottom:16,fontSize:13,color:e.darkTextColor,whiteSpace:"pre-wrap"},testResultTitle:{fontWeight:600,marginBottom:8,fontSize:14},failedTestButton:{backgroundColor:"#ffebee",color:"#d32f2f",padding:"4px 8px",borderRadius:4},successTestButton:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"4px 8px",borderRadius:4},memorySelector:{display:"flex",gap:8,marginBottom:12,alignItems:"center"},memorySelect:{padding:"4px 8px",borderRadius:4,border:`1px solid ${e.regularDividerColor}`,backgroundColor:e.background.primary,color:e.text.primary},addMemoryButton:{display:"flex",alignItems:"center",gap:4}})),[]),[f,y]=(0,r.useState)(""),v=("inferenceTranscript"===n.type?[...n.request.transcript,...n.response.transcript].filter((e=>e.type.includes("inference"))):[]).map(((e,t)=>({index:t,id:e.id}))),b=(0,r.useCallback)(((e,t)=>{const n=[...a];n[m]={...n[m],[e]:t},l(n)}),[a,m,l]),j=(0,r.useCallback)((()=>{const e=a.filter(((e,t)=>t!==m));l(e),h(Math.min(m,e.length-1))}),[a,m,l]),C=(0,r.useCallback)((()=>{l([...a,{testTitle:"",inputSummary:"",promptFeedback:"",testInstructions:"",originalOutputPassesTest:!1,originalOutputTestResults:[],originalOutput:"",feedback:"",correctedOutputs:[],verified:!1,isOptional:!1}]),h(a.length)}),[a,l]),S=(0,r.useCallback)((async()=>{f.trim()&&(g(!0),await(0,$().Wd)({environment:d,request:n,memory:{...a[m],feedback:f},clientStore:s,onChange:e=>{const t=[...a];t[m]=e,l(t)}}),y(""),g(!1))}),[d,n,a,m,s,l,f]),T=(0,r.useCallback)((async()=>{g(!0),await(0,$().VZ)({environment:d,request:n,memory:a[m],clientStore:s,onChange:e=>{const t=[...a];t[m]=e,l(t)}}),g(!1)}),[d,n,a,m,s,l]),I=a[m];return(0,W.jsxs)("div",{style:x.container,children:[(0,W.jsx)("div",{style:x.sectionTitle,children:"Memory Editor"}),(0,W.jsxs)("div",{style:x.memorySelector,children:[(0,W.jsx)("select",{style:x.memorySelect,value:m,onChange:e=>h(Number(e.target.value)),children:a.map(((e,t)=>{return(0,W.jsxs)("option",{value:t,children:["Memory ",t+1,": ",(n=e.testTitle||"Untitled",n.length>24?`${n.slice(0,24)}...`:n)]},t);var n}))}),(0,W.jsx)(p().p,{onClick:C,style:x.addMemoryButton,children:"Add Memory"})]}),I?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("div",{style:x.topbar,children:[(0,W.jsx)("div",{style:x.status,children:u?(0,W.jsx)(c().k,{}):I.originalOutputTestResults&&I.originalOutputTestResults.length>0?(0,W.jsx)(w().A,{renderOrigin:e=>(0,W.jsxs)(p().p,{...e,style:I.originalOutputTestResults.every((e=>1===e.score))?x.successTestButton:x.failedTestButton,children:[I.originalOutputTestResults.every((e=>1===e.score))?"✅ Test score: ":"❌ Test score: ",(I.originalOutputTestResults.reduce(((e,t)=>e+t.score),0)/I.originalOutputTestResults.length).toFixed(2)]}),popupType:F().n.Popup,placementToOrigin:"bottom",render:()=>(0,W.jsx)("div",{style:x.testResultsPopup,children:I.originalOutputTestResults.map(((e,t)=>(0,W.jsxs)("div",{style:x.testResultItem,children:[(0,W.jsxs)("div",{style:x.testResultTitle,children:["Test Result ",t+1," - Score: ",e.score]}),e.reasoning]},t)))})}):null}),(0,W.jsxs)("div",{style:x.buttonRow,children:[(0,W.jsx)(w().A,{renderOrigin:e=>(0,W.jsx)(p().p,{...e,children:"Auto-generate"}),popupType:F().n.Popup,placementToOrigin:"bottom",render:e=>(0,W.jsxs)("div",{style:x.popupContent,children:[(0,W.jsxs)("div",{style:x.formRow,children:[(0,W.jsx)("div",{style:x.formLabel,children:"Feedback"}),(0,W.jsx)(ue,{value:f,placeholder:"Enter feedback to generate memory",onChange:e=>y(e.target.value),textarea:!0,autosize:!0})]}),(0,W.jsx)(p().p,{onClick:()=>{S(),e.close()},disabled:!f.trim(),children:"Generate"})]})}),(0,W.jsx)(p().p,{onClick:T,children:"Test"}),(0,W.jsx)(A().A,{icon:K().trashIcon,onClick:j,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.memoryEditor.deleteMemory",defaultMessage:"Delete memory"})})]})]}),(0,W.jsx)(P().b,{label:"Visual editor",defaultOpen:!0,children:(0,W.jsxs)("div",{style:x.formContainer,children:[(0,W.jsxs)("div",{style:x.formRow,children:[(0,W.jsx)("div",{style:x.formLabel,children:"Test Title"}),(0,W.jsx)(ue,{value:I.testTitle,placeholder:"Enter test title",onChange:e=>b("testTitle",e.target.value)})]}),(0,W.jsxs)("div",{style:x.formRow,children:[(0,W.jsx)("div",{style:x.formLabel,children:"Input Summary"}),(0,W.jsx)(ue,{value:I.inputSummary,placeholder:"Enter input summary",onChange:e=>b("inputSummary",e.target.value),textarea:!0,autosize:!0})]}),(0,W.jsxs)("div",{style:x.formRow,children:[(0,W.jsx)("div",{style:x.formLabel,children:"Prompt Feedback"}),(0,W.jsx)(ue,{value:I.promptFeedback,placeholder:"Enter prompt feedback",onChange:e=>b("promptFeedback",e.target.value),textarea:!0,autosize:!0})]}),(0,W.jsxs)("div",{style:x.formRow,children:[(0,W.jsx)("div",{style:x.formLabel,children:"Test Instructions"}),(0,W.jsx)(ue,{value:I.testInstructions,placeholder:"Enter test instructions",onChange:e=>b("testInstructions",e.target.value),textarea:!0,autosize:!0})]}),(0,W.jsx)("div",{style:x.formRow,children:(0,W.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,W.jsx)("input",{type:"checkbox",checked:I.originalOutputPassesTest,onChange:e=>b("originalOutputPassesTest",e.target.checked)}),(0,W.jsx)("span",{style:x.formLabel,children:"Original Output Passes Test"})]})}),(0,W.jsx)("div",{style:x.formRow,children:(0,W.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,W.jsx)("input",{type:"checkbox",checked:I.isOptional,onChange:e=>b("isOptional",e.target.checked)}),(0,W.jsx)("span",{style:x.formLabel,children:"Optional Memory"})]})}),v&&v.length>0?(0,W.jsxs)("div",{style:x.formRow,children:[(0,W.jsx)("div",{style:x.formLabel,children:"stepId:"}),(0,W.jsxs)("select",{style:{display:"flex",alignItems:"center",gap:8},value:I.stepId??"all",onChange:e=>{const t=e.target.value,n=v.find((e=>e.id===t));b("stepId",null==n?void 0:n.id)},children:[(0,W.jsx)("option",{value:"all",children:"all"},-1),v.map((e=>(0,W.jsx)("option",{value:e.id,children:`${e.index}: ...${e.id.slice(-8)}`},e.index)))]})]}):void 0]})}),(0,W.jsx)(P().b,{label:"JSON editor",defaultOpen:!1,children:(0,W.jsx)(L().X,{language:"json",value:JSON.stringify(I,null,2)})})]}):void 0]})}var me=()=>n(718827),he=()=>n(284371),xe=()=>n(88291);function fe(e){const t=e.model,n=(0,i().v3)(),r=(0,o().IS)((e=>({badge:{fontSize:12,fontWeight:500,padding:"1px 6px",backgroundColor:e.cardHoveredBackground,color:e.text.tertiary,borderRadius:4,...he().RC}})),[]),a=(0,s().K8)((()=>xe().$.getData(n,{})||[]),[n]),l=e.model?ye[e.model]||e.model:"Default model";return(0,W.jsx)(w().A,{popupType:w().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",renderOrigin:t=>(0,W.jsx)(B().A,{renderTooltip:()=>(0,W.jsx)("div",{children:"Select a model"}),placement:"bottom",alignment:"center",render:n=>"button"===e.format?(0,W.jsx)(p().p,{...(0,H().A)(t,n),children:l}):(0,W.jsx)(me().Ay,{...(0,H().A)(t,n),ignoreLocalHoverState:!0,children:(0,W.jsx)("div",{style:r.badge,children:l})})}),render:n=>(0,W.jsx)(O().A,{menuType:D().gu.Popup,children:(0,W.jsx)(R().Ay,{type:R().Oh.Vertical,initialFocus:0,sections:[{key:"models",render:e=>(0,W.jsx)(N().A,{...e,title:"Models",shouldShowBottomDivider:!0}),items:a.map((r=>({key:r,action:()=>{e.setModel(r),n.close()},render:e=>(0,W.jsx)(I().A,{...e,title:ye[r]||r,isChecked:r===t})})))}]})})})}const ye={default:"Default model","openai-gpt-4o":"OpenAI GPT-4o","openai-chatgpt-4o-latest":"OpenAI ChatGPT-4o-latest","openai-gpt-4o-mini":"OpenAI GPT-4o-mini","openai-o1":"OpenAI o1","openai-o1-mini":"OpenAI o1-mini","openai-o3-mini":"OpenAI o3-mini","openai-o3":"OpenAI o3","openai-o4-mini":"OpenAI o4-mini","openai-gpt-4.1":"OpenAI GPT-4.1","openai-gpt-4.1-mini":"OpenAI GPT-4.1-mini","openai-gpt-4.1-nano":"OpenAI GPT-4.1-nano","openai-gpt-5-mini":"OpenAI GPT-5 Mini","openai-gpt-5-nano":"OpenAI GPT-5 Nano","openai-turbo":"OpenAI Turbo","openai-turbo-minimal-thinking":"OpenAI Turbo Minimal Thinking","openai-turbo-thinking":"OpenAI Turbo Thinking","openai-turbo-10":"OpenAI GPT-5 + juice@10","openai-turbo-8":"OpenAI GPT-5 + juice@8","anthropic-haiku":"Anthropic Haiku","anthropic-sonnet-3.5":"Anthropic Sonnet 3.5","anthropic-sonnet-3.7":"Anthropic Sonnet 3.7","anthropic-sonnet-3.7-thinking":"Anthropic Sonnet 3.7 Thinking","anthropic-sonnet-4":"Anthropic Sonnet 4","anthropic-sonnet-4-thinking":"Anthropic Sonnet 4 Thinking","anthropic-opus-4":"Anthropic Opus 4","anthropic-opus-4-thinking":"Anthropic Opus 4 Thinking","anthropic-opus-4.1":"Anthropic Opus 4.1","anthropic-opus-4.1-thinking":"Anthropic Opus 4.1 Thinking","anthropic-sonnet-alt":"Anthropic Sonnet (dev only)","anthropic-sonnet-alt-thinking":"Anthropic Sonnet (dev only) + thinking","anthropic-opus":"Anthropic Opus","vertex-gemini-1.5-pro":"Vertex Gemini 1.5 Pro","vertex-gemini-1.5-flash":"Vertex Gemini 1.5 Flash","vertex-gemini-2.0-flash":"Vertex Gemini 2.0 Flash","vertex-gemini-2.5-pro":"Vertex Gemini 2.5 Pro","vertex-gemini-2.5-flash":"Vertex Gemini 2.5 Flash","gemini-pro":"Gemini 2.5 Pro","gemini-flash":"Gemini 2.5 Flash","groq-gemma2-9b-it":"Groq Gemma2 9b It","groq-gemma-7b-it":"Groq Gemma 7b It","groq-llama-70b":"Groq Llama 70b","groq-llama-8b":"Groq Llama 8b","groq-mixtral":"Groq Mixtral","fireworks-llama3.1-405b":"Llama 3.1 405b","fireworks-llama3.1-70b":"Llama 3.1 70b","fireworks-llama3.3-70b":"Llama 3.3 70b","fireworks-llama3.3-70b-dedicated":"Llama 3.3 70b Dedicated","fireworks-llama3.1-8b":"Llama 3.1 8b","fireworks-llama3-70b":"Llama 3.70b","fireworks-mixtral-22b":"Mixtral 22b","fireworks-mixtral-7b":"Mixtral 7b","fireworks-ft-router-101":"FT Router 101","fireworks-ft-router-102":"FT Router 102","fireworks-deepseek-v3":"DeepSeek V3","fireworks-deepseek-r1":"DeepSeek R1","fireworks-deepseek-r1-0528":"DeepSeek R1 0528","fireworks-kimi-k2":"Kimi K2","fireworks-gpt-oss-20b":"GPT-OSS 20b","fireworks-gpt-oss-120b":"GPT-OSS 120b","fireworks-llama-8b-finetune-v07-p50-cru6bgc4":"Llama 8b Finetune V07 P50 (Iowa)","cerebras-llama3.1-8b":"Cerebras Llama 3.1 8b","cerebras-llama3.3-70b":"Cerebras Llama 3.3 70b","cerebras-deepseek-r1-distill-llama-70b":"Cerebras DeepSeek R1 Distill Llama 70b","bedrock-nova-pro":"Bedrock Nova Pro","bedrock-nova-lite":"Bedrock Nova Lite","bedrock-nova-micro":"Bedrock Nova Micro","bedrock-anthropic-sonnet-3.7":"Bedrock Anthropic Sonnet 3.7","bedrock-anthropic-sonnet-3.5":"Bedrock Anthropic Sonnet 3.5","bedrock-anthropic-haiku-3.5":"Bedrock Anthropic Haiku"};var ve=()=>n(406094),be=()=>n(449445),je=()=>n(668725),ke=()=>n(763884),Ce=()=>n(419357);function Se(e){const{scopeKey:t,inference:n,defaultState:r}=e,a=(0,k().tz)();return(0,W.jsx)(w().A,{popupType:w().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",renderOrigin:e=>(0,W.jsx)(B().A,{renderTooltip:()=>"Save to dataset",placement:"top",render:t=>(0,W.jsx)("div",{...(0,H().A)(t,e),children:(0,W.jsx)(A().A,{icon:be().arrowLineDownSmallIcon,ariaLabel:a.formatMessage({defaultMessage:"Retry",id:"aiInferenceTranscript.debug.retry"})})})}),render:e=>(0,W.jsx)(Te,{scopeKey:t,inference:n,buttonPopupParent:e,defaultState:r})})}function Te(e){const{scopeKey:t,inference:n,buttonPopupParent:a,defaultState:s}=e,l=(0,i().v3)(),d=(0,o().IS)((e=>({menuContent:{display:"flex",flexDirection:"column",gap:8,padding:8},label:{fontSize:12,color:e.text.primary}})),[]),c=(0,r.useMemo)((()=>function(e){const{environment:t,scopeKey:n,defaultState:r}=e,a=Oe(n),i=ke().K.get({userId:t.currentUser.id,key:a});if(!i&&r)return r;return i||{project:void 0,dataset:void 0,tags:[]}}({environment:l,scopeKey:t,defaultState:s})),[l,s,t]),[p,u]=(0,r.useState)(c),g=(0,r.useCallback)((e=>{u(e),function(e){const{environment:t,scopeKey:n,state:r}=e,a=Oe(n);ke().K.set({userId:t.currentUser.id,key:a,value:r})}({environment:l,scopeKey:t,state:e})}),[l,t]),m=(0,r.useCallback)((e=>{g({...p,project:e,dataset:void 0})}),[g,p]),h=(0,r.useCallback)((e=>{g({...p,dataset:e})}),[g,p]),x=(0,r.useCallback)((e=>{g({...p,tags:e})}),[g,p]),f=(0,r.useCallback)((()=>{const{project:e,dataset:t,tags:r}=p;e&&t&&(0,$().wm)({environment:l,inference:{...n,tags:r},project:e.name,dataset:t})}),[l,n,p]);return(0,W.jsx)(O().A,{menuType:D().gu.Popup,...a,children:(0,W.jsxs)("div",{style:d.menuContent,children:[(0,W.jsx)("div",{style:d.label,children:"Project"}),(0,W.jsx)(Ie,{project:p.project,setProject:m}),p.project?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("div",{style:d.label,children:"Dataset"}),(0,W.jsx)(we,{project:p.project.name,dataset:p.dataset,onChange:h})]}):void 0,p.project&&p.dataset?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("div",{style:d.label,children:"Tags"}),(0,W.jsx)(Me,{tags:p.tags,onChange:x}),(0,W.jsx)(ve().A,{size:"lg",onClick:f,children:"Save"})]}):void 0]})})}function Ie(e){const t=e.project,[n,a]=(0,r.useState)([]),s=(0,i().v3)();return(0,h().Yb)((async()=>{const e=await T().callApi({eventName:"getBraintrustProjects",environment:s,data:{}});if("failed"===e.type)throw e.error;a(e.data.projects.map((({id:e,name:t})=>({id:e,name:t}))))}),[s]),(0,W.jsx)(Ae,{items:n.sort(((e,t)=>e.name.localeCompare(t.name))),selectedItem:t,onSelect:e.setProject,renderItem:e=>e.name,isFiltered:(e,t)=>e.name.toLowerCase().includes(t.toLowerCase()),placeholder:"Select project"})}function we(e){const{project:t,dataset:n,onChange:a}=e,s=(0,i().v3)(),[o,l]=(0,r.useState)([]),d=(0,r.useCallback)((async()=>{if(!t)return;const e=await T().callApi({eventName:"getBraintrustDatasetsForProject",environment:s,data:{project:t}});if("failed"===e.type)throw e.error;const n=e.data.datasets.map((e=>e.name));n.sort(),l(n)}),[s,t]);return(0,h().Yb)((async()=>{await d()}),[d]),(0,W.jsx)(Ae,{items:o,selectedItem:n,onSelect:a,renderItem:S().D_,isFiltered:(e,t)=>e.toLowerCase().includes(t.toLowerCase()),placeholder:"Select dataset"})}function Ae(e){const{items:t,selectedItem:n,onSelect:a,renderItem:i,placeholder:s,isFiltered:l}=e,d=(0,o().IS)((e=>({chevron:{width:10,marginInlineStart:4,fill:e.icon.tertiary},buttonWrapper:{display:"flex",alignItems:"center"}})),[]),[c,u]=(0,r.useState)(""),g=(0,r.useCallback)((e=>{u(e.target.value)}),[]),m=t.filter((e=>l(e,c)));return(0,W.jsx)(w().A,{popupType:w().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",renderOrigin:e=>(0,W.jsx)(p().p,{...e,children:(0,W.jsxs)("div",{style:d.buttonWrapper,children:[n?i(n):s||"",(0,je().b)(d.chevron)]})}),render:e=>(0,W.jsxs)(O().A,{menuType:D().gu.Popup,children:[(0,W.jsx)(Ce().Ay,{value:c,onChange:g,autoFocus:!0}),(0,W.jsx)(R().Ay,{type:R().Oh.Vertical,initialFocus:0,sections:[{key:"items",render:e=>(0,W.jsx)(N().A,{...e}),items:m.map(((t,r)=>({key:r,action:()=>{a(t),e.close()},render:e=>(0,W.jsx)(I().A,{...e,title:i(t),isChecked:t===n})})))}]})]})})}function Me(e){const{tags:t,onChange:n}=e,a=(0,o().IS)((e=>({container:{display:"flex",flexDirection:"column",gap:4},tagsContainer:{display:"flex",flexWrap:"wrap",gap:8}})),[]),i=(0,r.useCallback)((e=>{const r=t.includes(e)?t.filter((t=>t!==e)):[...t,e];n(r)}),[n,t]);return(0,W.jsx)("div",{style:a.container,children:(0,W.jsx)("div",{style:a.tagsContainer,children:u().d7.map((e=>(0,W.jsxs)(p().p,{onClick:()=>i(e),style:{display:"flex",alignItems:"center",gap:4},children:[(0,W.jsx)(d().S,{checked:t.includes(e),size:14}),(0,W.jsx)("span",{children:e})]},e)))})})}function Oe(e){return`ai-inference-transcript-save-to-dataset-${e}`}function Re(e){const{step:t,compressionThreshold:n}=e,{inputTokens:r,outputTokens:a,cachedTokensRead:i,cachedTokensCreated:s}=t,l=(0,o().IS)((e=>({container:{display:"flex",flexDirection:"column",gap:4,fontSize:12,fontFamily:"monospace"},progressContainer:{display:"flex",alignItems:"center",gap:8},progressBar:{flexGrow:1,minWidth:100},label:{color:e.text.secondary,minWidth:120},metrics:{display:"flex",gap:12,marginTop:2,fontSize:11,color:e.text.tertiary},metric:{display:"flex",alignItems:"center",gap:4},colorBox:{width:8,height:8,borderRadius:2}})),[]),d=i??0,c=s??0,p=Math.max(0,(r??0)-d),u=d+p+c+(a??0),g=t.maxInputTokens??t.maxContextTokens??272e3,m=(0,o().IS)((e=>({progressContainer:{width:"100%",height:6,backgroundColor:e.border.secondary,borderRadius:3,overflow:"visible",display:"flex",position:"relative"},segment:{height:"100%",transition:"width 0.3s ease"},thresholdLine:{position:"absolute",top:-2,width:1,height:10,backgroundColor:e.text.secondary,zIndex:1,pointerEvents:"none"}})),[]);if(0===u)return null;const h=Math.min(u/g*100,100),x=e=>void 0===e||0===e?"0":e.toLocaleString(),f=[`Total input tokens: ${x(r)}`,d>0?`  • Cached read: ${x(d)}`:null,p>0?`  • Uncached read: ${x(p)}`:null,`Output tokens: ${x(a)}`,s?`Cached tokens created: ${x(s)}`:null,void 0!==n?`Compression threshold: ${x(Math.round(n*g))} (${Math.round(100*n)}%)`:null,`Total: ${x(u)} / ${x(g)} (${Math.round(h)}%)`].filter(Boolean).join("\n"),y=p/g*100,v=d/g*100,b=(a??0)/g*100,j=(s??0)/g*100,k=void 0!==n?100*n:void 0;return(0,W.jsxs)("div",{style:l.container,children:[(0,W.jsxs)("div",{style:l.progressContainer,children:[(0,W.jsx)("span",{style:l.label,children:"Token Usage:"}),(0,W.jsx)("div",{style:l.progressBar,children:(0,W.jsx)(B().A,{renderTooltip:()=>(0,W.jsx)("div",{style:{whiteSpace:"pre-line"},children:f}),placement:"top",render:e=>(0,W.jsxs)("div",{...e,style:m.progressContainer,children:[p>0?(0,W.jsx)("div",{style:{...m.segment,width:`${Math.max(.5,y)}%`,backgroundColor:"#3498db"},title:`Uncached read tokens: ${x(p)}`}):void 0,d>0?(0,W.jsx)("div",{style:{...m.segment,width:`${Math.max(.5,v)}%`,backgroundColor:"#9b59b6"},title:`Cached read tokens: ${x(d)}`}):void 0,void 0!==a&&a>0?(0,W.jsx)("div",{style:{...m.segment,width:`${Math.max(.5,b)}%`,backgroundColor:"#e67e22"},title:`Output tokens: ${x(a)}`}):void 0,void 0!==s&&s>0?(0,W.jsx)("div",{style:{...m.segment,width:`${Math.max(.5,j)}%`,backgroundColor:"#1abc9c"},title:`Cached tokens created: ${x(s)}`}):void 0,void 0!==k?(0,W.jsx)("div",{style:{...m.thresholdLine,insetInlineStart:`${k}%`},title:`Compression threshold: ${Math.round(100*n)}%`}):void 0]})})}),(0,W.jsxs)("span",{style:l.label,children:[x(u)," / ",x(g)," (",Math.round(h),"%)"]})]}),(0,W.jsxs)("div",{style:l.metrics,children:[p>0?(0,W.jsx)(B().A,{renderTooltip:()=>`Uncached read tokens: ${x(p)}`,placement:"top",render:e=>(0,W.jsxs)("div",{...e,style:l.metric,children:[(0,W.jsx)("div",{style:{...l.colorBox,backgroundColor:"#3498db"}}),(0,W.jsxs)("span",{children:["Uncached Read: ",x(p)]})]})}):void 0,d>0?(0,W.jsx)(B().A,{renderTooltip:()=>`Cached read tokens: ${x(d)}`,placement:"top",render:e=>(0,W.jsxs)("div",{...e,style:l.metric,children:[(0,W.jsx)("div",{style:{...l.colorBox,backgroundColor:"#9b59b6"}}),(0,W.jsxs)("span",{children:["Cached Read: ",x(d)]})]})}):void 0,void 0!==a&&a>0?(0,W.jsx)(B().A,{renderTooltip:()=>`Output tokens: ${x(a)}`,placement:"top",render:e=>(0,W.jsxs)("div",{...e,style:l.metric,children:[(0,W.jsx)("div",{style:{...l.colorBox,backgroundColor:"#e67e22"}}),(0,W.jsxs)("span",{children:["Output: ",x(a)]})]})}):void 0,void 0!==s&&s>0?(0,W.jsx)(B().A,{renderTooltip:()=>`Cached tokens created: ${x(s)}`,placement:"top",render:e=>(0,W.jsxs)("div",{...e,style:l.metric,children:[(0,W.jsx)("div",{style:{...l.colorBox,backgroundColor:"#1abc9c"}}),(0,W.jsxs)("span",{children:["Cached Created: ",x(s)]})]})}):void 0]})]})}function Ne(e){const{clientStore:t,threadStore:n}=e,a=(0,o().IS)((e=>({topBar:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,fontSize:14},inferencesWrap:{display:"flex",flexDirection:"column",gap:12,fontSize:14},header:{fontSize:14}})),[]),i=(0,s().K8)((()=>null==n?void 0:n.id),[n]),d=(0,s().K8)((()=>i?t.getOrCreateClientAIChatThreadStore(i).state.inferences.length:0),[t,i]),u=(0,s().K8)((()=>Boolean(i&&t.getOrCreateClientAIChatThreadStore(i).state.loading||void 0!==(null==n?void 0:n.getCurrentInferenceId()))),[t,n,i]),g=(0,s().K8)((()=>i?t.getOrCreateClientAIChatThreadStore(i).state.inferences:[]),[t,i]),m=(0,s().K8)((()=>i?t.getOrCreateClientAIChatThreadStore(i).state.requestInfo:void 0),[t,i]),h=(0,r.useCallback)((()=>{if(!i)return;const e=t.getOrCreateClientAIChatThreadStore(i),{acceptedInferenceKeys:n}=e.state;n.length>0?e.setState({...e.state,acceptedInferenceKeys:[]}):e.setState({...e.state,acceptedInferenceKeys:e.state.inferences.map((e=>e.key))})}),[t,i]),x=(0,s().K8)((()=>t.state.configForNewTranscripts),[t]),f=(0,s().K8)((()=>t.state.debugOverrides),[t]),y=(0,s().K8)((()=>t.state.model),[t]),v=(0,r.useCallback)((e=>{t.setState({...t.state,model:e})}),[t]),b=(0,s().K8)((()=>(0,z().av)(n)),[n]);return(0,W.jsxs)(l().Y1,{direction:"vertical",height:"fill",width:"fill",style:{pointerEvents:"auto"},children:[(0,W.jsxs)(l().Y1,{direction:"horizontal",gap:8,padding:"8px 12px",height:46,align:"center",children:[u?(0,W.jsx)(c().k,{}):void 0,!b&&n?(0,W.jsx)(Fe,{clientStore:t,threadStore:n},n.id):void 0,(0,W.jsx)("div",{style:{flexGrow:1}}),(0,W.jsx)(fe,{model:y,setModel:v,format:"badge"}),(0,W.jsx)(ae,{clientStore:t})]}),(0,W.jsxs)(l().Y1,{direction:"vertical",gap:16,padding:"8px 12px",height:"fill",style:{overflowY:"auto"},children:[m?(0,W.jsx)(Be,{requestInfo:m,clientStore:t,threadStore:n}):void 0,b&&x?(0,W.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:(0,W.jsx)(Ee,{debugOverrides:f,clientStore:t,configType:x.type})}):void 0,(0,W.jsx)(ze,{inferences:g,requestInfo:m,model:y}),(0,W.jsxs)("div",{style:a.inferencesWrap,children:[g.length>0?(0,W.jsxs)("div",{style:a.topBar,children:[(0,W.jsx)("div",{style:a.header,children:"Inferences"}),(0,W.jsx)("div",{style:{flexGrow:1}}),d>0?(0,W.jsx)("div",{children:`${d} inference${1===d?"":"s"}`}):void 0,!u&&d>0?(0,W.jsx)(p().p,{onClick:h,children:"Toggle all"}):void 0]}):void 0,g.map(((e,r)=>(0,W.jsx)(Le,{inference:e,clientStore:t,threadStore:n},`${e.key}-${r}`)))]})]})]})}function Be(e){var t;const{requestInfo:n,clientStore:a,threadStore:i}=e,l=(0,s().K8)((()=>null==i?void 0:i.id),[i]),d=(0,o().IS)((e=>({wrap:{display:"flex",flexDirection:"column",gap:4,padding:"4px 2px",border:`1px solid ${e.regularDividerColor}`,borderRadius:8,whiteSpace:"pre-wrap",fontSize:14},header:{display:"flex",gap:4,alignItems:"center",padding:"0 6px"},toggle:{border:"none",padding:0,margin:0}})),[]),{request:c,response:p,memories:g}=n,h=c.transcript.find((e=>"config"===e.type)),x=(0,r.useCallback)((()=>{if(!p)throw new Error("Response is required");if(!l)return;const e=a.getOrCreateClientAIChatThreadStore(l);e.setState({...e.state,requestInfo:{...n,memories:[{...u().s8,originalOutput:p}]}})}),[a,n,p,l]),y=(0,r.useCallback)((e=>{if(!l)return;const t=a.getOrCreateClientAIChatThreadStore(l);t.setState({...t.state,requestInfo:{...n,memories:e}})}),[a,n,l]),b=(0,r.useCallback)((e=>{if(!l)return;const t=a.getOrCreateClientAIChatThreadStore(l);t.setState({...t.state,requestInfo:{...n,expectedAgentTools:e}})}),[a,n,l]),j=(0,r.useCallback)((e=>{var t,n,r;if(!l)return;const i=a.getOrCreateClientAIChatThreadStore(l),s=(null===(t=e.metadata)||void 0===t?void 0:t.memories)||[],o=null===(n=e.metadata)||void 0===n?void 0:n.expectedAgentTools;e.input.type===m().uF&&i.setState({...i.state,requestInfo:{request:e.input,response:e.expected,memories:s,expectedAgentTools:o,availableToolNames:null===(r=e.metadata)||void 0===r?void 0:r.tools}})}),[a,l]),C=(0,r.useCallback)((()=>{if(!l)return;const e=a.getOrCreateClientAIChatThreadStore(l);e.setState({...e.state,requestInfo:{...n,expectedAgentTools:{expect:[{toolType:"search",minTimes:void 0,maxTimes:void 0,description:""}]}}})}),[a,n,l]),S=(0,s().K8)((()=>function(e){if(!e)return;const t=e.getMessageStores(),n=t.map((e=>e.getStep())).filter((e=>"eval-result"===(null==e?void 0:e.type)));if(0===n.length)return;const r=n[n.length-1],a=null==r?void 0:r.braintrustInfo;if(null==a||!a.project||null==a||!a.dataset||null==a||!a.originalInferenceId)return;return{project:a.project,dataset:a.dataset,exampleId:a.originalInferenceId}}(i)),[i]),T=(0,r.useMemo)((()=>({id:(null==S?void 0:S.exampleId)||c.traceId,input:{type:m().uF,...c},expected:p,metadata:{memories:g.map((({originalOutput:e,...t})=>t)),...n.expectedAgentTools&&{expectedAgentTools:n.expectedAgentTools}}})),[c,p,g,S,n.expectedAgentTools]),I=(0,r.useMemo)((()=>{if(!n.response)return;return{type:"inferenceTranscript",request:n.request,response:n.response}}),[n]),w=(0,k().tz)();return(0,W.jsxs)("div",{style:d.wrap,children:[(0,W.jsxs)("div",{style:d.header,children:[(0,W.jsxs)("span",{style:{flexGrow:1},children:["Request",S?(0,W.jsx)("a",{href:`https://www.braintrust.dev/app/Notion/p/${S.project}/datasets/${S.dataset}?r=${S.exampleId}`,target:"_blank",rel:"noopener noreferrer",style:{marginInlineStart:8,fontSize:12,color:"inherit"},children:"View in Braintrust"}):void 0]}),0===g.length?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(B().A,{renderTooltip:()=>"Add memory for this inference",placement:"top",render:e=>(0,W.jsx)("div",{...e,children:(0,W.jsx)(A().A,{icon:v().plusSmallIcon,onClick:x,ariaLabel:w.formatMessage({defaultMessage:"Add memory",id:"aiInferenceTranscript.debug.addMemory"})})})}),(0,W.jsx)(Ke,{onLoadExample:j,datasetInfo:S})]}):void 0,n.expectedAgentTools&&n.expectedAgentTools.expect&&0!==n.expectedAgentTools.expect.length?void 0:(0,W.jsx)(B().A,{renderTooltip:()=>"Add agent tool expectations",placement:"top",render:e=>(0,W.jsx)("div",{...e,children:(0,W.jsx)(A().A,{icon:f().P,onClick:C,ariaLabel:w.formatMessage({defaultMessage:"Add agent tool expectations",id:"aiInferenceTranscript.debug.addAgentToolExpectations"})})})}),T?(0,W.jsx)(Se,{inference:T,scopeKey:`inferenceTranscript-${null==h?void 0:h.value.type}`}):void 0]}),(0,W.jsx)(P().b,{label:"Input",style:d.toggle,children:(0,W.jsx)(L().X,{language:"json",value:JSON.stringify(n.request,null,2)})}),n.response?(0,W.jsx)(P().b,{label:"Output",style:d.toggle,children:(0,W.jsx)(L().X,{value:JSON.stringify(n.response,null,2),language:"json"})}):null,I&&g.length>0?(0,W.jsx)(ge,{request:I,memories:g,onChange:y,clientStore:a}):void 0,n.expectedAgentTools&&n.expectedAgentTools.expect&&n.expectedAgentTools.expect.length>0?(0,W.jsx)(q,{expectations:n.expectedAgentTools,onChange:b,transcript:[...n.request.transcript,...(null===(t=n.response)||void 0===t?void 0:t.transcript)??[]]}):void 0]})}function De(e){const{inference:t,clientStore:a,threadStore:l}=e,c=t.key,p=(0,i().v3)(),g=(0,s().K8)((()=>null==l?void 0:l.id),[l]),m=(0,o().IS)((e=>({wrap:{display:"flex",flexDirection:"column",gap:4,padding:"4px 2px",border:`1px solid ${e.regularDividerColor}`,borderRadius:8,whiteSpace:"pre-wrap",fontSize:14},header:{padding:"0 6px",display:"flex",gap:4,alignItems:"center"},annotation:{padding:"0 6px"},toggle:{border:"none",padding:0,margin:0},typeLabel:{flexGrow:1,marginInlineStart:4,fontSize:12,fontFamily:"monospace"}})),[]),h=(0,s().K8)((()=>g?a.getOrCreateClientAIChatThreadStore(g).state.inferenceKeysToAnnotations[c]:void 0),[a,c,g]),x=(0,r.useCallback)((e=>{if(!g)return;const t=a.getOrCreateClientAIChatThreadStore(g),n=e.target.value,r={...t.state.inferenceKeysToAnnotations,[c]:n};t.setState({...t.state,inferenceKeysToAnnotations:r})}),[a,c,g]),f=(0,s().K8)((()=>{if(!g)return!1;const{acceptedInferenceKeys:e}=a.getOrCreateClientAIChatThreadStore(g).state;return e.includes(c)}),[a,c,g]),y=(0,r.useCallback)((e=>{if(!g)return;const t=a.getOrCreateClientAIChatThreadStore(g),{acceptedInferenceKeys:n,inferences:r}=t.state,i=e.shiftKey;if(n.includes(c))if(i){const e=r.findIndex((e=>e.key===c)),a=r.slice(0,e+1).map((e=>e.key));t.setState({...t.state,acceptedInferenceKeys:S().sb(n.filter((e=>!a.includes(e))))})}else t.setState({...t.state,acceptedInferenceKeys:n.filter((e=>e!==c))});else if(i){const e=r.findIndex((e=>e.key===c)),a=r.slice(0,e+1).map((e=>e.key)),i=S().sb([...n,...a]);t.setState({...t.state,acceptedInferenceKeys:i})}else t.setState({...t.state,acceptedInferenceKeys:S().sb([...n,c])})}),[a,c,g]),b=(0,r.useMemo)((()=>{const e=null==t?void 0:t.value.expected;if(!e)return"";if("string"!=typeof e)return JSON.stringify(e,null,2);try{return e.trim().startsWith("{")?JSON.stringify(JSON.parse(e),null,2):e}catch(n){return e}}),[t]),j=(0,s().K8)((()=>{if(g)return a.getOrCreateClientAIChatThreadStore(g).state.inferenceKeysToMemories[c]}),[a,c,g]),C=(0,r.useMemo)((()=>({type:"inference",inference:t.value})),[t]),T=(0,r.useCallback)((async()=>{g&&await(0,$().Ou)({environment:p,clientStore:a,inference:t,threadId:g})}),[a,p,t,g]),I=(0,r.useCallback)((e=>{if(!g)return;const t=a.getOrCreateClientAIChatThreadStore(g);t.setState({...t.state,inferenceKeysToMemories:{...t.state.inferenceKeysToMemories,[c]:e[0]}})}),[a,c,g]),w=(0,r.useCallback)((()=>{if(!g)return;if(!t.value.expected)throw new Error("Expected output is required");const e=a.getOrCreateClientAIChatThreadStore(g);e.setState({...e.state,inferenceKeysToMemories:{...e.state.inferenceKeysToMemories,[c]:{...u().s8,originalOutput:t.value.expected}}})}),[a,c,t,g]),M=(0,r.useMemo)((()=>({...t.value,metadata:{...t.value.metadata,memories:S().oE([j])}})),[t,j]),O=(0,k().tz)();return t?(0,W.jsxs)("div",{style:m.wrap,children:[(0,W.jsxs)("div",{style:m.header,children:[(0,W.jsx)(B().A,{renderTooltip:()=>(0,W.jsx)("div",{style:{width:300,whiteSpace:"normal"},children:"Checking this will 'freeze' this inference. When the request is retried, instead of running the inference again, the original output will be used."}),placement:"top",render:e=>(0,W.jsx)("div",{...e,children:(0,W.jsx)(d().S,{checked:f,size:14,onClick:y})})}),(0,W.jsx)(de,{inference:t.value,trigger:(0,W.jsx)("span",{style:{...m.typeLabel,cursor:"pointer",textDecoration:"underline",textDecorationStyle:"dotted"},children:Pe(t.value.input)})}),(0,W.jsx)(B().A,{renderTooltip:()=>"Retry inference",placement:"top",render:e=>(0,W.jsx)("div",{...e,children:(0,W.jsx)(A().A,{icon:n(499872).b,onClick:T,ariaLabel:O.formatMessage({defaultMessage:"Retry",id:"aiInferenceTranscript.debug.retry"})})})}),(0,W.jsx)(Y,{inference:t.value}),j?void 0:(0,W.jsx)(B().A,{renderTooltip:()=>"Add memory for this inference",placement:"top",render:e=>(0,W.jsx)("div",{...e,children:(0,W.jsx)(A().A,{icon:v().plusSmallIcon,onClick:w,ariaLabel:O.formatMessage({defaultMessage:"Add memory",id:"aiInferenceTranscript.debug.addMemory"})})})}),(0,W.jsx)(Se,{inference:M,scopeKey:`inference-${t.value.input.type}`,defaultState:{project:void 0,dataset:t.value.input.type,tags:[]}})]}),(0,W.jsx)($e,{input:t.value.input}),(0,W.jsx)(B().A,{renderTooltip:()=>(0,W.jsx)("div",{style:{width:300,whiteSpace:"normal"},children:"The text you type here is passed as 'context.annotation' when this inference is retried. Typically, this is rendered as a final user step in the prompt used to 'nudge' the model."}),placement:"right",render:e=>(0,W.jsx)("div",{...e,style:m.annotation,children:(0,W.jsx)(ue,{value:h,placeholder:"Set annotation",onChange:x,textarea:!0,autosize:!0})})}),(0,W.jsx)(P().b,{label:"Input",style:m.toggle,children:(0,W.jsx)(L().X,{disabled:!0,language:"json",value:JSON.stringify({...t.value.input,examples:void 0},null,2)})}),t.value.expected?(0,W.jsx)(P().b,{label:"Output",style:m.toggle,children:(0,W.jsx)(L().X,{disabled:!0,value:b,language:"json"})}):null,t.value.metadata?(0,W.jsx)(P().b,{label:"Metadata",style:m.toggle,children:(0,W.jsx)(L().X,{disabled:!0,value:JSON.stringify(t.value.metadata,null,2),language:"json"})}):null,j?(0,W.jsx)(ge,{request:C,memories:[j],onChange:I,clientStore:a}):void 0]}):null}const Le=r.memo(De);function Pe(e){let t=e.type;"fileName"in e&&(t+=` – ${e.fileName}`),"testName"in e&&(t+=` – ${e.testName}`),"functionKey"in e&&(t+=` – ${e.functionKey}`),"key"in e&&(t+=` – ${e.key}`);const n=["retries","validationRetries"];for(const r of n)if(r in e&&e[r].length>0){t+=` (${e[r].filter((e=>"assistant"!==e.type)).length} error steps)`}return t}function $e(e){const{input:t}=e,n="transcript"in t&&Array.isArray(t.transcript)?t.transcript:void 0,a=(0,r.useMemo)((()=>S().oE(null==n?void 0:n.map((e=>"agent-tool-result"===e.type?e.toolName:void 0)))),[n]),i=(0,o().IS)((e=>({container:{fontSize:12,color:e.text.secondary,paddingTop:0,paddingInlineEnd:6,paddingBottom:4,paddingInlineStart:6}})),[]);return 0===a.length?null:(0,W.jsxs)("div",{style:i.container,children:["Tools: ",a.join(", ")]})}function ze(e){const{inferences:t,requestInfo:n}=e,i=(0,r.useMemo)((()=>{var e;let r,a=0;for(const n of t){const e=n.value.input;if("transcript"in e&&Array.isArray(e.transcript))for(const t of e.transcript)if("agent-inference"===t.type){const e=t.startedAt||0;e>a&&(a=e,r=t)}}if(null!=n&&null!==(e=n.response)&&void 0!==e&&e.transcript)for(const t of n.response.transcript)if("agent-inference"===t.type){const e=t.startedAt||0;e>a&&(a=e,r=t)}return r}),[t,n]),l=(0,s().K8)((()=>a().default.getConfigKey("ai_agent_progressive_transcript_compression_threshold","threshold")),[]),d=(0,o().IS)((e=>({container:{padding:"8px 12px",borderBottom:`1px solid ${e.regularDividerColor}`,marginBottom:8}})),[]);if(!i)return null;return void 0!==i.inputTokens||void 0!==i.outputTokens||void 0!==i.cachedTokensRead||void 0!==i.cachedTokensCreated||void 0!==i.maxContextTokens||void 0!==i.maxInputTokens?(0,W.jsx)("div",{style:d.container,children:(0,W.jsx)(Re,{step:i,compressionThreshold:l})}):null}function Fe(e){const t=(0,k().tz)(),{clientStore:n,threadStore:a}=e,l=(0,s().K8)((()=>null==a?void 0:a.id),[a]),d=(0,i().v3)(),c=(0,o().IS)((e=>({button:{fontSize:14}})),[]),u=(0,s().K8)((()=>a.getSpaceId()),[a]),m=(0,s().K8)((()=>{const e=a.getMessageStores().map((e=>{const t=e.getStep();if(t&&"config"===t.type)return t.value.type}));return S().oE(e)[0]}),[a]),[{value:x},f]=(0,h().Yb)((async()=>{if(!u||!m)return;const e=(0,g().W)({environmentName:"production",suffix:m});return await T().callApi({eventName:"getBraintrustLogsForThread",environment:d,data:{project:e,threadId:a.id,spaceId:u}})}),[d,u,a,m]),v=(0,r.useMemo)((()=>{if(!x||"failed"===x.type)return;const e=x.data.logs,t=[],n=new Map;for(const r of e)if(r.span_id===r.root_span_id)t.push(r);else if(r.root_span_id){const e=n.get(r.root_span_id)||[];e.push(r),n.set(r.root_span_id,e)}for(const r of n.values())r.sort(((e,t)=>{var n,r;return((null===(n=e.metadata)||void 0===n?void 0:n.index)||0)-((null===(r=t.metadata)||void 0===r?void 0:r.index)||0)}));return t.sort(((e,t)=>{const n=new Date(e.created||"");return new Date(t.created||"").getTime()-n.getTime()})),{rootSpans:t,subSpanGroups:n}}),[x]),C=(0,r.useCallback)((e=>{if(!e.span_id)return;if(!l)return;const t=(null==v?void 0:v.subSpanGroups.get(e.span_id))||[],r=n.getOrCreateClientAIChatThreadStore(l);r.setState({...r.state,requestInfo:{request:e.input,response:e.output,memories:[]},inferences:S().oE(t.map(((e,t)=>{var n,r;let a;return a="number"==typeof(null===(n=e.metadata)||void 0===n?void 0:n.index)?e.metadata.index:"number"==typeof(null===(r=e.metadata)||void 0===r||null===(r=r.extraLogMetadata)||void 0===r?void 0:r.index)?e.metadata.extraLogMetadata.index:t,{type:"inference",key:(0,j().$A)(e.input),index:a,value:{id:e.id,input:e.input,expected:e.output,metadata:e.metadata}}})))})}),[n,v,l]),M=(0,r.useCallback)((()=>{var e;if(!l)return;const t=null===(e=n.getOrCreateClientAIChatThreadStore(l).state.requestInfo)||void 0===e||null===(e=e.request)||void 0===e?void 0:e.traceId;if(!m||!t)return;const r=(0,g().W)({environmentName:"production",suffix:m});window.open(`https://www.braintrust.dev/app/Notion/p/${r}/logs?r=${t}`,"_blank")}),[n,m,l]),L=(0,r.useCallback)((()=>{var e;if(!l)return;const t=null===(e=n.getOrCreateClientAIChatThreadStore(l).state.requestInfo)||void 0===e||null===(e=e.request)||void 0===e?void 0:e.traceId;if(!t)return;const r={time_range:1800,granularity:0,breakdowns:[],calculations:[{op:"COUNT"}],filters:[{column:"aiTraceId",op:"=",value:t}],filter_combination:"AND",orders:[]},a=`https://ui.honeycomb.io/notion/environments/production?query=${encodeURIComponent(JSON.stringify(r))}`;window.open(a,"_blank")}),[n,l]);return(0,W.jsx)(w().A,{popupType:w().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",renderOrigin:e=>(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(p().p,{...e,style:c.button,children:"failed"===(null==x?void 0:x.type)?"Failed to load logs":v?`View logs (${v.rootSpans.length})`:"Loading logs"}),(0,W.jsx)(B().A,{renderTooltip:()=>(0,W.jsx)("span",{children:"Open in Braintrust"}),render:e=>(0,W.jsx)(A().A,{...e,icon:b().b,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.openInBraintrust",defaultMessage:"Open in Braintrust"}),onClick:M})}),(0,W.jsx)(B().A,{renderTooltip:()=>(0,W.jsx)("span",{children:"Open in Honeycomb"}),render:e=>(0,W.jsx)(A().A,{...e,icon:y().linkSmallIcon,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.openInHoneycomb",defaultMessage:"Open in Honeycomb"}),onClick:L})})]}),render:e=>(0,W.jsx)(O().A,{menuType:D().gu.Popup,children:(0,W.jsx)(R().Ay,{type:R().Oh.Vertical,initialFocus:0,sections:[{key:"refresh",render:e=>(0,W.jsx)(N().A,{...e}),items:[{key:"refresh",render:e=>(0,W.jsx)(I().A,{...e,title:"Refresh"}),action:()=>{f()}}]},{key:"dates",render:e=>(0,W.jsx)(N().A,{...e,shouldShowBottomDivider:!0}),items:((null==v?void 0:v.rootSpans)||[]).map((t=>({key:t.id,render:e=>(0,W.jsx)(I().A,{...e,title:t.created||"No date"}),action:()=>{e.close(),C(t)}})))||[]}]})})})}function Ee(e){const{clientStore:t,configType:n,debugOverrides:a}=e,i=function(e){if("researcher"===e)return"researchModeDebugOptions"}(n),l=(0,s().K8)((()=>function(e){return"researcher"===e?u().vW:{}}(n)),[n]),c=(0,o().IS)((e=>({wrap:{margin:"12px 0",display:"flex",flexDirection:"column",gap:8},title:{fontSize:16,color:e.text.secondary,fontWeight:500},row:{display:"flex",alignItems:"center",gap:8,color:e.text.secondary,fontSize:12},input:{width:200,backgroundColor:e.background.primary,border:`1px solid ${e.regularDividerColor}`,fontSize:12,color:e.text.secondary}})),[]),p=(0,r.useCallback)((e=>{i&&t.setState({...t.state,debugOverrides:{...t.state.debugOverrides,[i]:{...t.state.debugOverrides[i]??{},...e}}})}),[t,i]);if(!i)return null;const g=a[i]??{},m=Object.entries(l).filter((([e,t])=>"type"!==e&&("boolean"==typeof t||"string"==typeof t||"number"==typeof t))).map((([e,t])=>[e,g[e]??t]));if(0===m.length)return null;const h=m.map((([e,t])=>((e,t)=>"boolean"==typeof t?(0,W.jsxs)("div",{style:c.row,children:[(0,W.jsx)("span",{children:e}),(0,W.jsx)(d().S,{checked:t,onClick:()=>p({[e]:!t}),size:12})]},e):"string"==typeof t?(0,W.jsxs)("div",{style:c.row,children:[(0,W.jsx)("span",{children:e}),(0,W.jsx)(M().A,{value:t.toString(),onChange:t=>{p({[e]:t.target.value})},style:{width:200}})]},e):"number"==typeof t?(0,W.jsxs)("div",{style:c.row,children:[(0,W.jsx)("span",{children:e}),(0,W.jsx)(M().A,{type:"number",value:t.toString(),onChange:t=>{p({[e]:Number(t.target.value)})},style:{...c.input,width:65}})]},e):null)(e,t)));return h.length>0?(0,W.jsxs)("div",{style:c.wrap,children:[(0,W.jsx)("div",{style:c.title,children:"Debug overrides"}),(0,W.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:16},children:h})]}):null}function Ke(e){const{onLoadExample:t,datasetInfo:n}=e,a=(0,k().tz)(),s=(0,i().v3)(),[l,d]=(0,r.useState)(""),[u,g]=(0,r.useState)(""),[m,h]=(0,r.useState)(""),[f,y]=(0,r.useState)(!1),[v,b]=(0,r.useState)(!1);r.useEffect((()=>{n&&!v&&(n.project&&d(n.project),n.dataset&&g(n.dataset),n.exampleId&&h(n.exampleId),b(!0))}),[n,v]);const j=(0,o().IS)((e=>({form:{display:"flex",flexDirection:"column",gap:8,padding:12,minWidth:300},row:{display:"flex",flexDirection:"column",gap:4},label:{fontSize:12,fontWeight:500,color:e.text.secondary},input:{fontSize:12,padding:6},buttons:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:8}})),[]),S=(0,r.useCallback)((async e=>{if(l.trim()&&u.trim()&&m.trim()){y(!0);try{const n=await T().callStreamApi({eventName:"getBraintrustDataset",environment:s,data:{project:l.trim(),dataset:u.trim()}});if("success"!==n.type)throw new Error("Failed to get dataset stream");let r=null;if(C().hS.is(n.data))for await(const e of n.data){const{inference:t}=e;if(t.id===m.trim()){r=t;break}}if(!r)return void window.alert(`Example ${m} not found in ${l}/${u}`);t(r),e()}catch(n){window.alert("Failed to load example from Braintrust")}finally{y(!1)}}}),[l,u,m,t,s]);return(0,W.jsx)(w().A,{popupType:w().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"end",renderOrigin:e=>(0,W.jsx)(B().A,{renderTooltip:()=>"Load memories and tool expectations from Braintrust example",placement:"top",render:t=>(0,W.jsx)("div",{...t,children:(0,W.jsx)(A().A,{...e,icon:x().arrowInCircleDownIcon,ariaLabel:a.formatMessage({defaultMessage:"Load from Braintrust",id:"aiInferenceTranscript.debug.loadFromBraintrust"})})})}),render:e=>(0,W.jsxs)("div",{style:j.form,children:[(0,W.jsxs)("div",{style:j.row,children:[(0,W.jsx)("div",{style:j.label,children:"Project"}),(0,W.jsx)(ue,{value:l,onChange:e=>d(e.target.value),placeholder:"Enter Braintrust project name",style:j.input})]}),(0,W.jsxs)("div",{style:j.row,children:[(0,W.jsx)("div",{style:j.label,children:"Dataset"}),(0,W.jsx)(ue,{value:u,onChange:e=>g(e.target.value),placeholder:"Enter Braintrust dataset name",style:j.input})]}),(0,W.jsxs)("div",{style:j.row,children:[(0,W.jsx)("div",{style:j.label,children:"Example ID"}),(0,W.jsx)(ue,{value:m,onChange:e=>h(e.target.value),placeholder:"Enter Braintrust example ID",style:j.input})]}),(0,W.jsxs)("div",{style:j.buttons,children:[(0,W.jsx)(p().p,{onClick:()=>e.close(),children:"Cancel"}),(0,W.jsx)(p().p,{onClick:()=>{S(e.close)},disabled:f||!l.trim()||!u.trim()||!m.trim(),children:f?(0,W.jsx)(c().k,{}):"Load from Braintrust"})]})]})})}},449445:(e,t,n)=>{n.r(t),n.d(t,{arrowLineDownSmallIcon:()=>a,iconDefinition:()=>r});n(296540);const r={viewBox:"0 0 16 16",fittedViewBox:"2.97 2.12 10.06 11.76",svg:(0,n(474848).jsx)("path",{d:"M8 2.125a.625.625 0 0 0-.625.625v7.128L5.378 7.881a.625.625 0 1 0-.884.884l3.064 3.064c.244.244.64.244.884 0l3.065-3.064a.625.625 0 0 0-.884-.884L8.625 9.878V2.75A.625.625 0 0 0 8 2.125m-4.403 10.5a.625.625 0 1 0 0 1.25h8.806a.625.625 0 1 0 0-1.25z"})},a=(0,n(340498).wt)("arrowLineDownSmall",r)},465505:(e,t,n)=>{n.d(t,{P:()=>a});n(296540);const r={viewBox:"0 0 20 20",fittedViewBox:"2.72 1.77 14.55 16.45",svg:(0,n(474848).jsx)("path",{d:"M10.302 1.853a.63.63 0 0 0-.604 0l-6.65 3.669c-.2.11-.323.32-.323.547v7.862c0 .228.124.437.323.547l6.65 3.67a.63.63 0 0 0 .604 0l6.65-3.67c.2-.11.323-.32.323-.547V6.069a.63.63 0 0 0-.323-.547zM3.975 7.127l5.4 2.98v6.434l-5.4-2.98zm6.65 9.414v-6.434l5.4-2.98v6.435zM15.356 6.07 10 9.024 4.644 6.069 10 3.114z"})},a=(0,n(340498).wt)("cube",r)},499872:(e,t,n)=>{n.d(t,{b:()=>a});n(296540);const r={viewBox:"0 0 20 20",fittedViewBox:"4.75 3.52 11.53 12.95",svg:(0,n(474848).jsx)("path",{d:"m7.006 16.267 8.523-4.971a1.5 1.5 0 0 0 0-2.592L7.006 3.733A1.5 1.5 0 0 0 4.75 5.028v9.944a1.5 1.5 0 0 0 2.256 1.295"})},a=(0,n(340498).wt)("mediaPlayFill",r)},703778:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>a,linkSmallIcon:()=>i});n(296540);var r=n(474848);const a={viewBox:"0 0 16 16",fittedViewBox:"1.87 1.87 12.19 12.19",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M12.848 2.8a3.145 3.145 0 0 0-4.448 0L6.918 4.283a.625.625 0 0 0 .884.883l1.482-1.482c.74-.74 1.94-.74 2.68 0l.294.294c.74.74.74 1.94 0 2.68l-1.482 1.483a.625.625 0 1 0 .884.884l1.482-1.482a3.145 3.145 0 0 0 0-4.449z"}),(0,r.jsx)("path",{d:"M10.472 5.47a.625.625 0 0 0-.884 0L5.229 9.83a.625.625 0 1 0 .884.883l4.359-4.359a.625.625 0 0 0 0-.883"}),(0,r.jsx)("path",{d:"M5.167 6.918a.625.625 0 0 0-.884 0L2.8 8.4a3.146 3.146 0 0 0 0 4.448l.294.294a3.145 3.145 0 0 0 4.449 0l1.482-1.482a.625.625 0 0 0-.884-.884L6.66 12.258c-.74.74-1.94.74-2.68 0l-.295-.294c-.74-.74-.74-1.94 0-2.68L5.167 7.8a.625.625 0 0 0 0-.883"})]})},i=(0,n(340498).wt)("linkSmall",a)},800204:(e,t,n)=>{n.d(t,{U3:()=>s,og:()=>o,p9:()=>l,yu:()=>i});n(898992),n(354520);var r=()=>n(534177);const a=["calendar.runTool","calendar.fetchPlaybook","mail.runTool","mail.getPrompt","codegen.run","codegen.runStatus","files.getFileContent","files.getFileName","files.getFileUrl","github.getPullRequest","github.getUser","github.listOrganizationRepositories","github.listPullRequests","github.parseGithubUrlToParts","mail.getPrompt","mail.runTool","mcpServer.getPrompt","mcpServer.listPrompts","mcpServer.listResources","mcpServer.readResource","mcpServer.runTool","notion.addCommentToDiscussion","notion.addCommentToPage","notion.getPageDiscussions","notion.sendNotification","pipedream.action","slack.addReactionToMessage","slack.createThreadInChannel","slack.createThreadInDirectMessage","slack.findUserByEmail","slack.getThreadsInChannelSince","slack.getUser","slack.parseSlackMessageUrlToId","slack.queryChannels","slack.removeReactionFromMessage","slack.replyInThread","slack.updateMessage","zendesk.addComment","zendesk.addTicket","zendesk.getComments","zendesk.getTicket","zendesk.updateTicket"],i=["search","view","view-version-history","view-database-files","create-database","update-database","update-database-data-sources","update-database-views","query-data-sources","update-database-triggers","error","create-pages","update-page","delete-pages","result","toggle-user-integration-tools","update-user-integrations","edit-json","spawn-agent","create-agent","update-agent","delete-agent","query-salesforce-tool",...a];function s(e){if("string"!=typeof e)return!1;for(const t of i)if(e===t)return!0;return!!o(e)}function o(e){return!!(0,r().Xk)(a,e)}const l="REJECTED_BY_USER"}}]);