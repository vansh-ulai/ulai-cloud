"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[69184],{84349:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().Store{getInitialState(){return{open:!1}}}const i=new n},131581:(e,t,o)=>{o.d(t,{Ju:()=>H,en:()=>N,p6:()=>W});o(898992),o(672577),o(814603),o(147566),o(198721);var n=()=>o(242422),i=()=>o(726637),r=()=>o(908006),a=()=>o(700500),s=()=>o(304740),c=()=>o(522419),l=()=>o(651784),d=()=>o(179034),u=()=>o(519831),p=()=>o(869558),m=()=>o(201980),f=()=>o(496603),g=()=>o(559506),v=()=>o(97270),b=()=>o(18387),k=()=>o(943846),S=()=>o(906537),y=()=>o(129522),h=()=>o(110955),I=()=>o(176106),x=()=>o(375447),C=()=>o(261358),M=()=>o(148832),T=()=>o(543665),w=()=>o(913530),A=()=>o(502438),B=()=>o(292167),D=()=>o(437219),_=()=>o(541372),R=()=>o(443120),P=()=>o(896628),L=()=>o(222299),F=()=>o(384944),E=()=>o(391214),V=()=>o(319975),O=()=>o(231297),U=()=>o(62287);function N(e){const t=(0,C().zH)(e);return t instanceof M().B&&void 0!==t.getAssociatedCollectionStore()}function W(e){const{environment:t,textStore:o,url:r,oldTextValue:a,urlSelection:c}=e;if(h().Ay.state.open||v().A.state.open||x().Ay.state.open||I().A.state.open||N(o)&&s().Vp({url:r,baseUrl:i().A.domainBaseUrl,publicDomainName:i().A.publicDomainName}))return;const l=S().get();if(!l)return;const d=S().getRect(l);if(!d)return;const u=()=>{I().A.setState({open:!0,willOpen:!1,loading:!1,textStore:o,url:r,oldTextValue:a,urlSelection:c,selectionRect:d}),D().wQ(t,{url:r})},p=n().default.checkGate({gateName:"mobile_embed_menu_cursor_fix"});!t.device.isTablet&&p?(I().A.setState({open:!1,willOpen:!0,loading:!1}),setTimeout(u,0)):u()}async function H(e){const{environment:t,spaceId:o}=e,n=I().A.state;if(n.open){const{url:v,textStore:S,oldTextValue:h}=n,x=A().default.state.stores,C=x[0];if(!C)return;const N=(0,c().Zv)(v)||(0,c().ku)(v,i().A.secureFileConfig.hostname),W=N?(0,c().xm)(N):v,H=(0,l().parseRoute)({url:W,baseUrl:i().A.domainBaseUrl,publicDomainName:i().A.publicDomainName,isMobile:Boolean(i().A.isMobile),protocol:i().A.protocol,currentUrl:window.location.href});if((0,l().Jx)(H))await O().createAndCommitAsync({environment:t,userAction:"embedMenuActions.embedPageAlias",waitForServerCommit:!1,perform:async o=>{let i;if(V().R9({environment:t,store:S,value:h,transaction:o}),H.peekViewBlockId){const e=M().B.createChildStore(S,{table:d().ev,id:H.peekViewBlockId});await e.load(),e.isPageBlock()&&(i=e)}if(!i&&"page"===H.name&&H.blockId&&(i=M().B.createChildStore(S,{table:d().ev,id:H.blockId})),i){const s="page"===H.name?H.scrollToBlockId:void 0,c="page"===H.name?H.collectionViewId:void 0;if("mention-page"===e.type){const e=i.getRecordModel({id:i.id,table:d().ev});V().Gf({environment:t,editorMode:"default",store:S,selection:{startIndex:n.urlSelection.startIndex,endIndex:n.urlSelection.startIndex},annotation:m().ld4(s??i.id,null==e?void 0:e.space_id),transaction:o,analyticsFrom:"block"})}else if("create-transclusion"===e.type){if(!s)return;_().Ce({environment:t,blocks:A().default.state.stores,copiedBlockIds:[s]})}else if(i.isCollectionView()){var a;const e=c?w().p.createChildStore(i,{table:p().Gy,id:c}):void 0;await Promise.all([i.load(),e?e.load():void 0]);const n=e?e.getCollectionStore():null===(a=i.getCollectionViewStores())||void 0===a||null===(a=a[0])||void 0===a?void 0:a.getCollectionStore();n&&(await n.load(),L().oT({environment:t,store:C,collectionStore:n,collectionViewStore:e,transaction:o}))}else{const n=C.getParentBlockStore();if(n){const r=B().s({environment:t,parentBlockStore:n,targetStore:i,transaction:o});E().LE({environment:t,blocksToInsert:[r],target:x,transaction:o,replaceEmptyTextBlock:!0}),"form"===e.type&&(A().default.reset(),D().ol(t,{url:v,type:e.type,form_id:i.id,block_id:r.id}))}}r().default.afterNextFlush((()=>{O().createAndCommit({userAction:"embedMenuActions.accept",environment:t,canUndo:!0,perform:e=>{E().um({blocks:x,transaction:e})}})}))}}});else if("collection"===H.name){if("mention-page"===e.type)O().createAndCommit({environment:t,canUndo:!0,userAction:"embedMenuActions.embedCollectionMention",perform:e=>{V().R9({environment:t,store:S,value:h,transaction:e});const o=H.space&&"id"in H.space?H.space.id:void 0;V().Gf({environment:t,editorMode:"default",store:S,selection:{startIndex:n.urlSelection.startIndex,endIndex:n.urlSelection.startIndex},annotation:m().ETy({collectionId:H.collectionId,spaceId:o,parentCvbId:H.parentBlockId}),transaction:e,analyticsFrom:"collection"})}});else if(e.type===a().xd.collectionView){const e=H.space&&"id"in H.space?H.space.id:C.getSpaceId(),o=T().m.createChildStore(S,{table:u().Vl,id:H.collectionId,spaceId:e});await o.load(),o.isDefined()&&O().createAndCommit({environment:t,canUndo:!0,userAction:"embedMenuActions.embedCollectionLinkedView",perform:e=>{V().R9({environment:t,store:S,value:h,transaction:e}),L().oT({environment:t,store:C,collectionStore:o,collectionViewStore:void 0,transaction:e})}})}}else if(e.type===a().xd.bookmark||"teamsInvite"===H.name){const{performResult:e}=O().createAndCommit({userAction:"embedMenuActions.insertedBlocks",environment:t,canUndo:!0,perform:e=>{var o;V().R9({environment:t,store:S,value:h,transaction:e});const n=F().Wv({environment:t,type:a().xd.bookmark,inMemoryRecordCache:C.inMemoryRecordCache,transaction:e,spaceId:0!==x.length?x[x.length-1].pointer.spaceId:null===(o=(0,b().Z)())||void 0===o?void 0:o.pointer.spaceId}),i=E().LE({environment:t,blocksToInsert:[n],target:x,transaction:e,replaceEmptyTextBlock:!0});return P().zA({stores:[n],transaction:e,update:{bookmark_loading_ttl:Date.now()}}),i}});r().default.afterNextFlush((()=>{O().createAndCommit({userAction:"embedMenuActions.accept",environment:t,canUndo:!0,perform:e=>{E().um({blocks:x,transaction:e})}})}));const o=e[0];"teamsInvite"===H.name?await R().Ht({environment:t,store:o,url:v,teamId:H.teamId}):await R().Ht({environment:t,store:o,url:v})}else if(e.type===a().xd.drive){const{performResult:e}=O().createAndCommit({userAction:"embedMenuActions.insertedBlocks",environment:t,canUndo:!0,perform:e=>{var o;V().R9({environment:t,store:S,value:h,transaction:e});const n=F().Wv({environment:t,type:a().xd.drive,inMemoryRecordCache:C.inMemoryRecordCache,transaction:e,spaceId:0!==x.length?x[x.length-1].pointer.spaceId:null===(o=(0,b().Z)())||void 0===o?void 0:o.pointer.spaceId});return E().LE({environment:t,blocksToInsert:[n],target:x,transaction:e,replaceEmptyTextBlock:!0})}});r().default.afterNextFlush((()=>{O().createAndCommit({userAction:"embedMenuActions.accept",environment:t,canUndo:!0,perform:e=>{E().um({blocks:x,transaction:e})}})}));const o=e[0];r().default.afterNextFlush((()=>{const e=y().K.find((e=>e.getBlockStore()===o));e&&e.initializeGoogleDriveBlockFromUrl(v)}))}else if("link-mention"===e.type){I().A.setState({open:!1,willOpen:!1,loading:!0});const e=await g().callApi({eventName:"getDataForLinkMention",environment:t,data:{url:W,spaceId:o,source:"link_mention_activate"}});if("success"===e.type){const o=e.data;if("error"in o){const e=m().wmz(m().gru({href:v,title:v.includes("mailto:")?v:new URL(v).hostname}));O().createAndCommit({environment:t,userAction:"embedMenuActions.mention",canUndo:!0,perform:o=>{V().jQ({environment:t,store:S,selection:{startIndex:n.urlSelection.startIndex,endIndex:n.urlSelection.endIndex},transaction:o}),V().yr({environment:t,store:S,tokens:[e],index:n.urlSelection.startIndex,transaction:o})}}),D().vt(t,{domain:v.includes("mailto:")?v:new URL(v).hostname})}else{var s;const{title:e,description:i,author_name:r,provider_name:a,images:c,favicon_url:l,iframe:d,height:u,padding:p,padding_top:f}=o,g=m().wmz(m().gru({href:v,title:e||(a||new URL(v).hostname),description:i,link_author:r,link_provider:a,thumbnail_url:c&&c.length>0?null===(s=c[0])||void 0===s?void 0:s.url:void 0,icon_url:l,iframe_url:v.includes("nytimes.com")?void 0:d,height:u,padding:p,padding_top:f}));O().createAndCommit({environment:t,userAction:"embedMenuActions.mention",canUndo:!0,perform:e=>{V().jQ({environment:t,store:S,selection:{startIndex:n.urlSelection.startIndex,endIndex:n.urlSelection.endIndex},transaction:e}),V().yr({environment:t,store:S,tokens:[g],index:n.urlSelection.startIndex,transaction:e})}})}}else{const e=m().wmz(m().gru({href:v,title:v.includes("mailto:")?v:new URL(v).hostname}));O().createAndCommit({environment:t,userAction:"embedMenuActions.mention",canUndo:!0,perform:o=>{V().jQ({environment:t,store:S,selection:{startIndex:n.urlSelection.startIndex,endIndex:n.urlSelection.endIndex},transaction:o}),V().yr({environment:t,store:S,tokens:[e],index:n.urlSelection.startIndex,transaction:o})}}),D().vt(t,{domain:v.includes("mailto:")?v:new URL(v).hostname})}}else{const{performResult:o}=O().createAndCommit({userAction:"embedMenuActions.insertedBlocks",environment:t,canUndo:!0,perform:e=>{var o;V().R9({environment:t,store:S,value:h,transaction:e});const n=F().Wv({environment:t,type:a().xd.copyIndicator,inMemoryRecordCache:C.inMemoryRecordCache,transaction:e,spaceId:0!==x.length?x[x.length-1].pointer.spaceId:null===(o=(0,b().Z)())||void 0===o?void 0:o.pointer.spaceId});return E().LE({environment:t,blocksToInsert:[n],target:x,transaction:e,replaceEmptyTextBlock:!0})}});r().default.afterNextFlush((()=>{O().createAndCommit({userAction:"embedMenuActions.accept",environment:t,canUndo:!0,perform:e=>{E().um({blocks:x,transaction:e})}})}));const n=o[0],i=o=>{O().createAndCommit({environment:t,userAction:"embedMenuActions.accept.insertExtractedData",canUndo:!0,perform:t=>{let i;e.type&&"mention-page"!==e.type&&"create-transclusion"!==e.type&&"link-mention"!==e.type&&"jira-sync"!==e.type?i=e.type:(i=a().xd.embed,null!=o&&o.media&&("photo"===o.media.type?i=a().xd.image:"video"===o.media.type&&(i=a().xd.video))),U().pd({environment:e.environment,block:n,blockType:i,transaction:t})}}),r().default.afterNextFlush((()=>{const e=y().K.find((e=>e.getBlockStore()===n&&f().Tn(e.embed)));e&&e.embed({originUrl:W,pastedSecureFile:N})}))};k().DB(t,W).then(i)}}(0,I().V)()}},136833:(e,t,o)=>{function n(e){return Date.now()-parseInt(e.timestamp)}o.d(t,{S:()=>n})},340593:(e,t,o)=>{o.d(t,{d:()=>r});var n=()=>o(765957),i=()=>o(712505);function r(){const{mainEditorCurrentBlockStore:e}=n().default.state;return i().default.state.open&&i().default.state.targetStore||e}},448801:(e,t,o)=>{o.d(t,{i:()=>i});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698);var n=()=>o(371562);n();function i(e,t){const o=n().create({arrays:{detectMove:!1,includeValueOnMove:!0}}).diff(e,t);if(!o)return{beforeOps:{},removeOps:new Set};let i=[],r=[];for(const n in o)"_t"!==n&&("_"===n[0]?i.push(parseInt(n.slice(1),10)):1===o[n].length&&r.push({index:parseInt(n,10),value:o[n][0]}));const a={},s=new Set,c=[...e];i=i.sort(((e,t)=>e-t));for(let n=i.length-1;n>=0;n--){const e=i[n],t=c.splice(e,1)[0];s.add(t)}r=r.sort(((e,t)=>e.index-t.index));for(let n=0;n<r.length;n++){const e=r[n];a[e.value]=c[e.index],c.splice(e.index,0,e.value)}return{beforeOps:a,removeOps:s}}},482871:(e,t,o)=>{o.d(t,{z:()=>d});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(430670),o(581454);var n=()=>o(898244),i=()=>o(448801),r=()=>o(179034),a=()=>o(722101),s=()=>o(878710),c=(o(354520),()=>o(496603));function l(e){const{collectionContextStore:t,collectionViewStore:o,transaction:i}=e,l=o.getPageSortStore(),d=l.getValue(),u=t.groupsStore.getAllGroupStates(),p=function(e){const{pageSort:t,currentResults:o}=e;if(!t||t.length<=n().WF)return[];const i=t.filter((e=>!o.has(e)));return c().sb([...i.reverse(),...c().o8(t).reverse()]).slice(0,t.length-n().WF)}({pageSort:d,currentResults:new Set(u.flatMap((e=>e.resultsStore.state.map((e=>e.id)))))});for(const n of p)a().TF({parentStore:l,childToRemoveStore:(0,s().v3)(l,{table:r().ev,id:n}),transaction:i})}function d(e){const{resultIds:t,collectionViewStore:o,collectionContextStore:c,transaction:d}=e,u=o.getPageSortStore(),p=u.getValue()||[],{beforeOps:m}=(0,i().i)(p,t.slice(0,n().WF));for(const[n,i]of Object.entries(m))if(i){const e=(0,s().v3)(o,{table:r().ev,id:i});a().nc({parentStore:u,insertStore:(0,s().v3)(o,{table:r().ev,id:n}),beforeStore:e,transaction:d})}else{const e=t.findIndex((e=>e===n)),i=t[e-1],c=i?(0,s().v3)(o,{table:r().ev,id:i}):void 0;a().WH({parentStore:u,insertStore:(0,s().v3)(o,{table:r().ev,id:n}),afterStore:c,transaction:d})}l({collectionContextStore:c,collectionViewStore:o,transaction:d})}},487494:(e,t,o)=>{o.d(t,{A:()=>i});var n=function(e){return e[e.Preview=0]="Preview",e[e.Mention=1]="Mention",e[e.Link=2]="Link",e}(n||{});const i=n},491848:(e,t,o)=>{o.d(t,{w:()=>i});o(898992),o(672577);var n=()=>o(755199);function i({collectionContextStore:e,transaction:t}){const o="collectionTypedView"===e.contextType,i=e.databaseType,r=e.collectionStoresStore.state,a=r.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly()))||r[0];!o&&a&&n().ee({transaction:t,databaseType:i,collectionId:a.id})}},539914:(e,t,o)=>{o.r(t),o.d(t,{clipboardMessages:()=>Yt,copy:()=>Po,copyDirectLinkToContent:()=>un,copyFormattedLinkToBlock:()=>ln,copyHtml:()=>pn,copyLinkToBlock:()=>sn,copyLinkToCollection:()=>cn,copyLinksToBlocks:()=>dn,copyString:()=>mn,copyWithToast:()=>vn,createSelectedMultiColumnBlockSubtree:()=>Mo,cutWithMaybeConfirmation:()=>Ro,getFormulaEditorInformation:()=>Ko,getInlineTextValueFromClipboardData:()=>Sn,getInlineTitleValueFromClipboardTextHtml:()=>Ho,getNotionSelectionClipboardData:()=>yo,htmlToMultiTextSelectionClipboardData:()=>Wo,insertOrTransformToCodeBlock:()=>nn,markdownToBlocks:()=>kn,multiTextSelectionToMarkdown:()=>bn,paste:()=>on,pasteFilesForBlocks:()=>Lo,pasteMarkdown:()=>Uo,serializeMultiTextSelectionToClipboardData:()=>Ao,serializePagePropertiesAsText:()=>To,triggerBrowserCopy:()=>gn});var n={};o.r(n),o.d(n,{clipboardMessages:()=>Yt,copy:()=>Po,copyDirectLinkToContent:()=>un,copyFormattedLinkToBlock:()=>ln,copyHtml:()=>pn,copyLinkToBlock:()=>sn,copyLinkToCollection:()=>cn,copyLinksToBlocks:()=>dn,copyString:()=>mn,copyWithToast:()=>vn,createSelectedMultiColumnBlockSubtree:()=>Mo,cutWithMaybeConfirmation:()=>Ro,getFormulaEditorInformation:()=>Ko,getInlineTextValueFromClipboardData:()=>Sn,getInlineTitleValueFromClipboardTextHtml:()=>Ho,getNotionSelectionClipboardData:()=>yo,htmlToMultiTextSelectionClipboardData:()=>Wo,insertOrTransformToCodeBlock:()=>nn,markdownToBlocks:()=>kn,multiTextSelectionToMarkdown:()=>bn,paste:()=>on,pasteFilesForBlocks:()=>Lo,pasteMarkdown:()=>Uo,serializeMultiTextSelectionToClipboardData:()=>Ao,serializePagePropertiesAsText:()=>To,triggerBrowserCopy:()=>gn});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(823215),o(354520),o(430670),o(803949),o(581454),o(908872),o(737550);var i=o.n(o(842838)),r=()=>o(208360),a=()=>o(44551),s=()=>o(242422),c=()=>o(726637),l=()=>o(221844),d=()=>o(908006),u=()=>o(929219),p=()=>o(764880),m=()=>o(584262),f=()=>o(700500),g=()=>o(898244),v=()=>o(921940),b=()=>o(304740),k=()=>o(634201),S=()=>o(856197),y=()=>o(683259),h=()=>o(107041),I=()=>o(522419),x=()=>o(80979),C=()=>o(239381),M=()=>o(165358),T=()=>o(236162),w=()=>o(938379),A=()=>o(416504),B=()=>o(911676),D=()=>o(206267),_=()=>o(777447),R=()=>o(945778),P=()=>o(997769),L=()=>o(128713),F=()=>o(792071),E=()=>o(134025),V=()=>o(476158),O=()=>o(754199),U=()=>o(388821),N=()=>o(696706),W=()=>o(450648),H=()=>o(651784),$=()=>o(179034),j=()=>o(343666),z=()=>o(161479),G=()=>o(994310),J=()=>o(201980),Z=()=>o(439180),Q=()=>o(969842),K=()=>o(173979),q=()=>o(708830),Y=()=>o(445120),X=()=>o(69708),ee=()=>o(100622),te=()=>o(496603),oe=()=>o(498212),ne=()=>o(183558),ie=()=>o(534177),re=()=>o(939768),ae=()=>o(720665),se=()=>o(466614),ce=()=>o(807700);function le(e){return e.trimEnd().includes("\n")}var de=()=>o(450510),ue=()=>o(404779),pe=()=>o(516430),me=()=>o(518736),fe=()=>o(568131),ge=()=>o(59110),ve=()=>o(949653),be=()=>o(375078),ke=()=>o(267419),Se=()=>o(120672),ye=()=>o(18387),he=()=>o(560595),Ie=()=>o(131385),xe=()=>o(951177),Ce=()=>o(909470),Me=()=>o(808237),Te=()=>o(492414),we=()=>o(594794),Ae=()=>o(611191),Be=()=>o(972435),De=()=>o(557155),_e=()=>o(481292),Re=()=>o(794144),Pe=()=>o(962845),Le=()=>o(299545),Fe=()=>o(969197),Ee=()=>o(906537),Ve=()=>o(792002),Oe=()=>o(847463),Ue=()=>o(129522),Ne=()=>o(301421),We=()=>o(857048),He=()=>o(404715),$e=()=>o(980914),je=()=>o(562800),ze=()=>o(24973),Ge=()=>o(765957),Je=()=>o(673898),Ze=()=>o(77246),Qe=()=>o(53137),Ke=()=>o(732770),qe=()=>o(261358),Ye=()=>o(148832),Xe=()=>o(878710),et=()=>o(502438),tt=()=>o(693202),ot=()=>o(50764),nt=()=>o(559926),it=()=>o(209660),rt=()=>o(812182),at=()=>o(755199),st=()=>o(680074),ct=()=>o(522094),lt=()=>o(160475);function dt(e){var t;const{originalHtmlContentSize:o,environment:n}=e;if(o<500)return;const i=(0,st().R$)(n),r=null==i||null===(t=i.getSettings())||void 0===t?void 0:t.adoption_entry_points,a=r?r.import_nudge_on_large_paste:void 0;if(a){const e=s().default.getConfigKey("adoption_entry_point_time_delta","import_nudge_on_large_paste"),t=a[a.length-1];if(!(Date.now()-t>e.view_delta))return}"nudge_on_large_paste"===s().default.getEligibleGroup({experimentId:"adoption_import_entry_point",defaultGroup:"control"})&&((0,lt().t)({environment:n,action:"view",from:"import_nudge_on_paste"}),rt().Iz({message:Be().A.formatMessage(ut.triggerNudgeOnPasteDescription),presentationType:"persistent",id:"nudge-on-paste",title:Be().A.formatMessage(ut.triggerNudgeOnPasteTitle),onUserDismiss:()=>{(0,lt().t)({environment:n,action:"dismiss",from:"import_nudge_on_paste"})},onDismiss:()=>{at().pr(n,{entryPoint:"import_nudge_on_large_paste"})},actions:{primary:{title:Be().A.formatMessage(ut.triggerNudgeOnPastePrimaryAction),onAction:()=>{const e=ct().A.getOrCreateFlowId();(0,lt().t)({environment:n,action:"click",from:"import_nudge_on_paste"}),nt().kY(n,{from:"import_nudge_on_paste",flowId:e}),rt().UW("nudge-on-paste"),it().Ow({currentTab:"imports",openedFrom:"import_nudge_on_paste"})}}}}))}const ut=(0,X().YK)({triggerNudgeOnPasteTitle:{id:"adoption.nudgeOnPaste.title",defaultMessage:"Import content directly"},triggerNudgeOnPasteDescription:{id:"adoption.nudgeOnPaste.description",defaultMessage:"Get all your content into Notion with a click"},triggerNudgeOnPastePrimaryAction:{id:"adoption.nudgeOnPaste.primaryAction",defaultMessage:"Import now"}});var pt=()=>o(970330),mt=()=>o(314529),ft=()=>o(136833);var gt=()=>o(541372),vt=(o(16280),o(672577),()=>o(741237)),bt=()=>o(842989),kt=()=>o(220719),St=()=>o(44729),yt=()=>o(534402),ht=()=>o(227894),It=()=>o(20313),xt=()=>o(695625),Ct=()=>o(257216),Mt=()=>o(319975),Tt=()=>o(901444);function wt(e){var t;const{environment:o,clipboardData:n,transaction:i,allowPasteIntoHeaderWithoutChildren:r,selectAll:a,preventLegacyTransclusions:s}=e;if(tt().default.isEditingComment()||(0,Ve().X4)())return!1;if(function(e,t){return e.blockSelection.blocks.some((e=>{var o;if(!e.blockSubtree)return!0;const n=null===(o=e.blockSubtree.getModel({id:e.blockId,table:$().ev}))||void 0===o?void 0:o.spaceId;return!!(n&&t&&se().Lw({sourceSpaceId:n,targetSpaceId:t,sourceBlockSubtree:e.blockSubtree}))||void 0}))}(n,null===(t=Ge().default.state.sidebarSpaceStore)||void 0===t?void 0:t.id))return!1;const c=tt().default.state;if("editing"!==c.mode)return!1;const l=c.multiSelection.start.store;if(!l.isTable($().ev))return!1;const u=(0,Fe().T)(l);if(!u)return!1;if(l!==u.getBlockTitleStore())return!1;const p=u.getType(),m=u.getFormat();if(!p)return!1;if(!((0,f().IU)(p,m)||r&&(0,f().CN)(p)))return!1;if(r&&(0,f().CN)(p)){const e=n.blockSelection.blocks[0],t=null==e?void 0:e.blockId,o=null==e?void 0:e.blockSubtree,i=t&&o?o.getModel({id:t,table:"block"}):void 0;if(Boolean(null==i?void 0:i.getContentLength()))return!1}const g=(0,It().Ag)({includeNonSelectableListContainer:!0});if(!g)return!1;const v=(0,It().Xs)(u,[g]);if(!v)return!1;let b=0;for(let d=v.length-1;d>=0;d--){const e=v[d].value.store,t=xt().T.findSelectableFromStore(e),o=e.getModel();if(null!=o&&o.isType(f().U6)||t&&!t.props.canSelect){b=d;break}}const k=v.slice(b);if(0===k.length)return!1;const S=k[0].value.store,y=S.pointer.spaceId,h=(0,ce().l)(S);i.logDebugMessage("pasteMultiTextSelection: pasting",k,{spaceId:y,pastingIntoTemplate:h,insertionPathRootStore:S});const I=n.blockSelection.blocks.map((({blockId:e,blockSubtree:t})=>{var n;if(!t)throw new Error("Missing data for local duplicate block during paste");const r=(null===(n=t.getModel({table:$().ev,id:e}))||void 0===n?void 0:n.getType())===f().xd.factory,a=!(h||r),c=(0,ve().localDuplicate)({environment:o,sourceBlockId:e,targetBlockPointer:(0,we().zP)({environment:o,table:$().ev,spaceId:y}),sourceBlockSubtree:t,targetInMemoryRecordCache:S.inMemoryRecordCache,transaction:i,from:"paste",options:{addCopyName:!0,allowRedundancy:!1,deepCopyTransclusionContainers:!1,preventLegacyTransclusions:s,resolveTemplateVariables:a}}),l=c.targetBlockStore.getType();if(l){const e=u.getParentCollectionIdUpToTwoLevels(),t={from:"paste",type:l,new_page_id:"page"===l?c.targetBlockStore.id:void 0,creating_block_id:c.targetBlockStore.id,parent_collection_id:e};pt().tP(l)?pt().vH(o,{...t,type:l,collection_id:e||""}):pt().vH(o,{...t,type:l})}return c})),x=n.multiTextSelection.start.pointerPath,C=n.multiTextSelection.end.pointerPath,M=[],T=[],w=Math.max(x.length,C.length),A=(k[k.length-w]||k[0]).value.store,B=(0,q().v)({node:n.tree,recordStoreParent:A},(({node:e,recordStoreParent:t})=>{const o=((e,t)=>{let o;for(const{originalToDuplicate:n}of I)if(o=n.get(t),o)break;if(o)return Ye().B.createChildStore(e,o)})(t,e.value),n=M.length<x.length?x[M.length]:void 0,i=T.length<C.length?C[T.length]:void 0;let r=!1;if((null==n?void 0:n.id)===e.value.id&&(r=!0,M.push(o)),(null==i?void 0:i.id)===e.value.id&&(r=!0,T.push(o)),!r)return{value:{store:o}};const a=(null==o?void 0:o.getContentStore())||S;return{value:{store:o},children:e.children.map((e=>({node:e,recordStoreParent:a})))}}));if(M.length!==x.length||0===M.length)throw new Error(`Failed to hydrate start path during paste (found ${M.length} of ${x.length})`);if(T.length!==C.length||0===T.length)throw new Error(`Failed to hydrate end path during paste (found ${T.length} of ${C.length})`);const D=M[M.length-1],_=T[T.length-1];if(!D||!_)throw new Error(`Failed to hydrate position during paste (${D?"":"missing start"} ${_?"":"missing end"})`);const R=(0,q().Qe)([B],(e=>e.value.store===D)),P=(0,q().Qe)([B],(e=>e.value.store===_)),L=R&&P&&bt().W.fromNearestCommonAncestor(R,P);if(!L)throw new Error(`Failed to build range for paths: ${R?"":"missing start"} ${P?"":"missing end"}`);Mt().f0({environment:o,multiSelection:c.multiSelection,transaction:i});const F=tt().default.state,E="editing"===F.mode?F.multiSelection:c.multiSelection;if((0,Le().P4)(u)&&0===n.multiTextSelection.start.textIndex){const e=D.getType();e&&(0,f().aO)(e)&&be().transformBlocks({environment:o,blocks:[u],blockType:e,transaction:i})}let V;return S.useCrdt()?(Bt({transaction:i,clipboardData:n,startBlockStore:u,duplicateStartStore:D,range:L,insertionPath:k,duplicates:I,insertionPathRootStore:S}),V=At({environment:o,transaction:i,clipboardData:n,insertionPoint:E,textSelectionState:c,duplicateEndStore:_,pastingIntoTemplate:h}).newSelectionIndex):(V=At({environment:o,transaction:i,clipboardData:n,insertionPoint:E,textSelectionState:c,duplicateEndStore:_,pastingIntoTemplate:h}).newSelectionIndex,Bt({transaction:i,clipboardData:n,startBlockStore:u,duplicateStartStore:D,range:L,insertionPath:k,duplicates:I,insertionPathRootStore:S})),d().default.afterNextFlush((()=>{const e=(0,It().PY)({rootStore:S,root:g,target:L.end}),t=e&&(0,Fe().aI)(e[e.length-1]);if(!t)return;const o={start:{index:a?E.start.index:V,store:a?E.start.store:t},end:{index:V,store:t}};(0,Tt().setMultiSelection)({multiSelection:o})})),!0}function At(e){const{insertionPoint:t,duplicateEndStore:o,pastingIntoTemplate:n,environment:i,transaction:r,clipboardData:a}=e;let s=0;const c=t.end.store,l=t.end.index,d=(0,Fe().aI)(o);if(d){s=J().qAZ(d.getValue()).length;const e=(0,kt().o9)((0,Fe().T)(c)),t=(0,kt().o9)((0,Fe().T)(d));me().Le({store:c,blockStore:e})&&me().Le({store:d,blockStore:t})?(yt().X0({sourceBlockStore:e,targetBlockStore:t,splitAtGraphemeIndex:l,transaction:r,moveIntoNewBlock:!1}),r.logDebugMessage("(CRDT) pasted suffix into end",d)):(Mt().jN({environment:i,sourceStore:c,sourceIndex:l,targetStore:d,targetIndex:s,transaction:r}),r.logDebugMessage("pasted suffix into end",d))}else Mt().jQ({environment:i,transaction:r,store:c,selection:{startIndex:l,endIndex:1/0}}),r.logDebugMessage("no end title store to paste text into");let u=J().Uee(a.multiTextSelection.start.copiedText,{removeSuggestionAnnotationsAndText:!1,removeSuggestionAnnotations:!0,removeDiscussions:!0});return n||(u=(0,K().f$)(u,{currentUserId:i.currentUser.id,currentTimeZone:(0,A().P)()})),Mt().yr({environment:i,index:t.start.index,store:t.start.store,tokens:u,transaction:r}),{newSelectionIndex:s}}function Bt(e){const{transaction:t,clipboardData:o,startBlockStore:n,duplicateStartStore:i,insertionPath:r,insertionPathRootStore:a,duplicates:c,range:l}=e,d=s().default.checkGate({gateName:"prefer_high_level_operations"});for(const s of l.iterateInsertionAt(r))(0,It().eM)({transaction:t,treeOperation:s,deleteFrom:"tree-parent",preferHighLevelOperations:d}),vt().O.applyMutable(s);if(o.blockSelection.wasContiguousSelection&&o.blockSelection.blocks.length>0&&!n.hasContent())for(const s of i.getContentStores())St().NI({parentStore:n.getContentStore(),childStore:s,transaction:t});const u=new Set;for(const{originalToDuplicate:s}of c){const e=s.getByTable($().ev);for(const{value:o}of e){var p;if(!o||u.has(o.id))continue;u.add(o.id);const e=Ye().B.createChildStore(i,o),n=(0,ht().g)(e),r="transclusion_reference"===a.getType()?null===(p=a.getTransclusionReferenceTargetStore())||void 0===p?void 0:p.id:a.id;n.find((e=>e.id===r))||(t.logDebugMessage("disposing of unwanted duplicated block",e,e.id===i.id),Ct().bn({childStore:e,parentStore:a,alive:!1,transaction:t}))}}}var Dt=()=>o(914577),_t=()=>o(901389),Rt=()=>o(675074),Pt=()=>o(131581),Lt=()=>o(813743),Ft=()=>o(722101),Et=()=>o(384944),Vt=()=>o(391214),Ot=()=>o(778417),Ut=()=>o(471995),Nt=()=>o(904193),Wt=()=>o(538527),Ht=()=>o(789200),$t=()=>o(72159),jt=()=>o(903864);function zt(){var e;const t=Ee().get(),o=null===(e=(0,Pe().GI)({range:t,contentEditableLeafRegistry:void 0,allowInvisibleEndSelection:!0}))||void 0===e?void 0:e.multiSelection;if(o){const e=(0,Pe().$W)(o).some((({editable:e})=>e.props.disabled));(0,Tt().setMultiSelection)({readOnly:e,multiSelection:o})}}var Gt=()=>o(231297),Jt=()=>o(949237),Zt=()=>o(340593);const Qt=!1;function Kt(...e){Qt&&console.log("clipboardActions:",...e)}const qt=(0,X().YK)({offlineError:{id:"clipboardActions.offlineError.message",defaultMessage:"Please go online to copy this block."},untitled:{defaultMessage:"Untitled",id:"clipboardActions.untitledMessage"}}),Yt=(0,X().YK)({copiedQnAMessageToClipboard:{id:"action.copiedQnAMessageToClipboard",defaultMessage:"Copied response to clipboard"},copiedHumanMessageToClipboard:{id:"action.copiedHumanMessageToClipboard",defaultMessage:"Copied your message to clipboard"},copiedEmailToClipboard:{id:"action.copiedEmailToClipboard.snackBarMessage",defaultMessage:"Copied email to clipboard"},copiedUserIdToClipboard:{id:"action.copiedUserIdToClipboard.snackBarMessage",defaultMessage:"Copied user ID to clipboard"},copiedLinkToClipboard:{id:"action.copiedLinkToClipboard.snackBarMessage",defaultMessage:"Copied link to clipboard"},copiedPageLinkToClipboard:{id:"action.copiedPageLinkToClipboard.snackBarMessage",defaultMessage:"Copied page link to clipboard"},copiedFormLinkToClipboard:{id:"action.copiedFormLinkToClipboard.snackBarMessage",defaultMessage:"Copied form link to clipboard"},copiedTeamHomeLinkToClipboard:{id:"action.copiedTeamHomeLinkToClipboard.snackBarMessage",defaultMessage:"Copied page link to clipboard"},copiedBlockLinkToClipboard:{id:"action.copiedBlockLinkToClipboard.snackBarMessage",defaultMessage:"Copied block link to clipboard"},copiedLinksToClipboard:{id:"action.copiedLinksToClipboard.snackBarMessage",defaultMessage:"Copied links to clipboard"},copiedPropertyToClipboard:{id:"action.copiedPropertyToClipboard.snackBarMessage",defaultMessage:"Copied property to clipboard"},copiedCodeToClipboard:{id:"action.copiedCodeToClipboard.snackBarMessage",defaultMessage:"Copied code to clipboard"},copiedTokenToClipboard:{id:"action.copiedTokenToClipboard.snackBarMessage",defaultMessage:"Copied token to clipboard"},copiedToClipboard:{id:"action.copiedToClipboard.snackBarMessage",defaultMessage:"Copied to clipboard"},copiedApiObjectToClipboard:{id:"action.copiedApiObjectToClipboard.snackBarMessage",defaultMessage:"Copied API object to clipboard"},copiedImageToClipboard:{id:"action.copiedImageToClipboard.snackBarMessage",defaultMessage:"Copied image to clipboard"},copyingImage:{id:"action.copyingImage.snackBarMessage",defaultMessage:"Copying..."},copyImageError:{id:"action.copyImageError.snackBarMessage",defaultMessage:"Failed to copy image to clipboard"},copiedPageToClipboard:{id:"action.copiedPageToClipboard.snackBarMessage",defaultMessage:"Copied page to clipboard"},clipboardAccessDenied:{id:"action.clipboardAccessDenied.snackBarMessage",defaultMessage:"Clipboard access denied. Please check your browser permissions."}}),Xt={...o(979004).fileExtensionToCodeLanguageMap,dockerfile:"Docker",javascriptreact:"JavaScript",jsonc:"JSON","objective-c":"Objective-C",proto:"Protobuf",shellscript:"Shell",typescriptreact:"TypeScript",vb:"Visual Basic"},eo="text/_notion-blocks-v3-production",to="text/_notion-text-production",oo="text/_notion-multi-text-production",no="text/_notion-page-source-production",io="vscode-editor-data",ro=[eo,to,oo,no],ao=new Set(ro);const so={fromJson:e=>e,toJson:e=>e},co=so,lo=so,uo=so,po={fromJson(e){const t=(0,q().v)(e.tree,(e=>e)),o=mo.fromJson(e.blockSelection);return{...e,tree:t,blockSelection:o}},toJson(e){const t=mo.toJson(e.blockSelection);return{...e,blockSelection:t}}},mo={fromJson:e=>({...e,blocks:e.blocks.map((e=>({...e,blockSubtree:e.blockSubtree?U().RecordMap.create(e.blockSubtree):void 0})))}),toJson:e=>({...e,blocks:e.blocks.map((e=>({...e,blockSubtree:e.blockSubtree?e.blockSubtree.toJson():void 0})))})},fo="VirtualClipboard:production";let go;function vo(e){return e.isAndroid}function bo(e,t){if(!vo(t))return e;const o=(0,xe().n8)(e.getData("text/html"));if(o){go||(go=G().A.get(fo));const t=go;if(o===(null==t?void 0:t.id)){const o=e.types.concat(Object.keys(t.mimeTypes));return{getData(o){const n=e.getData(o);return!n&&function(e){return ao.has(e)}(o)?t.mimeTypes[o]||"":n},types:[...new Set(o)].filter((o=>{const n=t.mimeTypes[o];return""!==e.getData(o)||n&&""!==n})),items:e.items}}}return e}function ko(e,t,o,n){if(!e.clipboardData)return;const i=o.toJson(n),r=JSON.stringify(i);e.clipboardData.setData(t,r)}function So(e,t,o){try{const n=e.getData(t),i=JSON.parse(n);return o.fromJson(i)}catch(n){}}function yo(e){const{clipboardData:t}=e,{text:o,html:n,isFromMicrosoftOffice:i,isHtmlTable:a}=function(e){const{clipboardData:t,tinyMceMicrosoftWordPasteFilter:o}=e,n=t.getData("text/uri-list"),i=t.getData("text/plain").replace(en,"\n")||n;let a=t.getData("text/html");for(const d of tn){const e=t.getData(d);if(e){const{ops:t}=JSON.parse(e);t&&(a=new(r().Ss)(t,{}).convert())}}const s=Jo(a),{isHtmlTable:c,htmlContainsRichFormatting:l}=function(e){var t;const o=document.createElement("div");o.innerHTML=Zo(e);const n=Boolean("table"===(null===(t=o.firstElementChild)||void 0===t?void 0:t.nodeName.toLowerCase()));return{htmlContainsRichFormatting:B().HZ({node:o,window,emojiData:ke().A.state}),isHtmlTable:n}}({html:a,tinyMceMicrosoftWordPasteFilter:o});if(!l&&!function(e,t){return Xo.test(e)&&Xo.test(t)}(a,i))return{text:i,isFromMicrosoftOffice:s,isHtmlTable:c};return{text:i,html:a,isFromMicrosoftOffice:s,isHtmlTable:c}}(e);return{text:o,html:n,multiTextSelectionData:So(t,oo,po),textSelectionData:So(t,to,co),blockSelectionData:So(t,eo,mo),isFromMicrosoftOffice:i,isHtmlTable:a}}function ho(e){const{blocks:t,action:o,environment:n}=e;if(0===t.length)return{action:o,blocks:[],wasContiguousSelection:!1};const i=t[0],r=i.inMemoryRecordCache,a=te().sb(te().oE(t.map((e=>e.id)))),s=i.getParentBlockStore(),c=s?s.getRenderableContentIds():[],l=c.indexOf(i.id),d=Boolean(s&&t.every(((e,t)=>c.indexOf(e.id)===l+t)));if(r.isTemplatePreview){return{blocks:a.map((e=>({blockId:e,blockSubtree:(0,ge().loadLocalSubtree)({environment:n,blockId:e,inMemoryRecordCache:r,options:{allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Ae().$J)()}}).recordMap}))),action:o,wasContiguousSelection:d}}if(r.snapshotData){!function(e,t){(0,mt().DO_NOT_USE_trackLegacy)(e,"history_copy",{ageMs:(0,ft().S)(t)})}(n,r.snapshotData);return{blocks:a.map((e=>({blockId:e,blockSubtree:(0,ge().loadLocalSubtree)({environment:n,blockId:e,inMemoryRecordCache:r,options:{allowCopyCollections:!0,requireFullSubtree:!0,skipNavigableChildren:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Ae().$J)()}}).recordMap}))),action:o,wasContiguousSelection:d,wasSelectionFromSnapshot:!0}}{const e=(0,xe().x4)(t),i=e&&Mo({environment:n,inMemoryRecordCache:r,multiColumnPasteInfo:e});if(e&&i){let t=!1;const s=[];for(const o of a)e.blockIds.has(o)?t||(s.push({blockId:e.columnListId,blockSubtree:i}),t=!0):s.push({blockId:o,blockSubtree:(0,ge().loadLocalSubtree)({environment:n,blockId:o,inMemoryRecordCache:r,options:{allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Ae().$J)()}}).recordMap});return{blocks:s,action:o,wasContiguousSelection:d}}return{blocks:a.map((e=>({blockId:e,blockSubtree:(0,ge().loadLocalSubtree)({environment:n,blockId:e,inMemoryRecordCache:r,options:{allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Ae().$J)()}}).recordMap}))),action:o,wasContiguousSelection:d}}}function Io({textToken:e,hrefToNumberMetadata:t}){if(!J().B8H(e))return e;const o=J().uPN(e),n=J().g2K(o);if(!n)return e;const i=J().NpB(n).href;let r=t.map.get(i);return r||(r=t.currentNumber++,t.map.set(i,r)),J().Ey_(`[${r}]`,[J().Sez(i)])}function xo({recordMap:e,hrefToNumberMetadata:t}){const o=e.getModelsByTable($().ev);for(const n of o){const o=n.getProperty("title");if(!o)continue;const i=J().RQ(o).map((e=>Io({textToken:e,hrefToNumberMetadata:t}))),r=e.getValue(n.pointer);if(r){const t={...r,properties:{...r.properties,title:i}};e.setValue(n.pointer,t)}}}function Co(e){const{markdown:t,markdownOptions:o,markdownLinkifyIt:n}=e;if(n)return L().uY({...n,markdown:t,plugin:null==o?void 0:o.plugin})}function Mo(e){var t;const{environment:o,multiColumnPasteInfo:n,inMemoryRecordCache:i}=e,{columnListId:r,columnIds:a,spaceId:s}=n,c=U().RecordMap.create(),l=null===(t=i.getEntry({pointer:{table:$().ev,id:r,spaceId:s},userId:o.currentUser.id}))||void 0===t?void 0:t.value.value;if("column_list"!==(null==l?void 0:l.type))return;const d={...l,content:(l.content||[]).filter((e=>a.has(e)))};c.setValue({table:$().ev,id:r,spaceId:s},d);for(const m of a){var u;const e=null===(u=i.getEntry({pointer:{table:$().ev,id:m,spaceId:s},userId:o.currentUser.id}))||void 0===u?void 0:u.value.value;if("column"!==(null==e?void 0:e.type))return;const t={...e,content:(e.content||[]).filter((e=>n.blockIds.has(e)))};c.setValue({table:$().ev,id:m,spaceId:s},t)}const p=[c];for(const m of n.blockIds){const e=(0,ge().loadLocalSubtree)({environment:o,blockId:m,inMemoryRecordCache:i,options:{allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Ae().$J)()}}).recordMap;if(!e)return;p.push(e)}return U().RecordMap.merge(p)}function To(e){const{rootBlock:t,getRecordValue:o,spaceIdCreator:n}=e,i=o(t);if(!i)return;const r=(0,T().zN)({block:i,getRecordValue:o});if(!r)return;const a=(0,xe().M9)({rootBlock:t,getRecordValue:o,formulasModule:x(),spaceIdCreator:n}),s=(0,g().Dp)(r),c=Object.keys(s),l=te().Ul(c,(e=>{const t=s[e];return t&&t.name||""}));let d="";for(const u of l){const e=s[u];if(e&&"title"!==u){const t=(0,y().sL)({property:u,schema:s,block:i,exportArgs:a,renderers:S().z});t&&(d+=`${e.name}: ${t}\n`)}}return d||void 0}function wo(e){const{treePath:t,textPosition:o,endpoint:n}=e,{store:i,index:r}=o,a=t.map((e=>e.value.store.pointer)),s=me().SL(o.store)?["properties","title"]:o.store.path,c=J().AI5(i.getValue(),r,r);return{copiedText:"end"===n?c.tokensBeforeRange:c.tokensAfterRange,textIndex:r,attributePath:s,pointerPath:a}}function Ao(e){var t;const{multiSelection:o,action:n,environment:i}=e;(0,Re().K)(o)&&console.warn("Warning, serializeMultiTextSelectionToClipboardData() was called with a single-store text selection! This function should only be  called with a multi-selection that spans multiple blocks.");const r=null===(t=(0,Pe().ZS)({filterCommonAncestors:!0,multiSelection:o,focus:void 0}))||void 0===t?void 0:t.stores;if(!r)return;const a=o.start.store.inMemoryRecordCache,c=ho({action:n,blocks:r,environment:i});if(0===c.blocks.length)return;const l=(0,Pe().Tp)({multiSelection:o,includeNonSelectable:!1});if(!l)return;const{treeRange:d}=l,u=[],p=new Map,m=(e,t)=>{t.forEach((e=>m(e,[])));const o=p.get(e),n=o&&o.length>t.length?o:t;p.set(e,n)},f=s().default.checkGate({gateName:"prefer_high_level_operations"});for(const{start:s,end:h}of d.iterateAnalogousNodes()){if(s){const e=s.childrenBeforeRange.slice(-1).concat(s.childrenInsideRange);m(s.parent,e)}if(h)if(m(h.parent,h.childrenInsideRange),f)for(const e of h.childrenAfterRange)u.push({command:"removeChild",path:["content"],pointer:h.parent.value.store.pointer,args:{id:e.value.store.id}});else u.push(E().op.set({pointer:h.parent.value.store.pointer,path:["content"],args:h.childrenInsideRange.map((e=>e.value.store.id))}))}const g=wo({textPosition:o.start,endpoint:"start",treePath:d.startPath}),v=wo({textPosition:o.end,endpoint:"end",treePath:d.endPath});u.push(...(0,xe().Qr)(g),...(0,xe().Qr)(v));for(const s of[null===(b=c.blocks[0])||void 0===b?void 0:b.blockSubtree,null===(k=c.blocks[c.blocks.length-1])||void 0===k?void 0:k.blockSubtree]){var b,k;s&&((0,V().applyOperationsToRecordMap)({recordMap:s,operations:u,updateOnly:!0}),f&&Bo(i,a,s))}const S=(0,q().v)(d.commonAncestor,(e=>{const t=p.get(e);if(t)return{value:e.value.store.pointer,children:t}}));if(!S)return void Kt("unexpected: trimming tree produced undefined");const y={currentNumber:1,map:new Map};for(const{blockSubtree:s}of c.blocks)s&&xo({recordMap:s,hrefToNumberMetadata:y});return g.copiedText=J().RQ(g.copiedText).map((e=>Io({textToken:e,hrefToNumberMetadata:y}))),v.copiedText=J().RQ(v.copiedText).map((e=>Io({textToken:e,hrefToNumberMetadata:y}))),{blockSelection:c,tree:S,multiTextSelection:{start:g,end:v},action:n}}function Bo(e,t,o){const n=[];for(const{model:i}of o)if(i instanceof F().zgg&&!i.alive){n.push(i.pointer);const o=(0,ge().loadLocalSubtree)({environment:e,blockId:i.pointer.id,inMemoryRecordCache:t,options:{allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Ae().$J)()}}).recordMap;if(o)for(const{pointer:e}of o)n.push(e)}for(const i of n)o.delete(i)}function Do(e){const{environment:t,event:o}=e,n=D().JW();!function(e){const{environment:t,event:o,markdownLinkifyIt:n}=e;if(!o.clipboardData)return;const i=et().default.state.stores,r=tt().default.isEditingComment(),a=ze().A.state.open,l=We().wg(),d="empty"!==tt().default.state.mode&&tt().default.state.multiSelection,u=t.currentUser.id,p="copy"===o.type?"copy":"cut",m=(0,ye().Z)();m&&(0,N().Yt)(m.pointer,$().ev)&&ko(o,no,lo,m.pointer);const g=d&&(0,De().H)(d);if(g&&g.selection.startIndex!==g.selection.endIndex){const e=Be().A.getIntl(),{store:n,selection:i}=g,r=n.inMemoryRecordCache,a=n.getValue();Kt("copy: copying single-store text selection"),o.preventDefault();const s=Ko();if(a&&!s){const e=n.table===$().ev?(0,Fe().T)(n):void 0,t=e&&te().n4(n.path,e.getBlockTitleStore().path)?e.getType():void 0,r=t&&(0,f().aO)(t)?t:void 0,s=a.filter((e=>!J().B8H(e)&&!J().jR$(e)));ko(o,to,co,{blockType:r,editing:s,selection:i,action:p})}const l=J().Ffo(a,i.startIndex,i.endIndex),d=F().b4_.fromGetRecordValueFn(r.makeGetRecordValueFn(u)),m=r.makeGetRecordRoleFn(u),v=null==s?void 0:s.valueTypes,b=(0,W().r4)({intl:e,textValue:l,getRecordModel:d,userTimeZone:(0,A().P)(),externalIntegrations:Qe().A.integrations.state,valueTypes:v});o.clipboardData.setData("text/plain",(0,xe().Df)(t.device.isWindows,b));const k=e=>e.table===$().ev?(0,Te().QN)(e):je().tN(t)(e),S=(0,Q().$e)({textValue:l&&{value:l,spaceId:(0,z().e)(n.pointer.spaceId)},getRecordModel:d,getRecordRole:m,userTimeZone:(0,A().P)(),isAndroid:!1,isSafariOrIOS:!1,isFirefox:!1,isWindows:!1,disableLinks:!1,disabled:!0,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,baseUrl:c().A.domainBaseUrl,publicDomainName:c().A.publicDomainName,showEmojiInline:!0,emojiType:"raw",theme:(0,ee().x0)(),intl:e,katex:void 0,isClient:void 0,currentUserId:void 0,getPublicBaseUrlForPageOrCollection:k,externalIntegrations:Qe().A.integrations.state,formulaValueTypes:[],emojiData:ke().A.state,isMobileNative:!1});return void o.clipboardData.setData("text/html",(0,xe().Df)(t.device.isWindows,S))}if(d&&!(0,_e().k)(d)&&!r&&d.start.store.table===$().ev&&d.end.store.table===$().ev){const e=Ao({environment:t,multiSelection:d,action:p});if(e){Kt("copy: copying multi-text selection"),o.preventDefault(),ko(o,oo,po,e);const{markdown:i,html:r}=(0,xe().Ij)({clipboardData:e,multiSelection:d,currentUserId:u,isWindows:t.device.isWindows,markdownLinkifyIt:n,markdownSerializationOptions:{transformBlockMapping:{image:s().default.checkGate({gateName:"docs_clipboard_imagedata"})?_o:void 0}},formulasModule:x(),spaceIdCreator:t.idCreator.getSpaceIdCreatorSync(d.start.store.pointer.spaceId||"")});return i&&o.clipboardData.setData("text/plain",i),void(r&&o.clipboardData.setData("text/html",r))}}if(d&&!(0,_e().k)(d)&&!r&&d.start.store.table===j().SN&&d.end.store.table===j().SN){Kt("copy: copying comment multi-text selection"),o.preventDefault();const e=(0,Pe().$W)(d),n=Be().A.getIntl(),i=e.map((({store:e,selection:o})=>{if(o.startIndex===o.endIndex)return;const i=e.inMemoryRecordCache,r=F().b4_.fromGetRecordValueFn(i.makeGetRecordValueFn(u)),a=i.makeGetRecordRoleFn(u),s=J().Ffo(e.getValue(),o.startIndex,o.endIndex);return{plainText:(0,W().r4)({intl:n,textValue:s,getRecordModel:r,userTimeZone:(0,A().P)(),externalIntegrations:Qe().A.integrations.state}),htmlContent:(0,Q().$e)({textValue:s&&{value:s,spaceId:(0,z().e)(e.pointer.spaceId)},getRecordModel:r,getRecordRole:a,userTimeZone:(0,A().P)(),isAndroid:!1,isSafariOrIOS:!1,isFirefox:!1,isWindows:!1,disableLinks:!1,disabled:!0,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,baseUrl:c().A.domainBaseUrl,publicDomainName:c().A.publicDomainName,showEmojiInline:!0,emojiType:"raw",theme:(0,ee().x0)(),intl:n,katex:void 0,isClient:void 0,currentUserId:void 0,getPublicBaseUrlForPageOrCollection:je().tN(t),externalIntegrations:Qe().A.integrations.state,formulaValueTypes:[],emojiData:ke().A.state,isMobileNative:!1}),textValue:s}})).filter(ie().O9),r=i.map((e=>e.plainText)).join("\n\n"),a=`<div>${i.map((e=>e.htmlContent)).join("</div><div>")}</div>`;return o.clipboardData.setData("text/plain",(0,xe().Df)(t.device.isWindows,r)),void o.clipboardData.setData("text/html",(0,xe().Df)(t.device.isWindows,a))}if(i.length>0&&!r&&!l&&!a){Kt("copy: copying block selection"),o.preventDefault();const e=i[0],r=e.inMemoryRecordCache,a=ho({blocks:i,environment:t,action:p});if(ko(o,eo,mo,a),!e.isDefined())return;const s=te().oE(i.map((e=>e.computeWithRecordValues((({getRecordValueAndSubscribe:t})=>t(e)))))),c=r.makeGetRecordValueFn(u),{markdown:l,html:d}=(0,xe().ZI)({rootBlock:{id:e.id,table:$().ev,spaceId:e.getSpaceId()},blockValues:s,getRecordValue:c,isWindows:t.device.isWindows,markdownLinkifyIt:n,formulasModule:x(),spaceIdCreator:t.idCreator.getSpaceIdCreatorSync(e.getSpaceId())});return l&&o.clipboardData.setData("text/plain",l),void(d&&o.clipboardData.setData("text/html",d))}Kt("copy: doing nothing")}(e),(0,xe().dk)(o,n),function({event:e,device:t,customEventId:o}){if(!e.clipboardData||!vo(t))return;const n={};for(const a of ro)n[a]=e.clipboardData.getData(a);const i=e.clipboardData.getData("text/html");e.clipboardData.setData("text/html",`${i}${(0,xe().uE)(o)}`),go={id:o,mimeTypes:n};try{G().A.set(fo,go)}catch(r){M().log({level:"error",from:"clipboardActions",type:"setVirtualClipboardData",error:{message:"Unable to persistently store virtual clipboard data."}})}}({event:o,device:t.device,customEventId:n})}function _o(e){const{block:t,exportArgs:o}=e,{getExportedRenderAsset:n}=o,{source:i}=F().Bj6.fromBlock(t).getProperties(),r=J().q4_(i),a=function(e){if(!e.file_ids)return;const t=Ue().K.findBlockFromId(e.id);if(!t)return;const o=t.getNode();if(!(o instanceof Element))return;const n=o.querySelector("img");if(!n)return;const i=document.createElement("canvas");i.width=n.width,i.height=n.height;const r=i.getContext("2d");if(!r)return;return r.drawImage(n,0,0,n.width,n.height),i.toDataURL()}(t)??n({fromBlockId:o.blockId,toFileURI:r}),s=L().qh(e)||L().Qw({block:t,exportArgs:o})||a;return{text:(0,b().rS)({url:r})?`![${s}](${a})`:`[${s}](${a})`,breakLines:!0,children:L().q5(e)}}async function Ro(e){const{event:t,environment:o,markdownLinkifyIt:n}=e;zt();const i=et().default.state.stores,r=tt().default.isEditingComment(),a=(0,he().f)(),s="editing"===tt().default.state.mode&&tt().default.state.multiSelection,{phase:c}=et().default.state;if(Po({environment:o,event:t,disableSyncTextSelection:!0,markdownLinkifyIt:n}),s&&!(0,_e().k)(s)){const e=(0,qe().aP)(s.start.store),t=e?Ze().Uv.getMode(e):"default";Gt().createAndCommit({userAction:"clipboardActions.cutWithMaybeConfirmation",environment:o,canUndo:!0,perform:n=>{if("suggest"===t){const t=pe().RR(o,n,e);pe().rY({environment:o,multiSelection:s,transaction:n,discussionStore:t})}else Mt().f0({environment:o,multiSelection:s,transaction:n})}})}else(c===et().SelectionPhase.Selected||s)&&i.length>0&&!r&&!a&&await Vt().Af({environment:o,blocks:i,shouldCheckSuggestEdit:!0});Ke().A.setKeyboardMode(!0)}function Po(e){const{environment:t,event:o,disableSyncTextSelection:n,markdownLinkifyIt:i}=e;n||zt(),Do({environment:t,event:o,markdownLinkifyIt:i}),Ke().A.setKeyboardMode(!0)}function Lo(e){var t;const{environment:o,files:n,transaction:i,insertBelowBlockStore:r}=e,a=et().default.getCurrentRecordCache(),s=(0,Se().y)(o);if(!a)return;const c=et().default.state.stores,l=Rt().$C({environment:o,files:n,inMemoryRecordCache:a,transaction:i,pageWidth:s,spaceId:0!==c.length?c[0].pointer.spaceId:null===(t=(0,ye().Z)())||void 0===t?void 0:t.pointer.spaceId});l.forEach((e=>{const t=e.getType();t&&pt().vH(o,{from:"paste",type:t,creating_block_id:e.id})})),Vo({environment:o,blocks:l,transaction:i,replaceEmptyTextBlock:!0,insertBelowBlockStore:r})}function Fo(e){const{environment:t,store:o,tokens:n,index:i,transaction:r,multiTextSelection:a,disableEmbedMenu:s,selectAll:l}=e,u=(0,De().H)(a),p=u?{value:u.store.getValue()}:void 0,m=(0,qe().aP)(o),f=m?Ze().Uv.getMode(m):"default",g=tt().default.isEditingComment()||tt().default.isEditingCaption(),v=m&&"page"===m.getType()&&m.getBlockTitleStore()===o;let b=n;(g||v)&&(b=function(e){const{tokens:t}=e,o=Eo(t);if(o&&o.url===o.text){const e=(0,H().parseRoute)({url:o.url,baseUrl:c().A.domainBaseUrl,publicDomainName:c().A.publicDomainName,isMobile:Boolean(c().A.isMobile),protocol:c().A.protocol,currentUrl:window.location.href});if("page"===e.name&&e.blockId){const t=J().ld4(e.scrollToBlockId??e.blockId,void 0);return[J().wmz(t),J().Ey_(" ")]}if("collection"===e.name){const t=J().ETy({collectionId:e.collectionId,spaceId:e.space&&"id"in e.space?e.space.id:void 0,parentCvbId:e.parentBlockId});return[J().wmz(t),J().Ey_(" ")]}}return t}({environment:t,tokens:n})),Mt().yr({environment:t,store:o,tokens:b,index:i,transaction:r,selectAll:l,editorMode:f});const S=Eo(b);!s&&p&&S&&"suggest"!==f&&function(e){const{environment:t,hyperlink:o,oldTextValue:n}=e,i="editing"===tt().default.state.mode&&(0,De().H)(tt().default.state.multiSelection),r=et().default.state;if(i&&r.stores.length>0){const e=i.store.getValue(),r=J().q4_(e),a=k().PE(r.substring(0,r.indexOf(o.text))).length,s=a+k().PE(o.text).length;if(i.store.isTable($().ev)||i.store.isTable(j().SN)){if(Jt().p6({environment:t,blockStore:et().default.state.stores[0],textStore:i.store,textValueBeforePaste:n,url:o.url,urlSelection:{startIndex:a,endIndex:s}}))return;if(Lt().Yf({environment:t,textStore:i.store,blockStore:et().default.state.stores[0],oldTextValue:n,url:o.url,urlSelection:{startIndex:a,endIndex:s}}))return}d().default.afterNextFlush((()=>{const e=o.url;Pt().p6({environment:t,textStore:i.store,oldTextValue:n,url:e,urlSelection:{startIndex:a,endIndex:s}})}))}}({environment:t,hyperlink:S,oldTextValue:p.value,transaction:r})}function Eo(e){if(1!==e.length)return;const t=e[0];if(!J().BEe(t))return;const[o,n]=t;if(1!==n.length)return;const i=n[0];if(!J().sh$(i))return;return{text:o,url:J().cQR(i)}}function Vo(e){const{environment:t,blocks:o,transaction:n,replaceEmptyTextBlock:i,insertBelowBlockStore:r}=e,a=et().default.state.stores;if(1===a.length){const e=a[0];if(e.getType()&&e.isType(f().KK)&&function(e){if("editing"!==tt().default.state.mode||!tt().default.state.multiSelection)return!1;const t=(0,De().H)(tt().default.state.multiSelection);if(!t)return!1;return t.store===e.getTitleStore()}(e)){const i=e.getContentStore(),r=te().o8(o).reverse().map((e=>Ft().Hs({parentStore:i,prependStore:e,transaction:n}).childStore));return Ot().td({environment:t,stores:r}),r}}return Vt().LE({environment:t,blocksToInsert:o,target:r?[r]:a,transaction:n,replaceEmptyTextBlock:i})}function Oo(e,t,o,n){const i=(0,ye().Z)();if(!i)return;const r=et().default.state.stores,a=0!==r.length?r[0].pointer.spaceId:i.pointer.spaceId,s="suggest"===Ze().Uv.getMode(i,!0);let c=function(e,t){if("cut"!==t.action)return;const o="suggest"===Ze().Uv.getMode(e,!0),n=[];for(const i of t.blocks){const t=Ye().B.createChildStore(e,{table:$().ev,id:i.blockId});if(!t.isReady())return;const r=t.getModel();if(!r)return;if(r.getSpaceId()!==e.getSpaceId())return;if(!1!==r.alive)return;o&&!f().ei[r.getType()]||n.push(t)}return n}(i,t);if(!c){const r=JSON.stringify(t).length>Oe().vs;c=t.blocks.reduce(((c,{blockId:l,blockSubtree:d})=>{var p,m,g,v;const b=Ye().B.createChildStore(i,{table:$().ev,id:l,spaceId:null==o?void 0:o.spaceId});let k;if(b.isDefined())k=b.getModel();else{const e=null==d?void 0:d.getModel({table:$().ev,id:l});k=e&&F().Bj6.fromBlock(e)}if(s&&k&&!f().ei[k.getType()])return c;if(null!==(p=k)&&void 0!==p&&p.isCollectionView()&&d&&k.hasLinkedCollections(F().b4_.fromRecordMap(d))&&(null===(m=k)||void 0===m?void 0:m.getSpaceId())!==a){const t=Et().Wv({environment:e,type:f().xd.text,inMemoryRecordCache:b.inMemoryRecordCache,transaction:n,spaceId:a});return Mt().yr({environment:e,store:t.getBlockTitleStore(),tokens:[J().wmz(J().ld4(l,k.getSpaceId()))],index:0,transaction:n}),c.push(t),c}const S=!((0,ce().l)(i)||qo()||null!==(g=k)&&void 0!==g&&g.isTemplateVariableContainerBlock()),y=d&&a&&(null===(v=k)||void 0===v?void 0:v.getSpaceId())&&se().Lw({sourceSpaceId:k.getSpaceId(),targetSpaceId:a,sourceBlockSubtree:d});if(d&&!r&&!y){const t=(0,ve().localDuplicate)({environment:e,sourceBlockId:l,targetBlockPointer:(0,we().zP)({environment:e,table:$().ev,spaceId:a}),sourceBlockSubtree:d,targetInMemoryRecordCache:b.inMemoryRecordCache,options:{addCopyName:!0,allowRedundancy:!1,deepCopyTransclusionContainers:!1,resolveTemplateVariables:S,preventLegacyTransclusions:(0,Ae().$J)()},from:"paste",transaction:n}).targetBlockStore,o=t.getType();if(o){const n=b.getParentCollectionIdUpToTwoLevels(),i={from:"paste",new_page_id:"page"===o?t.id:void 0,creating_block_id:t.id,parent_collection_id:n};pt().tP(o)?pt().vH(e,{...i,type:o,collection_id:n||""}):pt().vH(e,{...i,type:o})}return c.push(t),c}if(t.wasSelectionFromSnapshot)return M().log({level:"warning",from:"clipboardActions",type:"pasteBlockSelection",data:{message:"Unable to locally duplicate pasted block selection from snapshot",miscDataToConvertToString:{blockId:l,blockType:b.getType(),blockSelectionTooBig:r,missingBlockSubtree:!d}}}),c;u().A.state.online||_t().f1(Be().A.formatMessage(qt.offlineError));const{blockStores:h,onComplete:I}=fe().duplicateBlock({environment:e,stores:[b],transaction:n,from:"paste",options:{addCopyName:!0,allowRedundancy:!1,deepCopyTransclusionContainers:!1,resolveTemplateVariables:S,convertExternalObjectInstancesToPlaceholders:!1},targetSpaceId:(0,z().e)(a),executionTarget:"server",skipUserFacingMessages:!1}),x=h[0],C=x.getType();return I.then((t=>{if("success"===t.status&&C){const t=b.getParentCollectionIdUpToTwoLevels(),o={from:"paste",new_page_id:"page"===C?x.id:void 0,creating_block_id:x.id,parent_collection_id:t};pt().tP(C)?pt().vH(e,{...o,type:C,collection_id:t||""}):pt().vH(e,{...o,type:C})}})),c.push(x),c}),[])}if(s){const t=pe().RR(e,n,c[0]),o=[];c.forEach((e=>{const i={type:"insert",id:D().JW(),discussionId:t.id};pe().tM(n,e,i),o.push(e.id)})),n.preEnqueueActions.push((()=>{pe().c3({environment:e,transaction:n,discussionStore:t,addModifiedBlockIdsAfter:o})})),Wt().Ug({environment:e,blocks:c,annotation:[J().Ifu.SuggestionInsertText,t.id],transaction:n})}Vo({environment:e,blocks:c,transaction:n,replaceEmptyTextBlock:!0});const l=et().default.state.stores,p=l.length>0?l:[i],m=t.blocks.map((e=>{const t=p[0];return Ye().B.createChildStore(t,{table:$().ev,id:e.blockId})}));d().default.afterNextFlush((async()=>{await Promise.all(p.map((e=>e.waitUntil((()=>{const t=e.getType();return Boolean(t&&t!==f().xd.copyIndicator)}))))),await Promise.all(m.map((e=>e.load()))),o&&gt().ei({environment:e,blocks:p,pageSource:o,copiedStores:m,action:t.action,wasContiguousSelection:t.wasContiguousSelection,rootStore:i})&&gt().gi({environment:e,copiedStores:m,blocks:p,pageSource:o})}))}function Uo(e){const{environment:t,disableEmbedMenu:o,transaction:n,overwrite:i,selectAll:r,markdownOptions:a,markdownLinkifyIt:s,text:c,tinyMceMicrosoftWordPasteFilter:l}=e,d=tt().default.state,u=Qo(d);"editing"!==d.mode||"inline"!==u&&le(c)?i?(n.logDebugMessage("paste: pasting as markdown overwrite"),function(e){const{environment:t,text:o,transaction:n,selectAll:i,markdownOptions:r,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:s}=e,c=Co({markdown:o,markdownOptions:r,markdownLinkifyIt:a});if(!c)return;let l=Wo({environment:t,html:c,wrapInEmptyBlocks:!1,tinyMceMicrosoftWordPasteFilter:s});l||(l=Wo({environment:t,html:c,wrapInEmptyBlocks:!0,tinyMceMicrosoftWordPasteFilter:s}));if(!l)return;wt({environment:t,clipboardData:l,transaction:n,allowPasteIntoHeaderWithoutChildren:!0,selectAll:i,preventLegacyTransclusions:(0,Ae().$J)()})}({environment:t,text:c,transaction:n,selectAll:r,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l})):c&&(n.logDebugMessage("paste: pasting as markdown append"),function(e){const{environment:t,text:o,transaction:n,markdownOptions:i,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a}=e,s=Co({markdown:o,markdownOptions:i,markdownLinkifyIt:r});if(s)jo({environment:t,html:s,transaction:n,tinyMceMicrosoftWordPasteFilter:a})}({environment:t,text:c,transaction:n,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l})):(n.logDebugMessage("paste: pasting as inline markdown"),function(e){const{environment:t,text:o,disableEmbedMenu:n,transaction:i,selectAll:r,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:c}=e,l="editing"===tt().default.state.mode&&tt().default.state.multiSelection;if(l){const e=(0,De().H)(l);if(e&&function(e){const t=tt().default.state;return"editing"===t.mode&&!(0,_e().k)(t.multiSelection)&&(0,Re().K)(t.multiSelection)&&P().t6(e,"url")}(o))Yo({environment:t,text:o,transaction:i,editingSelection:e,selectAll:r});else if((0,Ve().B1)("c")){const e=(0,Fe().T)(l.start.store);Mt().$D({environment:t,editorMode:e?Ze().Uv.getMode(e):"default",multiSelection:l,string:o,disableMentions:!0,disableEmojiCommands:!0,disableSlashCommands:!0,transaction:i,selectAll:r})}else{const e=s&&L().Z4({...s,markdown:o,plugin:null==a?void 0:a.plugin});if(!e)return;$o({environment:t,html:e,transaction:i,stripText:!1,stripSurroundingWhitespace:!1,disableEmbedMenu:n,selectAll:r,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:c})}}}({environment:t,text:c,disableEmbedMenu:o,transaction:n,selectAll:r,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l}))}function No(e,t){const o=e.getValue({table:$().ev,id:t});if(!o)return;const n={table:$().ev,id:t,spaceId:o.space_id},i=(o.content??[]).map((t=>No(e,t))).filter(ie().O9);return new(q().PH)(n,i)}function Wo(e){var t,o,n,i;const r=(0,ye().Z)(),{html:a,wrapInEmptyBlocks:s,tinyMceMicrosoftWordPasteFilter:c,environment:d}=e,u=Go({environment:d,html:a,tinyMceMicrosoftWordPasteFilter:c,useCrdt:!1});if(!u)return;const{currentUserStore:p}=Ge().default.state;if(!p)return;let{allOperations:m,rootContentIds:f}=u;if(s){const e=zo(d),t=zo(d);if(!e||!t)return;m=[e.operation,...m,t.operation],f=[e.id,...f,t.id]}const g=U().RecordMap.create();(0,V().applyOperationsToRecordMap)({recordMap:g,operations:m,updateOnly:!1});const v=[],b=function(e){const{name:t,userId:o,recordMap:n}=e,i=U().RecordMapWithRole.create();for(const{pointer:r,model:a}of n)i.setModelAndRole(r,a,"reader");return new(l().A)({name:t,data:new(Y().b)({[o]:i})})}({name:"htmlToMultiTextSelectionClipboardData",userId:p.id,recordMap:g});for(const l of f){const e=(0,ge().loadLocalSubtree)({environment:d,blockId:l,inMemoryRecordCache:b,options:{allowCopyCollections:!0,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,Ae().$J)()}}).recordMap;v.push({blockId:l,blockSubtree:e})}const k=new(q().PH)({...(0,we().zP)({environment:d,table:$().ev,spaceId:null==r?void 0:r.pointer.spaceId})},f.map((e=>No(g,e))).filter(ie().O9));if(0===k.children.length)return;const S=k.children[0],y=null===(t=(0,q().Qe)([k],(e=>e===S)))||void 0===t?void 0:t.map((e=>e.value)),h=null===(o=g.getValue(S.value))||void 0===o||null===(o=o.properties)||void 0===o?void 0:o.title,I=(0,q().wI)(k),x=null===(n=(0,q().Qe)([k],(e=>e===I)))||void 0===n?void 0:n.map((e=>e.value)),C=null===(i=g.getValue(I.value))||void 0===i||null===(i=i.properties)||void 0===i?void 0:i.title,M=C?J().q4_(C).length:0;return h&&y&&C&&x?{blockSelection:{blocks:v,wasContiguousSelection:!0,action:"copy"},tree:k,multiTextSelection:{start:{textIndex:0,copiedText:h,attributePath:["properties","title"],pointerPath:y},end:{textIndex:M,copiedText:C,attributePath:["properties","title"],pointerPath:x}},action:"copy"}:void 0}function Ho(e){const{text:t,html:o,stripText:n,stripSurroundingWhitespace:i,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a}=e,c=o||(t?Co({markdown:t,markdownLinkifyIt:r}):void 0);if(!c)return;if(s().default.checkGate({gateName:"paste_links_as_mentions"})){const e=(0,xe().Lj)(c);if(e)return[J().wmz(J().ld4(e.id,e.spaceId),[])]}const l=document.createElement("div");return l.innerHTML=Zo({html:c,tinyMceMicrosoftWordPasteFilter:a}),B().Hw({node:l,window,stripText:n,stripSurroundingWhitespace:i,emojiData:ke().A.state})}function $o(e){const{environment:t,html:o,transaction:n,stripText:i,stripSurroundingWhitespace:r,disableEmbedMenu:a,selectAll:s,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:l}=e,d="editing"===tt().default.state.mode&&tt().default.state.multiSelection;if(d){const e=Ho({html:o,stripText:i,stripSurroundingWhitespace:r,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:l});if(!e)return;const u=(0,Fe().T)(d.start.store),p=1===e.length;if(p){if(p&&(!e[0][1]||0===e[0][1].length)){n.logDebugMessage("pasteInlineHtml: insertString");const o=e[0][0];return void Mt().$D({environment:t,editorMode:u?Ze().Uv.getMode(u):"default",multiSelection:d,string:o,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:n,selectAll:s})}const o=(0,De().H)(d);if(o&&!(0,_e().k)(d)){const[,i]=e[0],r=i&&J().VtW(i);if(r){n.logDebugMessage("pasteInlineHtml: pasteLinkOverText");return void Yo({environment:t,text:J().cQR(r),transaction:n,editingSelection:o,selectAll:s})}}}n.logDebugMessage("pasteInlineHtml: delete selection and insert"),Mt().f0({environment:t,multiSelection:d,transaction:n}),Fo({environment:t,store:d.start.store,tokens:e,index:d.start.index,transaction:n,disableEmbedMenu:a,multiTextSelection:d,selectAll:s})}}function jo(e){const{environment:t,html:o,transaction:n,tinyMceMicrosoftWordPasteFilter:i}=e,r=(0,ye().Z)();if(!r)return;const a=Go({environment:t,html:o,tinyMceMicrosoftWordPasteFilter:i,useCrdt:r.useCrdt()});if(!a)return;const{allOperations:s,rootContentIds:l}=a;for(const c of s)if((0,Z().ph)(c)){const e=Ye().B.createChildStore(r,c.pointer);Gt().applyCrdtTextOperation({store:e,operation:c,invertedOperation:void 0,transaction:n})}else if((0,E().$Y)(c)){const e=(0,Xe().v3)(r,c.pointer);Gt().applyOperation({store:e,operation:c,transaction:n})}else(0,ie().HB)(c);const u=l.map((e=>Ye().B.createChildStore(r,{table:$().ev,id:e})));u.forEach((e=>{const o=e.getType();if(o){const n=e.getParentCollectionIdUpToTwoLevels(),i={from:"paste",creating_block_id:e.id,parent_collection_id:n};pt().tP(o)?pt().vH(t,{...i,type:o,collection_id:n||""}):pt().vH(t,{...i,type:o})}}));const p=Vo({environment:t,blocks:u,transaction:n,replaceEmptyTextBlock:!0}).slice().reverse();return d().default.afterNextFlush((()=>{const e=p.map((e=>{if(e.getType()!==f().xd.text)return;const t=Eo(e.getTitleValue());if(!t)return;const o=(0,H().parseRoute)({url:t.url,baseUrl:c().A.domainBaseUrl,publicDomainName:c().A.publicDomainName,isMobile:Boolean(c().A.isMobile),protocol:c().A.protocol,currentUrl:window.location.href});return"page"===o.name?o:void 0})).filter(ie().O9);gt().T_({environment:t,rootStore:r,blocks:p,copiedLinks:e})||gt().Tw({environment:t,blocks:p})})),u}function zo(e){const{currentUserStore:t}=Ge().default.state,o=(0,ye().Z)();if(!t||!o)return;const n=t.id;if(!n)return;const i=o.id,r=o.pointer.spaceId,a=(0,we().Z1)({environment:e,table:$().ev,spaceId:r});return{operation:{pointer:{table:"block",id:a,spaceId:r},command:"set",path:[],args:{id:a,version:1,type:"text",properties:{title:[[""]]},parent_id:i,parent_table:"block",space_id:r,created_by_table:"notion_user",created_by_id:n,created_time:Date.now(),last_edited_by_table:"notion_user",last_edited_by_id:n,last_edited_time:Date.now(),alive:!0}},id:a}}function Go(e){const{environment:t,useCrdt:o,...n}=e,i=document.createElement("div");i.innerHTML=Zo(n);const{currentUserStore:r}=Ge().default.state,a=(0,ye().Z)();if(!r||!a)return;const s=r.getValue();if(!s)return;const c=a.getSpaceId(),l=(0,we().Gx)({environment:t,spaceId:c}),d=t.idCreator.getSpaceShortIdCreator(c,l);return B().aH({actor:(0,p().A7)(s),parent:{id:a.id,table:$().ev,spaceId:c},rootNode:i,deps:{importFileMap:{},window,intl:Be().A.getIntl(),randomID:oe().Ay,spaceIdCreator:d,randomShortID:ne().Ay,isPhoneNumber:O().W,emojiData:ke().A.state},options:{useCrdt:o,ignoreBlockCount:!1}})}function Jo(e){return/schemas-microsoft-com:office/.test(e)||/xmlns:m="http:\/\/schemas.microsoft.com\/office\/2004\/12\/omml"/.test(e)}function Zo(e){const{html:t,tinyMceMicrosoftWordPasteFilter:o}=e;return i().sanitize(o&&Jo(t)?o(t):t)}function Qo(e){const t="editing"===e.mode&&e.multiSelection;if(!t)return;const o=Ne().n.findEditableWithStore(t.start.store),n=null==o?void 0:o.props;return n&&!n.disabled?n.pasteBehavior:void 0}function Ko(){if("editing"!==tt().default.state.mode)return;const e=tt().default.state.multiSelection.start,t=e.store.path;if("formula"!==t[t.length-1])return;const o=(0,qe().zH)(e.store);if(o.table!==$().ev)return;const n=o.getPropertiesStore().getValue();if(!n)return;const i=o.getSpaceId(),r=J().q4_(n.value_types);if(!r)return;const a=(0,ae().$l)(r);return{start:e,spaceId:i,getRecordModel:o.getRecordModel,valueTypes:a}}function qo(){const e=et().default.state.stores;if("editing"!==tt().default.state.mode)return e.length>0&&e[0].isInsideFactoryOrDuplicateBlocksAction();if(0===e.length)return!1;const{multiSelection:t}=tt().default.state,o=t.start.store;if(!o.isTable($().ev))return!1;const n=Me().E(o);return Boolean(n)}function Yo(e){const{text:t,transaction:o,environment:n,editingSelection:i,selectAll:r}=e,a=(0,H().parseRoute)({url:t,baseUrl:c().A.domainBaseUrl,publicDomainName:c().A.publicDomainName,isMobile:Boolean(c().A.isMobile),protocol:c().A.protocol,currentUrl:window.location.href}),s="page"===a.name&&a.blockId?(0,_().wv)({pageId:a.blockId,peekViewBlockId:a.peekViewBlockId,peekMode:a.peekMode,discussionId:a.discussionId,scrollToBlockId:a.scrollToBlockId,collectionViewId:a.collectionViewId}):"collection"===a.name?(0,w().C)({collectionId:a.collectionId,spaceId:a.space&&"id"in a.space?a.space.id:void 0,spaceDomain:a.space&&"domain"in a.space?a.space.domain:void 0,parentCvbId:a.parentBlockId}):t,l=Mt().di({environment:n,store:i.store,selection:i.selection,transaction:o});Ht().g({environment:n,store:i.store,selection:l,annotationKey:"a",transaction:o,updateSelection:!1}),Wt().Mw({environment:n,store:i.store,selection:l,annotation:["a",s],transaction:o}),(0,$t().t)({store:i.store,selection:{startIndex:r?l.startIndex:l.endIndex,endIndex:l.endIndex}})}const Xo=/\<\!-- wp:/;const en=/\u2028/g,tn=["slack/texty"];function on({environment:e,event:t,disableEmbedMenu:o,transaction:i,onPasteFiles:r,formulasModule:a,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:l}){var d;const u=s().default.checkGate({gateName:"allow_cut_copy_comment"});if(t.preventDefault(),zt(),!t.clipboardData)return;const p=bo(t.clipboardData,e.device),m=Array.from(Array((null===(d=p.items)||void 0===d?void 0:d.length)??0).keys()).flatMap((e=>{var t;const o=p.items[e];if("file"!==o.kind)return[];const n=null===(t=o.getAsFile())||void 0===t||null===(t=t.name.match(/\.[^.]+$/))||void 0===t?void 0:t[0];return n?[n]:[]})),g=p.getData("text/html"),v=null==g?void 0:g.length;!function(e,{source:t,types:o,fileExtensions:n,htmlContent:i}){const r=[...o];r.sort();const a=n.map((e=>e.toLowerCase()));(0,mt().DO_NOT_USE_trackLegacy)(e,"paste",{source:t,types:r,file_extensions:a,original_html_content_size:i.length})}(e,{source:"editor",types:p.types||[],fileExtensions:m,htmlContent:g});const{text:b,html:S,multiTextSelectionData:y,textSelectionData:h,blockSelectionData:I,isFromMicrosoftOffice:x,isHtmlTable:M}=yo({clipboardData:p,tinyMceMicrosoftWordPasteFilter:l}),T=So(p,no,lo),w=function(e){return e.clipboardData?e.clipboardData.items?te().oE(Array.from(e.clipboardData.items).map((e=>{const t=e.getAsFile();if(t&&t.size>0)return new File([t],t.name??Be().A.formatMessage(qt.untitled),{type:e.type})}))):k().PE(e.clipboardData.files):[]}(t),B=(null==I?void 0:I.action)||(null==y?void 0:y.action)||(null==h?void 0:h.action);i.annotateWithUserAction("cut"===B?"paste.from_cut":Ie().V);const D=le(b),_=(0,Ve().X4)(),R="body"===_&&!h;if((w.length>0||I||D&&!R)&&!(0,ot().E)(e))return;const P=tt().default.state,L=Qo(P),F=function(e){const t=So(e,io,uo),o=null==t?void 0:t.mode;if(!o)return;return Xt[o]||"Plain Text"}(p),E=D&&F&&"inline"!==L&&!_?nn({codeLanguage:F,environment:e,transaction:i}):void 0;nt().oF(e,{pastedText:b,source:"editor_paste"});const V=We().wg(),O=We().KR(),U=t.clipboardData.getData(de().sE),N=Ko();if(w.length>0&&!x&&!M)i.logDebugMessage("paste: file/image detected -> onPasteFiles"),r({environment:e,files:w,transaction:i});else if(R)i.logDebugMessage("paste: editing code block contents with no Notion text selection -> pasteRawText"),rn(e,b,i);else if(E)i.logDebugMessage("paste: pasting code in existing empty text block with no selection or new code block after selection  -> pasteRawText"),rn(e,b,i);else if(N){if(i.logDebugMessage("paste: formulaInformation detected, attempting to paste as formula"),!a)return void rn(e,b,i);"multiSelection"in P&&Mt().f0({environment:e,multiSelection:P.multiSelection,transaction:i});const{start:t,getRecordModel:o,valueTypes:n,spaceId:r}=N,s=(0,C().K5)({formulasModule:a,getRecordModel:o,textValue:[[b]],featureGates:(0,Ce().i)(),valueTypes:n,spaceId:r});Mt().yr({environment:e,tokens:s,store:t.store,index:t.index,transaction:i})}else if("plaintext"===L)i.logDebugMessage("paste: plaintext paste behavior detected, pasting as inline html"),$o({environment:e,html:b,transaction:i,stripText:!0,stripSurroundingWhitespace:!0,disableEmbedMenu:o,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:l}),dt({environment:e,type:"plaintext",originalHtmlContentSize:v});else if(y){i.logDebugMessage("paste: multiTextSelectionData detected, attempting to paste as textselection");const t=function(e){const{environment:t,transaction:o,multiTextSelectionData:n,disableEmbedMenu:i,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a}=e,s=e.pasteBehavior||"inline",c=e.html||Co({markdown:e.text,markdownLinkifyIt:r});if("editing"===tt().default.state.mode)switch(s){case"inline":return!!c&&($o({environment:t,html:c,transaction:o,stripText:!1,stripSurroundingWhitespace:!0,disableEmbedMenu:i,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a}),!0);case"block":return wt({environment:t,clipboardData:n,transaction:o,preventLegacyTransclusions:(0,Ae().$J)()});default:(0,ie().HB)(s)}}({multiTextSelectionData:y,environment:e,html:S,text:b,transaction:i,disableEmbedMenu:o,pasteBehavior:L,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:l});t||(i.logDebugMessage("paste: could not paste as textSelection -> paste as blockSelection"),Oo(e,y.blockSelection,T,i))}else if(null!=h&&h.editing){i.logDebugMessage("paste: textSelectionData detected, pasting text selection");const t=(0,Zt().d)(),n=(null==T?void 0:T.id)!==(null==t?void 0:t.id);!function(e){const{environment:t,textSelectionData:o,transaction:n,disableEmbedMenu:i,removeDiscussions:r}=e,a=et().default.getCurrentRecordCache(),{editing:s,selection:c}=o;let{tokensInsideRange:l}=J().AI5(s,c.startIndex,c.endIndex);l=J().Uee(l,{removeSuggestionAnnotationsAndText:!1,removeSuggestionAnnotations:!0,removeDiscussions:r??!0});const d=(0,ye().Z)();if(d&&!(d.isInsideTemplate()||qo()||d.isInsideFactoryOrDuplicateBlocksAction())&&(l=(0,K().f$)(l,{currentUserId:t.currentUser.id,currentTimeZone:(0,A().P)()})),"body"===(0,Ve().X4)()){const e=J().Cc8(l);e&&(l=e)}const u="editing"===tt().default.state.mode&&tt().default.state.multiSelection;if(u){if(!(0,_e().k)(u)){const t=(0,De().H)(u);if(t){const n=J().Ffo(o.editing,o.selection.startIndex,o.selection.endIndex);if(1===n.length){const[o,i]=n[0],r=i&&J().VtW(i);if(r){const n=J().cQR(r);if([o,`http://${o}`,`https://${o}`].includes(n))return void Yo({environment:e.environment,text:n,transaction:e.transaction,editingSelection:t})}}}}const r=(0,Fe().T)(u.start.store),a=r?Ze().Uv.getMode(r):"default";if("suggest"===a){const e=pe().RR(t,n,u);pe().rY({environment:t,multiSelection:u,transaction:n,discussionStore:e}),l=J().Mwp({textValue:l,selection:{startIndex:0,endIndex:1/0},annotation:[J().Ifu.SuggestionInsertText,e.id]})}else"default"===a&&Mt().f0({environment:t,multiSelection:u,transaction:n});const s=tt().default.state;if("editing"===s.mode){const e=s.multiSelection;if(o.blockType&&0===c.startIndex){const i=(0,Fe().T)(e.start.store);i&&"page"!==o.blockType&&(0,Le().P4)(i)&&be().transformBlocks({environment:t,blocks:[i],blockType:o.blockType,transaction:n})}Fo({environment:t,store:e.end.store,tokens:l,index:e.end.index,transaction:n,disableEmbedMenu:"suggest"===a||i,multiTextSelection:u})}}else if(a){var p;const e=et().default.state.stores,o=Et().Wv({environment:t,type:f().xd.text,inMemoryRecordCache:a,transaction:n,spaceId:0!==e.length?e[e.length-1].pointer.spaceId:null===(p=(0,ye().Z)())||void 0===p?void 0:p.pointer.spaceId}),i=o.getTitleStore();i&&Mt().yr({environment:t,store:i,tokens:l,index:0,transaction:n}),Vo({environment:t,blocks:[o],transaction:n,replaceEmptyTextBlock:!1}),pt().vH(t,{from:"paste",type:f().xd.text,creating_block_id:o.id,parent_collection_id:o.getParentCollectionIdUpToTwoLevels()})}}({environment:e,textSelectionData:h,transaction:i,disableEmbedMenu:o,removeDiscussions:!u||("copy"===B||n)})}else if(I&&I.blocks.length>0&&"inline"!==L)i.logDebugMessage("paste: blockSelectionData detected, pasting block selection"),Oo(e,I,T,i);else if(V&&U){const{simpleTableStore:o,rowIndex:r,columnIndex:a}=V.getProps();let s=null==O?void 0:O.selection;s||(s=$e().nj({row:r,col:a}));const d=He().$O(o);s&&d&&(0,Nt().G)({clipboardActions:n,environment:e,simpleTableStore:o,selection:s,currentRows:o.getContentStores(),columnOrder:d,event:t,transaction:i,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:l})}else if(S)if(V&&O&&U){const{simpleTableStore:o,rowIndex:r,columnIndex:a}=V.getProps();let{selection:s}=O;s||(s=$e().nj({row:r,col:a}));const d=He().$O(o);s&&d&&(i.logDebugMessage("paste: pasting selection into simple table"),(0,Nt().G)({clipboardActions:n,environment:e,simpleTableStore:o,selection:s,currentRows:o.getContentStores(),columnOrder:d,event:t,transaction:i,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:l}))}else if((D||M)&&"inline"!==L)i.logDebugMessage("paste: pasting as html"),jo({environment:e,html:S,transaction:i,tinyMceMicrosoftWordPasteFilter:l}),dt({environment:e,type:"html",originalHtmlContentSize:v});else{i.logDebugMessage("paste: pasting as inline html");const t=Boolean(V);$o({environment:e,html:S,transaction:i,stripText:t,stripSurroundingWhitespace:t,disableEmbedMenu:o,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:l}),dt({environment:e,type:"inline_html",originalHtmlContentSize:v})}else i.logDebugMessage("paste: pasting as markdown"),Uo({environment:e,text:b,disableEmbedMenu:o,transaction:i,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:l}),dt({environment:e,type:"markdown",originalHtmlContentSize:v});Ke().A.setKeyboardMode(!0)}function nn(e){const{codeLanguage:t,environment:o,transaction:n}=e,i=tt().default.state,r="editing"===i.mode&&i.multiSelection,a=et().default.state.stores;if(!r&&0===a.length)return;let s,c,l;if(r?(s=r.start.store,c=r.end.store,l=(0,Fe().T)(c)):(s=a[0],c=a[a.length-1],l=c),!l)return;let d=l;if((0,Le().P4)(l))!function(e){const{blockStore:t,environment:o,transaction:n,codeLanguage:i}=e;be().transformBlocks({environment:o,blocks:[t],blockType:"code",transaction:n}),Dt().IA({blocks:[t],language:i,transaction:n})}({blockStore:l,environment:o,transaction:n,codeLanguage:t});else{const e=(0,Fe().T)(l);if(!e)return;const t=s.inMemoryRecordCache;if(!t)return;d=Et().Wv({environment:o,type:f().xd.code,inMemoryRecordCache:t,transaction:n,spaceId:e.pointer.spaceId}),Ft().WH({parentStore:e.getContentStore(),afterStore:c,insertStore:d,transaction:n})}Ee().clear(o);const u=(0,Fe().aI)(d);return u&&(0,jt().e)({store:u}),d}function rn(e,t,o){const n="editing"===tt().default.state.mode&&tt().default.state.multiSelection;if(n){const i=(0,Fe().T)(n.start.store);Mt().$D({environment:e,editorMode:i?Ze().Uv.getMode(i):"default",multiSelection:n,string:t,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:o})}}function an(e){const t=e.getNavigableBlockStore();if(t){const o=e.environment.RouterStore.state.route,n="page"===o.name&&o.collectionViewId?o.collectionViewId:void 0;return(0,Te().J8)({store:t,scrollToBlockId:t.id===e.id?void 0:e.id,fullyQualified:!0,pageVisitSource:m().y8.CopyLink,embedded:!1,collectionViewId:n})}}function sn(e){const{environment:t,blockStore:o,callback:n}=e;(0,ue().y)(),We().wr();const i=an(o);if(i){mn({environment:t,stringValue:i,copiedMessage:o.isPageBlock()||o.isFormBlock()?Yt.copiedLinkToClipboard:Yt.copiedBlockLinkToClipboard}).then(n)}}function cn(e){var t,o;const{environment:n,collectionStore:i,callback:r}=e;(0,ue().y)(),We().wr();const a=(0,w().C)({collectionId:i.id,spaceId:i.getSpaceId(),spaceDomain:null===(t=i.getSpaceStore())||void 0===t?void 0:t.getEditDomain(),parentCvbId:null===(o=i.getParentPointer())||void 0===o?void 0:o.id,domainBaseUrl:c().A.domainBaseUrl,pageVisitSource:m().y8.CopyLink});if(a){mn({environment:n,stringValue:a,copiedMessage:Yt.copiedLinkToClipboard}).then(r)}}function ln(e){const{environment:t,blockStore:o,callback:n}=e;(0,ue().y)(),We().wr();const i=an(o),r=function(e,t){var o;const n=an(t);if(!n)return;const i=e.currentUser.id,r=(0,y()._z)({blockId:t.id,intl:Be().A.getIntl(),getRecordValue:t.inMemoryRecordCache.makeGetRecordValueFn(i),userTimeZone:(0,A().P)()}),a=null===(o=t.getBlockIconStore())||void 0===o?void 0:o.getValue(),c=[(0,R().A)(a)?a:void 0,r].filter(ie().O9).join(" ");if(!c)return n;let l=`<a href="${n}"><span>${c}</span></a>`;return s().default.checkGate({gateName:"paste_links_as_mentions"})&&(l+=(0,xe().a0)({id:t.id,spaceId:t.getSpaceId()})),l}(t,o);if(i&&r){pn({environment:t,stringValue:i,htmlValue:r,copiedMessage:o.isPageBlock()?Yt.copiedPageLinkToClipboard:o.isFormBlock()?Yt.copiedFormLinkToClipboard:Yt.copiedBlockLinkToClipboard}).then(n)}}function dn(e){const{environment:t,blocks:o,callback:n}=e;(0,ue().y)(),We().wr();const i=o.map(an).filter(ie().O9);if(i.some(Boolean)){const e=i.length>1?Yt.copiedLinksToClipboard:Yt.copiedLinkToClipboard;mn({environment:t,stringValue:i.join("\n\n"),copiedMessage:e}).then(n)}}function un(e){const{environment:t,blocks:o,callback:n}=e,i=o[0];if(!i.isDefined())return;const r=i.getModel(),a=i.getProperties(),s=i.getFormat();let c;if(i.isType(f().xd.bookmark))c=J().q4_(a.link);else if((0,f().ie)(r.type))c=J().q4_(a.source);else if(i.isType(f().xd.externalObjectInstance)||i.isType(f().xd.externalObjectInstancePage))c=(null==s?void 0:s.original_url)||(null==s?void 0:s.uri);else if(i.isType(f().xd.collectionView)){var l;const e=null===(l=i.getCollectionStoreIfSingleSource())||void 0===l?void 0:l.getValue();var d;if(e&&(0,h().ek)(e))c=null===(d=e.format)||void 0===d?void 0:d.original_url}else{if(!i.isType(f().xd.alias))return;c=null==s?void 0:s.comment_alias_url}if(!c)return;if(I()._J(c))return void M().log({level:"error",from:"clipboardActions",type:"copyDirectLinkToContent",error:{message:"Attempted to copy a direct signed url for S3-housed content."}});if(c=re().q7(c),!c)return;(0,ue().y)(),We().wr();mn({environment:t,stringValue:c,copiedMessage:Yt.copiedLinkToClipboard}).then(n)}function pn(e){return fn(e)}function mn(e){return fn(e)}async function fn(e){const{environment:t,htmlValue:o,stringValue:n,copiedMessage:i,showCopyModal:r,copiedMessageValues:s}=e;function c(){Ot().IU({environment:t}),Je().A.setState({...Je().A.state,active:!0,stringValue:n})}if(r)c();else try{var l;if(t.device.isElectron&&null!==a().electronApi&&void 0!==a().electronApi&&null!==(l=a().electronApi.clipboard)&&void 0!==l&&l.write){const e={text:n};o&&(e.html=o),await a().electronApi.clipboard.write(e)}else if("undefined"==typeof ClipboardItem)await navigator.clipboard.writeText(n);else{const e={"text/plain":new Blob([n],{type:"text/plain"})};o&&(e["text/html"]=new Blob([o],{type:"text/html"}));const t=new ClipboardItem(e);await navigator.clipboard.write([t])}i&&Ut().D6({label:Be().A.formatMessage(i,s)})}catch{c()}}function gn(){document.queryCommandSupported("copy")&&document.execCommand("copy")}async function vn(e,t){let o;o="string"==typeof t?t:JSON.stringify(t),o&&await mn({environment:e,stringValue:o,copiedMessage:Yt.copiedToClipboard})}function bn(e){const{environment:t,textSelection:o,markdownSerializationOptions:n,markdownLinkifyIt:i}=e,r=(0,De().H)(o);if(r&&r.selection.startIndex!==r.selection.endIndex)return function(e){const{environment:t,singleStoreTextSelection:o,markdownSerializationOptions:n}=e,{store:i,selection:r}=o,a=t.currentUser.id,l=i.inMemoryRecordCache,d=Be().A.getIntl(),u=i.getValue(),p=J().Ffo(u,r.startIndex,r.endIndex),f=i.getRecordStoreUIRoot().getValue();if(!f)return;const g={id:f.id,table:$().ev,spaceId:f.space_id},b=l.makeGetRecordValueFn(a),k=t.idCreator.getSpaceIdCreatorSync(f.space_id);return L().ZR({textValue:p,exportArgs:{root:g,navigableBlockId:g.id,renderParentBlockId:void 0,blockId:g.id,userTimeZone:(0,A().P)(),intl:d,getRecordValue:b,getRecordModel:F().b4_.fromGetRecordValueFn(b),numberedListCache:{},bulletedListCache:{},getRecordsWithParent:()=>[],getExportedPathToFile:({toFileURI:e})=>e,getExportedRenderAsset:({toFileURI:e})=>e,getExportedPathToPage:({toPageId:e})=>(0,v().A)({pageId:e,pageValue:b({table:$().ev,id:e}),baseUrl:c().A.domainBaseUrl,pageVisitSource:m().y8.Export}),baseUrl:c().A.domainBaseUrl,publicDomainName:c().A.publicDomainName,transformAnnotation:null==n?void 0:n.transformAnnotation,transformBlockMapping:null==n?void 0:n.transformBlockMapping,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map,experimentService:s().default,collectionFeatureGates:(0,Ce().i)(),formulasModule:x(),spaceIdCreator:k}})}({environment:t,singleStoreTextSelection:r,markdownSerializationOptions:n});const a=Ao({environment:t,multiSelection:o,action:"copy"});if(!a)return;const{markdown:l}=(0,xe().Ij)({clipboardData:a,multiSelection:o,currentUserId:t.currentUser.id,isWindows:t.device.isWindows,markdownSerializationOptions:n,markdownLinkifyIt:i,formulasModule:x(),spaceIdCreator:t.idCreator.getSpaceIdCreatorSync(o.start.store.pointer.spaceId||"")});return l}function kn(e){const{environment:t,inMemoryRecordCache:o,text:n,transaction:i,markdownOptions:r,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:s,parentPointer:c,ignoreImages:l}=e,d=Co({markdown:n,markdownOptions:r,markdownLinkifyIt:a});if(!d)return;const u=document.createElement("div");u.innerHTML=Zo({html:d,tinyMceMicrosoftWordPasteFilter:s});const{currentUserStore:m,sidebarSpaceStore:f}=Ge().default.state;if(!m||!f)return;const g=m.getValue();if(!g)return;const v=((0,ye().Z)()??f).id,b=f.id,k=(0,we().Gx)({environment:t,spaceId:b}),S=t.idCreator.getSpaceShortIdCreator(b,k),{allOperations:y,rootContentIds:h}=B().aH({actor:(0,p().A7)(g),parent:c??{id:v,table:$().ev,spaceId:f.id},rootNode:u,deps:{importFileMap:{},window,intl:Be().A.getIntl(),randomID:oe().Ay,spaceIdCreator:S,randomShortID:ne().Ay,isPhoneNumber:O().W,emojiData:ke().A.state},options:{useCrdt:(0,me().D8)(f),ignoreBlockCount:!1,codePreviewFormat:o.isSyntheticAssistantData?"code":void 0,ignoreImages:l}});for(const p of y)if((0,Z().ph)(p)){const e=new(Ye().B)(t,p.pointer,{inMemoryRecordCache:o,userId:g.id});Gt().applyCrdtTextOperation({store:e,operation:p,invertedOperation:void 0,transaction:i})}else if((0,E().$Y)(p)){const e=new(Xe().pm)({environment:t,pointer:p.pointer,recordStoreOptions:{inMemoryRecordCache:o,userId:g.id}});Gt().applyOperation({store:e,operation:p,transaction:i})}else(0,ie().HB)(p);return h.map((e=>new(Ye().B)(t,{table:$().ev,id:e},{inMemoryRecordCache:o})))}function Sn(e){const{event:t,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:n}=e;if(!t.clipboardData)return;const{text:i,html:r,multiTextSelectionData:a,textSelectionData:s,blockSelectionData:c}=yo({clipboardData:t.clipboardData,tinyMceMicrosoftWordPasteFilter:n});if(a)return Ho({text:i,html:r,stripText:!1,stripSurroundingWhitespace:!0,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:n});if(s){const{editing:e,selection:t}=s;return J().Uee(J().AI5(e,t.startIndex,t.endIndex).tokensInsideRange,{removeSuggestionAnnotationsAndText:!1,removeSuggestionAnnotations:!0,removeDiscussions:!0})}return r||i?function(e){const{text:t,html:o,blockSelectionData:n,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:r}=e;if(n&&n.blocks.length>0||le(t))return J().x9d(t);return Ho({text:t,html:o,stripText:!1,stripSurroundingWhitespace:!0,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:r})}({text:i,html:r,blockSelectionData:c,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:n}):void 0}},541372:(e,t,o)=>{o.d(t,{Ce:()=>O,GV:()=>V,T_:()=>D,Tw:()=>B,VN:()=>_,Xw:()=>E,ei:()=>P,gi:()=>w,h8:()=>L});o(16280),o(18107),o(967357),o(898992),o(823215),o(581454),o(737550);var n=()=>o(564884),i=()=>o(726637),r=()=>o(584262),a=()=>o(700500),s=()=>o(921940),c=()=>o(696706),l=()=>o(179034),d=()=>o(201980),u=()=>o(496603),p=()=>o(534177),m=()=>o(18387),f=()=>o(989616),g=()=>o(695625),v=()=>o(430483),b=()=>o(84349),k=()=>o(77246),S=()=>o(148832),y=()=>o(292167),h=()=>o(44729),I=()=>o(384944),x=()=>o(391214),C=()=>o(778417),M=()=>o(319975),T=()=>o(231297);function w(e){const{environment:t,blocks:o,copiedStores:i,pageSource:r}=e,a=u().HV(o);if(!a)return;const s=g().T.getRectFromStore(a);s&&(b().A.setState({open:!0,type:"blocks",blocks:o,rect:s,copiedStores:i,pageSource:r}),(0,n().u)({environment:t,event:{eventName:"block_paste_menu_opened",eventProperties:{type:"blocks"}}}))}const A=250;function B(e){if(!v().zD.areAiActionsOnPasteEnabled())return!1;const{blocks:t,environment:o}=e;if(o.device.isMobileNative)return!1;if(!t.some((e=>e.isAiFollowupEligibleBlock())))return!1;if((0,f().R)(t,!0).length<A)return!1;const i=t.at(0);if(!i)return!1;const r=g().T.getRectFromStore(i);return!!r&&(b().A.setState({open:!0,type:"ai_actions",blocks:t,rect:r}),(0,n().u)({environment:o,event:{eventName:"block_paste_menu_opened",eventProperties:{type:"ai_actions"}}}),!0)}function D(e){const{environment:t,blocks:o,copiedLinks:i,rootStore:r}=e;if(o.length!==i.length)return!1;if(!o.every(R))return!1;if(i.some((e=>e.blockId===r.id)))return!1;const a=u().HV(o);if(!a)return!1;const s=g().T.getRectFromStore(a);return!!s&&(b().A.setState({open:!0,type:"links",blocks:o,rect:s,copiedLinks:i}),(0,n().u)({environment:t,event:{eventName:"block_paste_menu_opened",eventProperties:{type:"links"}}}),!0)}function _(e){b().A.state.open&&(0,n().u)({environment:e,event:{eventName:"block_paste_menu_closed",eventProperties:{type:b().A.state.type}}}),b().A.setState({open:!1})}function R(e){return!(e.isType(a().xd.copyIndicator)||e.isTransclusionType()||e.isInsideCollection())}function P(e){const{blocks:t,pageSource:o,wasContiguousSelection:n,action:i,rootStore:r,copiedStores:s}=e,l=k().Uv.getMode(t[0]);return"copy"===i&&n&&!(0,c().Z2)(o,r.pointer)&&(L(e)||V({currentSpaceId:r.getSpaceId(),...e}))&&t.every(R)&&!s.every((e=>e.getType()===a().xd.externalObjectInstance))&&"suggest"!==l}function L(e){const{blocks:t}=e;return 1===t.length}function F(e){const{transaction:t,blockUrl:o,spaceId:n,environment:i}=e,r=I().Wv({environment:i,type:a().xd.text,inMemoryRecordCache:i.defaultRecordCache.inMemoryRecordCache,transaction:t,spaceId:n}),s=(0,d().xV3)(o),c=[(0,d().Ey_)(s,[(0,d().Sez)(s)],{skipSanitization:!0})];return M().R9({environment:i,store:r.getBlockTitleStore(),value:c,transaction:t}),r}async function E(e){const{environment:t,blocks:o,source:n}=e,a=u().$1(o);if(!a)return;const c=a.getParentBlockStore();if(!c)return;const d=a.getContentStore();let m;await T().createAndCommitAsync({environment:t,userAction:"blockPasteMenuActions.acceptLinkToPage",waitForServerCommit:!0,perform:async e=>{if("blocks"===n.type){const{copiedStores:o,pageSource:u}=n,p=a,f=o[0];if(!p||!f)return;const g=S().B.createChildStore(d,{table:l().ev,id:f.id});if(g.isNavigableBlock())await g.load(),m=[y().s({environment:t,parentBlockStore:c,targetStore:g,transaction:e})];else{const o=(0,s().A)({pageId:u.id,scrollToBlockId:g.id,baseUrl:i().A.domainBaseUrl,pageVisitSource:r().y8.LinkInPage});m=[F({blockUrl:o,spaceId:a.getSpaceId(),environment:t,transaction:e})]}}else if("links"===n.type){const{copiedLinks:p}=n;if(p.length!==o.length)return;m=(0,u().oE)(await Promise.all(p.map((async o=>{const n=o.scrollToBlockId||o.peekViewBlockId||o.blockId;if(n){const u=S().B.createChildStore(d,{table:l().ev,id:n});if(await u.load(),u.isNavigableBlock())return y().s({environment:t,parentBlockStore:c,targetStore:u,transaction:e});{const n=o.peekViewBlockId||o.blockId;if(n){const o=S().B.createChildStore(d,{table:l().ev,id:n});await o.load();return F({blockUrl:(0,s().A)({pageId:n,pageModel:o.getModel(),scrollToBlockId:u.id,baseUrl:i().A.domainBaseUrl,pageVisitSource:r().y8.LinkInPage}),spaceId:a.getSpaceId(),environment:t,transaction:e})}}}}))))}else(0,p().HB)(n);const f=x().LE({environment:t,blocksToInsert:m,target:o,replaceEmptyTextBlock:!0,transaction:e});x().ZL({environment:t,blocks:o,transaction:e}),C().td({environment:t,stores:f}),_(t)}})}function V(e){const{currentSpaceId:t,blocks:o,copiedStores:n}=e;return o.length>0&&!n.some((e=>e.isInsideCollection()))&&n.every((e=>e.canEdit()))&&n.every((e=>e.getSpaceId()===t))}async function O(e){const{environment:t,blocks:o,copiedBlockIds:n,removeBlocks:i}=e,r=await Promise.all(n.map((async e=>{const t=S().B.createChildStore(o[0],{table:l().ev,id:e});await t.load();const n=t.getParentBlockStore();if(!n)throw new Error("Block has no parent.");await n.load();const i=n.getContentStore();return{store:S().B.createChildStore(i,{table:l().ev,id:e}),parentStore:n,parentContentStore:i}}))),s=r[0];if(!s)return;const c=(0,m().Z)();if(!c)return;const{serverCommitResult:d}=T().createAndCommit({userAction:"blockPasteMenuActions.acceptCreateTransclusion",environment:t,canUndo:!0,perform:e=>{let n;if(s.store.getType()===a().xd.transclusionContainer)n=s.store;else if(s.store.getType()===a().xd.transclusionReference){const e=s.store.getTransclusionReferenceTargetStore();if(!e)throw new Error("Could not find transclusion reference target");n=e}else if(s.parentStore.getType()===a().xd.transclusionContainer)n=s.parentStore;else{n=I().Wv({environment:t,type:a().xd.transclusionContainer,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:e,spaceId:s.store.pointer.spaceId});const o=n.getContentStore();h().Br({parentStore:s.parentContentStore,oldChildStore:s.store,newChildStore:n,transaction:e});for(const{store:t}of r)h().NI({parentStore:o,childStore:t,transaction:e})}const l=I().Wv({environment:t,type:a().xd.transclusionReference,format:{transclusion_reference_pointer:n.pointer},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:e,spaceId:0!==o.length?o[o.length-1].pointer.spaceId:c.pointer.spaceId}),d=x().LE({environment:t,blocksToInsert:[l],target:o,transaction:e,replaceEmptyTextBlock:!0});C().td({environment:t,stores:d}),i&&x().ZL({environment:t,blocks:o,transaction:e}),_(t)}});await d}},560595:(e,t,o)=>{o.d(t,{f:()=>a});var n=()=>o(496603),i=()=>o(693202),r=()=>o(486674);function a(){const e=(0,r().a)(),t=i().default.state;if("editing"!==t.mode)return!1;const o=t.multiSelection.start.store;return Boolean(e&&e.id===o.id&&(e.getBlockTitleStore()===o||n().n4(e.getBlockTitleStore().path,o.path)))}},673898:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().Store{getInitialState(){return{active:!1,stringValue:""}}}const i=new n},754199:(e,t,o)=>{function n(e){return/^(\+\d{1,2}[\s.-])?\(?\d{3}\)?[\s.-]\d{3}[\s.-]\d{4}$/.test(e)}function i(e){return/^[0-9 .()\-\+]{7,}$/.test(e)}o.d(t,{W:()=>n,e:()=>i})},766854:(e,t,o)=>{o.d(t,{H:()=>h,Q:()=>y});o(898992),o(672577);var n=()=>o(242422),i=()=>o(929219),r=()=>o(700500),a=()=>o(179034),s=()=>o(201980),c=()=>o(557281),l=()=>o(384944),d=()=>o(381678),u=()=>o(476492),p=()=>o(646736),m=()=>o(406792),f=()=>o(765957),g=()=>o(148832),v=()=>o(622811),b=()=>o(491848),k=()=>o(482871);function S(e,t,o){const i=(0,d()._)(e),r=null==i?void 0:i.id;if(!r||!o)return;if(!n().default.checkGate({gateName:"full_access_for_created_collection_pages"}))return;if(t.canAdmin())return;const a=t.getSpaceStore();return a&&(0,p().dp)(a,r).isMember()?[{role:"editor",type:"user_permission",user_id:r}]:void 0}function y(e){const{collectionContextStore:t,transaction:o}=e;return(0,b().w)({collectionContextStore:t,transaction:o}),h(e)}function h(e){var t,o,n;const{environment:d,collectionContextStore:p,groupsPointer:b,insertAtIndex:y,shouldCoerce:h,templateStore:I,transaction:x,from:C,tracker:M,inMemoryRecordCache:T,isKeyboard:w,title:A}=e,B=m().default.DO_NOT_USE_markLegacy("collections.add_item_lag");m().default.DO_NOT_USE_measureAfterNextFlushLegacy(B,{environment:d,getData:()=>({...u().kz(p),from:C.createBlock})});const D="collectionTypedView"===p.contextType,_=p.databaseType,R=p.collectionStoresStore.state,P=R.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly()))||R[0],L=null===(t=f().default.state.sidebarSpaceStore)||void 0===t?void 0:t.id,F=f().default.state.currentUserSettingsStore,E=D&&_&&L&&F&&[...F.getAllPreferredCollections(L),...F.getPreferredCollectionsOfType(L,_)]||[];let V;const O=b[0];if("group_header"===C.createBlock&&"location"===O.value.type){const e=O.value.value;if(e){V=R.find((t=>t.id===e.id&&(t.canEdit()||t.canEditCollection()||t.canEditContentOnly())))}}else V=function(e,t){for(const o of e){const e=t.find((e=>e.id===o&&(e.canEdit()||e.canEditCollection()||e.canEditContentOnly())));if(e)return e}}(E,R);const U=V??P,N=null==U?void 0:U.getSpaceId(),W=p.collectionViewStore(),H=p.getViewType(),$=l().Wv({environment:d,type:r().xd.page,inMemoryRecordCache:T,transaction:x,spaceId:N,tracker:M,permissions:S(d,U,N),properties:{title:(0,s().x9d)(A)}});if(!U||!W||!H)return{coercionSucceeded:!0,newStore:$};const j=null===(o=p.groupsStore.getGroupState(b))||void 0===o?void 0:o.groupUiParentStore;if(!j)return{coercionSucceeded:!0,newStore:$};const z=g().B.createChildStore(j,{table:a().ev,id:$.id});I&&i().A.state.online&&c().n5({title:"template",environment:d,store:$,templateStore:I,isKeyboard:w??!1,isCreateIn:!1,transaction:x,from:C.initCollection??"collection_group_actions"});const G=(0,v().j)({environment:d,store:$,collectionStore:U,collectionContextStore:p,groupsPointer:b,shouldCoerce:h,transaction:x}),J=(null===(n=p.groupsStore.getGroupState(b))||void 0===n||null===(n=n.reducerResultStore.state)||void 0===n?void 0:n.blockIds)||[],Z=void 0!==y?y:J.length;if(p.permissionScopesStore.state.canEditContent||D){const e=[...J.slice(0,Z),z.id,...J.slice(Z)];(0,k().z)({resultIds:e,collectionViewStore:W,collectionContextStore:p,transaction:x})}return{coercionSucceeded:G,newStore:z}}},813743:(e,t,o)=>{o.d(t,{O8:()=>F,Yf:()=>P,fS:()=>L});var n=()=>o(726637),i=()=>o(221844),r=()=>o(496506),a=()=>o(700500),s=()=>o(792071),c=()=>o(651784),l=()=>o(179034),d=()=>o(197959),u=()=>o(161479),p=()=>o(201980),m=()=>o(534177),f=()=>o(384944),g=()=>o(778417),v=()=>o(97270),b=()=>o(299545),k=()=>o(906537),S=()=>o(110955),y=()=>o(487494),h=()=>o(176106),I=()=>o(525112),x=()=>o(375447),C=()=>o(148832),M=()=>o(878710),T=()=>o(292167),w=()=>o(437219),A=()=>o(722101),B=()=>o(666144),D=()=>o(319975),_=()=>o(72159),R=()=>o(231297);function P(e){const{environment:t,textStore:o,blockStore:a,url:s,oldTextValue:p,urlSelection:m}=e;if(S().Ay.state.open||v().A.state.open||x().Ay.state.open||h().A.state.open)return!1;const f=k().get();if(!f)return!1;const g=k().getRect(f);if(!g)return!1;const C=(0,c().parseRoute)({url:s,baseUrl:n().A.domainBaseUrl,publicDomainName:n().A.publicDomainName,isMobile:Boolean(n().A.isMobile),protocol:n().A.protocol,currentUrl:window.location.href});if("page"===C.name&&Boolean(C.discussionId)&&C.discussionId){const e=C.discussionId,n=C.blockId;if(!n)return!1;const c=a.getParentBlockStore();if(!c)return!1;const f=(0,M().v3)(c,{table:l().ev,id:n,spaceId:(0,u().e)(c.pointer.spaceId)}),v=(0,M().v3)(f,{table:d().$Y,id:e,spaceId:(0,u().e)(a.pointer.spaceId)});if("none"===v.getRole())return!1;const k=new(r().ComputedStore)((()=>b().wc(v)[0]),{debugName:"firstCommentStore"}),S=new(i().A)({name:"internalUnfurlingMenuActions.activate",isTemporaryData:!0});t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(S);const h=a.clone(S),x=o.clone(S),T=c.clone(S);return I().A.setState({args:{commentStore:k},stores:{blockStore:a,textStore:o,parentStore:c},temporaryStores:{blockStore:h,textStore:x,parentStore:T},temporaryRecordCache:S,focusedIndex:y().A.Preview,selectionRect:g,oldTextValue:p,open:!0,url:s,urlSelection:m}),w().wQ(t,{url:s}),!0}return!1}function L(e){const{actionType:t,environment:o,commentStore:n,useTempStores:i}=e,r=I().A.state;if(!r.open)return;const{oldTextValue:a}=r,c=i?r.temporaryStores:r.stores,{textStore:l,blockStore:d,parentStore:f}=c,v=o.currentUser.id;if(v){if(i){r.temporaryRecordCache.clearCache();for(const e in r.temporaryStores){const t=r.temporaryStores[e],n={userId:v,pointer:t.pointer},i=o.defaultRecordCache.inMemoryRecordCache.getRecord(n);i?B().PC({environment:o,inMemoryRecordCache:r.temporaryRecordCache,pointer:t.pointer,model:s().Bj6.fromValue(t.pointer.table,i.value),role:i.role,updatePaths:[[]],userId:v,force:!0,debugSource:"setUnfurlType"}):B().oX({environment:o,inMemoryRecordCache:r.temporaryRecordCache,persistedRecordCache:void 0,pointer:t.pointer,userId:v})}}else o.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(r.temporaryRecordCache);switch(t){case y().A.Link:g().hc({environment:o,store:r.stores.blockStore}),(0,_().t)({store:r.stores.textStore,selection:{startIndex:r.urlSelection.endIndex,endIndex:r.urlSelection.endIndex}}),I().A.setState({...r,focusedIndex:y().A.Link});break;case y().A.Mention:if(!n)return;const e=(0,u().e)(l.pointer.spaceId);if(!e)return;const i=n.id;R().createAndCommit({environment:o,userAction:"internalUnfurlingMenuActions.mention",canUndo:!0,perform:t=>{D().R9({environment:o,store:l,value:a,transaction:t}),D().Gf({environment:o,editorMode:"default",store:l,selection:{startIndex:r.urlSelection.startIndex,endIndex:r.urlSelection.startIndex},annotation:p().hiQ(i,e),transaction:t,analyticsFrom:"block"})}}),I().A.setState({...r,focusedIndex:y().A.Mention});break;case y().A.Preview:if(!n)return;R().createAndCommit({environment:o,userAction:"internalUnfurlingMenuActions.preview",canUndo:!0,perform:e=>{D().R9({environment:o,store:l,value:a,transaction:e});const t=b().eK(n);if(!t)return;if(!b().No(t)||!f||!t.getParentId())return;const i=T().s({environment:o,parentBlockStore:f,targetStore:n,transaction:e});if(A().WH({parentStore:f.getContentStore(),insertStore:i,afterStore:d,transaction:e}),0===p().q4_(r.oldTextValue).trim().length){const t=C().B.createChildStore(f.getContentStore(),r.stores.blockStore.pointer);A().TF({parentStore:f.getContentStore(),childToRemoveStore:t,transaction:e})}}}),I().A.setState({...r,focusedIndex:y().A.Preview});break;default:throw(0,m().HB)(t)}i||I().A.setState({open:!1})}}function F(e){var t,o;const{blockStore:n,transaction:i}=e,r=n.getType(),s=n.getFormat(),c=n.getSpaceId();if(!n.isDefined()||r!==a().xd.alias||null==s||null===(t=s.alias_pointer)||void 0===t||!t.id)return;const l=[p().wmz(p().hiQ(null==s||null===(o=s.alias_pointer)||void 0===o?void 0:o.id,c))];f().zv({store:n,data:{type:a().xd.text},transaction:i}),f().zv({store:n.getFormatStore(),data:{alias_pointer:null},transaction:i}),D().R9({environment:n.environment,store:n.getBlockTitleStore(),value:l,transaction:i})}},904193:(e,t,o)=>{o.d(t,{G:()=>v});o(944114),o(898992),o(823215),o(354520),o(581454),o(737550);var n=()=>o(713998),i=()=>o(258035),r=()=>o(522419),a=()=>o(201980),s=()=>o(534177),c=()=>o(766854),l=()=>o(450510),d=()=>o(919878),u=()=>o(857048),p=()=>o(404715),m=()=>o(384944),f=()=>o(319975),g=()=>o(706280);function v(e){const{clipboardActions:t,environment:o,selection:n,currentRows:r,event:s,transaction:c,markdownLinkifyIt:m,tinyMceMicrosoftWordPasteFilter:f}=e;if(!s.clipboardData)return;let v;const h=s.clipboardData.getData(l().sE),I=s.clipboardData.getData("text/html"),x=s.clipboardData.getData("text/plain");if(h)v=JSON.parse(h);else if(I){const e=document.createElement("div");e.innerHTML=I;const t=e.querySelector("table");if(t){const e=t.querySelectorAll("tr");v=[];for(const t of Array.from(e)){const e=[],o=t.querySelectorAll("td, th");for(const t of Array.from(o)){const o=a().x9d(t.textContent||"");e.push([o,void 0])}v.push(e)}}}if(!v&&x){const e=(0,i().CO)(x);if(e.length>1&&e.every((t=>t.length===e[0].length))&&e[0].length>1){v=[];for(const t of e){const e=[];for(const o of t){const t=a().x9d(o);e.push([t,void 0])}v.push(e)}}}if(!v){const e=t.getInlineTextValueFromClipboardData({event:s,markdownLinkifyIt:m,tinyMceMicrosoftWordPasteFilter:f});e&&(v=[[[e,void 0]]])}if(v){const t=l().hn(n),{trimmedSelection:i,actualWidth:a,actualHeight:s}=function(e){if(!e.length)return{trimmedSelection:e,actualWidth:0,actualHeight:0};let t=e.length,o=e[0].length;for(;t>0;){if(e[t-1].some((e=>!y(e))))break;t--}if(0===t)return{trimmedSelection:[],actualWidth:0,actualHeight:0};for(;o>0;){let n=!1;for(let i=0;i<t;i++)if(!y(e[i][o-1])){n=!0;break}if(n)break;o--}const n=e.slice(0,t).map((e=>e.slice(0,o)));return{trimmedSelection:n,actualWidth:o,actualHeight:t}}(v),m=a,f=s;if(0===m||0===f)return;let h=Math.floor((t.maxCol-t.minCol+1)/m);0===h&&(h=1);let I,x=Math.floor((t.maxRow-t.minRow+1)/f);if(0===x&&(x=1),"simpleTableStore"in e){const o=t.minCol+m*h,{simpleTableStore:n}=e;I=e.columnOrder;const i=I.length;if(o>i){const e=o-i;d().eI({count:e,simpleTableStore:n,transaction:c}),I=(0,p().$O)(n)||[]}}for(let o=0;o<x;o++)for(let n=0;n<h;n++){const a=t.minCol+n*m,s=t.minRow+o*f;for(let t=0;t<f;t++){let o=r[s+t];if(!o){const t="selectionKey"in e?b(e):d().D(e);t&&(e.currentRows.push(t),o=t)}for(let n=0;n<m;n++){var C;const r=null===(C=i[t])||void 0===C?void 0:C[n];if(!r)continue;const s=a+n;"currentPropertyFormats"in e?k({rowStore:o,x:s,serializedValue:r,currentPropertyFormats:e.currentPropertyFormats,transaction:c,schema:e.schema}):S({rowStore:o,x:s,serializedValue:r,columnOrder:I??e.columnOrder,transaction:c})}}}const M={start:{col:t.minCol,row:t.minRow},end:{col:t.minCol+m*h-1,row:t.minRow+f*x-1}};"selectionKey"in e?(0,g().t)({environment:o,selectionKey:e.selectionKey,selection:M}):(0,u().ep)({environment:o,start:M.start,end:M.end,simpleTableStore:e.simpleTableStore})}}function b(e){const{environment:t,currentRows:o,collectionContextStore:n,selectionKey:i,transaction:r}=e,{groupFormat:a}=i,s=(0,c().Q)({environment:t,collectionContextStore:n,groupsPointer:a?[a]:[],insertAtIndex:o.length,shouldCoerce:!0,transaction:r,from:{createBlock:"table_paste_selection"},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache});return null==s?void 0:s.newStore}function k(e){var t;const{rowStore:o,x:i,serializedValue:a,currentPropertyFormats:c,transaction:l,schema:d}=e,u=c[i];if(!u)return;if("verification"===(null===(t=d[u.property])||void 0===t?void 0:t.type))return;const[p,g]=a,v=o.getPropertyStore(u.property);if(f().R9({environment:v.environment,store:v,value:p,transaction:l}),g){var b;const e=p?n().pJ(p):void 0,t=null==e||null===(b=e.map((e=>{var t;return null===(t=(0,r().oN)({urlOrAlias:e.url}))||void 0===t?void 0:t.fileId})))||void 0===b?void 0:b.filter(s().O9);t&&t.length>0&&m().Bn({store:o,source:g,fileIds:t,transaction:l})}}function S(e){const{rowStore:t,x:o,serializedValue:n,transaction:i,columnOrder:r}=e,s=r[o];if(!s)return;const[c,l]=n,d=t.getPropertyStore(s);f().R9({environment:d.environment,store:d,value:a().Uee(c,{removeSuggestionAnnotationsAndText:!1,removeSuggestionAnnotations:!0,removeDiscussions:!0}),transaction:i})}function y(e){if(!e)return!0;const[t]=e;if(!t||!t.length)return!0;const o=a().q4_(t);return!o||""===o.trim()}}}]);