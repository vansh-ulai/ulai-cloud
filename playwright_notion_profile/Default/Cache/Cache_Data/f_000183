"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[71204,87487],{36951:(e,t,o)=>{o.d(t,{Iu:()=>O,NC:()=>D,VK:()=>R,YM:()=>N,createAndNavigateToInferenceTranscriptWithConfig:()=>P,eS:()=>V,xh:()=>I});o(16280),o(898992),o(354520),o(737550);var n=()=>o(370657),r=()=>o(386164),i=()=>o(651784),a=()=>o(427704),c=()=>o(155792),l=()=>o(201980),s=()=>o(530199),u=()=>o(532659),d=()=>o(498212),p=()=>o(534177),m=()=>o(939768),f=()=>o(559506),y=()=>o(24962),v=()=>o(450294),h=()=>o(354785),g=()=>o(577142),_=()=>o(260488),S=()=>o(890754),T=()=>o(594794),b=()=>o(765957),C=()=>o(122058),M=()=>o(177097),w=()=>o(844317),k=()=>o(46986),A=()=>o(555102),x=()=>o(166442),E=()=>o(107527);async function I(e){var t;const{environment:o,clientStore:i,message:a,configs:s}=e,p=b().default.state.sidebarSpaceStore;if(!p)throw new Error("No current space store");const m=null===(t=o.currentUser)||void 0===t?void 0:t.id;if(!m)throw new Error("No current user");if((0,l().q4_)(a).trim().length<6)return;const y=s.filter((e=>n()._z.includes(e.type))),v=await f().callStreamApi({eventName:"runInferenceTranscript",environment:o,data:{transcript:[{id:(0,T().Z1)({environment:o,table:c().mS,spaceId:p.id}),type:"config",value:{type:"route-inference-transcript",configs:y}},{id:(0,T().Z1)({environment:o,table:c().mS,spaceId:p.id}),type:"user",value:a,userId:m}],traceId:(0,d().Ay)(),spaceId:p.id,generateTitle:!1},headers:(0,r().WS)({spaceId:p.id})});if("failed"===v.type)throw v.error;if(u().hS.is(v.data))for await(const n of v.data)if("config"===n.type)i.state.userSelectedConfig||i.setState({...i.state,configForNewTranscripts:n.value});else if("error"===n.type)throw n.message}function R(e){var t;const{environment:o,oldThreadStore:n,newThreadStore:r,openUsingQuickSearchHandler:i,openInNewTab:a,createdSource:c,resetLocalThreadStore:l,isAgent:s}=e,u=(null==r?void 0:r.id)||(s?S().NEW_CHAT_THREAD_ID:void 0),d=null==r?void 0:r.getConfig();if("search"===(null==d?void 0:d.type)&&(0,C().By)({sessionId:void 0,searchSessionId:d.searchSessionId,threadId:u,environment:o,createdSource:c}),u&&"researcher"===(null==d?void 0:d.type)){((null==r?void 0:r.getTranscript())||[]).some((e=>"researcher-report"===e.type))&&h().MU({environment:o,researchModeThreadId:u,source:"chat_history"})}const p=o.device.isElectron,m=D({environment:o,threadId:u,spaceId:null===(t=b().default.state)||void 0===t||null===(t=t.sidebarSpaceStore)||void 0===t?void 0:t.id,config:null==n?void 0:n.getConfig()});if(p&&(null==l||l()),!i||!p)return a&&p?((0,y().B)({makeTabActive:!0,url:m,position:"end",openInNew:"tab",environment:o}),void _().st({environment:o,reset:!1})):void(0,g().navigate)({environment:o,url:m,...a?{openInNew:"tab",makeTabActive:!1}:{}});(0,v().N)(m)}function O(e){const{environment:t,query:o,clientStore:n,config:r,additionalSteps:i=[],openInNewTab:a,openUsingQuickSearchHandler:c,surface:l,suggestedPrompt:s}=e,u=A().bX.state;if(!u)throw new Error("No inference context");const{spaceStore:d,userStore:p}=u;(0,E().Wq)({clientStore:n,environment:t});const m=r.type;if(a&&"search"===m)return void function(e){var t;const{environment:o,config:n,query:r,openUsingQuickSearchHandler:i}=e,a=o.device.isElectron,c=!0,l=D({environment:o,threadId:void 0,spaceId:null===(t=b().default.state)||void 0===t||null===(t=t.sidebarSpaceStore)||void 0===t?void 0:t.id,config:n,query:r,forceRouteToChat:c});if(i&&a)return void(0,v().N)(l);if(a)return(0,y().B)({makeTabActive:!0,url:l,position:"end",openInNew:"tab",environment:o}),void _().st({environment:o,reset:!1});(0,g().navigate)({environment:o,url:l,openInNew:"tab",makeTabActive:!1})}({environment:t,config:r,query:o,openUsingQuickSearchHandler:c});const f=(0,A().Kf)({environment:t,spaceStore:d,userStore:p,value:o}),h=(0,k().re)();if("workflow"!==r.type||h){const e=(0,A().Xd)({environment:t,config:r,inferenceContext:u,addSteps:[...i,f],surface:l}),o=(0,M().addTranscriptToNewThreadOnClientAndRun)({environment:t,spaceStore:d,clientStore:n,userStore:p,transcript:e,analyticsArgs:{suggestedPrompt:s}});return R({environment:t,oldThreadStore:void 0,newThreadStore:o,openInNewTab:a,openUsingQuickSearchHandler:c}),o}(0,M().createEmptyWorkflowContainerAndBuild)({environment:t,parentStore:d,userStep:f})}function N(e){const{spaceId:t,searchScopes:o}=e;if((0,k().re)()){var n;const e=t?(null===(n=x().UserChatPreferenceLocalStorageStore.getState())||void 0===n?void 0:n[t])??{}:{},{webEnabled:r,model:i}=e;return(0,w().n)({searchScopes:o,...void 0!==r&&{useWebSearch:r},model:i})}return{type:"search",scopeForNextSearch:{type:"everything"}}}function D(e){const{environment:t,threadId:o,spaceId:n,config:r,query:c,forceRouteToChat:l}=e,u=t.device.isElectron,p={};o&&(p[s().P5]=(0,d().Xw)(o)),u&&n&&(p.spaceId=n),c&&(p[s().ah]=encodeURIComponent(JSON.stringify(c)));const f=o&&o!==S().NEW_CHAT_THREAD_ID;if(!f){let e=N({spaceId:n});r&&(0,i().bD)(r.type)&&(e=r),p[s().q8]=encodeURIComponent(JSON.stringify(e))}return f||l?(0,m().Gm)({url:a().JZ.chat,query:p}):(0,m().Gm)({url:a().JZ.ai,query:p})}function P(e){const{environment:t,config:o,query:n,surface:r="search_modal"}=e,i=A().bX.state;if(!i)throw new Error("No inference context");const{spaceStore:a,userStore:c}=i,l=(0,A().Kf)({environment:t,spaceStore:a,userStore:c,value:n}),s=(0,A().Xd)({environment:t,inferenceContext:i,config:o,addSteps:[l],surface:r});R({environment:t,newThreadStore:(0,M().addTranscriptToNewThreadOnClientAndRun)({environment:t,spaceStore:a,clientStore:x().defaultClientAIChatStore,userStore:c,transcript:s}),oldThreadStore:void 0})}const U=["workflow","researcher","markdown-chat"];function V(e){const{config:t,agentEnabled:o}=e;return!t||(!o||(n=t.type,(0,p().Xk)(U,n)));var n}},124749:(e,t,o)=>{o.d(t,{$:()=>i});var n=()=>o(56366);const r=new(o(496506).ComputedStore)((()=>o(765957).default.state.currentUserStore),{debugName:"AppStoreCurrentUserStore"});function i(){return(0,n().O$)(r)}},175213:(e,t,o)=>{o.d(t,{G:()=>i});var n=()=>o(314529),r=()=>o(242422);function i(e,t){(0,n().DO_NOT_USE_trackLegacy)(e,"delete_property",t),r().default.logEvent("delete_property")}},241319:(e,t,o)=>{o.d(t,{y:()=>i});o(898992),o(672577);var n=()=>o(534177),r=()=>o(239381);function i(e){var t;const{actionModels:o,id:i}=e,a=(0,r().y5)(i),c="action"===a.source?o.find((e=>e.id===a.action_id)):void 0,l=(0,n().O9)(c)&&c.isType("create_page")?null===(t=c.getConfig())||void 0===t?void 0:t.collection:void 0;return{automationValueInfo:a,collectionPointer:l,actionModel:c}}},275598:(e,t,o)=>{o.d(t,{N:()=>i});var n=o(296540),r=()=>o(401497);function i(e,t){const o=(0,r().IS)((e=>({theme:{backgroundColor:e.background.primary}})),[]);(0,n.useLayoutEffect)((()=>{if(e)return"open"!==t&&"opening"!==t||function(e){document.body.style.overflow="visible",e&&(document.body.style.backgroundColor=e);const t=document.getElementById("notion-app");t&&(t.style.overflow="visible",t.style.overscrollBehavior="contain")}(o.theme.backgroundColor),()=>{!function(){document.body.style.overflow="",document.body.style.backgroundColor="";const e=document.getElementById("notion-app");e&&(e.style.overflow="",e.style.overscrollBehavior="")}()}}),[t,o.theme.backgroundColor,e])}},299177:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().Store{getInitialState(){return{}}}const r=new n;o(852832).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",r);const i=r},350605:(e,t,o)=>{o.d(t,{u:()=>A});var n=o(296540),r=()=>o(484714),i=()=>o(852507),a=()=>o(56366),c=()=>o(401497),l=()=>o(699143),s=()=>o(98126),u=()=>o(534177),d=()=>o(944584),p=()=>o(277942),m=()=>o(36951),f=()=>o(791256),y=()=>o(353755),v=()=>o(166442),h=()=>o(631611),g=()=>o(581495),_=()=>o(828634),S=()=>o(369955),T=()=>o(765957),b=()=>o(207214),C=()=>o(118078),M=()=>o(965454),w=()=>o(590027),k=o(474848);function A(e){const{chatSidebarRouteData:t,chatSidebarMode:o,panelSize:A,onDismiss:x,onEsc:E,fromSurface:I="corner",aiChatFeature:R}=e,O=(0,r().v3)(),N=(0,S().L)(),D=(0,a().O$)(T().AppStoreMainEditorCurrentBlockStore),P=(0,a().K8)((()=>null!=D&&D.isPersonalHomePage()?"home":"page"),[D]),U=(0,c().IS)((e=>{const t="full"===o||"sidebar"===o;return{content:{position:"absolute",bottom:0,insetInlineStart:0,insetInlineEnd:0,top:t?0:void 0},layout:{...t?{flex:1}:{minHeight:A.height.min,maxHeight:A.height.max}}}}),[A.height.min,A.height.max,o]);(0,i().w)((()=>{d().trackAiOpened({environment:O,agentEnabled:!0,surface:I,cornerSurface:P})}));const{state:V,threadStore:F,transcript:B}=(0,y().j)({clientStore:v().defaultClientAIChatStore,chatSidebarState:t,spaceStore:N}),H=(0,b().L)(O),W=(0,M().AD)(),G=(0,a().K8)((()=>(0,f().Ns)(F)??(0,m().YM)({spaceId:null==N?void 0:N.id})),[F,null==N?void 0:N.id]),q=(0,n.useCallback)((e=>{const t=T().default.state.mainEditorCurrentBlockStore||H;t&&(W.reset(),(0,C().showChatSidebar)({environment:O,store:t,chatSidebarRouteData:e?{isOpen:!0,threadId:e.id}:{isOpen:!0,isNewThread:!0}}))}),[O,H,W]),z=(0,n.useRef)(null),L=(0,n.useCallback)((e=>{z.current&&w().MU.setState({...w().MU.state,naturalPanelContentSize:e})}),[]);let j;switch((0,_().tK)(z,L),o){case"sidebar":j=R||"agent";break;case"popup":j=R||"agent_popup";break;case"full":j=R||"agent_mobile";break;default:if(R){j=R;break}(0,u().HB)(o)}return(0,k.jsx)(g().eh.Provider,{value:x,children:(0,k.jsx)(h().hP,{surface:h().wy.inferenceTranscriptChatView,children:(0,k.jsx)("div",{ref:z,style:U.content,children:(0,k.jsx)(l().Y1,{direction:"vertical",width:"content"===A.width.resizeMode?"hug":A.width.value,height:"content"===A.height.resizeMode?"hug":A.height.value,style:U.layout,children:N?(0,k.jsx)(p().NV,{aiChatFeature:j,clientStore:v().defaultClientAIChatStore,config:G,hideAgentName:!0,onEsc:E,onThreadChange:q,parentStore:N,threadStore:F,threadStoreState:V,transcript:B||[]}):(0,k.jsx)(l().Y1,{width:"fill",height:"fill",align:"center",children:(0,k.jsx)(s().k,{})})})})})})}},353755:(e,t,o)=>{o.d(t,{j:()=>p});var n=o(296540),r=()=>o(484714),i=()=>o(56366),a=()=>o(791256),c=()=>o(965454),l=()=>o(890754),s=()=>o(124749),u=()=>o(207214),d=()=>o(36951);function p({clientStore:e,chatSidebarState:t,spaceStore:o}){const{threadStore:p,isNewThread:m}=function({clientStore:e,chatSidebarState:t,spaceStore:o}){const n=(0,r().v3)(),a=(0,s().$)(),p=(0,u().L)(n),m=(0,c().AD)(),f=(0,i().K8)((()=>e.state.configForNewTranscripts),[e]),y=(0,i().K8)((()=>{if(o&&t&&a)return"isNewThread"in t&&t.isNewThread?m.createTemporaryThreadStore({environment:n,spaceStore:o,userStore:a,workflowStore:p,config:(0,d().YM)({spaceId:null==o?void 0:o.id})??f.type}):(0,l().threadStoreGivenRouteData)({spaceStore:o,chatSidebarRouteData:t})}),[o,t,a,m,n,p,f]);return{threadStore:y,isNewThread:"isNewThread"in t&&t.isNewThread}}({clientStore:e,chatSidebarState:t,spaceStore:o}),{steps:f,allReady:y}=(0,i().K8)((()=>p?(0,a().A3)({clientStore:e,threadStore:p}):{steps:[],allReady:!1}),[e,p]),[v,h]=(0,n.useState)(y),[g,_]=(0,n.useState)(void 0);(g!==p||y&&!v)&&(_(p),h(y));return(y||v)&&p?{state:m?"new":"ready",threadStore:p,transcript:f}:{state:"loading",threadStore:void 0,transcript:void 0}}},380295:(e,t,o)=>{o.d(t,{m:()=>c});var n=o(296540),r=()=>o(591779),i=()=>o(865241),a=()=>o(590027);function c(e){const{shouldAnimateRef:t,chatSidebarMode:o,chatSidebarVisibility:c,onClosingFinished:l}=e;(0,r().ZC)(o)!==o&&(t.current=!0);const s=(0,n.useCallback)((()=>{i().P.setState(!1),t.current=!1,"closing"===c&&l()}),[c,t,l]);return(0,n.useEffect)((()=>{"opening"===c&&(t.current=!0,requestAnimationFrame((()=>{a().MU.update((e=>({...e,chatSidebarVisibility:"open"})))})))}),[c,t]),{handleAnimationEnd:s}}},390527:(e,t,o)=>{o.r(t),o.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>R,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>C,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>b,MAX_RECURRENCE_INTERVAL:()=>h,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>g,RRULE_WEEKDAYS_MAP:()=>v,adjustedStartDateIfPossible:()=>w,areRecurrenceSchedulesEqual:()=>U,convertFromUnpersistedRecurrenceConfig:()=>P,convertToUnpersistedRecurrenceConfig:()=>O,getFormattedEndCondition:()=>I,getFormattedNextRecurrenceTime:()=>E,getNewEndTimestamp:()=>N,getNextDateUtc:()=>x,getRecurrenceAfter:()=>k,isRunningBetweenMidnightAnd3AM:()=>A,isValidRecurrenceInterval:()=>_,isValidRecurrenceNumberOfRuns:()=>S,rruleFromRecurrence:()=>T,templateAncestorsViolateRecurrenceNesting:()=>M});o(898992),o(354520),o(581454);var n=()=>o(906745);o(944114);function r(e,...t){if(0===t.length)return e.map((e=>[e]));const o=[];for(const n of e)o.push(...r(t[0],...t.slice(1)).map((e=>[n,...e])));return o}var i=()=>o(496603),a=()=>o(534177),c=()=>o(720665),l=()=>o(597777),s=()=>o(869190),u=()=>o(416504),d=()=>o(402390);class p extends(()=>o(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var m=()=>o(912720);const f=(0,o(69708).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),y={day:p.DAILY,week:p.WEEKLY,month:p.MONTHLY,year:p.YEARLY},v={MO:p.MO,TU:p.TU,WE:p.WE,TH:p.TH,FR:p.FR,SA:p.SA,SU:p.SU},h=99,g=999;function _(e){return(0,c().Et)(e)&&Number.isInteger(e)&&e>0&&e<=h}function S(e){return(0,c().Et)(e)&&Number.isInteger(e)&&e>0&&e<=g}function T(e){const{start_date:t,frequency:o,interval:n,weekdays:i,timezone:c,hour:s,minute:u}=e,d="week"===o&&i?i.map((e=>v[e])):void 0,m={};return(0,a().O9)(e.end_condition)&&("date"===e.end_condition.type?m.until=(0,l().eU)(e.end_condition.end_at):"number"===e.end_condition.type?m.count=e.end_condition.number_of_occurrences:(0,a().HB)(e.end_condition)),"month"===e.frequency&&(0,a().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?m.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?m.byweekday=r(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((([e,t])=>v[e].nth(t))):(0,a().HB)(e.monthly_restriction)),new p({freq:y[o],dtstart:(0,l().eU)(t),interval:n,byweekday:d,tzid:c,byhour:s??0,byminute:u??0,bysecond:0,...m})}const b=1,C=1;function M(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const o=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),n=e.length,r=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=n>b,a=o.length>=C;return{violatesConstraint:i||a,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:n,immediateAncestorRecurrenceType:r}}function w(e){var t;const{recurrence:o,afterDate:r}=e;if("number"===(null===(t=o.end_condition)||void 0===t?void 0:t.type)||o.start_date>=r)return o;let i=n().c9.fromMillis(o.start_date,{zone:"utc"});const a=n().c9.fromMillis(r,{zone:"utc"});switch(o.frequency){case"year":{const e=Math.floor(a.diff(i,"years").years/o.interval);i=i.plus({years:e*o.interval});break}case"month":{const e=Math.floor(a.diff(i,"months").months/o.interval);i=i.plus({months:e*o.interval});break}case"week":{const e=Math.floor(a.diff(i,"weeks").weeks/o.interval);i=i.plus({weeks:e*o.interval});break}case"day":{const e=Math.floor(a.diff(i,"days").days/o.interval);i=i.plus({days:e*o.interval});break}}return{...o,start_date:(0,l().DH)(i.toMillis())}}function k(e){const{recurrence:t,afterDate:o}=e;if((0,m().wt)(t)){const e=(0,l().l1)(o);return t.start_date>=e?new Date(t.start_date):void 0}{const e=T(w({recurrence:t,afterDate:o})).after((0,l().eU)(o));if(!e)return;return(0,l().h1)(e)}}function A(e){return 0===e.hour||1===e.hour||2===e.hour}function x(e){return T(e).after((0,l().eU)((0,l().Rz)()))||void 0}function E(e){const{recurrence:t,intl:o}=e,r=x(P(t));if(!r)return;const i=A(t),a=n().c9.fromJSDate(r).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,d().H)(o)).setZone(t.timezone),c=(0,s().Yq)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:o,shortenDate:!0});if(i)return o.formatMessage(f.dateBetweenMidnightAnd3AM,{date:c});{let e=a.toLocaleString(n().c9.TIME_SIMPLE);return t.timezone!==(0,u().P)()&&(e+=` ${a.toFormat("ZZZZ")}`),o.formatMessage(f.dateAtTime,{date:c,time:e})}}function I(e,t){return(0,a().O9)(e)?"number"===e.type?t.formatMessage(f.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,s().Yq)({date:n().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,a().HB)(e):t.formatMessage(f.noEndCondition)}const R=100;function O(e){return{...e,start_date:(0,l().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,l().l1)(e.end_condition.end_at)}:(0,a().HB)(e.end_condition):void 0}}function N(e,t,o){return e.plus(o-t)}function D(e,t){const o=n().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,l().Rz)(o.toJSDate())}}function P(e){return{...e,start_date:(0,l().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?D(e,e.end_condition):(0,a().HB)(e.end_condition):void 0}}function U(e,t){const o=i().fN(e,(e=>void 0!==e)),n=i().fN(t,(e=>void 0!==e));return i().n4(o,n)}},422540:(e,t,o)=>{o.d(t,{$0:()=>h,Fx:()=>M,Ge:()=>f,I3:()=>p,Kj:()=>b,PP:()=>w,TK:()=>k,Yy:()=>d,aE:()=>A,cQ:()=>C,kH:()=>y,m7:()=>m,nq:()=>S,nv:()=>g,tj:()=>v});o(898992),o(354520),o(737550);var n=()=>o(496603),r=()=>o(534177),i=()=>o(381283),a=()=>o(898244),c=()=>o(651124),l=()=>o(349835),s=()=>o(390066);const u={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,place:!1},d={checkbox:[{type:"checkbox"}],date:[{type:"date"}],email:[{type:"text"}],multi_select:[{type:"text"},{of:{type:"text"},type:"array"}],number:[{type:"number"}],person:[{type:"person"},{of:{type:"person"},type:"array"}],phone_number:[{type:"text"}],relation:[{type:"block"},{of:{type:"block"},type:"array"}],select:[{type:"text"},{of:{type:"text"},type:"array"}],status:[{type:"text"},{of:{type:"text"},type:"array"}],text:void 0,title:void 0,url:[{type:"text"}]};function p(e){return Boolean(u[e.type]&&!(0,a().UU)(e)&&(!(0,a().$M)(e)||void 0===(0,a().om)(e)))}function m(e){const{collectionFormat:t,collectionSchema:o,filter:i,sort:l,sourcePropertyIds:u}=e,d=(u??(0,r().uv)(o)).filter(((t,n,r)=>{const c=o[t];return!(!c||!p(c))&&(("relation"!==c.type||!e.restrictCrossSpace||!(0,a().o2)(e.spaceId,c))&&(!i||i([t,c],n,o)))}));if(0===d.length)return[];if(!t||!1===l)return d;const m=(0,s().L)(t,o,void 0,c().jf.Page).collection_page_properties||[];return n().Ul(d,(e=>m.findIndex((t=>t.property===e))))}function f(e){const{collectionFormat:t,collectionSchema:o,sort:a}=e,l=(0,r().uv)(o).filter(((e,t,n)=>{const r=o[e];return!(!r||!(0,i().J)(r))}));if(0===l.length)return[];if(!t||!1===a)return l;const u=(0,s().L)(t,o,void 0,c().jf.Page).collection_page_properties||[];return n().Ul(l,(e=>u.findIndex((t=>t.property===e))))}function y(e){return e.type===l().M9.InvalidCharacter?{type:e.type,character:e.character}:e.type===l().M9.TokenExpected?{type:e.type,token:e.token}:e.type===l().uW.MissingSchemaPropertyOnThisRow||e.type===l().uW.MissingSchemaPropertyOnCollection?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===l().uW.ThisRowBlockPropertyMismatchCollection?{type:e.type,thisRowCollection:e.thisRowCollection}:e.type===l().uW.MissingContextVariable?{type:e.type,valueId:e.valueId}:e.type===l().uW.FunctionCallTooFewArguments?{type:e.type,numArguments:e.numArguments}:e.type===l().uW.FunctionCallUnexpectedArgument?{type:e.type,parameterIndex:e.parameterIndex}:e.type===l().uW.FunctionCallArgumentWrongType?{type:e.type,argumentType:e.argumentType,libraryFunctionName:e.libraryFunction.name,parameterIndex:e.parameterIndex}:e.type===l().uW.MissingDataDependencyBlock?{type:e.type,blockPointer:e.blockPointer,node:e.node}:e.type===l().uW.MissingDataDependencyPerson?{type:e.type,personPointer:e.personPointer}:e.type===l().uW.MemberPropertyMismatchCollection?{type:e.type,blockCollection:e.blockCollection}:e.type===l().uW.DownstreamParseFailure?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===l().uW.ContextVariableWrongType?{type:e.type,valueId:e.valueId,expectedType:e.expectedType,resultType:e.resultType}:e.type===l().uW.DisallowedValueType?{type:e.type,expressionValue:e.expressionValue,allowedValueTypes:e.allowedValueTypes}:e.type===l().uW.LibraryFunctionExecutionError?{type:e.type,error:e.error,libraryFunctionName:e.libraryFunction.name}:{type:e.type}}const v={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,button:!1,file:!1,verification:!1,auto_increment_id:!1,created_by:!1,created_time:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,place:!1};function h(e){return Boolean(v[e.type])}function g(e){const{collectionFormat:t,collectionSchema:o,filter:i,sort:l}=e,u=(0,r().uv)(o).filter(((e,t,n)=>{var r;const c=o[e];return!(!c||!v[c.type])&&((!(0,a().$M)(c)||null===(r=(0,a().om)(c))||void 0===r||!r.auto_update_on_edit)&&(!i||i([e,c],t,o)))}));if(0===u.length)return[];if(!t||!1===l)return u;const d=(0,s().L)(t,o,void 0,c().jf.Page).collection_page_properties||[];return n().Ul(u,(e=>d.findIndex((t=>t.property===e))))}const _={checkbox:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,date:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,place:!1};function S(e){return _[e.type]}const T={checkbox:!0,created_by:!0,created_time:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,last_edited_by:!0,last_edited_time:!0,auto_increment_id:!1,button:!1,file:!1,formula:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,place:!1};function b(e){return T[e.type]}function C(e){return 0===e}function M(e){return function(e){return"button_block"===e||"button_property"===e}(e)}function w(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function k(e){const{collectionSchema:t,property:o,type:n}=e,r=null==t?void 0:t[o];return!r||("action"===n?!p(r):!v[r.type])}function A({automationTrigger:e,collectionSchema:t}){if("event"===(null==e?void 0:e.type)){const{pagesAdded:o,pagePropertiesEdited:n,source:i,relativeDate:a}=e.event;if(void 0===i)return!1;const c="some"===n.type&&n.some,l="all"===n.type&&n.all;if((c||l||[]).some((e=>w({collectionSchema:t,property:e.property})||k({collectionSchema:t,property:e.property,type:"trigger"}))))return!1;const s="some"===n.type&&(!(0,r().O9)(n.some)||0===n.some.length),u="all"===n.type&&(!(0,r().O9)(n.all)||0===n.all.length);if(!o&&("none"===n.type||s||u)&&!a)return!1}else{if("recurrence"!==(null==e?void 0:e.type))return!1;if(!e.recurrence)return!1}return!0}},448801:(e,t,o)=>{o.d(t,{i:()=>r});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698);var n=()=>o(371562);n();function r(e,t){const o=n().create({arrays:{detectMove:!1,includeValueOnMove:!0}}).diff(e,t);if(!o)return{beforeOps:{},removeOps:new Set};let r=[],i=[];for(const n in o)"_t"!==n&&("_"===n[0]?r.push(parseInt(n.slice(1),10)):1===o[n].length&&i.push({index:parseInt(n,10),value:o[n][0]}));const a={},c=new Set,l=[...e];r=r.sort(((e,t)=>e-t));for(let n=r.length-1;n>=0;n--){const e=r[n],t=l.splice(e,1)[0];c.add(t)}i=i.sort(((e,t)=>e.index-t.index));for(let n=0;n<i.length;n++){const e=i[n];a[e.value]=l[e.index],l.splice(e.index,0,e.value)}return{beforeOps:a,removeOps:c}}},482871:(e,t,o)=>{o.d(t,{z:()=>u});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(430670),o(581454);var n=()=>o(898244),r=()=>o(448801),i=()=>o(179034),a=()=>o(722101),c=()=>o(878710),l=(o(354520),()=>o(496603));function s(e){const{collectionContextStore:t,collectionViewStore:o,transaction:r}=e,s=o.getPageSortStore(),u=s.getValue(),d=t.groupsStore.getAllGroupStates(),p=function(e){const{pageSort:t,currentResults:o}=e;if(!t||t.length<=n().WF)return[];const r=t.filter((e=>!o.has(e)));return l().sb([...r.reverse(),...l().o8(t).reverse()]).slice(0,t.length-n().WF)}({pageSort:u,currentResults:new Set(d.flatMap((e=>e.resultsStore.state.map((e=>e.id)))))});for(const n of p)a().TF({parentStore:s,childToRemoveStore:(0,c().v3)(s,{table:i().ev,id:n}),transaction:r})}function u(e){const{resultIds:t,collectionViewStore:o,collectionContextStore:l,transaction:u}=e,d=o.getPageSortStore(),p=d.getValue()||[],{beforeOps:m}=(0,r().i)(p,t.slice(0,n().WF));for(const[n,r]of Object.entries(m))if(r){const e=(0,c().v3)(o,{table:i().ev,id:r});a().nc({parentStore:d,insertStore:(0,c().v3)(o,{table:i().ev,id:n}),beforeStore:e,transaction:u})}else{const e=t.findIndex((e=>e===n)),r=t[e-1],l=r?(0,c().v3)(o,{table:i().ev,id:r}):void 0;a().WH({parentStore:d,insertStore:(0,c().v3)(o,{table:i().ev,id:n}),afterStore:l,transaction:u})}s({collectionContextStore:l,collectionViewStore:o,transaction:u})}},491848:(e,t,o)=>{o.d(t,{w:()=>r});o(898992),o(672577);var n=()=>o(755199);function r({collectionContextStore:e,transaction:t}){const o="collectionTypedView"===e.contextType,r=e.databaseType,i=e.collectionStoresStore.state,a=i.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly()))||i[0];!o&&a&&n().ee({transaction:t,databaseType:r,collectionId:a.id})}},522282:(e,t,o)=>{o.d(t,{Ab:()=>c,GW:()=>g,Jx:()=>h,Kg:()=>S,S_:()=>T,UP:()=>_,UZ:()=>y,Y_:()=>i,eI:()=>d,hh:()=>n,jI:()=>s,jp:()=>p,m7:()=>u,m8:()=>l,nW:()=>f,pj:()=>m,vd:()=>r,wl:()=>a,xw:()=>v});const n=360,r=800,i=450,a=500,c=15,l=50,s=15,u=.96,d=450,p=300,m=700,f=200,y={duration:f},v=10,h=.28,g=10,_=600,S={hiddenVariant:{transform:"translateX(calc(var(--direction, 1) * 20%))",opacity:0},visibleVariant:{transform:"translateX(0%)",opacity:1}},T={duration:.1,ease:"easeOut"}},546461:(e,t,o)=>{o.d(t,{EC:()=>C,To:()=>b,YC:()=>M,or:()=>T,u:()=>S});o(16280);var n=o(296540),r=()=>o(484714),i=()=>o(792485),a=()=>o(56366),c=()=>o(496506),l=()=>o(322867),s=()=>o(69708),u=()=>o(534177),d=()=>o(813297),p=()=>o(862292),m=()=>o(698331),f=()=>o(645873),y=()=>o(190019),v=()=>o(76190),h=o(474848);const g=new WeakMap,_=(0,n.createContext)({automationStore:void 0,contextType:void 0,defined:!1,typecheckResult:void 0});_.displayName="AutomationContext";function S(e){const{automationStore:t,children:o,contextType:n}=e,S=(0,r().v3)(),T=(0,s().tz)(),{value:b}=(0,f().fJ)(p().T.formulas),{value:C}=(0,f().fJ)(d().QV.automationTypecheck),M=(0,v().n)(t),w=(0,i().S)(),k=(0,a().K8)((()=>{if(!b)return{error:new(l().N9)("Missing formulas dependency")};if(!C)return{error:new(l().N9)("Missing automation dependency")};const e=function(e){const{environment:t,automationStore:o,automationTypecheckModule:n,contextType:r,formulasModule:i,intl:a,isSubscribed:l,pageStore:s}=e,d=g.get(o);if(d)return d;{const e=new(c().ComputedStore)((()=>{const e=o.getTriggerType();let c=r;return(0,u().O9)(e)&&(0,m().x2)(e)&&(c=(0,m().H8)(e)),(0,y().Z)({environment:t,automationStore:o,automationTypecheckModule:n,contextType:c,formulasModule:i,intl:a,isSubscribed:l,pageStore:s})}),{debugName:"automationContextTypecheckResultCachedStore"});return g.set(o,e),e}}({environment:S,automationStore:t,automationTypecheckModule:C,contextType:n,formulasModule:b,intl:T,isSubscribed:M,pageStore:"button_block"===n?null==w?void 0:w.pageStore:void 0});return e.state}),[S,t,C,n,b,T,M,null==w?void 0:w.pageStore]);return(0,h.jsx)(_.Provider,{value:{automationStore:t,typecheckResult:k,contextType:n,defined:!0},children:o})}function T(e){const{automationStore:t,children:o}=e,n=(0,a().K8)((()=>{var e;return null===(e=t.getTrigger())||void 0===e?void 0:e.type}),[t]);return(0,h.jsx)(S,{automationStore:t,contextType:(0,m().H8)(n??"event"),children:o})}function b(e){var t;return null===(t=g.get(e))||void 0===t?void 0:t.state}function C(){const e=n.useContext(_);if(!1===e.defined)throw new Error("No automation context found!");return e}function M(){return n.useContext(_)}},698331:(e,t,o)=>{o.d(t,{$X:()=>i,H8:()=>a,x2:()=>r});var n=()=>o(534177);function r(e){return"event"===e||"recurrence"===e}function i(e){const t=e.getTrigger();return(0,n().O9)(t)&&r(t.type)}function a(e){return"event"===e?"event":"recurrence"===e?"recurrence":void(0,n().HB)(e)}},706959:(e,t,o)=>{o.d(t,{c:()=>l});var n=o(296540),r=()=>o(484714),i=()=>o(56366),a=()=>o(118078),c=()=>o(590027);function l(){const e=(0,r().v3)(),{visibility:t,naturalPanelContentSize:o,mode:l}=(0,i().K8)((()=>({visibility:c().MU.state.chatSidebarVisibility,naturalPanelContentSize:c().MU.state.naturalPanelContentSize,mode:c().MU.state.chatSidebarMode})),[]),s=(0,i().K8)((()=>c().BC.getState()),[]),u="open"===t||"opening"===t||"closing"===t;return{onDismissed:(0,n.useCallback)((()=>{c().BC.setState(void 0),c().MU.update((e=>({...e,chatSidebarVisibility:"closed",editorWidthUsed:0}))),(0,a().closeChatSidebar)({environment:e})}),[e]),onDismiss:(0,n.useCallback)((()=>{u&&(0,a().dismissChatSidebar)()}),[u]),userPreferenceSidebarWidth:s,naturalPanelContentSize:o,visibility:t,isOpen:u,mode:l}}},766854:(e,t,o)=>{o.d(t,{H:()=>T,Q:()=>S});o(898992),o(672577);var n=()=>o(242422),r=()=>o(929219),i=()=>o(700500),a=()=>o(179034),c=()=>o(201980),l=()=>o(557281),s=()=>o(384944),u=()=>o(381678),d=()=>o(476492),p=()=>o(646736),m=()=>o(406792),f=()=>o(765957),y=()=>o(148832),v=()=>o(622811),h=()=>o(491848),g=()=>o(482871);function _(e,t,o){const r=(0,u()._)(e),i=null==r?void 0:r.id;if(!i||!o)return;if(!n().default.checkGate({gateName:"full_access_for_created_collection_pages"}))return;if(t.canAdmin())return;const a=t.getSpaceStore();return a&&(0,p().dp)(a,i).isMember()?[{role:"editor",type:"user_permission",user_id:i}]:void 0}function S(e){const{collectionContextStore:t,transaction:o}=e;return(0,h().w)({collectionContextStore:t,transaction:o}),T(e)}function T(e){var t,o,n;const{environment:u,collectionContextStore:p,groupsPointer:h,insertAtIndex:S,shouldCoerce:T,templateStore:b,transaction:C,from:M,tracker:w,inMemoryRecordCache:k,isKeyboard:A,title:x}=e,E=m().default.DO_NOT_USE_markLegacy("collections.add_item_lag");m().default.DO_NOT_USE_measureAfterNextFlushLegacy(E,{environment:u,getData:()=>({...d().kz(p),from:M.createBlock})});const I="collectionTypedView"===p.contextType,R=p.databaseType,O=p.collectionStoresStore.state,N=O.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly()))||O[0],D=null===(t=f().default.state.sidebarSpaceStore)||void 0===t?void 0:t.id,P=f().default.state.currentUserSettingsStore,U=I&&R&&D&&P&&[...P.getAllPreferredCollections(D),...P.getPreferredCollectionsOfType(D,R)]||[];let V;const F=h[0];if("group_header"===M.createBlock&&"location"===F.value.type){const e=F.value.value;if(e){V=O.find((t=>t.id===e.id&&(t.canEdit()||t.canEditCollection()||t.canEditContentOnly())))}}else V=function(e,t){for(const o of e){const e=t.find((e=>e.id===o&&(e.canEdit()||e.canEditCollection()||e.canEditContentOnly())));if(e)return e}}(U,O);const B=V??N,H=null==B?void 0:B.getSpaceId(),W=p.collectionViewStore(),G=p.getViewType(),q=s().Wv({environment:u,type:i().xd.page,inMemoryRecordCache:k,transaction:C,spaceId:H,tracker:w,permissions:_(u,B,H),properties:{title:(0,c().x9d)(x)}});if(!B||!W||!G)return{coercionSucceeded:!0,newStore:q};const z=null===(o=p.groupsStore.getGroupState(h))||void 0===o?void 0:o.groupUiParentStore;if(!z)return{coercionSucceeded:!0,newStore:q};const L=y().B.createChildStore(z,{table:a().ev,id:q.id});b&&r().A.state.online&&l().n5({title:"template",environment:u,store:q,templateStore:b,isKeyboard:A??!1,isCreateIn:!1,transaction:C,from:M.initCollection??"collection_group_actions"});const j=(0,v().j)({environment:u,store:q,collectionStore:B,collectionContextStore:p,groupsPointer:h,shouldCoerce:T,transaction:C}),K=(null===(n=p.groupsStore.getGroupState(h))||void 0===n||null===(n=n.reducerResultStore.state)||void 0===n?void 0:n.blockIds)||[],Y=void 0!==S?S:K.length;if(p.permissionScopesStore.state.canEditContent||I){const e=[...K.slice(0,Y),L.id,...K.slice(Y)];(0,g().z)({resultIds:e,collectionViewStore:W,collectionContextStore:p,transaction:C})}return{coercionSucceeded:j,newStore:L}}},888325:(e,t,o)=>{function n(e){return`${e.table}:${e.id}`}o.d(t,{_:()=>n})},890409:(e,t,o)=>{o.d(t,{Ah:()=>h,Dk:()=>f,Iv:()=>v,SF:()=>y,YO:()=>S,_f:()=>b,c_:()=>p,dW:()=>_,gW:()=>m,sp:()=>C,vN:()=>g});o(16280),o(944114),o(898992),o(354520),o(803949),o(581454),o(737550);var n=()=>o(496603),r=()=>o(973647),i=()=>o(534177),a=()=>o(842599),c=()=>o(239381),l=()=>o(179034),s=()=>o(798880),u=()=>o(201980),d=()=>o(241319);function p(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"add_automation_step",properties:t})}function m(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"delete_automation_step",properties:t})}function f(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_create",properties:t})}function y(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_update",properties:t})}function v(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_delete",properties:t})}function h(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_enable",properties:t})}function g(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_disable",properties:t})}function _(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_action_create",properties:t})}function S(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_action_delete",properties:t})}function T(e){const{formulaAnalyticsModule:t,formulasModule:o,formulaTypecheckContextValues:n,getRecordModel:a,spaceId:l,value:s,featureGates:u}=e;if("formula"===s.type){if(!(0,i().O9)(s.value))return;const e=r().Q.unwrapOr(o.parseFormulaInputToAst(s.value),void 0);if(e){const r=o.addTypesToFormulaAST(e,{handleDataRequest:(0,c().zg)(a),spaceId:l,valueTypes:n,featureGates:u});return{...t.getFormulaAnalytics(e,{getRecordModel:a,typecheckContextValues:n}),formula_return_type:r.node.type,redacted_formula:t.getRedactedFormulaAsStringSync(e,{getRecordModel:a,typecheckContextValues:n})}}}else{if("simple"===s.type){if(!(0,i().O9)(s.value))return;return t.getSimpleFormulaAnalytics(s.value,{getRecordModel:a,typecheckContextValues:n})}(0,i().HB)(s.type)}}function b(e){const{automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:r,formulasModule:l,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f,simpleFormulasModule:y}=e;return t.isType("complete_sprint")?{automation_action_id:t.pointer.id,type:"complete_sprint"}:t.isType("create_page")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:n,formulaTypecheckContextValues:r,getRecordModel:a,featureGates:c}=e,l=t.getConfig();let s,u=[];const d=null==l?void 0:l.collection,p=null==l?void 0:l.properties;if((0,i().O9)(d)&&(0,i().O9)(p)&&p.length>0){const e=a(d),f=null==e?void 0:e.getNormalizedSchema();(0,i().O9)(f)&&(u=p.map((e=>{var t;return(null===(t=f[e])||void 0===t?void 0:t.type)??"unknown"})));const y=null==l?void 0:l.values;if(n&&(0,i().O9)(y)){s=[];for(const e of p){var m;const i=null===(m=y[e])||void 0===m?void 0:m.value;if(!i)continue;const l=T({formulaAnalyticsModule:o,formulasModule:n,getRecordModel:a,formulaTypecheckContextValues:r,spaceId:t.spaceId,value:i,featureGates:c});l&&s.push(l)}}}return{automation_action_id:t.pointer.id,property_formula_stats:s,property_types:u,type:"create_page"}}({automationActionModel:t,formulaAnalyticsModule:r,formulasModule:l,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):t.isType("duplicate_blocks")?{automation_action_id:t.pointer.id,type:"duplicate_blocks"}:t.isType("modal_confirmation")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:n,formulaTypecheckContextValues:r,getRecordModel:a,featureGates:c}=e,l=t.getConfig(),s=[];if(n&&(0,i().O9)(l)&&l.text){const e=T({formulasModule:n,formulaAnalyticsModule:o,getRecordModel:a,formulaTypecheckContextValues:r,spaceId:t.spaceId,value:l.text,featureGates:c});e&&s.push(e)}return{automation_action_id:t.pointer.id,formula_stats:s,type:"modal_confirmation"}}({automationActionModel:t,formulaAnalyticsModule:r,formulasModule:l,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):t.isType("open_page")?{automation_action_id:t.pointer.id,type:"open_page"}:t.isType("query_collection")?{automation_action_id:t.pointer.id,type:"query_collection"}:t.isType("send_in_app_notification")?function(e){var t;const{automationActionModel:o,formulaAnalyticsModule:n,formulasModule:r,formulaTypecheckContextValues:a,getRecordModel:c,featureGates:l,simpleFormulasModule:s}=e,d={automation_action_id:o.pointer.id,messageCharacterCount:0,type:"send_in_app_notification"},p=o.getConfig();if(!(0,i().O9)(p))return d;if((0,i().O9)(p.target))if("formula"===p.target.type&&(0,i().O9)(p.target.value)){if(d.targetData={type:"formula",numUserFormulaTargets:(0,u().Fbh)(p.target.value.value).length,numFormulaContextTargets:s.getReferencedContextValueIds(p.target.value).length},r){const e=T({formulasModule:r,formulaAnalyticsModule:n,getRecordModel:c,formulaTypecheckContextValues:a,spaceId:o.spaceId,value:p.target.value,featureGates:l});e&&(d.formula_stats??=[],d.formula_stats.push(e))}}else if("property"===p.target.type&&(0,i().O9)(p.target.propertyId)&&(0,i().O9)(p.target.collectionPointer)){const e=c(p.target.collectionPointer),t=null==e?void 0:e.getSchema();var m;(0,i().O9)(t)&&(d.targetData={type:"property",propertyType:null===(m=t[p.target.propertyId])||void 0===m?void 0:m.type})}if((0,i().O9)(null===(t=p.notification_message)||void 0===t?void 0:t.value)&&(d.messageCharacterCount=(0,u().FAw)(p.notification_message.value),r)){const e=T({formulasModule:r,formulaAnalyticsModule:n,getRecordModel:c,formulaTypecheckContextValues:a,spaceId:o.spaceId,value:p.notification_message,featureGates:l});e&&(d.formula_stats??=[],d.formula_stats.push(e))}return d}({automationActionModel:t,formulaAnalyticsModule:r,formulasModule:l,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f,simpleFormulasModule:y}):t.isType("send_gmail_notification")?function(e){var t,o,r,c,l,d,p;const{automationActionModel:m,formulaAnalyticsModule:f,formulasModule:y,formulaTypecheckContextValues:v,getRecordModel:h,featureGates:g}=e,_=m.getConfig();if(!(0,i().O9)(_))return{automation_action_id:m.pointer.id,fields:{},recipient_domains:{},type:"send_gmail_notification"};const S=Object.fromEntries(Object.entries(_||{}).map((([e,t])=>{var o;return"formula"===(null==t?void 0:t.type)?[e,Boolean(null==t||null===(o=t.value)||void 0===o?void 0:o.value)]:"simple"===(null==t?void 0:t.type)?[e,Boolean(null==t?void 0:t.value)]:[e,Boolean(t)]}))),{to:b,cc:C,bcc:M}=_,w=[...(null==b||null===(t=b.value)||void 0===t?void 0:t.value)||[],...(null==C||null===(o=C.value)||void 0===o?void 0:o.value)||[],...(null==M||null===(r=M.value)||void 0===r?void 0:r.value)||[]],k=[...(0,u().Fbh)(w).map((e=>h({table:s().oo,id:e}))).map((e=>null==e?void 0:e.email)).filter(i().O9),...(0,a().C3)((0,u().k4p)(w))],A=n().Tr(k.map((e=>e.split("@")[1]))),x=[null===(c=_.to)||void 0===c?void 0:c.value,null===(l=_.cc)||void 0===l?void 0:l.value,null===(d=_.bcc)||void 0===d?void 0:d.value,null===(p=_.reply_to)||void 0===p?void 0:p.value,_.from_name,_.email_subject,_.email_body].map((e=>{if(y&&(0,i().O9)(e))return T({formulaAnalyticsModule:f,formulasModule:y,getRecordModel:h,formulaTypecheckContextValues:v,spaceId:m.spaceId,value:e,featureGates:g})})).filter(i().O9);return{automation_action_id:m.pointer.id,fields:S,formula_stats:x,recipient_domains:A,type:"send_gmail_notification"}}({automationActionModel:t,formulaAnalyticsModule:r,formulasModule:l,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):t.isType("slack_notification")?{automation_action_id:t.pointer.id,type:"slack_notification"}:t.isType("update_pages")?function(e){const{automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:n,formulasModule:r,formulaTypecheckContextValues:a,getRecordModel:l,featureGates:s}=e,u=t.getConfig(),p=[],m=[],f=[];if((0,i().O9)(u)&&(0,i().O9)(u.target)&&(0,i().O9)(u.properties)&&u.properties.length>0){let e;if("variable"===u.target.type){const t=(0,c().y5)(u.target.id);if("action"===t.source){const t=(0,d().y)({actionModels:o,id:u.target.id}).collectionPointer;if((0,i().O9)(t)){const o=l(t);e=null==o?void 0:o.getNormalizedSchema()}}else{if("global"!==t.source||"button_page"!==t.global)throw new Error("Failed loading property schema");{const t=(0,c().IV)(a,u.target.id);if("block"===(null==t?void 0:t.type.type)&&(0,i().O9)(t.type.collection)){const o=l(t.type.collection);e=null==o?void 0:o.getNormalizedSchema()}}}}else if("collection"===u.target.type){const t=l(u.target.collection);e=null==t?void 0:t.getNormalizedSchema()}(0,i().O9)(e)&&u.properties.forEach((o=>{const c=e[o];if((0,i().O9)(c)&&(p.push(c.type),r&&(0,i().O9)(u.values))){const e=u.values[o];if((0,i().O9)(e)&&(m.push({type:c.type,operator:e.action}),e.value)){const o=T({formulasModule:r,formulaAnalyticsModule:n,getRecordModel:l,formulaTypecheckContextValues:a,spaceId:t.spaceId,value:e.value,featureGates:s});o&&f.push(o)}}}))}return{automation_action_id:t.pointer.id,property_configs:m,property_formula_stats:f,property_types:p,type:"update_pages"}}({automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:r,formulasModule:l,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):t.isType("define_variables")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:n,formulaTypecheckContextValues:r,getRecordModel:a,featureGates:c}=e,l=t.getConfig(),s=[];if(n&&(0,i().O9)(l)&&l.values)for(const i of Object.values(l.values))if(i.value){const e=T({formulasModule:n,formulaAnalyticsModule:o,getRecordModel:a,formulaTypecheckContextValues:r,spaceId:t.spaceId,value:i.value,featureGates:c});e&&s.push(e)}return{automation_action_id:t.pointer.id,formula_stats:s,type:"define_variables"}}({automationActionModel:t,formulaAnalyticsModule:r,formulasModule:l,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):t.isType("http_request")?{automation_action_id:t.pointer.id,type:"http_request"}:t.isType("publish_site")?{automation_action_id:t.pointer.id,type:"publish_site"}:void(0,i().HB)(t)}function C(e){const{automationModel:t,builderType:o="sidebar",formulaAnalyticsModule:n,formulasModule:r,formulaTypecheckContextValues:a,getRecordModel:c,featureGates:s,simpleFormulasModule:u,source:d}=e,p=[],m=t.getActionPointers().map((e=>c(e))).filter(i().O9);for(const l of t.getActionPointers()){const e=c(l);(0,i().O9)(e)&&p.push(b({automationActionModel:e,automationActionModels:m,formulaAnalyticsModule:n,formulasModule:r,formulaTypecheckContextValues:a,getRecordModel:c,featureGates:s,simpleFormulasModule:u}))}const f=[];let y,v,h;if(t.isEventType()){var g;const e=t.getEventConfiguration(),o=c(t.getParentPointer());y=t.getParentId();const n=t.getEventConfiguration();if("collection_view"===(null===(g=n.source)||void 0===g?void 0:g.type)){const e=c(n.source.pointer);(null==e?void 0:e.parent_table)===l().ev&&(h=null==e?void 0:e.parent_id),v=null==n?void 0:n.source.pointer.id}const r=null==o?void 0:o.getNormalizedSchema();if((0,i().O9)(r)){const{pagesAdded:t,pagePropertiesEdited:o}=e;if(t&&f.push({type:"page"}),"any"===o.type)f.push({condition:"any",type:"property"});else if("none"===o.type)f.push({condition:"none",type:"property"});else{let e=[];"some"===o.type?e=o.some??[]:"all"===o.type&&(e=o.all??[]);const t=[],n=[];e.forEach((e=>{var o;const a=null===(o=r[e.property])||void 0===o?void 0:o.type;(0,i().O9)(a)&&(t.push({type:a,operator:e.filter.operator}),n.push(a))})),f.push({condition:o.type,property_configs:t,property_types:n,type:"property"})}}}else if(t.isButtonType())f.push({type:"button"});else if(t.isRecurrenceType()){var _;f.push({type:"recurrence",frequency:null===(_=t.getTrigger().recurrence)||void 0===_?void 0:_.frequency})}else(0,i().HB)(t);return{automation_actions:p,automation_id:t.id,automation_triggers:f,collection_id:y,collection_view_id:v,collection_view_block_id:h,builder_type:o,source:d}}},965454:(e,t,o)=>{o.d(t,{AD:()=>l,XN:()=>c,rz:()=>a});o(16280);var n=o(296540),r=()=>o(234459),i=()=>o(231297);class a{constructor(){this.tempThreadCache=void 0,this.tempThreadPointer=void 0,this.environment=void 0,this.userStore=void 0,this.spaceStore=void 0,this.workflowStore=void 0,this.config=void 0,this.tempThreadCache=new(o(221844).A)({name:"TemporaryAiThreadCache",isTemporaryData:!0})}getTempThreadPointerIfExists(){return this.tempThreadPointer}createTemporaryThreadStore({environment:e,spaceStore:t,userStore:n,workflowStore:r,config:a}){if(this.environment=e,this.userStore=n,this.spaceStore=t,this.workflowStore=r,this.config=a,this.tempThreadPointer)return o(796977).E.createChildStore(t,this.tempThreadPointer);e.defaultRecordCache.inMemoryRecordCache.addCacheFallback(this.tempThreadCache);return i().createAndCommit({environment:e,canUndo:!1,perform:o=>this.performCreateThread({transaction:o,inMemoryRecordCache:this.tempThreadCache,environment:e,spaceStore:t,userStore:n,workflowStore:this.workflowStore,config:a}),userAction:"TemporaryAiThreadManager.createTemporaryThread"}).performResult}getLogData(){return{missingEnvironment:!Boolean(this.environment),missingUser:!Boolean(this.userStore),missingSpace:!Boolean(this.spaceStore),missingThreadPointer:!Boolean(this.tempThreadPointer)}}persistTemporaryThreadStoreIfExists(e){var t;if(!(this.environment&&this.userStore&&this.spaceStore&&this.tempThreadPointer))return;let o,n;if(this.environment.defaultRecordCache.inMemoryRecordCache.removeCacheFallback(this.tempThreadCache),this.tempThreadCache.clearCache(),e)o=this.performCreateThread({transaction:e,inMemoryRecordCache:this.environment.defaultRecordCache.inMemoryRecordCache,environment:this.environment,spaceStore:this.spaceStore,userStore:this.userStore,pointer:this.tempThreadPointer,workflowStore:this.workflowStore,config:this.config});else{if(n=i().createAndCommit({environment:this.environment,canUndo:!1,perform:e=>{if(this.environment&&this.userStore&&this.spaceStore&&this.tempThreadPointer)return this.performCreateThread({transaction:e,inMemoryRecordCache:this.environment.defaultRecordCache.inMemoryRecordCache,environment:this.environment,spaceStore:this.spaceStore,userStore:this.userStore,pointer:this.tempThreadPointer,workflowStore:this.workflowStore,config:this.config})},userAction:"TemporaryAiThreadManager.createTemporaryThread"}),!n.performResult)throw new Error("Expected to be able to persist");o=n.performResult}return this.reset(),{threadStore:o,commitResult:null===(t=n)||void 0===t?void 0:t.serverCommitResult}}reset(){this.environment=void 0,this.spaceStore=void 0,this.userStore=void 0,this.tempThreadPointer=void 0,this.workflowStore=void 0}performCreateThread({environment:e,spaceStore:t,userStore:n,workflowStore:i,config:a,inMemoryRecordCache:c,pointer:l,transaction:s}){const u=(null==l?void 0:l.id)??(0,o(594794).Z1)({environment:e,table:r().To,spaceId:t.id});return this.tempThreadPointer={id:u,table:r().To,spaceId:t.id},(0,o(107527).aP)({environment:e,userStore:n,spaceStore:t,transcript:[],transaction:s,threadId:u,inMemoryRecordCache:c,workflowId:null==i?void 0:i.id,threadType:null==a?void 0:a.type})}}const c=(0,n.createContext)(new a);function l(){return(0,n.useContext)(c)}c.displayName="TemporaryAiThreadContext"},966759:(e,t,o)=>{o.d(t,{i:()=>i});var n=()=>o(476492),r=()=>o(175213);function i(e){const{environment:t,collectionContextStore:o,property_type:i,from:a,property:c,...l}=e,s=(0,n().sl)(o)||{};(0,r().G)(t,{property:c,property_type:i,from:a,...l,...s})}},996958:(e,t,o)=>{o.d(t,{D:()=>s,N:()=>i});var n=()=>o(534177),r=()=>o(522282);function i(e){const{chatSidebarMode:t,chatSidebarVisibility:o}=e,r="opening"===o||"open"===o;switch(t){case"popup":return{initial:a(!1),animate:a(r)};case"sidebar":return{initial:c(!1),animate:c(r)};case"full":return{initial:l(!0),animate:l(!1),exit:l(!0)};default:(0,n().HB)(t)}}function a(e){return{opacity:e?1:0,scale:e?1:r().m7,transformOrigin:"bottom right"}}function c(e){return{translateX:e?0:"100%"}}function l(e){return{translateY:e?"100%":0}}function s(e){const{chatSidebarVisibility:t,editorWidthUsed:o}=e;return{initial:{width:0},animate:{width:"opening"===t||"open"===t?o??0:0}}}}}]);