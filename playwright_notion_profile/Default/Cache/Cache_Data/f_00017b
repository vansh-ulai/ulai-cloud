"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[25204,97829],{14959:(e,t,o)=>{o.d(t,{u:()=>i});var n=()=>o(751735);function i(e,t){const{r:o,g:i,b:r}=(null==e?void 0:e.info.accent_color)||{r:0,g:0,b:0},a=`rgba(${o},${i},${r},${"dark"===t?.6:1})`;return{background:a,hoveredBackground:(0,n().e$)(a,.4),pressedBackground:(0,n().e$)(a,.9)}}},23402:(e,t,o)=>{o.d(t,{u:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"3.14 6.87 13.7 6.27",svg:(0,o(474848).jsx)("path",{d:"M15.586 11.003V9.036l-3.902 3.903a.625.625 0 0 1-.884 0L7.735 9.874 4.2 12.967a.625.625 0 1 1-.822-.94l3.975-3.478.097-.071a.626.626 0 0 1 .756.1l3.035 3.034 3.486-3.484H12.71a.625.625 0 0 1 0-1.25h3.5a.626.626 0 0 1 .625.625v3.5a.625.625 0 0 1-1.25 0"})},i=(0,o(340498).wt)("lineUptrend",n)},66486:(e,t,o)=>{o.d(t,{W:()=>$,D:()=>X});o(898992),o(672577),o(581454);var n=o(296540),i=()=>o(484714),r=()=>o(56366),a=()=>o(401497),l=()=>o(718827),s=()=>o(19238),c=()=>o(708685),d=()=>o(568063),u=()=>o(239381),p=()=>o(668725),m=()=>o(72135),g=()=>o(69708),f=()=>o(100622),y=()=>o(534177),h=()=>o(284371),S=()=>o(901952),v=()=>o(231297),b=()=>o(908201),x=()=>o(312296),w=()=>o(406699),C=()=>o(623580),A=()=>o(417392),j=()=>o(78901),M=()=>o(89924),I=()=>o(581369),k=()=>o(859428),T=()=>o(726637),_=()=>o(763884),P=()=>o(778078),R=()=>o(972435),B=()=>o(722872),D=()=>o(970585),O=()=>o(760217),F=()=>o(419357),K=()=>o(404277),V=()=>o(939740),z=o(474848);const N="LastUsedCurrency",W=o(757695).Store.createClass("",{name:"NumberFormatFilterStore"});function q(e){const{collectionContextStore:t,collectionStore:o,property:a,schema:l,onClose:s}=e,c=(0,i().v3)(),d=(0,g().tz)(),u=(0,r().uB)(void 0,D().A),p=(0,r().uB)(void 0,W),f=(0,n.useCallback)((e=>{p.setState(e.target.value),u.setState({...u.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[p,u]),y=(0,r().O$)(p),h=(0,r().K8)((()=>function(e){const{environment:t,collectionContextStore:o,collectionStore:n,property:i,schema:r,numberFormatFilterStore:a,onClose:l}=e,s=_().K.get({userId:t.currentUser.id,key:N}),c=(0,P().Ay)(a.state,(0,m().RQ)(s),(e=>e));return c.map((e=>{const a=(0,m().gL)(R().A.getIntl(),e),s=(0,m().D9)(e),c=s?`${a} (${s})`:a,d={key:e,render:e=>(0,z.jsx)(O().A,{...e,title:c}),action:()=>function(e){const{newFormat:t,collectionContextStore:o,collectionStore:n,property:i,schema:r,environment:a,onClose:l}=e,s=r[i];if(!s)return;if("number"!==s.type&&"formula"!==s.type)return;const c={...s,number_format:t,..."percent"===t&&void 0!==(null==s?void 0:s.show_as)?{show_as:{...null==s?void 0:s.show_as,maxValue:1}}:{}};"number"===s.type&&(0,m().SL)(t)&&_().K.set({userId:a.currentUser.id,key:N,value:t});v().createAndCommit({userAction:"NumberFormatMenu.handleNumberFormatChange",environment:a,canUndo:!0,perform:e=>{(0,x().F)({environment:a,collectionStore:n,update:{[i]:c},transaction:e})}}),(0,S().V)({environment:a,collectionContextStore:o,property:i,from:"view_settings",action:"number_change_format",number_format:t}),null==l||l()}({newFormat:e,collectionContextStore:o,collectionStore:n,property:i,schema:r,environment:t,onClose:l})};return d}))}({environment:c,collectionStore:o,collectionContextStore:t,property:a,schema:l,numberFormatFilterStore:p,onClose:s})),[t,c,o,a,l,p,s]);let b;b=T().A.isMobile?{menuType:B().gu.ActionSheet}:{menuType:B().gu.Popup};const w=!T().A.isMobile&&(0,z.jsx)(M().A,{isInput:!0,children:(0,z.jsx)(F().Ay,{value:y,onChange:f,focus:!0,focusAfterAnimation:!0,placeholder:d.formatMessage({defaultMessage:"Filter formats…",id:"blockPropertyValue.filterForNumberFormats.placeholder"}),preventCaptureDeleteWhenEmpty:!0,preventCaptureSpacebarWhenEmpty:!0})});return(0,z.jsx)(K().A,{...b,header:w,children:(0,z.jsx)(V().Ay,{type:V().Oh.Vertical,initialFocus:0,sections:[{key:0,render:e=>(0,z.jsx)(M().A,{...e}),items:h}],store:u})})}var Y=()=>o(893952),U=()=>o(722372),L=()=>o(255824),E=()=>o(463830),H=()=>o(497222),G=()=>o(828973);function $(e){const{collectionContextStore:t,property:o,source:a}=e,l=(0,i().v3)(),{propertySchema:s,numberFormat:p,numberPrecision:g}=(0,r().K8)((()=>{const e=t.collectionStore();if(!e)return{};const n=t.normalizedSchemaStore.state[o];if(!n)return{};const i=e.getSpaceId(),r=l.idCreator.getSpaceIdCreatorSync(i);if("number"===n.type)return{propertySchema:n,numberFormat:n.number_format??m().C4,numberPrecision:n.number_precision??m().pS};if("formula"===n.type)return"number"===(0,c().getFormulaPropertySchemaResultType)(n)?{propertySchema:n,numberFormat:n.number_format??m().C4,numberPrecision:n.number_precision??m().pS}:n.formula2&&"number"===(0,u().pg)(n.formula2.result_type).type?{propertySchema:n,numberFormat:n.number_format??m().C4,numberPrecision:m().pS}:{};if("rollup"===n.type){var a;if(n.aggregation&&"show_unique"!==n.aggregation){var s;const i=null===(s=(0,d().eY)({property:o,schema:t.normalizedSchemaStore.state,getRecordModel:e.getRecordModel,spaceIdCreator:r}))||void 0===s?void 0:s.targetPropertySchema;if(void 0===(null==i?void 0:i.type))return{};const a=(0,U().o_)(n.aggregation,(0,U().o_)(n.aggregation,"number_format"in i?i.number_format:void 0));return a?{propertySchema:n,numberFormat:a,numberPrecision:m().pS}:{}}const i=null===(a=(0,d().eY)({property:o,schema:t.normalizedSchemaStore.state,getRecordModel:e.getRecordModel,spaceIdCreator:r}))||void 0===a?void 0:a.targetPropertySchema;if("number"===(null==i?void 0:i.type)||"formula"===(null==i?void 0:i.type)&&"number"===(0,c().getFormulaPropertySchemaBaseResultType)(i))return{propertySchema:n,numberFormat:i.number_format??m().C4,numberPrecision:m().pS}}return{}}),[t,o,l]),f="rollup"!==(null==s?void 0:s.type),y=(0,n.useMemo)((()=>"formula"===(null==s?void 0:s.type)&&"number"!==(0,c().getFormulaPropertySchemaResultType)(s)),[s]),h="rollup"!==(null==s?void 0:s.type)&&!y;return s?(0,z.jsxs)(z.Fragment,{children:[f?(0,z.jsx)(J,{numberFormat:p,property:o}):void 0,h?(0,z.jsx)(Z,{numberPrecision:g,property:o}):void 0,(0,z.jsx)(Q,{property:o,propertySchema:s,numberFormat:p,source:a})]}):null}function J(e){const{numberFormat:t,property:o}=e,a=(0,g().tz)(),{isMobile:l}=(0,i().Y0)(),s=(0,b().ET)(),c=(0,r().uB)(void 0,E().A),d=(0,r().K8)((()=>s.collectionStore()),[s]),u=(0,r().O$)(s.normalizedSchemaStore),p=(0,n.useCallback)((e=>(0,z.jsx)(H().A,{title:(0,z.jsx)(g().sA,{defaultMessage:"Number format",id:"database.viewSettings.numberOptions.numberFormat"}),right:(0,z.jsx)("span",{style:{...h().RC},children:(0,m().gL)(a,m().PA.find((e=>e===t))??m().C4)}),showChevron:!0,rotateChevron:c.state.open,...e})),[c,a,t]),f=(0,n.useCallback)((e=>d?(0,z.jsx)(q,{collectionContextStore:s,collectionStore:d,property:o,schema:u,onClose:e.close}):null),[s,d,o,u]);return(0,z.jsx)(w().A,{popupType:l?A().nl.BottomSheet:A().nl.Popup,alignmentToOrigin:"end",bottomSheetInitialState:"half",renderOrigin:p,render:f,buttonPopupStore:c})}function Z(e){const{numberPrecision:t,property:o}=e,a=(0,g().tz)(),l=(0,i().v3)(),s=(0,b().ET)(),d=(0,r().K8)((()=>s.collectionStore()),[s]),u=(0,r().O$)(s.normalizedSchemaStore),p=(0,n.useMemo)((()=>{const e=u[o];if(!e)return;const t="formula"===e.type&&"number"===(0,c().getFormulaPropertySchemaResultType)(e);return"number"===e.type||t?e:void 0}),[o,u]),f=(0,n.useMemo)((()=>m().iv.map((e=>({key:e,type:"button",title:X(a,e)})))),[a]),y=(0,n.useCallback)((e=>{if(!d||!p)return;const t={...p,number_precision:e};v().createAndCommit({userAction:"NumberFormatMenu.handleNumberPrecisionChange",environment:l,canUndo:!0,perform:e=>{(0,x().F)({environment:l,collectionStore:d,update:{[o]:t},transaction:e})}}),(0,S().V)({environment:l,collectionContextStore:s,property:o,from:"view_settings",action:"number_change_precision",number_precision:e})}),[s,d,l,o,p]),h=(0,n.useCallback)((()=>(0,z.jsx)(g().sA,{defaultMessage:"Round to a specified number of decimal places. The underlying remains unchanged.",id:"database.viewSettings.numberOptions.numberPrecision.tooltip"})),[]),w=(0,n.useCallback)((e=>(0,z.jsx)(G().A,{...e,title:(0,z.jsx)(g().sA,{defaultMessage:"Decimal places",id:"database.viewSettings.numberOptions.numberPrecision"}),selectedKey:t,options:f,onChange:y})),[y,t,f]);return(0,z.jsx)(k().A,{placement:"right",textWrap:!0,renderTooltip:h,render:w})}function X(e,t){switch(t){case"precision_uncapped":return e.formatMessage({id:"collection.numberFormat.precisionUncapped",defaultMessage:"Default"});case"precision_0":return e.formatMessage({id:"collection.numberFormat.precision0",defaultMessage:"0"});case"precision_1":return e.formatMessage({id:"collection.numberFormat.precision1",defaultMessage:"1"});case"precision_2":return e.formatMessage({id:"collection.numberFormat.precision2",defaultMessage:"2"});case"precision_3":return e.formatMessage({id:"collection.numberFormat.precision3",defaultMessage:"3"});case"precision_4":return e.formatMessage({id:"collection.numberFormat.precision4",defaultMessage:"4"});case"precision_5":return e.formatMessage({id:"collection.numberFormat.precision5",defaultMessage:"5"});default:(0,y().HB)(t)}}function Q(e){const{property:t,propertySchema:o,numberFormat:r,source:c}=e,{show_as:d}=o,u=(0,i().v3)(),m=(0,a().DP)(),y=(0,b().ET)(),A=(0,n.useRef)({color:(null==d?void 0:d.color)??"green",maxValue:(null==d?void 0:d.maxValue)??100,showValue:(null==d?void 0:d.showValue)??!0}),k=(0,L().a)(),T="tableHeaderMenu"===c,_={type:(null==d?void 0:d.type)??"number",color:(null==d?void 0:d.color)??A.current.color,maxValue:(null==d?void 0:d.maxValue)??A.current.maxValue,showValue:(null==d?void 0:d.showValue)??A.current.showValue},P=(0,a().IS)((e=>({card:{boxSizing:"content-box",height:36,flex:1,margin:1,boxShadow:`0 0 0 1px ${e.regularDividerColor}`,color:e.text.secondary,borderRadius:6,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",paddingInlineStart:12,paddingInlineEnd:12,paddingTop:6,paddingBottom:6,cursor:"pointer",background:k?e.background.elevated:void 0},cardHoveredStyle:{background:k?e.background.elevated:void 0},cardPressedStyle:{background:k?e.background.elevated:void 0},selectedCard:{boxShadow:`0 0 0 2px ${e.blue.border.accentPrimary}`,color:e.blue.text.accentPrimary},cardVisual:{height:20,marginBottom:4,width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},cardText:{lineHeight:1,fontSize:12},showAsTypeOption:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginInlineStart:k?12:T?8:16,marginInlineEnd:T?8:16,marginTop:6,gap:6},allExtraOptions:{backgroundColor:k?e.background.elevated:e.palette.gray[30],boxShadow:k?`0 0 0 1px ${e.regularDividerColor}`:void 0,borderRadius:5,marginTop:12,marginInlineStart:k?12:T?8:16,marginInlineEnd:T?8:16,paddingTop:12,paddingBottom:12,maxHeight:1e3,transition:"max-height 0.5s ease-in-out",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",gap:8},extraOptionStyle:{display:"flex",flexDirection:"row",alignItems:"center",paddingInlineStart:16,paddingInlineEnd:16,gap:16,height:28,width:"100%"},applyToAllViews:{marginTop:12,marginInlineStart:T?10:18,marginInlineEnd:T?10:18,fontSize:12,color:e.text.tertiary,paddingBottom:T?6:0}})),[k,T]),R=(0,n.useCallback)((e=>{const n=y.collectionStore();o&&n&&(v().createAndCommit({userAction:"CollectionSettingsProperty.handleNumberShowAsChange",environment:u,canUndo:!0,perform:i=>{(0,x().F)({environment:u,collectionStore:n,update:{[t]:{...o,show_as:e}},transaction:i})}}),(0,S().V)({environment:u,collectionContextStore:y,property:t,from:"view_settings",action:"number_change_show_as",number_show_as:(null==e?void 0:e.type)??"number"}))}),[y,u,t,o]),B=(0,n.useMemo)((()=>[{key:"number",visual:(0,z.jsx)("div",{style:{fontSize:16,fontWeight:h().Wy.medium},children:"42"}),text:(0,z.jsx)(g().sA,{defaultMessage:"Number",id:"database.viewSettings.numberOptions.showAsNumber"})},{key:"bar",visual:(0,z.jsx)(j().z,{percentage:50,filledColor:m["bar"===_.type?"blue":"gray"].background.accentPrimary,unfilledColor:m["bar"===_.type?"blue":"gray"].background.tertiaryTranslucent,style:{width:"100%"}}),text:(0,z.jsx)(g().sA,{defaultMessage:"Bar",id:"database.viewSettings.numberOptions.showAsBar"})},{key:"ring",visual:(0,z.jsx)(s().E,{size:20,progressPercentage:40,progressColor:"ring"===_.type?"blue":"gray",ringColor:"ring"===_.type?"blue":"gray",ringThickness:2}),text:(0,z.jsx)(g().sA,{defaultMessage:"Ring",id:"database.viewSettings.numberOptions.showAsRing"})}]),[_.type,m]),D=(0,z.jsx)("div",{style:P.showAsTypeOption,children:B.map((e=>{const t=_.type===e.key;return(0,z.jsxs)(l().Ay,{onClick:()=>{const t="number"===e.key?void 0:{type:e.key,color:_.color,maxValue:"percent"===r?1:_.maxValue,showValue:_.showValue};void 0!==t&&(A.current=t),R(t)},style:{...P.card,...t?P.selectedCard:{}},hoveredStyle:P.cardHoveredStyle,pressedStyle:P.cardPressedStyle,children:[(0,z.jsx)("div",{style:P.cardVisual,children:e.visual}),(0,z.jsx)("div",{style:P.cardText,children:e.text})]},e.key)}))}),O=e=>{const t="number"!==_.type?{..._,type:_.type,...e}:void 0;void 0!==t&&(A.current=t),R(t)},F="number"!==_.type?(0,z.jsxs)("div",{style:P.extraOptionStyle,children:[(0,z.jsx)("div",{style:{flex:6,fontSize:14},children:(0,z.jsx)(g().sA,{defaultMessage:"Color",id:"database.viewSettings.numberOptions.color"})}),(0,z.jsx)("div",{style:{display:"flex",flexWrap:"wrap",flex:6,gap:7},children:(0,z.jsx)(w().A,{popupType:u.device.isMobile?w().z.BottomSheet:w().z.Popup,bottomSheetInitialState:"half",renderOrigin:e=>(0,z.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"end"},...e,children:(0,z.jsx)(Y().A,{color:_.color,focused:!1,buttonStyle:{width:"auto",marginInlineStart:0,marginInlineEnd:0,borderRadius:6,color:m.text.tertiary},style:{minHeight:36},right:(0,p().b)({width:12,height:12})})}),render:e=>{const t=f().tS.map((t=>(0,z.jsx)(Y().A,{color:t,isChecked:t===_.color,focused:!1,style:{width:"100%"},onClick:()=>{O({color:t}),e.close()}},t)));return(0,z.jsx)("div",{style:{minWidth:150,paddingTop:8,paddingBottom:8},children:t})}})})]}):null,K="number"!==_.type?"percent"!==r&&(0,z.jsxs)("div",{style:P.extraOptionStyle,children:[(0,z.jsx)("div",{style:{flex:6,fontSize:14},children:(0,z.jsx)(g().sA,{defaultMessage:"Divide by",id:"database.viewSettings.numberOptions.divideBy"})}),(0,z.jsx)("div",{style:{flex:6},children:(0,z.jsx)(C().A,{value:_.maxValue.toString(),onChange:e=>{const t=e.target.value.replace(/[^0-9]/g,""),o=parseFloat(t);!isNaN(o)&&o>0&&O({maxValue:o})},inputStyle:{textAlign:"end"}})})]}):null,V="number"!==_.type?(0,z.jsxs)("div",{style:P.extraOptionStyle,children:[(0,z.jsx)("div",{style:{flex:6,fontSize:14},children:(0,z.jsx)(g().sA,{defaultMessage:"Show number",id:"database.viewSettings.numberOptions.showValue"})}),(0,z.jsx)("div",{style:{flex:6,display:"flex",justifyContent:"flex-end"},children:(0,z.jsx)(I().A,{on:_.showValue,onClick:()=>{O({showValue:!_.showValue})},disabled:!1})})]}):null,N=Boolean(F||K||V)?(0,z.jsxs)("div",{style:P.allExtraOptions,children:[F,K,V]}):null;return(0,z.jsxs)(M().A,{title:(0,z.jsx)(g().sA,{defaultMessage:"Show as",id:"database.viewSettings.numberPercentOptions.showAs"}),topBorder:!0,disableMobileBorders:!0,children:[D,N,k?void 0:(0,z.jsx)("div",{style:P.applyToAllViews,children:(0,z.jsx)(g().sA,{id:"database.CollectionSettings.NumberOptions.applyAllViews",defaultMessage:"Changes apply to all views showing this property."})})]})}},107440:(e,t,o)=>{o.d(t,{A:()=>_});var n=o(296540),i=()=>o(395361),r=()=>o(484714),a=()=>o(56366),l=()=>o(401497),s=()=>o(929219),c=()=>o(98126),d=()=>o(160432),u=()=>o(835243),p=()=>o(187174),m=()=>o(689094),g=()=>o(519831),f=()=>o(69708),y=()=>o(100622),h=()=>o(284371),S=()=>o(901952),v=()=>o(559506),b=()=>o(581928),x=()=>o(901389),w=()=>o(231297),C=()=>o(419357),A=()=>o(16006),j=()=>o(132389),M=()=>o(125565),I=()=>o(972435),k=o(474848);const T=(0,f().YK)({autoIncrementIdPrefixPlaceholder:{defaultMessage:"Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixPlaceholder"},duplicatePrefixNameError:{defaultMessage:"{prefixName} isn’t available for use.",id:"database.viewSettings.propertyTab.duplicatePrefixNameError"}});function _(e){const{uniqueIdProperty:t,prefixValue:o,collectionContextStore:c}=e,y=(0,r().v3)(),_=(0,a().K8)((()=>c.collectionStore()),[c]),[R,B]=(0,n.useState)(o??""),[D,O]=(0,n.useState)(!0),[F,K]=(0,n.useState)(),V=!(0,a().O$)(s().e),z=(0,n.useCallback)((()=>{O(!0),K(void 0)}),[O,K]),N=(0,n.useCallback)((e=>{O(!0),K(I().A.formatMessage(T.duplicatePrefixNameError,{prefixName:`"${e}"`}))}),[]),W=(0,n.useCallback)(((e,t,o)=>{const n=o.collectionStore();n&&(O(!1),v().callApi({eventName:"setRecordKey",environment:y,data:{spaceId:n.getSpaceId(),table:n.table,key:e,id:n.id}}).then((n=>{O(!0),200!==n.status?N(e):(0,S().V)({environment:y,collectionContextStore:o,property:t,from:"view_settings",action:"unique_id_change_collection_key"})})).catch((()=>N(e))))}),[y,N]),q=(0,n.useCallback)((async e=>{if(!_)return!1;const t=await v().callApi({eventName:"isRecordKeyAvailable",environment:y,data:{spaceId:_.getSpaceId(),table:_.table,key:e.trim()}});return"success"===t.type&&t.data.isAvailable}),[_,y]),Y=(0,i().U)((e=>{q(e).then((t=>{t||N(e),O(!0)})).catch((()=>N(e)))}),500),[U]=(0,p().Yb)((async()=>{if(_)return v().callApi({eventName:"suggestRecordKey",environment:y,data:{spaceId:_.getSpaceId(),table:g().Vl,id:_.id,shouldSetSuccessfullySuggestedRecord:!1}})}),[_,y]);(0,n.useEffect)((()=>{var e;o||"resolved"!==U.status||"success"===(null===(e=U.value)||void 0===e?void 0:e.type)&&U.value.data&&(K(void 0),B(U.value.data.key))}),[o,U]),(0,n.useEffect)((()=>()=>{Y.cancel()}),[Y]);const L=(0,n.useCallback)((e=>{const t=e.target.value.toUpperCase();B(t),z(),t&&t!==o&&((0,u().n4)(t)||K(I().A.formatMessage(u().DZ.prefixInvalidError)),O(!1),Y(t))}),[z,o,Y]),E=(0,n.useCallback)((()=>{Y.flush()}),[Y]),H=(0,n.useCallback)((e=>{const n=null==_?void 0:_.getRecordKeyStore();e!==o&&!F&&n&&_&&null!=t&&t.propertySchema?W(e,null==t?void 0:t.property,c):O(!0)}),[_,o,F,t,W,c]),G=(0,n.useCallback)((()=>{const e=c.collectionStore();e&&w().createAndCommit({userAction:"CollectionSettingsAutoIncrementIdPropertyCreateNewIdProperty",environment:y,canUndo:!0,perform:t=>{const o=(0,b().createProperty)({environment:y,collectionStore:e,collectionViewArgs:void 0,propertyType:"auto_increment_id",transaction:t});W(R,o,c)}})}),[c,y,R,W]),$=(0,n.useCallback)((e=>{if(!_)return;const t=[{label:(0,k.jsx)(f().sA,{id:"database.viewSettings.propertyTab.autoIncrementIdPrefixSubmit",defaultMessage:"Update ID Prefix"}),color:"red",onAccept:()=>H(e)}];x().ui({message:(0,k.jsx)("span",{children:(0,k.jsx)(f().sA,{id:"database.viewSettings.propertyTab.changePrefixConfirmationMessage",defaultMessage:"Updating the prefix will stop 3rd party automations that rely on this ID (e.g., GitHub PR status automation).",values:{databaseName:(0,k.jsx)(A().A,{style:{display:"inline",fontWeight:h().Wy.medium},shouldWrap:!0,store:_})}})}),showCancel:!0,keepFocus:!0,items:t})}),[_,H]),J=(0,n.useCallback)((e=>{o?$(e):H(e)}),[o,H,$]),Z=(0,n.useCallback)((()=>t?t&&!o?(0,k.jsxs)(k.Fragment,{children:[(0,m().W)({width:14,height:14}),(0,k.jsx)(j().A,{size:4}),(0,k.jsx)(f().sA,{defaultMessage:"Add ID prefix",id:"database.viewSettings.propertyTab.autoIncrementIdCreatePrefix"})]}):(0,k.jsx)(f().sA,{defaultMessage:"Update ID Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixSubmit"}):(0,k.jsxs)(k.Fragment,{children:[(0,m().W)({width:14,height:14}),(0,k.jsx)(j().A,{size:4}),(0,k.jsx)(f().sA,{defaultMessage:"Add ID property",id:"database.viewSettings.propertyTab.autoIncrementIdCreateProperty"})]})),[o,t]),X=(0,l().IS)((e=>({prefixInputOuterStyle:{color:void 0===o?e.text.tertiary:e.text.primary},actionButton:{display:"flex",justifyContent:"center",marginTop:8,padding:8},subtext:{paddingInlineStart:8}})),[o]);return(0,k.jsxs)(k.Fragment,{children:[V?void 0:(0,k.jsx)(C().Ay,{left:(0,k.jsx)(M().A,{children:(0,k.jsx)(f().sA,{defaultMessage:"Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefix"})}),value:R,inputOuterStyle:X.prefixInputOuterStyle,style:{gap:18},onChange:L,onBlur:E,placeholder:T.autoIncrementIdPrefixPlaceholder.defaultMessage,onSubmit:()=>J(R.trim()),focusInitial:!1,selectAll:!1,disabled:!1}),(0,k.jsx)("div",{style:X.subtext,children:F||!D?(0,k.jsx)(P,{prefixName:R,hasRequestCompleted:D,errorMessage:F}):V?(0,k.jsx)(M().A,{isSmall:!0,isSecondaryColor:!0,style:{marginTop:16,marginInlineStart:16},children:(0,k.jsx)(f().sA,{defaultMessage:"Prefix is not available offline.",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixOffline"})}):(0,k.jsx)(M().A,{isSmall:!0,isSecondaryColor:!0,children:(0,k.jsx)(f().sA,{defaultMessage:"{prefixWithHyphen}1, {prefixWithHyphen}2, {prefixWithHyphen}3, ...",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixPreview",values:{prefixWithHyphen:R?`${R}-`:""}})})}),(0,k.jsx)("div",{style:X.actionButton,children:(0,k.jsx)(d().A,{colorPalette:"blue",size:"md",style:{width:"100%"},onClick:()=>{t?J(R.trim()):G()},disabled:R===o||Boolean(F)||!D||V,children:Z()})})]})}function P(e){const{errorMessage:t,hasRequestCompleted:o}=e;return(0,k.jsx)(M().A,{isMultiline:!0,style:{...o?{color:y().Tj.red}:{}},isSecondaryColor:!o,children:o&&t?t:(0,k.jsx)("div",{style:{paddingTop:3,paddingBottom:3},children:(0,k.jsx)(c().A,{legacySize:14})})})}},109129:(e,t,o)=>{o.d(t,{V:()=>u});o(296540);var n=()=>o(484714),i=()=>o(665589),r=()=>o(69708),a=()=>o(901952),l=()=>o(231297),s=()=>o(312296),c=()=>o(35091),d=o(474848);function u({menuListProps:e,collectionContextStore:t,property:o,propertySchema:u}){const p=(0,n().v3)();return(0,d.jsx)(c().A,{title:(0,d.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:(0,d.jsx)(r().sA,{defaultMessage:"Show full URL",id:"database.viewSettings.propertyTab.toggleShowFullUrl"})}),icon:i().l,showChevron:!1,switcherProps:{on:Boolean(u.show_full_url),noColor:!1},...e,onClick:()=>function(e,t,o,n){const i=t.collectionStore();if(!n||!i||"url"!==n.type)return;const r=!Boolean(n.show_full_url);l().createAndCommit({userAction:"CollectionSettingsProperty.handleNumberShowAsChange",environment:e,canUndo:!0,perform:t=>{(0,s().F)({environment:e,collectionStore:i,update:{[o]:{...n,show_full_url:r}},transaction:t})}}),(0,a().V)({environment:e,collectionContextStore:t,property:o,from:"view_settings",action:r?"url_toggle_show_full_on":"url_toggle_show_full_off"})}(p,t,o,u)})}},115552:(e,t,o)=>{o.d(t,{A:()=>c});o(581454),o(296540);var n=()=>o(401497),i=()=>o(718827),r=()=>o(284371),a=()=>o(115512),l=o(474848);const s={tall:80,short:50};function c(e){const{disabled:t,options:o,selectedOption:c,onOptionSelected:d,height:u}=e,p=(0,n().IS)((e=>({cardContainer:{paddingInlineStart:8,paddingInlineEnd:8,display:"flex",justifyContent:"space-between",alignItems:"center",columnGap:8},cardUnselected:{display:"flex",flexDirection:"column",alignItems:"center",flexGrow:1,flexBasis:82,minWidth:0,color:e.palette.gray[500]},cardSelected:{display:"flex",flexDirection:"column",alignItems:"center",flexGrow:1,flexBasis:82,minWidth:0,color:e.palette.gray[500]},cardButtonBase:{height:s[u],width:"100%",borderRadius:6,borderStyle:"solid",transition:"border-color 0.3s, box-shadow 0.3s",display:"flex",justifyContent:"center",alignItems:"center",color:t?e.icon.tertiary:void 0,background:e.background.elevated},cardButtonHovered:{background:e.background.elevated,...(0,a().nl)({width:2,color:e.blue.border.strong})},cardButtonSelected:(0,a().nl)({width:2,color:e.blue.border.accentPrimary}),cardButtonUnselected:(0,a().nl)({width:1,color:"dark"===e.mode?e.palette.gray[400]:e.palette.gray[100]}),cardLabelBase:{...r().RC,marginTop:6,fontSize:12,lineHeight:"14px",maxWidth:"100%",color:t?e.icon.tertiary:void 0},cardLabelSelected:{fontWeight:r().Wy.semibold,color:e.palette.gray[900]},iconBase:{height:24,width:24,color:t?void 0:e.icon.secondary},iconSelected:{color:e.blue.icon.accentPrimary,fill:e.blue.icon.accentPrimary},imageBase:{maxHeight:s[u],opacity:t?.5:1},imageSelected:{opacity:1}})),[t,u]),m=o.available.map((e=>{const n=o.appearance[e],r=e===c;return(0,l.jsxs)("div",{style:r?p.cardSelected:p.cardUnselected,children:[(0,l.jsx)(i().Ay,{style:{...p.cardButtonBase,...r?p.cardButtonSelected:p.cardButtonUnselected},hoveredStyle:p.cardButtonHovered,pressedStyle:p.cardButtonHovered,ignoreLocalHoverState:r,disabled:t,onClick:()=>{d(e)},children:n.icon?n.icon.function({...p.iconBase,height:n.icon.size,width:n.icon.size,...r?p.iconSelected:{}}):(0,l.jsx)("img",{src:n.image.src,style:{width:n.image.width,height:n.image.height,...p.imageBase,...r?p.imageSelected:{}}})}),(0,l.jsx)("div",{style:{...p.cardLabelBase,...r?p.cardLabelSelected:{}},children:n.label})]},e)}));return(0,l.jsx)("div",{style:p.cardContainer,children:m})}},128011:(e,t,o)=>{o.d(t,{S:()=>c});var n=o(296540),i=()=>o(312788),r=()=>o(484714),a=()=>o(401497),l=()=>o(496703),s=()=>o(69708);o(474848);(0,s().YK)({debugLabel:{defaultMessage:"Debug agent",id:"databaseAgents.debugAgent.icon"}});function c(e){const{navigate:t}=(0,n.useContext)(i().E),{workflowStore:o}=e,c=(0,r().v3)();(0,s().tz)(),(0,a().IS)((e=>({debugIcon:{color:e.icon.tertiary}})),[]),(0,n.useCallback)((()=>{if(!o)return;const e=(0,l().L)({workflowId:o.id,params:{workflowViewType:"activity"}});t({environment:c,url:e,redirect:!1})}),[o,c,t]);return null}},158797:(e,t,o)=>{o.d(t,{A:()=>me});o(898992),o(672577);var n=o(296540),i=()=>o(484714),r=()=>o(56366),a=()=>o(401497),l=()=>o(631524),s=()=>o(617871),c=()=>o(14959),d=()=>o(69708),u=()=>o(534177),p=()=>o(901389),m=()=>o(510683),g=()=>o(374562),f=()=>o(895876),y=()=>o(89924),h=()=>o(132389),S=()=>o(817126),v=()=>o(176983),b=()=>o(53137),x=()=>o(107440),w=(o(944114),o(354520),o(430670),o(803949),o(581454),()=>o(160432)),C=()=>o(898244),A=()=>o(852424),j=()=>o(784892),M=()=>o(638681);const I={pull_request_review_edited:!0,pull_request_review_submitted:!0,pull_request_review_requested:!0,pull_request_review_request_removed:!0,pull_request_closed:!0,pull_request_opened:!0,pull_request_reopened:!0,pull_request_converted_to_draft:!0,pull_request_edited:!0,pull_request_assigned:!0,pull_request_labeled:!0,pull_request_unlabeled:!0},k={pull_request_review_comment_created:!0,issue_comment_created:!0},T={installation_deleted:!0,installation_suspend:!0,installation_unsuspend:!0,...I,...k},_={pull_request_opened:!0,pull_request_review_requested:!0,pull_request_review_submitted:!0,pull_request_closed:!0};M().literals(...(0,u().uv)({pull_request:!0,pull_request_review:!0,pull_request_review_comment:!0,installation:!0,issue_comment:!0})),M().literals(...(0,u().uv)(T)),M().literals(...(0,u().uv)(k));var P=()=>o(452951),R=()=>o(689094),B=()=>o(236262),D=()=>o(901952),O=()=>o(581928),F=()=>o(231297),K=()=>o(908201),V=()=>o(312296),z=()=>o(760217),N=()=>o(406699),W=()=>o(811979),q=()=>o(802790),Y=()=>o(404277),U=()=>o(939740),L=()=>o(45552),E=()=>o(859428),H=()=>o(399762),G=()=>o(972435),$=()=>o(722872),J=()=>o(685889),Z=()=>o(497222),X=()=>o(35091),Q=o(474848);const ee=14,te=(0,d().YK)({autoUpdate:{defaultMessage:"Auto-update",id:"collectionSettingsGithubAutomationConfig.statusPicker.autoUpdate"},when:{defaultMessage:"when PR is",id:"collectionSettingsGithubAutomationConfig.statusPicker.when"},addStatusDescription:{defaultMessage:"Add a status property to set up automations.",id:"collectionSettingsGithubAutomationConfig.addStatusDescription"},addStatusButton:{defaultMessage:"Add status property",id:"collectionSettingsGithubAutomationConfig.statusPicker.addStatusButton"},newStatusPropertyButton:{defaultMessage:"New status",id:"collectionSettingsGithubAutomationConfig.statusPicker.newStatusPropertyButton"},pull_request_opened:{defaultMessage:"Opened",id:"collectionSettingsGithubAutomationConfig.pullRequestOpened"},pull_request_review_requested:{defaultMessage:"Review requested",id:"collectionSettingsGithubAutomationConfig.pullRequestReviewRequested"},pull_request_review_submitted:{defaultMessage:"Approved",id:"collectionSettingsGithubAutomationConfig.pullRequestApproved"},pull_request_closed:{defaultMessage:"Merged",id:"collectionSettingsGithubAutomationConfig.pullRequestMerged"},noAutomations:{defaultMessage:"None",id:"collectionSettingsGithubAutomationConfig.noAutomation"},removeStatusOption:{defaultMessage:"Clear",id:"collectionSettingsGithubAutomationConfig.removeStatusOption"},linkbackAndActivitySectionHeader:{defaultMessage:"Linkbacks & Activity",id:"collectionSettingsGithubAutomationConfig.linkbacksAndActivityHeading"},linkBacksToggle:{defaultMessage:"Linkbacks in GitHub",id:"collectionSettingsGithubAutomationConfig.linkBacksToggle"},linkBacksToggleDescription:{defaultMessage:"Enable linkback comments to the linked page on GitHub",id:"collectionSettingsGithubAutomationConfig.linkBacksToggleDescription"},activityCommentsToggle:{defaultMessage:"Activity Comments",id:"collectionSettingsGithubAutomationConfig.activityCommentsToggle"},activityCommentsToggleDescription:{defaultMessage:"Show GitHub activity as comments on the linked page",id:"collectionSettingsGithubAutomationConfig.activityCommentsToggleDescription"}}),oe={pull_request_opened:G().A.formatMessage(te.pull_request_opened),pull_request_review_requested:G().A.formatMessage(te.pull_request_review_requested),pull_request_review_submitted:G().A.formatMessage(te.pull_request_review_submitted),pull_request_closed:G().A.formatMessage(te.pull_request_closed)},ne=G().A.formatMessage(te.noAutomations),ie={pull_request_opened:null,pull_request_review_requested:null,pull_request_review_submitted:null,pull_request_closed:null},re={github_linkbacks:!0,activity_comments:!1};function ae(e){const{gitHubProperty:t,selectedStatusProperty:o,setSelectedStatusProperty:a,intl:l}=e,s=(0,i().v3)(),c=(0,K().ET)(),d=(0,i().Y0)(),p=de(),m=(0,r().K8)((()=>{const e=(0,J().Jq)(c,t);if(e&&(0,C().UU)(e))return e}),[c,t]),g=(0,r().K8)((()=>{const e=c.normalizedSchemaStore.state;return(0,u().WP)(e).flatMap((([e,t])=>t&&(0,C().DD)(t)?[{id:e,schema:t}]:[]))}),[c.normalizedSchemaStore]),f=(0,r().K8)((()=>m&&(0,C().UU)(m)&&(0,u().O9)(m.connectedRelation.automationSettings)?m.connectedRelation.automationSettings:re),[m]);(0,n.useEffect)((()=>{x(f)}),[f]),(0,n.useEffect)((()=>{if(!o&&g.length>0){if(null!=m&&m.connectedRelation.automation)for(const t of g)if(m.connectedRelation.automation[t.id])return void a(t);const e=g[0];a(e)}}),[g,m,o,a]);const[S,v]=(0,n.useState)(ie),[b,x]=(0,n.useState)(re),w=(0,n.useCallback)((e=>{const o=c.collectionStore();if(!o||!m||!(0,C().nC)(m))return;const n=m.connectedRelation;n.automationSettings=e;const i={...m,connectedRelation:{...n}};F().createAndCommit({userAction:"CollectionSettingsConfigureGithubAutomation",environment:s,canUndo:!0,perform:e=>{(0,V().F)({environment:s,collectionStore:o,update:{[t]:i},transaction:e})}}),x(e)}),[c,s,t,m]);(0,n.useEffect)((()=>{var e,t;o&&m&&(0,C().UU)(m)&&null!==(e=m.connectedRelation.automation)&&void 0!==e&&e[o.id]?v(null===(t=m.connectedRelation.automation)||void 0===t?void 0:t[o.id]):v(ie)}),[m,o]);const A=(0,n.useCallback)((e=>{const n=c.collectionStore();if(!(n&&o&&m&&(0,C().nC)(m)))return;const i=m.connectedRelation;if(!i||!o.id)return;i.automation={...i.automation,...e};const r={...m,connectedRelation:{...i}};(0,D().V)({environment:s,collectionContextStore:c,property:o.id,from:"github_pull_requests_property",action:"configure_github_pr_automation",githubAutomationConfigured:e}),F().createAndCommit({userAction:"CollectionSettingsConfigureGithubAutomation",environment:s,canUndo:!0,perform:e=>{(0,V().F)({environment:s,collectionStore:n,update:{[t]:r},transaction:e})}})}),[c,o,m,s,t]),M=(0,r().K8)((()=>o&&o.schema.options?o.schema.options:[]),[o]),I=(0,r().K8)((()=>{const e={};return M.forEach((t=>{e[t.id]=t})),e}),[M]),k=(0,r().K8)((()=>{var e,t;const n=null==o||null===(e=o.schema)||void 0===e?void 0:e.groups,i=null==o||null===(t=o.schema)||void 0===t?void 0:t.options;return n&&i?n.map((e=>{const t=i.filter((t=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));if(0!==t.length)return{group:e,groupOptions:t}})).filter(u().O9):[]}),[o]);function T(e,t){const n=k.map((({group:t,groupOptions:n})=>{const i=n.map((n=>({key:n.id,render:e=>(0,Q.jsx)(z().A,{...e,focused:e.focused,isTokenTitle:!0,title:(0,Q.jsx)(H().q,{format:j().NY.Small,value:n.value,color:n.color,showRemoveButton:!1,groupColor:t.color,isSingle:!0})}),action:()=>{const t={...S,[e]:n.id};o&&(A({[o.id]:t}),v(t))}}))).filter(u().O9);return{key:t.name,render:e=>(0,Q.jsx)(y().A,{...e,title:t.name,topBorder:e.index>0}),items:i}}));if(S[e]){function i(){const n={...S,[e]:null};o&&(A({[o.id]:n}),v(n)),t.close()}const r={key:"removeOptionSection",render:e=>(0,Q.jsx)(y().A,{...e,topBorder:!0}),items:[{key:"removeOptionButton",render:e=>(0,Q.jsx)(z().A,{...e,focused:!1,title:l.formatMessage(te.removeStatusOption),left:(0,B().trashIcon)({width:12}),onClick:i}),action:e=>{i()}}]};n.push(r)}return n}return(0,Q.jsxs)(Q.Fragment,{children:[o?(0,Q.jsx)(y().A,{topBorder:!1,disableDesktopPadding:!0,disableMobilePadding:!0,title:(0,Q.jsx)(se,{selectedStatusProperty:o,setSelectedStatusProperty:a,existingStatusProperties:g,intl:l}),children:(0,u().uv)(_).map((e=>(0,Q.jsx)(W().A,{focused:!1,placementToOrigin:"top",alignmentToOrigin:"end",popupType:d.isMobile?N().z.SlideUp:N().z.Popup,render:t=>{const o=d.isMobile?{menuType:$().gu.Modal,right:(0,Q.jsx)(L().DoneMenuText,{}),onClickRight:t.close}:{menuType:$().gu.Popup,width:150};return(0,Q.jsx)(Y().A,{...o,children:(0,Q.jsx)(U().Ay,{type:U().Oh.Vertical,sections:T(e,t),initialFocus:void 0,onAccept:t.close})})},renderOrigin:t=>{const n=S[e];let i=(0,Q.jsx)("div",{style:p.noneText,children:ne});if(n){const e=I[n];if(e){var r;const t=null==o||null===(r=o.schema)||void 0===r||null===(r=r.groups)||void 0===r||null===(r=r.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(n)})))||void 0===r?void 0:r.color;i=(0,Q.jsx)(H().q,{format:j().NY.Small,showRemoveButton:!1,isSingle:!0,value:e.value,color:e.color,groupColor:t})}}return(0,Q.jsx)(Z().A,{...t,focused:!1,icon:()=>(0,Q.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"flex-start",whiteSpace:"nowrap"},children:[oe[e],(0,Q.jsx)(h().A,{size:8}),(0,P().Z)(p.automationMenuItemArrow)]}),title:(0,Q.jsx)("div",{style:{width:"100%",display:"inline-flex",justifyContent:"flex-end"},children:i}),showChevron:!0,chevronStyle:{margin:0}})}},e)))}):(0,Q.jsx)(le,{setSelectedStatusProperty:a,intl:l}),(0,Q.jsx)(y().A,{topBorder:!0,disableDesktopPadding:!0,disableMobilePadding:!0,title:l.formatMessage(te.linkbackAndActivitySectionHeader),children:[(0,Q.jsx)(E().A,{renderTooltip:()=>l.formatMessage(te.linkBacksToggleDescription),render:e=>(0,Q.jsx)(X().A,{...e,title:l.formatMessage(te.linkBacksToggle),onClick:()=>{w({...b,github_linkbacks:!b.github_linkbacks})},switcherProps:{on:b.github_linkbacks}})},"github_linkbacks"),(0,Q.jsx)(E().A,{renderTooltip:()=>l.formatMessage(te.activityCommentsToggleDescription),render:e=>(0,Q.jsx)(X().A,{...e,title:l.formatMessage(te.activityCommentsToggle),onClick:()=>{w({...b,activity_comments:!b.activity_comments})},switcherProps:{on:b.activity_comments}})},"activity_comments")]})]})}function le(e){const{setSelectedStatusProperty:t,intl:o}=e,n=(0,i().v3)(),r=(0,K().ET)(),a=de();return(0,Q.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Q.jsx)(q().A,{size:"100%",innerStyle:a.addStatusDivider}),(0,Q.jsx)("div",{style:a.addStatusDescription,children:o.formatMessage(te.addStatusDescription)}),(0,Q.jsxs)(w().A,{colorPalette:"blue",style:a.addStatusButton,onClick:e=>{e.stopPropagation(),ce(n,r,t)},children:[(0,R().W)({width:14}),(0,Q.jsx)(h().A,{size:4}),o.formatMessage(te.addStatusButton)]}),(0,Q.jsx)(h().A,{size:4})]})}function se(e){const{selectedStatusProperty:t,setSelectedStatusProperty:o,existingStatusProperties:n,intl:r}=e,l=(0,i().v3)(),s=(0,K().ET)(),c=(0,i().Y0)(),d=de(),p=(0,a().DP)(),m=n.map((e=>{const{id:t,schema:n}=e;return{key:t,action:()=>{o(e)},render:t=>(0,Q.jsx)(z().A,{...t,icon:(0,Q.jsx)(A().zB,{size:ee,theme:p,icon:e&&e.schema.icon,type:"status"}),title:n.name})}})).filter(u().O9),g={key:"newStatusProperty",action:()=>{ce(l,s,o)},render:e=>(0,Q.jsx)(z().A,{...e,icon:(0,R().W)(d.statusPickerIcon),title:r.formatMessage(te.newStatusPropertyButton)})};return(0,Q.jsxs)("div",{style:d.statusPickerWrapper,children:[(0,Q.jsxs)("div",{style:{display:"inline-flex",alignItems:"center"},children:[r.formatMessage(te.autoUpdate),c.isMobile?(0,Q.jsx)(h().A,{size:4}):void 0,(0,Q.jsx)(N().A,{placementToOrigin:"bottom",alignmentToOrigin:"start",popupType:c.isMobile?N().z.SlideUp:N().z.Popup,renderOrigin:e=>(0,Q.jsx)(z().A,{...e,title:t.schema.name,focused:!1,style:d.statusPickerButtonCore,textWrapperStyle:d.statusPickerButtonTextWrapper,left:(0,Q.jsx)(A().zB,{size:ee,theme:p,icon:t.schema.icon,type:"status"}),leftStyle:{marginInlineStart:2},showExtensionArrow:!0,extensionArrowStyle:d.statusPickerExtensionArrow}),render:e=>{const t=c.isMobile?{menuType:$().gu.ActionSheet}:{menuType:$().gu.Popup,width:150};return(0,Q.jsx)(Y().A,{...t,children:(0,Q.jsx)(U().Ay,{type:U().Oh.Vertical,sections:[{key:0,render:e=>(0,Q.jsx)(y().A,{...e}),items:[...m,g]}],initialFocus:0,onAccept:e.close})})}})]}),c.isMobile?(0,Q.jsx)(h().A,{size:4}):void 0,r.formatMessage(te.when)]})}function ce(e,t,o){const n=t.collectionStore();n&&F().createAndCommit({userAction:"CollectionSettingsConfigureGithubAutomationCreateNewStatusProperty",environment:e,canUndo:!0,perform:i=>{const r=(0,O().createProperty)({environment:e,collectionStore:n,collectionViewArgs:void 0,propertyType:"status",transaction:i}),a=(0,J().Jq)(t,r);a&&(0,C().DD)(a)&&o({id:r,schema:a})}})}function de(){const e=(0,i().Y0)().isMobile;return(0,a().IS)((t=>({addStatusDivider:{borderColor:t.tableDividerColor},addStatusDescription:{width:"calc(100% - 24px)",padding:e?"16px 8px":"14px 0px",fontSize:e?16:12,color:t.text.tertiary},addStatusButton:{width:"calc(100% - 24px)",display:"inline-flex",alignItems:"center",justifyContent:"center"},noneText:{color:t.text.tertiary},automationMenuItemArrow:{width:12,fill:t.icon.tertiary,stroke:t.icon.tertiary,strokeOpacity:.5,strokeWidth:2},statusPickerWrapper:{display:"inline-flex",alignItems:"center",flexWrap:"wrap",rowGap:2,marginBottom:e?10:void 0},statusPickerButtonTextWrapper:{margin:"0px 4px",fontSize:12},statusPickerButtonCore:{minHeight:e?28:20,borderRadius:5,maxWidth:e?150:100},statusPickerIcon:{width:ee,height:ee},statusPickerExtensionArrow:{transform:"rotate(180deg)",marginInlineEnd:2}})),[e])}var ue=()=>o(283860);const pe=(0,d().YK)({connect:{defaultMessage:"Connect to GitHub (Workspace)",id:"database.viewSettings.githubConfigTab.connect"},connectDescriptionAdmin:{defaultMessage:"Ask your workspace admin to configure the GitHub (Workspace) connection.",id:"database.viewSettings.githubConfigTab.connectDescriptionAdmin"},authError:{defaultMessage:"Auth failed. Please try again or contact Notion support.",id:"database.viewSettings.githubConfigTab.authError"},tabDescriptionNoIdPrefix:{defaultMessage:"This feature requires a prefixed ID property to link GitHub PRs to Notion {pluralItemName}.",id:"database.viewSettings.githubConfigTab.tabDescriptionNoIdPrefix"},tabDescriptionNoStatus:{defaultMessage:"Link PRs by adding the {singleItemName} ID to the PR title.",id:"database.viewSettings.githubConfigTab.tabDescriptionNoStatus"},tabDescription:{defaultMessage:"Link PRs by adding the {singleItemName} ID to the PR title. Set up automated status updates in Notion based on PR status changes.",id:"database.viewSettings.githubConfigTab.tabDescription"}});function me(e){const{collectionContextStore:t,property:o}=e,i=(0,d().tz)(),[a,l]=(0,n.useState)(void 0),c=(0,S().uF)({featureName:"collection_connected_property_github"}),u=(0,r().K8)((()=>{const e=b().A.bots.state.find((e=>e.integration_id===s().ob));return Boolean(e)}),[]);return null!=c&&c.isAvailable?u?(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(fe,{collectionContextStore:t}),(0,Q.jsx)(ye,{collectionContextStore:t,intl:i,selectedStatusProperty:a}),(0,Q.jsx)(he,{collectionContextStore:t}),(0,Q.jsx)(Se,{collectionContextStore:t,selectedStatusProperty:a,setSelectedStatusProperty:l,property:o,intl:i})]}):(0,Q.jsx)(ge,{collectionContextStore:t,intl:i}):null}function ge({collectionContextStore:e,intl:t}){const o=we(),{hoveredBackground:n,pressedBackground:a}=xe(),s=(0,v().J)(),c=(0,i().v3)(),d=be(),u=function(e){return(0,r().K8)((()=>{var t;return null===(t=e.collectionStore())||void 0===t?void 0:t.getSpaceId()}),[e])}(e);return(0,Q.jsxs)(y().A,{disableMobileBorders:!0,mobileStyle:o.previewContentContainer,style:o.previewContentContainer,children:[(0,Q.jsx)("img",{src:"/images/external_integrations/github-icon.png",style:{width:36,height:36}}),(0,Q.jsx)("p",{style:o.connectDescription,children:s?(0,g().Jb)().description:t.formatMessage(pe.connectDescriptionAdmin)}),(0,Q.jsx)(l().p,{style:o.connectButton,hoveredStyle:{background:n},pressedStyle:{background:a},disabled:!s,disabledFeedback:!s,onClick:async e=>{if(e.preventDefault(),u&&d)try{await m().Jq({environment:c,spaceId:u,integration:d,from:"connected_relation_property_menu"})}catch(o){const e=t.formatMessage(pe.authError);p().f1(e)}},children:t.formatMessage(pe.connect)}),(0,Q.jsx)(h().A,{size:4})]})}function fe({collectionContextStore:e}){const t=we(),{isMobile:o}=(0,i().Y0)(),n=ve(e);return(0,Q.jsxs)(y().A,{disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0,mobileStyle:t.previewContentContainer,style:t.previewContentContainer,children:[(0,Q.jsx)(h().A,{size:o?16:8}),(0,Q.jsx)(ue().A,{width:"calc(100% - 24px)",uniqueIdPrefix:null==n?void 0:n.prefix})]})}function ye({collectionContextStore:e,intl:t,selectedStatusProperty:o}){const n=(0,r().K8)((()=>e.databaseType),[e]),i=ve(e),a=we(),l=(0,f().$O)(n),s=(0,f().oj)(n);let c;return c=i&&i.prefix?o?t.formatMessage(pe.tabDescription,{singleItemName:l}):t.formatMessage(pe.tabDescriptionNoStatus,{singleItemName:l}):t.formatMessage(pe.tabDescriptionNoIdPrefix,{pluralItemName:s}),(0,Q.jsx)(y().A,{disableMobileBorders:!0,disableMobilePadding:!0,mobileStyle:a.tabDescription,style:a.tabDescription,children:c})}function he({collectionContextStore:e}){const t=ve(e);return t&&t.prefix?null:(0,Q.jsx)(x().A,{collectionContextStore:e,uniqueIdProperty:t&&{property:t.id,propertySchema:t.schema},prefixValue:null==t?void 0:t.prefix})}function Se({collectionContextStore:e,selectedStatusProperty:t,setSelectedStatusProperty:o,property:n,intl:i}){const r=ve(e);return r&&r.prefix?(0,Q.jsx)(ae,{selectedStatusProperty:t,setSelectedStatusProperty:o,gitHubProperty:n,intl:i}):null}function ve(e){return(0,r().K8)((()=>{var t,o;const n=null===(t=e.collectionStore())||void 0===t||null===(t=t.getRecordKeyStore())||void 0===t?void 0:t.getRecordKey(),i=null===(o=e.collectionStore())||void 0===o?void 0:o.getSchema(),r=i&&(0,u().WP)(i).find((([,e])=>e&&"auto_increment_id"===e.type));if(r){const[e,t]=r;if(t&&"auto_increment_id"===t.type)return{id:e,schema:t,prefix:n}}}),[e])}function be(){return(0,r().K8)((()=>b().A.integrations.state.find((e=>e.id===s().ob))),[])}function xe(){const e=be(),t=(0,a().eP)();return(0,r().K8)((()=>(0,c().u)(e,t)),[e,t])}function we(){const{isMobile:e}=(0,i().Y0)(),{background:t}=xe();return(0,a().IS)((o=>({previewContentContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},connectButton:{fontSize:14,maxWidth:"calc(100% - 24px)",height:void 0,color:o.text.inversePrimary,background:t,whiteSpace:"normal",padding:8,textAlign:"center"},connectDescription:{maxWidth:"calc(100% - 24px)",color:o.text.tertiary,fontSize:14,textAlign:"center"},tabDescription:{padding:e?18:14,fontSize:e?16:12,color:o.text.tertiary}})),[e,t])}},181922:(e,t,o)=>{o.d(t,{g:()=>a});var n=()=>o(302107),i=()=>o(972435),r=()=>o(901389);function a(e){const{collectionContextStore:t,propertyId:o,propertySchema:a,handlePropertyTypeChange:l}=e,s=t.collectionStore();if(s)if(a&&(0,n().dR)({propertyId:o,propertyType:a.type,permissionItems:s.getPermissionItems()})){const e=[{label:i().A.formatMessage(n().DZ.changePropertyTypeWarningButtonLabel),color:"red",onAccept:l}];r().ui({showCancel:!0,keepFocus:!1,message:i().A.formatMessage(n().DZ.changePropertyTypeWarningMessage),description:i().A.formatMessage(n().DZ.changePropertyTypeWarningDescription),mode:"wide",items:e})}else l()}},208698:(e,t,o)=>{o.d(t,{$:()=>s});var n=o(296540),i=()=>o(484714),r=()=>o(69708),a=()=>o(383594),l=()=>o(486666);function s(e){const{iconButton:t,onDelete:o}=e,s=(0,i().v3)(),c=(0,r().tz)();return(0,n.useCallback)((e=>{if(!(t&&e.target instanceof Element))return;const{onSubmit:n,enforceIconColor:i}=t;a().W(s,{originRect:e.target.getBoundingClientRect(),originGap:3,popupHeight:l().GF,popupWidth:l().jv,showArrow:!0,title:c.formatMessage({defaultMessage:"Icon",id:"mediaPicker.tabs.icon"}),currentTab:"icon",tabs:[{type:"icon",enforceIconColor:i,onChange:(e,t)=>{n(e),t&&t.keepVisible||a().I()}}],onDelete:()=>{null==o||o(),n(),a().I()}})}),[s,t,c,o])}},212854:(e,t,o)=>{o.d(t,{W:()=>p,e:()=>m});o(16280),o(944114),o(898992),o(354520);var n=()=>o(792071),i=()=>o(179034),r=()=>o(798880),a=()=>o(743246),l=()=>o(71621),s=()=>o(498212),c=()=>o(559506),d=()=>o(231297),u=()=>o(878710);const p={shouldTriggerOnPageContentUpdate:!1,shouldTriggerOnPageCreate:!0,shouldTriggerOnPropertyUpdate:!1};async function m(e){var t,o;const{environment:m,collectionStore:g,propertyId:f,propertySchema:y,collectionContextStore:h}=e,S=g.getSpaceId(),v=g.id,b=m.currentUser.id;if(!b)throw new Error("User ID is required to create agent");const x=await m.idCreator.idWithSpaceId(S,a().C0),w=g.getParentId();if(g.getParentTable()!==i().ev||!w)throw new Error("Collection must have a parent block to attach agent");const C=w,A={table:i().ev,id:C,spaceId:S},j={type:"notion",id:(0,s().Ay)(),name:`Autofill "${y.name}"`,version:l().IN.latestVersion,permissions:[{moduleType:"notion",type:"notion",identifier:{type:"pageOrCollectionViewBlock",blockId:C},actions:["read_and_write"]},{moduleType:"notion",type:"notion",identifier:{type:"workspacePublic"},actions:["reader"]},{moduleType:"notion",type:"search",identifier:{type:"web"},actions:["allow"]}],state:{ownedByDatabasePropertyIds:[f]}},M=(null===(t=h.remoteResultStore.state)||void 0===t?void 0:t.sizeHint)??1e3,I={name:`Autofill "${y.name}"`,triggers:[],instructions:[],modules:[j],usage_limit:{type:"runLimit",maximum:Math.max(5*M,1e3)}},{operations:k,model:T}=n().Bgh.create({id:x,parentPointer:A,space_id:S,data:I,createdByPointer:{table:r().oo,id:b},permissions:[{type:"space_permission",role:"read_and_write"}]}),_=[],P=g.getSchema(),R=Object.keys(P).filter((e=>e!==f)),B=function(e){const{collectionId:t,shouldTriggerOnPageContentUpdate:o,shouldTriggerOnPageCreate:n,shouldTriggerOnPropertyUpdate:i,propertyIds:r}=e,a=[{id:(0,s().Ay)(),name:"Database agent manually triggered",moduleId:void 0,enabled:!0,state:{type:"notion.button.pressed"}}],l={id:(0,s().Ay)(),name:"Database Agent Updated",moduleId:void 0,enabled:!0,state:{type:"notion.database.agent.updated",collectionId:t}};if(a.push(l),o){const e={id:(0,s().Ay)(),name:"Page Updated",moduleId:void 0,enabled:!0,state:{type:"notion.page.updated",collectionId:t,propertyIds:i?r:[],shouldIgnorePageContentUpdates:!o}};a.push(e)}if(n){const e={id:(0,s().Ay)(),name:"Page Created",moduleId:void 0,enabled:!0,state:{type:"notion.page.created",collectionId:t}};a.push(e)}return a}({...p,propertyIds:R,collectionId:v});for(const n of B){const e={pointer:T.pointer,command:"keyedObjectListAfter",path:["data","triggers"],args:{value:n}};_.push(e)}const D={command:"listAfter",path:["format","database_agent_ids"],pointer:A,args:{id:T.id}},O=g.getParentStore();if(!O)throw new Error("Collection must have a parent store");const F=[..._,D],K=g.pointer;if(void 0===(null===(o=g.getSchema()[f])||void 0===o?void 0:o.default_workflow_id)){const e={pointer:K,command:"update",path:["schema",f,"default_workflow_id"],args:x};F.push(e)}const{serverCommitResult:V}=d().createAndCommit({userAction:"TableHeaderCellMenu.createClientDbAgentWithTriggers",environment:m,canUndo:!1,perform:e=>{for(const t of k)d().applyOperation({store:(0,u().v3)(O,t.pointer),operation:t,transaction:e});for(const t of F)d().applyOperation({store:(0,u().v3)(O,t.pointer),operation:t,transaction:e})}}),z=[...k,...F];return await V,await c().callApi({eventName:"publishCustomAgentVersion",environment:m,data:{workflowId:x,spaceId:S}}),{workflowId:x,operations:z}}},283860:(e,t,o)=>{o.d(t,{A:()=>d});o(296540);var n=()=>o(484714),i=()=>o(401497),r=()=>o(148307),a=()=>o(69708),l=()=>o(284371),s=()=>o(132389),c=o(474848);function d(e){const t=(0,a().tz)(),o=function(e){const{isMobile:t}=(0,n().Y0)(),o=t?18:14,r=1,a=6,s=20;return(0,i().IS)((t=>({githubContainer:{display:"flex",alignSelf:"center",flexDirection:"column",width:e||"90%",padding:s,border:`${r}px solid ${t.tableDividerColor}`,borderRadius:a,borderEndEndRadius:6,cursor:"default"},githubPrTitleRow:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",width:`calc(100% + ${s}px)`,overflow:"hidden"},githubPrTitle:{display:"inline-flex",fontSize:o,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",background:t.whiteButtonBackground,padding:"2px 4px",borderStartStartRadius:5,borderEndStartRadius:5,borderInlineStart:`2px solid ${t.blue.border.accentPrimary}`,borderTop:`2px solid ${t.blue.border.accentPrimary}`,borderBottom:`2px solid ${t.blue.border.accentPrimary}`,width:"100%"},githubTask:{background:"light"===t.mode?t.palette.blue[50]:t.palette.blue[400]},githubPrInfoRow:{display:"inline-flex"},githubPrInfoPill:{display:"flex",flexDirection:"row",alignItems:"center",width:"fit-content",padding:"4px 10px",borderRadius:"2em",background:"#238636",flexShrink:0,...l().RC},githubPrInfoOpenText:{color:"white",fontSize:o-2,fontWeight:500},githubPrInfoMergeInto:{display:"inline-flex",alignItems:"center",fontSize:o-2,color:t.text.tertiary,...l().RC},githubPrInfoMain:{padding:"0px 4px",fontFamily:l().Tf.githubMono,background:t.cardPressedBackground,borderRadius:a,color:t.text.primary,verticalAlign:"text-bottom",...l().RC}})),[o,e])}(e.width),d=(0,c.jsx)("div",{id:"github-preview-github-pr-title-row",style:o.githubPrTitleRow,children:(0,c.jsxs)("div",{id:"github-preview-github-pr-title-wrapper",style:o.githubPrTitle,children:[(0,c.jsx)(s().A,{size:2}),"[",(0,c.jsxs)("div",{id:"github-preview-github-pr-task",style:o.githubTask,children:[e.uniqueIdPrefix||t.formatMessage(u.idPrefix),e.uniqueIdValue?`-${e.uniqueIdValue}`:"-1"]}),"]",(0,c.jsx)(s().A,{size:2}),t.formatMessage(u.prTitle)]})}),p=(0,c.jsxs)("div",{id:"github-preview-github-pr-info-row",style:o.githubPrInfoRow,children:[(0,c.jsxs)("div",{id:"github-preview-github-open-pr-pill",style:o.githubPrInfoPill,children:[(0,c.jsx)("img",{src:r().A.images.externalIntegrations.githubPullOpenIconWhitePng,style:{width:16,height:16}}),(0,c.jsx)(s().A,{size:2}),(0,c.jsx)("div",{style:o.githubPrInfoOpenText,children:t.formatMessage(u.open)})]}),(0,c.jsx)(s().A,{size:8}),(0,c.jsx)("div",{id:"github-preview-github-merge-into-main",style:o.githubPrInfoMergeInto,children:(0,c.jsxs)("span",{style:o.githubPrInfoMergeInto,children:[t.formatMessage(u.mergeInto),(0,c.jsx)(s().A,{size:4}),(0,c.jsx)("span",{style:o.githubPrInfoMain,children:t.formatMessage(u.main)})]})})]});return(0,c.jsxs)("div",{id:"github-preview-github-container",style:o.githubContainer,children:[d,(0,c.jsx)(s().A,{size:12}),p]})}const u=(0,a().YK)({idPrefix:{defaultMessage:"TASK",id:"database.viewSettings.githubConfigTab.preview.idPrefix"},prTitle:{defaultMessage:"GitHub PR Title",id:"database.viewSettings.githubConfigTab.preview.prTitle"},open:{defaultMessage:"Open",id:"database.viewSettings.githubConfigTab.preview.open"},mergeInto:{defaultMessage:"Merge into",id:"database.viewSettings.githubConfigTab.preview.mergeInto"},main:{defaultMessage:"main",id:"database.viewSettings.githubConfigTab.preview.main"}})},363631:(e,t,o)=>{o.d(t,{A:()=>l});var n=o(296540),i=()=>o(69708),r=o(474848);function a({setAiInference:e,aiInference:t,disabled:a}){const l=(0,n.useRef)(o(206267).JW()),s=()=>{if(!t)return;const o={...t,add_options:!t.add_options};e(o)};return(0,r.jsx)(o(859428).A,{renderTooltip:()=>(0,r.jsx)(i().sA,{id:"collectionSettingsAiAutofillAddOptionsToggle.title.description",defaultMessage:"New options are created based on property name & page details"}),placement:"bottom",render:e=>(0,r.jsx)(o(497222).A,{title:(0,r.jsx)(i().sA,{id:"collectionSettingsAiAutofillAddOptionsToggle.title.text",defaultMessage:"Generate new options"}),showChevron:!1,right:(0,r.jsx)(o(581369).A,{inputId:l.current,on:Boolean(null==t?void 0:t.add_options),onClick:s,disabled:!1,noColor:!1}),onClick:s,disabled:Boolean(a),textWrapperStyle:{minWidth:"auto"},...e})})}const l=n.memo(a)},402560:(e,t,o)=>{o.d(t,{R5:()=>c,gY:()=>l,so:()=>d,uG:()=>s});o(944114),o(898992),o(823215),o(354520),o(581454);var n=()=>o(824862),i=()=>o(743246),r=()=>o(319625),a=()=>o(201718);function l(e){const{workflowsData:t,collectionViewBlockStore:o,currentCollectionStore:n,property:r,spaceId:l}=e;if(0===t.length||!n)return[];const s=[];for(const i of t)"none"!==i.access&&i.collectionId===n.id&&s.push(i.workflowId);return s.map((e=>a().N.createChildStore(o,{table:i().C0,id:e,spaceId:l}))).filter((e=>{const t=e.getDraftData()??e.getData(),o=null==t?void 0:t.modules;for(const i of o??[]){var n;if("notion"===i.type)return(null===(n=i.state)||void 0===n||null===(n=n.ownedByDatabasePropertyIds)||void 0===n?void 0:n.includes(r))??!1}return!1}))}function s(e){const{workflowsData:t,collectionViewBlockStore:o,currentCollectionStore:n,spaceId:r}=e;if(0===t.length||!n)return[];const l=[];for(const i of t)"none"!==i.access&&i.collectionId===n.id&&l.push(i.workflowId);return l.map((e=>a().N.createChildStore(o,{table:i().C0,id:e,spaceId:r})))}function c(e){const{workflowId:t,collectionViewBlockStore:o,spaceId:n}=e;return a().N.createChildStore(o,{table:i().C0,id:t,spaceId:n})}function d(e){const{collectionStore:t,spaceId:o}=e,i=t.getParentStore(),l=null==i?void 0:i.getFormat(),s=l&&"database_agent_ids"in l&&Array.isArray(l.database_agent_ids)?l.database_agent_ids:[];if(!i||!l||0===s.length)return{value:[]};const c=s.map((e=>{const t={id:e,table:"workflow",spaceId:o};return a().N.createChildStore(i,t)}));if(!c.every((e=>e.isDefined())))return{value:[]};try{return{value:c.map((e=>{const o=e.getData();let r;const a=null==o?void 0:o.runtime_actor_pointer;a&&a.table===n().GP&&(r=a.id);return{...{blockId:i.id,collectionId:t.id,workflowId:e.id,botId:r},access:"write"}}))}}catch(d){return{error:(0,r().A)(d)}}}},419167:(e,t,o)=>{o.d(t,{Ay:()=>I,GI:()=>j,Ve:()=>T,am:()=>M,jD:()=>k});var n=o(296540),i=()=>o(242422),r=()=>o(56366),a=()=>o(401497),l=()=>o(929219),s=()=>o(252291),c=()=>o(869190),d=()=>o(651124),u=()=>o(116089),p=()=>o(340498),m=()=>o(72135),g=()=>o(69708),f=()=>o(534177),y=()=>o(10521),h=()=>o(312540),S=()=>o(497222),v=()=>o(877568),b=()=>o(329304),x=()=>o(135221),w=()=>o(859428),C=o(474848);const A=36e5;function j({autofillFeatureAvailability:e}){const t=(0,C.jsx)(g().sA,{...h().fillAllPagesMessages.fillAllPagesAddAiMessage});return(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{style:{color:"white",fontWeight:500,wordWrap:"break-word",whiteSpace:"pre-wrap"},children:(0,C.jsx)(g().sA,{...h().fillAllPagesMessages.fillAllPagesTooltip})}),(0,b().e2)(e)?void 0:(0,C.jsx)("div",{style:{color:"#ACABA9",fontWeight:500},children:t})]})}function M({updateAiInferencesTaskStatus:e,iconStyle:t,progressIconStyle:o}){return(0,v()._)({taskRunningState:e})?(0,C.jsx)("div",{style:o,children:(0,C.jsx)(x().A,{})}):(0,C.jsx)("div",{style:{display:"flex",alignItems:"center",height:"100%"},children:(0,C.jsx)(s().I,{icon:u().x,style:t})})}function I({updateAiInferencesTaskStatus:e}){const t=(0,g().tz)(),o=(0,r().K8)((()=>i().default.checkGate({gateName:"autofill_all_pages_use_new_endpoint"})?(0,C.jsx)(g().sA,{defaultMessage:"Autofill this view",id:"aiAutofill.fillAllPagesInView.buttonTitle"}):(0,C.jsx)(g().sA,{defaultMessage:"Autofill all pages",id:"aiAutofill.fillAllPages.buttonTitle"})),[]),l=(0,n.useMemo)((()=>{switch(e.status){case"requested":return(0,C.jsx)(g().sA,{defaultMessage:"Requested Autofill",id:"AiAutofill.fillAllPages.requested"});case"notRunning":case"error":return o;case"running":const n=0!==e.lastEditedTime&&Date.now()-e.lastEditedTime>A;return e.numPagesFilled>=e.numPagesRequested||n?o:(0,C.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",gap:"4px"},children:[(0,C.jsx)(g().sA,{defaultMessage:"{numPagesRequested, plural, one {Autofilling {numPagesFilled} of {numPagesRequested} page} other {Updating {numPagesFilled} of {numPagesRequested} pages}}",id:"aiAutofill.fillallPages.updatingAllPagesWithProgress",values:{numPagesFilled:(0,m().ZV)(e.numPagesFilled,"compact",t),numPagesRequested:(0,m().ZV)(e.numPagesRequested,"compact",t)}}),0!==e.lastEditedTime?(0,C.jsx)("div",{style:{fontSize:"12px"},children:(0,C.jsx)(g().sA,{defaultMessage:"Last edited: {lastEditedTime}",id:"aiAutofill.fillallPages.lastEditedTime",values:{lastEditedTime:(0,c().W_)(e.lastEditedTime,"month_day_time",t.locale)}})}):void 0]});default:(0,f().HB)(e)}}),[o,t,e]),s=(0,a().IS)((()=>({textWrapper:{display:"flex",alignItems:"center",overflow:"hidden"}})),[]);return(0,C.jsx)("div",{style:s.textWrapper,children:l})}function k({updateAiInferencesTaskStatus:e}){const t=(0,a().IS)((e=>({inner:{background:e.palette.purple[400],height:"100%",transition:"width .5s"},outer:{background:e.palette.gray[100],height:3,borderRadius:2,minWidth:120,overflow:"hidden",marginTop:8}})),[]);switch(e.status){case"notRunning":case"requested":case"error":return null;case"running":break;default:(0,f().HB)(e)}const{numPagesFilled:o,numPagesRequested:n}=e;return 0===n||o===n?null:(0,C.jsx)("div",{style:t.outer,role:"progressbar",children:(0,C.jsx)("div",{style:{...t.inner,width:100*Math.min(o/n,1)+"%"}})})}function T(e){const{environment:t,collectionContextStore:o,property:i,propertySchema:a,autofillFeatureAvailability:s,isAutofillSetupEnabled:c}=e,u=!(0,r().O$)(l().e),m=(0,r().K8)((()=>{const e=o.collectionStore();return e?(0,d().Ts)(e.getFormat(),i):{status:"notRunning"}}),[o,i]),f=(0,n.useCallback)((async e=>{const n=o.collectionStore(),r=o.collectionViewStore();n&&a&&r&&((0,b().e2)(e)?await h().autofillPropertyForCollection({environment:t,collectionStore:n,propertySchema:a,property:i,collectionViewStore:r}):h().triggerAiAutofillUpsell({environment:t,from:"ai_autofill_fill_all_pages",upsell:e.upsell}))}),[t,a,i,o]),x=(0,v()._)({taskRunningState:m});return(0,C.jsx)(w().A,{disableTooltip:(0,b().e2)(s),renderTooltip:()=>u?(0,C.jsx)(g().sA,{...y().AY.aiUnavailableOfflineTooltip}):(0,C.jsx)(j,{autofillFeatureAvailability:s}),render:e=>(0,C.jsx)(S().A,{icon:e=>(0,C.jsx)(M,{updateAiInferencesTaskStatus:m,iconStyle:e,progressIconStyle:{width:p().Ev.sm,marginTop:4,marginInlineStart:4,marginInlineEnd:2}}),title:(0,C.jsx)(I,{updateAiInferencesTaskStatus:m}),caption:x&&"requested"!==m.status&&(0,C.jsx)(k,{updateAiInferencesTaskStatus:m}),focused:!1,onClick:()=>f(s),disabled:x||!c||u,...e})})}},422068:(e,t,o)=>{o.d(t,{u:()=>s});var n=o(296540),i=()=>o(252291),r=()=>o(69708),a=o(474848);const l=(0,r().YK)({displayAsLabel:{id:"database.viewSettings.statusOptions.displayAs",defaultMessage:"Display as"},statusCheckboxLabel:{id:"database.viewSettings.statusOptions.showAs.checkbox",defaultMessage:"Checkbox"},statusSelectLabel:{id:"database.viewSettings.statusOptions.showAs.selectOptionLabel",defaultMessage:"Select"}}),s=n.memo((function(e){const{collectionContextStore:t,property:s,disabled:c}=e,d=(0,o(484714).v3)(),u=(0,r().tz)(),{propertySchema:p,showAs:m}=(0,o(56366).K8)((()=>{var e;const o=t.normalizedSchemaStore.state[s];return{propertySchema:o&&"status"===o.type?o:void 0,showAs:(null===(e=t.getPropertyFormat(s))||void 0===e?void 0:e.statusShowAs)??"select"}}),[t,s]),g=(0,n.useCallback)((e=>{const n=t.formatStore();if(!n)return;const i=t.getPropertyFormatKey();i&&(o(231297).createAndCommit({userAction:"CollectionSettingsStatusOptions.handleShowAsChange",environment:d,canUndo:!0,perform:t=>{(0,o(949658).a)({formatStore:n,formatKey:i,property:s,update:{statusShowAs:e,visible:!0},transaction:t})}}),(0,o(901952).V)({environment:d,collectionContextStore:t,property:s,from:"view_settings",action:"status_change_format"}))}),[t,d,s]),f=(0,o(401497).IS)((e=>({popup:{minWidth:190}})),[]),y=(0,n.useMemo)((()=>[{key:"checkbox",type:"button",title:u.formatMessage(l.statusCheckboxLabel),icon:(0,a.jsx)(i().I,{icon:o(396350).i})},{key:"select",type:"button",title:u.formatMessage(l.statusSelectLabel),icon:(0,a.jsx)(i().I,{icon:o(430401).b})}]),[u]);return p?(0,a.jsx)(o(828973).A,{icon:o(89849).eyeIcon,title:u.formatMessage(l.displayAsLabel),selectedKey:m,popupStyle:f.popup,options:y,onChange:g,disabled:c}):null}))},463620:(e,t,o)=>{o.d(t,{u:()=>u});o(296540);var n=()=>o(242422),i=()=>o(56366),r=()=>o(401497),a=()=>o(406094),l=()=>o(493552),s=()=>o(69708),c=()=>o(21140),d=o(474848);function u(e){const{workflowStore:t,onRequestIncrease:o,minified:u=!1}=e,p=(0,r().IS)((e=>({container:{paddingTop:14,paddingInlineEnd:16,paddingBottom:14,paddingInlineStart:20,backgroundColor:e.background.primary,border:`1px solid ${e.border.primary}`,borderRadius:14,marginBlock:12},containerMinified:{paddingTop:12,paddingInlineEnd:12,paddingBottom:12,paddingInlineStart:12,backgroundColor:e.background.primary,border:`1px solid ${e.border.primary}`,borderRadius:12,marginBlock:8}})),[]),m=(0,i().K8)((()=>{const e=t.getDraftData(),o=null==e?void 0:e.usage_limit,i=n().default.getConfig({configName:"custom_agent_sub_features"}),r=(null==i?void 0:i.default_run_limit)??100;return"runLimit"===(null==o?void 0:o.type)?o.maximum:r}),[t]),g=u?p.containerMinified:p.container,f=u?"Caption/Medium":"Body/Medium",y=u?"sm":"md",h=(0,d.jsxs)(c().Ye,{alignItems:"center",gap:4,children:[(0,d.jsx)(l().D,{styleKey:f,colorVariant:"primary",children:(0,d.jsx)(s().sA,{id:"workflow.runLimitReached.header",defaultMessage:"Run limit reached"})}),(0,d.jsx)(l().D,{styleKey:f,colorVariant:"secondary",children:(0,d.jsx)(s().sA,{id:"workflow.runLimitReached.count",defaultMessage:" · {maxRuns} / {maxRuns}",values:{maxRuns:m}})})]}),S=(0,d.jsx)(l().D,{styleKey:"Caption/Regular",colorVariant:"secondary",children:(0,d.jsx)(s().sA,{id:"workflow.runLimitReached.requestMessage",defaultMessage:"Request an increase to continue using this agent"})}),v=(0,d.jsx)(a().A,{onClick:o,size:y,children:(0,d.jsx)(s().sA,{id:"workflow.runLimitReached.requestIncrease",defaultMessage:"Request"})});return u?(0,d.jsxs)(c().wt,{gap:8,style:g,children:[h,S,v]}):(0,d.jsxs)(c().Ye,{alignItems:"center",justifyContent:"space-between",gap:12,style:g,children:[(0,d.jsxs)(c().wt,{gap:4,children:[h,S]}),v]})}},493612:(e,t,o)=>{o.d(t,{Z:()=>r});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(581454);function n(e){return`${e.rowId}:${e.propertyId}`}class i extends(()=>o(757695))().Store{getInitialState(){return{cellsBeingFilled:new Set}}startAIFill(e){const t=new Set([...this.state.cellsBeingFilled,...e.map((e=>n(e)))]);this.setState({...this.state,cellsBeingFilled:t})}startIndividualCellFill(e){const t=new Set([...this.state.cellsBeingFilled,n(e)]);this.setState({...this.state,cellsBeingFilled:t})}removeCellBeingFilled(e){const t=new Set(this.state.cellsBeingFilled);t.delete(n(e)),this.setState({...this.state,cellsBeingFilled:t})}isCellBeingFilled(e){return this.state.cellsBeingFilled.has(n(e))}clearAllCells(){this.setState({...this.state,cellsBeingFilled:new Set})}}const r=new i},503264:(e,t,o)=>{o.d(t,{e:()=>Q});o(16280),o(898992),o(672577),o(737550);var n=o(296540),i=()=>o(484714),r=()=>o(56366),a=()=>o(401497),l=()=>o(396896),s=()=>o(406094),c=()=>o(160432),d=()=>o(493552),u=o(474848);const p={viewBox:"0 0 16 16",fittedViewBox:"1.95 1.95 12.11 12.11",directional:!0,svg:(0,u.jsx)("path",{d:"M8 14.05a6.05 6.05 0 1 1 0-12.1 6.05 6.05 0 0 1 0 12.1m-.837-3.765 3.067-1.79a.574.574 0 0 0 0-.99l-3.067-1.79a.574.574 0 0 0-.863.496v3.578c0 .443.48.719.863.496"})},m=(0,o(340498).wt)("arrowTriangleRightCircleFillSmall",p);var g=()=>o(721479),f=()=>o(69708),y=()=>o(496603),h=()=>o(815510),S=()=>o(35091),v=(o(944114),o(354520),o(581454),()=>o(729108)),b=()=>o(898244),x=()=>o(906380),w=()=>o(534177),C=()=>o(760217),A=()=>o(406699),j=()=>o(404277),M=()=>o(939740),I=()=>o(89924),k=()=>o(722872);const T=(0,f().YK)({selectProperties:{id:"collectionSettings.propertySelection.selectProperties",defaultMessage:"Select"},moreCount:{id:"collectionSettings.propertySelection.moreCount",defaultMessage:"{count, plural, one {# more} other {# more}}"}});function _({schema:e,selectedProperties:t,onSelectionChange:o}){const i=(0,f().tz)(),r=(0,a().IS)((e=>({buttonContent:{width:"100%",marginInlineStart:-4,marginInlineEnd:-4,marginTop:4,marginBottom:4},fillDataLabel:{fontSize:14,color:e.text.primary},propertyLabel:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:200,fontSize:14,color:e.text.secondary},dropdownIcon:{color:e.text.tertiary,flexShrink:0,height:12,width:12,marginInlineStart:4},checkbox:{marginInlineEnd:8,flexShrink:0}})),[]),l=n.useMemo((()=>Object.keys(e).filter((t=>e[t]&&"title"!==e[t].type&&!b().rb.has(e[t].type)))),[e]),s=(0,n.useCallback)((e=>{const n=[...t],i=n.indexOf(e);i>-1?n.splice(i,1):n.push(e),n.length>0&&o(n)}),[t,o]),c=(0,n.useCallback)((()=>{if(0===t.length)return i.formatMessage(T.selectProperties);const o=t.map((t=>{var o;return null===(o=e[t])||void 0===o?void 0:o.name})).filter((e=>!!(0,w().O9)(e)));if(0===o.length)return i.formatMessage(T.selectProperties);const n=new Intl.ListFormat(i.locale,{style:"long",type:"conjunction"});if(o.length>2){const e=o.slice(0,2),t=o.length-2,r=i.formatMessage(T.moreCount,{count:t});return n.format([...e,r])}return n.format(o)}),[t,e,i]);return(0,u.jsx)(A().A,{popupType:A().z.Popup,renderOrigin:e=>(0,u.jsx)(C().A,{...e,focused:!1,buttonStyle:r.buttonContent,title:(0,u.jsx)("span",{style:r.fillDataLabel,children:(0,u.jsx)(f().sA,{defaultMessage:"Fill data in",id:"collectionSettings.propertyAgentAutofill.fillDataTitle"})}),right:(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,u.jsx)("span",{style:r.propertyLabel,children:c()}),(0,x().arrowChevronSingleRightSmallIcon)(r.dropdownIcon)]})}),render:()=>(0,u.jsx)(j().A,{menuType:k().gu.Popup,minWidth:200,maxHeight:360,children:(0,u.jsx)(M().Ay,{type:M().Oh.Vertical,sections:[{key:"properties",items:l.map((o=>({key:o,action:()=>s(o),render:n=>{var i;return(0,u.jsx)(C().A,{...n,role:"menuitemcheckbox",title:(null===(i=e[o])||void 0===i?void 0:i.name)||o,left:(0,u.jsx)("div",{style:r.checkbox,children:(0,u.jsx)(v().S,{checked:t.includes(o),size:16,onClick:()=>s(o)})}),onClick:()=>s(o)})}}))),render:e=>(0,u.jsx)(I().A,{...e})}],initialFocus:void 0})})})}var P=()=>o(212854),R=()=>o(802790),B=()=>o(285790),D=()=>o(859428),O=()=>o(402560),F=()=>o(629509),K=()=>o(553965),V=()=>o(724833),z=()=>o(463620),N=()=>o(247331),W=()=>o(239381),q=()=>o(756005),Y=()=>o(519831),U=()=>o(319975),L=()=>o(231297),E=()=>o(712855),H=()=>o(792540),G=()=>o(741198),$=()=>o(693202);function J(e){const{store:t,collectionStore:o,placeholder:s,style:c,minHeight:p,footer:m,disabled:g=!1}=e,y=(0,i().v3)(),h=(0,r().K8)((()=>t.getValue()),[t]),S=(0,G().Q7)({textStore:t,initialFocus:!h}),v=!S.isFocused&&!h,b=(0,a().IS)((e=>({container:{display:"flex",flexDirection:"column",width:"100%",minHeight:p??56,cursor:"text",background:e.background.elevated,borderRadius:6,boxShadow:S.isFocused?`0 0 0 2px ${e.blue.border.accentPrimary}`:e.shadow.outline.sm,boxSizing:"border-box",padding:2,...v&&{boxShadow:`0 0 0 2px ${e.red.text.accentPrimary}`}},textContainer:{padding:(null==c?void 0:c.padding)??"6px 8px",maxHeight:240,overflow:"auto",fontSize:14},placeholder:{opacity:1,cursor:"text"}})),[S.isFocused,c,p,v]),x=(0,r().K8)((()=>({table:Y().Vl,id:o.id,spaceId:o.getSpaceId()})),[o]),w=(0,n.useMemo)((()=>{if(!x)return[];return[{id:(0,W().QF)(`collection_${x.id}`),kind:N().FormulaContextValueKind.ContextValue,name:"Current page",type:{type:"block",collection:x}}]}),[x]),C=(0,n.useMemo)((()=>(0,q().Yz)({page:!1,createPage:!0,collection:!0,user:!0,inviteUserToWorkspace:!0,inviteUserToPage:!0,date:!1,reminder:!0,bot:!0,heading:!0,group:!0,team:!0,templateVariable:!0,slackSpecialMention:!0,formulaContextVariable:!0,property:!1})),[]),A=(0,n.useCallback)((e=>{var t;null===(t=e.preventDefault)||void 0===t||t.call(e);const o=$().default.state;"editing"===o.mode&&L().createAndCommit({userAction:"DatabaseAgentTextInput.handleEnter",environment:y,canUndo:!0,perform:e=>{U().$D({environment:y,editorMode:"default",string:"\n",multiSelection:o.multiSelection,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:e})}})}),[y]),j=(0,n.useRef)(null),M=(0,n.useCallback)((e=>{e.target===j.current&&S.focus()}),[S]);return(0,u.jsxs)(l().VP,{children:[(0,u.jsxs)("div",{style:b.container,role:"textbox",ref:j,onPointerDown:M,children:[(0,u.jsx)(E().A,{style:b.textContainer,placeholder:s,disabled:g,onChange:e.onChange,store:t,placeholderStyle:b.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!0,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableEnter:!1,onEnter:A,onTab:()=>!0,onUntab:()=>!0,onFocus:S.focus,onBlur:S.blur,disableMobileActionBar:!0,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!0,disableSuggestEdit:!0,inPageFind:H().Os.none,usePopupForMentionOnMobile:!0,disabledMentionTypes:C,formulaValueTypes:w,mentionSectionOrdering:["property"],collectionStore:o}),m]}),v?(0,u.jsx)(d().D,{colorPalette:"red",colorVariant:"accentPrimary",styleKey:"Caption/Regular",children:(0,u.jsx)(f().sA,{defaultMessage:"This field is required",id:"databaseAgentTextInput.requiredErrorLabel"})}):void 0]})}const Z={canSearchWorkspace:!0,canSearchWeb:!0};const X=(0,f().YK)({previewOptionFirstPage:{id:"propertyAgentAutofillMenu.preview.option.firstPage",defaultMessage:"First page"},previewOptionFirst5Pages:{id:"propertyAgentAutofillMenu.preview.option.first5Pages",defaultMessage:"First 5 pages"},previewOptionFirst10Pages:{id:"propertyAgentAutofillMenu.preview.option.first10Pages",defaultMessage:"First 10 pages"},previewOptionAllPages:{id:"propertyAgentAutofillMenu.preview.option.allPages",defaultMessage:"All pages in this view"},inputPlaceholder:{defaultMessage:"Add specific instructions for your agent, e.g., ‘Fill in the most recent company’.",id:"propertyAgentAutofillMenu.placeholder"},onPageCreation:{defaultMessage:"On page creation",id:"propertyAgentAutofillMenu.triggerOnCreate"},onPageUpdate:{defaultMessage:"On page update",id:"propertyAgentAutofillMenu.triggerOnUpdate"},searchWorkspace:{defaultMessage:"Any workspace pages",id:"propertyAgentAutofillMenu.searchWorkspace"},searchWeb:{defaultMessage:"Anything on the web",id:"propertyAgentAutofillMenu.searchWeb"},createAgent:{defaultMessage:"Create agent",id:"propertyAgentAutofillMenu.createAgent"},saveChanges:{defaultMessage:"Save changes",id:"propertyAgentAutofillMenu.saveChanges"},runAutoFill:{defaultMessage:"Run auto-fill now",id:"propertyAgentAutofillMenu.runAutoFill"},noConfig:{defaultMessage:"No agent configuration found.",id:"propertyAgentAutofillMenu.noConfig"},instructionsTitle:{defaultMessage:"Instructions",id:"propertyAgentAutofillMenu.instructions.title"},sourcesTitle:{defaultMessage:"Sources",id:"propertyAgentAutofillMenu.sources.title"},sourcesTooltip:{defaultMessage:"This agent only searches the selected sources",id:"propertyAgentAutofillMenu.sources.tooltip"},setAsDefault:{defaultMessage:"Set as default",id:"propertyAgentAutofillMenu.setAsDefault"},hasSelectOrMultiselectWithNoOptions:{defaultMessage:"All select and multi-select properties must have options",id:"propertyAgentAutofillMenu.hasSelectOrMultiselectWithNoOptions"},onPageCreationTooltip:{defaultMessage:"The agent automatically fills this property when new pages are created",id:"propertyAgentAutofillMenu.onPageCreationTooltip"},onPageUpdateTooltip:{defaultMessage:"The agent automatically fills this property when the page is updated",id:"propertyAgentAutofillMenu.onPageUpdateTooltip"},creatingAgent:{defaultMessage:"Creating agent...",id:"propertyAgentAutofillMenu.creatingAgent"}});function Q(e){const{collectionContextStore:t,collectionStore:o,handleCloseParent:p=(()=>{}),numWorkflowsForProperty:v=1,property:b,propertySchema:x,spaceId:w,workflowId:T}=e,N=(0,i().v3)(),W=(0,f().tz)(),[q,Y]=(0,n.useState)(!1),U=(0,r().K8)((()=>{const e=o.getParentCollectionViewBlockStore();return e?(0,O().R5)({workflowId:T,collectionViewBlockStore:e,spaceId:w}):null}),[o,T,w]),L=(0,r().K8)((()=>{const e=(null==U?void 0:U.getDraftDataStore())??(null==U?void 0:U.getDataStore());return null==e?void 0:e.getKeyStore("instructions")}),[U]),E=(0,r().K8)((()=>{if(!U)return P().W;const e=U.getDraftData()??U.getData();let t=!1,o=!1,n=!1;if(e){var i,r;a="notion.page.created",o=!(null==e||!e.triggers)&&e.triggers.some((e=>{var t;return(null===(t=e.state)||void 0===t?void 0:t.type)===a}));const l=null===(i=e.triggers)||void 0===i?void 0:i.find((e=>{var t;return"notion.page.updated"===(null===(t=e.state)||void 0===t?void 0:t.type)&&e.enabled}));l&&"notion.page.updated"===(null===(r=l.state)||void 0===r?void 0:r.type)&&(n=Boolean(l.state.propertyIds&&l.state.propertyIds.length>0),t=!l.state.shouldIgnorePageContentUpdates)}var a;return{shouldTriggerOnPageContentUpdate:t,shouldTriggerOnPageCreate:o,shouldTriggerOnPropertyUpdate:n}}),[U]),H=(0,r().K8)((()=>{var e,t,o;if(!U)return Z;const n=U.getDraftData()??U.getData(),i=null==n||null===(e=n.modules)||void 0===e?void 0:e.find((e=>"notion"===e.type));if(!i)return Z;const r=null===(t=i.permissions)||void 0===t?void 0:t.some((e=>{var t;return"notion"===e.type&&"workspacePublic"===(null===(t=e.identifier)||void 0===t?void 0:t.type)})),a=null===(o=i.permissions)||void 0===o?void 0:o.some((e=>{var t;return"search"===e.type&&"web"===(null===(t=e.identifier)||void 0===t?void 0:t.type)}));return{canSearchWorkspace:Boolean(r),canSearchWeb:Boolean(a)}}),[U]),G=(0,r().K8)((()=>{var e;if(!U)return[];const t=U.getDraftData()??U.getData(),o=null==t||null===(e=t.modules)||void 0===e?void 0:e.find((e=>"notion"===e.type));if(o&&"state"in o&&o.state){return o.state.ownedByDatabasePropertyIds??[]}return[]}),[U]),$=(0,r().K8)((()=>!!U&&U.hasBeenPublished()),[U]),Q=(0,n.useCallback)(((e,t)=>{U&&o&&h().gT({workflowStore:U,currentCollectionStore:o,environment:N,spaceId:w,properties:G,triggerStates:E,triggerType:e,enabled:t})}),[N,U,G,E,o,w]),ee=(0,n.useCallback)((e=>{if(!U||!o)return;const t=function(e){const t=null==e?void 0:e.getParentCollectionViewBlockStore();if(t)return t.id}(o);if(!t)throw new Error("Collection must have a parent block to update permissions");h().$6({workflowStore:U,environment:N,spaceId:w,newSearchStates:e,collectionViewBlockId:t})}),[N,U,o,w]),te=(0,n.useCallback)((e=>{U&&o&&h().r1({workflowStore:U,environment:N,spaceId:w,selectedProperties:e})}),[N,U,o,w]),oe=(0,r().K8)((()=>o.getSchema()),[o]),ne=(0,n.useCallback)((async()=>{U&&(Y(!0),await h().D9({workflowStore:U,environment:N,spaceId:w}),Y(!1))}),[U,N,w,Y]),ie=(0,a().IS)((e=>({container:{display:"flex",flexDirection:"column",height:"100%"},contentContainer:{flex:1,overflowY:"auto",paddingTop:8,paddingInlineStart:16,paddingInlineEnd:8},section:{paddingInlineEnd:8},toggleSection:{display:"flex",flexDirection:"column",gap:4},loadingText:{color:e.text.secondary,fontSize:14,padding:16},buttonContainer:{backgroundColor:e.background.primary,display:"flex",justifyContent:"center",paddingInline:16},buttonsContainer:{marginTop:12,marginBottom:16},buttonWidth:{width:"100%"},collectionSettingsSwitcherMenuItemStyle:{marginInlineStart:-4,marginInlineEnd:-4},divider:{marginBottom:8,marginTop:8,paddingInlineEnd:8},autofillIcons:{color:e.icon.tertiary},blueDot:{width:6,height:6,borderRadius:"50%",backgroundColor:e.blue.background.accentPrimary}})),[]),re=(0,n.useCallback)((async e=>{U&&o?(await h().ay({n:e,collectionContextStore:t,workflowStore:U,currentCollectionStore:o,environment:N,properties:G,spaceId:w}),p()):p()}),[t,o,N,p,G,w,U]),ae=(0,n.useCallback)((async()=>{U&&o?(await h().Xp({workflowStore:U,currentCollectionStore:o,collectionContextStore:t,environment:N,spaceId:w,properties:G}),p()):p()}),[p,U,o,t,N,w,G]),le=(0,n.useCallback)((()=>{b&&U&&h().XL({workflowId:T,propertyId:b,collectionStore:o,workflows:[U],environment:N})}),[b,U,T,o,N]),se=(0,n.useMemo)((()=>!(!U||!x)&&(0,F().DO)(U.id,x)),[x,U]),ce=(0,r().K8)((()=>!(!L||!U)&&(U.hasBeenPublished()?U.hasChanges():!!L.getValue()||(!(1===G.length&&(!b||G.includes(b)))||(!y().n4(E,P().W)||!y().n4(H,Z))))),[L,b,H,G,E,U]),de=(0,r().K8)((()=>{var e;const t=null==U||null===(e=U.getDraftData())||void 0===e?void 0:e.paused_reason;return Boolean(null==t?void 0:t.reason)}),[U]),[ue,pe]=(0,n.useState)(!1),me=(0,n.useCallback)((()=>{pe(!0)}),[]),ge=(0,r().K8)((()=>null==L?void 0:L.getValue()),[L]),fe=(0,r().K8)((()=>{const e=t.collectionStore(),o=null==e?void 0:e.getSchema();return!!o&&G.some((e=>{const t=o[e];if(("select"===(null==t?void 0:t.type)||"multi_select"===(null==t?void 0:t.type))&&0===(t.options||[]).length)return!0}))}),[t,G]);return(0,u.jsxs)("div",{style:ie.container,role:"presentation",children:[U?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{style:ie.contentContainer,children:[de?(0,u.jsx)(z().u,{workflowStore:U,onRequestIncrease:me,minified:!0}):void 0,(0,u.jsx)("div",{style:ie.section,children:L?(0,u.jsxs)(l().VP,{gap:8,children:[(0,u.jsxs)(l().fI,{gap:8,alignItems:"center",children:[(0,u.jsx)(d().D,{styleKey:"Caption/Medium",color:"gray",colorVariant:"secondary",children:(0,u.jsx)(f().sA,{...X.instructionsTitle})}),ce&&$?(0,u.jsx)("div",{style:ie.blueDot}):void 0]}),(0,u.jsx)(J,{store:L,collectionStore:o,placeholder:W.formatMessage(X.inputPlaceholder),minHeight:80})]}):void 0}),(0,u.jsx)("div",{style:{paddingBottom:4}}),(0,u.jsx)(_,{schema:oe,selectedProperties:G,onSelectionChange:te}),(0,u.jsxs)("div",{style:ie.toggleSection,children:[(0,u.jsx)(D().A,{delayThreshold:2e3,render:e=>(0,u.jsx)(S().A,{...e,switcherProps:{on:E.shouldTriggerOnPageCreate||!1},title:(0,u.jsx)(f().sA,{...X.onPageCreation}),onClick:()=>{Q("shouldTriggerOnPageCreate",!E.shouldTriggerOnPageCreate)},buttonStyle:ie.collectionSettingsSwitcherMenuItemStyle}),renderTooltip:()=>W.formatMessage(X.onPageCreationTooltip)}),(0,u.jsx)(D().A,{delayThreshold:2e3,render:e=>(0,u.jsx)(S().A,{...e,switcherProps:{on:E.shouldTriggerOnPageContentUpdate||!1},buttonStyle:ie.collectionSettingsSwitcherMenuItemStyle,title:(0,u.jsx)(f().sA,{...X.onPageUpdate}),onClick:()=>{Q("shouldTriggerOnPageContentUpdate",!E.shouldTriggerOnPageContentUpdate)}}),renderTooltip:()=>W.formatMessage(X.onPageUpdateTooltip)})]}),(0,u.jsx)(R().A,{size:1,style:ie.divider,colorVariant:"secondary"}),(0,u.jsxs)(l().VP,{gap:8,children:[(0,u.jsxs)(l().fI,{gap:4,children:[(0,u.jsx)(d().D,{styleKey:"Caption/Medium",color:"gray",colorVariant:"secondary",children:(0,u.jsx)(f().sA,{...X.sourcesTitle})}),(0,u.jsx)(D().A,{renderTooltip:()=>(0,u.jsx)(f().sA,{...X.sourcesTooltip}),render:e=>(0,u.jsx)(B().A,{...e,size:"xxs",icon:()=>(0,g().questionMarkCircleSmallIcon)(ie.autofillIcons),ariaLabel:W.formatMessage(X.sourcesTooltip)})})]}),(0,u.jsxs)("div",{style:ie.toggleSection,children:[(0,u.jsx)(S().A,{buttonStyle:ie.collectionSettingsSwitcherMenuItemStyle,switcherProps:{on:H.canSearchWorkspace||!1},title:(0,u.jsx)(f().sA,{...X.searchWorkspace}),onClick:()=>{ee({...H,canSearchWorkspace:!H.canSearchWorkspace})}}),(0,u.jsx)(S().A,{switcherProps:{on:H.canSearchWeb||!1},buttonStyle:ie.collectionSettingsSwitcherMenuItemStyle,title:(0,u.jsx)(f().sA,{...X.searchWeb}),onClick:()=>{ee({...H,canSearchWeb:!H.canSearchWeb})}})]})]})]}),(0,u.jsxs)("div",{style:ie.buttonsContainer,children:[$?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(A().A,{popupType:A().z.Popup,popupWrapStyle:{width:288},alignmentToOrigin:"center",renderOrigin:e=>(0,u.jsx)(D().A,{disableTooltip:!fe,renderTooltip:()=>(0,u.jsx)(f().sA,{...X.hasSelectOrMultiselectWithNoOptions}),render:t=>(0,u.jsx)("div",{style:ie.buttonContainer,children:(0,u.jsx)(s().A,{...(0,K().A)(e,t),size:"md",style:ie.buttonWidth,iconLeading:{icon:m,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"},disabled:fe,children:(0,u.jsx)(f().sA,{...X.runAutoFill})})})}),render:({close:e})=>(0,u.jsx)(j().A,{menuType:k().gu.Popup,children:(0,u.jsx)(M().Ay,{type:M().Oh.Vertical,sections:[{key:"preview-options",items:[{key:"first-page",action:()=>{re(1),e()},render:e=>(0,u.jsx)(C().A,{...e,title:W.formatMessage(X.previewOptionFirstPage),buttonStyle:{width:"100%",justifyContent:"flex-start",textAlign:"start"}})},{key:"first-5-pages",action:()=>{re(5),e()},render:e=>(0,u.jsx)(C().A,{...e,title:W.formatMessage(X.previewOptionFirst5Pages),buttonStyle:{width:"100%",justifyContent:"flex-start",textAlign:"start"}})},{key:"first-10-pages",action:()=>{re(10),e()},render:e=>(0,u.jsx)(C().A,{...e,title:W.formatMessage(X.previewOptionFirst10Pages),buttonStyle:{width:"100%",justifyContent:"flex-start",textAlign:"start"}})},{key:"all-pages",action:()=>{ae(),e()},render:e=>(0,u.jsx)(C().A,{...e,title:W.formatMessage(X.previewOptionAllPages),buttonStyle:{width:"100%",justifyContent:"flex-start",textAlign:"start"}})}],render:e=>(0,u.jsx)(I().A,{...e})}],initialFocus:void 0})})}),(0,u.jsx)("div",{style:{marginTop:8}})]}):null,$&&!se&&b&&v>1?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{style:ie.buttonContainer,children:(0,u.jsx)(s().A,{size:"md",style:ie.buttonWidth,onClick:le,children:(0,u.jsx)(f().sA,{...X.setAsDefault})})}),(0,u.jsx)("div",{style:{marginTop:8}})]}):null,(0,u.jsx)("div",{style:ie.buttonContainer,children:(0,u.jsx)(c().A,{onClick:ne,size:"md",style:ie.buttonWidth,colorPalette:"blue",disabled:!ce||!ge,children:$?(0,u.jsx)(f().sA,{...X.saveChanges}):(0,u.jsx)(f().sA,{...q?X.creatingAgent:X.createAgent})})})]})]}):(0,u.jsx)("div",{style:ie.loadingText,children:(0,u.jsx)(f().sA,{...X.noConfig})}),ue&&U?(0,u.jsx)(V().h,{workflowStore:U,isOpen:ue,onClose:()=>pe(!1)}):void 0]})}},607567:(e,t,o)=>{o.d(t,{Z:()=>r});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.12 16.74 14.99",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M4.5 4.125A2.125 2.125 0 0 0 2.375 6.25v7.5c0 1.174.951 2.125 2.125 2.125h5.702a4.7 4.7 0 0 1-.2-1.25H4.5a.875.875 0 0 1-.875-.875V7.5h12.75v2.535a4.7 4.7 0 0 1 1.25.684V6.25A2.125 2.125 0 0 0 15.5 4.125zm.758 1.684a.625.625 0 1 1-1.25 0 .625.625 0 0 1 1.25 0m1.375-.625a.625.625 0 1 1 0 1.25.625.625 0 0 1 0-1.25m2.625.625a.625.625 0 1 1-1.25 0 .625.625 0 0 1 1.25 0"}),(0,n.jsx)("path",{d:"M17.7 16.607a3.625 3.625 0 1 0-.893.878l1.223 1.427a.625.625 0 0 0 .94-.823zM12.375 14.5a2.375 2.375 0 1 1 4.75 0 2.375 2.375 0 0 1-4.75 0"})]})},r=(0,o(340498).wt)("browserMagnifyingGlass",i)},608997:(e,t,o)=>{o.d(t,{g:()=>y});var n=o(296540),i=()=>o(484714),r=()=>o(56366),a=()=>o(401497),l=()=>o(236262),s=()=>o(69708),c=()=>o(471995),d=()=>o(147503),u=()=>o(815510),p=()=>o(285790),m=()=>o(859428),g=o(474848);const f=(0,s().YK)({deleteLabel:{defaultMessage:"Delete agent",id:"collectionSettings.propertyAgentAutofill.deleteAgent.icon"},agentDeletedSuccessfully:{defaultMessage:"Agent deleted successfully",id:"database.collectionViewAgentsMenu.agentDeletedSuccessfully"}});function y(e){const{collectionSettingsStore:t,collectionStore:o,onDeleteAgent:y,spaceId:h,workflowStore:S}=e,v=(0,i().v3)(),b=(0,s().tz)(),x=(0,a().IS)((e=>({deleteIcon:{color:e.icon.tertiary}})),[]),w=(0,n.useCallback)((()=>{if(!h||!S)return;const e=o.getParentCollectionViewBlockStore();u().MT({workflowStore:S,collectionStore:o,collectionViewBlockStore:e,environment:v,spaceId:h}),d().os({collectionSettingsStore:t}),y&&y(),c().D6({label:b.formatMessage(f.agentDeletedSuccessfully)})}),[h,S,o,v,t,y,b]);return(0,r().K8)((()=>!!S&&S.hasBeenPublished()),[S])?(0,g.jsx)(m().A,{renderTooltip:()=>(0,g.jsx)(s().sA,{...f.deleteLabel}),render:e=>(0,g.jsx)(p().A,{...e,size:"xxs",icon:()=>(0,l().trashIcon)(x.deleteIcon),ariaLabel:b.formatMessage(f.deleteLabel),onClick:w})}):null}},629509:(e,t,o)=>{function n(e,t){return t.default_workflow_id===e}function i(e){const{collectionPointer:t,propertyId:o,workflowId:n}=e;return{pointer:t,command:"set",path:["schema",o,"default_workflow_id"],args:n}}function r(e){const{collectionPointer:t,propertyId:o}=e;return{pointer:t,command:"set",path:["schema",o,"default_workflow_id"],args:void 0}}o.d(t,{DO:()=>n,Eq:()=>i,rK:()=>r})},653259:(e,t,o)=>{o.d(t,{A:()=>l});o(296540);var n=()=>o(69708),i=()=>o(100622),r=()=>o(125565),a=o(474848);function l(e){return(0,a.jsx)(r().A,{isMultiline:!0,style:{paddingTop:8,marginInlineStart:16,marginInlineEnd:16,color:i().Tj.red,...e.styles},children:(0,a.jsx)(n().sA,{id:"database.viewSettings.propertyTab.duplicatePropertyNameError",defaultMessage:"A property named {propertyName} already exists in this database.",values:{propertyName:e.propertyName}})})}},656704:(e,t,o)=>{o.d(t,{y:()=>r});var n=()=>o(597777);const i=(0,o(69708).YK)({none:{defaultMessage:"None",id:"dateFormatHelpers.reminderMenuItems.none"},onTheDay:{defaultMessage:"On day of event {formattedTimeText}",id:"dateFormatHelpers.reminderMenuItems.onTheDayOfEvent"},hoursBefore:{defaultMessage:"{numberOfHours, plural, one {{numberOfHours} hour before} other {{numberOfHours} hours before}}",id:"dateFormatHelpers.reminderMenuItems.hoursBefore"},minutesBefore:{defaultMessage:"{numberOfMinutes, plural, one {{numberOfMinutes} minute before} other {{numberOfMinutes} minutes before}}",id:"dateFormatHelpers.reminderMenuItems.minutesBefore"},yearsBefore:{defaultMessage:"{numberOfYears, plural, one {{numberOfYears} year before {formattedTimeText}} other {{numberOfYears} years before {formattedTimeText}}}",id:"dateFormatHelpers.reminderMenuItems.yearsBefore"},daysBefore:{defaultMessage:"{numberOfDays, plural, one {{numberOfDays} day before {formattedTimeText}} other {{numberOfDays} days before {formattedTimeText}}}",id:"dateFormatHelpers.reminderMenuItems.daysBefore"},monthsBefore:{defaultMessage:"{numberOfMonths, plural, one {{numberOfMonths} month before {formattedTimeText}} other {{numberOfMonths} months before {formattedTimeText}}}",id:"dateFormatHelpers.reminderMenuItems.monthsBefore"},weeksBefore:{defaultMessage:"{numberOfWeeks, plural, one {{numberOfWeeks} week before {formattedTimeText}} other {{numberOfWeeks} weeks before {formattedTimeText}}}",id:"dateFormatHelpers.reminderMenuItems.weeksBefore"},atTimeOf:{defaultMessage:"At time of event",id:"dateFormatHelpers.reminderMenuItems.atTimeOfEvent"}});function r(e){const{reminder:t,shouldShowTime:o,intl:r,formatTime:a}=e;if(n().DG(t)){if(n().fc(t)){const{unit:e,value:n,time:l}=t,s=a({start_time:l,time_format:"LT",humanReadable:!0,intl:r}),c=o?`(${s})`:"";return 0===n?r.formatMessage(i.onTheDay,{formattedTimeText:c}):"day"===e?r.formatMessage(i.daysBefore,{formattedTimeText:c,numberOfDays:n}):"year"===e?r.formatMessage(i.yearsBefore,{formattedTimeText:c,numberOfYears:n}):"month"===e?r.formatMessage(i.monthsBefore,{formattedTimeText:c,numberOfMonths:n}):r.formatMessage(i.weeksBefore,{formattedTimeText:c,numberOfWeeks:n})}{const{unit:e,value:o}=t;return 0===o?r.formatMessage(i.atTimeOf):"hour"===e?r.formatMessage(i.hoursBefore,{numberOfHours:o}):r.formatMessage(i.minutesBefore,{numberOfMinutes:o})}}return r.formatMessage(i.none)}},673099:(e,t,o)=>{o.d(t,{b:()=>m,p:()=>p});o(296540);var n=()=>o(97294),i=o(474848);const r={viewBox:"0 0 16 16",fittedViewBox:"2.37 1.59 12.03 12.03",svg:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("path",{d:"m14.2 2.781-.517.518-.977-.976.525-.524a.69.69 0 0 1 .97 0 .69.69 0 0 1 0 .97zM7.052 9.93l5.998-5.998-.977-.977L6.07 8.948a1 1 0 0 0-.208.347l-.254.82c-.046.173.116.335.277.277l.82-.254a.8.8 0 0 0 .347-.208"}),(0,i.jsx)("path",{d:"M3.625 5c0-.76.616-1.375 1.375-1.375h3a.625.625 0 1 0 0-1.25H5A2.625 2.625 0 0 0 2.375 5v6A2.625 2.625 0 0 0 5 13.625h6A2.625 2.625 0 0 0 13.625 11V8a.625.625 0 1 0-1.25 0v3c0 .76-.616 1.375-1.375 1.375H5c-.76 0-1.375-.616-1.375-1.375z"})]})},a=(0,o(340498).wt)("composeSmall",r);var l=()=>o(69708),s=()=>o(95441),c=()=>o(497222);const d="https://www.notion.so/notion/Notion-x-Salesforce-Integration-Beta-21fefdeead05808f8180fc9270458ba0",u="https://www.notion.so/notion/21fefdeead0580808823c9d0dede7495";function p(){return(0,i.jsx)(s().A,{href:d,title:(0,i.jsx)(l().sA,{defaultMessage:"Learn about Salesforce",id:"database.viewSettings.propertyTab.salesforceRelation.learnMoreButton.title"}),analyticsFrom:"view_settings_property_salesforce_relation"})}function m(){return(0,i.jsx)(n().N,{href:u,onClick:()=>{},external:!0,children:(0,i.jsx)(c().A,{icon:a,title:(0,i.jsx)(l().sA,{defaultMessage:"Provide feedback",id:"database.viewSettings.propertyTab.salesforceRelation.feedbackButton.title"}),isGray:!0})})}},724833:(e,t,o)=>{o.d(t,{h:()=>T});o(581454);var n=o(296540),i=()=>o(242422),r=()=>o(484714),a=()=>o(56366),l=()=>o(401497),s=()=>o(98126),c=()=>o(406094),d=()=>o(631524),u=()=>o(160432),p=()=>o(493552),m=()=>o(324254),g=()=>o(23402),f=()=>o(69708),y=()=>o(901389),h=()=>o(471995),S=()=>o(760217),v=()=>o(406699),b=()=>o(404277),x=()=>o(939740),w=()=>o(107683),C=()=>o(89924),A=()=>o(21140),j=()=>o(722872),M=()=>o(177097),I=o(474848);const k=[100,250,500,1e3,1e4,1e5];function T(e){const{workflowStore:t,isOpen:o,onClose:T}=e,_=(0,r().v3)(),P=(0,f().tz)(),R=(0,a().K8)((()=>{const e=i().default.getConfig({configName:"custom_agent_sub_features"});return(null==e?void 0:e.available_run_increases)??k}),[]),B=(0,n.useMemo)((()=>Array.isArray(R)?R:k),[R]),[D,O]=(0,n.useState)(B[0]??100),[F,K]=(0,n.useState)(""),[V,z]=(0,n.useState)(!1),N=(0,l().IS)((e=>({container:{padding:32,width:480},icon:{width:48,height:48,fill:e.icon.secondary},dropdownButton:{width:"100%",height:36,paddingInline:12,backgroundColor:e.background.primary,border:`1px solid ${e.border.secondary}`,borderRadius:8,fontSize:14,color:e.text.primary,display:"flex",alignItems:"center",justifyContent:"space-between"},chevronIcon:{width:16,height:16,fill:e.icon.tertiary,flexShrink:0},reasonInput:{width:"100%",minHeight:120,padding:12,backgroundColor:e.background.primary,border:`1px solid ${e.border.secondary}`,borderRadius:8,resize:"vertical",fontSize:14,color:e.text.primary}})),[]),W=(0,n.useCallback)((async()=>{if(!V){z(!0);try{await(0,M().requestWorkflowLimitIncrease)({environment:_,workflowStore:t,amount:D,reason:F}),h().D6({label:P.formatMessage({defaultMessage:"Request sent successfully",id:"workflows.requestLimitModal.success"})}),T()}catch(e){y().f1(P.formatMessage({defaultMessage:"Failed to request limit increase",id:"workflows.requestLimitModal.error"}))}finally{z(!1)}}}),[_,t,D,F,P,T,V]);return(0,I.jsx)(w().s,{isOpen:o,onDismiss:T,render:()=>(0,I.jsxs)(A().wt,{gap:32,style:N.container,children:[(0,I.jsxs)(A().wt,{alignItems:"center",gap:12,children:[(0,g().u)(N.icon),(0,I.jsx)(p().D,{styleKey:"Title/Semibold",colorVariant:"primary",children:(0,I.jsx)(f().sA,{id:"workflows.requestLimitModal.title",defaultMessage:"Need additional runs?"})}),(0,I.jsx)(p().D,{styleKey:"Body/Regular",colorVariant:"secondary",children:(0,I.jsx)(f().sA,{id:"workflows.requestLimitModal.subtitle",defaultMessage:"Request to add more runs for this agent"})})]}),(0,I.jsxs)(A().wt,{gap:12,children:[(0,I.jsx)(p().D,{styleKey:"Body/Medium",colorVariant:"primary",children:(0,I.jsx)(f().sA,{id:"workflows.requestLimitModal.amountLabel",defaultMessage:"Amount"})}),(0,I.jsx)(v().A,{popupType:v().z.Popup,alignmentToOrigin:"start",placementToOrigin:"bottom",originGap:4,renderOrigin:e=>(0,I.jsxs)(d().p,{...e,style:N.dropdownButton,hoveredStyle:{background:"transparent"},pressedStyle:{background:"transparent"},children:[(0,I.jsx)("span",{children:P.formatMessage({id:"workflows.requestLimitModal.runsOption",defaultMessage:"{amount} runs"},{amount:P.formatNumber(D)})}),(0,m().arrowChevronSingleDownSmallIcon)(N.chevronIcon)]}),render:({close:e})=>(0,I.jsx)(b().A,{menuType:j().gu.Popup,children:(0,I.jsx)(x().Ay,{initialFocus:0,type:x().Oh.Vertical,sections:[{key:"amount-options",render:e=>(0,I.jsx)(C().A,{...e}),items:B.map((t=>({key:t,action:()=>{O(t),e()},render:e=>(0,I.jsx)(S().A,{...e,title:P.formatMessage({id:"workflows.requestLimitModal.runsOption",defaultMessage:"{amount} runs"},{amount:P.formatNumber(t)}),buttonStyle:{width:"100%",justifyContent:"flex-start",textAlign:"start"}})})))}]})})})]}),(0,I.jsxs)(A().wt,{gap:12,children:[(0,I.jsx)(p().D,{styleKey:"Body/Medium",colorVariant:"primary",children:(0,I.jsx)(f().sA,{id:"workflows.requestLimitModal.reasonLabel",defaultMessage:"Reason for increase"})}),(0,I.jsx)("textarea",{style:N.reasonInput,placeholder:P.formatMessage({id:"workflows.requestLimitModal.reasonPlaceholder",defaultMessage:"e.g., higher task volume, ongoing projects"}),value:F,onChange:e=>K(e.target.value)})]}),(0,I.jsxs)(A().wt,{gap:12,children:[(0,I.jsx)(u().A,{onClick:W,disabled:V||!F.trim(),colorPalette:"blue",size:"lg",style:{width:"100%"},children:V?(0,I.jsxs)(A().Ye,{alignItems:"center",gap:8,children:[(0,I.jsx)(s().k,{size:"sm"}),(0,I.jsx)(f().sA,{id:"workflows.requestLimitModal.submitting",defaultMessage:"Requesting..."})]}):(0,I.jsx)(f().sA,{id:"workflows.requestLimitModal.request",defaultMessage:"Request"})}),(0,I.jsx)(c().A,{onClick:T,disabled:V,size:"lg",style:{width:"100%"},children:(0,I.jsx)(f().sA,{id:"workflows.requestLimitModal.cancel",defaultMessage:"Cancel"})})]})]})})}},741198:(e,t,o)=>{o.d(t,{Jc:()=>f,Q7:()=>g});var n=o(296540),i=()=>o(908006),r=()=>o(484714),a=()=>o(852507),l=()=>o(56366),s=()=>o(913747),c=()=>o(749804),d=()=>o(190033),u=()=>o(301421),p=()=>o(732770),m=()=>o(693202);function g(e){const{textStore:t,initialFocus:o}=e,i=(0,r().v3)(),s=(0,l().K8)((()=>y(t)),[t]),d=(0,n.useCallback)((()=>{f(t)}),[t]),m=(0,n.useCallback)((()=>{!function(e){const{environment:t,textStore:o}=e;if(!y(o))return;const n=u().n.findNodeFromStore(o);null==n||n.blur(),(0,c().I)({environment:t}),p().A.setKeyboardMode(!1)}({environment:i,textStore:t})}),[i,t]);return(0,a().w)((()=>{o&&d()})),(0,n.useMemo)((()=>({isFocused:s,focus:d,blur:m})),[s,d,m])}function f(e){i().default.afterNextFlush((()=>{(0,s().w)();const t=u().n.findNodeFromStore(e);null==t||t.focus(),(0,d().z)({store:e})}))}function y(e){return"empty"!==m().default.state.mode&&m().default.state.multiSelection.start.store.id===e.id}},750294:(e,t,o)=>{o.d(t,{oX:()=>ao,t_:()=>qt,lI:()=>so});o(16280),o(944114),o(898992),o(672577);var n=o(296540),i=()=>o(59226),r=()=>o(726637),a=()=>o(484714),l=()=>o(56366),s=()=>o(401497),c=()=>o(929219),d=()=>o(794198);const u="usersOnly";var p=()=>o(898244),m=()=>o(713998),g=()=>o(158115),f=()=>o(104077),y=()=>o(105819),h=()=>o(69708),S=()=>o(100622),v=()=>o(534177),b=()=>o(59400),x=()=>o(901952),w=()=>o(231297),C=()=>o(272200),A=()=>o(799829);function j(e,t,o){return(0,A().e0)(e,t,o)}var M=()=>o(831566),I=()=>o(312296),k=()=>o(89924),T=()=>o(859428),_=()=>o(798174),P=()=>o(852353),R=()=>o(673730),B=()=>o(495159),D=()=>o(68465),O=()=>o(972435),F=()=>o(148307),K=()=>o(965134),V=()=>o(284371),z=()=>o(115552),N=()=>o(33218),W=()=>o(937199),q=o(474848);function Y(){const{layoutStore:e,currentModuleSelection:t,collectionStore:n}=(0,W().LH)(),i=(0,l().K8)((()=>{if("existing_module"===(null==t?void 0:t.type))return e.getModuleById(t.moduleId)}),[t,e]),r=(0,l().K8)((()=>{if((0,o(778781).gx)(i))return null==n?void 0:n.getSchemaStore().getKeyStore(i.propertyId).getValue()}),[n,i]);if(!i||!r)return null;switch(i.type){case"property_person":case"property_created_by":case"property_last_edited_by":return(0,q.jsx)(H,{module:i,options:U,heightVariant:"tall"});case"property_formula":return(0,o(708685).isNumberFormulaPropertySchema)(r)?(0,q.jsx)(H,{module:i,options:E,heightVariant:"short"}):null;case"property_number":return(0,q.jsx)(H,{module:i,options:E,heightVariant:"short"});case"property_file":return(0,q.jsx)(H,{module:i,options:L,heightVariant:"short"});case"property_place":return(0,q.jsx)(H,{module:i,options:G,heightVariant:"short"});default:return null}}const U={available:["large","compact"],appearance:{compact:{label:(0,q.jsx)(h().sA,{id:"PropertyTypeSpecificModuleConfiguration.person.display.compact",defaultMessage:"Compact"}),image:{src:F().A.images.layouts.configuration.personCompactPng,width:100,height:41}},large:{label:(0,q.jsx)(h().sA,{id:"PropertyTypeSpecificModuleConfiguration.person.display.large",defaultMessage:"Large"}),image:{src:F().A.images.layouts.configuration.personMediumPng,width:82,height:56}}}},L={available:["landscape","portrait","square"],appearance:{landscape:{label:(0,q.jsx)(h().sA,{id:"PropertyTypeSpecificModuleConfiguration.file.display.landscape",defaultMessage:"Landscape"}),image:{src:F().A.images.layouts.configuration.fileLandscapePng,width:192,height:128}},portrait:{label:(0,q.jsx)(h().sA,{id:"PropertyTypeSpecificModuleConfiguration.file.display.portrait",defaultMessage:"Portrait"}),image:{src:F().A.images.layouts.configuration.filePortraitPng,width:192,height:128}},square:{label:(0,q.jsx)(h().sA,{id:"PropertyTypeSpecificModuleConfiguration.file.display.square",defaultMessage:"Square"}),image:{src:F().A.images.layouts.configuration.fileSquarePng,width:192,height:128}}}},E={available:["large","small"],appearance:{large:{label:(0,q.jsx)(h().sA,{id:"PropertyTypeSpecificModuleConfiguration.number.display.large",defaultMessage:"Large"}),icon:{function:K().i,size:42}},small:{label:(0,q.jsx)(h().sA,{id:"PropertyTypeSpecificModuleConfiguration.number.display.small",defaultMessage:"Small"}),icon:{function:K().i,size:22}}}};function H({module:e,options:t,heightVariant:o}){const i=(0,a().v3)(),{layoutStore:r}=(0,W().LH)(),l=(0,n.useCallback)((t=>{const o=r.getModel(),n=null==o?void 0:o.getPageModuleAreaById(e.id);if(!n||!o)return;const a={...e,style:t};w().createAndCommit({environment:i,perform(e){(0,N().UQ)({environment:i,transaction:e,layoutStore:r,position:{area:n,moduleId:a.id},updatedModule:a})},canUndo:!0,userAction:"BuilderLayoutModules.setDisplayStyle"})}),[i,r,e]),c=(0,s().IS)((e=>({container:{margin:"10px 8px"},label:{fontSize:V().J.UISmall.desktop,fontWeight:V().Wy.medium,marginTop:0,marginInlineEnd:8,marginBottom:6,marginInlineStart:8,color:e.text.secondary}})),[]);return(0,q.jsxs)("div",{style:c.container,children:[(0,q.jsx)("p",{style:c.label,children:(0,q.jsx)(h().sA,{id:"PropertyTypeSpecificModuleConfiguration.person.display.title",defaultMessage:"Style"})}),(0,q.jsx)(z().A,{disabled:!1,options:t,selectedOption:e.style,onOptionSelected:l,height:o})]})}const G={available:["map","text"],appearance:{map:{label:(0,q.jsx)(h().sA,{id:"PropertyTypeSpecificModuleConfiguration.place.display.map",defaultMessage:"Map"}),image:{src:F().A.images.blocks.mapsPng,width:40,height:40}},text:{label:(0,q.jsx)(h().sA,{id:"PropertyTypeSpecificModuleConfiguration.place.display.text",defaultMessage:"Text"}),image:{src:F().A.images.blocks.textPng["en-US"],width:40,height:40}}}};var $=()=>o(255824),J=()=>o(463830),Z=()=>o(411671),X=()=>o(878710),Q=()=>o(147503),ee=()=>o(527438),te=(o(18107),o(967357),()=>o(417392)),oe=()=>o(497222);const ne=n.memo((function({collectionContextStore:e,collectionSettingsStore:t,property:i}){const r=(0,a().v3)(),{isMobile:s}=(0,a().Y0)(),c=(0,l().uB)(void 0,J().A),d=(0,n.useCallback)((n=>{const a=e.collectionStore();if(!a)return null;const l=e.normalizedSchemaStore.state[i];if("formula"!==(null==l?void 0:l.type))return;const s=Boolean(a.getDatabaseType()&&a.isTypedProperty(i)),c=t.getState().fromBlockStore??e.resultsInViewOrder(1).at(0);return(0,q.jsx)(o(645873).u2,{dependency:o(862292).T.formulas,children:e=>(0,q.jsx)(o(490696).C,{handleClose:n.close,property:i,getRecordModel:a.getRecordModel,propertySchema:l,collectionStore:a,handleSave:e=>function(e,t){const{newValue:o,newType:n,propertySchema:i,property:r,collectionStore:a}=e,l=o?{...i,formula2:{code:o,result_type:n},version:"v2"}:{...i,formula2:void 0,version:"v2"};w().createAndCommit({userAction:"CollectionFormulaOptions.handleFormulaChange",environment:t,canUndo:!0,perform:e=>{(0,I().F)({environment:t,collectionStore:a,update:{[r]:l},transaction:e})}})}(e,r),formulas:e,disabled:s,blockStore:c,analyticsFrom:"view_settings"})})}),[e,t,r,i]);return(0,q.jsx)(o(406699).A,{popupType:s?te().nl.BottomSheet:te().nl.Popup,alignmentToOrigin:"end",renderOrigin:e=>(0,q.jsx)(oe().A,{title:(0,q.jsx)(h().sA,{defaultMessage:"Edit formula",id:"database.viewSettings.formulaOptions.title"}),showChevron:!0,icon:y().pencilLineIcon,rotateChevron:c.state.open,...e}),render:d,buttonPopupStore:c})}));var ie=()=>o(66486),re=()=>o(363631),ae=()=>o(107440),le=(o(581454),()=>o(242422)),se=()=>o(662303),ce=()=>o(656704),de=()=>o(597777),ue=()=>o(869190),pe=()=>o(971404),me=()=>o(68913),ge=()=>o(274570),fe=()=>o(42583),ye=()=>o(755199),he=()=>o(147294),Se=()=>o(765957),ve=()=>o(828973);function be({collectionContextStore:e,property:t}){const o=(0,h().tz)(),n=(0,a().v3)(),i=(0,l().K8)((()=>xe(e,t)),[e,t]),r=(0,l().K8)((()=>e.getPropertyFormat(t)),[e,t]),s=(0,l().K8)((()=>"date"===(null==i?void 0:i.type)&&le().default.checkGate({gateName:"adoption_reminder_collection_default"})),[null==i?void 0:i.type]),c=function(){const e=(0,he().oG)("collection_property_reminder"),t=(0,l().K8)((()=>{var e;return Boolean(null===(e=Se().default.state.currentUserSettingsStore)||void 0===e?void 0:e.hasClickedCollectionPropertyReminderButton())}),[]);return e&&!t}();if(!i)return null;const d=s&&"date"===i.type,u=(null==r?void 0:r.date_format)||i.date_format||de().vz,p=function(e){const t=we();for(const o in t)if(t[o]===e)return o;return"12h"}((null==r?void 0:r.time_format)||i.time_format||de().CE),m="date"===i.type?function(e,t){if(void 0!==(null==t?void 0:t.default_reminder))return t.default_reminder;if(void 0!==e.default_reminder)return e.default_reminder;return}(i,r):void 0;return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(ve().A,{icon:fe().D,title:(0,q.jsx)(h().sA,{defaultMessage:"Date format",id:"database.viewSettings.dateOptions.dateFormat"}),selectedKey:u,popupStyle:{minWidth:190},options:de().wJ.map((e=>({key:e,type:"button",title:o.formatMessage(de().xz[e])}))),onChange:o=>function(e,t,o,n){const i=o.collectionStore(),r=xe(o,n);if(!i||!r)return;const a={...r,date_format:e};w().createAndCommit({userAction:"CollectionSettingsDateOptions.handleDateFormatChange",environment:t,canUndo:!0,perform:e=>{(0,I().F)({environment:t,collectionStore:i,update:{[n]:a},transaction:e})}}),(0,x().V)({environment:t,collectionContextStore:o,property:n,from:"view_settings",action:"date_change_format"})}(o,n,e,t)}),(0,q.jsx)(ve().A,{icon:ge().clockIcon,title:(0,q.jsx)(h().sA,{defaultMessage:"Time format",id:"database.viewSettings.dateOptions.timeFormat"}),selectedKey:p,popupStyle:{minWidth:190},options:de().ZD.map((e=>({key:e,type:"button",title:o.formatMessage(de().px[e])}))),onChange:o=>function(e,t,o,n){const i=we()[e],r=o.collectionStore(),a=xe(o,n);if(!r||!a)return;const l={...a,time_format:i};w().createAndCommit({userAction:"CollectionSettingsDateOptions.handleClockFormatChange",environment:t,canUndo:!0,perform:e=>{(0,I().F)({environment:t,collectionStore:r,update:{[n]:l},transaction:e})}}),(0,x().V)({environment:t,collectionContextStore:o,property:n,from:"view_settings",action:"date_change_time_format"})}(o,n,e,t)}),d?(0,q.jsx)(ve().A,{icon:me().alarmIcon,title:(0,q.jsx)(T().A,{placement:"right",disableTooltip:!c,renderTooltip:()=>(0,q.jsx)("div",{style:{whiteSpace:"pre-wrap"},children:(0,q.jsx)(h().sA,{defaultMessage:"Default reminders for new dates",id:"database.viewSettings.dateOptions.reminderTooltip"})}),render:e=>c?(0,q.jsxs)("div",{...e,style:{display:"flex",alignItems:"center",gap:4},children:[(0,q.jsx)(h().sA,{defaultMessage:"Notifications",id:"database.viewSettings.dateOptions.reminder"}),(0,q.jsx)(he().Ee,{newBadgeKey:"collection_property_reminder",didUserEngage:!c,keyType:"date",style:{marginInlineStart:2}})]}):(0,q.jsx)(h().sA,{defaultMessage:"Notifications",id:"database.viewSettings.dateOptions.reminder"})}),selectedKey:m,renderSelectedKey:e=>(0,ce().y)({reminder:e,shouldShowTime:!1,intl:o,formatTime:ue().fU}),popupStyle:{minWidth:190},options:de().vK.map((e=>{const t=(0,ce().y)({reminder:e,shouldShowTime:!0,intl:o,formatTime:ue().fU});return{key:(0,de().Mb)(e)?void 0:e,type:"button",title:t}})),onChange:o=>{!function(e,t,o,n){const i=o.collectionStore(),r=xe(o,n);if(!i||!r)return;const a={...r,default_reminder:e};w().createAndCommit({userAction:"CollectionSettingsDateOptions.handleDefaultDateTimeReminderChange",environment:t,canUndo:!0,perform:e=>{(0,I().F)({environment:t,collectionStore:i,update:{[n]:a},transaction:e})}}),(0,x().V)({environment:t,collectionContextStore:o,property:n,from:"view_settings",action:"date_change_reminder_default"})}(o,n,e,t)},onClick:()=>{!function(e){const{environment:t}=e,{currentUserSettingsStore:o}=Se().default.state;if(!o)return;const n=e=>{ye().mJ({userSettingsStore:o,transaction:e,data:{collection_property_reminder_button_clicked_at:Date.now()}})};w().createAndCommit({environment:t,userAction:"userClickedCollectionPropertyReminderButton",canUndo:!1,cellTarget:"main",perform:e=>n(e)})}({environment:n})}}):null]})}function xe(e,t){const o=e.normalizedSchemaStore.state[t];if(o)return"date"===o.type||"created_time"===o.type||"last_edited_time"===o.type||"last_visited_time"===o.type?o:void 0}function we(){return(0,pe().X)(se().locale).time}var Ce=()=>o(91451),Ae=()=>o(788621);function je(e){const{collectionContextStore:t,property:o,propertySchema:i}=e,r=(0,a().v3)(),l=(0,n.useCallback)((e=>{const n={...i,default:"created_by"===e?"created_by":void 0},a=t.collectionStore();a&&((0,M().p)({environment:r,collectionStore:a,performTransaction:t=>{w().applyOperation({store:(0,X().v3)(a,a.pointer),operation:{pointer:a.pointer,command:"update",path:["schema",o],args:{default:e}},transaction:t})}}),w().createAndCommit({userAction:"CollectionSettingsDefaultPersonPicker.handleChange",environment:r,canUndo:!0,perform:e=>{(0,I().F)({environment:r,collectionStore:a,update:{[o]:n},transaction:e})}}))}),[t,r,o,i]);return(0,q.jsx)(ve().A,{icon:Ae().personCircleIcon,title:(0,q.jsx)(h().sA,{defaultMessage:"Default",id:"CollectionSettingsDefaultPersonPicker.default.title"}),selectedKey:i.default?"created_by":"no_default",popupStyle:{minWidth:190},options:[{key:"no_default",type:"button",title:(0,q.jsx)(h().sA,{defaultMessage:"No default",id:"CollectionSettingsDefaultPersonPicker.options.noDefault"})},{key:"created_by",type:"button",title:(0,q.jsx)(h().sA,{defaultMessage:"Created by",id:"CollectionSettingsDefaultPersonPicker.options.creator"}),icon:(0,Ce().z)({width:16})}],onChange:l})}var Me=()=>o(764781),Ie=()=>o(798880),ke=()=>o(436696),Te=()=>o(4319),_e=()=>o(177618),Pe=()=>o(722872),Re=()=>o(232930),Be=()=>o(95441),De=()=>o(422068),Oe=()=>o(35091);const Fe=n.memo((function(e){const{environment:t,property:n,propertySchema:i,collectionContextStore:r,collectionStore:a}=e,s=(0,l().K8)((()=>null==a?void 0:a.getSpaceId()),[a]),c=(0,o(329304)._X)({name:"collection_property_autofill",spaceId:s,userId:t.currentUser.id,amount:"unknown"}),d=(0,l().K8)((()=>{const e=r.collectionStore();return e&&(0,D().jq)(Z().A.getMode(t,e),e)}),[t,r]);return(0,l().K8)((()=>(0,p().lx)(i)&&i.select_ai_inference),[i])&&c?(0,q.jsx)(o(419167).Ve,{environment:t,collectionContextStore:r,collectionStore:a,property:n,propertySchema:i,autofillFeatureAvailability:c,isAutofillSetupEnabled:Boolean(d)}):null}));var Ke=()=>o(252291),Ve=()=>o(895876);o(354520);function ze(e){const{collectionContextStore:t,formatKey:o,property:n}=e,i=Ne({formatKey:o,collectionContextStore:t});return i&&0!==i.length?i.filter((e=>e.visible)).findIndex((e=>e.property===n)):-1}function Ne(e){const{formatKey:t,collectionContextStore:o}=e;if(!t)return[];var n;if("collection_page_properties"===t)return(null===(n=o.collectionStore())||void 0===n?void 0:n.getFormat().collection_page_properties)??[];return o.normalizedFormatStore.state[t]||[]}const We=n.memo((function(e){const{isRequiredTypedProperty:t,databaseType:i,collectionContextStore:l,property:c,collectionSettingsStore:d,formatKey:u}=e,p=(0,s().DP)(),g=(0,a().v3)(),f=(0,n.useCallback)((async()=>{const e=l.normalizedSchemaStore.state,t=l.collectionStore(),n=(0,m()._g)({schema:e,property:c}),i=!!n&&(0,o(846657).J)(n);await o(854593).q({environment:g,collectionContextStore:l,property:c,handleDeleteAccept:function(){n&&(t&&w().createAndCommitAsync({environment:g,userAction:"CollectionSettingsProperty.handleDeleteAccept",waitForServerCommit:!1,perform:async n=>{await(0,o(390787).P)({environment:g,collectionStore:t,schema:e,property:c,transaction:n,permanentlyDelete:i});const r=ze({property:c,formatKey:u,collectionContextStore:l});Te().sp({environment:g,collectionContextStore:l,currentIndex:r,entrypoint:"CollectionSettingsProperty",transaction:n,propertyAction:"delete"})}}),Q().yl({collectionSettingsStore:d}),(0,ke().X)({environment:g,collectionContextStore:l,action:"delete_property",property_type:null==n?void 0:n.type}),(0,o(966759).i)({environment:g,collectionContextStore:l,property_type:n.type,from:"view_settings",property:c}))},theme:p,from:"view_settings",isPermanentlyDelete:i})}),[l,d,g,u,c,p]),y=(0,n.useCallback)((e=>(0,Ve().eF)(i,e)),[i]),S=(0,n.useCallback)((e=>t?(0,q.jsx)("div",{...e,style:{display:"inline-flex"},children:(0,q.jsx)(Ke().I,{icon:o(471095).i})}):(0,q.jsx)(Ke().I,{icon:o(236262).trashIcon})),[t]),v=(0,n.useCallback)((e=>(0,q.jsx)(oe().A,{...e,isRed:!0,disabled:t,onClick:f,icon:()=>S(e),title:(0,q.jsx)(h().sA,{defaultMessage:"Delete property",id:"database.viewSettings.propertyTab.deleteButton.title"}),caption:r().A.isMobile&&t?(0,Ve().eF)(i):void 0})),[i,f,S,t]);return(0,q.jsx)(T().A,{disableTooltip:!t,placement:"left",renderTooltip:y,render:v})}));var qe=()=>o(673099);const Ye=n.memo((function(e){const{collectionContextStore:t,property:o,extraPadding:n}=e,i=(0,l().O$)(t.normalizedSchemaStore)[o];return(0,m().di)(i)?(0,q.jsx)(k().A,{extraPadding:n,topBorder:!0,children:(0,q.jsx)(Be().A,{href:(0,Re().x)("guides.githubRelation"),title:(0,q.jsx)(h().sA,{defaultMessage:"Learn about GitHub Pull Requests",id:"database.viewSettings.propertyTab.githubPrRelation.learnMoreButton.title"}),analyticsFrom:"view_settings_property_github_pr_relation"})}):(0,m().V5)(i)?(0,q.jsxs)(k().A,{extraPadding:n,topBorder:!0,children:[(0,q.jsx)(qe().p,{}),(0,q.jsx)(qe().b,{})]}):(0,q.jsx)(k().A,{extraPadding:n,topBorder:!0,children:(0,q.jsx)(Be().A,{href:(0,Re().x)("guides.relations"),title:(0,q.jsx)(h().sA,{defaultMessage:"Learn about relations",id:"database.viewSettings.propertyTab.relations.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"})})})),Ue=n.memo((function(e){const{propertySchema:t,propertyFormat:r,isRequiredTypedProperty:s,databaseType:c,collectionContextStore:d,formatKey:u,property:g,collectionSettingsStore:f,wrapProperty:y}=e,S=(0,a().v3)(),b=(0,Pe().Tf)(),x=(0,i().X)("move_show_as_option_for_select_property"),C=(0,n.useCallback)((()=>function(e,t,o,n,i){const r=function(e){const{collectionContextStore:t,formatKey:o,property:n}=e,i=Ne({formatKey:o,collectionContextStore:t});return i&&0!==i.length?i.find((e=>e.property===n)):-1}({property:n,formatKey:o,collectionContextStore:t}),a=t.collectionViewStore(),l=t.normalizedFormatStore.state,s=(0,ee().Jq)({collectionContextStore:t,property:n});if(!(r&&a&&o&&s))return;Te().Nv({currentValue:i,environment:e,property:n,collectionViewStore:a,format:l,formatKey:o}),(0,ke().X)({environment:e,collectionContextStore:t,action:"toggle_property_wrap",original_view_type:a.getType(),property_type:s.type})}(S,d,u,g,y)),[S,d,u,g,y]),A=(0,l().K8)((()=>d.collectionStore()),[d]),M=(0,l().K8)((()=>d.getViewType()),[d]),I=(0,$().a)(),T=(0,l().K8)((()=>j(c,d.normalizedSchemaStore.state,g)),[c,d,g]),_=(0,l().K8)((()=>!!M&&(u&&(0,_e().hc)({viewType:M,property:g}))),[u,g,M]),P=(0,l().K8)((()=>f.state.hideDuplicatePropertyOption),[f]),R=(0,p().vB)(t)&&Boolean(A)&&!I&&"form_editor"!==M&&!P,B=p().cN.includes(t.type)&&A&&!I&&"form_editor"!==M,D="form_editor"===M;return _||R||B||D?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(k().A,{topBorder:!0,disableMobilePadding:!b,extraPadding:!0,children:[_&&r?(0,q.jsx)(Oe().A,{icon:o(871114).o,title:(0,q.jsx)(h().sA,{defaultMessage:"Wrap in view",id:"database.viewSettings.propertyTab.wrapInViewButton.title"}),switcherProps:{on:y,disallowTabbing:!0},onClick:C}):void 0,"status"===t.type&&x?(0,q.jsx)(De().u,{collectionContextStore:d,property:g,disabled:T}):void 0,A?(0,q.jsx)(Fe,{environment:S,collectionStore:A,collectionContextStore:d,property:g,propertySchema:t}):void 0,R?(0,q.jsx)(oe().A,{icon:Me().V,title:(0,q.jsx)(h().sA,{defaultMessage:"Duplicate property",id:"database.viewSettings.propertyTab.duplicateButton.title"}),onClick:()=>async function(e,t,n,i,r){const a=Ne({formatKey:r,collectionContextStore:n}),l=n.normalizedSchemaStore.state,s=n.collectionStore(),c=null==s?void 0:s.getSpaceId();if(!s||!c)return;const d=(0,m()._g)({schema:l,property:t});if(!d)return;const u=s.getNormalizedPropertyGroups(),p=await(0,_e().W4)({environment:e,schema:l,property:t,properties:a,propertyGroups:u,parentStore:s,spaceId:c});if(!p)return;const g=e.currentUser.id,f=g?{id:g,table:Ie().oo}:void 0,y=n.collectionViewStore();w().createAndCommit({userAction:"CollectionSettingsProperty.handleDuplicateClick",environment:e,canUndo:!0,perform:i=>{(0,v().O9)(p.automationUpdate)&&(0,o(324587).duplicateAutomation)({actorPointer:f,environment:e,sourceAutomationStore:p.automationUpdate.sourceAutomationStore,targetAutomationId:p.automationUpdate.targetAutomationId,transaction:i});const a={...l,[p.newProperty]:p.newPropertySchema},c={...s.getFormat(),collection_page_properties:p.newProperties,property_groups:p.newPropertyGroups};(0,o(797535).I)({environment:e,collectionStore:s,update:{schema:a,format:c},transaction:i});const d=ze({property:t,formatKey:r,collectionContextStore:n});Te().sp({environment:e,collectionContextStore:n,currentIndex:d,entrypoint:"CollectionSettingsProperty",transaction:i,propertyAction:"duplicate"}),r&&y&&o(896628).zA({stores:[y],update:{[r]:p.newProperties},transaction:i})}}),Q().os({collectionSettingsStore:i}),(0,ke().X)({collectionContextStore:n,environment:e,action:"duplicate_property",original_view_type:null==y?void 0:y.getType(),property_type:d.type})}(S,g,d,f,u)}):void 0,B?(0,q.jsx)(We,{collectionContextStore:d,property:g,collectionSettingsStore:f,formatKey:u,isRequiredTypedProperty:s,databaseType:c}):void 0,D?(0,q.jsx)(Be().A,{href:(0,Re().x)("guides.databaseProperties"),title:(0,q.jsx)(h().sA,{defaultMessage:"Learn about properties",id:"database.viewSettings.propertiesTab.learnMoreButton.title"}),analyticsFrom:"view_settings_properties"}):void 0]}),"formula"===t.type?(0,q.jsx)(k().A,{topBorder:!0,children:(0,q.jsx)(Be().A,{href:(0,Re().x)("guides.formulas"),title:(0,q.jsx)(h().sA,{defaultMessage:"Learn about formulas",id:"database.viewSettings.propertyTab.formulas.learnMoreButton.title"}),analyticsFrom:"view_settings_property_formula"})}):void 0,"relation"===t.type?(0,q.jsx)(Ye,{collectionContextStore:d,property:g,extraPadding:!0}):void 0,"rollup"===t.type?(0,q.jsx)(k().A,{topBorder:!0,children:(0,q.jsx)(Be().A,{href:(0,Re().x)("guides.relations"),title:(0,q.jsx)(h().sA,{defaultMessage:"Learn about rollups",id:"database.viewSettings.propertyTab.rollups.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"})}):void 0]}):null}));var Le=()=>o(158797),Ee=()=>o(992307),He=()=>o(913687),Ge=()=>o(685889),$e=(o(737550),()=>o(564884)),Je=()=>o(98126),Ze=()=>o(617871),Xe=()=>o(202017),Qe=()=>o(796073),et=()=>o(462853),tt=()=>o(817126),ot=()=>o(534239);const nt=(0,h().YK)({linkPreviewDescription:{defaultMessage:"Salesforce URLs will be auto-converted as a Salesforce property with live preview on hover.",id:"database.viewSettings.salesforceConfigTab.linkPreviewDescription"},databaseActionsTitle:{defaultMessage:"Database actions",id:"database.viewSettings.connectedRelationSettings.databaseActions"},addPropertiesTitle:{defaultMessage:"Add properties",id:"database.viewSettings.connectedRelationSettings.addPropertiesTitle"},databaseActionsDisabledWhileSyncing:{defaultMessage:"Cannot edit while syncing",id:"database.viewSettings.connectedRelationSettings.databaseActionsDisabledWhileSyncing"},syncInProgress:{defaultMessage:"Sync in progress",id:"database.viewSettings.salesforceConfigTab.syncInProgress"},syncInProgressDescription:{defaultMessage:"Fetching the latest data from Salesforce…",id:"database.viewSettings.salesforceConfigTab.syncInProgressDescription"},linkPreviewTitle:{defaultMessage:"Preview",id:"database.viewSettings.salesforceConfigTab.linkPreviewTitle"},featureUnavailableTooltip:{defaultMessage:"{upsellTier, select, plus {Plus} business {Business} enterprise {Enterprise} other {}} plan is required to access this feature",id:"database.viewSettings.collectionSettingsDatabaseActionsConfig.featureUnavailableTooltip"}});function it(e){const t=(0,et().l)(e.integrationId);return t?(0,q.jsx)(rt,{...e,featureName:t}):(0,q.jsx)(at,{...e,upsellInfo:void 0})}function rt(e){const{featureName:t,...o}=e,n=(0,tt().uF)({featureName:t});return(0,q.jsx)(at,{...o,upsellInfo:n})}function at(e){const{collectionContextStore:t,property:o,connectedRelationPatternName:n,integrationId:i,propertySchema:r,environment:a,upsellInfo:s}=e,c=(0,h().tz)(),d=(0,l().K8)((()=>{if(r&&(0,p().UU)(r)&&r.connectedRelation.integration_id===Ze().mn)return r.collection_pointer}),[r]),{format:u,loading:m}=(0,ot().e8)(d,{debugName:"CollectionSettingsDatabaseActionsConfig"}),g=(0,l().K8)((()=>{var e;return!!u&&Boolean(null===(e=u.sync_state)||void 0===e?void 0:e.syncing)}),[u]),f=s&&!s.isAvailable;return(0,q.jsxs)(q.Fragment,{children:[g?(0,q.jsx)(st,{}):(0,q.jsx)(lt,{}),m?(0,q.jsx)(Je().k,{}):(0,q.jsx)(ct,{disabled:g||f,disabledTooltipMessage:f?c.formatMessage(nt.featureUnavailableTooltip,{upsellTier:null==s?void 0:s.upsellTier}):void 0,collectionContextStore:t,property:o,connectedRelationPatternName:n,integrationId:i,propertySchema:r,environment:a})]})}function lt(){const e=dt(),t=(0,h().tz)();return(0,q.jsxs)(k().A,{disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0,mobileStyle:e.previewContentContainer,title:(0,q.jsx)("div",{style:e.tabTitle,children:t.formatMessage(nt.linkPreviewTitle)}),children:[(0,q.jsx)("div",{children:(0,q.jsx)("img",{src:F().A.images.externalIntegrations.salesforceLinkpreviewPng,style:e.previewContentContainer,alt:"Paste Salesforce URLs to create a Salesforce property."})}),(0,q.jsx)("div",{style:e.tabDescription,children:t.formatMessage(nt.linkPreviewDescription)})]})}function st(){const e=(0,s().IS)((e=>({borderedContainer:{borderRadius:6,borderStyle:"solid",borderWidth:1,borderColor:e.border.secondary,paddingTop:16,paddingInlineEnd:12,paddingBottom:16,paddingInlineStart:12,gap:6,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",margin:"8px"},header:{fontWeight:V().Wy.medium,color:e.text.primary,fontSize:V().J.UIRegular.desktop},captionText:{fontSize:V().J.UISmall.desktop,color:e.text.secondary,fontWeight:V().Wy.regular,textAlign:"center"},iconGroup:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gridColumnGap:10,height:36,width:36},icon:{height:29,width:30,color:e.icon.secondary}})),[]),t=(0,h().tz)();return(0,q.jsxs)(k().A,{style:e.borderedContainer,children:[(0,q.jsx)("div",{style:e.iconGroup,children:(0,Qe().$)(e.icon)}),(0,q.jsx)("div",{style:e.header,children:t.formatMessage(nt.syncInProgress)}),(0,q.jsx)("div",{style:e.captionText,children:t.formatMessage(nt.syncInProgressDescription)})]})}function ct({collectionContextStore:e,property:t,connectedRelationPatternName:o,integrationId:n,propertySchema:i,environment:r,disabled:a,disabledTooltipMessage:s}){const c=dt(),d=(0,h().tz)(),u=e.settingsStore,p=(0,l().K8)((()=>{var t;const o=null==e||null===(t=e.collectionStore())||void 0===t?void 0:t.getSchema();return o&&Object.values(o).some((e=>e&&"url"===e.type))}),[e]);return(0,q.jsx)(k().A,{disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0,mobileStyle:c.previewContentContainer,topBorder:!0,title:(0,q.jsx)("div",{style:c.tabTitle,children:d.formatMessage(nt.databaseActionsTitle)}),children:(0,q.jsx)(T().A,{disableTooltip:!a,renderTooltip:e=>(0,q.jsx)("div",{...e,style:R().Q$,children:s||d.formatMessage(nt.databaseActionsDisabledWhileSyncing)}),render:l=>(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(oe().A,{...l,showChevron:!0,title:d.formatMessage(nt.addPropertiesTitle),icon:Xe().n,disabled:a,onClick:()=>{const a=e.collectionStore();(0,$e().u)({environment:r,event:{eventName:"salesforce_actions",eventProperties:{actionType:"add_properties_clicked",collectionId:null==a?void 0:a.id,integrationId:n,details:{source:"edit_property"}}}}),Q().a2({collectionSettingsStore:u,item:{type:"connectedRelationDatabaseActions",source:"connectedRelationAddProperties",rootPropertyId:t,connectedRelationPatternName:o,integrationId:n,rootPropertySchema:i,eventSource:"edit_property"}})}}),(0,q.jsx)(oe().A,{...l,showChevron:!0,title:(0,q.jsx)(h().sA,{defaultMessage:"Populate property",id:"database.viewSettings.salesforceConfigTab.populateProperty"}),icon:Me().V,disabled:a,onClick:()=>{Q().a2({collectionSettingsStore:u,item:{type:"connectedRelationDatabaseActions",source:"connectedRelationCopyUrl",rootPropertyId:t,connectedRelationPatternName:o,integrationId:n,rootPropertySchema:i}});const a=e.collectionStore();(0,$e().u)({environment:r,event:{eventName:"salesforce_actions",eventProperties:{actionType:"navigate_to_copy_url",collectionId:null==a?void 0:a.id,integrationId:n,details:{source:"edit_property",isCopyUrlDisabled:!p}}}})}})]})})})}function dt(){const{isMobile:e}=(0,a().Y0)();return(0,s().IS)((t=>({previewContentContainer:{display:"flex",alignSelf:"center",flexDirection:"column",width:"100%",paddingInlineStart:8,paddingInlineEnd:8,cursor:"default"},tabDescription:{padding:e?18:10,fontSize:e?16:12,color:t.text.tertiary},tabTitle:{fontWeight:410,fontSize:12,color:t.text.secondary}})),[e])}var ut=()=>o(899164),pt=()=>o(896427);function mt(e){const{collectionContextStore:t,property:o,targetCollectionStore:i}=e,r=(0,a().v3)(),s=(0,h().tz)(),c=(0,l().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.id}),[t]),d=(0,l().K8)((()=>t.contextType),[t]),[u,p]=(0,n.useState)(void 0),m=Boolean(i&&c===i.id),g=(0,n.useCallback)((()=>{if(!u)return;const{hasInverseRelation:e,inverseName:n,autoRelate:i}=u;w().createAndCommit({userAction:"CollectionSettingsRelationOptions.handleEditRelation",environment:r,canUndo:!0,perform:a=>{ut().Go({environment:r,collectionContextStore:t,property:o,hasInverseRelation:e,inverseName:n,autoRelate:i,intl:s,transaction:a})}}),(0,x().V)({environment:r,collectionContextStore:t,property:o,from:"collectionPage"===d?"page_properties":"view_settings",action:"relation_edit",is_self_relation:m,has_inverse:e,auto_relate:null==i?void 0:i.enabled}),p(void 0)}),[u,r,t,o,d,m,s]);return(0,q.jsx)(pt().Ay,{collectionContextStore:t,targetCollectionStore:i,property:o,temporaryInverseState:u,setTemporaryInverseState:p,onSubmit:g})}var gt=()=>o(860037);function ft(e){const{collectionContextStore:t,property:o}=e,n=(0,a().v3)(),i=(0,l().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.id}),[t]),r=(0,l().K8)((()=>Ge().Jq(t,o)),[t,o]),s=(0,l().K8)((()=>{const e=t.collectionViewBlockStore();return(0,ee().k7)(e,r)}),[t,r]),c=Boolean(s&&i===s.id),d=r&&(0,p().UU)(r)?r.connectedRelation:void 0,{isConnectedRelationDatabaseActionsSupported:u,connectedRelationPatternName:g,integrationId:f}=(0,l().K8)((()=>{const e=t.normalizedSchemaStore.state[o],n=null==e?void 0:e.name,i=(0,m().Dz)(e);return{isConnectedRelationDatabaseActionsSupported:(0,m().Mn)(i)&&le().default.checkGate({gateName:"connected_relations_database_actions_enabled"}),connectedRelationPatternName:n,integrationId:i}}),[t,o]);if(!s)return null;const y=r&&!(0,m().H6)(r)&&!(0,m().KF)(r);return(0,q.jsxs)(q.Fragment,{children:[y?(0,q.jsx)(gt().A,{isSelfRelation:c,collectionStore:s,showAs:"link",disabled:!0}):void 0,y?(0,q.jsx)(Ee().Z,{collectionContextStore:t,propertySchema:r,property:o}):void 0,u&&g&&f?(0,q.jsx)(it,{collectionContextStore:t,property:o,connectedRelationPatternName:g,integrationId:f,propertySchema:r,environment:n}):void 0,Boolean(d)?void 0:(0,q.jsx)(mt,{collectionContextStore:t,property:o,targetCollectionStore:s})]})}var yt=()=>o(998531),ht=()=>o(582684),St=()=>o(689094),vt=()=>o(596359),bt=()=>o(173868),xt=()=>o(308631),wt=()=>o(760217),Ct=()=>o(439264),At=()=>o(285790),jt=()=>o(419357),Mt=()=>o(784892),It=()=>o(908201),kt=()=>o(814777),Tt=()=>o(399762);function _t(e){var t;const o=(0,a().v3)(),i=(0,s().DP)(),{isMobile:r}=(0,a().Y0)(),{property:c,option:d,statusGroup:u,propertySchema:p,isDefault:m,disabled:g}=e,f=(0,It().ET)(),y=(0,l().K8)((()=>{var e;return null===(e=f.collectionStore())||void 0===e?void 0:e.id}),[f]),S=(0,l().uB)(void 0,J().A),v=(0,l().K8)((()=>S.state.open),[S]),b=(0,n.useCallback)((()=>{S.setState({open:!0})}),[S]),x=(0,n.useCallback)((()=>{S.setState({open:!1})}),[S]),C=(0,n.useCallback)((e=>{const t=f.collectionStore();t&&(0,M().p)({environment:o,collectionStore:t,performTransaction:o=>{for(const n of e)w().applyOperation({store:(0,X().v3)(t,n.pointer),operation:n,transaction:o})}})}),[f,o]),A=(0,s().IS)((()=>({defaultText:{fontSize:12,fontWeight:500,textTransform:"uppercase"}})),[]);return y?(0,q.jsx)(kt().h,{open:v,origin:(0,q.jsx)(T().A,{renderTooltip:e=>(0,q.jsxs)("div",{...e,style:R().Q$,children:[(0,q.jsx)("div",{children:d.value}),(0,q.jsx)("div",{style:{color:i.text.inverseSecondary},children:d.description})]}),placement:"left",disableTooltip:!(null!==(t=d.description)&&void 0!==t&&t.length),render:t=>{var o,n;return(0,q.jsx)(oe().A,{desktopTitleStyle:{marginInlineStart:-2},...t,showDragHandle:!r,showChevron:!0,disabled:g,rotateChevron:v,reducedPadding:e.reducedPadding,title:"status"===p.type?(0,q.jsx)(Tt().q,{format:r?Mt().NY.Large:Mt().NY.Medium,value:d.value,color:d.color,hideTooltip:Boolean(null===(o=d.description)||void 0===o?void 0:o.length),tooltipPlacement:"left",showRemoveButton:!1,isSingle:!0,groupColor:null==u?void 0:u.color}):(0,q.jsx)(Tt().O,{format:r?Mt().NY.Large:Mt().NY.Medium,value:d.value,color:d.color,hideTooltip:Boolean(null===(n=d.description)||void 0===n?void 0:n.length),tooltipPlacement:"left",showRemoveButton:!1,isSingle:!0}),right:m?(0,q.jsx)("span",{style:A.defaultText,children:(0,q.jsx)(h().sA,{id:"database.statusProperty.default",defaultMessage:"Default"})}):void 0,onClick:b})}}),option:d,property:c,propertySchema:p,statusGroup:u,collectionId:y,analyticsFrom:"view_settings",alignmentToOrigin:"end",onChange:C,onClose:x}):null}const Pt=o(757695).Store.createClass(void 0,{name:"InputGroupIndexStore"});function Rt(e){const{collectionContextStore:t,property:o,disabled:i,aIAutofillOption:r}=e,s=(0,a().v3)(),c=(0,l().uB)(void 0,Pt),[d,u]=(0,n.useState)({inputValue:"",focus:!1}),m=(0,l().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getSchema()}),[t]),g=(0,l().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[t]),f=(0,l().K8)((()=>Dt(t,o)),[t,o]),y=(0,l().O$)(c);if(!m||!f)return null;if("status"===f.type){const e=f.groups??[];if(0===e.length)return null;const n=f.options??[],r=e.map((e=>{const t=n.filter((t=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));return{group:e,groupOptions:t}})),a=f.defaultOption,l=[...r[0].groupOptions.map((e=>e.value))];for(const{group:t,groupOptions:o}of r.slice(1))l.push({key:`group-header-${t.name}`,draggable:!1}),l.push(...o.map((e=>e.value)));const p=j(g,m,o)?{tooltipCaption:(0,q.jsx)(h().sA,{defaultMessage:"These options are core to the property and cannot be changed.",id:"database.viewSettings.selectOptions.disabledGroupMessage"})}:void 0,S=(l,s)=>{if(l.startsWith("group-header-")){const e=l.substring(13),n=r.findIndex((({group:t})=>t.name===e)),{group:a,groupOptions:s}=r[n];return(0,q.jsxs)(Bt,{title:(0,q.jsx)(xt().RS,{disableGroup:p,group:a,showIcon:!1}),right:(0,q.jsx)(Ot,{collectionContextStore:t,property:o,onClick:e=>Kt(u,c,n),isVisible:!d.focus}),disabled:i,children:[y===n?(0,q.jsx)(Vt,{collectionContextStore:t,property:o,input:d,setInput:u,inputGroupIndexStore:c}):void 0,(0,q.jsx)(zt,{setInput:u,inputGroupIndexStore:c,groupIndex:n,visible:!d.focus&&0===s.length})]})}{const t=n.find((e=>e.value===l));if(!t)return null;const r=e.find((e=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));return(0,q.jsx)(_t,{option:t,statusGroup:r,propertySchema:f,property:o,isDefault:t.value===a,disabled:i},t.value)}};return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(Bt,{title:(0,q.jsx)(xt().RS,{disableGroup:p,group:r[0].group}),right:(0,q.jsx)(Ot,{collectionContextStore:t,property:o,onClick:()=>Kt(u,c,0),isVisible:!d.focus}),disabled:i,children:[0===y?(0,q.jsx)(Vt,{collectionContextStore:t,property:o,input:d,setInput:u,inputGroupIndexStore:c}):void 0,(0,q.jsx)(zt,{setInput:u,inputGroupIndexStore:c,groupIndex:0,visible:!d.focus&&0===r[0].groupOptions.length})]}),(0,q.jsx)(Ct().Ay,{direction:"vertical",keys:l,renderKey:S,onDrop:e=>Ft(e,s,o,t),disabled:i})]})}{const e=f.options??[],n=e.map((e=>e.value)),a=f.auto_sort_options||"manual";return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(ve().A,{icon:ht().arrowUpDownIcon,title:(0,q.jsx)(h().sA,{defaultMessage:"Sort",id:"database.viewSettings.selectOptions.autoSort"}),selectedKey:a,options:[{key:"manual",type:"button",title:(0,q.jsx)(h().sA,{defaultMessage:"Manual",id:"database.viewSettings.selectOptions.autoSort.none"})},{key:"alphabetical",type:"button",title:(0,q.jsx)(h().sA,{defaultMessage:"Alphabetical",id:"database.viewSettings.selectOptions.autoSort.alphabetical"})},{key:"reverse_alphabetical",type:"button",title:(0,q.jsx)(h().sA,{defaultMessage:"Reverse alphabetical",id:"database.viewSettings.selectOptions.autoSort.reverseAlphabetical"})}],onChange:e=>function(e,t,o,n){const i=o.collectionStore(),r=o.normalizedSchemaStore.state,a=Dt(o,n);if(!i||!a)return;if(!(0,p().lx)(a))return;const l=[{pointer:i.pointer,command:"update",path:["schema",n],args:{auto_sort_options:e}}];"alphabetical"!==e&&"reverse_alphabetical"!==e||l.push(...function(e){const{collectionId:t,property:o,propertySchema:n,schema:i,isAscending:r}=e,a=n.options||[],l=[...a].map((e=>e.value)).sort(((e,t)=>e.localeCompare(t,void 0,{sensitivity:"base"})*(r?1:-1)));return(0,bt().o)({newOptions:l,collectionId:t,property:o,schema:i})}({collectionId:i.id,property:n,propertySchema:a,schema:r,isAscending:"alphabetical"===e})||[]);(0,M().p)({environment:t,collectionStore:i,performTransaction:e=>{for(const t of l)w().applyOperation({store:(0,X().v3)(i,t.pointer),operation:t,transaction:e})}}),(0,x().V)({environment:t,collectionContextStore:o,property:n,from:"view_settings",action:"select_change_auto_sort_options"})}(e,s,t,o),popupStyle:{minWidth:190}},"autoSortMenuItem"),r,(0,q.jsxs)(Bt,{topBorder:!0,overrideStyle:{marginTop:4,marginInlineStart:-4,width:"calc(100% + 8px)"},title:(0,q.jsx)(h().sA,{defaultMessage:"Options",id:"database.viewSettings.selectOptions.title"}),right:(0,q.jsx)("div",{style:{marginInlineEnd:-2},children:(0,q.jsx)(Ot,{collectionContextStore:t,property:o,onClick:()=>Kt(u,c),isVisible:!d.focus&&n.length>0})}),disabled:i,children:[(0,q.jsx)(Vt,{collectionContextStore:t,property:o,input:d,setInput:u,inputGroupIndexStore:c}),(0,q.jsx)(zt,{setInput:u,inputGroupIndexStore:c,visible:!d.focus&&0===n.length})]},"sectionHeader"),n.length>0?(0,q.jsx)(Ct().Ay,{style:{marginBottom:2},direction:"vertical",keys:n,renderKey:t=>{const n=e.find((e=>e.value===t));return n?(0,q.jsx)(_t,{option:n,property:o,propertySchema:f,isDefault:!1,statusGroup:void 0,disabled:i,reducedPadding:!0},n.value):null},onDrop:e=>Ft(e,s,o,t)}):void 0]})}}function Bt({title:e,right:t,children:o,disabled:n,overrideStyle:i,topBorder:r}){const a=(0,Pe().Tf)(),l=(0,s().IS)((()=>({desktop:{width:"100%",paddingBottom:0,...i},desktopTitle:{height:20},mobile:{...a&&{borderRadius:0}},mobileTitle:{...a&&{paddingTop:12,paddingBottom:4,minHeight:44}}})),[a,i]);return(0,q.jsx)(k().A,{title:e,right:!n&&t,style:l.desktop,desktopTitleStyle:l.desktopTitle,mobileStyle:l.mobile,mobileTitleStyle:l.mobileTitle,disableMobilePadding:!!a||void 0,topBorder:r,children:n?void 0:o})}function Dt(e,t){const o=e.normalizedSchemaStore.state[t];if(o&&((0,p().lx)(o)||"status"===o.type))return o}function Ot({onClick:e,collectionContextStore:t,property:o,isVisible:n}){const i=(0,h().tz)();return(0,l().K8)((()=>Dt(t,o)),[t,o])?(0,q.jsx)(At().A,{icon:St().W,onClick:e,style:{width:20,height:20,visibility:n?void 0:"hidden"},disabled:!n,ariaLabel:i.formatMessage({defaultMessage:"Add an option",id:"database.viewSettings.selectOptions.addOption"})}):null}function Ft(e,t,o,n){const i=n.normalizedSchemaStore.state,r=n.collectionStore();r&&(vt().gc({newValues:e,property:o,schema:i,collectionStore:r,environment:t}),(0,x().V)({environment:t,collectionContextStore:n,property:o,from:"view_settings",action:"select_options_reorder"}))}function Kt(e,t,o){e({focus:!0,inputValue:""}),void 0!==o&&t.setState(o)}function Vt({collectionContextStore:e,property:t,input:o,setInput:i,inputGroupIndexStore:l}){const c=(0,a().v3)(),d=(0,h().tz)(),u=(0,n.useCallback)((n=>{null==n||n.stopPropagation(),function(e,t,o,n,i,r){const a=t.collectionStore(),l=Dt(t,o);if(!l||!a)return;const s=l.options||[],c=n.inputValue.trim();if(c)if("status"===l.type){const t=r.state;let n;if(void 0!==t&&(n=s.find((e=>{var o;return null===(o=l.groups)||void 0===o||null===(o=o[t].optionIds)||void 0===o?void 0:o.includes(e.id)}))),void 0===t||void 0!==n)vt().Uk({modification:{type:"keyedObjectListBefore",beforeOption:n,newValue:c},property:o,propertySchema:l,options:s,environment:e,collectionStore:a,groupIndex:t});else{let n;for(let e=t-1;e>=0;e--){var d;const t=null===(d=l.groups)||void 0===d?void 0:d[e];if(t&&(n=s.find((e=>{var o;return null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id)})),void 0!==n))break}vt().Uk({modification:{type:"keyedObjectListAfter",afterOption:n,newValue:c},property:o,propertySchema:l,options:s,environment:e,collectionStore:a,groupIndex:t})}}else!(0,p().lx)(l)||"alphabetical"!==l.auto_sort_options&&"reverse_alphabetical"!==l.auto_sort_options?vt().Uk({modification:{type:"keyedObjectListBefore",newValue:c},property:o,propertySchema:l,options:s,environment:e,collectionStore:a}):vt().Uk({modification:{type:"autoSortInsert",newValue:c},property:o,propertySchema:l,options:s,environment:e,collectionStore:a});i({focus:!0,inputValue:""}),(0,x().V)({environment:e,collectionContextStore:t,property:o,from:"view_settings",action:"select_add_option",option_value_char_count:c.length})}(c,e,t,o,i,l)}),[c,e,t,o,i,l]),m=(0,n.useCallback)((e=>function(e,t){t({focus:!0,inputValue:e.target.value.replace(/,/g,"")})}(e,i)),[i]),g=(0,n.useCallback)((()=>function(e,t,o){o({focus:!1,inputValue:r().A.isMobile?t.inputValue:""})}(0,o,i)),[c,o,i]),f=(0,$().a)(),y=(0,s().IS)((e=>({inputOuterStyle:f?{backgroundColor:e.background.primary}:{},inputMenuItem:{marginTop:2,marginBottom:8}})),[f]);return o.focus?(0,q.jsx)(yt().N,{debugName:"CollectionSettingsSelectOptions",capture:!0,onEsc:g,children:(0,q.jsx)(jt().Ay,{value:o.inputValue,focus:!0,placeholder:d.formatMessage({defaultMessage:"Type a new option…",id:"database.viewSettings.selectOptions.newSelectOption.inputPlaceholder"}),style:y.inputMenuItem,inputOuterStyle:y.inputOuterStyle,onChange:m,onBlur:g,onSubmit:u,mobileKeyboardOnDismiss:u})}):null}function zt({groupIndex:e,setInput:t,inputGroupIndexStore:o,visible:n}){return(0,q.jsx)(wt().A,{icon:(0,St().W)({width:14}),focused:!1,title:(0,q.jsx)(h().sA,{defaultMessage:"Add an option",id:"database.viewSettings.selectOptions.noOptions"}),buttonStyle:{...n?{}:{display:"none"}},style:{width:"100%"},onClick:()=>Kt(t,o,e)})}var Nt=()=>o(109129),Wt=()=>o(611520);const qt=n.memo((function(e){const{collectionContextStore:t,collectionSettingsStore:i,formatKey:r,property:c,selectNameInitial:d,titleOverride:u}=e,[p,g]=(0,n.useState)(!1),[f,y]=(0,n.useState)(""),S=(0,a().v3)(),v=(0,n.useRef)(null),C=(0,h().tz)(),A=(0,s().DP)(),j=(0,s().eP)(),{collectionStore:M,isMultiSourceView:T}=(0,l().K8)((()=>({collectionStore:t.collectionStore(),isMultiSourceView:"collectionTypedView"===t.contextType})),[t]),_=(0,l().O$)(t.normalizedSchemaStore),{isTypedProperty:B,databaseType:D}=(0,l().K8)((()=>M?{isTypedProperty:M.isTypedProperty(c),databaseType:M.getDatabaseType()}:{isTypedProperty:!1,databaseType:void 0}),[M,c]),F=(0,l().K8)((()=>(0,m()._g)({schema:_,property:c})),[c,_]),K=(0,l().K8)((()=>Ut({property:c,formatKey:r,collectionContextStore:t})),[t,r,c]),V=(0,l().K8)((()=>(0,P().fE)({property:c,collectionContextStore:t,newValue:f})),[t,f,c]),z=(0,l().K8)((()=>{var e;const n=null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id;return!!n&&(0,o(696746).Nh)(n)}),[t]),N=(0,l().K8)((()=>void 0!==M&&void 0!==D&&(0,o(671793).j)((0,o(413955).appConfigs)(),D,c,M)),[M,D,c]),W=(0,l().K8)((()=>{var e;const o=t.collectionViewStore();return!!o&&("timeline"!==o.getType()&&Boolean((null===(e=Ut({property:c,formatKey:r,collectionContextStore:t}))||void 0===e?void 0:e.wrap)||o.getFormat().table_wrap))}),[t,r,c]),U=(0,l().uB)(void 0,J().A),L=(0,$().a)();(0,n.useEffect)((()=>{!function(e,t,n){const i=t.collectionViewStore();if(!i||"table"!==i.getType())return;const r=o(344482).A.findTableHeaderCell(t,e);if(!r)return;const a=r.getNode();if(!a||!n)return;const l=(0,o(53798).T8)(a);if(!l)return;const s=n.getBoundingClientRect(),c=a.getBoundingClientRect().right+20-s.left;l.scrollLeft=l.scrollLeft+c}(c,t,v.current),F&&y(F.name||"")}),[t,c,F]);const E=(0,n.useCallback)((e=>{(0,ee().Fc)({collectionContextStore:t,environment:S,inputValue:f,name:e,property:c})}),[t,S,f,c]),H=(0,n.useCallback)((e=>{g(!p),e.stopPropagation()}),[p]),G=(0,n.useCallback)((e=>{!function(e){var t;const{description:o,environment:n,collectionContextStore:i,property:r}=e,a=i.collectionStore(),l=null==a||null===(t=a.getSchema())||void 0===t?void 0:t[r];if(!a||void 0===l||o===l.description)return;w().createAndCommit({userAction:"CollectionSettingsProperty.handleDescriptionChange",environment:n,canUndo:!0,perform:e=>{(0,I().F)({environment:n,collectionStore:a,update:{[r]:{...l,description:o}},transaction:e})}}),(0,x().V)({environment:n,collectionContextStore:i,property:r,from:"view_properties",action:"set_description"})}({collectionContextStore:t,description:e,environment:S,property:c})}),[t,S,c]),Z=(0,n.useCallback)((e=>{y(e)}),[]);if(!F)return null;const X=!(0,m().di)(F),Q=T,te=T||(0,m().Jf)({property:c,propertySchema:F,isTypedProperty:B,schema:_}),oe=F.description;return(0,q.jsxs)(o(735695).Ay,{...e,title:u||(M?(0,q.jsx)(h().sA,{defaultMessage:"Edit property",id:"database.viewSettings.propertyTab.title"}):(0,q.jsx)(h().sA,{defaultMessage:"View property",id:"database.viewSettings.propertyTab.title.viewProperty"})),footer:(0,q.jsx)(Ue,{collectionContextStore:t,formatKey:r,property:c,collectionSettingsStore:i,wrapProperty:W,propertySchema:F,propertyFormat:K,isRequiredTypedProperty:N,databaseType:D}),ref:v,children:[(0,q.jsxs)(k().A,{isInput:!0,style:L?{margin:"0 2px"}:void 0,children:[(0,q.jsx)(o(755735).B,{disabled:Q,initialValue:F.name||"",placeholder:O().A.formatMessage(He().A.inputPlaceholder),onBlur:E,onSubmit:E,focusInitial:d,selectAll:d,iconButton:{icon:e=>(0,q.jsx)(o(852424).zB,{type:F.type,icon:F.icon,size:o(340498).Ev.sm,theme:A,style:e}),iconStyle:{fill:o(278238).l8[j].gray},...L?{hasBackground:!0}:void 0,enforceIconColor:"gray",onSubmit:e=>function(e,t,n,i){const r=n.collectionStore();if(!r)return;(0,o(986488).y)({environment:e,collectionStore:r,collectionContextStore:n,property:t,icon:i,from:"view_settings"})}(S,c,t,e)},inputOuterStyle:L?{backgroundColor:A.white}:void 0,inputRightButton:z?null:(0,q.jsx)(o(539148).S,{description:oe,showTooltip:!p,onClick:H,addDescriptionText:C.formatMessage(R().Mo.addPropertyDescriptionTooltip),editDescriptionText:C.formatMessage(R().Mo.editPropertyDescriptionTooltip)}),onChange:Z}),V?(0,q.jsx)(o(653259).A,{propertyName:f}):void 0]}),p?(0,q.jsx)(o(705602).y,{initialDescription:oe,handleSaveDescription:G}):void 0,(0,q.jsx)(oo,{collectionStore:M,property:c,propertySchema:F}),(0,q.jsxs)(k().A,{extraPadding:!0,children:[X?(0,q.jsx)(b().Dy,{disabled:te,isTypedProperty:B,collectionUri:D,collectionContextStore:t,formatKey:r,propertyTypeButtonPopupStore:U,property:c}):void 0,"button"===F.type?(0,q.jsx)(b().nR,{collectionSettingsStore:i,collectionContextStore:t,property:c,source:"collectionSettingsMenu"}):void 0,T?(0,q.jsxs)(q.Fragment,{children:["status"===F.type?(0,q.jsx)(Lt,{collectionSettingsStore:i,collectionContextStore:t,property:c}):void 0,"date"===F.type||"created_time"===F.type||"last_edited_time"===F.type?(0,q.jsx)(Ht,{collectionContextStore:t,property:c}):void 0]}):(0,q.jsx)(so,{collectionContextStore:t,property:c,propertySchema:F,source:"collectionSettingsMenu"})]}),L?(0,q.jsx)(Y,{}):void 0]})}));function Yt(e){const t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}function Ut(e){const{collectionContextStore:t,formatKey:o,property:n}=e,i=function(e){const{formatKey:t,collectionContextStore:o}=e;return t?"collection_page_properties"===t?(null===(n=o.collectionStore())||void 0===n?void 0:n.getFormat().collection_page_properties)??[]:o.normalizedFormatStore.state[t]||[]:[];var n}({formatKey:o,collectionContextStore:t});return null==i?void 0:i.find((e=>e.property===n))}function Lt({collectionSettingsStore:e,collectionContextStore:t,property:o}){const n=(0,l().K8)((()=>{var e;return j(null===(e=t.collectionStore())||void 0===e?void 0:e.getDatabaseType(),t.normalizedSchemaStore.state,o)}),[t,o]),r=(0,i().X)("move_show_as_option_for_select_property");return(0,q.jsxs)(q.Fragment,{children:[n||r?void 0:(0,q.jsx)(De().u,{collectionContextStore:t,property:o,disabled:n}),(0,q.jsx)(Rt,{collectionSettingsStore:e,collectionContextStore:t,property:o,disabled:n,aIAutofillOption:null})]})}function Et({collectionContextStore:e,collectionSettingsStore:t,property:o}){return(0,q.jsx)(ne,{collectionContextStore:e,collectionSettingsStore:t,property:o})}function Ht({collectionContextStore:e,property:t}){return(0,q.jsx)(be,{collectionContextStore:e,property:t})}function Gt({collectionContextStore:e,property:t}){const o=(0,l().K8)((()=>{const o=e.normalizedSchemaStore.state[t];return o&&(0,p().UU)(o)}),[e,t]),n=(0,l().K8)((()=>{const o=e.normalizedSchemaStore.state[t];return(0,m().di)(o)}),[e,t])?(0,q.jsx)(Le().A,{collectionContextStore:e,property:t}):(0,q.jsx)(ft,{collectionContextStore:e,property:t}),i=o?(0,q.jsx)(Wt().uo,{collectionContextStore:e,property:t,compact:!0}):null;return(0,q.jsxs)(q.Fragment,{children:[i,n]})}function $t({collectionContextStore:e,property:t,source:o}){const n=(0,l().K8)((()=>(0,ee().Jq)({collectionContextStore:e,property:t})),[e,t]);return n&&("number"===n.type||"formula"===n.type||"rollup"===n.type)?(0,q.jsx)(ie().W,{collectionContextStore:e,property:t,source:o}):null}function Jt({collectionContextStore:e,property:t}){const o=(0,l().K8)((()=>(0,ee().Jq)({collectionContextStore:e,property:t})),[e,t]),n=(0,l().K8)((()=>e.collectionStore()),[e]);return o&&"url"===o.type&&n?(0,q.jsx)(Nt().V,{collectionContextStore:e,property:t,propertySchema:o}):null}function Zt({collectionContextStore:e,property:t}){const o=(0,l().K8)((()=>(0,ee().Jq)({collectionContextStore:e,property:t})),[e,t]);return o&&"person"===o.type?(0,q.jsx)(je,{collectionContextStore:e,propertySchema:o,property:t}):null}function Xt({collectionContextStore:e,property:t}){const o=(0,a().v3)(),i=(0,h().tz)(),r=(0,l().K8)((()=>{const o=(0,ee().Jq)({collectionContextStore:e,property:t});return"person"===(null==o?void 0:o.type)?o:void 0}),[e,t]),s=(0,l().K8)((()=>e.collectionStore()),[e]),c=(0,l().K8)((()=>{if(r)return function(e){return e.notifications??u}(r)}),[r]),d=(0,n.useCallback)((e=>{s&&r&&w().createAndCommit({userAction:"PersonNotificationOptions.handlePersonNotificationChange",environment:o,canUndo:!0,perform:n=>{(0,I().F)({environment:o,collectionStore:s,update:{[t]:{...r,notifications:e}},transaction:n})}})}),[o,s,t,r]);return c?(0,q.jsx)(ve().A,{icon:f().r,title:(0,q.jsx)(h().sA,{defaultMessage:"Notifications",id:"database.personProperty.notifications"}),selectedKey:c,options:[{key:"usersAndGroups",type:"button",title:i.formatMessage(He().A.usersAndGroups)},{key:"usersOnly",type:"button",title:i.formatMessage(He().A.usersOnly)},{key:"none",type:"button",title:i.formatMessage(He().A.none)}],onChange:d}):null}function Qt({collectionContextStore:e,property:t}){const o=(0,l().K8)((()=>(0,ee().Jq)({collectionContextStore:e,property:t})),[e,t]);return o&&"button"===o.type?(0,q.jsx)(b().m4,{collectionContextStore:e,propertySchema:o,property:t}):null}function eo({collectionContextStore:e,property:t}){const o=(0,l().K8)((()=>(0,ee().Jq)({collectionContextStore:e,property:t})),[e,t]);return o?(0,q.jsx)(Ee().Z,{collectionContextStore:e,propertySchema:o,property:t}):null}function to({collectionContextStore:e,property:t}){const o=(0,l().K8)((()=>(0,ee().Jq)({collectionContextStore:e,property:t})),[e,t]),n=(0,l().K8)((()=>{var t;const o=null===(t=e.collectionStore())||void 0===t?void 0:t.getRecordKeyStore();return null==o?void 0:o.getRecordKey()}),[e]);return o&&"auto_increment_id"===o.type?(0,q.jsx)(ae().A,{uniqueIdProperty:{property:t,propertySchema:o},prefixValue:n,collectionContextStore:e}):null}function oo({collectionStore:e,property:t,propertySchema:n}){const i=(0,o(763870).i)({collectionStore:e,property:t,propertySchema:n,blockStore:void 0}),a=(0,l().K8)((()=>{if(!i)return null;const{role:e}=i,t=n.name;return(0,o(115314).v)(e,t)}),[i,n.name]),c=(0,s().IS)((()=>({rowPermissionBannerWrapperStyle:{padding:r().A.isMobile?void 0:"0 4px"}})),[]);return i?(0,q.jsx)(k().A,{extraPadding:!0,children:(0,q.jsx)("div",{style:c.rowPermissionBannerWrapperStyle,children:(0,q.jsx)(o(179030).l,{display:"inline-compact",staticIcon:o(112886).keyFillSmallIcon,label:a,tint:"gray"})})}):null}function no({collectionContextStore:e,property:t}){return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(eo,{collectionContextStore:e,property:t}),(0,q.jsx)(Zt,{collectionContextStore:e,property:t}),(0,q.jsx)(Xt,{collectionContextStore:e,property:t})]})}function io(e){const{environment:t,property:o,propertySchema:r,collectionSettingsStore:a,collectionContextStore:s,collectionStore:c,buttonPopupParent:u}=e,m=(0,l().K8)((()=>(0,p().om)(r)),[r]),f=(0,i().X)("database_agents"),y=Boolean(m),v=(0,l().K8)((()=>(0,D().jq)(Z().A.getMode(t,c),c)),[t,c]),b=(0,n.useMemo)((()=>{const e=r.name.trim(),t=P().dC[r.type],o=new RegExp(`${t}(?:\\s?\\d+)?`);return!e||o.test(e)}),[r.name,r.type]),x=(0,n.useCallback)((()=>{if(!c||!r||!(0,p().lx)(r))return;const e=(0,p().RM)(r);if(!e)return;const n=[];if(m)C().trackAiAutofillSettingsAction(t,{type:"remove_ai_inference",ai_inference_type:m.type,collection_id:c.id}),n.push({pointer:c.pointer,command:"set",path:["schema",o,e],args:void 0});else{const i={type:r.type,auto_update_on_edit:!1,add_options:!1};C().trackAiAutofillSettingsAction(t,{type:"set_ai_inference",ai_inference_type:i.type,collection_id:c.id}),n.push({pointer:c.pointer,command:"set",path:["schema",o,e],args:i})}(0,M().p)({environment:t,collectionStore:c,performTransaction:e=>{for(const t of n)w().applyOperation({store:(0,X().v3)(c,t.pointer),operation:t,transaction:e})}})}),[m,c,t,o,r]),A=(0,n.useCallback)((e=>{if(!r||!c||!(0,p().$M)(r))return;const n=(0,p().RM)(r);if(!n)return;const i={pointer:c.pointer,command:"set",path:["schema",o,n],args:e};(0,M().p)({environment:t,collectionStore:c,performTransaction:e=>{w().applyOperation({store:(0,X().v3)(c,i.pointer),operation:i,transaction:e})}})}),[c,t,o,r]),j=(0,l().K8)((()=>Yt(s)),[s]);return v&&"form_editor"!==j&&(!f||y)?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(k().A,{topBorder:!0,style:{marginTop:4,paddingTop:0,marginInlineStart:-4,width:"calc(100% + 8px)"}},"aiSectionHeader"),(0,q.jsx)(T().A,{disableTooltip:!b,placement:"left",renderTooltip:e=>(0,q.jsx)(h().sA,{...e,defaultMessage:"Update the property name to use AI autofill",id:"database.collectionsettings.autofilloptions.disableswitch.tooltip",description:"User needs to change the property name from the default name to turn on autofill"}),render:e=>(0,q.jsx)(Oe().A,{...e,title:(0,q.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:(0,q.jsx)(h().sA,{defaultMessage:"AI autofill",id:"database.viewSettings.propertyTab.aiAutofill.open"})}),showChevron:!1,switcherProps:{on:Boolean(m),noColor:!1},onClick:x,disabled:!v||b}),style:{whiteSpace:"break-spaces"}}),!m||b||"select"!==m.type&&"multi_select"!==m.type?void 0:(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(re().A,{setAiInference:A,aiInference:m,disabled:!v}),(0,q.jsx)(oe().A,{title:(0,q.jsxs)("div",{style:{display:"flex",alignItems:"center",lineHeight:1.2,color:S().Tj.uiGray,gap:4},children:[(0,q.jsx)(h().sA,{id:"database.collectionsettings.aiAutofillOptions.more",defaultMessage:"More"}),(0,q.jsx)(d().I,{icon:g().arrowChevronSingleRightFillSmallIcon,size:"xs",colorVariant:"tertiary"})]}),disabled:!1,onClick:()=>{null==u||u.close(),Q().a2({collectionSettingsStore:a,item:{type:"propertyAiAutofill",propertySchema:r,property:o}})}})]})]}):null}function ro({propertySchema:e,collectionSettingsStore:t,collectionContextStore:o,property:n,buttonPopupParent:i}){const r=(0,a().v3)(),s=(0,l().K8)((()=>o.collectionStore()),[o]);return s?(0,q.jsx)(Rt,{collectionSettingsStore:t,collectionContextStore:o,property:n,disabled:!1,aIAutofillOption:(0,q.jsx)(io,{environment:r,collectionStore:s,collectionSettingsStore:t,collectionContextStore:o,property:n,propertySchema:e,buttonPopupParent:i})}):null}function ao({collectionContextStore:e,property:t,collectionSettingsStore:o,source:n}){const r=(0,i().X)("database_agents"),a=(0,l().K8)((()=>(0,ee().Jq)({collectionContextStore:e,property:t})),[e,t]),s=(0,l().K8)((()=>Yt(e)),[e]),d=!(0,l().O$)(c().e);if(!a||"text"!==a.type||"form_editor"===s)return null;const u=(0,p().om)(a),m=Boolean(u);if(r&&!m)return null;let g;return u&&(0,p().UH)(u.type)?"summarize"===u.type?g=B().VT.autofillSummary:"extract"===u.type?g=B().VT.autofillExtract:"custom"===u.type?g=B().VT.autofillCustom:"translate"===u.type?g=B().VT.autofillTranslate:(0,v().HB)(u):g=He().A.autofillOffLabel,(0,q.jsx)(oe().A,{title:(0,q.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:(0,q.jsx)(h().sA,{defaultMessage:"AI autofill",id:"database.viewSettings.propertyTab.aiAutofill.open"})}),source:n,icon:y().pencilLineIcon,showChevron:!0,right:O().A.formatMessage(g),onClick:()=>function(e,t,o){const n=(0,ee().Jq)({collectionContextStore:t,property:o});t.collectionStore()&&n&&Q().a2({collectionSettingsStore:e,item:{type:"propertyAiAutofill",propertySchema:n,property:o}})}(o,e,t),disabled:d})}function lo({property:e,collectionContextStore:t}){const o=(0,a().v3)(),n=(0,l().K8)((()=>t.collectionStore()),[t]),i=(0,l().K8)((()=>(0,P().Kc)(t)),[t]),r=(0,l().K8)((()=>Boolean((null==n?void 0:n.getDatabaseType())&&(null==n?void 0:n.isTypedProperty(e)))),[n,e]);return n?(0,q.jsx)(_().R,{disabled:r,context:"viewSettings",property:e,schema:i,analyticsFrom:"view_settings",parentStore:n,onChange:n=>function(e,t,o,n){const i=n.collectionStore();i&&w().createAndCommit({userAction:"CollectionSettingsProperty.handleRollupPropertyMenuChange",environment:t,canUndo:!0,perform:n=>{(0,I().F)({environment:t,collectionStore:i,update:{[o]:e.propertySchema},transaction:n})}})}(n,o,e,t)}):null}function so({property:e,propertySchema:t,collectionContextStore:o,source:i,buttonPopupParent:r}){const a=o.settingsStore;return(0,n.useMemo)((()=>"button"===t.type),[t.type])?null:(0,q.jsxs)(q.Fragment,{children:["text"===t.type?(0,q.jsx)(ao,{collectionContextStore:o,property:e,collectionSettingsStore:a,source:i}):void 0,(0,p().lx)(t)?(0,q.jsx)(ro,{collectionSettingsStore:a,collectionContextStore:o,property:e,propertySchema:t,buttonPopupParent:r}):void 0,"status"===t.type?(0,q.jsx)(Lt,{collectionSettingsStore:a,collectionContextStore:o,property:e}):void 0,"formula"===t.type?(0,q.jsx)(Et,{collectionContextStore:o,collectionSettingsStore:a,property:e}):void 0,"rollup"===t.type?(0,q.jsx)(lo,{property:e,collectionContextStore:o}):void 0,"date"===t.type||"created_time"===t.type||"last_edited_time"===t.type?(0,q.jsx)(Ht,{collectionContextStore:o,property:e}):void 0,"relation"===t.type?(0,q.jsx)(Gt,{collectionContextStore:o,property:e}):void 0,"person"===t.type?(0,q.jsx)(no,{collectionContextStore:o,property:e}):void 0,(0,q.jsx)($t,{collectionContextStore:o,property:e,source:i}),(0,q.jsx)(Jt,{collectionContextStore:o,property:e}),"auto_increment_id"===t.type?(0,q.jsx)(to,{collectionContextStore:o,property:e}):void 0,"button"===t.type?(0,q.jsx)(Qt,{collectionContextStore:o,property:e}):void 0]})}},755735:(e,t,o)=>{o.d(t,{B:()=>a});var n=o(296540),i=()=>o(419357),r=o(474848);const a=n.forwardRef((function(e,t){const{placeholder:a,focusInitial:l,selectAll:s,disabled:c,inputOuterStyle:d,iconButton:u,inputRightButton:p,initialValue:m,onBlur:g,onSubmit:f,onChange:y,maxLength:h,textWrapperStyle:S,textarea:v}=e,[b,x]=(0,n.useState)((()=>m||"")),w=(0,n.useCallback)((()=>{g(b)}),[b,g]),C=(0,n.useCallback)((()=>{f(b)}),[b,f]),A=(0,n.useCallback)((e=>{const t=e.target.value;x(t),null==y||y(t)}),[y]),j=(0,o(208698).$)({iconButton:u}),M=(0,o(336811).O)();(0,n.useEffect)((()=>()=>{M.current&&m!==b&&g(b)}),[m,b,M,g]);const I=(0,o(401497).IS)((()=>({iconButton:{opacity:c?.4:void 0},textWrapper:{opacity:c?.4:void 0,...S}})),[c,S]);return(0,r.jsx)(i().Ay,{ref:t,focusInitial:l,autoFocus:!!l||void 0,selectAll:s,value:b,onChange:A,onBlur:w,onSubmit:C,placeholder:a,disabled:c,textWrapperStyle:I.textWrapper,maxlength:h,inputOuterStyle:d,left:u?(0,r.jsx)(i().KF,{icon:u.icon,iconStyle:u.iconStyle,onClick:j,disabled:c,style:I.iconButton,hasBackground:u.hasSolidBackground}):null,showClearButton:!1,inputRight:p,textarea:v})}))},796073:(e,t,o)=>{o.d(t,{$:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("sync",{viewBox:"0 0 30 30",svg:(0,n.jsx)("path",{d:"M27.93 13.81h-1.54c-.606-5.717-5.536-10.265-11.387-10.265-3.425 0-6.514 1.55-8.625 3.987-.427.483-.37 1.078.079 1.392.438.315.965.214 1.336-.202a9.57 9.57 0 017.21-3.268 9.503 9.503 0 019.456 8.356h-1.673c-.798 0-1 .539-.573 1.156l2.516 3.583c.359.516.898.528 1.269 0l2.504-3.572c.45-.628.236-1.167-.573-1.167zM2.064 16.202h1.55c.607 5.716 5.526 10.253 11.388 10.253 3.425 0 6.525-1.561 8.636-3.987.416-.483.36-1.09-.078-1.404-.438-.314-.977-.202-1.337.214-1.74 2.01-4.324 3.268-7.221 3.268a9.496 9.496 0 01-9.467-8.344H7.22c.798 0 1-.55.573-1.157l-2.516-3.583c-.359-.516-.898-.527-1.269 0l-2.515 3.572c-.438.617-.236 1.168.572 1.168z"})})},815510:(e,t,o)=>{o.d(t,{$6:()=>w,D9:()=>S,GK:()=>y,MT:()=>A,XL:()=>h,Xp:()=>b,ay:()=>v,deleteDatabaseAgentsFromProperty:()=>j,gT:()=>x,r1:()=>C});o(944114),o(898992),o(354520),o(672577),o(430670),o(803949),o(581454),o(737550);var n=o.n(o(794148)),i=()=>o(179034),r=()=>o(743246),a=()=>o(498212),l=()=>o(877661),s=()=>o(559506),c=()=>o(357625),d=()=>o(471995),u=()=>o(231297),p=()=>o(212854),m=()=>o(493612),g=()=>o(402560),f=()=>o(629509);async function y(e){const{environment:t,collectionStore:o,propertyId:n,propertySchema:i,workflows:r,collectionContextStore:a}=e,l=await(0,p().e)({environment:t,collectionStore:o,propertyId:n,propertySchema:i,collectionContextStore:a});return!i.default_workflow_id&&l.workflowId&&h({workflowId:l.workflowId,propertyId:n,collectionStore:o,workflows:r,environment:t}),l.workflowId}function h(e){const{workflowId:t,propertyId:o,collectionStore:n,workflows:i,environment:a}=e,l=n.pointer;u().createAndCommit({userAction:"AgentsSubmenu.setDefaultWorkflow",environment:a,canUndo:!0,perform:e=>{const a=(0,f().Eq)({collectionPointer:l,propertyId:o,workflowId:t});u().applyOperation({store:n,operation:a,transaction:e});const s=i.find((e=>e.id===t));if(s){const i=s.getDraftData()??s.getData();if(null!=i&&i.modules){const a=i.modules.map((e=>{if("notion"===e.type){var t;const n=(null===(t=e.state)||void 0===t?void 0:t.ownedByDatabasePropertyIds)??[];if(!n.includes(o))return{...e,state:{...e.state,ownedByDatabasePropertyIds:[...n,o]}}}return e}));if(a.some(((e,t)=>{var o;return e!==(null===(o=i.modules)||void 0===o?void 0:o[t])}))){const o=n.getSpaceId(),i={command:"set",path:["data","modules"],args:a,pointer:{id:t,table:r().C0,spaceId:o}};u().applyOperation({store:s,operation:i,transaction:e})}}}}})}async function S(e){const{workflowStore:t,environment:o,spaceId:n}=e,i="success"===(await s().callApi({eventName:"publishCustomAgentVersion",environment:o,data:{workflowId:t.id,spaceId:n}})).type;return i?d().D6({label:"Agent published successfully"}):d().D6({label:"Failed to publish agent"}),{success:i}}async function v(e){const{n:t,collectionContextStore:o,workflowStore:n,currentCollectionStore:a,environment:s,properties:u,spaceId:p}=e,g=o.resultsInViewOrder(t);if(0===g.length)return;const f=g.map((e=>e.id)),y=f.flatMap((e=>u.map((t=>({rowId:e,propertyId:t})))));y.forEach((e=>m().Z.startIndividualCellFill(e)));const h=(0,c().UT)(s,l().m,{type:"blockFill",workflowPointer:{table:r().C0,id:n.id,spaceId:p},collectionId:a.id,blockIds:f.map((e=>({table:i().ev,id:e,spaceId:p}))),propertyIds:u},{spaceIds:[p]});let S=!1;for await(const i of h){var v;if("failure"===i.taskStatus)return y.forEach((e=>m().Z.removeCellBeingFilled(e))),void d().D6({label:"Failed to trigger agent for selected rows"});if("success"===i.taskStatus&&"value"in i&&null!==(v=i.value)&&void 0!==v&&v.success){S=!0;break}}S||y.forEach((e=>m().Z.removeCellBeingFilled(e)))}async function b(e){var t;const{workflowStore:o,currentCollectionStore:n,collectionContextStore:i,environment:a,spaceId:s,properties:u}=e,p=n.id,m=null===(t=i.collectionViewStore())||void 0===t?void 0:t.id,g=(0,c().UT)(a,l().m,{type:"viewFill",workflowPointer:{table:r().C0,id:o.id,spaceId:s},collectionId:p,...m&&{viewId:m},propertyIds:u},{spaceIds:[s]});let f=!1;for await(const r of g){var y,h;if("failure"===r.taskStatus){f=!1;break}if("value"in r&&null!==(y=r.value)&&void 0!==y&&y.percentageComplete,"success"===r.taskStatus&&"value"in r&&null!==(h=r.value)&&void 0!==h&&h.success){f=!0;break}}return f?d().D6({label:"Started filling all pages in the collection"}):d().D6({label:"Failed to start fill all operation"}),{success:f}}function x(e){const{workflowStore:t,currentCollectionStore:o,environment:n,spaceId:i,properties:l,triggerStates:s,triggerType:c,enabled:d}=e,p=o.id;u().createAndCommit({userAction:"CollectionSettingsPropertyAgentAutofill.updateTriggers",environment:n,canUndo:!0,perform:e=>{const n={...s,[c]:d},m=[];if(m.push({id:(0,a().lZ)(),name:"Database agent manually triggered",moduleId:void 0,enabled:!0,state:{type:"notion.button.pressed"}}),n.shouldTriggerOnPageContentUpdate||n.shouldTriggerOnPropertyUpdate){const e=o.getSchema(),t=Object.keys(e).filter((e=>!l.includes(e)));m.push({id:(0,a().lZ)(),name:"Page Updated",moduleId:void 0,enabled:!0,state:{type:"notion.page.updated",collectionId:p,propertyIds:n.shouldTriggerOnPropertyUpdate?t:[],shouldIgnorePageContentUpdates:n.shouldTriggerOnPropertyUpdate&&!n.shouldTriggerOnPageContentUpdate}})}n.shouldTriggerOnPageCreate&&m.push({id:(0,a().lZ)(),name:"Page Created",moduleId:void 0,enabled:!0,state:{type:"notion.page.created",collectionId:p}});const g={command:"update",path:["data"],args:{triggers:m},pointer:{id:t.id,table:r().C0,spaceId:i}};u().applyOperation({store:t,operation:g,transaction:e})}})}function w(e){const{workflowStore:t,environment:o,spaceId:n,newSearchStates:i,collectionViewBlockId:a}=e;u().createAndCommit({userAction:"CollectionSettingsPropertyAgentAutofill.updateSearchPermissions",environment:o,canUndo:!0,perform:e=>{const o=t.getDraftData()??t.getData();if(null==o||!o.modules)return;const l=o.modules.find((e=>"notion"===e.type));if(!l||"notion"!==l.type)return;const s=function(e){const{searchStates:t,collectionViewBlockId:o}=e,n=[];return n.push({moduleType:"notion",type:"notion",identifier:{type:"pageOrCollectionViewBlock",blockId:o},actions:["read_and_write"]}),t.canSearchWorkspace&&n.push({moduleType:"notion",type:"notion",identifier:{type:"workspacePublic"},actions:["reader"]}),t.canSearchWeb&&n.push({moduleType:"notion",type:"search",identifier:{type:"web"},actions:["allow"]}),n}({searchStates:i,collectionViewBlockId:a}),c={command:"set",path:["data","modules"],args:o.modules.map((e=>"notion"===e.type?{...e,permissions:s}:e)),pointer:{id:t.id,table:r().C0,spaceId:n}};u().applyOperation({store:t,operation:c,transaction:e})}})}function C(e){const{workflowStore:t,environment:o,spaceId:n,selectedProperties:i}=e,a=t.getDraftData()??t.getData();u().createAndCommit({userAction:"CollectionSettingsPropertyAgentAutofill.updateSelectedProperties",environment:o,canUndo:!0,perform:e=>{var o;if(null==a||!a.modules)return;const l=a.modules.map((e=>"notion"===e.type?{...e,state:{...e.state,ownedByDatabasePropertyIds:i}}:e)),s=null===(o=a.triggers)||void 0===o?void 0:o.map((e=>{var t;if("notion.page.updated"===(null===(t=e.state)||void 0===t?void 0:t.type)&&e.state.propertyIds){const t=e.state.propertyIds.filter((e=>!i.includes(e)));return{...e,state:{...e.state,propertyIds:t}}}return e})),c={command:"set",path:["data","modules"],args:l,pointer:{id:t.id,table:r().C0,spaceId:n}};if(u().applyOperation({store:t,operation:c,transaction:e}),s){const o={command:"set",path:["data","triggers"],args:s,pointer:{id:t.id,table:r().C0,spaceId:n}};u().applyOperation({store:t,operation:o,transaction:e})}}})}function A(e){const{workflowStore:t,collectionStore:o,collectionViewBlockStore:n,environment:r,spaceId:a}=e;n&&a&&u().createAndCommit({environment:r,userAction:"CollectionViewAgentsMenu.deleteAgent",canUndo:!0,perform:e=>{u().applyOperation({store:t,transaction:e,operation:{pointer:t.pointer,command:"set",path:["alive"],args:!1}});const r=n.getFormat()||{},l="database_agent_ids"in r&&r.database_agent_ids||[],s=l.filter((e=>e!==t.id));l.length!==s.length&&u().applyOperation({store:n,transaction:e,operation:{pointer:{id:n.id,table:i().ev,spaceId:a},command:"set",path:["format","database_agent_ids"],args:s}});const c=o.getSchema();if(c)for(const[n,i]of Object.entries(c))if((null==i?void 0:i.default_workflow_id)===t.id){const t=(0,f().rK)({collectionPointer:o.pointer,propertyId:n});u().applyOperation({store:o,transaction:e,operation:t})}}})}function j(e){const{collectionStore:t,environment:o,property:i}=e,r=t.getSpaceId(),a=t.getParentCollectionViewBlockStore();n().ok(a);const l=(0,g().so)({collectionStore:t,spaceId:r});n().ok(!l.error);const s=(0,g().gY)({workflowsData:l.value,collectionViewBlockStore:a,currentCollectionStore:t,property:i,spaceId:r});for(const n of s)A({workflowStore:n,collectionStore:t,collectionViewBlockStore:a,environment:o,spaceId:r})}},860037:(e,t,o)=>{o.d(t,{A:()=>h});o(296540);var n=()=>o(484714),i=()=>o(56366),r=()=>o(401497),a=()=>o(584262),l=()=>o(73337),s=()=>o(69708),c=()=>o(284371),d=()=>o(296798),u=()=>o(187820),p=()=>o(16006),m=()=>o(492414),g=()=>o(263711),f=()=>o(497222),y=o(474848);function h(e){const{isSelfRelation:t,collectionStore:o,showAs:h,disabled:S,onClick:v}=e,b=(0,i().K8)((()=>Boolean(o)),[o]),x=(0,i().K8)((()=>null==o?void 0:o.getIcon()),[o]),w=(0,i().K8)((()=>{if(t)return;const e=null==o?void 0:o.getParentBlockStore();return e&&(0,m().Ay)({store:e,pageVisitSource:a().y8.LinkInPage})}),[o,t]),C=(0,n().Y0)(),A=(0,r().IS)((e=>({linkBox:{display:"flex",alignItems:"center"},linkTitle:{color:e.text.primary,fontWeight:c().Wy.semibold,fontSize:14,marginInlineStart:4*(C.isRetina?.5:1),wordBreak:"break-word",...c().RC},chevronTitle:{display:"inline",wordBreak:"break-word",...c().RC}})),[C]),j=(0,i().K8)((()=>g().g.state.isOpen&&"layout-editor"===g().g.state.mode),[]),M=(0,y.jsx)(u().B6,{icon:x,iconRecordCategory:"collection",isEmptyPage:!1,size:20,disabled:!0});return(0,y.jsx)(f().A,{icon:l().P,title:(0,y.jsx)(s().sA,{defaultMessage:"Related to",id:"database.viewSettings.editRelation.targetLink.title"}),showChevron:"chevron"===h,onClick:v,disabled:S,right:t?(0,y.jsx)(s().sA,{defaultMessage:"This database",id:"database.viewSettings.editRelation.selfRelationTarget.title"}):"link"===h&&w?(0,y.jsxs)(d().A,{external:j,href:w,innerStyle:A.linkBox,children:[M,(0,y.jsx)(p().A,{store:o,underline:!0,style:A.linkTitle,maxLength:15})]}):b?(0,y.jsxs)(y.Fragment,{children:[M,(0,y.jsx)(p().A,{store:o,style:A.chevronTitle})]}):(0,y.jsx)(s().sA,{defaultMessage:"No target",id:"database.viewSettings.editRelation.noTarget.title"}),rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0}})}},877568:(e,t,o)=>{o.d(t,{_:()=>i});var n=()=>o(534177);function i(e){const{taskRunningState:t}=e;switch(t.status){case"requested":return!0;case"running":return t.numPagesFilled<t.numPagesRequested;case"error":case"notRunning":return!1;default:(0,n().HB)(t)}}},877661:(e,t,o)=>{o.d(t,{m:()=>n});const n=(0,o(583835).Dv)("triggerAgentOverCollectionTask")},896427:(e,t,o)=>{o.d(t,{EB:()=>R,Ay:()=>P,DZ:()=>D});var n=o(296540),i=()=>o(726637),r=()=>o(484714),a=()=>o(56366),l=()=>o(401497),s=()=>o(252291),c=()=>o(160432),d=()=>o(665589),u=()=>o(721479),p=()=>o(340498),m=()=>o(68263),g=()=>o(69708),f=()=>o(496603),y=()=>o(901952),h=()=>o(406699),S=()=>o(811979),v=()=>o(419357),b=()=>o(16006),x=()=>o(89924),w=()=>o(574036),C=()=>o(859428),A=()=>o(125565),j=()=>o(685889),M=()=>o(463830),I=()=>o(487941),k=o(474848);function T(e){const{temporaryAutoRelateState:t,handleAutoRelateToggle:o,collectionStore:n,targetCollectionStore:r,autoRelate:c}=e,d=(0,a().K8)((()=>(null==n?void 0:n.getFormat().bot_id)||r.getFormat().bot_id),[n,r]),p=!!d,m=(0,l().IS)((()=>({helpIcon:{marginInlineStart:6}})),[]),f=(0,k.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"pre"},children:[(0,k.jsx)(g().sA,{defaultMessage:"Automatically Relate",id:"database.viewSettings.setupRelationTab.autoRelate.title"}),i().A.isMobile?void 0:(0,k.jsx)(C().A,{render:e=>(0,k.jsx)("div",{...e,style:m.helpIcon,children:(0,k.jsx)(s().I,{icon:u().questionMarkCircleSmallIcon,size:"sm",colorVariant:"tertiary"})}),style:{width:200},placement:"bottom",textWrap:!0,renderTooltip:()=>(0,k.jsx)(g().sA,{defaultMessage:"Relations will automatically populate based on links found in page properties.",id:"database.viewSettings.setupRelationTab.autoRelateTooltip"})})]});return p?(0,k.jsx)(w().A,{title:f,on:t?t.enabled:!!c&&(null==c?void 0:c.enabled),focused:!1,onClick:()=>o(d),textWrapperStyle:{opacity:1}}):null}var _=()=>o(497222);function P(e){const{collectionContextStore:t,property:o,targetCollectionStore:d,temporaryInverseState:p,setTemporaryInverseState:f,mode:v="edit",onSubmit:x,shouldEnforceTwoWayRelation:P}=e,O=(0,r().v3)(),F=(0,g().tz)(),K=(0,a().uB)(void 0,M().A),V=(0,a().K8)((()=>o?j().Jq(t,o):void 0),[t,o]),z=(0,a().K8)((()=>t.collectionStore()),[t]),N=(0,a().K8)((()=>t.contextType),[t]),W=Boolean((null==z?void 0:z.id)===d.id),q=(0,a().K8)((()=>Boolean(o?j().D5(t,o,d):void 0)),[t,o,d]),Y=(0,a().K8)((()=>{if("relation"!==(null==V?void 0:V.type))return"";const e=V.property;if(!e||e===o)return"";const t=d.getRole();if(!t||!m().Tt(t))return"";const n=d.getSchema()[e];return(null==n?void 0:n.name)||""}),[d,o,V]),U=(0,a().K8)((()=>"relation"===(null==V?void 0:V.type)&&V.autoRelate?V.autoRelate:{enabled:!1}),[V]),L=(0,a().K8)((()=>Boolean(j().uf(d))),[d]),E=(0,a().K8)((()=>Boolean((null==z?void 0:z.getDatabaseType())&&o&&(null==z?void 0:z.isTypedProperty(o)))),[z,o]),H=(0,n.useMemo)((()=>p?p.hasInverseRelation:q),[p,q]),G=(0,n.useMemo)((()=>p?p.inverseName:Y),[p,Y]),$=(0,n.useMemo)((()=>p?p.autoRelate:U),[p,U]),J=(0,n.useCallback)((()=>{o&&(0,y().V)({environment:O,collectionContextStore:t,property:o,from:"collectionPage"===N?"page_properties":"view_settings",action:H?"relation_toggle_inverse_off":"relation_toggle_inverse_on",is_self_relation:W})}),[o,t,O,N,W,H]),Z=(0,n.useCallback)((()=>null!=z&&z.isSyncedCollection()?$:H?{enabled:!1}:$),[z,$,H]),X=(0,n.useCallback)((()=>{f({hasInverseRelation:!0,inverseName:G,autoRelate:Z()}),J()}),[f,G,J,Z]),Q=(0,n.useCallback)((()=>{f({hasInverseRelation:!1,inverseName:void 0,autoRelate:Z()}),J()}),[f,J,Z]),ee=Boolean(!L||E||P),te=(0,n.useCallback)((e=>{f({hasInverseRelation:!0,inverseName:e.target.value,autoRelate:$})}),[f,$]),oe=(0,n.useCallback)((e=>{const n=null!=$&&$.enabled?{enabled:!1}:{enabled:!0,bot_id:e};f({hasInverseRelation:H,inverseName:G,autoRelate:n}),o&&(0,y().V)({environment:O,collectionContextStore:t,property:o,from:"collectionPage"===N?"page_properties":"view_settings",action:n.enabled?"auto_relation_toggle_on":"auto_relation_toggle_off"})}),[o,f,t,N,G,H,$,O]),ne=(0,l().IS)((e=>({container:{width:i().A.isMobile?"100%":250,paddingBottom:i().A.isMobile?16:8,paddingInlineStart:i().A.isMobile?8:4,paddingInlineEnd:i().A.isMobile?8:4,marginTop:8},helpIcon:{marginInlineStart:6},disabled:{opacity:.5,pointerEvents:"none"}})),[]),ie=(0,a().uB)(void 0,I().A),re=(0,n.useMemo)((()=>!L||E?F.formatMessage(D.errors.cannotEditTargetDatabase):W?F.formatMessage(D.tooltips.selfRelationInverseTooltip):F.formatMessage(D.tooltips.inverseRelationTooltip,{databaseName:(0,k.jsx)(b().A,{shouldWrap:!0,style:{display:"inline"},store:d})})),[L,E,F,W,d]),ae=(0,n.useMemo)((()=>(0,k.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"pre"},children:[F.formatMessage(D.generic.title),i().A.isMobile?void 0:(0,k.jsx)(C().A,{placement:"bottom",textWrap:!0,style:{width:200},store:ie,render:e=>(0,k.jsx)("div",{...e,style:ne.helpIcon,children:(0,k.jsx)(s().I,{icon:u().questionMarkCircleSmallIcon,size:"sm",colorVariant:"tertiary"})}),renderTooltip:()=>re})]})),[F,ne.helpIcon,re,ie]);return z?(0,k.jsxs)(k.Fragment,{children:["create"===v?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(R,{currentInverseState:H,disableInverseRelation:Q,enableInverseRelation:X,handleAutoRelateToggle:oe,temporaryInverseState:p,collectionStore:z,targetCollectionStore:d,isTwoWayToggleDisabled:ee,isNameDisabled:ee,menuTitle:ae,autoRelate:U,isSelfRelation:W,inverseRelationName:Y,handleInverseNameChange:te}),(0,k.jsx)(c().A,{colorPalette:"blue",style:{display:"flex",marginTop:6,marginInlineEnd:12,marginBottom:0,marginInlineStart:12},onClick:x,children:F.formatMessage(D.create.addRelation)})]}):void 0,"edit"===v?(0,k.jsx)(S().A,{focused:!1,disabled:ee,popupType:i().A.isMobile?h().z.SlideUp:h().z.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",isFullWidthOnMobile:!0,buttonPopupStore:K,onClose:x,renderOrigin:e=>(0,k.jsx)(_().A,{...e,showChevron:!0,rotateChevron:K.state.open,title:ae,disabled:ee,right:H?F.formatMessage(D.generic.on):F.formatMessage(D.generic.off)}),render:e=>(0,k.jsxs)("div",{style:ne.container,children:[(0,k.jsx)(w().A,{textWrapperStyle:{overflow:"hidden",display:"inline-flex"},focused:!1,disabled:ee,on:H,title:F.formatMessage(D.edit.enable),titleStyle:{display:"inline-flex"},onClick:e=>{H?Q():X()}}),(0,k.jsxs)("div",{style:H?void 0:ne.disabled,children:[(0,k.jsx)(T,{handleAutoRelateToggle:oe,temporaryAutoRelateState:null==p?void 0:p.autoRelate,collectionStore:z,autoRelate:U,targetCollectionStore:d}),(0,k.jsx)(B,{collectionStore:z,targetCollectionStore:d,isSelfRelation:W,temporaryInverseState:p,inverseRelationName:Y,disabled:ee,onChange:te,title:(0,k.jsx)(A().A,{isSecondaryColor:!0,isSmall:!0,children:F.formatMessage(D.edit.propertyNameLabel)})})]})]})}):void 0]}):null}function R(e){const{currentInverseState:t,disableInverseRelation:o,enableInverseRelation:n,handleAutoRelateToggle:i,temporaryInverseState:r,collectionStore:a,targetCollectionStore:l,isTwoWayToggleDisabled:s,isNameDisabled:c,menuTitle:u,autoRelate:m,isSelfRelation:f,inverseRelationName:y,handleInverseNameChange:h}=e,S=(0,g().tz)();return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(w().A,{icon:(0,d().l)({width:p().Ev.default,height:p().Ev.default}),textWrapperStyle:{overflow:"hidden",display:"inline-flex"},focused:!1,on:t,disabled:s,title:u,titleStyle:{display:"inline-flex"},onClick:()=>{t?o():n()}}),t?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(T,{handleAutoRelateToggle:i,temporaryAutoRelateState:null==r?void 0:r.autoRelate,collectionStore:a,autoRelate:m,targetCollectionStore:l}),(0,k.jsx)(B,{collectionStore:a,targetCollectionStore:l,isSelfRelation:f,temporaryInverseState:r,inverseRelationName:y,disabled:c,onChange:h,title:(0,k.jsx)(A().A,{isSmall:!0,isSecondaryColor:!0,children:f?S.formatMessage(D.create.selfRelationPropertyNameHeader):S.formatMessage(D.create.relationPropertyNameHeader)})})]}):void 0]})}function B(e){const{collectionStore:t,targetCollectionStore:o,isSelfRelation:n,temporaryInverseState:i,inverseRelationName:r,disabled:l,onChange:s,title:c}=e,d=(0,g().tz)(),u=(0,a().K8)((()=>null!=t&&t.isDefined()?j().zF(d,{sourceCollection:t.getModel(),isSelfRelation:n,targetCollectionStore:o,createUnique:!0}):d.formatMessage(D.placeholders.relatedToTarget)),[t,d,n,o]);return(0,k.jsx)(x().A,{title:c,noTextOverflow:!0,children:(0,k.jsx)(v().Ay,{value:(null==i?void 0:i.inverseName)||r,placeholder:u,onChange:s,onBlur:f().D_,onSubmit:f().D_,focusInitial:!0,selectAll:!1,disabled:l})})}const D={generic:(0,g().YK)({on:{id:"database.viewSettings.setupRelationTab.generic.on",defaultMessage:"On"},off:{id:"database.viewSettings.setupRelationTab.generic.off",defaultMessage:"Off"},title:{id:"database.viewSettings.setupRelationTab.generic.title",defaultMessage:"Two-way relation"}}),create:(0,g().YK)({addRelation:{id:"database.viewSettings.setupRelationTab.create.relation.add",defaultMessage:"Add relation"},addRelationInverse:{id:"database.viewSettings.setupRelationTab.create.relation.inverse.add",defaultMessage:"Show on {databaseName}"},addSelfRelationInverse:{id:"database.viewSettings.setupRelationTab.addSelfRelationInverse",defaultMessage:"Separate directions {icon}"},relationPropertyNameHeader:{id:"database.viewSettings.setupRelationTab.create.relation.inverse.propertyNameHeader",defaultMessage:"Related property name"},selfRelationPropertyNameHeader:{id:"database.viewSettings.setupRelationTab.create.selfRelation.inverse.propertyNameHeader",defaultMessage:"Inverse related property name"}}),edit:(0,g().YK)({modalTitle:{id:"database.viewSettings.setupRelationTab.edit.relation.inverse.modalTitle",defaultMessage:"Related property settings"},enable:{id:"database.viewSettings.setupRelationTab.edit.relation.inverse.enable",defaultMessage:"Enable"},propertyNameLabel:{id:"database.viewSettings.setupRelationTab.edit.relation.inverse.propertyNameLabel",defaultMessage:"Related property name"},addRelationInverse:{id:"database.viewSettings.setupRelationTab.edit.relation.inverse.add",defaultMessage:"Show on {databaseName}"},editRelationInverse:{id:"database.viewSettings.setupRelationTab.edit.relation.inverse.edit",defaultMessage:"Edit relation on {databaseName}"},saveRelationInverse:{id:"database.viewSettings.setupRelationTab.relation.inverse.save",defaultMessage:"Save"},removeRelationInverse:{id:"database.viewSettings.setupRelationTab.edit.relation.inverse.remove",defaultMessage:"Remove property"},addSelfRelationInverse:{id:"database.viewSettings.setupRelationTab.edit.selfRelation.inverse.add",defaultMessage:"Add inverse property"},editSelfRelationInverse:{id:"database.viewSettings.setupRelationTab.edit.selfRelation.inverse.edit",defaultMessage:"Edit inverse property"},renameSelfRelationInverse:{id:"database.viewSettings.setupRelationTab.edit.selfRelation.inverse.rename",defaultMessage:"Rename"},saveSelfRelationInverse:{id:"database.viewSettings.setupRelationTab.edit.selfRelation.inverse.save",defaultMessage:"Save"},removeSelfRelationInverse:{id:"database.viewSettings.setupRelationTab.edit.selfRelation.inverse.remove",defaultMessage:"Remove property"}}),tooltips:(0,g().YK)({inverseRelationTooltip:{id:"database.viewSettings.setupRelationTab.relation.inverse.tooltip",defaultMessage:"Manage property on {databaseName} showing backlinks to the current database"},selfRelationInverseTooltip:{id:"database.viewSettings.setupRelationTab.selfRelation.inverse.tooltip",defaultMessage:"Manage separate properties for each direction of a two-way relation. Useful for modeling Parent task/Sub-tasks, Blocked by/Blocking, and more."},disabledTwoWayRelationTooltip:{id:"database.viewSettings.setupRelationTab.relation.inverse.disabled.tooltip",defaultMessage:"Two-way relations cannot be enabled when share settings are inherited through this relation."}}),errors:(0,g().YK)({cannotEditTargetDatabase:{id:"database.viewSettings.setupRelationTab.inverseDisabledWarning.title",defaultMessage:"Cannot edit target database."}}),placeholders:(0,g().YK)({relatedToTarget:{id:"database.viewSettings.setupRelationTab.relation.inverse.placeholder",defaultMessage:"Related to target"}})}},949658:(e,t,o)=>{o.d(t,{a:()=>s});o(944114);var n=()=>o(534177),i=()=>o(148832),r=()=>o(543665),a=()=>o(913530),l=()=>o(896628);function s(e){const{formatStore:t,formatKey:o,property:s,update:c,transaction:d}=e,u=[...t.getFormat()[o]||[]],p=u.findIndex((e=>e.property===s));-1!==p?u[p]={...u[p],...c}:u.push({property:s,...c}),l().zA({stores:t instanceof i().B||t instanceof r().m||t instanceof a().p?[t]:(0,n().HB)(t),update:{[o]:u},transaction:d})}},971404:(e,t,o)=>{o.d(t,{V:()=>r,X:()=>a});var n=()=>o(597777);const i={"de-DE":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"da-DK":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"fi-FI":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"nb-NO":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"nl-NL":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"sv-SE":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"en-US":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"es-ES":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"es-LA":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"fr-FR":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"pt-BR":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"ko-KR":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"YYYY[년] MMMM"},"zh-CN":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"YYYY[年]MMM"},"zh-TW":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"YYYY[年]MMM"},"ja-JP":{time:{"12h":"A h:mm","24h":"H:mm",hidden:n().jk},month:"YYYY[年]MMM"},"vi-VN":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"th-TH":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"id-ID":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"en-GB":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"he-IL":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"ar-SA":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},pseudo:{time:{"12h":"A h:mm","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"}},r=["de-DE","fr-FR"];function a(e){return i[e]}},992307:(e,t,o)=>{o.d(t,{Z:()=>g,o:()=>f});var n=o(296540),i=()=>o(484714),r=()=>o(898244),a=()=>o(965134),l=()=>o(69708),s=()=>o(901952),c=()=>o(231297),d=()=>o(312296),u=()=>o(846657),p=()=>o(828973),m=o(474848);function g(e){const{property:t,propertySchema:o,collectionContextStore:a}=e,l=(0,i().v3)(),u=(0,n.useCallback)((e=>{const n=a.collectionStore();if(!n||!(0,r().sO)(o))return;const i={...o,limit:Number(e)?1:void 0};c().createAndCommit({userAction:"CollectionSettingsLimitOptions.handleLimitChange",environment:l,canUndo:!0,perform:e=>{(0,d().F)({environment:l,collectionStore:n,update:{[t]:i},transaction:e})}});const u=Number(e)?`${o.type}_toggle_limit_on`:`${o.type}_toggle_limit_off`;(0,s().V)({environment:l,collectionContextStore:a,property:t,from:"view_settings",action:u})}),[a,l,t,o]);return(0,r().sO)(o)?"relation"===o.type&&o.connectedRelation?(0,m.jsx)(f,{propertyType:o.type,connectedRelation:!0,selectedKey:o.limit?"1":"no_limit",onChange:u}):(0,m.jsx)(f,{propertyType:o.type,selectedKey:o.limit?"1":"no_limit",onChange:u}):null}function f(e){const{propertyType:t,selectedKey:o,connectedRelation:n,onChange:i}=e;return(0,m.jsx)(p().A,{icon:a().i,title:(0,m.jsx)(l().sA,{defaultMessage:"Limit",id:"database.viewSettings.collectionPropertyLimitHelpers.limit"}),selectedKey:o,popupStyle:{minWidth:190},options:[(0,u().Q)("1",t,n),(0,u().Q)("no_limit",t)],onChange:i})}}}]);