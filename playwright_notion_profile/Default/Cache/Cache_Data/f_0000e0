"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[8881,78405],{36629:(e,t,o)=>{o.d(t,{XO:()=>D,h3:()=>K,nZ:()=>G,pG:()=>z});o(16280),o(944114),o(898992),o(823215),o(354520),o(803949),o(581454);var r=()=>o(314529),i=()=>o(564884),n=()=>o(66689),a=()=>o(716016),l=()=>o(898244),s=()=>o(617871),p=()=>o(165358),d=()=>o(388693),c=()=>o(792071),u=()=>o(179034),y=()=>o(332393),m=()=>o(96689),g=()=>o(854150),S=()=>o(496603),v=()=>o(534177),f=()=>o(235059),h=()=>o(969956),P=()=>o(147503),b=()=>o(254497),x=()=>o(312296),w=()=>o(177618),I=()=>o(601734),C=()=>o(972435),A=()=>o(395963),k=()=>o(765957),_=()=>o(53137),j=()=>o(148832),B=()=>o(908447),V=()=>o(559506),M=()=>o(84448),T=()=>o(581928),R=()=>o(899164),O=()=>o(803074),E=()=>o(896628),F=()=>o(231297);const N=(0,o(69708).YK)({aiCustomPromptDefaultPropertyName:{id:"collectionSettingsCreatePropertyActions.createProperty",defaultMessage:"Text"}});function L(e){const{environment:t,collectionContextStore:o,collectionUri:i,feature:n,transaction:a,addFeatureFrom:l,createFeatureStartTime:s}=e;if("dependencies"in n)for(const r of n.dependencies)"property"===r.type&&r.collectionUri===i&&(0,B().Z)({environment:t,collectionContextStore:o,from:"view_settings",property:r.uri,property_type:r.propertySchema.type,is_suggested_property:!0,property_id:r.uri,feature:{id:r.uri,from:l,type:n.uri}});if("dependencies"in n&&n.dependencies.map((e=>e.type)).every((e=>"property"===e))){const e=o.collectionViewStore(),t=o.getPropertyFormatKey(),r=o.normalizedFormatStore.state;if(t&&e){const o=r[t]||[],i=[...o];n.dependencies.forEach((e=>{const t=o.findIndex((t=>t.property===e.uri));-1===t?i.push({visible:!0,property:e.uri}):i[t]={...o[t],visible:!0}})),E().zA({stores:[e],update:{[t]:i},transaction:a})}}if(void 0!==n.propertyIdCollectionSettingToNavigateTo){const e={type:"property",property:n.propertyIdCollectionSettingToNavigateTo,selectNameInitial:!1,formatKey:o.getPropertyFormatKey()};P().a2({collectionSettingsStore:o.settingsStore,item:e})}a.postSubmitCallbacks.push((e=>{(0,r().DO_NOT_USE_trackLegacy)(t,"collection_create_suggested_property_latency",{collection_uri:n.collectionUri,feature_uri:n.uri,time:Date.now()-s,status:Boolean(e)?"fail":"success"})}))}async function K(e){var t;const{appTemplatesSetupActions:o,appTemplatesSprintBoardActions:r,appConfigs:i}=await I().Aw.load(),{environment:l,collectionContextStore:c,feature:S,addFeatureFrom:v,customPropertyName:P}=e,{sidebarSpaceViewStore:b}=k().default.state,x=c.collectionStore(),w=null==x?void 0:x.getParentBlockStore(),C={},A=e=>{(0,p().log)({level:"error",from:"collectionSettingsCreatePropertyActions",type:"handleCreateNewSuggestedProperty",data:{collectionId:null==x?void 0:x.id,miscDataToConvertToString:{featureUri:S.uri,addFeatureFrom:v,...C,...e}}})};if(!x||!w)return void A({hasCollectionStore:Boolean(x),hasCollectionViewBlockStore:Boolean(w)});if((0,h().u)(S))return async function(e){const{environment:t,collectionContextStore:o,feature:r,addFeatureFrom:i}=e,{untypedFeaturesSetupActions:a}=await I().Aw.load(),l=o.collectionStore(),s=null==l?void 0:l.getParentBlockStore();if(!l||!s)return;const p=Date.now();F().createAndCommit({environment:t,userAction:"collectionSettingsCreatePropertyActions.handleCreateNewUntypedFeature",canUndo:!0,perform:e=>{a.applyUntypedFeature({environment:t,collectionStore:l,collectionViewBlockStore:s,feature:r,transaction:e}),L({environment:t,collectionContextStore:o,collectionUri:n().iH,feature:r,transaction:e,addFeatureFrom:i,createFeatureStartTime:p})}})}({environment:l,collectionContextStore:c,feature:S,addFeatureFrom:v});const B=c.collectionViewStore(),T=null==w?void 0:w.getParentStore(),R=null==x||null===(t=x.getFormat())||void 0===t?void 0:t.app_config_uri,N=R&&(0,f().l)(i(),R);if(C.appConfigUri=N&&N.uri,!T||T.table!==m().NX&&T.table!==u().ev&&T.table!==g().yK||!N)return void A({hasAppParentStore:Boolean(T),appParentStoreTable:null==T?void 0:T.table,appConfigUri:N?N.uri:void 0});const K=x.getSchema(),z=w.getFormat().app_id;C.appId=z;const G=z?await V().callApi({eventName:"getCollectionViewBlocksByAppId",environment:l,data:{spaceId:w.getSpaceId(),appId:z}}):void 0,D="success"===(null==G?void 0:G.type)&&G.data.result.length?G.data.result.map((e=>j().B.createChildStore(T,{table:u().ev,id:e.blockId,spaceId:w.getSpaceId()}))):[w],U=S.integrationId;if(U){const e=_().A.getIntegrationsAsRecordMap().getValue({table:y().Li,id:U});if(!e||!(0,d().v_)(e))return void A({hasIntegration:Boolean(e)});await O().C4(l,x,e,Boolean(S.canOnlyAdminAuth))}U===s().ob&&K&&0===(0,a().yP)(K).length&&await M().c({environment:l,collectionStore:x});const H=Date.now();F().createAndCommit({environment:l,userAction:"collectionSettingsCreatePropertyActions.handleCreateNewSuggestedProperty",canUndo:!0,perform:e=>{var t;if(!b)return void A({hasCurrentSpaceViewStore:!1});const i=null===(t=x.getFormat())||void 0===t?void 0:t.app_config_uri;if(!i)return void A({hasCollectionUri:!1});const a=o.applyTypedFeatures({environment:l,spaceViewStore:b,appParentStore:T,appUri:N.uri,features:[{type:"simple",featureUri:S.uri}],transaction:e,createOrModify:"modify",appCollectionViewBlockStores:D,customPropertyName:P});r.createSprintPage({environment:l,spaceViewStore:b,appParentStore:T,transaction:e,blockStores:a,creationEntryPoint:{type:"sprint_relation"}}),"notion://tasks/sub_task_feature"===S.uri&&E().zA({stores:[x],update:{subitem_property:n().yx.SubTaskRelation},transaction:e}),"notion://tasks/task_dependencies_feature"===S.uri&&(E().zA({stores:[x],update:{collection_default_arrows_by:n().yx.BlockingRelation},transaction:e}),B&&E().zA({stores:[B],update:{timeline_arrows_by:{property:n().yx.BlockingRelation}},transaction:e})),L({environment:l,collectionContextStore:c,collectionUri:i,feature:S,transaction:e,addFeatureFrom:v,createFeatureStartTime:H}),e.isEmpty()&&A({isEmptyTransaction:!0})}})}function z({propertyType:e,collectionContextStore:t,propertyId:o}){switch(e){case"ai_custom_prompt":case"ai_summary":case"ai_extract":case"ai_translate":return P().a2({collectionSettingsStore:t.settingsStore,item:{type:"propertyAiAutofill",propertySchema:t.normalizedSchemaStore[o],property:o}});case"ai_keywords":return P().a2({collectionSettingsStore:t.settingsStore,item:{type:"property",property:o,formatKey:t.getPropertyFormatKey()}});default:(0,v().HB)(e)}}function G(e){const{environment:t,collectionContextStore:o,propertyType:r,isSuggestedProperty:i,propertyName:n,propertyIcon:a,selectOptions:s,from:p,shouldOpenEditMenu:d=!0,newPropertyFormat:c}=e,u=o.collectionStore(),y=o.collectionViewStore(),m=o.getPropertyFormatKey(),g=o.normalizedFormatStore.state;if(!u)return;if("relation"===r)return void P().a2({collectionSettingsStore:o.settingsStore,item:{type:"selectRelationSource",property:void 0,initialPropertyName:n,formatKey:m,newPropertyFormat:c}});let S=n;"ai_custom_prompt"===r&&(S=C().A.formatMessage(N.aiCustomPromptDefaultPropertyName));const v=c&&m?{...g,[m]:c}:g,{performResult:f}=F().createAndCommit({userAction:"collectionSettingsCreatePropertyActions.handleCreateNewStandardProperty",environment:t,canUndo:!0,perform:e=>(0,T().createProperty)({environment:t,collectionStore:u,collectionViewArgs:y&&m?{collectionViewStore:y,format:v,formatKey:m}:void 0,propertyName:S,propertyIcon:a,propertyType:r,selectOptions:s,transaction:e})});d&&((0,l().hN)(r)?z({propertyType:r,propertyId:f,collectionContextStore:o}):P().n1({collectionSettingsStore:o.settingsStore,property:f,formatKey:m,selectNameInitial:!0}));const h="view_settings"===p?{feature:{id:f,from:"new_property",type:r}}:{};(0,B().Z)({environment:t,collectionContextStore:o,from:p,property_type:(0,l().v2)(r),property:(0,l().hN)(r)?r:void 0,is_suggested_property:i,property_id:f,...h}),i||o.userAddedPropertyStore.update((()=>!0))}async function D(e){const{environment:t,collectionContextStore:o,intl:r,connectedRelationProperty:n,from:p,untypedFeatureArgs:d,propertyGroupId:u,propertyLimit:y,skipDatabaseActions:m,propertyName:g}=e,f=o.collectionStore(),h=o.collectionViewStore(),I=o.getPropertyFormatKey();if(!f||!I)return;const C=n.integration.id;(0,s().XO)(C)||await O().C4(t,f,n.integration,Boolean(n.canOnlyAdminAuth));const k=f.getSchema();let _;C===s().ob&&k&&0===(0,a().yP)(k).length&&(_=await M().c({environment:t,collectionStore:f})),F().createAndCommit({environment:t,userAction:"collectionSettingsCreatePropertyActions.handleCreateNewConnectedRelationProperty",canUndo:!0,perform:e=>{_&&(0,T().createProperty)({environment:t,collectionStore:f,collectionViewArgs:h?{collectionViewStore:h,format:h.getFormat(),formatKey:I}:void 0,propertyType:"auto_increment_id",transaction:e,propertyGroupId:u});const a=f.getDeletedSchema(),k=(0,v().WP)(a).map((([e,t])=>{if(t&&l().UU(t)&&t.connectedRelation.integration_id===s().ob)return{propertyId:e,propertySchema:t}})).filter(v().O9);if(!S().Im(k)){const{propertyId:r}=k[0],i=(0,w().KA)({deletedSchema:a,property:r});if(!i)throw new Error("Deleted property schema was not found");u&&(0,A().En)({collectionStore:f,groupId:u,propertyId:r,transaction:e}),(0,x().F)({environment:t,collectionStore:f,update:i.updateSchema,transaction:e}),(0,b().E)({collectionStore:f,update:i.updateDeletedSchema,transaction:e});const n={type:"property",property:r,formatKey:I};return void P().a2({collectionSettingsStore:o.settingsStore,item:n})}const j=c().Bj6.fromIntegration(n.integration),V=O().qM({environment:t,pattern:n.pattern,integration:j,parentCollectionStore:f,transaction:e}),M=(0,T().createProperty)({environment:t,collectionStore:f,collectionViewArgs:h&&I?{collectionViewStore:h,format:h.getFormat(),formatKey:I}:void 0,propertyType:"relation",transaction:e,propertyId:null==d?void 0:d.propertyId});if(R().cT({environment:t,collectionContextStore:o,collectionStore:f,property:M,propertyName:g&&g.length>0?g:n.name,propertyIcon:n.integration.info.icon,propertyLimit:y??"no_limit",targetCollectionStore:V,hasInverseRelation:!0,autoRelate:void 0,intl:r,connectedRelation:{integration_id:C},transaction:e}),!d)if(m){const e=f.getSchema(),r=null==e?void 0:e[M];P().a2({collectionSettingsStore:o.settingsStore,item:{type:"connectedRelationDatabaseActions",source:"connectedRelationAddProperties",rootPropertyId:M,integrationId:C,rootPropertySchema:r,skipDatabaseActions:!0,eventSource:"first_time_setup"}}),(0,i().u)({environment:t,event:{eventName:"salesforce_actions",eventProperties:{actionType:"add_properties_clicked",details:{source:"first_time_setup"},integrationId:C,collectionId:null==f?void 0:f.id}}})}else{const e={type:"property",property:M,formatKey:I};P().a2({collectionSettingsStore:o.settingsStore,item:e})}(0,B().Z)({environment:t,collectionContextStore:o,from:"view_settings",property_id:M,property_type:"relation",integration_id:C,feature:{id:M,from:p,type:`notion://feature/connection_${C}`}})}})}},84448:(e,t,o)=>{o.d(t,{c:()=>a});var r=()=>o(165358),i=()=>o(519831),n=()=>o(559506);async function a(e){const{environment:t,collectionStore:o}=e,a={id:o.id,table:i().Vl,spaceId:o.getSpaceId()},l=await n().callApi({eventName:"suggestRecordKey",environment:t,data:{...a,shouldSetSuccessfullySuggestedRecord:!0}});if("success"===l.type)return l.data.key;r().log({level:"error",from:"collectionAutoIncrementIdActions.suggestRecordKeyResponse",type:"JSONParseError",error:{miscDataString:l.error.message}})}},122724:(e,t,o)=>{o.d(t,{$w:()=>l,M7:()=>r,Qd:()=>a,g1:()=>i,iw:()=>n});let r=function(e){return e[e.SelectedPage=0]="SelectedPage",e[e.SearchPage=1]="SearchPage",e[e.NewPage=2]="NewPage",e}({});const i=4,n=32,a=560,l=20},157260:(e,t,o)=>{o.d(t,{Xt:()=>j,Ay:()=>_});o(944114),o(898992),o(354520);var r=o(296540),i=()=>o(726637),n=()=>o(484714),a=()=>o(56366),l=()=>o(401497),s=()=>o(718827),p=()=>o(252291),d=()=>o(631524),c=()=>o(854705),u=o(474848);const y={viewBox:"0 0 16 16",fittedViewBox:"2.94 4.85 10.11 5.81",svg:(0,u.jsx)("path",{d:"M8.53 5.07a.75.75 0 0 0-1.06 0L3.15 9.39a.75.75 0 0 0 1.06 1.06L8 6.66l3.79 3.79a.75.75 0 0 0 1.06-1.06z"})},m=(0,o(340498).wt)("arrowChevronSingleUpFillSmall",y);var g=()=>o(621837),S=()=>o(69708),v=()=>o(571763),f=()=>o(59400),h=()=>o(147503),P=()=>o(527438),b=()=>o(908201),x=()=>o(553965),w=()=>o(463830),I=()=>o(171018),C=()=>o(406699),A=()=>o(417392),k=()=>o(623186);function _(e){const{locked:t,disabled:o,collectionStore:r,mergedProperties:i,schema:n,isCompact:l,pagePropertiesStore:s,wrapperStyle:p,customization:d}=e,c=(0,a().K8)((()=>s.state.forceShowProperties),[s]),y=R(i,n,l),m=(0,k().aN)(r),g=[];return!c&&0!==y||!(!t&&!o&&m)||null!=d&&d.hideAddPropertyButton||g.push((0,u.jsx)(j,{...e},"add-property")),y>0&&(c?g.push((0,u.jsx)(V,{mergedProperties:i,schema:n,isCompact:l,pagePropertiesStore:s},"hide-properties")):g.push((0,u.jsx)(B,{mergedProperties:i,schema:n,isCompact:l,pagePropertiesStore:s},"show-more"))),g.length>0&&p?(0,u.jsx)("div",{style:p,children:g}):(0,u.jsx)(u.Fragment,{children:g})}function j(e){const{collectionStore:t,isInPeekRenderer:o,pagePropertiesStore:l,propertyGroupId:s,onPropertyAdded:p,disabled:c,iconStyle:y}=e,m=(0,b().Ks)(),k=(0,n().v3)(),_=(0,a().uB)(void 0,w().A),j=T(),B=(0,a().K8)((()=>null==m?void 0:m.settingsStore.state.open),[null==m?void 0:m.settingsStore]);(0,r.useEffect)((()=>{B||_.setState({..._.state,open:!1})}),[_,B]);const V=(0,a().uB)(l,I().YB),M=(0,r.useCallback)((()=>{m&&(0,v().H)({environment:k,propertyGroupId:s,collectionContextStore:m,pagePropertiesStore:V,collectionStore:t,isInPeekRenderer:o,onCloseMenu:e=>{null==p||p(e),_.setState({open:!1})},propertyVisibility:"show"})}),[k,s,m,V,t,o,p,_]);return(0,a().K8)((()=>{var e;return null==m||null===(e=m.permissionScopesStore.state)||void 0===e?void 0:e.isExternallyImportedAndSyncedCollection}),[m])||!m?null:(0,u.jsx)("div",{style:{display:"flex"},children:(0,u.jsx)(C().A,{popupType:i().A.isMobile?A().nl.SlideUp:A().nl.Popup,buttonPopupStore:_,originGap:1,alignmentToOrigin:"start",render:()=>(0,u.jsx)(f().m$,{context:P().Bd.TopbarFilterPopup,collectionContextStore:m,collectionSettingsStore:m.settingsStore,hideDesktopHeader:!0}),onClick:M,onClose:()=>{const e=m.settingsStore;h().os({collectionSettingsStore:e})},renderOrigin:t=>(0,u.jsx)(d().p,{style:j.AddOrTogglePropertyButtonStyle,iconLeading:{icon:g().plusFillSmallIcon,size:"sm",colorVariant:"tertiary",style:{...j.ActionPropertyButtonIconStyle,...y}},disabled:c,disabledFeedback:!0,...(0,x().A)(e,t),children:(0,u.jsx)(S().sA,{defaultMessage:"Add a property",id:"database.pageProperties.addPropertyButtonTitle"})})})})}function B(e){const{mergedProperties:t,schema:o,isCompact:i,pagePropertiesStore:n}=e,a=T(),l=R(t,o,i),d=(0,r.useCallback)((e=>{e.stopPropagation(),n.setState({...n.state,forceShowProperties:!0})}),[n]);return(0,u.jsx)("div",{style:{display:"flex"},children:(0,u.jsx)("div",{style:a.AddOrToggleContainerStyle,children:(0,u.jsxs)(s().Ay,{style:{...a.AddOrTogglePropertyButtonStyle,...e.style},onClick:d,children:[(0,u.jsx)("div",{style:{...a.ActionPropertyButtonIconStyle,marginInlineEnd:6},children:(0,u.jsx)(p().I,{icon:c().arrowChevronSingleDownFillSmallIcon,size:"sm",colorVariant:"tertiary"})}),(0,u.jsx)("div",{style:a.AddPropertyButtonTitleStyle,children:(0,u.jsx)(S().sA,{defaultMessage:"{num, plural, one {1 more property} other {{num} more properties}}",id:"database.pageProperties.showMorePropertyTitle",values:{num:l}})})]},"show-more")})})}function V(e){const{mergedProperties:t,schema:o,isCompact:i,pagePropertiesStore:n}=e,a=R(t,o,i),l=T(),d=(0,r.useCallback)((e=>{e.stopPropagation(),n.setState({...n.state,forceShowProperties:!1})}),[n]);return(0,u.jsx)("div",{style:{display:"flex"},children:(0,u.jsxs)(s().Ay,{style:{...l.AddOrTogglePropertyButtonStyle,...e.style},onClick:d,children:[(0,u.jsx)("div",{style:l.ActionPropertyButtonIconStyle,children:(0,u.jsx)(p().I,{icon:m,size:"sm",colorVariant:"tertiary"})}),(0,u.jsx)("div",{style:l.AddPropertyButtonTitleStyle,children:(0,u.jsx)(S().sA,{defaultMessage:"{num, plural, one {Hide 1 property} other {Hide {num} properties}}",id:"database.pageProperties.hidePropertyTitle",values:{num:a}})})]},"hide-properties")})}const M=16;function T(){return(0,l().IS)((e=>({AddOrToggleContainerStyle:{display:"grid"},AddOrTogglePropertyButtonStyle:{display:"flex",alignItems:"center",color:e.text.tertiary,fontSize:14,borderRadius:4,paddingInlineStart:6,paddingInlineEnd:6,height:34,width:i().A.isMobile?"100%":"auto",gridColumn:1,gridRow:1},ActionPropertyButtonIconStyle:{marginTop:1},AddPropertyButtonTitleStyle:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",minWidth:0,lineHeight:`${M}px`}})),[])}function R(e,t,o){return(0,r.useMemo)((()=>e.filter((e=>"hide"===e.visibility||"hide_if_empty"===e.visibility&&!e.hasValue)).length),[e])}},246219:(e,t,o)=>{o.d(t,{PF:()=>a,Qd:()=>r().Qd,g1:()=>r().g1,iw:()=>r().iw});var r=()=>o(122724),i=()=>o(645873);const n=new(i().O2)("RelationPropertyMenu",(async()=>await Promise.all([o.e(9773),o.e(36556),o.e(40537),o.e(55373),o.e(36192),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(90825),o.e(10872),o.e(87249),o.e(71621),o.e(88924),o.e(92845),o.e(56369),o.e(5834),o.e(48486),o.e(2411),o.e(89296),o.e(46414),o.e(9294),o.e(11676),o.e(91256),o.e(40563),o.e(67494),o.e(44584),o.e(53141),o.e(4422),o.e(4330),o.e(55162),o.e(22001),o.e(71386),o.e(4351),o.e(6331),o.e(69144),o.e(12341),o.e(96402),o.e(29945)]).then(o.bind(o,721659)))),a=(0,i()._h)(n,(e=>e.RelationPropertyMenu))},402838:(e,t,o)=>{o.d(t,{s:()=>n});var r=o(296540),i=()=>o(472090);function n(e,t){const[o,n]=(0,r.useState)(void 0),a=e.current;return(0,r.useEffect)((()=>{if(!a)return;const e=new(i().E)({throttleMs:t});return e.observe(a),e.rect.addListener((e=>{n(e.state)})),()=>{e.destroy()}}),[a,t]),o}},410730:(e,t,o)=>{o.d(t,{U:()=>r});const r=4},571763:(e,t,o)=>{o.d(t,{H:()=>m});var r=()=>o(726637),i=()=>o(898244),n=()=>o(651124),a=()=>o(390066),l=()=>o(147503),s=()=>o(395963),p=()=>o(908447),d=()=>o(36629),c=()=>o(334261),u=()=>o(231297),y=()=>o(581928);function m(e){const{propertyGroupId:t,collectionContextStore:o,collectionStore:m,environment:g,isInPeekRenderer:S,onCloseMenu:v,pagePropertiesStore:f,propertyVisibility:h}=e,P=o.settingsStore;l().a2({collectionSettingsStore:P,item:{type:"propertyType",propertyGroupId:t,onAccept:e=>{const{propertyType:b,isSuggestedProperty:x,propertyName:w,selectOptions:I}=e;if("relation"===b)return void l().a2({collectionSettingsStore:P,item:{type:"selectRelationSource",property:void 0,formatKey:"collection_page_properties",propertyGroupId:t}});const{performResult:C}=u().createAndCommit({userAction:"PageProperties.handleAddPropertyClick",environment:g,canUndo:!0,perform:e=>(0,y().createProperty)({environment:g,collectionStore:m,collectionViewArgs:void 0,propertyType:b,propertyName:w,selectOptions:I,transaction:e})});(t||h)&&u().createAndCommit({userAction:"PageProperties.handleAddPropertyClick.addPropertyToGroupAndUpdateVisibility",environment:g,canUndo:!0,perform:e=>{t&&(0,s().En)({collectionStore:m,groupId:t,propertyId:C,transaction:e}),h&&c().D7({property:C,visibility:h,format:(0,a().L)(m.getFormat(),m.getSchema(),void 0,n().jf.Collection),store:m,transaction:e})}}),null==v||v(C),l().dP({collectionSettingsStore:P,item:{type:"property",formatKey:"collection_page_properties",property:C,selectNameInitial:!r().A.isMobile}}),f.setState({...f.state,openProperty:{property:C,isInPeekRenderer:S},forceShowProperties:!0}),(0,i().hN)(b)&&d().pG({propertyType:b,propertyId:C,collectionContextStore:o}),(0,p().Z)({environment:g,collectionContextStore:o,from:"page_properties",property_type:(0,i().v2)(b),property:(0,i().hN)(b)?b:void 0,is_suggested_property:x,property_id:C})}}})}},578405:(e,t,o)=>{o.d(t,{h:()=>ke});var r=o(296540),i=()=>o(993905),n=()=>o(56366),a=()=>o(69708),l=()=>o(543886),s=()=>o(405170),p=()=>o(21140),d=(o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(581454),()=>o(484714)),c=()=>o(401497),u=()=>o(410730),y=()=>o(124672),m=()=>o(797809),g=()=>o(496603),S=()=>o(534177),v=()=>o(720665),f=()=>o(662453),h=()=>o(454305),P=()=>o(997583),b=()=>o(548821),x=()=>o(623186),w=(o(944114),o(803949),()=>o(202775)),I=()=>o(439264),C=(o(672577),()=>o(908006)),A=()=>o(90654),k=()=>o(908201),_=()=>o(774733),j=()=>o(402838),B=()=>o(795963),V=()=>o(255824),M=()=>o(68350),T=()=>o(726637),R=()=>o(689094),O=()=>o(599806),E=()=>o(199896),F=o(474848);function N(e){const{property:t,store:i,disabled:l,canConfigureCollection:s,onTab:p,onUntab:u,schema:y,blockPropertyValueOverlayStore:m,collectionStore:g,pagePropertiesStore:S,customization:v}=e,f=(0,d().v3)(),{currentUser:h}=f,P=(0,k().Ks)(),b=y[t],{value:x}=(0,o(645873).fJ)(o(862292).T.formulas),w=(0,c().IS)((e=>({propertyOuter:{display:"flex",alignItems:"left",height:"100%",flex:"auto",flexDirection:"column",minWidth:0,...null!=v&&v.stackPropertyLabelAndValue?{marginInlineStart:0}:{marginInlineStart:4}},property:{display:"flex",alignItems:"center",height:"100%",flex:"auto",minWidth:0,...null!=v&&v.stackPropertyLabelAndValue?{marginInlineStart:0}:{marginInlineStart:4}},addPageButton:{fontSize:14,minHeight:o(246219).iw,color:e.text.tertiary,background:void 0,boxShadow:void 0,borderBottom:"none"},iconStyle:{width:14,fill:e.icon.tertiary}})),[null==v?void 0:v.stackPropertyLabelAndValue]),I=(0,r.useCallback)((()=>{S.setState({...S.state,hoveredProperty:e.property})}),[e.property,S]),C=(0,r.useCallback)((()=>{S.setState({...S.state,hoveredProperty:void 0})}),[S]),_=(0,r.useCallback)((()=>{A().ho({environment:f,blockPropertyValueOverlayStore:m,store:i,property:t,surface:"page",collectionContextStore:P})}),[f,m,i,t,P]),j=(0,n().K8)((()=>T().A.isMobile&&!l&&"relation"===(null==b?void 0:b.type)&&i.isDefined()&&!o(726317).r({block:i.getModel(),property:t,schema:y,getRecordModel:i.getRecordModel,userId:h.id,userTimeZone:(0,o(416504).P)(),intl:o(972435).A.getIntl(),experimentService:o(242422).default,collectionFeatureGates:(0,o(909470).i)(),formulasModule:x,spaceIdCreator:f.idCreator.getSpaceIdCreatorSync(i.getModel().space_id)})),[h.id,l,t,b,y,i,x,f.idCreator]);return(0,F.jsx)("div",{role:"cell",style:w.propertyOuter,children:(0,F.jsxs)(E().Ay,{store:i,analyticsName:"page_property",children:[(0,F.jsx)("div",{style:w.property,onMouseMove:I,onMouseLeave:C,children:(0,F.jsx)(O().q,{store:i,property:t,locked:!s,disabled:l,surface:"page",onTab:p,onUntab:u,tableWrap:!1,blockPropertyValueOverlayStore:m,onOpenProperty:_,collectionStore:g})},t),j?(0,F.jsx)(o(760217).A,{focused:!1,icon:(0,R().W)(w.iconStyle),buttonStyle:{marginInlineEnd:0,width:"calc(100% - 4px)"},mobileIconStyle:{marginInlineStart:12},textWrapperStyle:{marginInlineStart:4},style:w.addPageButton,title:(0,F.jsx)(a().sA,{id:"pagePropertyRowValue.addRelationButtonMessage",defaultMessage:"Add page"}),onClick:_}):void 0]})})}const L=r.memo(N),K=r.memo((function(e){const{schema:t,format:i,store:a,collectionStore:l,disabled:s,locked:u,blockPropertyValueOverlayStore:y,isInPeekRenderer:m,property:v,mergedProperties:f,hideDragHandle:h,disablePropertyName:P,opacity:b,pagePropertiesStore:x,customization:w,isCollectionViewLocked:I,canConfigureCollection:T,layoutModule:R}=e,O=(0,r.useId)(),E=(0,d().v3)(),N=(0,k().Ks)(),K=(0,r.useCallback)((()=>{const e=y.state;if(!e.isOpen)return;const o=f,r=o.findIndex((t=>t.property===e.property)),i=o.find(((e,o)=>o>r&&z(t,e.property)))||o.find(((e,o)=>z(t,e.property)));i&&C().default.afterNextFlush((()=>{A().ho({environment:E,blockPropertyValueOverlayStore:y,store:a,property:i.property,surface:"page",collectionContextStore:N})})),A().VN({environment:E,blockPropertyValueOverlayStore:y})}),[y,N,E,f,t,a]),G=(0,r.useCallback)((()=>{const e=y.state;if(!e.isOpen)return;const o=f,r=o.findIndex((t=>t.property===e.property)),i=g().Uk(o,((e,o)=>o<r&&z(t,e.property)))||g().Uk(o,((e,o)=>z(t,e.property)));i&&C().default.afterNextFlush((()=>{A().ho({environment:E,blockPropertyValueOverlayStore:y,store:a,property:i.property,surface:"page",collectionContextStore:N})})),A().VN({environment:E,blockPropertyValueOverlayStore:y})}),[y,N,E,f,t,a]),D=(0,o(671891).l)(a),U=(0,n().K8)((()=>{var e;return"hide"===(null==D||null===(e=D.getFormat())||void 0===e?void 0:e.property_icons_visibility)}),[D]),H=Boolean(null==w?void 0:w.stackPropertyLabelAndValue),W=r.useRef(null),$=(0,j().s)(W,50),[Y,q]=r.useState(0);(0,r.useEffect)((()=>{var e;q((null==$?void 0:$.width)||(null===(e=W.current)||void 0===e?void 0:e.offsetWidth)||0)}),[$]);const{isPropertyInPageDetails:Z}=(0,o(517223)._1)({store:a,propertyId:v}),{isMobile:X}=E.device,Q=(0,B().Ge)({isMobile:X,stackPropertyLabelAndValue:H,isPropertyInPageDetails:Z}),J=(0,c().IS)((e=>({container:{display:"flex",width:"100%",position:"relative",opacity:b??1,...null!=w&&w.stackPropertyLabelAndValue?{flexDirection:"column",marginBottom:null!=w&&w.disableRowBottomMargin?void 0:16}:{marginBottom:null!=w&&w.disableRowBottomMargin?void 0:4}},flexRow:{...Z?{width:"100%"}:void 0,...(0,S().O9)(Q)?{width:Q,flexShrink:0}:void 0}})),[null==w?void 0:w.disableRowBottomMargin,null==w?void 0:w.stackPropertyLabelAndValue,Z,b,Q]),ee=(0,V().a)(),te="normalizedTitleWithIcon"===R.type&&"hide"===R.propertyLabels,oe=(0,r.useMemo)((()=>({height:{variant:null==w?void 0:w.heightVariant},width:(0,B().aG)({stackPropertyLabelAndValue:H}),size:"medium",fontWeight:"regular"})),[null==w?void 0:w.heightVariant,H]),re=u||I;return(0,F.jsxs)("div",{role:"row","aria-labelledby":O,ref:W,style:J.container,children:[(0,F.jsx)(o(964447).U$,{origin:W}),(0,F.jsxs)(p().Ye,{alignItems:"center",alignSelf:"flex-start",style:J.flexRow,children:[te?void 0:(0,F.jsx)(M().I,{schema:t,format:i,property:v,collectionStore:l,pagePropertiesStore:x,disabled:Boolean(s||P),locked:re,canConfigureCollection:T,isInPeekRenderer:m,hideIcon:U,hideDragHandle:h,showDragHandleAsIcon:!re&&!s,propertyNameAriaId:O,styleVariants:oe,blockStore:a,layoutModule:R}),X||ee?void 0:(0,F.jsx)(_().L_,{store:a,propertyId:v,style:Z?void 0:{position:"absolute",alignSelf:"center",...Y?{insetInlineStart:Y+4}:{insetInlineEnd:0},top:6}})]}),(0,F.jsx)(L,{schema:t,property:v,store:a,collectionStore:l,pagePropertiesStore:x,disabled:s||u,canConfigureCollection:T,onTab:K,onUntab:G,blockPropertyValueOverlayStore:y,customization:w}),X?(0,F.jsx)(_().L_,{store:a,propertyId:v,style:{marginTop:6}}):void 0]},v)}));function z(e,t){return(0,o(468882).B2)(e[t])}function G(e){const{disabled:t,locked:o,collectionStore:i,format:l,mergedProperties:s,propertyGroupId:p,showHiddenProperties:d,hideDragHandle:c,pagePropertiesStore:u,rowCustomization:y,disableLastRowBottomPadding:m,blockPropertyValueOverlayStore:g,isInPeekRenderer:S,schema:v,store:f,layoutModule:h}=e,P=(0,a().tz)(),b=s,C=(0,x().aN)(i),A=(0,x().Od)({collectionStore:i,format:l}),k=(0,x().U$)({collectionStore:i,propertyGroupId:p}),_=p?k:A,j=P.formatMessage({id:"pageProperties.tableLabel",defaultMessage:"Page properties"}),B=function(e){const{properties:t,showHiddenProperties:o}=e;return(0,r.useMemo)((()=>{const e=[];let r=0;return t.forEach((t=>{if("section"!==t.visibility)return o?(e.splice(r,0,t.property),void(r+=1)):void("hide"!==t.visibility&&("hide_if_empty"!==t.visibility||t.hasValue)?(e.splice(r,0,t.property),r+=1):e.push(t.property));e.push(t.property)})),{all:e,visible:e.slice(0,r)}}),[t,o])}({properties:b,showHiddenProperties:d}).visible,V=(0,n().K8)((()=>(0,w().r)(i)),[i]),M=(0,r.useMemo)((()=>({...y,...m&&{disableRowBottomMargin:!0}})),[m,y]);return t||o||!C||c?(0,F.jsx)("div",{role:"table","aria-label":j,style:I().Bb,children:B.map(((e,r)=>{const n=r===B.length-1?M:y;return(0,F.jsx)("div",{children:(0,F.jsx)(K,{schema:v,format:l,store:f,collectionStore:i,disabled:t,locked:o,blockPropertyValueOverlayStore:g,isInPeekRenderer:S,property:e,mergedProperties:s,pagePropertiesStore:u,customization:n,isCollectionViewLocked:V,canConfigureCollection:C,layoutModule:h})},e)}))}):(0,F.jsx)(I().Ay,{role:"table","aria-label":j,direction:"vertical",keys:B,renderKey:(e,r)=>{const n=r===B.length-1?M:y;return(0,F.jsx)(K,{schema:v,format:l,store:f,collectionStore:i,disabled:t,locked:o,blockPropertyValueOverlayStore:g,isInPeekRenderer:S,mergedProperties:s,hideDragHandle:c,customization:n,property:e,pagePropertiesStore:u,isCollectionViewLocked:V,canConfigureCollection:C,layoutModule:h})},onDrop:_})}var D=()=>o(718827),U=()=>o(553965),H=()=>o(554283),W=()=>o(589647),$=()=>o(937199),Y=()=>o(455994),q=()=>o(463830),Z=()=>o(77246),X=()=>o(145214),Q=()=>o(406699),J=()=>o(417392),ee=()=>o(859428);const te=408;var oe=()=>o(157260);const re=130;function ie(e){const{store:t,collectionStore:o,pagePropertiesStore:i,blockPropertyValueOverlayStore:a,compactProperties:l,disabled:s,locked:u,format:y,hiddenProperties:m,rowLength:g,variant:S,pageViewBlockContext:v,layoutModule:f}=e,h=(0,n().K8)((()=>o.getSchema()),[o]),[P,w]=(0,r.useState)(!1),I=(0,x().aN)(o),C=(0,n().K8)((()=>Z().Uv.getMode(t)),[t]),A=(0,d().Y0)(),{isFirefox:B}=A,R=(0,n().uB)(void 0,q().A),N=(0,k().ET)(),L=(0,n().K8)((()=>o.getLayoutStore()),[o]),[K,z]=(0,r.useState)(!1),[G,D,U]=(0,H().B)(),Q=(0,j().s)(U,100),J=((null==Q?void 0:Q.width)||0)>=te&&!A.isPhone,ee=(0,n().K8)((()=>Y().A.getPanelState("mainPage").isOpen),[]),oe=Boolean((0,r.useContext)($().sf)),re=(0,r.useMemo)((()=>!(!f||!("propertyLabels"in f)||"hide"!==f.propertyLabels)),[f]),ie=(0,n().K8)((()=>{if(oe)return!1;const e=null==L?void 0:L.getModules();return!(!e||"pinned"!==S||0===e.page_details.length)}),[oe,L,S]),le=J&&ee&&!D?"hidden":"visible",se=J,pe=(0,c().IS)((()=>{const e={display:"grid",gridTemplateColumns:`repeat(${l.length>g?g:"auto-fit"}, minmax(80px, max-content))`,columnGap:4,rowGap:4};return{container:{...ie&&se?{display:"flex",flexDirection:"row",gap:8}:void 0,...ie&&!se?{display:"flex",flexDirection:"column",gap:6}:void 0},row:{...re?{display:"flex",flexDirection:"row",flexWrap:"wrap",marginTop:15}:"pinned"===S?{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(80px, max-content))",columnGap:4,rowGap:8,marginTop:10}:e,...ie?{maxWidth:"100%",...B&&{flexGrow:1}}:void 0},propertyRowWrapper:{..."pinned"===S?{display:"flex",flexDirection:"column"}:void 0},LastPagePropertyWrapper:{position:"relative"},LastPagePropertyInnerHoverPlusButton:{position:"absolute",insetInlineStart:"calc(100% + 10px)",top:"50%",transform:"translateY(-50%)"},infoPanelToggleButtonContainer:{display:"flex",alignItems:"end",flexShrink:0,visibility:le}}}),[l.length,g,ie,se,re,S,B,le]),de=(0,r.useCallback)((()=>{w(!0)}),[]),ce=(0,r.useCallback)((()=>{w(!1)}),[]),ue=(0,V().a)(),ye=(0,n().K8)((()=>{var e;return"hide"===(null==L||null===(e=L.getFormat())||void 0===e?void 0:e.property_icons_visibility)}),[L]),me=(0,r.useMemo)((()=>(0,F.jsx)(ae,{layoutModule:f,onClose:ce,hiddenProperties:m,canConfigureCollection:I&&"suggest"!==C,store:t,collectionStore:o,collectionContextStore:N,blockPropertyValueOverlayStore:a,disabled:s,locked:u,isInPeekRenderer:v===b().Rr.PeekView,format:y,buttonPopupStore:R,pagePropertiesStore:i,hideDragHandle:"pinned"===S})),[a,R,I,N,o,s,C,y,ce,m,u,i,v,t,S,f]);return r.useEffect((()=>{z(!0)}),[]),(0,F.jsxs)("div",{style:pe.container,ref:G,children:[(0,F.jsx)("div",{style:pe.row,onMouseEnter:de,onMouseLeave:ce,children:0===l.length?me:l.map(((r,n)=>{const d=n===l.length-1;return(0,F.jsxs)("div",{style:{...pe.propertyRowWrapper,...d?pe.LastPagePropertyWrapper:void 0},children:[re?void 0:(0,F.jsxs)(p().Ye,{children:[(0,F.jsx)(M().I,{schema:h,format:y,hideDragHandle:!0,property:r.property,blockStore:t,collectionStore:o,pagePropertiesStore:i,disabled:s,locked:u,canConfigureCollection:I&&"suggest"!==C,isInPeekRenderer:v===b().Rr.PeekView,styleVariants:ne,hideDuplicatePropertyOption:Boolean(L),layoutModule:e.layoutModule,hideIcon:ye}),ue?void 0:(0,F.jsx)(_().L_,{store:t,propertyId:r.property})]}),(0,F.jsx)(E().Ay,{store:t,analyticsName:"page_property",children:(0,F.jsx)(O().q,{store:t,collectionStore:o,blockPropertyValueOverlayStore:a,property:r.property,surface:re?"mini":"compact_page",disabled:s,locked:u,tableWrap:!1})}),d&&"pinned"!==S?(0,F.jsx)(X().A,{visible:P||T().A.isMobile,initial:{opacity:0},animate:{opacity:1,marginInlineStart:"auto"},exit:{opacity:0},style:pe.LastPagePropertyInnerHoverPlusButton,children:me}):void 0]},r.property)}))}),ie?(0,F.jsx)("div",{style:pe.infoPanelToggleButtonContainer,children:(0,F.jsx)(W().dI,{collectionStore:o,variant:se?"compact":"full",pageViewBlockContext:v})}):void 0]})}const ne={size:"small",fontWeight:"medium",width:{variant:"hug-content"},height:{variant:"small"}},ae=r.memo((function(e){const{hiddenProperties:t,canConfigureCollection:i,collectionStore:l,isInPeekRenderer:s,buttonPopupStore:p,collectionContextStore:u,hideDragHandle:y,overflowButtonWrapperStyle:m,overflowButtonStyle:g,pagePropertiesStore:S,layoutModule:v}=e,f=(0,d().v3)(),h=(0,n().K8)((()=>l.getSchema()),[l]),P=(0,c().IS)((e=>({overflowIcon:{width:16,height:16,fill:e.icon.secondary},pagePropertiesOverflow:{width:"100%",fontSize:14,padding:y?"10px":"10px 10px 10px 28px",maxHeight:500,overflowY:"scroll"},overflowButtonWrapper:{display:"flex",alignItems:"center",paddingBottom:8,...m},overflowButton:{display:"flex",width:32,height:32,borderRadius:4,justifyContent:"center",alignItems:"center",...g}})),[y,m,g]),b=(0,r.useCallback)((()=>{(0,o(571763).H)({environment:f,collectionContextStore:u,collectionStore:l,isInPeekRenderer:s,onCloseMenu:()=>{p.setState({open:!1})},pagePropertiesStore:S})}),[f,u,S,l,s,p]);return t.length?(0,F.jsx)(Q().A,{onClose:e.onClose,popupWrapStyle:{width:500},buttonPopupStore:p,popupType:T().A.isMobile?J().nl.SlideUp:J().nl.Popup,render:()=>(0,F.jsx)(o(805751).A,{debugName:"PagePropertiesCompact",capture:!0,children:(0,F.jsxs)("div",{style:P.pagePropertiesOverflow,children:[(0,F.jsx)(G,{showHiddenProperties:!0,schema:h,mergedProperties:t,format:e.format,store:e.store,collectionStore:e.collectionStore,disabled:e.disabled,locked:e.locked,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,isInPeekRenderer:e.isInPeekRenderer,hideDragHandle:y,pagePropertiesStore:S,layoutModule:v}),i?(0,F.jsx)(oe().Xt,{collectionStore:l,pagePropertiesStore:S,isInPeekRenderer:s}):void 0]})}),renderOrigin:e=>(0,F.jsx)("div",{style:P.overflowButtonWrapper,children:(0,F.jsx)(ee().A,{renderTooltip:()=>(0,F.jsx)(a().sA,{defaultMessage:"{num, plural, one {1 more property} other {{num} more properties}}",id:"database.pageProperties.compact.showMoreTooltip",values:{num:t.length}}),placement:"bottom",render:t=>(0,F.jsx)(D().Ay,{style:P.overflowButton,...(0,U().A)(e,t),children:(0,o(30626)._)(P.overflowIcon)})})})}):i?(0,F.jsx)("div",{style:P.overflowButtonWrapper,children:(0,F.jsx)(ee().A,{renderTooltip:()=>(0,F.jsx)(a().sA,{defaultMessage:"Add a property",id:"database.pageProperties.compact.addPropertyButtonTitle"}),placement:"bottom",render:t=>(0,F.jsx)(Q().A,{popupType:T().A.isMobile?J().nl.SlideUp:J().nl.Popup,onClose:e.onClose,buttonPopupStore:p,originGap:1,alignmentToOrigin:"start",render:()=>(0,F.jsx)(o(59400).m$,{context:o(527438).Bd.TopbarFilterPopup,collectionContextStore:u,collectionSettingsStore:u.settingsStore,hideDesktopHeader:!0}),onClick:b,onDismiss:()=>{const e=u.settingsStore;o(147503).os({collectionSettingsStore:e})},renderOrigin:e=>(0,F.jsx)(D().Ay,{style:P.overflowButton,...(0,U().A)(e,t),children:(0,R().W)(P.overflowIcon)})})})}):null})),le=5;function se(e){const{collectionStore:t,schema:o,store:i,format:a,propertyIds:l,propertyGroupId:s,variant:p,customization:w,pagePropertiesStore:I,pageViewBlockContext:C,blockPropertyValueOverlayStore:A,layoutModule:k,disabled:_,locked:j}=e,[B,V]=(0,P().z)(),M=(0,n().uB)(void 0,h().A),T=(0,d().Y0)(),R=(0,c().IS)((e=>({pageProperties:{width:"100%",fontSize:14},actionButtonsWithTopMargin:{marginTop:8}})),[]),O=(0,r.useCallback)((()=>{M.setState({...M.state,mouseEntered:!0})}),[M]),E=(0,r.useCallback)((()=>{M.setState({...M.state,mouseEntered:!1})}),[M]),N=(0,n().K8)((()=>"pinned"===p||Boolean(i.isAssociatedCollectionAPageTree())),[i,p]),L=(0,n().K8)((()=>{var e;return null===(e=t.getLayoutStore())||void 0===e?void 0:e.getModules()}),[t]);let K=(0,x().z7)({store:i,format:a,schema:o,collectionStore:t,propertyIds:l,propertyGroupId:s});w&&(K=function(e,t,o,r,i){const{hideEmptyProperties:n,neverShowEmptyPropertiesIfMoreThanNProperties:a,neverShowNotionSystemProperties:l,sortNonEmptyPropertiesFirst:s,neverShowPropertiesElsewhereInLayout:p,propertyIdsToExclude:d}=t;n&&(e=e.map((e=>({...e,visibility:e.hasValue?e.visibility:"hide"}))));if(p&&o){const t=(0,y().q)({modulesByArea:o,collectionSchema:r,collectionFormat:i}),n=new Set(t);e=e.filter((e=>!n.has(e.property)))}l&&(e=e.filter((e=>!((0,m().TV)(e.property)||"show"!==e.visibility&&e.property.startsWith("notion://")))));void 0!==a&&e.length>a&&(e=e.filter((e=>e.hasValue)));d&&(e=e.filter((e=>!d.includes(e.property))));s&&(e=g().Ul(e,(e=>!e.hasValue)));return e}(K,w,L,o,a));const z=(0,n().K8)((()=>I.state.forceShowProperties),[I]),[D,U]=(0,r.useMemo)((()=>{if((0,v().pN)(p))return g().jB(K,(e=>{var t;return!!(null===(t=o[e.property])||void 0===t?void 0:t.type)&&function(e){if("section"===e.visibility)return!1;if("hide"===e.visibility)return!1;if("hide_if_empty"===e.visibility&&!e.hasValue)return!1;return!0}(e)}));if("pinned"===p){const e=Object.fromEntries(K.map((e=>[e.property,e])));if(!l)return[[],[]];const t=l.map((t=>{var r;const i=o[t];if(i)return{property:t,visibility:"show",hasValue:(null===(r=e[t])||void 0===r?void 0:r.hasValue)??!1,name:i.name}})).filter(S().O9);return[t.slice(0,u().U),t.slice(u().U)]}(0,S().HB)(p)}),[K,l,o,p]),H=(0,r.useMemo)((()=>N?D.concat(U):K),[N,D,U,K]),{paddingLeft:W,paddingRight:$}=e,Y=k&&"normalizedTitleWithIcon"===k.type&&"hide"===k.propertyLabels,q=Math.min(le,D.length)*re,Z=!Y&&("pinned"===p?T.isPhone||V>0&&V<te:V>0&&V<q);let X;if(null!=w&&w.emptyState&&0===D.length&&0===U.length)return w.emptyState;if(null!=w&&w.dontRenderIfNoPropertiesDefaultShown&&0===D.length)return null;if(N&&!Z)X=(0,F.jsx)(ie,{store:i,collectionStore:t,pagePropertiesStore:I,blockPropertyValueOverlayStore:A,compactProperties:D,hiddenProperties:U,disabled:e.disabled,locked:e.locked,format:a,rowLength:le,variant:p,layoutModule:k,pageViewBlockContext:C});else{const r={stackPropertyLabelAndValue:null==w?void 0:w.stackPropertyLabelAndValue,heightVariant:null!=w&&w.stackPropertyLabelAndValue||N&&!Z?"small":"medium",hideAddPropertyButton:null==w?void 0:w.hideAddPropertyButton},n=C===b().Rr.PeekView;X=(0,F.jsxs)("div",{style:{...null!=w&&w.disableContainerPadding?{}:{paddingBottom:8},...!Z||null!=w&&w.disableTopPadding?{}:{paddingTop:8}},children:[(0,F.jsx)(G,{schema:o,format:a,store:i,disabled:_,locked:j,collectionStore:t,propertyGroupId:s,pagePropertiesStore:I,hideDragHandle:"pinned"===p,showHiddenProperties:z,mergedProperties:H,rowCustomization:r,disableLastRowBottomPadding:null==w?void 0:w.disableLastRowBottomPadding,isInPeekRenderer:n,layoutModule:k,blockPropertyValueOverlayStore:A}),"pinned"!==p?(0,F.jsx)(oe().Ay,{collectionStore:t,propertyGroupId:s,schema:o,customization:r,disabled:e.disabled,locked:e.locked,pagePropertiesStore:I,isInPeekRenderer:n,mergedProperties:H,wrapperStyle:null!=w&&w.stackPropertyLabelAndValue?R.actionButtonsWithTopMargin:void 0}):void 0]})}return(0,F.jsx)("div",{style:R.pageProperties,onMouseEnter:O,onMouseLeave:E,ref:B,children:(0,F.jsxs)("div",{style:{width:"100%",maxWidth:"100%",padding:N||null!=w&&w.disableContainerPadding?void 0:"16px 0 8px 0",margin:"0 auto",...W?{paddingInlineStart:W}:{},...$?{paddingInlineEnd:$}:{}},children:[X,(0,F.jsx)(f().G0,{blockId:i.id,collectionStore:t})]})})}var pe=()=>o(478726),de=()=>o(891078),ce=()=>o(765957),ue=()=>o(171018),ye=()=>o(712505),me=()=>o(241181),ge=()=>o(720501),Se=()=>o(252291),ve=()=>o(854705),fe=()=>o(284371),he=()=>o(656219),Pe=()=>o(817942);function be(e){const{store:t,context:o,disabled:a,wrapper:l,forceGroupsOpenOrClosed:s,customization:p,moduleId:d,layoutModule:u}=e,y=(0,n().K8)((()=>t.getAssociatedCollectionStore()),[t]),m=(0,n().K8)((()=>(null==y?void 0:y.getNormalizedPropertyGroups({publicPageDataFallbackEnabled:!0}))||[]),[y]),g=(0,n().K8)((()=>{if(t.isCollectionViewPageWithContent())return{type:"hidden"};const e=t.getAssociatedCollectionStore();if(!e)return{type:"hidden"};const o=(0,pe().gV)(t);return o?{type:"visible",store:t,format:o,collectionStore:e}:{type:"hidden"}}),[t]),S=(0,c().IS)((e=>({container:{cursor:"default"}})),[]);if("hidden"===g.type)return null;return(l||(e=>(0,F.jsx)(Pe().vV,{className:"layout-content",children:e})))((0,F.jsx)(Pe().vV,{children:(0,F.jsx)(i().s,{allowSelectionWithin:!0,children:(0,F.jsxs)("div",{style:S.container,children:[m.map(((e,t)=>(0,r.createElement)(xe,{...g,key:e.id,context:o,disabled:a,propertyGroup:e,forceGroupOpenOrClosed:s,customization:p,isLast:t===m.length-1,moduleId:d,layoutModule:u}))),0===m.length?(0,F.jsx)(xe,{...g,context:o,disabled:a,propertyGroup:"virtualPropertiesGroup",forceGroupOpenOrClosed:s,customization:p,isLast:!0,moduleId:d,layoutModule:u}):void 0]})})}))}function xe(e){const{store:t,context:o,disabled:i,propertyGroup:p,format:d,collectionStore:u,forceGroupOpenOrClosed:y,customization:m,isLast:g,moduleId:S,layoutModule:v}=e,f=(0,n().K8)((()=>"virtualPropertiesGroup"===p?{idForRememberingCollapsedState:`${S}_defaultGroup`,groupIdForSavingPropertyToGroup:void 0,title:(0,F.jsx)(a().sA,{id:"collapsiblePropertyGroups.defaultGroupTitle",defaultMessage:"Properties"})}:{idForRememberingCollapsedState:p.id,groupIdForSavingPropertyToGroup:p.id,title:p.title}),[S,p]),h=(0,n().K8)((()=>void 0!==y?"open"===y:he().A.isPropertyGroupExpanded({groupId:f.idForRememberingCollapsedState})),[y,f.idForRememberingCollapsedState]),P=o===b().Rr.PeekView,x=(0,n().K8)((()=>t.isNonEditableState()),[t]),w=(0,n().K8)((()=>u.getSchema()),[u]),I=(0,n().K8)((()=>{var e,o;return t.id===(null===(e=ce().default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.id)?ue().Ep.getNewEditorPagePropertiesStore(f.idForRememberingCollapsedState):t.id===(null===(o=ye().default.peekTargetStore.state)||void 0===o?void 0:o.id)?ue().A6.getNewEditorPagePropertiesStore(f.idForRememberingCollapsedState):new(ue().YB)}),[f.idForRememberingCollapsedState,t.id]),C=(0,r.useCallback)((()=>{he().A.togglePropertyGroupExpanded({groupId:f.idForRememberingCollapsedState})}),[f.idForRememberingCollapsedState]),A=(0,c().IS)((e=>({groupContent:{paddingInlineStart:0,paddingBottom:g?void 0:null!=m&&m.stackPropertyLabelAndValue?28:20}})),[null==m?void 0:m.stackPropertyLabelAndValue,g]);return(0,F.jsxs)("div",{children:[(0,F.jsx)(we,{onClick:C,isExpanded:h,customization:m,children:f.title}),h?(0,F.jsx)("div",{style:A.groupContent,children:(0,F.jsx)(se,{propertyGroupId:f.groupIdForSavingPropertyToGroup,pagePropertiesStore:I,schema:w,format:d,store:t,collectionStore:u,disabled:i,locked:x,blockPropertyValueOverlayStore:P?s().A:l().A,pageViewBlockContext:o,customization:{...m,neverShowPropertiesElsewhereInLayout:!0},layoutModule:v})}):void 0]})}function we(e){const{children:t,isExpanded:o,customization:r,onClick:i}=e,n=(0,a().tz)(),l=(0,d().Y0)(),s=Boolean(null==r?void 0:r.stackPropertyLabelAndValue);let p;p=o&&s?l.isTablet?0:T().A.isMobile?2:8:0;const u=(0,c().IS)((e=>({container:{height:34,display:"flex",alignItems:"center",justifyContent:"flex-start",paddingInlineStart:6,paddingInlineEnd:6,gap:6,marginBottom:p,borderRadius:6},label:{fontSize:13,color:e.text.secondary,fontWeight:fe().Wy.medium,...fe().RC,height:20},icon:{transition:"transform .2s ease",transform:o?"rotate(0deg)":"rotate(-90deg)"},iconContainer:{display:"flex",alignItems:"center",justifyContent:"center"}})),[p,o]),y=(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{style:u.label,children:t}),(0,F.jsx)("div",{style:u.iconContainer,children:(0,F.jsx)("span",{style:u.icon,children:(0,F.jsx)(Se().I,{icon:ve().arrowChevronSingleDownFillSmallIcon,size:"xs",colorVariant:"tertiary"})})})]});return o?(0,F.jsx)(D().Ay,{onClick:i,style:u.container,children:y}):(0,F.jsx)(D().Ay,{style:u.container,onClick:i,ariaLabel:n.formatMessage(Ie.showProperties),children:y})}const Ie=(0,a().YK)({showProperties:{id:"CollapsiblePropertyGroups.showProperties",defaultMessage:"Show properties in section"}});function Ce(e){const{store:t,format:o,collectionStore:r,disabled:i,blockPropertyValueOverlayStore:a,variant:l,propertyIds:s,customization:p,pagePropertiesStore:d,pageViewBlockContext:c,layoutModule:u}=e,y=(0,n().K8)((()=>r.getSchema()),[r]),m=(0,n().K8)((()=>t.isNonEditableState()),[t]);return(0,F.jsx)(se,{store:t,collectionStore:r,schema:y,format:o,disabled:i,locked:m,blockPropertyValueOverlayStore:a,pageViewBlockContext:c,propertyIds:s,variant:l,customization:p,pagePropertiesStore:d,layoutModule:u})}const Ae={id:"properties",type:"properties"};function ke(e){const{store:t,context:o,disabled:r,variant:d,layoutModule:c=Ae,propertyIds:u,customization:y,wrapper:m,showDefaultTitle:g,shownAsPopup:S}=e,v=(0,de().bx)(t,r),f=(0,n().K8)((()=>Z().Uv.getMode(t)),[t]),{isMainEditor:h,isPeekEditor:P}=(0,n().K8)((()=>{var e,o;const r=Boolean(ye().default.isSidePeekOpen()&&t.id===(null===(e=ye().default.peekTargetStore.state)||void 0===e?void 0:e.id));return{isMainEditor:Boolean(!r&&t.id===(null===(o=ce().default.state.mainEditorCurrentBlockStore)||void 0===o?void 0:o.id)),isPeekEditor:r}}),[t]),x=(0,n().K8)((()=>t.getAssociatedCollectionStore()),[t]),w=(0,n().K8)((()=>{if(!x)return{type:"hidden"};if(t.isCollectionViewPageWithContent())return{type:"hidden"};const e=(0,pe().gV)(t);return e?{type:"visible",store:t,format:e,collectionStore:x}:{type:"hidden"}}),[x,t]),I=(0,me().p)({collectionStore:x,layoutModule:c}),C=(0,n().K8)((()=>I&&c&&!(null!=y&&y.doNotShowPropertyGroups)),[null==y?void 0:y.doNotShowPropertyGroups,I,c]),A=(0,n().K8)((()=>{if(!S){if(h)return ue().Ep.getNewEditorPagePropertiesStore();if(P)return ue().A6.getNewEditorPagePropertiesStore()}return new(ue().YB)}),[S,h,P]);if("hidden"===w.type)return null;const k=o===b().Rr.PeekView,_=C&&c?(0,F.jsx)(be,{...e,layoutModule:c,wrapper:void 0,moduleId:c.id}):(0,F.jsxs)(p().wt,{gap:8,children:[g?(0,F.jsx)(ge().j,{style:{marginInlineStart:6},children:(0,F.jsx)(a().sA,{id:"pageLayout.propertiesModule.title",defaultMessage:"Properties"})}):void 0,(0,F.jsx)(i().s,{allowSelectionWithin:!0,children:(0,F.jsx)(Ce,{...w,disabled:!v||"suggest"===f,pageViewBlockContext:o,blockPropertyValueOverlayStore:k?s().A:l().A,propertyIds:u,variant:d,layoutModule:c,customization:y,pagePropertiesStore:A})})]});return m((0,F.jsx)(F.Fragment,{children:_}))}},589647:(e,t,o)=>{o.d(t,{LR:()=>a,Rm:()=>l,dI:()=>n});var r=()=>o(645873);const i={PinnedInfoPanelToggleButton:new(r().O2)("PinnedInfoPanelToggleButton",(async()=>o.e(7989).then(o.bind(o,279829)))),PageHeaderInfoPanelToggleButton:new(r().O2)("PageHeaderInfoPanelToggleButton",(async()=>o.e(20589).then(o.bind(o,579029)))),ScrollToCommentsButton:new(r().O2)("ScrollToCommentsButton",(async()=>o.e(93813).then(o.bind(o,769231))))},n=(0,r()._h)(i.PinnedInfoPanelToggleButton,(e=>e.default)),a=(0,r()._h)(i.PageHeaderInfoPanelToggleButton,(e=>e.PageHeaderInfoPanelToggleButton)),l=(0,r()._h)(i.ScrollToCommentsButton,(e=>e.ScrollToCommentsButton))},621837:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>r,plusFillSmallIcon:()=>i});o(296540);const r={viewBox:"0 0 16 16",fittedViewBox:"2.65 2.65 10.7 10.7",svg:(0,o(474848).jsx)("path",{d:"M8 2.65a.75.75 0 0 1 .75.75v3.85h3.85a.75.75 0 0 1 0 1.5H8.75v3.85l-.004.077a.75.75 0 0 1-1.492 0L7.25 12.6V8.75H3.4a.75.75 0 0 1 0-1.5h3.85V3.4A.75.75 0 0 1 8 2.65"})},i=(0,o(340498).wt)("plusFillSmall",r)},689094:(e,t,o)=>{o.d(t,{W:()=>i});o(296540);var r=o(474848);const i=(0,o(340498).wt)("plus",{viewBox:"0 0 16 16",svg:(0,r.jsx)("path",{d:"M7.977 14.963c.407 0 .747-.324.747-.723V8.72h5.362c.399 0 .74-.34.74-.747a.746.746 0 00-.74-.738H8.724V1.706c0-.398-.34-.722-.747-.722a.732.732 0 00-.739.722v5.529h-5.37a.746.746 0 00-.74.738c0 .407.341.747.74.747h5.37v5.52c0 .399.332.723.739.723z"})})},720501:(e,t,o)=>{o.d(t,{j:()=>l});o(296540);var r=()=>o(56366),i=()=>o(401497),n=()=>o(284371),a=o(474848);function l(e){const{children:t,style:o}=e,{store:l}=e.icon?e:{},s=(0,r().K8)((()=>{var e;return"hide"!==(null==l||null===(e=l.getAssociatedCollectionStore())||void 0===e||null===(e=e.getLayoutStore())||void 0===e||null===(e=e.getFormat())||void 0===e?void 0:e.property_icons_visibility)}),[l]),p=(0,i().IS)((e=>({title:{padding:"3px 0",fontSize:13,lineHeight:"18px",color:e.text.secondary,display:"flex",flexDirection:"row",alignItems:"center",fontWeight:n().Wy.medium,gap:2,...o},icon:{width:18,height:24,fill:e.icon.secondary}})),[o]);return(0,a.jsxs)("div",{style:p.title,children:[e.icon&&s?e.icon(p.icon):void 0,(0,a.jsx)("div",{children:t})]})}},803074:(e,t,o)=>{o.d(t,{C4:()=>h,Nf:()=>b,qM:()=>P});o(16280),o(944114),o(898992),o(430670),o(581454);var r=()=>o(726637),i=()=>o(617871),n=()=>o(388693),a=()=>o(519831),l=()=>o(161479),s=()=>o(534177),p=()=>o(572088),d=()=>o(594794),c=()=>o(972435),u=()=>o(252833),y=()=>o(543665),m=()=>o(559506),g=()=>o(901389),S=()=>o(510683),v=()=>o(384944);const f=(0,o(69708).YK)({authError:{defaultMessage:"Auth failed. Please try again or contact Notion support.",id:"database.viewSettings.propertyTypeSection.connected.authFail"},mobileAdminError:{defaultMessage:"Ask your workspace admin to configure the GitHub (Workspace) app in settings to use this feature.",id:"database.viewSettings.propertyTypeSection.connected.mobileAdminError"},mobileError:{defaultMessage:"Please authorize this integration on the desktop app or a browser.",id:"database.viewSettings.propertyTypeSection.connected.mobileError"}});async function h(e,t,o,i){const n=null==t?void 0:t.getSpaceStore();if(!n)return;const a=(0,p().jw)(o.id).length;if(r().A.isMobile&&i&&!a){const e=c().A.formatMessage(f.mobileAdminError);throw g().f1(e),new Error(e)}if(r().A.isMobile&&!i&&!a){const e=c().A.formatMessage(f.mobileError);throw g().f1(e),new Error(e)}if(!a&&i&&n.canAdmin()||!a&&!i)try{await S().Jq({environment:e,integration:o,spaceId:n.id,from:"collection_settings_property_type"})}catch(l){const e=c().A.formatMessage(f.authError);throw g().f1(e),new Error(e)}if(!(0,p().jw)(o.id).length){const e=c().A.formatMessage(f.authError);throw g().f1(e),new Error(e)}}function P(e){const{environment:t,pattern:o,integration:r,parentCollectionStore:i,transaction:n}=e;if(!o.connected_relation_properties)throw new Error("Cannot create a connected relation collection without properties");const p=new(y().m)(t,(0,d().zP)({environment:t,table:a().Vl,spaceId:i.pointer.spaceId})),c={};o.connected_relation_sub_schemas&&(0,s().WP)(o.connected_relation_sub_schemas).map((([e,o])=>{const r=new(y().m)(t,(0,d().zP)({environment:t,table:a().Vl,spaceId:i.pointer.spaceId})),s={bot_id:void 0,external_object_id:void 0,uri:e,integration_id:void 0,is_placeholder:void 0,original_url:void 0,domain:void 0,external_schema:o,sync_state:void 0,pattern_name:void 0},u={id:r.id,version:0,space_id:(0,l().e)(i.pointer.spaceId),parent_table:a().Vl,parent_id:p.id,alive:!0,format:s,schema:{}};c[e]=r.id,v().zv({store:r,data:u,transaction:n})}));const m={id:p.id,version:0,space_id:(0,l().e)(i.pointer.spaceId),parent_table:a().Vl,parent_id:i.id,alive:!0,format:{attributes:[{id:"title",name:"title",type:"inline",format:{type:"title",section:"title"},values:[(0,u().Fe)({pattern:o,integration:r})]}],bot_id:void 0,external_object_id:void 0,uri:`notion://user-defined-collection/${r.id}/${o.name}`,integration_id:r.id,is_placeholder:void 0,original_url:void 0,domain:void 0,external_schema:o.connected_relation_properties,sync_state:void 0,pattern_name:o.name,related_external_object_uris_to_instance_ids:c},schema:{}};return v().zv({store:p,data:m,transaction:n}),p}async function b(e){const{bot:t,connected_relation_properties:o}=e;if(t.integration_id===i().Iy||t.integration_id===i().mn)return await async function(e){var t,o,r;const{environment:i,objectName:a,spaceId:l,bot:s}=e,p=await m().callApi({eventName:"describeSalesforceObject",environment:i,data:{spaceId:l,objectName:a,botId:s.id}});if("success"!==(null==p?void 0:p.type))return{error:n().qh.FAILED_TO_FETCH_SALESFORCE_PROPERTIES};var d,c;if((null===(t=p.data)||void 0===t?void 0:t.responseStatus)===n().qh.REAUTHENTICATION_REQUIRED||(null===(o=p.data)||void 0===o?void 0:o.responseStatus)===n().qh.NO_USER_API_ACCESS)return{error:`${null===(d=p.data)||void 0===d?void 0:d.responseStatus}:${null===(c=p.data)||void 0===c?void 0:c.userType}`};const u=null==p||null===(r=p.data)||void 0===r?void 0:r.properties;if(u){return{value:u.flatMap((e=>{const t=e.custom?e.label:e.relationshipName||e.label;return"User"===e.referenceTo||"Group"===e.referenceTo?[{id:e.name,name:t,isSelected:!1,type:e.type,metadata:e,isAlreadySynced:e.isAlreadySynced,isAdminNotAccessible:e.isAdminNotAccessible},{id:`mapped_${e.name}`,name:`${t} (Notion User)`,isSelected:!1,type:"person",metadata:e,isAlreadySynced:e.isAlreadySynced,isAdminNotAccessible:e.isAdminNotAccessible}]:[{id:"Name"===e.name?"title":e.name,name:"relation"===e.type?t:e.label,isSelected:!1,type:e.type,metadata:e,isAlreadySynced:e.isAlreadySynced,isAdminNotAccessible:e.isAdminNotAccessible}]}))}}return{error:n().qh.NO_PROPERTIES_FOUND}}(e);const r=[],a=o;for(const i in a){const e=a[i];null!=e&&e.name&&null!=e&&e.type&&r.push({id:i,name:e.name,isSelected:!1,type:e.type,metadata:{name:e.name,label:e.name,type:e.type,custom:!1},isAlreadySynced:!1})}return{value:r}}}}]);