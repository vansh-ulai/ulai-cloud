"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[4586],{323779:(e,t,n)=>{n.r(t),n.d(t,{default:()=>he});var o=n(296540),i=()=>n(908006),s=()=>n(484714),r=()=>n(792485),a=()=>n(56366),l=()=>n(998531),c=()=>n(30537),u=()=>n(777447),d=()=>n(69708),p=()=>n(264879),k=()=>n(501666),f=()=>n(231297),m=()=>n(805751),g=()=>n(404277),v=()=>n(939740),x=()=>n(45552),y=()=>n(417392),h=()=>n(156988),I=()=>n(722872),S=()=>n(557155),b=()=>n(564884),T=()=>n(726637),A=()=>n(929219),w=()=>n(328347),B=()=>n(332737),P=()=>n(179034),C=()=>n(201980),j=()=>n(496603),L=()=>n(534177),M=()=>n(939768),U=()=>n(559926),E=()=>n(319975),R=()=>n(760217),V=()=>n(89924),_=()=>n(18387),F=()=>n(481292),H=()=>n(781286),K=()=>n(958163),N=()=>n(401497),W=()=>n(718827),q=()=>n(148832),D=()=>n(187820),Q=()=>n(16006),O=n(474848);function z(e){const{store:t,onClick:n}=e,o=(0,s().v3)(),i=(0,s().WS)(),r=(0,a().K8)((()=>t.getIcon()),[t]),l=(0,a().K8)((()=>t instanceof q().B&&t.isEmptyPage()),[t]),c=(0,a().K8)((()=>(0,D().Te)(t)),[t]),u=(0,N().IS)((e=>({container:{display:"flex",alignItems:"center",padding:"4px 6px",marginInlineStart:12,marginInlineEnd:12,borderRadius:6,boxShadow:e.inputBoxShadow,background:e.inputBackground,height:28,fontSize:14,lineHeight:"120%"},phoneContainer:{display:"flex",alignItems:"center",padding:"4px 16px",boxShadow:`${e.regularDividerColor} 0px 1px 0px`,background:e.background.elevated,height:46}})),[]);return(0,O.jsxs)(W().Ay,{style:i?u.phoneContainer:u.container,onClick:n,children:[(0,O.jsx)(D().B6,{disabled:!0,icon:r,iconRecordCategory:c,isEmptyPage:l,size:o.device.isMobile?24:20,style:{marginInlineEnd:4}}),(0,O.jsx)(Q().A,{store:t})]})}var $=()=>n(419357),G=()=>n(711319);function J(e){const{state:t,focusInitial:n,defaultValue:o,onBlur:i,onKeyDown:r,style:a,inputComboboxProps:l}=e,c=(0,s().WS)(),u=(0,d().tz)(),p=u.formatMessage({defaultMessage:"Paste link or search pages",id:"selectionLinkButton.search.createNewLinkPlaceholder"}),k=u.formatMessage({defaultMessage:"Edit link or search pages",id:"selectionLinkButton.search.editLinkPlaceholder"}),f=!c||!t.showCreateIn,m=c?void 0:!t.showCreateIn&&t.focusLinkInput,g=(0,h().lR)(t)?k:p;return f?(0,O.jsx)($().Ay,{onFocus:h().Nd,placeholder:g,value:o||t.url,onChange:Y,onBlur:i,onKeyDown:r,focus:m,focusInitial:n,focusAfterAnimation:!0,preventCaptureArrowShortcuts:!0,style:a,...l}):null}function Y(e){const t=(0,h().t4)();t&&function(e,t){switch(e.type){case"text":return void G().A.setState({...e,url:t.target.value,focusLinkInput:!0});case"image":return void K().A.setState({...e,url:t.target.value,focusLinkInput:!0});default:(0,L().HB)(e)}}(t,e)}function Z(e){const{state:t,showPreview:n,store:o,inputComboboxProps:i}=e,r=(0,s().WS)(),a=(0,h().Hx)(t),l=(0,h().lR)(t);return n&&o?(0,O.jsx)(z,{store:o,onClick:h().Nd}):(0,O.jsx)(J,{state:t,onBlur:h().gZ,onKeyDown:X,defaultValue:n?a:void 0,style:l?void 0:{marginTop:6},focusInitial:!l||r&&"text"===t.type&&!t.focusTitleInput,inputComboboxProps:i})}function X(e){"Escape"===e.key&&(e.stopPropagation(),(0,h().OY)())}function ee(e){const{title:t,focus:n,defaultTitle:i}=e,r=(0,s().v3)(),a=(0,s().WS)(),[l,c]=(0,o.useState)(),u=(0,o.useRef)(!1),d=(0,o.useMemo)((()=>({environment:r,defaultTitle:i,setPlaceholder:c,hasTitleChanged:u})),[i,r]);return(0,o.useEffect)((()=>{const e=u.current;return()=>{e&&U().st(r)}}),[u,r]),(0,O.jsx)($().Ay,{focus:n,focusInitial:a,onFocus:ne,onBlur:()=>oe(d),onChange:e=>function(e,t){te(e.target.value,t)}(e,d),onKeyDown:e=>function(e,t){"Enter"!==e.key&&"Escape"!==e.key||(e.stopPropagation(),oe(t))}(e,d),value:l?"":t,placeholder:l,preventCaptureArrowShortcuts:!0,style:{paddingBottom:8}})}function te(e,t){const n=G().A.state;if(!n.open)return;const{editingToken:o,savedTextSelectionState:i}=n;if(!o)return;if(!e)return void G().A.setState({...n,title:""});const{environment:s,setPlaceholder:r,hasTitleChanged:a}=t;f().createAndCommit({userAction:"LinkMenu.updateTitle",environment:s,canUndo:!0,perform:t=>{const l=k().ar({environment:s,title:e,transaction:t,editingToken:o,savedTextSelectionState:i});l&&G().A.setState({...n,...l,title:e}),r(void 0),a.current=!0}})}function ne(){(0,h().zE)(!0)}function oe(e){!function(e){const t=G().A.state;if(!t.open)return;const{defaultTitle:n,setPlaceholder:o}=e;t.title||(te(n,e),o(n))}(e),(0,h().zE)(!1)}n(898992),n(581454),n(737550);var ie=()=>n(17022),se=()=>n(187174),re=()=>n(305390),ae=()=>n(825972),le=()=>n(106628),ce=()=>n(645873),ue=()=>n(62856);var de=()=>n(857437),pe=()=>n(252291),ke=()=>n(236262);function fe(e){const{state:t,onUnlink:n}=e,[i,r]=(0,de().$)(),l=(0,o.useMemo)((()=>(0,h().V8)(t)),[t]),c=(0,o.useMemo)((()=>(0,h().KX)(l)),[l]),p=function(e){const{state:t,inputUrl:n,query:i,handleLinkSelection:r}=e,{url:l}=t,c=(0,s().v3)(),u=(0,s().WS)(),p=(0,a().O$)(A().e),k=Boolean(l),f=(0,o.useMemo)((()=>{let e,o=!1;if(!n&&k)e=(0,O.jsx)(d().sA,{defaultMessage:"Type a complete URL to link",id:"selectionLinkButton.invalidUrl"}),o=!0;else{if(!n)return;if("notion"===n.type&&p)return;"web"===n.type?e=(0,O.jsx)(d().sA,{id:"selectionLinkButton.linkToWebPage",defaultMessage:"Link to web page"}):"notion"===n.type?e=(0,O.jsx)(d().sA,{id:"selectionLinkButton.linkToPage",defaultMessage:"Link to page"}):"other"===n.type?e=(0,O.jsx)(d().sA,{id:"selectionLinkButton.linkToURL",defaultMessage:"Link to URL"}):(0,L().HB)(n.type)}return{key:"link to url",action:()=>r(c,t,i,u),render:t=>(0,O.jsx)(R().A,{...t,title:l,caption:e,icon:(0,w().h)({width:16,paddingTop:4}),disabled:o})}}),[t,i,c,u,p,n,r,k,l]);return f}({state:t,inputUrl:c,query:l,handleLinkSelection:me}),k=function(e){const{state:t,inputUrl:n,query:i,additionalItem:r}=e,l="text"===t.type?t.editingToken:t.imageHyperlink,c=(0,h().lR)(t),p=function(e){const{state:t,inputUrl:n,query:i,handleLinkSelection:r,disableEmptyQueryResults:l}=e,c=(0,s().v3)(),p=(0,s().WS)(),[{online:k}]=(0,a().$y)(A().A),f=(0,o.useMemo)((()=>{var e;const n="text"===t.type?null===(e=(0,S().H)(t.savedTextSelectionState.multiSelection))||void 0===e?void 0:e.store:t.store;if(n&&n instanceof q().B)return n}),[t]),m=(0,ce().fJ)(le().T.searchActions),[{value:g,status:v}]=(0,se().Yb)((async()=>{if(!k||"resolved"!==m.status)return[];if(!i)return l?[]:ae().NK.state.map((e=>e.pageId));const e=m.value;return(await e.searchMentionablePages({nearBlock:f,environment:c,query:i,source:"mention_menu",limit:10})).map((e=>e.id))}),[i,f,c,k,l,m.status,m.value]),x=(0,ue().A)("resolved"===v,300,300),y=(0,o.useMemo)((()=>{if(n&&"notion"===n.type){const e="page"===n.notionPage.name?n.notionPage.blockId:n.notionPage.peekViewBlockId,t=g?j().FF(g,e):[];return[n,...t]}return g}),[g,n]);return(0,o.useMemo)((()=>{if(!y||0===y.length)return;if(n&&"web"===n.type&&n.url===i)return;const e=ie().e.withListenerIgnored(_().Z);if(!e)return;const o=t.url?5:3,s=(0,O.jsx)(d().sA,{id:"selectionLinkButton.linkToPage.linkToBlock",defaultMessage:"Link to block"}),a=(0,O.jsx)(d().sA,{defaultMessage:"Link to page",id:"selectionLinkButton.linkToPageSection.title"});return{items:(0,j().oE)(y.map(((n,o)=>{const{pageId:i,peekViewBlockId:a,scrollToBlockId:l,discussionId:k,collectionViewId:f}="object"==typeof n?{pageId:"page"===n.notionPage.name?n.notionPage.blockId:n.notionPage.peekViewBlockId,..."page"===n.notionPage.name?{scrollToBlockId:n.notionPage.scrollToBlockId,peekViewBlockId:n.notionPage.peekViewBlockId,discussionId:n.notionPage.discussionId,collectionViewId:n.notionPage.collectionViewId}:{scrollToBlockId:void 0,peekViewBlockId:void 0,discussionId:void 0,collectionViewId:void 0}}:{pageId:n,peekViewBlockId:void 0,scrollToBlockId:void 0,discussionId:void 0,collectionViewId:void 0};if(!i)return;const m=q().B.createChildStore(e,{table:P().ev,id:i});return{key:o,action:()=>{if("object"==typeof n){const e=(0,u().wv)({pageId:i,peekViewBlockId:a,peekMode:n.notionPage.peekMode,discussionId:k,collectionViewId:f,scrollToBlockId:l});r(c,t,e,p,m)}else r(c,t,(0,u().wv)({pageId:i}),p,m)},render:e=>{const t="object"==typeof n&&l;return(0,O.jsx)(re().A,{...e,store:m,caption:t?s:void 0,placeholder:x?(0,O.jsx)(d().sA,{id:"selectionLinkButton.linkToPage.unknownBlock",defaultMessage:"Unknown block"}):(0,O.jsx)(d().sA,{id:"selectionLinkButton.linkToPage.loading",defaultMessage:"Loading..."})})}}}))).slice(0,o),title:y.some((e=>Boolean("object"==typeof e&&"page"===e.notionPage.name&&e.notionPage.scrollToBlockId)))?s:a}}),[y,t,c,p,i,n,r,x])}({state:t,inputUrl:n,query:i,handleLinkSelection:me,disableEmptyQueryResults:c}),k=(0,o.useMemo)((()=>{if(p||r){return{key:"results",items:j().oE([...(null==p?void 0:p.items)||[],r]),render:e=>(0,O.jsx)(V().A,{...e,title:l||i?void 0:(0,O.jsx)(d().sA,{id:"selectionLinkButton.recents.title",defaultMessage:"Recents"})})}}}),[p,r,l,i]);return k}({state:t,inputUrl:c,query:l,additionalItem:p}),f=(0,h().Hx)(t),m=f&&(0,u().lX)({url:f,baseUrl:T().A.domainBaseUrl,publicDomainName:T().A.publicDomainName}),g=(0,a().K8)((()=>{if(!m)return;const e=(0,_().Z)();return e?q().B.createChildStore(e,{table:P().ev,id:m}):void 0}),[m]),v=function(e){const{state:t,url:n,isEmptyResults:i,pageStore:s,inputComboboxProps:r}=e,a=(0,o.useMemo)((()=>{let e=(0,O.jsx)(d().sA,{defaultMessage:"Page or URL",id:"selectionLinkButton.currentInfo.pageOrUrl"});const o=!t.focusLinkInput&&i;let a;return s?a={key:"link to page",action:()=>{},render:()=>(0,O.jsx)(Z,{state:t,showPreview:o,store:s,inputComboboxProps:r})}:n?a={key:"link to web",action:()=>{},render:()=>(0,O.jsx)(Z,{state:t,showPreview:!0,inputComboboxProps:r})}:(e=void 0,a={key:"create link",action:()=>{},render:()=>(0,O.jsx)(Z,{state:t,showPreview:o,inputComboboxProps:r})}),{key:"page or url",render:t=>(0,O.jsx)(V().A,{title:e,...t}),items:[a]}}),[t,n,i,s,r]);return a}({state:t,url:f,isEmptyResults:!Boolean(k),pageStore:g,inputComboboxProps:i}),x=function(e){const{state:t,url:n,pageStore:i}=e,s=(0,a().K8)((()=>i?C().q4_(i.getTitleValue()):void 0),[i]),r=(0,o.useMemo)((()=>{if("text"!==t.type)return;const{editingToken:e,title:o,focusTitleInput:i}=t;return e?{key:"link title",render:e=>(0,O.jsx)(V().A,{title:(0,O.jsx)(d().sA,{defaultMessage:"Link title",id:"selectionLinkButton.currentInfo.linkTitle"}),...e}),items:[{key:"update title",action:()=>{},render:()=>(0,O.jsx)(ee,{title:o,defaultTitle:s??n,focus:i})}]}:void 0}),[t,n,s]);return r}({state:t,url:f,pageStore:g}),y=function(e){const{state:t,onUnlink:n}=e,i=function(e){const{state:t,onUnlink:n}=e,i=(0,s().v3)();return(0,o.useMemo)((()=>{if((0,h().lR)(t))return{key:"unlink",action:()=>{n(i);const e=(0,h().Hx)(t);switch(t.type){case"text":U().Mi(i,{type:"remove_link",url:e});break;case"image":const n=e?(0,M().bk)(e):void 0;(0,b().u)({environment:i,event:{eventName:"image_hyperlink_action",eventProperties:{action:"remove_link",url_type:null!=n&&n.hostname?"external":"notion"}}});break;default:(0,L().HB)(t)}},render:e=>(0,O.jsx)(R().A,{...e,title:(0,O.jsx)(d().sA,{id:"selectionLinkButton.removeLink",defaultMessage:"Remove link"}),icon:(0,O.jsx)(pe().I,{icon:ke().trashIcon})})}}),[n,t,i])}({state:t,onUnlink:n}),r=(0,o.useMemo)((()=>{const e=j().oE([i]);if(0!==e.length)return{key:"link actions",render:e=>(0,O.jsx)(V().A,{topBorder:!0,...e}),items:e}}),[i]);return r}({state:t,onUnlink:n});let I,B;return k?(B=1,I=j().oE([v,k])):(B=void 0,I=j().oE([v,x,y])),{initialFocus:B,sections:I,comboboxProps:r}}function me(e,t,n,o,i){const s=(0,B().l)(n);if(!s)return;const r=(0,h().Hx)(t);if(f().createAndCommit({userAction:"LinkMenu.handleLinkSelection",environment:e,canUndo:!0,perform:n=>{switch(t.type){case"text":const{editingToken:r,savedTextSelectionState:a,title:l}=t;(0,F().k)(a.multiSelection)&&(i?E().Gf({environment:e,editorMode:"default",store:a.multiSelection.start.store,selection:{startIndex:a.multiSelection.start.index,endIndex:a.multiSelection.end.index},annotation:C().ld4(i.id,i.getSpaceId()),transaction:n,analyticsFrom:"block"}):E().yr({environment:e,store:a.multiSelection.start.store,tokens:[[s,[["a",s]]]],index:a.multiSelection.start.index,transaction:n}));const c=k().BK({environment:e,transaction:n,url:s,title:l,editingToken:r,savedTextSelectionState:a});c?(U().Mi(e,{type:"edit_link",url:s}),G().A.setState({...t,...c,url:"",focusLinkInput:!1,focusTitleInput:Boolean(o)})):(U().Mi(e,{type:"create_link",url:s}),G().A.reset());break;case"image":H().Uc({url:s,transaction:n}),K().A.reset()}}}),"image"===t.type){var a;const t=null!==(a=(0,M().bk)(s))&&void 0!==a&&a.hostname?"external":"notion";(0,b().u)({environment:e,event:{eventName:"image_hyperlink_action",eventProperties:{action:r?"edit_link":"create_link",url_type:t}}})}}var ge=()=>n(691298),ve=()=>n(963248),xe=()=>n(50764);const ye=330;function he(){const e=(0,a().K8)((()=>(0,h().t4)()),[]),t=(0,s().Y0)(),n=null==e?void 0:e.trapFocus,i=(0,a().K8)((()=>!e||function(e){switch(e.type){case"text":return k().GC();case"image":return!e.open;default:(0,L().HB)(e)}}(e)),[e]);(0,o.useEffect)((()=>{e&&i&&function(e){switch(e){case"text":return void k().d();case"image":return void H().J6();default:(0,L().HB)(e)}}(e.type)}),[i,e]);const r=function(e){if(e)switch(e.type){case"text":return{onClose:k().d,onUnlink:k().sp};case"image":return{onClose:H().J6,onUnlink:H().PA};default:(0,L().HB)(e)}}(e);return r&&e?(0,O.jsx)(y().Ay,{popupType:t.isMobile?t.isTablet?c().n.Popup:c().n.SlideUp:c().n.Popup,style:{width:ye},keepFocus:t.isPhone,open:e.open,originRect:e.open?e.selectionRect:void 0,placementToOrigin:"bottom",alignmentToOrigin:"center",originGap:8,disableContentScroll:!0,onDismiss:r.onClose,render:()=>e.open?(0,O.jsx)(Ie,{state:e,onClose:r.onClose,onUnlink:r.onUnlink}):void 0,preventBlockRenderQueueOnEnter:!t.isMobile,trapFocus:n}):null}function Ie(e){const{state:t,onClose:n,onUnlink:r}=e,a=(0,s().WS)(),[u,p]=(0,o.useState)(!0);(0,o.useEffect)((()=>p(!1)),[]);const k=(0,o.useRef)(null);(0,o.useEffect)((()=>(k.current=document.createElement("input"),k.current.style.position="fixed",k.current.style.top="-9999px",k.current.style.left="-9999px",document.body.appendChild(k.current),()=>{k.current&&document.body.removeChild(k.current)})),[]);const f=a&&t.focusLinkInput&&("text"!==t.type||!t.focusTitleInput);(0,o.useEffect)((()=>{f&&i().default.afterNextFlush((()=>{k.current&&k.current.focus()}))}),[f]);const v=(0,o.useCallback)((()=>{i().default.afterNextFlush((()=>{k.current&&document.activeElement===k.current&&k.current.blur()}))}),[]);if((0,ge().A)({shouldPreserveTextSelection:f,shouldPreserveBlockSelection:!0,shouldRestoreSelection:!0,onClearSelection:v}),t.showCreateIn&&!a)return(0,O.jsx)(be,{state:t});let S;return S=a?{menuType:I().gu.Modal,title:(0,O.jsx)(d().sA,{defaultMessage:"Link",id:"selectionLinkButton.mobile.title"}),right:(0,O.jsx)(x().CancelMenuText,{}),onClickRight:n,footer:(0,O.jsx)(y().Ay,{popupType:c().n.SlideUp,open:t.showCreateIn||!1,render:()=>(0,O.jsx)(be,{state:t})})}:{menuType:I().gu.Popup},(0,O.jsxs)(m().A,{debugName:"LinkMenu",capture:t.open&&(u||t.focusLinkInput||"text"===t.type&&t.focusTitleInput),allowEsc:!0,children:[(0,O.jsx)(g().A,{...S,children:(0,O.jsx)(Se,{state:t,onUnlink:r})}),(0,O.jsx)(l().N,{debugName:"LinkMenu",capture:!0,onCommandSlash:h().Nd})]})}function Se(e){const{state:t,onUnlink:n}=e,{initialFocus:o,sections:i,comboboxProps:s}=fe({state:t,onUnlink:n});return(0,O.jsx)(v().Ay,{type:v().Oh.Vertical,initialFocus:o,sections:i,comboboxProps:s})}function be(e){var t,n;const{state:i}=e,a=(0,s().v3)(),l=null===(t=(0,r().S)())||void 0===t?void 0:t.spaceStore,c=(0,o.useCallback)((async e=>{var t;if(!(0,xe().E)(a))return;const n="text"===i.type?null===(t=(0,S().H)(i.savedTextSelectionState.multiSelection))||void 0===t?void 0:t.store:void 0;if(!n)return;const{performResult:{createInState:o}}=await f().createAndCommitAsync({environment:a,userAction:"LinkMenu.LinkCreateInMenu",waitForServerCommit:!0,perform:async t=>{const o=p().oj({environment:a,transaction:t,titleText:i.url||"",createInValue:e,recordStoreParentStore:n}),[s]=o.createdPages;return s&&"text"===i.type&&(k().BK({environment:a,url:(0,u().wv)({pageId:s.id}),transaction:t,editingToken:i.editingToken,savedTextSelectionState:i.savedTextSelectionState}),G().A.reset()),await o.moveToStorePromise,{createInState:o}}});await p().nT({analyticsFrom:"link_menu",createInState:o,spaceStore:l})}),[i,a,l]),d="text"===i.type?null===(n=(0,S().H)(i.savedTextSelectionState.multiSelection))||void 0===n?void 0:n.store:void 0,m=d&&"block"===d.table?d.id:void 0;return(0,O.jsx)(ve().v8,{blocksToMove:[],isAddTo:!0,isCreateIn:!0,onAccept:c,parentBlockId:m,onAutocompleteQueryChange:Te,autocompleteQuery:i.createInQuery||"",desktopWidth:ye,onCancel:Ae})}function Te(e){const t=G().A.state;t.open&&G().A.setState({...t,createInQuery:e})}function Ae(){const e=G().A.state;e.open&&G().A.setState({...e,showCreateIn:!1,createInQuery:""})}}}]);