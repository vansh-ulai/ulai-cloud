"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[29595],{4688:(e,t,n)=>{n.r(t),n.d(t,{arrowStraightUpSmallIcon:()=>o,iconDefinition:()=>r});n(296540);const r={viewBox:"0 0 16 16",fittedViewBox:"3.05 2.12 9.9 11.76",svg:(0,n(474848).jsx)("path",{d:"M8.442 2.308a.625.625 0 0 0-.884 0l-4.32 4.32a.625.625 0 0 0 .884.884l3.253-3.253v9.017c0 .334.283.599.625.599a.61.61 0 0 0 .625-.599V4.26l3.253 3.253a.625.625 0 0 0 .884-.884z"})},o=(0,n(340498).wt)("arrowStraightUpSmall",r)},33642:(e,t,n)=>{n.d(t,{YL:()=>o,qO:()=>r});const r=10,o=10},36951:(e,t,n)=>{n.d(t,{Iu:()=>_,NC:()=>P,VK:()=>N,YM:()=>R,createAndNavigateToInferenceTranscriptWithConfig:()=>E,eS:()=>O,xh:()=>B});n(16280),n(898992),n(354520),n(737550);var r=()=>n(370657),o=()=>n(386164),i=()=>n(651784),a=()=>n(427704),s=()=>n(155792),l=()=>n(201980),d=()=>n(530199),c=()=>n(532659),u=()=>n(498212),p=()=>n(534177),m=()=>n(939768),h=()=>n(559506),g=()=>n(24962),f=()=>n(450294),y=()=>n(354785),v=()=>n(577142),b=()=>n(260488),x=()=>n(890754),S=()=>n(594794),w=()=>n(765957),k=()=>n(122058),I=()=>n(177097),T=()=>n(844317),M=()=>n(46986),C=()=>n(555102),j=()=>n(166442),A=()=>n(107527);async function B(e){var t;const{environment:n,clientStore:i,message:a,configs:d}=e,p=w().default.state.sidebarSpaceStore;if(!p)throw new Error("No current space store");const m=null===(t=n.currentUser)||void 0===t?void 0:t.id;if(!m)throw new Error("No current user");if((0,l().q4_)(a).trim().length<6)return;const g=d.filter((e=>r()._z.includes(e.type))),f=await h().callStreamApi({eventName:"runInferenceTranscript",environment:n,data:{transcript:[{id:(0,S().Z1)({environment:n,table:s().mS,spaceId:p.id}),type:"config",value:{type:"route-inference-transcript",configs:g}},{id:(0,S().Z1)({environment:n,table:s().mS,spaceId:p.id}),type:"user",value:a,userId:m}],traceId:(0,u().Ay)(),spaceId:p.id,generateTitle:!1},headers:(0,o().WS)({spaceId:p.id})});if("failed"===f.type)throw f.error;if(c().hS.is(f.data))for await(const r of f.data)if("config"===r.type)i.state.userSelectedConfig||i.setState({...i.state,configForNewTranscripts:r.value});else if("error"===r.type)throw r.message}function N(e){var t;const{environment:n,oldThreadStore:r,newThreadStore:o,openUsingQuickSearchHandler:i,openInNewTab:a,createdSource:s,resetLocalThreadStore:l,isAgent:d}=e,c=(null==o?void 0:o.id)||(d?x().NEW_CHAT_THREAD_ID:void 0),u=null==o?void 0:o.getConfig();if("search"===(null==u?void 0:u.type)&&(0,k().By)({sessionId:void 0,searchSessionId:u.searchSessionId,threadId:c,environment:n,createdSource:s}),c&&"researcher"===(null==u?void 0:u.type)){((null==o?void 0:o.getTranscript())||[]).some((e=>"researcher-report"===e.type))&&y().MU({environment:n,researchModeThreadId:c,source:"chat_history"})}const p=n.device.isElectron,m=P({environment:n,threadId:c,spaceId:null===(t=w().default.state)||void 0===t||null===(t=t.sidebarSpaceStore)||void 0===t?void 0:t.id,config:null==r?void 0:r.getConfig()});if(p&&(null==l||l()),!i||!p)return a&&p?((0,g().B)({makeTabActive:!0,url:m,position:"end",openInNew:"tab",environment:n}),void b().st({environment:n,reset:!1})):void(0,v().navigate)({environment:n,url:m,...a?{openInNew:"tab",makeTabActive:!1}:{}});(0,f().N)(m)}function _(e){const{environment:t,query:n,clientStore:r,config:o,additionalSteps:i=[],openInNewTab:a,openUsingQuickSearchHandler:s,surface:l,suggestedPrompt:d}=e,c=C().bX.state;if(!c)throw new Error("No inference context");const{spaceStore:u,userStore:p}=c;(0,A().Wq)({clientStore:r,environment:t});const m=o.type;if(a&&"search"===m)return void function(e){var t;const{environment:n,config:r,query:o,openUsingQuickSearchHandler:i}=e,a=n.device.isElectron,s=!0,l=P({environment:n,threadId:void 0,spaceId:null===(t=w().default.state)||void 0===t||null===(t=t.sidebarSpaceStore)||void 0===t?void 0:t.id,config:r,query:o,forceRouteToChat:s});if(i&&a)return void(0,f().N)(l);if(a)return(0,g().B)({makeTabActive:!0,url:l,position:"end",openInNew:"tab",environment:n}),void b().st({environment:n,reset:!1});(0,v().navigate)({environment:n,url:l,openInNew:"tab",makeTabActive:!1})}({environment:t,config:o,query:n,openUsingQuickSearchHandler:s});const h=(0,C().Kf)({environment:t,spaceStore:u,userStore:p,value:n}),y=(0,M().re)();if("workflow"!==o.type||y){const e=(0,C().Xd)({environment:t,config:o,inferenceContext:c,addSteps:[...i,h],surface:l}),n=(0,I().addTranscriptToNewThreadOnClientAndRun)({environment:t,spaceStore:u,clientStore:r,userStore:p,transcript:e,analyticsArgs:{suggestedPrompt:d}});return N({environment:t,oldThreadStore:void 0,newThreadStore:n,openInNewTab:a,openUsingQuickSearchHandler:s}),n}(0,I().createEmptyWorkflowContainerAndBuild)({environment:t,parentStore:u,userStep:h})}function R(e){const{spaceId:t,searchScopes:n}=e;if((0,M().re)()){var r;const e=t?(null===(r=j().UserChatPreferenceLocalStorageStore.getState())||void 0===r?void 0:r[t])??{}:{},{webEnabled:o,model:i}=e;return(0,T().n)({searchScopes:n,...void 0!==o&&{useWebSearch:o},model:i})}return{type:"search",scopeForNextSearch:{type:"everything"}}}function P(e){const{environment:t,threadId:n,spaceId:r,config:o,query:s,forceRouteToChat:l}=e,c=t.device.isElectron,p={};n&&(p[d().P5]=(0,u().Xw)(n)),c&&r&&(p.spaceId=r),s&&(p[d().ah]=encodeURIComponent(JSON.stringify(s)));const h=n&&n!==x().NEW_CHAT_THREAD_ID;if(!h){let e=R({spaceId:r});o&&(0,i().bD)(o.type)&&(e=o),p[d().q8]=encodeURIComponent(JSON.stringify(e))}return h||l?(0,m().Gm)({url:a().JZ.chat,query:p}):(0,m().Gm)({url:a().JZ.ai,query:p})}function E(e){const{environment:t,config:n,query:r,surface:o="search_modal"}=e,i=C().bX.state;if(!i)throw new Error("No inference context");const{spaceStore:a,userStore:s}=i,l=(0,C().Kf)({environment:t,spaceStore:a,userStore:s,value:r}),d=(0,C().Xd)({environment:t,inferenceContext:i,config:n,addSteps:[l],surface:o});N({environment:t,newThreadStore:(0,I().addTranscriptToNewThreadOnClientAndRun)({environment:t,spaceStore:a,clientStore:j().defaultClientAIChatStore,userStore:s,transcript:d}),oldThreadStore:void 0})}const D=["workflow","researcher","markdown-chat"];function O(e){const{config:t,agentEnabled:n}=e;return!t||(!n||(r=t.type,(0,p().Xk)(D,r)));var r}},43972:(e,t,n)=>{n.d(t,{w:()=>l});n(296540);var r=()=>n(764880),o=()=>n(534177),i=()=>n(256863),a=()=>n(453697),s=n(474848);function l(e){const{actor:t}=e,n={size:e.size??14,style:{marginInlineEnd:2,...e.style}};return(0,r().H3)(t)?(0,s.jsx)(i().A,{botValue:t.asActor,...n}):(0,r().ps)(t)?(0,s.jsx)(a().A,{userValue:t.asActor,...n}):(0,r().h2)(t)?(0,s.jsx)(a().A,{userValue:void 0,...n}):void(0,o().HB)(t)}},46497:(e,t,n)=>{n.d(t,{y:()=>o});var r=()=>n(44551);function o(){var e;null===r().electronApi||void 0===r().electronApi||null===(e=r().electronApi.closeQuickSearch)||void 0===e||e.call(r().electronApi)}},51367:(e,t,n)=>{n.d(t,{Cu:()=>p,DL:()=>a,Jb:()=>d,Sq:()=>l,Y5:()=>s,gc:()=>u,wo:()=>c});var r=()=>n(564884),o=()=>n(242422),i=()=>n(917629);function a(e,t){const n=(0,i().h2)(t.callout_key);n&&(t.placement_key=(0,i().t9)(n)),(0,r().u)({environment:e,event:{eventName:"callout_show",eventProperties:{...t,callout_src:n?"static":"cio"}}}),o().default.logEvent("callout_show",t.callout_key)}function s(e,t){const n=(0,i().h2)(t.callout_key);n&&(t.placement_key=(0,i().t9)(n)),(0,r().u)({environment:e,event:{eventName:"callout_click",eventProperties:{...t,callout_src:n?"static":"cio"}}}),o().default.logEvent("callout_click",t.callout_key)}function l(e,t){const n=(0,i().h2)(t.callout_key);n&&(t.placement_key=(0,i().t9)(n)),(0,r().u)({environment:e,event:{eventName:"callout_dismiss",eventProperties:{...t,callout_src:n?"static":"cio"}}}),o().default.logEvent("callout_dismiss",t.callout_key)}function d(e,t){const n=(0,i().h2)(t.callout_key);n&&(t.placement_key=(0,i().t9)(n)),(0,r().u)({environment:e,event:{eventName:"callout_engagement",eventProperties:{...t,callout_src:n?"static":"cio"}}})}function c(e,t){const{eligible_callouts:n,required_arg_timeout:o,required_args_run_duration:i,eligibility_timeouts:a,blocklist:s}=t;(0,r().u)({environment:e,event:{eventName:"callout_coordinator_resolved",eventProperties:{eligible_callouts:n,required_arg_timeout:o,required_args_run_duration:i,eligibility_timeouts:a,blocklist:s}}})}function u(e,t){(0,r().u)({environment:e,event:{eventName:"callout_feature_interaction",eventProperties:t}})}function p(e,t){(0,r().u)({environment:e,event:{eventName:"callout_skipped",eventProperties:t}})}},86771:(e,t,n)=>{n.d(t,{bF:()=>x});n(16280),n(18107),n(410838),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(967357);var r=n(296540),o=()=>n(484714),i=()=>n(56366),a=()=>n(401497),s=()=>n(493552),l=()=>n(529099),d=()=>n(134025),c=()=>n(201980),u=()=>n(69708),p=()=>n(534177),m=()=>n(231297),h=()=>n(36951),g=()=>n(555102),f=n(474848);let y;function v(e){const{query:t,searchFilters:a,searchResultsStore:s,searchSessionId:l}=e,d=(0,o().v3)(),u=r.useMemo((()=>n(166442).defaultClientAIChatStore),[]),m=(0,i().O$)(g().bX),[f,v]=(0,r.useState)(void 0),[x,S]=(0,r.useState)({type:"loading"}),w=(0,r.useCallback)((e=>{if(!e||0===e.length)return;if(!m)throw new Error("No current space");S({type:"recomputing"});const t=(0,g().Kf)({environment:d,spaceStore:m.spaceStore,userStore:m.userStore,value:e});(0,n(107527).Wq)({clientStore:u,environment:d});const r=(0,g().Xd)({environment:d,inferenceContext:m,config:{type:"search",scopeForNextSearch:{type:"everything"},searchSessionId:l,filtersForNextSearch:{ancestorsFilter:null==a?void 0:a.ancestors,createdByFilter:null==a?void 0:a.createdBy,teamspacesFilter:(0,n(245241).fg)(null==a?void 0:a.inTeams),titleOnlyFilter:null==a?void 0:a.navigableBlockContentOnly}},addSteps:[t],surface:"auto_stream"}),o=(0,n(177097).addTranscriptToNewThreadAndRun)({environment:d,spaceStore:m.spaceStore,transcript:r,createdSource:"auto_stream"});return y&&(u.getOrCreateClientAIChatThreadStore(y).resetState(),y=o.id),v(o),o}),[d,u,l,m,a]);(0,r.useEffect)((()=>{w((0,c().x9d)(t))}),[w,t]);const k=(0,r.useRef)(new Set),I=(0,r.useCallback)((({results:e,disambiguationKey:t})=>{s&&!k.current.has(t)&&(s.update((t=>({...t,universalResults:e}))),k.current.add(t))}),[s]);(0,i().K8)((()=>{if(!f)return;const e=f.getTranscript(),t=e.at(-1);if("search"!==(null==t?void 0:t.type)||"resultsComplete"!==t.status&&"resultsBlended"!==t.status)if("search-chat"===(null==t?void 0:t.type)){const n=e.findLast((e=>"search"===e.type&&("resultsComplete"===e.status||"resultsBlended"===e.status)));let r=0;for(const[,e]of(0,p().WP)((null==n?void 0:n.results)??{}))r+=(null==e?void 0:e.length)??0;S({type:"completed",searchChatResult:t.value,resultCount:r,traceId:t.traceId})}else{var n;const e=null===(n=u.getOrCreateClientAIChatThreadStore(f.id).state)||void 0===n?void 0:n.temporarySteps;if(!e)return;const t=e.findLast((e=>"search-chat"===e.type)),r=e.findLast((e=>"search"===e.type&&"resultsPartial"===e.status));r&&I({results:r.results,disambiguationKey:`partial-${r.id}`}),t&&S({type:"streaming",currentStreamResult:t.value,traceId:t.traceId})}else I({results:t.results,disambiguationKey:t.id})}),[u,f,I]);const T=(0,r.useCallback)((e=>{f&&m&&((0,h().VK)({environment:d,oldThreadStore:void 0,newThreadStore:f,createdSource:"auto_stream",openInNewTab:e.openInNewTab}),b({threadStore:f,environment:d,spaceId:m.spaceStore.id}))}),[d,f,m]),M=(0,r.useCallback)((e=>{if(!m)return;const t=w(e.query);t&&((0,h().VK)({environment:d,oldThreadStore:void 0,newThreadStore:t,createdSource:"auto_stream",openInNewTab:e.openInNewTab}),b({threadStore:t,environment:d,spaceId:m.spaceStore.id}))}),[d,w,m]);return{latestThreadState:x,navigateToThreadStore:T,navigateToFreshThreadWithQuery:M,analyticsData:(0,r.useMemo)((()=>({thread_id:null==f?void 0:f.id,search_session_id:l})),[l,null==f?void 0:f.id])}}function b(e){const{threadStore:t,environment:n,spaceId:r}=e;m().createAndCommit({userAction:"SearchAutoStreamResultsBox.setThreadToUnifiedFindCreationSource",environment:n,canUndo:!1,perform:e=>{m().applyOperation({store:t,operation:d().op.update({pointer:t.pointer,path:[],args:{space_id:r,created_source:"full_page_chat"}}),transaction:e})}})}const x=(0,r.forwardRef)((function(e,t){const{query:o,searchFilters:d,searchResultsStore:m,menuListItemProps:h,searchSessionId:g}=e,y=(0,a().IS)((e=>({autoStreamResultsBox:{paddingTop:8,paddingInlineEnd:4,paddingInlineStart:2,width:"100%"},loadingWrapper:{display:"flex",alignItems:"center",gap:6,borderRadius:6,paddingBottom:8},assistantFaceIcon:{height:20,width:20,fill:e.icon.primary},askAiText:{fontWeight:500,fontSize:14},resultHeader:{display:"flex",alignItems:"center",gap:6},answerContainer:{boxShadow:e.shadowXS,borderRadius:6,alignItems:"flex-start",minHeight:36,marginTop:2,marginBottom:2}})),[]),b=(0,i().K8)((()=>n(242422).default.getConfigKey("ai_auto_stream_config","debounceTimeMs")??1500),[]),x=(0,n(591779).lW)(o,b,((e,t)=>function(e,t){return e===t||!(!e||!t)&&e.trim()===t.trim()}(e,t))),{latestThreadState:I,navigateToThreadStore:T,navigateToFreshThreadWithQuery:M,analyticsData:C}=v({query:x,searchFilters:d,searchResultsStore:m,searchSessionId:g}),j=(0,r.useRef)(null),A=(0,r.useCallback)((e=>{const{openInNewTab:t}=e;x!==o?M({query:(0,c().x9d)(o),openInNewTab:t}):T({openInNewTab:t})}),[M,T,o,x]);(0,r.useImperativeHandle)(t,(()=>({navigateToThread:A})),[A]);const B=(0,r.useMemo)((()=>{const e=(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(n(895432).N,{styleKey:"Caption/Medium",animate:!0,colorVariant:"secondary",text:(0,f.jsx)(u().sA,{id:"SearchAutoStreamResultsBox.updatingStep",defaultMessage:"Thinking"})}),(0,f.jsx)(n(135221).A,{isTriColored:!0})]});switch(I.type){case"loading":return(0,f.jsxs)("div",{style:y.loadingWrapper,children:[(0,l().aiFaceIcon)(y.assistantFaceIcon),(0,f.jsx)("div",{style:y.askAiText,children:(0,f.jsx)(u().sA,{id:"SearchAutoStreamResultsBox.AskAI.loading",defaultMessage:"Ask AI —"})}),e]});case"recomputing":return(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{style:y.resultHeader,children:[(0,l().aiFaceIcon)(y.assistantFaceIcon),(0,f.jsx)("div",{style:y.askAiText,children:(0,f.jsx)(u().sA,{id:"SearchAutoStreamResultsBox.AskAI.streaming",defaultMessage:"Ask AI"})}),e]}),(0,f.jsx)(w,{alreadyStreamedAnswerContainerRef:j})]});case"streaming":return(0,f.jsxs)("div",{ref:j,children:[(0,f.jsxs)("div",{style:y.resultHeader,children:[(0,l().aiFaceIcon)(y.assistantFaceIcon),(0,f.jsx)("div",{style:y.askAiText,children:(0,f.jsx)(u().sA,{id:"SearchAutoStreamResultsBox.AskAI.streaming",defaultMessage:"Ask AI"})}),e]}),(0,f.jsx)(k,{streamingText:I.currentStreamResult,isFocused:h.focused,analyticsData:C,traceId:I.traceId})]},"answer");case"completed":return(0,f.jsxs)("div",{ref:j,children:[(0,f.jsxs)("div",{style:y.resultHeader,children:[(0,l().aiFaceIcon)(y.assistantFaceIcon),(0,f.jsx)("div",{style:y.askAiText,children:(0,f.jsx)(u().sA,{id:"SearchAutoStreamResultsBox.AskAI.query",defaultMessage:"Ask AI"})}),(0,f.jsx)(n(90546).O,{marginLeftOverride:4}),(0,f.jsx)(s().D,{styleKey:"Caption/Regular",colorVariant:"tertiary",children:(0,f.jsx)(u().sA,{defaultMessage:"— {resultCount, plural, one {{resultCount} result} other {{resultCount} results}}",id:"SearchAutoStreamResultsBox.AskAI.resultCount",values:{resultCount:I.resultCount}})})]}),(0,f.jsx)(k,{streamingText:I.searchChatResult,isFocused:h.focused,analyticsData:C,traceId:I.traceId})]},"answer");default:(0,p().HB)(I)}}),[C,I,h.focused,y]);return(0,f.jsx)(n(760217).A,{style:"recomputing"===I.type||"streaming"===I.type||"completed"===I.type?y.answerContainer:void 0,textWrapperStyle:y.autoStreamResultsBox,...h,title:B,right:(0,f.jsx)(S,{focused:h.focused})})}));function S(e){const{focused:t}=e,r=(0,a().IS)((e=>({right:{display:"flex",opacity:t?1:0,marginTop:8},rightContentWrapper:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center"},rightIcon:{height:14,width:14,fill:e.icon.tertiary,marginInlineEnd:6,marginTop:2}})),[t]);return(0,f.jsx)("div",{style:r.right,children:(0,f.jsxs)("div",{style:r.rightContentWrapper,children:[(0,f.jsx)("div",{style:{marginInlineEnd:4},children:(0,f.jsx)(s().D,{styleKey:"Caption/Regular",colorVariant:"tertiary",children:(0,f.jsx)(u().sA,{defaultMessage:"Open",id:"SearchAutoStreamResultsBox.AskAI.open"})})}),(0,n(968610).arrowTurnDownLeftFillSmallIcon)(r.rightIcon)]})})}function w(e){const{alreadyStreamedAnswerContainerRef:t}=e,o=(0,r.useMemo)((()=>{if(null==t||!t.current)return;const e=t.current.getBoundingClientRect().height-20,n=Math.max(1,Math.ceil(e/30)),r=[];return n>8?(r.push({lineHeight:20,lineMargin:5,sectionWidths:[100],repeat:5,sectionMargin:10}),r.push({lineHeight:20,lineMargin:5,sectionWidths:[85],repeat:Math.min(5,n-5),sectionMargin:10}),n>10&&r.push({lineHeight:20,lineMargin:5,sectionWidths:[70],repeat:n-10,sectionMargin:10})):r.push({lineHeight:20,lineMargin:5,sectionWidths:[100],repeat:n,sectionMargin:10}),r}),[t]);return null!==t.current&&o?(0,f.jsx)(n(298697).A,{paragraphs:o}):null}function k(e){const{streamingText:t}=e,i=r.useRef(null),s=r.useRef(null),[l,d]=(0,r.useState)(!1);(0,r.useEffect)((()=>{if(!l&&s.current&&i.current){s.current.scrollHeight>92&&d(!0)}}),[t,l]);const c=(0,o().v3)();(0,r.useEffect)((()=>{e.analyticsData.thread_id&&(0,n(564884).u)({environment:c,event:{eventName:"answer_stream_first_char_rendered",eventProperties:{...e.analyticsData,trace_id:e.traceId}}})}),[e.analyticsData,e.traceId,c]);const u=(0,a().IS)((e=>({containerStyle:{overflow:"hidden",position:"relative",marginTop:4,marginBottom:6,maxHeight:92,...l?{maskImage:"linear-gradient(black calc(100% - 36px), transparent calc(100% - -6px))",WebkitMaskImage:"linear-gradient(black calc(100% - 36px), transparent calc(100% - -6px))"}:{}},textStyle:{fontSize:14,lineHeight:"20px",fontWeight:n(284371).Wy.medium}})),[l,92]),p=(0,r.useMemo)((()=>({type:"assistantChatText",text:t,inferenceId:"unused"})),[t]);return(0,f.jsx)("div",{style:{position:"relative"},children:(0,f.jsx)("div",{ref:i,style:u.containerStyle,children:(0,f.jsx)("div",{ref:s,style:u.textStyle,children:(0,f.jsx)(n(274981).c,{clientStep:p,disablePointerEvents:!0})})})})}},87529:(e,t,n)=>{n.d(t,{Bo:()=>r,Jq:()=>o,_9:()=>i,w_:()=>a});const r={"lastEdited.desc":"led","lastEdited.asc":"lea","created.desc":"ctd","created.asc":"cta"},o=(0,n(69708).YK)({bestMatches:{id:"search.sort.sortOrder.bestMatches",defaultMessage:"Best matches"},lastEditedNewestFirst:{id:"search.sort.sortOrder.lastEdited.newestFirst",defaultMessage:"Last edited: Newest first"},lastEditedOldestFirst:{id:"search.sort.sortOrder.lastEdited.oldestFirst",defaultMessage:"Last edited: Oldest first"},createdNewestFirst:{id:"search.sort.sortOrder.created.newestFirst",defaultMessage:"Created: Newest first"},createdOldestFirst:{id:"search.sort.sortOrder.created.oldestFirst",defaultMessage:"Created: Oldest first"}}),i=[{key:"lastEdited.desc",formattedName:o.lastEditedNewestFirst,sort:{field:"lastEdited",direction:"desc"}},{key:"lastEdited.asc",formattedName:o.lastEditedOldestFirst,sort:{field:"lastEdited",direction:"asc"}},{key:"created.desc",formattedName:o.createdNewestFirst,sort:{field:"created",direction:"desc"}},{key:"created.asc",formattedName:o.createdOldestFirst,sort:{field:"created",direction:"asc"}}],a=[{key:"relevance",formattedName:o.bestMatches,sort:{field:"relevance"}},...i]},90546:(e,t,n)=>{n.d(t,{O:()=>s});n(296540);var r=()=>n(56366),o=()=>n(805768),i=()=>n(604018),a=n(474848);function s(e){const{marginLeftOverride:t}=e,n=(0,r().K8)((()=>{const e=(0,i().wd)();return 0===e.length?["notion",...(0,i().kB)()]:["notion",...e]}),[]);return(0,a.jsx)("div",{style:{display:"flex",paddingTop:2,paddingBottom:2,marginInlineStart:t??8},children:(0,a.jsx)(o().hC,{connectors:n,maxBubbles:3,iconSize:12})})}},93723:(e,t,n)=>{function r(e){return e>=1e5?"100k-or-more":e>=5e4?"50k-100k":e>=1e4?"10k-50k":e>=5e3?"5k-10k":e>=1e3?"1k-5k":e>=500?"500-1k":e>=100?"100-500":e>=1?"1-100":"0"}n.d(t,{P:()=>r})},104556:(e,t,n)=>{n.d(t,{_:()=>o});n(296540);const r={viewBox:"0 0 20 20",fittedViewBox:"2.06 3.15 15.88 15.65",svg:(0,n(474848).jsx)("path",{d:"M7.793 18.678a1.91 1.91 0 0 0 2.33-.838l.348-.715c.177-.293.36-.658.535-1.005l.13-.257c.225-.442.431-.822.627-1.08l2.164-2.306h2.41a1.6 1.6 0 0 0 1.6-1.6V5.74a1.6 1.6 0 0 0-1.6-1.6H13.03l-1.227-.42-.021-.011a5.2 5.2 0 0 0-2.347-.553H5.126a1.844 1.844 0 0 0-1.78 2.32 1.84 1.84 0 0 0-.922 1.6c0 .284.067.547.18.78-.333.327-.54.782-.54 1.297 0 .429.145.817.388 1.124-.17.27-.272.592-.272.943 0 1.018.826 1.844 1.844 1.844h3.783c-.069.167-.15.33-.242.516v.001a6 6 0 0 0-.417 1.004v.002L6.64 16.36a1.913 1.913 0 0 0 1.144 2.315zm1.567-2.126-.345.71a.66.66 0 0 1-.781.247.66.66 0 0 1-.393-.804l.507-1.773v-.001c.08-.276.195-.512.336-.797l.014-.028c.134-.27.292-.59.408-.97a1.03 1.03 0 0 0-.988-1.323H4.023a.594.594 0 0 1-.593-.594.56.56 0 0 1 .27-.47.625.625 0 0 0-.066-1.086.56.56 0 0 1-.321-.511c0-.255.157-.467.398-.55a.625.625 0 0 0 .192-1.074.59.59 0 0 1-.23-.453c0-.334.263-.594.584-.594a.625.625 0 0 0 .452-1.057.594.594 0 0 1 .416-1.02h4.31c.593 0 1.17.13 1.703.381a.6.6 0 0 0 .161.083l1.424.488a.6.6 0 0 0 .202.033h.181v6.136l-2.275 2.425-.037.043c-.286.367-.547.86-.772 1.303l-.147.29c-.177.352-.334.665-.486.912zm4.846-5.324v-5.84h2.131a.35.35 0 0 1 .35.35v5.139a.35.35 0 0 1-.35.35z"})},o=(0,n(340498).wt)("handThumbsDown",r)},109158:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>o,notionFlatTintableIcon:()=>i});n(296540);var r=n(474848);const o={viewBox:"0 0 20 20",fittedViewBox:"1.5 1.49 17 17.01",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M12.475 11.304V6.65l-1.306-.25a.8.8 0 0 1 .152-.639q.21-.278.667-.278h2.738q.111.291-.014.528-.111.236-.43.375l-.446.208v7.809q-.39.18-.597.236a2 2 0 0 1-.514.056q-.417 0-.75-.195a2 2 0 0 1-.612-.597L7.542 8.497v4.864l1.39.25a.84.84 0 0 1-.153.653q-.208.277-.667.277-.292 0-.806-.013a35 35 0 0 0-.931-.014q-.361 0-.68.014-.306 0-.418.013a1 1 0 0 1-.056-.306q.001-.193.098-.36.112-.166.375-.264l.487-.195V6.538l-.875-.18q-.056-.375.152-.625t.667-.25H8.39z"}),(0,r.jsx)("path",{d:"M11.7 1.498c2.38 0 3.57 0 4.48.463.8.408 1.45 1.058 1.857 1.858.463.909.463 2.099.463 4.48v3.4c0 2.38 0 3.57-.463 4.479a4.25 4.25 0 0 1-1.857 1.857c-.91.464-2.1.463-4.48.463H8.3c-2.38 0-3.57 0-4.48-.463a4.25 4.25 0 0 1-1.857-1.857c-.463-.91-.463-2.1-.463-4.48v-3.4c0-2.38 0-3.57.463-4.48A4.25 4.25 0 0 1 3.82 1.962c.91-.463 2.1-.463 4.48-.463zM8.3 2.86c-1.213 0-2.04.001-2.68.053-.625.051-.95.144-1.182.261a2.9 2.9 0 0 0-1.262 1.263c-.118.23-.21.556-.261 1.18-.052.64-.054 1.469-.054 2.681v3.4c0 1.213.002 2.04.054 2.681.051.624.143.95.26 1.18a2.9 2.9 0 0 0 1.263 1.264c.231.117.557.21 1.181.26.64.053 1.468.054 2.68.054H11.7c1.213 0 2.04-.001 2.68-.054.625-.05.951-.143 1.181-.26.544-.277.986-.72 1.263-1.263.118-.23.21-.557.261-1.18.052-.641.054-1.469.054-2.682v-3.4c0-1.212-.002-2.04-.054-2.68-.051-.625-.143-.95-.26-1.181a2.9 2.9 0 0 0-1.263-1.263c-.231-.117-.557-.21-1.181-.26-.64-.053-1.468-.054-2.68-.054z"})]})},i=(0,n(340498).wt)("notionFlatTintable",o)},113474:(e,t,n)=>{n.d(t,{_:()=>c});n(296540);var r=()=>n(484714),o=()=>n(401497),i=()=>n(718827),a=()=>n(668725),s=()=>n(678553),l=()=>n(125565),d=n(474848);function c(e){const t=(0,o().DP)(),n=(0,r().v3)(),{device:c}=n;return(0,d.jsx)(i().Ay,{onClick:e.onClick,hovered:e.focused,disabled:e.disabled,style:{width:"100%",...!c.isMobile&&{borderRadius:6},...e.buttonStyle},hoveredStyle:e.hoveredButtonStyle,pressedStyle:e.pressedButtonStyle,children:(0,d.jsx)(s().Ay,{...e,dontShrinkTitle:!0,right:(0,d.jsxs)("div",{style:{display:"flex",whiteSpace:"nowrap"},children:[e.right?(0,d.jsx)(l().A,{isSecondaryColor:!0,isMobile:c.isMobile,children:e.right}):void 0,c.isMobile?void 0:(0,d.jsx)("div",{style:{flexShrink:0},children:(0,a().b)({width:10,marginInlineStart:4,fill:t.icon.tertiary,transform:"right"===e.chevronType?"rotate(-90deg)":void 0,transition:"transform 0.2s ease"})})]})})})}},160907:(e,t,n)=>{n.d(t,{f:()=>i});var r=()=>n(765957),o=()=>n(712505);function i(){if(o().default.state.open)return o().default.state.targetStore;return r().default.state.mainEditorCurrentBlockStore??r().default.state.sidebarSpaceStore}},187881:(e,t,n)=>{n.r(t),n.d(t,{eyeFillIcon:()=>i,iconDefinition:()=>o});n(296540);var r=n(474848);const o={viewBox:"0 0 20 20",fittedViewBox:"0.96 4.19 18.07 11.62",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M10 8.894a1.104 1.104 0 1 1-.003 2.207A1.104 1.104 0 0 1 10 8.894"}),(0,r.jsx)("path",{d:"M10 4.194c3.878 0 7.26 2.075 8.862 5.127l.073.163c.126.333.126.7 0 1.033l-.073.163c-1.602 3.052-4.984 5.126-8.862 5.126-3.757 0-7.049-1.946-8.707-4.843l-.156-.283a1.46 1.46 0 0 1 0-1.359l.156-.283C2.95 6.141 6.243 4.194 10 4.194m0 2.496a3.307 3.307 0 0 0-3.306 3.307l.004.17A3.307 3.307 0 0 0 9.83 13.3l.17.004a3.305 3.305 0 0 0 3.3-3.137l.005-.17a3.307 3.307 0 0 0-3.135-3.303z"})]})},i=(0,n(340498).wt)("eyeFill",o)},198427:(e,t,n)=>{n.d(t,{A:()=>a});n(296540);var r=()=>n(484714),o=()=>n(401497),i=n(474848);function a(){(0,r().v3)(),(0,o().IS)((e=>({container:{margin:"8px 16px",background:e.palette.yellow[100],borderRadius:8,height:"fit-content"}})),[]);return(0,i.jsx)(i.Fragment,{})}},199103:(e,t,n)=>{n.d(t,{H:()=>i});n(296540);var r=n(474848);const o={viewBox:"0 0 20 20",fittedViewBox:"4.12 2.37 11.75 15.25",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M9.134 5.001c-.236-.667-1.18-.667-1.415 0L6.28 9.084a.5.5 0 1 0 .943.332l.276-.784h1.857l.276.784a.5.5 0 0 0 .944-.332zm-.708 1.001.576 1.63h-1.15zM10.75 5a.5.5 0 0 0 0 1h2.5a.5.5 0 0 0 0-1zm.313 3a.5.5 0 0 1 .5-.5h1.687a.5.5 0 0 1 0 1h-1.687a.5.5 0 0 1-.5-.5M6.75 10.708a.5.5 0 0 0-.5.5v3.715a.5.5 0 0 0 .845.362l1.101-1.05a.25.25 0 0 1 .347.003l.675.657a.5.5 0 0 0 .734-.038l1.189-1.435a.25.25 0 0 1 .375-.01l1.368 1.467a.5.5 0 0 0 .866-.341v-3.33a.5.5 0 0 0-.5-.5zm2.554 2.435a.696.696 0 1 1 0-1.393.696.696 0 0 1 0 1.393"}),(0,r.jsx)("path",{d:"M6.25 2.375A2.125 2.125 0 0 0 4.125 4.5v11c0 1.174.951 2.125 2.125 2.125h7.5a2.125 2.125 0 0 0 2.125-2.125v-11a2.125 2.125 0 0 0-2.125-2.125zM5.375 4.5c0-.483.392-.875.875-.875h7.5c.483 0 .875.392.875.875v11a.875.875 0 0 1-.875.875h-7.5a.875.875 0 0 1-.875-.875z"})]})},i=(0,n(340498).wt)("docRichText",o)},224503:(e,t,n)=>{n.r(t),n.d(t,{browserAddIcon:()=>i,iconDefinition:()=>o});n(296540);var r=n(474848);const o={viewBox:"0 0 20 20",fittedViewBox:"-0.01 4.12 17.63 14.63",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M2.375 6.25c0-1.174.951-2.125 2.125-2.125h11c1.174 0 2.125.951 2.125 2.125v7.5a2.125 2.125 0 0 1-2.125 2.125H7.957a4.5 4.5 0 0 0 0-1.25H15.5a.875.875 0 0 0 .875-.875V7.5H3.625v3.252L3.5 10.75c-.388 0-.765.05-1.125.142zm2.258.184a.625.625 0 1 0 0-1.25.625.625 0 0 0 0 1.25m2.625-.625a.625.625 0 1 0-1.25 0 .625.625 0 0 0 1.25 0m1.375.625a.625.625 0 1 0 0-1.25.625.625 0 0 0 0 1.25"}),(0,r.jsx)("path",{d:"M7 15.25q-.001.32-.056.625A3.501 3.501 0 1 1 3.5 11.75h.011l.114.002A3.5 3.5 0 0 1 7 15.25m-6.125 0c0 .345.28.625.625.625h1.375v1.375a.625.625 0 1 0 1.25 0v-1.375H5.5a.625.625 0 1 0 0-1.25H4.125V13.25a.625.625 0 1 0-1.25 0v1.375H1.5a.625.625 0 0 0-.625.625"})]})},i=(0,n(340498).wt)("browserAdd",o)},230510:(e,t,n)=>{n.d(t,{P:()=>r});const r=(0,n(340498).xh)("openAi",{default:{loader:()=>n.e(77375).then(n.bind(n,89116))},darkMode:{loader:()=>n.e(77375).then(n.bind(n,457784))}})},251383:(e,t,n)=>{n.d(t,{V:()=>a});var r=()=>n(943290),o=()=>n(295169),i=()=>n(358579);function a(e){const{environment:t,sessionId:n,operationIds:a,useCrdt:s}=e,l=o().default.getSessionContextOrThrow(n);l.caches.clear();const d=l.clearUncommittedOperations({onlyClearOperationIds:a}),c=0===l.uncommittedExecutableOperations.length,u=(0,r().iL)(d);for(const r of d)"addBlockToPage"===r.command&&l.evaluator.state.unmarkPageAsLoaded(r.blockNode.attributes.id);return(0,i().Z)({environment:t,sessionContext:l,useCrdt:s}),{allEditsRejected:c,editGroupsThatWereRejected:u}}},253447:(e,t,n)=>{n.d(t,{F:()=>o});var r=()=>n(963575);function o(e,t){if(e)return e;switch(t){case"large":return r().A.card.desktop.large.height;case"small":return r().A.card.desktop.small.height;default:return r().A.card.desktop.medium.height}}},271232:(e,t,n)=>{n.d(t,{t:()=>i});var r=n(296540),o=n(474848);const i=r.memo((function(e){const{coverHeight:t,coverSizeFormat:r,emptyGalleryCoverStyle:i}=e,a=(0,n(401497).IS)((()=>({container:{height:(0,n(253447).F)(t,r),...i}})),[t,r,i]);return(0,o.jsx)("div",{style:a.container})}))},274981:(e,t,n)=>{n.d(t,{c:()=>f});n(16280);var r=n(296540),o=()=>n(17022),i=()=>n(221844),a=()=>n(484714),s=()=>n(510818),l=()=>n(884107),d=()=>n(231297),c=()=>n(108184),u=()=>n(485601),p=()=>n(919980),m=()=>n(659602),h=()=>n(645873),g=n(474848);function f(e){const{clientStep:t,disablePointerEvents:n}=e,f=(0,a().v3)(),{value:y}=(0,h().fJ)(m().g),{value:v}=(0,h().fJ)(l().R.clipboardActions),b=(0,r.useMemo)((()=>y&&v?o().e.withListenerIgnored((()=>function(e){const{environment:t,clientStep:n,clipboardActions:r,markdownLinkifyIt:o}=e,a=new(i().A)({name:"AssistantChatMessageListRenderer"}),l=d().createAndCommit({userAction:"AssistantChatMessageRenderer.temporaryListStoreForClientChatTextStep",environment:t,canUndo:!1,perform:e=>{const l=function(e){const{environment:t,clientStep:n,clipboardActions:r,transaction:o,markdownLinkifyIt:a}=e,l=new(i().A)({name:"AssistantChatMessageRenderer",isSyntheticAssistantData:!0}),c=t.currentUser.id;if(!c)throw new Error("No current user.");const u=e=>{const o=r.markdownToBlocks({environment:t,text:(0,s().e_)(n.text),transaction:e,inMemoryRecordCache:l,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:void 0});if(!o)return[];for(const t of o)l.setModelAndRole({pointer:t.pointer,userId:c},t.getModel(),"reader");return o};l.addCacheFallback(t.defaultRecordCache.inMemoryRecordCache);const p=d().createAndCommitOrAppend({userAction:"AssistantChatMessageRenderer.temporaryBlockStoresForClientChatTextStep",transaction:o,environment:t,perform:u,canUndo:!1});return p}({environment:t,clientStep:n,clipboardActions:r,transaction:e,markdownLinkifyIt:o});return c().wrapTemporaryBlocksInList({environment:t,stores:l,inMemoryRecordCache:a,transaction:e})}}).performResult;return l}({environment:f,clientStep:t,clipboardActions:v,markdownLinkifyIt:y}))):void 0),[t,f,y,v]);return(0,g.jsx)(u().c,{displayName:"AssistantChatStepContent",disabled:!0,style:n?{pointerEvents:"none"}:void 0,children:b?(0,g.jsx)(p().A,{store:b,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0}):null})}},288466:(e,t,n)=>{n.d(t,{O:()=>o});class r extends(()=>n(757695))().Store{getInitialState(){return{currentState:"default",lastStepLoadingCompletionUnixEpochMs:-1/0,aiWindowLastSeenUnixEpochMs:-1/0}}setAssistantLastViewedTime(){this.setState({...this.state,aiWindowLastSeenUnixEpochMs:Date.now()})}}const o=new r;(0,n(852832).exposeDebugValue)("AssistantOriginElementStore",o)},298182:(e,t,n)=>{n.d(t,{B5:()=>d,CJ:()=>a,CO:()=>i,Sf:()=>u,md:()=>s,wb:()=>l});n(814603),n(147566),n(198721);var r=()=>n(939768);const o={dateRangeFilter:{everything:!0},excludeCreatedByFilter:{everything:!0},createdByFilter:{everything:!1,notion:!0},titleOnlyFilter:{everything:!1,notion:!0},ancestorsFilter:{everything:!1,notion:!0},teamspacesFilter:{everything:!1,notion:!0}};function i(e,t){const n=function(e){switch(e){case"notion":case"workspace":case"teamspace":case"page":case"collection":case"site":return"notion";case"slack":return"slack";case"google-drive":return"google-drive";case"github":return"github";case"jira":return"jira";case"helpdocs":return"helpdoc";case"web":return"webpage";default:return"all"}}(e);return o[t][n]||o[t].everything}function a(e,t){return!!e&&Boolean(o[t][e]||o[t].everything)}const s=(0,n(756005).xS)({page:!0,collection:!1,createPage:!1,user:!0,inviteUserToWorkspace:!1,inviteUserToPage:!1,date:!0,reminder:!1,bot:!1,group:!1,team:!0,heading:!1,templateVariable:!1,formulaContextVariable:!1,slackSpecialMention:!1,property:!1});function l(e){switch(e){case"pull-request":return"Pull Request";case"issue":return"Issue";case"code":return"Code";default:return null}}function d(e){if(!e)return e;let t=e;return t=t.replace(/<gzkNfoUU>/g,"§§HIGHLIGHT_START§§"),t=t.replace(/<\/gzkNfoUU>/g,"§§HIGHLIGHT_END§§"),t=t.replace(/<(.*?)\|([^>]*)>/g,((e,t,n)=>{try{return new URL(n),c(n)}catch{return n.length>0?n:t}})),t=t.replace(/<(\S+(?:\s+\S+)*)>/g,((e,t)=>{try{return new URL(t),c(t)}catch{return t}})),t=u(t),t=t.replace(/§§HIGHLIGHT_START§§/g,"<gzkNfoUU>"),t=t.replace(/§§HIGHLIGHT_END§§/g,"</gzkNfoUU>"),t=function(e){return e.replace(/&amp;/g,"&")}(t),t}function c(e){if(!e||""===e.trim()||e.trim().includes(" "))return e;const t=e.trim();let n=r().qg(t),o=n.host;if(n.protocol&&o||(n=r().qg(`http://${t}`),o=n.host),!o)return e;o=o.replace(/^www./i,"");const i=n.pathname||"",a=n.hash||"";if(i.length+a.length<=20)return`${o}${i}${a}`;const s=i+a;return`(${o}${s.slice(0,3)}…${s.slice(-3)})`}function u(e){let t=e;return t=t.replace(/(&gt;)/g,">"),t=t.replace(/(&lt;)/g,"<"),t}},298697:(e,t,n)=>{n.d(t,{A:()=>s});n(581454);var r=n(296540),o=()=>n(401497),i=()=>n(710149),a=n(474848);function s({paragraphs:e}){const t=(0,o().IS)((e=>({skeletonRect:{borderRadius:4,backgroundColor:e.lightDividerColor}})),[]),n=null==e?void 0:e.map(((e,n)=>{const o={height:e.lineHeight,marginTop:e.lineMargin,marginBottom:e.lineMargin},s={marginTop:e.sectionMargin,marginBottom:e.sectionMargin},l=[...Array(e.repeat||1)].map(((n,r)=>(0,a.jsx)("div",{style:s,children:e.sectionWidths.map(((e,n)=>(0,a.jsx)(i().A,{style:{...t.skeletonRect,...o,width:`${e}%`}},n)))},r)));return(0,a.jsxs)(r.Fragment,{children:[" ",l," "]},n)}));return(0,a.jsxs)(a.Fragment,{children:[" ",n," "]})}},305872:(e,t,n)=>{n.d(t,{H:()=>i});var r=()=>n(645873);const o=new(r().O2)("AdminReactJson",(async()=>Promise.all([n.e(29151),n.e(64038),n.e(83755)]).then(n.bind(n,291605)))),i=(0,r()._h)(o,(e=>e.AdminReactJson))},313948:(e,t,n)=>{n.d(t,{m:()=>R});var r=n(296540),o=()=>n(726637),i=()=>n(56366),a=()=>n(401497),s=()=>n(718827),l=()=>n(252291),d=()=>n(998531),c=()=>n(30537),u=()=>n(563884),p=()=>n(668725),m=()=>n(69708),h=()=>n(56394),g=()=>n(722872),f=()=>n(780865),y=()=>n(35394),v=()=>n(250484),b=()=>n(760217),x=()=>n(417392),S=()=>n(89924),w=()=>n(933117),k=()=>n(427711),I=()=>n(821879),T=()=>n(978625),M=()=>n(604995),C=()=>n(416504),j=()=>n(534177),A=n(474848);const B={today:(0,A.jsx)(m().sA,{defaultMessage:"Today",id:"searchDateFilter.quickActions.today.label"}),pastWeek:(0,A.jsx)(m().sA,{defaultMessage:"Last 7 days",id:"searchDateFilter.quickActions.last7Days.label"}),pastMonth:(0,A.jsx)(m().sA,{defaultMessage:"Last 30 days",id:"searchDateFilter.quickActions.last30Days.label"})};function N({date:e,onClick:t,onDismiss:n}){const r=(0,C().P)(),o=M().Ec(r),i=o;let a;const s=B[e];"today"===e?a=o:"pastWeek"===e?a=M().t0(r):"pastMonth"===e?a=M().ZG(r):(0,j().HB)(e);return(0,A.jsx)(b().A,{focused:!1,title:s,onClick:e=>{t({value:{starting:{type:"date",start_date:a.start_date},ending:{type:"date",start_date:i.start_date}}}),n(e)}})}var _=()=>n(806754);function R(e){const{initialValue:t,dateFilterType:n,onMenuDismiss:i,title:a,icon:s,disabled:l,onMenuOpen:d,dateFormat:c,mode:u,shouldAlsoUpdateSearchStore:p}=e,{current:m}=(0,r.useRef)(e.store??new(y().A)({initialDateRange:t,shouldAlsoUpdateSearchStore:p}));return(0,r.useEffect)((()=>{m.state.dateFilterType===n||m.update((e=>({...e,dateFilterType:n})))}),[n,m]),o().A.isMobile?(0,A.jsx)($,{onMenuDismiss:i,title:a,disabled:l,onMenuOpen:d,dateFormat:c,icon:s,store:m,mode:u}):(0,A.jsx)(W,{onMenuDismiss:i,title:a,disabled:l,onMenuOpen:d,icon:s,store:m})}function P(e){const{dateFilterType:t,nextState:n,store:r}=e;r.update((e=>({...e,temporaryDateRange:{...r.state.temporaryDateRange,...n},dateFilterType:t}))),r.state.shouldAlsoUpdateSearchStore&&v().Ay.updateFilters({[t]:n})}function E(e){return{lastEditedTime:(0,A.jsx)(m().sA,{id:"search.filterMenu.moreFilters.lastEdited",defaultMessage:"Last edited"}),createdTime:(0,A.jsx)(m().sA,{id:"search.filterMenu.moreFilters.created",defaultMessage:"Created"})}[e]}function D(){return(0,p().b)({width:10,height:10,...o().A.isMobile&&{marginTop:2}})}function O(e){e.preventDefault&&e.preventDefault()}function F(e,t,n){t||(n&&n(),e.setState({...e.state,isOpen:!0,focus:"starting"}))}function q(e,t,n){const{temporaryDateRange:r,dateFilterType:o}=t.state;f().a9(e)||(P({dateFilterType:o,nextState:r,store:t}),t.setState({...t.state,isOpen:!1}),n&&n())}function L(e){const{dateFilterType:t}=e.state;P({dateFilterType:t,nextState:{starting:void 0,ending:void 0},store:e}),e.clearTemporaryDateRange()}function K({store:e}){const t=(0,a().DP)(),n=(0,i().K8)((()=>e.state.dateFilterType),[e]),r=(0,i().K8)((()=>e.state.temporaryDateRange??{starting:void 0,ending:void 0}),[e]),l={width:190,items:["createdTime","lastEditedTime"],selectedItem:n,getKey:e=>e,onSelect:t=>function(e,t,n){const{dateFilterType:r}=n.state;P({dateFilterType:e,nextState:t,store:n}),e!==r&&(P({dateFilterType:r,nextState:{starting:void 0,ending:void 0},store:n}),n.setState({...n.state,dateFilterType:e}))}(t,r,e),renderItem:e=>(0,A.jsx)(b().A,{title:E(e.value),...e}),renderOrigin:e=>(0,A.jsx)(s().Ay,{...e,style:{paddingInlineStart:4,paddingInlineEnd:4,borderRadius:4,flexShrink:0},children:(0,A.jsxs)("div",{style:{display:"flex",alignItems:"center",...!o().A.isMobile&&{color:t.text.secondary,fill:t.icon.tertiary,fontWeight:500,fontSize:12,lineHeight:"16px"}},children:[(0,A.jsx)("span",{style:{marginInlineEnd:4},children:E(n)}),(0,A.jsx)(D,{})]})})};return(0,A.jsx)(w().A,{...l,menuTypeOverride:(0,g().PK)()})}function U({disabled:e,onMenuOpen:t,icon:n,title:o,store:i}){const s=(0,r.useCallback)((()=>F(i,e,t)),[i,e,t]),l=(0,a().IS)((()=>({icon:{height:14,width:14,fill:"currentColor"}})),[]);return(0,A.jsx)(b().A,{disabled:e,focused:!1,icon:n(l.icon),title:o,onClick:s})}function V({disabled:e,onMenuOpen:t,title:n,store:o,dateFormat:s}){const l=(0,m().tz)(),d=(0,r.useCallback)((()=>L(o)),[o]),c=(0,r.useCallback)((()=>F(o,e,t)),[o,e,t]),p=(0,i().K8)((()=>o.state.temporaryDateRange??{starting:void 0,ending:void 0}),[o]),h=(0,a().IS)((()=>({summary:{display:"inline-flex"},iconActiveMobile:{height:14,width:14,fill:"currentColor",marginTop:1,marginInlineEnd:6}})),[]),g=(0,A.jsxs)("div",{style:h.summary,children:[(0,u().k)(h.iconActiveMobile),f().tX(p,l,s)]});return(0,A.jsx)(T().A,{disabled:e,onClick:c,onClickClear:d,label:n,title:g})}function z({disabled:e,onMenuOpen:t,icon:n,title:o,store:s}){const d=(0,r.useCallback)((()=>F(s,e,t)),[s,e,t]),c=(0,a().IS)((()=>({pillIcon:{marginInlineEnd:6}})),[]),u=(0,i().K8)((()=>s.state.temporaryDateRange.starting),[s]);return(0,A.jsx)(h().A,{on:Boolean(u),icon:(0,A.jsx)(l().I,{icon:n,style:c.pillIcon}),title:(0,A.jsx)("span",{children:o}),onClick:d})}function H({onMenuDismiss:e,title:t,store:n}){const o=(0,i().K8)((()=>n.state.dateFilterType),[n]),l=(0,i().K8)((()=>n.state.temporaryDateRange),[n]),d=(0,r.useCallback)((t=>q(t,n,e)),[n,e]),c=(0,r.useCallback)((e=>{if(e.error)return;n.setState({...n.state,temporaryDateRange:{...l,...e.value}});const{starting:t,ending:r}=n.state.temporaryDateRange;t&&r&&P({dateFilterType:o,nextState:{starting:t,ending:r},store:n})}),[o,l,n]),u=(0,r.useCallback)((()=>L(n)),[n]),p=(0,a().IS)((e=>({dateFilterHeader:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",paddingTop:4,paddingInlineEnd:4,paddingBottom:2,paddingInlineStart:4},clearButton:{color:e.text.secondary,fill:e.icon.tertiary,fontWeight:500,fontSize:12,lineHeight:"16px",paddingInlineStart:4,paddingInlineEnd:4,borderRadius:4,flexShrink:0},showBottomDivider:{boxShadow:`0 1px 0 ${e.regularDividerColor}`}})),[]);return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(S().A,{children:(0,A.jsxs)("div",{style:p.dateFilterHeader,children:[(0,A.jsx)(K,{store:n}),(0,A.jsx)(s().Ay,{style:p.clearButton,onClick:u,children:(0,A.jsx)(m().sA,{defaultMessage:"Clear",id:"searchDateFilter.clearButton.label"})})]})}),(0,A.jsxs)(S().A,{style:p.showBottomDivider,children:[(0,A.jsx)(N,{date:"today",onClick:c,onDismiss:d}),(0,A.jsx)(N,{date:"pastWeek",onClick:c,onDismiss:d}),(0,A.jsx)(N,{date:"pastMonth",onClick:c,onDismiss:d})]}),(0,A.jsx)(k().A,{title:t,value:l,onUpdate:c,store:n,onDismiss:d,hideDateInputMenuItems:!0})]})}function W({onMenuDismiss:e,title:t,disabled:n,onMenuOpen:o,icon:s,store:l}){const u=(0,i().K8)((()=>l.state.isOpen),[l]),p=(0,r.useCallback)((t=>q(t,l,e)),[l,e]),m=(0,a().IS)((()=>({sectionMenuItem:{display:"flex"}})),[]);return(0,A.jsx)(_().A,{style:m.sectionMenuItem,children:(0,A.jsx)(d().N,{debugName:"SearchGenericDateFilter",capture:u,onUp:O,onDown:O,onEnter:O,children:(0,A.jsx)(x().Ay,{popupType:c().n.Popup,open:u,origin:(0,A.jsx)(z,{disabled:n,onMenuOpen:o,icon:s,title:t,store:l}),render:()=>(0,A.jsx)(H,{onMenuDismiss:e,title:t,store:l}),onDismiss:p,placementToOrigin:"bottom",alignmentToOrigin:"start",keepFocus:!0})})})}function $({mode:e,onMenuDismiss:t,title:n,disabled:o,onMenuOpen:a,dateFormat:s,icon:l,store:d}){const u=(0,r.useCallback)((e=>q(e,d,t)),[d,t]),p=(0,r.useCallback)((()=>(0,A.jsx)(H,{onMenuDismiss:t,title:n,store:d})),[t,n,d]),m=(0,i().K8)((()=>d.state.isOpen),[d]),h=e===I().C.Section?(0,A.jsx)(V,{disabled:o,onMenuOpen:a,title:n,store:d,dateFormat:s}):(0,A.jsx)(U,{disabled:o,onMenuOpen:a,icon:l,title:n,store:d});return(0,A.jsx)(x().Ay,{popupType:c().n.SlideUp,open:m,origin:h,render:p,onDismiss:u,preventScaleTransition:!0})}},320865:(e,t,n)=>{n.d(t,{A:()=>o});n(296540);var r=n(474848);const o=function(){return(0,r.jsx)(n(678553).Ay,{title:(0,r.jsx)(n(98126).k,{size:"default"}),titleStyle:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%"}})}},333603:(e,t,n)=>{n.d(t,{Y:()=>o});n(296540);const r={viewBox:"0 0 16 16",fittedViewBox:"3.05 4.97 9.9 5.58",svg:(0,n(474848).jsx)("path",{d:"M8.442 5.158a.625.625 0 0 0-.884 0l-4.32 4.32a.625.625 0 1 0 .884.884L8 6.484l3.878 3.878a.625.625 0 1 0 .884-.884z"})},o=(0,n(340498).wt)("arrowChevronSingleUpSmall",r)},339600:(e,t,n)=>{n.d(t,{Cy:()=>M,iK:()=>T,qT:()=>C});n(898992),n(354520),n(581454);var r=n(296540),o=()=>n(560198),i=()=>n(484714),a=()=>n(401497),s=()=>n(951105),l=()=>n(187881),d=()=>n(176412),c=()=>n(564613),u=()=>n(558842),p=()=>n(69708),m=()=>n(100622),h=()=>n(496603),g=()=>n(284371),f=()=>n(884107),y=()=>n(354584),v=()=>n(38337),b=()=>n(645873),x=()=>n(285790),S=()=>n(859428),w=()=>n(125565),k=n(474848);const I=(0,p().YK)({copyColor:{defaultMessage:"Copied ‘{stringValue}’",id:"uidoc.colors.copied"}});function T({children:e,style:t}){const n=(0,a().IS)((e=>({subheader:{fontSize:24,fontWeight:g().Wy.semibold,marginTop:36,marginBottom:8,lineHeight:1,...t}})),[t]);return(0,k.jsx)("div",{style:n.subheader,children:e})}function M({children:e,style:t,scrollContentRef:n}){const o=function(){const e=(0,i().v3)();return(0,r.useCallback)((async t=>{const n=t.length>_?`${t.slice(0,_)}...`:t;(await f().R.clipboardActions.load()).copyString({copiedMessage:{...I.copyColor,defaultMessage:`Copied '${n}'`},environment:e,stringValue:t})}),[e])}(),[l,d]=(0,r.useState)(!1),u=(0,r.useRef)(null),{value:m}=(0,b().fJ)(y().y),{renderChildren:g,githubUrl:v}=(0,r.useMemo)((()=>{if(R(e)){var t;const n=`https://github.com/makenotion/notion-next/tree/main/${e.fileName}#L${(null===(t=e.start)||void 0===t?void 0:t.line)??"1"}`;return{renderChildren:(e.source&&function(e){const t=e.split("\n"),n=t.map((e=>{var t;return(null===(t=e.match(/^\s*/))||void 0===t?void 0:t[0])??""})).filter(((e,t)=>""!==e&&0!==t));if(0===n.length)return e;const r=h().wq(n,(e=>e.length));if(!r||0===r.length)return e;return t.map((e=>e.startsWith(r)?e.slice(r.length):e)).join("\n")}(e.source))??e.source??e.value,githubUrl:n}}return{renderChildren:e}}),[e]),S=(0,a().IS)((e=>({code:{fontSize:"80%",fontFamily:"monospace",color:e.text.primary,borderRadius:"0.25em",background:"rgba(135, 131, 120, 0.15)",padding:"0.2em 0.4em",position:"relative",tabSize:2,margin:0,...t},buttonBar:{position:"absolute",insetInlineEnd:2,top:2,display:"flex",gap:4},button:{width:"1.55em",height:"1.55em"}})),[t]);(0,r.useLayoutEffect)((()=>{var t;const n="string"==typeof e?e:null===(t=u.current)||void 0===t?void 0:t.innerText;if(m&&n&&u.current){const e="tsx",t=m.highlight(n,m.languages[e],e);u.current.innerHTML=t}}));const w=(0,p().tz)();return(0,k.jsxs)("pre",{onMouseEnter:()=>{d(!0)},onMouseLeave:()=>{d(!1)},style:S.code,ref:n,children:[(0,k.jsx)("div",{ref:u,children:g}),l?(0,k.jsxs)("div",{style:S.buttonBar,children:[v?(0,k.jsx)(x().A,{ariaLabel:w.formatMessage({id:"uidoc.code.openInGithub",defaultMessage:"Open in Github"}),style:S.button,hasBackground:!0,icon:c().gitHubIcon,showShadow:!0,href:v,external:!0}):void 0,(0,k.jsx)(x().A,{ariaLabel:w.formatMessage({id:"uidoc.code.copy",defaultMessage:"Copy code"}),style:S.button,hasBackground:!0,icon:s().k,showShadow:!0,onClick:()=>{o((null==g?void 0:g.toString())||"")}})]}):void 0]})}function C(e){const[t,n]=(0,r.useState)(!1),[o,i]=(0,r.useState)(e.showTransparency??!1),s=e.showTransparencyToggle??t,c=(0,a().IS)((()=>({container:{position:"relative"},toggleButton:{position:"absolute",top:16,insetInlineEnd:14}})),[]);return(0,k.jsxs)("div",{onMouseEnter:()=>{n(!0)},onMouseLeave:()=>{n(!1)},style:c.container,children:[(0,k.jsx)(j,{marginTopBottom:e.marginTopBottom,isInverted:e.isInverted,showTransparency:o,children:(0,k.jsx)(A,{showSize:e.showSize??t,showInsets:e.showInsets??t,insetSize:24,children:(0,k.jsx)(N,{isInverted:e.isInverted,children:e.children})})}),s?(0,k.jsx)("div",{style:c.toggleButton,children:(0,k.jsx)(S().A,{renderTooltip:()=>o?"Hide transparency":"Show transparency",render:e=>(0,k.jsx)(x().A,{...e,icon:o?d().L:l().eyeFillIcon,size:"sm",ariaLabel:"Toggle transparency",onClick:()=>i(!o),hasBackground:!0,showShadow:!0})})}):null]})}function j(e){const{marginTopBottom:t,showTransparency:n}=e,o=(0,a().DP)(),i=B(),s=e.isInverted?i:o,l=(0,r.useMemo)((()=>({borderRadius:4,overflow:"hidden",border:`1px solid ${s.regularDividerColor}`,background:n?`repeating-conic-gradient(${s.background.primary} 0 25%, ${s.background.tertiary} 0 50%) 50% / 20px 20px`:s.background.primary,marginTop:t??12,marginBottom:t??12,color:s.text.primary})),[s,n,t]);return(0,k.jsx)("div",{className:"dark"===s.mode?v().Rsl:v().fRh,style:l,children:e.children})}function A(e){const{showInsets:t,showSize:n,insetSize:o,children:i}=e,s=(0,r.useRef)(null),l=(0,a().IS)((e=>{const n=t?"rgba(255, 105, 180, 1)":"rgba(255, 105, 180, 0)",r=`1px dashed ${n}`,i=`${o}px`,a="all 0.1s ease-in-out",s={t:{borderBottom:r,transition:a},l:{borderInlineEnd:r,transition:a},r:{borderInlineStart:r,transition:a},b:{borderTop:r,transition:a,position:"relative"}};return{grid:{display:"grid",gridTemplateColumns:`${i} auto ${i}`,gridTemplateRows:`${i} auto ${i}`,...s.t,...s.l,...s.r,...s.b},...s,tl:{...s.t,...s.l},tr:{...s.t,...s.r},bl:{...s.b,...s.l},br:{...s.b,...s.r},c:{position:"relative"},insetText:{color:n,fontSize:10,paddingInlineStart:(o-10)/2,fontFamily:g().Tf.githubMono,lineHeight:i,maxHeight:o,transition:a,position:"absolute"}}}),[t,o]);return(0,k.jsxs)("div",{style:l.grid,children:[(0,k.jsx)("div",{style:l.tl}),(0,k.jsx)("div",{style:l.t}),(0,k.jsx)("div",{style:l.tr}),(0,k.jsx)("div",{style:l.l}),(0,k.jsx)("div",{style:l.c,ref:s,children:i}),(0,k.jsx)(S().A,{forceVisibleState:n??t,renderTooltip:()=>{var e;return`${null===(e=s.current)||void 0===e?void 0:e.getBoundingClientRect().height}px`},placement:"right",render:()=>(0,k.jsx)("div",{style:l.r})}),(0,k.jsx)("div",{style:l.bl}),(0,k.jsx)(S().A,{placement:"bottom",forceVisibleState:n??t,renderTooltip:()=>{var e;return`${null===(e=s.current)||void 0===e?void 0:e.getBoundingClientRect().width}px`},render:()=>(0,k.jsx)("div",{style:l.b,children:(0,k.jsx)(w().A,{style:l.insetText,children:`${o}px inset`})})}),(0,k.jsx)("div",{style:l.br})]})}function B(){const e=(0,a().eP)();return(0,m().O4)({theme:"light"===e?"dark":"light"})}function N({children:e,isInverted:t}){const{mode:n}=B();return t?(0,k.jsx)(o().wX,{mode:n,children:e}):(0,u().Du)(e)}const _=25;function R(e){return Boolean(e&&"object"==typeof e&&("isSourceMacroResult"in e||"value"in e&&"source"in e))}const P=(0,r.createContext)(!1);P.displayName="UIDocExpandAllCode"},358006:(e,t,n)=>{n.d(t,{z:()=>a});n(296540);var r=()=>n(645873),o=n(474848);const i=new(r().O2)("CollectionItemCover",(async()=>{const{CollectionItemCover:e}=await n.e(79883).then(n.bind(n,873718));return{CollectionItemCover:e}})),a=(0,r()._h)(i,(e=>e.CollectionItemCover),{renderLoading:(e,t)=>{const{coverHeight:r,coverSizeFormat:i,emptyGalleryCoverStyle:a,showEmptyGalleryCover:s}=t;return s?(0,o.jsx)(n(271232).t,{coverHeight:r,coverSizeFormat:i,emptyGalleryCoverStyle:a}):null}})},358579:(e,t,n)=>{n.d(t,{Z:()=>i});n(898992),n(430670);var r=()=>n(371621),o=()=>n(980382);function i(e){const{environment:t,sessionContext:n,useCrdt:i}=e,a=n.getAllPendingExecutableOperations();if(0===a.length)return;const s=a.flatMap((({operations:e})=>e));(0,r().gv)({environment:t,operations:s,caches:n.caches,attributionActor:n.attributionActor}),(0,o().I)({environment:t,assistantSessionContext:n,useCrdt:i})}},359941:(e,t,n)=>{n.d(t,{V:()=>a});var r=()=>n(56366),o=()=>n(646736),i=()=>n(981342);function a(e){const{spaceStore:t}=e,n=(0,o().nB)(t);return(0,r().K8)((()=>(0,i().MU)({spaceStore:t,actorRole:n})),[t,n])}},360457:(e,t,n)=>{n.d(t,{S:()=>m,g:()=>p});n(296540);var r=()=>n(401497),o=()=>n(699143),i=()=>n(406094),a=()=>n(493552),s=()=>n(66913),l=()=>n(69708),d=()=>n(285790),c=()=>n(559273),u=n(474848);const p=8;function m(e){const{title:t,body:n,button:m,imageUrl:h,onDismiss:g,badge:f}=e,y=(0,l().tz)(),v=(0,r().IS)((e=>({container:{backgroundColor:"transparent",margin:p,display:"flex"},card:{maxWidth:232,minWidth:232,borderRadius:12,border:`1px solid ${e.border.primary}`,boxShadow:"0px 12px 36px -6px rgba(29, 27, 22, 0.08)",position:"relative",backgroundColor:e.background.elevated},dismissButton:{position:"absolute",top:12,insetInlineEnd:12,width:24,height:24,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:12,background:e.background.elevated},dismissButtonHover:{background:e.whiteButtonHoveredBackground},image:{background:"white",borderStartStartRadius:12,borderStartEndRadius:12,alignSelf:"stretch",height:142,width:"100%",objectFit:"cover"},badge:{display:"flex",alignItems:"center",justifyContent:"center",height:16,padding:"0px 4px",gap:2,borderRadius:4,background:e.blue.background.secondaryTranslucent,width:"fit-content"}})),[]);return(0,u.jsx)("div",{style:v.container,children:(0,u.jsxs)(o().Y1,{direction:"vertical",style:v.card,children:[(0,u.jsx)(c().A,{src:h,style:v.image}),(0,u.jsxs)(o().Y1,{gap:6,padding:"12px 16px 12px 12px",children:["string"==typeof f?(0,u.jsx)("div",{style:v.badge,children:(0,u.jsx)(a().D,{styleKey:"Caption-sm/Medium",colorPalette:"blue",colorVariant:"accentPrimary",children:f})}):f,(0,u.jsx)(a().D,{styleKey:"Body/Semibold",colorVariant:"primary",children:t}),(0,u.jsx)(a().D,{styleKey:"Body/Regular",colorVariant:"secondary",children:n})]}),(0,u.jsx)(o().Y1,{padding:"0px 12px 12px 12px",children:(0,u.jsx)(i().A,{size:"md",onClick:()=>m.onClick(),children:(0,u.jsx)(a().D,{styleKey:"Body/Medium",colorVariant:"primary",children:m.text})})}),g?(0,u.jsx)(d().A,{ariaLabel:y.formatMessage({id:"dismiss.dismissButton.label",defaultMessage:"Dismiss"}),hoveredStyle:v.dismissButtonHover,icon:s().V,onClick:g,style:v.dismissButton}):void 0]})})}},371621:(e,t,n)=>{n.d(t,{BB:()=>N,CD:()=>P,_W:()=>_,gv:()=>A,r0:()=>j,y2:()=>C});n(16280),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(803949),n(581454);var r=()=>n(181856),o=()=>n(691309),i=()=>n(416504),a=()=>n(134025),s=()=>n(68263),l=()=>n(696706),d=()=>n(179034),c=()=>n(798880),u=()=>n(439180),p=()=>n(763824),m=()=>n(973647),h=()=>n(534177),g=()=>n(333334),f=()=>n(255460),y=()=>n(231297),v=()=>n(436725),b=()=>n(518736),x=()=>n(765957),S=()=>n(295169),w=()=>n(148832),k=()=>n(878710),I=()=>n(881480);async function T(e){const{environment:t,latentOperation:n,operationContext:r,inMemoryRecordCache:i,transaction:a,useCrdt:s}=e,l=x().default.state.sidebarSpaceStore,c=x().default.state.sidebarSpaceViewStore;if(!c||!l)throw new Error("No space or space view.");const u=new Set,{assistantOperation:p,type:m}=n;if("addBlockToPage"===m||"insertBlockAfter"===m){const e="addBlockToPage"===m?p.blockNode.attributes.id:p.insertBlockNode.attributes.id;u.add(e);const n=w().B.createChildStore(c,{id:(0,o().So)(e),table:d().ev}),{target:i}=r.addBlockToPage,s=l.id;let f;"insertBlockAfter"===m&&r.enforceDefaultInsertBehavior?(f={type:"page",id:p.parentId,spaceId:s},u.add(p.parentId)):"page"===i?(f={type:"page",id:r.addBlockToPage.pageId,spaceId:s},u.add(r.addBlockToPage.pageId)):"collection"===i?f={type:"collection",id:r.addBlockToPage.collectionId,spaceId:s}:"privatePages"===i?f={type:"space-private-pages",spaceId:s}:"team"===i?f={type:"team",id:r.addBlockToPage.teamspaceId,spaceId:s}:(0,h().HB)(i);const y={environment:t,value:f,blocksToMove:[n],transaction:a};"insertBlockAfter"===m?"team"===y.value.type||r.enforceDefaultInsertBehavior?await g().HY(y):await g().LC(y):"addBlockToPage"===m?await g().HY(y):(0,h().HB)(m)}else if("removeBlock"===m){const{actorPointer:e}=n.data,r=(0,o().o4)({assistantOperation:p,updateMetadata:{last_edited_by_table:e.table,last_edited_by_id:e.id,last_edited_time:Date.now()},includeRemoveFromParent:!0});for(const n of r){B({environment:t,operation:n,recordCache:i,transaction:a});const e=M({operation:n,environment:t,inMemoryRecordCache:i});e&&u.add(e)}}else if("addUnknownBlockToPage"===m){const{operations:e}=(0,o().rB)({latentOperation:n,shouldCreateUnknownBlock:!0,useCrdt:s});for(const n of e)B({environment:t,operation:n,recordCache:i,transaction:a})}else(0,h().HB)(m);return{editedPageIds:u}}function M(e){const{operation:t,environment:n,inMemoryRecordCache:r}=e;if(t.pointer.table===d().ev){const e=new(w().B)(n,t.pointer,{inMemoryRecordCache:r});if(e.isPageBlock())return e.id}}async function C(e){const{environment:t,transaction:n,operations:r,inMemoryRecordCache:o,operationContext:i,useCrdtOverride:a}=e,s=new Set;for(const l of r)if("latentOperation"===l.type){const{latentOperation:e}=l,{editedPageIds:r}=await T({environment:t,latentOperation:e,operationContext:i,inMemoryRecordCache:o,transaction:n,useCrdt:a});r.forEach((e=>s.add(e)))}else if("operation"===l.type){const{operation:e}=l;B({environment:t,operation:e,recordCache:o,transaction:n});const r=M({operation:e,environment:t,inMemoryRecordCache:o});r&&s.add(r)}else(0,h().HB)(l);return{editedPageIds:s}}function j(e){var t;const{assistantOperation:n,attributionActor:r,caches:a,environment:s,currentUserId:l}=e,d=(0,I().g)().getSpaceId(),c=null===(t=x().default.state.sidebarSpaceViewStore)||void 0===t?void 0:t.id,u=(0,b().D8)(x().default.state.sidebarSpaceStore),p=m().Q.unwrap((0,o().Vz)({assistantOperation:n,actorPointer:r,getRecordValue:a.makeGetRecordValueFnFromUpdatesCache(l),spaceId:d,spaceViewId:c,useCrdt:u,currentTimeZone:(0,i().P)()}));return p.length>0&&A({environment:s,operations:p,caches:a,attributionActor:r}),p}function A(e){const{environment:t,operations:n,caches:i,attributionActor:a,operationContext:s}=e,u=t.currentUser.id;if(!u)throw new Error("No current user.");const p=x().default.state.sidebarSpaceStore,m=(0,b().D8)(p),h=l().L3.isEqual(a,{id:u,table:c().oo}),g=new Set;i.commitTransaction({environment:t,transactionActions:y(),perform(e,i,a){const{operations:l}=(0,o().g$)(n,s??(0,o().tF)({shouldRemoveBlocksFromParent:a}),m);for(const n of l){if(!R(t,n))throw new(r().Te)("page_edit_insufficient_permissions","Insufficient permissions to perform this edit. Respond with a chat instead.");n.pointer.table===d().ev&&g.add(n.pointer.id),B({environment:t,operation:n,recordCache:i,transaction:e})}},userAction:"assistantActions.applyTemporaryOperations",userId:u,...!h&&{skipUpdatingEditedMetadata:!0},canUndo:!1});const v=x().default.state.mainEditorCurrentBlockStore;v&&f().YW(t,v,[...g])}function B(e){const{environment:t,operation:n,transaction:r,recordCache:o}=e;if((0,u().ph)(n))(0,v().e)({environment:t,operation:n,transaction:r,inMemoryRecordCache:o});else if(n.pointer.table===d().ev)(0,v().e)({environment:t,operation:n,transaction:r,inMemoryRecordCache:o});else if((0,a().$Y)(n)||(0,a().mP)(n)){const e=new(k().pm)({environment:t,pointer:n.pointer,path:n.path,recordStoreOptions:{inMemoryRecordCache:o}});y().applyOperation({store:e,operation:n,transaction:r})}else(0,h().HB)(n)}function N(e){const{shouldCreateUnknownBlock:t}=e,n=S().default.getActiveSession();if(null!=n&&n.assistantConfigurationState.requestedOnPublicDomain)return(0,o().ze)();const r=x().default.state.sidebarSpaceViewStore;if(!r)throw new Error("No space view.");return(0,o().OS)({spaceViewId:r.id,shouldCreateUnknownBlock:t})}function _(e){const t=x().default.state.sidebarSpaceViewStore;if(!t)throw new Error("No space view.");let n;const{type:r}=e;if("page"===r)n={addBlockToPage:{target:"page",pageId:e.id}};else if("space-private-pages"===r)n={addBlockToPage:{target:"privatePages",spaceViewId:t.id}};else if("collection"===r)n={addBlockToPage:{target:"collection",collectionId:e.id}};else if("team"===r)n={addBlockToPage:{target:"team",teamspaceId:e.id}};else{if("space"===r)throw new Error("Move to Space not supported");(0,h().HB)(r)}return n}function R(e,t){const n=t.pointer,r=new(k().pm)({environment:e,pointer:n}).getRole();return!r||(0,s().p2)(r)}async function P(e){const{environment:t,assistantOperations:n}=e,r=[];for(const a of n)"createBlock"===a.command&&(0,h().O9)(a.databaseSchemaId)&&r.push({id:a.databaseSchemaId,table:d().ev});const o=r.map((e=>new(w().B)(t,e)));await p().lX(o,500,(e=>e.load()));const i=o.map((e=>e.getCollectionStore())).filter(h().O9);await p().lX(i,500,(e=>e.load()))}},374693:(e,t,n)=>{n.d(t,{_:()=>r});const r=(0,n(340498).xh)("notion",{default:{loader:()=>n.e(60858).then(n.bind(n,558687))},darkMode:{loader:()=>n.e(60858).then(n.bind(n,633137))},tintable:{loader:()=>n.e(60858).then(n.bind(n,182183))}})},379819:(e,t,n)=>{n.d(t,{A:()=>k});n(18107),n(967357);var r=n.n(n(32485)),o=n(296540),i=()=>n(813974),a=()=>n(588165),s=()=>n(484714),l=()=>n(56366),d=()=>n(401497),c=()=>n(252291),u=()=>n(631524),p=()=>n(4688),m=()=>n(40457),h=()=>n(995847),g=()=>n(69708),f=()=>n(115512),y=()=>n(563253),v=()=>n(859428),b=()=>n(414706),x=n(474848);function S(e,t){const{inline:o,title:i,focused:a,className:s,blueOutlineFocused:u,compact:p,shouldShowArrowUp:m,shouldShowDismissButton:h,onClickDismissButton:g,type:f}=e,y=(0,d().IS)((e=>({hoveredStyle:{background:e.buttonHoveredBackground}})),[]),v=(0,d().IS)((e=>({style:{minHeight:36,paddingTop:8,paddingBottom:8,width:p?"min-content":"100%",display:"flex",transition:"none",...u?{boxShadow:e.focusedShadow,borderRadius:6}:{}},textWrapper:{alignItems:void 0,flex:void 0,display:"block",textOverflow:"ellipsis",...o&&{alignItems:"baseline"}}})),[o,u,p]),b=(0,l().K8)((()=>n(430483).zD.isDeepFindEnabled()),[]),S={title:i,icon:"topic"===f?(0,x.jsx)(c().I,{icon:n(877788).w}):b?(0,x.jsx)(c().I,{icon:n(207207).J,colorVariant:"secondary"}):(0,x.jsx)(c().I,{icon:n(529099).aiFaceIcon}),style:v.style,textWrapperStyle:v.textWrapper,right:(0,x.jsx)(w,{shouldShowArrowUp:m,shouldShowDismissButton:h,focused:a,onClickDismissButton:g}),className:r()("notranslate",s),buttonStyle:{paddingInlineStart:2,width:p?"min-content":void 0},hoveredStyle:y.hoveredStyle};return(0,x.jsx)(n(760217).A,{...e,...S,ignoreLocalHoverState:!0,ref:t})}function w(e){const{focused:t,shouldShowArrowUp:n,shouldShowDismissButton:r,onClickDismissButton:o}=e,{isElectron:S,isMac:w}=(0,s().Y0)(),k=(0,s().v3)(),{shortcut:I,shortcutString:T}=(0,l().K8)((()=>{var e;const t=i().getKeyboardShortcuts(),n=null===(e=(0,a().c)(t,"notionAiCommandSearchDefault"))||void 0===e?void 0:e.at(0);if(!n)return{shortcut:void 0,shortcutString:void 0};const r=(0,y().z_)(n,w);return{shortcut:r,shortcutString:(0,y().Vd)(r,w)}}),[w]),M=(0,d().IS)((e=>({container:{fontSize:(0,f().ny)(k,"UISmall"),color:e.icon.secondary}})),[k]);return n?(0,x.jsx)(c().I,{icon:p().arrowStraightUpSmallIcon,size:"xs",colorVariant:"secondary"}):r?(0,x.jsx)(v().A,{renderTooltip:()=>(0,x.jsx)("div",{children:(0,x.jsx)(g().sA,{defaultMessage:"Don’t show this again",id:"search.SearchAssistantMenuItem.dismissAITooltip"})}),render:e=>(0,x.jsx)(u().p,{size:"sm",shape:"pill",iconLeading:{icon:h().xMarkSmallIcon,size:"xs",colorVariant:"tertiary"},onClick:o,...e})}):t?(0,x.jsx)(c().I,{icon:m().arrowTurnDownLeftSmallIcon,size:"xs",colorVariant:"secondary"}):S&&I&&T?w?(0,x.jsx)(b().z,{shortcut:I}):(0,x.jsx)("div",{style:M.container,children:T}):null}const k=o.forwardRef(S)},383064:(e,t,n)=>{n.d(t,{g:()=>m,x:()=>p});n(581454);var r=n(296540),o=()=>n(726637),i=()=>n(401497),a=()=>n(245241),s=()=>n(69708),l=()=>n(428343),d=()=>n(89924),c=()=>n(913441),u=n(474848);function p(e){const{onSelect:t}=e,n=(0,s().tz)(),p=(0,l().Q)({filterCategory:"all",availableOffline:!0,searchQuery:""}),h=(0,i().IS)((()=>({sectionHeader:{marginBottom:"8px"},section:{marginBottom:"4px"}})),[]),g=(0,r.useCallback)(((e,n)=>{t({index:{local:e.indexLocal,global:e.index},event:e.event,selectedResult:{store:n,id:n.id,score:-1,spaceId:n.getSpaceId(),sources:[a().Ni.Local],featureGroups:[],originalPosition:0,serverEventProperties:void 0},fromSidePeekPanel:!1,context:"offline_pages"})}),[t]),f=(0,r.useMemo)((()=>{const e=p.sort(((e,t)=>t.lastModifiedTime-e.lastModifiedTime)).map((({pageBlockStore:e})=>({key:e.id,action:t=>g(t,e),render:t=>(0,r.createElement)(c().GC,{...t,store:e,inline:!o().A.isMobile,hidePath:!1,buttonStyle:{paddingInlineStart:1},type:"offline_pages",key:e.id})})));return[{key:"offline_pages",items:e,render:e=>(0,u.jsx)(d().A,{desktopTitleStyle:h.sectionHeader,style:h.section,title:n.formatMessage(m.offlinePages),children:e.children})}]}),[p,g,h.sectionHeader,h.section,n]);return f}const m=(0,s().YK)({offlinePages:{id:"search.default_page_body.offline_pages",defaultMessage:"Offline pages"}})},385054:(e,t,n)=>{n.d(t,{b:()=>r});const r=(0,n(340498).xh)("cursor",{default:{loader:()=>n.e(32831).then(n.bind(n,738508))},darkMode:{loader:()=>n.e(32831).then(n.bind(n,482984))},tintable:{loader:()=>n.e(32831).then(n.bind(n,531738))}})},385979:(e,t,n)=>{n.d(t,{h:()=>c});n(581454);var r=n(296540),o=()=>n(401497),i=()=>n(496603),a=()=>n(710149),s=n(474848);const l=8;function d(e){const{isLastShimmer:t,hideBorders:n,hidePathText:l}=e,d=(0,r.useMemo)((()=>(0,i().XM)(["30%","45%","55%","60%","70%","75%","80%","90%"])),[]),c=(0,r.useMemo)((()=>(0,i().XM)(["10%","15%","20%","25%","30%","35%","55%","70%"])),[]),u=(0,o().IS)((e=>({resultContainer:{display:"flex",gap:10,boxShadow:n||t?void 0:`0 1px 0 ${e.lightDividerColor}`,marginTop:8,marginInlineEnd:8,marginBottom:10,marginInlineStart:6,paddingBottom:n?0:10},icon:{width:20,height:20,borderRadius:5,marginInlineStart:6},titleAndPath:{width:"100%",display:"flex",flexDirection:"column",gap:5},title:{height:18,borderRadius:5},path:{height:12,borderRadius:5}})),[t,n]);return(0,s.jsxs)("div",{style:u.resultContainer,children:[(0,s.jsx)(a().A,{style:u.icon}),(0,s.jsxs)("div",{style:u.titleAndPath,children:[(0,s.jsx)(a().A,{style:{...u.title,width:d}}),l?void 0:(0,s.jsx)(a().A,{style:{...u.path,width:c}})]})]})}function c(e){const{resultsCount:t,shouldShow:n,hideBorders:o,hidePathText:i}=e,a=l-t,c=n?Math.max(0,a):0;return(0,r.useMemo)((()=>{if(0===c)return;const e=Array.from({length:c},(()=>!0));return e.map(((t,n)=>({key:`shimmer-item-${n}`,action:()=>{},render:()=>(0,s.jsx)(d,{isLastShimmer:n===e.length-1,hideBorders:o,hidePathText:i})})))}),[c,o,i])}},409066:(e,t,n)=>{n.d(t,{E:()=>k});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(581454),n(296540);var r=()=>n(484714),o=()=>n(56366),i=()=>n(784892),a=()=>n(177148),s=()=>n(179034),l=()=>n(69708),d=()=>n(972435),c=()=>n(825972),u=()=>n(106628),p=()=>n(765957),m=()=>n(148832),h=()=>n(187820),g=()=>n(305390),f=()=>n(16006),y=()=>n(297401),v=()=>n(881690),b=()=>n(821879),x=n(474848);const S={token:{display:"flex",alignItems:"center"},icon:{marginInlineEnd:4}},w=(0,l().YK)({searchPages:{defaultMessage:"Search pages",id:"searchPageFilter.searchTokenFilter.tokenInput.placeholder"}});function k({mode:e,title:t,blockIds:n,onChange:o,disabled:i,focused:s,peopleBlocksToInclude:m,onMenuDismiss:h,onMenuOpen:g,parentStore:f}){const y=(0,r().v3)();return(0,x.jsx)(b().A,{mode:e,hasItemsSelected:(null==n?void 0:n.length)>0,title:t,icon:a().Y,items:n,onChange:o,focused:s,renderFilter:(e,t)=>(0,x.jsx)(j,{item:e,args:t,parentStore:f}),renderToken:(e,t)=>(0,x.jsx)(M,{item:e,handlers:t,blockIds:n,parentStore:f}),renderItemForSummary:e=>(0,x.jsx)(T,{item:e,parentStore:f}),addItemLabel:(0,x.jsx)(l().sA,{defaultMessage:"Add another page",id:"searchPageFilter.searchTokenFilter.addAPage.button"}),labelText:{title:t,tokenInputPlaceholder:d().A.formatMessage(w.searchPages),componentDebugName:"SearchPageFilter"},performRequest:({query:e,current:t})=>async function(e,t){const{query:n,current:r,peopleBlocksToInclude:o}=e,{sidebarSpaceStore:i}=p().default.state;if(!i)return[];const a=await u().T.searchActions.load(),s=n?(await a.searchPageIds({environment:t,query:n,limit:20,spaceId:i.id,requireEditPermissions:!1,excludeTemplates:!1,source:"ancestor_filter_page_search",boostRecentlyViewedPages:!0,spaceStore:i,peopleBlocksToInclude:o})).results:c().NK.state.map((e=>e.pageId)),l=new Set(r);return s.filter((e=>!l.has(e)))}({query:e,current:t,peopleBlocksToInclude:m},y),renderResultMenuItem:(e,t)=>(0,x.jsx)(C,{item:e,props:t,parentStore:f}),disabled:i,onMenuDismiss:h,onMenuOpen:g})}function I(e,t){return m().B.createChildStore(t,{table:s().ev,id:e})}function T({item:e,parentStore:t}){const n=I(e,t);return(0,x.jsx)(f().A,{store:n,shouldWrap:!0,maxLength:50})}function M({item:e,handlers:t,blockIds:n,parentStore:a}){const s=(0,r().v3)(),l=S,d=1===n.length,c=I(e,a),u=(0,o().K8)((()=>c.getIcon()),[c]),p=(0,o().K8)((()=>(0,h().Te)(c)),[c]),m=(0,x.jsxs)("div",{style:l.token,children:[(0,x.jsx)(h().B6,{disabled:!0,icon:u,iconRecordCategory:p,isEmptyPage:!1,size:20,style:l.icon}),(0,x.jsx)(f().A,{store:c})]});return(0,x.jsx)(v().A,{format:s.device.isMobile?i().NY.Large:i().NY.Small,value:m,showRemoveButton:!0,onClickRemove:t.onRemove,isSingle:d,shouldShrink:!0,backgroundColor:"transparent",shouldWrap:!1})}function C({item:e,props:t,parentStore:n}){const r=(0,o().K8)((()=>I(e,n)),[e,n]);return(0,x.jsx)(g().A,{...t,store:r})}function j({item:e,args:t,parentStore:n}){const{disabled:o,onRemove:i,onClick:a}=t,s=function(e){return{menuItem:{minHeight:void 0,paddingTop:e.device.isMobile?12:4,paddingBottom:e.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginInlineEnd:12}}}((0,r().v3)()),l=I(e,n),d=(0,x.jsx)(y().A,{disabled:o,onClick:i});return(0,x.jsx)(g().A,{disabled:o,focused:!1,store:l,right:d,style:s.menuItem,desktopTitleStyle:s.menuItemTitle,onClick:a})}},414706:(e,t,n)=>{n.d(t,{z:()=>f});n(296540);var r=()=>n(401497),o=()=>n(396896),i=()=>n(493552),a=()=>n(333603),s=()=>n(340498),l=n(474848);const d={viewBox:"0 0 16 16",fittedViewBox:"0.94 1.41 14.11 13.17",svg:(0,l.jsx)("path",{d:"M11.57 12.947c0 .903-.733 1.636-1.637 1.636H6.066a1.637 1.637 0 0 1-1.636-1.636v-3.23H2.2a1.25 1.25 0 0 1-.884-2.135l5.8-5.8a1.25 1.25 0 0 1 1.768 0l5.8 5.8a1.25 1.25 0 0 1-.884 2.134h-2.23zm-5.89 0c0 .187.133.343.309.379l.077.007h3.867l.079-.008c.15-.03.27-.15.3-.3l.008-.078v-4.4a.08.08 0 0 1 .049-.074l.031-.007h3.4L8 2.666l-5.8 5.8h3.4a.08.08 0 0 1 .08.08z"})},c=(0,s().wt)("arrowShapeUpSmall",d);var u=()=>n(40457);const p={viewBox:"0 0 16 16",fittedViewBox:"2.37 2.37 11.26 11.26",svg:(0,l.jsx)("path",{d:"M4.667 2.375a2.292 2.292 0 0 0 0 4.583h1.042v2.084H4.667a2.292 2.292 0 1 0 2.291 2.291v-1.041h2.083v1.041a2.292 2.292 0 1 0 2.292-2.291h-1.041V6.958h1.041a2.292 2.292 0 1 0-2.292-2.291v1.041H6.958V4.667a2.29 2.29 0 0 0-2.291-2.292M3.625 4.667a1.042 1.042 0 1 1 2.083 0v1.041H4.667a1.04 1.04 0 0 1-1.042-1.041m6.666 0a1.042 1.042 0 1 1 1.042 1.041h-1.042zM6.958 9.042V6.958h2.084v2.084zm-3.333 2.291c0-.575.466-1.041 1.042-1.041h1.041v1.041a1.042 1.042 0 1 1-2.083 0m6.666 0v-1.041h1.042a1.042 1.042 0 1 1-1.042 1.041"})},m=(0,s().wt)("commandSmall",p),h={viewBox:"0 0 16 16",fittedViewBox:"2.44 3 11.11 10",svg:(0,l.jsx)("path",{d:"M5.647 3.002c.514 0 .948.284 1.152.75l3.47 7.822a.3.3 0 0 0 .106.125c.04.024.098.04.185.04h2.343c.354 0 .648.281.648.632a.636.636 0 0 1-.648.626h-2.58c-.265 0-.497-.056-.693-.182a1.23 1.23 0 0 1-.45-.558L5.696 4.43a.3.3 0 0 0-.105-.13.3.3 0 0 0-.165-.041H3.098a.635.635 0 0 1-.649-.632.63.63 0 0 1 .649-.626zm7.256 0c.356 0 .642.262.642.621a.625.625 0 0 1-.642.626H9.481a.63.63 0 0 1-.647-.626c0-.36.293-.621.647-.621z"})},g=(0,s().wt)("optionSmall",h);function f(e){const{shortcut:t}=e,n=(0,r().IS)((e=>({icon:{width:s().Ev.xxs,height:s().Ev.xxs,fill:e.icon.secondary}})),[]);return t?(0,l.jsxs)(o().fI,{gap:2,alignItems:"center",children:[t.shift?c(n.icon):void 0,t.control?(0,a().Y)(n.icon):void 0,t.option?g(n.icon):void 0,t.command?m(n.icon):void 0,t.enter?(0,u().arrowTurnDownLeftSmallIcon)(n.icon):void 0,t.key?(0,l.jsx)(i().D,{colorVariant:"secondary",styleKey:"Caption/Regular",children:1===t.key.length?t.key.toUpperCase():t.key}):void 0]}):null}},428343:(e,t,n)=>{n.d(t,{Q:()=>m});n(898992),n(354520),n(581454);var r=()=>n(484714),o=()=>n(56366),i=()=>n(179034),a=()=>n(69708),s=()=>n(534177),l=()=>n(860864),d=()=>n(765957),c=()=>n(148832),u=()=>n(968913),p=()=>n(959462);function m(e){const{searchQuery:t,filterCategory:n,availableOffline:m=!1,disable:h=!1}=e,g=(0,r().v3)(),f=(0,a().tz)(),y=(0,o().K8)((()=>{if(h)return[];const e=p().A.state.offlinePages??{};return Object.keys(e).map((r=>{var o;const a=e[r];if(void 0===a)return;const{is_explicitly_offlined_origin:p,is_autosynced_origin:h}=a;if(!p&&!h)return;if(m&&!(0,u().Bd)(r))return;if(!function(e){const{filterCategory:t,isExplicitlyOfflinedOrigin:n,isAutosyncedOrigin:r}=e;switch(t){case"all":return!0;case"manual":return n;case"autosynced":return r;default:(0,s().HB)(t)}}({filterCategory:n,isExplicitlyOfflinedOrigin:p,isAutosyncedOrigin:h}))return;const y=new(c().B)(g,{table:i().ev,id:r});if(Boolean(t)&&!function(e){const{pageBlockStore:t,searchQuery:n,intl:r}=e,{displayTitle:o}=(0,l().tL)({store:t,intl:r});if(void 0===o)return!1;return o.toLowerCase().includes(n.toLowerCase())}({pageBlockStore:y,searchQuery:t,intl:f}))return;if((null===(o=d().default.state.sidebarSpaceStore)||void 0===o?void 0:o.id)!==y.getSpaceId())return;const v=y.getLastEditedTime();return{id:r,downloadStatus:a.download_status,isClickable:!1,lastModifiedTime:v,pageBlockStore:y,showOptions:p}})).filter(s().O9)}),[h,m,n,g,t,f]);return y}},433876:(e,t,n)=>{n.d(t,{A:()=>o});n(296540);var r=n(474848);const o=function(e){const t=(0,n(484714).v3)(),{modalStyle:o,alignItems:i="flex-start"}=e,a=(0,n(401497).IS)((e=>({modalStyle:{top:n(175947).jq(t.device.isElectronMac),borderRadius:12,overflow:"hidden",boxShadow:e.shadowLG,background:e.background.primary,...o}})),[t,o]),{device:s}=t;return s.isMobile?(0,r.jsx)(n(417392).Ay,{popupType:n(30537).n.SlideUp,open:e.open,render:e.renderContent,preventSlideUpTransition:e.disableAnimation,onDismiss:e.onDismiss,origin:e.origin,trapFocus:!1,ariaLabel:e.ariaLabel}):(0,r.jsx)(n(676007).a,{open:e.open,preventHideChildrenWhileOpening:!0,style:{alignItems:i},innerStyle:a.modalStyle,onDismiss:e.onDismiss,render:e.renderContent,origin:e.origin,isWaxPaper:e.modalIsWaxPaper,backgroundStyle:e.modalBackgroundStyle,transitionAppearance:e.disableAnimation?"none":void 0,ariaLabel:e.ariaLabel})}},436468:(e,t,n)=>{n.d(t,{jk:()=>Y,om:()=>ve,Xp:()=>ee,y5:()=>be,Ij:()=>xe,BM:()=>te,Rz:()=>X,ld:()=>se,oc:()=>ue,w$:()=>de});n(16280),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(672577),n(430670),n(803949),n(581454),n(737550);var r=()=>n(906745),o=()=>n(496603),i=()=>n(763824),a=()=>n(183558),s=()=>n(973647),l=()=>n(534177),d=()=>n(720665),c=()=>n(933528),u=()=>n(902006),p=()=>n(241178),m=()=>n(992214),h=()=>n(700500),g=()=>n(15440),f=()=>n(356246),y=()=>n(657970),v=()=>n(335997),b=()=>n(302322),x=()=>n(581793),S=()=>n(363170),w=()=>n(898244),k=()=>n(713998),I=()=>n(604995),T=()=>n(651124),M=()=>n(236162),C=()=>n(416504),j=()=>n(390066),A=()=>n(206267),B=()=>n(792071),N=()=>n(72135),_=()=>n(251582),R=()=>n(433847),P=()=>n(388821),E=()=>n(179034),D=()=>n(519831),O=()=>n(869558),F=()=>n(437607),q=()=>n(798880),L=()=>n(797809),K=()=>n(201980),U=()=>n(181856),V=()=>n(510818),z=()=>n(832443),H=()=>n(353566),W=()=>n(252050),$=()=>n(706461),G=()=>n(471159);var Q=()=>n(586984);async function X(e){const{pointer:t,intl:n,currentTimeZone:r}=e,o="loadRecordValue"in e?B().h0Y.fromLoadRecordValueFn(e.loadRecordValue):e.loadRecordModel,i=(0,R().ns)({pointer:t,loadRecordModel:o}),a=await ee({pointer:t,loadRecordModel:o,rootPointer:t,parentPointer:void 0,spaceId:t.spaceId,intl:n,currentTimeZone:r});if(!a)throw new(U().u7)(t.id,"Failed to build XML node");return{node:a,isNonSpaceShared:!(await i)}}async function Y(e){const{intl:t,textValue:n,allowsText:r,allowedTagNames:o,loadRecordModel:a,shouldUsePlaceholderRecordInformation:s,currentTimeZone:d,allowWebLoading:c=!1}=e,p=[],g=P().RecordMap.create(),f=K().RQ(n).flatMap((e=>K().uPN(e)));if(s&&a)throw new Error("Expected no loadRecordModelFn when using placeholder record information");if(!s&&!a)throw new Error("Expected loadRecordModelFn to be defined when not using placeholder record info");!s&&a&&await Promise.all(f.map((async e=>{if(K().jIt(e)){const t=K().i$F(e);if(!t)return;const n=await a(t);if(g.setModel(t,n),!n)return;const r=i().lX(n.getCollectionPointers(),100,(async e=>{g.setModel(e,await a(e))})),o=i().lX(n.getCollectionViewPointers(),100,(async e=>{g.setModel(e,await a(e))}));await Promise.all([r,o]);const{linkedCollectionPointers:s}=n.getAllLinkedAndSourceCollectionPointers(B().b4_.fromRecordMap(g));await i().lX(s,100,(async e=>{g.setModel(e,await a(e))}))}else if(K().rie(e)){const t={table:q().oo,id:K().NcG(e)};g.setModel(t,await a(t))}else if(K().RaC(e)){const t=K().FHi(e);if(!t)return;const{groupId:n,spaceId:r}=t,o={table:F().n,id:(0,F().gK)({spacePermissionGroupId:n,spaceId:r}),spaceId:r};g.setModel(o,await a(o))}else if(K().$ch(e)){const t=K().KdU(e);g.setModel(t,await a(t))}else if(K().muW(e)){const t=K().TSJ(e);g.setModel(t,await a(t))}})));const y=s?void 0:B().b4_.fromRecordMap(g);for(const i of K().RQ(n)){let e=p,n=!1,a=K().uPN(i);if(K().GiG(i)?a=[...a.filter((e=>!K().gir(e))),...a.filter((e=>K().gir(e)))]:K().qXl(i)&&(a=[...a.filter((e=>!K().iGj(e))),...a.filter((e=>K().iGj(e)))]),!a.some((e=>(0,K().O3D)(e)))){for(const r of a){(K().iGj(r)||K().gir(r))&&(n=!0);const a=K()._XS(r),s=he[a];if(!(0,l().Xk)(o,s))continue;let p;if("e"===s){if(!K().GiG(i)){n=!1;continue}p={type:"inline",tagName:s,attributes:{equation:K().u$N(i)},children:[]}}else if("a"===s){if(!K().sh$(r))throw new Error("Unexpected annotation for link annotation");const e=K().cQR(r);let t=(0,u().Tq)(e);t=c||"web"!==t?t:void 0,p=t?{type:"inline",tagName:s,attributes:{href:e,type:t,"external-id":(0,u().V9)(e)},children:[]}:{type:"inline",tagName:s,attributes:{href:e,type:void 0,"external-id":void 0},children:[]}}else if("mention-page"===s){if(!K().jIt(r))throw new Error("Unexpected annotation for page annotation");const e=K().v55(r);if(y){var v;const n=y({table:E().ev,id:e}),r=(null==n?void 0:n.getCollectionPointer())??(null==n?void 0:n.getFirstCollectionPointerFromViews(y)),o=n?r&&(null===(v=y(r))||void 0===v?void 0:v.getName())||(null==n?void 0:n.getProperty("title")):K().x9d((0,m().mA)(t)),i=[{type:"text",value:(0,V().Pm)(K().q4_(o))}];if(n&&(0,h().Ef)(n.type)){if(!r)throw new Error("Unable to find collection for mention-database");p={type:"inline",tagName:"mention-database",attributes:{"database-id":(0,W().z5)(r.id)},children:i}}else p={type:"inline",tagName:s,attributes:{"page-id":(0,W().ew)(e)},children:i}}else{const t=[{type:"text",value:(0,V().Pm)("Page title")}];p={type:"inline",tagName:s,attributes:{"page-id":(0,W().ew)(e)},children:t}}}else if("mention-database"===s){if(!K().$ch(r))throw new Error("Unexpected annotation for database annotation");const e=K().KdU(r);if(y){var b;const n=e?(null===(b=y(e))||void 0===b?void 0:b.getName())??K().x9d("Unnamed collection"):K().x9d((0,m().mA)(t)),r=[{type:"text",value:(0,V().Pm)(K().q4_(n))}];p={type:"inline",tagName:s,attributes:{"database-id":(0,W().z5)(e.id)},children:r}}else{const t=[{type:"text",value:(0,V().Pm)("Collection title")}];p={type:"inline",tagName:s,attributes:{"database-id":(0,W().z5)(e.id)},children:t}}}else if("mention-data-source"===s){if(!K().muW(r))throw new Error("Unexpected annotation for database annotation");const e=K().TSJ(r);if(y){var x;const n=e?(null===(x=y(e))||void 0===x?void 0:x.getName())??K().x9d("Unnamed collection"):K().x9d((0,m().mA)(t)),r=[{type:"text",value:(0,V().Pm)(K().q4_(n))}];p={type:"inline",tagName:s,attributes:{"data-source-id":(0,W().z5)(e.id)},children:r}}else{const t=[{type:"text",value:(0,V().Pm)("Collection title")}];p={type:"inline",tagName:s,attributes:{"data-source-id":(0,W().z5)(e.id)},children:t}}}else if("mention-person"===s){if(!K().rie(r))throw new Error("Unexpected annotation for user annotation");const e=K().NcG(r);if(y){const n=y({table:q().oo,id:e});p={type:"inline",tagName:s,attributes:{"person-id":(0,W().ew)(e),"person-name":null==n?void 0:n.getDisplayName(t)},children:[]}}else p={type:"inline",tagName:s,attributes:{"person-id":(0,W().ew)(e),"person-name":"Person name"},children:[]}}else if("mention-date"===s){if(!K().qsB(r))throw new Error("Unexpected annotation for date annotation");const e=K().K7D(r),t=(0,I().kW)(e,d);let n,o;"date"===t.type?(n="mention-date",o={date:t.start_date}):"datetime"===t.type?(n="mention-datetime",o={date:t.start_date,time:t.start_time}):"daterange"===t.type?(n="mention-date-range",o={"start-date":t.start_date,"end-date":t.end_date}):(n="mention-datetime-range",o={"start-date":t.start_date,"start-time":t.start_time,"end-date":t.end_date,"end-time":t.end_time}),p={type:"inline",tagName:n,attributes:o,children:[]}}else if("h"===s){if(!K().YuY(r))throw new Error("Unexpected annotation for highlight annotation");p={type:"inline",tagName:s,attributes:{color:W().P8[K().uIc(r)]},children:[]}}else if("mention-link"===s){if(!K().ik2(r))throw new Error("Unexpected annotation for link mention annotation");const e=K().q1R(r);p={type:"inline",tagName:s,attributes:{title:e.title,href:e.href,description:e.description,icon_url:e.icon_url},children:[]}}else p={type:"inline",tagName:s,attributes:{},children:[]};e.push(p),e=p.children}if(!n&&r){const t=K().N8A(i);t.length>0&&e.push({type:"text",value:(0,V().Pm)(t)})}}}return p}function Z(e){const{tagName:t,blockId:n,schemaId:r,attributes:o}=e;return(0,W().g5)(t),{type:"block",tagName:t,text:[],attributes:{id:n,...o},properties:{},schemas:{},children:[],parent:void 0,persisted:!0,schemaId:r}}function J(e){const t=le[e];return(0,l().O)(W().sA,t)}async function ee(e){const{pointer:t,loadRecordModel:n,rootPointer:r,parentPointer:o,spaceId:a,intl:s,currentTimeZone:d,viewedBlockIds:c=new Set}=e;if(c.has(t.id))return;c.add(t.id);const u=await n(t);if(!u)return;if(!J(u.type))return;const p=t.table===r.table&&t.id===r.id&&t.spaceId===r.spaceId,m=u.getFormatValue("suggestions");if(!p&&m&&m.some((e=>"insert"===e.type)))return;let f,y=t;const v=(0,W().ew)((null==o?void 0:o.id)??r.id),b=(0,h().Af)(u.type,u.getFormat());if(u.isType(h().xd.page)||u.isType(h().xd.collectionViewPage)&&b){var x;const e=null===(x=await(0,M().wC)({block:u,loadRecordModel:n}))||void 0===x?void 0:x.id,t=e?(0,W().z5)(e):void 0,i=u.getFormatValue("page_font"),a=u.getFormatValue("page_small_text")?"small":void 0,l=u.getFormatValue("page_full_width")?"full-width":void 0;if(p){const e=await(0,M().wC)({block:u,loadRecordModel:n});let r;r=e&&e.parent_table!==D().Vl?(0,W().ew)(e.parent_id):(0,W().ew)(u.id),f=Z({tagName:u.isType(h().xd.collectionViewPage)&&b?"page":le[u.type],blockId:(0,W().ew)(u.id),attributes:{...i&&"comic"!==i?{"page-font":i}:{},...a?{"page-font-size":a}:{},...l?{"page-width":l}:{},...t?{"database-id":t}:{}},schemaId:r})}else f=Z({tagName:"child-page",blockId:(0,W().ew)(`${u.id}/${(null==o?void 0:o.id)||r.id}`),attributes:{"page-id":(0,W().ew)(u.id),"database-id":t,"has-content":u.getContentLength()>0?"true":"false"},schemaId:v});await oe({node:f,block:u,loadRecordModel:n,intl:s,currentTimeZone:d}),!p&&t&&await async function(e){const{node:t,loadRecordModel:n,intl:r,currentTimeZone:o,block:i,maxBlocksToLoad:a=50,viewedBlockIds:s=new Set}=e,l=i.getContentPointers(),d=[];for(const c of l){const e=await ee({pointer:c,rootPointer:i.pointer,parentPointer:i.pointer,spaceId:i.getSpaceId(),loadRecordModel:n,intl:r,currentTimeZone:o,viewedBlockIds:s});if(e&&(d.push(e),d.length>=a))break}t.children.push(...d.slice(0,a))}({node:f,loadRecordModel:n,intl:s,currentTimeZone:d,block:u,maxBlocksToLoad:50,viewedBlockIds:c})}else if(u.type===h().xd.collectionView||u.isType(h().xd.collectionViewPage)&&!b)f=Z({tagName:"database-views",blockId:(0,W().ew)(u.id),schemaId:(0,W().ew)(u.id),attributes:{}}),await oe({block:u,node:f,loadRecordModel:n,intl:s,currentTimeZone:d});else if(u.type===h().xd.alias){const e=u.getFormatValue("alias_pointer");if(!e||e.table!==E().ev)return;const t=await n(e);if(!t)return;if(t.type===h().xd.collectionView||t.type===h().xd.collectionViewPage)f=Z({tagName:"link-database",blockId:(0,W().ew)(u.id),schemaId:v,attributes:{"database-id":(0,W().z5)(t.id)}});else{var S;const e=null===(S=await(0,M().wC)({block:u,loadRecordModel:n}))||void 0===S?void 0:S.getParentId();f=Z({tagName:"link-page",blockId:(0,W().ew)(u.id),schemaId:v,attributes:{"page-id":(0,W().ew)(t.id),...e?{"database-id":(0,W().z5)(e)}:{}}})}await oe({node:f,block:t,loadRecordModel:n,intl:s,currentTimeZone:d})}else if(u.type===h().xd.table){const e=u.getFormatValue("table_block_row_header"),t=u.getFormatValue("table_block_column_header");f=Z({tagName:le[u.type],blockId:(0,W().ew)(u.id),schemaId:v,attributes:{...e?{"header-row":"true"}:{},...t?{"header-column":"true"}:{}}})}else if(u.type===h().xd.tableRow){if(u.parent_table!==E().ev)return;const e=await n({table:u.parent_table,id:u.parent_id,spaceId:u.space_id});if(!e||e.type!==h().xd.table)return;f=Z({tagName:le[u.type],blockId:(0,W().ew)(u.id),schemaId:v,attributes:{}});const t=e.getFormatValue("table_block_column_order")||[];for(const r of t){const e=(t.indexOf(r)+1).toString(),o={type:"property",tagName:"property-text",attributes:{name:e},children:await Y({textValue:u.getProperty(r),allowsText:W().GU["property-text"].text,allowedTagNames:W().GU["property-text"].inline,loadRecordModel:n,intl:s,currentTimeZone:d})};f.properties[e]=o}}else if(u.isType(h().xd.transclusionReference)){const e=u.getTransclusionReferenceTargetPointer();if(!e)return;f=Z({tagName:le[u.type],blockId:(0,W().ew)(u.id),schemaId:v,attributes:{"synced-block-id":(0,W().ew)(e.id)}}),y=e}else if(u.getFormatValue("toggleable")&&(u.isType(h().xd.header)||u.isType(h().xd.subHeader)||u.isType(h().xd.subSubHeader))){const e=ce[u.type];f=Z({tagName:"toggle",blockId:(0,W().ew)(u.id),schemaId:v,attributes:{size:e}}),await oe({block:u,node:f,loadRecordModel:n,intl:s,currentTimeZone:d})}else if(u.isType(h().xd.code)){const e=u.getLanguage().name,t=g().$K[e];f=Z({tagName:"code-block",blockId:(0,W().ew)(u.id),schemaId:v,attributes:{language:t}}),await oe({block:u,node:f,loadRecordModel:n,intl:s,currentTimeZone:d})}else"unknown-block"===le[u.type]?(f=Z({tagName:"unknown-block",blockId:(0,W().ew)(u.id),schemaId:v,attributes:{type:u.type}}),await oe({block:u,node:f,loadRecordModel:n,intl:s,currentTimeZone:d})):(f=Z({tagName:le[u.type],blockId:(0,W().ew)(u.id),schemaId:v,attributes:{}}),await oe({block:u,node:f,loadRecordModel:n,intl:s,currentTimeZone:d}));if((0,l().Xk)(W().sW,f.tagName)){const e=u.getFormatValue("block_color");e&&(f.attributes.color=W().P8[e])}if(u.isType(h().xd.collectionViewPage)&&!b||u.isType(h().xd.collectionView)){const e=u.getCollectionViewIds(),t=(await i().lX(e,500,(async e=>await async function(e){const{pointer:t,parentPointer:n,loadRecordModel:r}=e,o=await r(t);if(!o)return;const i=await r(n);if(!i)return;const a=o.getCollectionPointer(i);if(!a)return;const s=await r(a);if(!s)return;const l=(0,K().k4p)(s.getName()),d=o.getName(),c={type:"collectionView",tagName:"database-view",parent:(0,W().ew)(n.id),attributes:{id:(0,W().wn)(t.id),title:d??"","database-id":(0,W().z5)(s.id),"database-name":l},persisted:!0,schemaId:(0,W().ew)(n.id)};return c}({pointer:{table:O().Gy,id:e},loadRecordModel:n,rootPointer:r,intl:s,parentPointer:{table:E().ev,id:f.attributes.id}})))).filter(l().O9);f.children.push(...t)}else if(p||!(0,h().$I)(u.type)){let e;if(u.isType(h().xd.transclusionReference)){e=[];const t=u.getTransclusionReferenceTargetPointer();if(t){const r=await n(t);r&&(e=r.getRenderableContentIds())}}else e=u.getRenderableContentIds();const t=3e3,o=25,i=(await async function(e,t,n,r){const o=new Array(e.length);let i=!1;const a=setTimeout((()=>{i=!0}),n);try{const n=new Set;for(let a=0;a<e.length&&!i;a++){const s=a,l=e[a],d=(async()=>{try{if(i)return;const e=await r(l);i||(o[s]=e)}catch(e){i||(o[s]=void 0)}})().then((()=>{n.delete(d)}));if(n.add(d),n.size>=t&&await Promise.race(n),i)break}if(!i&&n.size>0){const e=new Promise((e=>{const t=setInterval((()=>{(i||0===n.size)&&(clearInterval(t),e())}),100)})),t=Array.from(n);await Promise.race([Promise.all(t),e])}}finally{clearTimeout(a)}return o}(e,o,t,(async e=>ee({pointer:{table:"block",id:e},loadRecordModel:n,rootPointer:r,parentPointer:y,spaceId:a,intl:s,currentTimeZone:d,viewedBlockIds:c})))).filter(l().O9);f.children.push(...i),i.forEach((e=>{e.parent=f}))}return f}async function te(e){const{loadRecordModel:t,collectionPointer:n,intl:r,currentTimeZone:o}=e,i=await t(n);if(!i)throw new(U().S2)(n.id,"Failed to build XML Node. No available collection model");const a=i.getParentPointer();if(a.table===D().Vl)throw new(U().S2)(n.id,"Unsupported operation for table");const s=await t(a);if(!s)throw new(U().S2)(n.id,"Failed to build XML node: missing block");if(!J(s.type))throw new(U().S2)(n.id,`Failed to build XML node: unsupported block type ${s.type}`);const l=P().RecordMapWithRole.create(),d=B().b4_.fromRecordMapWithRole(l),c={type:"collection",tagName:"database",parent:(0,W().ew)(a.id),attributes:{id:(0,W().z5)(n.id),title:i.getRenderTitle({getRecordModel:d,userTimeZone:(0,I().dB)(),intl:r})??""},persisted:!0,schemaId:(0,W().ew)(s.id),schemas:{},properties:{}},u=i.getDescription();if(u){const e={type:"property",tagName:"property-text",attributes:{name:"Description"},children:await Y({textValue:u,allowsText:!0,allowedTagNames:Object.keys(W()._S),loadRecordModel:t,intl:r,currentTimeZone:o})};c.properties.description=e}return await re({collectionPointedTo:i,node:c,loadRecordModel:t}),c}function ne(e){const t=e.getNormalizedSchema(),n=["title",...((0,j().L)(e.getFormat()||{},t,void 0,T().jf.Page).collection_page_properties||[]).map((({property:e})=>e))];return Object.entries(t).sort((([e],[t])=>n.indexOf(e)-n.indexOf(t)))}async function re({collectionPointedTo:e,node:t,loadRecordModel:n}){await Promise.all(ne(e).map((async([e,r])=>{if(!(0,a().Ut)(e)||!r)return;const o=`schema-${pe[r.type]}`;if((0,l().O)(W().U4,o))switch(o){case"schema-property-title":case"schema-property-text":case"schema-property-url":case"schema-property-email":case"schema-property-phone-number":case"schema-property-checkbox":case"schema-property-created-time":case"schema-property-created-by":case"schema-property-last-edited-by":case"schema-property-last-edited-time":{const e={type:"schema",tagName:o,attributes:{name:r.name,description:r.description},children:[]};t.schemas[r.name]=e;break}case"schema-property-date":{const e={type:"schema",tagName:o,attributes:{name:r.name,description:r.description},children:[]};t.schemas[r.name]=e;break}case"schema-property-number":{if("number"!==r.type)throw new Error(`Unexpected property schema type ${r.type}`);const e={type:"schema",tagName:o,attributes:{name:r.name,description:r.description,format:r.number_format||"number"},children:[]};t.schemas[r.name]=e;break}case"schema-property-person":{if("person"!==r.type)throw new Error(`Unexpected property schema type ${r.type}`);const e=1===r.limit?"1":"Infinity",n={type:"schema",tagName:o,attributes:{name:r.name,description:r.description,limit:e},children:[]};t.schemas[r.name]=n;break}case"schema-property-multi-select":case"schema-property-select":{if("select"!==r.type&&"multi_select"!==r.type)throw new Error(`Unexpected property schema type ${r.type}`);const e={type:"schema",tagName:o,attributes:{name:r.name,description:r.description},children:(r.options||[]).map((e=>({type:"inline",tagName:"schema-option",attributes:{option:e.value},children:[]})))};t.schemas[r.name]=e;break}case"schema-property-relation":{var i;if("relation"!==r.type)throw new Error(`Unexpected property schema type ${r.type}`);const e=1===r.limit?"1":"Infinity",a=(0,w().zO)(r),s=a?(0,W().z5)(a):void 0;if(!s)throw new Error("Cannot link to relation without table pointer");if(r.connectedRelation)break;const d=await n({id:s,table:D().Vl});if(!d)break;const c=d.getNormalizedSchema(),u=r.property&&(0,l().O)(c,r.property)?(null===(i=c[r.property])||void 0===i?void 0:i.name)??void 0:void 0,p={type:"schema",tagName:o,attributes:{name:r.name,description:r.description,limit:e,"database-id":s,"synced-property-name":u},children:[]};t.schemas[r.name]=p;break}case"schema-property-status":{if("status"!==r.type)throw new Error(`Unexpected property schema type ${r.type}`);const e={type:"schema",tagName:o,attributes:{name:r.name,description:r.description},children:(r.groups||[]).map((e=>({type:"inline",tagName:"schema-option-category",attributes:{category:e.name},children:(e.optionIds||[]).flatMap((e=>{var t;const n=null===(t=r.options)||void 0===t?void 0:t.find((t=>t.id===e));return n?{type:"inline",tagName:"schema-option",attributes:{option:n.value},children:[]}:[]}))})))};t.schemas[r.name]=e;break}default:(0,l().HB)(o)}})))}async function oe(e){const{block:t,node:n,loadRecordModel:o,intl:s,currentTimeZone:d}=e,c=t.getCollectionPointer(),u=c&&await o(c);u&&"database-views"!==n.tagName&&await re({collectionPointedTo:u,node:n,loadRecordModel:o});const p=await(0,M().wC)({block:t,loadRecordModel:o}),m=p?ne(p):(0,h().$I)(t.type)?(0,l().WP)({title:(0,L().RX)(s).title}):void 0;if(m)await async function({propertySchemaByIdEntries:e,block:t,node:n,intl:o,collectionPointedTo:s,loadRecordModel:d,currentTimeZone:c}){const u=new Map;await(0,i().lX)(e,25,(async([e,n])=>{if(!(0,a().Ut)(e)||!n)return;const i=pe[n.type];if(!(0,l().O)(W().GU,i))return;const p="title"===e&&(null==s?void 0:s.getName())||t.getProperty(e);switch(i){case"property-title":{const t={type:"property",tagName:i,attributes:{name:n.name},children:await Y({textValue:p,allowsText:W().GU[i].text,allowedTagNames:W().GU[i].inline,loadRecordModel:d,intl:o,currentTimeZone:c})};u.set(e,t);break}case"property-text":{const t={type:"property",tagName:i,attributes:{name:n.name},children:await Y({textValue:p,allowsText:W().GU[i].text,allowedTagNames:W().GU[i].inline,loadRecordModel:d,intl:o,currentTimeZone:c})};u.set(e,t);break}case"property-url":{const t={type:"property",tagName:i,attributes:{name:n.name},children:await Y({textValue:k().jw(k().MO(p)),allowsText:W().GU[i].text,allowedTagNames:W().GU[i].inline,loadRecordModel:d,intl:o,currentTimeZone:c})};u.set(e,t);break}case"property-email":case"property-phone-number":{const t={type:"property",tagName:i,attributes:{name:n.name},children:await Y({textValue:p,allowsText:W().GU[i].text,allowedTagNames:W().GU[i].inline,loadRecordModel:d,intl:o,currentTimeZone:c})};u.set(e,t);break}case"property-person":{const r=B().Bj6.fromBlock(t),a={type:"property",tagName:i,attributes:{name:n.name},children:await Y({textValue:(0,x().h)((0,S().e)({textValue:p,propertySchema:n,blockCreatorPointer:r.getCreatedByPointer()})),allowsText:W().GU[i].text,allowedTagNames:W().GU[i].inline,loadRecordModel:d,intl:o,currentTimeZone:c})};u.set(e,a);break}case"property-created-by":case"property-last-edited-by":{let r;r="property-created-by"===i?t.getCreatedByPointer():t.getLastEditedByPointer();const a={type:"property",tagName:i,attributes:{name:n.name},children:await Y({textValue:(0,x().h)(r?[r]:[]),allowsText:W().GU[i].text,allowedTagNames:W().GU[i].inline,loadRecordModel:d,intl:o,currentTimeZone:c})};u.set(e,a);break}case"property-relation":{if("relation"!==n.type)throw new Error("Invalid type for property-relation");const t=(0,w().zO)(n);if(!t)throw new Error("Invalid database id for property-relation");const r=await d({table:D().Vl,id:t});if(!r)break;if(n.connectedRelation)break;const a=(0,W().z5)(r.id),s=(await k().jB({relationValue:(0,k().n)(p),loadRecordModel:d,limit:10,propertySchema:n})).map((e=>e.pointer)),l={type:"property",tagName:i,attributes:{name:n.name,"database-id":a},children:await Y({textValue:(0,k().Ap)(s),allowsText:W().GU[i].text,allowedTagNames:W().GU[i].inline,loadRecordModel:d,intl:o,currentTimeZone:c})};u.set(e,l);break}case"property-date":{const t={type:"property",tagName:i,attributes:{name:n.name},children:await Y({textValue:p,allowsText:W().GU[i].text,allowedTagNames:W().GU[i].inline,loadRecordModel:d,intl:o,currentTimeZone:c})};u.set(e,t);break}case"property-created-time":case"property-last-edited-time":{const a=r().c9.fromMillis(t[me[i]]),s={type:"property",tagName:i,attributes:{name:n.name},children:await Y({textValue:k().m5({type:"datetime",start_date:a.toISODate(),start_time:a.toFormat("HH:mm"),time_zone:a.zone.name}),allowsText:W().GU[i].text,allowedTagNames:W().GU[i].inline,loadRecordModel:d,intl:o,currentTimeZone:c})};u.set(e,s);break}case"property-checkbox":{const t={type:"property",tagName:i,attributes:{name:n.name,checked:(0,y().w)(p)?"true":"false"},children:await Y({textValue:p,allowsText:W().GU[i].text,allowedTagNames:W().GU[i].inline,loadRecordModel:d,intl:o,currentTimeZone:c})};u.set(e,t);break}case"property-select":case"property-multi-select":case"property-status":{let t;if("select"===n.type){const e=k().L3(p,n.options||[]);t=void 0!==e?[e]:[]}else if("multi_select"===n.type)t=k().o2(p,n.options||[]);else{if("status"!==n.type)throw new Error("Unexpected property schema type");{const e=k().RZ(p,n);t=void 0!==e?[e]:[]}}const r={type:"property",tagName:i,attributes:{name:n.name},children:t.map((e=>({type:"inline",tagName:"option",attributes:{option:e},children:[]})))};u.set(e,r);break}case"property-number":{if("number"!==n.type)throw new Error("Unexpected property schema type");const t=N().ZV(b().M(p),n.number_format,o),r={type:"property",tagName:i,attributes:{name:n.name,number:t},children:await Y({textValue:p,allowsText:W().GU[i].text,allowedTagNames:W().GU[i].inline,loadRecordModel:d,intl:o,currentTimeZone:c})};u.set(e,r);break}default:(0,l().HB)(i)}}));for(const[r,i]of e){if(!i)continue;const e=u.get(r);e&&(n.properties[i.name]=e)}}({propertySchemaByIdEntries:m,block:t,node:n,intl:s,loadRecordModel:o,collectionPointedTo:u,currentTimeZone:d});else for(const r of L().vn){const e=t.getProperty(r);if(e)if("title"===r)n.text.push(...await Y({textValue:e,allowsText:!0,allowedTagNames:(0,l().uv)(W()._S),loadRecordModel:o,intl:s,currentTimeZone:d}));else{const t=ie(r,e);t&&(n.attributes[r]=t)}}}function ie(e,t){if("checked"===e)return K().q4_(t)===f().I1?"true":"false"}const ae=Symbol("CitationToStrip");function se(e){const{getRecordModel:t,currentTimeZone:n}=e;if("text"===e.type){const{nodes:r,citationHandling:o}=e,i=function(e){return e.map(((t,n)=>{if(t===ae)return;const r=t;let o=K().N8A(r);return n<e.length&&e[n+1]===ae&&(o=o.trimEnd()),n>=0&&e[n-1]===ae&&(o=o.trimStart()),0!==o.length?K().Ey_(o,K().uPN(r)):void 0})).filter(l().O9)}(r.flatMap((e=>{if("inline"===e.type){const r=function(e){if("mention-date"===e||"mention-datetime"===e||"mention-date-range"===e||"mention-datetime-range"===e)return"d";if("mention-database"===e)return"p";const t=ye[e];return t}(e.tagName);if(!r)throw new Error(`Unknown inline element: ${e.tagName}`);const i=e.children;let a;if((0,l().O)(ge,r)){const n={node:e,getRecordModel:t};a=ge[r](n)}else{if(!function(e){if((0,l().O)(fe,e))return!0;return!1}(r))throw new Error(`Unsupported annotation type: ${r}`);a=[r]}if(!a)return[];const s=se({type:"text",nodes:i,getRecordModel:t,currentTimeZone:n})||[];if(K().iGj(a))return[K().Ey_(K().Sj,[a])];if(K().gir(a))return[K().Ey_(K().Yl$,[a])];if(K().sh$(a)&&(0,l().O9)(a[1])&&0===K().AhH(s)&&(0,l().O9)(o))if("createCitations"===o.type){const e=K().cQR(a),t=z().tD.parseAssistantHref(e);if(t){if("database_query_results"===t.type){const e=t.id;return[K().wmz(K().X$({type:"query_database_result",href:a[1],queryDatabaseResultId:e}))]}if("block"===t.type){const{blockId:e}=t;return[K().wmz(K().X$({href:a[1],blockId:e,type:"block"}))]}if("slack"===t.type){const{baseUrl:e,domain:n,channelId:r,messageId:i,threadTs:s}=t;return[K().wmz(K().X$({type:"slack",href:a[1],baseUrl:e,domain:n,channelId:r,messageId:i,threadTs:s,threadHref:o.getPageLevelCitationId(t.href)}))]}if("helpdoc"===t.type){const{url:e}=t;return[K().wmz(K().X$({href:a[1],url:e,type:t.type}))]}if("helpdoc-section"===t.type){const{url:e}=t;return[K().wmz(K().X$({href:a[1],url:e,type:t.type,parentPageHref:t.parentPageHref}))]}if("microsoft-teams"===t.type){const{url:e,channelId:n,messageId:r,threadTs:i,messageType:s}=t;return[K().wmz(K().X$({href:a[1],url:e,type:"microsoft-teams",channelId:n,messageId:r,threadTs:i,messageType:s,threadHref:o.getPageLevelCitationId(t.href)}))]}if("discord"===t.type){const{url:e}=t;return[K().wmz(K().X$({type:"discord",href:a[1],url:e}))]}if((0,c().aB)(t)){const{url:e}=t;return[K().wmz(K().X$({href:a[1],url:e,type:t.type,messageId:e}))]}if("webpage"===t.type){const{url:e}=t;return[K().wmz(K().X$({href:a[1],url:e,type:"webpage"}))]}if("citation_unsupported"===t.type)return[ae];(0,l().HB)(t)}}else{if("stripCitations"===o.type)return[ae];(0,l().HB)(o)}if(K().sh$(a)&&(0,l().O9)(a[1])){const e=K().cQR(a),t=z().tD.parseAssistantHref(e);if(t)if("slack"===t.type){const{baseUrl:e,domain:n,channelId:r,messageId:o,threadTs:i}=t,s=(0,p().mQ)({baseUrl:e,domain:n,channelId:r,messageId:o,threadTs:i});a=K().Sez(s)}else"google-drive"!==t.type&&"github"!==t.type&&"webpage"!==t.type&&"helpdoc"!==t.type&&"helpdoc-section"!==t.type||(a=K().Sez(t.url))}const d=a;return s.map((e=>K().Ey_(K().N8A(e),[d,...K().uPN(e)])))}if("text"===e.type)return[K().Ey_(e.value,[])];(0,l().HB)(e)}))),a="createCitations"!==(null==o?void 0:o.type)?i:function({tokens:e,getPageLevelCitationId:t}){const n=e=>{var n;if(!K().qXl(e))return;const r=null===(n=K().g2K(e[1]))||void 0===n?void 0:n[1].href;return r?t(r):void 0};return e.filter(((t,r)=>{if(0===r)return!0;const o=n(t);return!(0,l().O9)(o)||o!==n(e[r-1])}))}({tokens:i,getPageLevelCitationId:o.getPageLevelCitationId});return K().__s(a)}{const{property:r,nodes:i}=e;if("property-title"===r.tagName||"property-text"===r.tagName||"property-url"===r.tagName||"property-email"===r.tagName||"property-phone-number"===r.tagName)return se({type:"text",nodes:i,getRecordModel:t,currentTimeZone:n});if("property-person"===r.tagName){const e=o().oE(i.map((e=>"inline"===e.type&&"mention-person"===e.tagName?e.attributes["person-id"]:void 0)));return(0,x().h)(e.map((e=>({table:q().oo,id:e}))))}if("property-relation"===r.tagName){const e=o().oE(i.map((e=>{if("inline"===e.type&&"mention-page"===e.tagName)return e.attributes["page-id"]})));return(0,k().Ap)(e.map((e=>({table:E().ev,id:e}))))}if("property-date"===r.tagName){if(1!==i.length)throw new Error("Date property XML definition is invalid - should only have 1 mention");const e=i[0];if("inline"!==e.type)throw new Error("Date property XML definition should only have inline children");if("mention-date"===e.tagName)return k().m5({type:"date",start_date:e.attributes.date});if("mention-date-range"===e.tagName)return k().m5({type:"daterange",start_date:e.attributes["start-date"],end_date:e.attributes["end-date"]});if("mention-datetime"===e.tagName)return k().m5({type:"datetime",start_date:e.attributes.date,start_time:e.attributes.time,time_zone:n});if("mention-datetime-range"===e.tagName)return k().m5({type:"datetimerange",start_date:e.attributes["start-date"],end_date:e.attributes["end-date"],start_time:e.attributes["start-time"],end_time:e.attributes["end-time"],time_zone:n});throw new Error("Date property XML mention option is invalid")}if("property-checkbox"===r.tagName)return"true"===r.attributes.checked?f().h4:f().ZO;if("property-select"===r.tagName||"property-status"===r.tagName){const e=o().oE(i.map((e=>"inline"===e.type&&"option"===e.tagName?e.attributes.option:void 0)))[0];return k().U8(e)}if("property-multi-select"===r.tagName){const e=o().oE(i.map((e=>"inline"===e.type&&"option"===e.tagName?e.attributes.option:void 0)));return k().rK(e)}if("property-number"===r.tagName){const e=r.attributes.number,t=e?N().$J(e):void 0;return v().h(t)}if("property-created-time"===r.tagName||"property-last-edited-time"===r.tagName||"property-created-by"===r.tagName||"property-last-edited-by"===r.tagName)throw new Error(`You should not manually edit metadata of type ${r.tagName}.`);(0,l().HB)(r)}}const le={text:"text",page:"page",bulleted_list:"uli",numbered_list:"oli",toggle:"toggle",quote:"quote",factory:"factory",button:"button",to_do:"todo",column_list:"columns",column:"column",embed:"unknown-block",framer:"unknown-block",tweet:"unknown-block",gist:"unknown-block",drive:"unknown-block",figma:"unknown-block",loom:"unknown-block",typeform:"unknown-block",codepen:"unknown-block",audio:"unknown-block",maps:"unknown-block",invision:"unknown-block",image:"unknown-block",pdf:"unknown-block",video:"unknown-block",file:"unknown-block",bookmark:"unknown-block",equation:"math-block",code:"code-block",header:"h1",sub_header:"h2",sub_sub_header:"h3",collection_view:"database-views",collection_view_page:"database-views",breadcrumb:"breadcrumb",copy_indicator:"unknown-block",link_to_page:"link_to_page",link_to_collection:"link_to_collection",alias:"link-page",transclusion_container:"synced-block",transclusion_reference:"synced-block-reference",divider:"hr",callout:"callout",table_of_contents:"tableofcontents",whimsical:"unknown-block",miro:"unknown-block",abstract:"unknown-block",sketch:"unknown-block",excalidraw:"unknown-block",replit:"unknown-block",hex:"unknown-block",deepnote:"unknown-block",mixpanel:"unknown-block",post:"unknown-block",external_object_instance:"unknown-block",workflow:"unknown-block",transcription:"transcript",external_object_instance_page:"unknown-block",table:"table",table_row:"tr",tab:"tab",ai_block:"ai-block",drawing:"drawing",slide:"slide",mail:"mail-block",personal_home_page:"page",home_shortcuts:"page",form:"page"},de={...(0,d().MU)((0,l().WP)(le).map((([e,t])=>[t,e]))),"child-page":"page","child-database":"page","link-page":"alias","link-database":"alias",page:"page"},ce={[h().xd.header]:"h1",[h().xd.subHeader]:"h2",[h().xd.subSubHeader]:"h3"},ue=(0,d().AH)(ce),pe={title:"property-title",text:"property-text",url:"property-url",email:"property-email",phone_number:"property-phone-number",checkbox:"property-checkbox",person:"property-person",created_by:"property-created-by",last_edited_by:"property-last-edited-by",file:"property-file",select:"property-select",multi_select:"property-multi-select",status:"property-status",number:"property-number",date:"property-date",created_time:"property-created-time",last_edited_time:"property-last-edited-time",last_visited_time:"property-last-visited-time",formula:"property-formula",rollup:"property-rollup",button:"property-button",auto_increment_id:"property-id",location:"property-location",verification:"property-verification",place:"property-geo-point",relation:"property-relation"},me=o().B8(pe),he={b:"b",i:"i",s:"s",c:"code","~":"~",_:"u","+":"+","-":"-",z:"z",u:"mention-person",r:"r",p:"mention-page",ds:"mention-data-source",dst:"dst",ce:"ce",pt:"pt",d:"mention-date",eoi:"eoi",tv:"tv",cm:"cm",m:"m",a:"a",h:"h",e:"e",et:"et",xt:"xt",st:"st",fpp:"fpp",fv:"fv",g:"group",t:"team",mark:"find-highlight",smark:"selected-find-highlight",ci:"ci",cit:"cit",tc:"tc",si:"si",sr:"sr",sa:"sa",sua:"sua",mabf:"mabf",dut:"dut",ht:"ht",lm:"mention-link",aic:"mention-database",tch:"tch",tsu:"tsu",plc:"plc",sm:"mention-slack",sf:"sf",sfct:"sfct",sflet:"sflet",to:"to",so:"so"},ge={u:({node:e})=>{if(!e.attributes["person-id"])throw new Error(`Missing attribute person-id for inline element ${e.tagName}`);return["u",e.attributes["person-id"]]},p:({node:e,getRecordModel:t})=>{if("mention-page"===e.tagName){if(!e.attributes["page-id"])throw new Error(`Missing attribute page-id for inline element ${e.tagName}`);return["p",e.attributes["page-id"]]}if("mention-database"===e.tagName){if(!e.attributes["database-id"])throw new Error(`Missing attribute database-id for inline element ${e.tagName}`);const n=t({id:e.attributes["database-id"],table:D().Vl}),r=null==n?void 0:n.getParentPointer();if((null==r?void 0:r.table)===E().ev)return["p",r.id]}else(0,l().HB)(e)},d:({node:e})=>"mention-date-range"===e.tagName?["d",{start_date:e.attributes["start-date"],end_date:e.attributes["end-date"],type:"daterange"}]:"mention-date"===e.tagName?["d",{start_date:e.attributes.date,type:"date"}]:"mention-datetime"===e.tagName?["d",{start_date:e.attributes.date,start_time:e.attributes.time,time_zone:(0,C().P)(),type:"datetime"}]:"mention-datetime-range"===e.tagName?["d",{start_date:e.attributes["start-date"],start_time:e.attributes["start-time"],end_date:e.attributes["end-date"],end_time:e.attributes["end-time"],time_zone:(0,C().P)(),type:"datetimerange"}]:void(0,l().HB)(e),a:({node:e})=>{if(!e.attributes.href)throw new Error(`Missing attribute href for inline element ${e.tagName}`);return["a",e.attributes.href]},h:({node:e})=>{if(!e.attributes.color)throw new Error(`Missing color attribute for inline element ${e.tagName}`);if(!W().Bt.includes(e.attributes.color))throw new Error(`Bad color attribute for inline element: ${e.attributes.color}`);return["h",W().BP[e.attributes.color]]},lm:({node:e})=>{if(!e.attributes.href)throw new Error(`Missing attribute href for inline element ${e.tagName}`);return["lm",{href:e.attributes.href,title:e.attributes.title,description:e.attributes.description,icon_url:e.attributes.icon_url}]},e:({node:e})=>{if(!e.attributes.equation)throw new Error(`Missing attribute equation for inline element ${e.tagName}`);return["e",e.attributes.equation]}},fe={[K().Ifu.Bold]:!0,[K().Ifu.Italic]:!0,[K().Ifu.Strike]:!0,[K().Ifu.Code]:!0,[K().Ifu.FormulaError]:!0,[K().Ifu.Underline]:!0,[K().Ifu.Inserted]:!0,[K().Ifu.Deleted]:!0,[K().Ifu.TemporaryComment]:!0,[K().Ifu.TemporaryCursor]:!0,[K().Ifu.TemporaryPage]:!0,[K().Ifu.TemporaryCitation]:!0,[K().Ifu.TemporaryCollection]:!0,[K().Ifu.TemporaryEquation]:!0,[K().Ifu.TemporarySelection]:!0,[K().Ifu.TemporaryFindHighlight]:!0,[K().Ifu.TemporarySelectedFindHighlight]:!0,[K().Ifu.TemporaryCommentHighlight]:!0,[K().Ifu.TitleOnly]:!0};const ye=(0,d().AH)(he);async function ve(e){return{type:"instructions",tagName:"instructions",attributes:{},children:e.shouldUsePlaceholderRecordInformation?await Y({textValue:e.textValue,allowsText:!0,allowedTagNames:W().qI,intl:e.intl,shouldUsePlaceholderRecordInformation:!0,currentTimeZone:e.currentTimeZone}):await Y({textValue:e.textValue,allowsText:!0,allowedTagNames:W().qI,loadRecordModel:e.loadRecordModel,intl:e.intl,currentTimeZone:e.currentTimeZone})}}function be(e){const{inlineNodes:t,idMapper:n,humanChatTag:r}=e,o=function(e){const{inlineNodes:t,idMapper:n}=e;return`<text>${t.map((e=>n.mapNodeKeyToCounter(e))).map((e=>(0,$().sD)({node:e,selection:void 0,namespace:"end_to_end"}))).join("")}</text>`}({inlineNodes:t,idMapper:n});return`<${r}>${o}</${r}>`}function xe(e){const t=function(e){const{chatValue:t,evaluatorState:n}=e,r=n.getIdMapper(),o=(0,G().gO)(n.parse(t),H().p$),i=(0,_().$d)((0,Q().dl)({allocateIdFn:()=>(0,W().ew)(A().Dt()),mapCounterToKey:e=>r.mapCounterToKey(e)}),o);return s().Q.isSuccess(i)?i.value.children:[]}({chatValue:e.humanChatValue,evaluatorState:e.evaluatorState});return t.flatMap((e=>{if("text"in e)return e.text})).filter(l().O9)}},438632:(e,t,n)=>{n.d(t,{PD:()=>u,cb:()=>d,hl:()=>p});n(16280),n(944114),n(898992),n(354520),n(803949),n(581454);var r=n.n(n(625473)),o=n.n(n(716471)),i=()=>n(496603),a=()=>n(534177),s=()=>n(634201),l=()=>n(201980);let d=function(e){return e[e.removed=-1]="removed",e[e.added=1]="added",e[e.same=0]="same",e}({});const c=1e4;function u(e,t){const n=new(o())({timeout:2,editCost:6}),r=n.main(t,e);return n.cleanupSemantic(r),r}function p(e){const t=performance.now(),{before:n,after:o,isIncompleteAfter:p,insertCursor:m}=e,h=l().AhH(n),g=l().AhH(o);if(Math.max(h,g)>c)return{diffValue:o,metrics:{beforeLength:h,afterLength:g,latencyMs:performance.now()-t}};const f={count:0,encoding:{},decoding:{},annotationEncoding:{},annotationDecoding:{}},y=e=>{const t=f.encoding[e];if(t)return t;{const t=String.fromCharCode(f.count);return f.count++,f.encoding[e]=t,f.decoding[t]=e,t}},v=e=>{const t=r()(e),n=f.annotationEncoding[t];if(n)return n;{const n=String.fromCharCode(f.count);return f.count++,f.annotationEncoding[t]=n,f.annotationDecoding[n]=e,n}},b=t=>i().Bq(l().RQ(t).map((t=>{let n=[];if("word"===e.mode||"wordUnderlineFinal"===e.mode){if("undefined"==typeof Intl||!Intl.Segmenter)throw new Error("Intl.Segmenter is not supported");{const e=new Intl.Segmenter(void 0,{granularity:"word"}).segment(t[0]);n=Array.from(e).map((e=>e.segment))}}else n=s().PE(t[0]);const r=n.map(y);if(l().qXl(t)){const e=l().uPN(t),n=l().jhx(e);n&&(r[0]=v({type:"mention",value:n}),e.forEach((e=>{l().iGj(e)||l().gir(e)||l().lfl(e)||(r.unshift(v({type:"start",value:e})),r.push(v({type:"end",value:e})))})))}else if(l().GiG(t)){const e=l().uPN(t),n=l().j1D(e);if(n){r[0]=v({type:"equation",value:n});for(const t of e)l().iGj(t)||l().gir(t)||l().lfl(t)||(r.unshift(v({type:"start",value:t})),r.push(v({type:"end",value:t})))}}else if(l().BEe(t)){l().uPN(t).forEach((e=>{r.unshift(v({type:"start",value:e})),r.push(v({type:"end",value:e}))}))}return r}))).join("");if(f.count>65535)throw new Error("This string has way too many different characters.");const x=u(b(o),b(n)),S=[];let w=[],k=0;const I=p?i().Kl(x,(e=>0===e[0]||1===e[0])):0;let T=!1;const M=e.insertionAnnotation,C=e.deletionAnnotation;x.forEach((([t,n])=>{n.split("").forEach((n=>{if(f.decoding[n]){const r=f.decoding[n];t===d.added?S.push([r,[...w,"wordUnderlineFinal"===e.mode?e.underlineAnnotation:M]]):t===d.removed&&(!p||k<=I)?"wordUnderlineFinal"!==e.mode&&S.push([r,[...w,C]]):(p&&m&&!T&&k===I+1&&(T=!0,S.push(["",[["tc"]]])),S.push([r,w]))}else{const r=f.annotationDecoding[n];if(t===d.added)if("mention"===r.type)S.push([l().Sj,[...w,"wordUnderlineFinal"===e.mode?e.underlineAnnotation:M,r.value]]);else if("start"===r.type)w=[...w,r.value];else if("end"===r.type)w=w.filter((e=>!i().n4(e,r.value)));else if("equation"===r.type){const e=l().U35(r.value),t=l().G0H(e,[...w,M]);S.push(t)}else(0,a().HB)(r);else if(t===d.removed){if("mention"===r.type)"wordUnderlineFinal"!==e.mode&&S.push([l().Sj,[...w,C,r.value]]);else if("equation"===r.type){const e=l().U35(r.value),t=l().G0H(e,[...w,C]);S.push(t)}}else if(t===d.same)if("mention"===r.type)S.push([l().Sj,[...w,r.value]]);else if("start"===r.type)w=[...w,r.value];else if("end"===r.type)w=w.filter((e=>!i().n4(e,r.value)));else if("equation"===r.type){const e=l().U35(r.value),t=l().G0H(e,w);S.push(t)}else(0,a().HB)(r)}})),p&&(k+=1)}));return{diffValue:l().__s(S),metrics:{beforeLength:h,afterLength:g,latencyMs:performance.now()-t}}}},471159:(e,t,n)=>{n.d(t,{gO:()=>b});n(16280),n(18107),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(967357),n(898992),n(823215),n(354520),n(672577),n(430670),n(581454),n(737550);var r=()=>n(496603),o=()=>n(534177),i=()=>n(412412),a=()=>n(252050),s=()=>n(968579),l=()=>n(762282),d=(n(803949),n.n(n(42833))),c=n.n(n(542922));const u={h1:{disableRules:["list"]},h2:{disableRules:["list"]},h3:{disableRules:["list"]},text:{disableRules:[]},uli:{disableRules:["heading"]},oli:{disableRules:[]},toggle:{disableRules:[]},quote:{disableRules:[]},todo:{disableRules:[]}};function p(e){return"element"===e.type&&void 0!==u[e.tagName]}class m extends l().o0{constructor(...e){super(...e),this.name="ConvertUliWithNumberToOli"}applyImpl(e,t){return e.map((e=>this.convertUliWithNumberToOli(e)))}convertUliWithNumberToOli(e){if("text"===e.type)return e;if("uli"===e.tagName){const t=(e.children.length>0&&"text"===e.children[0].type?e.children[0].value:"").match(/^(\d+)\.\s(.*)$/);if(t){const n=[...e.children.slice(1)];""!==t[2]&&n.unshift({type:"text",value:t[2]}),e={type:"element",tagName:"oli",attributes:{index:t[1]},children:n},this.markModified()}return e}return{...e,children:e.children.map((e=>this.convertUliWithNumberToOli(e)))}}}class h extends l().o0{constructor(...e){super(...e),this.name="ConvertMarkdownFormattingToXMLUsingMarkdownIt"}applyImpl(e,t){return e.flatMap((e=>this.convertMarkdownFormattingToXMLUsingMarkdownIt(e)))}convertMarkdownFormattingToXMLUsingMarkdownIt(e){if("text"===e.type)return e;if(p(e)){const t=(0,i()._o)(e,!1,0,!0),r=";!--childPlaceholder--;",o="\x3c!--childPlaceholder--\x3e",a="\x3c!--lt--\x3e",s="\x3c!--gt--\x3e",l=[],p=e.children.map((e=>"element"===e.type?(l.push(e),{type:"text",value:r}):e)).map((e=>(0,i()._o)(e,!1,0,!0))).join("").replaceAll("&lt;",a).replaceAll("&gt;",s).replaceAll(r,o),{disableRules:m}=u[e.tagName];let g=(0,n(128713).uY)({markdown:p,LinkifyIt:d(),MarkdownIt:c(),options:{breaks:!0},disable:["newline",...m]}).replace(/\n+/g,"\n").replace(/>\n+</g,"><").replace(/>\n$/,">").replace(/^\n/,"");for(const[e,n]of Object.entries(h.REPLACEMENTS))g=g.replaceAll(e,n);g=g.replace(new RegExp(o,"g"),(()=>{const e=l.shift();return e?(0,i()._o)(e,!1,0,!0):""})).replaceAll(a,"&lt;").replaceAll(s,"&gt;");let f=(0,i().BD)(g);1===f.length&&"element"===f[0].type&&"text"===f[0].tagName&&(f=f[0].children);const y={...e,children:f};return t!==(0,i()._o)(y,!1,0,!0)&&this.markModified(),y}return{...e,children:e.children.flatMap((e=>this.convertMarkdownFormattingToXMLUsingMarkdownIt(e)))}}}h.REPLACEMENTS={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#46;":".","<ul>":"","</ul>":"","<li>":"<uli>","</li>":"</uli>","<strong>":"<b>","</strong>":"</b>","<em>":"<i>","</em>":"</i>","<p>":"<text>","</p>":"</text>","<br>":"\n","<br/>":"\n"};class g extends l().o0{constructor(...e){super(...e),this.name="ConvertUnicodeBulletsToUlis"}applyImpl(e,t){return e.map((e=>this.convertUnicodeBulletsToUlis(e,!1)))}convertUnicodeBulletsToUlis(e,t){if("text"===e.type){const n=e.value.trim();if(n.startsWith("•")){this.markModified();const e=n.replaceAll("•","").trim();return t?{type:"text",value:e}:{type:"element",tagName:"uli",attributes:{},children:[{type:"text",value:e}]}}return e}const n="uli"===e.tagName||"oli"===e.tagName;return{...e,children:e.children.map((e=>this.convertUnicodeBulletsToUlis(e,n)))}}}class f extends l().o0{constructor(...e){super(...e),this.name="ConvertOlUliToOli"}applyImpl(e,t){return e.map((e=>this.convertOl(e)))}convertOl(e){return"text"===e.type?e:p(e)?(e=this.convertOlUliToOli(e),e=this.removeToDeleteNodes(e)):{...e,children:e.children.map((e=>this.convertOl(e)))}}convertOlUliToOli(e){if("element"===e.type&&"ol"===e.tagName){const t=e.children.filter((e=>"element"===e.type&&"uli"===e.tagName)),n=e.children.filter((e=>!("element"===e.type&&"uli"===e.tagName)));return{...e,tagName:"toDelete",children:[...t.map((t=>{var n;return{...t,tagName:"oli",attributes:{index:null===(n=e.attributes)||void 0===n?void 0:n.start}}})),...n]}}return"element"===e.type?{...e,children:e.children.map((e=>this.convertOlUliToOli(e)))}:e}removeToDeleteNodes(e){if("element"===e.type){let t=[];return e.children.forEach((e=>{"element"===e.type&&"toDelete"===e.tagName?(this.markModified(),t=t.concat(e.children)):t.push(this.removeToDeleteNodes(e))})),{...e,children:t}}return e}}class y extends l().o0{constructor(...e){super(...e),this.name="ConvertTextChildrenOfListItems"}applyImpl(e,t){return e.flatMap((e=>this.convertTextChildrenOfListItems(e)))}convertTextChildrenOfListItems(e){return"text"===e.type?e:"oli"===e.tagName||"uli"===e.tagName||"quote"===e.tagName?{...e,children:e.children.flatMap((e=>"element"===e.type&&"text"===e.tagName?(this.markModified(),e.children):e))}:{...e,children:e.children.map((e=>this.convertTextChildrenOfListItems(e)))}}}class v extends l().o0{constructor(...e){super(...e),this.name="CollapseRedundantParentTags"}applyImpl(e,t){return e.flatMap((e=>this.collapseRedundantParentTags(e)))}collapseRedundantParentTags(e){return"text"===e.type?e:p(e)?this.generalCollapse(e):{...e,children:e.children.map((e=>this.collapseRedundantParentTags(e)))}}generalCollapse(e){if("element"===e.type){for(const[t,[n,r]]of v.collapseRules){if(("hx"===n?/^h[1-3]$/.test(e.tagName):e.tagName===n)&&1===e.children.length&&"element"===e.children[0].type){const n=e.children[0],o="hx"===r?/^h[1-3]$/.test(n.tagName):n.tagName===r;if("element"===n.type&&o)return this.markModified(),{...n,tagName:"hx"===t?e.tagName:t,attributes:{...e.attributes,...n.attributes}}}}return{...e,children:e.children.map((e=>this.generalCollapse(e)))}}return e}}function b(e,t,n){const{nodes:r}=function({xmlNodes:e,state:t,debug:n=!1,autoFixerNamesToSkip:r}){let o="",a="";const s=[],l=new Set(r??[]),d=ee.filter((e=>!l.has(e.name)));for(const c of d)n&&(o=e.map((e=>(0,i()._o)(e))).join("")),e=c.apply(e,t),n&&c.modified()&&(a=e.map((e=>(0,i()._o)(e))).join(""),s.push({name:c.name,before:o,after:a}));return{nodes:e,activeAutoFixerNames:d.filter((e=>e.modified())).map((e=>e.name)),debugLogs:s}}({xmlNodes:e,state:t,debug:!1,autoFixerNamesToSkip:n});return r}v.collapseRules=[["oli",["uli","oli"]],["uli",["hx","uli"]],["hx",["hx","oli"]],["hx",["hx","text"]],["text",["text","text"]],["b",["b","b"]],["uli",["text","uli"]],["uli",["uli","text"]],["oli",["text","oli"]],["oli",["oli","text"]],["toggle",["toggle","text"]],["quote",["quote","text"]],["todo",["todo","text"]],["oli",["oli","text"]]];class x extends l().o0{constructor(...e){super(...e),this.name="CleanupSearchTags"}applyImpl(e,t){return e.map((e=>this.cleanupSearchTags(e)))}cleanupSearchTags(e){if("element"!==e.type)return e;if("search"!==e.tagName)return e;const t=Object.fromEntries(Object.entries(e.attributes).map((([e,t])=>{if("question"===e||"keywords"===e||"question-intl"===e)return[e,t];if("source"===e){const e=t;return s().Ut.includes(e)?["source",e]:void this.markModified()}if("lookback"===e)return["lookback",t];if("channel"===e)return["channel",t];if("sort"===e)return["sort",t];if("file-type"===e){const e=t;return s().Km.includes(e)?["file-type",e]:void this.markModified()}return"contributor"===e?["contributor",t]:"repo"===e?["repo",t]:"database"===e?["database",t]:"database-id"===e?(this.markModified(),["database",t]):"search-notion-help"===e&&"true"===t?["search-notion-help","true"]:void this.markModified()})).filter((e=>void 0!==e)));return{...e,attributes:t}}}class S extends l().o0{constructor(...e){super(...e),this.name="CollapseTableSectionTags"}applyImpl(e,t){return e.flatMap((e=>this.collapseTableSectionTags(e)))}collapseTableSectionTags(e){return"element"===e.type?"thead"===e.tagName||"tbody"===e.tagName||"tfoot"===e.tagName?(this.markModified(),e.children.flatMap((e=>this.collapseTableSectionTags(e)))):[{...e,children:e.children.flatMap((e=>this.collapseTableSectionTags(e)))}]:[e]}}class w extends l().o0{constructor(...e){super(...e),this.name="CitationATagInnerTextRemover"}applyImpl(e,t){return e.map((e=>"element"===e.type&&"chat"===e.tagName?{...e,children:e.children.flatMap((e=>this.ensureCitationATagsHaveNoInnerText(e)))}:e))}ensureCitationATagsHaveNoInnerText(e){if("element"===e.type){if("a"===e.tagName){const t=e.attributes.href;if(t&&/^[0-9]+$/.test(t)){e.children.length>0&&this.markModified();const t=e.children.flatMap((e=>this.ensureCitationATagsHaveNoInnerText(e)));return e.children=[],[...t,e]}}const{children:t,...n}=e;return[{...n,children:t.flatMap((e=>this.ensureCitationATagsHaveNoInnerText(e)))}]}return[e]}}class k extends l().o0{constructor(...e){super(...e),this.name="MarkdownInlineNodeConverter"}applyImpl(e,t){return e.map((e=>"element"===e.type&&"chat"===e.tagName?{...e,children:e.children.flatMap((e=>this.convertInlineMarkdownToXML(e,[])))}:e))}convertInlineMarkdownToXML(e,t){const n=t.some((e=>"element"===e.type&&("code-block"===e.tagName||"code"===e.tagName||"math-block"===e.tagName)));if("text"!==e.type||n)return"element"===e.type?[{...e,children:e.children.flatMap((n=>this.convertInlineMarkdownToXML(n,[...t,e])))}]:[e];{const t=/(\*\*|~~|\*|`)(.+?)\1/g,n=[];let r,o=0;for(;null!==(r=t.exec(e.value));){const[i,a,s]=r,l=e.value.slice(o,r.index);let d;switch(l&&n.push({type:"text",value:l}),a){case"**":d={type:"element",tagName:"b",attributes:{},children:[{type:"text",value:s}]};break;case"*":d={type:"element",tagName:"i",attributes:{},children:[{type:"text",value:s}]};break;case"`":d={type:"element",tagName:"code",attributes:{},children:[{type:"text",value:s}]};break;case"~~":d={type:"element",tagName:"s",attributes:{},children:[{type:"text",value:s}]}}if(!d)throw new Error("Unreachable");n.push(d),this.markModified(),o=t.lastIndex}const i=e.value.slice(o);return i&&n.push({type:"text",value:i}),n}}}class I extends l().o0{constructor(...e){super(...e),this.name="RemoveExtraSearchNotionHelpAttributes"}applyImpl(e,t){const n=e.map((e=>(0,i()._o)(e))).join(""),r=this.removeExtraSearchNotionHelpAttributes(e);return n!==r.map((e=>(0,i()._o)(e))).join("")&&this.markModified(),r}removeExtraSearchNotionHelpAttributes(e){let t=!1;return e.map((e=>("element"===e.type&&"search"===e.tagName&&a().HV in e.attributes&&(t?(this.markModified(),delete e.attributes[a().HV]):t=!0),e)))}}class T extends l().o0{constructor(...e){super(...e),this.name="DowngradeBlocksToTextInSimpleTables"}applyImpl(e,t){return e.map((e=>this.downgradeBlocksToTextInSimpleTables(e)))}downgradeBlocksToTextInSimpleTables(e){return"text"===e.type?e:"table"===e.tagName?{...e,children:e.children.flatMap((e=>this.maybeConvertToInlineNode(e)))}:{...e,children:e.children.map((e=>this.downgradeBlocksToTextInSimpleTables(e)))}}maybeConvertToInlineNode(e){if("text"===e.type||(0,l().Qz)(e))return[e];if("text"===e.tagName||"h2"===e.tagName||"h1"===e.tagName||"h3"===e.tagName||"quote"===e.tagName||"todo"===e.tagName||"toggle"===e.tagName||"callout"===e.tagName||"code-block"===e.tagName||"math-block"===e.tagName)return this.markModified(),e.children.flatMap((e=>this.maybeConvertToInlineNode(e)));if("uli"===e.tagName||"oli"===e.tagName){const t=e.children.flatMap((e=>this.maybeConvertToInlineNode(e)));return this.markModified(),[{type:"text",value:"· "},...t]}{const t=e.children.flatMap((e=>this.maybeConvertToInlineNode(e)));return[{...e,children:t}]}}}class M extends l().o0{constructor(...e){super(...e),this.name="TextWrapTopLevelInlineNodes"}applyImpl(e,t){return e.map((e=>"element"!==e.type||"chat"!==e.tagName&&"insert"!==e.tagName&&"insert-before"!==e.tagName&&"insert-after"!==e.tagName&&"create-page"!==e.tagName&&"replace"!==e.tagName?e:this.textWrapTopLevelInlineNodes(e)))}textWrapTopLevelInlineNodes(e){if("element"===e.type){const t=[],n=this.trimLeadingAndTrailingWhitespace(e.children),r=e=>{if(e&&"element"===e.type&&(0,l().Y7)(e)){const t=e.children.at(-1);return!t||(0,l().Qz)(t)}return!1};for(const e of n)if((0,l().Qz)(e)){this.markModified();const n=t.at(-1);"element"===(null==n?void 0:n.type)&&r(n)?n.children.push(e):t.push({type:"element",tagName:"text",attributes:{},children:[e]})}else t.push(e);return{...e,children:t}}return e}}class C extends l().o0{constructor(...e){super(...e),this.name="WrapNodesWithRequiredParent",this.wrapNodesMap={td:"tr",tr:"table"}}applyImpl(e,t){return e.map((e=>this.wrapNodesWithRequiredParent(e)))}wrapNodesWithRequiredParent(e){if("element"===e.type){let t=e;for(const n of(0,o().uv)(this.wrapNodesMap))t.tagName!==this.wrapNodesMap[n]&&e.children.some((e=>"element"===e.type&&e.tagName===n))&&(this.markModified(),t={...e,children:[{type:"element",tagName:this.wrapNodesMap[n],attributes:{},children:e.children}]});return{...t,children:t.children.map((e=>this.wrapNodesWithRequiredParent(e)))}}return e}}class j extends l().o0{constructor(...e){super(...e),this.name="UnwrapHTMLLists"}applyImpl(e,t){return e.flatMap((e=>this.unwrapHTMLLists(e,void 0)))}unwrapHTMLLists(e,t){return"element"===e.type?"ul"===e.tagName||"ol"===e.tagName?(this.markModified(),e.children.flatMap((t=>this.unwrapHTMLLists(t,e.tagName)))):"li"===e.tagName?(this.markModified(),[{...e,tagName:"ol"===t?"oli":"uli",children:e.children.flatMap((e=>this.unwrapHTMLLists(e,t)))}]):[{...e,children:e.children.flatMap((e=>this.unwrapHTMLLists(e,t)))}]:[e]}}class A extends l().o0{constructor(...e){super(...e),this.name="RemoveBlockIds"}applyImpl(e,t){return e.map((e=>this.removeBlockIds(e)))}removeBlockIds(e){if("element"===e.type){if((0,l().CD)(e)&&"unknown-block"!==e.tagName){e.attributes.id&&this.markModified();const t=r().cJ(e.attributes,"id");return{...e,attributes:t,children:e.children.map((e=>this.removeBlockIds(e)))}}return{...e,children:e.children.map((e=>this.removeBlockIds(e)))}}return e}}class B extends l().o0{constructor(...e){super(...e),this.name="FixCodeBlockLanguage"}applyImpl(e,t){return e.map((e=>this.fixCodeBlockLanguage(e)))}fixCodeBlockLanguage(e){if("element"===e.type){if("code-block"===e.tagName){const t=e.attributes.language;if(t&&!n(15440).yz.includes(t)){this.markModified();const t=r().cJ(e.attributes,"language");return{...e,attributes:t,children:e.children.map((e=>this.fixCodeBlockLanguage(e)))}}}return{...e,children:e.children.map((e=>this.fixCodeBlockLanguage(e)))}}return e}}class N extends l().o0{constructor(...e){super(...e),this.name="SanitizeTextNodes"}applyImpl(e,t){const n=e.map((e=>(0,i()._o)(e))).join(""),o=r().oE(e.map((e=>this.sanitizeTextNodes(e))));return n!==(0,i().PJ)(o)&&(this.modified()||this.markModified()),o}sanitizeTextNodes(e){if("element"===e.type){if((0,o().O)(a().sA,e.tagName)&&a().sA[e.tagName].title){let t=!1;const n=[...e.children],r=[],o=[];for(;n.length>0;){const e=n.shift();if((0,l().Qz)(e))if(t){const t=[e];for(;n.length>0&&(0,l().Qz)(n[0]);)t.push(n.shift());const o=this.trimLeadingAndTrailingWhitespace(t);o.length>0&&r.push({type:"element",tagName:"text",attributes:{},children:o})}else o.push(e);else{const n=this.sanitizeTextNodes(e);n&&r.push(n),t=!0}}const i=[...this.trimLeadingAndTrailingWhitespace(o),...r];return{...e,children:i}}return(0,o().O)(a().GU,e.tagName)?{...e,children:this.trimLeadingAndTrailingWhitespace(e.children)}:{...e,children:e.children?r().oE(e.children.map((e=>this.sanitizeTextNodes(e)))):[]}}{const t=e.value.trim();if(t)return t!==e.value?{...e,value:t}:e}}}class _ extends l().o0{constructor(...e){super(...e),this.name="TrimLinesBetweenBrTags"}applyImpl(e,t){return e.map((e=>this.trimLinesBetweenBrTags(e)))}trimLinesBetweenBrTags(e){if("element"===e.type){if(e.children.some((e=>"element"===e.type&&"br"===e.tagName))){const t=e.children.map((e=>{if("text"===e.type){const t=e.value.trim();return t!==e.value?(this.markModified(),{type:"text",value:t}):e}return this.trimLinesBetweenBrTags(e)}));return{...e,children:t}}return{...e,children:e.children.map((e=>this.trimLinesBetweenBrTags(e)))}}return e}}class R extends l().o0{constructor(...e){super(...e),this.name="ConvertBrToNewline"}applyImpl(e,t){return e.flatMap((e=>this.convertBrToNewline(e)))}convertBrToNewline(e){return"element"===e.type?"br"===e.tagName?(this.markModified(),[{type:"text",value:"\n"}]):[{...e,children:e.children.flatMap((e=>this.convertBrToNewline(e)))}]:[e]}}class P extends l().o0{constructor(...e){super(...e),this.name="RemoveTopLevelWhitespace"}applyImpl(e,t){return e.flatMap((e=>"text"===e.type?(this.markModified(),[]):[e]))}}class E extends l().o0{constructor(...e){super(...e),this.name="ClampHeaderLevel",this.headerRegex=/^h(\d+)$/}applyImpl(e,t){return e.map((e=>this.clampHeaderLevel(e)))}clampHeaderLevel(e){if("element"!==e.type)return e;let t=e.tagName;const n=e.tagName.match(this.headerRegex);if(n){parseInt(n[1],10)>3&&(this.markModified(),t="h3")}return{...e,tagName:t,children:e.children.map((e=>this.clampHeaderLevel(e)))}}}class D extends l().o0{constructor(...e){super(...e),this.name="MoveCreatePageInChatToTopLevel"}applyImpl(e,t){return e.flatMap((e=>this.moveCreatePageInChatToTopLevel(e)))}moveCreatePageInChatToTopLevel(e){if("element"===e.type&&"chat"===e.tagName){const t=e.children.filter((e=>"element"===e.type&&"create-page"===e.tagName));if(0===t.length)return[e];this.markModified();const n=e.children.filter((e=>!t.includes(e)));return[{...e,children:n},...t]}return[e]}}class O extends l().o0{constructor(...e){super(...e),this.name="TransformTopLevelApisInCreatePageToCreatePage"}applyImpl(e,t){return e.map((e=>this.transformTopLevelApisInCreatePageToCreatePage(e)))}transformTopLevelApisInCreatePageToCreatePage(e){const t=["page","insert"];if("element"===e.type&&"create-page"===e.tagName){let n,r=[];for(const o of e.children)"element"===o.type&&t.includes(o.tagName)?(n||(n=o),r=[...r,...o.children]):r.push(o);return n?(this.markModified(),{type:"element",tagName:"create-page",attributes:{...n.attributes,...e.attributes.in&&{in:e.attributes.in}},children:r}):e}return e}}class F extends l().o0{constructor(...e){super(...e),this.name="MoveTopLevelCreateOrPageToCreatePage"}applyImpl(e,t){return e.map((e=>this.moveTopLevelCreateOrPageToCreatePage(e)))}moveTopLevelCreateOrPageToCreatePage(e){return"element"===e.type&&"page"===e.tagName?(this.markModified(),{type:"element",tagName:"create-page",attributes:{},children:e.children}):"element"===e.type&&"create"===e.tagName&&1===e.children.length&&"element"===e.children[0].type&&"page"===e.children[0].tagName?(this.markModified(),{type:"element",tagName:"create-page",attributes:{},children:e.children[0].children}):e}}class q extends l().o0{constructor(...e){super(...e),this.name="TagNameMapper",this.inlineTagNameMap={strong:"b",p:"text",span:"inline",sub:"inline",sup:"inline"}}applyImpl(e,t){return e=(e=e.flatMap((e=>this.mapTagNames(e,this.inlineTagNameMap)))).map((e=>"element"===e.type&&"chat"===e.tagName?{...e,children:e.children.flatMap((e=>this.mapTagNames(e,{chat:"text"})))}:e))}mapTagNames(e,t){if("element"===e.type){const n=t[e.tagName.toLowerCase()];if(void 0!==n&&this.markModified(),"inline"===n){return{type:"text",value:e.children.map((e=>"text"===e.type?e.value:"")).join("")}}const r=n||e.tagName;return{...e,tagName:r,children:e.children.map((e=>this.mapTagNames(e,t)))}}return e}}class L extends l().o0{constructor(...e){super(...e),this.name="UnwrapEmptyBlocks"}applyImpl(e,t){return e.flatMap((e=>this.unwrapEmptyBlocks(e)))}unwrapEmptyBlocks(e){if("element"===e.type){return!e.children.every((e=>(0,l().CD)(e)))||"uli"!==e.tagName&&"oli"!==e.tagName&&"text"!==e.tagName&&"toggle"!==e.tagName&&"quote"!==e.tagName?[{...e,children:e.children.flatMap((e=>this.unwrapEmptyBlocks(e)))}]:(this.markModified(),e.children.flatMap((e=>this.unwrapEmptyBlocks(e))))}return[e]}}class K extends l().o0{constructor(...e){super(...e),this.name="UnwrapSyncedBlocks"}applyImpl(e,t){return e.flatMap((e=>this.unwrapSyncedBlocks(e)))}unwrapSyncedBlocks(e){return"element"===e.type?"synced-block-reference"===e.tagName||"synced-block"===e.tagName?(this.markModified(),e.children.flatMap((e=>this.unwrapSyncedBlocks(e)))):[{...e,children:e.children.flatMap((e=>this.unwrapSyncedBlocks(e)))}]:[e]}}class U extends l().o0{constructor(...e){super(...e),this.name="RemoveDisallowedBlocks"}applyImpl(e,t){return e.flatMap((e=>this.removeDisallowedBlocks(e)))}removeDisallowedBlocks(e){return"element"===e.type?U.removeBlockTagNames[e.tagName]?(this.markModified(),[]):[{...e,children:e.children.flatMap((e=>this.removeDisallowedBlocks(e)))}]:[e]}}U.removeBlockTagNames={"database-views":!0};class V extends l().o0{constructor(...e){super(...e),this.name="UnwrapBlocksInProperties"}applyImpl(e,t){return e.flatMap((e=>this.unwrapBlocksInProperties(e)))}unwrapBlocksInProperties(e){if("element"===e.type){if((0,l().YV)(e))return[{...e,children:e.children.flatMap((e=>this.unwrapBlocks(e)))}];{const t=e;return[{...t,children:t.children.flatMap((e=>this.unwrapBlocksInProperties(e)))}]}}return[e]}unwrapBlocks(e){if("element"===e.type){if((0,l().CD)(e))return this.markModified(),[...e.children.flatMap((e=>this.unwrapBlocks(e))),{type:"text",value:"\n"}];{const t=e;return[{...t,children:t.children.flatMap((e=>this.unwrapBlocks(e)))}]}}return[e]}}class z extends l().o0{constructor(...e){super(...e),this.name="RemoveUnsupportedProperties"}applyImpl(e,t){return e.flatMap((e=>this.removeUnsupportedProperties(e)))}removeUnsupportedProperties(e){return"element"===e.type?"property-created-time"===e.tagName||"property-last-edited-time"===e.tagName||"property-created-by"===e.tagName||"property-last-edited-by"===e.tagName?(this.markModified(),[]):[{...e,children:e.children.flatMap((e=>this.removeUnsupportedProperties(e)))}]:[e]}}class H extends l().o0{constructor(...e){super(...e),this.name="RemoveNonTitleProperties"}applyImpl(e,t){return e.flatMap((e=>"element"!==e.type||("create-page"!==e.tagName||e.attributes.in)&&"replace"!==e.tagName?[e]:this.removeNonTitleProperties(e)))}removeNonTitleProperties(e){return"element"===e.type?e.tagName.startsWith("property-")&&"property-title"!==e.tagName?(this.markModified(),[]):[{...e,children:e.children.flatMap((e=>this.removeNonTitleProperties(e)))}]:[e]}}class W extends l().o0{constructor(...e){super(...e),this.name="ConvertToggleToUli"}applyImpl(e,t){return e.map((e=>"element"===e.type&&"chat"===e.tagName?this.convertToggleToUli(e):e))}convertToggleToUli(e){return"element"===e.type?"toggle"===e.tagName?(this.markModified(),{...e,tagName:"uli",attributes:{},children:e.children.map((e=>this.convertToggleToUli(e)))}):{...e,children:e.children.map((e=>this.convertToggleToUli(e)))}:e}}class $ extends l().o0{constructor(...e){super(...e),this.name="RemoveATargetAttribute"}applyImpl(e,t){return e.map((e=>this.removeATargetAttribute(e)))}removeATargetAttribute(e){if("element"===e.type&&"a"===e.tagName&&e.attributes.target){const t=r().cJ(e.attributes,"target");return{...e,attributes:t,children:e.children.map((e=>this.removeATargetAttribute(e)))}}return e}}class G extends l().o0{constructor(...e){super(...e),this.name="JoinAdjacentTextNodes"}applyImpl(e,t){return e.map((e=>this.joinAdjacentTextNodes(e)))}joinAdjacentTextNodes(e){if("text"===e.type)return e;const t=[];for(const n of e.children){const e=t.at(-1);"text"===n.type&&e&&"text"===e.type&&""!==n.value?(this.markModified(),t[t.length-1]={type:"text",value:e.value+n.value}):t.push(this.joinAdjacentTextNodes(n))}return{...e,children:t}}}class Q extends l().o0{constructor(...e){super(...e),this.name="UnwrapPages"}applyImpl(e,t){return e.flatMap((e=>"element"!==e.type||"insert"!==e.tagName&&"chat"!==e.tagName?[e]:this.unwrapPages(e)))}unwrapPages(e){return"element"===e.type?"page"===e.tagName||"child-page"===e.tagName?(this.markModified(),e.children.flatMap((e=>this.unwrapPages(e)))):[{...e,children:e.children.flatMap((e=>this.unwrapPages(e)))}]:[e]}}class X extends l().o0{constructor(...e){super(...e),this.name="RemoveProperties"}applyImpl(e,t){return e.map((e=>"element"!==e.type||"insert"!==e.tagName&&"chat"!==e.tagName?e:this.removeProperties(e)))}removeProperties(e){if("text"===e.type)return e;if(e.children.some(l().YV)){const t=e.children.flatMap((t=>"element"!==e.type?[t]:(0,l().YV)(t)?(this.markModified(),"property-title"===t.tagName?[{type:"element",attributes:{},tagName:"h1",children:t.children}]:[]):[t]));return{...e,children:t.map((e=>this.removeProperties(e)))}}return{...e,children:e.children.map((e=>this.removeProperties(e)))}}}class Y extends l().o0{constructor(...e){super(...e),this.name="TruncateSearches"}applyImpl(e,t){return this.truncateSearches(e)}truncateSearches(e){let t=0;return e.flatMap((e=>"element"!==e.type||"search"!==e.tagName?[e]:t<3?(t+=1,[e]):(this.markModified(),[])))}}class Z extends l().o0{constructor(...e){super(...e),this.name="FillEmptyQueryDatabaseWithEmptySearch"}applyImpl(e,t){return e.map((e=>this.fillEmptyQueryDatabaseWithEmptySearch(e)))}fillEmptyQueryDatabaseWithEmptySearch(e){return"element"!==e.type||"query-database"!==e.tagName||e.children.length>0?e:(this.markModified(),{...e,children:[{type:"element",tagName:"search",attributes:{question:"",keywords:"",lookback:"default"},children:[]}]})}}class J extends l().o0{constructor(...e){super(...e),this.name="AutofixTypesInDatabaseQueryOutput"}applyImpl(e,t){return t?e.map((e=>this.autofixTypesInDatabaseQueryOutput(e,t))):e}autofixTypesInDatabaseQueryOutput(e,t){var n;if("element"!==e.type||"query-database"!==e.tagName)return e;const r=e.attributes.id;if(!r)return e;const o=null===(n=t.idMapper.keyMap.find((e=>e.counter===r)))||void 0===n?void 0:n.key;if(!o)return e;const i=t.collectionIdMap[o.key];if(!i)return e;const a=(0,l().uI)(e,(e=>this.fixQueryDatabaseFilterSortTypes(e,i.schemas)));return a}fixQueryDatabaseFilterSortTypes(e,t){if("element"!==e.type)return e;const n=e.tagName.startsWith("filter"),r=e.tagName.startsWith("sort");if(!n&&!r)return e;const o=e.attributes.name,i=Object.entries(t).filter((([e,t])=>e===o)).map((([e,t])=>t.tagName.replace(/^schema-property-/,""))),a=e.tagName.replace(/^(filter|sort)-property-/,"");return 0===i.length||i.includes(a)?e:(this.markModified(),{...e,tagName:`${n?"filter":"sort"}-property-${i[0]}`})}}const ee=[new x,new w,new k,new g,new q,new T,new _,new R,new P,new E,new M,new N,new C,new H,new z,new j,new A,new B,new O,new Q,new X,new D,new F,new m,new h,new f,new y,new L,new v,new $,new K,new U,new W,new V,new G,new Y,new Z,new I,new J,new S]},471327:(e,t,n)=>{n.d(t,{X:()=>m});n(296540);var r=()=>n(401497),o=()=>n(252291),i=()=>n(396896),a=()=>n(631524),s=()=>n(160432),l=()=>n(995847),d=()=>n(69708),c=()=>n(284371),u=()=>n(125565),p=n(474848);function m({title:e,description:t,onDismiss:n,icon:m,primaryAction:h,secondaryAction:g}){const f=(0,d().tz)(),y=(0,r().IS)((e=>({container:{position:"relative",width:"100%",padding:16},multiIconsRow:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginBottom:12},singleIconRow:{position:"absolute",top:10,insetInlineEnd:16},dismissButton:{marginTop:-7,marginInlineEnd:-7},title:{fontWeight:c().Wy.medium,fontSize:c().J.UIRegular.desktop,lineHeight:1.2,color:e.darkTextColor,marginBottom:6},description:{fontWeight:c().Wy.regular,fontSize:c().J.UISmall.desktop,color:e.text.secondary,marginBottom:12},primaryActionButton:{width:"100%",display:"flex",justifyContent:"center",whiteSpace:"normal"},secondaryActionButton:{width:"100%",display:"flex",justifyContent:"center"}})),[]),v=f.formatMessage({id:"prompt.dismissButton.ariaLabel",defaultMessage:"Close"});return(0,p.jsxs)("div",{style:y.container,children:[m?(0,p.jsxs)("div",{style:y.multiIconsRow,children:[(0,p.jsx)(o().I,{icon:m}),(0,p.jsx)(a().p,{size:"sm",style:y.dismissButton,onClick:n,"aria-label":v,iconLeading:{icon:l().xMarkSmallIcon,size:"xs"}})]}):(0,p.jsx)("div",{style:y.singleIconRow,children:(0,p.jsx)(a().p,{size:"sm",style:y.dismissButton,onClick:n,"aria-label":v,iconLeading:{icon:l().xMarkSmallIcon,size:"xs"}})}),(0,p.jsx)(u().A,{style:y.title,isMultiline:!0,children:e}),(0,p.jsx)(u().A,{style:y.description,isMultiline:!0,isSmall:!0,children:t}),(0,p.jsxs)(i().VP,{gap:8,children:[h?(0,p.jsx)(s().A,{colorPalette:"blue",size:"lg",style:y.primaryActionButton,onClick:e=>h.onClick(e),"aria-label":h.ariaLabel,children:h.text}):null,g?(0,p.jsx)(a().p,{colorPalette:"gray",style:y.secondaryActionButton,onClick:e=>g.onClick(e),"aria-label":g.ariaLabel,iconLeading:g.icon?{icon:g.icon,size:"sm"}:void 0,children:g.text}):null]})]})}},472499:(e,t,n)=>{n.d(t,{J:()=>p});n(296540);var r=()=>n(484714),o=()=>n(401497),i=()=>n(252291),a=()=>n(56394),s=()=>n(574036),l=()=>n(978625),d=()=>n(806754),c=()=>n(821879),u=n(474848);function p({title:e,value:t,disabled:n,icon:o,style:i,onChange:a,focused:s,mode:l}){const d=(0,r().v3)(),{device:c}=d;return c.isMobile?(0,u.jsx)(y,{title:e,value:t,disabled:n,icon:o,style:i,onChange:a,focused:s,mode:l}):(0,u.jsx)(f,{title:e,icon:o,value:t,style:i,onChange:a,focused:s,mode:l})}function m(e,t){t(!e)}function h(e){return{menuItem:{minHeight:void 0,paddingTop:e.device.isMobile?12:4,paddingBottom:e.device.isMobile?12:4},icon:{height:14,width:14,fill:"currentColor"},pillIcon:{marginInlineEnd:6},sectionMenuItem:{display:"flex"}}}function g({mode:e,title:t,icon:n,value:l,style:d,onChange:p,focused:g}){const f=(0,o().DP)(),y=h((0,r().v3)()),v=function(e){return{menuItem:{color:e.text.secondary}}}(f),b={...y.menuItem,...v.menuItem,...d};return e===c().C.Pill?(0,u.jsx)(a().A,{on:l,hideChevron:!0,title:(0,u.jsx)("span",{children:t}),onClick:()=>m(l,p),icon:(0,u.jsx)(i().I,{icon:n,style:y.pillIcon})}):(0,u.jsx)(s().A,{title:t,icon:n(y.icon),on:l,onClick:()=>m(l,p),style:b,focused:g})}function f({mode:e,title:t,icon:n,value:o,style:i,onChange:a,focused:s}){const l=(0,r().v3)();return(0,u.jsx)(d().A,{marginAfter:!1,style:h(l).sectionMenuItem,children:(0,u.jsx)(g,{title:t,icon:n,value:o,style:i,onChange:a,mode:e,focused:s})})}function y({mode:e,title:t,value:n,disabled:r,icon:o,style:i,onChange:a,focused:s}){return e===c().C.Button?(0,u.jsx)(g,{title:t,icon:o,value:n,style:i,onChange:a,mode:e,focused:s}):(0,u.jsx)(l().A,{disabled:r,onClick:()=>m(n,a),label:t,isToggle:!0,isToggleActive:n})}},482173:(e,t,n)=>{n.d(t,{A:()=>u,q:()=>c});var r=n(296540),o=()=>n(484714),i=()=>n(56366),a=()=>n(401497),s=()=>n(284371),l=()=>n(250484),d=n(474848);function c(e){return{fontSize:12,color:e.text.tertiary,marginInlineStart:6,paddingInlineEnd:4,paddingInlineStart:4,height:24}}const u=function(e){const t=(0,a().DP)(),c=(0,o().v3)(),u=(0,o().Y0)(),p=(0,a().IS)((()=>({footer:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:u.isMobile?s().J.UIRegular.mobile:s().J.UIRegular.desktop,padding:"6px 8px"},footerWrapper:{flexShrink:0},footerText:{color:t.text.tertiary,fontSize:n(115512).ny(c,"UISmall"),...s().RC},debugGearIcon:{color:t.palette.gray[400]},hoveredDebugGearIcon:{color:t.palette.gray[600]}})),[u.isMobile,c,t]),m=(0,i().K8)((()=>l().Ay.state.isDebugSidebarOpen),[]),{searchResultStore:h}=(0,r.useContext)(n(974779).SearchStaticContext),g=(0,i().K8)((()=>{var e;return null===(e=h.state.localResults)||void 0===e?void 0:e.results}),[h]),{serverResults:f,debugInfo:y,exposedSearchExperiments:v}=(0,i().K8)((()=>{var e;const t=h.state.serverResults;return{serverResults:null==t?void 0:t.results,debugInfo:null==t?void 0:t.debugInfo,exposedSearchExperiments:null==t||null===(e=t.serverEventProperties)||void 0===e?void 0:e["server-searchExperiments"]}}),[h]);return(0,d.jsx)("footer",{style:p.footerWrapper,children:(0,d.jsxs)(n(89924).A,{topBorder:!0,style:p.footer,disableDesktopPadding:!0,children:[(0,d.jsx)(n(678553).Ay,{...e,style:p.footerText}),(0,d.jsxs)("div",{style:{display:"flex",gap:4},children:[e.shouldShowReportBadSearchButton?(0,d.jsx)(n(942095).c,{source:n(245241).m2.searchModal,localResults:g,serverResults:f,debugInfo:y,exposedSearchExperiments:v}):void 0,(0,n(211134).PF)(n(726637).A)&&!m?(0,d.jsx)(n(631524).p,{onClick:()=>l().Ay.setState({...l().Ay.state,isDebugSidebarOpen:!0}),size:"sm",style:p.debugGearIcon,hoveredStyle:p.hoveredDebugGearIcon,children:(0,n(846899).B)({width:12,height:12})}):void 0]})]})})}},500251:(e,t,n)=>{n.d(t,{sb:()=>ar,CX:()=>lr});var r=n(296540),o=()=>n(484714),i=()=>n(56366),a=()=>n(401497),s=()=>n(929219),l=()=>n(988083),d=()=>n(998531),c=()=>n(584262),u=()=>n(175947),p=()=>n(496603),m=()=>n(222917),h=()=>n(884107),g=()=>n(187778),f=()=>n(858341),y=()=>n(38337),v=()=>n(492414),b=()=>n(722872),x=()=>n(825972),S=()=>n(780865),w=()=>n(974779),k=()=>n(361330),I=()=>n(793765),T=()=>n(606331);const M=(0,p().sg)(T().Lj,k().ab),C=(0,p().sg)(T().Lj,k().ab);var j=()=>n(857437),A=()=>n(691298),B=()=>n(899677),N=()=>n(250484),_=()=>n(297872),R=()=>n(404277),P=()=>n(45552),E=()=>n(198427),D=(n(581454),()=>n(242422)),O=()=>n(726637),F=()=>n(252291),q=()=>n(729108),L=()=>n(715256),K=()=>n(281844),U=()=>n(211134),V=()=>n(534177),z=()=>n(658883),H=()=>n(760217),W=()=>n(472499),$=()=>n(821879),G=()=>n(631524),Q=()=>n(668725),X=()=>n(69708),Y=()=>n(100622),Z=()=>n(406699),J=()=>n(939740),ee=()=>n(89924),te=n(474848);function ne(e){const t=(0,o().Y0)();return(0,te.jsx)(Z().A,{popupType:t.isMobile?Z().z.SlideUp:Z().z.Popup,renderOrigin:t=>(0,te.jsx)(oe,{events:t,...e}),render:t=>(0,te.jsx)(re,{parent:t,...e})})}function re({parent:e,experiment:t,onChange:n}){const r=(0,o().Y0)(),i=(0,a().IS)((()=>({menuOptionStyle:{color:Y().Tj.mediumTextColor}})),[]);let s;s=r.isMobile?{menuType:b().gu.Modal,title:t.experimentId,right:(0,te.jsx)(X().sA,{defaultMessage:"Done",id:"appearanceSettings.modal.done"}),onClickRight:e.close}:{menuType:b().gu.Popup,width:250};const l=t.groups.map((r=>({key:r,action:o=>{n({experimentId:t.experimentId,group:r}),e.close()},render:(e,t)=>(0,te.jsx)(H().A,{...e,title:r,style:i.menuOptionStyle})})));return(0,te.jsx)(R().A,{...s,children:(0,te.jsx)(J().Ay,{type:J().Oh.Vertical,initialFocus:void 0,sections:[{key:t.experimentId,render:e=>(0,te.jsx)(ee().A,{...e}),items:l}]})})}function oe({experiment:e,events:t,searchExperimentOverrides:n}){const o=(0,a().IS)((e=>({experimentGroupButtonChevronStyle:{width:10,fill:e.icon.tertiary},experimentGroupButtonStyle:{overflowX:"hidden",justifyContent:"left",overflow:"hidden",marginInlineStart:6,color:e.text.secondary},rowContainer:{display:"flex",overflow:"hidden",flexDirection:"row"},groupCell:{overflow:"hidden",marginInlineEnd:4}})),[]);return(0,r.createElement)(G().p,{...t,size:"sm",key:e.experimentId,style:o.experimentGroupButtonStyle},(0,te.jsxs)("div",{style:o.rowContainer,children:[(0,te.jsx)("div",{style:o.groupCell,children:n[e.experimentId]||e.group}),(0,te.jsx)("div",{children:(0,Q().b)(o.experimentGroupButtonChevronStyle)})]}))}function ie(e){return{fontSize:14,lineHeight:1.2,color:e.text.secondary,marginInlineEnd:4,display:"flex",alignItems:"center",whiteSpace:"nowrap"}}const ae=function(e){const{experiment:t}=e,{leftOverrides:n,rightOverrides:o,experimentDiffers:s,experimentAgreesButNondefault:l}=(0,i().K8)((()=>{const e=I().E.state.searchExperimentOverrides,n=I().nS.state.searchExperimentOverrides,r=(e[t.experimentId]??t.group)!==(n[t.experimentId]??t.group);return{leftOverrides:e,rightOverrides:n,experimentDiffers:r,experimentAgreesButNondefault:!r&&void 0!==n[t.experimentId]&&e[t.experimentId]!==t.group}}),[t]),d=(0,a().IS)((e=>({rowContainer:{backgroundColor:s?e.red.background.secondary:l?e.yellow.background.secondary:void 0},titleCell:{...ie(e),maxWidth:180,textOverflow:"ellipsis",overflow:"hidden"}})),[l,s]),c=(0,r.useCallback)((e=>{const{experimentId:t,group:n,store:r}=e;r.setState({...r.state,searchExperimentOverrides:{...r.state.searchExperimentOverrides,[t]:n}})}),[]);return(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)("div",{style:{...d.titleCell,...d.rowContainer},children:t.experimentId.replace("search-","")}),(0,te.jsx)("div",{style:d.rowContainer,children:(0,te.jsx)(ne,{experiment:t,searchExperimentOverrides:n,onChange:e=>{c({...e,store:I().E})}})}),(0,te.jsx)("div",{style:d.rowContainer,children:(0,te.jsx)(ne,{experiment:t,searchExperimentOverrides:o,onChange:e=>{c({...e,store:I().nS})}})})]})};var se=()=>n(806754),le=()=>n(805751),de=()=>n(623580);function ce(e){const{leftValue:t,rightValue:n,setLeftValue:o,setRightValue:i,placeholder:s,label:l}=e,{titleCell:d,rightTitleCell:c,leftTitleCell:u}=(0,a().IS)((e=>{const r=ie(e);return{titleCell:r,rightTitleCell:{...r,color:n?r.color:e.text.tertiary,width:"95%"},leftTitleCell:{...r,color:t?r.color:e.text.tertiary,width:"95%"}}}),[t,n]),[p,m]=(0,r.useState)(n),[h,g]=(0,r.useState)(t);(0,r.useEffect)((()=>{void 0===n&&m(void 0),void 0===t&&g(void 0)}),[n,t]);const f=(0,r.useCallback)((()=>{i(p)}),[i,p]),y=(0,r.useCallback)((()=>{o(h)}),[o,h]),v=(0,r.useCallback)((e=>{m(e.target.value)}),[]),b=(0,r.useCallback)((e=>{g(e.target.value)}),[]);return(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)("div",{style:d,children:l}),(0,te.jsxs)(le().A,{debugName:"SearchStringOverrideControls",capture:!0,allowMenuList:!1,children:[(0,te.jsx)(de().A,{style:u,onBlur:y,value:h,onChange:b,placeholder:s}),(0,te.jsx)(de().A,{style:c,onBlur:f,value:p,onChange:v,placeholder:s})]})]})}function ue(){const e=(0,r.useRef)(null),t=(0,i().K8)((()=>(0,V().WP)(L().hH).map((([e,t])=>({experimentId:e,experimentVersion:1,group:D().default.getEligibleGroup({experimentId:e,defaultGroup:"control"}),groups:["control",...t]})))),[]);return(0,te.jsx)(pe,{ref:e,searchExperimentsToToggle:t})}const pe=r.forwardRef((function({searchExperimentsToToggle:e},t){const r=(0,a().DP)(),s=(0,o().v3)(),l={sidebar:{paddingTop:12,paddingBottom:24,overflowY:"auto",overflowX:"hidden",flex:"0 0 250px",minHeight:400},sidebarHidden:{display:"none"}},d=function(e){return{sidebar:{backgroundColor:e.sidebarSecondaryBackground,borderInlineStart:`1px solid ${e.regularDividerColor}`}}}(r),c=(0,i().K8)((()=>N().Ay.isDebugSidebarOpen()),[]),u=(0,i().K8)((()=>(0,z().q)(s)),[s]),p={...l.sidebar,...d.sidebar,...!c&&l.sidebarHidden};return(0,te.jsxs)("aside",{ref:t,style:p,children:[(0,te.jsx)(n(718827).Ay,{onClick:xe,style:{display:"flex",alignItems:"center",justifyContent:"center",background:void 0,borderRadius:6,width:16,height:16,position:"absolute",top:10,insetInlineEnd:10,...u&&(0,n(745766).g)({noDrag:!0})},children:(0,te.jsx)(F().I,{icon:n(995847).xMarkSmallIcon,size:"sm",colorVariant:"secondary"})}),(0,te.jsx)(me,{searchExperimentsToToggle:e})]})}));function me({searchExperimentsToToggle:e}){const{leftForcedClusterPattern:t,rightForcedClusterPattern:r,leftForcedBlockIds:o,rightForcedBlockIds:a}=(0,i().K8)((()=>({leftForcedClusterPattern:I().E.state.forcedClusterPattern,rightForcedClusterPattern:I().nS.state.forcedClusterPattern,leftForcedBlockIds:I().E.state.forcedBlockIds,rightForcedBlockIds:I().nS.state.forcedBlockIds})),[]);return(0,U().PF)(O().A)?(0,te.jsx)(se().A,{title:"Dev Tools",children:(0,te.jsxs)(n(145214).A,{animate:{height:"100%"},style:{overflow:"scroll"},children:[(0,te.jsx)(ye,{}),(0,te.jsx)(ve,{}),(0,te.jsx)(be,{}),(0,te.jsx)(fe,{}),(0,te.jsxs)(se().A,{style:{marginTop:16},title:"Quick Switch",children:[(0,te.jsx)(ge,{title:"No local at all",searchExperimentOverrides:{"search-no-local-blending":"on","search-debug-only-no-recent-boosting":"on"}}),(0,te.jsx)(ge,{title:"No local results",searchExperimentOverrides:{"search-no-local-blending":"on"}}),(0,te.jsx)(ge,{title:"No local boosting",searchExperimentOverrides:{"search-debug-only-no-recent-boosting":"on"}})]}),(0,te.jsx)(se().A,{style:{marginTop:16},title:"Dev Experiments",right:(0,te.jsx)(n(124092).p,{onClick:()=>{I().E.reset(),I().nS.reset()},style:{paddingInlineStart:0,paddingInlineEnd:0,height:"unset"},children:(0,te.jsx)(F().I,{icon:n(97889).C,size:"sm"})}),children:(0,te.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr 1fr",minWidth:"100%",maxWidth:"100%",paddingInlineStart:14},children:[(0,te.jsx)("div",{}),(0,te.jsx)("div",{}),(0,te.jsx)(he,{columnStore:I().nS}),e.map((e=>(0,te.jsx)(ae,{experiment:e},e.experimentId))),(0,te.jsx)(ce,{leftValue:t,rightValue:r,setLeftValue:e=>I().E.updateForcedClusterPattern(e),setRightValue:e=>I().nS.updateForcedClusterPattern(e),placeholder:"cluster-pattern",label:"forced cluster pattern"}),(0,te.jsx)(ce,{leftValue:o,rightValue:a,setLeftValue:e=>I().E.updateForcedBlockIds(e),setRightValue:e=>I().nS.updateForcedBlockIds(e),placeholder:"block ids",label:"forced block ids"})]})})]})}):null}function he({columnStore:e}){const t=(0,i().K8)((()=>e.state.visible),[e]);return(0,te.jsx)(H().A,{icon:(0,te.jsx)(q().S,{checked:t,size:14,onClick:()=>e.update((e=>({...e,visible:!e.visible})))}),focused:!1,title:"Show",onClick:()=>e.update((e=>({...e,visible:!e.visible})))})}function ge({title:e,searchExperimentOverrides:t}){return(0,te.jsx)(H().A,{focused:!1,title:e,onClick:()=>{I().nS.update((e=>({...e,visible:!1}))),I().E.update((e=>({...e,searchExperimentOverrides:t})))}})}function fe(){return null}function ye(){const e=(0,i().K8)((()=>I().Ay.state.showDebugInfo),[]);return(0,te.jsx)(W().J,{mode:$().C.Button,focused:!1,title:"Show debug info",icon:K().v,value:e,onChange:e=>{I().Ay.setState({...I().Ay.state,showDebugInfo:Boolean(e)})}})}function ve(){const e=(0,i().K8)((()=>I().Ay.state.autoExpandDebugInfo),[]);return(0,te.jsx)(W().J,{mode:$().C.Button,focused:!1,title:"Auto-expand debug info",icon:K().v,value:e,onChange:e=>{I().Ay.setState({...I().Ay.state,autoExpandDebugInfo:Boolean(e)})}})}function be(){const e=(0,i().K8)((()=>"everything"===I().Ay.state.debug),[]);return(0,te.jsx)(W().J,{mode:$().C.Button,focused:!1,title:"Profile query",icon:K().v,value:e,onChange:e=>{I().Ay.setState({...I().Ay.state,debug:e?"everything":void 0})}})}function xe(){N().Ay.update((e=>({...e,isDebugSidebarOpen:!1})))}var Se=()=>n(284371),we=()=>n(678553);const ke={viewBox:"0 0 16 16",fittedViewBox:"1.87 1.87 12.25 12.25",svg:(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)("path",{d:"M4.9 5.905a.575.575 0 0 0 0 1.15h6.2a.575.575 0 0 0 0-1.15zm5.425 1.883h-4.65a.575.575 0 1 0 0 1.15h4.65a.575.575 0 1 0 0-1.15M6.721 9.672a.575.575 0 0 0 0 1.15H9.28a.575.575 0 1 0 0-1.15z"}),(0,te.jsx)("path",{d:"M8 1.875a6.125 6.125 0 1 0 0 12.25 6.125 6.125 0 0 0 0-12.25M3.125 8a4.875 4.875 0 1 1 9.75 0 4.875 4.875 0 0 1-9.75 0"})]})},Ie=(0,n(340498).wt)("filterCircleSmall",ke);var Te=()=>n(435644),Me=()=>n(42583),Ce=()=>n(37433),je=()=>n(575695),Ae=()=>n(409066),Be=()=>n(140828),Ne=()=>n(693176),_e=(n(898992),n(354520),()=>n(604995)),Re=()=>n(416504),Pe=()=>n(177148),Ee=()=>n(253673),De=()=>n(765957);function Oe({onMenuDismiss:e}){const t=(0,o().v3)(),n=(0,i().K8)((()=>N().Ay.state.query.filters),[]),r=function(e,t){const n=ze(e);if(!n)return!1;if(!n.createdBy)return!1;const r=n.createdBy[0];return-1!==t.createdBy.indexOf(r)}(t,n),a=function(e){const{lastEditedTime:t}=Ve();return p().n4(t,e.lastEditedTime)}(n),s=(0,i().K8)((()=>function(e){const t=Ue();if(!t)return!1;if(!t.ancestors)return!1;const n=t.ancestors[0];return-1!==e.ancestors.indexOf(n)}(n)),[n]);return r&&a&&s?null:(0,te.jsxs)(se().A,{title:(0,te.jsx)(X().sA,{id:"search.filterMenu.quickFiltersSection.title",defaultMessage:"Quick filters"}),marginAfter:!0,children:[r?void 0:(0,te.jsx)(Le,{focused:!1,onMenuDismiss:e}),a?void 0:(0,te.jsx)(Ke,{focused:!1,onMenuDismiss:e}),s?void 0:(0,te.jsx)(qe,{focused:!1,onMenuDismiss:e})]})}function Fe({icon:e,title:t,filter:n,onMenuDismiss:r,focused:o}){const i={minHeight:void 0,paddingTop:O().A.isMobile?12:4,paddingBottom:O().A.isMobile?12:4};return(0,te.jsx)(H().A,{icon:(0,te.jsx)(F().I,{icon:e}),focused:o,title:t,onClick:()=>function(e,t){(function(e){N().Ay.updateFilters(e)})(e),void(N().Ay.isDebugSidebarOpen()||N().Ay.setState({...N().Ay.state,isDebugSidebarOpen:!0})),t&&t()}(n,r),style:i})}function qe(e){const t=(0,i().K8)((()=>Ue()),[]);return t?(0,te.jsx)(Fe,{icon:Pe().Y,title:(0,te.jsx)(X().sA,{id:"search.filterMenu.quickFilters.inCurrentPage",defaultMessage:"In current page"}),filter:t,...e}):null}function Le(e){const t=ze((0,o().v3)());return t?(0,te.jsx)(Fe,{icon:Ee().personIcon,title:(0,te.jsx)(X().sA,{id:"search.filterMenu.quickFilters.createdByMe",defaultMessage:"Created by me"}),filter:t,...e}):null}function Ke(e){const t=Ve();return t?(0,te.jsx)(Fe,{icon:Me().D,title:(0,te.jsx)(X().sA,{id:"search.filterMenu.quickFilters.editedLastWeek",defaultMessage:"Edited last week"}),filter:t,...e}):null}function Ue(){const{mainEditorCurrentBlockStore:e}=De().default.state;if(e&&e.id)return{ancestors:[e.id]}}function Ve(){return{lastEditedTime:{starting:_e().t0((0,Re().P)()),ending:_e().Ec((0,Re().P)())}}}function ze(e){const{id:t}=e.currentUser;if(t)return{createdBy:[t]}}let He=function(e){return e.Button="Button",e.Section="Section",e}({});function We({mode:e},t){const o=(0,i().uB)(void 0,n(463830).A),a=(0,r.useRef)(null),s=(0,r.useRef)(null);return(0,r.useImperativeHandle)(t,(()=>({getClientHeight:()=>{if(null!==a.current){const e=a.current.getAnchor();return(null==e?void 0:e.clientHeight)??0}return null!==s.current?s.current.clientHeight:0}}))),e===He.Button?(0,te.jsx)(dt,{ref:a,buttonPopupStore:o}):e===He.Section?(0,te.jsx)(lt,{ref:s,buttonPopupStore:o}):void(0,V().HB)(e)}const $e=r.forwardRef(We);function Ge(e){return t=>N().Ay.updateFilters({[e]:t})}function Qe({mode:e}){const t=(0,i().K8)((()=>N().Ay.state.query.filters.isDeletedOnly),[]);return(0,te.jsx)(W().J,{mode:e,focused:!1,title:(0,te.jsx)(X().sA,{id:"search.filterMenu.deletedOnlyToggle.label",defaultMessage:"Deleted only"}),icon:n(236262).trashIcon,value:t||!1,onChange:Ge("isDeletedOnly")})}function Xe(){return(0,te.jsx)(X().sA,{id:"search.filterMenu.moreFiltersSection.title",defaultMessage:"More filters"})}function Ye(e){N().Ay.updateFilters({navigableBlockContentOnly:e})}function Ze({mode:e}){const t=(0,i().K8)((()=>N().Ay.state.query.filters.navigableBlockContentOnly),[]);return(0,te.jsx)(W().J,{mode:e,focused:!1,title:(0,te.jsx)(X().sA,{id:"search.filterMenu.onlyMatchTitlesToggle.label",defaultMessage:"Title only"}),icon:Te().a,value:t||!1,onChange:Ye})}function Je(e){return(0,te.jsx)("div",{style:{marginInlineEnd:-8},children:(0,te.jsx)(G().p,{...e,iconLeading:Ie,size:"sm",colorPalette:"blue",children:(0,te.jsx)(X().sA,{defaultMessage:"Add filter",id:"search.addFilter.button.label"})})})}function et(e){e.setState({...e.state,open:!1})}function tt({mode:e,buttonPopupStore:t}){const n=(0,r.useCallback)((()=>et(t)),[t]),o=(0,i().K8)((()=>N().Ay.state.query.filters.ancestors),[]);return(0,te.jsx)(w().SearchStoresContext.Consumer,{children:({parentStore:t})=>(0,te.jsx)(Ae().E,{mode:e,focused:!1,title:(0,te.jsx)(X().sA,{id:"search.filterMenu.moreFilters.inPage",defaultMessage:"In"}),parentStore:t,blockIds:o,onMenuDismiss:n,onChange:Ge("ancestors"),peopleBlocksToInclude:"collection_view_page"})})}function nt({mode:e,buttonPopupStore:t}){const n=(0,r.useCallback)((()=>et(t)),[t]),o=(0,i().K8)((()=>N().Ay.state.query.filters.createdBy),[]);return(0,te.jsx)(w().SearchStoresContext.Consumer,{children:({parentStore:t})=>(0,te.jsx)(Be().A,{mode:e,focused:!1,title:(0,te.jsx)(X().sA,{id:"search.filterMenu.moreFilters.createdBy",defaultMessage:"Created by"}),parentStore:t,userIds:o,onMenuDismiss:n,onChange:Ge("createdBy")})})}function rt({mode:e,buttonPopupStore:t}){const n=(0,r.useCallback)((()=>et(t)),[t]),o=(0,i().K8)((()=>N().Ay.state.query.filters.createdTime),[]);return(0,te.jsx)(je().A,{mode:e,focused:!1,title:(0,te.jsx)(X().sA,{id:"search.filterMenu.moreFilters.created",defaultMessage:"Created"}),icon:Me().D,value:o,onMenuDismiss:n,onChange:Ge("createdTime")})}function ot({mode:e,buttonPopupStore:t}){const n=(0,r.useCallback)((()=>et(t)),[t]),o=(0,i().K8)((()=>N().Ay.state.query.filters.lastEditedTime),[]);return(0,te.jsx)(je().A,{mode:e,focused:!1,title:(0,te.jsx)(X().sA,{id:"search.filterMenu.moreFilters.lastEdited",defaultMessage:"Last edited"}),icon:Me().D,value:o,onMenuDismiss:n,onChange:Ge("lastEditedTime")})}function it({mode:e,buttonPopupStore:t}){const n=(0,r.useCallback)((()=>et(t)),[t]),o=(0,i().K8)((()=>N().Ay.state.query.filters.inTeams),[]);return(0,i().K8)((()=>(0,Ce().zI)()>0),[])?(0,te.jsx)(w().SearchStoresContext.Consumer,{children:({parentStore:t})=>(0,te.jsx)(Ne().SZ,{mode:e,focused:!1,title:(0,te.jsx)(X().sA,{id:"search.filterMenu.moreFilters.inTeams",defaultMessage:"Teamspace"}),parentStore:t,teamIds:o,onMenuDismiss:n,onChange:Ge("inTeams")})}):null}function at({activeFilters:e,mode:t,buttonPopupStore:n}){return(0,te.jsxs)(r.Fragment,{children:[e.createdBy?(0,te.jsx)(nt,{buttonPopupStore:n,mode:t}):void 0,e.createdTime?(0,te.jsx)(rt,{buttonPopupStore:n,mode:t}):void 0,e.lastEditedTime?(0,te.jsx)(ot,{buttonPopupStore:n,mode:t}):void 0,e.ancestors?(0,te.jsx)(tt,{buttonPopupStore:n,mode:t}):void 0,e.inTeams?(0,te.jsx)(it,{buttonPopupStore:n,mode:t}):void 0]})}function st({buttonPopupStore:e}){return(0,te.jsxs)(R().A,{menuType:b().gu.ActionSheet,children:[(0,te.jsx)(Oe,{onMenuDismiss:()=>et(e)}),(0,te.jsxs)(se().A,{title:(0,te.jsx)(Xe,{}),children:[(0,te.jsx)(nt,{buttonPopupStore:e,mode:$().C.Button}),(0,te.jsx)(rt,{buttonPopupStore:e,mode:$().C.Button}),(0,te.jsx)(ot,{buttonPopupStore:e,mode:$().C.Button}),(0,te.jsx)(tt,{buttonPopupStore:e,mode:$().C.Button}),(0,te.jsx)(it,{buttonPopupStore:e,mode:$().C.Button})]})]})}const lt=r.forwardRef((function({buttonPopupStore:e},t){const n=(0,i().K8)((()=>N().Ay.state.query.filters),[]),r=(0,i().K8)((()=>S().ug(n)),[n]);return(0,te.jsxs)(ee().A,{ref:t,disableMobilePadding:!0,disableMobileBorders:!0,children:[(0,te.jsx)(Ze,{mode:$().C.Section}),(0,te.jsx)(Qe,{mode:$().C.Section}),(0,te.jsx)(at,{buttonPopupStore:e,activeFilters:r,mode:$().C.Section})]})})),dt=r.forwardRef((function({buttonPopupStore:e},t){const n=(0,r.useCallback)((()=>(0,te.jsx)(st,{buttonPopupStore:e})),[e]);return(0,te.jsx)(Z().A,{ref:t,popupType:Z().z.SlideUp,buttonPopupStore:e,renderOrigin:e=>(0,te.jsx)(Je,{...e}),render:n})}));const ct=function(e){const t=r.useRef(),i=(0,o().Y0)(),s=(0,X().tz)(),{isMobile:l}=i,{activeOption:d,items:c}=r.useMemo((()=>function(e){const{currentSortBy:t,setSortBy:n,sortOptions:r,selectButton:o,intl:i}=e;let a=r[0];const s=r.map((e=>{const r=t.field,s=`${r}.${"relevance"===r?"":t.direction}`,l=e.key===s;return l&&(a=e),{key:e.key,action:()=>{n(e.sort),o&&o.current&&o.current.closeMenu()},render:t=>(0,te.jsx)(H().A,{...t,title:i.formatMessage(e.formattedName),isChecked:l})}}));return{activeOption:a,items:s}}({...e,selectButton:t,intl:s})),[e,t,s]),u=(0,a().IS)((e=>({selectedTitle:{color:e.text.secondary},label:{marginInlineEnd:2,fontSize:l?Se().J.UISmall.mobile:Se().J.UISmall.desktop,transform:"translateY(0.5px)"},innerButton:{color:e.text.secondary,fontWeight:Se().Wy.semibold,fontSize:l?Se().J.UISmall.mobile:Se().J.UISmall.desktop,height:20,padding:"2px 4px",marginInlineEnd:1,transform:"translateY(0.5px)"},menu:{minWidth:200}})),[l]),p=l?(0,te.jsx)(X().sA,{id:"search.sort.sortMenuTitle",defaultMessage:"Sort By"}):void 0;return(0,te.jsx)(n(755535).A,{ref:e=>{e&&(t.current=e)},alignmentToOrigin:"start",selectedTitle:(0,te.jsx)("div",{style:u.selectedTitle,children:s.formatMessage(d.formattedName)}),label:void 0,renderMenuSections:()=>[{key:"searchSortOrder",render:e=>(0,te.jsx)(se().A,{...e,title:p,desktopStyle:u.menu,disableDesktopPadding:!1}),items:c}],labelStyle:u.label,innerButtonStyle:u.innerButton})};var ut=()=>n(87529);const pt=function({isPublicPageSearch:e}){const t=(0,o().v3)(),{device:n}=t,r=function(e){return{menuItemMobile:{paddingBottom:0},titleWrapper:{flex:void 0,marginTop:-3,marginBottom:-1},showSidebarButton:()=>{const{device:t}=e;return{padding:"0 4px",fontSize:t.isMobile?Se().J.UISmall.mobile:Se().J.UISmall.desktop,fontWeight:Se().Wy.medium,borderRadius:4,height:20,lineHeight:"20px"}}}}(t),i={...n.isMobile&&r.menuItemMobile},a=e?void 0:(0,te.jsx)(ht,{});return(0,te.jsx)(we().Ay,{title:(0,te.jsx)(mt,{}),right:a,textWrapperStyle:r.titleWrapper,style:i})};function mt(){const e=(0,i().K8)((()=>N().Ay.state.query.sort),[]);return(0,te.jsx)(ct,{currentSortBy:e,setSortBy:e=>{N().Ay.setState({...N().Ay.state,query:{...N().Ay.state.query,sort:e}})},sortOptions:ut().w_})}function ht(){const e=(0,o().v3)(),{device:t}=e;return t.isMobile?(0,te.jsx)($e,{mode:He.Button}):null}var gt=()=>n(792751),ft=()=>n(288782),yt=()=>n(152197),vt=()=>n(887267),bt=(n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),()=>n(611648)),xt=()=>n(763884),St=()=>n(439264),wt=()=>n(2143),kt=()=>n(681873),It=()=>n(179034),Tt=()=>n(854150),Mt=()=>n(798880),Ct=()=>n(245241),jt=()=>n(695608),At=()=>n(972435),Bt=()=>n(148832),Nt=()=>n(95758),_t=()=>n(870092);function Rt(e){const{filterUIName:t}=e,{parentStore:n}=(0,r.useContext)(w().SearchStoresContext),o=(0,i().K8)((()=>N().Ay.state.query.filters),[]),s=(0,a().IS)((e=>({title:{maxWidth:220,...Se().RC}})),[]),l=(0,i().K8)((()=>{switch(t){case"personFilter":return function(e,t){const n=e.createdBy,r=At().A.getIntl(),o=p().oE(n.map((e=>{const n=_t().L.createChildStore(t,{table:Mt().oo,id:e});return(0,jt().c6)(r,n.getModel())})));return(0,kt().G)(o,Dt)}(o,n);case"teamsFilter":case"dev_notInTeamFilter":return function(e,t){const n=(0,Ct().fg)(e.inTeams);if(!n)return[];const r=p().oE(n.map((e=>Nt().h.createChildStore(t,{table:Tt().yK,id:e}).getName())));return(0,kt().G)(r,Dt)}(o,n);case"pageFilter":case"dev_notInPageFilter":return Ot(o,n);case"dateFilter":return function(e){const t=At().A.getIntl(),n=function(e){const t=S().z7.createdTime(e.createdTime),n=S().z7.lastEditedTime(e.lastEditedTime);if(t)return"createdTime";if(n)return"lastEditedTime";return}(e);if("createdTime"===n)return S().tX(e.createdTime,t);if("lastEditedTime"===n)return S().tX(e.lastEditedTime,t);return""}(o);case"titleToggle":return[];default:(0,V().HB)(t)}}),[n,t,o]);return(0,te.jsx)("div",{style:s.title,children:(0,te.jsx)(X().sA,{defaultMessage:"{filterName}{colon} {filterOperator} {filterValues}",id:"search.filterBarFilter.title",values:{filterName:Pt(t),filterOperator:0===l.length?void 0:Et(t,o),filterValues:l,colon:0===l.length?void 0:":"}})})}function Pt(e){switch(e){case"personFilter":return(0,te.jsx)(X().sA,{id:"search.filterMenu.moreFilters.person",defaultMessage:"Created by"});case"teamsFilter":return(0,te.jsx)(X().sA,{id:"search.filterMenu.moreFilters.inTeams",defaultMessage:"Teamspace"});case"pageFilter":return(0,te.jsx)(X().sA,{id:"search.filterMenu.moreFilters.inPage",defaultMessage:"In"});case"dateFilter":return(0,te.jsx)(X().sA,{id:"search.filterMenu.moreFilters.dateFilterLabel",defaultMessage:"Date"});case"titleToggle":return(0,te.jsx)(X().sA,{id:"search.filterMenu.onlyMatchTitlesToggle.label",defaultMessage:"Title only"});case"dev_notInPageFilter":return(0,te.jsx)(X().sA,{id:"[DO NOT TRANSLATE].search.filterMenu.notInPageFilter.label",defaultMessage:"[dev] Not in page"});case"dev_notInTeamFilter":return(0,te.jsx)(X().sA,{id:"[DO NOT TRANSLATE].search.filterMenu.notInTeamFilter.label",defaultMessage:"[dev] Not in teamspace"})}(0,V().HB)(e)}function Et(e,t){switch(e){case"personFilter":case"teamsFilter":case"pageFilter":case"dev_notInPageFilter":case"dev_notInTeamFilter":case"dateFilter":case"titleToggle":return}(0,V().HB)(e)}function Dt(e){return", "}function Ot(e,t){const n=e.ancestors,r=p().oE(n.map((e=>{const n=Bt().B.createChildStore(t,{table:It().ev,id:e});return n.isDefined()?n.getModel().getRenderTitle({getRecordModel:n.getRecordModel,userTimeZone:(0,Re().P)(),intl:At().A.getIntl()}):""})));return(0,kt().G)(r,Dt)}var Ft=()=>n(313948),qt=(n(944114),n(672577),()=>n(582684)),Lt=()=>n(56394);function Kt(e){const t=(0,X().tz)();return(0,te.jsx)(Z().A,{popupType:Z().z.Popup,renderOrigin:e=>function(e,t){const n=N().Ay.state.query.sort,r=ut().w_.find((e=>p().n4(e.sort,n)))??ut().w_[0],o="relevance"===r.sort.field?Ut.sort:r.formattedName;return(0,te.jsx)(Lt().A,{disabled:!1,title:t.formatMessage(o),onClick:e.onClick,icon:(0,te.jsx)(F().I,{icon:qt().arrowUpDownIcon,style:{marginInlineEnd:6}})})}(e,t),render:e=>function(e){const{intl:t}=e,n=N().Ay.state.query.sort,r=ut().w_.findIndex((e=>p().n4(e.sort,n))),o=[];for(const i of ut().w_)o.push({key:i.key,render:e=>(0,te.jsx)(H().A,{...e,title:t.formatMessage(i.formattedName)}),action:()=>{N().Ay.setState({...N().Ay.state,query:{...N().Ay.state.query,sort:i.sort}})}});return(0,te.jsx)(R().A,{menuType:b().gu.Popup,children:(0,te.jsx)(J().Ay,{type:J().Oh.Vertical,initialFocus:r<0?0:r,sections:[{key:"sortOptions",items:o,render:e=>(0,te.jsx)(ee().A,{...e})}]})})}({...e,intl:t}),disabled:!1,placementToOrigin:"bottom",alignmentToOrigin:"start",onClick:e.onMenuOpen,onClose:e.onMenuDismiss})}const Ut=(0,X().YK)({sort:{id:"search.sort.sortOrder.bestMatches.title",defaultMessage:"Sort"}}),Vt="SearchFilterSettings",zt={starting:void 0,ending:void 0};function Ht(e){const{isMobile:t}=e,{parentStore:n}=(0,r.useContext)(w().SearchStoresContext),{handlePopupOpen:s,handlePopupClose:l}=(0,r.useContext)(w().SearchStaticContext),d=(0,o().v3)().currentUser.id,c=(0,i().K8)((()=>N().Ay),[]),u=(0,i().O$)(c),m=u.query.filters,h=(0,i().K8)((()=>B().default.state.isPublicPageSearch),[]),g=(0,i().K8)((()=>(0,Ce().zI)()>0&&!h),[h]),f=!h,y=!1,v=(0,a().IS)((e=>({scroller:{display:"flex",alignItems:"center",paddingTop:10,paddingInlineEnd:12,paddingBottom:10,paddingInlineStart:12},barContainer:{display:"flex",alignItems:"center"},scrollerContainer:{position:"relative",flexGrow:0,overflow:"hidden"},draggableList:{display:"flex",flexShrink:0,marginInlineStart:6},divider:{height:16,width:1,borderRadius:1,backgroundColor:e.border.secondary}})),[]),b=(0,r.useCallback)((e=>t=>c.updateFilters({[e]:t})),[c]),x=(0,r.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:r}=e;if(f)return(0,te.jsx)(Be().A,{mode:$().C.Pill,focused:!1,title:(0,te.jsx)(Rt,{filterUIName:"personFilter"}),parentStore:n,userIds:m.createdBy,onMenuDismiss:t,onMenuOpen:r,onChange:b("createdBy")})}),[f,n,m.createdBy,b]),S=(0,r.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:r}=e;return g&&(0,te.jsx)(Ne().SZ,{mode:$().C.Pill,focused:!1,title:(0,te.jsx)(Rt,{filterUIName:"teamsFilter"}),parentStore:n,teamIds:m.inTeams,onMenuDismiss:t,onMenuOpen:r,onChange:b("inTeams")})}),[n,m.inTeams,b,g]),k=(0,r.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:r}=e;return(0,te.jsx)(Ae().E,{mode:$().C.Pill,focused:!1,title:(0,te.jsx)(Rt,{filterUIName:"pageFilter"}),parentStore:n,blockIds:m.ancestors,onMenuDismiss:t,onMenuOpen:r,onChange:b("ancestors"),peopleBlocksToInclude:"collection_view_page"})}),[n,m.ancestors,b]),I=(0,r.useCallback)((()=>null),[n,m.dev_excludedPages,b,y]),T=(0,r.useCallback)((()=>null),[n,m.dev_excludedTeams,b,y]),M=(0,i().K8)((()=>p().Im(m.createdTime)||p().n4(m.createdTime,zt)?"lastEditedTime":"createdTime"),[m.createdTime]),C=(0,i().K8)((()=>"createdTime"===M?m.createdTime:m.lastEditedTime),[M,m.createdTime,m.lastEditedTime]),j=(0,r.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:n}=e,r={mode:$().C.Pill,focused:!1,title:(0,te.jsx)(Rt,{filterUIName:"dateFilter"}),icon:Me().D,initialValue:C,dateFilterType:M,onMenuDismiss:t,onMenuOpen:n,shouldAlsoUpdateSearchStore:!0};return(0,te.jsx)(Ft().m,{...r})}),[M,C]),A=(0,r.useCallback)((()=>!t&&(0,te.jsx)(W().J,{mode:$().C.Pill,focused:!1,title:(0,te.jsx)(Rt,{filterUIName:"titleToggle"}),icon:Te().a,value:m.navigableBlockContentOnly||!1,onChange:b("navigableBlockContentOnly")})),[m.navigableBlockContentOnly,b,t]);(0,r.useEffect)((()=>{const e=xt().K.get({userId:d,key:Vt});e&&p().n4(new Set(e.filterOrder),new Set(u.filterBar.order))&&!p().n4(e.filterOrder,u.filterBar.order)&&e.filterOrder&&c.updateFilterOrder(e.filterOrder)}),[u.filterBar.order,d,c]);const _={onMenuOpen:s,onMenuDismiss:l},R={titleToggle:A(),personFilter:x(_),teamsFilter:S(_),pageFilter:k(_),dateFilter:j(_),dev_notInPageFilter:I(),dev_notInTeamFilter:T()};const P=(0,r.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:n}=e;return(0,te.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,te.jsx)(Kt,{onMenuOpen:n,onMenuDismiss:t}),(0,te.jsx)("div",{style:v.divider})]})}),[v.divider]);return(0,te.jsx)("div",{style:v.barContainer,children:(0,te.jsx)("div",{style:v.scrollerContainer,children:(0,te.jsxs)(wt().H,{type:bt().A.X,style:v.scroller,children:[(0,te.jsx)(te.Fragment,{children:P(_)}),(0,te.jsx)(te.Fragment,{children:(0,te.jsx)(St().Ay,{direction:"horizontal",keys:u.filterBar.order,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:e=>R[e],style:v.draggableList,onDrop:e=>function(e){const t={filterOrder:e};xt().K.set({userId:d,key:Vt,value:t}),c.updateFilterOrder(e)}(e)})})]})})})}var Wt=()=>n(381175),$t=()=>n(493552),Gt=()=>n(201980),Qt=()=>n(231297),Xt=()=>n(755199),Yt=()=>n(36951),Zt=()=>n(166442),Jt=()=>n(300789),en=()=>n(360457),tn=()=>n(430483),nn=()=>n(970585),rn=()=>n(329304),on=()=>n(417392),an=()=>n(379819),sn=()=>n(757695),ln=()=>n(406094),dn=()=>n(305872),cn=()=>n(115512),un=()=>n(676007),pn=()=>n(482173);const mn=sn().Store.createClass(!1,{name:"RequestModalOpenStore"}),hn=sn().Store.createClass(!1,{name:"ResponseModalOpenStore"});const gn=function({searchResultStore:e,shouldShow:t,showSpinner:r}){const o=(0,i().uB)(void 0,hn),a=(0,i().uB)(void 0,mn);return t?(0,te.jsx)(pn().A,{title:(0,te.jsx)(n(857744).A,{}),shouldShowReportBadSearchButton:!0,right:(0,te.jsx)(yn,{searchResultStore:e,requestModalOpenStore:a,responseModalOpenStore:o})}):null};function fn(e,t){return{footer:()=>{const{device:t}=e;return{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:t.isMobile?Se().J.UIRegular.mobile:Se().J.UIRegular.desktop}},footerText:{fontSize:cn().ny(e,"UISmall"),...Se().RC},inlineHint:{display:"inline",marginInlineEnd:16},resultCountWrapper:{display:"flex",alignItems:"center",...Se().RC},resultCount:{fontWeight:Se().Wy.medium},resultText:{verticalAlign:"middle",marginInlineEnd:6},spinner:{display:"inline",width:12,height:12,verticalAlign:"middle"},keyboardShortcut:{marginInlineEnd:4,marginBottom:1,fontVariant:"all-small-caps",fontSize:1.1*cn().ny(e,"UISmall")},commandGlyph:{fontSize:.75*cn().ny(e,"UIRegular")},footerDebugButton:(0,pn().q)(t),debugModalStyle:{maxHeight:"90vh",maxWidth:"90vw",height:"90vh",width:"90vw",overflow:"scroll",padding:10},navigationHints:{marginInlineStart:15}}}function yn({searchResultStore:e,requestModalOpenStore:t,responseModalOpenStore:n}){const r=(0,a().DP)(),s=(0,o().v3)(),{debug:l,showDebugInfo:d}=(0,i().K8)((()=>{const{debug:e,showDebugInfo:t}=I().Ay.state;return{debug:e,showDebugInfo:t}}),[]),c=(0,i().K8)((()=>{var t;return null===(t=e.state.serverResults)||void 0===t||null===(t=t.debugInfo)||void 0===t?void 0:t.response}),[e]),u=(0,i().O$)(t),p=(0,i().O$)(n);if(!l&&!d)return null;const{rawRequests:m,rawResponses:h}=c||{};return(0,te.jsxs)(te.Fragment,{children:[m?(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(un().a,{open:u,innerStyle:fn(s,r).debugModalStyle,onDismiss:()=>{t.setState(!1)},render:()=>(0,te.jsx)(dn().H,{showCopyButton:"large",defaultCollapsed:!1,data:m})}),(0,te.jsx)(ln().A,{size:"lg",style:fn(s,r).footerDebugButton,onClick:()=>t.setState(!0),children:"Open Request"})]}):void 0,h?(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(un().a,{open:p,innerStyle:fn(s,r).debugModalStyle,onDismiss:()=>{n.setState(!1)},render:()=>(0,te.jsx)(dn().H,{showCopyButton:"large",data:{rawResponses:h},defaultCollapsed:!1})}),(0,te.jsx)(ln().A,{size:"lg",style:fn(s,r).footerDebugButton,onClick:()=>n.setState(!0),children:"Open Response"})]}):void 0]})}n(430670);var vn=n(440961),bn=()=>n(260488),xn=()=>n(883476),Sn=()=>n(915189),wn=()=>n(496067),kn=()=>n(718807),In=()=>n(64e3),Tn=()=>n(97294);const Mn=function(e){const{style:t,captionStyle:n,title:r,caption:i}=e,a=(0,o().v3)(),s=An(a),l={...s.menuItem,...t},d={...s.caption,...n};return(0,te.jsx)(we().Ay,{...e,title:(0,te.jsx)(Bn,{title:r}),caption:(0,te.jsx)(jn,{caption:i,captionStyle:d}),textWrapperStyle:An(a).text,style:l,captionStyle:d})};function Cn(e){return{title:{color:e.text.secondary},caption:{color:e.text.tertiary}}}function jn({captionStyle:e,caption:t}){const n=(0,a().DP)();if(!t)return null;const r={...e,...Cn(n).caption};return(0,te.jsx)("div",{style:r,children:t})}function An(e){return{menuItem:{minHeight:void 0,...e.device.isMobile&&{background:void 0,boxShadow:void 0},paddingTop:32,paddingBottom:32},text:{textAlign:"center"},title:{margin:0,fontWeight:Se().Wy.medium,fontSize:cn().ny(e,"UIRegular"),lineHeight:cn().ks(e,"UIRegular")},caption:{fontSize:cn().ny(e,"UIRegular")}}}function Bn({title:e}){const t=(0,a().DP)(),n=(0,o().v3)();if(!e)return null;const r=An(n),i=Cn(t),s={...r.title,...i.title};return(0,te.jsx)("div",{role:"alert",style:s,children:e})}const Nn=(0,te.jsx)(X().sA,{defaultMessage:"No results",id:"searchErrorMenuItem.error.noResults"});const _n=function(e){const t=(0,a().IS)((e=>({menuItem:{marginTop:"auto",marginBottom:"auto"},caption:{marginTop:"auto"},reportProblemButton:{display:"inline",color:e.blue.text.accentPrimary},searchDeletedButton:{display:"inline",lineHeight:"25px",color:e.blue.text.accentPrimary}})),[]),s=(0,o().v3)(),{isQuickSearch:l}=(0,r.useContext)(w().SearchStaticContext),d=(0,i().K8)((()=>(0,n(466088).w)(s)),[s]),c=()=>{n(994877).SI({environment:s,from:"quick_find"})};function u(n,r){const o=function(n,r){if(n||r)return;const o=S().J3(p);if(!S().z7.isDeletedOnly(p.isDeletedOnly))return(0,te.jsx)(X().sA,{id:"searchErrorMenuItem.errorPrompt.searchDeleted",defaultMessage:"Some results may be in your deleted pages.{br}<searchdeleted>Search deleted pages</searchdeleted>",values:{searchdeleted:n=>(0,te.jsx)(Tn().N,{onClick:e.handleSearchDeletedOnly,style:t.searchDeletedButton,children:n}),br:(0,te.jsx)("br",{})}});return o?(0,te.jsx)(X().sA,{defaultMessage:"Try different search terms or filters",id:"searchErrorMenuItem.errorPrompt.searchTermsAndFilters"}):(0,te.jsx)(X().sA,{defaultMessage:"Try different search terms",id:"searchErrorMenuItem.errorPrompt.searchTerms"})}(n,r);return{title:Nn,caption:o}}const p=(0,i().K8)((()=>N().Ay.state.query.filters),[]);return(0,te.jsx)(Mn,{...function(n,r){const o=e.error;switch(o.type){case Ct().yq.NoResults.type:return u(n,r);case Ct().yq.Offline.type:return function(){const e=(0,te.jsx)(X().sA,{defaultMessage:"Go online for more results.",id:"searchErrorMenuItem.errorPrompt.goOnline"});return{title:Nn,caption:e}}();case Ct().yq.RequestFailed.type:return{title:(0,te.jsx)(X().sA,{id:"searchErrorMenuItem.error.genericErrorMessage",defaultMessage:"Something went wrong"}),caption:(0,te.jsx)(X().sA,{id:"searchErrorMenuItem.errorPrompt.refreshOrReport",defaultMessage:"Try refreshing or <reportlink>report a problem</reportlink>.",values:{reportlink:e=>(0,te.jsx)(Tn().N,{onClick:c,style:t.reportProblemButton,children:e})}})};default:(0,V().HB)(o)}}(l??!1,d),style:t.menuItem,captionStyle:t.caption,shouldWrapCaption:!0})};var Rn=()=>n(913441);function Pn(e){const{searchResultStore:t}=e,n=(0,i().O$)(De().AppStoreSidebarSpaceStore),r=(0,i().K8)((()=>{var e;const r=t.state.currentlySelectedUniversalSearchResultView;if(!r||!n)return[];return((null===(e=t.state.universalResults)||void 0===e?void 0:e[r])??[]).flatMap((({key:e,result:t})=>((0,Sn().SF)(t,n)??[]).filter((e=>"notion"!==e.type)).map((t=>({key:e,result:t}))))).filter(V().O9)}),[t,n]),o=(0,a().IS)((e=>({container:{display:"flex",flexDirection:"column",gap:10,paddingInlineStart:20,paddingInlineEnd:20},noResultsPrompt:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:e.text.tertiary}})),[]);return n?0===r.length?(0,te.jsx)("div",{style:o.noResultsPrompt,children:(0,te.jsx)(X().sA,{defaultMessage:"No results",id:"SearchResultsMenuList.NoResults"})}):(0,te.jsx)(wt().H,{type:bt().A.Y,style:o.container,children:r.map((({key:e,result:t},n)=>(0,te.jsx)(xn().V,{result:t,position:n},e)))}):null}const En=r.memo((function(e){var t,s,l,d,c;const[u,m]=(0,r.useState)(!1),{searchResultStore:h,localResults:g,serverResults:f,resultListStore:v,searchExperimentOverrides:b,assistantResultItem:x,subscribeToTopicItem:k,extraTopPadding:T,comboboxProps:M,isQueryNaturalLanguageQuestion:C}=e,j=(0,o().Y0)().isMobile,A=(0,a().IS)((e=>({results:{paddingTop:T?8:4,flex:1,display:"flex",flexDirection:"column",overflow:"auto",height:"100%",paddingInlineStart:4,paddingInlineEnd:4},messageMenuItem:{...j&&{background:void 0,boxShadow:void 0}},debugMessageMenuItemTextStyle:{whiteSpace:"pre-wrap",fontFamily:"monospace",marginTop:0},menuListContainer:{display:"flex",flexDirection:"column",marginTop:j?13:void 0,marginBottom:4},section:{marginBottom:4}})),[j,T]),_=(0,o().v3)(),R=e.errorState,P=(0,r.useCallback)((()=>{h.endTimeToRenderServerResultsTiming(_)}),[h,_]),E=(0,i().K8)((()=>h.state.queryBasedActionResults??[]),[h]),{isNewElectronTab:D,searchSessionId:O}=(0,i().K8)((()=>({isNewElectronTab:Boolean(B().default.state.isNewElectronTab),searchSessionId:B().default.state.sessionId})),[]),F=(0,i().K8)((()=>{const{tabs:e,currentTab:t}=n(982254).A.state;return(0,S().iu)(e,t.id)}),[]),q=(0,i().K8)((()=>(0,n(620333).mk)({searchSessionId:B().default.state.sessionId,searchSessionFlowNumber:n(498719).default.state.numServerRequests})),[]),L=(0,i().K8)((()=>0===E.length?[]:E.map((e=>(0,n(896278).g)({environment:_,result:e,queryId:q,desktopProps:{electronTabs:F,isNewElectronTabSearch:D},searchSessionId:O,source:"quick_find",action:t=>{"full_search"!==e.eventName&&bn().st({environment:_,reset:!0,searchResultStore:h})}})))),[E,_,q,F,D,h,O]),K=(0,i().K8)((()=>tn().zD.isDeepFindEnabled()),[]),U=(0,i().K8)((()=>{if(!x&&!k)return;return{key:"search-results-actions-section",render:e=>(0,te.jsx)(ee().A,{...e,shouldShowBottomDivider:!1,disableMobilePadding:!0,disableMobileBorders:!0,title:K?void 0:(0,te.jsx)(X().sA,{id:"search.searchActions.actions.text",defaultMessage:"Actions"}),titleClassName:y().J5z,style:A.section}),items:p().oE([k,x])}}),[x,k,K,A.section]),H=((null==U?void 0:U.items.length)??0)+E.length,W=(0,i().K8)((()=>h.state.serverResultsLoading),[h]),$=(0,n(385979).h)({resultsCount:((null==g?void 0:g.length)??0)+L.length,shouldShow:W}),G=(0,z().Y)(),Q=(0,r.useMemo)((()=>(0,S().HA)({intentBasedGrouping:G,localResults:g,serverResults:f})),[G,g,f]),Y=(0,r.useCallback)((t=>{const{results:n,sectionTitle:o,compact:i,additionalResults:a}=t,{id:s,title:l}=function(e){if(!e)return{id:"allSearchResults",title:void 0};switch(e.type){case"unique-id":return{id:"uniqueIdSearchResults",title:(0,te.jsx)(X().sA,{id:"search.searchResultBuckets.uniqueID.text",defaultMessage:"ID matches"})};case"jump-back-in":return{id:"jumpBackInSearchResults",title:(0,te.jsx)(X().sA,{id:"search.searchResultBuckets.topResults.text",defaultMessage:"Top results"})};case"server":return{id:"serverOnlySearchResults",title:(0,te.jsx)(X().sA,{id:"search.searchResultBuckets.server.text",defaultMessage:"{count}{maybeLowerBoundSign} results",values:{count:e.values.count,maybeLowerBoundSign:e.values.isLowerBound?"+":""}})};case"main":return{id:"mainSearchResults",title:(0,te.jsx)(X().sA,{id:"search.searchResultBuckets.bestMatches.text",defaultMessage:"Best matches"})};default:(0,V().HB)(e)}}(o),d=Boolean(n.length+((null==a?void 0:a.length)??0)>0),c=$&&"main"===(null==o?void 0:o.type);if(d||c)return{key:s,render:e=>(0,te.jsx)(ee().A,{...e,shouldShowBottomDivider:!1,disableMobilePadding:!0,disableMobileBorders:!0,title:l,titleClassName:y().J5z,style:A.section}),items:p().oE([...a??[],...n.map(((t,n)=>function(e){var t;const{selectedResult:n,index:o,props:i,compact:a,onEndTimeToRenderServerResults:s}=e,{store:l}=n;let d;d=n.workflowData||l.isNavigableBlock()?l:l.getNavigableBlockStore();if(!d)return;const c=r.createRef(),u=Boolean(I().Ay.getDebugLevel()),p=u&&n.sources.includes(Ct().Ni.Local)?{id:n.id,localSource:n.localSource,score:n.score,localRelevancies:n.localRelevancies,frecencyScore:n.frecencyScore,personalizationBoost:n.personalizationBoost,terms:n.terms}:void 0,m=u&&(n.sources.includes(Ct().Ni.ElasticSearch)||n.sources.includes(Ct().Ni.VectorDBBlock)||n.sources.includes(Ct().Ni.VectorDBCollection)||n.sources.includes(Ct().Ni.VectorDBBlockOpenAI)||n.sources.includes(Ct().Ni.VectorDBCollectionOpenAI)||n.sources.includes(Ct().Ni.VectorDBBlockBGE)||n.sources.includes(Ct().Ni.VectorDBCollectionBGE)||n.sources.includes(Ct().Ni.VectorDBBlockBGE1024)||n.sources.includes(Ct().Ni.VectorDBCollectionBGE1024)||n.sources.includes(Ct().Ni.VectorDBBlockBGE4096)||n.sources.includes(Ct().Ni.VectorDBCollectionBGE4096)||n.sources.includes(Ct().Ni.VectorDBBlockE5)||n.sources.includes(Ct().Ni.VectorDBCollectionE5))?null===(t=i.debugInfo)||void 0===t||null===(t=t.response)||void 0===t?void 0:t.resultsDebugMap[l.id]:void 0,h=i.clusterInfo;return{key:`${l.id}:${o}`,action:e=>{const{event:t}=e;function r(e){const n=vn.findDOMNode(e.current);return Boolean(n&&"target"in t&&t.target&&(n===t.target||n.contains(t.target)))}c.current&&r(c)||i.handleSelectResult({event:e.event,index:{local:e.indexLocal,global:e.index},selectedResult:n,fromSidePeekPanel:!1,context:"query_results"})},render:e=>{var t;return(0,te.jsx)(Rn().GC,{...e,index:o,isFirstInSection:0===o,store:d,hidePath:!1,result:n,className:y().LF7,debugLocal:p,debugHits:m,debugAreaRef:c,clusterInfo:h,inline:a&&!u,inlineCaptionMinWidthPercentage:20,queryId:null===(t=n.serverEventProperties)||void 0===t?void 0:t["server-queryId"],type:"query_results",onEndTimeToRenderServerResults:s})}}}({selectedResult:t,index:n,props:e,compact:i,onEndTimeToRenderServerResults:P}))),...$??[]])}}),[$,A.section,e,P]),Z=(0,i().K8)((()=>Y({results:"intent-based-grouping"===Q.type?Q.sections.jumpBackInSearchResults:[],additionalResults:void 0,sectionTitle:{type:"jump-back-in"},compact:!0})),[Y,Q.sections,Q.type]),ne=(0,i().K8)((()=>{const e="intent-based-grouping"===Q.type?Q.sections.serverOnlySearchResults:[],{count:t,isLowerBound:n}=h.getResultCount();return Y({results:e,additionalResults:void 0,sectionTitle:{type:"server",values:{count:t,isLowerBound:n}},compact:!1})}),[Y,Q.sections,Q.type,h]),re=(0,i().K8)((()=>Y({results:"uniqueIdSearchResults"in Q.sections?Q.sections.uniqueIdSearchResults:[],additionalResults:void 0,sectionTitle:{type:"unique-id"},compact:!1})),[Y,Q.sections]),oe=(0,i().K8)((()=>Y({results:"unique-id"===Q.type?Q.sections.nonUniqueIdSearchResults:"all"===Q.type?Q.sections.allSearchResults:[],additionalResults:L,sectionTitle:"unique-id"===Q.type||H>0?{type:"main"}:void 0,compact:!1})),[Y,Q.type,Q.sections,L,H]),ie=[U,Z,re,ne,oe].filter(V().O9),ae=null===(t=e.debugInfo)||void 0===t||null===(t=t.response)||void 0===t?void 0:t.parsedQueries,se=null===(s=e.debugInfo)||void 0===s||null===(s=s.response)||void 0===s?void 0:s.detectedLanguages,le=null===(l=e.debugInfo)||void 0===l?void 0:l.traceLogs,de=null===(d=e.debugInfo)||void 0===d||null===(d=d.response)||void 0===d?void 0:d.debugUrls,{onMaybeLoadMoreResults:ce}=e,ue=(0,r.useCallback)(((e,t)=>{const n=e<=200;n&&!u&&ce(),m(n),t.offsetFromTop&&N().Ay.update((e=>({...e,hasScrolled:!0})))}),[u,ce]),pe=0===((null==g?void 0:g.length)??0)&&0===L.length&&"serverError"in R&&"NoResultsFound"===(null===(c=R.serverError)||void 0===c?void 0:c.type),me=(0,r.useMemo)((()=>pe?0:null!=U&&U.items.length?C?0:U.items.length:0),[pe,null==U?void 0:U.items.length,C]);return(0,te.jsx)(w().SearchStaticContext.Consumer,{children:({queryResultsSectionRef:e})=>(0,te.jsxs)("section",{style:A.results,ref:e,children:[p().Im(b)?void 0:On((0,te.jsx)(dn().H,{data:{searchExperimentOverrides:b},showCopyButton:!1,showModalButton:!1,defaultCollapsed:!1}),A.debugMessageMenuItemTextStyle),ae?(0,te.jsx)(te.Fragment,{children:On((0,te.jsx)(dn().H,{data:{parsedQueries:ae},customCollapsedRenderers:[Un],showCopyButton:"small",showModalButton:!0,defaultCollapsed:!0}),A.debugMessageMenuItemTextStyle)}):void 0,se?On((0,te.jsx)(dn().H,{data:{detectedLanguages:se},customCollapsedRenderers:[Ln]}),A.debugMessageMenuItemTextStyle):void 0,le?On((0,te.jsx)(dn().H,{data:{tracer:{traceLogs:le}},customCollapsedRenderers:[qn],defaultCollapsed:!0}),A.debugMessageMenuItemTextStyle):void 0,de?On((0,te.jsx)(dn().H,{data:{debugUrls:de},defaultCollapsed:!0,customCollapsedRenderers:[zn],showCopyButton:"small",showModalButton:!0,maxLinkValueLength:40}),A.debugMessageMenuItemTextStyle):void 0,ie?(0,te.jsx)("div",{className:"search-results-list",children:(0,te.jsx)(J().Ay,{type:J().Oh.Vertical,initialFocus:me,store:v,disableKeyboardArrowWrap:!0,sections:ie,style:A.menuListContainer,comboboxProps:M})}):void 0,Dn(_,R,A.messageMenuItem)||(0,te.jsx)(n(228927).A,{onChange:ue})]})})}));function Dn(e,t,n){if(!t.isLoading)return t.showMajorError?(0,te.jsx)(_n,{error:t.serverError,handleSearchDeletedOnly:()=>{const t=N().Ay.state.query.text;bn().st({environment:e,reset:!1}),wn().A.setState({...wn().A.state,open:!0}),kn().Ay.setState({...kn().Ay.state,filter:t})}}):t.serverError&&t.serverError!==Ct().yq.NoResults?function(e,t){return(0,te.jsx)(ee().A,{disableMobilePadding:!0,disableMobileBorders:!0,children:(0,te.jsx)(In().A,{title:e,style:t})})}(t.serverError.message,n):void 0}function On(e,t){return(0,te.jsx)(ee().A,{disableMobilePadding:!0,disableMobileBorders:!0,topBorder:!1,style:{marginTop:0,paddingTop:0},children:(0,te.jsx)(we().Ay,{body:e,bodyStyle:t})})}function Fn(e){const t=e.replaceAll(/\(MatchNoDocsQuery\("Matching no documents because no terms present"\)\)\^[0-9\.]/g,"").replaceAll(/MatchNoDocsQuery\("Matching no documents because no terms present"\)/g,"").replaceAll(/ConstantScore\(([^)]+):([^)]+)\)/g,"<i>$1</i>:<b>$2</b>").replace(/function score \(\((.*)\), functions:.*\)/,"$1").replaceAll("( ","(").replaceAll(" )",")").replaceAll("|","| <br/>").replaceAll(/([^( ]+):"([^"]+)"/g,'<i>$1</i>:<b>"$2"</b>').replaceAll(/([^( ]+):([^) ]+)/g,"<i>$1</i>:<b>$2</b>");return(0,te.jsx)("span",{dangerouslySetInnerHTML:{__html:t}})}function qn({data:e,keyPath:t}){if("traceLogs"===(null==t?void 0:t[0])&&p().Qd(e)&&Array.isArray(e.log)&&e.log.length>0){const{log:t,startTimeMs:n}=e;return{element:(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)("div",{children:(0,te.jsx)("b",{children:`Trace started at ${n}`})}),t.map(((e,t)=>(0,te.jsxs)("div",{children:[(0,te.jsx)("span",{style:Vn,children:`[${e.timestamp-n}ms][${e.callerFileName.split(".")[0]}]`}),(0,te.jsx)("span",{children:`${e.msg}`})]},t)))]}),expanded:!1}}return null}function Ln({data:e,keyPath:t}){return"detectedLanguages"===t.join(".")&&p().Qd(e)?{element:(0,te.jsx)(te.Fragment,{children:Object.entries(e).filter((([e,t])=>Boolean(t))).map((([e])=>e)).join(", ")||"None"}),expanded:!1}:null}const Kn=["type","description","time_in_nanos"];function Un({data:e,keyPath:t}){var n,r;const o=e,i=Object.values(o).find((e=>void 0!==e));if(!i)return null;if(!Kn.every((e=>i[e])))return null;if(1===t.length)return{element:Fn(i.description),expanded:!1};let a=i.description??"";return null!==(n=a)&&void 0!==n&&n.includes("permissions.teamIds")&&(a="PermissionsQuery"),null!==(r=a)&&void 0!==r&&r.includes("(_id:[")&&(a="BoostRecentPageIds"),{element:Fn(a),expanded:!1}}const Vn={color:"blue"};function zn({data:e}){const t=e;if(!t)return null;const n=Object.values(t).find((({clusterName:e})=>void 0!==e));if(n){const{clusterName:e}=n;return{element:(0,te.jsx)(te.Fragment,{children:e}),expanded:!1}}return{element:(0,te.jsx)(te.Fragment,{children:"unknown"}),expanded:!1}}X().sA,X().sA;var Hn=()=>n(852507),Wn=()=>n(148307),$n=()=>n(683274);const Gn={id:"search_unified_find_result_tooltip",key:"search_unified_find_result_tooltip",type:"static",props:{}};function Qn(){const[e,t]=(0,r.useState)(!1),n=(0,o().v3)(),a=(0,X().tz)(),s=Wn().A.images.unifiedFind.searchDeepFindTooltipPng;(0,Hn().w)((()=>{const e=new Image;e.src=s,e.onload=()=>t(!0),e.onerror=()=>t(!0)}));const l=(0,i().K8)((()=>N().Ay.state.query.text),[]),{isQuickSearch:d}=(0,r.useContext)(w().SearchStaticContext),c=(0,r.useCallback)((()=>(0,Yt().Iu)({environment:n,query:(0,Gt().x9d)(l),clientStore:Zt().defaultClientAIChatStore,config:{type:"search",searchSessionId:B().default.state.sessionId,scopeForNextSearch:{type:"everything"}},openInNewTab:B().default.state.isNewElectronTab,openUsingQuickSearchHandler:d,surface:"search_modal"})),[n,d,l]);return e?(0,te.jsx)($n().l,{messageKey:"search_unified_find_result_tooltip",title:a.formatMessage(Xn.title),imageUrl:s,badge:a.formatMessage(Xn.newBadge),body:a.formatMessage(Xn.body),button:{text:a.formatMessage(Xn.tryIt),onClick:()=>{c(),(0,Jt().OX)(n,Gn)}}}):null}const Xn=(0,X().YK)({tryIt:{id:"UnifiedFindUpsellTooltip.tryIt",defaultMessage:"Try it"},title:{id:"UnifiedFindUpsellTooltip.title",defaultMessage:"Search all sources with AI"},body:{id:"UnifiedFindUpsellTooltip.body",defaultMessage:"Get instant answers across all your apps"},newBadge:{id:"UnifiedFindUpsellTooltip.newBadge",defaultMessage:"New"}});const Yn=(0,X().YK)({untitledWorkspace:{defaultMessage:"Untitled workspace",id:"searchResultsBody.askAiInUntitledWorkspacePlaceholder"},askAiInSpace:{id:"searchResultsBody.askAiInSpace",defaultMessage:"in {name}"},unifiedFindAskAiMenuItemTitle:{id:"searchResultsBody.unifiedFindAskAiMenuItem.title",defaultMessage:"Search all sources with AI"},subscribeToTopicMenuItemTitle:{id:"searchResultsBody.subscribeToTopicMenuItem.title",defaultMessage:"Subscribe to this topic"},askAiMenuItemServiceDown:{id:"searchResultsBody.askAiMenuItem.serviceDown",defaultMessage:" — {icon} AI is currently unavailable"},askAiMenuItemTitle:{id:"searchResultsBody.askAiMenuItem.title",defaultMessage:"Ask AI"}});const Zn=function(e){const{searchResultStore:t,sxsMode:s,searchDebugColumnStore:l,extraTopPadding:d,comboboxProps:u}=e,p=(0,o().v3)(),m=(0,X().tz)(),h=(0,i().O$)(De().AppStoreSidebarSpaceStore),g=(0,i().K8)((()=>N().Ay.state.query.text),[]),f=(0,i().uB)(void 0,nn().A),y=(0,i().K8)((()=>f.state.focus),[f]),{handleSelectSearchResult:v,isQuickSearch:b}=(0,r.useContext)(w().SearchStaticContext),{localResults:x,serverResults:k,clusterInfo:I,debugInfo:T,serverResultsLoading:M,searchExperimentOverrides:C,hasPublicAccessPermission:j,serverResultsAllLoaded:A}=(0,i().K8)((()=>{var e,n;const{hasPublicAccessPermission:r}=S().Er(p);return{localResults:t.state.localResults,serverResults:t.state.serverResults,serverResultsLoading:t.state.serverResultsLoading,clusterInfo:null===(e=t.state.serverResults)||void 0===e?void 0:e.clusterInfo,debugInfo:null===(n=t.state.serverResults)||void 0===n?void 0:n.debugInfo,searchExperimentOverrides:l.state.searchExperimentOverrides,hasPublicAccessPermission:r,serverResultsAllLoaded:t.state.serverResultsAllLoaded}}),[t,l,p]),_=(0,i().K8)((()=>t.state.errorState),[t]),R=(0,r.useCallback)((()=>{!M&&!A&&void 0!==k&&N().Ay.update((e=>({...e,limit:e.limit+N().ZK,isScrolled:!0,source:"quick_find_scroll"})))}),[M,A,k]),P=(0,i().K8)((()=>S().yu({localResults:null==x?void 0:x.results,serverResults:null==k?void 0:k.results})??[]),[x,k]),E=(0,i().K8)((()=>{let e;return e=h?(0,n(665381).G)(p,h):m.formatMessage(Yn.untitledWorkspace),m.formatMessage(Yn.askAiInSpace,{name:e})}),[h,p,m]),D=(0,i().K8)((()=>tn().zD.isDeepFindEnabled()),[]),O=(0,i().K8)((()=>B().default.state.sessionId),[]),{isNaturalLanguageQueryWithCredits:q,aiSearchResultItemVariant:L,aiUsageAvailability:K,hasCreditsForAiUsage:U}=(0,n(957046).T)({query:g,searchSessionId:O}),V="auto_streaming"===L,{actionForFeatureAvailability:z}=(0,n(949305).x)({featureAvailability:K,upgradeRequestAnalyticsEntrypoint:"search_modal",upgradeRequestEntrypoint:"search_modal",upsellFrom:"ai_unified_find_search_modal"}),H=(0,i().K8)((()=>n(321843).R.isUnifiedFindDown()),[]),W=(0,a().IS)((e=>({container:{display:"flex",flexDirection:"column",width:s?"50%":"100%",overflow:"hidden"},resultsContainer:{display:"flex",flex:1,overflowY:"scroll"},askAiQueryContainer:{display:"flex",flexDirection:"row",width:s?"50%":"100%",flex:1,overflow:"hidden",alignItems:"center",color:e.text.primary,fontWeight:Se().Wy.medium,fontSize:14},unifiedFindInnerTitle:{display:"flex",gap:4,alignItems:"center",...Se().RC},query:{fontWeight:Se().Wy.regular,marginInlineStart:6,...Se().RC},textOverflow:{display:"contents",...Se().RC},aiUnavailable:{display:"flex",alignItems:"center",gap:4,...Se().RC},styledTextQuery:{display:"inline",alignItems:"baseline",...Se().RC}})),[s]),$=(0,i().K8)((()=>N().Ay.state.query.filters),[]),{setDismissUnifiedFindUpsell:G,hasUserDismissedSearchModalUnifiedFindComponent:Q,canDismissUnifiedFindUpsell:Y}=function(){const{spaceId:e,userId:t}=(0,i().K8)((()=>{var e,t;return{spaceId:null===(e=De().AppStoreSidebarSpaceStore.state)||void 0===e?void 0:e.id,userId:null===(t=De().default.state.currentUserStore)||void 0===t?void 0:t.userId}}),[]),n=(0,rn()._X)({name:"ai_usage",spaceId:e,userId:t,amount:1}),a="available"===(null==n?void 0:n.type),s=(0,i().K8)((()=>{const e=De().default.state.currentUserSettingsStore;if(!e)return!1;if(a)return!1;return Boolean(e.getSettingsStore().getKeyStore("ai_search_modal_item_dismissed_by_user_without_ai_at").getValue())}),[a]),l=(0,o().v3)(),d=(0,r.useCallback)((()=>{const e=De().default.state.currentUserSettingsStore;e&&Qt().createAndCommit({userAction:"debuggingHelpers.resetAiSearchModalItemDismissed",environment:l,canUndo:!0,userId:t,perform:t=>{Xt().mJ({userSettingsStore:e,data:{ai_search_modal_item_dismissed_by_user_without_ai_at:Date.now()},transaction:t})}})}),[l,t]);return{setDismissUnifiedFindUpsell:d,hasUserDismissedSearchModalUnifiedFindComponent:s,canDismissUnifiedFindUpsell:!a}}(),Z=(0,n(59226).X)("topic_subscriptions_posts_in_feed"),J=(0,r.useCallback)((()=>{if(p.device.isPhone)return;if("auto_streaming"===L||"none"===L||Q)return;return{type:"assistant",renderTitle:()=>(0,te.jsxs)("div",{className:"notranslate",style:W.askAiQueryContainer,children:[(0,te.jsx)("span",{style:W.textOverflow,children:D?(0,te.jsxs)("div",{style:W.unifiedFindInnerTitle,children:[m.formatMessage(V?Yn.askAiMenuItemTitle:Yn.unifiedFindAskAiMenuItemTitle),H?(0,te.jsx)($t().D,{as:"span",styleKey:"Caption/Regular",colorVariant:"tertiary",style:W.aiUnavailable,children:m.formatMessage(Yn.askAiMenuItemServiceDown,{icon:(0,te.jsx)(F().I,{icon:n(553034).C})})}):(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(n(90546).O,{}),(0,te.jsx)($t().D,{styleKey:"Caption/Regular",colorVariant:"tertiary",style:W.styledTextQuery,children:` — "${g}"`})]})]}):m.formatMessage(Yn.askAiMenuItemTitle)}),D?null:(0,te.jsx)("span",{style:W.query,children:g.length>0?' "Search query"':` ${E}`})]}),action:e=>{if(!H)if(U||!z){var t,r,o;const i={metric:n(406792).default.mark("ai_input_to_transcript_render"),surface:"search_modal"};Zt().defaultClientAIChatStore.setState({...Zt().defaultClientAIChatStore.state,userInputToTranscriptRenderMetric:i}),(0,Yt().Iu)({environment:p,query:(0,Gt().x9d)(g),clientStore:Zt().defaultClientAIChatStore,config:{type:"search",searchSessionId:B().default.state.sessionId,scopeForNextSearch:{type:"everything"},filtersForNextSearch:{dateRangeFilter:{startDate:null===(t=$.lastEditedTime.starting)||void 0===t?void 0:t.start_date,endDate:null===(r=$.lastEditedTime.ending)||void 0===r?void 0:r.start_date},createdByFilter:$.createdBy,titleOnlyFilter:$.navigableBlockContentOnly,ancestorsFilter:$.ancestors,teamspacesFilter:Array.isArray($.inTeams)?$.inTeams:null===(o=$.inTeams)||void 0===o?void 0:o.teamIds}},openInNewTab:!!B().default.state.isNewElectronTab||"tab"===(0,Wt().V)(e.event),openUsingQuickSearchHandler:b,surface:"search_modal"})}else z&&z()}}}),[L,D,g,$,W.unifiedFindInnerTitle,W.aiUnavailable,W.styledTextQuery,W.askAiQueryContainer,W.textOverflow,W.query,m,V,H,Q,E,U,z,p,b]),ee=(0,i().K8)((()=>{if(!n(131448).default.isVisible("search_unified_find_result_tooltip"))return!1;return p.WindowSizeStore.state.width>=1260&&!Boolean(b)&&!H}),[p.WindowSizeStore,H,b]),ne=(0,r.useRef)(null),re=(0,r.useCallback)((()=>{if(g.trim()&&Z)return{key:"SubscribeToTopicMenuItem",action:()=>{const e=g.trim();n(568008).OY({environment:p,name:e,creator:"human"}),n(812182).Iz({message:`Topic "${e}" added to your subscriptions`,icon:n(877788).w,actions:{primary:{title:"Go to Home",onAction:()=>{const e=n(696746).XH("main");e&&e.load().then((()=>{e.canRead()&&n(857783).uK({environment:p,store:e,pageVisitSource:c().y8.PersonalHomeUnknown})}))}}},presentationType:"transient"})},render:e=>(0,te.jsx)(an().A,{...e,type:"topic",title:(0,te.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,te.jsx)("span",{children:m.formatMessage(Yn.subscribeToTopicMenuItemTitle)}),(0,te.jsx)($t().D,{as:"span",styleKey:"Caption/Regular",colorVariant:"tertiary",style:{marginInlineStart:6,...Se().RC},children:` — new content related to "${g.trim()}" will show up in Home`})]})})}}),[p,m,g,Z]),oe=(0,i().K8)((()=>{if(s||"default"!==B().default.state.searchMode)return;if("auto_streaming"===L){const e={key:"AssistantStreamingElement",action:e=>{if(!ne.current)return;const t=(0,Wt().V)(null==e?void 0:e.event),n=B().default.state.isNewElectronTab,r=Boolean("tab"===t||n);ne.current.navigateToThread({openInNewTab:r})},render:e=>(0,te.jsx)(n(86771).bF,{query:g,searchFilters:$,searchResultsStore:t,searchSessionId:B().default.state.sessionId,menuListItemProps:e,ref:ne})};return e}const e=J();return e?function(e){const{environment:t,item:n,key:r,shouldShowDeepFindTooltip:o,shouldShowDismissButton:i,onClickDismissButton:a}=e;return{key:"SearchResults.SearchAssistantMenuItem"+(r?`.${r}`:""),action:e=>{n.action(e),o&&(0,Jt().OX)(t,Gn)},render:e=>(0,te.jsx)(on().Ay,{open:o,trapFocus:!1,keepFocus:!0,preventCaptureEsc:!0,placementToOrigin:"right",alignmentToOrigin:"start",popupType:on().nl.Popup,disableMouseCapture:!0,preventScaleTransition:!0,preventOpacityTransition:!0,origin:(0,te.jsx)(an().A,{...e,...n,onClickDismissButton:a,shouldShowDismissButton:i,title:n.renderTitle()}),render:()=>(0,te.jsx)(Qn,{}),style:{backgroundColor:"transparent",boxShadow:"none",padding:0,overflow:"visible",bottom:en().g,insetInlineStart:en().g}})}}({environment:p,key:"AssistantMenuListSearchItem",item:e,shouldShowDeepFindTooltip:ee,shouldShowDismissButton:!Q&&Y,onClickDismissButton:()=>G()}):void 0}),[s,L,J,p,ee,Q,Y,g,$,t,G],{useDeepEqual:!0}),ie=(0,i().K8)((()=>re()),[re]),ae=(0,i().K8)((()=>{const e=[];ie&&e.push({type:"assistant",value:g}),oe&&e.push({type:"assistant",value:g}),t.update((t=>({...t,fixedActionResults:e})));return e.length}),[oe,ie,g,t]),se=(0,r.useCallback)((e=>f.update((t=>t.focus.isInitialized&&0===t.focus.section&&0===t.focus.indexLocal&&0===t.focus.indexGlobal||void 0!==P&&void 0!==t.focus.indexGlobal&&t.focus.indexGlobal<=P.length?t:{...t,focus:e.numberOfFixedActionResults>0?{section:1,indexLocal:0,indexGlobal:e.numberOfFixedActionResults,footerFocused:!1}:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}}))),[f,P]),le=!1;(0,i().K8)((()=>{N().Ay.state.isSidePeekPanelOpen!==le&&N().Ay.update((e=>({...e,isSidePeekPanelOpen:le})))}),[le]),(0,r.useEffect)((()=>{se({numberOfFixedActionResults:ae})}),[P,ae,se]),(0,r.useEffect)((()=>{void 0!==y.section&&void 0!==y.indexLocal&&void 0!==y.indexGlobal?t.update((e=>({...e,focusedIndex:{local:{section:y.section,indexLocal:y.indexLocal},global:y.indexGlobal}}))):t.update((e=>({...e,focusedIndex:void 0})))}),[y,t]),(0,i().K8)((()=>(0,S().lO)({searchResultStore:t})),[t]);const de=(0,i().K8)((()=>Boolean(t.state.currentlySelectedUniversalSearchResultView)),[t]);return(0,te.jsxs)("div",{style:W.container,children:[de?(0,te.jsx)(Pn,{searchResultStore:t}):(0,te.jsxs)("div",{style:W.resultsContainer,children:[(0,te.jsx)(En,{errorState:_,handleSelectResult:v,onMaybeLoadMoreResults:R,resultListStore:f,searchResultStore:t,localResults:null==x?void 0:x.results,serverResults:null==k?void 0:k.results,debugInfo:T,clusterInfo:I,publicAccessPermission:j,searchExperimentOverrides:C,assistantResultItem:oe,subscribeToTopicItem:ie,extraTopPadding:d,comboboxProps:u,isQueryNaturalLanguageQuestion:q}),null]}),(0,te.jsx)(gn,{searchResultStore:t,showSpinner:M,shouldShow:!0})]})};var Jn=()=>n(700500);function er(e,t,n){const r=[];return tr(t({table:It().ev,id:e}),t,r,!0,new Set,n),p().sb(r)}function tr(e,t,n,r,o,i){if(!e)return;if(o.has(e.id))return;if(o.add(e.id),n.length>=i)return n;e.isType(Jn().Gz)&&n.push(e.id);const a=e.getType()===Jn().xd.transclusionReference&&e.getTransclusionReferenceTargetPointer();a&&tr(t(a),t,n,!1,o,i);if(r||e.hasContent())for(const s of e.getContentIds())tr(t({table:It().ev,id:s}),t,n,!1,o,i)}const nr=function(e){const{onSelect:t,pageId:n,comboboxProps:s}=e,l=(0,i().uB)(void 0,nn().A),d=(0,o().v3)(),c=(0,o().Y0)(),u=(0,i().K8)((()=>new(Bt().B)(d,{table:It().ev,id:n})),[d,n]),p=(0,i().K8)((()=>er(n,u.getRecordModel,10).map((e=>new(Bt().B)(d,{table:It().ev,id:e}))).filter(V().O9)),[u.getRecordModel,d,n]),m=(0,a().IS)((e=>({wrapper:{width:"100%",height:"100%",overflowX:"hidden",overflowY:"auto"}})),[]),h=[{key:"pages",items:p.map((e=>({key:null==e?void 0:e.id,render:t=>(0,r.createElement)(Rn().GC,{...t,store:e,inline:!c.isMobile,hidePath:!1,buttonStyle:{paddingInlineStart:1},type:"recent_pages",key:null==e?void 0:e.id}),action:n=>t({index:{local:n.indexLocal,global:n.index},event:n.event,selectedResult:{store:e,id:e.id,score:-1,spaceId:e.getSpaceId(),sources:[Ct().Ni.Local],featureGroups:[],originalPosition:0,serverEventProperties:void 0},fromSidePeekPanel:!1,context:"recent_pages"})}))),render:e=>(0,te.jsx)(ee().A,{title:(0,te.jsx)(X().sA,{id:"search.default_page_body.pages",defaultMessage:"Pages"}),children:e.children})}];return(0,te.jsx)("div",{style:m.wrapper,children:(0,te.jsx)(J().Ay,{store:l,type:J().Oh.Vertical,initialFocus:0,disableKeyboardArrowWrap:!0,sections:h,unfocusOnScroll:!0,comboboxProps:s})})};function rr(e){const{searchContentPaneType:t,comboboxProps:n}=e,{searchMobileFilterMenuRef:o,handleSelectSearchResult:s,searchResultStore:l,secondarySearchResultStore:d}=(0,r.useContext)(w().SearchStaticContext),c=(0,i().K8)((()=>Boolean((0,I().I5)()&&I().nS.state.visible)),[]),u=(0,i().K8)((()=>{const e=l.state.errorState;return!1===e.isLoading&&e.showMajorError}),[l]),p=(0,a().IS)((()=>({sxsContainer:{display:"flex",flexDirection:"row",height:"100%",overflow:"hidden",maxWidth:"100%"}})),[]),m=(0,i().K8)((()=>N().Ay.state.filterBar.show),[]),h=!O().A.isMobile&&!m,g=(0,r.useMemo)((()=>({searchResultStore:l,searchDebugColumnStore:I().E,sxsMode:c,extraTopPadding:h,comboboxProps:n})),[h,l,c,n]),f=(0,i().K8)((()=>(0,ft().s)()),[]),y=(0,yt().r)();return(0,te.jsxs)(te.Fragment,{children:[!O().A.isMobile&&m?(0,te.jsx)(Ht,{isMobile:Boolean(O().A.isMobile)}):void 0,"search_results"===t?(0,te.jsxs)(te.Fragment,{children:[!u&&O().A.isMobile?(0,te.jsx)($e,{mode:He.Section,ref:o}):void 0,(0,te.jsxs)("div",{style:p.sxsContainer,children:[(0,te.jsx)(Zn,{...g}),c?(0,te.jsx)(Zn,{...g,searchResultStore:d,searchDebugColumnStore:I().nS}):void 0]})]}):y?(0,te.jsx)(vt().Ay,{onSelect:s,spaceId:y,extraTopPadding:h,comboboxProps:n}):f?(0,te.jsx)(nr,{onSelect:s,pageId:f,comboboxProps:n}):null]})}const or=570,ir=500;function ar(e){const t=(0,o().Y0)(),n=(0,o().v3)();return(0,r.useEffect)((()=>{(0,x().Dd)()||g().G(n,"searchContentPane")}),[n]),function(){const{searchResultStore:e,secondarySearchResultStore:t}=(0,r.useContext)(w().SearchStaticContext),{parentStore:n}=(0,r.useContext)(w().SearchStoresContext),o=(0,T().Nu)(n),a=(0,i().K8)((()=>Boolean((0,I().I5)()&&I().nS.state.visible)),[]);(0,T().nR)({dependencies:o,searchResultStore:e,debugColumnStore:I().E,enabled:!0,serverSearchFn:M}),(0,T().nR)({dependencies:o,searchResultStore:t,debugColumnStore:I().nS,enabled:a,serverSearchFn:C,preventUpdateSearchMetrics:!0})}(),(0,A().A)({shouldPreserveTextSelection:!0,shouldPreserveBlockSelection:!0,shouldRestoreSelection:!t.isMobile}),(0,te.jsx)(_().A,{capture:!0,allowMenuList:!0,render:t=>(0,te.jsx)(sr,{...e,ignoreAreaEvents:t})})}function sr(e){const{ignoreAreaEvents:t,quickSearchMode:n,onClose:u,searchContentPaneType:g}=e,{handleQueryChange:x,modalBodyMenuRef:k,searchResultStore:I,defaultBodyFocusedResult:T,handleCopySearchItemLink:M}=(0,r.useContext)(w().SearchStaticContext),[C,A]=(0,r.useState)(!1),[_,P]=(0,r.useState)(!1),[D,O]=(0,j().$)(),F=(0,o().v3)(),q=(0,o().Y0)(),L=(0,i().K8)((()=>N().Ay.state.query.text),[]),{isSearchMenuOpen:K,shouldShowDebugSidebar:U,hasPublicAccessPermission:V,shouldShowSpinner:z}=(0,i().K8)((()=>{const e=Boolean(s().A.state.online),{hasPublicAccessPermission:t}=S().Er(F);return{isSearchMenuOpen:B().default.state.open,shouldShowSpinner:e&&Boolean(L)&&I.state.serverResultsLoading&&!C,shouldShowDebugSidebar:ur({device:q,isPublicAccessPermissionForPage:t}),hasPublicAccessPermission:t}}),[C,I,q,F,L]),H=(0,r.useMemo)((()=>p().sg((()=>{const{activeElement:e}=document;e instanceof HTMLInputElement&&e.blur()}),ir,{leading:!0})),[]),W=(0,r.useCallback)((()=>{_&&H()}),[H,_]),$=(0,r.useCallback)((e=>{P(e),e||q.isMobileNative&&f().m(F,l().i.willHide,0)}),[q.isMobileNative,F]),G=(0,i().K8)((()=>S().lO({searchResultStore:I})),[I]),Q=T,X=(0,r.useMemo)((()=>(0,te.jsx)(gt().h,{isOpen:n||K,onTypingChange:A,onFocusChange:$,showSpinner:z,onQueryChange:x,quickSearchMode:n,selectedResultStore:"page_result"===(null==G?void 0:G.type)?G.value.selectedResult.store:void 0,inputComboboxProps:D,searchResultStore:I})),[K,$,z,x,n,G,D,I]),Y=(0,i().K8)((()=>lr({searchContentPaneType:g,quickSearchMode:n,environment:F})),[g,n,F]),Z=(0,a().IS)((e=>({body:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",zIndex:2},topbar:{height:void 0,marginTop:10,marginInlineStart:16,marginBottom:10,marginInlineEnd:16},topbarRightButtonWrapper:{flex:void 0,paddingInlineStart:16},topbarButton:{fontWeight:void 0,padding:0,color:e.text.secondary},scroller:{display:"flex",flexDirection:"row",flexWrap:"nowrap",justifyContent:"space-between",maxHeight:Y.maxHeight,minHeight:Y.minHeight}})),[Y.maxHeight,Y.minHeight]),J=(0,r.useMemo)((()=>{if(q.isMobile){return{menuType:b().gu.Modal,left:X,shouldRenderLeftDirectly:!0,width:n?"100vw":void 0,...dr({style:Z.topbarRightButtonWrapper,quickSearchMode:n,onClick:u}),header:"search_results"===g&&(0,te.jsx)(pt,{isPublicPageSearch:V}),disableHeaderShadow:!0,topbarStyle:Z.topbar,leftRightButtonStyle:Z.topbarButton,onScroll:cr(q)?W:void 0,bodyScrollerClassName:y().Smt,...t}}return{menuType:b().gu.Popup,maxHeight:Y.maxHeight,minHeight:Y.minHeight,maxWidth:"100%",...n?{width:"100vw"}:{},disableScroller:!0,scrollerStyle:Z.scroller,...t}}),[q,Z,t,X,u,g,V,W,Y.minHeight,Y.maxHeight,n]),ee=Q||G,ne=(0,r.useCallback)((e=>{if("page_result"!==(null==ee?void 0:ee.type))return;const{index:t,selectedResult:n}=ee.value;M({index:t,selectedResult:n,fromSidePeekPanel:e.source===m().rD.SidePeekPanel,context:"search_results"===g?"query_results":"recent_pages",source:e.source})}),[M,g,ee]),re=(0,r.useCallback)((async()=>{if(!F.device.isElectron||!ee||"page_result"!==ee.type)return;const e=ee.value.selectedResult.store,t=(0,v().J8)({store:e,collectionViewId:e.id,fullyQualified:!0,pageVisitSource:c().y8.SearchQuery});if(!t)return;const n=await h().R.clipboardActions.load();n.copyString({environment:F,stringValue:t,copiedMessage:n.clipboardMessages.copiedLinkToClipboard}),ne({source:m().rD.KeyboardShortcut})}),[F,ne,ee]);return(0,te.jsx)(d().N,{debugName:"SearchContentPane",capture:!0,onCopyLinkToCurrentPage:e=>{re()},onCopyLinkToPageInCommandSearch:e=>{re()},children:(0,te.jsxs)(R().A,{...J,className:y().Y0h,ref:k,children:[(0,te.jsxs)("div",{style:Z.body,children:[(0,te.jsx)(E().A,{}),q.isMobile?void 0:X,(0,te.jsx)(rr,{searchContentPaneType:g,comboboxProps:O})]}),U?(0,te.jsx)(ue,{}):void 0]})})}function lr(e){const{searchContentPaneType:t,quickSearchMode:n,environment:r}=e;if(n)return{maxHeight:"100vh",minHeight:"100vh"};const o=r.WindowSizeStore.state.height,i=(0,u().jq)(r.device.isElectronMac),a=o>or+i?or:0;return{minHeight:`max(${"search_results"===t?70:50}vh, ${a}px)`,maxHeight:`max(${"search_results"===t?70:50}vh, ${a}px)`}}function dr({style:e,quickSearchMode:t,onClick:n}){return t?{rightOuterStyle:{display:"none"}}:{right:(0,te.jsx)(P().CancelMenuText,{}),onClickRight:n,rightOuterStyle:e}}function cr(e){return!!e.isMobile&&(!e.isIOS||e.isMobileNative)}function ur({device:e,isPublicAccessPermissionForPage:t}){if(!t&&!e.isMobile)return N().Ay.isDebugSidebarOpen()}},506166:(e,t,n)=>{n.d(t,{E:()=>i});n(296540);var r=n(474848);const o={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.25 15.26",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M8.35 12.274a.625.625 0 0 0 0 1.25h3.3a.625.625 0 1 0 0-1.25zM13 9.844a.625.625 0 1 1 0 1.25H7a.625.625 0 0 1 0-1.25zm-7-2.43a.625.625 0 1 0 0 1.25h8a.625.625 0 1 0 0-1.25z"}),(0,r.jsx)("path",{d:"M10 2.375a7.625 7.625 0 1 0 0 15.25 7.625 7.625 0 0 0 0-15.25M3.625 10a6.375 6.375 0 1 1 12.75 0 6.375 6.375 0 0 1-12.75 0"})]})},i=(0,n(340498).wt)("filterCircle",o)},513402:(e,t,n)=>{n.r(t),n.d(t,{arrowUpDownSmallIcon:()=>o,iconDefinition:()=>r});n(296540);const r={viewBox:"0 0 16 16",fittedViewBox:"1.67 2.48 12.66 11.03",directional:!0,svg:(0,n(474848).jsx)("path",{d:"M11.349 2.672a.625.625 0 0 0-.884 0L7.666 5.471a.625.625 0 1 0 .884.883l1.732-1.73v8.262a.625.625 0 1 0 1.25 0V4.623l1.73 1.731a.625.625 0 0 0 .885-.883zM5.093 2.49a.625.625 0 0 0-.625.624v8.263l-1.73-1.731a.625.625 0 1 0-.885.883l2.798 2.799c.244.244.64.244.884 0l2.798-2.798a.625.625 0 0 0-.883-.884l-1.732 1.73V3.115a.625.625 0 0 0-.625-.625"})},o=(0,n(340498).wt)("arrowUpDownSmall",r)},522500:(e,t,n)=>{n.d(t,{q:()=>o});n(296540);var r=n(474848);const o=(0,n(340498).wt)("megaphone",{viewBox:"0 0 64 64",svg:(0,r.jsx)("path",{d:"m54,10v40h-4l-20-10h-4l4,16h-10l-4-16c-4.94,0-8-3.06-8-8v-4c0-4.94,3.06-8,8-8h14l20-10h4Z"})})},542101:(e,t,n)=>{n.d(t,{r:()=>o});n(296540);const r={viewBox:"0 0 20 20",fittedViewBox:"2.06 1.19 15.88 15.65",svg:(0,n(474848).jsx)("path",{d:"M12.207 1.322a1.91 1.91 0 0 0-2.33.838l-.348.715c-.177.292-.36.658-.535 1.005l-.13.257c-.225.442-.431.822-.627 1.08L6.073 7.521h-2.41a1.6 1.6 0 0 0-1.6 1.6v5.139a1.6 1.6 0 0 0 1.6 1.6H6.97l1.227.42.021.01c.73.366 1.528.554 2.347.554h4.309a1.844 1.844 0 0 0 1.78-2.32c.554-.318.922-.918.922-1.6 0-.284-.067-.547-.18-.78.333-.327.54-.782.54-1.297a1.8 1.8 0 0 0-.388-1.124c.17-.27.271-.592.271-.943a1.844 1.844 0 0 0-1.843-1.844h-3.783c.069-.167.15-.33.242-.516a6 6 0 0 0 .416-1.004l.001-.002.507-1.774a1.913 1.913 0 0 0-1.144-2.315zM10.64 3.449l.345-.71a.66.66 0 0 1 .781-.248c.32.128.488.471.393.804l-.507 1.773v.001c-.08.276-.195.512-.336.797l-.014.028c-.134.27-.292.59-.408.97a1.03 1.03 0 0 0 .988 1.323h4.095c.327 0 .593.267.593.594a.56.56 0 0 1-.27.47.625.625 0 0 0 .066 1.086.56.56 0 0 1 .322.511.58.58 0 0 1-.4.55.625.625 0 0 0-.191 1.074c.149.122.23.285.23.453a.586.586 0 0 1-.584.594.625.625 0 0 0-.452 1.057.594.594 0 0 1-.416 1.02h-4.31c-.593 0-1.17-.13-1.703-.381a.6.6 0 0 0-.161-.083l-1.424-.488a.6.6 0 0 0-.202-.033h-.181V8.475L9.169 6.05l.037-.043c.286-.367.547-.86.772-1.303l.147-.29a13 13 0 0 1 .515-.965M5.794 8.772v5.839H3.663a.35.35 0 0 1-.35-.35V9.122a.35.35 0 0 1 .35-.35z"})},o=(0,n(340498).wt)("handThumbsUp",r)},551171:(e,t,n)=>{n.d(t,{C:()=>o});n(296540);const r={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.12 15.25 11.75",svg:(0,n(474848).jsx)("path",{d:"M9.375 4.125H4.5A2.125 2.125 0 0 0 2.375 6.25v1.375h7zm-7 7v-2.25h7v2.25zm0 1.25v1.375c0 1.174.951 2.125 2.125 2.125h4.875v-3.5zm8.25 0v3.5H15.5a2.125 2.125 0 0 0 2.125-2.125v-1.375zm7-1.25v-2.25h-7v2.25zm0-4.875v1.375h-7v-3.5H15.5c1.174 0 2.125.951 2.125 2.125"})},o=(0,n(340498).wt)("viewTableFill",r)},563253:(e,t,n)=>{n.d(t,{Vd:()=>k,np:()=>g,z_:()=>w});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520);var r=n(296540),o=()=>n(813974),i=()=>n(588165),a=()=>n(484714),s=()=>n(56366),l=()=>n(401497),d=()=>n(69708),c=()=>n(496603),u=()=>n(623580),p=n(474848);const m=["control+t","control+shift+n","control+shift+t","control+w","control+shift+w","control+r","control+shift+r","control+shift+i","control+\\","control+=","control+-","control+0","control+[","control+]","control+shift+tab","control+tab","control+1","control+2","control+3","control+4","control+5","control+6","control+7","control+8","control+9"],h=["command+,","command+t","command+shift+n","command+shift+t","command+w","command+shift+w","command+r","command+shift+r","alt+command+i","command+\\","command+=","command+-","command+0","command+[","command+]","control+shift+tab","control+tab","command+option+left","command+option+right","command+shift+[","command+shift+]","command+1","command+2","command+3","command+4","command+5","command+6","command+7","command+8","command+9"];function g(e){function t(){return e.shortcut?w(e.shortcut,e.isMac):void 0}const{isMac:n,isWindows:g}=(0,a().Y0)(),I=(0,s().K8)((()=>o().getKeyboardShortcuts()),[]),[T,M]=(0,r.useState)(t),[C,j]=(0,r.useState)(new Set([])),[A,B]=(0,r.useState)(),[N,_]=(0,r.useState)(!1),R=(0,r.useRef)(!1),P=(0,r.useRef)(!1),E=(0,r.useRef)(!1),D=(0,l().IS)((e=>({container:{display:"flex",flexDirection:"column",gap:10,alignItems:"flex-end"},takenShortcutError:{color:e.palette.red[500],fontSize:12}})),[]);function O(){if(T&&E.current)if(T.key)if(n?T.control||T.option||T.command:T.control||T.option)if(function(e,t,n){for(const o of Object.values((0,i().a)(e)))for(const e of o)if(c().n4(w(e,n),t))return!0;const r=n?h:m;for(const o of r)if(c().n4(w(o,n),t))return!0;return!1}(I,T,n)||function(e,t,n){for(const r of t)if(c().n4(w(r,n),e))return!0;return!1}(T,e.conflictingShortcuts||[],n)){M(t());const e=k(T,n);B((0,p.jsx)(d().sA,{id:"desktopQuickSearch.error.shortcutAlreadyUsed",defaultMessage:"{reservedShortcut} is already used",values:{reservedShortcut:e}}))}else{const t=function(e,t){const n=[];e.shift&&n.push("shift");e.control&&(t?n.push("control"):n.push("ctrl"));e.option&&(t?n.push("option"):n.push("alt"));e.command&&(t?n.push("command"):n.push("meta"));e.enter&&n.push("enter");e.key&&n.push(e.key.toLowerCase());return n.join("+")}(T,n);e.onChange(t)}else M(t()),B(n?(0,p.jsx)(d().sA,{id:"desktopQuickSearch.error.macModifierRequired",defaultMessage:"Use one of Option, Control, or Command for global keyboard shortcuts"}):(0,p.jsx)(d().sA,{id:"desktopQuickSearch.error.windowsModifierRequired",defaultMessage:"Use one of Control or Alt for global keyboard shortcuts"}));else M(void 0);else E.current||M(t());R.current=!0,_(!1),E.current=!1}function F(e){if(g&&e.startsWith("Meta"))return;const t=new Set([...C,e]),n=function(e){const t={};for(const r of e)r.startsWith(y)?t.command=!0:r.startsWith(b)?t.option=!0:r.startsWith(v)?t.shift=!0:r.startsWith(x)?t.control=!0:r.startsWith(S)?t.enter=!0:r.startsWith("Key")?t.key=r.substring(3).toLowerCase():r.startsWith("Digit")?t.key=r.substring(5):f[r]&&(t.key=f[r]);const n=0===Object.values(t).filter((e=>!c().b0(e))).length;return n?void 0:t}(t);j(t),M(n),B(void 0),E.current=!0}return(0,p.jsxs)("div",{style:D.container,children:[(0,p.jsx)(u().A,{onKeyDown:function(e){P.current=!0,"Escape"===e.key?e.currentTarget.blur():"Tab"!==e.key&&(e.preventDefault(),e.stopPropagation(),F(e.code))},onKeyUp:function(e){P.current&&function(e){const t=new Set([...C]);if(t.delete(e),e.startsWith("Meta"))for(const n of t)n.startsWith(v)||n.startsWith(b)||n.startsWith(x)||t.delete(n);j(t),0===t.size&&O()}(e.code)},onFocus:function(e){M(void 0),_(!0)},onBlur:function(e){R.current||O(),R.current=!1,P.current=!1,j(new Set),_(!1)},focus:N,readOnly:!0,inputStyle:{textAlign:"center",caretColor:"transparent"},value:T&&k(T,n)}),A?(0,p.jsx)("div",{style:D.takenShortcutError,children:A}):void 0]})}const f={ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",Backquote:"`",Backslash:"\\",Backspace:"backspace",BracketLeft:"[",BracketRight:"]",Comma:",",Delete:"delete",Enter:"return",Equal:"=",Minus:"-",Period:".",Quote:"'",Semicolon:";",Slash:"/",Space:"space"},y="Meta",v="Shift",b="Alt",x="Control",S="Return";function w(e,t){const n={};for(let r of e.split("+"))r=r.toLowerCase(),"command"===r||"meta"===r?n.command=!0:"option"===r||"alt"===r?n.option=!0:"shift"===r?n.shift=!0:"control"===r||"ctrl"===r?n.control=!0:"cmdorctrl"===r||"commandorcontrol"===r?t?n.command=!0:n.control=!0:"enter"===r||"return"===r?n.enter=!0:n.key=r;return n}function k(e,t){const n=[];if(e.shift&&(t?n.push("shift"):n.push("Shift")),e.control&&(t?n.push("control"):n.push("Ctrl")),e.option&&(t?n.push("option"):n.push("Alt")),e.command&&(t?n.push("⌘"):n.push("Win")),e.enter&&(t?n.push("enter"):n.push("Return")),e.key){const t=1===e.key.length?e.key.toUpperCase():e.key;n.push(t)}return n.join("+")}},563263:(e,t,n)=>{n.d(t,{A:()=>g});n(581454);var r=n(296540),o=()=>n(56366),i=()=>n(401497),a=()=>n(794198),s=()=>n(854705),l=()=>n(496603),d=()=>n(222917),c=()=>n(765957),u=()=>n(406699),p=()=>n(187820),m=n(474848);function h(e){const{events:t,spaceIcon:n,spaceName:o}=e,[l,d]=(0,r.useState)(!1),c=(0,i().IS)((e=>({wrapper:{display:"flex",alignItems:"center",gap:2,paddingInlineEnd:5,cursor:"pointer"},recordIcon:{backgroundColor:l?e.buttonHoveredBackground:void 0,padding:4,height:void 0,width:void 0}})),[l]);return(0,m.jsxs)("span",{...t,style:c.wrapper,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),role:"button",children:[(0,m.jsx)(p().B6,{bucket:"public",disabled:!0,icon:n,iconRecordCategory:"workspace",isEmptyPage:!1,size:24,style:c.recordIcon,title:o}),(0,m.jsx)(a().I,{icon:s().arrowChevronSingleDownFillSmallIcon,size:"xxs",colorVariant:"tertiary"})]})}const g=function(e){const{mode:t,onWorkspaceSwitch:i}=e??{},a=(0,o().O$)(c().AppStoreSidebarSpaceStore),s=(0,o().K8)((()=>null==a?void 0:a.id),[null==a?void 0:a.id]),p=(0,n(484714).v3)(),g=p.currentUser.id,{handlePopupOpen:f,handlePopupClose:y}=(0,r.useContext)(n(974779).SearchStaticContext),v=(0,r.useCallback)((async e=>{const{newSpaceViewStore:r,associatedUserId:o,closeSwitcherPopupFn:a}=e,s=r.getSpaceId();if(r&&g&&s){var l;const e=null===(l=c().default.state.sidebarSpaceViewStore)||void 0===l?void 0:l.id,u=d().wr();e&&u&&s&&d().mg(p,{currentSearchSessionId:u,currentWorkspaceId:e,newWorkspaceId:s}),a(),c().default.update((e=>({...e,sidebarSpaceViewStore:r,sidebarSpaceStore:null==r?void 0:r.getSpaceStore()}))),g!==o&&await n(840153).T({environment:p,newCurrentUserId:o}),n(430483).zD.isAiEnabled()&&n(650829).assistantDependency.load().then((({assistantActions:e})=>{e.clearAllAssistantSessions()})),n(899677).default.closeAndResetMetricsState(),n(786601).A.closeAndResetMetricsState(),n(498719).default.reset(),n(260488)._N({environment:p,analyticsFrom:"quick-search-switch-workspace",isQuickSearch:!0,mode:t}),null==i||i()}}),[g,p,t,i]),{spaceIcon:b,spaceName:x}=(0,o().K8)((()=>a?{spaceName:a.getName(),spaceIcon:(0,n(625247).c)(p,a)}:{spaceName:void 0,spaceIcon:void 0}),[a,p]),S=[...p.currentUser.loggedInUserIds],w=(0,o().K8)((()=>{var e;return l().hS(l().oE((null===(e=c().default.state.currentUserRootStore)||void 0===e?void 0:e.getSpaceViewStores())??[]),(e=>e.getSpaceId())).length>1}),[]);return a&&s&&g&&a&&(w||1!==S.length)?(0,m.jsx)(u().A,{popupType:u().z.Popup,renderOrigin:e=>(0,m.jsx)(h,{events:e,spaceIcon:b,spaceName:x}),render:e=>(0,m.jsx)(n(404277).A,{menuType:n(722872).gu.Popup,children:S.map(((t,r)=>(0,m.jsx)(n(455997).ti,{onSpaceClick:n=>v({newSpaceViewStore:n.spaceViewStore,associatedUserId:t,closeSwitcherPopupFn:e.close}),userId:t,isLastUser:r===S.length-1,shouldShowNewWorkspaceButtonInUserSpaceView:!1,disableAccountActions:!0,close:e.close},`commandSearch-userworkspaces-${r}`)))}),onClick:f,onClose:y,disabled:!1,placementToOrigin:"bottom",alignmentToOrigin:"start",style:{marginInlineEnd:30}}):null}},566468:(e,t,n)=>{n.d(t,{Ji:()=>k,bd:()=>C,f0:()=>T,mf:()=>M,s7:()=>I});n(944114),n(296540);var r=()=>n(56366),o=()=>n(401497),i=()=>n(30626),a=()=>n(69708),s=()=>n(496603),l=()=>n(534177),d=()=>n(722872),c=()=>n(463830),u=()=>n(760217),p=()=>n(406699),m=()=>n(285790),h=()=>n(710149),g=()=>n(404277),f=()=>n(939740),y=()=>n(417392),v=()=>n(89924),b=()=>n(859428),x=()=>n(125565),S=n(474848);const w=20,k=12;function I({title:e,byline:t,icon:n,iconSize:r,iconMargin:o,useThinTitle:i,useSecondaryColorTitle:a,containerStyles:s,summaryStyles:l,rightContent:d,badge:c}){const u=T({icon:n,iconSize:r,iconMargin:o,useThinTitle:i,containerStyles:s,summaryStyles:l});return(0,S.jsxs)("div",{style:u.container,children:[n?(0,S.jsx)("div",{style:u.iconContainer,children:n}):null,(0,S.jsxs)("div",{style:u.summaryContainer,children:[(0,S.jsxs)("div",{style:u.nameContainer,children:[(0,S.jsx)(x().A,{style:u.name,isSecondaryColor:a,showTooltipWhenTruncated:!0,children:e}),c?(0,S.jsx)("div",{style:u.badge,children:c}):null]}),t?(0,S.jsx)(x().A,{style:u.byline,children:t}):null]}),d]})}function T(e){const{icon:t,iconSize:n,iconMargin:r,useThinTitle:i,containerStyles:a,summaryStyles:s}=e,l=r??k,d=t?n??w:0;return(0,o().IS)((e=>({container:{position:"relative",display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",padding:"8px 0",width:"100%",...a},summaryContainer:{width:`calc(100% - ${d}px)`,...s},iconContainer:{height:d,width:d,flexGrow:0,flexShrink:0,flexBasis:d,marginInlineEnd:l,display:"flex",justifyContent:"center",alignItems:"center",borderRadius:6},badge:{marginInlineEnd:8},nameContainer:{display:"flex",alignItems:"center",gap:6},name:{fontSize:14,fontWeight:i?400:500},byline:{fontSize:12,lineHeight:1.3,opacity:.5}})),[d,l,i,a,s])}function M({titleStyles:e,includeByline:t,bylineStyles:n,includeIcon:r,iconStyles:i,containerStyles:a}){const s=(0,o().IS)((()=>({container:{height:53,display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",padding:"8px 0",width:"100%",gap:8,...a},icon:{borderRadius:4,height:24,width:24,marginInlineStart:-2,...i},textContainer:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",width:"calc(100% - 32px)",gap:4},title:{borderRadius:4,height:14,width:"80%",...e},byline:{borderRadius:4,height:12,width:"60%",...n}})),[a,e,n,i]);return(0,S.jsxs)("div",{style:s.container,children:[r?(0,S.jsx)(h().A,{style:s.icon}):null,(0,S.jsxs)("div",{style:s.textContainer,children:[(0,S.jsx)(h().A,{style:s.title}),t?(0,S.jsx)(h().A,{style:s.byline}):null]})]})}function C(e){const t=(0,a().tz)(),n=(0,r().uB)(void 0,c().A),h=(0,o().IS)((()=>({popupMenu:{width:312}})),[]);let x=[];const w=[];for(const r of e.items)if("divider"===r.type){const t=w.length>0,n={key:`actions-${w.length}`,render:n=>(0,S.jsx)(v().A,{title:e.title,topBorder:t,...n}),items:x};w.push(n),x=[]}else if("action"===r.type){const e={key:r.key,render:e=>(0,S.jsx)(b().A,{textWrap:!0,render:t=>(0,S.jsx)(u().A,{...e,...t,isRedOnHover:r.isDestructive,shouldWrapCaption:!0,icon:r.icon,title:r.title,caption:r.caption,disabled:r.disabled,disabledFeedback:r.disabled}),renderTooltip:()=>r.tooltipTitle,disableTooltip:r.tooltipDisabled??!0,placement:"right"}),action:()=>{r.action(),n.setState({...n.state,open:!1})}};x.push(e)}else(0,l().HB)(r);const k={key:`actions-${w.length}`,render:t=>(0,S.jsx)(v().A,{title:e.title,topBorder:w.length>0,...t}),items:x};return w.push(k),(0,S.jsx)(p().A,{stopClickPropagation:!0,popupType:y().nl.Popup,alignmentToOrigin:"start",placementToOrigin:"bottom",style:h.popupMenu,render:()=>(0,S.jsx)(g().A,{menuType:d().gu.Popup,width:312,children:(0,S.jsx)(f().Ay,{type:f().Oh.Vertical,initialFocus:void 0,sections:w})}),onClose:s().lQ,buttonPopupStore:n,renderOrigin:e=>(0,S.jsx)(m().A,{ariaLabel:t.formatMessage({id:"iconCellActionMenu.iconButton.ariaLabel",defaultMessage:"More actions"}),icon:i()._,...e})})}},568008:(e,t,n)=>{n.d(t,{EF:()=>s,OY:()=>l});n(581454);var r=()=>n(498212),o=()=>n(231297),i=()=>n(755199),a=()=>n(765957);function s(e){var t;const n=(null===(t=e.getSettings())||void 0===t?void 0:t.custom_topics)||{};return Object.entries(n).map((([e,t])=>({id:e,...t})))}function l(e){var t;const{environment:n,name:s,creator:l,description:d,icon:c}=e,u=a().default.state.currentUserSettingsStore;if(!u)return;const p=Date.now(),m=(0,r().lZ)(),h=(null===(t=u.getSettings())||void 0===t?void 0:t.custom_topics)||{};o().createAndCommit({userAction:"userTopicsActions.createTopic",environment:n,canUndo:!0,cellTarget:"main",perform:e=>{i().mJ({userSettingsStore:u,data:{custom_topics:{...h,[m]:{name:s,createdAt:p,updatedAt:p,creator:l,...d?{description:d}:{},...c?{icon:c}:{}}}},transaction:e})}})}},575695:(e,t,n)=>{n.d(t,{A:()=>T});var r=n(296540),o=()=>n(484714),i=()=>n(56366),a=()=>n(401497),s=()=>n(252291),l=()=>n(998531),d=()=>n(30537),c=()=>n(631524),u=()=>n(160432),p=()=>n(563884),m=()=>n(69708),h=()=>n(534177),g=()=>n(56394),f=()=>n(780865),y=()=>n(760217),v=()=>n(417392),b=()=>n(427711),x=()=>n(297401),S=()=>n(978625),w=()=>n(806754),k=()=>n(821879),I=n(474848);const T=function({onChange:e,onMenuDismiss:t,showButtons:r,title:a,value:s,disabled:l,dateFormat:d,icon:c,mode:u,focused:p}){const m=(0,o().v3)(),h=(0,i().uB)(void 0,n(35394).A);(0,n(852507).l)((()=>{R({value:s},h)}));const{device:g}=m;return g.isMobile?(0,I.jsx)(K,{onChange:e,onMenuDismiss:t,showButtons:r,title:a,value:s,disabled:l,dateFormat:d,icon:c,mode:u,store:h}):(0,I.jsx)(L,{onChange:e,onMenuDismiss:t,showButtons:r,title:a,value:s,disabled:l,dateFormat:d,focused:p,icon:c,mode:u,store:h})};function M(e){const{device:t}=e;return t.isMobile?d().n.SlideUp:d().n.Popup}function C(e){return{buttonMenuItem:{color:e.text.secondary},activeMenuItem:{color:e.text.primary}}}function j(e){e.preventDefault&&e.preventDefault()}function A(e){e({starting:void 0,ending:void 0})}function B(e){return{menuItem:{minHeight:void 0,paddingTop:e.device.isMobile?12:4,paddingBottom:e.device.isMobile?12:4},icon:{height:14,width:14,fill:"currentColor"},iconActiveDesktop:{height:14,width:14,fill:"currentColor",alignSelf:"flex-start",marginTop:2,marginInlineEnd:2},iconActiveDesktopWrapper:{marginTop:0},iconActiveMobile:{height:14,width:14,fill:"currentColor",marginTop:1,marginInlineEnd:6},popup:{paddingTop:12,paddingBottom:8},menuItemTitleDesktop:{width:"100%"},sectionMenuItem:{display:"flex"},summary:{display:"inline-flex"}}}function N(e,t){t||e.setState({...e.state,isOpen:!0,focus:"starting"})}function _(e,t,n,r,o){const{temporaryDateRange:i}=n.state;f().a9(e)||(o||t(i),n.setState({...n.state,isOpen:!1,temporaryDateRange:{starting:void 0,ending:void 0}}),r&&r())}function R(e,t){if(!e.error)return t.setState({...t.state,temporaryDateRange:{...t.state.temporaryDateRange,...e.value}})}function P({disabled:e,icon:t,title:n,store:o}){const i=(0,r.useCallback)((()=>N(o,e)),[o,e]);return(0,I.jsx)(y().A,{disabled:e,focused:!1,icon:(0,I.jsx)(s().I,{icon:t}),title:n,onClick:i})}function E({disabled:e,title:t,value:n,dateFormat:i,onChange:a,store:s}){const l=(0,m().tz)(),d=(0,o().v3)(),c=(0,r.useCallback)((()=>N(s,e)),[s,e]),u=B(d),h=(0,I.jsxs)("div",{style:u.summary,children:[(0,p().k)(u.iconActiveMobile),f().tX(n,l,i)]});return(0,I.jsx)(S().A,{disabled:e,onClick:c,onClickClear:()=>A(a),label:t,title:h})}function D({disabled:e,value:t,dateFormat:n,focused:i,onChange:s,store:l}){const d=(0,m().tz)(),c=(0,a().DP)(),u=(0,o().v3)(),h=(0,r.useCallback)((()=>N(l,e)),[l,e]),g=B(u),v=C(c),b={...g.menuItem,...v.activeMenuItem},S=f().tX(t,d,n),w=(0,I.jsx)(x().A,{onClick:()=>A(s),disabled:e});return(0,I.jsx)(y().A,{focused:i,disabled:e,icon:(0,p().k)(g.iconActiveDesktop),title:S,right:w,isTokenTitle:!0,alignIconTop:!0,onClick:h,desktopTitleStyle:g.menuItemTitleDesktop,desktopIconStyle:g.iconActiveDesktopWrapper,style:b})}function O({disabled:e,title:t,icon:n,focused:i,mode:l,store:d}){const c=(0,a().DP)(),u=(0,o().v3)(),p=(0,r.useCallback)((()=>N(d,e)),[d,e]),m=B(u),h=C(c),g={...m.menuItem,...h.buttonMenuItem,...l===k().C.Pill?{width:"fit-content",border:"solid 1px",paddingInlineStart:0,paddingInlineEnd:0,borderRadius:20,fontSize:12}:{}};return(0,I.jsx)(y().A,{focused:i,disabled:e,icon:(0,I.jsx)(s().I,{icon:n}),title:t,onClick:p,style:g})}function F({disabled:e,value:t,title:n,store:o}){const i=(0,r.useCallback)((()=>N(o,e)),[o,e]);return(0,I.jsx)(g().A,{on:Boolean(t.starting||t.ending),icon:(0,p().k)({width:16,marginInlineEnd:6,fill:"currentColor"}),title:(0,I.jsx)("span",{children:n}),onClick:i})}function q({onChange:e,onMenuDismiss:t,showButtons:n,title:o,value:a,store:s}){const l=(0,r.useCallback)((r=>_(r,e,s,t,n)),[e,s,t,n]),d=(0,r.useCallback)((e=>R(e,s)),[s]),p=(0,i().K8)((()=>function(e,t){const{temporaryDateRange:n}=t.state;return{...e,...n}}(a,s)),[s,a]);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(b().A,{title:o,value:p,onUpdate:d,store:s,onDismiss:l}),n?(0,I.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",padding:"0px 10px"},children:[(0,I.jsx)(c().p,{colorPalette:"gray",style:{marginInlineStart:"auto",marginInlineEnd:8},onClick:l,children:(0,I.jsx)(m().sA,{defaultMessage:"Cancel",id:"searchDateFilter.cancelButton.label"})}),(0,I.jsx)(u().A,{colorPalette:"blue",onClick:()=>e(s.state.temporaryDateRange),children:(0,I.jsx)(m().sA,{defaultMessage:"Accept",id:"searchDateFilter.acceptButton.label"})})]}):void 0]})}function L({mode:e,onChange:t,onMenuDismiss:n,showButtons:a,title:s,value:d,disabled:c,dateFormat:u,focused:p,icon:m,store:g}){const f=(0,o().v3)(),y=(0,r.useCallback)((e=>_(e,t,g,n,a)),[t,g,n,a]),b=(0,r.useCallback)((()=>(0,I.jsx)(q,{onChange:t,onMenuDismiss:n,showButtons:a,title:s,value:d,store:g})),[t,n,a,s,d,g]),x=B(f),S=e===k().C.Section,T=S?s:void 0,C=e===k().C.Section?(0,I.jsx)(D,{disabled:c,value:d,dateFormat:u,focused:p,onChange:t,store:g}):e===k().C.Button?(0,I.jsx)(O,{disabled:c,title:s,icon:m,focused:p,mode:e,store:g}):e===k().C.Pill?(0,I.jsx)(F,{disabled:c,value:d,title:s,store:g}):void(0,h().HB)(e),A=(0,i().K8)((()=>g.state.isOpen),[g]);return(0,I.jsx)(w().A,{title:T,marginAfter:S,children:(0,I.jsx)(l().N,{debugName:"SearchDateFilter",capture:A,onUp:j,onDown:j,onEnter:j,children:(0,I.jsx)(v().Ay,{popupType:M(f),open:A,origin:C,render:b,onDismiss:y,placementToOrigin:"bottom",alignmentToOrigin:"start",keepFocus:!0,style:x.popup})})})}function K({mode:e,onChange:t,onMenuDismiss:n,showButtons:o,title:a,value:s,disabled:l,dateFormat:c,icon:u,store:p}){const m=(0,i().K8)((()=>p.state.isOpen),[p]),h=(0,r.useCallback)((e=>_(e,t,p,n,o)),[t,p,n,o]),g=(0,r.useCallback)((()=>(0,I.jsx)(q,{onChange:t,onMenuDismiss:n,showButtons:o,title:a,value:s,store:p})),[t,n,o,a,s,p]),f=e===k().C.Section?(0,I.jsx)(E,{disabled:l,title:a,value:s,dateFormat:c,onChange:t,store:p}):(0,I.jsx)(P,{disabled:l,icon:u,title:a,store:p});return(0,I.jsx)(v().Ay,{popupType:d().n.SlideUp,open:m,origin:f,render:g,onDismiss:h,preventScaleTransition:!0})}},582684:(e,t,n)=>{n.r(t),n.d(t,{arrowUpDownIcon:()=>o,iconDefinition:()=>r});n(296540);const r={viewBox:"0 0 20 20",fittedViewBox:"2.24 3.26 15.53 13.47",directional:!0,svg:(0,n(474848).jsx)("path",{d:"M14.075 3.45a.625.625 0 0 0-.884 0l-3.497 3.5a.625.625 0 0 0 .883.884l2.431-2.431v10.705a.625.625 0 0 0 1.25 0V5.402l2.431 2.43a.625.625 0 1 0 .884-.883zM2.427 12.167a.625.625 0 0 1 .884 0l2.43 2.431V3.893a.625.625 0 0 1 1.25 0v10.705l2.431-2.43a.625.625 0 0 1 .884.883L6.81 16.55a.625.625 0 0 1-.884 0l-3.498-3.498a.625.625 0 0 1 0-.884"})},o=(0,n(340498).wt)("arrowUpDown",r)},586984:(e,t,n)=>{n.d(t,{C:()=>j,VY:()=>B,WR:()=>b,Y2:()=>I,ZE:()=>M,dF:()=>f,dl:()=>x,oZ:()=>h,pf:()=>T,tl:()=>A,wT:()=>y,wq:()=>C});n(898992),n(354520),n(581454),n(737550);var r=()=>n(973647),o=()=>n(534177),i=()=>n(251582),a=()=>n(181856),s=()=>n(832443),l=()=>n(252050),d=()=>n(162278),c=()=>n(228803),u=()=>n(233364),p=()=>n(331119);function m(e){return i().p.mapResult((0,p().U5)("insert-inside"),(t=>{const n=(0,p().ke)({inputAttributes:t.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},tagName:"insert-inside",mapCounterToKey:e.mapCounterToKey});if(r().Q.isFail(n))return n;const o=(0,u().x)(e),s=(0,i().$d)(i().p.sequence([i().p.choice([o["property-relation"],o["property-person"],o["property-multi-select"]]),i().p.eof((()=>new(a().yd)))]),t.children??[]);if(r().Q.isFail(s))return s;return{value:{type:"effect",tagName:"insert-inside",insertType:"property",attributes:n.value,children:[s.value[0]]}}}))}function h(e){return i().p.choice([i().p.try(m(e)),i().p.andThen(i().p.lookAhead(i().p.map((0,p().U5)("insert-inside"),(t=>{const{mapCounterToKey:n}=e;if(!(0,o().O9)(n)||!(0,o().O9)(t.attributes.id))return!1;const i=(0,r().j)((()=>n(t.attributes.id)));return!r().Q.isFail(i)&&"collection"===i.value.type}))),(t=>t?function(e){return i().p.mapResult((0,p().U5)("insert-inside"),(t=>{const n=(0,p().ke)({inputAttributes:t.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"collection_counter"}},tagName:"insert-inside",mapCounterToKey:e.mapCounterToKey});if(r().Q.isFail(n))return n;const o=(0,i().$d)((0,p().nx)("insert-inside",[(0,d().vj)({allocateIdFn:e.allocateIdFn,allowMove:!0,allowUncited:!1,persisted:!1,mapCounterToKey:e.mapCounterToKey})]),t.children??[]);return r().Q.isFail(o)?o:{value:{type:"effect",tagName:"insert-inside",insertType:"blockIntoDatabase",attributes:n.value,children:o.value}}}))}(e):function(e){return i().p.mapResult((0,p().U5)("insert-inside"),(t=>{const n=(0,p().ke)({inputAttributes:t.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},tagName:"insert-inside",mapCounterToKey:e.mapCounterToKey});if(r().Q.isFail(n))return n;const o=(0,i().$d)((0,p().nx)("insert-inside",[(0,d().vj)({allocateIdFn:e.allocateIdFn,allowMove:!0,allowUncited:!1,persisted:!1,mapCounterToKey:e.mapCounterToKey})]),t.children??[]);return r().Q.isFail(o)?o:{value:{type:"effect",tagName:"insert-inside",insertType:"block",attributes:n.value,children:o.value}}}))}(e)))])}function g(e){return t=>{const a=i().p.mapResult((0,p().U5)(e),(n=>{const o=(0,p().ke)({inputAttributes:n.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},tagName:e,mapCounterToKey:t.mapCounterToKey});if(r().Q.isFail(o))return o;const a=(0,i().$d)((0,p().nx)(e,[(0,d().vj)({allocateIdFn:t.allocateIdFn,allowMove:!0,allowUncited:!1,persisted:!1,mapCounterToKey:t.mapCounterToKey})]),n.children??[]);if(r().Q.isFail(a))return a;return{value:{type:"effect",tagName:e,insertType:"block",attributes:o.value,children:a.value}}})),s=i().p.mapResult((0,p().U5)(e),(o=>{const a=(0,p().ke)({inputAttributes:o.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"block_counter"},name:{required:!0,values:!0}},tagName:e,mapCounterToKey:t.mapCounterToKey});if(r().Q.isFail(a))return a;const s=(0,n(491810).D)({mapCounterToKey:t.mapCounterToKey}),l=(0,i().$d)((0,p().nx)(e,[(0,n(525704).M)(t),s["schema-property-text"]]),o.children??[]);if(r().Q.isFail(l))return l;return{value:{type:"effect",tagName:e,insertType:"table",attributes:a.value,children:l.value}}}));return i().p.andThen(i().p.lookAhead(i().p.map(i().p.any(),(t=>{var n;return"element"===t.type&&t.tagName===e&&(0,o().O9)(null===(n=t.attributes)||void 0===n?void 0:n.name)}))),(e=>e?s:a))}}const f=g("insert-before"),y=g("insert-after"),v=i().p.mapResult((0,p().U5)("action-button"),(e=>{const t=(0,p().ke)({inputAttributes:e.attributes,definitions:{name:{required:!0,values:!0},icon:{required:!1,values:!0},action:{required:!1,values:!0}},tagName:"action-button",mapCounterToKey:void 0});return r().Q.isFail(t)?t:{value:{name:t.value.name,icon:t.value.icon,action:t.value.action}}})),b=i().p.mapResult((0,p().U5)("chat-md"),(e=>{const t=e.attributes?Object.keys(e.attributes):[];if(t.length>0)return{error:new(a().LN)({tagName:"chat-md",attributeNames:t})};const n=(0,i().$d)((0,p().nx)("chat-md",[p().W6]),e.children??[]);if(r().Q.isFail(n))return n;const o={type:"effect",tagName:"chat-md",text:n.value.map((e=>e.value)).join("")};return{value:o}}));function x(e){return i().p.mapResult((0,p().U5)("chat"),(t=>{const n=t.attributes?Object.keys(t.attributes):[];if(n.length>0)return{error:new(a().LN)({tagName:"chat",attributeNames:n})};const o=(0,i().$d)((0,p().nx)("chat",[(0,d().st)(),(0,d().V8)({allocateIdFn:e.allocateIdFn,allowMove:!1,allowUncited:!0,persisted:!1,mapCounterToKey:e.mapCounterToKey}),i().p.map(v,(e=>({type:"action-button",value:e})))]),t.children??[]);if(r().Q.isFail(o))return o;const s=o.value.some((e=>"uncited"===e.type)),l=o.value.filter((e=>"uncited"!==e.type)),c=l.filter((e=>"block"===e.type)),u=l.filter((e=>"action-button"===e.type)),m=c.some((e=>e.hasUncited));return{value:{type:"effect",tagName:"chat",children:c,actionButtons:u.map((e=>e.value)),uncited:s||m}}}))}function S(e){return i().p.mapResult((0,p().U5)("delete"),(t=>{const n=(0,p().ke)({inputAttributes:t.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},tagName:"delete",mapCounterToKey:e.mapCounterToKey});if(r().Q.isFail(n))return n;const o=(0,p().x3)(t);if(r().Q.isFail(o))return o;return{value:{type:"effect",tagName:"delete",deleteType:"block",attributes:n.value}}}))}function w(e){return i().p.mapResult((0,p().U5)("delete"),(t=>{const n=(0,p().ke)({inputAttributes:t.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},tagName:"delete",mapCounterToKey:e.mapCounterToKey});if(r().Q.isFail(n))return n;const o=(0,u().x)(e),s=(0,i().$d)(i().p.sequence([i().p.choice([o["property-relation"],o["property-person"],o["property-multi-select"]]),i().p.eof((()=>new(a().nD)))]),t.children??[]);if(r().Q.isFail(s))return s;return{value:{type:"effect",tagName:"delete",deleteType:"property",attributes:n.value,children:[s.value[0]]}}}))}function k(e){return i().p.map((0,p().RB)({tagName:"delete",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"block_counter"},name:{required:!0,values:!0}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"effect",tagName:"delete",deleteType:"table-column",attributes:e})))}function I(e){return i().p.choice([i().p.try(S(e)),i().p.try(w(e)),k(e)])}function T(e){return i().p.mapResult((0,p().U5)("set-title"),(t=>{const n=(0,p().ke)({inputAttributes:t.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},tagName:"set-title",mapCounterToKey:e.mapCounterToKey});if(r().Q.isFail(n))return n;const o=(0,i().$d)((0,p().nx)("set-title",[(0,c().Et)({inlineNodesAllowed:l().qI,textAllowed:!0,parentTagName:"set-title",mapCounterToKey:e.mapCounterToKey})]),t.children??[]);if(r().Q.isFail(o))return o;return{value:{type:"effect",tagName:"set-title",attributes:n.value,children:o.value}}}))}function M(e){return i().p.mapResult((0,p().U5)("set-attribute"),(t=>{const{id:n,...o}=t.attributes??{};if(!n)return{error:new(a().HQ)({tagName:"set-attribute",attributeName:"id"})};if(!(0,s().D4)(n))return{error:new(a().qW)("id",n)};const i=e.mapCounterToKey?s().tD.mapCounterToKeyInMode({mapCounterToKey:e.mapCounterToKey},n,"block_counter","set-attribute"):{value:n};if(r().Q.isFail(i))return i;const l=i.value;if(0===Object.keys(o).length)return{error:new(a().Uc)};const d=(0,p().x3)(t);if(r().Q.isFail(d))return d;const c=Object.entries(o).map((([e,t])=>({key:e,value:t})));return{value:{type:"effect",tagName:"set-attribute",id:l,attributes:c}}}))}function C(e){return i().p.map((0,p().RB)({tagName:"set-tag-name",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"block_counter"},"tag-name":{required:!0,values:(0,o().uv)(l().sA)}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"effect",tagName:"set-tag-name",attributes:{id:e.id,newTagName:e["tag-name"]}})))}function j(e){return i().p.mapResult((0,p().U5)("set-property"),(t=>{const n=(0,p().ke)({inputAttributes:t.attributes,definitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},tagName:"set-property",mapCounterToKey:e.mapCounterToKey});if(r().Q.isFail(n))return n;const o=t.children.filter((e=>"element"===e.type)),a=(0,i().$d)(i().p.map(i().p.sequence([(0,u().Q)(e),i().p.manyTill((0,u().Q)(e),i().p.eof())]),(([e,t])=>[e,...t])),o);if(r().Q.isFail(a))return a;return{value:{type:"effect",tagName:"set-property",attributes:n.value,children:a.value}}}))}function A(e){return i().p.mapResult((0,p().U5)("persist-blocks"),(t=>{const n=t.attributes?Object.keys(t.attributes):[];if(n.length>0)return{error:new(a().LN)({tagName:"persist-blocks",attributeNames:n})};const o=(0,i().$d)((0,p().nx)("persist-blocks",[(0,d().V8)({allocateIdFn:e.allocateIdFn,allowMove:!1,allowUncited:!1,persisted:!1,mapCounterToKey:e.mapCounterToKey})]),t.children??[]);if(r().Q.isFail(o))return o;return{value:{type:"effect",tagName:"persist-blocks",children:o.value}}}))}function B(e){return i().p.mapResult((0,p().U5)("create"),(t=>{const n=t.attributes?Object.keys(t.attributes):[];if(n.length>0)return{error:new(a().LN)({tagName:"create",attributeNames:n})};const o=(0,i().$d)((0,p().nx)("create",[(0,d().V8)({allocateIdFn:e.allocateIdFn,allowMove:!1,allowUncited:!1,persisted:!1,mapCounterToKey:e.mapCounterToKey})]),t.children??[]);if(r().Q.isFail(o))return o;return{value:{type:"effect",tagName:"create",children:o.value}}}))}},619403:(e,t,n)=>{n.d(t,{w:()=>i});n(296540);var r=n(474848);const o={viewBox:"0 0 20 20",fittedViewBox:"4.12 2.37 11.75 15.25",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M9.95 2.375h-3.7A2.125 2.125 0 0 0 4.125 4.5v11c0 1.174.951 2.125 2.125 2.125h7.5a2.125 2.125 0 0 0 2.125-2.125V8.3H12a2.05 2.05 0 0 1-2.05-2.05zM13.3 14.25a.55.55 0 0 1-.55.55h-5.5a.55.55 0 1 1 0-1.1h5.5a.55.55 0 0 1 .55.55m-.55-1.95h-5.5a.55.55 0 1 1 0-1.1h5.5a.55.55 0 0 1 0 1.1"}),(0,r.jsx)("path",{d:"M15.665 7.2a2.1 2.1 0 0 0-.412-.581L11.63 2.997c-.17-.17-.367-.31-.581-.412V6.25c0 .525.425.95.95.95z"})]})},i=(0,n(340498).wt)("pageFill",o)},626822:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(296540),o=()=>n(69708),i=n(474848);function a(e,t){const{teamStore:r,renderAsEveryoneMention:a}=e,s=(0,n(56366).K8)((()=>r.getName()),[r]);return(0,i.jsx)(n(760217).A,{...e,icon:a?(0,n(522500).q)({width:14,height:14}):(0,i.jsx)(n(898808).x,{size:14,store:r,disabled:!0}),title:a?(0,i.jsx)(o().sA,{id:"posts.teamMenuItem.everyoneMention",defaultMessage:"@everyone"}):s,ref:t,inline:!0,caption:a?(0,i.jsx)(o().sA,{id:"posts.teamMenuItem.caption",defaultMessage:"Notifies everyone in the teamspace"}):void 0})}const s=r.forwardRef(a)},639417:(e,t,n)=>{n.d(t,{R:()=>v});var r=n(296540),o=()=>n(56366),i=()=>n(401497),a=()=>n(605777),s=()=>n(12193),l=n(474848);const d={viewBox:"0 0 20 20",fittedViewBox:"2.96 1.99 14.08 15.13",svg:(0,l.jsx)("path",{d:"M7.3 2a.55.55 0 1 0 0 1.1h5.4a.55.55 0 0 0 0-1.1zM4.95 4.8a.55.55 0 0 1 .55-.55h9a.55.55 0 0 1 0 1.1h-9a.55.55 0 0 1-.55-.55m.138 1.625A2.125 2.125 0 0 0 2.963 8.55V15c0 1.174.951 2.125 2.125 2.125h9.825A2.125 2.125 0 0 0 17.038 15V8.55a2.125 2.125 0 0 0-2.125-2.125z"})},c=(0,n(340498).wt)("stackFill",d);var u=()=>n(941115),p=()=>n(534177),m=()=>n(460292),h=()=>n(187820);const g={notion:n(426388).S,webpage:s().globeIcon,helpdocs:a().bookIcon,"helpdoc-section":a().bookIcon,...n(203717).G},f={"google-drive-spreadsheets":n(551171).C,"google-drive-presentation":c,"google-drive-document":n(619403).w,"google-drive-pdf":n(199103).H};function y(e){if(e&&function(e){for(const t of(0,p().uv)(f))if(t===e)return!0;return!1}(e))return e}function v(e){const{result:t,size:n,style:r,notStandaloneIcon:o}=e,a=(0,i().IS)((()=>{const e=Math.floor(20*n/16);return{wrapper:o?{}:{position:"relative",flexShrink:0,marginInlineEnd:2,marginTop:2,width:e,height:e}}}),[o,n]);return"notion"===t.type?(0,l.jsx)("div",{style:a.wrapper,children:(0,l.jsx)(b,{result:t,size:n,style:r})}):(0,l.jsx)("div",{style:a.wrapper,children:(0,l.jsx)(x,{result:t,size:n,style:r})})}function b(e){const{result:{store:t},size:n,style:r}=e,i=(0,o().K8)((()=>t.getIcon()),[t]),a=(0,o().K8)((()=>t.isEmptyPage()),[t]),s=(0,o().K8)((()=>(0,h().Te)(t)),[t]);return(0,l.jsx)(h().B6,{disabled:!0,icon:i,isEmptyPage:a,size:n,style:r,useInvertedColors:!1,iconRecordCategory:s})}function x(e){const{result:t,size:n,style:o}=e,[a,d]=(0,r.useState)(!1),c=(0,i().eP)(),p=(0,r.useMemo)((()=>y("google-drive"===t.type?`google-drive-${t.fileType}`:void 0)),[t]),h=(0,i().IS)((e=>{let t;switch(p){case"google-drive-presentation":t=e.palette.yellow[500];break;case"google-drive-spreadsheets":t=e.palette.green[500];break;case"google-drive-document":t=e.palette.blue[500]}return{icon:{...o,...t?{fill:t}:{},height:n,width:n,position:"relative"}}}),[n,o,p]);if(p)return f[p](h.icon);if("webpage"===t.type)return t.url.includes("github.com")?(0,l.jsx)(m().Q,{iconGroup:u().A,variantName:"dark"===c?"darkMode":"default",overrideSize:()=>n}):a?(0,s().globeIcon)(h.icon):(0,l.jsx)("img",{style:h.icon,src:`${t.domain}/favicon.ico`,onError:()=>d(!0),alt:`Favicon for ${t.url}`});{const e=g[t.type];return"function"==typeof e?e(h.icon):(0,l.jsx)(m().Q,{iconGroup:e,variantName:"dark"===c?"darkMode":"default",overrideSize:()=>n})}}},641514:(e,t,n)=>{n.d(t,{A:()=>l});n(296540);var r=()=>n(484714),o=()=>n(30537),i=()=>n(676007),a=()=>n(417392),s=n(474848);function l(e){const{isMobile:t}=(0,r().Y0)();return t?(0,s.jsx)(a().Ay,{ariaLabel:e.ariaLabel,open:e.isOpen,popupType:o().n.SlideUp,origin:e.origin,onDismiss:e.onDismiss,render:e.render,style:e.style}):(0,s.jsx)(i().a,{ariaLabel:e.ariaLabel,open:e.isOpen,preventHideChildrenWhileOpening:!0,render:e.render,onDismiss:e.onDismiss,style:e.style,innerStyle:e.innerStyle,showCloseIcon:e.showCloseIcon})}},659467:(e,t,n)=>{n.d(t,{A:()=>o});class r extends(()=>n(757695))().Store{getInitialState(){return{open:!1}}}const o=new r},677590:(e,t,n)=>{n.d(t,{U:()=>d});n(898992),n(354520),n(581454);var r=()=>n(651784),o=()=>n(496603),i=()=>n(534177),a=()=>n(577142),s=()=>n(295169),l=()=>n(251383);function d(e){const{environment:t,useCrdt:n}=e,d=e.sessionId??s().default.getActiveSessionId(),c=d?s().default.getSessionContext(d):void 0;if(!d||!c)return;c.addTemporaryOperationsToUncommittedOperations();const{editGroupsThatWereRejected:u}=(0,l().V)({environment:t,sessionId:d,useCrdt:n}),p=t.RouterStore.state.route,m=(0,r().hZ)(p);if(m.length>0){const e=u.map((e=>"updatedPage"===e.type&&e.didCreatePage?e.pageId:void 0)).filter(i().O9);o().E$(m,e).length>0&&(0,a().navigate)({environment:t,url:c.urlAtStartOfSession})}c.caches.removeDefaultCacheOverride(t),s().default.setState({...s().default.state,...s().default.state.activeAiSessionId===d&&{activeAiSessionId:void 0}})}},683274:(e,t,n)=>{n.d(t,{l:()=>d});var r=n(296540),o=()=>n(484714),i=()=>n(300789),a=()=>n(51367),s=()=>n(360457),l=n(474848);function d(e){const{messageKey:t,button:n}=e,d=(0,o().v3)();(0,r.useEffect)((()=>{a().DL(d,{callout_key:t,placement_key:"Tooltip"})}),[d,t]);const c=(0,r.useCallback)((e=>{a().Y5(d,{callout_key:t,click_type:"primary_cta",placement_key:"Tooltip"}),e&&e()}),[d,t]),u=(0,r.useCallback)((()=>{a().Sq(d,{callout_key:t,dismiss_type:"announcement_card_dismiss",placement_key:"Tooltip"}),i().a(d,t)}),[d,t]);return(0,l.jsx)(s().S,{...e,button:{...n,onClick:()=>{c(n.onClick)}},onDismiss:u})}},684462:(e,t,n)=>{n.d(t,{j:()=>r});const r=(0,n(340498).xh)("claude",{default:{loader:()=>n.e(3791).then(n.bind(n,802140))},darkMode:{loader:()=>n.e(3791).then(n.bind(n,80696))}})},691298:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(296540),o=()=>n(502438),i=()=>n(693202);const a=function({shouldPreserveTextSelection:e,shouldPreserveBlockSelection:t,shouldRestoreSelection:a,onClearSelection:s}){const l=(0,n(484714).v3)(),d=(0,r.useRef)(e),c=(0,r.useRef)(""),u=(0,r.useRef)({selectionState:null,textSelectionState:null}),p=(0,r.useCallback)((()=>u.current),[]),m=(0,r.useCallback)((()=>{c.current=window.location.href,i().default.hasSelection()&&(u.current.textSelectionState=i().default.cloneState()),(0,n(749804).I)({environment:l}),t&&(o().default.isSelected()&&(u.current.selectionState=o().default.cloneState()),n(778417).IU({environment:l}))}),[l,t]),h=(0,r.useCallback)((()=>{u.current={selectionState:null,textSelectionState:null},c.current="",null==s||s()}),[s]),g=(0,r.useCallback)((()=>{const{selectionState:e,textSelectionState:n}=u.current;window.location.href===c.current&&(n&&"mode"in n&&"editing"===n.mode&&i().default.setState({...i().default.state,...n}),t&&e&&o().default.setState({...o().default.state,...e})),h()}),[h,t]);return(0,n(852507).l)((()=>{d.current=e,e&&m()})),(0,r.useEffect)((()=>(d.current&&!e?a?g():h():!d.current&&e&&m(),d.current=e,()=>{a?g():h()})),[e,h,g,m,a]),{clearSavedSelection:h,restoreSavedSelection:g,getSavedSelection:p}}},691309:(e,t,n)=>{n.d(t,{Nc:()=>P,OS:()=>M,So:()=>F,Vg:()=>q,Vz:()=>T,g$:()=>B,l4:()=>E,o4:()=>N,qY:()=>A,rB:()=>R,tF:()=>C,ze:()=>j});n(16280),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(672577),n(430670),n(803949),n(581454);var r=()=>n(496603),o=()=>n(183558),i=()=>n(973647),a=()=>n(534177),s=()=>n(700500),l=()=>n(15440),d=()=>n(356246),c=()=>n(898244),u=()=>n(236162),p=()=>n(206267),m=()=>n(792071),h=()=>n(72135),g=()=>n(134025),f=()=>n(54821),y=()=>n(179034),v=()=>n(519831),b=()=>n(96689),x=()=>n(84520),S=()=>n(798880),w=()=>n(252050),k=()=>n(436468),I=()=>n(33642);function T(e){const t=function(e){const{useCrdt:t,assistantOperation:n,actorPointer:l,getRecordValue:d,spaceId:p,citationHandling:h,currentTimeZone:b}=e,x=Date.now(),S={last_edited_by_table:l.table,last_edited_by_id:l.id,last_edited_time:x},w={created_by_table:l.table,created_by_id:l.id,created_time:x,...S},I=m().b4_.fromGetRecordValueFn(d);let T=[];if("createBlock"===n.command){if("database"===n.blockNode.tagName)return{error:new Error("Invalid creation operation for database")};const e=I({table:y().ev,id:n.blockNode.attributes.id}),i={},u={};let x;if("toggle"===n.blockNode.tagName&&(0,a().O9)(n.blockNode.attributes.size)&&(x=k().oc[n.blockNode.attributes.size],u.toggleable=!0),x||(x=k().w$[n.blockNode.tagName]),!x)return{error:new Error(`Unknown block type: ${n.blockNode.tagName}`)};if(n.blockNode.attributes)for(const[t,r]of Object.entries(n.blockNode.attributes)){const e=L[t];if(e){const t=e(r,{spaceId:p,isCreate:!0});Object.assign(i,t.properties),Object.assign(u,t.format)}}const S=Object.values(n.blockNode.properties).find((e=>"property-title"===e.tagName)),j=S?S.children:n.blockNode.text,A={};if(n.databaseSchemaId){const e={table:y().ev,id:n.databaseSchemaId},t=d(e);if(!t)return{error:new Error("No collection view block")};const r=n.collectionId?{table:v().Vl,id:n.collectionId,spaceId:p}:(0,f().j6)({table:y().ev,value:t});if(!r)return{error:new Error("No collection pointer")};const o=d(r);if(!o)return{error:new Error("No collection")};const i=(0,c().Dp)(o);for(const[a,s]of Object.entries(n.blockNode.properties)){const e=Object.entries(i).find((([,e])=>(null==e?void 0:e.name)===a));if(!e)return{error:new Error(`Property not found: ${a}`)};const[t]=e;A[t]=(0,k().ld)({type:"property",property:s,nodes:s.children,getRecordModel:I,currentTimeZone:b})||[]}}if("unknown-block"===n.blockNode.tagName&&e)return{value:[{type:"latentOperation",latentOperation:{type:"addUnknownBlockToPage",assistantOperation:{command:"addUnknownBlockToPage",blockNode:n.blockNode,copiedFromBlock:e},data:{spaceId:p,actorPointer:l}}}]};if(p){const{operations:e}=m().zgg.assistantCreate({type:x,id:F(n.blockNode.attributes.id),space_id:p,properties:{title:(null==j?void 0:j.length)>0?(0,k().ld)({type:"text",nodes:j,citationHandling:h,getRecordModel:I,currentTimeZone:b}):void 0,...i,...A},content:n.blockNode.children.length>0?n.blockNode.children.map((e=>F(e.attributes.id))):void 0,parentPointer:n.blockNode.parent&&{table:y().ev,id:F(n.blockNode.parent.attributes.id),spaceId:p},createdBy:{table:w.created_by_table,id:w.created_by_id,spaceId:p},lastEditedBy:{table:w.last_edited_by_table,id:w.last_edited_by_id,spaceId:p},format:u},{useCrdt:t??!1});T.push(...e)}if("tr"===n.blockNode.tagName){var M,C;const e=n.blockNode.attributes.id,t=null===(M=n.blockNode.parent)||void 0===M?void 0:M.attributes.id;if(!t)return{error:new Error(`Parent not found: ${t}.`)};const i={table:y().ev,id:F(e)},a={table:y().ev,id:F(t)},l=d(a);if(!l)return{error:new Error(`Parent block not found: ${t}.`)};if(l.type!==s().xd.table)return{error:new Error("Parent block is not of type table.")};let c=(null===(C=l.format)||void 0===C?void 0:C.table_block_column_order)||[];const u=Object.values(n.blockNode.properties).sort(((e,t)=>parseInt(e.attributes.name)-parseInt(t.attributes.name)));if(c.length>0&&c.length!==u.length){const e=e=>({type:"property",tagName:"property-text",attributes:{name:e},children:[{type:"text",value:""}]});for(const t of r().y1(u.length,c.length)){const n=(t+1).toString();u.push(e(n))}}for(const n of u)if(u.indexOf(n)+1!==parseInt(n.attributes.name))return{error:new Error("Table row properties are not in order.")};if(0===c.length){c=u.map((()=>(0,o().Ay)()));const e={last_edited_by_table:w.last_edited_by_table,last_edited_by_id:w.last_edited_by_id,last_edited_time:w.last_edited_time};T.push(g().op.update({pointer:a,path:["format"],args:{table_block_column_order:c}}),g().op.update({pointer:a,path:[],args:e}))}const p=Object.fromEntries(u.map(((e,t)=>[c[t],e.children.length>0?(0,k().ld)({type:"property",nodes:e.children,property:e,getRecordModel:I,currentTimeZone:b}):void 0])));T.push(g().op.update({pointer:i,path:["properties"],args:p}))}}else{if("removeBlock"===n.command)return{value:[{type:"latentOperation",latentOperation:{type:"removeBlock",assistantOperation:n,data:{spaceId:p,actorPointer:l}}}]};if("moveBlock"===n.command)T=[{pointer:{table:y().ev,id:F(n.oldParentId)},command:"listRemove",path:["content"],args:{id:F(n.blockNode.attributes.id)}},g().op.update({pointer:{table:y().ev,id:F(n.parentId)},path:[],args:S}),{pointer:{table:y().ev,id:F(n.blockNode.attributes.id)},command:"update",path:[],args:{parent_id:F(n.parentId),parent_table:y().ev,alive:!0,...S}}];else if("insertBlockBefore"===n.command)T=[{pointer:{table:y().ev,id:F(n.parentId)},command:"listBefore",path:["content"],args:{id:F(n.insertBlockNode.attributes.id),before:n.beforeId?F(n.beforeId):void 0}},g().op.update({pointer:{table:y().ev,id:F(n.parentId)},path:[],args:S}),{pointer:{table:y().ev,id:F(n.insertBlockNode.attributes.id)},command:"update",path:[],args:{parent_id:F(n.parentId),parent_table:y().ev,alive:!0,...S}}];else if("insertBlockAfter"===n.command){if("page"===n.insertBlockNode.tagName)return{value:[{type:"latentOperation",latentOperation:{type:"insertBlockAfter",assistantOperation:n,data:{spaceId:p,actorPointer:l}}}]};T=_(n,S)}else if("setBlockText"===n.command)T=[{pointer:{table:y().ev,id:F(n.blockNode.attributes.id)},command:"update",path:["properties"],args:{title:n.text&&n.text.length>0?(0,k().ld)({type:"text",nodes:n.text,getRecordModel:I,currentTimeZone:b}):void 0}},g().op.update({pointer:{table:y().ev,id:F(n.blockNode.attributes.id)},path:[],args:S})];else if("setBlockAttribute"===n.command){const e=L[n.attribute];if(!e)return{value:[]};{const t=e(n.value,{spaceId:p,isCreate:!1}),r={table:y().ev,id:F(n.blockNode.attributes.id)};T=[...t.properties?[g().op.update({pointer:r,path:["properties"],args:t.properties})]:[],...t.format?[g().op.update({pointer:r,path:["format"],args:t.format})]:[],g().op.update({pointer:r,path:[],args:S})]}}else if("setBlockTagName"===n.command){const e=k().w$[n.tagName];if(!e)return{error:new Error(`Unknown tag name: ${n.tagName}`)};T=[{pointer:{table:y().ev,id:F(n.blockNode.attributes.id)},command:"update",path:[],args:{type:e,...S}}]}else if("setBlockProperty"===n.command){const{blockNode:e,property:t,parentBlockId:r}=n,i={table:y().ev,id:F(e.attributes.id)},a=r?{table:y().ev,id:F(r)}:void 0,l=d(i),p=a?d(a):void 0;if(!l)return{error:new Error(`Block not found: ${e.attributes.id}.`)};if("property-title"===t.tagName)T=[{pointer:{table:y().ev,id:F(n.blockNode.attributes.id)},command:"update",path:["properties"],args:{title:(0,k().ld)({type:"text",nodes:t.children,getRecordModel:I,currentTimeZone:b})}},g().op.update({pointer:{table:y().ev,id:F(n.blockNode.attributes.id)},path:[],args:S})];else if(l.type===s().xd.tableRow){var j;if(!a||!p)return{error:new Error(`Block not found: ${r}.`)};if(p.type!==s().xd.table)return{error:new Error("Parent block is not of type table.")};const e=Number(t.attributes.name);if(!Number.isInteger(e)||e<1)return{error:new Error(`Invalid column index: ${e}.`)};const n=(null===(j=p.format)||void 0===j?void 0:j.table_block_column_order)||[];if(e>n.length+1)return{error:new Error(`Column index too high: ${e}.`)};const l=n[e-1];let d,c;l?(d=l,c=[...n]):(d=(0,o().Ay)(),c=[...n,d]),T=[g().op.update({pointer:i,path:["properties"],args:{[d]:t.children.length>0?(0,k().ld)({type:"text",nodes:t.children,getRecordModel:I,currentTimeZone:b})||[]:null}}),g().op.update({pointer:i,path:[],args:S})],l||T.push(g().op.update({pointer:a,path:["format"],args:{table_block_column_order:c}}),g().op.update({pointer:a,path:[],args:S}))}else{const e=(0,u().zN)({getRecordValue:d,block:l});if(!e)return{error:new Error("Block is not in a database.")};const r=t.attributes.name,o=(0,c().Dp)(e),i=Object.entries(o).find((([,e])=>(null==e?void 0:e.name)===r));if(!i)return{error:new Error(`Property not found: ${r}`)};const[a]=i,s=(0,k().ld)({type:"property",property:t,nodes:t.children,getRecordModel:I,currentTimeZone:b});T=[{pointer:{table:y().ev,id:F(n.blockNode.attributes.id)},command:"update",path:["properties"],args:{[a]:s}},g().op.update({pointer:{table:y().ev,id:F(n.blockNode.attributes.id)},path:[],args:S})]}}else if("insertOrMoveTableColumns"===n.command){var A;const{blockNode:e,atIndex:t,insertOrMoves:r}=n,l={table:y().ev,id:F(e.attributes.id)},c=d(l);if(!c)return{error:new Error(`Block not found: ${e.attributes.id}.`)};if(c.type!==s().xd.table)return{error:new Error("Block is not of type table.")};const u=(null===(A=c.format)||void 0===A?void 0:A.table_block_column_order)||[],p=i().Q.map(r,(e=>{if("schema"===e.type){return{value:(0,o().Ay)()}}if("move"===e.type){const t=u[Number(e.attributes.name)-1];return t?{value:t}:{error:new Error(`Invalid column index: ${e.attributes.name}.`)}}(0,a().HB)(e)}));if(i().Q.isFail(p))return p;const m=p.value,h=[...u.slice(0,t).filter((e=>!m.includes(e))),...m,...u.slice(t).filter((e=>!m.includes(e)))];T=[g().op.update({pointer:l,path:["format"],args:{table_block_column_order:h}}),g().op.update({pointer:l,path:[],args:S})]}else if("removeTableColumn"===n.command){var B;const{blockNode:e,columnIndex:t}=n,r={table:y().ev,id:F(e.attributes.id)},o=d(r);if(!o)return{error:new Error(`Block not found: ${e.attributes.id}.`)};if(o.type!==s().xd.table)return{error:new Error("Block is not of type table.")};const i=(null===(B=o.format)||void 0===B?void 0:B.table_block_column_order)||[],a=i[t];if(!a)return{error:new Error(`Invalid column index: ${t}.`)};const l=[...i.slice(0,t),...i.slice(t+1)];T=[g().op.update({pointer:r,path:["format"],args:{table_block_column_order:l}}),g().op.update({pointer:r,path:[],args:S}),...(o.content||[]).flatMap((e=>{const t={table:y().ev,id:e},n=d(t);return n&&n.type===s().xd.tableRow?[g().op.update({pointer:t,path:["properties"],args:{[a]:null}}),g().op.update({pointer:t,path:[],args:S})]:[]}))]}else if("setBlockParent"===n.command){const e={table:y().ev,id:n.parentId};let t;const r=d(e);r&&(t=n.collectionId?{table:v().Vl,id:n.collectionId,spaceId:p}:(0,f().j6)({table:y().ev,value:r})),T=[{pointer:{table:y().ev,id:F(n.blockNode.attributes.id)},command:"update",path:[],args:{...t?{parent_id:F(t.id),parent_table:t.table}:{parent_id:F(e.id),parent_table:e.table},alive:!0,...S}}]}else{if("addBlockToPage"===n.command){return{value:[{type:"latentOperation",latentOperation:{type:"addBlockToPage",assistantOperation:n,data:{spaceId:p,actorPointer:l}}}]}}(0,a().HB)(n)}}return{value:T.map((e=>({type:"operation",operation:e})))}}(e);if(i().Q.isFail(t))return t;return{value:t.value.map((e=>{if("operation"===e.type||"latentOperation"===e.type)return e;(0,a().HB)(e)}))}}function M(e){const{spaceViewId:t,shouldCreateUnknownBlock:n}=e;return{addBlockToPage:{target:"privatePages",spaceViewId:t},enforceDefaultInsertBehavior:!0,shouldRemoveBlocksFromParent:!1,shouldCreateUnknownBlock:n}}function C(e){const{shouldRemoveBlocksFromParent:t}=e;return{addBlockToPage:{spaceViewId:void 0,target:"unlistedPages"},enforceDefaultInsertBehavior:!0,shouldRemoveBlocksFromParent:t,shouldCreateUnknownBlock:!1}}function j(){return{addBlockToPage:{target:"privatePages",spaceViewId:void 0},enforceDefaultInsertBehavior:!0,shouldRemoveBlocksFromParent:!1,shouldCreateUnknownBlock:!0}}function A(){return{addBlockToPage:{target:"privatePages",spaceViewId:void 0},enforceDefaultInsertBehavior:!0,shouldRemoveBlocksFromParent:!0,shouldCreateUnknownBlock:!0}}function B(e,t,n){const r=[],o=new Map;for(const i of e){if("operation"===i.type){r.push(i.operation);continue}const{latentOperation:e}=i,{type:s}=e;if("addBlockToPage"===s){const{assistantOperation:n,data:o}=e,{spaceId:i,actorPointer:a}=o,{addBlockToPage:s}=t,l=[{type:"user_permission",role:"editor",user_id:a.id}];"unlistedPages"===s.target&&l.push({type:"space_permission",role:"editor",unlisted_timestamp:Date.now()});const d={pointer:{table:y().ev,id:F(n.blockNode.attributes.id)},command:"update",path:[],args:{permissions:l,parent_id:i,parent_table:b().NX,alive:!0}},{spaceViewId:c}=s,u=c&&{pointer:{table:x().mu,id:c},command:"listAfter",path:["private_pages"],args:{id:F(n.blockNode.attributes.id)}};u&&r.push(u),r.push(d)}else if("insertBlockAfter"===s){const{actorPointer:t}=e.data;r.push(..._(e.assistantOperation,{last_edited_by_table:t.table,last_edited_by_id:t.id,last_edited_time:Date.now()}))}else if("removeBlock"===s){const{actorPointer:n}=e.data;r.push(...N({assistantOperation:e.assistantOperation,updateMetadata:{last_edited_by_table:n.table,last_edited_by_id:n.id,last_edited_time:Date.now()},includeRemoveFromParent:t.shouldRemoveBlocksFromParent}))}else if("addUnknownBlockToPage"===s){const{operations:i,replacedBlockIdMap:a}=R({latentOperation:e,shouldCreateUnknownBlock:t.shouldCreateUnknownBlock,useCrdt:n??!1});r.push(...i),a.forEach(((e,t)=>{o.set(t,e)}))}else(0,a().HB)(s)}return{operations:r,replacedBlockIdMap:o}}function N(e){const{assistantOperation:t,updateMetadata:n,includeRemoveFromParent:r}=e;return(r?[{pointer:{table:y().ev,id:F(t.parentId)},command:"listRemove",path:["content"],args:{id:F(t.removeBlockNode.attributes.id)}}]:[]).concat([g().op.update({pointer:{table:y().ev,id:F(t.parentId)},path:[],args:n}),{pointer:{table:y().ev,id:F(t.removeBlockNode.attributes.id)},command:"update",path:[],args:{parent_id:F(t.parentId),parent_table:y().ev,alive:!1,...n}}])}function _(e,t){return[{pointer:{table:y().ev,id:F(e.parentId)},command:"listAfter",path:["content"],args:{id:F(e.insertBlockNode.attributes.id),after:e.afterId?F(e.afterId):void 0}},g().op.update({pointer:{table:y().ev,id:F(e.parentId)},path:[],args:t}),{pointer:{table:y().ev,id:F(e.insertBlockNode.attributes.id)},command:"update",path:[],args:{parent_id:F(e.parentId),parent_table:y().ev,alive:!0,...t}}]}function R(e){const{latentOperation:t,shouldCreateUnknownBlock:n,useCrdt:r}=e,{spaceId:o,actorPointer:i}=t.data,a=Date.now(),{blockNode:s,copiedFromBlock:l}=t.assistantOperation,d=[],c=new Map;if(n){const e={table:y().ev,id:F(p().Dt()),spaceId:o};let t;if(s.parent&&(t={table:y().ev,id:F(s.parent.attributes.id),spaceId:o}),!o)throw new Error("Invalid spaceId.");const{operations:n}=m().zgg.assistantCreate({id:e.id,type:l.type,space_id:o,properties:l.getProperties(),content:l.getContentIds(),format:l.getFormat(),parentPointer:t,createdBy:i,lastEditedBy:i,created_time:a},{useCrdt:r});d.push(...n);for(const r of l.getFileIds())d.push({pointer:e,command:"copyFile",path:[],args:{source:l.pointer,fileId:r}});c.set(l.id,e.id),t&&d.push({pointer:t,path:["content"],command:"listReplace",args:{id:l.pointer.id,newId:e.id}})}else if(o){const{operations:e}=m().zgg.assistantCreate({type:l.type,space_id:o,id:l.id,properties:l.getProperties(),content:l.getContentIds(),format:l.getFormat(),createdBy:{table:i.table,id:i.id,spaceId:o},lastEditedBy:{table:i.table,id:i.id,spaceId:o},parentPointer:s.parent&&{table:y().ev,id:F(s.parent.attributes.id),spaceId:o}},{useCrdt:r});d.push(...e)}return{operations:d,replacedBlockIdMap:c}}function P(e){const t=new Set;for(const n of e)"latentOperation"===n.type?"removeBlock"===n.latentOperation.type?t.add(n.latentOperation.assistantOperation.removeBlockNode.attributes.id):"insertBlockAfter"===n.latentOperation.type?t.add(n.latentOperation.assistantOperation.insertBlockNode.attributes.id):"addBlockToPage"===n.latentOperation.type||"addUnknownBlockToPage"===n.latentOperation.type?t.add(n.latentOperation.assistantOperation.blockNode.attributes.id):(0,a().HB)(n.latentOperation):"operation"===n.type?n.operation.pointer.table===y().ev&&t.add(n.operation.pointer.id):(0,a().HB)(n);return[...t]}async function E({assistantDatabaseQuery:e,spaceId:t,loadRecordModel:n}){const r={databaseId:F(e.databaseId),filter:e.filter,sorts:e.sorts,limit:e.limit},i={table:v().Vl,id:r.databaseId,spaceId:t},a=await n(i);if(!a)throw new Error("No collection");const s=a.getNormalizedSchema(),l=a.getParentPointer();if(l.table===v().Vl)throw new Error("Unsupported parent object for collection");const d={...l,spaceId:t};return{collectionViewBlockPointer:d,collectionPointer:{...i,spaceId:d.spaceId},filter:D({groupFilter:r.filter,schema:s}),sort:r.sorts.map((e=>{const t=Object.keys(s).find((t=>{var n;return(0,o().Ut)(t)&&(null===(n=s[t])||void 0===n?void 0:n.name)===e.propertyName}));if(!t)throw new Error(`Invalid property name: ${e.propertyName}.`);return{property:t,direction:e.direction}})),aggregation:O({collectionSchema:s,aggregationRequest:e.aggregation}),limit:Math.min(r.limit||I().qO,I().qO)}}function D(e){const{groupFilter:t,schema:n}=e;return{operator:{any:"or",all:"and"}[t.operator],filters:t.filters.map((e=>{const{operator:t}=e;return"any"===t||"all"===t?D({groupFilter:e,schema:n}):"is"===t||"contains"===t||">"===t||"<"===t||"≥"===t||"≤"===t||"is empty"===t?function(e){const{filter:t,schema:n}=e,{propertyTagName:r,operator:i,not:s,attributes:l,children:d,propertyName:c}=t,u=Object.keys(n).find((e=>{var t;return(0,o().Ut)(e)&&(null===(t=n[e])||void 0===t?void 0:t.name)===c}));if(!u)throw new Error(`Invalid property name: ${c}.`);if("property-title"===r||"property-text"===r||"property-url"===r||"property-email"===r||"property-phone-number"===r){const e={empty:s?"is_not_empty":"is_empty",is:s?"string_is_not":"string_is",contains:s?"string_does_not_contain":"string_contains"};return{property:u,filter:"is empty"!==i&&(0,a().EI)(d)?{operator:e[i],value:{type:"exact",value:d[0].value}}:{operator:e.empty}}}if("property-person"===r||"property-created-by"===r||"property-last-edited-by"===r){const e={empty:s?"is_not_empty":"is_empty",contains:s?"person_does_not_contain":"person_contains"};return{property:u,filter:(0,a().EI)(d)?{operator:e[i],value:d.filter((e=>"mention-person"===e.tagName)).map((e=>{const t=e.attributes["person-id"];return{type:"exact",value:{table:S().oo,id:t}}}))}:{operator:e.empty}}}if("property-relation"===r){const e={empty:s?"is_not_empty":"is_empty",contains:s?"relation_does_not_contain":"relation_contains"};return{property:u,filter:(0,a().EI)(d)?{operator:e[i],value:d.map((e=>({type:"exact",value:e.attributes["page-id"]})))}:{operator:e.empty}}}if("property-date"===r||"property-created-time"===r||"property-last-edited-time"===r){if("is"===i&&!0===s)throw new Error("Data filter does not support 'is not' operator");const e={empty:s?"is_not_empty":"is_empty",is:"date_is",">":s?"date_is_on_or_before":"date_is_after","<":s?"date_is_on_or_after":"date_is_before","≥":s?"date_is_before":"date_is_on_or_after","≤":s?"date_is_after":"date_is_on_or_before"};if("is empty"===i)return{property:u,filter:{operator:e.empty}};let t;const n=d[0];if("mention-date"!==n.tagName)throw new Error("Invalid mention date in filter. This should never happen");return t={type:"date",start_date:n.attributes.date},{property:u,filter:{operator:e[i],value:{type:"exact",value:t}}}}if("property-checkbox"===r)return{property:u,filter:{operator:{is:s?"checkbox_is_not":"checkbox_is"}[i],value:{type:"exact",value:{true:!0,false:!1}[l.checked]}}};if("property-select"===r){const e={empty:s?"is_not_empty":"is_empty",is:s?"enum_is_not":"enum_is"};return{property:u,filter:(0,a().EI)(d)?{operator:e[i],value:d.map((e=>({type:"exact",value:e.attributes.option})))}:{operator:e.empty}}}if("property-multi-select"===r){const e={empty:s?"is_not_empty":"is_empty",contains:s?"enum_does_not_contain":"enum_contains"};return{property:u,filter:(0,a().EI)(d)?{operator:e[i],value:d.map((e=>({type:"exact",value:e.attributes.option})))}:{operator:e.empty}}}if("property-status"===r){const e={empty:s?"is_not_empty":"is_empty",is:s?"status_is_not":"status_is"};return{property:u,filter:(0,a().EI)(d)?{operator:e[i],value:d.map((e=>"option-category"===e.tagName?{type:"is_group",value:e.attributes.category}:"option"===e.tagName?{type:"is_option",value:e.attributes.option}:(0,a().HB)(e)))}:{operator:e.empty}}}if("property-number"===r){const e={empty:s?"is_not_empty":"is_empty",is:s?"number_does_not_equal":"number_equals",">":s?"number_less_than_or_equal_to":"number_greater_than","<":s?"number_greater_than_or_equal_to":"number_less_than","≥":s?"number_less_than":"number_greater_than_or_equal_to","≤":s?"number_greater_than":"number_less_than_or_equal_to"};if("is empty"===i)return{property:u,filter:{operator:e.empty}};const t=n[u];if(!t||"number"!==t.type)throw new Error("Invalid property type");const r=h().$J(l.number);if("number"!=typeof r)throw new Error("Invalid number");const o={property:u,filter:{operator:e[i],value:{type:"exact",value:r}}};return!s||">"!==i&&"<"!==i&&"≥"!==i&&"≤"!==i?o:{operator:"or",filters:[o,{property:u,filter:{operator:"is_empty"}}]}}(0,a().HB)(r)}({filter:e,schema:n}):void(0,a().HB)(t)}))}}function O(e){const{collectionSchema:t,aggregationRequest:n}=e;if(!n)return;const r=Object.entries(t).find((([,e])=>e&&e.name===n.attributes.name));if(!r)return;const o=r[0];return"aggregation-property-status"===n.tagName?{property:o,aggregator:"Count per group"===n.attributes.aggregation||"Percent per group"===n.attributes.aggregation?{operator:w().sk[n.attributes.aggregation],groupName:n.attributes.group}:w().sk[n.attributes.aggregation]}:{property:o,aggregator:w().sk[n.attributes.aggregation]}}function F(e){return e.split("/")[0]}function q(e){return e}const L={checked:e=>({properties:{checked:"true"===e?d().h4:d().ZO}}),color:e=>{if(!e)return{};const t=w().BP[e];if(!t)throw new Error(`Unrecognized assistant color: ${e}`);return{format:{block_color:t}}},"synced-block-id":(e,{spaceId:t})=>e?{format:{transclusion_reference_pointer:{id:e,table:y().ev,spaceId:t}}}:{},"page-font":e=>({format:{page_font:e&&(0,n(284371).PE)(e)?e:void 0}}),"page-font-size":e=>({format:{page_small_text:"small"===e}}),"page-width":e=>({format:{page_full_width:"full-width"===e}}),language:(e,t)=>{if(!e||!(0,l().Ll)(e))return{};const n=l().nD[e];return{properties:{language:[[n]]},...t.isCreate&&(0,l().Ys)(n).customRender?{format:{code_preview_format:"code"}}:{}}},index:e=>{if(!e)return{};const t=parseInt(e);return Number.isInteger(t)?{format:{list_start_index:t}}:{}}}},693176:(e,t,n)=>{n.d(t,{SZ:()=>S,UO:()=>w,lx:()=>k});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(803949),n(581454);var r=n(296540),o=()=>n(484714),i=()=>n(56366),a=()=>n(737693),s=()=>n(854150),l=()=>n(245241),d=()=>n(69708),c=()=>n(37433),u=()=>n(106628),p=()=>n(765957),m=()=>n(95758),h=()=>n(51781),g=()=>n(187820),f=()=>n(848401),y=()=>n(297401),v=()=>n(626822),b=()=>n(821879),x=n(474848);function S({mode:e,title:t,teamIds:n,onChange:r,disabled:i,focused:s,onMenuDismiss:c,onMenuOpen:u,parentStore:p}){const m=(0,o().v3)(),h=(0,d().tz)(),g=(0,l().fg)(n);return(0,x.jsx)(b().A,{mode:e,title:t,icon:a().V,items:g||[],onChange:r,disabled:i,focused:s,renderFilter:(e,t)=>(0,x.jsx)(j,{item:e,args:t,parentStore:p}),renderToken:(e,t)=>(0,x.jsx)(C,{item:e,handlers:t,teamIds:n,parentStore:p}),renderItemForSummary:e=>(0,x.jsx)(T,{item:e,parentStore:p}),addItemLabel:(0,x.jsx)(d().sA,{defaultMessage:"Add a teamspace",id:"search.filterMenu.addATeamButton.label"}),labelText:{title:t,tokenInputPlaceholder:h.formatMessage({defaultMessage:"Search teamspaces",id:"search.filterMenu.searchTeams.placeholder"}),componentDebugName:"SearchTeamFilter"},performRequest:e=>k(e,m),renderResultMenuItem:(e,t)=>(0,x.jsx)(M,{item:e,props:t,parentStore:p}),onMenuDismiss:c,onMenuOpen:u,hasItemsSelected:Boolean(g&&(null==g?void 0:g.length)>0)})}const w=20;async function k({query:e,current:t},n){var r;const o=new Set(t),i=p().default.state.sidebarSpaceViewStore,a=p().default.state.sidebarSpaceStore,s=null===(r=p().default.state.currentUserStore)||void 0===r?void 0:r.id;if(!i||!a||!s)return[];const l=await(0,h().wq)({userId:s,spaceStore:a,environment:n}),d=(0,c().dT)({spaceStore:a,teams:l}).map((e=>e.store));if(!e){const e=new Set(i.getTeamsStores().map((e=>e.id)));if(d.map((e=>e.id)).forEach((t=>e.add(t))),e.size>0)return[...e]}const m=await u().T.searchActions.load();return(await m.searchTeams({query:e,spaceViewStore:i,teamStores:d})).filter((e=>!o.has(e.id))).slice(0,w).map((e=>e.id))}function I(e,t){return m().h.createChildStore(t,{table:s().yK,id:e})}function T({item:e,parentStore:t}){return(0,x.jsx)(x.Fragment,{children:I(e,t).getName()})}function M({item:e,props:t,parentStore:n}){const o=I(e,n);return(0,r.createElement)(v().A,{...t,key:e,teamStore:o})}function C({item:e,handlers:t,teamIds:n,parentStore:r}){const a=(0,o().v3)(),s=(0,l().fg)(n),d=1===(null==s?void 0:s.length),c=(0,i().K8)((()=>I(e,r)),[e,r]),u=(0,i().K8)((()=>c.getName()),[c]),p=(0,i().K8)((()=>function(e){const t=e.getIcon();return function(e){return(0,x.jsx)(g().B6,{disabled:!0,icon:t,iconRecordCategory:"teamspace",isEmptyPage:!1,size:e})}}(c)),[c]);return c?(0,x.jsx)(f().Ay,{format:a.device.isMobile?f().mI.Large:f().mI.Small,showRemoveButton:!0,isSingle:d,onClickRemove:t.onRemove,renderAvatar:p,title:u,style:{background:"transparent"}}):null}function j({item:e,args:t,parentStore:n}){const{disabled:r,onRemove:i,onClick:a}=t,s=function(e){return{menuItem:{minHeight:void 0,paddingTop:e.device.isMobile?12:4,paddingBottom:e.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginInlineEnd:12}}}((0,o().v3)()),l=I(e,n),d=(0,x.jsx)(y().A,{disabled:r,onClick:i});return(0,x.jsx)(v().A,{disabled:r,focused:!1,teamStore:l,right:d,style:s.menuItem,desktopTitleStyle:s.menuItemTitle,onClick:a},e)}},696419:(e,t,n)=>{n.d(t,{x:()=>a});var r=()=>n(564884),o=()=>n(93723),i=()=>n(438632);function a(e){const{environment:t,from:n,...a}=e,{diffValue:s,metrics:l}=(0,i().hl)(a);return(0,r().u)({environment:t,event:{eventName:"diff_text_value_latency",eventProperties:{time:l.latencyMs,from:n,implementation:"sync",before_length:(0,o().P)(l.beforeLength),after_length:(0,o().P)(l.afterLength)}}}),s}},755535:(e,t,n)=>{n.d(t,{A:()=>v});n(581454);var r=n(296540),o=()=>n(484714),i=()=>n(56366),a=()=>n(401497),s=()=>n(631524),l=()=>n(668725),d=()=>n(722872);class c extends(()=>n(757695))().Store{getInitialState(){return{}}}const u=c;var p=()=>n(406699),m=()=>n(113474),h=()=>n(404277),g=()=>n(939740),f=n(474848);function y({isMenuItem:e,style:t,labelStyle:o,alignmentToOrigin:s,renderMenuSections:l,label:d,selectedTitle:c,focused:p,disabled:m,innerButtonStyle:h,buttonPopupStore:g,downIconStyle:y},v){const x=(0,a().DP)(),k=(0,i().uB)(void 0,u),I=(0,i().uB)(g,n(463830).A);return(0,r.useImperativeHandle)(v,(()=>({closeMenu:()=>{I.setState({...I.state,open:!1})}})),[I]),e?(0,f.jsx)(w,{alignmentToOrigin:s,isMenuItem:e,renderMenuSections:l,buttonPopupStore:I,SelectButtonStore:k,renderOrigin:n=>(0,f.jsx)(b,{events:n,style:t,isMenuItem:e,label:d,selectedTitle:c,focused:p,disabled:m})}):(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center",height:32,...t},children:[d?(0,f.jsx)("div",{style:{marginInlineEnd:"auto",color:x.text.tertiary,fontSize:14,...o},children:d}):void 0,(0,f.jsx)(w,{alignmentToOrigin:s,isMenuItem:e,renderMenuSections:l,buttonPopupStore:I,SelectButtonStore:k,renderOrigin:e=>(0,f.jsx)(S,{events:e,innerButtonStyle:h,disabled:m,selectedTitle:c,downIconStyle:y})})]})}const v=r.forwardRef(y);function b({events:e,style:t,isMenuItem:n,label:r,selectedTitle:o,focused:i,disabled:a}){if(n){const n=r?{title:r,right:o}:{title:o};return(0,f.jsx)(m()._,{...e,focused:Boolean(i),disabled:a,style:t,...n})}return null}function x({downIconStyle:e}){const{device:t}=(0,o().v3)(),n=(0,a().DP)();return(0,f.jsx)(f.Fragment,{children:(0,l().b)({width:t.isMobile?14:10,marginInlineStart:4,fill:n.icon.tertiary,...e})})}function S({events:e,innerButtonStyle:t,downIconStyle:n,disabled:r,selectedTitle:o}){return(0,f.jsxs)(s().p,{disabled:r,disabledFeedback:!0,style:{marginInlineEnd:-6,...t},...e,children:[o,(0,f.jsx)(x,{downIconStyle:n})]})}function w({renderOrigin:e,alignmentToOrigin:t,isMenuItem:n,renderMenuSections:r,buttonPopupStore:i,SelectButtonStore:a}){const s=(0,o().v3)(),{device:l}=s;return(0,f.jsx)(p().A,{popupType:l.isMobile?p().z.SlideUp:p().z.Popup,buttonPopupStore:i,alignmentToOrigin:void 0!==t?t:"end",renderOrigin:e,placementToOrigin:n?"right":"bottom",originGap:n?void 0:4,render:e=>{let t;t=l.isMobile?{menuType:d().gu.ActionSheet}:{menuType:d().gu.Popup};const{focusedIndex:n,menuSections:o}=function(e,t,n){let r,o=0;const i=t(e).map((e=>({...e,items:e.items.map((e=>(e.key===n.state.selectedKey&&(r=o),o++,{...e,action:t=>{e.action(t),function(e,t){t.setState({selectedKey:e})}(e.key,n)}})))})));return{menuSections:i,focusedIndex:r}}(e,r,a);return(0,f.jsx)(h().A,{...t,children:(0,f.jsx)(g().Ay,{type:g().Oh.Vertical,initialFocus:n,sections:o})})}})}},756790:(e,t,n)=>{n.d(t,{p:()=>i});var r=()=>n(313127),o=()=>n(765957);function i(){var e,t,n,i,a,s,l,d,c,u,p,m,h,g;const{sidebarSpaceStore:f,sidebarSpaceViewStore:y}=o().default.state,v=null==f?void 0:f.getSpaceSurveyData(),b=null==y?void 0:y.getUserSurveyData();return{function:null!=b&&null!==(e=b.function)&&void 0!==e&&e.value?(0,r().Tj)(null==b||null===(t=b.function)||void 0===t?void 0:t.value):void 0,role:null!=b&&null!==(n=b.role)&&void 0!==n&&n.value?(0,r().t_)(null==b||null===(i=b.role)||void 0===i?void 0:i.value):void 0,educationRole:null==b||null===(a=b.education_role)||void 0===a?void 0:a.value,educationLevel:null==b||null===(s=b.education_level)||void 0===s?void 0:s.value,useCases:null!=v&&null!==(l=v.use_cases)&&void 0!==l&&l.value?(0,r().h0)(null==v||null===(d=v.use_cases)||void 0===d?void 0:d.value):void 0,companySize:null!=v&&null!==(c=v.company_size)&&void 0!==c&&c.value?(0,r().JE)(null==v||null===(u=v.company_size)||void 0===u?void 0:u.value):void 0,intent:null!=v&&null!==(p=v.intent)&&void 0!==p&&p.value?(0,r().j9)(null==v||null===(m=v.intent)||void 0===m?void 0:m.value):void 0,categories:null==b||null===(h=b.categories)||void 0===h?void 0:h.value,collaborativeIntent:null==v||null===(g=v.collaborative_intent)||void 0===g?void 0:g.value}}},792751:(e,t,n)=>{n.d(t,{A:()=>_,h:()=>F});n(944114),n(898992),n(581454),n(737550);var r=n(296540),o=()=>n(484714),i=()=>n(56366),a=()=>n(401497),s=()=>n(75435),l=()=>n(718827),d=()=>n(252291),c=()=>n(203717),u=()=>n(506166),p=()=>n(426388),m=()=>n(340498),h=()=>n(620333),g=()=>n(201980),f=()=>n(69708),y=()=>n(987267),v=()=>n(604018),b=()=>n(38337),x=()=>n(780865),S=()=>n(765957),w=()=>n(430483),k=()=>n(982254),I=()=>n(498719),T=()=>n(250484),M=()=>n(285790),C=()=>n(623580),j=()=>n(460292),A=()=>n(187820),B=()=>n(859428),N=n(474848);const _=48;function R(e){const{onTypingChange:t,onFocusChange:l,isOpen:c,showSpinner:u,onQueryChange:p,selectedResultStore:m,quickSearchMode:h,inputComboboxProps:y,searchResultStore:v}=e,M=(0,f().tz)(),j=(0,r.useRef)();(0,r.useEffect)((()=>()=>{j.current&&(window.clearTimeout(j.current),j.current=void 0)}),[]);const B=(0,o().v3)(),R=(0,i().K8)((()=>T().Ay.state.isPopupOpen),[]),{electronTabsState:E,isPinnedState:D}=(0,i().K8)((()=>({electronTabsState:(0,x().iu)(k().A.state.tabs,k().A.state.currentTab.id),isPinnedState:k().A.state.currentTab.isPinned})),[]),F=(0,i().K8)((()=>n(899677).default.state.isNewElectronTab),[]),{isElectronTabSearchEnabledState:K,isPinnedTabNewTabEnabledState:U}=(0,i().K8)((()=>{var e,t;return{isElectronTabSearchEnabledState:null===(e=s().A.state.preferences)||void 0===e?void 0:e.isNewTabSearchEnabled,isPinnedTabNewTabEnabledState:null===(t=s().A.state.preferences)||void 0===t?void 0:t.isPinnedTabNewTabEnabled}}),[]),V=Boolean(F)&&Boolean(K)||Boolean(U)&&Boolean(D),z=(0,o().Y0)(),H=(0,a().IS)((e=>({boxShadowStyle:{...z.isTablet&&{width:"100%"}},inputDesktop:{fontSize:18,height:_,paddingInlineStart:12,paddingInlineEnd:16,alignItems:"center",flexGrow:0,flexShrink:0,zIndex:1},inputMobile:{fontSize:16,border:"none",boxShadow:"none",borderRadius:7,lineHeight:"1.2",padding:"6px 8px",background:e.inputBackground},searchIcon:{width:16,height:16},searchIconColor:{fill:e.icon.secondary},headerIcon:{height:24,width:24,display:"flex",alignItems:"center",justifyContent:"center"},input:{minWidth:0,...n(284371).RC},suggestedText:{whiteSpace:"pre",color:e.text.secondary},suggestedTextWrapper:{overflow:"hidden",textOverflow:"ellipsis"},autoCompletedText:{color:e.text.secondary,background:e.background.tertiaryTranslucent},suggestedTextInvisibleUserQuery:{whiteSpace:"pre-wrap",color:"transparent"},clearButton:{marginInlineStart:8},userInputAndSuggestedTextContainer:{display:"grid",gridTemplateColumns:"auto 1fr"}})),[z.isTablet]),W=(0,i().K8)((()=>T().Ay.state.query.text),[]),{currentSpaceStore:$,currentSpaceViewStore:G,mainEditorCurrentBlockStore:Q}=(0,i().K8)((()=>({currentSpaceStore:S().default.state.sidebarSpaceStore,currentSpaceViewStore:S().default.state.sidebarSpaceViewStore,mainEditorCurrentBlockStore:S().default.state.mainEditorCurrentBlockStore})),[]),X=(0,i().K8)((()=>null==Q?void 0:Q.getTitleValue()),[Q]),Y=(0,i().K8)((()=>$&&(0,n(665381).G)(B,$)),[B,$]),Z=(0,i().K8)((()=>w().zD.showSearchAiFeatures()),[]),J=(0,n(135055).y6)(),ee=!(0,i().O$)(n(929219).e),te=z.isMobile?C().C.ExtraLarge:C().C.Transparent,ne=(0,i().K8)((()=>(0,n(303742).o)(G)),[G]),re=(0,i().K8)((()=>function(e){const{intl:t,isNewElectronTab:n,isOffline:r,pageTitleValue:o,showSearchAiFeatures:i,spaceName:a,isExternalPagesSearch:s}=e;if(r)return t.formatMessage({id:"searchInputMenuItem.placeholder.offline",defaultMessage:"Search offline pages…"});if(n)return t.formatMessage({id:"searchInputMenuItem.placeholder.newTab",defaultMessage:"Open in new tab..."});if(a&&i)return t.formatMessage({id:"searchInputMenuItem.placeholder.SearchOrAskQuestionInSpace",defaultMessage:"Search or ask a question in {spaceName}…"},{spaceName:a});if(s)return t.formatMessage({id:"searchInputMenuItem.placeholder.externalPagesSearch",defaultMessage:"Search external pages…"});if(a)return t.formatMessage({id:"searchInputMenuItem.placeholder.searchInSpace",defaultMessage:"Search {spaceName}…"},{spaceName:a});if(o){const e=100,n=g().k4p(o).slice(0,e);return t.formatMessage({id:"searchInputMenuItem.placeholder.namedPage",defaultMessage:"Search in {pageTitle}…"},{pageTitle:n})}return t.formatMessage({id:"searchInputMenuItem.placeholder.unnamedPage",defaultMessage:"Search in page…"})}({intl:M,isNewElectronTab:V,isOffline:J&&ee,pageTitleValue:X,showSearchAiFeatures:Z,spaceName:Y,isExternalPagesSearch:ne})),[M,V,ee,J,X,ne,Z,Y]),oe=(0,i().K8)((()=>{const e=Boolean(K)?E:[];return function(e,t,n,r,o,i){if(0===r.length||r.length>=20||t.isMobile||void 0===n)return;const a=g().k4p(n.getTitleValue()),s=a.replaceAll("\n"," "),l=a.slice(0,r.length),d=a.length>0&&l.toLocaleLowerCase()===r.toLocaleLowerCase(),c=d?s.substring(r.length):"";switch(!0){case t.isElectron&&o.some((e=>e.pageId===n.id)):return`${c} — ${e.formatMessage(L.switchTab)}`;case t.isElectron&&i:return`${c} — ${e.formatMessage(L.openInTab)}`;default:return`${c} — ${e.formatMessage(L.open)}`}}(M,z,m,W,e,V)}),[E,K,m,z,W,V,M]),ie=(0,i().K8)((()=>n(659467).A.state.open),[]),ae=(0,r.useMemo)((()=>oe&&0!==W.trim().length?(0,N.jsxs)("div",{style:H.userInputAndSuggestedTextContainer,"data-search-suggested-text":!0,children:[(0,N.jsx)("span",{style:H.suggestedTextInvisibleUserQuery,children:W}),(0,N.jsx)("div",{style:{...H.suggestedTextWrapper},className:h&&!R?b().sbV:void 0,children:(0,N.jsx)("span",{style:H.autoCompletedText,children:oe})})]}):""),[oe,W,H.userInputAndSuggestedTextContainer,H.suggestedTextInvisibleUserQuery,H.suggestedTextWrapper,H.autoCompletedText,h,R]),se=z.isMobile?H.inputMobile:H.inputDesktop,le={...H.input,width:0===W.length&&h?`min(${re.length}ch, 100%)`:"100%"},de=(0,i().K8)((()=>null==m?void 0:m.getIcon()),[m]),ce=(0,i().K8)((()=>(0,A().Te)(m)),[m]),ue=(0,i().K8)((()=>Boolean(W.trim())&&!z.isMobile),[W,z]),pe=(0,r.useMemo)((()=>{if(h)return(0,N.jsx)(n(563263).A,{});return(0,N.jsx)("div",{style:H.headerIcon,children:(()=>{switch(!0){case u:return(0,N.jsx)(n(98126).A,{size:"md"});case ue:return(0,N.jsx)(A().B6,{disabled:!0,icon:de,iconRecordCategory:ce,isEmptyPage:Boolean(de),size:20});case V:return(0,N.jsx)(d().I,{icon:n(224503).browserAddIcon,colorVariant:"secondary"});default:return(0,N.jsx)(d().I,{icon:n(207207).J,colorVariant:"secondary"})}})()})}),[H.headerIcon,h,u,ue,de,ce,V]),me=(0,i().K8)((()=>w().zD.isSearchConnectorTabSectionEnabled()),[]),he=()=>{void 0===I().default.state.firstKeyStrokeTimeMs&&I().default.update((e=>({...e,firstKeyStrokeTimeMs:Date.now()}))),j.current&&window.clearTimeout(j.current),t(!0),j.current=window.setTimeout((()=>t(!1)),300)};return(0,N.jsxs)("div",{style:H.boxShadowStyle,children:[(0,N.jsx)("div",{style:{display:"flex",flex:1},className:h&&!R?b().sbV:void 0,children:(0,N.jsx)(C().A,{format:te,placeholder:re,left:pe,value:W,suggestedText:ae,suggestedTextStyle:H.suggestedText,focus:z.isMobile?void 0:c&&!ie,focusInitial:!(0,n(155959).T)("supportsNativeHome")&&z.isMobile,focusAfterAnimation:!0,showClearButton:!0,right:!z.isMobile&&(0,N.jsx)(O,{quickSearchMode:h}),isRightLastElementOfInput:!0,selectAll:!0,onChange:e=>{he();const t=String(e.target.value);p(t)},onClearButtonClick:q,style:se,inputStyle:le,...(0,n(553965).A)(y,{onFocus:()=>function(e){e(!0)}(l),onBlur:()=>function(e){e(!1)}(l)})})}),me?(0,N.jsx)(P,{searchResultsStore:v}):void 0]})}function P(e){const{searchResultsStore:t}=e,n=(0,i().K8)((()=>(0,v().wd)()),[]),r=(0,a().IS)((e=>({wrapperStyle:{display:"flex",alignItems:"center",marginInlineStart:8,marginBottom:8,marginTop:-4}})),[]),o=(0,i().K8)((()=>{const e=[];for(const o of n){var r;const n=(null===(r=t.state.universalResults)||void 0===r||null===(r=r[o])||void 0===r?void 0:r.length)??0;e.push({type:o,resultCount:n})}return e}),[n,t]);return(0,N.jsxs)("div",{style:r.wrapperStyle,children:[(0,N.jsx)(D,{searchResultStore:t}),o.map((({type:e,resultCount:n})=>(0,N.jsx)(E,{searchResultsStore:t,resultCount:n,connectorType:e},e)))]})}function E(e){const{connectorType:t,resultCount:n,searchResultsStore:o}=e,s="dark"===(0,a().eP)(),d=(0,i().K8)((()=>o.state.currentlySelectedUniversalSearchResultView===t),[t,o]),{icon:u,name:p}=(0,r.useMemo)((()=>({icon:c().G[t],name:y().w0[t]})),[t]),m=(0,r.useCallback)((()=>{o.update((e=>({...e,currentlySelectedUniversalSearchResultView:t})))}),[t,o]),h=(0,a().IS)((()=>({pillStyle:{display:"flex",alignItems:"center",marginInlineEnd:8,paddingInlineStart:12,paddingInlineEnd:12,paddingTop:6,paddingBottom:6,borderRadius:20,cursor:"pointer",userSelect:"none"},iconStyle:{height:14,width:14}})),[]);return(0,N.jsxs)(l().Ay,{style:h.pillStyle,onClick:m,focused:d,children:[(0,N.jsx)(j().Q,{iconGroup:u,variantName:s?"darkMode":"default",overrideSize:()=>h.iconStyle.width}),(0,N.jsx)("span",{style:{marginInlineStart:4,fontSize:12},children:p}),n>0?(0,N.jsx)("span",{style:{marginInlineStart:4,fontSize:12},children:n}):void 0]},t)}function D(e){const{searchResultStore:t}=e,n=(0,a().IS)((()=>({pillStyle:{display:"flex",alignItems:"center",marginInlineEnd:8,paddingInlineStart:12,paddingInlineEnd:12,paddingTop:6,paddingBottom:6,borderRadius:20,cursor:"pointer",userSelect:"none"},iconStyle:{height:14,width:14}})),[]),o=(0,i().K8)((()=>!Boolean(t.state.currentlySelectedUniversalSearchResultView)),[t]),s=(0,r.useCallback)((()=>{t.update((e=>({...e,currentlySelectedUniversalSearchResultView:void 0})))}),[t]);return(0,N.jsxs)(l().Ay,{style:n.pillStyle,onClick:s,focused:o,children:[(0,p().S)(n.iconStyle),(0,N.jsx)("span",{style:{marginInlineStart:4,fontSize:12},children:(0,N.jsx)(f().sA,{id:"SearchInputMenuItem.Notion",defaultMessage:"Notion"})})]})}function O(e){const[t,n]=(0,i().K8)((()=>{const e=T().Ay.state.query.filters,t=(0,x().J3)(e);return[T().Ay.state.filterBar.show,t]}),[]),r=(0,o().v3)();(0,i().K8)((()=>{const e=r.currentUser.id;if(!e)return;!1===(0,h().YT)(e)&&!0===t&&T().Ay.collapseFilterBar()}),[r,t]);const s=(0,a().IS)((()=>({container:{marginInlineStart:4,display:"flex"},icon:{width:m().Ev.default,height:m().Ev.default}})),[]),l=(0,f().tz)(),d=t?l.formatMessage({id:"searchInputMenuItem.filterBarToggleButtonTooltip.hide",defaultMessage:"Hide filters"}):l.formatMessage({id:"searchInputMenuItem.filterBarToggleButtonTooltip.show",defaultMessage:"Show filters"});return(0,N.jsx)(B().A,{renderTooltip:()=>(0,N.jsx)("div",{children:d}),placement:"bottom",alignment:"start",disableTooltip:r.device.isMobile,delayThreshold:400,render:e=>(0,N.jsx)("span",{style:s.container,children:(0,N.jsx)(M().A,{...e,icon:u().E,iconStyle:s.icon,ariaLabel:d,onClick:()=>t?T().Ay.collapseFilterBar():T().Ay.expandFilterBar(),...n?{colorPalette:"blue",colorVariant:"accentPrimary"}:{}})})})}const F=R;function q(){T().Ay.resetQuery({resetFilters:!0}),T().Ay.update((e=>({...e,source:"quick_find"})))}const L=(0,f().YK)({open:{id:"search.inputMenu.suggestedText.open",defaultMessage:"Open"},openInTab:{id:"search.inputMenu.suggestedText.openInTab",defaultMessage:"Open in tab"},switchTab:{id:"search.inputMenu.suggestedText.switchTab",defaultMessage:"Switch tab"}});R.displayName="SearchInputMenuItem"},805768:(e,t,n)=>{n.d(t,{hC:()=>m,e1:()=>u});n(581454);var r=n(296540),o=()=>n(401497),i=()=>n(203717),a=()=>n(374693);const s={claude:n(684462).j,cursor:n(385054).b,chatgpt:n(230510).P};var l=()=>n(284371),d=()=>n(460292),c=n(474848);function u(e){const t={...i().G,...s};return"notion"===e?a()._:t[e]}const p=5;function m(e){const{connectors:t,maxBubbles:n,iconSize:i,bubbleStyles:a,disableNumericalEllipsis:s}=e,m=(0,r.useMemo)((()=>[...t.slice(0,n)].reverse()),[t,n]),h=Math.max(0,t.length-n),g=(0,o().IS)((e=>({bubbleWrapper:{display:"flex",alignItems:"center",flexDirection:"row-reverse",justifyContent:"flex-end",marginInlineStart:p},bubble:{boxShadow:e.connectorBubbleShadow,borderRadius:"100%",width:20,height:20,backgroundColor:e.whiteButtonBackground,display:"flex",alignItems:"center",justifyContent:"center",marginInlineStart:-p,fontSize:9,fontWeight:l().Wy.medium,color:e.text.tertiary,...a}})),[a]),f="dark"===(0,o().eP)(),y=(0,r.useCallback)((e=>"notion"===e?"default":f?"darkMode":"default"),[f]);return 0===t.length?null:(0,c.jsxs)("div",{style:g.bubbleWrapper,children:[!s&&h>0?(0,c.jsx)("div",{style:g.bubble,children:(0,c.jsx)("div",{children:`+${h}`})}):void 0,m.map(((e,t)=>(0,c.jsx)("div",{style:g.bubble,children:(0,c.jsx)(d().Q,{iconGroup:u(e),overrideSize:()=>i,variantName:y(e)})},`${e}-${t}`)))]})}},857744:(e,t,n)=>{n.d(t,{A:()=>I});var r=n(296540),o=()=>n(484714),i=()=>n(56366),a=()=>n(401497),s=()=>n(75435),l=()=>n(252291),d=()=>n(148307),c=()=>n(513402),u=()=>n(109158),p=()=>n(69708),m=()=>n(284371),h=()=>n(222917),g=()=>n(426077),f=()=>n(115512),y=()=>n(563253),v=()=>n(430483),b=()=>n(899677),x=()=>n(35392),S=()=>n(859428),w=()=>n(414706),k=n(474848);function I(){const e=(0,o().v3)(),t=(0,p().tz)(),n=(0,o().Y0)().isElectron,d=(0,a().IS)((t=>({listStyle:{...f().$t,...m().RC,display:"inline-flex",alignItems:"center",fontSize:f().ny(e,"UISmall"),color:t.text.tertiary,gap:20},inlineHint:{display:"flex",gap:6,alignItems:"center",height:"max-content"}})),[e]),u=(0,i().K8)((()=>{var t;const n=null===(t=s().A.state.preferences)||void 0===t?void 0:t.isQuickSearchEnabled;return e.device.isElectron&&n}),[e.device.isElectron]),y=(0,r.useCallback)((()=>{(b().default.state.open||b().default.state.openAsPage)&&h().$n(e,{searchSessionId:b().default.state.sessionId})}),[e]),S=e.device.isMac,I=(0,i().K8)((()=>!v().zD.isMiniSearchModalEnabled()),[]);return(0,k.jsxs)("ul",{style:d.listStyle,children:[I?(0,k.jsxs)("li",{style:d.inlineHint,children:[(0,k.jsx)(l().I,{icon:c().arrowUpDownSmallIcon,size:"xxs",colorVariant:"secondary"}),t.formatMessage({id:"searchFooter.helpText.selectHint",defaultMessage:"Select"})]}):void 0,I?(0,k.jsxs)("li",{style:d.inlineHint,children:[(0,k.jsx)(w().z,{shortcut:{enter:!0}}),t.formatMessage({id:"searchFooter.helpText.openHint",defaultMessage:"Open"})]}):void 0,(0,k.jsxs)("li",{style:d.inlineHint,children:[S?(0,k.jsx)(w().z,{shortcut:{command:!0,enter:!0}}):(0,k.jsx)(x().A,{name:"commandEnter"}),t.formatMessage({id:"searchFooter.helpText.newTab",defaultMessage:"Open in new tab"})]}),n?(0,k.jsxs)("li",{style:d.inlineHint,children:[S?(0,k.jsx)(w().z,{shortcut:{command:!0,key:"L"}}):(0,k.jsx)(x().A,{name:"copyLinkToCurrentPage"}),t.formatMessage({id:"searchFooter.helpText.copyLink",defaultMessage:"Copy link"})]}):void 0,u?(0,k.jsx)("li",{style:d.inlineHint,onClick:()=>{y(),(0,g().S)()},children:(0,k.jsx)(T,{environment:e,containerStyles:d.inlineHint})}):void 0]})}function T(e){const{environment:t,containerStyles:n}=e,[o,l]=(0,r.useState)(!1),d=(0,a().IS)((e=>({container:{...n,cursor:"pointer"},commandSearchHint:{display:"flex",alignItems:"center"},commandText:{padding:"2px 4px",borderRadius:4,background:o?e.buttonHoveredBackground:void 0},hintAndBadgeContainer:{display:"flex",gap:3,alignItems:"center",width:"max-content"},tooltip:{background:"transparent",boxShadow:"none"}})),[n,o]),c=t.device.isMac,u=(0,p().tz)(),{commandSearchShortcut:m,commandSearchShortcutToString:f}=(0,i().K8)((()=>{var e;const t=null===(e=s().A.state.preferences)||void 0===e?void 0:e.quickSearchShortcut;if(!t)return{commandSearchShortcut:void 0,commandSearchShortcutToString:void 0};const n=(0,y().z_)(t,c);return{commandSearchShortcut:n,commandSearchShortcutToString:(0,y().Vd)(n,c)}}),[c]),v=(0,r.useCallback)((()=>{(b().default.state.open||b().default.state.openAsPage)&&h().WF(t,{searchSessionId:b().default.state.sessionId})}),[t]);return(0,k.jsx)(S().A,{delayThreshold:400,placement:"bottom",originGap:8,disableTooltip:!c,renderTooltip:()=>(v(),(0,k.jsx)(M,{shortcut:f})),closeDelay:0,style:d.tooltip,render:e=>(0,k.jsxs)("div",{...e,style:d.container,onClick:()=>(0,g().S)(),onMouseEnter:t=>{e.onMouseEnter&&e.onMouseEnter(t),o||l(!0)},onMouseLeave:t=>{e.onMouseLeave&&e.onMouseLeave(t),o&&setTimeout((()=>{l(!1)}),200)},children:[(0,k.jsx)("span",{style:d.commandText,children:c?(0,k.jsx)(w().z,{shortcut:m}):f}),(0,k.jsx)("div",{style:d.commandSearchHint,children:o?(0,k.jsx)("span",{children:u.formatMessage({id:"searchFooter.commandSearch.editText",defaultMessage:"Click to edit shortcut"})}):(0,k.jsx)("div",{style:d.hintAndBadgeContainer,children:u.formatMessage({id:"searchFooter.commandSearch.defaultText",defaultMessage:"Command Search"})})})]})})}function M(e){const{shortcut:t}=e,n=d().A.images.commandSearch.tooltipPng,[o,i]=(0,r.useState)(!1);(0,r.useEffect)((()=>{const e=new Image;e.src=n,e.onload=()=>{i(!0)}}),[n]);const s=(0,a().IS)((e=>({container:{width:260,borderRadius:8,backgroundColor:"transparent"},textContainer:{whiteSpace:"break-spaces",padding:15,display:"flex",flexDirection:"column",gap:1,backgroundColor:"light"===e.mode?e.palette.gray[700]:e.palette.gray[300],borderStartEndRadius:8,borderStartStartRadius:8},description:{fontWeight:m().Wy.regular,color:e.text.inverseSecondary},image:{width:"100%"}})),[]);return o?(0,k.jsxs)("div",{style:s.container,children:[(0,k.jsxs)("div",{style:s.textContainer,children:[(0,k.jsx)("div",{children:(0,k.jsx)(p().sA,{id:"searchFooter.commandSearch.tooltip.header",defaultMessage:"Use search and Q&A anywhere"})}),(0,k.jsx)("div",{style:s.description,children:(0,k.jsx)(p().sA,{id:"searchFooter.commandSearch.tooltip.description",defaultMessage:"Try {shortcut} or click on {menuBarIcon} in your menubar to access search and Ask AI anytime, even with Notion minimized.",values:{shortcut:t,menuBarIcon:(0,k.jsx)(C,{})}})})]}),(0,k.jsx)("img",{style:s.image,src:n})]}):null}function C(){const e=(0,a().IS)((()=>({container:{display:"inline-block",position:"relative"},placeholder:{width:15,height:15,display:"inline-block"},flatMenuIcon:{position:"absolute",insetInlineStart:0,top:3}})),[]);return(0,k.jsxs)("div",{style:e.container,children:[(0,k.jsx)("span",{style:e.placeholder}),(0,k.jsx)("span",{style:e.flatMenuIcon,children:(0,k.jsx)(l().I,{icon:u().notionFlatTintableIcon,colorVariant:"inverseSecondary",size:"sm"})})]})}},860864:(e,t,n)=>{n.d(t,{BM:()=>b,EB:()=>y,dX:()=>v,tL:()=>x});n(898992),n(354520),n(581454),n(296540);var r=()=>n(56366),o=()=>n(401497),i=()=>n(416504),a=()=>n(69708),s=()=>n(697650),l=()=>n(972435),d=()=>n(186445),c=()=>n(765957),u=()=>n(543665),p=()=>n(95758),m=()=>n(187820),h=()=>n(125565),g=n(474848);const f=(0,a().YK)({privateTeamspace:{id:"baseTable.pageCell.privateTeamspace",defaultMessage:"Private teamspace"},untitledPath:{id:"baseTable.pageCell.untitledPath",defaultMessage:"Untitled"}});function y({store:e,parentSpaceStore:t,rightIcon:n,inlineTitleContent:o,useThinTitle:i,skipUntitledStyling:s}){const l=(0,a().tz)(),d=(0,r().K8)((()=>t||c().default.state.sidebarSpaceStore),[t]),u=(0,r().K8)((()=>{var t;return null==e||null===(t=e.getModel())||void 0===t?void 0:t.getRenderIcon({getRecordModel:e.getRecordModel})}),[e]),{displayTitle:p,pageTitle:h}=(0,r().K8)((()=>x({store:e,intl:l})),[e,l]),f=(0,r().K8)((()=>(0,m().Te)(e)),[e]),y=(0,r().K8)((()=>b({blockStore:e,spaceStore:d,intl:l})),[e,d,l]);return(0,g.jsx)(v,{inlineTitleContent:o,mainIcon:(0,g.jsx)(m().B6,{icon:u,iconRecordCategory:f,size:20,isEmptyPage:!1,disabled:!0}),rightIcon:n,subTitle:y,title:p,titleOpacity:h||s?void 0:.25,useThinTitle:i})}function v({inlineTitleContent:e,mainIcon:t,rightIcon:n,subTitle:r,title:i,titleOpacity:a,useThinTitle:s}){const l=(0,o().IS)((e=>({container:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",padding:"8px 0",width:"100%",position:"relative",overflow:"hidden"},summaryContainer:{flex:1,overflow:"hidden"},iconContainer:{height:20,width:20,flexGrow:0,flexShrink:0,flexBasis:20,marginInlineEnd:12,display:"flex",justifyContent:"center",alignItems:"center",borderRadius:6},byline:{lineHeight:1.3,fontSize:12,opacity:.5},titleContainer:{alignItems:"center",flexDirection:"row",display:"flex"},title:{fontSize:14,fontWeight:s?400:500,...void 0!==a?{opacity:a}:{}}})),[a,s]);return(0,g.jsxs)("div",{style:l.container,children:[(0,g.jsx)("div",{style:l.iconContainer,children:t}),(0,g.jsxs)("div",{style:l.summaryContainer,children:[(0,g.jsxs)("div",{style:l.titleContainer,children:[(0,g.jsx)(h().A,{showTooltipWhenTruncated:!0,style:l.title,children:i}),e]}),(0,g.jsx)(h().A,{showTooltipWhenTruncated:!0,style:l.byline,children:r})]}),n]})}function b(e){const{intl:t,blockStore:n,spaceStore:r}=e;const o=n?(0,d().f)(n,{includeTeamHomeFeed:!1,includeDataSources:!0}).filter((e=>e.id!==n.id)).map((e=>{if(e instanceof p().h)return e.getName()||t.formatMessage(f.privateTeamspace);const n=e.getModel();return(null==n?void 0:n.getRenderTitleWithPlaceholder({getRecordModel:e.getRecordModel,userTimeZone:(0,i().P)(),intl:l().A.getIntl()}))||t.formatMessage(f.untitledPath)})).reverse():[];return o.length>0?o.join("/"):null==r?void 0:r.getName()}function x({store:e,intl:t}){if(e instanceof u().m)return{pageTitle:e.getRenderTitle({intl:t,userTimeZone:(0,i().P)()}),displayTitle:(0,s().getCollectionNameOrDefault)({intl:t,collectionStore:e})};const n=null==e?void 0:e.getModel();if(!n||!e)return{pageTitle:void 0,displayTitle:void 0};const r=e.getRecordModel,o=(0,i().P)(),a=n.getRenderTitle({getRecordModel:r,userTimeZone:o,intl:t}),l=n.getEmptyTitlePlaceholder({getRecordModel:r,userTimeZone:o,intl:t});return{pageTitle:a,displayTitle:a||l}}},881480:(e,t,n)=>{n.d(t,{g:()=>o});n(16280);var r=()=>n(160907);function o(){const e=(0,r().f)();if(!e)throw new Error("No available store");return e}},883476:(e,t,n)=>{n.d(t,{K:()=>F,V:()=>K});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(581454);var r=n(296540),o=()=>n(726637),i=()=>n(484714),a=()=>n(852507),s=()=>n(56366),l=()=>n(401497),d=()=>n(252291),c=()=>n(396896),u=()=>n(631524),p=()=>n(584262),m=()=>n(604995),h=()=>n(955363),g=()=>n(417104),f=()=>n(142078),y=()=>n(49621),v=()=>n(245241),b=()=>n(69708),x=()=>n(534177),S=()=>n(284371),w=()=>n(720128),k=()=>n(296798),I=()=>n(128295),T=()=>n(16006),M=()=>n(447587),C=()=>n(913441),j=()=>n(339600),A=()=>n(362976),B=()=>n(921855),N=()=>n(751380),_=()=>n(492414),R=()=>n(298182),P=()=>n(915189),E=()=>n(639417),D=n(474848);const O=(0,b().YK)({unknownChannel:{id:"SlackResultTitle.unknownChannel",defaultMessage:"Unknown Channel"},showMore:{id:"GithubCodeBlock.showMore",defaultMessage:"Show more"}});function F(e){const{result:t,onMouseEnter:n,onMouseLeave:r,onClick:o,compact:i,hideArrowOnHover:a}=e;return"notion"===t.type?(0,D.jsx)(q,{result:t,position:e.position,onMouseEnter:n,onMouseLeave:r,onClick:o,compact:i,hideArrowOnHover:a}):(0,D.jsx)(K,{result:t,position:e.position,onMouseEnter:n,onMouseLeave:r,onClick:o,compact:i,hideArrowOnHover:a})}function q(e){var t,n;const{result:a,result:{store:c,badges:u},onMouseEnter:m,onMouseLeave:g,onClick:f,compact:y,hideArrowOnHover:v}=e,[b,x]=(0,r.useState)(!1),T=(0,r.useRef)(null),C=V({hovered:b,isDeepFindUxActive:!0,isCompactView:y??!1}),j=(0,i().v3)(),R=(0,r.useCallback)((e=>{x(!0),null==m||m(e)}),[m]),O=(0,r.useCallback)((e=>{x(!1),null==g||g(e)}),[g]),F=(0,r.useCallback)((e=>{null==f||f(e)}),[f]),q=(0,s().K8)((()=>{if(a.highlight&&a.highlight.text)return a.highlight.text}),[a.highlight]),L=(0,s().K8)((()=>{if(q)return q;const e=(0,A().E)(c);return e?(0,B().r4)(e,c):""}),[c,q]),K=(0,N().PO)({words:(0,N().oQ)(null===(t=a.highlight)||void 0===t?void 0:t.title),highlightText:null===(n=a.highlight)||void 0===n?void 0:n.title,styleOverride:C.textHighlight}),U=(0,N().Ay)(L),H={tokenize:e=>(0,N().nB)(U),style:C.textHighlight},{metaHref:W,href:$}=(0,s().K8)((()=>({metaHref:(0,_().Ay)({store:c,fullyQualified:!1,pageVisitSource:p().y8.AIQna}),href:(0,P().OA)({result:a,environment:j})})),[c,a,j]),G=(0,l().IS)((e=>({captionTooltip:{color:e.text.inversePrimary},captionTooltipDivider:{color:e.text.inversePrimary},pageInfoWrapper:{width:"100%",minWidth:0,fontWeight:S().Wy.regular}})),[]);return(0,D.jsx)("div",{style:C.wrap,ref:T,children:(0,D.jsx)(k().A,{href:W,metaHref:$,external:!1,style:C.linkBox,hovered:b,hoveredStyle:C.linkBoxHoveredStyle,onMouseEnter:R,onMouseLeave:O,onClick:F,children:(0,D.jsxs)("div",{style:C.titleWrap,children:[(0,D.jsx)(E().R,{result:a,size:y?12:16,style:C.icon,notStandaloneIcon:y}),(0,D.jsx)("div",{style:G.pageInfoWrapper,children:y?(0,D.jsxs)("div",{style:C.universalTitleWrapper,children:[(0,D.jsx)(z,{badges:y?[]:u??[],store:c,titleHighlighter:K,compact:y}),b&&!v?(0,D.jsx)(d().I,{icon:h().arrowDiagonalUpRightIcon,size:"xxs",style:{flexShrink:0}}):void 0]}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(z,{badges:y?[]:u??[],store:c,titleHighlighter:K,compact:y}),(0,D.jsx)(I().Ay,{store:c,extraLength:o().A.isMobile?0:2,showFullPathInTooltip:!0,enableHoverAncestor:!0,tooltipStyle:G.captionTooltip,tooltipDividerStyle:G.captionTooltipDivider}),(0,D.jsx)(M().A,{maxLines:1,style:C.text,children:(0,D.jsx)(w().A,{text:L,highlighter:H})})]})})]})})},a.id)}function L(e){const{result:t,hovered:n,compact:o}=e,i=V({hovered:n,isDeepFindUxActive:!0,isCompactView:o??!1}),a=(0,b().tz)(),s=(0,r.useMemo)((()=>{if("slack"===t.type){var e;const n=(null===(e=t.highlight)||void 0===e?void 0:e.title)??t.title;return n?n.startsWith("https://")?n:`#${n}`:a.formatMessage(O.unknownChannel)}return"github"===t.type&&"code"===t.fileType?t.githubRepoName:void 0}),[t,a]),l=(0,r.useMemo)((()=>{var e;return"slack"===t.type&&(null===(e=t.threadMessages)||void 0===e?void 0:e.length)&&t.threadMessages.length>1}),[t]),c=(0,r.useMemo)((()=>{var e;return(null===(e=t.highlight)||void 0===e?void 0:e.title)??t.title}),[t]),u={tokenize:e=>(0,N().nB)((0,N().Ay)(c)),style:i.textHighlight},p={tokenize:e=>(0,N().nB)((0,N().Ay)(s||"")),style:i.textHighlight},m={tokenize:e=>(0,N().nB)((0,N().Ay)("slack"===t.type?t.user??"":"")),style:i.textHighlight};return(0,D.jsxs)("div",{style:i.universalTitleWrapper,children:[(0,D.jsx)("span",{style:i.universalTitleText,children:"slack"===t.type?(0,D.jsx)(H,{result:t,highlighter:m}):(0,D.jsx)(w().A,{text:c,highlighter:u})}),(0,D.jsxs)("span",{style:i.universalTitleFollowup,children:[l&&!o?(0,D.jsx)(d().I,{size:"xs",icon:y().h,style:{display:"inline-flex"}}):null,(0,D.jsx)("span",{children:s?(0,D.jsx)(w().A,{text:s,highlighter:p}):null})]})]})}function K(e){const{result:t,onMouseEnter:n,onMouseLeave:o,onClick:a,compact:s,hideArrowOnHover:l}=e,[c,u]=(0,r.useState)(!1),p=(0,r.useRef)(null),g=V({hovered:c,isDeepFindUxActive:!0,isCompactView:s??!1}),f=(0,r.useCallback)((e=>{u(!0),null==n||n(e)}),[n]),y=(0,r.useCallback)((e=>{u(!1),null==o||o(e)}),[o]),v=(0,r.useCallback)((e=>{null==a||a(e)}),[a]),b=(0,i().v3)(),x=(0,r.useMemo)((()=>(0,P().OA)({result:t,environment:b})),[t,b]),{isCodeResult:S,codeText:I}=(0,r.useMemo)((()=>{const e="github"===t.type&&"code"===t.fileType;return{isCodeResult:e,codeText:e?(0,R().Sf)(t.text):""}}),[t]),T=(0,r.useMemo)((()=>{if(!S)return function(e){const t=[];if("slack"===e.type){var n;const r=null!==(n=e.threadMessages)&&void 0!==n&&n.length&&e.threadMessages.length>1?e.threadMessages.length-1+" replies":void 0;r&&t.push(r)}else if("github"===e.type){const n=(0,R().wb)(e.fileType);n&&t.push(n),e.statusTag&&"pull-request"===e.fileType&&t.push(e.statusTag),e.authorName&&t.push(e.authorName)}else"webpage"===e.type&&t.push(e.domain);return e.lastEdited!==m().Mb&&t.push(e.lastEdited),t}(t).join(" • ")}),[t,S]),C=(0,r.useMemo)((()=>{var e,n;return"slack"===t.type?(0,R().B5)((null===(n=t.highlight)||void 0===n?void 0:n.text)??t.text):(null===(e=t.highlight)||void 0===e?void 0:e.text)??t.text}),[t]),j={tokenize:e=>(0,N().nB)((0,N().Ay)(C)),style:g.textHighlight},A=(0,r.useMemo)((()=>{if(!S)return"slack"===t.type?3:1}),[t,S]);return(0,D.jsx)("div",{style:g.wrap,ref:p,children:(0,D.jsx)(k().A,{href:x,metaHref:x,external:!0,style:g.linkBox,hovered:c,hoveredStyle:g.linkBoxHoveredStyle,onMouseEnter:f,onMouseLeave:y,onClick:v,children:(0,D.jsxs)("div",{style:g.universalResultWrapper,children:[(0,D.jsx)(E().R,{result:t,size:s?12:16,style:g.icon,notStandaloneIcon:s}),(0,D.jsx)("div",{style:g.universalBodyWrapper,children:s?(0,D.jsxs)("div",{style:g.universalTitleWrapper,children:[(0,D.jsx)(L,{result:t,hovered:c,compact:s}),c&&!l?(0,D.jsx)(d().I,{icon:h().arrowDiagonalUpRightIcon,size:"xxs",style:{flexShrink:0}}):void 0]}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(L,{result:t,hovered:c,compact:s}),(0,D.jsx)(M().A,{maxLines:A,style:g.text,children:S?(0,D.jsx)(U,{text:I}):(0,D.jsx)(w().A,{text:C,highlighter:j})}),T?(0,D.jsx)("div",{style:g.footerMetadata,children:T}):null]})})]})})},t.id)}function U(e){const{text:t}=e,n=(0,b().tz)(),o=(0,r.useRef)(null),[i,s]=(0,r.useState)(!1),[d,c]=(0,r.useState)(!1),p=(0,l().IS)((e=>({code:{backgroundColor:"transparent",color:e.text.secondary,overflow:i?"auto":"hidden",maxHeight:i?400:200,scrollbarWidth:"thin",tabSize:4,padding:10},codeWrapper:{position:"relative",border:`1px solid ${"light"===e.mode?e.palette.gray[100]:e.palette.gray[300]}`,borderRadius:6},showMoreButton:{margin:10,color:e.text.tertiary,cursor:"pointer",fontSize:12,fontWeight:S().Wy.medium,background:"none",border:"none"}})),[i]);(0,a().w)((()=>{if(o.current&&!i){const e=o.current.scrollHeight,t=o.current.clientHeight;c(e>t)}}));const m=(0,r.useCallback)((e=>{s(!0),e.preventDefault(),e.stopPropagation()}),[]);return(0,D.jsxs)("div",{style:p.codeWrapper,children:[(0,D.jsx)(j().Cy,{style:p.code,scrollContentRef:o,children:t}),!i&&d?(0,D.jsx)(u().p,{style:p.showMoreButton,onClick:e=>m(e),children:n.formatMessage(O.showMore)}):void 0]})}function V(e){const{hovered:t,isCompactView:n}=e;return(0,l().IS)((e=>{const r={wrap:{display:"flex",position:"relative"},linkBox:{display:"flex",alignItems:"center",gap:4,padding:"0 4px",borderRadius:6,fontWeight:500,fontSize:13,transition:"background 150ms",marginInlineStart:-6,maxWidth:"calc(100% + 8px)"},linkBoxHoveredStyle:{background:e.buttonHoveredBackground},iconWrap:{position:"relative",marginInlineEnd:4,width:14,height:14,flexShrink:0},icon:{position:"absolute",insetInlineStart:0,top:0,transition:"opacity 150ms",opacity:1},number:{position:"absolute",insetInlineStart:0,top:0,opacity:t?1:0,transition:"opacity 150ms",zIndex:10},titleWrap:{display:"flex",minWidth:50,alignItems:"start",padding:void 0},text:{marginTop:2,color:e.text.secondary,fontWeight:400},textHighlight:{color:e.text.primary,fontWeight:S().Wy.medium}};return n?{...r,titleWrap:{...r.titleWrap,alignItems:"center",gap:8,color:e.text.secondary,fontWeight:400},wrap:{...r.wrap,width:"100%"},linkBox:{...r.linkBox,padding:"4px 6px",width:"100%",marginInlineStart:0},iconWrap:{...r.iconWrap,marginInlineEnd:6,marginTop:0,width:12,height:12},universalResultWrapper:{...r.titleWrap,flexGrow:1,alignItems:"center",gap:8},number:{...r.number,opacity:0},icon:{position:"relative",width:12,height:12,opacity:1,color:e.icon.secondary},footerMetadata:{whiteSpace:"nowrap",color:e.text.tertiary,fontSize:12,fontWeight:S().Wy.regular,marginTop:3},universalBodyWrapper:{width:"100%",display:"flex",alignItems:"center",color:e.text.secondary,flexWrap:"nowrap",minWidth:0},universalTitleWrapper:{display:"flex",alignItems:"center",overflow:"hidden",gap:4},universalTitleText:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:14,fontWeight:400,color:e.text.secondary},universalTitleFollowup:{whiteSpace:"nowrap",color:e.text.tertiary,fontSize:12,fontWeight:S().Wy.regular,alignItems:"center",gap:3,display:"flex"},textHighlight:{}}:{...r,wrap:{...r.wrap,width:"calc(100% + 20px)"},linkBox:{...r.linkBox,padding:8,width:"100%",marginInlineStart:-8},iconWrap:{...r.iconWrap,marginInlineEnd:12,marginTop:1,width:20,height:20},universalResultWrapper:{...r.titleWrap,flexGrow:1},number:{...r.number,opacity:0},icon:{...r.icon,opacity:1},footerMetadata:{whiteSpace:"nowrap",color:e.text.tertiary,fontSize:12,fontWeight:S().Wy.regular,marginTop:3},universalBodyWrapper:{width:"100%",minWidth:0},universalTitleWrapper:{display:"flex",alignItems:"center",gap:"8px"},universalTitleText:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:14,fontWeight:500},universalTitleFollowup:{whiteSpace:"nowrap",color:e.text.tertiary,fontSize:12,fontWeight:S().Wy.regular,alignItems:"center",gap:3,display:"flex"}}}),[t,n])}function z(e){const{badges:t,store:n,titleHighlighter:o,compact:i}=e,a=(0,b().tz)(),u=(0,l().IS)((e=>({title:{fontSize:14,color:e.text.secondary,fontWeight:i?S().Wy.regular:S().Wy.medium}})),[i]),p=(0,s().K8)((()=>(0,D.jsx)(T().A,{store:n,style:u.title,highlighter:o})),[n,u.title,o]),m=(0,r.useMemo)((()=>new Set(t.map((e=>e.type)))),[t]);return(0,D.jsxs)(c().fI,{gap:4,alignItems:"center",children:[p,m.has("is_collection")?(0,D.jsx)(d().I,{icon:f().H,size:"sm",colorVariant:"secondary"}):void 0,m.has("verified")?(0,D.jsx)(d().I,{icon:g().badgeCheckFillSmallIcon,size:"sm",colorPalette:"blue",colorVariant:"accentPrimary"}):void 0,m.has("is_template")?(0,D.jsx)(C().rx,{label:a.formatMessage(v().Nz.template)}):void 0,m.has("popular_this_week")?(0,D.jsx)(C().oj,{label:a.formatMessage(v().Nz.popularThisWeek)}):void 0,m.has("most_viewed")?(0,D.jsx)(C().iY,{label:a.formatMessage(v().Nz.mostViewed)}):void 0,m.has("agent")?(0,D.jsx)(C().Kg,{label:a.formatMessage(v().Nz.agent)}):void 0]})}function H(e){const{result:t,highlighter:n}=e,o=(0,r.useMemo)((()=>"slack"===t.type?(0,x().O9)(t.threadHref)?t.user:t.text.split(":")[0]:void 0),[t]);return(0,x().O9)(o)?(0,D.jsx)(w().A,{text:o,highlighter:n}):(0,D.jsx)(b().sA,{id:"SlackCitationTitle.authorUnknown",defaultMessage:"Unknown author"})}},887267:(e,t,n)=>{n.d(t,{sg:()=>E,Ay:()=>D,fQ:()=>_,mD:()=>R});n(944114),n(898992),n(354520),n(672577),n(803949),n(581454);var r=n(296540),o=()=>n(484714),i=()=>n(56366),a=()=>n(75435),s=()=>n(584262),l=()=>n(859384),d=()=>n(179034),c=()=>n(245241),u=()=>n(69708),p=()=>n(496603),m=()=>n(534177),h=()=>n(824188),g=()=>n(135669),f=()=>n(260488),y=()=>n(825972),v=()=>n(780865),b=()=>n(968172),x=()=>n(148832),S=()=>n(21899);var w=()=>n(599412),k=()=>n(765957),I=()=>n(982254),T=()=>n(712505),M=()=>n(899677),C=()=>n(939740),j=()=>n(89924),A=()=>n(896278),B=()=>n(913441),N=n(474848);function _(e){const{environment:t,offsetFromBottom:n,spaceId:r,setIsLoadingRecents:o,setEndOfRecentsReached:i,numRecents:a,setNumRecents:s,endOfRecentsReached:l,isLoadingRecents:d,incrementBy:c=50,isCrossWorkspace:u=!1}=e;if(n>200||d||l)return;if(u){if((0,y().Dd)()){const e=a+c;s(e),e>200&&i(!0)}return}const m=b().A.getWithoutSubscribing(r),g=m[m.length-1],f=null==g?void 0:g.visitedAt;if(!f)return;const v=p().nF((async()=>{const e=t.currentUser.id;if(!e||!f)return;o(!0);const n=await h().loadMoreRecentPages(f,{environment:t,userId:e,spaceId:r});o(!1),n||i(!0)}),300);if((0,y().Dd)()){const e=y().NK.state.length,t=Math.min(a+c,e);s(t),i(t>=e)}else v()}function R(e){const{environment:t,isNewElectronTab:n,electronTabs:r,intl:o}=e,i=o.formatMessage({id:"searchDefaultBody.searchActionMenuItem.newPage",defaultMessage:"Create a new page"});return(0,A().g)({environment:t,queryId:void 0,desktopProps:{isNewElectronTabSearch:Boolean(n),electronTabs:r},searchSessionId:void 0,source:"quick_find",action:()=>{f().st({environment:t,reset:!1})},result:{type:"client_action",eventName:"tab_new_page",value:{icon:l().M,title:i,behavior:"action",aliases:void 0,caption:void 0,action:()=>{const e=s().y8.SearchTabs;(async()=>{var n;const o=await(0,w().M)({environment:t,from:"electron_new_tab_search",pageVisitSource:e,navigateOnCreate:!1});o&&(await(null===(n=t.defaultRecordCache.persistedRecordCache)||void 0===n?void 0:n.flushPendingWrites()),g().q9({environment:t,pageVisitSource:e,openInNew:void 0,electronTabSearch:{tabs:r,isNewTab:!0},searchResult:{type:"custom",store:o},queryId:void 0,context:"new_page"}))})()}}}})}function P(e,t){return{store:e,id:e.id,score:-1,spaceId:e.getSpaceId(),sources:[c().Ni.Local],featureGroups:[],originalPosition:t,serverEventProperties:void 0}}function E({bucket:e}){switch(e){case"today":return(0,N.jsx)(u().sA,{id:"search.recentPagesTimeBuckets.today.text",defaultMessage:"Today"});case"yesterday":return(0,N.jsx)(u().sA,{id:"search.recentPagesTimeBuckets.yesterday.text",defaultMessage:"Yesterday"});case"past_week":return(0,N.jsx)(u().sA,{id:"search.recentPagesTimeBuckets.pastWeek.text",defaultMessage:"Past week"});case"past_30_days":return(0,N.jsx)(u().sA,{id:"search.recentPagesTimeBuckets.past30Days.text",defaultMessage:"Past 30 days"});case"older":return(0,N.jsx)(u().sA,{id:"search.recentPagesTimeBuckets.older.text",defaultMessage:"Older"})}(0,m().HB)(e)}const D=function(e){var t;const{onSelect:s,spaceId:l,comboboxProps:c}=e,[h,w]=r.useState(!1),[D,O]=r.useState(!1),F=(0,i().K8)((()=>(0,y().Dd)()?30:-1),[]),[q,L]=r.useState(F),K=(0,i().uB)(void 0,n(970585).A),{section:U,indexLocal:V,indexGlobal:z}=(0,i().K8)((()=>K.state.focus),[K]),H=(0,o().v3)(),W=(0,u().tz)(),$=(0,o().Y0)(),G=(0,n(401497).IS)((e=>({wrapper:{paddingTop:8,width:"100%",height:"100%",overflowX:"hidden",overflowY:"auto",paddingInlineStart:4,paddingInlineEnd:4},sectionHeader:{marginBottom:8},section:{marginBottom:4},menuItemLabel:{lineHeight:"20px",fontSize:14,fontWeight:n(284371).Wy.medium}})),[]),{setDefaultBodyFocusedResult:Q,isQuickSearch:X}=(0,r.useContext)(n(974779).SearchStaticContext),Y=(0,i().K8)((()=>{const e=T().default.state,t=T().default.isCenterPeekOpen()||n(502438).default.isInPeekRenderer();return e.open&&(t||e.isOpening)?e.targetStore:k().default.state.mainEditorCurrentBlockStore}),[]),Z=(0,i().K8)((()=>(0,n(303742).o)(k().default.state.sidebarSpaceViewStore)),[]),J=(0,i().K8)((()=>{const{currentUserRootStore:e}=k().default.state;if(Z&&e)return function(e){const{currentUserRootStore:t,currentPageStore:n,numRecents:r}=e;if(!t)return[];const o=(0,S().f)({currentUserRootStore:t}),i=[];o.forEach((e=>{const t=e.getSpaceId(),n=e.getSpaceStore();if(!n)return;const r=b().A.get(t);if(r){const e=r.map((e=>({...e,store:x().B.createChildStore(n.getPagesStore(),{table:d().ev,id:e.pageId,spaceId:t})})));i.push(...e)}}));const a=i.sort(((e,t)=>t.visitedAt-e.visitedAt)),s=(0,p().hS)(a,(e=>e.pageId)).filter((e=>e.pageId!==(null==n?void 0:n.id)));return r>0?s.slice(0,r):s}({currentUserRootStore:e,currentPageStore:Y,numRecents:q});const t=y().NK.state.filter((e=>e.pageId!==(null==Y?void 0:Y.id)));return q>0?t.slice(0,q):t}),[q,Z,Y]);(0,r.useEffect)((()=>()=>{Q(void 0)}),[Q]);const ee=(0,i().K8)((()=>M().default.state.isNewElectronTab),[]),te=(0,i().K8)((()=>(0,v().iu)(I().A.state.tabs,I().A.state.currentTab.id)),[]),ne=(0,i().K8)((()=>n(430483).zD.isDeepFindEnabled()),[]),re=(0,i().K8)((()=>{var e;const t=[],n=null===(e=a().A.state.preferences)||void 0===e?void 0:e.isNewTabSearchEnabled;if(ee&&n){const e=R({environment:H,isNewElectronTab:ee,electronTabs:te,intl:W});t.push(e)}return t}),[ee,H,W,te]),oe=(0,i().K8)((()=>{var e;const t=$.isElectron&&(null===(e=a().A.state.preferences)||void 0===e?void 0:e.isNewTabSearchEnabled)&&(0,v().iu)(I().A.state.tabs,I().A.state.currentTab.id),r=M().default.state.isNewElectronTab,{sidebarSpaceStore:o}=k().default.state;if(!o||!t||!r)return[];return t.slice(0,4).map(((e,t)=>{let r;if(e.pageId){var i;const n=(null===(i=J.find((({pageId:t})=>e.pageId===t)))||void 0===i?void 0:i.store)??x().B.createChildStore(o,{table:d().ev,id:e.pageId});r={key:`${n.id}:${e.id}`,action:e=>s({index:{local:e.indexLocal,global:e.index},event:e.event,selectedResult:P(n,t),fromSidePeekPanel:!1,additionalResultsCount:re.length,context:"tabs"}),render:e=>(0,N.jsx)(B().GC,{...e,inline:!0,store:n,hidePath:!1,buttonStyle:{paddingInlineStart:1},type:"tabs"})}}else if("chat"===e.type){const t=(0,N.jsx)("div",{style:{...G.menuItemLabel,marginInlineStart:2},children:(0,N.jsx)(u().sA,{id:"searchDefaultBody.searchTabMenuItem.notionAI",defaultMessage:"Notion AI"})});r={key:e.id,action:t=>g().HI({tabId:e.id,tabSectionId:e.tabSectionId,url:n(427704).JZ.chat,event:t.event,environment:H}),render:e=>(0,N.jsx)(n(379819).A,{type:"assistant",...e,title:t})}}return r})).filter(m().O9)}),[$.isElectron,s,re.length,J,G.menuItemLabel,H]),ie=(0,i().K8)((()=>{const e={};return J.forEach((({pageId:t,visitedAt:n})=>e[t]=n)),e}),[J]),ae=(0,i().K8)((()=>{const e=new Map;return J.map(((t,n)=>{const r=y().ht(t.visitedAt),o="today"!==r&&"yesterday"!==r,i={key:`${t.store.id}:${n}`,action:e=>s({index:{local:e.indexLocal,global:e.index},event:e.event,selectedResult:P(t.store,n),fromSidePeekPanel:!1,additionalResultsCount:re.length+oe.length,context:"recent_pages"}),render:e=>(0,N.jsx)(B().GC,{...e,inline:!$.isMobile,store:t.store,hidePath:!1,lastViewed:o?ie[t.store.id]:void 0,buttonStyle:{paddingInlineStart:1},type:"recent_pages"})},a={result:i,store:t.store};var l;e.has(r)?null===(l=e.get(r))||void 0===l||l.push(a):e.set(r,[a])})),e}),[re.length,$.isMobile,J,s,ie,oe.length]),se=(0,n(645873).fJ)(n(601734).Aw),le=(0,i().K8)((()=>(0,n(756790).p)().function),[]),de=(0,i().K8)((()=>{var e;const t=null===(e=se.value)||void 0===e?void 0:e.templatePickerItems.getSuggestedTemplatesForSearch({persona:le,environment:H}).slice(0,3);return null==t?void 0:t.map(((e,t)=>(0,A().g)({environment:H,queryId:void 0,desktopProps:{isNewElectronTabSearch:Boolean(ee),electronTabs:te},searchSessionId:void 0,source:"quick_find",action:()=>{f().st({environment:H,reset:!1})},result:{type:"client_action",eventName:"new_user_template",value:{icon:()=>(0,N.jsx)("div",{children:e.icon}),title:e.name,behavior:"action",aliases:void 0,caption:void 0,action:()=>e.onClick()}}})))}),[null===(t=se.value)||void 0===t?void 0:t.templatePickerItems,le,H,ee,te]),ce=(0,n(135055).y6)(),ue=!(0,i().O$)(n(929219).e),pe=ce&&ue,me=(0,n(383064).x)({onSelect:s}),he=(0,i().K8)((()=>{const e=[];if(re.length>0&&e.push({key:"actions",items:re,render:e=>(0,N.jsx)(j().A,{title:ne?void 0:(0,N.jsx)(u().sA,{id:"search.actions.header",defaultMessage:"Actions"}),desktopTitleStyle:G.sectionHeader,style:G.section,children:e.children})}),oe.length>0&&e.push({key:"tabs",items:oe,render:e=>(0,N.jsx)(j().A,{title:(0,N.jsx)(u().sA,{id:"search.tabs.header",defaultMessage:"Tabs"}),desktopTitleStyle:G.sectionHeader,style:G.section,children:e.children})}),pe)e.push(...me);else for(const[t,n]of ae.entries()){const r={key:t,items:n.map((e=>e.result)),render:e=>(0,N.jsx)(j().A,{title:(0,N.jsx)(E,{bucket:t}),desktopTitleStyle:G.sectionHeader,style:{...G.section},children:e.children})};e.push(r)}return!X&&de&&de.length>0&&e.push({key:"templates",items:de,render:e=>(0,N.jsx)(j().A,{title:(0,N.jsx)(u().sA,{id:"search.templateSuggestions.header",defaultMessage:"Start with a template"}),desktopTitleStyle:G.sectionHeader,style:G.section,children:e.children})}),e}),[re,oe,pe,X,de,ne,G.sectionHeader,G.section,me,ae]),ge=(0,r.useCallback)((e=>_({environment:H,offsetFromBottom:e,spaceId:l,setIsLoadingRecents:w,setEndOfRecentsReached:O,numRecents:q,setNumRecents:L,endOfRecentsReached:D,isLoadingRecents:h,isCrossWorkspace:Z})),[D,H,h,q,l,Z]);(0,r.useEffect)((()=>{var e;if(void 0===U||void 0===V||void 0===z)return;const t=null===(e=he[U])||void 0===e?void 0:e.key;if(t&&"string"==typeof t)if("actions"===t)Q({type:"assistant"});else if(y().Rj.includes(t)){var n;const e=null===(n=ae.get(t))||void 0===n||null===(n=n[V])||void 0===n?void 0:n.store;e&&Q({type:"page_result",value:{index:{local:{indexLocal:V,section:U},global:z},selectedResult:P(e,z-re.length)}})}}),[re.length,Q,z,U,V,ae,he]);const fe=re.length,ye=!$.isMobile&&J.length>0;return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)("div",{style:G.wrapper,children:[(0,N.jsx)(C().Ay,{store:K,type:C().Oh.Vertical,initialFocus:fe,disableKeyboardArrowWrap:!0,sections:he,unfocusOnScroll:!0,comboboxProps:c}),(0,N.jsx)(n(228927).A,{onChange:ge})]}),ye?(0,N.jsx)(n(482173).A,{title:(0,N.jsx)(n(857744).A,{}),shouldShowReportBadSearchButton:!1}):void 0]})}},896278:(e,t,n)=>{n.d(t,{g:()=>h});n(296540);var r=()=>n(564884),o=()=>n(381175),i=()=>n(401497),a=()=>n(584262),s=()=>n(40457),l=()=>n(534177),d=()=>n(577142),c=()=>n(135669),u=()=>n(760217),p=n(474848);function m(e){const{menuListItemProps:t,title:n,caption:r,icon:o,preventClickDefault:a}=e,l=(0,i().IS)((e=>({container:{paddingTop:8,paddingBottom:8},title:{fontWeight:500},shortcut:{fontSize:12,color:e.text.quaternary},icon:{height:20,width:20,fontSize:20},enterIcon:{height:14,width:14,fill:e.text.tertiary,marginTop:2,marginInlineEnd:6}})),[]);return(0,p.jsx)(u().A,{title:(0,p.jsx)("div",{style:l.title,children:n}),caption:r?(0,p.jsx)("div",{children:r}):void 0,...t,icon:o(l.icon),style:l.container,buttonStyle:e.buttonStyles,right:t.focused?(0,s().arrowTurnDownLeftSmallIcon)(l.enterIcon):void 0,rightStyle:l.shortcut,onMouseDown:a?e=>e.preventDefault():void 0})}function h(e){const{result:t,desktopProps:{isNewElectronTabSearch:n,electronTabs:i},queryId:s,environment:u,isMiniSearch:h,preventClickDefault:g,searchSessionId:f,source:y}=e,{title:v,icon:b,caption:x}=t.value;let S=`${v}-search-action-item`;if("navigation"===t.value.behavior){const e=t.value.destination,n="block"===e.type?e.blockStore.id:e.url;S=`${v}-${n}-search-action-item`}return{key:S,action:({event:p})=>{e.action(p),(0,r().u)({environment:u,event:{eventName:"search_action_result_click",eventProperties:{type:t.eventName,search_session_id:f,source:y}}});const{behavior:m}=t.value;if("action"===m)t.value.action();else if("navigation"===m){const e=t.value.destination,r=(0,o().V)(p);"block"===e.type?c().q9({environment:u,openInNew:r,pageVisitSource:a().y8.SearchCustomAction,queryId:s,context:"action",electronTabSearch:{tabs:i??[],isNewTab:n},searchResult:{type:"custom",store:e.blockStore}}):"url"===e.type?(0,d().navigate)({environment:u,url:e.url,queryId:s,openInNew:r,makeTabActive:n}):(0,l().HB)(e)}},render:t=>(0,p.jsx)(m,{menuListItemProps:t,caption:x,icon:b,isMiniSearch:h,preventClickDefault:g,title:v,...e})}}},913441:(e,t,n)=>{n.d(t,{Sh:()=>ee,se:()=>ne,wS:()=>Z,Kg:()=>de,rx:()=>ae,iY:()=>ie,oj:()=>oe,GC:()=>G,yD:()=>Q,Rp:()=>Y});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(823215),n(354520),n(672577),n(430670),n(581454),n(737550);var r=n.n(n(32485)),o=n(296540),i=()=>n(726637),a=()=>n(484714),s=()=>n(56366),l=()=>n(401497),d=()=>n(75435),c=()=>n(252291),u=()=>n(970236),p=()=>n(493552);function m({explanation:e,simple:t=!1,filterZeros:n=!1}){var r;return function e(r,o){if(!r)return[];const{value:i,description:a,details:s}=r;if(0===i&&n)return[];const l=(0===i?"0":i.toFixed(4)).padStart(8);function d(e,t=0){return`${"  ".repeat(o+t)}${e}`}const c=`[${l}] ${a}`;if(a.startsWith("match on required clause")){return[d(`[${l}] match on required clause ${null==s?void 0:s[1].description}`)]}if(["max of:","sum of:","min of:"].includes(a)&&1===(null==s?void 0:s.length))return e(s[0],o);if(a.startsWith("tf")||a.startsWith("idf")){var u;const e=a.split(",")[0],t=null===(u=a.split(" computed as ")[1])||void 0===u?void 0:u.replace(" from:","");return[d(`[${l}] ${e}: [${(s??[]).map((e=>`${e.description.split(",")[0]}=${e.value}`)).join(" ")}] --\x3e ${t}`)]}if(a.startsWith("ConstantScore(_id:"))return[d(`[${l}] ids query`)];const p=t&&0!==o&&(a.startsWith("weight")||a.startsWith("Function"));return[d(c.replace(", result of:","").replace(" from:","").replace(" [PerFieldSimilarity]","").replace(/:$/,"").trim()),...(p?[]:s??[]).flatMap((t=>e(t,o+1)))]}(null==e||null===(r=e.details)||void 0===r?void 0:r[0],0)}var h=()=>n(968610),g=()=>n(417104),f=()=>n(207289),y=()=>n(179034),v=()=>n(245241);var b=()=>n(470020),x=()=>n(931075),S=()=>n(536504),w=()=>n(69708),k=()=>n(512062),I=()=>n(534177),T=()=>n(284371),M=()=>n(135669),C=()=>n(305872),j=()=>n(288782),A=()=>n(751380),B=()=>n(422366),N=()=>n(780865),_=()=>n(907514),R=()=>n(41223),P=()=>n(240865),E=()=>n(765957),D=()=>n(982254),O=()=>n(148832),F=()=>n(793765),q=()=>n(760217),L=()=>n(720128),K=()=>n(676007),U=()=>n(187820),V=()=>n(128295),z=()=>n(16006),H=()=>n(398217),W=n(474848);function $(e,t){const[d,c]=(0,o.useState)(!1),{focused:u,isLastInSection:p,inline:m,className:h}=e;(0,n(852507).w)((()=>{const t=Y(e.result);"query_results"===e.type&&t&&e.onEndTimeToRenderServerResults&&e.onEndTimeToRenderServerResults()}));const g=function(){const{isMobile:e}=(0,a().Y0)();return(0,l().IS)((t=>({menuItem:{minHeight:36,paddingTop:e?12:8,paddingBottom:e?12:8,transition:"none"},menuItemBorder:{},textWrapper:{alignItems:"center",width:"100%"},inlineTextWrapper:{alignItems:"center"},caption:{marginTop:1,color:t.text.secondary},timestamp:{fontSize:T().J.UISmall.desktop,fontWeight:T().Wy.regular,color:t.text.tertiary}})),[e])}(),f=(0,l().IS)((e=>({hovered:{background:e.background.tertiaryTranslucent}})),[]),y=(0,s().O$)(E().AppStoreSidebarSpaceStore),v=(0,n(359941).V)({spaceStore:y}),b=(0,s().K8)((()=>!!e.hidePath||!v&&e.store.isPersonProfile()),[v,e.store,e.hidePath]),x=(0,s().K8)((()=>{var t,o;const{isSurrogateCollection:a,collectionId:s}=e.result??{},l=a&&s?n(543665).m.createChildStore(e.store,{table:n(519831).Vl,id:s}):void 0,y=void 0!==(null===(t=e.result)||void 0===t?void 0:t.workflowData),v=null===(o=e.result)||void 0===o?void 0:o.workflowData;let x=null==v?void 0:v.icon;if(!x){const e=(0,S().Oy)({baseUrl:i().A.domainBaseUrl||"",shape:S().WJ,color:S().i});x=(0,S().Hy)(e)}return{title:l?(0,W.jsx)(n(649320).G,{collectionStore:l,hideCollectionViewBlockIcon:!0}):(0,W.jsx)(pe,{store:e.store,result:e.result,placeholder:e.placeholder,index:e.index,focused:e.focused,inline:e.inline}),icon:y?(0,W.jsx)(U().B6,{disabled:!0,icon:{pointer:e.store.pointer,icon:x},iconRecordCategory:"workflow",isEmptyPage:!0,size:20,largeIcon:!1}):(0,W.jsx)(J,{store:e.store}),caption:b?void 0:(0,W.jsx)(he,{store:l??e.store,inline:e.inline,result:e.result,debugLocal:e.debugLocal,debugHits:e.debugHits,debugAreaRef:e.debugAreaRef,debugModalState:{explanationModalOpen:d,setExplanationModalOpen:c}}),body:v?v.description??void 0:(0,W.jsx)(ee,{result:e.result}),right:(0,W.jsx)(ue,{focused:e.focused,type:e.type,lastViewed:e.lastViewed,result:e.result}),rightStyle:u?void 0:g.timestamp,dontShrinkRight:!0,captionStyle:g.caption,style:{...g.menuItem,...!m&&!p&&!u&&!e.isBeforeFocused&&g.menuItemBorder},spacerStyle:(w=e.store,k=b,k||!(0,V().a6)(w)?{visibility:"hidden"}:void 0),textWrapperStyle:{...g.textWrapper,...e.inline&&g.inlineTextWrapper},className:r()("notranslate",h),buttonStyle:{paddingInlineStart:2},hoveredStyle:f.hovered};var w,k}),[f.hovered,h,d,u,m,p,e.debugAreaRef,e.debugHits,e.debugLocal,e.focused,e.index,e.inline,e.isBeforeFocused,e.lastViewed,e.placeholder,e.result,e.store,e.type,g.caption,g.inlineTextWrapper,g.menuItem,g.menuItemBorder,g.textWrapper,g.timestamp,b]),w=(0,s().K8)((()=>Q({result:e.result,queryId:e.queryId})),[e.queryId,e.result]),k=(0,o.useCallback)((e=>{e.preventDefault(),e.stopPropagation()}),[]),I=(0,o.useMemo)((()=>(0,W.jsx)(q().A,{ref:t,...e,...x,ignoreLocalHoverState:!0})),[t,e,x]);return w?(0,W.jsx)(n(620896).A,{href:w,onClick:k,children:I},w):I}const G=o.memo((0,o.forwardRef)($),((e,t)=>{var n,r;const o=t.focused!==e.focused,i=(null===(n=t.result)||void 0===n?void 0:n.highlight)!==(null===(r=e.result)||void 0===r?void 0:r.highlight),a=t.isLastInSection!==e.isLastInSection,s=t.isBeforeFocused!==e.isBeforeFocused;return o||i||a||s}));function Q(e){const{result:t,queryId:n,pageVisitSource:r,scrollToBlockId:o}=e;if(!t)return;const i=M().$f({result:t,fallbackToCustom:!0});return i?M().xg({result:i,queryId:n,pageVisitSource:r,scrollToBlockId:o}):void 0}function X({data:e}){const t=e;if(!t)return null;if("localSource"in t){const{localSource:e}=t,n=e||["unknown"];return{element:(0,W.jsx)(W.Fragment,{children:`from ${[...n].join(",")}`}),expanded:!1}}return null}function Y(e){return e&&!e.sources.includes(v().Ni.Local)}function Z({result:e,index:t}){var n;if(!e)return null;const r=(null===(n=e.sources??[])||void 0===n?void 0:n.flatMap((e=>e===v().Ni.Local?["💻"]:e===v().Ni.ElasticSearch?["🌐"]:e===v().Ni.Postgres?["🐘"]:e===v().Ni.VectorDBBlock||e===v().Ni.VectorDBCollection?["🔭"]:e===v().Ni.VectorDBBlockOpenAI||e===v().Ni.VectorDBCollectionOpenAI?["🤖"]:e===v().Ni.VectorDBBlockBGE||e===v().Ni.VectorDBCollectionBGE?["🎯"]:e===v().Ni.VectorDBBlockBGE1024||e===v().Ni.VectorDBCollectionBGE1024?["🎪"]:e===v().Ni.VectorDBBlockBGE4096||e===v().Ni.VectorDBCollectionBGE4096?["🎯"]:e===v().Ni.VectorDBBlockE5||e===v().Ni.VectorDBCollectionE5?["⚡"]:e===v().Ni.ElasticsearchRandom?["🎲"]:e===v().Ni.ElasticsearchUniqueID?["🆔"]:e===v().Ni.ElasticsearchForcedRecentRecall?["⏰"]:e===v().Ni.NotionUnknown?["🤷"]:e===v().Ni.UniversalUnknown?["👽"]:void(0,I().HB)(e))).reverse()).join("").trim();return r?(0,W.jsx)("span",{children:r}):null}function J({store:e}){const t=(0,s().K8)((()=>e.getIcon()),[e]),n=(0,s().K8)((()=>e.isEmptyPage()),[e]),r=(0,s().K8)((()=>(0,U().Te)(e)),[e]);return(0,W.jsx)(U().B6,{disabled:!0,icon:t,iconRecordCategory:r,isEmptyPage:n,size:20,largeIcon:!1})}function ee(e){var t,n,r,o,i,a,d,c,u,p,m,h;const{result:g}=e,y=(null==g||null===(t=g.sources)||void 0===t?void 0:t.includes(v().Ni.VectorDBBlock))||(null==g||null===(n=g.sources)||void 0===n?void 0:n.includes(v().Ni.VectorDBCollection))||(null==g||null===(r=g.sources)||void 0===r?void 0:r.includes(v().Ni.VectorDBBlockOpenAI))||(null==g||null===(o=g.sources)||void 0===o?void 0:o.includes(v().Ni.VectorDBCollectionOpenAI))||(null==g||null===(i=g.sources)||void 0===i?void 0:i.includes(v().Ni.VectorDBBlockBGE))||(null==g||null===(a=g.sources)||void 0===a?void 0:a.includes(v().Ni.VectorDBCollectionBGE))||(null==g||null===(d=g.sources)||void 0===d?void 0:d.includes(v().Ni.VectorDBBlockBGE1024))||(null==g||null===(c=g.sources)||void 0===c?void 0:c.includes(v().Ni.VectorDBCollectionBGE1024))||(null==g||null===(u=g.sources)||void 0===u?void 0:u.includes(v().Ni.VectorDBBlockBGE4096))||(null==g||null===(p=g.sources)||void 0===p?void 0:p.includes(v().Ni.VectorDBCollectionBGE4096))||(null==g||null===(m=g.sources)||void 0===m?void 0:m.includes(v().Ni.VectorDBBlockE5))||(null==g||null===(h=g.sources)||void 0===h?void 0:h.includes(v().Ni.VectorDBCollectionE5)),b=(0,l().IS)((e=>({highlight:{color:e.text.primary,fontWeight:T().Wy.medium,...y?{whiteSpace:"pre-wrap"}:{}},collectionTextMatchingProperty:{lineHeight:2,fontSize:12}})),[y]),x=(0,s().K8)((()=>null==g?void 0:g.store.isNavigableBlock()),[null==g?void 0:g.store]);if(!g||!g.highlight)return null;if(x&&!Y(g))return null;let S,w;const k=g.highlight;if(k.text)S=k.text;else if(k.collectionText){var I;S=k.collectionText,w=null==g||null===(I=g.matchedCollectionProperties)||void 0===I?void 0:I.collectionText}if(S=(0,f().KM)(S),!S)return null;const M=(0,A().Ay)(S);let C=!1;if(Y(g)){const e=e=>e.filter(A().dJ).map((e=>e[0].toLowerCase())),t=t=>void 0===t?[]:e((0,A().Ay)(t)),n=[...new Set([...t(k.title),...t(k.pathText)])],r=e=>n.some((t=>t.includes(e)));C=e(M).every((e=>r(e)))}const j=C?{}:b.highlight;return(0,W.jsxs)(W.Fragment,{children:[void 0!==w?(0,W.jsx)(H().mA,{propertySchema:w,showIcon:!0,style:b.collectionTextMatchingProperty}):void 0,(0,W.jsx)(L().A,{text:S,highlighter:{tokenize:e=>(0,A().nB)(M),style:j}})]})}function te(){return(0,l().IS)((e=>({badge:{background:"light"===e.mode?e.palette.blue[30]:e.palette.blue[200],display:"inline-flex",alignItems:"center",whiteSpace:"nowrap"},badgeContent:{display:"flex",alignItems:"center",width:"100%"},badgeCaption:{marginInlineStart:2,color:e.blue.text.accentPrimary},verifiedBadgeIcon:{width:10,height:10,fill:e.blue.icon.accentPrimary},grayedOutBadgeCaption:{marginInlineStart:1}})),[])}function ne(){const e=te();return(0,W.jsx)(u().E,{content:(0,W.jsx)("div",{style:e.grayedOutBadgeCaption,children:(0,W.jsx)(w().sA,{id:"search.result.database.badge.text",defaultMessage:"Database"})})})}function re({label:e}){const t=te();return(0,W.jsx)(u().E,{style:t.badge,content:(0,W.jsxs)("div",{style:t.badgeContent,children:[(0,W.jsx)(c().I,{icon:g().badgeCheckFillSmallIcon,size:"xs",colorPalette:"blue",colorVariant:"accentPrimary"}),(0,W.jsx)("div",{style:t.badgeCaption,children:e})]})})}function oe({label:e}){const t=te();return(0,W.jsx)(u().E,{style:t.badge,content:(0,W.jsx)("div",{style:t.badgeCaption,children:e})})}function ie({label:e}){const t=te();return(0,W.jsx)(u().E,{style:t.badge,content:(0,W.jsx)("div",{style:t.badgeCaption,children:e})})}function ae({label:e}){const t=te();return(0,W.jsx)(u().E,{content:(0,W.jsx)("div",{style:t.grayedOutBadgeCaption,children:e})})}function se(){const e=te();return(0,W.jsx)(u().E,{content:(0,W.jsx)("div",{style:e.grayedOutBadgeCaption,children:(0,W.jsx)(w().sA,{id:"search.result.archived.badge.text",defaultMessage:"Archived"})})})}function le(){const e=te();return(0,W.jsx)(u().E,{content:(0,W.jsx)("div",{style:e.grayedOutBadgeCaption,children:(0,W.jsx)(w().sA,{id:"search.result.current.page.badge.text",defaultMessage:"Current Page"})})})}function de({label:e}){const t=te();return(0,W.jsx)(u().E,{content:(0,W.jsx)("div",{style:t.grayedOutBadgeCaption,children:e})})}function ce({result:e,focused:t}){var n;const r=null==e||null===(n=e.highlight)||void 0===n?void 0:n.uniqueId,o=(0,l().IS)((e=>({uniqueIDBadgeWrapper:{display:"flex",gap:8,marginInlineEnd:8,alignItems:"center"},divider:{borderInlineEnd:`1.5px solid ${t?"dark"===e.mode?k().M.dark.translucentGray[300]:e.searchModalUniqueIdDividerFocused:"dark"===e.mode?k().M.dark.translucentGray[200]:e.searchModalUniqueIdDivider}`,height:14,borderRadius:1}})),[t]),i=(0,A().PO)({words:r?[r]:[]});return r?(0,W.jsxs)("div",{style:o.uniqueIDBadgeWrapper,children:[(0,W.jsx)("div",{children:(0,W.jsx)(L().A,{text:r,highlighter:i})}),(0,W.jsx)("div",{style:o.divider})]}):null}function ue({focused:e,type:t,lastViewed:n,result:r}){const o=(0,a().v3)(),i=(0,s().K8)((()=>(0,N().iu)(D().A.getState().tabs,D().A.getState().currentTab.id)),[]),c=(0,s().K8)((()=>{var e;return Boolean(null===(e=d().A.state.preferences)||void 0===e?void 0:e.isNewTabSearchEnabled)&&o.device.isElectron}),[o.device.isElectron]),u=(0,s().K8)((()=>(0,j().s)()),[]),p=u&&u===(null==r?void 0:r.id),m=c&&("tabs"===t||"query_results"===t&&i.some((e=>e.pageId===(null==r?void 0:r.id)&&"page"===e.type))),g=(0,l().IS)((t=>({right:{display:"flex"},rightIcon:{height:14,width:14,fill:t.icon.tertiary,opacity:e?1:0,marginInlineEnd:6,marginTop:2},rightContentWrapper:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center"},switchToTab:{fontSize:T().J.UISmall.desktop,fontWeight:T().Wy.regular,color:t.text.secondary,marginInlineEnd:4}})),[e]);if(o.device.isMobile)return null;if(n&&!e)return(0,W.jsx)(W.Fragment,{children:(0,_().nl)(n,{useCompactFormat:!0})});const f=m&&!p&&e;return(0,W.jsx)("div",{style:g.right,children:(0,W.jsxs)("div",{style:g.rightContentWrapper,children:[f?(0,W.jsx)("div",{style:g.switchToTab,children:(0,W.jsx)(w().sA,{id:"search.result.switchTab.text",defaultMessage:"Switch tab"})}):void 0,(0,h().arrowTurnDownLeftFillSmallIcon)(g.rightIcon)]})})}function pe({store:e,result:t,placeholder:n,index:r,focused:o,inline:i}){var a,d;const c=(0,w().tz)(),u=void 0===t,p=(0,l().IS)((e=>({title:{fontWeight:T().Wy.medium,lineHeight:"20px",...!u&&!o&&{color:e.text.secondary}},titlePersonalPronoun:{fontWeight:T().Wy.medium,lineHeight:"20px",color:e.text.secondary},titleContent:{display:"flex",...i?{}:{width:0,flexGrow:1}}})),[o,i,u]),m=null==t?void 0:t.workflowData,h=(0,s().K8)((()=>{const n=[];if(t&&t.highlight)if(n.push(...(0,A().oQ)(t.highlight.pathText)),Y(t))n.push(...(0,A().oQ)(t.highlight.title));else if(m)n.push(...(0,A().oQ)(t.highlight.text));else{O().B.createChildStore(e,{table:y().ev,id:t.id,spaceId:t.spaceId}).isNavigableBlock()&&n.push(...(0,A().oQ)(t.highlight.text))}return n}),[t,e,m]),g=(0,A().PO)({words:o?[]:h,highlightText:null==t||null===(a=t.highlight)||void 0===a?void 0:a.title}),f=(0,s().K8)((()=>{var t;return null===(t=(0,B().U)(e))||void 0===t?void 0:t.isArchived()}),[e]),S=function(e){if(e)return e.sources.includes(v().Ni.ElasticsearchUniqueID)}(t),k=(0,s().K8)((()=>(0,j().s)()),[]),I=k&&k===(null==t?void 0:t.id),M=(0,s().K8)((()=>{var t;if(!(e instanceof O().B))return!1;if(!(0,R().I)())return!1;const n=null===(t=E().default.state.sidebarSpaceStore)||void 0===t?void 0:t.getModel();return!(!n||!(0,b().X)(n))&&(0,x().sN)(e.getModel())}),[e]);const C=function(){function e(e){var n;return null==t||null===(n=t.badges)||void 0===n?void 0:n.find((t=>t.type===e))}for(const t of["is_template","popular_this_week","most_viewed","verified","agent"]){const n=e(t);if(void 0!==n)return{type:n.type,label:n.label};if("verified"===t&&M)return{type:"verified",label:c.formatMessage(v().Nz.verified)}}}(),N=(0,P().V)()??0,_=(0,s().K8)((()=>N>1&&!I&&!f||"is_template"===(null==C?void 0:C.type)),[I,f,C,N])?C:void 0,D={is_template:e=>(0,W.jsx)(ae,{label:e}),verified:e=>(0,W.jsx)(re,{label:e}),popular_this_week:e=>(0,W.jsx)(oe,{label:e}),most_viewed:e=>(0,W.jsx)(ie,{label:e}),agent:e=>(0,W.jsx)(de,{label:e})},q=(0,s().K8)((()=>F().Ay.state.showDebugInfo),[]),L=(0,s().K8)((()=>{var t;const n=null===(t=E().default.state.currentUserStore)||void 0===t?void 0:t.id;return Boolean(n&&e instanceof O().B&&e.isPersonProfile()&&e.getPersonProfileUserId()===n)}),[e]),K={style:p.title,store:e,placeholder:n,highlighter:g},U=L?(0,W.jsx)("div",{children:(0,W.jsx)(w().sA,{id:"search.result.title.you",defaultMessage:"{fullName} <you>(You)</you>",values:{fullName:(0,W.jsx)(z().A,{...K,shouldWrap:!0}),you:e=>(0,W.jsx)("span",{style:p.titlePersonalPronoun,children:e})}})}):m?(0,W.jsx)("span",{style:null==g?void 0:g.style,children:null==t||null===(d=t.workflowData)||void 0===d?void 0:d.name}):(0,W.jsx)(z().A,{...K});return(0,W.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",...p.title},children:[(0,W.jsxs)("div",{style:p.titleContent,children:[q&&void 0!==r?`${r+1}. `:void 0,S?(0,W.jsx)(ce,{focused:o,result:t}):void 0,U,f?(0,W.jsx)(se,{}):void 0,I?(0,W.jsx)(le,{}):void 0,_?D[_.type](_.label):void 0]}),q?(0,W.jsx)(Z,{result:t,index:r}):void 0]})}function me(e,t){const{data:n,keyPath:r}=e;if(2===r.length&&"spanText"===r[1]&&"object"==typeof n&&null!==n&&"spanText"in n)return{element:(0,W.jsx)("span",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:`spanText: "${n.spanText}"`}),expanded:!0};if(2===r.length&&"_explanation"===r[0])return{element:(0,W.jsx)("button",{onClick:e=>{t(!0),e.stopPropagation()},children:"show simplified explanation"}),expanded:!1};const o=n._ltrlog;if(o)return function(e){const t=Object.keys(e[0])[0],n=e[0][t],r={paddingInlineStart:5,paddingInlineEnd:20,paddingTop:2,paddingBottom:2,border:"1px solid black",color:k().M.dark.green[900]},o={...r,color:k().M.dark.gray[30]},i=n.map(((e,t)=>{const n=t%2==0?o:r;return(0,W.jsxs)("tr",{children:[(0,W.jsx)("td",{style:n,children:`${t}`}),(0,W.jsx)("td",{style:n,children:`${e.name}`}),(0,W.jsx)("td",{style:n,children:`${e.value}`})]},e.name)}));return{element:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("div",{children:(0,W.jsx)("b",{children:`Featureset: ${t}`})}),(0,W.jsx)("div",{style:{maxHeight:200,overflowY:"scroll"},children:(0,W.jsx)("table",{style:{border:"1px solid black"},children:i})})]}),expanded:!1}}(o);if(!["_score","matched_queries"].every((e=>n[e])))return null;const{_score:i,matched_queries:a}=n;return{element:(0,W.jsx)(W.Fragment,{children:`score ${i}, ${(a??[]).length} matched query clauses`}),expanded:!1}}function he({store:e,inline:t,result:n,debugLocal:r,debugHits:d,debugAreaRef:c,debugModalState:u}){var h,g;const f=(0,s().K8)((()=>F().Ay.state.autoExpandDebugInfo),[]),y=(0,a().Y0)(),v=(0,l().IS)((e=>({captionTooltip:{color:e.text.inversePrimary},captionTooltipDivider:{color:e.text.inversePrimary},debugArea:{fontFamily:"monospace",whiteSpace:"pre-wrap",wordBreak:"break-word"},breadcrumb:{height:"100%",flexGrow:0,marginInlineEnd:8,fontSize:10,minWidth:0},workflowBreadcrumb:{height:"100%",flexGrow:0,marginInlineEnd:8,fontSize:i().A.isMobile?T().J.UISmall.mobile:T().J.UISmall.desktop,minWidth:0,lineHeight:1.2,color:e.text.tertiary}})),[]),b=(0,o.useCallback)((e=>me(e,u.setExplanationModalOpen)),[u.setExplanationModalOpen]),x=(0,A().PO)({words:(0,A().oQ)(n&&n.highlight&&n.highlight.pathText),highlightText:null==n||null===(h=n.highlight)||void 0===h?void 0:h.pathText,removeDuplicate:!0}),S=t||y.isMobile?0:2,w=(d??[]).find((e=>"elasticsearch"===e.type&&void 0!==e._explanation)),k="elasticsearch"===(null==w?void 0:w.type)?null==w?void 0:w._explanation:void 0,I=(0,s().K8)((()=>Boolean(F().Ay.getDebugLevel())),[]),M=(O().B,null==n?void 0:n.workflowData);return(0,W.jsxs)(W.Fragment,{children:[M?(0,W.jsx)(p().D,{styleKey:"Caption/Regular",colorVariant:"tertiary",style:v.workflowBreadcrumb,children:null===(g=n.highlight)||void 0===g?void 0:g.pathText}):(0,W.jsx)(V().Ay,{store:e,extraLength:S,showFullPathInTooltip:!0,highlighter:x,enableHoverAncestor:!0,tooltipStyle:v.captionTooltip,tooltipDividerStyle:v.captionTooltipDivider,hideMultiSourceParentCVB:!0}),(0,W.jsxs)("div",{ref:c,children:[r?(0,W.jsx)("div",{style:v.debugArea,children:(0,W.jsx)(C().H,{data:{debugLocal:r},defaultCollapsed:!f,customCollapsedRenderers:[X],showCopyButton:!1,showModalButton:!1})}):void 0,d?(0,W.jsx)("div",{style:v.debugArea,children:(0,W.jsx)(C().H,{data:{debugHits:d},defaultCollapsed:!f,customCollapsedRenderers:[b],showCopyButton:"small",showModalButton:!0})}):void 0,d&&null!=n&&n.rankingSignals?(0,W.jsx)("div",{style:v.debugArea,children:(0,W.jsx)(C().H,{data:{rankingSignals:n.rankingSignals},defaultCollapsed:!f,showCopyButton:"small",showModalButton:!1})}):void 0,I&&null!=n&&n.featureGroups?(0,W.jsx)("div",{style:v.debugArea,children:(0,W.jsx)(C().H,{data:{featureGroups:n.featureGroups},defaultCollapsed:!f,showCopyButton:"small",showModalButton:!1})}):void 0,k?(0,W.jsx)(K().a,{open:u.explanationModalOpen,innerStyle:{maxHeight:"90vh",maxWidth:"90vw",height:"90vh",width:"90vw",overflow:"scroll",padding:10},onDismiss:()=>u.setExplanationModalOpen(!1),render:()=>(0,W.jsx)("pre",{children:m({explanation:k}).join("\n")})}):void 0]})]})}},921738:(e,t,n)=>{n.d(t,{O:()=>Z});var r=()=>n(564884),o=()=>n(242422),i=()=>n(484714),a=()=>n(56366),s=()=>n(929219),l=(n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(823215),n(354520),n(672577),n(581454),n(737550),()=>n(282834)),d=()=>n(620333);const c=new Set(["myself","of","the","until","couldn","below","won't","me","hers","what","i'll","it's","too","then","re","itself","further","ma","there","have","because","just","she'd","doing","hadn","mustn't","being","down","a","from","shouldn't","shouldn","it","mightn't","o","before","but","we'd","you've","and","ours","wasn't","did","each","is","should","which","were","here","not","at","ll","where","an","same","we're","haven't","haven","isn","with","hasn","she'll","between","has","that'll","been","they","this","for","more","over","i","that","having","he","needn","through","out","we","under","don't","wasn","both","you'll","do","so","t","hadn't","to","him","yourselves","nor","them","own","your","hasn't","they'll","he'll","couldn't","y","ain","he's","these","d","no","himself","after","how","mustn","mightn","off","other","ve","was","wouldn","in","it'll","shan","when","about","if","than","we've","who","above","didn't","only","they've","such","during","shan't","she's","why","can","theirs","won","our","its","had","as","up","will","m","their","doesn","those","you're","ourselves","isn't","yourself","into","you","needn't","any","am","very","my","they'd","again","themselves","didn","some","herself","her","whom","they're","while","now","weren't","i'd","his","by","we'll","yours","weren","or","most","it'd","i've","against","are","does","once","aren","aren't","few","s","all","wouldn't","you'd","he'd","doesn't","don","should've","on","be","i'm","she"]),u=3;const p=/(.{1,3})不\1/,m=/什么|什麼|谁|誰|哪|怎么|怎麼|多少|啥|如何|是否/,h=/我|你|他|她|它|您/,g=/今天|昨天|明天|前天|这几天|這幾天|这两天|這兩天|周|週|月|最近|最新|当前|當前|目前|近来|近來|即将|即將|刚才|剛才|刚刚|剛剛|进行中|進行中|正在/;const f=/누구|뭐|어디|언제|왜|어떻게|어떤|어느|할 수 있|할 수도/,y=/나는|내가|제가|너가|네가|우리|저희|너는|그것|그들|이것|그거|저거/,v=["내","제"],b=/지금|오늘|내일|어제|모레|그저께|이번주|다음주|지난주|이번달|다음달|지난달|올해|내년|작년|재작년|내후년|아침|정오|점심|오후|저녁|새벽|나중에|곧|항상|자주|가끔|드물게/,x=/슬랙|스랙|마이크로소프트|구글|깃허브|쉐어포인트|지메일|이메일|지라/;const S=/なに|何|だれ|誰|どこ|いつ|なぜ|どうして|どの|どれ|どちら|どっち|どんな|いかが|いかなる|どうする/,w=/何も|いつも|何でも|なんでも|誰でも|いつでも|どこでも|どうでも|どれでも|どこか|いつか|誰か/,k=/私|わたし|僕|ぼく|俺|おれ|あなた|君|きみ|彼|かれ|彼女|かのじょ/,I=/スラック|マイクロソフト|グーグル|ギットハブ|シェアポイント|ジーメール|メール|ジラ/,T=/今日|今晩|今朝|朝から|朝まで|午前|昼前|正午|昼時|午後|日中|夕方|昨日|明日|明後日|先週|今週|来週|先月|今月|来月|今年|来年|昨年|去年|最近|現在|最新|進行中|真夜中|明け方|後で|すぐ|時々|めったに/;function M(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}const C=["qui","que","quoi","où","quand","pourquoi","comment","quel","quelle","quels","quelles","combien"],j=["ou"],A=["je","tu","il","elle","nous","vous","ils","elles","moi","toi","lui","eux","mon","ton","son","notre","votre","leur","me","ma","te","ta","se","sa","mes","tes","ses","nos","vos","leurs"],B=[],N=["aujourd'hui","hier","demain","semaine","semaines","mois","recent","recemment","actuel","actuellement","dernierement","dernier","prochain","en cours"];const _=["quien","quienes","cual","cuales","porque","donde","cuanto","cuantos","cuantas"],R=["cuando","como"],P=["yo","tu","el","ella","nosotros","nosotras","vosotros","vosotras","ellos","ellas","mi","su","nuestro","nuestra","vuestro","vuestra","sus","me","te","se","nos","os","lo","la","los","las"],E=[],D=["hoy","ayer","manana","semana","semanas","mes","meses","reciente","recientemente","actual","actualmente","ultimo","proximo","en curso"],O=["el","la","los","las","de","del","al","en","un","una","unos","unas","y","o","pero","si","no","con","por","para","sin","sobre","entre","desde","hasta","durante","antes","despues","segun","hacia","contra","bajo","tras","ante","mediante","salvo","excepto","incluso","solo","tambien","aun","ya","todavia","apenas","mas","menos","muy","mucho","poco","bastante","demasiado","tan","tanto","cuanto","todo","cada","otro","mismo","ese","este","aquel","eso","esto","aquello","donde","cuando","como","que","quien","cual","cuyo","cuya","cuyos","cuyas","es","son","esta","estan","estoy","estas","estamos","estais","soy","eres","somos","sois","fue","fueron","era","eran","eras","eramos","erais","sea","sean","seas","seamos","seais","este","esten","estes","estemos","esteis","siendo","estado","ser","estar"];const F=["who","whos","what","whens","whats","wheres","why","how","hows","which","whose","whom","whatever","whenever","wherever","however","whichever","whether"],q=["is","can","could","couldn","couldnt","should","shouldn","shouldnt","would","wouldn","wouldnt","does","doesnt","did","didnt","do","does","dont","where","when"],L=["i","me","my","mine","myself","we","us","our","ours","ourselves","you","your","youre","yours","yourself","yourselves","it","its","itself","they","them","their","theirs","themselves","this","that","these","those"],K=["slack","microsoft","google","github","sharepoint","gmail","jira","onedrive","linear"],U=["today","yesterday","tomorrow","week","weeks","month","months","recent","recently","current","currently","lately","latest","upcoming","ongoing"];function V({query:e,detectedLanguage:t,detectionTypes:n,userLocale:r,treatUnsupportedLanguageAsNaturalLanguage:o,filterStopWords:i}){const a=(0,d().l0)(e).stringWithoutQuotedTerms,s=(a??"").toLowerCase().replace(/[^\w\s]|_/gu," ").split(/\s+/),V=new Set(s),z=(0,l().Bu)(e,r);if("zh"===z&&a){if(function(e){const{unquotedQuery:t,detectionTypes:n}=e;if(n.includes("question_words")){if(t.endsWith("吗")||t.endsWith("嗎")||t.endsWith("呢"))return!0;if(m.test(t))return!0;if(t.includes("有没有")||t.includes("有沒有")||t.includes("有冇"))return!0;if(p.test(t))return!0}return!!(n.includes("pronouns")&&h.test(t)||(n.includes("connector_names"),n.includes("time_frame")&&g.test(t)))}({unquotedQuery:a,detectionTypes:n}))return!0}else if("ko"===z&&a){if(function(e){const{unquotedQuery:t,detectionTypes:n}=e,r=(t??"").replace(/[^\p{L}\p{N}\s]|_/gu," ").split(/\s+/);if(n.includes("question_words")){if(f.test(t))return!0;if((t.endsWith("가요")||t.endsWith("나요"))&&!t.endsWith("인기가요"))return!0}if(n.includes("pronouns")){if(y.test(t))return!0;if(r.some((e=>e.startsWith("이거"))))return!0;if(r.some((e=>v.includes(e))))return!0}return!(!n.includes("connector_names")||!x.test(t))||!(!n.includes("time_frame")||!b.test(t))}({unquotedQuery:a,detectionTypes:n}))return!0}else if("ja"===z&&a){if(function(e){const{unquotedQuery:t,detectionTypes:n}=e,r=t.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()。、？]/g,"");if(n.includes("question_words")){if(r.length>6){if(r.endsWith("か"))return!0;if(r.endsWith("なの"))return!0;if(r.endsWith("どう"))return!0}if(S.test(t)&&!w.test(t))return!0}return!(!n.includes("pronouns")||!k.test(t))||!(!n.includes("connector_names")||!I.test(t))||!(!n.includes("time_frame")||!T.test(t))}({unquotedQuery:a,detectionTypes:n}))return!0}else if("fr"===t&&a){if(function(e){const{detectionTypes:t}=e,n=e.unquotedQuery.toLowerCase(),r=function(e){const t=[[/(\b)l[''](\w)/gi,"$1le $2"],[/(\b)d[''](\w)/gi,"$1de $2"],[/(\b)j[''](\w)/gi,"$1je $2"],[/(\b)m[''](\w)/gi,"$1me $2"],[/(\b)t[''](\w)/gi,"$1te $2"],[/(\b)s[''](\w)/gi,"$1se $2"],[/(\b)n[''](\w)/gi,"$1ne $2"],[/(\b)c[''](\w)/gi,"$1ce $2"],[/(\b)qu[''](\w)/gi,"$1que $2"],[/(\b)au(\b)/gi,"à le"],[/(\b)aux(\b)/gi,"à les"],[/(\b)du(\b)/gi,"de le"],[/(\b)des(\b)/gi,"de les"],[/(\b)l' (\w)/gi,"le $2"],[/(\b)d' (\w)/gi,"de $2"]];let n=e;for(const[r,o]of t)n=n.replace(r,o);return n}(n??"").replace(/[-.!,;:_?\s]/gu," ").toLowerCase().split(/\s+/),o=new Set(r),i=new Set(r.map((e=>M(e))));if(t.includes("question_words")&&r.length>=3){if(C.some((e=>o.has(e))))return!0;const e=null==n?void 0:n.split(/[.!,;:]\s+/).map((e=>M(e.trim().split(/\s+/)[0]??""))).filter(Boolean);if(null!=e&&e.find((e=>j.includes(e))))return!0;if(M(n).includes("est-ce que"))return!0;const t=["est","sont","a","ont","peut","peuvent","doit","doivent"],i=["je","tu","il","elle","nous","vous","ils","elles"];for(let n=0;n<r.length-1;n++)if(t.includes(r[n])&&i.includes(r[n+1]))return!0}return!(!t.includes("pronouns")||!A.some((e=>i.has(e))))||!(!t.includes("connector_names")||!B.some((e=>i.has(e))))||!(!t.includes("time_frame")||!N.some((e=>i.has(e))))}({unquotedQuery:a,detectionTypes:n}))return!0}else if("es"===t&&a){if(function(e){const{detectionTypes:t}=e,n=e.unquotedQuery.toLowerCase(),r=n.replace(/[-.!,;:_?\s]/gu," ").toLowerCase().split(/\s+/),o=new Set(r.map((e=>M(e))));if(0===r.filter((e=>{const t=M(e);return!O.includes(t)&&!_.includes(t)&&"que"!==t&&"como"!==t})).length)return!1;if(t.includes("question_words")&&r.length>=2){if(_.some((e=>o.has(e))))return!0;if(r.includes("qué"))return!0;const e=null==n?void 0:n.split(/[.!,;:]\s+/).map((e=>{var t;return M((null===(t=e.trim().split(/\s+/)[0])||void 0===t?void 0:t.toLowerCase())??"")})).filter(Boolean);if(null!=e&&e.find((e=>R.includes(e)))&&r.length>2)return!0;const t=["es","son","esta","estan","puede","pueden","debe","deben","tiene","tienen"];for(let n=0;n<r.length-1;n++)if(t.includes(M(r[n]))&&P.includes(M(r[n+1])))return!0}return!(!t.includes("pronouns")||!P.some((e=>o.has(e))))||!(!t.includes("connector_names")||!E.some((e=>o.has(e))))||!(!t.includes("time_frame")||!D.some((e=>o.has(e))))}({unquotedQuery:a,detectionTypes:n}))return!0}else if(o&&"en"!==t)return!0;if((a??"").includes("?")||(a??"").includes("？")||(a??"").includes("¿"))return!0;if(i){const e=function(e){const{query:t,stopWords:n}=e,r=((null==t?void 0:t.trim())??"").toLowerCase().replace(/[^\w\s]|_/gu," "),o=r.split(/\s+/),i=o.filter((e=>e.length>=u)),a=new Set(i);return Array.from(a).every((e=>n.has(e.trim())))}({query:a,stopWords:c});if(e)return!1}const H=[n.includes("question_words")?F:[],n.includes("pronouns")?L:[],n.includes("connector_names")?K:[],n.includes("time_frame")?U:[]];for(const l of H){if(l.some((e=>V.has(e))))return!0}if(n.includes("question_words")){const e=null==a?void 0:a.split(/[.!,;:]\s+/).map((e=>{var t;return null===(t=e.trim().split(/\s+/)[0])||void 0===t?void 0:t.toLowerCase()})).filter(Boolean);if(null!=e&&e.find((e=>q.includes(e))))return!0}return!1}var z=()=>n(979340),H=()=>n(209199),W=()=>n(765957),$=()=>n(430483);const G=3,Q=3,X=6;function Y(e){const{query:t,searchSessionId:n,environment:i}=e,{is_query_natural_language:a,character_length:s,word_length:d,cjk_language:c,is_extended_question:u}=function(e){var t;const{query:n}=e,r=(null===(t=W().default.state.currentUserSettingsStore)||void 0===t||null===(t=t.getSettings())||void 0===t?void 0:t.preferred_locale)??H().q,i=(0,l().Bu)(n,r);if("zh"===i){if(Array.from(n).length<G)return{is_query_natural_language:!1,cjk_language:"zh",character_length:Array.from(n).length,word_length:void 0,is_extended_question:!1}}else if("ja"===i){if(Array.from(n).length<2*G)return{is_query_natural_language:!1,cjk_language:"ja",character_length:Array.from(n).length,word_length:void 0,is_extended_question:!1}}else{if("ko"===i&&Array.from(n).length<2*G)return{is_query_natural_language:!1,cjk_language:"ko",character_length:Array.from(n).length,word_length:void 0,is_extended_question:!1};const e=(n??"").toLowerCase().replace(/[^\w\s]|_/gu," ").split(/\s+/),t=o().default.getConfigKey("ai_auto_stream_config","minWordCount")??Q;if(e.length<t)return{is_query_natural_language:!1,cjk_language:i,character_length:Array.from(n).length,word_length:e.length,is_extended_question:!1}}const a=V({query:n,detectedLanguage:"none"===i?(0,H().o_)(r):i,detectionTypes:["question_words"],userLocale:r,treatUnsupportedLanguageAsNaturalLanguage:!1,filterStopWords:!0});if(!a){if("zh"===i||"ja"===i||"ko"===i)return{is_query_natural_language:!1,cjk_language:i,character_length:Array.from(n).length,word_length:void 0,is_extended_question:Array.from(n).length/1.5>=X};const e=(n??"").toLowerCase().replace(/[^\w\s]|_/gu," ").split(/\s+/);return{is_query_natural_language:e.length>=X,cjk_language:i,character_length:Array.from(n).length,word_length:void 0,is_extended_question:e.length>=X}}return{is_query_natural_language:a,cjk_language:i,character_length:Array.from(n).length,word_length:void 0,is_extended_question:!1}}({query:t,searchSessionId:n});return(0,r().u)({environment:i,event:{eventName:"natural_language_query_check_fired",eventProperties:{is_query_natural_language:a,character_length:s,word_length:d,cjk_language:c,search_session_id:n,is_extended_question:u}}}),a||u}function Z(e){const{query:t,searchSessionId:n}=e,r=(0,a().K8)((()=>!!W().default.state.sidebarSpaceStore&&(0,z().HO)(W().default.state.sidebarSpaceStore.getSubscriptionTier())),[]),o=(0,i().v3)(),l=(0,a().K8)((()=>Y({query:t,searchSessionId:n,environment:o})),[o,t,n]);return{variant:(0,a().K8)((()=>r&&s().A.state.online&&l&&$().zD.isAnswerStreamingInSearchModalEnabled()?"auto_streaming":$().zD.shouldShowSearchMenuItemAskAI()&&s().A.state.online?"navigate_to_full_page":"none"),[r,l]),isNaturalLanguageQuery:l}}},933117:(e,t,n)=>{n.d(t,{A:()=>m});n(944114),n(898992),n(803949),n(581454);var r=n(296540),o=()=>n(30537),i=()=>n(496603),a=()=>n(534177),s=()=>n(722872),l=()=>n(404277),d=()=>n(939740),c=()=>n(45552),u=()=>n(89924),p=n(474848);const m=function({renderOrigin:e,onClick:t,items:r,getKey:o,renderItem:i,selectedItem:a,onSelect:l,dontCloseParentOnSelect:d,menuTypeOverride:c,menuTitle:u,width:m,minWidth:h,disabled:y,originGap:v,buttonPopupStore:b,sameWidthAsOrigin:x}){const S=(0,n(56366).uB)(b,n(463830).A),w=c??(n(726637).A.isMobile?s().gu.Modal:s().gu.Popup);return(0,p.jsx)(n(406699).A,{popupType:f(w),bottomSheetInitialState:"half",renderOrigin:e,buttonPopupStore:S,placementToOrigin:"bottom",onClick:t,render:e=>(0,p.jsx)(g,{parent:e,items:r,getKey:o,renderItem:i,selectedItem:a,onSelect:l,dontCloseParentOnSelect:d,menuType:w,menuTitle:u,width:m,minWidth:h}),disabled:y,originGap:v,sameWidthAsOrigin:x})};function h(e,t,n,o,i,a,s,l){return{key:0,render:e=>(0,r.createElement)(u().A,{...e,key:t,topBorder:t>0}),items:e.map((e=>({key:o(e),render:t=>i({...t,value:e,key:o(e),selectedItem:a}),action:()=>{!function(e,t,n){t!==e&&n(e)}(e,a,s),l||n.close()}})))}}function g({parent:e,items:t,getKey:n,renderItem:r,selectedItem:o,onSelect:u,dontCloseParentOnSelect:m,menuType:g,menuTitle:f,width:y,minWidth:v}){const b=[];if(function(e){return e.length>0&&e[0]instanceof Array}(t))t.forEach(((t,i)=>{const a=h(t,i,e,n,r,o,u,m);b.push(a)}));else{const i=h(t,0,e,n,r,o,u,m);b.push(i)}const x=(0,p.jsx)(d().Ay,{type:d().Oh.Vertical,initialFocus:i().SL(i().Bq(t),(e=>i().n4(e,o))),sections:b});let S;switch(g){case s().gu.ActionSheet:S={menuType:s().gu.ActionSheet};break;case s().gu.Modal:S={menuType:s().gu.Modal,title:f,right:(0,p.jsx)(c().DoneMenuText,{}),onClickRight:e.close};break;case s().gu.Popup:S={menuType:s().gu.Popup,width:y||160,minWidth:v};break;default:(0,a().HB)(g)}return(0,p.jsx)(l().A,{...S,children:x})}function f(e){switch(e){case s().gu.ActionSheet:return o().n.SlideUp;case s().gu.Modal:return o().n.BottomSheet;case s().gu.Popup:return o().n.Popup}}},942095:(e,t,n)=>{n.d(t,{c:()=>L});var r=n(296540),o=()=>n(56366),i=()=>n(401497),a=()=>n(406094),s=()=>n(104556),l=()=>n(542101),d=()=>n(69708),c=()=>n(430483),u=()=>n(659467),p=()=>n(285790),m=()=>n(859428),h=(n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(803949),n(737550),()=>n(564884)),g=()=>n(726637),f=()=>n(484714),y=()=>n(852507),v=()=>n(729108),b=()=>n(160432),x=()=>n(245241),S=()=>n(201980),w=()=>n(284371),k=()=>n(559506),I=()=>n(901389),T=()=>n(471995),M=()=>n(972435),C=()=>n(780865),j=()=>n(582089),A=()=>n(765957),B=()=>n(250484),N=()=>n(666429),_=()=>n(297872),R=()=>n(623580),P=()=>n(125565),E=()=>n(641514),D=n(474848);const O=(0,d().YK)({additionalInformationPlaceholder:{id:"SearchBadResultsForm.additionalInformation.placeholder",defaultMessage:"What went wrong with this search? Please be as specific as possible."},additionalInformationPositivePlaceholder:{id:"SearchGoodResultsForm.additionalInformation.placeholder",defaultMessage:"What went well with this search? Please be as specific as possible."},submitFailed:{id:"SearchBadResultsForm.submitFailed",defaultMessage:"Failed to submit report"},submitSuccess:{id:"SearchBadResultsForm.submitSuccess",defaultMessage:"Your report has been submitted, thanks!"},title:{id:"SearchBadResultsForm.title",defaultMessage:"Give search feedback"},warning:{id:"SearchBadResultsForm.warning",defaultMessage:"The pages from the search results, the search query, and the feedback will be sent to Notion for quality improvement."},cancel:{id:"SearchBadResultsForm.cancel",defaultMessage:"Cancel"},submit:{id:"SearchBadResultsForm.submit",defaultMessage:"Submit"},urlPlaceholder:{id:"SearchBadResultsForm.url.placeholder",defaultMessage:"Link to page you were looking for..."},additionalInformationWarning:{id:"SearchBadResultsForm.additionalInformation.warning",defaultMessage:"The details you provided are too similar to your search keywords. To help us understand the issue, please describe what went wrong."},checkboxLabel:{id:"SearchBadResultsForm.followUpCheckbox",defaultMessage:"Allow Notion to contact me by email to follow up regarding this search"}});function F(e){const t=(0,f().v3)(),n=(0,d().tz)();(0,y().l)((()=>{(0,h().u)({environment:t,event:{eventName:"report_bad_search_modal_open",eventProperties:{}}})}));const[s]=(0,r.useState)(B().Ay),l=(0,o().O$)(A().AppStoreSidebarSpaceStore),[p,m]=(0,o().$y)(u().A),[F,L]=(0,r.useState)(""),[K,U]=(0,r.useState)(!1),[V,z]=(0,r.useState)(true),H=(0,r.useCallback)((()=>{(0,h().u)({environment:t,event:{eventName:"report_bad_search_submit",eventProperties:{}}}),V&&(0,h().u)({environment:t,event:{eventName:"report_bad_search_allow_follow_up",eventProperties:{}}}),function({serverResults:e,localResults:t,exposedSearchExperiments:n,debugInfo:r,source:o,environment:i,allowFollowUp:a,searchStoreState:s,currentSpaceStore:l}){var d,p,m,h;const g=u().A.getState(),f=C().fz(e),y=C().fz(t),v=void 0,b={query:s.query,limit:s.limit,debug:v},{publicAccessPermissionAncestorBlockId:w}=C().Er(i),A=C().eV({environment:i,input:b,spaceId:null==l?void 0:l.id,publicAccessPermissionAncestorBlockId:w,source:"report_bad_search"});if(!A)return;let B;if(c().zD.isMiniSearchModalEnabled()){const e=document.querySelector(".mini-search-snapshot-container");B=null==e?void 0:e.outerHTML}else{const e=document.getElementsByClassName("notion-overlay-container notion-default-overlay-container")[0];B=null==e?void 0:e.outerHTML}const _=document.getElementsByClassName("notion-app-inner notion-dark-theme")[0],R=null==_?void 0:_.style.cssText,P=document.createElement("div");P.innerHTML=B||"",P.style.cssText=R||"",null===(d=P.querySelector("[data-search-suggested-text]"))||void 0===d||d.remove(),null===(p=P.querySelector("[data-search-snapshot-delete-nearest-overlay]"))||void 0===p||null===(p=p.closest("[data-overlay]"))||void 0===p||p.remove(),function(e,t){const n=document.createElement("span");n.innerHTML="💻";const r=document.createElement("span");r.innerHTML="⬇️🌐";e.querySelectorAll(".notranslate.search-query-result-item").forEach(((e,o)=>{const i=e.querySelector("[data-search-icon-target]");let a;var s;i?a=i:a=null===(s=e.firstElementChild)||void 0===s||null===(s=s.children[1])||void 0===s||null===(s=s.firstElementChild)||void 0===s?void 0:s.firstElementChild;a&&o<t?a.appendChild(n.cloneNode(!0)):a&&a.appendChild(r.cloneNode(!0))}))}(P,y.length);const E=f.some((e=>e.sources.includes(x().Ni.VectorDBBlock)||e.sources.includes(x().Ni.VectorDBCollection)||e.sources.includes(x().Ni.VectorDBBlockOpenAI)||e.sources.includes(x().Ni.VectorDBCollectionOpenAI)||e.sources.includes(x().Ni.VectorDBBlockBGE)||e.sources.includes(x().Ni.VectorDBCollectionBGE)||e.sources.includes(x().Ni.VectorDBBlockBGE1024)||e.sources.includes(x().Ni.VectorDBCollectionBGE1024)||e.sources.includes(x().Ni.VectorDBBlockBGE4096)||e.sources.includes(x().Ni.VectorDBCollectionBGE4096)||e.sources.includes(x().Ni.VectorDBBlockE5)||e.sources.includes(x().Ni.VectorDBCollectionE5)));E&&f.splice(0,-20);const F=n??{},q={queryText:s.query.text.trim(),apiRequest:A,serverResults:JSON.stringify(f,null,2),localResults:JSON.stringify(y,((e,t)=>t instanceof Set?Array.from(t):t),2),additionalInformation:g.additionalInformation,desiredUrl:g.desiredUrl,renderedHtml:(0,S().xV3)(P.outerHTML),experiments:JSON.stringify(F,null,2),isVectorSearchEnabled:E,traceLogs:null==r||null===(m=r.traceLogs)||void 0===m?void 0:m.log,userId:i.currentUser.id??"",platform:i.device.platform,workSpaceSize:(null===(h=(0,j().M)(null==l?void 0:l.getPublicSpaceData()))||void 0===h?void 0:h.toString())??"",planType:(null==l?void 0:l.getPlanType())??"",allowFollowUp:a,source:o,feedback:u().A.getState().feedback};k().callApi({eventName:"reportBadSearch",environment:i,data:q}).then((e=>{"failed"===e.type?I().f1((0,D.jsx)("h1",{children:M().A.formatMessage(O.submitFailed)})):T().D6({label:M().A.formatMessage(O.submitSuccess),durationMs:N().LX})})),u().A.reset()}({...e,currentSpaceStore:l,environment:t,allowFollowUp:V,searchStoreState:e.reportBadSearchInputRequest?{...s.state,source:"mini_quick_find",query:e.reportBadSearchInputRequest.query,limit:e.reportBadSearchInputRequest.limit}:s.state})}),[t,l,V,e,s]),W=e=>{const t=e.target.value;m({...p,additionalInformation:t}),t.trim()===s.state.query.text.trim()?(L(M().A.formatMessage(O.additionalInformationWarning)),U(!0)):(L(""),U(!1))},$=()=>{z(!V)},G=function(){const e=g().A.isMobile;return(0,i().IS)((t=>({wrap:{display:"flex",flexDirection:"column",width:e?"min(100%, 600px)":void 0,minHeight:128,maxHeight:e?void 0:"max(calc(100vh - 78px), 300px)"},modalWrap:{width:"32rem",padding:24,fontSize:14,maxWidth:"100%"},modalTitle:{fontSize:16,fontWeight:w().Wy.medium},modalWarning:{fontSize:13,color:t.text.tertiary},titleContainer:{marginBottom:12},buttonArea:{display:"flex",justifyContent:"flex-end",marginTop:18,gap:6},feedbackArea:{marginTop:17,padding:8},warningMessage:{color:t.red.text.accentPrimary,marginTop:10},checkboxArea:{marginTop:12,display:"flex",gap:6,alignItems:"center"}})),[e])}();return(0,D.jsx)(E().A,{onDismiss:()=>q(t),render:()=>(0,D.jsx)(_().A,{allowMobileAutoScroll:!0,capture:!0,allowUndo:!0,allowEsc:!0,allowTabUntab:!1,render:e=>(0,D.jsx)("div",{style:G.wrap,"data-search-snapshot-delete-nearest-overlay":!0,"data-mini-search-exclude-from-snapshot":!0,children:(0,D.jsxs)("div",{style:G.modalWrap,...e,children:[(0,D.jsxs)("div",{style:G.titleContainer,children:[(0,D.jsx)("div",{style:G.modalTitle,children:M().A.formatMessage(O.title)}),(0,D.jsx)("div",{style:G.modalWarning,children:M().A.formatMessage(O.warning)})]}),(0,D.jsx)(R().A,{placeholder:"thumbsUp"===p.feedback?n.formatMessage(O.additionalInformationPositivePlaceholder):n.formatMessage(O.additionalInformationPlaceholder),value:p.additionalInformation,onChange:W,focusInitial:!0,inputStyle:{padding:8},style:G.feedbackArea,textarea:!0}),F?(0,D.jsx)("div",{style:G.warningMessage,children:F}):void 0,(0,D.jsx)(R().A,{placeholder:M().A.formatMessage(O.urlPlaceholder),value:p.desiredUrl,onChange:e=>{m({...p,desiredUrl:e.target.value})},style:G.feedbackArea}),(0,D.jsxs)("div",{style:G.checkboxArea,children:[(0,D.jsx)(v().S,{checked:V,onClick:$,size:12}),(0,D.jsx)("div",{onClick:$,children:(0,D.jsx)(P().A,{style:{cursor:"pointer"},isSmall:!0,children:M().A.formatMessage(O.checkboxLabel)})})]}),(0,D.jsxs)("div",{style:G.buttonArea,children:[(0,D.jsx)(a().A,{size:"lg",onClick:()=>q(t),children:M().A.formatMessage(O.cancel)}),(0,D.jsx)(b().A,{colorPalette:"blue",size:"lg",onClick:H,disabled:K,children:M().A.formatMessage(O.submit)})]})]})})}),isOpen:p.open})}function q(e){(0,h().u)({environment:e,event:{eventName:"report_bad_search_abandon",eventProperties:{}}}),u().A.reset()}function L(e){const t=(0,d().tz)(),n=(0,o().K8)((()=>u().A.state.open),[]),h=(0,o().K8)((()=>c().zD.isMiniSearchModalEnabled()),[]),g=(0,r.useCallback)((e=>{u().A.update((t=>({...t,open:!0,feedback:e})))}),[]),f=(0,i().IS)((t=>({container:{...e.buttonStyles,display:"flex",alignItems:"center",gap:4},iconButton:{height:20,width:20,padding:2},legacyButton:{...e.buttonStyles,display:"inline-block",fontSize:12,color:t.text.tertiary,padding:4,cursor:"pointer",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",userSelect:"none",height:"inherit",alignContent:"center"}})),[e.buttonStyles]);return(0,D.jsxs)(D.Fragment,{children:[h?(0,D.jsxs)("div",{style:f.container,children:[(0,D.jsx)(m().A,{placement:"top",renderTooltip:()=>(0,D.jsx)("div",{children:t.formatMessage({id:"search.feedback.tooltip.good",defaultMessage:"Useful results"})}),render:e=>(0,D.jsx)(p().A,{...e,onClick:()=>g("thumbsUp"),icon:l().r,ariaLabel:t.formatMessage({id:"search.feedback.thumbsUp",defaultMessage:"Search was helpful"}),style:f.iconButton})}),(0,D.jsx)(m().A,{placement:"top",renderTooltip:()=>(0,D.jsx)("div",{children:t.formatMessage({id:"search.feedback.tooltip.bad",defaultMessage:"Not useful results"})}),render:e=>(0,D.jsx)(p().A,{...e,onClick:()=>g("thumbsDown"),icon:s()._,ariaLabel:t.formatMessage({id:"search.feedback.thumbsDown",defaultMessage:"Search was not helpful"}),style:f.iconButton})})]}):(0,D.jsx)(a().A,{size:"lg",style:f.legacyButton,onClick:()=>g("thumbsDown"),children:t.formatMessage({defaultMessage:"Give search feedback",id:"search.header.badSearch.button.label"})}),n?(0,D.jsx)(F,{source:e.source,localResults:e.localResults,serverResults:e.serverResults,debugInfo:e.debugInfo,exposedSearchExperiments:e.exposedSearchExperiments,reportBadSearchInputRequest:e.reportBadSearchInputRequest}):void 0]})}},943290:(e,t,n)=>{n.d(t,{BL:()=>p,BP:()=>m,Wd:()=>u,Wu:()=>T,iL:()=>x,j_:()=>M,qT:()=>c,s2:()=>C,wF:()=>w});n(16280),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(672577),n(430670),n(803949),n(581454);var r=n.n(n(794148)),o=()=>n(99895),i=()=>n(496603),a=()=>n(534177),s=()=>n(795727),l=()=>n(252050),d=()=>n(691309);function c(e){return e.flatMap((e=>"removedPage"===e.type||e.didCreatePage?e.operationIds:e.groupedEdits.flatMap((e=>e.operationIds))))}function u(e){return!p(e)}function p(e){return!("updatedPage"!==e.type||!e.didCreatePage)}function m(e){return"updatedPage"===e.type}class h{constructor(){this.parentToChildIndexMap=new(o().G)((e=>{if("database-views"===e.tagName)return new Map;const t=new Map;return e.children.forEach(((e,n)=>t.set(e.attributes.id,n))),t})),this.blockIdMap=new Map}getIndexInParentForBlock(e){return this.blockIdMap.set(e.attributes.id,e),(e.parent&&this.parentToChildIndexMap.get(e.parent).get(e.attributes.id))??0}getIndexInParentForBlockId(e){const t=this.blockIdMap.get(e);return t?this.getIndexInParentForBlock(t):0}}const g=["insertedBlocks","updatedBlocks"];function f(e){const{groupedEditType:t,group:n,block:r,executableOperation:o,blockIndexFinder:i}=e,s=r.parent?[r.parent.attributes.id,i.getIndexInParentForBlock(r)]:[void 0,0],l=n.groupedEditsByType[t].blocksByParent.get(s);"insertedBlocks"===t?n.groupedEditsByType[t].blocksByParent.set(s,{editId:r.attributes.id,type:t,blockIds:new Set([r.attributes.id,...(null==l?void 0:l.blockIds)??[]]),operationIds:[...(null==l?void 0:l.operationIds)??[],o.id]}):"updatedBlocks"===t?n.groupedEditsByType[t].blocksByParent.set(s,{editId:r.attributes.id,type:t,blockIds:new Set([r.attributes.id]),operationIds:[...(null==l?void 0:l.operationIds)??[],o.id]}):(0,a().HB)(t)}function y(e){const{group:t,block:n,executableOperation:r}=e,o=t.groupedEditsByType.removedBlocks;t.groupedEditsByType.removedBlocks={type:"removedBlocks",blockIds:new Set([...(null==o?void 0:o.blockIds)??[],n.attributes.id]),editId:(null==o?void 0:o.editId)??n.attributes.id,operationIds:[...(null==o?void 0:o.operationIds)??[],r.id]}}function v(e){const{group:t,executableOperation:n}=e;t.groupedEditsByType.updatedTitle={editId:`${t.pageId}.title`,type:"updatedTitle",blockId:t.pageId,operationIds:[n.id]}}function b(e){const{group:t,names:n,executableOperation:r}=e;0!==n.length&&t.groupedEditsByType.updatedProperties.push({editId:`${t.pageId}.properties`,type:"updatedProperties",propertyNames:new Set(n),operationIds:[r.id]})}function x(e){const t=new h,n=new(o().G)((e=>({type:"updatedPage",pageId:e,didCreatePage:!1,updatedTitle:!1,updatedPropertyNames:new Set,insertedBlockIds:new Set,updatedBlockIds:new Set,removedBlockIds:new Set,groupedEditsByType:{insertedBlocks:{blocksByParent:new(s().A)},removedBlocks:void 0,updatedBlocks:{blocksByParent:new(s().A)},updatedProperties:[],updatedTitle:void 0},extraOperationIds:[]}))),c=new(o().G)((e=>({type:"removedPage",pageId:e,operationIds:[]}))),{rootOperations:u,descendantOperationsMap:m,movedBlocks:x}=function(e){const t=new Map,n=new Set,r=new Set;for(const o of e){const e=w(o);t.set(e.attributes.id,e),"createBlock"===o.command||"insertBlockAfter"===o.command||"insertBlockBefore"===o.command||"setBlockProperty"===o.command||"setBlockText"===o.command||"setBlockAttribute"===o.command||"setBlockParent"===o.command?n.add(e.attributes.id):"moveBlock"===o.command&&r.add(e.attributes.id)}const i=[],a=new(o().G)((e=>[]));for(const o of e){const e=w(o),r=k(e).slice().reverse().find((e=>t.get(e.attributes.id)));r?a.get(r.attributes.id).push({...o}):"removeBlock"===o.command&&n.has(e.attributes.id)?a.get(e.attributes.id).push(o):i.push(o)}return{rootOperations:i,descendantOperationsMap:a,movedBlocks:r}}(e);for(const r of u){const e=w(r);if("moveBlock"===r.command||x.has(e.attributes.id)){const o=S(n,e);o.updatedBlockIds.add(e.attributes.id),f({groupedEditType:"updatedBlocks",group:o,block:e,executableOperation:r,blockIndexFinder:t})}else if("createBlock"===r.command||"insertBlockAfter"===r.command||"insertBlockBefore"===r.command){const o=[];for(const t of e.children)o.push(t.attributes.id);const i=Object.values(e.properties).filter((e=>"property-title"!==e.tagName)).map((e=>e.attributes.name));if(I(e)){const a=n.get((0,d().So)(e.attributes.id));a.didCreatePage=!0,i.forEach((e=>a.updatedPropertyNames.add(e))),o.forEach((e=>a.insertedBlockIds.add(e))),e.children.forEach((e=>{(0,l().gc)(e)||f({groupedEditType:"insertedBlocks",group:a,block:e,executableOperation:r,blockIndexFinder:t})})),(0,l().gc)(e)||f({groupedEditType:"insertedBlocks",group:a,block:e,executableOperation:r,blockIndexFinder:t}),b({group:a,names:i,executableOperation:r})}else{const o=S(n,e);o.insertedBlockIds.add(e.attributes.id),f({groupedEditType:"insertedBlocks",group:o,block:e,executableOperation:r,blockIndexFinder:t})}}else if("setBlockParent"===r.command){f({groupedEditType:"insertedBlocks",group:n.get(r.blockNode.attributes.id),block:r.blockNode,executableOperation:r,blockIndexFinder:t})}else if("removeBlock"===r.command)if(I(r.removeBlockNode)){c.get((0,d().So)(r.removeBlockNode.attributes.id)).operationIds.push(r.id)}else{const t=S(n,e);t.removedBlockIds.add(e.attributes.id),y({group:t,block:e,executableOperation:r})}else if("setBlockAttribute"===r.command||"setBlockTagName"===r.command||"setBlockText"===r.command||"setBlockProperty"===r.command||"insertOrMoveTableColumns"===r.command||"addBlockToPage"===r.command||"removeTableColumn"===r.command)if(I(r.blockNode)){const e=n.get((0,d().So)(r.blockNode.attributes.id)),t="setBlockText"===r.command;t&&(e.updatedTitle=!0);const o="setBlockProperty"===r.command?r.property.attributes.name:void 0;o&&e.updatedPropertyNames.add(o),t||"Title"===o?v({group:e,executableOperation:r}):o&&b({group:e,names:[o],executableOperation:r}),"addBlockToPage"===r.command&&(e.extraOperationIds.push(r.id),e.didCreatePage=!0)}else{const o=S(n,e);o.updatedBlockIds.add(r.blockNode.attributes.id),f({groupedEditType:"updatedBlocks",group:o,block:r.blockNode,executableOperation:r,blockIndexFinder:t})}else(0,a().HB)(r)}const T=[...n.entries()].map((([e,n])=>{if(!c.has(e)){if(n.didCreatePage)return function(e){var t,n;const{updatedPageGroup:o,descendantOperationsMap:a}=e;r()(o.didCreatePage);const{extraOperationIds:s,didCreatePage:l,groupedEditsByType:d,...c}=o;return{didCreatePage:!0,...c,operationIds:i().sb([...d.insertedBlocks.blocksByParent.valuesArray().flatMap((e=>e.operationIds)),...d.updatedBlocks.blocksByParent.valuesArray().flatMap((e=>e.operationIds)),...(null===(t=d.removedBlocks)||void 0===t?void 0:t.operationIds)??[],...(null===(n=d.updatedTitle)||void 0===n?void 0:n.operationIds)??[],...d.updatedProperties.flatMap((e=>e.operationIds)),...s,...[...a.values()].flat().map((e=>e.id))])}}({updatedPageGroup:n,descendantOperationsMap:m});{const e=function(e){const{updatedPageGroup:t,blockIndexFinder:n}=e;if(r()(!t.didCreatePage),t.extraOperationIds.length>0)throw new Error("Non page create update group contained unaccounted-for operations");const{groupedEditsByType:o,didCreatePage:s,extraOperationIds:l,...d}=t,c=[],{updatedProperties:u,updatedTitle:p}=o;p&&c.push(p);u.length>0&&c.push({type:"updatedProperties",editId:u[0].editId,operationIds:u.flatMap((e=>e.operationIds)),propertyNames:new Set(u.flatMap((e=>[...e.propertyNames])))});for(const r of g){const e=o[r].blocksByParent,t=[];for(;e.size>0;){const n=[e.keys().next().value],r=e.get(n[0]);for(t.push(r);e.size>0&&n.length>0;){const t=n.shift(),o=e.get(t);o&&(e.delete(t),r.operationIds.push(...o.operationIds),o.blockIds.forEach((e=>r.blockIds.add(e))),n.push([t[0],t[1]-1],[t[0],t[1]+1]))}}c.push(...t)}o.removedBlocks&&c.push(o.removedBlocks);for(const r of c){if((0,a().Xk)(g,r.type))if("insertedBlocks"===r.type||"updatedBlocks"===r.type){const e=i().Ul([...r.blockIds],(e=>n.getIndexInParentForBlockId(e)));r.blockIds=new Set(e)}else(0,a().HB)(r.type);r.operationIds=i().sb(r.operationIds)}return{didCreatePage:!1,...d,groupedEdits:c}}({updatedPageGroup:n,blockIndexFinder:t});return function(e){const{rootUpdatedPageGroup:t,descendantOperationsMap:n}=e;for(const r of t.groupedEdits)if("insertedBlocks"===r.type||"updatedBlocks"===r.type||"removedBlocks"===r.type)for(const e of r.blockIds){const o=n.get(e);for(const e of o)r.operationIds.push(e.id),"removeBlock"===e.command&&t.removedBlockIds.add(e.removeBlockNode.attributes.id)}return t}({rootUpdatedPageGroup:e,descendantOperationsMap:m})}}})).filter(a().O9),M=function(e){const{allGroups:t,rootOperations:n}=e,r=e=>{const{pageId:t}=e,r=n.find((e=>w(e).attributes.id===t)),o=r&&w(r),i=null==o?void 0:o.parent;return o&&i?i.children.findIndex((e=>e.attributes.id===t)):-1},o=t.slice().sort(((e,t)=>p(e)&&p(t)?r(e)-r(t):0));return o}({allGroups:[...T,...c.values()],rootOperations:u});return M}function S(e,t){const n=function(e){let t=e;for(;t;){if(I(t))return t;t=t.parent}}(t);if(!n)throw new Error(`No ancestor page found for block: ${t.attributes.id}`);return e.get(n.attributes.id)}function w(e){return"removeBlock"===e.command?e.removeBlockNode:"insertBlockAfter"===e.command||"insertBlockBefore"===e.command?e.insertBlockNode:e.blockNode}function k(e){let t=null==e?void 0:e.parent;const n=[];for(;t;){if(I(t))return n;n.push(t),t=t.parent}return n}function I(e){return"page"===e.tagName||"database"===e.tagName||"child-page"===e.tagName||"child-database"===e.tagName}function T(e){let t=0;for(const n of e)if("updatedPage"===n.type)t+=n.didCreatePage?1:n.groupedEdits.length;else{if("removedPage"!==n.type)return(0,a().HB)(n);t+=1}return t}function M(e){const{insertedBlockIds:t,updatedBlockIds:n,removedBlockIds:r,updatedTitle:o,updatedPropertyNames:i}=e;return t.size+n.size+r.size+(o?1:0)+i.size}function C(e){const{updatedPageGroups:t,executableOperations:n}=e,r=new Map;for(const i of n)r.set(i.id,{block:w(i),operation:i});const o=new Map;for(const i of t)if(i.didCreatePage)o.set(i.pageId,[i,void 0]);else{o.set(i.pageId,[i,void 0]);for(const e of i.groupedEdits)if("insertedBlocks"===e.type||"updatedBlocks"===e.type||"removedBlocks"===e.type)for(const t of e.operationIds){const n=r.get(t);if(n){const{block:t}=n;o.set(t.attributes.id,[i,e])}}}return{blockIdToPageGroupAndEdit:o}}},957046:(e,t,n)=>{n.d(t,{T:()=>d});var r=()=>n(484714),o=()=>n(56366),i=()=>n(985529),a=()=>n(401176),s=()=>n(329304),l=()=>n(921738);function d(e){const{query:t,searchSessionId:n}=e,d=(0,r().v3)(),c=(0,o().K8)((()=>a().aU()),[]),u=(0,s()._X)({name:"ai_usage",amount:1,spaceId:c??void 0,userId:d.currentUser.id}),p=(0,o().K8)((()=>(0,i().e2)(u)),[u]),{variant:m,isNaturalLanguageQuery:h}=(0,l().O)({query:t,searchSessionId:n});return{isNaturalLanguageQueryWithCredits:h&&p,aiSearchResultItemVariant:m,aiUsageAvailability:u,hasCreditsForAiUsage:p}}},968579:(e,t,n)=>{n.d(t,{Dk:()=>M,F6:()=>g,GC:()=>m,Km:()=>I,Lh:()=>S,Nm:()=>b,Or:()=>T,Uj:()=>y,Ut:()=>k,Wg:()=>C,XO:()=>d,aD:()=>w,d5:()=>v,dR:()=>p,lM:()=>x,w2:()=>h,xw:()=>f,yX:()=>c,zD:()=>u});n(16280),n(581454);var r=()=>n(973647),o=()=>n(902006),i=()=>n(251582),a=()=>n(832443),s=()=>n(252050),l=()=>n(331119);function d(e){return i().p.map((0,l().RB)({tagName:"load-page",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"observation",tagName:"load-page",attributes:e})))}function c(e){return i().p.map((0,l().RB)({tagName:"load-slack",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"observation",tagName:"load-slack",attributes:e})))}function u(e){return i().p.map((0,l().RB)({tagName:"load-google-drive",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"observation",tagName:"load-google-drive",attributes:e})))}function p(e){return i().p.map((0,l().RB)({tagName:"load-github",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"observation",tagName:"load-github",attributes:e})))}function m(e){return i().p.map((0,l().RB)({tagName:"load-github-code",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"observation",tagName:"load-github-code",attributes:e})))}function h(e){return i().p.map((0,l().RB)({tagName:"load-jira",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"observation",tagName:"load-jira",attributes:e})))}function g(e){return i().p.map((0,l().RB)({tagName:"load-linear",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"observation",tagName:"load-linear",attributes:e})))}function f(e){return i().p.map((0,l().RB)({tagName:"load-box",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"observation",tagName:"load-box",attributes:e})))}function y(e){return i().p.map((0,l().RB)({tagName:"load-microsoft-teams",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"observation",tagName:"load-microsoft-teams",attributes:e})))}function v(e){return i().p.map((0,l().RB)({tagName:"load-sharepoint",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"observation",tagName:"load-sharepoint",attributes:e})))}function b(e){return i().p.map((0,l().RB)({tagName:"load-web-page",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"observation",tagName:"load-web-page",attributes:e})))}function x(e){return i().p.map((0,l().RB)({tagName:"load-attachment",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"attachment_id_counter"},attachmentType:{required:!0,values:["pdf"]}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"observation",tagName:"load-attachment",attributes:e})))}function S(e){return i().p.map((0,l().RB)({tagName:"load-database",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"collection_counter"}},mapCounterToKey:e.mapCounterToKey}),(({attributes:e})=>({type:"observation",tagName:"load-database",attributes:e})))}function w(e){return i().p.mapResult((0,l().U5)("load"),(t=>{const n=(0,l().x3)(t);if(r().Q.isFail(n))return n;const{id:i,...s}=t.attributes;if(void 0===i)return{error:new Error("<load> must have an 'id' attribute")};if(Object.keys(s).length>0)return{error:new Error("<load> cannot have any attributes other than 'id'")};const{mapCounterToKey:d}=e;if(!d)return{error:new Error("mapCounterToKey is required")};const c=a().tD.mapCounterToKeyInMode({mapCounterToKey:d},i,"block_counter","load");if(!c.error)return{value:{type:"observation",tagName:"load-page",attributes:{id:c.value}}};const u=a().tD.mapCounterToKeyInMode({mapCounterToKey:d},i,"collection_counter","load");if(!u.error)return{value:{type:"observation",tagName:"load-database",attributes:{id:u.value}}};const p=a().tD.mapCounterToKeyInMode({mapCounterToKey:d},i,"external_id_counter","load");if(!p.error){const e=(0,o().Tq)(p.value);if("web"===e)return{value:{type:"observation",tagName:"load-web-page",attributes:{id:p.value}}};if("slack"===e)return{value:{type:"observation",tagName:"load-slack",attributes:{id:(0,o().V9)(p.value)}}};if("google-drive"===e)return{value:{type:"observation",tagName:"load-google-drive",attributes:{id:(0,o().V9)(p.value)}}};if("github"===e)return{value:{type:"observation",tagName:"load-github",attributes:{id:(0,o().V9)(p.value)}}};if("githubCode"===e)return{value:{type:"observation",tagName:"load-github-code",attributes:{id:(0,o().V9)(p.value)}}};if("jira"===e)return{value:{type:"observation",tagName:"load-jira",attributes:{id:(0,o().V9)(p.value)}}};if("linear"===e)return{value:{type:"observation",tagName:"load-linear",attributes:{id:(0,o().V9)(p.value)}}};if("box"===e)return{value:{type:"observation",tagName:"load-box",attributes:{id:(0,o().V9)(p.value)}}};if("microsoft-teams"===e)return{value:{type:"observation",tagName:"load-microsoft-teams",attributes:{id:p.value}}};if("sharepoint"===e)return{value:{type:"observation",tagName:"load-sharepoint",attributes:{id:p.value}}}}return{error:new Error(`<load> with id ${i} could must be either a block or database ID.`)}}))}const k=[...["notion","onedrive",...o().fl],"web"],I=["document","spreadsheets","presentation","pdf","message","chat","thread","pull-request","code","issue","task","ticket","email","project"],T=i().p.map((0,l().RB)({tagName:"search",attributeDefinitions:{question:{required:!0,values:!0},keywords:{required:!0,values:!0},lookback:{required:!1,values:!0},"question-intl":{required:!1,values:!0},channel:{required:!1,values:!0},source:{required:!1,values:!0},sort:{required:!1,values:["latest"]},database:{required:!1,values:!0},"file-type":{required:!1,values:I},repo:{required:!1,values:!0},[s().HV]:{required:!1,values:["true"]},contributor:{required:!1,values:!0}},mapCounterToKey:void 0}),(({attributes:e})=>({type:"observation",tagName:"search",attributes:e}))),M=(i().p.map((0,l().RB)({tagName:"search",attributeDefinitions:{question:{required:!1,values:!0},keywords:{required:!0,values:!0},lookback:{required:!1,values:!0},"question-intl":{required:!1,values:!0},channel:{required:!1,values:!0},source:{required:!1,values:!0},sort:{required:!1,values:["latest"]},database:{required:!1,values:!0},"file-type":{required:!1,values:I},repo:{required:!1,values:!0},[s().HV]:{required:!1,values:["true"]},contributor:{required:!1,values:!0}},mapCounterToKey:void 0}),(({attributes:e})=>({type:"observation",tagName:"search",attributes:e}))),i().p.map((0,l().RB)({tagName:"search-people",attributeDefinitions:{search:{required:!0,values:!0}},mapCounterToKey:void 0}),(({attributes:e})=>({type:"observation",tagName:"search-people",attributes:e})))),C=i().p.map((0,l().RB)({tagName:"search-databases",attributeDefinitions:{search:{required:!0,values:!0}},mapCounterToKey:void 0}),(({attributes:e})=>({type:"observation",tagName:"search-databases",attributes:e})))},968610:(e,t,n)=>{n.r(t),n.d(t,{arrowTurnDownLeftFillSmallIcon:()=>o,iconDefinition:()=>r});n(296540);const r={viewBox:"0 0 16 16",fittedViewBox:"1.45 3.05 12.3 10.24",directional:!0,svg:(0,n(474848).jsx)("path",{d:"M12.25 3.8a.75.75 0 0 1 1.5 0v4a1.95 1.95 0 0 1-1.95 1.95H4.01l2.24 2.24a.75.75 0 1 1-1.06 1.06L1.67 9.53a.75.75 0 0 1 0-1.06l3.52-3.52a.75.75 0 0 1 1.06 1.06L4.01 8.25h7.79a.45.45 0 0 0 .45-.45z"})},o=(0,n(340498).wt)("arrowTurnDownLeftFillSmall",r)},974779:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_MODAL_WIDTH_WITH_SIDE_PEEK:()=>me,INACTIVE_TIMEOUT_MS:()=>ce,Search:()=>he,SearchStaticContext:()=>ue,SearchStoresContext:()=>pe,getSearchResultMetadata:()=>fe});n(944114),n(898992),n(803949),n(581454);var r=n(296540),o=()=>n(20022),i=()=>n(17022),a=()=>n(381175),s=()=>n(908006),l=()=>n(484714),d=()=>n(852507),c=()=>n(118884),u=()=>n(56366),p=()=>n(401497),m=()=>n(584262),h=()=>n(282834),g=()=>n(620333),f=()=>n(69708),y=()=>n(534177),v=()=>n(222917),b=()=>n(46497),x=()=>n(450294),S=()=>n(44551);function w(){var e;null===S().electronApi||void 0===S().electronApi||null===(e=S().electronApi.quickSearchReady)||void 0===e||e.call(S().electronApi)}var k=()=>n(70268),I=()=>n(135669),T=()=>n(260488),M=()=>n(277942),C=()=>n(650829),j=()=>n(677590),A=()=>n(631611),B=()=>n(518736),N=()=>n(38337),_=()=>n(227894),R=()=>n(422366),P=()=>n(71304),E=()=>n(780865),D=()=>n(548648),O=()=>n(470928),F=()=>n(346923),q=()=>n(941541),L=()=>n(406792),K=()=>n(109054),U=()=>n(770906),V=()=>n(869562),z=()=>n(765957),H=()=>n(430483),W=()=>n(288466),$=()=>n(295169),G=()=>n(982254),Q=()=>n(793765),X=()=>n(899677),Y=()=>n(245241),Z=()=>n(250484);class J extends(()=>n(757695))().Store{getInitialState(){return{queryBasedActionResults:void 0,fixedActionResults:void 0,localResults:void 0,serverResultsLoading:!1,serverResults:void 0,serverEventProperties:void 0,serverResultsAllLoaded:!1,errorState:ee,selectedQueryResultQuery:void 0,timesToRender:new Map,focusedIndex:void 0}}setState(e){const t={...this.instanceState};if(!(0,n(821062).A)(this.instanceState,t))return;const r=function(e){const{newState:t,priorState:n}=e,{localResults:r,serverError:o,serverResultsLoading:i,serverResults:a}=t,s=Boolean(r),l=i?void 0:o;if(!s&&i)return!n.errorState.isLoading&&n.errorState.showMajorError?n.errorState:{isLoading:i};if(s)return{hasLocalResults:s,serverError:l,isLoading:!1,showMajorError:!1};if(l)return{hasLocalResults:s,serverError:l,isLoading:!1,showMajorError:!0};if(0===(null==a?void 0:a.results.length))return{hasLocalResults:s,serverError:Y().yq.NoResults,isLoading:!1,showMajorError:!0};return{hasLocalResults:s,serverError:l,isLoading:!1,showMajorError:!1}}({newState:e,priorState:t});super.setState({...e,errorState:r})}endTimeToRenderServerResultsTiming(e){this.state.timeToRenderServerResultsMetric&&(L().default.measure(this.state.timeToRenderServerResultsMetric.eventName,{environment:e,data:{query_length:this.state.timeToRenderServerResultsMetric.query_length,source:this.state.timeToRenderServerResultsMetric.source,search_session_id:this.state.timeToRenderServerResultsMetric.search_session_id}}),this.update((e=>({...e,timeToRenderServerResultsMetric:void 0}))))}getResultCount(){const{serverResults:e,localResults:t}=this.state,n=(null==e?void 0:e.total)??(null==t?void 0:t.total)??0,r=Boolean(e&&n>=100);return{count:n,isLowerBound:Boolean(e&&t&&n<Z().ZK)||r}}}const ee={showMajorError:!1,isLoading:!1,hasLocalResults:!1,serverError:void 0};const te=J;var ne=()=>n(498719),re=()=>n(543491),oe=()=>n(433876),ie=()=>n(500251),ae=()=>n(792751),se=()=>n(913441),le=n(474848);const de=50,ce=120*n(720665).TD,ue=r.createContext(null);ue.displayName="SearchStaticContext";const pe=r.createContext(null);pe.displayName="SearchStoresContext";const me=755;function he(e){var t;const n=(0,l().v3)(),[i,M]=(0,r.useState)(),A=(0,r.useRef)(),N=(0,r.useRef)(),_=(0,r.useRef)(!0),R=(0,u().K8)((()=>Boolean(X().default.state.open||X().default.state.openAsPage)),[],{debugName:"isOpen"}),Y=(0,r.useRef)(null),J=(0,r.useRef)(null),ee=(0,r.useRef)(null),ae=(0,u().K8)((()=>new te),[],{debugName:"searchResultStore"}),ue=(0,u().K8)((()=>new te),[],{debugName:"secondarySearchResultStore"}),pe=(0,u().K8)((()=>Z().Ay.state.query),[]),he=pe.text.trim(),Se=(0,F().l)(pe.filters),we=(0,u().K8)((()=>E().SC(Se)),[Se],{debugName:"hasActiveFilterOtherThanTitleOnly"}),ke=(0,u().K8)((()=>Boolean(he.trim())||we),[we,he],{debugName:"hasQuery"}),{isDebugSidebarOpen:Ie,isSidePeekPanelOpen:Te,mode:Me}=(0,u().K8)((()=>({isDebugSidebarOpen:Z().Ay.state.isDebugSidebarOpen,isSidePeekPanelOpen:Z().Ay.state.isSidePeekPanelOpen,mode:Z().Ay.state.mode})),[]),Ce=(0,u().K8)((()=>ae.state.localResults),[ae]),je=(0,u().K8)((()=>{var e;return(null===(e=ae.state.serverResults)||void 0===e?void 0:e.results)??[]}),[ae]),Ae=(0,r.useMemo)((()=>(null==Ce?void 0:Ce.results)??[]),[null==Ce?void 0:Ce.results]),Be=(0,r.useMemo)((()=>Ae.length),[Ae]),Ne=(0,r.useMemo)((()=>(null==Ce?void 0:Ce.total)??0),[null==Ce?void 0:Ce.total]),_e=(0,u().K8)((()=>(ae.state.fixedActionResults??[]).length),[ae],{debugName:"numberOfFixedActionResults"}),Re=(0,u().K8)((()=>(ae.state.queryBasedActionResults??[]).length),[ae],{debugName:"numberOfQueryBasedActionResults"}),Pe=(0,u().K8)((()=>{var e;return(null===(e=ae.state.localResults)||void 0===e?void 0:e.totalResultIds)??[]}),[ae],{debugName:"totalLocalResultIds"}),Ee=(0,u().K8)((()=>{var e;return(null===(e=ae.state.localResults)||void 0===e?void 0:e.allMatchingResultIds)??[]}),[ae],{debugName:"allMatchingResultIds"}),De=_e+Re,Oe=(0,r.useCallback)((()=>E().rp({environment:n,searchResultsSection:Y.current,modalBodyMenu:ee.current,searchFilterMenu:J.current,actionItemCount:De})),[De,n]),Fe=(0,u().K8)((()=>ae.state.timesToRender),[ae],{debugName:"timesToRender"}),qe=(0,u().K8)((()=>X().default.state.sessionId),[]),Le=(0,u().K8)((()=>X().default.state.openedTimeMs),[]),Ke=(0,u().K8)((()=>Z().Ay.state.hasScrolled),[]),{numKeystrokes:Ue,numServerRequests:Ve,firstKeyStrokeTimeMs:ze,numLocalRequests:He}=(0,u().K8)((()=>({numKeystrokes:ne().default.state.numKeystrokes,numServerRequests:ne().default.state.numServerRequests,numLocalRequests:ne().default.state.numLocalRequests,firstKeyStrokeTimeMs:ne().default.state.firstKeyStrokeTimeMs})),[]),We=(0,u().K8)((()=>ne().default.state.hadMetaClick),[]),$e=(0,u().K8)((()=>(0,E().yu)({localResults:Ae,serverResults:je})),[Ae,je]),Ge=(0,u().K8)((()=>null==$e?void 0:$e.length),[$e]),Qe=(0,f().tz)(),Xe=(0,r.useCallback)((e=>{const{selectedResult:t,index:r,fromSidePeekPanel:o,context:i,openedTimeMs:a,additionalResultsCount:s}=e,{serverEventProperties:l,store:d}=t,c=Date.now(),u=(0,P().Qe)(t.store,Qe,n,!1),p=(0,K().uv)({query:he,resultText:u??"",isLastQueryTermPartialMatchOK:!1}),m=z().default.state.sidebarSpaceStore,g=Boolean(null==m?void 0:m.getSettings().enable_ai_training),f=null!=m&&m.id?(0,D().X)({environment:n,spaceId:null==m?void 0:m.id})??1:1;return{...l,queryText:l&&l["server-query"]&&l["server-query"].query?l["server-query"].query:he,context:i,queryStringLength:he.length,numQueryTokens:h().qw(he).length,hasFilters:E().J3(Se),activeFilters:Se,selectedItemIndex:r.global-(De+(s??0)),selectedItemLocalIndex:{section:r.local.section,index:r.local.indexLocal},numKeystrokes:Ue,fromSidePeekPanel:o,isSidePeekPanelOpen:Te,isSidebarOpen:Ie,timeToSelectMs:c-a,timeFromFirstKeyStrokeToSelectMs:ze?c-ze:c-a,sources:null==t?void 0:t.sources,localSources:[...(null==t?void 0:t.localSource)??[]],hadMetaClick:We,numResultsAboveFold:Oe(),selectedSearchResultMetadata:fe(t,Ee),selectedSearchResultContent:void 0,allSearchResultMetadata:null==$e?void 0:$e.slice(0,de).map((e=>fe(e))),totalSearchResultCount:Ge,searchSessionId:qe,aiSessionId:void 0,traceId:void 0,searchSessionFlowNumber:Ve,originalPosition:null==t?void 0:t.originalPosition,numLocalResults:Be,numTotalLocalResults:Ne,totalLocalResultIds:Pe,numVisibleMembers:f,isMobile:n.device.isMobile,timeToRenderResult:Fe.get(d.id),hasScrolled:Ke,verificationState:(0,O().i1)(t.store),searchSource:"quick_find",isTitleMatch:p,queryIfLeap:g?he:void 0}}),[Qe,n,he,Se,De,Ue,Te,Ie,ze,We,Oe,$e,Ge,qe,Ve,Be,Ne,Pe,Fe,Ke,Ee]),Ye=(0,r.useCallback)((({index:e,context:t,selectedResult:r,fromSidePeekPanel:o,source:i,additionalResultsCount:a})=>{R&&qe&&Le&&v().yN(n,{...Xe({index:e,context:t,selectedResult:r,fromSidePeekPanel:o,openedTimeMs:Le,additionalResultsCount:a}),source:i,searchSessionId:qe})}),[Xe,n,R,Le,qe]),Ze=(0,r.useCallback)((()=>{if(!R)return;clearTimeout(A.current),Z().Ay.update((e=>({...e,hasScrolled:!1})));const e=_.current?"search_modal_first_open_lag":"search_modal_open_lag";_.current&&(_.current=!1),L().default.mark(e)}),[R]),Je=(0,u().K8)((()=>"chat"===n.RouterStore.state.route.name),[n.RouterStore]),et=(0,r.useCallback)((()=>{T().Yc({resultStore:ae,secondaryResultStore:ue}),e.quickSearchMode?(X().default.closeAndResetMetricsState(),Je||(0,j().U)({environment:n,useCrdt:(0,B().D8)(z().default.state.sidebarSpaceStore)})):X().default.reset()}),[n,Je,e.quickSearchMode,ae,ue]),tt=(0,u().K8)((()=>ae.state.serverEventProperties),[ae]),nt=(0,r.useCallback)((t=>{var r;const{device:o}=n,{selectedQueryResult:i}=ne().default.state,a=null!==(r=z().default.state.sidebarSpaceStore)&&void 0!==r&&r.id?(0,D().X)({environment:n,spaceId:z().default.state.sidebarSpaceStore.id})??1:1;if(Ue>0&&(Ve>0||He>0)&&!i&&!We&&qe&&Le&&R){const e=Date.now(),t=e-Le;v().mG(n,{...tt,timeToAbandonMs:t,timeFromFirstKeyStrokeToAbandonMs:ze?e-ze:void 0,numKeystrokes:Ue,numResultsAboveFold:Oe(),searchSessionId:qe,searchSessionFlowNumber:Ve,hasScrolled:Ke,numLocalResults:Be,numTotalLocalResults:Ne,numVisibleMembers:a,isMobile:o.isMobile}),T().jd({environment:n,query:he})}"assistant"===Me&&"keydown"===(null==t?void 0:t.type)?(Z().Ay.switchToSearchPane(),(0,k().f)(!1)):e.quickSearchMode?(X().default.closeAndResetMetricsState(),ne().default.reset(),i&&!We&&et(),(0,b().y)()):(T().st({environment:n,reset:!1}),ae.update((e=>({...e,universalResults:void 0,currentlySelectedUniversalSearchResultView:void 0})))),"assistant"===Me&&W().O.setAssistantLastViewedTime(),""===he&&"assistant"!==Me&&Z().Ay.reset(),A.current&&clearTimeout(A.current),A.current=window.setTimeout(et,ce),!e.quickSearchMode&&o.isMobile&&V().close(),U().VI({environment:n,skipAnimation:!0}),ne().default.reset()}),[ae,n,Ue,Ve,He,We,qe,Le,R,Me,e.quickSearchMode,he,tt,ze,Oe,Ke,Be,Ne,et]),rt=(0,u().K8)((()=>$().default.getActiveSessionId()),[]),ot=(0,u().K8)((()=>{if(rt)return $().default.getSessionContext(rt)}),[rt]),it=(0,r.useCallback)(((t,r,o,i)=>{if(!e.quickSearchMode)return;const a=q().Ay;if("stopQueueingSubscriptions"in a&&a.stopQueueingSubscriptions(n),r){let e;e="tray-icon"===o?"quick-search-tray-icon":"shortcut"===o?"quick-search-shortcut":"debug-menu"===o?"quick-search-debug-menu":"quick-search";const t=("search"===Me&&i||"assistant"===Me&&!i)&&!(!R&&r);i&&H().zD.shouldShowSearchMenuItemAskAI()?T().sv({environment:n,quickSearchMode:!0,from:t?"command_search_switching_panes":"command_search_shortcut",device:n.device}):!0!==i&&(Z().Ay.update((e=>({...e,mode:"search"}))),t&&(e="command_search_switching_panes",rt&&C().assistantDependency.load().then((({assistantAnalyticsActions:e})=>{e.trackAssistantClosed(n,{from:"command_search_switching_panes",sessionContext:ot})})))),T()._N({environment:n,analyticsFrom:e,isQuickSearch:!0,doNotTrackOpenSearchEvent:i}),s().default.afterNextFlush((()=>{var e;null===S().electronApi||void 0===S().electronApi||null===(e=S().electronApi.quickSearchRenderCompleted)||void 0===e||e.call(S().electronApi)}))}else nt()}),[ot,rt,n,nt,R,Me,e.quickSearchMode]),at=(0,r.useCallback)((t=>{e.quickSearchMode&&nt()}),[nt,e.quickSearchMode]),st=(0,r.useCallback)((()=>{T().Yc({resultStore:ae,secondaryResultStore:ue}),e.quickSearchMode||(X().default.reset(),(0,j().U)({environment:n,useCrdt:(0,B().D8)(z().default.state.sidebarSpaceStore)}))}),[n,e.quickSearchMode,ae,ue]),lt=(0,r.useCallback)((()=>{const t=z().default.state.sidebarSpaceStore&&z().default.state.sidebarSpaceStore.id;N.current!==t&&(N.current=t,st(),N.current&&z().default.state.currentUserStore&&e.quickSearchMode&&w())}),[e.quickSearchMode,st]),dt=(0,r.useRef)(),ct=(0,r.useRef)(),ut=(0,r.useRef)(),pt=(0,r.useRef)();(0,d().l)((()=>{var t;N.current=null===(t=z().default.state.sidebarSpaceStore)||void 0===t?void 0:t.id,z().default.state.sidebarSpaceStore&&z().default.state.currentUserStore&&e.quickSearchMode&&w(),z().default.addListener(lt),X().default.addListener(Ze),e.quickSearchMode?ct.current=o().JW.addListener(it):(dt.current=o().RS.addListener((()=>xe(n,!1))),ut.current=o().lS.addListener((()=>{"chat"!==n.RouterStore.state.route.name&&xe(n,!0)}))),I().w7.addListener(at),pt.current=o().OW.addListener((()=>{T()._N({environment:n,isNewElectronTab:!0,analyticsFrom:"new-tab"})}))})),(0,c().X)((()=>{var e,t,n,r;et(),X().default.removeListener(Ze),I().w7.removeListener(at),z().default.removeListener(lt),null===(e=ct.current)||void 0===e||e.call(ct),null===(t=dt.current)||void 0===t||t.call(dt),null===(n=ut.current)||void 0===n||n.call(ut),null===(r=pt.current)||void 0===r||r.call(pt),A&&(clearTimeout(A.current),A.current=void 0)}));const mt=(0,u().K8)((()=>(0,E().iu)(G().A.state.tabs,G().A.state.currentTab.id)),[]),ht=(0,u().K8)((()=>X().default.state.isNewElectronTab),[]),gt=(0,r.useCallback)((({index:t,event:r,context:o,selectedResult:i,fromSidePeekPanel:s,additionalResultsCount:l})=>{if(!R||!Le||!qe)return;const d=z().default.state.sidebarSpaceStore,c=Boolean(null==d?void 0:d.getSettings().enable_ai_training),u=(0,a().V)(r);"query_results"===o&&(ne().default.update((e=>({...e,selectedQueryResult:!0}))),ae.update((e=>({...e,selectedQueryResultQuery:pe})))),v().bo(n,{...Xe({index:t,context:o,selectedResult:i,fromSidePeekPanel:s,openedTimeMs:Le,additionalResultsCount:l}),searchSource:"quick_find",searchSessionId:qe,isMetaClick:Boolean(u),queryIfLeap:c?he:void 0});const p=(null==tt?void 0:tt["server-queryId"])??(0,g().mk)({searchSessionId:qe,searchSessionFlowNumber:Ve});let h;if("recent_pages"===o?h=m().y8.SearchRecents:"query_results"===o?h=m().y8.SearchQuery:"tabs"===o||"new_page"===o?h=m().y8.SearchTabs:"action"===o?h=m().y8.SearchCustomAction:"offline_pages"===o?h=m().y8.SearchOfflinePages:(0,y().HB)(o),n.device.isElectron&&e.quickSearchMode){const e=(0,se().yD)({result:i,queryId:p,pageVisitSource:h,scrollToBlockId:(0,E().pV)(i)});e&&(0,x().N)(e)}else{const e=I().$f({result:i,fallbackToCustom:!1});if(!e)return;I().q9({searchResult:e,environment:n,pageVisitSource:h,queryId:p,openInNew:u,electronTabSearch:{tabs:mt,isNewTab:Boolean(ht)},context:o})}re().A.setState({queryId:p,pageId:i.store.id,timeEntered:new Date}),u?ne().default.update((e=>({...e,hadMetaClick:!0}))):nt()}),[Xe,n,nt,ht,R,Ve,Le,e.quickSearchMode,pe,ae,qe,tt,mt,he]),ft=(0,r.useMemo)((()=>({queryResultsSectionRef:Y,searchMobileFilterMenuRef:J,modalBodyMenuRef:ee,handleSelectSearchResult:gt,handleCopySearchItemLink:Ye,handleQueryChange:be,handlePopupOpen:ye,handlePopupClose:ve,searchResultStore:ae,secondarySearchResultStore:ue,defaultBodyFocusedResult:i,isQuickSearch:e.quickSearchMode,setDefaultBodyFocusedResult:M})),[i,Ye,gt,e.quickSearchMode,ae,ue]),yt=ke?"search_results":"default_body",vt=function(e){const t=(0,l().v3)(),n=(0,u().K8)((()=>(0,ie().CX)({searchContentPaneType:e,quickSearchMode:!1,environment:t})),[t,e]),r=(0,u().K8)((()=>(0,Q().I5)()?"90vw":me),[]);return(0,p().IS)((e=>({wrapper:{width:"100%",minHeight:n.minHeight,maxHeight:n.maxHeight,transform:"translate3d(0,0,0)",background:e.popoverBackground,maxWidth:r,borderRadius:12}})),[r,n]).wrapper}(yt);return e.quickSearchMode?(0,le.jsx)(ge,{searchContentPaneType:yt,quickSearchMode:e.quickSearchMode,handleComponentClose:nt,parentStore:e.parentStore,staticContext:ft}):(0,le.jsx)(oe().A,{ariaLabel:Qe.formatMessage({id:"search.modal.ariaLabel",defaultMessage:"Search Notion"}),open:R,onDismiss:nt,modalStyle:vt,modalBackgroundStyle:{background:"transparent"},modalIsWaxPaper:!0,alignItems:"stretch",disableAnimation:!n.device.isMobile||(null===(t=n.mobileNative)||void 0===t?void 0:t.supportsNativeHomeOnPhone())||!1,renderContent:()=>(0,le.jsx)(ge,{searchContentPaneType:yt,quickSearchMode:e.quickSearchMode,handleComponentClose:nt,parentStore:e.parentStore,staticContext:ft})})}function ge(e){const{searchContentPaneType:t,quickSearchMode:n,handleComponentClose:r,parentStore:o,staticContext:i}=e,a=(0,l().v3)(),s=(0,u().K8)((()=>Z().Ay.state.isPopupOpen),[]),d=(0,u().K8)((()=>Z().Ay.state.mode),[]),c=n?A().wy.commandSearch:a.device.isMobile?A().wy.mobileSearch:A().wy.searchPane;return(0,le.jsx)(ue.Provider,{value:i,children:(0,le.jsx)(pe.Provider,{value:{parentStore:o},children:(0,le.jsxs)(A().hP,{surface:c,children:[n&&!s?(0,le.jsx)("div",{style:{position:"absolute",height:ae().A,width:"100%"},className:N().sbV}):void 0,"search"===d?(0,le.jsx)(ie().sb,{quickSearchMode:n,searchContentPaneType:t,onClose:r}):(0,le.jsx)(M().Yk,{quickSearchMode:n,searchContentPaneType:t,onClose:r})]})})})}function fe(e,t){const{store:n,highlight:r,sources:o,localSource:a}=e,s=t?t.indexOf(n.id):-1;return i().e.withListenerIgnored((()=>{var t,i,l,d,c;return{blockId:n.id,blockType:n.getType(),lowestNavigableAncestorId:null===(t=n.getNavigableBlockStore())||void 0===t?void 0:t.id,depth:(0,_().g)(n).length,matchesText:Boolean(null==r?void 0:r.text),matchesPathText:Boolean((null==r?void 0:r.pathText)||(null==r?void 0:r.title)),matchesTitle:Boolean(null==r?void 0:r.title),isNavigable:n.isNavigableBlock(),lastEditedTime:n.getLastEditedTime(),isTeamArchived:null===(i=(0,R().U)(n))||void 0===i?void 0:i.isArchived(),sources:o,localSource:[...a??[]],badges:(null===(l=e.badges)||void 0===l?void 0:l.map((e=>e.type)))??[],isCollectionPropertyMatch:void 0!==(null===(d=e.matchedCollectionProperties)||void 0===d?void 0:d.collectionText),isCollectionPropertyHighlight:void 0!==(null===(c=e.highlight)||void 0===c?void 0:c.collectionText),featureGroups:e.featureGroups,allMatchingLocalResultsIndex:s>=0?s:void 0}}))}function ye(){Z().Ay.setIsAnyPopupOpen(!0)}function ve(){Z().Ay.setIsAnyPopupOpen(!1)}function be(e){""!==e?(ne().default.update((e=>({...e,numKeystrokes:e.numKeystrokes+1}))),Z().Ay.updateQueryText(e),"full-content"===X().default.state.searchMode&&X().default.update((e=>({...e,searchMode:"nav-local-only"})))):Z().Ay.resetQuery({resetFilters:!1})}function xe(e,t){t&&Z().Ay.update((e=>({...e,mode:"assistant"}))),T()._N({environment:e,analyticsFrom:"keyboard-shortcut-quick-search-hotkey",isQuickSearch:!1})}},980382:(e,t,n)=>{n.d(t,{I:()=>C});n(898992),n(354520);var r=()=>n(943290),o=()=>n(691309),i=(n(16280),n(944114),n(823215),n(672577),n(581454),n(737550),()=>n(438632));function a(e){return function(e){const{beforeString:t,afterString:n}=e,r=(0,i().PD)(t,n).filter((([e])=>e!==i().cb.same)).length;return[r>5,{numberOfDiffs:r}]}(e)[0]}var s=()=>n(700500),l=()=>n(898244),d=()=>n(795727),c=()=>n(179034),u=()=>n(201980),p=()=>n(496603),m=()=>n(534177),h=()=>n(384944),g=()=>n(319975),f=()=>n(231297),y=()=>n(696419),v=()=>n(148832);function b(e){const{blockStore:t,property:n}=e,r=t.getSchema(),o=Object.entries(r||{}).find((([e])=>e===n)),i=null==o?void 0:o[1];return i?(0,l().QP)(i):void 0}function x(e,t){const{environment:n,isIncompleteAfter:r,editId:o}=t;return(0,y().x)({environment:n,from:"assistantDiff",before:e??[],after:[],isIncompleteAfter:r,insertionAnnotation:o?[u().Ifu.Inserted,o]:[u().Ifu.Inserted],deletionAnnotation:o?[u().Ifu.Deleted,o]:[u().Ifu.Deleted]})}function S(e,t){const{environment:n,isIncompleteAfter:r,editId:o}=t;return(0,y().x)({environment:n,from:"assistantDiff",before:[],after:e??[],isIncompleteAfter:r,insertionAnnotation:o?[u().Ifu.Inserted,o]:[u().Ifu.Inserted],deletionAnnotation:o?[u().Ifu.Deleted,o]:[u().Ifu.Deleted]})}function w(e){const{environment:t,transaction:n,blockStore:r,property:o,beforePropertyValue:i,afterPropertyValue:a,editId:s,isIncompleteAfter:l,dontDisplayRemoves:c}=e,p=function(e,t){if(!e||!t)return t;const n=e=>{if(!(0,u().qXl)(e))return;const[,t]=e;return(0,u().$CJ)(t)},r=e=>[e[0],{...e[1],date_format:void 0,time_format:void 0}];if(t.every((e=>!(0,u().uPN)(e).some(u().qsB)))||e.every((e=>!(0,u().uPN)(e).some(u().qsB))))return t;const o=e.map(n).filter(m().O9),i=new(d().A);for(const a of o){const e=r(a);i.set(e,a)}return t.map((e=>{const t=(0,u().uPN)(e).map((e=>{if(!(0,u().qsB)(e))return e;const t=r(e);return i.get(t)??e}));return(0,u().Ey_)((0,u().N8A)(e),t)}))}(i,a);if((i||p)&&!(0,u().MTk)(i,p)){let e=(0,y().x)({environment:t,from:"assistantDiff",before:i||[],after:p||[],isIncompleteAfter:l,insertionAnnotation:s?[u().Ifu.Inserted,s]:[u().Ifu.Inserted],deletionAnnotation:s?[u().Ifu.Deleted,s]:[u().Ifu.Deleted]});c&&(e=function(e){const t=e=>{if(!(0,u().BEe)(e))return!1;const[,t]=e;return t.some(u().XKU)};return e.filter((e=>!t(e)))}(e)),g().R9({environment:t,transaction:n,store:r.getPropertyStore(o),value:e})}}function k(e){const{environment:t,transaction:n,blockStore:r,property:o,beforePropertyValue:i,afterPropertyValue:a}=e;if((i||a)&&!(0,u().MTk)(i,a)){const s=x(i,e),l=S(a,e),d=s.concat([["\n"]]).concat(l);g().R9({environment:t,transaction:n,store:r.getPropertyStore(o),value:d})}}function I(e){const{environment:t,transaction:n,property:r,blockStore:o,originalPropertyValue:i}=e;g().R9({environment:t,transaction:n,store:o.getPropertyStore(r),value:x(i,e)})}function T(e){const{environment:t,transaction:n,property:r,blockStore:o,newPropertyValue:i}=e;g().R9({environment:t,transaction:n,store:o.getPropertyStore(r),value:S(i,e)})}var M=()=>n(371621);function C(e){const{assistantSessionContext:t,environment:n,processingBlockId:i,useCrdt:l}=e,d=t.getAllPendingOperations(),m=t.getAllPendingExecutableOperations(),g=(0,r().iL)(t.getAllPendingExecutableOperations()).filter(r().BP),{operations:y}=(0,o().g$)(d,(0,M().BB)({shouldCreateUnknownBlock:!1}),l);!function(e){const{environment:t,operations:n,processingBlockId:o,caches:i,updatedPageGroups:l,executableOperations:d,originalCache:m=t.defaultRecordCache.inMemoryRecordCache}=e,g=t.currentUser.id;if(!g)throw Error("User is not logged in.");const{blockIdToPageGroupAndEdit:y}=(0,r().s2)({updatedPageGroups:l,executableOperations:d}),x=p().hS(p().oE(n.map((e=>{if(e.pointer.table===c().ev)return e.pointer}))),(e=>e.id));i.commitDiffPreviewTransaction({environment:t,transactionActions:f(),perform(e,n){for(const M of x){var r,l;const x=y.get(M.id);if(!x)continue;const C=new(v().B)(t,M,{inMemoryRecordCache:n}),j=null===(r=m.getEntry({pointer:M,userId:g},{ignoreAllCaches:!0}))||void 0===r||null===(r=r.value)||void 0===r?void 0:r.value,[A,B]=x;if(A.didCreatePage){const t=i.updatesCache.getEntry({pointer:M,userId:g},{ignoreAllCaches:!0});var d;t&&h().KY({store:C.getContentStore(),transaction:e,value:(null===(d=t.value.value)||void 0===d?void 0:d.content)??[]});continue}const N=null===(l=n.getEntry({pointer:M,userId:g},{ignoreAllCaches:!0}))||void 0===l||null===(l=l.value)||void 0===l?void 0:l.value,_=p().sb([...Object.keys((null==j?void 0:j.properties)??{}),...Object.keys((null==N?void 0:N.properties)??{})]),R=A.removedBlockIds.has(M.id),P=R&&(null==j?void 0:j.type)===s().xd.text&&void 0===(null==j?void 0:j.properties);P&&_.push("title");for(const r of _){var f,S;const i=b({blockStore:C,property:r});if(i&&"text"!==i)continue;const s=null==j||null===(f=j.properties)||void 0===f?void 0:f[r],l=null==N||null===(S=N.properties)||void 0===S?void 0:S[r],d={environment:t,transaction:e,temporaryCache:n,blockStore:C,property:r,beforePropertyValue:s,afterPropertyValue:l,isIncompleteAfter:M.id===o&&M.table===c().ev,editId:null==B?void 0:B.editId},p=a({beforeString:(0,u().q4_)(s),afterString:(0,u().q4_)(l)}),m=A.updatedBlockIds.has(M.id)&&(0,u().MTk)(s,l),h=R&&!P&&void 0===s;(0,u().MTk)(C.getPropertyValue("language"),[["Mermaid"]])?w({...d,dontDisplayRemoves:!0}):p&&"title"===r?k({...d}):m?T({...d,newPropertyValue:l}):P?I({...d,originalPropertyValue:(0,u().x9d)("        ")}):h||R?I({...d,originalPropertyValue:l}):w(d)}}},userAction:"assistantActions.displayTransactionDiff",userId:g,canUndo:!1})}({environment:n,operations:y,processingBlockId:i,caches:t.caches,updatedPageGroups:g,executableOperations:m})}}}]);