"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[4351],{109054:(e,t,r)=>{r.d(t,{Nt:()=>a,oU:()=>o,uv:()=>n});r(898992),r(823215),r(354520),r(672577),r(737550);function a(e){return e.trim().normalize().toLocaleLowerCase().replace(/[^\w\s]/gu," ").split(/\s/gu).filter((e=>e.length>0))}function n(e){const{query:t,resultText:r,isLastQueryTermPartialMatchOK:n}=e,o=a(t),s=a(r);let i;if(n&&(i=o.pop(),!i))return!1;const l=o.every((e=>s.some((t=>t===e)))),c=!n||void 0!==s.find((e=>e.startsWith(i??"")));return l&&c}function o(e){const{blockStore:t,shouldShowPeopleCollection:r,shouldShowUserProfiles:a}=e;return!(!r&&t.isPeopleCollectionViewPage())&&!(!a&&t.isPersonProfile())}},282834:(e,t,r)=>{r.d(t,{Bu:()=>h,qw:()=>f});r(898992),r(354520),r(803949);var a=()=>r(496603);const n=/[\u4E00-\u9FA5]/g,o=/[\u3000-\u303f\u3040-\u309f\u30a0-\u30ff\uff00-\uff9f\u4e00-\u9faf\u3400-\u4dbf]/g,s=/[\u3041-\u3096\u30A0-\u30FF\u31F0-\u31FF\u3220-\u3243\u3280-\u337F]/g,i=/[\u1100-\u11FF\u3130-\u318F\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF]/g,l=/[-./\\()"'’‘”“，。、·～；,;<>~!@#$%^&*|+=[\]{}`~?:\s]/u;function c(e){return Boolean(e.match(n))}function u(e){return Boolean(e.match(i))}function d(e){return Boolean(e.match(o))}function f(e){return(0,a().oE)(e.split(l))}function h(e,t){const r=u(e);return c(e)||d(e)||r?r?"ko":function(e){return Boolean(e.match(s))}(e)||"ja-JP"===t?"ja":"zh":"none"}},309534:(e,t,r)=>{r.d(t,{A:()=>i,O:()=>s});var a=r(296540),n=()=>r(69708),o=r(474848);const s=(0,n().YK)({settingsAndMembers:{id:"sidebarSettingsButton.settingsAndMembers",defaultMessage:"Settings & members"},settings:{id:"sidebarSettingsButton.settings",defaultMessage:"Settings"},tooltip:{id:"sidebarSettingsButton.tooltip",defaultMessage:"Manage your account and settings"}}),i=function(e){const{buttonStyles:t}=e,i=(0,n().tz)(),l=i.formatMessage(s.settings),c=(0,r(644914).ab)(),u=(0,a.useCallback)((()=>{r(209660).Ow({openedFrom:"sidebar",currentTab:"user_settings"})}),[]);return(0,o.jsx)(r(859428).A,{renderTooltip:()=>i.formatMessage(s.tooltip),originGap:6,textWrap:!0,placement:"right",render:e=>(0,o.jsx)(r(718827).Ay,{...e,onClick:u,style:c.baseSidebarItem,hoveredStyle:null==t?void 0:t.hoveredStyle,children:(0,o.jsx)(r(490044).A,{left:(0,o.jsx)(r(252291).I,{icon:r(212727).gearIcon,colorVariant:"secondary",size:"lg"}),children:l})})})}},357927:(e,t,r)=>{r.r(t),r.d(t,{iconDefinition:()=>a,templatesIcon:()=>n});r(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"2.08 2.62 15.84 14.75",svg:(0,r(474848).jsx)("path",{d:"M7.682 5.716V4.182c0-.858.7-1.557 1.557-1.557h5.823c.858 0 1.557.7 1.557 1.557v5.59a1.56 1.56 0 0 1-1.093 1.486l2.185 3.786c.589 1.038-.154 2.331-1.354 2.331H9.38c-1.138 0-1.895-1.18-1.421-2.201q-.513.113-1.057.114a4.81 4.81 0 0 1-4.818-4.818 4.812 4.812 0 0 1 5.6-4.754M9.24 3.875a.31.31 0 0 0-.307.307v5.6a.3.3 0 0 0 .298.296h1.66l.622-1.075a.6.6 0 0 1 .073-.103 1.56 1.56 0 0 1 2.638.1l.002.003.62 1.075h.217a.31.31 0 0 0 .307-.306v-5.59a.31.31 0 0 0-.307-.307zm-.01 7.453a1.55 1.55 0 0 1-1.547-1.547V6.99a3.562 3.562 0 0 0-4.35 3.481 3.56 3.56 0 0 0 3.569 3.568 3.54 3.54 0 0 0 2.09-.669l1.178-2.04zm3.914-1.7a.31.31 0 0 0-.54.002 1 1 0 0 1-.057.08L9.11 15.665l-.001.002a.306.306 0 0 0 .27.458h6.978a.31.31 0 0 0 .268-.463z"})},n=(0,r(340498).wt)("templates",a)},690978:(e,t,r)=>{r.r(t),r.d(t,{getLocalFrecencyRankedSearchResultsWithStore:()=>ae,searchAndRerankLocalPages:()=>re});r(898992),r(823215),r(354520),r(672577),r(430670),r(803949),r(581454),r(737550);var a=()=>r(314529),n=()=>r(242422),o=()=>r(179034),s=()=>r(282834),i=()=>r(245241),l=()=>r(778078),c=()=>r(496603),u=()=>r(498212),d=()=>r(534177),f=()=>r(720665),h=()=>r(222917),_=()=>r(780865),g=()=>r(470928),p=()=>r(981342),m=()=>r(617711);r(944114),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698);async function v(e){const{spaceId:t,userId:a,blocks:n,environment:o}=e,s=n.map((e=>e.blockModel.id));if(!t||!a||!(0,d().EI)(s))return;const i=await r(559506).callApi({eventName:"getPageSignals",environment:o,data:{spaceId:t,pageIds:s,includeRecords:!0,signals:[{name:"pageAuthorityV1"}]}});if("success"===i.type){const e=s.map((e=>({})));i.data.signals.forEach((t=>{if("success"===t.status){const{name:r,data:a}=t;a.forEach(((t,a)=>{e[a][r]=t}))}}));const r=(0,f().MU)(e.map(((e,t)=>[s[t],e]))),n=S.getKey(t,a);S.update((e=>{const t=e.pageSignals.get(n),a=e.pageSignals.set(n,{...t,...r});return{...e,pageSignals:a}}))}}class E extends(()=>r(757695))().Store{getInitialState(){return{pageSignals:new Map}}getKey(e,t){return`${e}:${t}`}getPageSignals({spaceId:e,userId:t}){if(!e||!t)return;const r=this.getKey(e,t),a=this.state.pageSignals.get(r);return a||void 0}async updatePageSignals(e){const{spaceId:t,userId:r,blocks:a}=e;if(!t||!r)return;const n=this.getPageSignals(e),o=void 0===n?a:a.filter((e=>!n.hasOwnProperty(e.blockModel.id)));if(o.length>0&&await v({...e,blocks:o}),n){const e=Object.keys(n).length+o.length;if(e>2048){const o=e-2048,s=new Set(a.map((e=>e.blockModel.id)));!function(e){const{spaceId:t,userId:r,pageIds:a}=e,n=S.getKey(t,r);S.update((e=>{const t={...e.pageSignals.get(n)};a.forEach((e=>delete t[e]));const r=e.pageSignals.set(n,t);return{...e,pageSignals:r}}))}({spaceId:t,userId:r,pageIds:Object.keys(n).filter((e=>!s.has(e))).slice(0,o)})}}}}const S=new E;class I{constructor(e,t,a){var n;this.featuresets=void 0,this.queryLower=void 0,this.userId=void 0,this.spaceId=void 0,this.currentTimeMs=void 0,this.currentDateMs=void 0,this.pageSignals=void 0,this.resultsFeatureMetadata={},this.recentPagesMap=void 0,this.featuresets=e,this.queryLower=a.toLowerCase();const o=t.currentUser.id,s=null===(n=r(765957).default.state.sidebarSpaceStore)||void 0===n?void 0:n.id;this.userId=o,this.spaceId=s,this.currentTimeMs=Date.now(),this.currentDateMs=new Date(new Date(this.currentTimeMs).toDateString()).getTime(),this.pageSignals=S.getPageSignals({spaceId:this.spaceId,userId:this.userId}),this.recentPagesMap=c().Bj((()=>{const e=(s?r(968172).A.get(s):[])??[];return new Map(e.map((e=>[e.pageId,e.visitedAt])))}))}searchFrecencyVisits(e){const{spaceId:t,userId:a}=this;if(t&&a)return(0,r(355012).C8)({spaceId:t,userId:a,pageId:e})}searchSimilarUserVisits(e){const{spaceId:t,userId:a}=this;if(t&&a)return function(e){const{spaceId:t,userId:a,pageId:n}=e,o=r(314648).default.getUserSignals({spaceId:t,userId:a});if(!o)return;return o.similarUserRecentPages[n]}({spaceId:t,userId:a,pageId:e})}extractFeatureGroup(e){const t=[];for(const r of this.featuresets){const a={groupName:r.name,features:[]};for(const t of r.features)a.features.push(t({result:e,featureExtractor:this}));t.push(a)}return t}}var T=()=>r(448291),C=()=>r(148832),O=()=>r(523584);function b(e){return Number.isFinite(e)?e:0}const M={name:"CLIENT_FEATURESET_RELEVANCY_MODEL",features:[function({result:e,featureExtractor:t}){return{name:"TIME_SINCE_LAST_EDIT",value:t.currentTimeMs-e.block.blockModel.last_edited_time}},function({result:e,featureExtractor:t}){return{name:"IS_LAST_EDITED_BY_ME",value:t.userId&&e.block.blockModel.last_edited_by_id===t.userId?1:0}},function({result:e,featureExtractor:t}){return{name:"IS_CREATED_BY_ME",value:t.userId&&e.block.blockModel.created_by_id===t.userId?1:0}},...i().jp.map((e=>({result:t})=>({name:`BLOCK_SOURCE_${e}`,value:t.block.source.has(e)?1:0}))),function({result:e,featureExtractor:t}){var r;return{name:"PAGE_AUTHORITY_V1",value:t.pageSignals?null===(r=t.pageSignals[e.block.blockModel.id])||void 0===r?void 0:r.pageAuthorityV1:void 0}},function({result:e}){return{name:"TITLE_LENGTH",value:e.block.text.length}},function({result:{terms:e},featureExtractor:{queryLower:t}}){return{name:"TERMS_COUNT_NORMALIZED",value:b(e.length/(0,O().Bj)(t).length)}},function({result:{terms:e},featureExtractor:{queryLower:t}}){const r=(0,O().Bj)(t),a=new Set(e);return{name:"FULL_MATCH_TERM_COUNT_NORMALIZED",value:b(r.filter((e=>a.has(e))).length/r.length)}},function({result:{terms:e,block:{text:t}}}){const r=(0,O().Bj)(t.toLowerCase());return{name:"MATCHING_PERCENTAGE_OF_TITLE",value:b(e.length/r.length)}}]},R={name:"CLIENT_FEATURESET_RELEVANCY_MODEL_UNIFIED",features:[function({result:e,featureExtractor:t}){const r=e.block.blockModel.id,a=t.recentPagesMap().get(r),n=t.currentDateMs,o=Math.max(a??-1);return o<0?{name:"RECENT_VISIT_SCORE",value:y}:{name:"RECENT_VISIT_SCORE",value:1+A({nowDateMs:n,visitedAt:o})}},function({result:e,featureExtractor:t}){const r=e.block.blockModel.id,a=t.searchFrecencyVisits(r),n=t.currentDateMs;if(!a)return{name:"SEARCH_FRECENCY_SCORE",value:y};const o=a.visits.map((e=>A({nowDateMs:n,visitedAt:e}))),s=(0,c().cz)(o)/o.length;return{name:"SEARCH_FRECENCY_SCORE",value:1+a.totalVisits*s}},function({result:e,featureExtractor:t}){const r=e.block.blockModel.id,a=t.searchSimilarUserVisits(r);return a&&a.sortedSimilarUserSignals.length?{name:"SIMILAR_USER_VISIT_SCORE",value:1+a.sortedSimilarUserSignals[0].similarity}:{name:"SIMILAR_USER_VISIT_SCORE",value:0}},function({result:e,featureExtractor:t}){return{name:"MINISEARCH_SCORE",value:e.minisearchScore}},function({result:e,featureExtractor:t}){return{name:"MINISEARCH_SCORE_BOOST",value:e.score/e.minisearchScore}}]};function A({nowDateMs:e,visitedAt:t}){const r=new Date(new Date(t).toDateString()).getTime(),a=Math.max(Math.round((e-r)/f().nD),0);return L[Math.min(a,119)]??0}const L=[1,.434123725,.2014437701,.1884654745,.15822173,.1422946031,.142166057,.1585730404,.104180793,.08345552147,.08087231107,.07897914664,.07896564574,.08624855475,.1008828419,.07266583529,.06040518516,.05852083656,.05753743353,.05815673014,.0642358674,.07381557067,.05695876233,.04843320955,.0470903377,.0466126019,.04746668155,.05325934739,.06307552903,.04855074175,.04160564903,.04030096372,.0391499705,.03939387352,.04339750927,.04955280165,.03917733172,.03338547498,.03209648275,.03168258564,.03227832486,.03591521672,.04128251996,.03310833841,.02833391706,.0272294016,.02689436518,.02729836191,.03046923141,.03441215965,.02831271484,.02449716514,.02354647072,.02317412649,.02358864378,.0263629034,.03012237319,.02459941584,.02126459634,.02046809053,.02030330894,.02052315898,.0228313469,.02579947184,.02105456017,.01811545682,.01734374938,.01698213336,.01714570426,.01897155626,.02136217635,.01769765159,.01529119728,.01463419502,.01431262545,.01444443674,.0159017961,.01772871671,.01474489776,.01280999558,.01220517103,.01190906906,.01197576757,.01314474565,.01475010088,.01212414472,.01051461218,.009996802444,.009711358103,.009723316362,.01077170102,.01191292066,.009778124374,.008391943098,.007831708926,.007399958434,.007365904844,.008059776794,.008782521067,.007061224987,.006022772552,.005622109974,.005249218012,.005053326649,.005458692089,.005740997442,.004543123306,.00380476497,.003402129751,.003036012596,.002836157214,.00291875208,.00288708271,.002093633442,.001635128163,.001354411665,.001031197037,.0007361583583,.0005966154595,.000366973101],y=.4558522322;var U=()=>r(939504);r(16280),r(908872);function P(e,t){return N(e,t,0)}function N(e,t,r){const a=t[r];if("value"in a)return a.value;const{feature:n,threshold:o,left:s,right:i}=a;return e[n]<=o?N(e,t,i):N(e,t,s)}const B=[{feature:"NUMBER_OF_BLOCK_SOURCES",threshold:.9803883731365204,left:1,right:64},{feature:"NUMBER_OF_BLOCK_SOURCES",threshold:-.02051524817943573,left:2,right:33},{feature:"TITLE_LENGTH",threshold:-.9804741442203522,left:3,right:18},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:4,right:11},{feature:"PAGE_AUTHORITY_V1",threshold:.9929431676864624,left:5,right:8},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:6,right:7},{value:.055661729574773056},{value:.11489805030510493},{feature:"IS_LAST_EDITED_BY_ME",threshold:.5,left:9,right:10},{value:.1303473491773309},{value:.2761679479597871},{feature:"PAGE_AUTHORITY_V1",threshold:.7070983946323395,left:12,right:15},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:13,right:14},{value:.15403218305273927},{value:.2901420576840293},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:16,right:17},{value:.3969548667754214},{value:.5434689507494647},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:19,right:26},{feature:"PAGE_AUTHORITY_V1",threshold:-9373319335297929e-20,left:20,right:23},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:21,right:22},{value:.019246861924686193},{value:.0422577337207315},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.38750000298023224,left:24,right:25},{value:.04463445567238064},{value:.08163417730973187},{feature:"PAGE_AUTHORITY_V1",threshold:.9430259466171265,left:27,right:30},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:28,right:29},{value:.04921499627799959},{value:.11522081288769559},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:31,right:32},{value:.15812057498390902},{value:.26642904878592116},{feature:"TITLE_LENGTH",threshold:-.8644499182701111,left:34,right:49},{feature:"PAGE_AUTHORITY_V1",threshold:.7071063816547394,left:35,right:42},{feature:"TIME_SINCE_LAST_EDIT",threshold:-.9999998509883881,left:36,right:39},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.7386363744735718,left:37,right:38},{value:.5046524356869184},{value:.6139737991266375},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.9545454680919647,left:40,right:41},{value:.35265916931762176},{value:.4631217838765009},{feature:"IS_LAST_EDITED_BY_ME",threshold:.5,left:43,right:46},{feature:"BLOCK_SOURCE_teamPage",threshold:.5,left:44,right:45},{value:.5826717293752157},{value:.3459669582118562},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.9285714328289032,left:47,right:48},{value:.6696084874659657},{value:.7931906286870049},{feature:"PAGE_AUTHORITY_V1",threshold:.7071079015731812,left:50,right:57},{feature:"TIME_SINCE_LAST_EDIT",threshold:-.7071194350719452,left:51,right:54},{feature:"TITLE_LENGTH",threshold:.0027717105112969875,left:52,right:53},{value:.3084340622029064},{value:.20221830985915493},{feature:"TITLE_LENGTH",threshold:.0014528378378599882,left:55,right:56},{value:.19599360481519798},{value:.12874983418294833},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:58,right:61},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.3484848588705063,left:59,right:60},{value:.1674727932285369},{value:.2761101463656661},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.3229166716337204,left:62,right:63},{value:.31311018131101814},{value:.4333284274045184},{feature:"TITLE_LENGTH",threshold:-.8199742436408997,left:65,right:96},{feature:"PAGE_AUTHORITY_V1",threshold:.9987315237522125,left:66,right:81},{feature:"TIME_SINCE_LAST_EDIT",threshold:-.7075438499450684,left:67,right:74},{feature:"TERMS_COUNT_NORMALIZED",threshold:.7859025001525879,left:68,right:71},{feature:"NUMBER_OF_BLOCK_SOURCES",threshold:1.0080004930496216,left:69,right:70},{value:.6666666666666666},{value:.5572065378900446},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.8090909123420715,left:72,right:73},{value:.730962836028703},{value:.82483781278962},{feature:"TERMS_COUNT_NORMALIZED",threshold:.7750000059604645,left:75,right:78},{feature:"BLOCK_SOURCE_defaultRecordCache",threshold:.5,left:76,right:77},{value:.5598243688254665},{value:.3112244897959184},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:79,right:80},{value:.48986486486486486},{value:.6522655426765016},{feature:"TIME_SINCE_LAST_EDIT",threshold:-.9759486615657806,left:82,right:89},{feature:"IS_CREATED_BY_ME",threshold:.5,left:83,right:86},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:84,right:85},{value:.7596830985915493},{value:.8754666411409974},{feature:"TERMS_COUNT_NORMALIZED",threshold:.7750000059604645,left:87,right:88},{value:.8577648766328012},{value:.9412431085265464},{feature:"TERMS_COUNT_NORMALIZED",threshold:.9000000059604645,left:90,right:93},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.7083333432674408,left:91,right:92},{value:.7364085667215815},{value:.4639175257731959},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:94,right:95},{value:.7003610108303249},{value:.8495272810115048},{feature:"PAGE_AUTHORITY_V1",threshold:.9999995827674866,left:97,right:112},{feature:"TITLE_LENGTH",threshold:1.0038834810256958,left:98,right:105},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:99,right:102},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:100,right:101},{value:.18298261665141813},{value:.34929850024189646},{feature:"TIME_SINCE_LAST_EDIT",threshold:-.7071070969104767,left:103,right:104},{value:.5148422178641469},{value:.42366514623021195},{feature:"NUMBER_OF_BLOCK_SOURCES",threshold:1.3351261019706726,left:106,right:109},{feature:"TITLE_LENGTH",threshold:1.4187065362930298,left:107,right:108},{value:.2810958904109589},{value:.14157014157014158},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:110,right:111},{value:.19499105545617174},{value:.40776554596846176},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:113,right:120},{feature:"PAGE_AUTHORITY_V1",threshold:1.4150558710098267,left:114,right:117},{feature:"TITLE_LENGTH",threshold:.09616653248667717,left:115,right:116},{value:.5727355901189387},{value:.4002079002079002},{feature:"TITLE_LENGTH",threshold:.36996421217918396,left:118,right:119},{value:.3089700996677741},{value:.10194174757281553},{feature:"PAGE_AUTHORITY_V1",threshold:1.000001072883606,left:121,right:124},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.22649572789669037,left:122,right:123},{value:.6954795357361027},{value:.7911777488048675},{feature:"TITLE_LENGTH",threshold:-.2670345604419708,left:125,right:126},{value:.7278492480521833},{value:.5908471377647305}],k=["PAGE_AUTHORITY_V1"],w=["TIME_SINCE_LAST_EDIT"],G=["TIME_SINCE_LAST_EDIT","PAGE_AUTHORITY_V1","TITLE_LENGTH","NUMBER_OF_BLOCK_SOURCES"];class D extends Error{constructor(e,t){super(e),this.name="MathError",this.cause=void 0,this.cause=t}}function x(e){if(0===e.length)throw new Error("Can't compute std of an empty array.");const t=(0,c().i2)(e),r=(0,c().cz)(e.map((e=>Math.pow(e-t,2))))/e.length;return Math.sqrt(r)}const K=[function(e){return{name:"NUMBER_OF_BLOCK_SOURCES",value:e.reduce(((e,{name:t,value:r})=>void 0!==r&&t.startsWith("BLOCK_SOURCE")?e+r:e),0)}}];function F(e){return[...e,...K.map((t=>t(e)))]}const V={TIME_SINCE_LAST_EDIT:-.17725330223424154,IS_LAST_EDITED_BY_ME:.16176141450635628,IS_CREATED_BY_ME:.0593282388860205,BLOCK_SOURCE_spacePage:-.1800298837847493,BLOCK_SOURCE_recentVisit:.38019907955270416,BLOCK_SOURCE_bookmarkedPage:.2273554336295929,BLOCK_SOURCE_sharedPage:-.11405912441003871,BLOCK_SOURCE_frecencyStore:.7303811564943883,BLOCK_SOURCE_teamPage:-.3886937481702676,BLOCK_SOURCE_defaultRecordCache:-.08630181620439217,BLOCK_SOURCE_similarUser1dRecentPages:.1516065982402135,BLOCK_SOURCE_topPages7dPageView:.04024980669809112,BLOCK_SOURCE_editedPages1d:-.12760596916369363,BLOCK_SOURCE_similarUsersEditedPages1d:-.209104241796053,BLOCK_SOURCE_customAgent:0,BLOCK_SOURCE_offlinePage:0,BLOCK_SOURCE_unknown:0,PAGE_AUTHORITY_V1:.4303514640388112,TITLE_LENGTH:-.4316382562266375,TERMS_COUNT_NORMALIZED:-.1032745452783248,FULL_MATCH_TERM_COUNT_NORMALIZED:.18313025417928205,MATCHING_PERCENTAGE_OF_TITLE:1.0003388486917193,NUMBER_OF_BLOCK_SOURCES:.7940652678793755,BLOCK_SOURCE_inboxPage:0},H=-2.48072057;function Y(e){const t=e.map((({name:e,value:t})=>V[e]*(t??0)));return r=(0,c().cz)([H,...t]),1/(1+Math.exp(-r/2));var r}function j(e){if(e.some((({value:e})=>void 0===e)))return 0;const t=(0,f().MU)(e.map((({name:e,value:t})=>[e,t]))),r=[B].map((e=>P(t,e)));return(0,c().i2)([...r,Y(e)])}var z=()=>r(109054);const q=1.25,W=[M],$=0;function Z(e){const{results:t,featureGroups:r,shouldCalculateRelevancies:a}=e,n=t.map(((e,t)=>{const a=e.block.workflowStore;let n;const{block:o,score:s,personalizationBoost:l,rendered:c,terms:u}=e,d={text:c};if(a){var f;n=(0,U().getAvailableWorkflowData)(a);const e=a.getCreatedByPointer(),t=e?(0,T().JQ)({parentStore:a,pointer:e}):void 0,r=`${(null==t?void 0:t.getName())??""}`;d.title=null===(f=n)||void 0===f?void 0:f.name,d.pathText=r,d.text=c}return{sources:[i().Ni.Local],id:o.blockModel.id,collectionId:o.collectionModel?o.collectionModel.id:void 0,isSurrogateCollection:void 0!==o.collectionModel,spaceId:o.blockModel.space_id,score:s,localSource:o.source,personalizationBoost:l,terms:u,highlight:d,featureGroups:r[t],workflowData:n}})),o=a?function(e){const t=W.map(((t,r)=>{const a=e.map((({featureGroups:e})=>{var t;return null===(t=e[r])||void 0===t?void 0:t.features}));if(a.some((e=>void 0===e)))return;return function(e){const t=(0,c().mg)(e);for(const o of t)for(const e of o)(0,d().Xk)(k,e.name)?e.value??=0:(0,d().Xk)(w,e.name)&&(e.value=Math.log(e.value??1));const r=new Map,a=new Map,n=new Map;for(const o of t)for(const e of o)if(void 0!==e.value&&(0,d().Xk)(G,e.name)){r.has(e.name)||r.set(e.name,[]);const t=r.get(e.name);t&&t.push(e.value)}for(const[o,s]of r.entries())a.set(o,(0,c().i2)(s)),n.set(o,x(s));for(const o of t)for(const e of o)if((0,d().Xk)(G,e.name)){const t=a.get(e.name),r=n.get(e.name);if(void 0===e.value||void 0===t||void 0===r)throw new D(`Couldn't scale feature ${e.name}`);e.value=0===r?0:(e.value-t)/r}return t}(a.map(F)).map(j)}));if(!t.some((e=>void 0===e)))return(0,c().sn)(t.filter(d().O9))}(n):void 0;return n.map(((e,t)=>({...e,localRelevancies:void 0!==o?o[t]:void 0})))}function X(e,t,r){const a=e=>r.matches(e.block),n=(0,s().qw)(t);if(1===n.length)return e.search(t,{filter:a,prefix:!0,fields:["text","inits"]});const o=e.search(t,{filter:a,combineWith:"AND",fields:["text"]});if(o.length>0)return o;const i=n.filter((e=>e.length>=O().k2)),l=(c=i.length,Math.round(.6*c+.5));var c;return e.search(t,{filter:e=>e.queryTerms.length>=l&&a(e)})}function J(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Q(e){const{block:t,score:r,terms:a}=e,{source:n,text:o}=t,s=function(e,t){const r=t.map(J).join("|"),a=new RegExp(r,"ig");return t.length>0?e.replaceAll(a,`${i().$8}$&${i()._x}`):e}(o,a);var l;return{block:t,rendered:s,score:r,personalizationBoost:(l=n).has("recentVisit")||l.has("frecencyStore")||l.has("bookmarkedPage")||l.has("defaultRecordCache")||l.has("inboxPage")?q:1,terms:a,minisearchScore:e.minisearchScore??r}}function ee(e,t,r){const{blocks:a,getAllBlocks:n}=e,o=r.text.trim(),s=(0,u().dY)(o),i=s.length>0?s.join(" "):o,c=new(_().Zd)(t);return i.length>0?function(e){const{blocksIndex:t,queryString:r,filterMatcher:a}=e,n=X(t,r,a),o={exactMatch:l().gK,prefixMatch:1.5,wordPrefixMatch:1.25,substringMatch:1,dateMatch:l().tz};return n.map((e=>{const t=(0,O().B1)(r,e.block.text,o);return{...e,score:e.score*t,minisearchScore:e.score}})).map(Q)}({blocksIndex:a,queryString:i,filterMatcher:c}):n().filter((e=>c.matches(e.block))).map(Q)}const te=(0,c().sg)(((e,t)=>{t[0].featureGroups.forEach((({groupName:r},n)=>{const o=t.map((e=>({features:e.featureGroups[n].features,id:e.id})));(0,a().DO_NOT_USE_trackLegacy)(e,"search_local_result_features",{search_session_id:h().wr(),group_name:r,results_features:o})}))}),1e3,{leading:!1,trailing:!0});function re({query:e,localCachedPages:t,userId:r,includeRecordMap:a,environment:s,shouldUseNewRerankerDebugOverrideEnabled:i,spaceStore:l}){const{query:u,limit:d}=e,{filters:f,sort:h}=u,_=ee(t,f,u);if(0===_.length)return;const v=function(e,t){const{field:r}=e,a="relevance"===r||"desc"===e.direction?-1:1;switch(r){case"lastEdited":case"scroll":return(0,c().Ul)(t,(({block:{blockModel:e}})=>a*(e.last_edited_time||0)));case"created":return(0,c().Ul)(t,(({block:{blockModel:e}})=>a*(e.created_time||0)));default:return(0,c().Ul)(t,(({score:e})=>a*e))}}(h,_),E="relevance"===h.field,S=i||"on"===n().default.getEligibleGroup({experimentId:"search-use-local-reranker-layered",parameter:"shouldUseLocalReranker",defaultGroup:"control"}),T=function(e,t,r,a){const n=new I(t,e,r);return a.map((e=>n.extractFeatureGroup(e)))}(s,S?[M,R]:[R],e.query.text,v),O=Z({results:v,featureGroups:T,shouldCalculateRelevancies:S}),b=S&&O.every((({localRelevancies:e})=>void 0!==e&&e.length>0&&void 0!==e[$])),A=E?b?(L=$,O.sort((({localRelevancies:e},{localRelevancies:t})=>(t??[])[L]-(e??[])[L]))):function(e){const t=e.map((e=>{const t=e.featureGroups.flatMap((e=>e.groupName===R.name?e.features:[])).find((e=>"SEARCH_FRECENCY_SCORE"===e.name)),r=t?t.value:void 0;return r&&(e.score*=r),e}));return(0,c().Ul)(t,(({score:e})=>-1*e))}(O):O;var L;let y=A;if(l){const e=(0,m().$e)(l),t=(0,p().jj)(l);t&&e||(y=y.filter((r=>{const a=C().B.createChildStore(l,{table:o().ev,id:r.id});return(0,z().oU)({blockStore:a,shouldShowPeopleCollection:t,shouldShowUserProfiles:e})})))}const U=y.slice(0,d);return(0,g().EG)({results:U,recordMap:t.recordMap}),{total:_.length,results:U,recordMap:a??1?t.recordMap.toJson():{},trackEventProperties:void 0,allMatchingResultIds:A.map((e=>e.id))}}function ae({query:e,localCachedPages:t,parentStore:r,spaceStore:s,isOnline:l,environment:u,shouldLimitLocalResultsWhenOnline:g,canUseLtr:p,shouldUseNewRerankerDebugOverrideEnabled:m}){const v=re({query:e,localCachedPages:t,userId:u.currentUser.id,environment:u,shouldUseNewRerankerDebugOverrideEnabled:m,spaceStore:s});if(!v)return;if(0===v.results.length)return{error:i().yq.NoResults};const E=v.results.map(((e,t)=>{var a;const n=C().B.createChildStore(r,{table:o().ev,id:e.id}),s=n.isCollectionView()?null===(a=n.getCollectionPointerIfSingleSource())||void 0===a?void 0:a.id:void 0;return{...e,originalPosition:t,store:n,serverEventProperties:void 0,collectionId:e.collectionId??s}})),S=l&&g,I=(S?e=>(0,_().kZ)(u,e):e=>e)(E);if(0===I.length)return{error:i().yq.NoResults};const T=E.map((({localRelevancies:e})=>e)),O=(0,c().sn)(T.filter(d().O9)),b=O.map(c().i2),M=(0,c().sn)(I.map((({localRelevancies:e})=>e)).filter(d().O9)).map(c().i2),R=T.some(d().O9)?{...(0,f().MU)(O.map(((e,t)=>[`result_relevancies_${t}`,e]))),result_relevancies_means:b,visible_result_relevancy_means:M}:{},A=e.query.text.length>1&&p;return(0,a().DO_NOT_USE_trackLegacy)(u,"search_local_recall_results",{results:E.map(ne),search_session_id:h().wr(),num_local_results:I.length,are_results_limited:S,...R}),A&&(te(u,I),n().default.logEvent("visible_local_search_results",I.length,{resultRelevancyV1:b[0],visibleResultRelevancyV1:M[0]})),{value:{total:E.length,totalResultIds:E.map((e=>e.id)),allMatchingResultIds:v.allMatchingResultIds,results:I,debugInfo:void 0}}}function ne(e){const{id:t,localSource:r}=e;return{id:t,localSource:[...r??[]]}}},763336:(e,t,r)=>{r.d(t,{U:()=>g,W:()=>_});r(296540);var a=()=>r(242422),n=()=>r(484714),o=()=>r(56366),s=()=>r(252291),i=()=>r(357927),l=()=>r(69708),c=()=>r(981084),u=()=>r(296798),d=()=>r(859428),f=()=>r(490044),h=r(474848);function _(e){const{styles:t}=e,r=(0,n().v3)(),_=(0,l().tz)(),p=(0,o().K8)((()=>{const{RouterStore:e}=r;return e.state.route.name}),[r]),m=(0,o().K8)((()=>a().default.getEligibleGroup({experimentId:"inapp_marketplace_entrypoint_copy",defaultGroup:"control"})),[]),v=(0,c().U)("marketplace_sidebar_option_click");return(0,h.jsx)(d().A,{renderTooltip:()=>_.formatMessage(g.templatesMwnTooltip),originGap:6,placement:"right",render:e=>(0,h.jsx)(u().A,{style:t.sidebarItemButtonStyle,hoveredStyle:t.buttonHoveredStyle,onClick:v,...e,children:(0,h.jsx)(f().A,{left:(0,h.jsx)(s().I,{icon:i().templatesIcon,colorVariant:"secondary",size:"lg"}),isBottomItem:!0,style:"gallery"===p?t.sidebarItemActiveStyle:{},children:"on"===m?_.formatMessage(g.marketplaceTitle):_.formatMessage(g.title)})})})}const g=(0,l().YK)({templatesMwnTooltip:{defaultMessage:"Find all the best templates and set-ups built by Notion’s community",id:"sidebar.openTemplatePickerButton.tooltip.mwn"},title:{defaultMessage:"Templates",id:"sidebar.openTemplatePickerButton"},marketplaceTitle:{defaultMessage:"Marketplace",id:"sidebar.openMarketplaceButton"}})},806638:(e,t,r)=>{r.d(t,{P:()=>o});var a=()=>r(427704),n=()=>r(577142);function o(e){const{environment:t}=e;(0,n().navigate)({environment:t,url:a().JZ.marketplace,redirect:!1})}},908928:(e,t,r)=>{r.d(t,{GO:()=>B,Ju:()=>N,KA:()=>P,L2:()=>K,dA:()=>k,gI:()=>U,iN:()=>x,lM:()=>D,oG:()=>G,sK:()=>w});r(898992),r(354520),r(803949);var a=()=>r(386164),n=()=>r(433847),o=()=>r(68263),s=()=>r(388821),i=()=>r(179034),l=()=>r(824862),c=()=>r(161479),u=()=>r(96689),d=()=>r(798880),f=()=>r(763824),h=()=>r(534177),_=()=>r(901389),g=()=>r(855801),p=()=>r(594794),m=()=>r(972435),v=()=>r(329443),E=()=>r(542585),S=()=>r(148832),I=()=>r(258836),T=()=>r(559506),C=()=>r(496414),O=()=>r(579627),b=()=>r(384944),M=()=>r(471995),R=()=>r(231297),A=()=>r(949237);const L=(0,r(69708).YK)({duplicatingTemplate:{id:"botActions.duplicatingTemplate.loadingMessage",defaultMessage:"Duplicating template..."},duplicatingTemplateError:{id:"botActions.duplicateTemplateAndShareWithBot.snackbar.failure",defaultMessage:"Failed to duplicate template for to your workspace"}});function y(e,t){const{environment:r,spaceStore:a,membershipType:n}=t,o=function(e){const{name:t,spaceStore:r,userId:a,icon:n,type:o,environment:s}=e,i=Date.now(),c={name:t,created_at:i,created_by_table:d().oo,created_by_id:a,alive:!0,icon:n,space_id:r.id,last_edited_at:i,last_edited_by_id:a,last_edited_by_table:d().oo};switch(o){case"guest":return{...c,type:"guest",capabilities:e.capabilities,parent_table:u().NX,parent_id:r.id,integration_id:void 0};case"scim":return{...c,id:(0,p().Z1)({environment:s,table:l().GP,spaceId:r.id}),type:"scim",parent_table:d().oo,parent_id:a};default:(0,h().HB)(o)}}(t),s=b().eC({environment:r,table:l().GP,value:o,inMemoryRecordCache:r.defaultRecordCache.inMemoryRecordCache,transaction:e});return O().yG({environment:r,spaceStore:a,actors:[{type:"bot",membershipType:n,botId:s.id,parent:void 0}],transaction:e}),{botStore:s}}function U(e){const{environment:t}=e,{serverCommitResult:r,performResult:{botStore:a}}=R().createAndCommit({userAction:"botActions.createSpaceBot",environment:t,canUndo:!0,perform:t=>y(t,e)});return{botStore:a,transactionPromise:r}}async function P(e){const{environment:t,botId:r,onSuccess:a}=e,n=await T().callApi({eventName:"deleteBot",environment:t,data:{botId:r}});"failed"===n.type?_().Qg(n):"success"===n.type&&a&&(await A().oX({environment:t}),a())}async function N(e){const{environment:t,table:r,id:n,type:o}=e,s=await T().callApi({eventName:"getBots",environment:t,data:{table:r,id:n,type:o},headers:(0,a().WS)({spaceId:r===u().NX?n:void 0})});return"failed"===s.type?(_().Qg(s),{botIds:[],recordMap:{}}):(s.data.integrationManagementPermissions&&E().b.updatePermissions(s.data.integrationManagementPermissions),{botIds:s.data.botIds,recordMap:s.data.recordMap})}async function B(e){const{environment:t,spaceStore:r,botIds:a}=e;if(!r)return;const n=await T().callApi({eventName:"getBotSharedPageIds",environment:t,data:{spaceId:r.id,botIds:a}});if("failed"!==n.type)return function(e){const{integrationManagementPermissions:t}=e;t&&Object.keys(t).length>0&&E().b.updatePermissions(t)}({integrationManagementPermissions:n.data.integrationManagementPermissions}),n.data;_().Qg(n)}async function k(e){const{environment:t,botId:r}=e,a=await T().callApi({eventName:"getBotToken",environment:t,data:{botId:r}});if("failed"!==a.type)return a.data.token;_().Qg(a)}function w(e){const{botValue:t,store:r,environment:a}=e,{id:o,parent_id:s,parent_table:i,capabilities:l}=t,c={type:"bot_permission",bot_id:o,parent_id:s,parent_table:i,role:(0,n().MD)(l)};R().createAndCommit({userAction:"TopbarMoreButton.handleAddingConnection",environment:a,canUndo:!0,perform:e=>{O().zP({environment:a,store:r,permissionItems:[c],transaction:e})}})}function G(e){const{botId:t,store:r,environment:a}=e,n=r.getPermissionItems().filter((e=>!!(0,o().P3)(e)));for(const o of n)if(o.bot_id===t){const e={...o,role:"none"};R().createAndCommit({userAction:"TopbarMoreButton.handleRemovingConnection",environment:a,canUndo:!0,perform:t=>{O().zP({environment:a,store:r,permissionItems:[e],transaction:t})}})}}async function D(e){const{environment:t,spaceStore:r,botStore:a,pageIdAndOperations:n,concurrency:o=20}=e;return 0!==n.length&&(await(0,f().lX)(n,o,(async e=>{const n=S().B.createChildStore(r,{table:i().ev,id:e.pageId,spaceId:r.getSpaceId()}),o=(0,v().Ws)({botStore:a,addPermission:"add"===e.operationType}),{serverCommitResult:s}=R().createAndCommit({userAction:`botActions.updateBotPermissionsForPages.${e.operationType}`,environment:t,canUndo:!0,perform:e=>{O().zP({environment:t,store:n,permissionItems:[o],transaction:e})}});await s})),!0)}async function x(e){const{environment:t,spaceStore:r,botStore:a,pageIdAndOperations:n,effectiveAdminOnly:o}=e;return(0!==n.length||void 0!==o)&&(await T().callApi({eventName:"setBotPermissionsForPages",environment:t,data:{spaceId:r.getSpaceId(),botId:a.id,pageOperations:n,effectiveAdminOnly:o}}),!0)}async function K(e){const{environment:t,spaceStore:r,spaceViewStore:n,templatePageId:o,botValue:u,pages:d}=e;if(!r)return;const f=I().v.createChildStore(r,{table:l().GP,id:u.id});if(o)return await async function(e){const{environment:t,spaceStore:r,spaceViewStore:n,templatePageId:o,botStore:i}=e;if(!r||!n)return;try{C().m({message:L.duplicatingTemplate});const e=await T().callApi({eventName:"loadBlockSubtree",environment:t,data:{block:{id:o,spaceId:(0,c().e)(void 0)},shallow:!1},headers:(0,a().WS)({recordId:o})});if("failed"===e.type)return;const l=s().RecordMapWithRole.create(e.data.subtreeRecordMap),{createAndDuplicatePageInSpace:u}=await(0,g().nd)(),{performResult:d}=R().createAndCommit({userAction:"botActions.duplicateTemplateAndShareWithBot",environment:t,canUndo:!0,perform:e=>{const a=u({environment:t,recordMap:l,copyPageId:o,isPrivate:!0,spaceStore:r,spaceViewStore:n,transaction:e,allowCopyExternalObjectInstances:!1}),s=n.getPrivatePageIds();s.length>0&&b().zv({store:n,data:{private_pages:[a.id,...s]},transaction:e});const c=(0,v().Ws)({botStore:i,addPermission:!0});return O().zP({environment:t,store:a,permissionItems:[c],transaction:e}),a}});return d}catch(l){M().D6({label:m().A.formatMessage(L.duplicatingTemplateError)})}finally{C().V()}}({environment:t,templatePageId:o,botStore:f,spaceStore:r,spaceViewStore:n});!function(e){const{spaceStore:t,environment:r,pages:a,botStore:n,addPermission:o}=e;if(!t)return;const s=(0,v().Ws)({botStore:n,addPermission:o});a.forEach((e=>{const a=S().B.createChildStore(t,{table:i().ev,id:e,spaceId:t.getSpaceId()});R().createAndCommit({userAction:"botActions.updateBlockPermissionsForBot",environment:r,canUndo:!0,perform:e=>{O().zP({environment:r,store:a,permissionItems:[s],transaction:e})}})}))}({environment:t,spaceStore:r,botStore:f,pages:d,addPermission:!0})}},981084:(e,t,r)=>{r.d(t,{U:()=>u});var a=r(296540),n=()=>r(564884),o=()=>r(312788),s=()=>r(484714),i=()=>r(427704),l=()=>r(652617),c=()=>r(806638);function u(e,t){const{navigate:r}=(0,a.useContext)(o().E),u=(0,s().v3)(),{isPhone:d}=(0,s().Y0)(),f=(0,a.useContext)(l().e);return(0,a.useCallback)((a=>{if((0,n().u)({environment:u,event:{eventName:e,eventProperties:{}}}),d)null==f||f(),r({environment:u,url:"/nativetab/templates",redirect:!0});else{const e="click"===a.type&&(a.metaKey||a.ctrlKey);(null==t?void 0:t.forceOpenInNewTab)||e?r({environment:u,url:i().JZ.marketplace,openInNew:"tab",makeTabActive:!e&&u.device.isDesktop}):(0,c().P)({environment:u})}}),[u,e,t,d,f,r])}}}]);