"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[9020],{170350:(e,t,s)=>{s.r(t),s.d(t,{filterIcon:()=>n,iconDefinition:()=>o});s(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.87 15.25 10.25",svg:(0,s(474848).jsx)("path",{d:"M3 4.875a.625.625 0 1 0 0 1.25h14a.625.625 0 1 0 0-1.25zm2.125 5.742h9.75a.625.625 0 1 0 0-1.25h-9.75a.625.625 0 1 0 0 1.25m1.5 3.883c0-.345.28-.625.625-.625h5.5a.625.625 0 1 1 0 1.25h-5.5a.625.625 0 0 1-.625-.625"})},n=(0,s(340498).wt)("filter",o)},273321:(e,t,s)=>{s.d(t,{A:()=>T});var o=s(296540),n=()=>s(726637),i=()=>s(790748),r=()=>s(56366),l=()=>s(401497),a=()=>s(713998),d=()=>s(797809),c=()=>s(69708),u=()=>s(284371),m=()=>s(471995),p=()=>s(710648),g=()=>s(678553),h=()=>s(125565),y=()=>s(862292),b=()=>s(381678),f=()=>s(972435),S=()=>s(480289),v=()=>s(737230),x=()=>s(765957),A=()=>s(441467),k=()=>s(848565),j=()=>s(473975),C=()=>s(555776),M=()=>s(116008),D=()=>s(811879),I=()=>s(846583),F=()=>s(640753),B=()=>s(105157),w=s(474848);function T(e){const{environment:t,menuListItemProps:s,shouldShowTopDividerLine:T,shouldShowBottomDividerLine:R,shouldExpandDiscussionWidth:_,noBackgroundColors:E,onMouseEnter:O,onMouseLeave:P,onFocus:K,onBlur:z,onMobileClose:L}=e,W=(0,r().O$)(x().AppStoreMainEditorCurrentBlockStore),U=(0,r().K8)((()=>(0,b()._)(t)),[t]),H=k().eQ,V=(0,r().K8)((()=>C().A.state.isActivelyComposing),[]),N=(0,r().K8)((()=>C().A.state.isHovered),[]),Y=(0,o.useCallback)((()=>{null==O||O()}),[O]),$=(0,o.useCallback)((()=>{null==P||P()}),[P]),G=(0,o.useCallback)((()=>{null==K||K()}),[K]),q=(0,o.useCallback)((()=>{M().A.hasContent()?C().A.resetAllActiveSources():(M().A.reset(),C().A.reset()),null==z||z()}),[z]),J=(0,c().tz)(),Z=(0,o.useRef)(null),X=n().A.isMobile;(0,i().b)(S().A,(()=>({getNode:()=>Z.current})),[]);const Q=(0,l().IS)((e=>({menuDiscussionItem:{marginInlineStart:-14,marginInlineEnd:-14,width:"calc(100% + 28px)"},discussionContainer:{paddingTop:X?4:6,borderTop:!X&&T?`1px solid ${e.regularDividerColor}`:void 0,borderBottom:!X&&R?`1px solid ${e.regularDividerColor}`:void 0,transition:"background 300ms ease",background:E?void 0:V?e.focusDiscussionBackground:N?e.hoveredDiscussionBackground:void 0},comment:{position:"relative",fontSize:X?16:14},commentElementsBelowUserRow:{paddingInlineStart:k().FB},avatar:{marginTop:0,marginInlineEnd:X?4:8,userSelect:"none",WebkitUserSelect:"none"},userRow:{display:"flex",flexDirection:"row",alignItems:"center",userSelect:"none",WebkitUserSelect:"none"},placeholder:{height:8,width:81,borderRadius:6,background:e.lightDividerColor},draftLabel:{margin:"0 6px",flexBasis:140,whiteSpace:"normal",flexGrow:void 0,display:"inline",color:e.text.tertiary},container:{paddingTop:k().e4,paddingInlineEnd:16,paddingBottom:k().Wv,paddingInlineStart:16},noOverflow:{overflow:"hidden"},commentContext:{display:"flex",width:"100%",marginTop:6,marginBottom:22,fontSize:13,color:e.text.secondary},displayName:{fontWeight:u().Wy.medium,whiteSpace:"normal"},fullWidthFlex:{display:"flex",width:"100%"},smallTopPadding:{marginTop:1}})),[N,X,V,E,R,T]),ee=(0,o.useCallback)((async()=>{const e=await y().T.formulas.load();A().i5({environment:t,allowActionsWhileCommenting:!0,formulasModule:e});const s=v().Ay.state.hasActiveDraftComment;n().A.isMobile&&s&&(m().D6({label:J.formatMessage({id:"draftComment.submitted.snackbar",defaultMessage:"Comment added"}),position:"bottom",style:{justifyContent:"center",textAlign:"center"}}),null==L||L())}),[t,J,L]),te=(0,r().K8)((()=>!M().A.state.open||"reaction"===M().A.state.content),[]),se=(0,r().K8)((()=>{var e;return M().A.getBlockStore()??(null===(e=M().A.getClosestBlockStore())||void 0===e?void 0:e.parentBlockStore)}),[]),oe=(0,r().K8)((()=>M().A.getPropertyId()),[]),ne=(0,r().K8)((()=>{if(oe){var e;const t=null===(e=M().A.getBlockStore())||void 0===e?void 0:e.getAssociatedCollectionStore();if(!t||"collection"!==t.table)return;const s=t.getSchema();return(0,a()._g)({schema:s,property:oe})}}),[oe]),ie=(0,r().K8)((()=>(0,d().RX)(f().A.getIntl()).title),[]),re=(0,r().O$)(M().f),le=(0,r().K8)((()=>null==U?void 0:U.getDisplayName(J)),[U,J]),ae=(0,r().K8)((()=>null==se?void 0:se.getSpaceId()),[se]),de=(0,r().K8)((()=>A().Ek({environment:t})),[t]),ce=(0,r().K8)((()=>M().A.getType()),[]),ue=(0,r().K8)((()=>null==se?void 0:se.getValue()),[se]);if(te||!ie||!U||!se||!W||!re||!ae||!ue&&"block"===ce||!de&&"inline"===ce)return null;const me="inline"===ce||oe,pe="block"===ce&&!oe?(0,w.jsx)(p().Ay,{blockValue:ue,rootStore:se,blockPreviewLocation:"comments_sidebar"}):me?(0,w.jsx)(p().vY,{value:{value:(null==de?void 0:de.context)??[],spaceId:ae},propertySchema:ie,labeled:!1,rootStore:se,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableDateStyleAnnotations:!0}):null;return(0,w.jsx)("div",{style:Q.discussionContainer,ref:Z,onClick:null==s?void 0:s.onClick,onMouseEnter:Y,onMouseLeave:$,children:(0,w.jsx)(g().Ay,{allowTextSelection:!0,style:Q.menuDiscussionItem,title:(0,w.jsx)("div",{style:Q.container,children:(0,w.jsxs)("div",{style:Q.comment,children:[(0,w.jsxs)("div",{style:Q.userRow,children:[(0,w.jsx)(D().E,{authorStore:U,avatarSize:H,avatarStyle:Q.avatar}),(0,w.jsxs)("div",{style:Q.noOverflow,children:[(0,w.jsx)("span",{style:Q.displayName,children:le||(0,w.jsx)("span",{style:Q.placeholder})}),(0,w.jsx)(h().A,{isSmall:!X,isSecondaryColor:!0,isMultiline:!0,style:Q.draftLabel,children:(0,w.jsx)(c().sA,{defaultMessage:"Draft",id:"DraftCommentInputWithContext.draftLabel"})})]})]}),(0,w.jsxs)("div",{style:Q.commentElementsBelowUserRow,children:[(0,w.jsx)("div",{style:Q.commentContext,children:(0,w.jsxs)("div",{style:Q.fullWidthFlex,children:[(0,w.jsx)(I().T,{}),ne?(0,w.jsx)(B().A,{propertySchema:ne}):void 0,(0,w.jsx)("div",{style:Q.smallTopPadding,children:pe})]})}),(0,w.jsx)(F().A,{showAvatar:!1,parentStore:W,blockStore:se,onSubmit:ee,discussionInputStore:re,isNewComment:!0,isEditingExistingComment:!1,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,discussionFormat:j().DiscussionFormat.Sidebar,canDrop:!0,disableFocusRing:!0,adjustWidthForDraftDiscussions:_,dontMoveCursorToInputEndOnFocus:!0,onBlur:q,onFocus:G},"draft-comment-sidebar")]})]})})})},"draft-comment-discussion-updates")}},423817:(e,t,s)=>{s.d(t,{J:()=>r});s(581454),s(296540);var o=()=>s(401497),n=()=>s(710149),i=s(474848);function r(e){let t=Math.floor(e.areaHeight/124);0===t&&(t=1);const s=(0,o().IS)((e=>({skeletonRect:{height:8,borderRadius:4,margin:10,backgroundColor:e.lightDividerColor},skeletonCircle:{display:"flex",width:28,height:28,marginInlineEnd:8,backgroundColor:e.lightDividerColor,borderRadius:20},skeletonSection:{display:"flex",width:"100%",margin:20,flexDirection:"row"}})),[8,10,20]),r=[...Array(t)].map(((e,t)=>(0,i.jsxs)("div",{style:s.skeletonSection,children:[(0,i.jsx)(n().A,{style:s.skeletonCircle}),(0,i.jsxs)("div",{style:{width:"80%"},children:[(0,i.jsx)(n().A,{style:{width:"80%",...s.skeletonRect,marginTop:0}}),(0,i.jsx)(n().A,{style:{width:"50%",...s.skeletonRect}}),(0,i.jsx)(n().A,{style:{width:"60%",...s.skeletonRect}}),(0,i.jsx)(n().A,{style:{width:"50%",...s.skeletonRect}})]})]},t)));return(0,i.jsx)("div",{children:r})}},432229:(e,t,s)=>{s.d(t,{P:()=>C});s(581454),s(296540);var o=()=>s(560198),n=()=>s(401497),i=()=>s(699143),r=()=>s(718827),l=()=>s(252291),a=()=>s(406094),d=()=>s(631524),c=()=>s(493552),u=()=>s(995847),m=()=>s(460292),p=s(474848);function g(e){const t=(0,n().IS)((e=>({background:{position:"absolute",top:8,insetInlineEnd:8,width:24,height:24,borderRadius:"100%",background:e.background.accentPrimary},button:{width:"100%",height:"100%",borderRadius:"100%",display:"flex",justifyContent:"center",alignItems:"center",background:"transparent"},hovered:{background:e.buttonHoveredBackground},pressed:{background:e.buttonPressedBackground}})),[]);return(0,p.jsx)("div",{style:t.background,children:(0,p.jsx)(r().Ay,{onClick:e.onClick,style:t.button,hoveredStyle:t.hovered,pressedStyle:t.pressed,children:(0,p.jsx)(l().I,{icon:u().xMarkSmallIcon,size:"sm",colorVariant:"primary"})})})}function h(e){const{text:t,onClick:s}=e,o=(0,n().IS)((e=>({button:{height:28,padding:"0 8px",borderRadius:6,borderWidth:1,borderColor:e.border.primary,borderStyle:"solid"}})),[]);return(0,p.jsx)(a().A,{size:"lg",onClick:s,style:o.button,children:(0,p.jsx)(c().D,{styleKey:"Caption/Medium",colorVariant:"primary",children:t})})}function y(e){const{text:t,onClick:s}=e;return(0,p.jsx)(d().p,{onClick:s,children:(0,p.jsx)(c().D,{styleKey:"Caption/Medium",colorVariant:"secondary",children:t})})}function b(e){const{text:t,onClick:s}=e,o=(0,n().IS)((()=>({button:{height:28,padding:"4px 8px"}})),[]);return(0,p.jsx)(a().A,{size:"lg",onClick:s,style:o.button,children:(0,p.jsx)(c().D,{styleKey:"Caption/Medium",colorVariant:"primary",children:t})})}function f(e){const{button:t}=e;return(0,p.jsx)(b,{...t})}function S(e){const{primary:t,secondary:s}=e;return(0,p.jsxs)(i().Y1,{direction:"horizontal",gap:8,align:"center-left",children:[(0,p.jsx)(h,{...t}),s?(0,p.jsx)(y,{...s}):void 0]})}function v(e){const{primary:t}=e;return(0,p.jsx)(i().Y1,{direction:"horizontal",gap:8,align:"center-right",children:(0,p.jsx)(h,{...t})})}function x(e){const{numDots:t,activeDot:s}=e,o=(0,n().IS)((e=>({dot:{width:6,height:6,borderRadius:"100%",background:e.icon.quaternary},active:{background:e.icon.primary}})),[]),r=new Array(t).fill(0).map(((e,t)=>{const n=t===s?{...o.dot,...o.active}:o.dot;return(0,p.jsx)("div",{style:n},t)}));return(0,p.jsx)(i().Y1,{direction:"horizontal",gap:8,children:r})}function A(e){const{button:t,numStages:s,stage:o}=e;return(0,p.jsxs)(i().Y1,{direction:"horizontal",gap:"auto",align:"center",children:[(0,p.jsx)(x,{numDots:s,activeDot:o}),(0,p.jsx)(h,{...t})]})}function k(e){const{alt:t,src:s,type:o}=e,i=(0,n().IS)((()=>({media:{width:"100%",height:"auto",borderRadius:2}})),[]);return"image"===o?(0,p.jsx)("img",{src:s,style:i.media,alt:t}):(0,p.jsx)("video",{title:t,src:s,style:i.media,autoPlay:!0,playsInline:!0,muted:!0,loop:!0,controls:!1})}function j(e){const{onDismiss:t,buttonsProps:s,icon:o,title:r,media:l,body:a,badge:d}=e,u=(0,n().IS)((e=>({card:{borderWidth:1,borderColor:e.border.secondary,borderStyle:"solid",background:e.background.accentPrimary,backdropFilter:"blur(15px)",WebkitBackdropFilter:"blur(15px)",padding:12,width:280},title:{paddingInlineEnd:24},icon:{paddingBottom:2}})),[]);let h,y,b,x,j;if(s)switch(s.type){case"carousel":h=(0,p.jsx)(A,{...s});break;case"full-width":h=(0,p.jsx)(f,{...s});break;case"left-aligned":h=(0,p.jsx)(S,{...s});break;case"right-aligned":h=(0,p.jsx)(v,{...s})}return o&&(y=(0,p.jsx)(m().Q,{iconGroup:o,variantName:"small",colorVariant:"primary",style:u.icon})),r&&(b=(0,p.jsx)("div",{style:u.title,children:(0,p.jsxs)(c().D,{styleKey:"Caption/Semibold",colorVariant:"inversePrimary",children:[r,d]})})),a&&(x=(0,p.jsx)(c().D,{styleKey:"Caption/Regular",colorVariant:"primary",children:a})),l&&(j=(0,p.jsx)(k,{...l})),(0,p.jsxs)(i().Y1,{style:u.card,borderRadius:8,gap:8,children:[(0,p.jsxs)(i().Y1,{gap:2,children:[y,b,x]}),j,h,(0,p.jsx)(g,{onClick:t})]})}function C(e){return(0,p.jsx)(o().wX,{mode:"dark",children:(0,p.jsx)(j,{...e})})}},473541:(e,t,s)=>{s.d(t,{w:()=>n});s(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"5.87 3.72 7.16 12.56",directional:!0,svg:(0,s(474848).jsx)("path",{d:"M6.131 9.381a.875.875 0 0 0 0 1.238l5.4 5.4a.875.875 0 1 0 1.238-1.238L7.987 10l4.782-4.781A.875.875 0 0 0 11.53 3.98z"})},n=(0,s(340498).wt)("arrowChevronSingleLeftFill",o)},694956:(e,t,s)=>{s.r(t),s.d(t,{filterFillIcon:()=>n,iconDefinition:()=>o});s(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"2.12 4.62 15.76 10.75",svg:(0,s(474848).jsx)("path",{d:"M3 4.625a.875.875 0 1 0 0 1.75h14a.875.875 0 0 0 0-1.75zm2.125 6.242h9.75a.875.875 0 0 0 0-1.75h-9.75a.875.875 0 1 0 0 1.75m1.25 3.633c0-.483.392-.875.875-.875h5.5a.875.875 0 0 1 0 1.75h-5.5a.875.875 0 0 1-.875-.875"})},n=(0,s(340498).wt)("filterFill",o)},809020:(e,t,s)=>{s.d(t,{R:()=>Je});s(944114),s(517642),s(658004),s(733853),s(845876),s(432475),s(515024),s(731698),s(898992),s(354520),s(430670),s(581454),s(737550);var o=s(296540),n=()=>s(564884),i=()=>s(726637),r=()=>s(484714),l=()=>s(56366),a=()=>s(401497),d=()=>s(611648),c=()=>s(779315),u=()=>s(252291),m=()=>s(869190),p=()=>s(416504),g=()=>s(473541),h=()=>s(297813),y=()=>s(798880),b=()=>s(175947),f=()=>s(69708),S=()=>s(496603),v=()=>s(774733),x=()=>s(789557),A=()=>s(938045),k=()=>s(273321),j=()=>s(22426),C=()=>s(473975),M=()=>s(655236),D=()=>s(94953),I=()=>s(555776),F=()=>s(116008),B=()=>s(285790),w=()=>s(404277),T=()=>s(939740),R=()=>s(2143),_=()=>s(284371),E=()=>s(38337),O=()=>s(131448),P=()=>s(123021),K=(s(672577),()=>s(729108)),z=()=>s(631524),L=()=>s(764880),W=()=>s(589407),U=()=>s(694956),H=()=>s(835607),V=()=>s(534177),N=()=>s(899963),Y=()=>s(760217),$=()=>s(406699),G=()=>s(678553),q=()=>s(89924),J=()=>s(859428),Z=()=>s(125565),X=()=>s(457688),Q=()=>s(722872),ee=()=>s(869562),te=()=>s(883497),se=()=>s(737230),oe=s(474848);const ne=["comments","suggestions"],ie=["unresolved","unread","read","resolved"],re=(0,f().YK)({unresolved:{id:"updateSidebar.comments.mode.unresolvedOption",defaultMessage:"Open"},resolved:{id:"updateSidebar.comments.mode.resolvedOption",defaultMessage:"Resolved"},commentsAndSuggestions:{id:"updateSidebar.comments.typeMode.commentsAndSuggestions",defaultMessage:"Any"},comments:{id:"updateSidebar.comments.typeMode.comments",defaultMessage:"Comments only"},suggestions:{id:"updateSidebar.comments.typeMode.suggestions",defaultMessage:"Suggestions only"},read:{id:"updateSidebar.comments.readFilter.read",defaultMessage:"Read"},unread:{id:"updateSidebar.comments.readFilter.unread",defaultMessage:"Unread"},none:{id:"updateSidebar.comments.mode.none",defaultMessage:"Apply filters to see discussions"}}),le=(0,f().YK)({commentsAndSuggestions:{id:"updateSidebar.comments.typeMode.commentsAndSuggestionsCheckbox",defaultMessage:"Any"},comments:{id:"updateSidebar.comments.typeMode.commentsCheckbox",defaultMessage:"Comments"},suggestions:{id:"updateSidebar.comments.typeMode.suggestionsCheckbox",defaultMessage:"Suggestions"}}),ae=(0,f().YK)({filterLabel:{id:"updateSidebar.comments.filter.label",defaultMessage:"Filter"}});function de(e,t,s,o,n){if(t)return e;const{items:i}=e;if(i.length<=6)return e;const r=[...i.slice(0,5),{key:"show more",render:e=>(0,oe.jsx)(Y().A,{...e,icon:(0,W().ellipsisIcon)(n.showMoreResultsButton),title:(0,oe.jsx)("span",{style:n.showMoreResultsButtonTitle,children:(0,oe.jsx)(f().sA,{defaultMessage:"{numberMore} more results",id:"updateSidebar.comments.filter.byPerson.showMoreResultsButton.title",values:{numberMore:i.length-5}})})}),action:()=>{s(!0)}}];return{...e,items:r}}function ce(e){const{numCommenters:t,userActorsForDisplay:s,actorsForFilter:o,setActorsForFilter:n,onMobileClose:l,currentTypeMode:d,currentDiscussionStatusFilters:c,popupOpen:m,setPopupOpen:p,peopleFilterExpanded:g,setPeopleFilterExpanded:y}=e,b=(0,f().tz)(),S=(0,r().v3)(),v=Boolean(i().A.isMobile),x=(0,a().IS)((e=>({anyoneMenuItemMobileIconStyles:{width:G().nd},showMoreResultsButton:{width:16,fill:e.text.secondary},showMoreResultsButtonTitle:{color:e.text.secondary},menuList:{minWidth:v?void 0:272},left:{marginInlineEnd:v?12:0},checkbox:{pointerEvents:"none"}})),[v]),A=ne.map((e=>({key:e,render:t=>(0,oe.jsx)(Y().A,{...t,left:(0,oe.jsx)(K().S,{checked:d===e||"commentsAndSuggestions"===d,size:14,style:x.checkbox}),leftStyle:x.left,title:(0,oe.jsx)(Z().A,{isMobile:v,children:(0,oe.jsx)(f().sA,{...le[e]})})}),action:()=>{"commentsAndSuggestions"===d?ee().setUpdateSidebarCommentsTypeMode("comments"===e?"suggestions":"comments"):"none"===d?ee().setUpdateSidebarCommentsTypeMode(e):d===e?ee().setUpdateSidebarCommentsTypeMode("none"):ee().setUpdateSidebarCommentsTypeMode("commentsAndSuggestions");const t=se().Ay.state.discussionStatusFilters,s=se().Ay.state.commentsTypeMode;N().Fx(S,{new_status_filters_state:t,existing_status_filters_state:t,old_type_filter:d,new_type_filter:s})}}))),k={key:"typeMode",render:e=>(0,oe.jsx)(q().A,{...e,title:(0,oe.jsx)(f().sA,{defaultMessage:"Type",id:"commentFilterMenu.typeSection.heading"})}),items:A},j=ie.map((e=>({key:e,render:t=>{const{read:s,unread:o}=c,n="unread"===e||"read"===e,i="unresolved"===e&&s!==o,r=c[e];return(0,oe.jsx)(Y().A,{...t,title:(0,oe.jsx)(Z().A,{isMobile:v,children:b.formatMessage(re[e])}),left:(0,oe.jsx)(K().S,{checked:i?"partial":r,size:14,style:x.checkbox}),leftStyle:{...x.left,paddingInlineStart:n?8:0}})},action:()=>{const t=e,s=c;c[t]?se().Ay.removeDiscussionFilter(t):se().Ay.addDiscussionFilter(t);const o=se().Ay.state.discussionStatusFilters,n=se().Ay.state.commentsTypeMode;N().Fx(S,{new_status_filters_state:o,existing_status_filters_state:s,old_type_filter:n,new_type_filter:n})}}))),C={key:"commentFilter",render:e=>(0,oe.jsx)(q().A,{...e,topBorder:!0,title:(0,oe.jsx)(f().sA,{defaultMessage:"Status",id:"commentFilterMenu.statusSection.heading"})}),items:j},M={key:"anyone",render:e=>(0,oe.jsx)(Y().A,{...e,title:(0,oe.jsx)(Z().A,{isMobile:v,children:(0,oe.jsx)(f().sA,{defaultMessage:"Anyone",id:"commentFilterMenu.anyoneItem.title"})}),left:(0,oe.jsx)(K().S,{checked:0===o.length,size:14,style:x.checkbox}),icon:(0,oe.jsx)(u().I,{style:x.anyoneMenuItemMobileIconStyles,icon:H().F,colorVariant:"secondary"})}),action:()=>{n([])}},D=s.map((e=>{const t=e.getActorUserId(),s=o.some((e=>e.getActorUserId()===t));if(t){const i={key:t,render:t=>(0,oe.jsx)(X().A,{...t,actor:e,useEmailAsTooltip:!0,left:(0,oe.jsx)(K().S,{checked:s,size:14,style:x.checkbox})}),action:()=>{n(s?o.filter((e=>e.getActorUserId()!==t)):[...o,e])}};return i}})).filter(V().O9),I={key:"personFilter",render:e=>(0,oe.jsx)(q().A,{topBorder:!0,...e,title:(0,oe.jsx)(f().sA,{defaultMessage:"Person",id:"commentFilterMenu.personFilterSection.header"})}),items:v?[M,...D]:1===t?D:[M,...D]},F=(0,oe.jsx)(T().Ay,{style:x.menuList,type:T().Oh.Vertical,initialFocus:void 0,sections:[k,C,v?I:de(I,g,y,0,x)]}),R=(0,a().IS)((e=>({closeButton:{position:"absolute",insetInlineEnd:12,borderRadius:"50%",background:e.background.tertiaryTranslucent}})),[]);return v?(0,oe.jsx)(w().A,{menuType:Q().gu.Modal,scrollerStyle:{paddingBottom:0},title:(0,oe.jsx)(f().sA,{defaultMessage:"Filter",id:"commentFilterMenu.title"}),right:(0,oe.jsx)(B().A,{icon:h().xMarkFillIcon,onClick:()=>{l(),p(!1)},style:R.closeButton,ariaLabel:b.formatMessage({id:"updateSidebar.header.closeLabel",defaultMessage:"Close"})}),onClickRight:()=>{l(),p(!1)},children:F}):F}function ue({userActors:e,actorsForFilter:t,setActorsForFilter:s}){const n=(0,r().Y0)(),d=(0,f().tz)(),c=(0,l().K8)((()=>se().Ay.state.expanded),[]),u=(0,l().K8)((()=>te().A.state.open),[]),m=Boolean(i().A.isMobile),p=(0,l().K8)((()=>{let o=[...e];return t.length>0&&!o.find((e=>t.some((t=>t.getActorUserId()===e.getActorUserId()))))&&(m?s([]):o=[...t,...o]),o.sort(((e,t)=>{const s=(0,L().lR)(d,e),o=(0,L().lR)(d,t);return s&&o?s.localeCompare(o):0})),o}),[d,t,e,s,m]),[g,h]=(0,o.useState)(!1),[y,b]=(0,o.useState)(!1),{currentTypeMode:S,discussionStatusFilters:v}=(0,l().K8)((()=>({currentTypeMode:se().Ay.state.commentsTypeMode,discussionStatusFilters:se().Ay.state.discussionStatusFilters})),[]),x=(0,a().IS)((e=>({toggleButton:{justifyContent:"center",display:"flex",color:e.text.secondary,margin:0},toggleButtonContainer:{paddingInlineEnd:0,display:"flex"}})),[]),A=(0,oe.jsx)(f().sA,{...ae.filterLabel});return(0,o.useEffect)((()=>{m||c?m&&!u&&(ee().setUpdateSidebarCommentsMode("unresolved"),s([])):(ee().setUpdateSidebarCommentsMode("unresolved"),s([]),b(!1))}),[u,s,c,m]),(0,oe.jsx)($().A,{open:g,originGap:0,popupType:m?$().z.BottomSheet:$().z.Popup,bottomSheetInitialState:n.isTablet?"half":"full",renderOrigin:e=>(0,oe.jsx)(J().A,{...e,placement:"bottom",renderTooltip:()=>A,render:e=>(0,oe.jsx)("div",{style:x.toggleButtonContainer,className:E().kJD,children:(0,oe.jsx)(z().p,{...e,style:x.toggleButton,onClick:()=>{h(!0)},size:"sm",iconLeading:{icon:U().filterFillIcon,size:m?18:"default",colorPalette:"blue",colorVariant:"accentPrimary"}})})}),placementToOrigin:"bottom",alignmentToOrigin:"center",render:o=>(0,oe.jsx)(ce,{userActorsForDisplay:p,actorsForFilter:t,setActorsForFilter:s,onMobileClose:()=>o.close(),currentTypeMode:S,currentDiscussionStatusFilters:v,popupOpen:g,setPopupOpen:h,peopleFilterExpanded:y,setPeopleFilterExpanded:b,numCommenters:e.length}),onClose:()=>{h(!1)}})}var me=()=>s(765957),pe=()=>s(463830);const ge=(0,s(340498).xh)("megaphone",{default:{loader:()=>s.e(83433).then(s.bind(s,523277))},small:{loader:()=>s.e(83433).then(s.bind(s,994480))},fill:{loader:()=>s.e(83433).then(s.bind(s,136936))},fillSmall:{loader:()=>s.e(83433).then(s.bind(s,559471))}},["broadcast","loud","speaker","horn"]);var he=()=>s(432229),ye=()=>s(417392),be=()=>s(612900),fe=()=>s(735824),Se=()=>s(300789),ve=()=>s(51367);const xe=(0,f().YK)({title:{defaultMessage:"Updated comments & suggestions",id:"GetNotifiedOnboardingTooltip.title"},body:{defaultMessage:"Better filters and notification settings to help you get through feedback",id:"GetNotifiedOnboardingTooltip.body"},button:{defaultMessage:"Got it",id:"GetNotifiedOnboardingTooltip.button"}});function Ae({children:e}){const t=(0,r().v3)(),s=(0,f().tz)(),n=(0,o.useRef)(null),i=(0,fe().r)({getElement:()=>n.current}),d=(0,l().K8)((()=>O().default.isVisible("get_notified_onboarding_tooltip")),[]),c=(0,o.useCallback)((()=>{(0,ve().Sq)(t,{callout_key:"get_notified_onboarding_tooltip",placement_key:"Tooltip",dismiss_type:"tooltip_dismiss"}),(0,Se().a)(t,"get_notified_onboarding_tooltip")}),[t]),u=(0,o.useCallback)((()=>{(0,ve().Y5)(t,{callout_key:"get_notified_onboarding_tooltip",placement_key:"Tooltip",click_type:"primary_cta"}),c()}),[t,c]),m=(0,a().IS)((e=>({buttonWrapper:{position:"relative"},buttonHalo:{position:"absolute",top:-1,insetInlineStart:1},buttonHaloPlaceholder:i?{width:i.width,height:i.height+2}:{}})),[i]);(0,o.useEffect)((()=>{d&&Boolean(i)&&(0,ve().DL)(t,{callout_key:"get_notified_onboarding_tooltip",placement_key:"Tooltip"})}),[d,i,t]);const p=Boolean(i)&&d;return(0,oe.jsxs)(oe.Fragment,{children:[(0,oe.jsxs)("div",{style:m.buttonWrapper,children:[(0,oe.jsx)("div",{style:m.buttonHalo,children:(0,oe.jsx)(be().u,{shape:"square",borderRadius:6,children:(0,oe.jsx)("div",{style:m.buttonHaloPlaceholder})})}),(0,oe.jsx)("div",{ref:n,children:e})]}),(0,oe.jsx)(ye().Ay,{popupType:ye().nl.Popup,open:p,originRect:i,placementToOrigin:"bottom",alignmentToOrigin:"end",originGap:6,preventCaptureEsc:!0,preventPointerEvents:!1,enableOutsideClickDismiss:!1,trapFocus:!1,disableContentScroll:!1,disableMouseCapture:!0,render:()=>(0,oe.jsx)(he().P,{title:s.formatMessage(xe.title),body:s.formatMessage(xe.body),icon:ge,buttonsProps:{type:"full-width",button:{text:s.formatMessage(xe.button),onClick:u}},onDismiss:c})})]})}function ke({userActors:e,actorsForFilter:t,setActorsForFilter:s}){const o=(0,a().IS)((e=>({container:{display:"flex",flexDirection:"column",borderBottom:`1px solid ${e.regularDividerColor}`},commentsHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",pointerEvents:"auto"},label:{lineHeight:"inherit",fontSize:14,color:e.text.primary,fontWeight:_().Wy.medium,display:"flex",alignItems:"center",margin:0,paddingTop:12,paddingInlineEnd:12,paddingBottom:12,paddingInlineStart:16},actionButtonsContainer:{paddingInlineEnd:16}})),[]),n=(0,l().O$)(me().AppStoreMainEditorCurrentBlockStore),i=(0,l().uB)(void 0,pe().A),r=(0,l().K8)((()=>O().default.isVisible("get_notified_onboarding_tooltip")),[]);return(0,oe.jsx)("div",{style:o.container,children:(0,oe.jsxs)("div",{style:o.commentsHeader,className:E().S4C,children:[(0,oe.jsx)("h2",{style:o.label,children:(0,oe.jsx)(f().sA,{id:"topbarCommentsDesktop.header.discussionsLabel",defaultMessage:"All discussions"})}),(0,oe.jsx)("div",{style:o.actionButtonsContainer,children:r&&n?(0,oe.jsx)(Ae,{children:(0,oe.jsx)(je,{buttonPopupStore:i,userActors:e,actorsForFilter:t,setActorsForFilter:s})}):(0,oe.jsx)(je,{buttonPopupStore:i,userActors:e,actorsForFilter:t,setActorsForFilter:s})})]})})}function je({buttonPopupStore:e,userActors:t,actorsForFilter:s,setActorsForFilter:o}){const n=(0,a().IS)((e=>({actionButtons:{display:"flex",alignItems:"center",gap:4}})),[]),i=(0,l().O$)(me().AppStoreMainEditorCurrentBlockStore);return(0,oe.jsxs)("div",{style:n.actionButtons,children:[(0,oe.jsx)(ue,{userActors:t,actorsForFilter:s,setActorsForFilter:o}),i?(0,oe.jsx)(P().O,{blockStore:i,from:"comments_sidebar",buttonPopupStore:e,renderType:"button"}):null]})}var Ce=()=>s(972435),Me=()=>s(299545),De=()=>s(953418),Ie=()=>s(645873),Fe=()=>s(644914),Be=()=>s(372154),we=()=>s(546574),Te=()=>s(200688),Re=()=>s(406094),_e=()=>s(859002),Ee=()=>s(170350),Oe=()=>s(449195),Pe=()=>s(261358),Ke=()=>s(693202);function ze(e){const{hasOpenDiscussions:t,hasResolvedDiscussions:s}=e,n=(0,a().IS)((e=>({addCommentButton:{borderRadius:6}})),[]),i=(0,o.useCallback)((()=>{ee().setUpdateSidebarCommentsTypeMode("commentsAndSuggestions"),se().Ay.setToOpenDiscussionsFilters()}),[]),r=(0,o.useCallback)((()=>{ee().setUpdateSidebarCommentsTypeMode("commentsAndSuggestions"),se().Ay.setToResolvedDiscussionsFilters()}),[]);return t?(0,oe.jsx)(Re().A,{size:"lg",onClick:i,style:n.addCommentButton,children:(0,oe.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyCommentsShowOpenButton",defaultMessage:"Show all open"})}):s?(0,oe.jsx)(Re().A,{size:"lg",onClick:r,style:n.addCommentButton,children:(0,oe.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyCommentsShowResolvedButton",defaultMessage:"Show all resolved"})}):null}function Le(e){const{environment:t,device:s,navigableBlockStore:o,hasOpenDiscussions:n,hasResolvedDiscussions:i}=e,r=n||i,d=(0,l().K8)((()=>{if(s.isMobile)return!1;if(!t.currentUser.isLoggedIn())return!1;if(null==o||!o.canComment())return!1;const e=function(){const e=Ke().default.hasSelection()&&Ke().default.state.multiSelection&&(0,Pe().Y2)(Ke().default.state.multiSelection.start.store);return e&&"block"===e.table?e:void 0}();return!!(e&&"page"!==e.getType()||"section_hide"!==(0,Oe().Rn)())}),[s.isMobile,t.currentUser,o]),c=(0,a().IS)((e=>({commentsEmptyStyle:{flex:1,display:"flex",gap:2,alignItems:"center",justifyContent:"center",flexDirection:"column",textAlign:"center",fontSize:14,position:"relative",background:e.background.primary,marginInlineEnd:0,pointerEvents:"auto",paddingTop:10,marginTop:s.isPhone?80:void 0},commentsContainerMessage:{fontWeight:_().Wy.semibold,color:e.text.secondary,marginTop:4},commentsContainerSecondaryMessage:{fontWeight:_().Wy.regular,color:e.text.secondary,marginBottom:14},commentsContentStyle:{position:"relative",minHeight:0,display:"flex",flexDirection:"column",background:e.background.primary,marginInlineEnd:0,pointerEvents:"auto",height:"100%"}})),[s.isPhone]);return(0,oe.jsx)("div",{style:c.commentsContentStyle,children:(0,oe.jsxs)("div",{style:c.commentsEmptyStyle,children:[r?(0,oe.jsx)(u().I,{icon:Ee().filterIcon,size:"xl",colorVariant:"secondary"}):(0,oe.jsx)(u().I,{icon:_e().chatIcon,size:"xl",colorVariant:"secondary"}),(0,oe.jsx)("div",{style:c.commentsContainerMessage,children:(0,oe.jsx)(Ue,{hasOpenDiscussions:n,hasResolvedDiscussions:i})}),(0,oe.jsx)("div",{style:c.commentsContainerSecondaryMessage,children:(0,oe.jsx)(We,{hasOpenDiscussions:n??!1,hasResolvedDiscussions:i??!1})}),d?(0,oe.jsx)(ze,{hasOpenDiscussions:n,hasResolvedDiscussions:i}):null]})})}function We({hasOpenDiscussions:e,hasResolvedDiscussions:t}){return e?(0,oe.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyButHasOpenComments",defaultMessage:"There are open threads on this page"}):t?(0,oe.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyButHaResolvedComments",defaultMessage:"There are resolved threads on this page"}):null}function Ue({hasOpenDiscussions:e,hasResolvedDiscussions:t}){return e||t?(0,oe.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyDiscussionsFromFilters",defaultMessage:"Apply filters to see discussions"}):(0,oe.jsx)(f().sA,{id:"updateSidebar.commentContainer.emptyNoDiscussions",defaultMessage:"No discussions"})}const He=o.forwardRef((function(e,t){const{currentBlockStore:n,discussionStore:i,showAllRepliesAfterTimestamp:d,focused:c,isLast:u,location:m}=e,p=(0,l().K8)((()=>Be().A.state.open&&Be().A.state.discussionIds||[]),[]),g=(0,r().v3)();(0,o.useEffect)((()=>{var e;if(c){D().A.setState({source:"update_sidebar",discussionIds:[i.id]});const e=setTimeout((()=>{var e;(null===(e=D().A.state)||void 0===e||null===(e=e.discussionIds)||void 0===e?void 0:e[0])===i.id&&we().A.markDiscussionsInteractedWith([i.id])}),1500);return()=>{clearTimeout(e)}}(null===(e=D().A.state)||void 0===e||null===(e=e.discussionIds)||void 0===e?void 0:e[0])===i.id&&D().A.setState({discussionIds:[]})}),[c,i,g]);const h=(0,l().K8)((()=>{var e;return(null===(e=D().A.state)||void 0===e?void 0:e.discussionIds)||[]}),[]),y=i.id,{parentId:b,currentSpaceId:f}=(0,l().K8)((()=>({parentId:i.getParentId(),currentSpaceId:i.getSpaceId()})),[i]),S=b?s(148832).B.createChildStore(i,{table:s(179034).ev,id:b}):void 0,x=p.includes(y),A=h.includes(y),k=(0,a().IS)((e=>({discussionContainer:{paddingTop:g.device.isMobile?4:6,borderBottom:u||g.device.isMobile?void 0:`1px solid ${e.regularDividerColor}`,transition:"background 300ms ease"},hoveredStyle:{background:"sidebar"===m?e.hoveredDiscussionBackground:void 0},pressedStyle:{background:"sidebar"===m?e.focusDiscussionBackground:void 0},menuStyle:{marginInlineStart:-12,marginInlineEnd:-12,width:"calc(100% + 28px)",lineHeight:void 0,cursor:"pointer"}})),[g.device.isMobile,u,m]),{value:j}=(0,Ie().fJ)(v().commentsDependency);if(!j)return null;if(!S||!f)return null;const C=(0,oe.jsx)("div",{className:`sidebar-discussion-${y} ${E()._57}`,onClick:e.onClick,onMouseEnter:e.onMouseEnter,ref:t,style:{...k.discussionContainer,...A?k.hoveredStyle:{},...x?k.pressedStyle:{}},children:(0,oe.jsx)(v().PW,{store:i,blockStore:n,format:j.discussionHelpers.DiscussionFormat.Sidebar,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"updates_sidebar",showAllRepliesAfterTimestamp:d})});return(0,oe.jsx)(G().Ay,{allowTextSelection:!0,title:C,style:k.menuStyle})}));function Ve(e){const{firstItemId:t,ignoreFirstItemState:s}=e,o=(0,r().Y0)(),n=(0,l().K8)((()=>{var e;return!s&&(Boolean(t)&&(null===(e=D().A.state)||void 0===e?void 0:e.discussionIds.some((e=>e===t))))}),[t,s]),i=(0,l().K8)((()=>!s&&(Be().A.state.open&&Be().A.state.discussionIds&&Be().A.state.discussionIds.some((e=>e===t)))),[t,s]),d=(0,a().IS)((t=>({hoveredStyle:{background:"sidebar"===e.location?t.hoveredDiscussionBackground:void 0},pressedStyle:{background:"sidebar"===e.location?t.focusDiscussionBackground:void 0},basicDesktopTitleStyle:{paddingInlineStart:16,paddingTop:16,marginBottom:0,marginTop:0,fontSize:12,transition:"background 300ms ease"},mobileTitleStyle:{fontSize:13,fontWeight:_().Wy.medium,paddingBottom:0,textTransform:"unset",marginTop:o.isPhone?0:-12}})),[e.location,o.isPhone]);return(0,oe.jsx)(q().A,{desktopTitleStyle:{...d.basicDesktopTitleStyle,...n?d.hoveredStyle:{},...i?d.pressedStyle:{}},mobileTitleStyle:d.mobileTitleStyle,disableDesktopPadding:!0,disableMobileBorders:!0,...e})}function Ne(e){const t=(0,l().K8)((()=>I().A.state.isHovered),[]),s=(0,l().K8)((()=>I().A.state.isActivelyComposing),[]),o=(0,a().IS)((e=>({hoveredStyle:{background:e.hoveredDiscussionBackground},pressedStyle:{background:e.focusDiscussionBackground},basicDesktopTitleStyle:{paddingInlineStart:16,paddingTop:16,marginBottom:0,marginTop:0,fontSize:12,transition:"background 300ms ease"},mobileTitleStyle:{fontSize:13,fontWeight:_().Wy.medium,paddingBottom:0,textTransform:"unset",marginTop:-12}})),[]);return(0,oe.jsx)(q().A,{desktopTitleStyle:{...o.basicDesktopTitleStyle,...t?o.hoveredStyle:{},...s?o.pressedStyle:{}},mobileTitleStyle:o.mobileTitleStyle,disableDesktopPadding:!0,disableMobileBorders:!0,...e})}var Ye=()=>s(423817);const $e=new(s(970585).A),Ge=50;function qe(e){c().A.UpdateSidebarCommentScroller=e}function Je(e){const{timeViewed:t,location:s}=e,c=(0,r().v3)(),_=(0,r().Y0)(),O=(0,f().tz)(),P=Boolean(i().A.isMobile),[K,z]=(0,o.useState)(!1),[L,W]=(0,o.useState)([]),U=(0,l().O$)(me().AppStoreMainEditorCurrentBlockStore),H=c.currentUser.id,{value:V}=(0,Ie().fJ)(v().commentsDependency),N=(0,Te().S)(U,t),{currentCommentsMode:Y,currentCommentsType:$,activeDiscussionStore:G,hasActiveDraftComment:q}=(0,l().K8)((()=>({currentCommentsMode:se().Ay.state.commentsMode,currentCommentsType:se().Ay.state.commentsTypeMode,activeDiscussionStore:se().Ay.state.activeDiscussionStore,hasActiveDraftComment:se().Ay.state.hasActiveDraftComment})),[]),J=(0,l().K8)((()=>(0,Fe().me)(c)),[c]),Z=(0,l().K8)((()=>{const e=!("comments"!==$&&"commentsAndSuggestions"!==$||"unresolved"!==Y&&"anyResolution"!==Y),t=(F().A.hasContent()||I().A.state.isActivelyComposing)&&F().A.isDraftCommentOnValidSelection();return(J||P)&&t&&e&&F().A.ifPropertyCommentShouldDisplay()}),[Y,$,P,J]),X=(0,l().K8)((()=>Be().A.getOpenDiscussionIds()),[]),{discussionStoresFilteredByTypeAndModeAndReadStatus:ee,hasOpenDiscussions:ne,hasResolvedDiscussions:ie}=(0,l().K8)((()=>{const e="commentsAndSuggestions"===$?N:"none"===$?[]:N.filter((e=>e.getType()===se().zX[$])),t=se().Ay.state.discussionStatusFilters;return{hasOpenDiscussions:N.some((e=>!e.getResolved())),hasResolvedDiscussions:N.some((e=>e.getResolved())),discussionStoresFilteredByTypeAndModeAndReadStatus:e.filter((e=>{const{read:s,unread:o,resolved:n}=t,i=(0,M().s)({discussionStore:e,navigableBlockStore:U});return s&&!i&&!e.getResolved()||o&&i||n&&e.getResolved()}))}}),[N,$,U]),re=ee.map((e=>e.id)),le=(0,l().K8)((()=>{if(L.length>0){const e=new Set(L.map((e=>e.getActorUserId())));return ee.filter((t=>(0,Me().wc)(t).flatMap((e=>{const t=e.getCreatedByPointer();return(null==t?void 0:t.table)===y().oo?[t.id]:[]})).some((t=>e.has(t)))))}return ee}),[ee,L]),ae=(0,l().K8)((()=>(0,C().getSetOfUsersInDiscussions)(ee)),[ee]);(0,o.useEffect)((()=>{if("popup"===s&&K)return()=>{we().A.markDiscussionsInteractedWith(re)}}),[s,re,K]);const de=(0,a().IS)((e=>({commentsContentStyle:{position:"relative",minHeight:0,display:"flex",flexDirection:"column",background:e.background.primary,marginInlineEnd:0,pointerEvents:"auto",height:"100%"},scrollerStyle:{flexGrow:1,minHeight:0,transform:"translateZ(0px)",zIndex:1,overflow:"hidden auto",marginBottom:0},closeButton:{position:"absolute",insetInlineEnd:12,borderRadius:"50%",background:e.background.tertiaryTranslucent},menuList:{display:"flex",flexDirection:"column",gap:10},topbar:{marginBottom:_.isPhone&&G?4:-3}})),[G,_.isPhone]),ce=(0,o.useRef)(null),pe=(0,l().K8)((()=>{if(!V)return{};const e=S().$z(le,(e=>{const s=V.discussionHelpers.getLatestRelevantComment({recordStore:e,currentUserId:H,timestamp:t});return s?(0,m().aD)(s.getCreatedTime()):""}));return delete e[""],e}),[V,le,t,H]),ge=(0,l().K8)((()=>!V||V.discussionHelpers.anyDiscussionCommentsLoading(le)),[V,le]);(0,o.useEffect)((()=>{K||ge||z(!0)}),[K,ge]);const he=(0,o.useCallback)((()=>{I().A.setHoverWithSource("comments_pane"),D().A.reset()}),[]),ye=(0,o.useCallback)((()=>{I().A.resetHoverSource("comments_pane")}),[]),be=(0,l().K8)((()=>I().A.state.isActivelyComposing),[]),fe=(0,l().K8)((()=>te().A.state.source),[]),[Se,ve]=(0,l().K8)((()=>S().jB(le,(e=>(0,M().s)({discussionStore:e,navigableBlockStore:U})))),[le,U]);if(!U||!pe||!K)return(0,oe.jsx)(Ye().J,{areaHeight:window.innerHeight});const xe=(0,m().aD)(Date.now()),Ae=Object.keys(pe).sort().reverse();!Z||0!==Ae.length&&Ae.includes(xe)||Ae.unshift(xe);const je=Ae.map(((e,o)=>{const n=(0,m().ZF)({value:{type:"date",start_date:e},date_format:"relative",userTimeZone:(0,p().P)(),intl:Ce().A.getIntl(),allowRelativeDates:!0}),i=pe[e],r=Z&&e===xe,l=[];r&&l.push({key:"draft-discussion-in-comments-pane",render:e=>(0,oe.jsx)(k().A,{environment:c,shouldShowBottomDividerLine:!(1===Ae.length&&0===(null==i?void 0:i.length)),menuListItemProps:e,shouldExpandDiscussionWidth:!0,onMouseEnter:he,onMouseLeave:ye}),action:()=>{const e=F().A.getDiscussionInputStore();e&&(I().A.setActiveWithSource("comments_pane"),Be().A.reset(),(0,A().x)({currentBlockStore:U,discussionInputStore:e,environment:c,dontAffectCursor:be,animateScroll:!0}))}});const a=i?i.map(((e,n)=>{const l=e.getRecordStoreUIParent()??U,a={key:e.id,render:a=>(0,oe.jsx)(He,{...a,currentBlockStore:l,discussionStore:e,isFirstInSection:0===n&&!r,location:s,isLast:n===i.length-1&&o===Ae.length-1,showAllRepliesAfterTimestamp:t}),action:()=>{var t;be&&I().A.resetAllActiveSources(),x().DZ({discussionStore:e,currentBlockStore:U,environment:c,analyticsFrom:"updates_sidebar",currentEl:ce.current,animateScroll:!0,discussionReadStatus:(0,M().g)({discussionStore:e,navigableBlockStore:null===(t=e.getParentStore())||void 0===t?void 0:t.getNavigableBlockStore()})})}};return a})):[];return l.push(...a),{key:e,render:e=>r?(0,oe.jsx)(Ne,{title:n,...e}):(0,oe.jsx)(Ve,{title:n,firstItemId:i[0].id,location:s,ignoreFirstItemState:r,...e}),items:l}})),Re=je.flatMap((e=>e.items)).findIndex((e=>X.includes(e.key.toString()))),_e=0!==le.length||Z?(0,oe.jsx)(R().H,{type:d().A.Y,style:de.scrollerStyle,className:E().bzV,ref:qe,children:(0,oe.jsx)(T().Ay,{disableKeyboard:!0,store:$e,type:T().Oh.Vertical,initialFocus:Re>=0?Re:void 0,scrollElIntoView:e=>{if(e instanceof Element){const t=e.getBoundingClientRect(),s=b().ek(c.device.isElectronMac),o=window.innerHeight,n=s+Ge,i=o-n;if(t.height>=i)return;const r=t.top>=n&&t.top<=o,l=r&&t.bottom>=o,a=t.bottom>=n&&t.bottom<=o,d=a&&t.top-n<0,u=r||a,m=.4*t.height;l&&Math.abs(t.top-o)<m?(0,De().vq)(e,{edgeDist:o-t.height-n,animate:!0}):d&&Math.abs(t.bottom-n)<m?(0,De().vq)(e,{edgeDist:0,animate:!0}):u||(0,De().vq)(e,{edgeDist:0,animate:!0})}},sections:je})}):(0,oe.jsx)(Le,{environment:c,device:_,navigableBlockStore:U,actorsForFilter:L,hasOpenDiscussions:ne,hasResolvedDiscussions:ie});if(P){const t=async e=>{await x().JO({environment:c,discussionStore:e,currentBlockStore:U,topOffset:160,animate:!0}),se().Ay.update((t=>({...t,activeDiscussionStore:e})))},s=(0,j().sE)({unreadDiscussions:Se,readDiscussions:ve,handleDiscussionClick:t,handleDraftDiscussionClick:()=>{const e=F().A.getDiscussionInputStore();(0,A().x)({currentBlockStore:U,discussionInputStore:e,environment:c,animateScroll:!0,onlyScroll:!0}),se().Ay.update((e=>({...e,hasActiveDraftComment:!0})))},isMobile:!0,hasDraftComment:Boolean(Z)});return(0,oe.jsx)(w().A,{menuType:Q().gu.Modal,title:G?(0,oe.jsx)(f().sA,{defaultMessage:"Discussion",id:"discussionSheet.activeDiscussion.title"}):q?(0,oe.jsx)(f().sA,{defaultMessage:"Draft comment",id:"draftCommentSheet.title"}):(0,oe.jsx)(f().sA,{defaultMessage:"All discussions",id:"discussionsSheet.header.title"}),whiteBackground:!0,onClickLeft:()=>{se().Ay.update((e=>({...e,activeDiscussionStore:void 0,hasActiveDraftComment:!1}))),(0,n().u)({environment:c,event:{eventName:"tap_back_to_new_discussions_sheet",eventProperties:{landed_on_sheet_from:fe}}})},left:G||q?(0,oe.jsx)(u().I,{icon:g().w,colorVariant:"secondary"}):(0,oe.jsx)(ue,{userActors:ae,actorsForFilter:L,setActorsForFilter:W}),right:(0,oe.jsx)(B().A,{icon:h().xMarkFillIcon,onClick:e.onMobileClose,style:de.closeButton,ariaLabel:O.formatMessage({id:"updateSidebar.header.closeLabel",defaultMessage:"Close"})}),topbarStyle:de.topbar,children:G&&V?(0,oe.jsx)(v().PW,{store:G,blockStore:U,format:V.discussionHelpers.DiscussionFormat.Sidebar,isFirst:!0,isOnly:!0,discussionLocation:"updates_sidebar",showResolveButtonByDefaultIfPossible:!0,onDismiss:()=>{se().Ay.update((e=>({...e,activeDiscussionStore:void 0,hasActiveDraftComment:!1})))}}):q?(0,oe.jsx)(k().A,{environment:c,shouldShowBottomDividerLine:!1,shouldExpandDiscussionWidth:!0,onMouseEnter:he,onMouseLeave:ye,onMobileClose:e.onMobileClose}):0===s.length?(0,oe.jsx)(Le,{environment:c,device:_,navigableBlockStore:U,actorsForFilter:L,hasOpenDiscussions:ne,hasResolvedDiscussions:ie}):(0,oe.jsx)(T().Ay,{type:T().Oh.Vertical,sections:s,initialFocus:void 0,style:de.menuList})})}return(0,oe.jsxs)("div",{style:de.commentsContentStyle,ref:ce,children:[(0,oe.jsx)(ke,{userActors:ae,actorsForFilter:L,setActorsForFilter:W}),_e]})}}}]);