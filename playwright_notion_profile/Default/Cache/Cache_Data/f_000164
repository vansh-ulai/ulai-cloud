"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[36359],{68913:(e,t,o)=>{o.r(t),o.d(t,{alarmIcon:()=>n,iconDefinition:()=>a});o(296540);var r=o(474848);const a={viewBox:"0 0 20 20",fittedViewBox:"1.91 0.78 16.18 16.85",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M5.791 1.886a.625.625 0 1 0-.801-.96L2.138 3.31a.625.625 0 1 0 .802.96zm4.834 3.839a.625.625 0 1 0-1.25 0v3.65H6.4a.625.625 0 0 0 0 1.25H10c.345 0 .625-.28.625-.625z"}),(0,r.jsx)("path",{d:"M10 2.375a7.625 7.625 0 1 0 0 15.25 7.625 7.625 0 0 0 0-15.25M3.625 10a6.375 6.375 0 1 1 12.75 0 6.375 6.375 0 0 1-12.75 0M14.13 1.006a.625.625 0 0 0 .079.88l2.851 2.383a.625.625 0 1 0 .802-.96L15.01.927a.625.625 0 0 0-.88.079"})]})},n=(0,o(340498).wt)("alarm",a)},73337:(e,t,o)=>{o.d(t,{P:()=>n});o(296540);var r=o(474848);const a={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.12 16.79 14.42",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M18.507 11.112c.362 0 .655.293.655.656v4.369a.656.656 0 0 1-1.311 0V13.35l-4.997 4.997a.655.655 0 1 1-.927-.928l4.997-4.997h-2.786a.655.655 0 1 1 0-1.31z"}),(0,r.jsx)("path",{d:"M15.5 4.125c1.174 0 2.125.951 2.125 2.125v3.612h-1.25v-.987h-5.75v2.25h1.72a2 2 0 0 0-.103.448l-.01.195.01.195q.024.214.091.412h-1.708v2.25h2.33l-1.25 1.25H4.5a2.125 2.125 0 0 1-2.125-2.125v-7.5c0-1.174.951-2.125 2.125-2.125zM3.625 13.75c0 .483.392.875.875.875h4.875v-2.25h-5.75zm0-2.625h5.75v-2.25h-5.75zm.875-5.75a.875.875 0 0 0-.875.875v1.375h5.75v-2.25zm6.125 2.25h5.75V6.25a.875.875 0 0 0-.875-.875h-4.875z"})]})},n=(0,o(340498).wt)("collectionArrow",a)},173868:(e,t,o)=>{o.d(t,{o:()=>s});o(944114),o(898992),o(354520),o(672577),o(581454);var r=()=>o(898244),a=()=>o(448801),n=()=>o(519831),i=()=>o(496603);function s(e){const{newOptions:t,collectionId:o,property:s,schema:l}=e,p=l[s];if(!p)return;if(!r().lx(p)&&"status"!==p.type)return;const c=p.options||[],d=[],u=i().Bq(t),y=c.map((e=>e.value)),{beforeOps:m}=(0,a().i)(y,u);for(const[r,a]of Object.entries(m)){const e=c.find((e=>e.value===r));if(e)if(a){const t=c.find((e=>e.value===a));if(t){const r={pointer:{table:n().Vl,id:o},command:"keyedObjectListBefore",path:["schema",s,"options"],args:{value:e,before:{id:t.id}}};d.push(r)}}else{const t={pointer:{table:n().Vl,id:o},command:"keyedObjectListAfter",path:["schema",s,"options"],args:{value:e}};d.push(t)}}if("status"===p.type){const e=p.groups??[];for(const[r]of e.entries()){const e=t[r];if(!Array.isArray(e))return;const a=c.filter((t=>e.includes(t.value))).map((e=>e.id)),i={pointer:{table:n().Vl,id:o},command:"set",path:["schema",s,"groups",r,"optionIds"],args:a};d.push(i)}}return d.length>0?d:void 0}},490696:(e,t,o)=>{o.d(t,{C:()=>P});var r=o(296540),a=()=>o(242422),n=()=>o(726637),i=()=>o(484714),s=()=>o(118884),l=()=>o(56366),p=()=>o(708685),c=()=>o(502856),d=()=>o(247331),u=()=>o(239381),y=()=>o(792071),m=()=>o(973647),g=()=>o(193722),h=()=>o(908201),f=()=>o(921855),S=()=>o(476492),v=()=>o(909470),b=()=>o(722872),x=()=>o(152197),j=()=>o(792415),A=()=>o(404277),_=()=>o(20604),C=o(474848);function P(e){var t,o,P,M;const{property:k,disabled:O,formulas:w,getRecordModel:T,propertySchema:B,collectionStore:D,handleSave:I,handleClose:F,blockStore:V,analyticsFrom:L}=e,R=(0,h().ET)(),E=(0,i().v3)(),[K,z]=(0,r.useState)(null==B||null===(t=B.formula2)||void 0===t?void 0:t.code),G=(0,r.useRef)(null===(o=B.formula2)||void 0===o?void 0:o.code),U=(0,r.useRef)(K),H=(0,r.useRef)(null==B||null===(P=B.formula2)||void 0===P?void 0:P.result_type),N=(0,r.useCallback)((e=>{U.current=e,z(e)}),[]),Y=(0,r.useCallback)((e=>{H.current=e}),[]);(0,s().X)((()=>{const e=G.current,t=U.current,o=H.current;if(t!==e||void 0!==ee){I({newValue:t,newType:(0,p().removeFunctionsFromType)(o??{type:"unknown"}),propertySchema:B,collectionStore:D,property:k});const e=(0,f().r4)(t,D);(0,g().L)(E,{...(0,S().sl)(R),property_type:B.type,action:"formula_v2_edit",from:L,formula_char_count:e.length})}}));const $=(0,l().K8)((()=>D.pointer),[D.pointer]),X=(0,r.useMemo)((()=>{const e={type:"block",collection:$};return{kind:d().FormulaContextValueKind.ThisRow,type:e}}),[$]),q=(0,l().K8)((()=>j().A.state.publicPageData),[]),J=(0,x().r)(),W=(0,l().K8)((()=>(0,v().i)()),[]),Z=(0,l().K8)((()=>E.idCreator.getSpaceIdCreatorSync(J??"")),[E.idCreator,J]),Q=(0,r.useMemo)((()=>{if(!J)return;const e=y().h0Y.fromGetRecordModelFn(T);return{sourceProperty:k,valueTypes:[X],handleDataRequest:(0,c().MC)({collectionFeatureGates:W,experimentService:a().default,getRecordModel:T,loadRecordModel:e,spaceIdCreator:Z}),formulaPropertyNames:K&&(0,u().o2)(K),publicPageDataCollection:{id:null==q?void 0:q.collectionId,schema:null==q?void 0:q.collectionSchema},spaceId:J,restrictUnaccessibleProperties:"cross_space_only",featureGates:W}}),[J,T,k,X,K,null==q?void 0:q.collectionId,null==q?void 0:q.collectionSchema,W,Z]),ee=(0,l().K8)((()=>{if("v2"!==B.version&&B.formula)return w.convertCollectionFormulaToFormula2(B.formula,$,D.getSchema())}),[$,D,w,B.formula,B.version]),te=(0,r.useRef)(!1);(0,r.useEffect)((()=>{!async function(){if(!ee||te.current||!Q)return;const e=await w.analyzeFormula(ee,Q);let t;t=m().Q.isFail(e)?{type:"unknown"}:e.value.type??{type:"unknown"},te.current=!0,N(ee),Y(t)}()}),[D,w,N,Y,k,B,ee,Q]);const oe=(0,r.useMemo)((()=>{var e;const t="v2"===B.version?null===(e=B.formula2)||void 0===e?void 0:e.code:ee;return G.current=t,t}),[null===(M=B.formula2)||void 0===M?void 0:M.code,B.version,ee]);return Q&&J?(0,C.jsx)(A().A,{menuType:n().A.isMobile?b().gu.Modal:b().gu.Popup,height:n().A.isMobile?"100%":void 0,hideMobileTopbar:!0,width:n().A.isMobile?void 0:740,disableBottomPadding:!0,maxHeight:"unset",disableHeaderBorder:!0,disableScroller:!0,children:(0,C.jsx)(_().v,{initialCode:oe,formulas:w,getRecordModel:T,disabled:O,parentSpaceId:J,typecheckContext:Q,onCodeChange:N,onTypeChange:Y,handleClose:F,parentCollectionStore:D,autosave:!0,formulaSchema:B,collectionStore:D,blockStore:V})}):null}},539148:(e,t,o)=>{o.d(t,{S:()=>y});o(296540);var r=()=>o(484714),a=()=>o(401497),n=()=>o(718827),i=()=>o(734410),s=()=>o(69708),l=()=>o(859428),p=()=>o(673730),c=()=>o(554283),d=o(474848);const u=(0,s().YK)({addDescriptionTooltip:{id:"database.description.addDescriptionTooltip",defaultMessage:"Add description"},editDescriptionTooltip:{id:"database.description.editDescriptionTooltip",defaultMessage:"Edit description"}});function y({onClick:e,description:t,showTooltip:o,addDescriptionText:y,editDescriptionText:m,disabled:g}){const{isMobile:h}=(0,r().Y0)(),[f,S]=(0,c().B)(),v=(0,s().tz)(),b=(0,a().IS)((e=>({button:{flexShrink:0,flexGrow:0,borderRadius:h?24:20,marginInlineStart:4},info:{width:h?18:16,height:h?18:16,fill:S&&!g?e.icon.primary:e.icon.secondary}})),[S,h,g]);return(0,d.jsx)(l().A,{renderTooltip:e=>(0,d.jsx)("div",{...e,children:Boolean(null==t?void 0:t.length)?t:y??v.formatMessage(u.addDescriptionTooltip)}),disableTooltip:!o||g,style:p().Q$,placement:"top",render:o=>(0,d.jsx)(n().Ay,{...o,ref:f,onClick:e,"aria-label":Boolean(null==t?void 0:t.length)?y:m??v.formatMessage(u.editDescriptionTooltip),style:b.button,disabled:g,disabledFeedback:g,children:(0,i().q)(b.info)})})}},596359:(e,t,o)=>{o.d(t,{Uk:()=>d,gc:()=>u,r$:()=>m});o(944114),o(898992),o(354520),o(672577),o(430670),o(581454);var r=()=>o(898244),a=()=>o(183558),n=()=>o(831566),i=()=>o(173868),s=()=>o(972435),l=()=>o(878710),p=()=>o(901389),c=()=>o(231297);function d(e){const{modification:t,property:o,propertySchema:i,options:d,groupIndex:u,environment:m,collectionStore:g}=e;let h,f;if("keyedObjectListRemove"===t.type)h={pointer:g.pointer,command:"keyedObjectListRemove",path:["schema",o,"options"],args:{remove:{id:t.id}}},void 0!==u&&"status"===i.type&&(f={pointer:g.pointer,command:"listRemove",path:["schema",o,"groups",u,"optionIds"],args:{id:t.id}});else{if(d){if(d.find((e=>e.value.toLowerCase()===t.newValue.toLowerCase())))return void p().f1(s().A.formatMessage(y.optionAlreadyExists))}if("keyedObjectListUpdate"===t.type)h={pointer:g.pointer,command:"keyedObjectListUpdate",path:["schema",o,"options"],args:{value:{...t.option,value:t.newValue}}};else{const e=i.options||[];let n=(0,r().Zd)(e);if("status"===i.type&&void 0!==u){var S;const e=null===(S=i.groups)||void 0===S||null===(S=S[u])||void 0===S?void 0:S.color;e&&(n=e)}const s={id:(0,a().Ay)(),value:t.newValue,color:n};if("autoSortInsert"===t.type){if(!(0,r().lx)(i))return;h=(0,r().og)({collectionId:g.id,property:o,propertySchema:i,newOption:s,isAscending:"alphabetical"===i.auto_sort_options})}else"keyedObjectListBefore"===t.type?(h={pointer:g.pointer,command:"keyedObjectListBefore",path:["schema",o,"options"],args:{value:s,before:t.beforeOption}},void 0!==u&&"status"===i.type&&(f={pointer:g.pointer,command:"listBefore",path:["schema",o,"groups",u,"optionIds"],args:{id:s.id}})):"keyedObjectListAfter"===t.type&&(h={pointer:g.pointer,command:"keyedObjectListAfter",path:["schema",o,"options"],args:{value:s,after:t.afterOption}},void 0!==u&&"status"===i.type&&(f={pointer:g.pointer,command:"listBefore",path:["schema",o,"groups",u,"optionIds"],args:{id:s.id}}))}}(0,n().p)({environment:m,collectionStore:g,performTransaction:e=>{if(c().applyOperation({store:g,operation:h,transaction:e}),f&&c().applyOperation({store:(0,l().v3)(g,f.pointer),operation:f,transaction:e}),"status"===i.type){const t=i.options??[],r=(i.groups??[]).flatMap((e=>e.optionIds)),a=t.filter((e=>!r.includes(e.id)));for(const n of a)c().applyOperation({store:(0,l().v3)(g,g.pointer),operation:{pointer:g.pointer,command:"listBefore",path:["schema",o,"groups",0,"optionIds"],args:{id:n.id}},transaction:e})}}})}function u(e){const{newValues:t,property:o,schema:a,collectionStore:s,environment:p}=e,d=a[o];let u;if("status"===(null==d?void 0:d.type)){u=[[]];for(const o of t)o.startsWith("group-header-")?u.push([]):u[u.length-1].push(o);const e=((null==d?void 0:d.options)??[]).filter((e=>!t.includes(e.value)));u[0].push(...e.map((e=>e.value)))}else u=t;const y=(0,i().o)({newOptions:u,collectionId:s.id,property:o,schema:a});if(y){if(d&&(0,r().lx)(d)){"manual"!==(d.auto_sort_options||"manual")&&y.push({pointer:s.pointer,command:"update",path:["schema",o],args:{auto_sort_options:"manual"}})}(0,n().p)({environment:p,collectionStore:s,performTransaction:e=>{for(const t of y)c().applyOperation({store:(0,l().v3)(s,t.pointer),operation:t,transaction:e})}})}}const y=(0,o(69708).YK)({deleteModalPrompt:{id:"database.selectPropertyOptionEditMenu.deleteModal.prompt",defaultMessage:"Are you sure you want to delete this option?"},acceptButtonLabel:{id:"database.selectPropertyOptionEditMenu.deleteModal.confirmButton",defaultMessage:"Delete"},preventDefaultStatusOptionDelete:{defaultMessage:"Cannot delete default option.",id:"database.editProperty.errorDialog.forbidDeleteDefaultOption.message"},optionAlreadyExists:{defaultMessage:"Option already exists.",id:"database.optionExistsAlreadyError.message"}});function m(e){const{option:t,propertySchema:o,property:a,collectionStore:n,statusGroup:i,environment:l,deleteMessage:c}=e;"status"!==o.type||t.value!==o.defaultOption?p().ui({showCancel:!0,keepFocus:!1,message:c??s().A.formatMessage(y.deleteModalPrompt),items:[{label:s().A.formatMessage(y.acceptButtonLabel),color:"red",onAccept:()=>{if((0,r().lx)(o)||"status"===o.type)if("status"===o.type&&i){const e=(o.groups??[]).findIndex((e=>e.id===i.id));d({modification:{type:"keyedObjectListRemove",id:t.id},property:a,propertySchema:o,environment:l,collectionStore:n,groupIndex:e})}else d({modification:{type:"keyedObjectListRemove",id:t.id},property:a,propertySchema:o,environment:l,collectionStore:n})}}]}):p().f1(s().A.formatMessage(y.preventDefaultStatusOptionDelete))}},705602:(e,t,o)=>{o.d(t,{s:()=>d,y:()=>y});var r=o(296540),a=()=>o(484714),n=()=>o(401497),i=()=>o(69708),s=()=>o(419357),l=()=>o(89924),p=()=>o(673730),c=o(474848);const d=(0,i().YK)({descriptionHeader:{id:"database.viewSettings.propertyTab.description.title",defaultMessage:"Description"},addDescription:{id:"database.viewSettings.propertyTab.description.addDescription",defaultMessage:"Add a description..."}}),u=60;function y({initialDescription:e,handleSaveDescription:t,disableAutoSection:o}){const[y,m]=(0,r.useState)(e??""),g=(0,r.useRef)(y),{isMobile:h}=(0,a().Y0)(),f=(0,i().tz)(),S=(0,n().IS)((e=>({title:{display:"flex",alignItems:"center",gap:4,cursor:"default",color:e.text.secondary},descriptionInput:{lineHeight:"20px",fontSize:h?14:13}})),[h]),v=(0,r.useCallback)((()=>t(g.current)),[t]);(0,r.useEffect)((()=>()=>v()),[v]);const b=(0,r.useMemo)((()=>(0,c.jsx)(s().Ay,{value:y,onChange:e=>{m(e.target.value),g.current=e.target.value},onBlur:v,onSubmit:v,placeholder:f.formatMessage(d.addDescription),focusInitial:!0,disabled:!1,inputOuterStyle:S.descriptionInput,textarea:!0,textareaSubmitOnEnter:!0,maxlength:p().fy,autosize:!0,autosizeMaxHeight:u,showClearButton:!1})),[y,f,v,S.descriptionInput]);return h&&!o?(0,c.jsx)(l().A,{topBorder:!0,isInput:!0,title:(0,c.jsx)("span",{style:S.title,children:f.formatMessage(d.descriptionHeader)}),children:b}):b}},788621:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>a,personCircleIcon:()=>n});o(296540);var r=o(474848);const a={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.26 15.25",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M7.755 6.169C8.277 5.519 9.05 5.125 10 5.125s1.723.393 2.245 1.044c.51.635.75 1.474.75 2.346s-.24 1.71-.75 2.346c-.522.65-1.294 1.044-2.245 1.044-.95 0-1.723-.394-2.245-1.044-.51-.635-.75-1.474-.75-2.346s.24-1.711.75-2.346m.975.782c-.293.365-.475.909-.475 1.564s.182 1.198.475 1.564c.281.35.694.576 1.27.576s.989-.226 1.27-.576c.294-.366.475-.909.475-1.564s-.181-1.199-.475-1.564c-.281-.35-.693-.576-1.27-.576-.576 0-.989.225-1.27.576"}),(0,r.jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M10 3.625a6.375 6.375 0 0 0-4.087 11.267c.789-1.397 2.333-2.33 4.087-2.33s3.298.933 4.087 2.33A6.375 6.375 0 0 0 10 3.625M13.049 15.6c-.547-1.049-1.697-1.789-3.05-1.789-1.351 0-2.501.74-3.048 1.789a6.35 6.35 0 0 0 3.049.775 6.34 6.34 0 0 0 3.049-.775"})]})},n=(0,o(340498).wt)("personCircle",a)},798174:(e,t,o)=>{o.d(t,{R:()=>N});o(944114),o(898992),o(354520),o(803949);var r=o(296540),a=()=>o(59226),n=()=>o(726637),i=()=>o(484714),s=()=>o(56366),l=()=>o(401497),p=()=>o(952882),c=()=>o(67657),d=()=>o(898244),u=()=>o(713998),y=()=>o(568063),m=()=>o(955363),g=()=>o(668725),h=()=>o(688311),f=()=>o(585639),S=()=>o(69708),v=()=>o(496603),b=()=>o(534177),x=()=>o(314529);function j(e,t){(0,x().DO_NOT_USE_trackLegacy)(e,"configure_rollup_target_property",t)}var A=()=>o(680341),_=()=>o(497222),C=()=>o(908201),P=()=>o(722372),M=()=>o(476492),k=()=>o(722872),O=()=>o(553965),w=()=>o(981342),T=()=>o(463830),B=()=>o(543665),D=()=>o(760217),I=()=>o(406699),F=()=>o(404277),V=()=>o(939740),L=()=>o(45552),R=()=>o(417392),E=()=>o(89924),K=()=>o(859428),z=()=>o(398217),G=()=>o(250202),U=()=>o(150987),H=o(474848);function N({context:e,schema:t,property:o,parentStore:r,onDismiss:p,disabled:c,analyticsFrom:g,onChange:b}){const x=(0,l().DP)(),j=(0,i().v3)(),A=n().A.isMobile,C=(0,s().uB)(void 0,T().A),P=(0,s().uB)(void 0,T().A),M=(0,s().uB)(void 0,T().A),D=(0,a().X)("rollup_on_person_property"),E=(0,a().X)("sfdc_prevent_rollup_edits"),G=(0,w().o7)(),U=(0,s().K8)((()=>function({schema:e,property:t,parentStore:o,PeopleCollectionStore:r}){const a=e[t];if(!a)return;let n,i,s,l={};if("person"===a.rollup_type&&a.person_property){const t=e[a.person_property];if("person"===(null==t?void 0:t.type)&&(n=t),r&&(i=r,l=(0,y().U$)(d().Dp(r.getModel()))),a.target_property)if((0,y().cl)(a.target_property))s=(0,y().dk)(a.target_property);else if(l&&Object.keys(l).length>0){var p;s=l[(null===(p=i)||void 0===p?void 0:p.getMappedProperty(a.target_property))??a.target_property]}}else if(a.relation_property){const t=e[a.relation_property];if("relation"===(null==t?void 0:t.type)){var c;n=t;const e=d().Nv(t);i=e?B().m.createChildStore(o,e):void 0,l=d().Dp(null===(c=i)||void 0===c?void 0:c.getModel())}if(i&&a.target_property){var u;s=l[(null===(u=i)||void 0===u?void 0:u.getMappedProperty(a.target_property))??a.target_property]}}return{propertySchema:a,sourcePropertySchema:n,relatedCollectionStore:i,relatedCollectionSchema:l,targetPropertySchema:s}}({schema:t,property:o,parentStore:r,PeopleCollectionStore:G})),[t,o,r,G]),N=Boolean((null==U?void 0:U.propertySchema)&&(null==U?void 0:U.targetPropertySchema)&&E&&(0,u().rl)(U.propertySchema,t)),q=Boolean((null==U?void 0:U.propertySchema.relation_property)||(null==U?void 0:U.propertySchema.person_property)),J=Boolean(q&&(null==U?void 0:U.propertySchema.target_property)),re=(0,s().K8)((()=>v().oE([Z({environment:j,theme:x,disabled:c||N,sourcePropertySchema:null==U?void 0:U.sourcePropertySchema,analyticsFrom:g,relationButtonPopupStore:M,canSelectPersonProperty:D,onChange:b,schema:t,property:o}),ee({isEnabled:q,environment:j,theme:x,disabled:c||N,renderState:U,analyticsFrom:g,targetPropertyButtonPopupStore:P,onChange:b,schema:t,property:o,parentStore:r}),oe({isEnabled:J,environment:j,theme:x,disabled:c,renderState:U,analyticsFrom:g,aggregationButtonPopupStore:C,onChange:b,schema:t,property:o})])),[j,x,c,N,U,g,M,D,b,t,o,q,P,r,J,C]),ae=(0,s().K8)((()=>C.state.open),[C]),ne=(0,s().K8)((()=>M.state.open),[M]),ie=(0,s().K8)((()=>P.state.open),[P]);if(!U)return null;if("bpvOverlay"===e){let e;return e=A?{menuType:k().gu.Modal,title:U.propertySchema.name,right:(0,H.jsx)(L().DoneMenuText,{}),onClickRight:p}:{menuType:k().gu.Popup},(0,H.jsx)(F().A,{...e,children:(0,H.jsx)(V().Ay,{type:V().Oh.Vertical,initialFocus:void 0,sections:re})})}return(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(I().A,{popupType:A?R().nl.BottomSheet:R().nl.Popup,alignmentToOrigin:"end",renderOrigin:e=>(0,H.jsx)(_().A,{icon:m().arrowDiagonalUpRightIcon,title:D?(0,H.jsx)(S().sA,{defaultMessage:"Source property",id:"database.viewSettings.rollupOptions.sourceProperty"}):(0,H.jsx)(S().sA,{defaultMessage:"Relation",id:"database.viewSettings.rollupOptions.relationProperty"}),disabled:c||N,showChevron:!0,rotateChevron:ne,desktopTitleStyle:{flexShrink:0},rightStyle:{flexShrink:void 0},right:U.sourcePropertySchema?(0,H.jsx)(z().mA,{propertySchema:U.sourcePropertySchema,showIcon:!0}):(0,H.jsx)(S().sA,{id:"database.viewSettings.rollupOptions.selectRelation",defaultMessage:"Select"}),...e}),render:e=>(0,H.jsx)(W,{parent:e,analyticsFrom:g,schema:t,property:o,onChange:b,canSelectPersonProperty:D}),buttonPopupStore:M}),(0,H.jsx)(K().A,{renderTooltip:()=>(0,H.jsx)($,{}),disableTooltip:q,render:e=>(0,H.jsx)(I().A,{popupType:A?R().nl.BottomSheet:R().nl.Popup,alignmentToOrigin:"end",renderOrigin:t=>(0,H.jsx)(_().A,{icon:h().h,title:(0,H.jsx)("span",{style:{...!q&&{color:x.text.secondary}},children:(0,H.jsx)(S().sA,{id:"database.viewSettings.rollupOptions.targetProperty",defaultMessage:"Target property"})}),disabled:!q||c||N,showChevron:!0,rotateChevron:ie,desktopTitleStyle:{flexShrink:0},rightStyle:{flexShrink:void 0},right:q&&U.targetPropertySchema?(0,H.jsx)(z().mA,{propertySchema:U.targetPropertySchema,showIcon:!0}):(0,H.jsx)(S().sA,{id:"database.viewSettings.rollupOptions.selectTargetProperty",defaultMessage:"Select"}),...(0,O().A)(e,t)}),render:e=>(0,H.jsx)(Q,{parent:e,analyticsFrom:g,schema:t,property:o,parentStore:r,onChange:b,renderState:U}),buttonPopupStore:P})}),(0,H.jsx)(K().A,{renderTooltip:()=>(0,H.jsx)(X,{}),disableTooltip:J,render:e=>(0,H.jsx)(I().A,{popupType:A?R().nl.BottomSheet:R().nl.Popup,alignmentToOrigin:"end",renderOrigin:t=>(0,H.jsx)(_().A,{icon:f().v,disabled:!J||c,title:(0,H.jsx)("span",{style:{...!J&&{color:x.text.secondary}},children:(0,H.jsx)(S().sA,{defaultMessage:"Calculate",id:"database.viewSettings.rollupOptions.calculate"})}),showChevron:!0,rotateChevron:ae,desktopTitleStyle:{flexShrink:0},rightStyle:{flexShrink:void 0},right:J&&(0,H.jsx)(Y,{renderState:U}),...(0,O().A)(e,t)}),render:e=>(0,H.jsx)(te,{parent:e,analyticsFrom:g,onChange:b,renderState:U}),buttonPopupStore:C})})]})}function Y({renderState:e}){return e?e.propertySchema.aggregation?(0,H.jsx)(H.Fragment,{children:P().zY[(0,c().ZP)(e.propertySchema.aggregation)]}):"person"===e.propertySchema.rollup_type&&(0,b().Xk)(y().$J,e.propertySchema.target_property)?(0,H.jsx)(S().sA,{id:"database.rollupProperty.aggregate.showValues",defaultMessage:"Show values"}):(0,H.jsx)(S().sA,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}):null}function $(){return(0,H.jsx)(S().sA,{id:"database.rollupProperty.editProperty.tooltip",defaultMessage:"Select an existing relation first."})}function X(){return(0,H.jsx)(S().sA,{id:"database.rollupProperty.editAggregate.tooltip",defaultMessage:"Select an existing relation and property first."})}function q(e,t){return e?void 0:(0,g().b)({width:11,fill:t.icon.secondary})}function J(e,t,o,r,a,n,i){const s=r[a],l=r[e];if(!s||!l||"relation"!==l.type&&"person"!==l.type)return;let c;"person"===l.type?c={...s,rollup_type:"person",person_property:e,relation_property:void 0,target_property:p().Ym,target_property_type:"text",aggregation:void 0}:(c={...s,rollup_type:"relation",relation_property:e,person_property:void 0,target_property:"title",target_property_type:"title",aggregation:void 0},function(e,t){(0,x().DO_NOT_USE_trackLegacy)(e,"configure_rollup_relation",t)}(t,{...(0,M().sl)(i),from:o})),null==n||n({propertySchema:c})}function W({parent:e,analyticsFrom:t,schema:o,property:a,onChange:n,canSelectPersonProperty:s}){const l=(0,i().v3)(),p=(0,r.useCallback)((e=>J(e,l,t,o,a,n)),[l,t,o,a,n]),c=(0,r.useCallback)((e=>function(e,t){return Boolean("relation"===e.type||"person"===e.type&&t)}(e,s)),[s]);return(0,H.jsx)(U().A,{schema:o,isRelationProperty:!1,onAccept:p,onClose:e.close,allowProperty:c})}function Z({environment:e,theme:t,disabled:o,sourcePropertySchema:r,analyticsFrom:a,relationButtonPopupStore:i,canSelectPersonProperty:s,onChange:l,schema:p,property:c}){const d=n().A.isMobile;if(c&&p)return{key:0,render:e=>(0,H.jsx)(E().A,{...e,title:s?(0,H.jsx)(S().sA,{defaultMessage:"Source property",id:"database.viewSettings.rollupOptions.sourceProperty"}):(0,H.jsx)(S().sA,{defaultMessage:"Relation",id:"database.viewSettings.rollupOptions.relationProperty"})}),items:[{key:0,render:e=>(0,H.jsx)(I().A,{popupType:d?R().nl.BottomSheet:R().nl.Popup,renderOrigin:a=>r?(0,H.jsx)(G().G,{...(0,O().A)(e,a),propertySchema:r,format:G().e.Name,right:q(o,t),disabled:o}):(0,H.jsx)(D().A,{...(0,O().A)(e,a),title:s?(0,H.jsx)(S().sA,{id:"database.rollupProperty.editSourceProperty.buttonTitle",defaultMessage:"Select a source property…"}):(0,H.jsx)(S().sA,{id:"database.rollupProperty.editRelation.buttonTitle",defaultMessage:"Select an existing relation…"}),right:q(o,t),style:{color:t.text.secondary},disabled:o}),render:e=>(0,H.jsx)(W,{parent:e,analyticsFrom:a,schema:p,property:c,onChange:l,canSelectPersonProperty:s}),buttonPopupStore:i},e.key),action:()=>{i.setState({open:!0})}}]}}function Q({parent:e,analyticsFrom:t,schema:o,property:a,parentStore:n,onChange:s,renderState:l}){const p=(0,i().v3)(),c=(0,C().ET)(),u=(0,S().tz)(),m=(0,r.useCallback)((o=>{!function(e,t,o,r,a,n,i,s,l){if(!i||!i.propertySchema)return;const{propertySchema:p}=i;let c,d;if("person"===p.rollup_type){if((0,b().Xk)(y().$J,e))d=(0,y().dk)(e).type,c={...p,target_property:e,target_property_type:d,aggregation:void 0};else if(i.relatedCollectionSchema){const r=i.relatedCollectionSchema[e];r&&(d=r.type,c={...p,target_property:e,target_property_type:d,aggregation:void 0},j(t,{...(0,M().sl)(l),from:o,property_type:d}))}}else if("relation"===p.rollup_type||void 0===p.rollup_type){const r=i.relatedCollectionSchema[e];r&&(d=r.type,c={...p,target_property:e,target_property_type:r.type,aggregation:void 0},j(t,{...(0,M().sl)(l),from:o,property_type:r.type}))}c&&d&&(null==s||s({propertySchema:c}))}(o,p,t,0,0,0,l,s,c),e.close()}),[t,p,o,a,n,s,e,c,l]);if(!l)return null;if("person"===l.propertySchema.rollup_type){const e=[];return y().$J.forEach((t=>{e.push({key:`person_system_${t}`,render:e=>(0,H.jsx)(G().G,{...e,propertySchema:(0,y().dk)(t,u),format:G().e.Name}),action:()=>m(t)})})),l.relatedCollectionSchema&&Object.keys(l.relatedCollectionSchema).length>0&&Object.entries(l.relatedCollectionSchema).filter((([e,t])=>{if(!t)return!1;return"formula"!==t.type&&"rollup"!==t.type&&!(0,d().rK)(t.type)})).forEach((([t,o])=>{e.push({key:`people_collection_${t}`,render:e=>(0,H.jsx)(G().G,{...e,propertySchema:o,format:G().e.Name}),action:()=>m(t)})})),0===e.length?null:(0,H.jsx)(F().A,{menuType:k().gu.Popup,children:(0,H.jsx)(V().Ay,{type:V().Oh.Vertical,sections:[{key:"target_properties",items:e,render:e=>(0,H.jsx)(E().A,{...e})}],initialFocus:void 0})})}return!l.relatedCollectionSchema||"relation"!==l.propertySchema.rollup_type&&void 0!==l.propertySchema.rollup_type?null:(0,H.jsx)(U().A,{schema:l.relatedCollectionSchema,isRelationProperty:!1,onAccept:m,allowProperty:e=>"rollup"!==e.type&&!(0,d().rK)(e.type),onClose:e.close})}function ee({isEnabled:e,environment:t,theme:o,disabled:r,renderState:a,analyticsFrom:i,targetPropertyButtonPopupStore:s,onChange:l,schema:p,property:c,parentStore:d}){const u=n().A.isMobile;if(a&&a.propertySchema&&p&&c&&d)return{key:1,render:e=>(0,H.jsx)(E().A,{...e,title:(0,H.jsx)(S().sA,{id:"database.rollupProperty.editProperty.title",defaultMessage:"Property"}),topBorder:!0}),items:[{key:0,render:t=>(0,H.jsx)(K().A,{renderTooltip:()=>(0,H.jsx)($,{}),disableTooltip:e,render:n=>(0,H.jsx)(I().A,{popupType:u?R().nl.BottomSheet:R().nl.Popup,renderOrigin:i=>a.targetPropertySchema?(0,H.jsx)(G().G,{...t,propertySchema:a.targetPropertySchema,format:G().e.Name,right:q(!e||r,o),disabled:!e||r,disabledFeedback:!0}):(0,H.jsx)(D().A,{...t,...(0,O().A)(n,i),title:(0,H.jsx)(S().sA,{id:"database.rollupProperty.editProperty.buttonTitle",defaultMessage:"Select a property…"}),right:q(!e||r,o),disabled:!e||r,disabledFeedback:!0}),render:e=>(0,H.jsx)(Q,{parent:e,analyticsFrom:i,schema:p,property:c,parentStore:d,onChange:l,renderState:a}),buttonPopupStore:s})},t.key),action:()=>{s.setState({open:!0})}}]}}function te({parent:e,analyticsFrom:t,onChange:o,renderState:a}){const n=(0,i().v3)(),s=(0,C().ET)(),l=(0,r.useCallback)((({aggregationType:e})=>{if(null!=a&&a.propertySchema)return function({aggregationType:e,environment:t,analyticsFrom:o,rollupPropertySchema:r,collectionContextStore:a,onChange:n}){const i={...r,aggregation:e,show_as:void 0};null==n||n({propertySchema:i});const s=e?(0,c().ZP)(e):void 0;!function(e,t){(0,x().DO_NOT_USE_trackLegacy)(e,"configure_rollup_aggregation",t)}(t,{...(0,M().sl)(a),from:o,aggregation:s})}({aggregationType:e,environment:n,analyticsFrom:t,rollupPropertySchema:a.propertySchema,collectionContextStore:s,onChange:o})}),[n,t,null==a?void 0:a.propertySchema,s,o]);if(a&&a.propertySchema.target_property){let t=a.relatedCollectionSchema;return"person"===a.propertySchema.rollup_type&&a.targetPropertySchema&&a.propertySchema.target_property&&(t={[a.propertySchema.target_property]:a.targetPropertySchema}),(0,H.jsx)(A().v,{property:a.propertySchema.target_property,schema:t,currentAggregation:a.propertySchema.aggregation?{aggregator:a.propertySchema.aggregation,property:a.propertySchema.target_property}:void 0,onChange:l,onClose:e.close,noneText:(0,H.jsx)(S().sA,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),source:"rollupPropertyMenu"})}return null}function oe({isEnabled:e,environment:t,theme:o,disabled:r,renderState:a,analyticsFrom:i,aggregationButtonPopupStore:s,onChange:l,schema:p,property:c}){const d=n().A.isMobile;if(a&&c&&p)return{key:2,render:e=>(0,H.jsx)(E().A,{...e,title:(0,H.jsx)(S().sA,{id:"database.rollupProperty.editAggregate.title",defaultMessage:"Calculate"}),topBorder:!0}),items:[{key:0,render:t=>(0,H.jsx)(K().A,{renderTooltip:()=>(0,H.jsx)(X,{}),disableTooltip:e,render:n=>e?(0,H.jsx)(I().A,{popupType:d?R().nl.BottomSheet:R().nl.Popup,renderOrigin:e=>(0,H.jsx)(D().A,{...(0,O().A)(t,e),title:(0,H.jsx)(Y,{renderState:a}),right:q(r,o),disabled:r}),render:e=>(0,H.jsx)(te,{parent:e,analyticsFrom:i,onChange:l,renderState:a}),buttonPopupStore:s}):(0,H.jsx)(D().A,{...(0,O().A)(t,n),title:(0,H.jsx)(S().sA,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),right:q(r,o),disabled:!0,disabledFeedback:!0})},t.key),action:()=>{s.setState({open:!0})}}]}}},814777:(e,t,o)=>{o.d(t,{h:()=>E});o(944114),o(898992),o(354520),o(672577),o(430670),o(581454);var r=o(296540),a=()=>o(484714),n=()=>o(56366),i=()=>o(30537),s=()=>o(784892),l=()=>o(396350),p=()=>o(748054),c=()=>o(236262),d=()=>o(519831),u=()=>o(69708),y=()=>o(100622),m=()=>o(496603),g=()=>o(284371),h=()=>o(901952),f=()=>o(193722),S=()=>o(596359),v=()=>o(901389),b=()=>o(539148),x=()=>o(705602),j=()=>o(828973),A=()=>o(908201),_=()=>o(476492),C=()=>o(722872),P=()=>o(838364),M=()=>o(308631),k=()=>o(575143),O=()=>o(419357),w=()=>o(404277),T=()=>o(939740),B=()=>o(45552),D=()=>o(417392),I=()=>o(89924),F=()=>o(893952),V=()=>o(399762),L=o(474848);const R=o(757695).Store.createClass(!1,{name:"ShowSelectDescriptionStore"});function E({onClose:e,collectionId:t,propertySchema:o,property:s,onChange:l,option:p,analyticsFrom:c,statusGroup:d,origin:u,open:y,alignmentToOrigin:m}){const g=(0,a().v3)(),h=(0,A().ET)(),f=(0,n().uB)(void 0,R),{isMobile:S}=(0,a().Y0)(),[v,b]=(0,r.useState)(""),x=(0,r.useRef)(y);(0,r.useEffect)((()=>{!x.current&&y&&b(p.value),x.current=y}),[y,p.value]);const j=(0,r.useCallback)((()=>(0,L.jsx)(K,{collectionContextStore:h,onClose:e,collectionId:t,propertySchema:o,property:s,onChange:l,option:p,analyticsFrom:c,statusGroup:d,renameInputValue:v,setRenameInputValue:b,showSelectDescriptionStore:f})),[h,e,t,o,s,l,p,c,d,v,b,f]),_=(0,r.useCallback)((()=>function(e,t,o,r,a,n,i,s,l,p){if(o(),p)return;z(e,t,r,a,n,i,s,l)}(g,h,e,t,o,s,l,p,v,S)),[g,h,e,t,o,s,l,p,v,S]);return(0,L.jsx)(D().Ay,{popupType:S?i().n.BottomSheet:i().n.Popup,open:y,onDismiss:_,origin:u,render:j,alignmentToOrigin:m})}function K({collectionContextStore:e,onClose:t,collectionId:o,propertySchema:i,property:m,onChange:h,option:A,analyticsFrom:D,statusGroup:R,renameInputValue:E,setRenameInputValue:K,showSelectDescriptionStore:G}){const U=(0,u().tz)(),H=(0,a().v3)(),{isMobile:N}=(0,a().Y0)(),Y=(0,n().K8)((()=>e.collectionStore()),[e]),$=(0,r.useCallback)((e=>function(e,t){const o=e.target.value.replace(/,/g,"");t(o)}(e,K)),[K]),X=(0,r.useCallback)((r=>(r.stopPropagation(),function(e,t,o,r,a,n,i,s,l){o(),z(e,t,r,a,n,i,s,l)}(H,e,t,o,i,m,h,A,E))),[H,e,t,o,i,m,h,A,E]),q=(0,r.useCallback)((()=>{if(Y)return function(e,t,o,r,a,n,i,s,l){S().r$({environment:e,option:t,property:a,propertySchema:r,collectionStore:i,statusGroup:s}),n(),(0,f().L)(e,{...(0,_().sl)(l),property_type:r.type,action:"select_delete_option",from:o})}(H,A,D,i,m,t,Y,R,e)}),[H,A,Y,D,i,m,t,R,e]),J=(0,n().O$)(G),W=[];J&&W.push({key:"description",render:e=>(0,L.jsx)(I().A,{...e,desktopStyle:{paddingTop:0},title:N?U.formatMessage(x().s.descriptionHeader):void 0}),items:[{key:"description",render:e=>(0,L.jsx)(x().y,{...e,initialDescription:A.description,handleSaveDescription:e=>function(e,t,o,r,a,n,i,s){if(e===(s.description??""))return;const l={...s,description:e},p={pointer:{table:d().Vl,id:r},command:"keyedObjectListUpdate",path:["schema",a,"options"],args:{value:l}};o([p]),(0,f().L)(t,{property_type:n.type,action:"select_set_description",from:i})}(e,H,h,o,m,i,D,A),disableAutoSection:!0}),action:()=>{}}]});const Z={key:"action",render:e=>(0,L.jsx)(I().A,{...e}),items:[]};W.push(Z),Z.items.push({key:"delete",render:e=>(0,L.jsx)(k().A,{...e,title:(0,L.jsx)(u().sA,{id:"database.selectPropertyOptionEditMenu.deleteLabel",defaultMessage:"Delete"}),svg:c().trashIcon}),action:q}),R&&"status"===i.type&&(Z.items.push({key:"setAsDefault",render:e=>(0,L.jsx)(k().A,{...e,title:(0,L.jsx)(u().sA,{id:"database.selectPropertyOptionEditMenu.setAsDefault",defaultMessage:"Set as default"}),svg:p().M}),action:()=>async function(e,t,o,r,a,n,i,s,l){if("status"!==o.type||!l)return;if(n.value===o.defaultOption)return;if(void 0!==o.defaultOption){const{accept:e}=await v().Gh({mode:"wide",message:(0,L.jsx)(u().sA,{defaultMessage:"Change default to “{defaultValue}”?",id:"database.editProperty.setAsDefault.confirm.title",values:{defaultValue:n.value}}),description:(0,L.jsx)(u().sA,{defaultMessage:"New pages will start with {defaultValue} as the default status. Existing pages <b>without a status explicitly set</b> will switch to {defaultValue}.",id:"database.editProperty.setAsDefault.confirm.description",values:{defaultValue:n.value,b:e=>(0,L.jsx)("span",{style:{fontWeight:g().Wy.semibold},children:e})}}),acceptLabel:(0,L.jsx)(u().sA,{defaultMessage:"Continue",id:"database.editProperty.setAsDefault.confirm.continueButton"})});if(!e)return}const p={table:d().Vl,id:e},c=[],y={pointer:p,command:"update",path:["schema",t],args:{defaultOption:n.value}};c.push(y),r(c),i(),(0,f().L)(s,{property_type:o.type,action:"status_set_default",from:a,collection_id:e})}(o,m,i,h,D,A,t,H,R)}),Z.items.push({key:"Group",render:e=>(0,L.jsx)("div",{...e,children:(0,L.jsx)(j().A,{...e,title:(0,L.jsx)(u().sA,{id:"database.selectPropertyOptionEditMenu.Group",defaultMessage:"Group"}),selectedKey:R.name,options:(i.groups??[]).map((e=>({key:e.name,type:"button",title:M().OR[e.name]??e.name}))),icon:l().i,onChange:e=>{!function(e,t,o,r,a,n,i,s,l){if("status"!==i.type||!l)return;const p={table:d().Vl,id:t},c=[],u=i.groups??[],y=u.findIndex((e=>e.id===l.id)),m=u.findIndex((t=>t.name===e));if(y===m)return;const g={pointer:p,command:"listRemove",path:["schema",r,"groups",y,"optionIds"],args:{id:o.id}},h={pointer:p,command:"listAfter",path:["schema",r,"groups",m,"optionIds"],args:{id:o.id}};c.push(g,h);const S=i.options??[],v=u.flatMap((e=>{const t=e.optionIds??[],o=S.filter((e=>t.includes(e.id)));return o})),b={pointer:p,command:"set",path:["schema",r,"options"],args:v};c.push(b),a(c),(0,f().L)(s,{property_type:i.type,action:"status_set_default",from:n,collection_id:t})}(e,o,A,m,h,D,i,H,R)}})}),action:()=>{}}));const Q=y().tS.map((e=>{const t={key:e,render:t=>(0,L.jsx)(F().A,{...t,color:e,isChecked:A.color===e}),action:()=>{!function(e,t,o,r,a,n,i,s){const l={...t,color:e},p={pointer:{table:d().Vl,id:o},command:"keyedObjectListUpdate",path:["schema",r,"options"],args:{value:l}};n([p]),(0,f().L)(s,{property_type:a.type,action:"select_change_color",from:i,collection_id:o})}(e,A,o,m,i,h,D,H)}};return t})),ee={key:"color",render:e=>(0,L.jsx)(I().A,{...e,title:(0,L.jsx)(u().sA,{id:"database.selectPropertyOptionEditMenu.colorsSection",defaultMessage:"Colors"}),topBorder:!0}),items:Q};let te;return W.push(ee),te=N?{menuType:C().gu.Modal,title:(0,L.jsx)(V().O,{format:s().NY.Large,value:A.value,color:A.color,showRemoveButton:!1,isSingle:!0}),right:(0,L.jsx)(B().DoneMenuText,{}),onClickRight:X,scrollerStyle:{paddingBottom:P().Hc}}:{menuType:C().gu.Popup,width:220},(0,L.jsxs)(w().A,{...te,children:[(0,L.jsx)(I().A,{isInput:!0,children:(0,L.jsx)(O().Ay,{focusInitial:!0,selectAll:!N,value:E,maxlength:180,onChange:$,onSubmit:X,showClearButton:!1,inputRight:(0,L.jsx)(b().S,{onClick:()=>G.setState(!J),description:A.description,showTooltip:!J})})}),(0,L.jsx)(T().Ay,{type:T().Oh.Vertical,disableKeyboard:!0,initialFocus:void 0,sections:W})]})}function z(e,t,o,r,a,n,i,s){const l=s,p=r.options||[],c=p.find((e=>e.id!==i.id&&e.value.trim().toLowerCase()===l.trim().toLowerCase()));if(i.value!==l)if(l)if(c)v().f1((0,L.jsx)(u().sA,{defaultMessage:"This select option already exists.",id:"database.editProperty.errorDialog.duplicateSelectValue.message"}));else{const s=p.find((e=>e.id===i.id));if(!s)return;const c=l.trim(),u={...s,value:c},y={pointer:{table:d().Vl,id:o},command:"keyedObjectListUpdate",path:["schema",a,"options"],args:{value:u}},g="status"===r.type&&i.value===r.defaultOption?{pointer:{table:d().Vl,id:o},command:"update",path:["schema",a],args:{defaultOption:c}}:void 0;n(m().oE([y,g])),(0,h().V)({environment:e,collectionContextStore:t,property:a,from:"view_settings",action:"select_rename_option",option_value_char_count:c.length})}else v().f1((0,L.jsx)(u().sA,{defaultMessage:"Please type a value.",id:"database.editProperty.errorDialog.missingSelectValue.message"}))}}}]);