"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[57613,94300],{97835:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>s,inviteMemberIcon:()=>r});n(296540);var i=n(474848);const s={viewBox:"0 0 20 20",fittedViewBox:"3.68 2.37 15.82 17.13",svg:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("path",{d:"M10 2.375c-1.137 0-2.054.47-2.674 1.242-.608.757-.9 1.765-.9 2.824s.292 2.066.9 2.824c.62.772 1.537 1.241 2.674 1.241s2.055-.469 2.675-1.241c.608-.758.9-1.766.9-2.824 0-1.059-.292-2.067-.9-2.824-.62-.773-1.538-1.242-2.675-1.242M7.676 6.441c0-.842.233-1.554.624-2.042.38-.473.937-.774 1.7-.774s1.32.301 1.7.774c.391.488.624 1.2.624 2.042s-.233 1.554-.624 2.041c-.38.473-.937.774-1.7.774s-1.32-.3-1.7-.774c-.391-.487-.624-1.2-.624-2.041M10 11.63c-2.7 0-5.101 1.315-6.12 3.305-.361.706-.199 1.421.23 1.923.412.48 1.06.767 1.74.767h5.845a4.6 4.6 0 0 1-.28-1.25H5.85c-.342 0-.634-.148-.79-.33-.138-.162-.172-.336-.067-.54.761-1.488 2.672-2.626 5.007-2.626.83 0 1.605.144 2.294.395.269-.364.59-.688.952-.96A7.9 7.9 0 0 0 10 11.63"}),(0,i.jsx)("path",{d:"M16 19.5a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7m2.594-3.469a.625.625 0 0 0-.625-.625h-1.375v-1.375a.625.625 0 0 0-1.25 0v1.375h-1.375a.625.625 0 0 0 0 1.25h1.375v1.375a.625.625 0 1 0 1.25 0v-1.375h1.375c.345 0 .625-.28.625-.625"})]})},r=(0,n(340498).wt)("inviteMember",s)},101749:(e,t,n)=>{n.d(t,{N:()=>o});n(296540);var i=()=>n(69708),s=()=>n(423657),r=n(474848);function o(e){const t=(0,s().A)(e);return t.isGuestRequestRequired?(0,r.jsx)(i().sA,{id:"contextualInvite.buttonAndTokenTooltip.guestRequestRequired",defaultMessage:"This guest must be approved by a workspace owner first"}):t.isStoreInTeam?t.teamAllowsGuests?void 0:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{children:(0,r.jsx)(i().sA,{id:"contextualInvite.buttonAndTokenTooltip.teamDisablesGuestsAlertLine1",defaultMessage:"This teamspace doesn’t allow guests."})}),(0,r.jsx)("div",{children:(0,r.jsx)(i().sA,{id:"contextualInvite.buttonAndTokenTooltip.teamDisablesGuestsAlertLine2",defaultMessage:"Remove any guests to continue."})})]}):t.spaceAllowsGuests?void 0:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{children:(0,r.jsx)(i().sA,{id:"contextualInvite.buttonAndTokenTooltip.spaceDisablesGuestsAlertLine1",defaultMessage:"This workspace doesn’t allow guests."})}),(0,r.jsx)("div",{children:(0,r.jsx)(i().sA,{id:"contextualInvite.buttonAndTokenTooltip.spaceDisablesGuestsAlertLine2",defaultMessage:"Remove any guests to continue."})})]})}},133507:(e,t,n)=>{n.d(t,{j:()=>l});n(296540);var i=()=>n(56366),s=()=>n(69708),r=()=>n(10984),o=()=>n(749240),a=n(474848);function l({featureAvailability:e}){const t=(0,i().K8)((()=>(0,r().aV)(o().subscriptionDataStoreInstance.state)),[])??0,n={type:"unavailable",limit:{type:"cumulative",total:t,current:t},upsell:{type:"product",product:"plus",limit:{type:"cumulative",current:t,total:"unlimited"},trialability:"none"}};e??=n;const l=e.limit.total,d=e.upsell;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{children:(0,a.jsx)(s().sA,{id:"inviteUserButton.modalTooltip.guestLimitLine1",defaultMessage:"Your plan allows up to {currentLimit, plural, one {{currentLimit} unique guest} other {{currentLimit} unique guests}}.",values:{currentLimit:l}})}),"product"===d.type?(0,a.jsx)("div",{children:(0,a.jsx)(s().sA,{id:"inviteUserButton.modalTooltip.guestLimitLine2upgrade",defaultMessage:"Upgrade to get up to {upsellLimit, plural, one {{upsellLimit} guest} other {{upsellLimit} guests}}",values:{upsellLimit:d.limit.total}})}):(0,a.jsx)(s().sA,{id:"inviteUserButton.modalTooltip.guestLimitLine2contactSales",defaultMessage:"Contact sales to get more guests"})]})}},232376:(e,t,n)=>{n.d(t,{gw:()=>se,Qg:()=>ie});n(944114),n(898992),n(354520),n(581454),n(737550);var i=n(296540),s=()=>n(242422),r=()=>n(726637),o=()=>n(484714),a=()=>n(56366),l=()=>n(401497),d=()=>n(929219),u=()=>n(764880),c=()=>n(31503),p=()=>n(437607),m=()=>n(798880),v=()=>n(201980),g=()=>n(173979),h=()=>n(69708),y=()=>n(496603),f=()=>n(534177),S=()=>n(471995),b=()=>n(877750),x=()=>n(515872),I=()=>n(890801),T=()=>n(267584),A=()=>n(722872),w=()=>n(646736),_=()=>n(252291),j=()=>n(842599),k=()=>n(906380),M=()=>n(97835),C=()=>n(966505),P=()=>n(760217),U=()=>n(406699),E=()=>n(811979),R=()=>n(64e3),D=()=>n(89924),B=()=>n(765957),F=()=>n(529183),G=()=>n(10984),q=()=>n(980270),L=()=>n(875497),O=()=>n(893263),W=n(474848);function N(e){const t=(0,a().uB)(void 0,F().Ay),n=(0,a().uB)(void 0,L().A),{store:s,inputValue:r,intl:d,propertySchemaLimit:u,isLoading:c,handlePersonPropertyMenuChange:p,surface:v}=e,g=(0,o().v3)(),y=(0,l().IS)((e=>({moreBarTitleStyle:{color:e.text.secondary,fontSize:11},desktopTitleStyle:{color:e.text.secondary,fontSize:11},messageBodyStyle:{color:e.text.tertiary,paddingInlineStart:2},messageTitleStyle:{color:e.text.tertiary},inviteBodyStyle:{color:e.text.primary}})),[]),{isMobile:f}=(0,o().Y0)(),S=(0,a().K8)((()=>{var e;return null===(e=B().default.state.sidebarSpaceStore)||void 0===e?void 0:e.getName()}),[]),b=(0,a().K8)((()=>n.state.flowId),[n]),{email:T,isEmail:A,inviteButtonTitle:w}=(0,i.useMemo)((()=>{const e=(0,j().qh)(r),t=(0,j().DT)(e),n=d.formatMessage({id:"invite.person_property.button.invite_people",defaultMessage:"Invite people"}),i=d.formatMessage({id:"invite.person_property.button.invite_email",defaultMessage:"Invite ”{email}”"},{email:e});return{email:e,isEmail:t,inviteButtonTitle:t?i:n}}),[r,d]),N=(0,i.useCallback)((()=>{A&&T&&q().handlePopupClickWithEmail({email:T,inviteTargetsStore:t}),C().TS(g,{origin:"person_property_invite",invite_flow_id:b})}),[A,b,T,g,t]),V=(0,i.useCallback)((()=>{C().F$(g,{origin:"person_property_invite",invite_flow_id:b})}),[b,g]),K=(0,a().K8)((()=>{const e=function(e){const{canAddPermissions:t,isMobile:n,surface:i}=e,s="enterprise"===e.subscriptionTier;if(n||s||!t||(0,x().J)(i))return!1;return!0}({canAddPermissions:s.canEditMembership(),isMobile:f,subscriptionTier:(0,G().AI)(),surface:v});return e&&C().HJ(g,{origin:"person_property_invite",invite_flow_id:b}),e}),[s,b,f,g,v]),z=(0,a().K8)((()=>{if(!(0,x().J)(v))return(0,I().j)(u)}),[v,u]);return K?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(D().A,{title:(0,W.jsx)(h().sA,{defaultMessage:"People",id:"database.personPropertyValue.selectPerson.noSearchResults.resultsTitle"}),desktopTitleStyle:y.desktopTitleStyle,loading:c,desktopStyle:{paddingBottom:4},children:(0,W.jsx)(R().A,{title:(0,W.jsx)("span",{style:y.messageBodyStyle,children:(0,W.jsx)(h().sA,{defaultMessage:"No matches in {spaceName}",id:"database.personPropertyMenu.noSearchResults.messageWithSpaceName",values:{spaceName:S}})}),titleStyle:y.messageTitleStyle})}),(0,W.jsx)(D().A,{title:(0,W.jsx)(h().sA,{defaultMessage:"More",id:"database.personPropertyValue.selectPerson.noSearchResults.suggestionTitle"}),desktopTitleStyle:y.moreBarTitleStyle,topBorder:!0,desktopStyle:{marginTop:0,paddingTop:10},children:(0,W.jsx)(E().A,{focused:!1,stopClickPropagation:!0,popupType:U().z.Popup,renderOrigin:e=>(0,W.jsx)(P().A,{...e,focused:!1,icon:(0,W.jsx)(_().I,{icon:M().inviteMemberIcon,colorVariant:"primary"}),title:w,right:(0,W.jsx)(_().I,{icon:k().arrowChevronSingleRightSmallIcon,size:"sm",colorVariant:"secondary"}),textWrapperStyle:y.inviteBodyStyle}),onClick:N,onClose:V,borderRadius:8,render:e=>(0,W.jsx)(O().A,{inviteOrigin:"person_property_invite",store:s,handleBackButtonClick:()=>e.close(),inviteTargetsStore:t,personPropertyInviteStore:n,onInviteCompleteFn:t=>{e.close();const n=(t.success?Object.values(t.invitedUsers):[]).map((e=>({table:m().oo,id:e})));p(n)}})})})]}):(0,W.jsx)(D().A,{title:z,loading:c,children:(0,W.jsx)(R().A,{title:(0,W.jsx)(h().sA,{defaultMessage:"No results",id:"database.personPropertyMenu.noSearchResults.message"})})})}var V=()=>n(838364),K=()=>n(106628),z=()=>n(251126),J=()=>n(404277),H=()=>n(939740),Q=()=>n(313171),Y=()=>n(859428),$=()=>n(448693),X=()=>n(27356),Z=()=>n(862139),ee=()=>n(854212),te=()=>n(856952),ne=()=>n(457688);const ie=(0,h().YK)({searchForPeopleOrGroups:{defaultMessage:"Search for people or groups…",id:"database.personPropertyValue.searchPlaceholderPeopleOrGroups"},searchErrorMessage:{defaultMessage:"Something went wrong.",id:"database.personPropertyMenu.searchErrorMessage"},searchOfflineErrorMessage:{defaultMessage:"Unavailable offline.",id:"database.personPropertyMenu.searchOfflineErrorMessage"}});function se(e){const t=(0,o().v3)(),n=r().A.isMobile,l=(0,h().tz)(),{disabled:w,value:_,surface:j,valueIsUnpersistedDefaultValue:k,onChange:M,propertySchema:C,parentStore:U,isTemplatePage:E,insertChar:F,formQuestionStore:G,collectionStore:q}=e,L=(0,a().O$)(B().AppStoreSidebarSpaceStore),[O,Q]=(0,i.useState)((()=>F||"")),te=(0,a().K8)((()=>{if(!(0,x().J)(j))return(0,I().j)(C.limit)}),[j,C.limit]),se=(0,a().K8)((()=>{const e=C.limit;return(0,x().J)(j)&&G?(0,c().hm)(C,G.getModel()):e}),[G,j,C]),ae=(0,i.useCallback)((e=>{!function({newMentions:e,tokenLimit:t,value:n,valueIsUnpersistedDefaultValue:i,onChange:s}){1===t&&e.length>0?s({type:"personPropertyMenuUpdateReplacePerson",newValue:e[0]}):void 0===t?s(i?{type:"personPropertyMenuUpdateAddPerson",newValues:[...n,...e]}:{type:"personPropertyMenuUpdateAddPerson",newValues:e}):e.length+n.length<=t&&s({type:"personPropertyMenuUpdateAddPerson",newValues:e})}({newMentions:e,tokenLimit:se,value:_,valueIsUnpersistedDefaultValue:k,onChange:M}),Q("")}),[M,se,_,k]),{tokens:le,selectedTemplateAnnotationVariables:de}=(0,a().K8)((()=>{const e=[];return{tokens:_.map((t=>{if((0,v().MMZ)(t))return e.push(t),(0,W.jsx)(b().W,{templateVariableType:t,showRemoveButton:!w,onRemove:()=>{M({type:"personPropertyMenuUpdateRemovePerson",removedValue:t})},style:{marginTop:0,marginInlineEnd:6,marginBottom:6,marginInlineStart:0}},t);if((0,u().Pu)(t)){const e=(0,u().xC)({pointer:t,getRecordValue:U.getRecordValue});return(0,W.jsx)($().Ay,{actor:e,format:n?$().Ay.Format.Large:$().Ay.Format.Medium,showRemoveButton:!w,onClickRemove:()=>{k?S().D6({label:(0,W.jsx)(h().sA,{defaultMessage:"To replace the default user, add another person to this property.",id:"database.personPropertyMenu.defaultUserCannotBeRemoved"})}):M({type:"personPropertyMenuUpdateRemovePerson",removedValue:t})},shouldShrink:!0,isSingle:!0,hasPersonHoverCard:!0},t.id)}if((0,p().I6)(t)){const e=(0,p().S4)({spacePermissionGroupId:t.id,spaceId:t.spaceId});return(0,W.jsx)(X().UISpacePermissionGroupToken,{parentStore:U,groupPointer:e,format:n?$().Ay.Format.Large:$().Ay.Format.Medium,showRemoveButton:!w,onClickRemove:()=>{M({type:"personPropertyMenuUpdateRemovePerson",removedValue:t})},shouldShrink:!0,isSingle:!0},e.id)}(0,f().HB)(t)})),selectedTemplateAnnotationVariables:e}}),[_,w,M,U,n,k]),ue=v().Wov.filter((e=>!de.includes(e))),ce=(0,a().K8)((()=>{const e=Boolean(q&&q.isExternallyImportedAndSyncedCollection()&&(null==q?void 0:q.getFormat().external_collection_type)),n=null==q?void 0:q.getFormat().external_collection_type,i=Boolean(null==C?void 0:C.derived_property_record_metadata);if((0,T().JD)(q)&&e&&n&&i)return(0,ee().Y)({environment:t,intl:l,store:U,isSyncedCollection:e,inputValue:O,value:_,surface:j,propertySchema:C,handlePersonPropertyMenuAddMentions:ae,sectionMenuTitle:te,externalSyncedCollectionType:n});const r={request:{query:O,actorPointers:y().pb(_,u().Pu),groupPointers:y().pb(_,(e=>"string"!=typeof e&&(0,p().I6)(e)))},performRequest:async({query:e,actorPointers:n,groupPointers:i})=>{const r=await K().T.searchActions.load(),o=await r.searchSpaceUsers({environment:t,query:e,membersOnly:!1,limit:20+n.length,placeSelfFirst:""===e||r.isPersonalPronoun(e,l.locale),shouldUseEdgeCacheRollout:s().default.checkGate({gateName:"edge_cache_person_property"})}),a=r.searchSpaceGroups({query:e,intl:l});return{users:o.filter((e=>!n.some((t=>t.id===e.id)))).slice(0,20),groups:a.filter((e=>!i.some((t=>t.id===(0,p().HT)(e.pointer.id).spacePermissionGroupId)))).slice(0,20),type:"notionUsersAndGroups"}},render:(e,t,n)=>{if(e){const e=!d().A.state.online;return(0,W.jsx)(D().A,{title:te,loading:!n,children:(0,W.jsx)(R().A,{title:e?(0,W.jsx)(h().sA,{...ie.searchOfflineErrorMessage}):(0,W.jsx)(h().sA,{...ie.searchErrorMessage})})})}if(t&&"notionUsersAndGroups"!==t.type)return(0,W.jsx)(D().A,{title:te,loading:!n,children:(0,W.jsx)(R().A,{title:(0,W.jsx)(h().sA,{...ie.searchErrorMessage})})});if(t&&0===t.users.length&&0===t.groups.length)return(0,W.jsx)(N,{store:U,inputValue:O,intl:l,propertySchemaLimit:C.limit,isLoading:!n,surface:j,handlePersonPropertyMenuChange:e=>{ae(e)}});const i=!(void 0!==se&&_.length>=se&&se&&se>1),s=y().oE((t&&t.users||[]).map((e=>{const t={key:e.id,render:t=>(0,W.jsx)(Y().A,{disableTooltip:i,renderTooltip:()=>(0,W.jsx)(h().sA,{defaultMessage:"To select more, remove selection above",id:"database.personPropertyMenu.limitReached"}),render:n=>(0,W.jsx)(ne().A,{...t,badge:(0,W.jsx)(oe,{user:e,spaceStore:L}),actor:(0,u().A7)(e),disabled:!i,disabledFeedback:!i,...n})}),action:()=>{ae([{table:m().oo,id:e.id}])}};return t}))),r=y().oE((t&&t.groups||[]).map((e=>{const t={key:e.group_id,render:t=>(0,W.jsx)(Z()._,{group:e,menuListItemProps:t}),action:()=>{ae([e.getGroupPointer()])}};return t}))),o=y().oE([s.length>0||r.length>0?{key:"person and group section",render:e=>(0,W.jsx)(D().A,{...e,title:te,loading:!n}),items:[...s,...r]}:void 0]);return(0,W.jsx)(H().Ay,{type:H().Oh.Vertical,initialFocus:O.length>0?0:void 0,sections:o})}};return r}),[q,O,_,t,l,U,j,C,ae,te,se,L]),pe=(0,W.jsx)(re,{tokens:le,disabled:w,onChange:M,value:_,inputValue:O,setInputValue:Q});let me;return me=n?{menuType:A().gu.Modal,title:C.name,header:pe,includeFixedHeaderSpacing:!0,scrollerStyle:{paddingBottom:V().Hc}}:{menuType:A().gu.Popup,header:pe,tokenInputHeader:!0,maxHeight:333},w?(0,W.jsx)(J().A,{...me}):(0,W.jsxs)(J().A,{...me,children:[E?(0,W.jsx)(D().A,{title:(0,W.jsx)(h().sA,{defaultMessage:"Shortcuts",id:"PersonPropertyMenu.menuItem.shortcuts.label"}),children:ue.length>0?(0,W.jsx)(i.Fragment,{children:ue.map((e=>(0,W.jsx)(P().A,{focused:!1,title:(0,W.jsx)(b().W,{templateVariableType:e}),caption:(0,g().EC)(e,l),inline:!0,onClick:()=>{ae([e])}},`relative-person-shortcut-${e}`)))}):(0,W.jsx)(R().A,{title:(0,W.jsx)(h().sA,{id:"database.personPropertyMenu.noShorcuts.message",defaultMessage:"No shortcuts"})})}):void 0,(0,W.jsx)(z().A,{...ce})]})}const re=i.memo((function(e){const{tokens:t,disabled:s,onChange:a,value:d,inputValue:u,setInputValue:c}=e,{isAndroid:p,isPhone:m}=(0,o().Y0)(),v=r().A.isMobile,g=(0,h().tz)(),y=(0,l().IS)((()=>({tokenWrapStyle:{...(0,n(968021)._Q)({isPhone:m}).table.token,gap:4}})),[m]),f=(0,i.useCallback)((()=>{a({type:"personPropertyMenuUpdateRemovePerson",removedValue:d[d.length-1]})}),[a,d]);return(0,W.jsx)(D().A,{disableDesktopPadding:!0,children:(0,W.jsx)(te().Ay,{focus:!v||void 0,focusAfterAnimation:!0,format:te().le.Person,tokens:t,tokenWrapStyle:y.tokenWrapStyle,placeholder:g.formatMessage(ie.searchForPeopleOrGroups),hideInput:s,onRemoveLastToken:f,value:u,onChange:e=>c(e.target.value),dontShowBorderBottom:p||v})})}));function oe({user:e,spaceStore:t}){const n=(0,w().V_)({userId:e.id,spaceStore:t});return t&&"restricted_member"===n?(0,W.jsx)(Q().L,{}):null}},274652:(e,t,n)=>{n.d(t,{o:()=>r});var i=n(296540),s=n(474848);const r=i.forwardRef((function({color:e="primary",...t},i){const r=(0,n(401497).IS)((i=>{const s="blue"===e?n(100622).Tj.blue:"secondary"===e?i.text.secondary:i.text.primary;return{title:{color:s,fill:s},buttonMenuItem:{...t.style,...t.disabled?{cursor:"not-allowed"}:{}}}}),[t.disabled,e,t.style]);return(0,s.jsx)(n(760217).A,{ref:i,...t,title:(0,s.jsx)("div",{style:r.title,children:t.title}),icon:(0,s.jsx)(n(252291).I,{icon:n(617668).plusIcon,style:{fill:e}}),style:r.buttonMenuItem})}))},313171:(e,t,n)=>{n.d(t,{L:()=>o});n(296540);var i=()=>n(970236),s=()=>n(69708),r=n(474848);function o(){return(0,r.jsx)(i().E,{content:(0,r.jsx)(s().sA,{id:"spaceUserMembershipType.restrictedMember",defaultMessage:"Restricted"}),color:"yellow"})}},381374:(e,t,n)=>{n.d(t,{p:()=>r});n(296540);var i=()=>n(69708),s=n(474848);function r({invalidInvites:e,showEmptyError:t,styles:n}){if(t)return(0,s.jsx)("div",{style:n,children:(0,s.jsx)(i().sA,{id:"inviteTargetsInput.invalidWarning.noEmails",defaultMessage:"Please enter an email address"})});if(0===e.length)return null;const r=e[0].value.text;return 1===e.length?(0,s.jsx)("div",{style:n,children:(0,s.jsx)(i().sA,{id:"inviteTargetsInput.invalidWarning.singleEmail",defaultMessage:"“{text}” is not a valid email",values:{text:r}})}):(0,s.jsx)("div",{style:n,children:(0,s.jsx)(i().sA,{id:"inviteTargetsInput.invalidWarning.multipleEmails",defaultMessage:"{additionalInvalid, plural, one {”{text}” and {additionalInvalid} other are not valid emails} other {”{text}” and {additionalInvalid} others are not valid emails}}",values:{text:r,additionalInvalid:e.length-1}})})}},401996:(e,t,n)=>{n.d(t,{P:()=>d,S:()=>u});n(898992),n(354520),n(581454);var i=()=>n(842599),s=()=>n(535279),r=()=>n(765957),o=()=>n(324561),a=()=>n(542056);const l=n(496603).sg((({environment:e,flowId:t,billingData:i,origin:s})=>{n(134696).D2(e,{invite_flow_id:t,billingData:i,invite_origin:s})}),1e3);async function d(e){var t;const{environment:n,event:d,flowId:u,inviteTargetsStore:c,inviteOrigin:p,onInputChanged:m}=e;null==m||m();const v=null===(t=r().default.state.sidebarSpaceStore)||void 0===t?void 0:t.id,g=await(0,o().yk)({environment:n,spaceId:v});c.setState({...c.state,tokenQuery:d.target.value}),l({environment:n,flowId:u,billingData:g,origin:p});const h=d.target.value,{extractedEmails:y,invalidParts:f,newInputValue:S}=(0,i().l2)(h),b=[...await a().Ah(n,y),...f.map((e=>({type:"invalidUser",value:{text:e}})))].filter((e=>!s().P4({inviteTargetsStore:c,target:e}))),x=[...c.state.inviteTargets,...b];c.setState({...c.state,inviteTargets:x,tokenQuery:S})}function u(e){const{targetToRemove:t,inviteTargetsStore:n}=e;if(0===n.state.inviteTargets.length)return;const i=n.state.inviteTargets.filter((e=>e!==t));0===i.length?n.setState({...n.state,inviteTargets:[]}):n.setState({...n.state,inviteTargets:i})}},423657:(e,t,n)=>{n.d(t,{A:()=>l});var i=()=>n(299545),s=()=>n(78846),r=()=>n(707396),o=()=>n(765957);function a(e,t){return(0,s().h)(e)?{isGuestRequestRequired:!0}:t?{isStoreInTeam:!0,teamAllowsGuests:!0,spaceAllowsGuests:!0,isGuestRequestRequired:!1}:{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1}}const l=function(e){return(0,n(56366).K8)((()=>{if((0,i().nw)(e))return{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1};if("workflow"===e.table){const e=o().default.state.sidebarSpaceStore;return(0,r().r)(e)?a(e,void 0):{isStoreInTeam:!1,spaceAllowsGuests:!(null!=e&&e.getDisableGuests()),isGuestRequestRequired:!1}}if(!(0,i()._p)(e))return(0,r().r)(e)?a(e,void 0):{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1};const t=(0,n(422366).U)(e),s=(0,n(672873).p)(e),l=s||o().default.state.sidebarSpaceStore;if((0,r().r)(l))return a(l,t);const d=!(null!=s&&s.getDisableGuests());return t?{isStoreInTeam:!0,teamAllowsGuests:!t.getDisableGuests(),spaceAllowsGuests:d,isGuestRequestRequired:!1}:{isStoreInTeam:!1,spaceAllowsGuests:d,isGuestRequestRequired:!1}}),[e])}},454354:(e,t,n)=>{n.d(t,{A:()=>r});var i=()=>n(765957);class s extends(()=>n(757695))().Store{getInitialState(){return{changePermissionsEnabled:!1,privatePageStore:void 0,privateWorkflowStore:void 0,loading:!1,error:void 0}}shouldSaveTransactionWithSudoMode(e){const t=e===this.state.privatePageStore||e===this.state.privateWorkflowStore,n=this.doesUserAlreadyHaveEditorAccess(e.pointer);return t&&this.state.changePermissionsEnabled&&!n}shouldUserHaveAccessToPrivatePageBlock(){var e,t;const n=null===(e=i().default.state.sidebarSpaceStore)||void 0===e?void 0:e.canAdmin(),s="enterprise"===(null===(t=i().default.state.sidebarSpaceStore)||void 0===t?void 0:t.getSubscriptionTier());return this.state.privatePageStore&&n&&s}shouldUserHaveAccessToPrivateWorkflow(){var e,t;const n=null===(e=i().default.state.sidebarSpaceStore)||void 0===e?void 0:e.canAdmin(),s="enterprise"===(null===(t=i().default.state.sidebarSpaceStore)||void 0===t?void 0:t.getSubscriptionTier());return this.state.privateWorkflowStore&&n&&s}doesUserAlreadyHaveEditorAccess(e){const t=i().default.state.sidebarSpaceStore;if(!t)return!1;return(e.table===n(179034).ev?n(148832).B.createChildStore(t,e):"collection"===e.table?n(543665).m.createChildStore(t,e):n(201718).N.createChildStore(t,e)).canAdmin()}}const r=s},535279:(e,t,n)=>{n.d(t,{P4:()=>s,U1:()=>o,lW:()=>a});n(944114),n(898992),n(354520),n(737550);var i=()=>n(842599);function s(e){const{target:t,inviteTargetsStore:n}=e;return n.state.inviteTargets.some((e=>"newUser"===t.type?e.type===t.type&&t.value.email===e.value.email:"invalidUser"===t.type?e.type===t.type&&t.value.text===e.value.text:"group"===t.type?e.type===t.type&&e.value.group_id===t.value.group_id:e.type===t.type&&e.value.id===t.value.id))}function r(e){return"invalidUser"!==e.type}function o(e){const{inviteTargetsStore:t,includeInputFieldText:n}=e,o=[...t.state.inviteTargets];if(n){const e=function(e){const t=e.state.tokenQuery.trim();if(!(0,i().DT)(t))return;const n={type:"newUser",value:{email:t},source:"email"};return s({target:n,inviteTargetsStore:e})?void 0:n}(t);e&&o.push(e)}return o.filter(r)}function a(e){const{inviteTargetsStore:t,inviteTarget:n}=e;if(s({target:n,inviteTargetsStore:t})){const e=t.state.inviteTargets.filter((e=>"group"===n.type&&"group"===e.type?n.value.group_id!==e.value.group_id:"existingUser"===n.type&&"existingUser"===e.type?n.value.id!==e.value.id:"newUser"!==n.type||"newUser"!==e.type||n.value.email!==e.value.email));return t.setState({...t.state,inviteTargets:e}),!1}return t.setState({inviteTargets:[...t.state.inviteTargets,n],tokenQuery:""}),!0}},577829:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>s,personCropCircleBadgeExclamationPointSmallIcon:()=>r});n(296540);var i=n(474848);const s={viewBox:"0 0 16 16",fittedViewBox:"0.32 1.87 13.8 13.81",svg:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("path",{d:"M8 1.875a6.125 6.125 0 0 0-6.056 7.043.075.075 0 0 0 .1.059 4 4 0 0 1 1.057-.233.075.075 0 0 0 .068-.085 4.875 4.875 0 1 1 8.076 2.98C10.58 10.575 9.367 9.878 8 9.878c-.52 0-1.02.1-1.474.285a.075.075 0 0 0-.031.115c.217.29.395.61.525.954a.075.075 0 0 0 .095.044c.274-.095.572-.148.885-.148.962 0 1.784.5 2.212 1.217a4.86 4.86 0 0 1-2.87.485.075.075 0 0 0-.085.069 4 4 0 0 1-.233 1.056.075.075 0 0 0 .059.1q.45.069.917.069a6.125 6.125 0 0 0 0-12.25"}),(0,i.jsx)("path",{d:"M8 4.036c-.786 0-1.432.327-1.868.87-.424.528-.619 1.219-.619 1.927s.195 1.4.62 1.927c.435.543 1.08.87 1.867.87s1.433-.327 1.869-.87c.424-.528.619-1.219.619-1.927s-.195-1.4-.62-1.927c-.435-.543-1.08-.87-1.868-.87m-.893 1.652c.195-.243.48-.402.893-.402s.699.159.894.402c.207.258.343.653.343 1.145s-.136.887-.343 1.145c-.195.243-.48.402-.894.402-.412 0-.698-.159-.893-.402-.207-.258-.344-.653-.344-1.145s.137-.887.344-1.145M3.4 9.525a3.075 3.075 0 1 0 0 6.15 3.075 3.075 0 0 0 0-6.15m-.425 1.409a.425.425 0 1 1 .85 0v2a.425.425 0 0 1-.85 0zm0 3.44a.425.425 0 1 1 .85.002.425.425 0 0 1-.85-.002"})]})},r=(0,n(340498).wt)("personCropCircleBadgeExclamationPointSmall",s)},637573:(e,t,n)=>{n.d(t,{r:()=>a});var i=()=>n(484714),s=()=>n(56366),r=()=>n(425236),o=()=>n(765957);function a(){const e=(0,i().v3)();return(0,s().K8)((()=>{const{sidebarSpaceStore:t}=o().default.state;if(t)return(0,r().f)({environment:e,spaceId:t.id})}),[e])}},664133:(e,t,n)=>{n.d(t,{Sl:()=>W,i5:()=>L,ol:()=>q,xU:()=>O});n(898992),n(672577),n(803949);var i=()=>n(564884),s=()=>n(66689),r=()=>n(148307),o=()=>n(617871),a=()=>n(651124),l=()=>n(165358),d=()=>n(201980),u=()=>n(69708),c=()=>n(496603),p=()=>n(763824),m=()=>n(973647),v=()=>n(559926),g=()=>n(901389),h=()=>n(553003),y=()=>n(601734),f=()=>n(686504),S=()=>n(974233),b=()=>n(972435),x=()=>n(37433),I=()=>n(765957),T=()=>n(53137),A=()=>n(150193),w=()=>n(666803),_=()=>n(612587),j=()=>n(543665),k=()=>n(404141),M=()=>n(51781),C=()=>n(559506),P=()=>n(934839),U=()=>n(510683),E=()=>n(496414),R=()=>n(384944),D=()=>n(231297),B=()=>n(949237);const F=(0,u().YK)({JiraAuthenticationInvalidDetails:{id:"jiraImport.invalidDetails",defaultMessage:"Invalid Details"},TasksCollectionName:{defaultMessage:"Issues",id:"appTemplates.tasks.issuesDatabaseName"}}),G=6e4;async function q(e){const{environment:t,userEmail:n,spaceId:s,flowId:r,instance:o,authInfo:a}=e;(0,i().u)({environment:t,event:{eventName:"external_sync_auth",eventProperties:{integration:"jira",actionType:"admin_auth_initiated",flowId:r}}});try{var d;const m=e.site.replace(/\/+$/,"");if(!t.currentUser.id)return g().rG({message:b().A.formatMessage(F.JiraAuthenticationInvalidDetails)}),void E().V();let v;if("Basic"===a.authType&&"instance"in a&&"DataCenter"===a.instance)v=await C().callApi({eventName:"authenticateJiraUser",environment:t,data:{userEmail:n,site:m,userId:t.currentUser.id,spaceId:s,instance:o,username:a.username,password:a.password,authType:a.authType}});else{if(!("apiKey"in a))return;v=await C().callApi({eventName:"authenticateJiraUser",environment:t,data:{userEmail:n,site:m,apiKey:a.apiKey,userId:t.currentUser.id,spaceId:s,instance:o}})}await B().oX({environment:t});const h="success"===v.type&&(null===(d=v)||void 0===d||null===(d=d.data)||void 0===d?void 0:d.isAdmin);if((0,i().u)({environment:t,event:{eventName:"external_sync_auth",eventProperties:{integration:"jira",actionType:"admin_auth_status",flowId:r,status:h?"success":"failed"}}}),l().log({level:h?"info":"error",from:"jiraActions",type:"authenticateWithJira",data:{message:h?"authenticate with Jira is successful":"Failed to authenticate with Jira",miscDataToConvertToString:{authResponse:v}}}),"failed"===v.type){const e=(0,S().V)(v);console.error(v.error);const t=w().Ay.getInitialState();w().Ay.setState(t);const n=(0,u().YK)({dismissButtonLabel:{defaultMessage:"OK",id:"dialog.dismissButton.label"}});g().ui({message:e,showCancel:!1,keepFocus:!1,items:[{label:b().A.formatMessage(n.dismissButtonLabel),onAccept:c().D_}]}),l().log({level:"error",from:"jiraActions",type:"authenticateWithJira",data:{message:"Failed to authenticate with Jira",miscDataToConvertToString:{errorMessage:e,authResponse:v}}})}else{var p;if(null!==(p=v)&&void 0!==p&&null!==(p=p.data)&&void 0!==p&&p.isAdmin){w().Ay.setState({...w().Ay.state,type:"teamspace-selection",open:!0,flowId:r,site:m,botId:v.data.botId}),(0,i().u)({environment:t,event:{eventName:"external_sync_teamspace_selection",eventProperties:{integration:"jira",actionType:"teamspace_modal_render",flowId:r}}});const e=k().A.getInitialState();k().A.setState(e)}else w().Ay.setState({...w().Ay.state,type:"auth",open:!0,adminTokenError:!0,flowId:r,site:void 0}),(0,i().u)({environment:t,event:{eventName:"external_sync_auth",eventProperties:{integration:"jira",actionType:"admin_auth_render",flowId:r}}})}E().V()}catch(m){(0,i().u)({environment:t,event:{eventName:"external_sync_auth",eventProperties:{integration:"jira",actionType:"admin_auth_status",flowId:r,status:"failed"}}}),l().log({level:"error",from:"jiraActions",type:"authenticateWithJira",data:{message:"Failed to authenticate with Jira",miscDataToConvertToString:{err:m}}})}}async function L({environment:e,selectedTeamspaceId:t,siteUrl:n,botId:i,instanceType:o,syncName:u}){try{const{appTemplatesSetupActions:l,appConfigs:p}=await y().Aw.load(),{sidebarSpaceStore:m,sidebarSpaceViewStore:g,currentUserStore:f}=I().default.getState(),S=null==f?void 0:f.id;if(!S||!m)return;let T=m;if(t){var c;const n=await(0,M().wq)({userId:S,spaceStore:m,environment:e}),i=null===(c=(0,x().dT)({spaceStore:m,teams:n}).find((e=>e.store.id===t)))||void 0===c?void 0:c.store;if(!i)return;T=i}if(!g||!T)return;const{serverCommitResult:A,performResult:w}=D().createAndCommit({environment:e,perform:t=>{var n;const i=s().tP,r=null===(n=(0,h().B)(p(),i))||void 0===n?void 0:n.uri;if(!r)return;const o=p().find((e=>e.uri===r));if(null==o?void 0:o.presets.find((e=>e.uri===i))){return l.initializeApp({environment:e,spaceViewStore:g,appParentStore:T,appUri:r,presetUri:i,transaction:t,from:"jira_import"})}return[]},canUndo:!0,userAction:"importActions.importJira"}),_=e.defaultRecordCache.inMemoryRecordCache;await A,null==w||w.forEach((t=>{const l=t.getFormat(),c=null==l?void 0:l.collection_pointer;if(c){const t=_.getRecord({pointer:c,userId:e.currentUser.id});t&&t.value&&D().createAndCommit({userAction:"jiraActions.updateFormatForCollections",environment:e,canUndo:!0,perform:l=>{const p=t.value,m=null==p?void 0:p.format;if(m){m.external_collection_type=a().uO.Jira,m.synced_collection_external_url=n,m.synced_collection_instance_type=o,m.bot_id=i,p.icon=m.app_config_uri===s().dC?r().A.images.appPackages.jiraTaskIconSvg:r().A.images.appPackages.jiraProjectIconSvg;const t=new(j().m)(e,c),v=m.app_config_uri===s().dC?b().A.formatMessage(F.TasksCollectionName):d().q4_(p.name);(u||m.app_config_uri===s().dC)&&(p.name=(0,d().x9d)(u?`${u} ${v}`:v)),R().zv({store:t,data:p,transaction:l})}}})}}));const k=null==w?void 0:w.find((e=>{var t;return(null===(t=e.getFormat())||void 0===t?void 0:t.app_config_uri)===s().bq}));return v().eH(e,{import_source:"jira",from:"modal"}),k}catch(p){l().log({level:"error",from:"jiraActions",type:"projectPageNotCreated",data:{message:"Error while creating project page for Jira sync",miscDataToConvertToString:{error:p}}})}}async function O(e){const{environment:t,spaceId:n}=e,s=T().A.integrations.state.find((({id:e})=>e===o().me));if(s&&n)try{const e=t.device.isElectron?await async function(e,t,n){const i=await U().Jq({environment:e,integration:t,spaceId:n,from:"connected_apps_settings"}),s=T().A.externalAuthentications.state,r=performance.now()+G,o=p().yX(),a=setInterval((()=>{const e=performance.now();r<e?o.resolve(void 0):T().A.externalAuthentications.state.length>s.length&&o.resolve("success")}),1e3);return await o.promise,clearInterval(a),i}(t,s,n):await U().Jq({environment:t,integration:s,spaceId:n,from:"connected_apps_settings"});e&&m().Q.isSuccess(e)&&((0,i().u)({environment:t,event:{eventName:"external_sync_auth",eventProperties:{integration:"jira",flowId:w().Ay.state.flowId??"",status:"success",actionType:"member_auth_status"}}}),v().Gy(t,{from:"collection_view_page",step:"auth_success"}),P().zA({bannerStore:A().A,id:"AuthMissingForJiraSyncedCollectionPageBanner"}),P().zA({bannerStore:_().A,id:"AuthMissingForJiraSyncedCollectionPageBanner"}))}catch(r){l().log({level:"error",from:"syncedCollectionActions",type:"connectIntegrationFailed",data:{message:"Failed to authenticate",miscDataToConvertToString:{error:r}}}),v().Gy(t,{from:"collection_view_page",step:"auth_failure"})}}async function W(e){const{environment:t,blockStore:n,collectionStore:i}=e,s=(0,f().q6)(n),r=(0,f().r_)(i),o=n.getSpaceId();try{if(!s||!r||!o)return null;const e=await C().callApi({eventName:"getJiraIssueTransitions",environment:t,data:{issueId:s,site:r,spaceId:o}});return"success"===e.type?e.data.transitions:(l().log({level:"error",from:"jiraActions",type:"fetchJiraIssueTransitionsFailed",data:{message:"Failed to fetch JIRA issue status options",miscDataToConvertToString:{response:e,issueId:s,site:r,spaceId:o}}}),null)}catch(a){return l().log({level:"error",from:"jiraActions",type:"fetchJiraIssueTransitionsError",data:{message:"Failed to fetch JIRA transitions",miscDataToConvertToString:{error:a,issueId:s,site:r,spaceId:o}}}),null}}},686504:(e,t,n)=>{n.d(t,{WS:()=>r,ot:()=>o,q6:()=>a,r_:()=>l});n(944114),n(898992),n(672577),n(803949),n(737550);var i=()=>n(498212),s=()=>n(534177);function r(e){const{context:t,staticOptions:n,staticGroups:r,externalStatusOptions:o}=e;return t.collectionType&&"Jira"===t.collectionType?function(e){const{transitions:t,staticOptions:n,staticGroups:r}=e;if(!t)return null;return function(e){const{transitions:t,staticGroups:n}=e,r=[],o=[];return(0,s().WP)(t).forEach((([e,t])=>{const s=[];t.forEach((t=>{const n=(0,i().Ay)();r.push({id:n,value:t.name,color:d(e)}),s.push(n)}));const a=n.find((t=>t.name===e));a&&o.push({...a,optionIds:s})})),{options:r,groups:o}}({transitions:t,staticOptions:n,staticGroups:r})}({transitions:o,staticOptions:n,staticGroups:r}):null}function o(e){const{collectionStore:t,blockStore:n}=e,i=null==t?void 0:t.getFormat();return{collectionType:null==i?void 0:i.external_collection_type,spaceId:null==n?void 0:n.getSpaceId(),blockStore:n,collectionStore:t}}function a(e){const t=e.getProperties();for(const[n,i]of Object.entries(t||{}))if(Array.isArray(i)&&i.length>0){const e=i[0];if(Array.isArray(e)&&e.length>0){const t=e[0];if("string"==typeof t&&t.includes("/browse/")){const e=t.match(/\/browse\/([A-Z]+-\d+)/);if(e)return e[1]}}}return null}function l(e){const t=e.getFormat();return null==t?void 0:t.synced_collection_external_url}function d(e){switch(e){case"To-do":default:return"gray";case"In progress":return"blue";case"Complete":return"green"}}},744419:(e,t,n)=>{n.d(t,{RW:()=>d,bV:()=>l,nR:()=>u});var i=()=>n(513416),s=()=>n(686504),r=()=>n(252833),o=()=>n(559506),a=()=>n(664133);async function l({environment:e,blockPointer:t,query:n}){const s=await o().callApi({eventName:"getExternalUsersForSyncedCollection",environment:e,data:{blockPointer:t,query:n}});return(0,i().kX)(s)?[]:"success"===s.type?s.data.externalUsers:[]}async function d({environment:e,externalUser:t,blockPointer:n,externalSyncedCollectionType:s}){const a=await o().callApi({eventName:"getOrCreateNotionUserFromExternalUser",environment:e,data:{externalUser:(0,r().Vz)(t,s),blockPointer:n}});if(!(0,i().kX)(a))return"success"===a.type?a.data.notionUser:void 0}async function u({environment:e,blockStore:t,collectionStore:n}){if(!t||!n)return null;const i=(0,s().ot)({collectionStore:n,blockStore:t}).collectionType;return i&&"Jira"===i?await a().Sl({environment:e,blockStore:t,collectionStore:n}):null}},833243:(e,t,n)=>{n.r(t),n.d(t,{checkmarkCircleSmallIcon:()=>r,iconDefinition:()=>s});n(296540);var i=n(474848);const s={viewBox:"0 0 16 16",fittedViewBox:"1.87 1.87 12.25 12.25",svg:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("path",{d:"M10.243 5.558a.625.625 0 0 0-.857.214L7.432 9.03 6.396 7.82a.625.625 0 1 0-.949.814l1.6 1.867a.625.625 0 0 0 1.01-.086l2.4-4a.625.625 0 0 0-.214-.857"}),(0,i.jsx)("path",{d:"M8 1.875a6.125 6.125 0 1 0 0 12.25 6.125 6.125 0 0 0 0-12.25M3.125 8a4.875 4.875 0 1 1 9.75 0 4.875 4.875 0 0 1-9.75 0"})]})},r=(0,n(340498).wt)("checkmarkCircleSmall",s)},854212:(e,t,n)=>{n.d(t,{Y:()=>T,z:()=>A});n(581454),n(296540);var i=()=>n(242422),s=()=>n(56366),r=()=>n(764880),o=()=>n(437607),a=()=>n(798880),l=()=>n(69708),d=()=>n(496603),u=()=>n(744419),c=()=>n(249847),p=()=>n(152197),m=()=>n(106628),v=()=>n(666803),g=()=>n(329304),h=()=>n(760217),y=()=>n(939740),f=()=>n(64e3),S=()=>n(89924),b=()=>n(453697),x=()=>n(232376),I=n(474848);function T({environment:e,intl:t,store:n,isSyncedCollection:s,inputValue:c,value:p,surface:v,propertySchema:g,handlePersonPropertyMenuAddMentions:T,sectionMenuTitle:A,externalSyncedCollectionType:w}){return{...{request:{query:c,actorPointers:d().pb(p,r().Pu),groupPointers:d().pb(p,(e=>"string"!=typeof e&&(0,o().I6)(e)))},performRequest:async({query:t,actorPointers:i,groupPointers:s})=>({externalUsers:await u().bV({environment:e,blockPointer:n.pointer,query:t}),type:"externalUsers"}),render:(r,o,p)=>{if(r)return(0,I.jsx)(S().A,{title:A,loading:!p,children:(0,I.jsx)(f().A,{title:(0,I.jsx)(l().sA,{...x().Qg.searchErrorMessage})})});if(o&&"externalUsers"!==o.type)return(0,I.jsx)(S().A,{title:A,loading:!p,children:(0,I.jsx)(f().A,{title:(0,I.jsx)(l().sA,{...x().Qg.searchErrorMessage})})});const v=d().oE((o&&o.externalUsers||[]).map((r=>{const o=(0,I.jsx)(b().A,{avatar:{email:r.emailAddress,avatarUrl:"",name:r.displayName}});return{key:r.accountId,render:e=>(0,I.jsx)(h().A,{...e,title:r.displayName,caption:r.emailAddress,icon:o}),action:async()=>{await(async r=>{if(s&&r.emailAddress){const s=await m().T.searchActions.load(),o=await s.searchSpaceActors({environment:e,query:r.emailAddress,membersOnly:!1,userLocale:t.locale,shouldUseEdgeCacheRollout:i().default.checkGate({gateName:"edge_cache_person_property"}),limit:1});if(1===o.users.length)T([{table:a().oo,id:o.users[0].id}]);else{const t=await u().RW({environment:e,externalUser:r,blockPointer:n.pointer,externalSyncedCollectionType:w});t&&T([{table:a().oo,id:t.id}])}}})(r)}}}))),g=d().oE([v.length>0?{key:"external user section",render:e=>(0,I.jsx)(S().A,{...e,title:(0,I.jsx)(l().sA,{defaultMessage:"Select user from Jira",id:"database.personPropertyValue.externalUsers.searchPlaceholder"}),loading:!p}),items:v}:void 0]);return(0,I.jsx)(y().Ay,{type:y().Oh.Vertical,initialFocus:c.length>0?0:void 0,sections:g})}}}}function A(){const e=(0,p().r)(),t=(0,c().T)(),n=(0,s().K8)((()=>v().Ay.state.instanceValue),[])===v().cK.DataCenter?"collection_synced_database_jira_datacenter":"collection_synced_database_jira";return(0,g()._X)({name:n,spaceId:e,userId:t})}},875497:(e,t,n)=>{n.d(t,{A:()=>r,E:()=>i});let i=function(e){return e.InviteInput="invite_input",e.MessageInput="message_input",e.NoFocus="no_focus",e}({});class s extends(()=>n(757695))().Store{getInitialState(){return{flowId:n(206267).JW(),role:"editor",focus:i.InviteInput,emailMessage:"",isLoading:!1,showEmptyError:!1}}}const r=s},893263:(e,t,n)=>{n.d(t,{A:()=>de});var i=n(296540),s=()=>n(484714),r=()=>n(56366),o=()=>n(401497),a=()=>n(998531),l=()=>n(69708),d=()=>n(100622),u=()=>n(496603),c=()=>n(966505),p=()=>n(859428),m=()=>n(347160),v=()=>n(366858),g=()=>n(369955),h=()=>n(646736),y=(n(581454),()=>n(401996)),f=()=>n(856952),S=()=>n(529183),b=(n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),()=>n(784892)),x=()=>n(842599),I=()=>n(534177),T=()=>n(284371),A=()=>n(453697),w=()=>n(423657),_=()=>n(101749),j=()=>n(765957),k=n(474848);const M=function(e){const{store:t,target:i}=e,a=(0,s().Y0)(),u=(0,l().tz)(),c=function(){const e=(0,o().IS)((()=>({verifiedDomain:{margin:2,backgroundColor:"rgba(83, 168, 63, 0.1)"},disabled:{margin:2,backgroundColor:"rgba(211, 79, 67, 0.1)",border:"dashed #D9655B 1px",paddingInlineStart:5},normal:{margin:2},guest:{margin:2,backgroundColor:"rgba(218, 163, 64, 0.2)"},error:{margin:2,backgroundColor:"rgba(195,90,75,0.2)",color:"#DE5550"},tokenContent:{display:"flex",alignItems:"center",maxWidth:"100%"},tokenSpan:{maxWidth:"100%"},tokenText:{marginInlineStart:4,...T().RC},base:{borderRadius:4}})),[]);return e}(),m=(0,r().K8)((()=>{const e=j().default.state.sidebarSpaceStore;return new Set(null==e?void 0:e.getEmailDomains())}),[]),v=(0,w().A)(t),g=(0,_().N)(t),y=(0,r().K8)((()=>{if("invalidUser"===i.type)return"invalidUser";if(e.tokenType)return e.tokenType;if("group"===i.type)return"group";if("existingUser"===i.type&&!Boolean(i.membershipType)){const e=t.getSpaceId();if(e){var s;const r=n(985405).SpaceStore.createChildStore(t,{table:n(96689).NX,id:e}),o=null===(s=(0,h().sE)(r,i.value.id))||void 0===s?void 0:s.getMembershipType();i.membershipType=o??"none"}else i.membershipType="none"}if(!(0,n(743260).yi)(i))return"member";if(v.isGuestRequestRequired)return"guestRequestRequired";if(v.isStoreInTeam&&!v.teamAllowsGuests)return"teamGuestDisabled";if(!v.isStoreInTeam&&!v.spaceAllowsGuests||v.isStoreInTeam&&!v.teamAllowsGuests&&!v.spaceAllowsGuests)return"spaceGuestDisabled";const r=(0,x().zN)(i.value.email);return r&&m.has(r)?"verifiedDomain":"guest"}),[e.tokenType,i,m,v,t]),f=(0,r().K8)((()=>{const e=c.base;switch(y){case"member":case"group":return{...e,...c.normal};case"invalidUser":return{...e,...c.error};case"guest":case"guestRequestRequired":return{...e,...c.guest};case"verifiedDomain":return{...e,...c.verifiedDomain};case"spaceGuestDisabled":case"teamGuestDisabled":case"teamGroupOwner":return{...e,...c.disabled};default:(0,I().HB)(y)}}),[y,c]);function M(){switch(i.type){case"newUser":return i.value.email.trim();case"invalidUser":return i.value.text.trim();case"existingUser":return(0,n(695608).c6)(u,i.value);case"group":return(0,n(698449).Pf)({intl:u,groupName:i.value.name});default:(0,I().HB)(i)}}function C(){const e=(0,n(721479).questionMarkCircleSmallIcon)({height:16,width:16,color:"#D34F43"});switch(y){case"member":return(0,S().ju)(i)?(0,k.jsx)(A().A,{userValue:i.value,size:16}):(0,S().rP)(i)?(0,k.jsx)(A().A,{size:16,avatar:i.value}):(0,k.jsx)(A().A,{size:16});case"guest":case"guestRequestRequired":return(0,n(101163).globeSmallIcon)({height:16,width:16,color:"#DAA340"});case"invalidUser":return(0,n(577829).personCropCircleBadgeExclamationPointSmallIcon)({height:16,width:16,color:"#DE5550"});case"verifiedDomain":return(0,n(833243).checkmarkCircleSmallIcon)({height:16,width:16,color:"#53A83F"});case"group":return(0,k.jsx)("div",{style:{height:16,width:16,backgroundColor:d().IF.whiteWithAlpha(.8),borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,n(668250).R)({height:12,width:12,color:d().Tj.mediumTextColor})});case"spaceGuestDisabled":case"teamGuestDisabled":case"teamGroupOwner":return e;default:(0,I().HB)(y)}}function P(t){const n=C();let i=M(),s=c.tokenText;return e.onlyShowTokenType&&(["guest","teamGuestDisabled","spaceGuestDisabled"].includes(t)?(i="Guest",s={...s,color:"#DAA340"}):(i="Member",s={...s,color:"#53A83F"})),(0,k.jsxs)("div",{style:c.tokenContent,children:[n,(0,k.jsx)("div",{style:s,children:i})]})}function U(t){var n;t.stopPropagation(),null===(n=e.onClickRemove)||void 0===n||n.call(e)}const E="newUser"===i.type?i.value.email:"invalidUser"===i.type?i.value.text:i.value.id,R="group"!==i.type&&"invalidUser"!==i.type?i.value.email:void 0;return(0,k.jsx)(p().A,{placement:"top",renderTooltip:()=>function(e){const{tokenType:t,target:n,email:i}=e;return"guest"===t?(0,k.jsx)(l().sA,{defaultMessage:"{email} will be invited as a guest",id:"inviteTargetToken.guest.tooltip",values:{email:i}}):"spaceGuestDisabled"===t||"teamGuestDisabled"===t||"guestRequestRequired"===t?g:"invalidUser"===n.type?(0,k.jsx)(l().sA,{defaultMessage:"{text} is not a valid email",id:"inviteTargetToken.invalidUser.tooltip",values:{text:n.value.text}}):"verifiedDomain"===t&&"group"!==n.type?(0,k.jsx)(l().sA,{defaultMessage:"{email}{br}will automatically be added to the workspace{br}since @{domain} is an allowed email domain.",id:"inviteTargetToken.verifiedDomain.tooltip",values:{email:n.value.email,br:(0,k.jsx)("br",{}),domain:(0,x().zN)(n.value.email)}}):"group"===n.type?n.value.name||(0,k.jsx)(l().sA,{defaultMessage:"Untitled group",id:"inviteTargetToken.group.untitled"}):i}({tokenType:y,email:R,target:i}),render:t=>(0,k.jsx)("div",{style:c.tokenSpan,...t,children:(0,k.jsx)(n(881690).A,{isSingle:!1,format:a.isMobile?b().NY.Large:b().NY.Medium,showRemoveButton:e.showRemoveButton,onClickRemove:U,disabledFeedback:!0,value:P(y),style:f,shouldWrap:!1})})},E)};const C=function(e){const{flowId:t,store:i,disabled:a,placeholder:l,right:c,focus:p,hideIconColorAndTooltips:m,showEmptyError:v,origin:g,onFocus:h,onSubmit:b,onInputChanged:x}=e,I=(0,s().v3)(),T=(0,s().Y0)(),A=(0,r().uB)(e.inviteTargetsStore,S().Ay),w=(0,r().K8)((()=>A.state.inviteTargets),[A]),_=(0,r().K8)((()=>A.state.tokenQuery),[A]),j=w.map((e=>{const t="newUser"===e.type?e.value.email:"invalidUser"===e.type?e.value.text:e.value.id;return(0,k.jsx)(M,{store:i,target:e,showRemoveButton:!0,tokenType:m?"member":void 0,onClickRemove:()=>y().S({inviteTargetsStore:A,targetToRemove:e})},t)})),C=(0,o().IS)((e=>({tokenInputMenuItem:{paddingTop:j.length>0?4:6,paddingInlineStart:4,paddingInlineEnd:4,paddingBottom:4,borderRadius:4,minHeight:32,...p&&{background:"none"},...a&&{background:e.inputBackground,color:e.text.secondary,fill:d().Tj.white,opacity:.4}},inputAndTokenWrapRight:{gap:2},inputInnerStyle:{paddingTop:0},warningMessage:{color:"#DE5550"}})),[p,a,j]);return(0,k.jsx)(f().Ay,{focus:p,focusAfterAnimation:!0,onClick:()=>{T.isMobile||null==h||h()},format:f().le.Share,value:_,onChange:e=>y().P({environment:I,event:e,inviteTargetsStore:A,inviteOrigin:g,flowId:t,onInputChanged:x}),type:"email",tokens:j,disabled:a,autoComplete:"off",placeholder:l,onRemoveLastToken:()=>{A.setState({...A.state,inviteTargets:A.state.inviteTargets.slice(0,-1)})},right:c,showBorder:!0,inputStyle:C.inputInnerStyle,inputAndTokenWrapRightStyle:C.inputAndTokenWrapRight,style:C.tokenInputMenuItem,onSubmit:b,inputFullWidth:!0,message:(0,k.jsx)(n(381374).p,{invalidInvites:(0,u().oE)(w.map((e=>"invalidUser"===e.type?e:void 0))),showEmptyError:v,styles:C.warningMessage})})};var P=()=>n(454354),U=()=>n(980270),E=()=>n(875497),R=(n(16280),n(898992),n(354520),n(737550),()=>n(160432)),D=()=>n(68263),B=()=>n(542056),F=()=>n(125565),G=()=>n(133507),q=()=>n(718827);function L(e){const{isFirst:t,isLast:n,isSelected:i,item:s,itemStyle:r,selectedItemStyle:a,innerStyle:l,children:d,colors:u,onClick:c}=e,{isDisabled:m,tooltip:v}=s,g=(0,o().IS)((e=>{const s=(null==u?void 0:u.selectedOutline)??e.blue.border.accentPrimary,o=(null==u?void 0:u.unselectedOutline)??e.selectorBorderUnselected;return{SegmentedItem:{alignItems:"center",background:i?null==u?void 0:u.selectedBackground:void 0,borderEndStartRadius:t?3:0,borderEndEndRadius:n?3:0,borderColor:i?s:o,borderStyle:"solid",borderStartStartRadius:t?3:0,borderStartEndRadius:n?3:0,borderWidth:1,cursor:m?void 0:"pointer",display:"flex",flexBasis:"50%",marginInlineStart:t?0:-1,padding:0,userSelect:"none",zIndex:i?10:0,...r,...i?a:void 0},Inner:{borderEndStartRadius:t?2:0,borderEndEndRadius:n?2:0,borderColor:i?s:"transparent",borderStyle:"solid",borderStartStartRadius:t?2:0,borderStartEndRadius:n?2:0,borderWidth:1,display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",padding:"12px 20px",textAlign:"center",width:"100%",...l}}}),[null==u?void 0:u.selectedBackground,null==u?void 0:u.selectedOutline,null==u?void 0:u.unselectedOutline,t,n,i,m,r,a,l]),h=()=>{c&&c(s.key)};return(0,k.jsx)(p().A,{render:e=>(0,k.jsx)(q().Ay,{ariaLabel:s.ariaLabel,"aria-pressed":i,onClick:h,style:g.SegmentedItem,disabled:m,...e,children:(0,k.jsx)("div",{style:g.Inner,children:d})}),renderTooltip:()=>(0,k.jsx)("div",{children:v}),disableTooltip:i||void 0===v,placement:"bottom"})}function O(e){const{items:t=[],itemStyle:n,selectedItemStyle:i,innerStyle:s,outerStyle:r,value:a,onChange:l,colors:d}=e,u=(0,o().IS)((e=>({SegmentedButton:{background:e.background.elevated,display:"flex",width:"100%",...r}})),[r]);return 0===t.length?null:(0,k.jsx)("div",{style:u.SegmentedButton,children:t.map(((e,r)=>(0,k.jsx)(L,{isFirst:0===r,isLast:r===t.length-1,isSelected:e.key===a,item:e,itemStyle:n,selectedItemStyle:i,innerStyle:s,colors:d,onClick:l,children:e.render()},e.key)))})}var W=()=>n(535279),N=()=>n(329443),V=()=>n(637573),K=()=>n(329304),z=()=>n(749240);function J(e){var t;const{store:n,sudoModeStore:o,personPropertyInviteStore:a,onInviteCompleteFn:d,inviteOrigin:u}=e,m=(0,s().v3)(),v=$(),g=(0,r().uB)(e.inviteTargetsStore,S().Ay),h=(0,r().K8)((()=>a.state.isLoading),[a]),y=(0,i.useCallback)((e=>{a.setState({...a.state,isLoading:e,focus:E().E.NoFocus})}),[a]),[f,b]=(0,i.useState)("member"),x=(0,r().K8)((()=>{const{emailMessage:e}=a.state;return e}),[a]),I=(0,r().K8)((()=>{const{role:e}=a.state;return e}),[a]),T=(0,l().tz)(),A=(0,r().K8)((()=>a.state.flowId),[a]),M=(0,r().O$)(j().AppStoreSidebarSpaceStore),C=(0,r().K8)((()=>n.canEditMembership()),[n]),P=(0,r().K8)((()=>(0,W().U1)({inviteTargetsStore:g})),[g]),R=(0,i.useCallback)((async()=>{await U().handleEnterPress({environment:m,inviteTargetsStore:g,personPropertyInviteStore:a,allowShowEmptyError:!0})}),[m,g,a]),F=(0,i.useCallback)((()=>{const e=(0,W().U1)({inviteTargetsStore:g}),t=e.filter((({type:e})=>"newUser"===e)).map((({value:e})=>e.email)),n=e.filter((({type:e})=>"existingUser"===e)).map((({value:e})=>e.id));return N().FC({environment:m,subscriptionData:z().subscriptionDataStoreInstance.state,newGuestIds:[...t,...n]})}),[g,m]),q=(0,r().K8)((()=>F()),[F]),L=(0,r().O$)(z().subscriptionDataStoreInstance),J=(0,V().r)()??0,X=(0,r().K8)((()=>N().LS(L,J)),[J,L]),Z=(0,w().A)(n),ee=(0,r().K8)((()=>{if(Z.isGuestRequestRequired)return!1;const e=Z.isStoreInTeam&&!Z.teamAllowsGuests,t=!Z.isStoreInTeam&&!Z.spaceAllowsGuests||Z.isStoreInTeam&&!Z.teamAllowsGuests&&!Z.spaceAllowsGuests,n=P.some((e=>"newUser"===e.type||("existingUser"===e.type?"page_guest"===e.membershipType||"none"===e.membershipType:void 0)));return(e||t)&&n}),[P,Z]),te=(0,r().K8)((()=>null==M?void 0:M.getRole()),[M]),ne=(0,r().K8)((()=>!(!te||!(0,D().NB)(te))&&!(!M||M.getDisableMembershipRequests())),[te,M]),ie=(0,K().P9)({name:"members",spaceId:null==M?void 0:M.id,userId:null===(t=m.currentUser)||void 0===t?void 0:t.id,amount:1}),se=Boolean(ie&&te&&(0,D().vp)(te));(0,i.useEffect)((()=>{b(se?"member":"guest")}),[se]);const re=(0,_().N)(n),oe=x.length>1e3,ae=(0,i.useCallback)((e=>{const{response:t,shouldDoCompleteFn:n,invitedUserEmails:i,isRequestMember:s}=e;t.success?n&&(c().cI(m,{invited_user_count:i.length,is_success:t.success,can_add_member:se,invite_option:f,origin:u,invite_flow_id:A}),U().showMessageForInviteComplete({success:t.success,invitedUserEmails:i,isRequestMember:s}),y(!1),d(t)):(U().showMessageForInviteComplete({success:t.success,invitedUserEmails:i}),c().cI(m,{invited_user_count:i.length,is_success:t.success,can_add_member:se,invite_option:f,origin:u}))}),[d,A,y,m,f,se,u]),le=(0,i.useCallback)((async e=>{const{invitedUserEmails:t,shouldDoCompleteFn:i}=e;return await U().handleGuestInvite({environment:m,inviteOrigin:u,role:I,emailMessage:x,inviteTargetsStore:g,blockStore:n,sudoModeStore:o,flowId:A,onInviteComplete:e=>{ae({response:e,shouldDoCompleteFn:i||!1,invitedUserEmails:t})}})}),[m,I,x,n,o,A,g,ae,u]),de=(0,i.useCallback)((async e=>{const{invitedUserEmails:t,disable_invite_email:n,guestInviteResponse:i,shouldDoCompleteFn:s}=e;if(!M)return null;const r=null!=i&&i.success?i.invitedUsers:void 0;await U().handleMemberInvite({environment:m,spaceStore:M,flowId:A,onInviteComplete:e=>{ae({response:e,shouldDoCompleteFn:s||!1,invitedUserEmails:t})},intl:T,invitedUsers:r,inviteTargetsStore:g,inviteOrigin:u,disable_invite_email:n})}),[M,m,A,g,T,ae,u]),ue=(0,i.useCallback)((async e=>{const{invitedUserEmails:t,guestInviteResponse:i}=e;if(!M)return null;const s=null!=i&&i.success?i.invitedUsers:void 0;s&&await U().handleMemberRequest({environment:m,spaceStore:M,originType:"person_property_invite",intl:T,invitedUsers:s,reasonMessage:void 0,originId:n.id,flowId:A,onInviteComplete:e=>{ae({response:e,shouldDoCompleteFn:!0,invitedUserEmails:t,isRequestMember:!0})},inviteOrigin:u})}),[m,A,M,T,ae,n,u]),ce=(0,i.useCallback)((async()=>{const e="member"===f,t=g.state.inviteTargets.filter((e=>"newUser"===e.type||"existingUser"===e.type)).map((e=>e.value.email));if(0===t.length)return void c().N_(m,{invite_stage:"click_invite_button",invite_flow_id:A,error:"No valid input emails"});const n=F();if(y(!0),e)if(n)await de({invitedUserEmails:t,disable_invite_email:!1,guestInviteResponse:void 0,shouldDoCompleteFn:!0});else{const e=!se&&!ne,n=await le({invitedUserEmails:t,shouldDoCompleteFn:e});se?await de({invitedUserEmails:t,disable_invite_email:!0,guestInviteResponse:n,shouldDoCompleteFn:!0}):ne&&await ue({invitedUserEmails:t,guestInviteResponse:n})}else n?c().N_(m,{invite_stage:"click_invite_button",invite_flow_id:A,error:"Invite guest with guest limitation exceed"}):await le({invitedUserEmails:t,shouldDoCompleteFn:!0});y(!1),g.reset()}),[m,se,ne,f,A,F,g,le,de,ue,y]),pe=(0,i.useCallback)((async()=>{await R();const e=(0,W().U1)({inviteTargetsStore:g}).length;c().u$(m,{invited_user_count:e,invite_option:f,can_add_member:se,origin:u,inviteTargets:g.state.inviteTargets.map((e=>e.type.toString())),inviteTokenQuery:g.state.tokenQuery,invite_flow_id:A}),await ce()}),[m,A,R,ce,f,se,g,u]);let me;me=ee?re:oe?(0,k.jsx)(l().sA,{id:"shareMenu.inviteButton.emailOverMaxLength.tooltip",defaultMessage:"Message exceeds the limit of 1000 characters."}):void 0;const ve=(0,i.useMemo)((()=>[{key:"member",render:()=>(0,k.jsx)(p().A,{disableTooltip:se||ne,renderTooltip:()=>(0,k.jsx)(l().sA,{id:"invite.person_property.invite_member.tooltip",defaultMessage:"You do not have permission to add or request members to this workspace"}),render:e=>(0,k.jsx)(Y,{isSelected:"member"===f,inviteOption:"member",events:e})}),isDisabled:!se&&!ne},{key:"guest",render:()=>(0,k.jsx)(p().A,{disableTooltip:!q&&X,renderTooltip:()=>(0,k.jsx)(G().j,{}),render:e=>(0,k.jsx)(Y,{isSelected:"guest"===f,inviteOption:"guest",events:e})})}]),[f,q,X,ne,se]);return(0,k.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,k.jsx)("div",{style:v.section,children:(0,k.jsx)(O,{items:ve,itemStyle:v.itemStyle,innerStyle:v.innerStyle,value:f,onChange:e=>{b(e),c().ZZ(m,{invite_option:e,invite_flow_id:A,origin:u})}})}),!q&&X||"guest"!==f?(0,k.jsx)(Q,{tooltip:me,disabled:!C||ee||oe,onClick:pe,isLoading:h}):(0,k.jsx)(H,{onClick:()=>{c().j$(m,{invited_user_count:P.length,invite_flow_id:A,origin:u}),B().D6({environment:m,upgradeButtonName:"user_permission_item"})}})]})}function H(e){const{onClick:t}=e;return(0,k.jsx)(p().A,{disableTooltip:!1,renderTooltip:()=>(0,k.jsx)(G().j,{}),render:e=>(0,k.jsx)(R().A,{colorPalette:"blue",size:"lg",style:{marginTop:0,marginInlineEnd:16,marginBottom:16,marginInlineStart:16,borderRadius:6},onClick:t,...e,children:(0,k.jsx)(l().sA,{id:"invite.person_property.upgrade",defaultMessage:"Upgrade"})})})}function Q(e){const{tooltip:t,disabled:n,onClick:i,isLoading:s}=e;return(0,k.jsx)(p().A,{disableTooltip:!Boolean(t),renderTooltip:()=>t,render:e=>(0,k.jsx)(R().A,{colorPalette:"blue",size:"lg",style:{marginTop:0,marginInlineEnd:16,marginBottom:16,marginInlineStart:16,borderRadius:6},disabled:n,onClick:i,...e,isLoading:s,children:(0,k.jsx)(l().sA,{id:"invite.person_property.invite",defaultMessage:"Invite"})})})}function Y(e){const{isSelected:t,inviteOption:n,events:i}=e,s=$(),r=t?s.mainTextSelected:s.mainTextUnselected;let o,a;switch(n){case"guest":o=(0,k.jsx)(l().sA,{id:"invite.person_property.addAsGuest.title",defaultMessage:"Add to page only"}),a=(0,k.jsx)(l().sA,{id:"invite.person_property.addAsGuest.subtitle",defaultMessage:"Invite as a Guest"});break;case"member":o=(0,k.jsx)(l().sA,{id:"invite.person_property.addAsMember.title",defaultMessage:"Add to Workspace"}),a=(0,k.jsx)(l().sA,{id:"invite.person_property.addAsMember.subtitle",defaultMessage:"Invite and bill as a Member"});break;default:throw new Error(`Unsupported invite option: ${n}`)}return(0,k.jsx)("div",{style:s.row,...i,children:(0,k.jsxs)("div",{style:r,children:[o,(0,k.jsx)(F().A,{isSmall:!0,style:s.optionSubtitle,children:a})]})})}function $(){return(0,o().IS)((e=>({mainTextSelected:{fontWeight:T().Wy.medium,color:e.text.primary,fontSize:14,lineHeight:"14px"},mainTextUnselected:{color:e.text.secondary,fontSize:14,lineHeight:"14px"},row:{display:"flex",alignItems:"center",justifyContent:"center",gap:4,lineHeight:"14px"},section:{paddingTop:16,paddingInlineEnd:11,paddingBottom:16,paddingInlineStart:11},itemStyle:{margin:5,borderRadius:8,borderWidth:2},innerStyle:{borderWidth:0},optionSubtitle:{whiteSpace:"pre-wrap",paddingTop:2,fontSize:12}})),[])}var X=()=>n(149375),Z=()=>n(285790);function ee({handleBackButtonClick:e}){const t=(0,o().IS)((()=>({container:{display:"flex",margin:"0 12px 0px",height:40}})),[]);return(0,k.jsx)("div",{style:t.container,children:(0,k.jsx)(te,{onClick:e})})}function te(e){const{onClick:t}=e,n=(0,l().tz)(),i=(0,o().IS)((()=>({topContainer:{display:"flex",alignItems:"center",width:"max-content"},iconButton:{marginInlineEnd:6,height:24,width:24},arrowIcon:{height:16,width:16,strokeWidth:T().Wy.semibold},sendInviteLabel:{fontWeight:T().Wy.medium}})),[]);return(0,k.jsxs)("div",{style:i.topContainer,children:[(0,k.jsx)(Z().A,{icon:X().v,iconStyle:i.arrowIcon,style:i.iconButton,onClick:t,ariaLabel:n.formatMessage({id:"shareMenu.backButton.iconButton",defaultMessage:"Go back to main share menu."})}),(0,k.jsx)(F().A,{style:i.sendInviteLabel,children:(0,k.jsx)(l().sA,{id:"invite.person_property.popup_title",defaultMessage:"Invite and mention"})})]})}var ne=()=>n(456328),ie=()=>n(623580),se=()=>n(250064);const re=u().sg((({environment:e,flowId:t,origin:n})=>{c().IT(e,{origin:n,invite_flow_id:t})}),1e3);function oe(e){const{inviteTargetsStore:t,personPropertyInviteStore:n,inviteOrigin:o}=e,a=(0,s().v3)(),{focus:l,emailMessage:d}=(0,r().K8)((()=>{const{focus:e,emailMessage:t}=n.state;return{focus:e,emailMessage:t}}),[n]),u=(0,r().K8)((()=>n.state.flowId),[n]),c=(0,i.useCallback)((()=>{t.reset()}),[t]),p=(0,i.useCallback)((e=>{n.setState({...n.state,focus:l,emailMessage:e.target.value}),re({environment:a,flowId:u,origin:o})}),[a,n,u,o,l]),m=(0,i.useCallback)((()=>{c()}),[c]),v=(0,i.useCallback)((()=>{n.setState({...n.state,focus:E().E.MessageInput,emailMessage:d})}),[n,d]);return(0,k.jsx)(ae,{focus:l===E().E.MessageInput,value:d,onFocus:v,onChange:p,onCancel:m,maxLength:1e3,inviteTargetsStore:t})}function ae(e){const{focus:t,value:n,maxLength:i,inviteTargetsStore:a,onFocus:d,onChange:u,onCancel:c}=e,p=(0,l().tz)(),m=n.length/i>=.8,v=(0,ne().BS)(n),g=m||v,h=(0,s().Y0)(),y=(0,o().IS)((e=>({container:{maxHeight:80,bottom:0,paddingTop:2,paddingInlineEnd:16,paddingBottom:2,paddingInlineStart:16,backgroundColor:e.background.elevated,pointerEvents:"all",transitionProperty:"max-height",transitionDuration:"0.3s",overflow:"hidden",zIndex:1,height:72},input:{maxHeight:80,borderTop:1,borderTopStyle:"solid",borderTopColor:e.regularDividerColor,padding:2,fontSize:14,transitionProperty:"max-height",transitionDuration:"0.3s",height:"100%"},inputBox:{paddingTop:0,paddingInlineEnd:4,paddingBottom:0,paddingInlineStart:4,boxShadow:e.inputBoxShadow,background:e.inputBackground,width:"auto",height:"100%",borderRadius:6,...t&&{background:"none",boxShadow:e.inputBlueFocusRing}}})),[t]),f=(0,r().K8)((()=>a.state.inviteTargets.filter((e=>"newUser"===e.type||"existingUser"===e.type)).map((e=>e.value.email))),[a]),S=(0,r().K8)((()=>f.length>0?p.formatMessage({id:"invite.person_property.emailMessageInput.placeholder.withEmails",defaultMessage:"Add a message for {users}"},{users:(0,se().l)(f)}):p.formatMessage({id:"invite.person_property.emailMessageInput.placeholder.noEmails",defaultMessage:"Add a message to your invite..."})),[p,f]);return(0,k.jsxs)("div",{style:y.container,children:[g?(0,k.jsx)(le,{value:n,maxLength:i,shouldShowLengthWarning:m,shouldShowLinkWarning:v}):void 0,(0,k.jsx)(ie().A,{textarea:!0,focusInitial:!1,format:ie().C.Transparent,placeholder:S,maxlength:i,focus:t,value:n,onFocus:d,onChange:u,inputStyle:y.input,onCancel:c,style:y.inputBox,onClick:()=>{h.isMobile||null==d||d()}})]})}function le(e){const{shouldShowLengthWarning:t,shouldShowLinkWarning:n,value:i,maxLength:s}=e,r=(0,o().IS)((e=>({container:{position:"absolute",top:0,display:"flex",justifyContent:"center",fontSize:12,color:e.text.tertiary,width:"100%"},warning:{display:"flex",justifyContent:"center",width:"calc(100% - 36px)",backgroundColor:e.background.elevated,marginTop:1}})),[]);return(0,k.jsx)("div",{style:r.container,children:(0,k.jsxs)("div",{style:r.warning,children:[t?(0,k.jsx)(l().sA,{defaultMessage:"{characters} / {maxCharacters} characters",id:"ContextualInvite.permissions_invites.messageLengthWarning",values:{characters:i.length,maxCharacters:s}}):void 0,t&&n?" · ":void 0,n?(0,k.jsx)(l().sA,{defaultMessage:"Links will be omitted from your message",id:"ContextualInvite.permissions_invites.removeLinkWarning"}):void 0]})})}function de(e){const{store:t,handleBackButtonClick:n,onInviteCompleteFn:l,inviteTargetsStore:d,personPropertyInviteStore:c,inviteOrigin:p}=e,m=(0,r().uB)(void 0,P().A),v=(0,s().v3)(),g=(0,i.useCallback)((async()=>{await U().handleEnterPress({environment:v,inviteTargetsStore:d,personPropertyInviteStore:c,allowShowEmptyError:!1})}),[v,d,c]),h=(0,o().IS)((()=>({container:{position:"relative",width:450,transition:"all",transitionDuration:"0.3s",display:"flex",flexDirection:"column",maxHeight:500},searchBar:{paddingInlineStart:16,paddingInlineEnd:16,paddingBottom:16,paddingTop:16},horizontalLine:{margin:"0",color:"#E3E2E0",opacity:.3}})),[]);return(0,k.jsx)(a().N,{debugName:"PersonPropertyInvitePopup",capture:!0,onLeft:u().D_,onRight:u().D_,onSelectAll:u().D_,onRedo:u().D_,onUndo:u().D_,onCut:u().D_,onCopy:u().D_,onPaste:u().D_,onKeypress:u().D_,onDelete:u().D_,onBackspace:u().D_,onTab:u().D_,onEnter:g,children:(0,k.jsxs)("div",{style:h.container,children:[(0,k.jsx)(ee,{handleBackButtonClick:n}),(0,k.jsx)("hr",{style:h.horizontalLine}),(0,k.jsx)("div",{style:h.searchBar,children:(0,k.jsx)(ue,{store:t,inviteTargetsStore:d,personPropertyInviteStore:c,inviteOrigin:p})}),(0,k.jsx)(oe,{store:t,inviteTargetsStore:d,personPropertyInviteStore:c,inviteOrigin:p}),(0,k.jsx)("div",{children:(0,k.jsx)(J,{store:t,inviteTargetsStore:d,sudoModeStore:m,onInviteCompleteFn:l,personPropertyInviteStore:c,inviteOrigin:p})})]})})}function ue(e){const{store:t,personPropertyInviteStore:n,inviteOrigin:i}=e,a=(0,l().tz)(),u=(0,s().v3)(),y=(0,r().uB)(e.inviteTargetsStore,S().Ay),f=(0,g().L)(),b=(0,h().I_)(),x=(0,v().A)(f),{focus:I,emailMessage:T}=(0,r().K8)((()=>{const{focus:e,emailMessage:t}=n.state;return{focus:e,emailMessage:t}}),[n]),{role:A,showEmptyError:w}=(0,r().K8)((()=>{const{role:e,showEmptyError:t}=n.state;return{role:e,showEmptyError:t}}),[n]),_=(0,r().K8)((()=>t.getType()),[t]),j=(0,r().K8)((()=>n.state.flowId),[n]),M=(0,r().K8)((()=>t.canEditMembership()),[t]),P=(0,o().IS)((()=>({permissionsRoleSelectButton:{display:"flex",whiteSpace:"nowrap",height:20,margin:0,borderRadius:4,color:d().Tj.uiGray}})),[]);return f&&b&&x?(0,k.jsx)(p().A,{disableTooltip:M,renderTooltip:()=>{if(!M)return(0,k.jsx)(l().sA,{id:"shareMenu.inviteButton.fullAccessOnlyMessage.tooltip",defaultMessage:"Only those with full access can add people."})},render:e=>(0,k.jsx)("div",{style:{display:"flex"},...e,children:(0,k.jsx)(C,{inviteTargetsStore:y,store:f,disabled:!M,origin:i,flowId:j,focus:I===E().E.InviteInput,showEmptyError:w,onFocus:()=>{n.setState({...n.state,focus:E().E.InviteInput,emailMessage:T||""})},placeholder:a.formatMessage({id:"invite.person_property.inviteTargetsInput.placeholder",defaultMessage:"Add emails..."}),onInputChanged:()=>n.setState({...n.state,showEmptyError:!1}),right:(0,k.jsx)(m().Ay,{disabled:!M,role:A,table:"block",type:"user_permission",blockType:_,isInvite:!0,upgradeButtonName:"invite_permission_block",buttonStyle:P.permissionsRoleSelectButton,isMenuItem:!1,onChange:e=>{n.setState({...n.state,role:e}),c().et(u,{invited_role:e,invite_flow_id:j,origin:i})}})})})}):null}},980270:(e,t,n)=>{n.r(t),n.d(t,{handleEnterPress:()=>_,handleGuestInvite:()=>T,handleMemberInvite:()=>I,handleMemberRequest:()=>A,handlePopupClickWithEmail:()=>j,inviteToSpaceAsMembers:()=>w,showMessageForInviteComplete:()=>k});n(944114),n(898992),n(354520),n(430670),n(581454),n(737550),n(296540);var i=()=>n(842599),s=()=>n(165358),r=()=>n(206267),o=()=>n(68263),a=()=>n(69708),l=()=>n(319625),d=()=>n(229833),u=()=>n(966505),c=()=>n(559506),p=()=>n(579627),m=()=>n(542056),v=()=>n(471995),g=()=>n(250064),h=()=>n(535279),y=()=>n(329443),f=()=>n(134217),S=()=>n(10984),b=()=>n(475355),x=n(474848);async function I(e){const{environment:t,onInviteComplete:n,flowId:i,intl:r,spaceStore:o,invitedUsers:a,inviteTargetsStore:c,inviteOrigin:p,disable_invite_email:m}=e;let v={success:!1};try{v=await w({environment:t,spaceStore:o,invitedUsers:a,from:p,flowId:i,intl:r,inviteTargetsStore:c,disable_invite_email:m}),v.success?u().ke(t,{invited_user_count:Object.keys(v.invitedUsers).length,invite_flow_id:i,origin:p}):(u().N_(t,{invite_stage:"invite_member",invite_flow_id:i,error:v.error}),s().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberInvite"}))}catch(g){const e=(0,l().A)(g);u().N_(t,{invite_stage:"invite_member",invite_flow_id:i,error:e}),s().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberInvite",error:(0,d().convertErrorToLog)(g)})}finally{null==n||n(v)}}async function T(e){const{environment:t,blockStore:n,inviteTargetsStore:a,sudoModeStore:c,onInviteComplete:m,inviteOrigin:v,role:g,emailMessage:f,flowId:S}=e;let b={success:!1};try{if(b=await async function(e){const{environment:t,blockStore:n,sudoModeStore:s,inviteTargetsStore:a,role:l,inviteOrigin:d,emailMessage:u,onInviteStart:c}=e,m=e.flowId||r().JW();if(!(0,o().PW)(l))return{success:!1};const{tokenQuery:v,inviteTargets:g}=a.state;if((0,i().DT)(v.trim())&&0===g.length){const e={type:"newUser",value:{email:v.trim()},source:"email"};h().P4({target:e,inviteTargetsStore:a})||a.setState({inviteTargets:[...a.state.inviteTargets,e],tokenQuery:""})}const f=y().Nr(n,h().U1({inviteTargetsStore:a}));null==c||c();const S=await p().eP({environment:t,store:n,sudoModeStore:s,inviteTargets:f,inviteRole:l,isOnboarding:!1,invite:{inviteFlowId:m,inviteMessage:u,inviteOrigin:d}});return S}({environment:t,blockStore:n,sudoModeStore:c,inviteTargetsStore:a,role:g,emailMessage:f,inviteOrigin:v,flowId:S}),!b.success)return}catch(x){const e=(0,l().A)(x);u().N_(t,{invite_stage:"invite_guest",invite_flow_id:S,error:e}),s().log({level:"error",from:"personPropertyInviteAction",type:"handleGuestInvite",error:(0,d().convertErrorToLog)(x)})}finally{b.success&&u().oU(t,{invited_user_count:Object.keys(b.invitedUsers).length,origin:v,invite_flow_id:S}),null==m||m(b)}return b}async function A(e){const{environment:t,spaceStore:n,originId:i,originType:r,reasonMessage:o,intl:a,flowId:d,onInviteComplete:p,invitedUsers:m,inviteOrigin:h}=e,y=[];let f={success:!1};try{const e=Object.entries(m).map((([e,s])=>c().callApi({eventName:"requestAccess",environment:t,data:{type:"actor-to-space",forActorId:s,spaceId:n.id,message:o,attributes:{origin_id:i,origin_type:r,origin_table:"block",add_permissions_on_approval:!1}}}).catch((()=>y.push([e,s])))));await Promise.all(e),f={success:!0,invitedUsers:m,requestedUsers:{}}}catch(S){const e=(0,l().A)(S);return u().N_(t,{invite_stage:"request_member",invite_flow_id:d,error:e}),function(e,t){const n=Object.keys(t);if(0===n.length)return;v().D6({label:e.formatMessage({id:"contextual_invite.request_members_failure",defaultMessage:"Failed to request {users} to become members"},{users:(0,g().l)(n)})})}(a,m),s().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberRequest",data:{miscDataToConvertToString:{inviteTargetEmailsWithErrors:y}}}),f}finally{f.success&&u().d6(t,{invited_user_count:Object.keys(f.invitedUsers).length,origin:h,invite_flow_id:d}),null==p||p(f)}return f}async function w(e){const{environment:t,spaceStore:n,from:i,invitedUsers:r,intl:o,flowId:a,onInviteStart:l,inviteTargetsStore:d,disable_invite_email:u}=e,c=function(e){const t=[];if(!e)return t;for(const[n,i]of Object.entries(e))t.push({type:"existingUser",value:{id:i,email:n,version:1}});return t}(r),m=function(e){return e.state.inviteTargets.filter((e=>"newUser"===e.type))}(d).filter((e=>!c.some((t=>t.value.email===e.value.email)))),h=[...c,...m],y=(0,S().AI)(),x=y&&(0,f().fk)(y)?"owner":"member";let I={success:!1};if(!n.isTeamsEnabled()){if(!(await b().oH({environment:t,flowId:a,trackCreateTeamComplete:!1})))return I}try{null==l||l(),I=await p().cl({store:n,environment:t,inviteTargets:h.map((e=>({...e,membershipType:x}))),isOnboarding:!1,invite:{inviteOrigin:i,inviteFlowId:a,disable_invite_email:u}})}catch(T){return function(e,t){0!==t.length&&v().D6({label:e.formatMessage({id:"contextual_invite.contextual_invite_failure",defaultMessage:"{userCount, plural, one {Failed to invite {users} as member} other {Failed to invite {users} as members}}"},{users:(0,g().l)(t.flatMap((e=>e.value.email||[]))),userCount:t.length})})}(o,h),s().log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.inviteTargets",data:{miscDataToConvertToString:{usersToInviteAsMembers:h}}}),I}return I}async function _(e){const{environment:t,inviteTargetsStore:n,allowShowEmptyError:s,personPropertyInviteStore:r}=e,o=n.state.tokenQuery;if(""===o)return void(0===n.state.inviteTargets.length&&s&&r.setState({...r.state,showEmptyError:!0}));const a=(0,i().C3)(o),l=await m().Ah(t,a);let d=[];0===l.length&&(d=[{type:"invalidUser",value:{text:o}}]);const u=l.filter((e=>!h().P4({inviteTargetsStore:n,target:e}))),c=[...n.state.inviteTargets,...u,...d];n.setState({...n.state,inviteTargets:c,tokenQuery:""})}function j(e){const{email:t,inviteTargetsStore:n}=e,i={type:"newUser",value:{email:t},source:"email"},s=[...n.state.inviteTargets];h().P4({inviteTargetsStore:n,target:i})||s.push(i),n.setState({...n.state,inviteTargets:s})}function k(e){const{success:t,invitedUserEmails:n,isRequestMember:i}=e;t?0!==n.length&&(i?v().D6({label:(0,x.jsx)(a().sA,{id:"shareMenu.inviteSuccess.snackbarMessage.sendMemberRequest",defaultMessage:"Successfully sent request to admin to invite {users}",values:{users:(0,g().l)(n)}})}):v().D6({label:(0,x.jsx)(a().sA,{id:"shareMenu.inviteSuccess.snackbarMessage",defaultMessage:"Successfully invited {users}",values:{users:(0,g().l)(n)}})})):v().D6({label:(0,x.jsx)(a().sA,{id:"shareMenu.inviteFailure.snackbarMessage",defaultMessage:"Failed to invite {users}",values:{users:(0,g().l)(n)}})})}}}]);