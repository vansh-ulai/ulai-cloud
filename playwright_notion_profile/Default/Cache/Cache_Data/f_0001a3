"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[1397,59388,90871],{53592:(e,t,r)=>{r.r(t),r.d(t,{attemptServerBackedLocalDuplicate:()=>w,serverBackedLocalDuplicate:()=>M});r(944114),r(581454);var o=()=>r(165358),a=()=>r(386164),i=()=>r(388821),n=()=>r(912720),s=()=>r(199378),c=()=>r(229833),l=()=>r(763824),d=()=>r(973647),u=()=>r(466614),p=()=>r(559506),g=()=>r(666144),m=()=>r(231297),v=()=>r(974233),h=()=>r(611191),y=()=>r(866654),f=()=>r(261450),_=()=>r(503388),S=()=>r(966152),k=()=>r(59110),b=()=>r(949653),I=()=>r(677733);function M(e){const{environment:t,sourceBlock:r,targetInMemoryRecordCache:o,transaction:a,options:n,targetSpaceId:s,installationImprint:c,templateInstallationMetadata:u={},shouldUseSynchronousDuplicationAPI:p,stopwatch:g,from:m}=e,v=performance.now();null==g||g.mark("server_duplicate_start");const h=e.copyIndicators??(0,_().U8)({environment:t,sourceBlocks:[r],targetRecordCache:o,transaction:a,spaceId:s});null==g||g.mark("create_copy_indicators");const y=l().yX();return a.postSubmitCallbacks.push((async e=>{if(null==g||g.mark("transaction_post_submit_callback"),e)return(0,S().P0)({environment:t,type:"server_duplicate_transaction_post_submit_callback_error",data:{copyIndicatorIds:h.map((e=>e.id)),error:e,targetSpaceId:s,options:n}}),void y.resolve(d().Q.fail(e));(0,_().Yj)(h),null==g||g.mark("initialize_copy_indicators_progress_state");const o=await w({environment:t,sourceBlockPointer:r,targetBlockStore:h[0],options:n,templateInstallationMetadata:u,stopwatch:g,from:m});if(d().Q.isSuccess(o))return(0,f().E)({environment:t,success:!0,time:performance.now()-v,user_action:a.getUserActionForAnalyticsPurposesOnly(),is_duplication_local:!0,duplication_size:o.value.size,method:"server_backed_local_duplication",from:m}),null==g||g.mark("server_backed_local_duplicate_success"),(0,_().dH)(h),void y.resolve(d().Q.success({}));const l=a.getUserActionForAnalyticsPurposesOnly(),k=await(0,I().performServerDuplicate)({environment:t,copyIndicators:h,sourceBlocks:[r],targetSpaceId:s,options:n,templateInstallationMetadata:u,installationImprint:c,shouldUseSynchronousDuplicationAPI:p,stopwatch:g,userAction:l});if((0,_().dH)(h),d().Q.isFail(k))return(0,_().uC)({environment:t,copyIndicators:h}),(0,S().lI)({environment:t,type:"server_duplicate_iterator_error",error:k.error,data:{}}),void y.resolve(k);(0,f().E)({environment:t,success:!0,time:performance.now()-v,user_action:a.getUserActionForAnalyticsPurposesOnly(),is_duplication_local:!0,duplication_size:k.value.size,method:"sbld_fallback_server_duplication",from:m}),null==g||g.mark("server_duplicate_success"),y.resolve(d().Q.success({recordIdMap:k.value.recordIdMapJson?i().RecordMapPolymorphic.create(k.value.recordIdMapJson):void 0}))})),d().Q.success({blockStores:h,onComplete:y.promise})}async function w(e){const{environment:t,sourceBlockPointer:r,targetBlockStore:l,options:f,templateInstallationMetadata:_,recordLimit:I=500,targetInMemoryRecordCache:M,stopwatch:w,from:C}=e;null==w||w.mark("attempt_server_backed_local_duplicate_start"),(0,S().JW)({environment:t,type:"server_duplicate_attempt_server_backed_local_duplicate",data:{sourceBlockPointer:r,targetBlockStore:l,targetSpaceId:l.getSpaceId(),options:f}});const B=(0,h().$J)(),x=await async function(e){const{environment:t,sourceBlockPointer:r,targetBlockStore:n,targetInMemoryRecordCache:s,options:l,enableLegacyTransclusionFixing:d,recordLimit:u}=e,m=s??n.inMemoryRecordCache,h={environment:t,blockId:r.id,inMemoryRecordCache:m,options:{allowCopyCollections:!0,requireFullSubtree:!0,skipTransclusionContainerChildren:!l.deepCopyTransclusionContainers,allowCopyExternalObjectInstances:!l.convertExternalObjectInstancesToPlaceholders,includeLegacyTransclusionBlockValues:d}};let f;if(f=(0,k().loadLocalSubtree)(h),!f.recordMap&&m===t.defaultRecordCache.inMemoryRecordCache)try{(0,S().JW)({environment:t,type:"performInexactPagePreload",data:{message:"No local subtree found, performing performInexactPagePreload",loadLocalSubtreeArgs:h}}),await(0,y().A$)(t,{table:"block",id:r.id,spaceId:r.spaceId}),f=(0,k().loadLocalSubtree)(h)}catch(_){o().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"persistedRecordCachePreloadError",error:(0,c().convertErrorToLog)(_),data:{message:"Failed to preload subtree from persisted record cache"}})}f.recordMap||((0,S().JW)({environment:t,type:"loadLocalSubtreeApi",data:{message:"No local subtree found from previous attempts, attemping API call to loadBlockSubtree",currentLocalSubtreeResponse:f}}),f=await async function(e){const{environment:t,sourceBlockPointer:r,recordLimit:n,targetBlockStore:s,loadLocalSubtreeArgs:l}=e;try{const e=await p().callApi({eventName:"loadBlockSubtree",environment:t,data:{block:{id:r.id,spaceId:r.spaceId},shallow:!1,recordCountLimit:n},headers:(0,a().WS)({spaceId:r.spaceId})});if((0,S().JW)({environment:t,type:"loadBlockSubtreeApiResult",data:{message:"Result from loadBlockSubtree API call",subtreeResult:e,apiArgs:{block:{id:r.id,spaceId:r.spaceId},shallow:!1,recordCountLimit:n}}}),"success"===e.type){const r=i().RecordMapWithRole.create(e.data.subtreeRecordMap);return await g()._O({environment:t,inMemoryRecordCache:l.inMemoryRecordCache,recordMap:r,debugSource:"load_local_subtree_from_server"}),(0,k().loadLocalSubtree)(l)}{const t=(0,v().V)(e);o().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"loadBlockSubtreeFailure",data:{message:"Error fetching subtree",miscDataToConvertToString:{error:t,sourceBlockPointer:r,cacheSize:s.inMemoryRecordCache.size,targetBlockPointer:{id:s.id,spaceId:s.getSpaceId(),type:s.getType()}}}})}}catch(_){o().log({level:"error",from:"attemptServerBackedLocalDuplicate",type:"subtreeLoadError",error:(0,c().convertErrorToLog)(_),data:{message:"Error loading subtree",miscDataToConvertToString:{sourceBlockPointer:r,cacheSize:s.inMemoryRecordCache.size,targetBlockPointer:{id:s.id,spaceId:s.getSpaceId(),type:s.getType()}}}})}}({environment:t,sourceBlockPointer:r,recordLimit:u,targetBlockStore:n,loadLocalSubtreeArgs:h}));f&&!f.recordMap&&o().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"subtreeLoadFailure",data:{message:"Failed to load subtree",miscDataToConvertToString:{sourceBlockPointer:r,cacheSize:n.inMemoryRecordCache.size,reason:"error"===f.type?f.reason:void 0,targetBlockPointer:{id:n.id,spaceId:n.getSpaceId(),type:n.getType()},missingRecord:"error"===f.type?f.pointer:void 0}}});return f}({environment:t,sourceBlockPointer:r,targetBlockStore:l,targetInMemoryRecordCache:M,options:f,enableLegacyTransclusionFixing:B,recordLimit:I});if(null==w||w.mark("try_load_local_subtree_finished"),!x||!x.recordMap)return d().Q.fail({});if(u().Lw({sourceSpaceId:r.spaceId,targetSpaceId:l.getSpaceId(),sourceBlockSubtree:x.recordMap}))return o().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"accessLockingWarning",data:{message:"Unable to perform local duplication",miscDataToConvertToString:{sourceBlockPointer:r,targetBlockPointer:{id:l.id,spaceId:l.getSpaceId(),type:l.getType()}}}}),null==w||w.mark("attempt_server_backed_local_duplicate_failure"),d().Q.fail({});for(const a of x.recordMap.getTables())if(a===n().yB||a===s().SC)return o().log({level:"warning",from:"attemptServerBackedLocalDuplicate",type:"invalidRecordType",data:{message:"Local duplication does not support automation tables",miscDataToConvertToString:{sourceBlockPointer:r,targetBlockPointer:{id:l.id,spaceId:l.getSpaceId(),type:l.getType()}}}}),null==w||w.mark("attempt_server_backed_local_duplicate_failure"),d().Q.fail({});try{var T;(0,S().JW)({environment:t,type:"server_backed_duplicate_start_transaction",data:{message:"Starting transactionActions.createAndCommit for localDuplicate",sourceBlockPointer:r,targetBlockPointer:{id:l.id,spaceId:l.getSpaceId(),type:l.getType()}}});const{serverCommitResult:e}=m().createAndCommit({userAction:"server_backed_local_duplicate",environment:t,canUndo:!0,isTemplateInstantiationTransaction:Boolean(_),perform:e=>(0,b().localDuplicate)({environment:t,sourceBlockId:r.id,targetBlockPointer:l.pointer,sourceBlockSubtree:x.recordMap,targetInMemoryRecordCache:l.inMemoryRecordCache,transaction:e,templateInstallationMetadata:_,stopwatch:w,options:{...f,preventLegacyTransclusions:B},from:C})});return await e,null==w||w.mark("server_backed_local_duplicate_finished"),(0,S().JW)({environment:t,type:"server_duplicate_attempt_server_backed_local_duplicate_success",data:{targetSpaceId:l.getSpaceId(),options:f}}),d().Q.success({size:null===(T=x.recordMap)||void 0===T?void 0:T.getSize(),pageStore:l,transactionPromise:e})}catch(A){return o().log({level:"error",from:"attemptServerBackedLocalDuplicate",type:"subtreeLoadError",error:(0,c().convertErrorToLog)(A),data:{message:"Failed to load subtree",miscDataToConvertToString:{sourceBlockPointer:r,targetBlockPointer:{id:l.id,spaceId:l.getSpaceId(),type:l.getType()}}}}),d().Q.fail({})}}},152236:(e,t,r)=>{r.d(t,{M:()=>u,h:()=>p});r(16280),r(898992),r(354520);var o=()=>r(700500),a=()=>r(363497),i=()=>r(179034),n=()=>r(869558),s=()=>r(333334),c=()=>r(384944),l=()=>r(568131),d=()=>r(765957);function u(e){var t;const{environment:r,collectionViewStore:s,parentCollectionViewBlockStore:l,transaction:u,filter:p,inMemoryRecordCache:g,sort:m,semanticQuery:v,assistantChatSessionId:h}=e,y=d().default.state.sidebarSpaceStore,f=d().default.state.sidebarSpaceViewStore;if(!y||!f)throw new Error("No current space or space view.");const _=r.currentUser.id;if(!_)throw new Error("User is not logged in.");const S=c().Wv({environment:r,type:o().xd.collectionViewPage,inMemoryRecordCache:y.inMemoryRecordCache,transaction:u,spaceId:y.id,permissions:[{type:"user_permission",user_id:_,role:"editor"}]}),k={type:"table",parent_id:S.id,parent_table:i().ev,alive:!0,space_id:y.id,format:{table_properties:s.getFormat().table_properties,timeline_arrows_by:void 0,subitem_display_mode:"hidden",table_subitem_toggle_column:"title",is_unlisted:!0,collection_pointer:s.getFormat().collection_pointer??(null===(t=l.getCollectionPointers())||void 0===t?void 0:t[0]),...v?{is_unlisted_from_semantic_query:{is_from_semantic_query:!0,query:v}}:{is_unlisted_from_semantic_query:{is_from_semantic_query:!1}}},query2:{filter:p,sort:m}},b=c().eC({environment:r,table:n().Gy,value:k,inMemoryRecordCache:g,transaction:u});return c().zv({store:S,data:{parent_id:h,parent_table:a().TF,alive:!0,view_ids:[b.id]},transaction:u}),{collectionViewStore:b,linkedDatabaseCollectionBlockStore:S}}async function p(e){const{environment:t,transaction:r,acceptMoveToArgs:o,linkedDatabaseBlockStore:a}=e,{blockStores:[i]}=l().duplicateBlock({environment:t,stores:[a],transaction:r,targetSpaceId:a.getSpaceId(),executionTarget:"local",from:"save_unlisted_collection_view",options:{resolveTemplateVariables:!1,addCopyName:!1,allowRedundancy:!0,deepCopyTransclusionContainers:!0},skipUserFacingMessages:!0});c().zv({store:i,data:{alive:!0},transaction:r});for(const n of i.getCollectionViewStores())c().zv({store:n.getFormatStore(),data:{is_unlisted:null,is_unlisted_from_semantic_query:null},transaction:r});return await s().Ai({...o,blocksToMove:[i],transaction:r}),i}},274375:(e,t,r)=>{r.d(t,{Q:()=>a});r(898992),r(354520),r(672577);var o=()=>r(898244);function a(e,t){const r={property:o().rn,visible:!0,width:276},a={property:t,visible:!0},i=[r,a],n=e.getCollectionViewStores().find((e=>"table"===e.getType())),s=null==n?void 0:n.getFormatStore().getKeyStore("table_properties").getValue();if(!n||!s||0===s.length)return i;const c=s.find((e=>e.property===o().rn))??r;return[c,s.find((e=>e.property===t))??a,...s.filter((e=>e.property!==o().rn&&e.property!==t))]}},384856:(e,t,r)=>{r.d(t,{B:()=>g,G:()=>p});var o=()=>r(584262),a=()=>r(650829),i=()=>r(152236),n=()=>r(681445),s=()=>r(492414),c=()=>r(732038),l=()=>r(333334),d=()=>r(577142),u=()=>r(231297);function p(e){const{collectionContextStore:t,environment:r,originRect:a,isChartDrilldown:n,intl:s}=e,d=null==t?void 0:t.collectionViewBlockStore(),p=null==t?void 0:t.collectionViewStore();d&&p&&l().ho({environment:r,blocks:[d],originRect:a,moveToContext:"ai_ephemeral_view",isAddTo:!0,isDefaultPrivateLocation:!0,forceShowPrivatePageOption:!0,dontCommitActions:!0,onAccept:async e=>{const{performResult:a}=await u().createAndCommitAsync({environment:r,userAction:"UnlistedCollectionViewMoreButton.handleAddViewToMenuClick",waitForServerCommit:!0,perform:o=>n?c().Iz({environment:r,collectionViewStore:p,collectionViewBlockStore:d,collectionContextStore:t,acceptMoveToArgs:e,transaction:o,intl:s}):(0,i().h)({environment:r,transaction:o,linkedDatabaseBlockStore:d,acceptMoveToArgs:e})});await g({environment:r,blockStore:a,pageVisitSource:n?o().y8.ChartsDrilldown:o().y8.AIEphemeralView})}})}async function g(e){const{environment:t,blockStore:r,pageVisitSource:o}=e;if(!r)return;const i=(0,s().Ay)({store:r,pageVisitSource:o});(0,d().navigate)({environment:t,url:i});const{assistantMenuActions:c}=await a().assistantDependency.load();n().S.close(),await c.closeAssistantRightHandSideMenu({environment:t})}},418375:(e,t,r)=>{r.d(t,{A:()=>o});const o=r(757695).Store.createValue({executionTarget:null},{name:"DuplicationDebuggingStore"})},568131:(e,t,r)=>{r.r(t),r.d(t,{duplicateBlock:()=>C});r(16280),r(898992),r(823215),r(581454),r(737550);var o=()=>r(929219),a=()=>r(665344),i=()=>r(854150),n=()=>r(763824),s=()=>r(973647),c=()=>r(970330),l=()=>r(901389),d=()=>r(863168),u=()=>r(972435),p=()=>r(494043),g=()=>r(406792);class m{constructor(e){this.environment=void 0,this.metricName=void 0,this.startMetric=void 0,this.prevLapMetric=void 0,this.extraData=void 0,this.environment=e.environment,this.metricName=e.metricName,this.startMetric=g().default.mark(e.metricName),this.prevLapMetric=g().default.mark(e.metricName),this.extraData=e.extraData??{}}mark(e){g().default.measure(this.prevLapMetric,{environment:this.environment,data:{type:e,...this.extraData},sampleDecision:"default"}),this.prevLapMetric=g().default.mark(this.metricName)}end(){g().default.measure(this.startMetric,{environment:this.environment,data:{type:"total",...this.extraData},sampleDecision:"default"})}}var v=()=>r(765957),h=()=>r(261358),y=()=>r(95758),f=()=>r(418375),_=()=>r(261450),S=()=>r(977529),k=()=>r(112589),b=()=>r(985284),I=()=>r(949653),M=()=>r(53592),w=()=>r(677733);function C(e){if(e.skipUserFacingMessages)return B(e);const t=b().CU({sourceBlocks:e.stores});try{const r=B({...e,onRedundantDuplicationError:()=>{(0,S().Yv)()}});return{...r,onComplete:r.onComplete.then((e=>("success"===e.status?b().MK(t):b().UO(t),e))).catch((e=>{throw b().UO(t),e}))}}catch(r){throw b().UO(t),r}}function B(e){const{environment:t,stores:r,transaction:g,targetSpaceId:S,executionTarget:b,from:C,options:B,installationImprint:x,shouldAttemptServerBackedLocalDuplication:T,templateInstallationMetadata:A,shouldUseSynchronousDuplicationAPI:P,skipUserFacingMessages:D,onRedundantDuplicationError:R}=e,j="local"===(f().A.getState().executionTarget??b)?"local_duplication":T?"server_backed_local_duplication":P?"server_synchronous_duplication":"server_duplication",L=new m({environment:t,metricName:"duplicate_block_stopwatch",extraData:{duplication_type:j,from:C}});if(0===r.length)throw new Error("Must duplicate at least one block");const U=r[0].getSpaceId();if(!r.every((e=>e.getSpaceId()===U)))throw new Error("All stores must be in the same space");if(r.length>1&&!r.every((e=>e.isTypedCollectionViewBlock())))throw new Error("Multiple source blocks only supported for grouped typed DB duplication");!function(e){const{environment:t,stores:r}=e;for(const n of r){var o,a;const e=(0,h().zH)(n).getValue();if(!e)continue;const{sidebarSpaceStore:r}=v().default.getState();let s;r&&e.parent_table===i().yK&&(s=y().h.createChildStore(r,{table:i().yK,id:e.parent_id}));const l=n.getAssociatedCollectionId()??(null===(o=n.getCollectionStore())||void 0===o?void 0:o.id),d={from:"copy",type:e.type,teamStore:s,is_toggleable:(0,p().Yt)(e.type,e.format),collection_id:n.getAssociatedCollectionId()??(null===(a=n.getCollectionStore())||void 0===a?void 0:a.id),new_page_id:"page"===e.type?n.id:void 0,creating_block_id:n.id,parent_collection_id:n.getParentCollectionIdUpToTwoLevels(),form_id:n.getFirstFormIdInCollectionViewBlock()};c().tP(e.type)?c().vH(t,{...d,type:e.type,collection_id:l||""}):c().vH(t,{...d,type:e.type})}}({environment:t,stores:r}),L.mark("track_create_blocks"),B.convertExternalObjectInstancesToPlaceholders=U!==S;const F=A&&(0,a().Fe)(A.source)&&A.isListedTemplate;if(1===r.length&&"local_duplication"===j&&!F){const e=(0,I().tryLocalDuplicateWithTransaction)({environment:t,store:r[0],options:B,sourceSpaceId:U,targetSpaceId:S,transaction:g,installationImprint:x,templateInstallationMetadata:A,stopwatch:L,from:C});if(e)return L.mark("try_local_duplication_success"),L.end(),{blockStores:[e],onComplete:Promise.resolve({status:"success"})};L.mark("try_local_duplication_failure")}const z=t.defaultRecordCache.inMemoryRecordCache;if(r.some((e=>e.inMemoryRecordCache!==z)))throw new Error("Can only server duplicate from the environment.defaultRecordCache.inMemoryRecordCache.");let V;if(o().A.state.online||l().f1(u().A.formatMessage(_().V.offlineError)),V=1===r.length&&T?(0,M().serverBackedLocalDuplicate)({environment:t,sourceBlock:{id:r[0].id,spaceId:r[0].getSpaceId()},targetInMemoryRecordCache:z,transaction:g,targetSpaceId:S,installationImprint:x,templateInstallationMetadata:A,stopwatch:L,shouldUseSynchronousDuplicationAPI:P,options:B,from:C}):(0,w().serverDuplicate)({environment:t,sourceBlocks:r.map((e=>({id:e.id,spaceId:e.getSpaceId()}))),targetInMemoryRecordCache:z,transaction:g,targetSpaceId:S,installationImprint:x,templateInstallationMetadata:A,stopwatch:L,shouldUseSynchronousDuplicationAPI:P,options:B,from:C,onRedundantDuplicationError:R}),L.mark("duplicate_block_immediate_return"),s().Q.isFail(V))throw D||(0,k().x)({environment:t,duplicateError:V.error}),V.error;const{blockStores:E,onComplete:W}=V.value,O=n().yX();return W.then((e=>{if(L.end(),s().Q.isSuccess(e)){for(const e of E)if("ai_block"===e.getType()){d().EF.setState(e.pointer.id);break}O.resolve({status:"success",recordIdMap:e.value.recordIdMap})}else D||(0,k().x)({environment:t,duplicateError:e.error,blockStores:E}),O.resolve({status:"error",error:e.error,errorMessage:(0,k().eM)(e.error)})})),{blockStores:E,onComplete:O.promise}}},831030:(e,t,r)=>{r.d(t,{_G:()=>G,$k:()=>F,w$:()=>q,H$:()=>O,l9:()=>K,NH:()=>Y,jY:()=>W,JI:()=>N,ck:()=>E,i5:()=>Q,EN:()=>$,gc:()=>z,wK:()=>V});var o=()=>r(906745),a=r(296540),i=()=>r(726637),n=()=>r(401497),s=()=>r(764880),c=()=>r(100594),l=()=>r(901610),d=()=>r(62371),u=()=>r(713998),p=()=>r(534177),g=()=>r(825237),m=()=>r(651124),v=()=>r(792071),h=r(474848);const y=a.memo((function(e){const{size:t,style:r,icon:o,baseUrl:a,getRecordModel:i}=e;return(0,h.jsx)("div",{style:{height:t,width:t,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,verticalAlign:"top",marginTop:1,...r},children:(0,h.jsx)(S,{icon:o,size:t,baseUrl:a,getRecordModel:i})})}));function f(e){return.9*e}function _(e){return.888*e}function S({icon:e,size:t,baseUrl:r,getRecordModel:o}){if(!e)return null;const a=(e,o)=>{const a=g().wY({url:e,baseUrl:r,fullyQualified:!0,permissionRecord:o,width:_(t),userId:void 0});return(0,h.jsx)("img",{alt:"icon",src:a,style:{width:_(t),height:_(t),objectFit:"cover",borderRadius:4,marginTop:1}})},i=(0,m().WO)(e.icon);switch(i.type){case"unicode_emoji":return(0,h.jsx)("div",{style:{fontSize:f(t)},children:i.emoji.unicode});case"custom_emoji":const r=v().xm7.resolveCustomEmojiIcon(e,o);return r?a(r.icon,r.pointer):null;case"app_package_asset":case"notion_icon":case"url":return a(e.icon,e.pointer);default:(0,p().HB)(i)}}var k=()=>r(522419),b=()=>r(216519);const I=function(e){const{botValue:t,avatarSize:r,baseUrl:o,theme:a,style:i}=e;if(null!=t&&t.icon){const n=k().GM(t.icon)?g().x8({url:t.icon,width:e.avatarSize,fullyQualified:!0,stripGoogleIconQuery:!0,baseUrl:o,userId:void 0}):t.icon;return(0,h.jsx)("div",{style:{...(0,b().fo)({theme:a,avatarSize:r}),...i},children:(0,h.jsx)("img",{src:n,style:{display:"block",width:"100%",height:"100%",objectFit:"cover"}})})}if(null!=t&&t.name){const e=t.name[0];return(0,h.jsx)("div",{children:(0,h.jsx)("div",{style:{...(0,b().ws)({theme:a,avatarSize:r}),...i},children:(0,h.jsx)("div",{children:e})})})}return(0,h.jsx)("span",{children:"ðŸ¤–"})};var M=()=>r(658985),w=()=>r(437607);function C(e){const{group:t,getRecordModel:r,size:o=20,baseUrl:a,theme:i,groupIconStyles:n}=e,s={...(0,b().fo)({theme:i,avatarSize:o}),...e.avatarBackground};if(null!=t&&t.icon){const e=(0,m().WO)(t.icon);switch(e.type){case"unicode_emoji":return(0,h.jsx)("div",{style:s,children:(0,h.jsx)("div",{style:{fontSize:.9*o},children:e.emoji.unicode})});case"custom_emoji":const i=(0,w().S4)({spacePermissionGroupId:t.id,spaceId:t.space_id}),c=v().xm7.resolveCustomEmojiIcon({pointer:i,icon:t.icon},r);if(!c)return(0,h.jsx)(B,{groupIconStyles:n});const l=g().wY({url:c.icon,baseUrl:a,fullyQualified:!0,permissionRecord:c.pointer,width:o,userId:void 0});return(0,h.jsx)("div",{style:s,children:(0,h.jsx)("img",{src:l,alt:t.name,style:{display:"block",width:"100%",height:"100%",objectFit:"cover"}})});case"app_package_asset":case"notion_icon":case"url":const d=k().GM(t.icon)?g().x8({url:t.icon,width:o,fullyQualified:!0,stripGoogleIconQuery:!0,baseUrl:a,userId:void 0}):t.icon;return(0,h.jsx)("div",{style:s,children:(0,h.jsx)("img",{src:d,alt:t.name,style:{display:"block",width:"100%",height:"100%",objectFit:"cover"}})});default:(0,p().HB)(e)}}return(0,h.jsx)(B,{groupIconStyles:n})}function B(e){const{groupIconStyles:t}=e;return(0,h.jsx)("div",{style:null==t?void 0:t.iconContainer,children:(0,M().$)(null==t?void 0:t.icon)})}var x=()=>r(597777),T=()=>r(869190),A=()=>r(72135),P=()=>r(379632),D=()=>r(100622),R=()=>r(284371),j=()=>r(934201),L=()=>r(903047),U=()=>r(698449);const F=(0,r(69708).YK)({titlePlaceholder:{defaultMessage:"Untitled",id:"chartLabelFormatHelpers.untitledBlock"}});function z(e,t,r){const o=r?16:20,c=(0,n().IS)((e=>({wrapper:{display:"flex",alignItems:"center",gap:6,minWidth:0},initialStyle:{backgroundColor:e.background.elevated,border:`1px solid ${e.border.primary}`,color:e.text.secondary},avatarStyle:{background:"none"},botStyle:{backgroundColor:e.background.elevated,border:`1px solid ${e.border.primary}`,color:e.text.secondary,fontSize:r?8:10},avatarWrapper:{flexShrink:0},nameWrapper:{minWidth:0,...R().RC}})),[r]),l=(0,L().E)({size:o});return(0,a.useCallback)(((a,n)=>{var d;if(!n)return a.toString();let u,p,g;if(n.actorPointer&&e)if((0,w().I6)(n.actorPointer)){var m;const r=(0,w().S4)({spacePermissionGroupId:n.actorPointer.id,spaceId:n.actorPointer.spaceId});p=e(r),g=(0,U().Pf)({intl:t,groupName:null===(m=p)||void 0===m?void 0:m.name})}else{var y;const r=(0,s().xC)({pointer:n.actorPointer,getRecordModel:e});p=null==r?void 0:r.asActor,g=null===(y=p)||void 0===y?void 0:y.getDisplayName(t)}return g||(g=a||t.formatMessage(v().Fvx.messages.anonymousPlaceholder)),u="space_permission_group"===(null===(d=p)||void 0===d?void 0:d.table)&&e&&p instanceof v().G1c?(0,h.jsx)(C,{group:p,getRecordModel:e,size:o,baseUrl:i().A.domainBaseUrl,theme:(0,D().x0)(),avatarBackground:c.avatarStyle,groupIconStyles:l}):p instanceof v().Fvx&&p.isUser()?(0,h.jsx)(b().Ay,{userValue:p,avatarSize:o,baseUrl:i().A.domainBaseUrl,theme:(0,D().x0)(),fontSize:r?8:10,initialStyle:c.initialStyle,avatarStyle:c.avatarStyle}):p instanceof v().HaY&&p.isBot()?(0,h.jsx)(I,{botValue:p,avatarSize:o,baseUrl:i().A.domainBaseUrl,theme:(0,D().x0)(),style:c.botStyle}):(0,h.jsx)(b().Ay,{userValue:{name:"?"},avatarSize:o,baseUrl:i().A.domainBaseUrl,theme:(0,D().x0)(),fontSize:r?8:10,initialStyle:c.initialStyle,avatarStyle:c.avatarStyle}),P().A.renderToStaticMarkup((0,h.jsxs)("div",{style:c.wrapper,children:[(0,h.jsx)("div",{style:c.avatarWrapper,children:u}),r?(0,h.jsx)("div",{style:c.nameWrapper,children:g}):null]}))}),[e,t,r,c,l,o])}function V(e,t,r){const o=(0,n().IS)((()=>({wrapper:{display:"flex",alignItems:"center",gap:6,minWidth:0},avatarWrapper:{flexShrink:0},titleWrapper:{minWidth:0,...R().RC}})),[]),s=t.formatMessage(F.titlePlaceholder);return(0,a.useCallback)(((a,n)=>{if(!n||!e)return a.toString()||s;let c;if(n.pagePointer&&e&&(c=e(n.pagePointer)),!c)return a.toString()||s;const l=c.getRenderTitleWithPlaceholder({getRecordModel:e,userTimeZone:r,intl:t}),d=c.getRenderIcon({getRecordModel:e});return P().A.renderToStaticMarkup((0,h.jsxs)("div",{style:o.wrapper,children:[d?(0,h.jsx)("div",{style:o.avatarWrapper,children:(0,h.jsx)(y,{getRecordModel:e,icon:d,size:16,baseUrl:i().A.domainBaseUrl})}):void 0,(0,h.jsx)("div",{style:o.titleWrapper,children:l})]}))}),[e,r,t,s,o.wrapper,o.avatarWrapper,o.titleWrapper])}function E(e){var t,r,o,a;const i="count"===(null===(t=e.aggregation)||void 0===t?void 0:t.aggregator)||"unique"===(null===(r=e.aggregation)||void 0===r?void 0:r.aggregator)?"number":N(e.propertySchema);let n;return n="count"===(null===(o=e.aggregation)||void 0===o?void 0:o.aggregator)||"unique"===(null===(a=e.aggregation)||void 0===a?void 0:a.aggregator)?"precision_0":"precision_from_number_property"===e.numberPrecisionOverride?Q(e.propertySchema):e.numberPrecisionOverride,t=>"string"==typeof t?t:n&&"precision_uncapped"!==n?(0,A().ZV)(t,i,e.intl,"compact",n):(0,A().ZV)($(t,2),i,e.intl,"compact",void 0)}function W({groupBy:e,dateFormat:t,intl:r}){return(o,a)=>{let i;return i=a?a.name:"string"==typeof o?o:o.toString(),O({dateString:i,dateFormat:t,groupBy:e,intl:r})}}function O({dateString:e,dateFormat:t,groupBy:r,intl:a}){const i=parseInt(e,10);if(isNaN(i))return e;switch(r){case"relative":default:return e;case"day":return(0,T().ZF)({value:{type:"date",start_date:o().c9.fromMillis(i).toISODate()},date_format:t||x().vz,allowRelativeDates:!0,intl:a});case"week":case"month":case"year":const n=o().c9.fromMillis(i),s={type:r,range:{type:"daterange",start_date:n.toISODate(),end_date:n.plus({[`${r}s`]:1}).minus({days:1}).toISODate()}};return(0,j().nc)({value:s,intl:a})}}function N(e){let t;return("number"===e.type||"formula"===e.type)&&(t=e.number_format),t}function Q(e){return"number"===e.type||"formula"===e.type?e.number_precision:void 0}function Y({chartConfig:e,schema:t,highChartsLabel:r,highChartsValue:o,isMultiSeries:a,intl:i,numberPrecisionOverride:n}){let s=r,d=o;if(!e)return{label:s,value:d};const p=e.dataConfig;let g,m,v,h;if(a){if((0,l().m)(e)&&"groups_reducer"===e.dataConfig.type){var y;const r=e.dataConfig;if(g=null===(y=r.aggregationConfig.stackOptions)||void 0===y?void 0:y.groupBy,g){const e=(0,u()._g)({schema:t,property:g.property});e&&(0,c().zn)(e)&&(m=e)}h=r.aggregationConfig.aggregation,"count"!==h.aggregator&&(v=(0,u()._g)({schema:t,property:h.property}))}}else"groups_reducer"===p.type?(g=p.groupBy,m=(0,u()._g)({schema:t,property:p.groupBy.property}),h=p.aggregationConfig.aggregation,"count"!==h.aggregator&&(v=(0,u()._g)({schema:t,property:h.property}))):v=(0,u()._g)({schema:t,property:p.valueProperty});if(s=m?q({propertySchema:m,groupByFormat:g,aggregation:void 0,highChartsLabel:r,intl:i}):s,d&&"number"==typeof d&&v&&(0,c().JW)(v)){var f,_,S,k;const e="count"===(null===(f=h)||void 0===f?void 0:f.aggregator)||"unique"===(null===(_=h)||void 0===_?void 0:_.aggregator)?"number":N(v),t="count"===(null===(S=h)||void 0===S?void 0:S.aggregator)||"unique"===(null===(k=h)||void 0===k?void 0:k.aggregator)?"precision_0":n??Q(v);d=t&&"precision_uncapped"!==t?(0,A().ZV)(d,e,i,"compact",t):(0,A().ZV)($(d,2),e,i,"compact")}return{label:s,value:d}}function q(e){const{propertySchema:t,groupByFormat:r,aggregation:o,highChartsLabel:a,intl:i}=e;if(t&&(0,c().JW)(t)){const e="count"===(null==o?void 0:o.aggregator)||"unique"===(null==o?void 0:o.aggregator)?"number":N(t),r=parseInt(a,10);return isNaN(r)||"percent"===e?a:(0,A().ZV)(r,e,i,"compact")}const n="formula"===(null==r?void 0:r.type)?r.groupBy:r;return t&&(0,c().i8)(t)&&n&&(0,d().Ik)(n)?O({dateString:a,dateFormat:t.date_format,groupBy:n.groupBy,intl:i}):a}const H=1.2,J=2;function G(e){var t,r,o,a;if("count"===(null===(t=e.aggregation)||void 0===t?void 0:t.aggregator)||"unique"===(null===(r=e.aggregation)||void 0===r?void 0:r.aggregator))return!1;return"percent"===N(e.propertySchema)||(void 0!==e.userYAxisMax&&void 0!==e.userYAxisMin&&Math.abs(e.userYAxisMax-e.userYAxisMin)<J||(!!(null!==(o=e.userYAxisMax)&&void 0!==o&&o.toString().includes(".")||null!==(a=e.userYAxisMin)&&void 0!==a&&a.toString().includes("."))||Math.abs(e.dataYAxisMax)<H&&Math.abs(e.dataYAxisMin)<H))}function K(e){return e%1==0?e:e.toFixed(1)}function $(e,t){const r=Math.pow(10,t);return Math.round(e*r)/r}},977529:(e,t,r)=>{r.d(t,{DI:()=>d,Yv:()=>l,lq:()=>s});var o=()=>r(615234);const a=2*o().TD,i=8*o().TD,n=new Map;function s(e){return n.get(e)}function c(){return n.values().next().value}function l(){const e=Array.from(n.values());for(const t of e)t.clear()}class d{constructor(e){this.id=void 0,this.sourceBlocks=void 0,this.currentTimeout=null,this.stage=void 0,this.showInitialMessage=void 0,this.showUpdatedMessage=void 0,this.onClear=void 0,this.id=(0,r(498212).Ay)(),this.sourceBlocks=e.sourceBlocks,this.stage="started",this.showInitialMessage=e.showInitialMessage,this.showUpdatedMessage=e.showUpdatedMessage,this.onClear=e.onClear,n.set(this.id,this)}isOldestActive(){return c()===this}startSecondTimeout(){this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null),this.currentTimeout=setTimeout((()=>{this.stage="updated_message",this.isOldestActive()&&this.showUpdatedMessage(this.sourceBlocks),this.currentTimeout=null}),i)}start(){this.currentTimeout=setTimeout((()=>{this.stage="initial_message",this.isOldestActive()&&this.showInitialMessage(this.sourceBlocks),this.startSecondTimeout()}),a)}showSnackbarForCurrentStage(){"started"===this.stage||("initial_message"===this.stage?this.showInitialMessage(this.sourceBlocks):"updated_message"===this.stage?this.showUpdatedMessage(this.sourceBlocks):(0,r(534177).HB)(this.stage))}clear(){this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null),n.delete(this.id),this.onClear(),function(){const e=c();e&&e.showSnackbarForCurrentStage()}()}complete(){this.isOldestActive()&&this.stage,this.clear()}}},985284:(e,t,r)=>{r.d(t,{UO:()=>h,MK:()=>y,CU:()=>v});r(296540);var o=()=>r(471995),a=()=>r(69708),i=()=>r(104012),n=r(474848);function s(e){const{item:t,onDismiss:r}=e;o().D6({...t,right:(0,n.jsx)(i().Ag,{onClick:r??o().N2,children:(0,n.jsx)(a().sA,{id:"snackbar.dismiss.title",defaultMessage:"Dismiss"})})})}var c=()=>r(56366),l=()=>r(98126),d=()=>r(534177),u=()=>r(802790);const p=(0,a().YK)({pageDuplicatingMessage:{id:"duplicateProgressSnackbar.pageDuplicating",defaultMessage:"Page is duplicating"},pageStillDuplicatingMessage:{id:"duplicateProgressSnackbar.pageStillDuplicating",defaultMessage:"Page is still duplicating, but this is taking a while. Feel free to leave this page."},contentDuplicatingMessage:{id:"duplicateProgressSnackbar.contentDuplicating",defaultMessage:"Content is duplicating"},contentStillDuplicatingMessage:{id:"duplicateProgressSnackbar.contentStillDuplicating",defaultMessage:"Content is still duplicating, but this is taking a while. Feel free to leave this page."}});function g(e){const{sourceBlocks:t,stage:r}=e,o=(0,c().K8)((()=>!(!t||t.length<1)&&(null==t?void 0:t[0].isType("page"))),[t]);let i;return"initial"===r?i=o?p.pageDuplicatingMessage:p.contentDuplicatingMessage:"update"===r?i=o?p.pageStillDuplicatingMessage:p.contentStillDuplicatingMessage:(0,d().HB)(r),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)(l().A,{size:"sm",onDarkBackground:!0}),(0,n.jsx)("span",{children:(0,n.jsx)(a().sA,{...i})}),(0,n.jsx)("div",{style:{height:24},children:(0,n.jsx)(u().A,{type:"vertical",colorVariant:"inversePrimary",colorPalette:"gray",size:24})})]})}var m=()=>r(977529);function v(e){const{sourceBlocks:t}=e,r=new(m().DI)({sourceBlocks:t,showInitialMessage:f,showUpdatedMessage:_,onClear:S});return r.start(),r.id}function h(e){const t=(0,m().lq)(e);null==t||t.clear()}function y(e){const t=(0,m().lq)(e);null==t||t.complete()}function f(e){s({item:{label:(0,n.jsx)(g,{sourceBlocks:e,stage:"initial"}),durationMs:"keep"},onDismiss:()=>{(0,m().Yv)()}})}function _(e){s({item:{label:(0,n.jsx)(g,{sourceBlocks:e,stage:"update"}),durationMs:"keep"},onDismiss:()=>{(0,m().Yv)()}})}function S(){o().N2()}}}]);