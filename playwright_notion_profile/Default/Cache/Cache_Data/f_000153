"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[48046],{47273:(e,t,n)=>{n.d(t,{DS:()=>o,Fe:()=>d,GB:()=>a,Gf:()=>u,V_:()=>l,j1:()=>c,j8:()=>i,yp:()=>p,yw:()=>s});var r=()=>n(762433);function o(e){return(0,r().Fq)({subscription:e})}function i(e){return(0,r().Ry)({clock:void 0,subscription:e,trial:void 0})}function a({subscriptionState:e,logFunction:t,spaceId:n}){const o=m(e);return(0,r().yB)({billingData:{clock:void 0,subscription:o,trial:void 0},logFunction:t,spaceId:n})}function s(e){return(0,r().q8)({subscription:e})}function c(e){return(0,r().V9)({clock:void 0,subscription:m(e),trial:void 0})}function d(e){return(0,r().d$)({clock:void 0,subscription:m(e),trial:void 0})}function l(e){return(0,r().ji)({clock:void 0,subscription:m(e),trial:void 0})}function u(e){return(0,r().AI)({clock:void 0,subscription:m(e),trial:void 0})}function p(e,t){return(0,r().KH)({clock:void 0,subscription:m(e),trial:void 0},t)}function m(e){return e?{...e,trialEnd:void 0}:void 0}},51473:(e,t,n)=>{n.d(t,{A:()=>o});n(898992),n(672577);class r extends(()=>n(757695))().Store{getInitialState(){return{open:!1}}close(){this.state.open&&this.setState({open:!1})}open({oldTier:e,newTier:t,oldAddOns:r,newAddOns:o}){if(function(e){if(!e)return!1;return["plus","enterprise","business","student"].includes(e)}(t)){if(function(e,t){if(!e||!t)return!1;return"upgrade"===(0,n(979340).qR)({oldTier:e,newTier:t})}(e,t))return this.setState({productUpgrade:t,open:!0}),!0}if(o.length>r.length){const e=o.find((e=>!r.includes(e)));if(function(e){if(!e)return!1;return["ai"].includes(e)}(e))return this.setState({productUpgrade:e,open:!0}),!0}return!1}}const o=new r},323063:(e,t,n)=>{n.d(t,{V5:()=>c,Vr:()=>d,ef:()=>p,gL:()=>l,ng:()=>f,vH:()=>u,vk:()=>g,z2:()=>m});n(16280),n(898992),n(354520),n(672577),n(581454),n(737550);var r=()=>n(720665),o=()=>n(762433),i=()=>n(47273),a=()=>n(622963),s=()=>n(979340);function c(e,t){return(n=e.items,i=t.items,(0,r().Z4)(n,(e=>o().IE(e)),i,(e=>o().IE(e)))).some((([e,t])=>function(e,t){if(!e)return!1;if(!t)return!0;const n=o().xp(e),r=o().xp(t);if(!n||!r)return!1;return s().o3[n]>s().o3[r]}(e,t)));var n,i}function d(e,{trialEnd:t,items:n},r){return{trialEnd:t,items:n.map((t=>{const n=t.price.product,o=t.price.unitAmount.currencyCode,i=g(e,{interval:r,product:n,currency:o});return{...t,price:i}}))}}function l(e,t){const n=e.items.filter((e=>o().IE(e)!==t));return{...e,items:n}}function u(e,t){const n=o().IE(t),r=t.price.product,i=e.items.filter((e=>{const t=e.price.product,i=o().IE(e);return!(n===i)&&!("ai"===t&&("business"===r||"enterprise"===r))}));return{...e,items:i.concat([t])}}function p(e){const{state:t,prices:n,quantities:r,params:{interval:i,currency:a},products:s}=e,c=s.map((e=>function(e){if("personal_free"===e||"team_free"===e)return"free";return e}(e))),d=c.map((e=>o().Mr(e))),l=t.items.filter((e=>{const t=e.price.product,n=o().IE(e),r=d.includes(n),i="ai"===t&&(c.includes("business")||c.includes("enterprise"));return!r&&!i})),u=c.map((e=>f(g(n,{interval:i,currency:a,product:e}),r)));return{...t,items:l.concat(u)}}function m(e){const{prices:t,billingData:n,product:r}=e,a=o().Ry(n),s=o().lQ(n),c=i().yw(s),d=o().q8(n),l=c??d;return t.find((e=>e.product===r&&e.billingInterval===l&&e.unitAmount.currencyCode===a))}function g(e,{interval:t,product:n,currency:r}){return function(e,t){if(null==e)throw new Error(t);return e}(e.find((e=>e.product===n&&e.billingInterval===t&&e.unitAmount.currencyCode===r)),`Unable to find price with interval: ${t}, product: ${n}, currency: ${r}`)}function f(e,t){const{numSeats:n,numCustomHostnames:r,numAiCreditsPacks:o}=t;switch((0,a().vK)(e.product)){case"public_domain_custom_hostnames":return{price:e,quantity:r};case"ai_credits_pack_units":return{price:e,quantity:o};default:return{price:e,quantity:n}}}},348046:(e,t,n)=>{n.r(t),n.d(t,{applyStudentGitHubGrant:()=>_e,closeSubscriptionUpgradeModal:()=>Be,ensureSubscriptionDataIsFetched:()=>we,handlePaymentIntentNextActions:()=>Pe,handlePlanChangeClick:()=>Me,openSubscriptionUpgradeModal:()=>Ce,payUnpaidInvoice:()=>fe,refreshAllBillingData:()=>Se,refreshNonReactiveBillingData:()=>ye,refreshSubscriptionData:()=>xe,refreshUserData:()=>Ie,trackSubscriptionUpdate:()=>me,updateAddress:()=>be,updateBillingEmail:()=>he,updatePaymentMethod:()=>ge,updateSidebarSpace:()=>ke,updateSubscription:()=>ue,updateSubscriptionToEducationPlan:()=>Ae,updateVatId:()=>ve});n(16280),n(296540);var r=()=>n(165358),o=()=>n(206267),i=()=>n(763884),a=()=>n(386164),s=()=>n(762433),c=()=>n(47273),d=()=>n(323063),l=()=>n(166386);var u=()=>n(979340),p=()=>n(69708),m=()=>n(496603),g=()=>n(534177),f=()=>n(252105),b=()=>n(559506),v=()=>n(934839),h=()=>n(901389),y=()=>n(496414),S=()=>n(209660),I=()=>n(662453),x=()=>n(680074),w=()=>n(972435),A=()=>n(965378),k=()=>n(181405),T=()=>n(529803),C=()=>n(765957),B=()=>n(780262),M=()=>n(57605),P=()=>n(814431),D=()=>n(126410),_=()=>n(21735),E=()=>n(824973),U=()=>n(975971),H=()=>n(150193),F=()=>n(977870),N=()=>n(589994),W=()=>n(151059),$=()=>n(404141),L=()=>n(506090),R=()=>n(762299),O=()=>n(271084),V=()=>n(807778),z=()=>n(779795),j=()=>n(72256),q=()=>n(324561),G=()=>n(946473),Y=()=>n(370441),Q=()=>n(134217),K=()=>n(10984),Z=()=>n(995604),J=()=>n(805061),X=()=>n(51473),ee=()=>n(981046),te=()=>n(749240),ne=()=>n(921997),re=()=>n(941541);async function oe(e){const{environment:t,spaceId:n}=e,r=(0,ne().GM)({spaceId:n});if(!se||se!==r){let n;!function(e){ae&&re().Ay.removeListener(ae,e)}(t);const o=({value:t})=>{void 0!==n&&n!==t&&ie(e),n=t},i=m().nF(o,5e3);ae=re().Ay.addListener(r,void 0,i,void 0,t),se=r;const a=T().A.state;if(!Object.keys(a).length)return ie(e)}}async function ie(e){const{environment:t,spaceId:n}=e;if((0,Q().e9)(t,n))return;const r=await b().callApi({eventName:"getBillingSubscriptionBannerData",environment:t,data:{spaceId:n},headers:(0,a().WS)({cellId:void 0,spaceId:n})});var o;"success"===r.type&&((null===(o=C().default.state.sidebarSpaceStore)||void 0===o?void 0:o.id)===n&&T().A.setState(r.data.bannerData));const i=await b().callApi({eventName:"getSubscriptionEntitlements",environment:t,data:{spaceId:n}});var s;"success"===i.type&&((null===(s=C().default.state.sidebarSpaceStore)||void 0===s?void 0:s.id)===n&&B().A.setState(i.data))}let ae,se;var ce=n(474848);const de="SubscriptionData",le=(0,p().YK)({updatingSubscription:{id:"subscriptionSettings.updatingSubscriptionMessage",defaultMessage:"Updating your subscription…"},paymentMethodUpdateAuthFailed:{id:"subscriptionSettings.paymentMethodUpdateAuthFailedMessage",defaultMessage:"We could not update your payment method. Please try again or contact support."},verifyingEligibility:{id:"subscriptionSettings.verifyingEligibilityMessage",defaultMessage:"Verifying eligibility…"},educationPlusFree:{id:"subscriptionSettings.educationPlusFreeMessage",defaultMessage:"You are now subscribed to Notion’s Education plan for free"},finishingUp:{id:"subscription.upgrade.finishing",defaultMessage:"Finishing up..."}});async function ue(e){const{from:t,environment:n,spaceStore:r,billingEmail:o,paymentData:i,vatId:a,coupon:c,customerName:d,businessName:l,addressLine1:p,addressLine2:m,addressZip:g,addressCity:f,addressState:I,addressCountry:x,promoCodeId:w,offerInfo:A,deviceId:k,useTestClock:T,sessionId:C,inAppOffer:B,desiredState:M,trialData:P,partnerRedemptionInfo:D,postUpgradeCallback:_,performImmediately:U}=e;v().Re({bannerStore:H().A}),y().m({message:le.updatingSubscription});const F=r.id,N=await(0,q().Vv)({environment:n,spaceId:F});if(!N)throw new Error("Billing data not loaded");let W;if(M&&0===M.items.length)W=await b().callApi({eventName:"cancelSubscription",environment:n,data:{spaceId:r.id,cancelImmediately:e.performImmediately}});else{const e=U?{prorationBehavior:"always_invoice",billingCycleAnchor:"now"}:void 0;W=await b().callApi({eventName:"updateSubscription",environment:n,data:{spaceId:F,desiredState:M?(0,s().Lm)(M):void 0,billingEmail:o,paymentMethodId:(0,Y().optionalPaymentMethodIdGivenPaymentData)(i),vatId:a,coupon:c,customerName:d,businessName:l,addressLine1:p,addressLine2:m,addressZip:g,addressCity:f,addressState:I,addressCountry:x,promoCodeId:w,useTestClock:T,countryCode:undefined,modalSessionId:C,inAppOffer:B,offerInfo:A,clientVersion:n.device.version,trialData:P,deviceId:k,partnerRedemptionInfo:D,from:t,billingPolicyOverwrites:e}})}if("failed"===W.type)throw y().V(),h().Qg(W),new Error("An error occurred while updating subscription");Se({environment:n,spaceStore:r});const L=await(0,q().Vv)({environment:n,spaceId:F}),R=await E().T.awaitData(n,{userId:n.currentUser.id||""}),O=(0,G().H)(R,r,L);if(!L)throw y().V(),new Error("Billing data not loaded");if(me({environment:n,context:{spaceId:F,planType:r.getPlanType(),from:t,isMmOrEnt:O,trialData:P,modalId:C,offer:null==A?void 0:A.campaign},oldData:N,newData:L,desiredState:M}),y().V(),_)_();else if(Boolean(P)){if((0,s().TB)(N)&&!(0,s().TB)(L)){const e=(0,s().AW)(N);"upgrade"===(0,u().qR)({oldTier:e,newTier:(0,s().AI)(L)})&&pe({oldTier:(0,s().AW)(N),newTier:(0,s().AI)(L),oldAddOns:(0,s().ji)(N),newAddOns:(0,s().ji)(L)})}}else pe({oldTier:(0,s().AI)(N),newTier:(0,s().AI)(L),oldAddOns:(0,s().ji)(N),newAddOns:(0,s().ji)(L)});return $().A.state.open&&"requests"===$().A.state.currentTab&&S().Ow({currentTab:"billing"}),W.data}function pe(e){return!!(0,V().Pe)()&&X().A.open(e)}function me({environment:e,context:t,oldData:n,newData:r,desiredState:o}){var i;const a=(0,s().V9)(n),d=(0,s().AI)(n),l=(0,s().ji)(n),u=(0,s().q8)(n),p=(0,s().Ry)(n),m=n.email,g=(0,c().j1)(o),b=(0,c().Gf)(o),v=(0,c().V_)(o),h=(0,c().yw)(o),y=(0,c().j8)(o),S=Boolean(null==o?void 0:o.trialEnd),I=r.email,w=!(0,s().Fq)(n)&&(0,c().DS)(o),A=(0,s().Fq)(n)&&(0,c().DS)(o),k=(0,s().Fq)(n)&&!(0,c().DS)(o);w&&g?f().BK(e,{plan:g,credit_amount:0}):A?f().pT(e,{billing_email_changed:m!==I,plan_changed:g!==a,plan_current:g,plan_old:a,currency_code:y,billing_address_changed:!1}):k&&a&&f().pp(e,{plan:a}),f().xN(e,{from:t.from,action:k?"cancel":"update",spaceId:t.spaceId,isMmOrEnt:t.isMmOrEnt,planType:t.planType,addressCountry:null===(i=r.address)||void 0===i?void 0:i.country,oldSubscriptionTier:d,newSubscriptionTier:b,oldCurrency:p,newCurrency:y,oldPriceId:a,newPriceId:g,oldAddOns:l,newAddOns:v,oldBillingInterval:u,newBillingInterval:h,creditAmount:0,isProfessionalTeamUser:(0,x().YD)(),isTrial:S,trialEndDate:(0,s().i5)(n),trialData:t.trialData,modalId:t.modalId,offer:t.offer})}async function ge(e){const{environment:t,stripe:n,spaceStore:r,paymentMethodId:o}=e,i=await b().callApi({eventName:"updatePaymentMethod",environment:t,data:{spaceId:r.id,paymentMethodId:o}});if("failed"!==i.type){if(i.data.clientSecret&&"requires_action"===i.data.status){if("succeeded"!==await De({stripe:n,clientSecret:i.data.clientSecret}))return void h().f1(w().A.formatMessage(le.paymentMethodUpdateAuthFailed));const e=await b().callApi({eventName:"setDefaultPaymentMethod",environment:t,data:{spaceId:r.id,paymentMethodId:o}});if("failed"===e.type)return void h().Qg(e)}await Se({environment:t,spaceStore:r})}else h().Qg(i)}async function fe(e){const{environment:t,spaceStore:n,invoiceId:r,paymentMethodId:o}=e,i=await b().callApi({eventName:"payInvoice",environment:t,data:{invoiceId:r,paymentMethodId:o}});"failed"!==i.type?await Se({environment:t,spaceStore:n}):h().Qg(i)}async function be(e){const{environment:t,spaceStore:n,address:r}=e;v().Re({bannerStore:H().A}),y().m({message:le.updatingSubscription});const o=await b().callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,address:r}});if("failed"===o.type)throw y().V(),h().Qg(o),o.error;f().pT(t,{billing_email_changed:!1,plan_changed:!1,billing_address_changed:!0}),await Se({environment:t,spaceStore:n}),y().V()}async function ve(e){const{environment:t,spaceStore:n,vatId:r}=e;v().Re({bannerStore:H().A}),y().m({message:le.updatingSubscription});const o=await b().callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,vatId:r}});if("failed"===o.type)throw y().V(),h().Qg(o),o.error;f().pT(t,{billing_email_changed:!1,plan_changed:!1,billing_address_changed:!1}),await Se({environment:t,spaceStore:n}),y().V()}async function he(e){const{environment:t,spaceStore:n,email:r}=e;v().Re({bannerStore:H().A}),y().m({message:le.updatingSubscription});const o=await b().callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,billingEmail:r}});if("failed"===o.type)throw y().V(),h().Qg(o),o.error;f().pT(t,{billing_email_changed:!0,plan_changed:!1,billing_address_changed:!1}),await Se({environment:t,spaceStore:n}),y().V()}async function ye({environment:e,spaceStore:t}){const n=t.id;ee().A.setState({...ee().A.state,status:"init"}),await Promise.all([z().$W({environment:e,spaceId:n}),xe(e,n),J().c.resetData(e,{spaceId:n}),P().L.resetData(e,{spaceId:n}),R().A.resetData(e,{spaceId:n}),W().A.resetData(e,{spaceId:n,userId:e.currentUser.id})])}async function Se({environment:e,spaceStore:t}){const n=t.id;ee().A.setState({...ee().A.state,status:"init"}),await Promise.all([z().$W({environment:e,spaceId:n}),xe(e,n),J().c.resetData(e,{spaceId:n}),P().L.resetData(e,{spaceId:n}),R().A.resetData(e,{spaceId:n}),W().A.resetData(e,{spaceId:n,userId:e.currentUser.id}),M().T.resetData(e,{spaceId:n}),U().A.resetData(e,{spaceId:n})])}async function Ie({environment:e,spaceStore:t}){const n=t.id;await Promise.all([xe(e,n),W().A.resetData(e,{spaceId:n,userId:e.currentUser.id})])}async function xe(e,t){var n;const o=t??(null===(n=C().default.state.sidebarSpaceStore)||void 0===n?void 0:n.id),s=e.currentUser.id;if(!s)throw new Error("No userId.");if(!o)throw new Error("No spaceId.");const c=`${de}:${o}:v2`,d=i().K.get({userId:s,key:c});d&&(te().subscriptionDataStoreInstance.setState(d),te().subscriptionDataStoreInstance.spaceId=o,O().k.setState(d.userSimilarity)),F().c.setState({wasGetVisibleUsersCalled:!0}),await N().transactionQueue.drain();const[l,u,p]=await Promise.all([b().callApi({eventName:"getSubscriptionData",environment:e,data:{spaceId:o},headers:(0,a().WS)({cellId:void 0,spaceId:o})}),b().callApi({eventName:"getVisibleUsers",environment:e,data:{spaceId:o,supportsEdgeCache:!0,earlyReturnForEdgeCache:!0},headers:(0,a().WS)({spaceId:o})}),b().callApi({eventName:"getSimilarUsers",environment:e,data:{userId:s,spaceId:o,limit:100},headers:(0,a().WS)({spaceId:o})})]);if("success"===l.type&&"success"===u.type){var m;const t={...l.data,...u.data},n="success"===p.type?p.data.userSimilarity:void 0;n&&(t.userSimilarity=n),_().A.setState({shouldUseEdgeCache:u.data.shouldUseEdgeCache});try{i().K.set({userId:s,key:c,value:t})}catch{r().log({level:"error",from:"subscriptionActions",type:"subscriptionDataTooLarge",data:{miscDataToConvertToString:{subscriptionDataJsonSize:JSON.stringify(t).length}}})}(null===(m=C().default.state.sidebarSpaceStore)||void 0===m?void 0:m.id)===o&&(te().subscriptionDataStoreInstance.setState(t),te().subscriptionDataStoreInstance.spaceId=o,O().k.setState(t.userSimilarity),Q().Fq(t)&&f().G3(e))}else r().log({level:"error",from:"subscriptionActions",type:"fetchSubscriptionDataFailed",data:{miscDataToConvertToString:{getSubscriptionDataResponseType:l.type,getSubscriptionDataResponseStatus:l.status,getVisibleUserResponseType:u.type,getVisibleUserResponseStatus:u.status}}});await Promise.all([I().aiDependency.load().then((({completionActions:t})=>t.maybeUpdateAiEligibility(e,o,!0)))])}async function we(e){var t;const{environment:n}=e,r=e.spaceId??(null===(t=C().default.state.sidebarSpaceStore)||void 0===t?void 0:t.id),o=n.currentUser.id;r&&o&&(te().subscriptionDataStoreInstance.state&&te().subscriptionDataStoreInstance.spaceId===r||await xe(n,r))}const Ae=(0,m().sg)((async function(e){const{environment:t,spaceStore:r,code:o}=e;y().m({message:le.verifyingEligibility});const i=te().subscriptionDataStoreInstance.state;if(!i)throw new Error("Subscription data not loaded.");const a=await b().callApi({eventName:"updateSubscriptionToEducationPlan",environment:t,data:{spaceId:r.id,code:o}});"failed"===a.type?h().Qg(a):a.data.isEligible?(await Se({environment:t,spaceStore:r}),Te(i,t)):n(446242).A.setState({open:!0,handlePromoCode:async e=>{y().m({message:le.updatingSubscription});const n=await b().callApi({eventName:"updateSubscriptionToEducationPlan",environment:t,data:{spaceId:r.id,code:e}});"failed"===n.type?h().Qg(n):n.data.isEligible?(await Se({environment:t,spaceStore:r}),Te(i,t)):h().f1((0,ce.jsx)(p().sA,{id:"subscriptionSettings.invalidPromoCodeError.message",defaultMessage:"This promo code is not valid."})),y().V()}}),y().V()}),1e3,{leading:!0,trailing:!1});async function ke(e){const{environment:t,spaceId:n,isNewlyCreatedSpace:r}=e,o=te().subscriptionDataStoreInstance.spaceId;if(!t.currentUser.isLoggedIn()||o&&o===n)await te().subscriptionDataStoreInstance.waitUntilLoaded();else{if(T().A.setState({}),oe({environment:t,spaceId:n}),B().A.setState({}),r){const e={type:"unsubscribed_admin",accountBalance:0,users:[],joinedMemberIds:[],blockUsage:0,hasPaidNonzero:!1,userSimilarity:{},spaceUsers:[],members:[],customerData:void 0,revenueCatEnabled:!1};te().subscriptionDataStoreInstance.setState(e),te().subscriptionDataStoreInstance.spaceId=n,O().k.setState(e.userSimilarity)}xe(t,n)}}async function Te(e,t){const n=()=>{pe({oldTier:e.subscriptionTier??"free",newTier:"student",oldAddOns:[],newAddOns:[]})||h().rG({message:w().A.formatMessage(le.educationPlusFree)}),$().A.setState({...$().A.state,currentTab:"billing",defaultSubtab:void 0});const n=Q().RJ(e);f().tt(t,{plan:"student_free",old_plan:n?n.plan:void 0})};await k().TQ(t)?A().r({onSubmit:n,onCancel:n}):n()}function Ce(e){const{subscriptionTier:t,from:n,addOnFeature:r,isTrial:i,dismissMobilePlansModal:a,postUpgradeCallback:s,offer:c}=e,d=o().JW();L().A.open({from:n,subscriptionTier:t,billingInterval:"month",addOnFeature:r,isTrial:i,sessionId:d,dismissMobilePlansModal:a,postUpgradeCallback:s,offer:c})}function Be(e){const t=L().A.state;t.open&&(f().OC(e,{modal_id:t.sessionId}),L().A.setState({open:!1}))}async function Me(e){var t,n;const{environment:o,product:i,spaceStore:a,from:u,pageSection:p,churnState:f,billingData:b}=e,v=await z().p_({environment:o,spaceId:a.id}),h=b.subscription;if(!(h&&(0,g().O9)(b.paymentMethod)||"free"===i))return void Ce({subscriptionTier:i,from:u});const y=(0,s().lQ)(b),S=(0,s().Ry)(b),I=(0,c().yw)(y),x=(0,c().yw)(h),w=I??x,A=(null===(t=(0,s().KH)(b,"sites_custom_hostnames"))||void 0===t?void 0:t.quantity)??0,k=(null===(n=(0,s().KH)(b,"ai_credits_pack"))||void 0===n?void 0:n.quantity)??0,T=(0,c().GB)({spaceId:a.id,logFunction:r().log.bind(r()),subscriptionState:y}),C=(0,c().GB)({spaceId:a.id,logFunction:r().log.bind(r()),subscriptionState:h}),B=T??C;let M;if("free"===i)M=(0,d().gL)(y,"plan");else{if(!(S&&w&&B))throw new Error("Trying to update plan on a subscription with no items");M=(0,d().ef)({state:y,prices:v,quantities:{numSeats:B,numCustomHostnames:A,numAiCreditsPacks:k},params:{currency:S,interval:w},products:[i]})}if(!m().n4(y,M)){if((0,d().V5)(y,M)){if("no_churn"===f||!f)return;if((0,l().hZ)(D().A.getData(o,{spaceId:null==a?void 0:a.id}))&&(0,l().Jf)("resurrection_offer",K().AI(),x)){if(!(await(0,Z().Z)(o)))return}return await ue({environment:o,spaceStore:a,desiredState:M,from:u,performImmediately:"churn_immediately"===f})}(0,j().o)(o,{desiredProducts:[i],from:u,analyticsArgs:{from:u,pageSection:p}})}}async function Pe(e){y().m({message:le.finishingUp});const{paymentIntentData:t,stripe:n,onSuccess:r,onFailure:o}=e,i=t.paymentIntentClientSecret;let a=t.paymentIntentStatus;i&&"requires_action"===a&&(a=await De({stripe:n,clientSecret:i})),"succeeded"===a||"processing"===a?null==r||r():function({status:e}){return["requires_payment_method","requires_source"].includes(e)}({status:a})&&(null==o||o()),y().V()}async function De({stripe:e,clientSecret:t}){const{paymentIntent:n,setupIntent:r,error:o}=await e.handleNextAction({clientSecret:t});if(n)return n.status;if(r)return r.status;if(o.payment_intent)return o.payment_intent.status;if(o.setup_intent)return o.setup_intent.status;throw new Error(`Unexpected error handling intent: ${o.message}`)}async function _e(e){const{environment:t,data:n}=e;await b().callApi({eventName:"applyStudentGitHubGrant",environment:t,data:n})}},370441:(e,t,n)=>{n.r(t),n.d(t,{getLegacyStripeAppearance:()=>y,getStripe:()=>f,optionalPaymentMethodIdGivenPaymentData:()=>I,stripeElementLocaleGivenNotionLocale:()=>b,translateStripeError:()=>h,useElementsOptions:()=>v});var r=()=>n(37458),o=n(296540),i=()=>n(726637),a=()=>n(56366),s=()=>n(401497),c=()=>n(402390),d=()=>n(807487),l=()=>n(100622),u=()=>n(534177),p=()=>n(284371),m=()=>n(765957);let g=null;async function f(){return g||(r().loadStripe.setLoadParameters({advancedFraudSignals:!1}),g=(0,r().loadStripe)(i().A.stripe.key)),g}function b(e){switch(e){case"en-US":return"en";case"ko-KR":return"ko";case"ja-JP":return"ja";case"fr-FR":return"fr-FR";case"de-DE":return"de";case"es-ES":return"es-ES";case"es-LA":return"es-419";case"pt-BR":return"pt-BR";case"zh-CN":return"zh";case"zh-TW":return"zh-TW";case"da-DK":return"da";case"nl-NL":return"nl";case"fi-FI":return"fi";case"nb-NO":return"nb";case"sv-SE":return"sv";default:return"auto"}}function v(e){const t=(0,s().eP)(),n=(0,l().O4)({theme:t,useCssVars:!1}),{type:r}=e,i="setup"===r||"subscription"===r?e.currency:void 0,g="subscription"===r?e.amount:void 0,f=(0,a().K8)((()=>{var e;return(null===(e=m().default.state)||void 0===e||null===(e=e.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.preferred_locale)||c().q}),[]);return(0,o.useMemo)((()=>{const e=function(e){const t=S(e.text.primary),n=S(e.text.secondary),r=S(e.text.tertiary),o=S(e.red.text.accentPrimary),i=S(e.blue.text.accentPrimary),a=S(e.icon.inversePrimary),s=S(e.whiteButtonBackground);return{labels:"above",theme:"dark"===e.mode?"night":"stripe",variables:{spacingGridRow:"12px",spacingGridColumn:"12px",spacingUnit:"4px",spacingTab:"6px",colorPrimary:t,colorPrimaryText:t,colorText:t,colorTextSecondary:n,colorTextPlaceholder:r,colorIcon:t,colorIconCheckmark:a,colorDanger:o,colorBackground:s,colorIconTabHover:t,colorIconTabSelected:i,colorIconChevronDown:t,fontFamily:p().Tf.sans,fontWeightLight:`${p().Wy.light}`,fontWeightNormal:`${p().Wy.regular}`,fontWeightMedium:`${p().Wy.medium}`,fontWeightBold:`${p().Wy.medium}`,fontSizeBase:"14px",fontSizeSm:"12px",colorLogo:e.mode,colorLogoBlock:e.mode,colorLogoTab:e.mode,colorLogoTabSelected:e.mode,borderRadius:"6px"},rules:{".Tab":{padding:"10px 16px 10px 10px",fontSize:"13px",fontWeight:"500",lineHeight:"16px",color:t,border:`1px solid ${e.border.primary}`,boxShadow:"none",backgroundColor:e.whiteButtonBackground},".Tab:hover":{backgroundColor:e.whiteButtonHoveredBackground},".Tab:focus":{boxShadow:e.buttonBlueFocusRing},".Tab--selected, .Tab--selected:active":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.blue.border.accentPrimary}`,color:t,boxShadow:"none",outline:"none"},".Tab--selected:hover":{backgroundColor:e.whiteButtonBackground,color:t},".Tab--selected:focus":{border:`1px solid ${e.blue.border.accentPrimary}`,boxShadow:e.buttonBlueFocusRing},".Input":{fontSize:"14px",lineHeight:"18px",padding:"7px 8px",backgroundColor:e.background.secondary,boxShadow:`0 0 0 1px ${e.border.primary}`,border:"none",color:t},".Input--invalid":{color:t,boxShadow:e.inputRedFocusRing},".Input:focus":{color:t,boxShadow:e.inputBlueFocusRing},".Label":{fontSize:"12px",lineHeight:"15px",fontWeight:"500",color:n,marginBottom:"8px"},".Error":{fontSize:"12px",fontWeight:"400",lineHeight:"15px",color:o},".CodeInput":{backgroundColor:e.background.secondary,border:`1px solid ${e.border.primary}`,boxShadow:"none"},".PickerItem, .PickerItem--selected":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.border.primary}`,boxShadow:"none",color:t},".PickerItem:hover":{backgroundColor:e.whiteButtonHoveredBackground,color:t,border:`1px solid ${e.border.primary}`,boxShadow:"none"},".PickerItem--selected:hover":{boxShadow:"none"},".PickerItem--new":{fontSize:"14px",fontWeight:"500",lineHeight:"18px",color:t},".PickerItem--highlight, .PickerItem--highlight:hover":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.blue.border.accentPrimary}`,boxShadow:"none"},".PickerItem--highlight:hover":{backgroundColor:e.whiteButtonHoveredBackground},".TermsText":{color:n,fontSize:"10px",fontWeight:"400",lineHeight:"13px",letterSpacing:"0.12px"},".CheckboxLabel":{color:t,fontSize:"12px",fontWeight:"500",lineHeight:"15px"},".Action, .MenuAction":{color:t,fontWeight:"400",padding:"4px 8px"},".Action:hover, .MenuAction:hover":{backgroundColor:e.buttonHoveredBackground},".BlockAction:focus, .CodeInput:focus, .Input:focus,.CheckboxInput:focus, .PickerItem:focus, .PickerAction:focus,.MenuAction:focus, .Action:focus, .SecondaryLink:focus":{boxShadow:e.buttonBlueFocusRing},".MenuIcon, .MenuIcon:hover":{fill:t},".Block":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.border.primary}`,boxShadow:"none",padding:"16px"},".Icon":{fill:t}}}}(n),t={appearance:e,locale:b(f)},o={paymentMethodTypes:(0,d().VV)({currency:i})};switch(r){case"address":return t;case"setup":return{...t,...o,currency:null==i?void 0:i.toLowerCase(),mode:"setup",paymentMethodCreation:"manual"};case"subscription":return{...t,...o,amount:g,currency:null==i?void 0:i.toLowerCase(),mode:"subscription",paymentMethodCreation:"manual",setupFutureUsage:"off_session",loader:"never"};default:(0,u().HB)(r)}}),[n,f,i,r,g])}function h(e,t){if(!t.code)return t.message||"";switch(t.code){case"invalid_expiry_year_past":return e.formatMessage({id:"stripeHelpers.invalidExpiryYear.error.message",defaultMessage:"Your card's expiration year is in the past."});case"invalid_cvc":return e.formatMessage({id:"stripeHelpers.invalidCVC.error.message",defaultMessage:"Your card's security code is invalid."});case"invalid_number":return e.formatMessage({id:"stripeHelpers.invalidNumber.error.message",defaultMessage:"Your card number is not a valid credit card number."});case"card_declined":return function(e,t){switch(t){case"expired_card":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.expiredCard",defaultMessage:"Your card was declined because it is an expired card."});case"incorrect_number":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.incorrectNumber",defaultMessage:"Your card was declined because you input an incorrect number."});case"insufficient_funds":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.declinedFunds",defaultMessage:"Your card was declined because of insufficient funds."});case"invalid_cvc":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.invalidCvc",defaultMessage:"Your card was declined because you input an invalid CVC number"});case"invalid_amount":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.invalidAmount",defaultMessage:"Your card was declined because payment amount exceeds the amount that's allowed."});default:return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message",defaultMessage:"Your card was declined."})}}(e,t.decline_code);default:return t.message||""}}function y(e){return{labels:"floating",theme:"dark"===e.mode?"night":"stripe",variables:{spacingGridRow:"8px",spacingGridColumn:"8px",spacingUnit:"4px",spacingTab:"4px",colorPrimary:e.text.primary,colorPrimaryText:e.text.primary,colorText:e.text.primary,colorTextSecondary:e.text.secondary,colorTextPlaceholder:e.text.tertiary,colorIcon:e.text.primary,colorIconCheckmark:e.icon.inversePrimary,colorDanger:e.red.text.accentPrimary,colorBackground:e.whiteButtonBackground,colorIconTabHover:e.text.primary,colorIconTabSelected:e.blue.text.accentPrimary,colorIconChevronDown:e.text.primary,fontFamily:p().Tf.sans,fontWeightLight:`${p().Wy.light}`,fontWeightNormal:`${p().Wy.regular}`,fontWeightMedium:`${p().Wy.medium}`,fontWeightBold:`${p().Wy.semibold}`,fontSizeBase:"14px",fontSizeSm:"12px",colorLogo:e.mode,colorLogoBlock:e.mode,colorLogoTab:e.mode,colorLogoTabSelected:e.mode,borderRadius:"6px"},rules:{".Tab":{padding:"10px 16px 10px 10px",fontSize:"13px",fontWeight:"510",lineHeight:"16px",color:e.text.primary,border:`1px solid ${e.border.primary}`,boxShadow:"none",backgroundColor:e.whiteButtonBackground},".Tab:hover":{backgroundColor:e.whiteButtonHoveredBackground,color:e.text.primary},".Tab:focus":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.border.primary}`,boxShadow:e.buttonBlueFocusRing},".Tab--selected, .Tab--selected:hover, .Tab--selected:active":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.blue.border.accentPrimary}`,color:e.text.primary,boxShadow:"none",outline:"none"},".Tab--selected:focus":{border:`1px solid ${e.blue.border.accentPrimary}`,boxShadow:e.buttonBlueFocusRing},".Input":{fontSize:"14px",lineHeight:"18px",padding:"4px 8px",boxShadow:"none",backgroundColor:e.background.secondary,border:`1px solid ${e.border.primary}`,color:e.text.primary},".Input--invalid":{border:"none",color:e.text.primary,boxShadow:e.inputRedFocusRing},".Label":{fontSize:"14px",lineHeight:"18px",color:e.text.tertiary},".Label--floating":{fontSize:"10px",fontWeight:"510",lineHeight:"13px",letterSpacing:"0.12px",marginTop:"4px",transition:"all 200ms ease",color:e.text.secondary},".Error":{fontSize:"12px",fontWeight:"400",lineHeight:"15px",color:e.red.text.accentPrimary},".CodeInput":{backgroundColor:e.background.secondary,border:`1px solid ${e.border.primary}`,boxShadow:"none"},".PickerItem, .PickerItem--selected":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.border.primary}`,boxShadow:"none",color:e.text.primary},".PickerItem:hover, .PickerItem--selected:hover":{backgroundColor:e.whiteButtonHoveredBackground,color:e.text.primary,border:`1px solid ${e.border.primary}`,boxShadow:"none"},".PickerItem--new":{fontSize:"14px",fontWeight:"500",lineHeight:"18px",color:e.text.primary},".PickerItem--highlight, .PickerItem--highlight:hover":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.blue.border.accentPrimary}`,boxShadow:"none"},".PickerItem--highlight:hover":{backgroundColor:e.whiteButtonHoveredBackground},".TermsText":{color:e.text.secondary,fontSize:"12px",fontWeight:"400",lineHeight:"15px"},".CheckboxLabel":{color:e.text.primary,fontSize:"12px",fontWeight:"500",lineHeight:"15px"},".Action, .MenuAction":{color:e.text.primary,fontWeight:"400"},".Action:hover, .MenuAction:hover":{backgroundColor:e.buttonHoveredBackground},".BlockAction:focus, .CodeInput:focus, .Input:focus,.CheckboxInput:focus, .PickerItem:focus, .PickerAction:focus,.MenuAction:focus, .Action:focus, .SecondaryLink:focus":{boxShadow:e.buttonBlueFocusRing},".MenuIcon, .MenuIcon:hover":{fill:e.text.primary},".Block":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.border.primary}`,boxShadow:"none",color:e.text.primary}}}}function S(e){const[t,n,r,o]=e.match(/[\d.]+/g)??[];return t&&n&&r&&o&&1===parseInt(o)?`rgb(${t}, ${n}, ${r})`:e}function I(e){return"paymentMethodId"===(null==e?void 0:e.type)?e.value:void 0}},446242:(e,t,n)=>{n.d(t,{A:()=>o});class r extends(()=>n(757695))().Store{getInitialState(){return{open:!1}}}const o=new r},503416:(e,t,n)=>{n.d(t,{r:()=>r});const r=(0,n(340498).xh)("arrowInCircleDown",{default:{loader:()=>n.e(96029).then(n.bind(n,973238))},small:{loader:()=>n.e(96029).then(n.bind(n,747012))},fill:{loader:()=>n.e(96029).then(n.bind(n,561604))},fillSmall:{loader:()=>n.e(96029).then(n.bind(n,613131))}},["arrow","circle","down","direction","pointer","downgrade"])},506090:(e,t,n)=>{n.d(t,{A:()=>o});class r extends(()=>n(757695))().Store{getInitialState(){return{open:!1}}closeWithSuccess(){this.setState({open:!1,succeeded:!0})}closeWithFailure(){this.setState({open:!1,succeeded:!1})}open(e){const{subscriptionTier:t,addOnFeature:n,billingInterval:r,coupon:o,isTrial:i,sessionId:a,dismissMobilePlansModal:s,postUpgradeCallback:c,from:d,offer:l}=e;this.setState({open:!0,temporaryBillingInterval:r,temporaryAddress:{name:"",businessName:"",addressLine1:"",addressLine2:"",zipCode:"",city:"",state:"",country:""},appliedPromo:void 0,error:void 0,subscriptionTier:t,vatApplicable:!1,calculatingTax:!1,payButtonState:"enabled",type:"current_space",addOnFeature:n,onlyShowAddOn:void 0!==n,sessionId:a,coupon:o,isTrial:i,dismissMobilePlansModal:s,postUpgradeCallback:c,from:d,offer:l})}setAddressField(e){this.state.open&&this.setState({...this.state,temporaryAddress:{...this.state.temporaryAddress,...e},taxCalculationError:void 0})}}const o=new r},762299:(e,t,n)=>{n.d(t,{A:()=>o});const r=new(n(848776).U)(((e,{spaceId:t})=>`${e.currentUser.id}:${t}`),(async(e,{spaceId:t})=>{const r=await Promise.resolve().then(n.bind(n,559506)),o=await r.callApi({eventName:"getInvoiceData",environment:e,data:{spaceId:t,type:"upcoming"}});return"success"===o.type?o.data.invoiceData:void 0}));n(852832).exposeDebugValue("UpcomingInvoiceStore",r);const o=r},805061:(e,t,n)=>{n.d(t,{c:()=>r});const r=new(n(848776).U)(((e,{spaceId:t})=>`${e.currentUser.id}:${t}`),(async(e,{spaceId:t})=>{const r=await Promise.resolve().then(n.bind(n,559506)),o=await r.callApi({eventName:"getLegacyPriceInfo",environment:e,data:{spaceId:t},headers:(0,n(386164).WS)({cellId:void 0,spaceId:t})});if("success"===o.type)return o.data}))},814431:(e,t,n)=>{n.d(t,{L:()=>r});const r=new(n(848776).U)(((e,{spaceId:t})=>`${e.currentUser.id}:${t}`),(async(e,{spaceId:t})=>{var r;const o=await Promise.resolve().then(n.bind(n,559506)),i=await o.callApi({eventName:"getBillingHistory",environment:e,data:{spaceId:t,limit:20}});return"success"===i.type?null===(r=i.data)||void 0===r?void 0:r.events:void 0}));n(852832).exposeDebugValue("BillingHistoryStore",r)},995604:(e,t,n)=>{n.d(t,{Z:()=>b});n(296540);var r=()=>n(564884),o=()=>n(559506),i=()=>n(82275),a=()=>n(49210),s=()=>n(765957),c=()=>n(503416),d=()=>n(69708),l=()=>n(347063),u=()=>n(719147),p=()=>n(232930),m=n(474848);function g({onAccept:e}){return(0,m.jsx)(l().tf,{header:(0,m.jsx)(l().YA,{iconAndTitle:(0,m.jsx)(l().ZQ,{iconGroup:c().r,iconColorPalette:"red",iconColorVariant:"accentPrimary",title:(0,m.jsx)(d().sA,{id:"voidOfferModal.title",defaultMessage:"Are you sure?"})}),description:(0,m.jsx)(d().sA,{id:"voidOfferModal.subtitle",defaultMessage:"If you continue, your current discount will no longer be applied. See <terms>terms and conditions</terms> for more information.",values:{terms:e=>(0,m.jsx)(u().A,{external:!0,href:(0,p().x)("resurrectionLearnMore"),children:e})}})}),footer:(0,m.jsx)(l().aO,{layout:"vertical",primaryButtons:[{buttonType:"destructive",label:(0,m.jsx)(d().sA,{id:"voidOfferModal.primaryAction",defaultMessage:"Yes and remove discount"}),onClick:e}],secondaryButtons:[{buttonType:"dismiss",label:(0,m.jsx)(d().sA,{id:"voidOfferModal.cancelButton",defaultMessage:"Cancel"})}]})})}const f=406;async function b(e){var t;const n=null===(t=s().default.state.sidebarSpaceStore)||void 0===t?void 0:t.id;return await a().T.showAsyncModal((t=>(0,m.jsx)(i().s,{isOpen:t.isOpen,onDismiss:()=>{(0,r().u)({environment:e,event:{eventName:"void_offer_modal_dismiss",eventProperties:{}}}),t.onDismiss()},onClosed:t.onClosed,areaConstraint:{width:{type:"min",length:f},height:{type:"unlimited",scroll:"allow"}},render:()=>(0,m.jsx)(g,{onAccept:async()=>{(0,r().u)({environment:e,event:{eventName:"void_offer_modal_accept",eventProperties:{}}}),n&&await o().callApi({eventName:"voidCustomerOffer",environment:e,data:{spaceId:n}}),t.resolve("accepted")}})})))}}}]);