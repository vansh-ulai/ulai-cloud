"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[2411,4876,73801],{112589:(e,t,a)=>{a.d(t,{eM:()=>g,go:()=>m,sB:()=>p,x:()=>f});a(16280);var o=()=>a(416845),n=()=>a(378409),r=()=>a(100622),i=()=>a(466614),s=()=>a(812182),c=()=>a(100853),l=()=>a(745864),d=()=>a(972435),u=()=>a(261450);class p extends Error{constructor(e){super(e),this.name="DuplicationCancelledError"}}class m extends Error{constructor(e){super(e),this.name="DuplicationMultipleSpacesError"}}function f(e){const{duplicateError:t,environment:a,blockStores:o}=e;if(t instanceof p)return;const c=g(t);i().Rk(t)?o&&o.length>1?i().UK(a,{product:t.clientData.metadata.product}):i().yj({product:t.clientData.metadata.product}):function(e){e=e??d().A.getIntl().formatMessage(u().V.unknownErrorDescription);const t="duplicationError";s().HK({id:t,title:d().A.getIntl().formatMessage(u().V.errorTitle),message:e,presentationType:"persistent",icon:()=>(0,n().xMarkCircleIcon)({color:r().Tj.red}),actions:{primary:{title:d().A.getIntl().formatMessage(u().V.dismissButtonMessage),onAction:()=>s().UW(t)}},variant:"error"})}(c)}function g(e){const t=d().A.getIntl();if((0,o().op)(e)){const a=(0,c().D)(t,e);if(a)return a}return(0,o().pA)(e)?(0,l().A)(t,e):e instanceof m?t.formatMessage(u().V.multipleSpacesErrorDescription):t.formatMessage(u().V.unknownErrorDescription)}},129852:(e,t,a)=>{a.r(t),a.d(t,{exclamationMarkCircleIcon:()=>r,iconDefinition:()=>n});a(296540);var o=a(474848);const n={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.26 15.25",svg:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("path",{d:"M9.875 6.25c.345 0 .625.28.625.625v3.5a.625.625 0 1 1-1.25 0v-3.5c0-.345.28-.625.625-.625m0 7.375a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5"}),(0,o.jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M10 3.625a6.375 6.375 0 1 0 0 12.75 6.375 6.375 0 0 0 0-12.75"})]})},r=(0,a(340498).wt)("exclamationMarkCircle",n)},204441:(e,t,a)=>{a.d(t,{G:()=>l,Y:()=>d});var o=()=>a(564884),n=()=>a(416845),r=()=>a(129852),i=()=>a(100622),s=()=>a(812182),c=()=>a(972435);function l(e){const{onRetry:t,onDismiss:a,environment:n}=e,l="redundant_duplication_request_error",d=(0,i().O4)({theme:"dark"}),u=c().A.getIntl();s().Iz({id:l,title:u.formatMessage({defaultMessage:"You are already duplicating this item",id:"duplicationActions.redundantDuplicationError"}),message:u.formatMessage({defaultMessage:"Would you like to duplicate it again?",id:"duplicateActions.redundantDuplicationError.duplicateAgain"}),presentationType:"persistent",actions:{primary:{title:u.formatMessage({defaultMessage:"Proceed",id:"duplicateActions.redundantDuplicationError.proceed"}),onAction:()=>{(0,o().u)({environment:n,event:{eventName:"redundant_duplication_user_action",eventProperties:{action:"retry"}}}),t(),s().UW(l)}},secondary:{title:u.formatMessage({defaultMessage:"Dismiss",id:"duplicateActions.redundantDuplicationError.dismiss"}),onAction:()=>{(0,o().u)({environment:n,event:{eventName:"redundant_duplication_user_action",eventProperties:{action:"dismiss"}}}),null==a||a(),s().UW(l)}}},icon:()=>(0,r().exclamationMarkCircleIcon)({color:d.icon.inversePrimary}),onUserDismiss:()=>{(0,o().u)({environment:n,event:{eventName:"redundant_duplication_user_action",eventProperties:{action:"dismiss"}}}),null==a||a()}})}function d(e){return(0,n().pA)(e)&&"redundant_duplication_request"===e.clientData.type}},378409:(e,t,a)=>{a.r(t),a.d(t,{iconDefinition:()=>n,xMarkCircleIcon:()=>r});a(296540);var o=a(474848);const n={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.26 15.25",svg:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("path",{d:"M12.817 7.183a.625.625 0 0 1 0 .884L10.884 10l1.933 1.933a.625.625 0 1 1-.884.884L10 10.884l-1.933 1.933a.625.625 0 1 1-.884-.884L9.116 10 7.183 8.067a.625.625 0 1 1 .884-.884L10 9.116l1.933-1.933a.625.625 0 0 1 .884 0"}),(0,o.jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M10 3.625a6.375 6.375 0 1 0 0 12.75 6.375 6.375 0 0 0 0-12.75"})]})},r=(0,a(340498).wt)("xMarkCircle",n)},443002:(e,t,a)=>{a.d(t,{H:()=>s});a(898992),a(672577);var o=()=>a(84520),n=()=>a(294712),r=()=>a(190910),i=()=>a(614620);function s({spaceStore:e,userId:t,environment:a}){const s=new(i().d)(a,{table:n().GD,id:t}).getSpaceViewPointers().find((t=>t.spaceId===e.id));return s?r().v.createChildStore(e,{id:s.id,table:o().mu,spaceId:e.id}):void 0}},450486:(e,t,a)=>{a.r(t),a.d(t,{moveToTeamImpl:()=>c});var o=()=>a(496603),n=()=>a(534177),r=()=>a(44729),i=()=>a(955930),s=()=>a(375078);function c(e){const{environment:t,transaction:a,teamStore:c,spaceViewStore:l,location:d,blocksToMove:u}=e,p=l.getTeamsStores(),m=c.getTeamPagesStore();s().maybeTurnCollectionViewIntoCollectionViewPage({environment:t,blocks:u,transaction:a});for(const s of u){const e=o().I6(p,(e=>{const t=e.getTeamPagesStore().getValue();if(t)return t.includes(s.id)}));(null==e?void 0:e.id)!==c.id&&("append"===d.type?r().NI({parentStore:m,childStore:s,after:d.after,transaction:a}):"prepend"===d.type?r().Ti({parentStore:m,childStore:s,before:d.before,transaction:a}):(0,n().HB)(d),e&&i().Ex({teamStore:e,store:s,transaction:a}))}return c}},503388:(e,t,a)=>{a.d(t,{U8:()=>d,Yj:()=>u,d8:()=>m,dH:()=>p,uC:()=>f});a(16280),a(898992),a(354520),a(581454);var o=()=>a(700500),n=()=>a(179034),r=()=>a(534177),i=()=>a(559506),s=()=>a(899193),c=()=>a(723039),l=()=>a(384944);function d(e){const{environment:t,sourceBlocks:a,targetRecordCache:n,transaction:i,spaceId:s}=e,c=a.map(((e,a)=>l().Wv({environment:t,type:o().xd.copyIndicator,inMemoryRecordCache:n,transaction:i,spaceId:s})));if(c.length!==a.length)throw new Error("copyIndicators must be same length as source blocks");if(!(0,r().EI)(c))throw new Error("copyIndicators must cannot be empty");return c}function u(e){for(const t of e)s().n_(t.id)}function p(e){for(const t of e)s().L7(t.id)}function m(e){const{copyIndicatorIds:t,state:a}=e;for(const o of t)s().DW({state:a,targetRecordId:o})}function f(e){const{environment:t,copyIndicators:a}=e;i().callApi({eventName:"deleteContentRecords",environment:t,data:{records:a.filter((e=>e.useCrdt())).map((e=>e.getSpaceShardedPointer())),permanentlyDelete:!1}}),c().L({environment:t,stores:a.filter((e=>!e.useCrdt())),table:n().ev,from:"server_duplication_copy_indicators"})}},677733:(e,t,a)=>{a.r(t),a.d(t,{duplicateBlockWithQueueTask:()=>w,performServerDuplicate:()=>T,serverDuplicate:()=>C,shouldUseDuplicateAndTranslateTemplateBlock:()=>D,shouldUseDuplicateTemplateBlock:()=>A});a(16280),a(944114),a(581454);var o=()=>a(242422),n=()=>a(165358),r=()=>a(416504),i=()=>a(388821),s=()=>a(496603),c=()=>a(763824),l=()=>a(973647),d=()=>a(435345),u=()=>a(583835);const p=(0,u().Dv)("duplicateAndTranslateTemplateBlock"),m=(0,u().Dv)("duplicateTemplateBlock");var f=()=>a(466614),g=()=>a(559506),v=()=>a(357625),y=()=>a(972435),I=()=>a(811349),_=()=>a(261450),S=()=>a(503388),h=()=>a(966152),k=()=>a(112589),M=()=>a(204441);function C(e){const{environment:t,sourceBlocks:a,targetInMemoryRecordCache:o,transaction:n,options:r,targetSpaceId:i,stopwatch:s}=e,d=performance.now();null==s||s.mark("server_duplicate_start");const u=e.copyIndicators??(0,S().U8)({environment:t,sourceBlocks:a,targetRecordCache:o,transaction:n,spaceId:i});null==s||s.mark("create_copy_indicators");const p=c().yX();return n.postSubmitCallbacks.push((async a=>{if(null==s||s.mark("transaction_post_submit_callback"),a)return(0,h().P0)({environment:t,type:"server_duplicate_transaction_post_submit_callback_error",data:{copyIndicatorIds:u.map((e=>e.id)),error:a,targetSpaceId:i,options:r}}),void p.resolve(l().Q.fail(a));(0,S().Yj)(u),null==s||s.mark("initialize_copy_indicators_progress_state");const o=n.getUserActionForAnalyticsPurposesOnly();await b({serverDuplicateArgs:e,copyIndicators:u,userAction:o,deferred:p,isRetry:!1,startTime:d,onRedundantDuplicationError:e.onRedundantDuplicationError})})),l().Q.success({blockStores:u,onComplete:p.promise})}async function b(e){const{serverDuplicateArgs:t,copyIndicators:a,userAction:o,deferred:n,isRetry:r,startTime:s,onRedundantDuplicationError:c}=e,{environment:d,sourceBlocks:u,options:p,targetSpaceId:m,installationImprint:f,templateInstallationMetadata:g={},shouldUseSynchronousDuplicationAPI:v,stopwatch:y,from:I}=t,C=await T({environment:d,copyIndicators:a,sourceBlocks:u,targetSpaceId:m,options:p,templateInstallationMetadata:g,installationImprint:f,shouldUseSynchronousDuplicationAPI:v,stopwatch:y,userAction:o});if(null==y||y.mark("perform_server_duplicate_finished"),(0,h().JW)({environment:d,type:"server_duplicate_duplicate_block_iterator_success",data:{result:C,targetSpaceId:m,options:p}}),(0,S().dH)(a),l().Q.isFail(C))return(0,M().Y)(C.error)&&!r?((0,M().G)({onRetry:()=>{b({serverDuplicateArgs:{...t,options:{...t.options,allowRedundancy:!0}},copyIndicators:a,userAction:o,deferred:n,isRetry:!0,startTime:s,onRedundantDuplicationError:c})},onDismiss:()=>{(0,h().JW)({environment:d,type:"server_duplicate_redundant_duplication_error_dismissed",data:{copyIndicatorIds:a.map((e=>e.id))}}),(0,S().uC)({environment:d,copyIndicators:a}),n.resolve(l().Q.fail(new(k().sB)))},environment:d}),void(null==c||c())):((0,S().uC)({environment:d,copyIndicators:a}),(0,h().P0)({environment:d,type:"server_duplicate_iterator_error",data:{error:C.error}}),void n.resolve(C));r||(0,_().E)({environment:d,success:!0,time:performance.now()-s,user_action:o,is_duplication_local:!1,duplication_size:C.value.size,method:"server_duplication",from:I}),null==y||y.mark("server_duplicate_success"),n.resolve(l().Q.success({recordIdMap:C.value.recordIdMapJson?i().RecordMapPolymorphic.create(C.value.recordIdMapJson):void 0}))}async function T(e){const{environment:t,copyIndicators:a,sourceBlocks:o,targetSpaceId:n,options:i,templateInstallationMetadata:c,installationImprint:u,shouldUseSynchronousDuplicationAPI:f,stopwatch:v,userAction:y}=e,I=o[0].spaceId||n,_=o.map((e=>({...e,spaceId:e.spaceId||I}))),S=a.map((e=>({id:e.id,spaceId:e.getSpaceId()}))),h=!!i.resolveTemplateVariables&&{currentUserId:t.currentUser.id,currentTimeZone:(0,r().P)()},k={sourceBlocks:_,targetBlocks:S,addCopyName:i.addCopyName,deepCopyTransclusionContainers:i.deepCopyTransclusionContainers,convertExternalObjectInstancesToPlaceholders:i.convertExternalObjectInstancesToPlaceholders,duplicateOnlyCollectionSchema:i.duplicateOnlyCollectionSchema,isTemplateInstantiation:Boolean(c.source),resolveTemplateVariables:h,allowRedundancy:i.allowRedundancy,installationImprint:u,returnRecordIdMapJson:i.returnRecordIdMap},M=A(c.source),C=D(i.shouldTranslate,i.sourceLanguage,i.targetLanguage);let b;if(M){const e={...k,source:c.source,context:c.context,isEmailShared:c.isEmailShared,isFromDuplicateParam:c.isFromDuplicateParam,shouldTranslate:i.shouldTranslate,sourceLanguage:i.sourceLanguage,targetLanguage:i.targetLanguage};f?(b=await async function(e){const{environment:t,request:a,stopwatch:o}=e,n=await g().callApi({eventName:"duplicateTemplateBlockSynchronously",environment:t,data:a});if(null==o||o.mark("duplicate_template_synchronous_finished"),"failed"===n.type)return l().Q.fail(n.error);return l().Q.success({recordIdMapJson:n.data.recordIdMapJson,size:n.data.totalBlocks})}({environment:t,request:e}),null==v||v.mark("duplicate_template_synchronously_finished")):(b=await w({environment:t,eventName:m,request:e,spaceIds:[],copyIndicators:a,targetSpaceId:n,userAction:y}),null==v||v.mark("duplicate_template_finished"))}else C?(b=await w({environment:t,eventName:p,request:{...k,sourceLanguage:i.sourceLanguage,targetLanguage:i.targetLanguage},spaceIds:[],copyIndicators:a,targetSpaceId:n,userAction:y}),null==v||v.mark("duplicate_and_translate_template_finished")):f?(b=await async function(e){const{environment:t,request:a}=e,o=await g().callApi({eventName:"duplicateBlockSynchronously",environment:t,data:a});if("failed"===o.type)return l().Q.fail(o.error);return l().Q.success({recordIdMapJson:o.data.recordIdMapJson,size:o.data.size})}({environment:t,request:k}),null==v||v.mark("duplicate_block_synchronously_finished")):(b=await w({environment:t,eventName:d().w,request:k,spaceIds:(0,s().hS)([..._,...S],"spaceId").map((e=>e.spaceId)),copyIndicators:a,targetSpaceId:n,userAction:y}),null==v||v.mark("duplicate_block_finished"));return b}async function w(e){var t,a;const{environment:o,eventName:r,request:i,spaceIds:s,copyIndicators:c,targetSpaceId:d,userAction:u}=e,p=v().UT(o,r,i,{spaceIds:s});let m;try{for await(const e of p)(0,h().JW)({environment:o,type:"server_duplicate_duplicate_block_iterator",data:{response:e,targetSpaceId:d}}),(0,S().d8)({state:e,copyIndicatorIds:c.map((e=>e.id))}),f().$2(o,e),m=e}catch(g){}if(!m){const e=y().A.formatMessage(_().V.errorTitle);return l().Q.fail(new Error(e))}return m.error?(0,I().l)(m.error)&&(n().log({level:"warning",from:"serverDuplicate",type:"crossSpaceDuplication",data:{errorMessage:m.error.message,spaceIds:s,userAction:u}}),s.length>0)?w({environment:o,eventName:r,request:i,spaceIds:[],copyIndicators:c,targetSpaceId:d,userAction:u}):l().Q.fail(m.error):l().Q.success({recordIdMapJson:null===(t=m)||void 0===t?void 0:t.value.recordIdMapJson,size:(null===(a=m)||void 0===a?void 0:a.value.totalBlocks)??0})}function A(e){if(!e)return!1;const t=o().default.getConfigKey("enabled_installation_sources_for_duplicate_template_block",e);return Boolean(t)}function D(e,t,a){return Boolean(e&&t&&a)&&o().default.checkGate({gateName:"translate_template_top_bar"})}},723039:(e,t,a)=>{a.d(t,{E:()=>h,L:()=>S});a(581454);var o=()=>a(314529),n=()=>a(416845),r=()=>a(179034),i=()=>a(519831),s=()=>a(743246),c=()=>a(534177),l=()=>a(675925),d=()=>a(972435),u=()=>a(718807),p=()=>a(765957),m=()=>a(666429),f=()=>a(559506),g=()=>a(901389),v=()=>a(961606),y=()=>a(471995),I=()=>a(664713);const _=(0,a(69708).YK)({deletePageConfirmationMessage:{id:"trashActions.deletePagePermanentlyDialog.prompt",defaultMessage:"Are you sure you want to delete this page from Trash?"},deleteDataSourceConfirmationMessage:{id:"trashActions.deleteDataSourcePermanentlyDialog.prompt",defaultMessage:"Are you sure you want to delete this data source from Trash?"},deletePageConfirmationButton:{id:"trashActions.deletePagePermanentlyDialog.confirmDeleteButton.label",defaultMessage:"Delete page"},deleteDataSourceConfirmationButton:{id:"trashActions.deleteDataSourcePermanentlyDialog.confirmDeleteButton.label",defaultMessage:"Delete data source"},permanentlyDeleteFailedToast:{id:"trashActions.deletePagePermanentlyDialog.actionFailed.toast",defaultMessage:"Failed to delete, please try again later."},permanentlyDeletePermissionsFailure:{id:"trashActions.deleteContentPermanentlyDialog.actionFailed.permissions",defaultMessage:"You do not have sufficient permissions to delete this {contentLabel} from Trash."},deleteWorkflowConfirmationMessage:{id:"trashActions.deleteWorkflowConfirmationMessage",defaultMessage:"Are you sure? This agent will be permanently deleted and can no longer be restored."},deleteWorkflowConfirmationButton:{id:"trashActions.deleteWorkflowConfirmationButton",defaultMessage:"Yes, delete this agent"}});async function S(e){const{stores:t,environment:a,from:n}=e,{sidebarSpaceStore:r}=p().default.state,i=e.environment.currentUser.id;if(r&&i){await f().callApi({eventName:"deleteContentRecords",environment:e.environment,data:{records:t.map((e=>e.getSpaceShardedPointer())),permanentlyDelete:!0}}).then((e=>{if("failed"===e.type)throw k(e.body),e.error})),(0,o().DO_NOT_USE_trackLegacy)(a,"delete_trash_page",{from:n});for(const e of t)u().Ay.state.excludeRecords.add(e.id),u().Ay.emit();await I().Z({environment:a,spaceId:r.id,userId:i}),(0,v().V)({environment:e.environment,blocks:t})}}function h(e){const{environment:t,stores:a,table:n,handleSuccess:v,from:I}=e;let h,M,C;switch((0,o().DO_NOT_USE_trackLegacy)(t,"open_delete_trash_page_modal"),n){case r().ev:h=d().A.formatMessage(_.deletePageConfirmationMessage),M=d().A.formatMessage(_.deletePageConfirmationButton),C=async()=>{await(0,l().o)(t,{action:"delete_page_permanently",from:I,block_type:a[0].getType()},(async t=>{await S(e),null==v||v(a),t()}))};break;case i().Vl:h=d().A.formatMessage(_.deleteDataSourceConfirmationMessage),M=d().A.formatMessage(_.deleteDataSourceConfirmationButton),C=async()=>{var n;await(0,l().o)(t,{action:"delete_data_source_permanently",from:I,block_type:null===(n=a[0].getParentBlockStore())||void 0===n?void 0:n.getType()},(async t=>{await async function(e){const{environment:t,stores:a,from:n}=e;await f().callApi({eventName:"deleteContentRecords",environment:t,data:{records:a.map((e=>e.getSpaceShardedPointer())),permanentlyDelete:!0}}).then((e=>{if("failed"===e.type)throw k(e.body),e.error})),(0,o().DO_NOT_USE_trackLegacy)(t,"delete_trash_data_source",{from:n})}(e),null==v||v(a),t()}))};break;case s().C0:h=d().A.formatMessage(_.deleteWorkflowConfirmationMessage),M=d().A.formatMessage(_.deleteWorkflowConfirmationButton),C=async()=>{await(0,l().o)(t,{action:"delete_workflow_permanently",from:I,block_type:void 0},(async t=>{await async function(e){const{stores:t,environment:a}=e,{sidebarSpaceStore:n}=p().default.state;if(!n)return;const r=t.map((e=>e.getSpaceShardedPointer())),i=await f().callApi({environment:a,eventName:"deleteContentRecords",data:{records:r,permanentlyDelete:!0}});if("failed"===i.type)throw k(i.body),i.error;(0,o().DO_NOT_USE_trackLegacy)(a,"delete_trash_page");for(const o of t)u().Ay.state.excludeRecords.add(o.id),u().Ay.emit();return void y().D6({label:d().A.formatMessage(_.deleteWorkflowConfirmationMessage),durationMs:m().LX})}(e),null==v||v(a),t()}))};break;default:(0,c().HB)(n)}g().ui({message:h,showCancel:!0,keepFocus:!1,items:[{label:M,color:"red",onAccept:C}],handleCancel:()=>{(0,o().DO_NOT_USE_trackLegacy)(t,"cancel_delete_trash_page")}})}function k(e){let t=_.permanentlyDeleteFailedToast;(0,n().iD)(e,n().qQ)&&(t=_.permanentlyDeletePermissionsFailure),y().D6({label:d().A.formatMessage(t),durationMs:m().LX})}},745864:(e,t,a)=>{a.d(t,{A:()=>i});var o=()=>a(416845),n=()=>a(658512),r=()=>a(423039);function i(e,t){if((0,o().pA)(t)){const a=(0,r().$)(t.clientData);if(a)return"messageValues"in t.clientData?e.formatMessage(a,t.clientData.messageValues):e.formatMessage(a)}return e.formatMessage(n().k.generic_error)}},811349:(e,t,a)=>{a.d(t,{l:()=>n});var o=()=>a(416845);function n(e){return(0,o().pA)(e)&&"cross_space_duplication"===e.clientData.type}},930456:(e,t,a)=>{a.d(t,{J:()=>d});var o=()=>a(496603),n=()=>a(534177),r=()=>a(722101),i=()=>a(44729),s=()=>a(185544),c=()=>a(450486),l=()=>a(842677);function d(e){const{environment:t,sourceStore:a,transaction:d,destination:u,targetStores:p,appendWithoutAfter:m,targetSpaceViewStore:f}=e;let g={type:"append",after:m?void 0:a.id};const v=o().o8(p).reverse();if("team"===u.type){const e=l().RecordStores.createUniqueRootStore(t,u.parent);(0,c().moveToTeamImpl)({environment:t,transaction:d,spaceViewStore:f,teamStore:e,blocksToMove:p,location:g})}else if("block"===u.type){const e=l().RecordStores.createUniqueRootStore(t,u.parent);for(const t of v)i().NI({parentStore:e,childStore:t,transaction:d,after:g.after})}else if("space"===u.type){const e=l().RecordStores.createUniqueRootStore(t,u.parent);u.prepend&&(g={type:"prepend"});for(const a of v)s().yM({environment:t,spaceStore:e,spaceViewStore:f,pageStore:a,isPrivate:!0,location:g,transaction:d})}else if("collection"===u.type){const e=l().RecordStores.createUniqueRootStore(t,u.parent);for(const t of v)i().X$({childStore:t,parentStore:e,transaction:d}),u.addToTemplates&&r().BC({parentStore:e.getTemplatePagesStore(),appendStore:t,transaction:d})}else if("automation_action"===u.type){const e=l().RecordStores.createUniqueRootStore(t,u.parent);for(const t of v)i().NI({parentStore:e,childStore:t,transaction:d})}else(0,n().HB)(u)}},949653:(e,t,a)=>{a.r(t),a.d(t,{localDuplicate:()=>E,tryLocalDuplicateTo:()=>U,tryLocalDuplicateWithTransaction:()=>L});a(16280),a(944114),a(517642),a(658004),a(733853),a(845876),a(432475),a(515024),a(731698),a(581454);var o=()=>a(929219),n=()=>a(110192),r=()=>a(165358),i=()=>a(416845),s=()=>a(199378),c=()=>a(179034),l=()=>a(96689),d=()=>a(229833),u=()=>a(466614),p=()=>a(679156),m=()=>a(901389),f=()=>a(863168),g=()=>a(319975),v=()=>a(231297),y=()=>a(594794),I=()=>a(611191),_=()=>a(972435),S=()=>a(443002),h=()=>a(765957),k=()=>a(148832),M=()=>a(842677),C=()=>a(261450),b=()=>a(537012);function T(e){const{environment:t,recordMap:a,inMemoryRecordCache:o}=e,n=function(e){const t=e.getModelsByTable(s().SC),a=[];for(const o of t){const e=(0,b().Mn)({type:o.getType(),config:o.getConfig(),space_id:o.getSpaceId()});e&&a.push(...e.map((e=>e.pointer)))}return a}(a);for(const r of n)if(!o.hasRecord({pointer:r,userId:t.currentUser.id}))return!1;return!0}var w=()=>a(966152),A=()=>a(112589),D=()=>a(930456),B=()=>a(824438),R=()=>a(59110),P=()=>a(677733);function E(e){try{return x(e)}catch(t){throw r().log({level:"error",from:"localDuplicate",type:"local_duplicate_error",error:(0,d().convertErrorToLog)(t),data:{sourceBlockId:e.sourceBlockId}}),e.skipUserFacingMessages||A().x({environment:e.environment,duplicateError:new(i().Bk)}),t}}function x(e){var t,a,i;const{environment:s,sourceBlockId:l,targetBlockPointer:d,sourceBlockSubtree:u,targetInMemoryRecordCache:f,options:v,transaction:y,installationImprint:I,templateInstallationMetadata:S,stopwatch:M,from:b}=e,T=performance.now();null==M||M.mark("local_duplicate_start");const A=d.spaceId,D=null===(t=u.getModel({id:l,table:c().ev}))||void 0===t?void 0:t.spaceId,R=[],E=A??(null===(a=h().default.state.sidebarSpaceStore)||void 0===a?void 0:a.id)??(null===(i=h().default.state.mainEditorCurrentBlockStore)||void 0===i?void 0:i.getSpaceId()),x=E?s.idCreator.getSpaceIdCreatorSync(E):void 0,{targetBlockStore:L,originalToDuplicate:U,subtreeSize:N}=(0,B().j)({environment:s,sourceBlockId:l,targetBlockPointer:d,sourceBlockSubtree:u,targetRecordCache:f,transaction:y,deepCopyTransclusionContainers:Boolean(v.deepCopyTransclusionContainers),resolveTemplateVariables:Boolean(v.resolveTemplateVariables),preventLegacyTransclusions:v.preventLegacyTransclusions,createLegacyTransclusionCopyIndicator:{onCreate(e){R.push(e)}},installationImprint:I,templateInstallationMetadata:S,isTemplateInstantiation:v.isTemplateInstantiation,spaceIdCreator:x,appendContentOnly:v.appendContentOnly});return null==M||M.mark("local_duplicate_initialize_template_success"),(0,w().JW)({environment:s,type:"local_duplicate_initialize_template_success",data:{message:"Successful initialize template",targetSpaceId:A,sourceSpaceId:D,targetBlockStore:L,subtreeSize:N}}),A!==D&&r().log({level:"info",from:"localDuplicate",type:"local_duplicate_across_spaces",data:{sourceSpaceId:D,targetSpaceId:A,sourceBlockId:l,subTreeSize:u.getSize()}}),v.addCopyName&&L&&L.isNavigableBlock()&&(!function(e){const{environment:t,transaction:a,targetBlockStore:o}=e,r=o.getTitleStore();if(!r)return;const i=r.getValue(),s=(0,n().g)(i);g().R9({environment:t,store:r,value:s,transaction:a}),(0,w().JW)({environment:t,type:"local_duplicate_text_set_value",data:{value:s,titleStoreId:r.id,targetBlockId:o.id}})}({environment:s,transaction:y,targetBlockStore:L}),null==M||M.mark("local_duplicate_add_copy_name")),R.length&&(!function(e){const{environment:t,transaction:a,targetBlockStore:n,targetRecordCache:r,sourceSpaceId:i,legacyTransclusionCopyIndicators:s,options:l,templateInstallationMetadata:d,from:u}=e,f=!o().A.state.online;f&&m().f1(_().A.formatMessage(C().V.offlineError));for(const o of s){(0,w().JW)({environment:t,type:"local_duplicate_legacy_transclusion_copy_indicators",data:{message:"Iterating legacyTransclusionCopyIndicators",info:o}});const e=n.getSpaceId(),s=k().B.createChildStore(n,{table:c().ev,id:o.duplicateBlockId});(0,P().serverDuplicate)({environment:t,targetSpaceId:e,targetInMemoryRecordCache:r,transaction:a,sourceBlocks:[{id:o.sourceBlockId,spaceId:i}],copyIndicators:[s],options:{...l,addCopyName:!1,convertExternalObjectInstancesToPlaceholders:l.convertExternalObjectInstancesToPlaceholders??!1},templateInstallationMetadata:d,from:u})}p().hi(t,{offline:f,num_blocks_duplicated:s.length,user_action:a.getUserActionForAnalyticsPurposesOnly()})}({environment:s,transaction:y,targetBlockStore:L,targetRecordCache:f,sourceSpaceId:D,legacyTransclusionCopyIndicators:R,options:v,templateInstallationMetadata:S,from:b}),null==M||M.mark("local_duplicate_legacy_transclusion_fix")),(0,C().E)({environment:s,success:!0,time:performance.now()-T,user_action:y.getUserActionForAnalyticsPurposesOnly(),is_duplication_local:!0,duplication_size:N,method:"local_duplication",from:b}),null==M||M.mark("local_duplicate_success"),{targetBlockStore:L,originalToDuplicate:U}}function L(e){const{environment:t,store:a,sourceSpaceId:o,targetSpaceId:n,transaction:r,options:i,installationImprint:s,templateInstallationMetadata:l,stopwatch:d,from:u}=e,p=(0,I().$J)(),m=(0,R().loadLocalSubtree)({environment:t,blockId:a.id,inMemoryRecordCache:a.inMemoryRecordCache,options:{allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!i.deepCopyTransclusionContainers,allowCopyExternalObjectInstances:!i.convertExternalObjectInstancesToPlaceholders,includeLegacyTransclusionBlockValues:p}}).recordMap;if(!m||!N({environment:t,localSubtree:m,sourceSpaceId:o,targetSpaceId:n}))return;null==d||d.mark("load_local_subtree");const{targetBlockStore:g}=x({environment:t,sourceBlockId:a.id,targetBlockPointer:(0,y().zP)({environment:t,table:c().ev,spaceId:n}),sourceBlockSubtree:m,targetInMemoryRecordCache:a.inMemoryRecordCache,options:{...i,preventLegacyTransclusions:p},transaction:r,installationImprint:s,templateInstallationMetadata:l,stopwatch:d,from:u});return"ai_block"===g.getType()&&f().EF.setState(g.pointer.id),g}async function U(e){var t;const{environment:a,sourceStores:o,destination:n,options:r,installationImprint:i,templateInstallationMetadata:s,from:d,appendWithoutAfter:u,listener:p}=e,m=n.parent.spaceId,g=o[0].getSpaceId();if(!m||!g)return;if(1!==new Set(o.map((e=>e.getSpaceId()))).size)throw new Error("All source stores must be in the same space");const _=null===(t=h().default.state.currentUserRootStore)||void 0===t?void 0:t.id;if(!_)return;const k=M().RecordStores.createUniqueRootStore(a,{table:l().NX,id:m}),C=(0,S().H)({spaceStore:k,userId:_,environment:a});if(!C||!k)return;const b=(0,I().$J)(),T=new Map;for(const c of o){const e=(0,R().loadLocalSubtree)({environment:a,blockId:c.id,inMemoryRecordCache:c.inMemoryRecordCache,options:{allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!r.deepCopyTransclusionContainers,allowCopyExternalObjectInstances:!r.convertExternalObjectInstancesToPlaceholders,includeLegacyTransclusionBlockValues:b}}).recordMap;if(!e||!N({environment:a,localSubtree:e,sourceSpaceId:g,targetSpaceId:m}))return;T.set(c.id,e)}await p({type:"started"});const w=v().createAndCommit({environment:a,userAction:"duplicateBlockActions.duplicateTo",isTemplateInstantiationTransaction:Boolean(s),canUndo:!0,perform:e=>{const t=[];for(const l of o){const o=T.get(l.id);if(!o)continue;const{targetBlockStore:p}=x({environment:a,sourceBlockId:l.id,targetBlockPointer:(0,y().zP)({environment:a,table:c().ev,spaceId:m}),sourceBlockSubtree:o,targetInMemoryRecordCache:l.inMemoryRecordCache,options:{...r,preventLegacyTransclusions:b},transaction:e,installationImprint:i,templateInstallationMetadata:s,from:d});(0,D().J)({environment:a,sourceStore:l,transaction:e,destination:n,targetStores:[p],targetSpaceViewStore:C,appendWithoutAfter:u}),"ai_block"===p.getType()&&f().EF.setState(p.pointer.id),t.push(p)}return t}}).performResult;return w[0].isNavigableBlock()&&await p({type:"page_navigable",navigableBlockStore:w[0]}),await p({type:"completed",createdBlocks:w,recordIdMap:void 0}),w}function N(e){const{environment:t,localSubtree:a,sourceSpaceId:o,targetSpaceId:n}=e;return!u().Lw({sourceSpaceId:o,targetSpaceId:n,sourceBlockSubtree:a})&&!(Array.from(a.getTables()).includes(s().SC)&&!T({environment:t,recordMap:a,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache}))}}}]);