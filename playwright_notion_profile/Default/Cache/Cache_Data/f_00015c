"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[59042,65197],{112665:(e,t,a)=>{a.r(t),a.d(t,{badgeCheckIcon:()=>i,iconDefinition:()=>n});a(296540);var s=a(474848);const n={viewBox:"0 0 20 20",fittedViewBox:"1.57 1.57 16.86 16.86",svg:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("path",{d:"M12.806 8.074a.625.625 0 1 0-1.072-.643l-2.512 4.185-1.407-1.642a.625.625 0 1 0-.95.814l1.973 2.3a.625.625 0 0 0 1.01-.085z"}),(0,s.jsx)("path",{d:"M10.405 1.724a.625.625 0 0 0-.81 0L7.36 3.628l-2.926.233a.625.625 0 0 0-.573.574L3.628 7.36 1.724 9.595a.624.624 0 0 0 0 .81l1.904 2.234.233 2.926a.625.625 0 0 0 .574.573l2.926.234 2.234 1.904a.624.624 0 0 0 .81 0l2.234-1.904 2.926-.234a.625.625 0 0 0 .573-.573l.234-2.926 1.904-2.234a.624.624 0 0 0 0-.81L16.372 7.36l-.234-2.926a.625.625 0 0 0-.573-.573l-2.926-.234zM8.017 4.711 10 3.02l1.983 1.69c.1.085.224.136.355.147l2.597.207.207 2.597c.01.13.062.255.147.355L16.98 10l-1.69 1.983a.63.63 0 0 0-.147.355l-.207 2.597-2.597.207a.63.63 0 0 0-.355.147L10 16.98l-1.983-1.69a.63.63 0 0 0-.355-.147l-2.597-.207-.207-2.597a.63.63 0 0 0-.147-.355L3.02 10l1.69-1.983a.63.63 0 0 0 .147-.355l.207-2.597 2.597-.207a.63.63 0 0 0 .355-.147"})]})},i=(0,a(340498).wt)("badgeCheck",n)},196131:(e,t,a)=>{a.d(t,{C7:()=>i,CH:()=>r,JD:()=>n});a(898992),a(672577);var s=()=>a(842599);function n(e,t){return!!e&&i(e.getEmail(),t)}function i(e,t){return void 0!==r(e,t)}function r(e,t){if(!e)return;const a=(0,s().zN)(e);return t.find((e=>e.url===a))}},309049:(e,t,a)=>{a.d(t,{A:()=>n});class s extends(()=>a(757695))().Store{getInitialState(){return{count:0}}}const n=new s},366858:(e,t,a)=>{a.d(t,{A:()=>r});a(581454);var s=()=>a(484714),n=()=>a(56366),i=()=>a(592674);function r(e){const t=(0,s().v3)();return(0,n().K8)((()=>{var a;const s=null==e?void 0:e.id;if(s)return null===(a=i().A.getData(t,{spaceId:s}))||void 0===a?void 0:a.map((e=>e.domain))}),[t,e])}},529601:(e,t,a)=>{a.d(t,{$S:()=>c,Im:()=>d,SJ:()=>_,bb:()=>u,sf:()=>v,yQ:()=>p});a(898992),a(354520),a(581454),a(737550);var s=()=>a(496603),n=()=>a(534177),i=()=>a(842599),r=()=>a(176581),o=()=>a(196131);function u(e){return"member"!==(null==e?void 0:e.currentRole)&&"restricted_member"!==(null==e?void 0:e.currentRole)}function c({space:e,domains:t,team:a,spaceUser:i,invitees:r,internalGuestFeatureAvailability:o,guestFeatureAvailability:u,publicPageDataGuestSetting:c}){const l=d({domains:t,internalGuestFeatureAvailability:o,guestFeatureAvailability:u,invitees:r,space:e,spaceUser:i,team:a,publicPageDataGuestSetting:c}),p=m({domains:t,internalGuestFeatureAvailability:o,guestFeatureAvailability:u,invitees:r,space:e,spaceUser:i,team:a,publicPageDataGuestSetting:c}),_=function({team:e,invitees:t}){const a=null==e?void 0:e.getDisableRestrictedMembers();return(0,s().Cr)(t.map((e=>a?[e.email,{type:"cannot_add",reason:"restricted_members_disabled_by_admins"}]:[e.email,{type:"can_add"}])))}({invitees:r,team:a}),v=r.some((e=>{const t=p[e.email],a=l[e.email];return"can_autojoin"!==t.type&&g(a)}));return(0,s().Cr)(r.map((e=>{const{email:t,currentRole:a}=e,s=p[t],i=_[t],r=l[t];if("member"===a)return[t,{type:"member_page_add"}];if("guest"===a&&"can_add"===r.type)return[t,{type:"guest_page_add"}];if("restricted_member"===a)return"can_add"===i.type?[t,{type:"member_page_add"}]:[t,{type:"none",reason:i.reason}];if("can_autojoin"===s.type)return[t,{type:"member",reason:"autojoin_domain"}];if("cannot_add"===(o=l[t]).type&&"over_general_guest_limit"===o.reason)return[t,{type:"none",reason:"must_upgrade"}];if("can_add"===s.type&&v)return[t,{type:"member",reason:"over_internal_guest_limit"}];if("can_add"===r.type)return[t,{type:"guest"}];if("can_request"===r.type)return[t,{type:"guest_request"}];if("can_add"===s.type)return[t,{type:"member",reason:"guests_disabled"}];if("can_request"===s.type)return[t,{type:"member_request"}];if("cannot_add"===s.type&&"not_authorized_domain"===s.reason)return[t,{type:"none",reason:"not_authorized_domain"}];if("cannot_add"===r.type){return[t,{type:"none",reason:r.reason}]}if("cannot_add"===s.type){return[t,{type:"none",reason:s.reason}]}return(0,n().HB)(s)&&(0,n().HB)(r);var o})))}function d({space:e,domains:t,team:a,internalGuestFeatureAvailability:n,guestFeatureAvailability:i,optimism:r="pessimistic",spaceUser:u,invitees:c,publicPageDataGuestSetting:d}){const m=p({space:e,team:a,spaceUser:u,publicPageDataGuestSetting:d}),_=l(r,i,v(c)),g=function(e,t){return e.filter((e=>(0,o().C7)(e.email,t)&&!e.currentRole)).length}(c,t),b=l(r,n,g);return(0,s().Cr)(c.map((e=>{const a=(0,o().C7)(e.email,t),s=void 0!==e.currentRole;let n;return n=s||_?!a||s||b?"cannot_add"===m.type?{type:"cannot_add",reason:"disabled_by_admins"}:m:{type:"cannot_add",reason:"over_internal_guest_limit"}:{type:"cannot_add",reason:"over_general_guest_limit"},[e.email,n]})))}function l(e,t,a){const s=t.limit,n="unlimited"===s.total?"unlimited":s.total-s.current;return"optimistic"===e?"unlimited"===n||n>=1:"unlimited"===n||n>=a}function m({space:e,team:t,domains:a,spaceUser:r,invitees:o,internalGuestFeatureAvailability:u,guestFeatureAvailability:c,publicPageDataGuestSetting:l}){const m=_({space:e,domains:a,spaceUser:r}),p=d({space:e,domains:a,internalGuestFeatureAvailability:u,guestFeatureAvailability:c,team:t,spaceUser:r,invitees:o,publicPageDataGuestSetting:l}),v=!r.isMember();return(0,s().Cr)(o.map((e=>{const t=(0,i().zN)(e.email);if(!t)return[e.email,{type:"cannot_add",reason:"invalid_email"}];const a=g(p[e.email]),s=m.autojoinDomains;let r;return s.includes(t)?r={type:"can_autojoin"}:"can_add"===m.type?r={type:"can_add"}:"can_request"===m.type||a&&!v?r={type:"can_request"}:s.length>0?r={type:"cannot_add",reason:"not_authorized_domain"}:"cannot_add"===m.type?r={type:"cannot_add",reason:"disabled_by_admins"}:(0,n().HB)(m),[e.email,r]})))}function p({space:e,team:t,spaceUser:a,publicPageDataGuestSetting:s}){const i=a.isWorkspaceOwner(),o=(0,n().O9)(s)?s:(0,r().v)({space:e,team:t});return i&&"can_request"===o.type?{type:"can_add"}:o}function _({space:e,domains:t,spaceUser:a}){const s=!a.isMember(),n=function({space:e,domains:t}){const a=t.filter((e=>e.isAutojoinable)).map((e=>e.url));return e.getSettings().disable_membership_requests?{type:"cannot_add",autojoinDomains:a}:{type:"can_request",autojoinDomains:a}}({space:e,domains:t});return s?{type:"cannot_add",autojoinDomains:[]}:a.isWorkspaceOwner()?{...n,type:"can_add"}:n}function v(e){return e.filter((e=>!e.currentRole)).length}function g(e){return"cannot_add"===e.type&&"over_internal_guest_limit"===e.reason}},586880:(e,t,a)=>{a.d(t,{o:()=>d});var s=()=>a(242422),n=()=>a(484714),i=()=>a(56366),r=()=>a(519831),o=()=>a(743246),u=()=>a(792415);const c=new(a(848776).U)(((e,t)=>{if("block-space"===t.type)return`${t.type}-${t.blockId}-${t.spaceId}`;(0,a(534177).HB)(t.type)}),(async(e,t)=>{const s=await Promise.resolve().then(a.bind(a,559506)),n=(0,a(386164).WS)({spaceId:t.spaceId,recordId:t.blockId,verifyShortSpaceIdVersion:!0}),i=await s.callApi({eventName:"getPublicPageData",environment:e,data:t,headers:n});return"success"===i.type?i.data:void 0}));function d(e){const{store:t}=e,a=(0,n().v3)();return(0,i().K8)((()=>{if(!s().default.checkGate({gateName:"ui_guest_disable_changes"}))return;if(t.table===r().Vl||t.table===o().C0)return{type:"cannot_add"};const e=t.id,n=t.getSpaceId(),i=u().A.state.publicPageData;var d;if((null==i?void 0:i.pageId)===e)return(null==i||null===(d=i.securitySettings)||void 0===d?void 0:d.guestSetting)??{type:"can_add"};{var l;const t=c.getData(a,{type:"block-space",blockId:e,spaceId:n});return(null==t||null===(l=t.securitySettings)||void 0===l?void 0:l.guestSetting)??{type:"can_add"}}}),[t,a])}},592674:(e,t,a)=>{a.d(t,{A:()=>n});const s=new(a(848776).U)(((e,{spaceId:t})=>`${e.currentUser.id}:${t}`),(async(e,{spaceId:t},s=!1)=>{var n;const i=await Promise.resolve().then(a.bind(a,559506)),r=await i.callApi({eventName:"getInternalDomains",environment:e,data:{spaceId:t}});return"success"===r.type?null===(n=r.data)||void 0===n?void 0:n.internalDomainsWithInfo:void 0}));a(852832).exposeDebugValue("InternalDomainsStore",s);const n=s},616092:(e,t,a)=>{a.d(t,{H:()=>l,m:()=>d});var s=()=>a(484714),n=()=>a(56366),i=()=>a(529601),r=()=>a(366858),o=()=>a(586880),u=()=>a(151059),c=()=>a(329304);function d({space:e,team:t,spaceUser:a,invitees:s,store:u}){const d=(0,n().K8)((()=>null==a?void 0:a.getUserId()),[a]),l=(0,c()._X)({name:"internal_guests",spaceId:null==e?void 0:e.id,userId:d,amount:0}),v=(0,c()._X)({name:"guests",spaceId:null==e?void 0:e.id,userId:d,amount:0}),g=(0,o().o)({store:u}),b=m(e),y=p(a),f=_(y,t),q=(0,r().A)(e);return(0,n().K8)((()=>{if(b&&y&&v&&l&&q)return(0,i().$S)({space:b,domains:q,team:f,spaceUser:y,invitees:s,internalGuestFeatureAvailability:l,guestFeatureAvailability:v,publicPageDataGuestSetting:g})}),[b,f,l,v,y,s,q,g])}function l({space:e,team:t,spaceUser:a,invitees:s,optimism:o="pessimistic",publicPageDataGuestSetting:u}){const d=(0,n().K8)((()=>null==a?void 0:a.getUserId()),[a]),l=(0,c()._X)({name:"internal_guests",spaceId:null==e?void 0:e.id,userId:d,amount:0}),v=(0,c()._X)({name:"guests",spaceId:null==e?void 0:e.id,userId:d,amount:0}),g=m(e),b=p(a),y=_(b,t),f=(0,r().A)(e);return(0,n().K8)((()=>{if(g&&b&&v&&l&&f)return(0,i().Im)({space:g,domains:f,team:y,spaceUser:b,invitees:s,optimism:o,guestFeatureAvailability:v,internalGuestFeatureAvailability:l,publicPageDataGuestSetting:u})}),[g,b,f,y,s,v,l,o,u])}function m(e){const t=(0,s().v3)(),a=(0,n().K8)((()=>null==e?void 0:e.getModel()),[e]),i=(0,n().K8)((()=>{if(null==e||!e.id)return;const a=u().A.getData(t,{spaceId:e.id,userId:t.currentUser.id});return a?{id:a.id,disable_guests:a.disableGuests,getSettings:()=>({disable_membership_requests:!1,enable_guest_invite_requests:a.enableGuestInviteRequest})}:void 0}),[e,t]);return a??i}function p(e){return(0,n().K8)((()=>null==e?void 0:e.getModel()),[e])??{isMember:()=>!1,isWorkspaceOwner:()=>!1}}function _(e,t){const a=(0,n().K8)((()=>null==t?void 0:t.getModel()),[t]);return(0,n().K8)((()=>null==e?void 0:e.isMember()),[e])?a:{getDisableGuests:()=>!1,getDisableRestrictedMembers:()=>!1}}},692026:(e,t,a)=>{a.d(t,{C:()=>n});var s=()=>a(534177);function n(e){return e.isGuestInviteRequest()?"guest_invite_request":e.isPageAccessRequest()?"page_access_request":e.isSpaceMembershipRequest()?"space_membership_request":e.isTeamMembershipRequest()?"team_membership_request":void(0,s().HB)(e)}},746970:(e,t,a)=>{a.d(t,{KB:()=>A,Wy:()=>h,aV:()=>I,p4:()=>q,si:()=>w});a(18107),a(967357),a(898992),a(354520),a(581454);var s=()=>a(296344),n=()=>a(96689),i=()=>a(798880),r=()=>a(496603),o=()=>a(763824),u=()=>a(134696),c=()=>a(966505),d=()=>a(559506),l=()=>a(579627),m=()=>a(384944),p=()=>a(231297),_=()=>a(680074),v=()=>a(592674),g=()=>a(418266),b=()=>a(870092),y=()=>a(309049),f=()=>a(224701);async function q(e){const{environment:t,store:a,status:s,requests:n}=e,o=t.currentUser.id;c().qQ(t,{status:s,user_count:n.length,from:e.from,request_type:"member"});const u=await Promise.all(n.map((e=>U(t,{id:e.getForActorId(),table:i().oo})))).then((e=>(0,r().oE)(e)));if("approved"===s){const e=u.map((e=>({type:"existingUser",value:e.__IM_SORRY__getValue(),membershipType:"member"})));if(!(await l().cl({environment:t,store:a,inviteTargets:e,isOnboarding:!1,invite:{inviteOrigin:"membership_request"}})).success)return{failedUsers:u,resolvedUsers:[]}}return p().createAndCommit({userAction:"accessRequestActions.resolveMembershipRequests",environment:t,canUndo:!0,perform:r=>{n.map((n=>{const u=new(g().v)(t,n.pointer);m().zv({store:u,transaction:r,data:{granted_time:Date.now(),granted_by_table:i().oo,granted_by_id:o,resolved_time:Date.now(),resolved_by_table:i().oo,resolved_by_id:o,status:s}}),c().vn(t,{status:s,request_id:n.id,from:e.from,for_actor_id:n.for_actor_id,space_role:a.getRole()})}))}}),{failedUsers:[],resolvedUsers:u}}async function A(e){const{environment:t,store:a,status:s,requests:n}=e,o=t.currentUser.id;c().qQ(t,{status:s,user_count:n.length,from:e.from,request_type:"member"});const d=await Promise.all(n.map((e=>U(t,{id:e.getForActorId(),table:i().oo})))).then((e=>(0,r().oE)(e)));if("approved"===s){const e=d.map((e=>({type:"existingUser",value:e.__IM_SORRY__getValue(),membershipType:"member"})));if(!(await l().cl({environment:t,store:a,inviteTargets:e,isOnboarding:!1,invite:{inviteOrigin:"membership_request"}})).success)return{failedUsers:d,resolvedUsers:[]};const s=a.id,n=await v().A.awaitData(t,{spaceId:s}),i=n?n.map((e=>e.domain.url)):[];u().hp(t,{invite_flow_id:void 0,invite_origin:"membership_request",user_ids:d.map((e=>e.id)),internal_domains:i})}return p().createAndCommit({userAction:"accessRequestActions.resolveMembershipRequests",environment:t,canUndo:!0,perform:e=>{n.map((a=>{const n=new(g().v)(t,a.pointer);m().zv({store:n,transaction:e,data:{granted_time:Date.now(),granted_by_table:i().oo,granted_by_id:o,resolved_time:Date.now(),resolved_by_table:i().oo,resolved_by_id:o,status:s,type:"space_membership_request"}})}))}}),{failedUsers:[],resolvedUsers:d}}async function I(e){const{environment:t,status:a,requests:s,from:n}=e;c().qQ(t,{status:a,user_count:s.length,from:n,request_type:"guest"});const l=await Promise.all(s.map((async e=>{var s,r,o;const l=await U(t,{id:e.getForActorId(),table:i().oo});if(!l)return{type:"failed",user:void 0};if(!e.isGuestInviteRequest())return{type:"failed",user:l};const m=await d().callApi({eventName:"resolveAccessRequest",environment:t,data:{accessRequestId:e.id,status:a,spaceId:e.getParentId()}}),p=null===(s=e.getAttributes().permission_records_and_roles.at(0))||void 0===s?void 0:s.role,v=null===(r=e.getAttributes().permission_records_and_roles.at(0))||void 0===r?void 0:r.id,g=(null===(o=e.getAttributes().invite_message)||void 0===o?void 0:o.length)??0;return"success"===m.type&&"approved"===a&&u().Jg(t,{role:p,is_space:!1,invite_targets:[{type:"existingUser",value:{id:l.id,version:0,email:l.getEmail()},membershipType:"none"}],is_onboarding:!1,invite_origin:"guest_invite_request",permission_items:[{type:"user_permission",role:p,user_id:l.id}],invite_message_length:g,domainType:(0,_().FX)()}),"success"===m.type&&c().AE(t,{status:a,request_id:e.id,for_actor_id:e.getForActorId(),created_by_id:e.getCreatedById(),requested_page_id:v,requested_role:p,from:n}),{type:m.type,user:l}})));await(0,o().lX)(s,10,(e=>f().nO({environment:t,spaceStore:{id:e.getParentId()}})));const m=l.filter((e=>"failed"===e.type)).map((e=>e.user)),p=l.filter((e=>"success"===e.type)).map((e=>e.user));return{failedUsers:(0,r().oE)(m),resolvedUsers:(0,r().oE)(p)}}async function h(e){if(y().A.reset(),!e.canAdmin)return;const{environment:t,spaceId:a}=e,s=await d().callApi({eventName:"getUnreadAccessRequestCount",environment:t,data:{parentTable:n().NX,parentId:a,size:1}});"success"===s.type&&y().A.setState({spaceId:a,count:s.data.count})}async function w(e,t,a){const n=function(e){return Object.values((0,r().$z)(e,(e=>function(e){if(e.isGuestInviteRequest()){const t=e.getAttributes().permission_records_and_roles[0];return`guest_invite_${e.getForActorId()}:${null==t?void 0:t.id}:${e.getCreatedById()}`}return e.isSpaceMembershipRequest()?`space_membership_${e.getForActorId()}:${e.getCreatedById()}}`:e.isTeamMembershipRequest()?void 0:void e.isPageAccessRequest()}(e)))).map((e=>{const t=(0,r().Ul)(e,(e=>e.getCreatedTime()));return t[t.length-1]}))}(await Promise.all(a.map((async t=>{const a=s().O,n=new(g().v)(e,{table:a,id:t});return await n.load(),n.getModel()}))).then((e=>(0,r().oE)(e)))),o=await function(e,t){const a=Object.values((0,r().$z)(t,(e=>function(e){if(e.isGuestInviteRequest()){const t=e.getAttributes().permission_records_and_roles[0];return`guest_invite_${e.getForActorId()}:${null==t?void 0:t.id}:${null==t?void 0:t.role}`}return e.isSpaceMembershipRequest()?`space_membership_${e.getForActorId()}`:e.isTeamMembershipRequest()?void 0:void e.isPageAccessRequest()}(e))));return Promise.all(a.map((async t=>{const a=(0,r().Ul)(t,(e=>e.getCreatedTime())),s=a[0];return{createdByActorsWithReason:await Promise.all(a.map((async t=>{const a=await U(e,{id:t.created_by_id,table:i().oo});if(a)return{actor:a,reason:t.message}}))).then((e=>(0,r().oE)(e))),accessRequest:s}})))}(e,n);return Promise.all(o.map((async t=>{const a=await U(e,{id:t.accessRequest.getForActorId(),table:i().oo});if(a)return{forActor:a,...t}}))).then((e=>(0,r().oE)(e)))}async function U(e,t){const a=new(b().L)(e,t);return await a.load(),a.getModel()}},773442:(e,t,a)=>{a.d(t,{I:()=>l,T:()=>m});a(18107),a(967357),a(581454);var s=()=>a(484714),n=()=>a(56366),i=()=>a(692026),r=()=>a(798880),o=()=>a(496603),u=()=>a(870092),c=()=>a(616092),d=()=>a(646736);function l({spaceStore:e,request:t}){var a;const i=(0,s().v3)(),c=(0,n().K8)((()=>{if(t)return new(u().L)(i,{id:t.getForActorId(),table:r().oo}).getModel()}),[t,i]),d=t&&c?{accessRequest:t,forActor:c}:void 0;return null===(a=m({spaceStore:e,requests:(0,o().oE)([d])}))||void 0===a?void 0:a.at(0)}function m({spaceStore:e,requests:t}){const a=function({spaceStore:e,requests:t}){const a=(0,s().v3)(),i=(0,n().K8)((()=>null==t?void 0:t.map((t=>{const a=(0,d().dp)(e,t.forActor.id);return{email:t.forActor.email,currentRole:a.isPageGuest()?"guest":a.isMember()?"member":void 0}}))),[t,e]),r=a.currentUser.id,o=r?(0,d().dp)(e,r):void 0;return(0,c().H)({space:e,spaceUser:o,team:void 0,optimism:"optimistic",invitees:i??[],publicPageDataGuestSetting:void 0})}({spaceStore:e,requests:t});return(0,n().K8)((()=>null==t?void 0:t.map((e=>{var t;const s=(0,i().C)(e.accessRequest),n=null==a||null===(t=a[e.forActor.email])||void 0===t?void 0:t.type;return"guest_invite_request"!==s?s:"cannot_add"===n?"space_membership_request":"guest_invite_request"}))),[t,a])}}}]);