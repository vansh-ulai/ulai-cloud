"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[71621],{71621:(e,n,t)=>{t.d(n,{eC:()=>s,eR:()=>p,gk:()=>d,IN:()=>a});t(898992),t(672577),t(737550),t(944114);var o=()=>t(349470);function i(e){const{input:n,uriContext:i}=e,r=function(){const e=[...(0,o().QB)(),"page:\\/\\/[^\\s\\}]+"].join("|");return new RegExp(`(?:\\{\\{)?(${e}|https?:\\/\\/[^\\s)\\]"}]+|(?:www\\.)?notion\\.so\\/[^\\s)\\]"}]+)(?:\\}\\})?`,"g")}(),l=[];let a;for(;null!==(a=r.exec(n));){let e=a[1];if(e){e.startsWith("page://")&&(e=e.replace("page://","pageOrCollectionViewBlock://"));try{const n=(0,t(687249).Mg)(e,i);l.push({url:e,parsed:n})}catch(s){continue}}}return l}var r=()=>t(416504);t(581454);function l(e){const{textValue:n,baseUrl:o,recordMap:i}=e;return(0,t(81252).TF)({blocks:[{id:"",block:{type:"text",text:(0,t(762209).D)({title:n,baseUrl:o,recordMap:i??t(388821).RecordMap.create()})}}]}).map((e=>e.content)).join("")}const a={type:"notion",config:{},latestVersion:"1.0.0",effects:{"notion.sendNotification":{versionAvailability:"*"},"notion.getPageDiscussions":{versionAvailability:"*"},"notion.addCommentToPage":{versionAvailability:"*"},"notion.addCommentToDiscussion":{versionAvailability:"*"}},triggers:{recurrence:{isTriggerConfigured:()=>!0,triggerDuplicator:({original:e})=>({...e,scheduleId:void 0}),versionAvailability:"*",createDefaultState:()=>({type:"recurrence",interval:1,timezone:"America/New_York",frequency:"day"})},"notion.page.discussion.comment.added":{isTriggerConfigured:({collectionId:e})=>Boolean(e),fields:{database:{required:()=>!0,isConfigured:({collectionId:e})=>Boolean(e)}},triggerDuplicator:({original:e})=>e,versionAvailability:"*",createDefaultState:()=>({type:"notion.page.discussion.comment.added"})},"notion.page.created":{isTriggerConfigured:({collectionId:e})=>Boolean(e),fields:{database:{required:()=>!0,isConfigured:({collectionId:e})=>Boolean(e)}},triggerDuplicator:({original:e})=>e,versionAvailability:"*",createDefaultState:()=>({type:"notion.page.created"})},"notion.page.updated":{isTriggerConfigured:({collectionId:e})=>Boolean(e),fields:{database:{required:()=>!0,isConfigured:({collectionId:e})=>Boolean(e)}},triggerDuplicator:({original:e})=>e,versionAvailability:"*",createDefaultState:()=>({type:"notion.page.updated"})},"notion.page.deleted":{isTriggerConfigured:({collectionId:e})=>Boolean(e),fields:{database:{required:()=>!0,isConfigured:({collectionId:e})=>Boolean(e)}},triggerDuplicator:({original:e})=>e,versionAvailability:"*",createDefaultState:()=>({type:"notion.page.deleted"})},"notion.database.agent.updated":{isTriggerConfigured:({collectionId:e})=>Boolean(e),fields:{database:{required:()=>!0,isConfigured:({collectionId:e})=>Boolean(e)}},triggerDuplicator:({original:e})=>e,versionAvailability:"*",createDefaultState:()=>({type:"notion.database.agent.updated"})},"notion.agent.mentioned":{isTriggerConfigured:()=>!0,triggerDuplicator:({original:e})=>e,versionAvailability:"*",createDefaultState:()=>({type:"notion.agent.mentioned"})},"notion.button.pressed":{isTriggerConfigured:()=>!0,triggerDuplicator:({original:e})=>e,versionAvailability:"*",createDefaultState:()=>({type:"notion.button.pressed"})}},stateDuplicator:({original:e})=>e,getModuleConfigurationStatus:()=>"ready",getDescription:e=>e.formatMessage({defaultMessage:"This integration provides internal Notion functionality for workflows.",id:"workflow.module.notion.description"}),getName:e=>e.formatMessage({defaultMessage:"Notion",id:"workflow.module.notion.title"}),getModuleConfigSection:()=>"system",getIcon:()=>t(558687).notionIcon,autoGrantPermissions:async({module:e,workflow:n,loadRecordModel:o,uriContext:r,spaceId:a})=>{let s=e;const d=n.triggers||[];if("notion"!==s.type)return s;const p=i({input:l({textValue:n.instructions||[],baseUrl:r.baseUrl}),uriContext:r});for(const{parsed:i}of p)if("pageOrCollectionViewBlock"===i.type){const e=await o({table:t(179034).ev,id:i.id,spaceId:a});null!=e&&e.parent_id&&(s=u({module:s,blockId:e.id}))}else"collection"===i.type&&(s=await c({module:s,collectionId:i.collectionId,loadRecordModel:o,uriContext:r,spaceId:a}));for(const t of d){const e=t.state;e&&("notion.page.created"!==e.type&&"notion.page.updated"!==e.type&&"notion.page.deleted"!==e.type&&"notion.page.discussion.comment.added"!==e.type||!e.collectionId||(s=await c({module:s,collectionId:e.collectionId,loadRecordModel:o,uriContext:r,spaceId:a})))}return s}},s=[{key:"day",trigger:{type:"recurrence",frequency:"day",interval:1,timezone:(0,r().P)()}},{key:"week",trigger:{type:"recurrence",frequency:"week",interval:1,timezone:(0,r().P)()}},{key:"month",trigger:{type:"recurrence",frequency:"month",interval:1,timezone:(0,r().P)()}},{key:"year",trigger:{type:"recurrence",frequency:"year",interval:1,timezone:(0,r().P)()}}];async function c(e){const{module:n,collectionId:o,loadRecordModel:i,spaceId:r}=e,l=await i({table:t(519831).Vl,id:o,spaceId:r}),a=null==l?void 0:l.parent_id;return a?u({module:n,blockId:a}):n}function u(e){var n;const{module:t,blockId:o}=e;if(null===(n=t.permissions)||void 0===n?void 0:n.find((e=>"pageOrCollectionViewBlock"===e.identifier.type&&o===e.identifier.blockId)))return t;const i={moduleType:"notion",type:"notion",identifier:{type:"pageOrCollectionViewBlock",blockId:o},actions:["reader"]};return{...t,permissions:[...t.permissions||[],i]}}function d(e){const n=null==e?void 0:e.find((e=>!(!g(e)||"web"!==e.identifier.type)));return!!n&&n.actions.includes("allow")}function p(e){if(!e||0===e.length)return!0;const n=e.find((e=>!(!g(e)||"helpdocs"!==e.identifier.type)));return!n||n.actions.includes("allow")}function g(e){return"search"===e.type}},81252:(e,n,t)=>{t.d(n,{TF:()=>u});t(944114),t(898992),t(803949),t(581454);const o="\t",i=/([\\*~`$[\]<>{}|^])/g;function r(e){return e.replace(i,"\\$1")}function l(e,n){const t=[],o=[];return e.strike&&!n.strike&&t.push("~~"),e.bold&&!n.bold&&t.push("**"),e.italic&&!n.italic&&t.push("*"),!e.bold&&n.bold&&o.push("**"),!e.italic&&n.italic&&o.push("*"),!e.strike&&n.strike&&o.push("~~"),{close:t,open:o}}function a(e){const n=e.annotations??{};return!(n.href||n.code||n.color||n.underline||n.discussionUrls&&0!==n.discussionUrls.length)}function s(e){var n,t,o;return"string"!=typeof e&&"annotated"===e.type&&a(e)?{bold:Boolean(null===(n=e.annotations)||void 0===n?void 0:n.bold),italic:Boolean(null===(t=e.annotations)||void 0===t?void 0:t.italic),strike:Boolean(null===(o=e.annotations)||void 0===o?void 0:o.strikethrough)}:"string"!=typeof e&&"mention"===e.type&&e.annotations&&(e.annotations.bold||e.annotations.italic||e.annotations.strikethrough)?{bold:Boolean(e.annotations.bold),italic:Boolean(e.annotations.italic),strike:Boolean(e.annotations.strikethrough)}:{}}function c(e){let n="",t={};for(const o of e){const e=s(o),{close:i,open:c}=l(t,e);if(n+=i.join("")+c.join(""),"string"==typeof o)n+=r(o).replace(/\n/g,"<br>");else{if("annotated"===o.type&&a(o)){n+=r(o.text).replace(/\n/g,"<br>"),t=e;continue}switch(o.type){case"annotated":n+=m(o.text,o.annotations);break;case"equation":n+=`$\`${o.equation.trim()}\`$`;break;case"mention":n+=y(o);break;case"citation":n+=`[^${o.href}]`}}t=e}return n+=l(t,{}).close.join(""),n}function u({blocks:e,omitUnknownBlocks:n=!1,enableLinkedDatabases:t=!1,compressedCitationMap:o,skipTranscriptionTranscript:i=!1}){const r=[];let l=0;for(let a=0;a<e.length;a++){const s=e[a];let c="";const u=e[a-1],d="numbered_list"===(null==u?void 0:u.block.type);c+=g({block:s.block,indentLevel:0,sibling:"numbered_list"===s.block.type&&d?l:0,omitUnknownBlocks:n,enableLinkedDatabases:t,compressedCitationMap:o,skipTranscriptionTranscript:i}),r.push({id:s.id,content:c}),"numbered_list"!==s.block.type?l=0:l++}return r.map((e=>({id:e.id,content:e.content.replace(/[ \t]+$/,"")})))}function d(e,n,t=!1,o){const i=[];let r=0,l=!1;for(const a of e)"numbered_list"===a.type?(i.push(g({block:a,indentLevel:n,sibling:r,enableLinkedDatabases:t,compressedCitationMap:o})),l=!0,r++):(l&&(r=0,l=!1),i.push(g({block:a,indentLevel:n,sibling:0,enableLinkedDatabases:t,compressedCitationMap:o})));return i.join("\n")}function p(e){return e?` {color="${e}"}`:""}function g({block:e,indentLevel:n,sibling:t=0,omitUnknownBlocks:i,skipTranscriptionTranscript:r,enableLinkedDatabases:l=!1,compressedCitationMap:a}){var s;const u=o.repeat(n);switch(e.type){case"text":{var m;if(!e.text||0===e.text.length)return"\n\n";let t=`${u}${c(e.text)}${p(e.color)}`;return a&&e.citationData&&(t+=` [^{{${a.getCompressedCitationForData(e.citationData)}}}]`),null!==(m=e.children)&&void 0!==m&&m.length&&(t+=`\n${d(e.children,n+1,l,a)}`),t}case"ai_block":return`${u}${e.text&&c(e.text)}${e.children&&d(e.children,n+1,l)}`;case"h1":case"h2":case"h3":{const t="h1"===e.type?"#":"h2"===e.type?"##":"###";if(e.toggleable){var y;let t=`${u}${"h1"===e.type?"▶#":"h2"===e.type?"▶##":"▶###"} ${c(e.text||[])}${p(e.color)}`;return null!==(y=e.children)&&void 0!==y&&y.length&&(t+=`\n${d(e.children,n+1,l)}`),t}return`${u}${t} ${c(e.text||[])}${p(e.color)}`}case"toggle":{var k;let t=`${u}▶${e.text&&e.text.length?` ${c(e.text)}`:""}${p(e.color)}`;return null!==(k=e.children)&&void 0!==k&&k.length&&(t+=`\n${d(e.children,n+1,l)}`),t}case"callout":{var w;const t=e.color?` color="${e.color}"`:"";let i=`${u}<callout${e.icon?` icon="${e.icon}"`:""}${t}>`;return e.text&&(i+=`\n${u}${o}${c(e.text)}`),null!==(w=e.children)&&void 0!==w&&w.length&&(i+=`\n${d(e.children,n+1,l)}`),i+=`\n${u}</callout>`,i}case"to_do":{const t=e.checked?"[x]":"[ ]";return b(e,u,n,`- ${t}`,l)}case"bulleted_list":return b(e,u,n,"-",l);case"numbered_list":return b(e,u,n,`${t+1}.`,l,a);case"quote":{var C;let t=`${u}> ${c(e.text||[])}${p(e.color)}`;return null!==(C=e.children)&&void 0!==C&&C.length&&(t+=`\n${e.children.map(((e,t)=>g({block:e,indentLevel:n+1,sibling:t,enableLinkedDatabases:l,compressedCitationMap:a}))).join("\n")}`),t}case"divider":return`${u}---`;case"code":return`${u}\`\`\`${(null===(s=e.language)||void 0===s?void 0:s.toLowerCase())||""}\n${e.text?e.text[0]:""}\n${u}\`\`\``;case"equation":return`${u}$$\n${u}${e.text?e.text[0]:""}\n${u}$$${p(e.color)}`;case"table":return function(e,n){if(!e.rows||0===e.rows.length)return`${n}<table>\n${n}</table>`;const{attrsStr:t,colgroupContent:o,renderCell:i}=v(e,n);let r=`${n}<table${t}>`;return r+=o,e.rows.forEach((e=>{const t=e.color?` color="${e.color}"`:"";r+=`\n${n}<tr${t}>`,e.cells.forEach((e=>{r+=`\n${n}${i(e)}`})),r+=`\n${n}</tr>`})),r+=`\n${n}</table>`,r}(e,u);case"column_list":return function(e,n,t,i=!1){var r;let l=`${n}<columns>`;if(null!==(r=e.children)&&void 0!==r&&r.length)for(const s of e.children){var a;"column"===s.type&&(l+=`\n${n}${o}<column>`,null!==(a=s.children)&&void 0!==a&&a.length&&(l+=`\n${d(s.children,t+2,i)}`),l+=`\n${n}${o}</column>`)}return l+=`\n${n}</columns>`,l}(e,u,n,l);case"synced_block":{var _;let t=`${u}<synced_block${e.url?` url="${e.url}"`:""}>`;return null!==(_=e.children)&&void 0!==_&&_.length&&(t+=`\n${d(e.children,n+1,l)}`),t+=`\n${u}</synced_block>`,t}case"synced_block_reference":{var x;let t=`${u}<synced_block_reference url="${e.originalUrl}">`;return null!==(x=e.children)&&void 0!==x&&x.length&&(t+=`\n${d(e.children,n+1,l)}`),t+=`\n${u}</synced_block_reference>`,t}case"page":return`${u}${$(e)}`;case"database":return`${u}${f(e,l)}`;case"audio":case"image":case"video":case"file":case"pdf":return`${u}${h(e)}`;case"transcription":{var I,M,D;let t=`${u}<meeting-notes>`;null!==(I=e.text)&&void 0!==I&&I.length&&(t+=`\n${u}${o}${c(e.text)}`),e.summary&&"children"in e.summary&&null!==(M=e.summary.children)&&void 0!==M&&M.length&&(t+=`\n${u}${o}<summary>`,t+=`\n${e.summary.children.map((e=>g({block:e,indentLevel:n+2,compressedCitationMap:a}))).join("\n")}`,t+=`\n${u}${o}</summary>`),t+=`\n${u}${o}<notes>`;const i=e.notes&&"children"in e.notes?e.notes.children??[]:[];return i.length>0&&(t+=`\n${i.map((e=>g({block:e,indentLevel:n+2,compressedCitationMap:a}))).join("\n")}`),t+=`\n${u}${o}</notes>`,e.transcript&&"children"in e.transcript&&null!==(D=e.transcript.children)&&void 0!==D&&D.length&&!r&&(t+=`\n${u}${o}<transcript>`,t+=`\n${e.transcript.children.map((e=>g({block:e,indentLevel:n+2,compressedCitationMap:a}))).join("\n")}`,t+=`\n${u}${o}</transcript>`),t+=`\n${u}</meeting-notes>`,t}case"table_of_contents":return`${u}<table_of_contents${e.color?` color="${e.color}"`:""}/>`;case"unknown":return i?"":`${u}<unknown url="${e.url}"${e.alt?` alt="${e.alt}"`:""}/>`;default:return`${u}/* unsupported ${e.type} */`}}function $(e){return`<page url="${e.url}"${e.color?` color="${e.color}"`:""}>${c(e.text||[])}</page>`}function f(e,n=!1){const t=[];return e.url&&t.push(`url="${e.url}"`),t.push(`inline="${!0===e.inline}"`),e.icon&&t.push(`icon="${e.icon}"`),n&&e.dataSourceUrl&&t.push(`data-source-url="${e.dataSourceUrl}"`),e.color&&t.push(`color="${e.color}"`),`<database ${t.join(" ")}>${c(e.text||[])}</database>`}function h(e){const n=` source="${e.source||""}"`,t=e.color?` color="${e.color}"`:"";return`<${e.type}${n}${t}>${c(e.text||[])}</${e.type}>`}function b(e,n,t,o,i=!1,r){const l=[];e.text&&e.text.length&&l.push(c(e.text)),e.children&&l.push(...e.children.map(((e,n)=>g({block:e,indentLevel:t+1,sibling:n,enableLinkedDatabases:i,compressedCitationMap:r}))));return`${n}${o} ${l.join("\n").trim()}${p(e.color)}`}function m(e,n={}){let t=n.code?e.replace(/`/g,"\\`"):r(e);t=t.replace(/\n/g,"<br>"),n.code&&(t=`\`${t}\``),n.strikethrough&&(t=`~~${t}~~`),n.bold&&n.italic?t=`***${t}***`:(n.bold&&(t=`**${t}**`),n.italic&&(t=`*${t}*`)),n.href&&(t=`[${t}](${n.href})`);const o=[];return n.color&&o.push(`color="${n.color}"`),n.underline&&o.push('underline="true"'),n.discussionUrls&&n.discussionUrls.length>0&&o.push(`discussion-urls="${n.discussionUrls.join(",")}"`),o.length>0&&(t=`<span ${o.join(" ")}>${t}</span>`),t}function y(e){const{mention:n}=e,t=n=>{const t=e.annotations??{};if(!(t.color||t.underline||t.discussionUrls&&0!==t.discussionUrls.length))return n;const o=[];return t.color&&o.push(`color="${t.color}"`),t.underline&&o.push('underline="true"'),t.discussionUrls&&t.discussionUrls.length>0&&o.push(`discussion-urls="${t.discussionUrls.join(",")}"`),`<span ${o.join(" ")}>${n}</span>`};switch(n.type){case"user":return t(void 0===n.name?`<mention-user url="${n.url}"/>`:`<mention-user url="${n.url}">${r(n.name)}</mention-user>`);case"page":return t(void 0===n.title?`<mention-page url="${n.url}"/>`:`<mention-page url="${n.url}">${r(n.title)}</mention-page>`);case"database":return t(void 0===n.title?`<mention-database url="${n.url}"/>`:`<mention-database url="${n.url}">${r(n.title)}</mention-database>`);case"data-source":return t(void 0===n.title?`<mention-data-source url="${n.url}"/>`:`<mention-data-source url="${n.url}">${r(n.title)}</mention-data-source>`);case"date":return t(`<mention-date start="${n.start}"${n.end?` end="${n.end}"`:""}/>`);case"custom_emoji":return t(`:${n.name}:`)}}function v(e,n){const t=[];void 0!==e.headerRow&&t.push(`header-row="${e.headerRow}"`),void 0!==e.headerColumn&&t.push(`header-column="${e.headerColumn}"`),void 0!==e.fitPageWidth&&t.push(`fit-page-width="${e.fitPageWidth}"`);const o=t.length>0?` ${t.join(" ")}`:"";let i="";e.columnStyles&&e.columnStyles.length>0&&(i=`\n${n}<colgroup>`,e.columnStyles.forEach((e=>{const t=e.color?` color="${e.color}"`:"",o=e.width?` width="${e.width}"`:"";i+=`\n${n}<col${t}${o}>`})),i+=`\n${n}</colgroup>`);return{attrsStr:o,colgroupContent:i,renderCell:e=>`<td${e.color?` color="${e.color}"`:""}>${c(e.text||[])}</td>`}}},265282:(e,n,t)=>{t.d(n,{Ah:()=>l,Er:()=>s,Fi:()=>r,f9:()=>a});var o=()=>t(534177);const i={gray:"gray",brown:"brown",orange:"orange",yellow:"yellow",green:"teal",blue:"blue",purple:"purple",pink:"pink",red:"red",gray_bg:"gray_background",brown_bg:"brown_background",orange_bg:"orange_background",yellow_bg:"yellow_background",green_bg:"teal_background",blue_bg:"blue_background",purple_bg:"purple_background",pink_bg:"pink_background",red_bg:"red_background"};function r(e){for(const n of(0,o().uv)(i))if(n===e)return!0;return!1}function l(e){if(e)return i[e]}function a(e){if(e)for(const[n,t]of Object.entries(i))if(t===e)return n}function s(e){return"image"===e.type||"pdf"===e.type||"file"===e.type||"audio"===e.type||"video"===e.type?(e.type,!0):(e.type,!1)}},762209:(e,n,t)=>{t.d(n,{D:()=>u});t(16280),t(944114);var o=()=>t(402390),i=()=>t(792071),r=()=>t(179034),l=()=>t(798880),a=()=>t(201980),s=()=>t(265282),c=()=>t(687249);function u(e){const{title:n,baseUrl:t,disableTemplateWrapper:s,recordMap:u}=e,g=[],$=e.intl||(0,o().wW)();for(const o of(0,a().RQ)(n)){const e=(0,c().TE)((0,a().N8A)(o),{baseUrl:t,publicDomainName:""}),n=(0,a().uPN)(o),b=p(n,s);if((0,a().qXl)(o)){const e=(0,a().snh)(n);if(e){var f;const n=(0,a().NcG)(e);g.push({type:"mention",mention:{type:"user",url:s?(0,c().dE)({userId:n}):`{{${(0,c().dE)({userId:n})}}}`,name:null==u||null===(f=u.getModel({table:l().oo,id:n}))||void 0===f?void 0:f.getDisplayName($,!0)},annotations:b});continue}const o=(0,a().Sev)(n);if(o){var h;const e=(0,a().v55)(o);g.push({type:"mention",mention:{type:"page",url:s?(0,c().Q2)({baseUrl:t,pageId:e}):`{{${(0,c().Q2)({baseUrl:t,pageId:e})}}}`,title:null==u||null===(h=u.getModel({table:r().ev,id:e}))||void 0===h?void 0:h.getRenderTitle({getRecordModel:i().b4_.fromRecordMap(u),intl:$,userTimeZone:"UTC"})},annotations:b});continue}const d=(0,a().$CJ)(n);if(d){const e=(0,a().K7D)(d),n="daterange"===e.type?e.end_date:void 0;g.push({type:"mention",mention:{type:"date",start:e.start_date,end:n},annotations:b});continue}const p=(0,a().G6d)(n);if(p&&u){const e=(0,a().qS0)(p);if(e){const n=u.getModel(e);if(n){g.push({type:"mention",mention:{type:"custom_emoji",name:n.getName()},annotations:b});continue}}}const m=(0,a().lqY)(n);if(m){const e=(0,a().q1R)(m),n={type:"annotated",text:e.title??e.href,annotations:{...b??{},href:s?e.href:`{{${e.href}}}`}};g.push(n);continue}const y=(0,a().MzR)(n);if(y){const e=(0,a()._tF)(y),n=u.getModel({table:r().ev,id:e.id}),t=null==n?void 0:n.getFormat().original_url;if(t){g.push({type:"annotated",text:t,annotations:{...b??{},href:s?t:`{{${t}}}`}});continue}}const v=(0,a()._Vv)(n);if(v){const e=(0,a().FLg)(v);if(e){if("everyone"===e.mentionType){g.push("@everyone");continue}if("teamspace"===e.mentionType){if(u){const e=(0,a().KGg)(v);if(e){const n=u.getModel(e);if(n){g.push(`@${n.getName()}`);continue}}}g.push(`@[Team:${e.teamId}]`);continue}}}const k=(0,a().g2K)(n);if(k){const e=(0,a().NpB)(k);g.push({type:"citation",href:s?e.href:`{{${e.href}}}`,annotations:b});continue}const w=(0,a().dHc)(n);if(w){const e=(0,a().TSJ)(w),n=(0,c().CM)(e.id);g.push({type:"mention",mention:{type:"data-source",url:s?n:`{{${n}}}`}});continue}const C=(0,a().TVE)(n);if(C){const e=(0,a().GCe)(C);if((0,a().QkK)(e)){const n=(0,a().MaE)(e);if(n){const t=(0,c().ne)(n.collectionId,n.propertyId);g.push({type:"mention",mention:{type:"data-source",url:s?t:`{{${t}}}`,title:e.name},annotations:b});continue}}}}else{if((0,a().GiG)(o)){const e=(0,a().j1D)(n);if(e){g.push({type:"equation",equation:(0,a().U35)(e),annotations:b});continue}throw new Error("Equation token without equation annotation")}if(b){const n=(0,a().So_)(o);if(u&&n){const e=d({url:n,baseUrl:t,recordMap:u,disableTemplateWrapper:s,agentAnnotations:b});if(e){g.push(e);continue}}g.push({type:"annotated",text:e,annotations:b})}else g.push(e)}}return g.length>0?g:void 0}function d(e){const{url:n,baseUrl:t,recordMap:o,disableTemplateWrapper:i,agentAnnotations:l}=e;let a;try{a=(0,c().Mg)(n,{baseUrl:t,publicDomainName:""})}catch(d){return}if("pageOrCollectionViewBlock"!==a.type)return;const s=o.getModel({table:r().ev,id:a.id});if(!s)return;const u=(0,c().Q2)({baseUrl:t,pageId:s.id});return{type:"mention",mention:{type:s.isCollectionView()?"database":"page",url:i?u:`{{${u}}}`},annotations:l}}function p(e,n){const t={};for(const o of e)if((0,a().dRK)(o))t.bold=!0;else if((0,a().WWk)(o))t.italic=!0;else if((0,a().EgN)(o))t.strikethrough=!0;else if((0,a().cyx)(o))t.underline=!0;else if((0,a().rlz)(o))t.code=!0;else if((0,a().YuY)(o))t.color=(0,s().f9)((0,a().uIc)(o));else if((0,a().sh$)(o)){const e=(0,a().cQR)(o);if(e){const o=(0,c().TE)(e,{baseUrl:"",publicDomainName:""});t.href=n?o:`{{${o}}}`}}else if((0,a().iQL)(o)){const e=`discussion://${(0,a().Orm)(o)}`;t.discussionUrls=[...t.discussionUrls??[],n?e:`{{${e}}}`]}return Object.keys(t).length>0?t:void 0}}}]);