"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[943,71204],{19676:(e,t,o)=>{o.d(t,{i:()=>i,y:()=>l});var n=()=>o(340498),r=()=>o(284371);function i(e){const{theme:t,isInHomeWidget:o,isFeedbackButton:i,isMobile:l}=e;return{button:{display:"flex",alignItems:"center",fontSize:14,padding:6,...i?{height:o?24:28,color:t.text.tertiary,fill:t.icon.tertiary}:o?{height:24,width:24,color:t.text.tertiary,fill:t.icon.tertiary}:{height:l?32:28,width:l?32:28,color:t.icon.secondary,fill:t.icon.secondary},fontWeight:r().Wy.regular,lineHeight:1,borderRadius:6},icon:{width:l?n().Ev.default:n().Ev.sm,height:l?n().Ev.default:n().Ev.sm,fill:t.icon.secondary}}}function l(e){const{theme:t}=e;return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:t.icon.secondary,fontWeight:r().Wy.regular,lineHeight:1,borderRadius:6}}},56394:(e,t,o)=>{o.d(t,{A:()=>c});o(296540);var n=()=>o(484714),r=()=>o(401497),i=()=>o(718827),l=()=>o(606712),a=()=>o(668725),s=o(474848);function c(e){const{icon:t,title:o,on:c,disabled:d,hasDiff:u,wrapStyle:p,innerStyle:m,hideChevron:g}=e,{isMobile:S}=(0,n().Y0)(),h=(0,r().IS)((e=>({container:{borderRadius:14,marginInlineEnd:6,display:"inline-flex",...u&&{position:"relative"},...p},filterPill:{fontSize:14,display:"inline-flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",borderRadius:32,height:S?28:24,lineHeight:S?"28px":"24px",padding:"0 8px",color:e.text.secondary,...c&&{color:e.blue.text.accentPrimary,borderColor:e.blue.border.strong,background:e.blue.background.secondary},...d&&{color:e.blue.text.disabled,borderColor:e.blue.border.strong,background:e.blue.background.secondary},...m},hovered:c?{background:(0,l().R)({color:e.blue.background.secondary,mode:e.mode})}:{},pressed:c?{background:(0,l().y)({color:e.blue.background.secondary,mode:e.mode})}:{},chevron:{width:10,marginInlineStart:4,marginTop:1,fill:d?e.blue.icon.disabled:c?e.blue.icon.accentPrimary:e.icon.tertiary},diffDot:{position:"absolute",top:-2,insetInlineEnd:-2,background:e.orange.icon.accentPrimary,border:`1px solid ${e.background.primary}`,width:9,height:9,borderRadius:9}})),[u,p,S,c,d,m]);return(0,s.jsxs)("div",{style:h.container,children:[(0,s.jsxs)(i().Ay,{disabled:d,style:h.filterPill,hoveredStyle:h.hovered,pressedStyle:h.pressed,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onClick:e.onClick,onDoubleClick:e.onDoubleClick,children:[t,o,g?void 0:(0,a().b)(h.chevron)]}),u?(0,s.jsx)("div",{style:h.diffDot}):void 0]})}},63467:(e,t,o)=>{o.d(t,{y:()=>d});var n=()=>o(637997),r=()=>o(267419);const i={ko:()=>o.e(2268).then(o.bind(o,224434)),es:()=>o.e(95264).then(o.bind(o,196425)),de:()=>o.e(35390).then(o.bind(o,653703)),fr:()=>o.e(3272).then(o.bind(o,94677)),pt:()=>o.e(27315).then(o.bind(o,766869)),zh:()=>o.e(69945).then(o.bind(o,516814)),ja:()=>o.e(77757).then(o.bind(o,824432)),da:()=>o.e(9423).then(o.bind(o,440761)),fi:()=>o.e(59337).then(o.bind(o,462135)),nb:()=>o.e(2040).then(o.bind(o,937314)),nl:()=>o.e(51106).then(o.bind(o,530897)),sv:()=>o.e(53631).then(o.bind(o,895222)),th:()=>o.e(17278).then(o.bind(o,796137)),id:()=>o.e(51872).then(o.bind(o,443716)),vi:()=>o.e(51872).then(o.bind(o,443716)),he:()=>o.e(51872).then(o.bind(o,443716)),ar:()=>o.e(51872).then(o.bind(o,443716))};let l=!1,a=!1;async function s(e){for(const[o,r]of Object.entries(e.emojiLocaleKeywords)){var t;n().fB[o]={...n().fB[o],keywords:[...r,...(null===(t=n().fB[o])||void 0===t?void 0:t.keywords)||[]]}}await r().A.waitUntilLoaded(),r().A.update((({emojiByName:t,...o})=>({...o,emojiByName:{...t,...e.emojiByName}})))}async function c(){if(l)return;const[e]=o(662303).locale.split("-");e in i&&(await s(await i[e]()),l=!0)}const d=(0,o(279900).A)((async()=>{await async function(){a||(await s(await o.e(51872).then(o.bind(o,443716))),a=!0)}(),await c()}))},69447:(e,t,o)=>{o.d(t,{Lq:()=>n,WK:()=>i,nh:()=>r});const n=40,r=48,i=60},75368:(e,t,o)=>{o.d(t,{A:()=>r});class n extends(()=>o(757695))().Store{getInitialState(){return{open:!1}}}const r=new n},92253:(e,t,o)=>{o.d(t,{i:()=>s});o(898992),o(354520),o(581454);var n=()=>o(448801),r=()=>o(869558),i=()=>o(496603),l=()=>o(722101),a=()=>o(913530);function s(e){const{collectionViewBlockStore:t,newViewIds:o,transaction:s}=e,c=t.getCollectionViewStores(),{beforeOps:d}=(0,n().i)(c.map((e=>e.id)).slice(0,o.length),o);i().jJ(d,((e,n)=>{const c=a().p.createChildStore(t,{table:r().Gy,id:n,spaceId:t.getSpaceId()});if(e)l().nc({parentStore:t.getCollectionViewsStore(),insertStore:c,beforeStore:a().p.createChildStore(t,{table:r().Gy,id:e,spaceId:t.getSpaceId()}),transaction:s});else{const e=i().HV(o.filter((e=>e!==n)));l().WH({parentStore:t.getCollectionViewsStore(),insertStore:c,afterStore:e?a().p.createChildStore(t,{table:r().Gy,id:e,spaceId:t.getSpaceId()}):void 0,transaction:s})}}))}},106150:(e,t,o)=>{o.d(t,{V:()=>n});const n=32},112412:(e,t,o)=>{o.r(t),o.d(t,{filterSmallIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"1.69 3.69 12.61 8.61",svg:(0,o(474848).jsx)("path",{d:"M2.4 3.7a.7.7 0 1 0 0 1.4h11.2a.7.7 0 1 0 0-1.4zm9.5 3.594H4.1a.7.7 0 1 0 0 1.4h7.8a.7.7 0 1 0 0-1.4M5.8 10.9a.7.7 0 1 0 0 1.4h4.4a.7.7 0 1 0 0-1.4z"})},r=(0,o(340498).wt)("filterSmall",n)},112961:(e,t,o)=>{o.d(t,{$m:()=>i,bw:()=>l,i7:()=>d,rJ:()=>s});var n=()=>o(645873);const r=new(n().O2)("TableHeaderCellMenu",(()=>Promise.all([o.e(9773),o.e(36556),o.e(40537),o.e(55373),o.e(36192),o.e(62475),o.e(3151),o.e(98629),o.e(87249),o.e(71621),o.e(88924),o.e(92845),o.e(56369),o.e(5834),o.e(2411),o.e(89296),o.e(46414),o.e(9294),o.e(11676),o.e(91256),o.e(40563),o.e(67494),o.e(44584),o.e(53141),o.e(84166),o.e(16448),o.e(37384),o.e(3259),o.e(13955),o.e(55776),o.e(51444),o.e(50856),o.e(36359),o.e(25204),o.e(47779)]).then(o.bind(o,659229)))),i=(0,n()._h)(r,(e=>e.TableHeaderCellMenu)),l=new(n().O2)("AddColumnContainerAIPropertySuggestion",(()=>o.e(77974).then(o.bind(o,960607)))),a=((0,n()._h)(l,(e=>e.AddColumnContainerAIPropertySuggestion)),new(n().O2)("addColumnContainerWithAI",(()=>o.e(3625).then(o.bind(o,993870))))),s=(0,n()._h)(a,(e=>e.AddColumnContainerWithAI)),c=new(n().O2)("databasePropertySuggestionTooltip",(()=>o.e(48564).then(o.bind(o,462434)))),d=(0,n()._h)(c,(e=>e.DatabasePropertySuggestionTooltip))},124311:(e,t,o)=>{o.d(t,{K:()=>r});var n=()=>o(314529);function r(e){(0,n().DO_NOT_USE_trackLegacy)(e,"inline_collection_load_more_click")}},126912:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,xMarkCircleFillSmallIcon:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"1.95 1.94 12.11 12.1",svg:(0,o(474848).jsx)("path",{d:"M8 1.95a6.05 6.05 0 1 0 0 12.1 6.05 6.05 0 0 0 0-12.1m2.289 3.761a.55.55 0 0 1 0 .778L8.778 8l1.511 1.511a.55.55 0 0 1-.778.778l-1.51-1.511-1.512 1.51a.55.55 0 1 1-.778-.777L7.222 8l-1.51-1.511a.55.55 0 1 1 .777-.778L8 7.222l1.511-1.51a.55.55 0 0 1 .778 0"})},r=(0,o(340498).wt)("xMarkCircleFillSmall",n)},152077:(e,t,o)=>{o.d(t,{Vs:()=>c,WA:()=>s,YU:()=>d,bO:()=>l,lU:()=>a});var n=o(296540),r=o(474848);const i=n.createContext(void 0);function l(e){return(0,r.jsx)(i.Provider,{value:e.surface,children:e.children})}function a(){return n.useContext(i)}function s(){const e=a();return"TeamHome"===e||"PersonalHome"===e}function c(){return void 0===a()}function d(){return c()?12:0}i.displayName="PostFeedSurfaceContext"},157071:(e,t,o)=>{o.d(t,{PH:()=>f,Un:()=>x,V_:()=>C,hn:()=>A,lY:()=>k,v7:()=>I,zU:()=>w});var n=()=>o(584262),r=()=>o(970330),i=()=>o(857783),l=()=>o(281948),a=()=>o(778417),s=()=>o(190033),c=()=>o(90654),d=()=>o(766854),u=()=>o(714574),p=()=>o(573451),m=()=>o(357643),g=()=>o(177618),S=()=>o(862292),h=()=>o(476492),y=()=>o(996494),v=()=>o(372267);function f(e){(0,u().P)({store:e})}function b(e,t,o,n,r){if("title"===e){c().VN({environment:r,blockPropertyValueOverlayStore:o});const e=t.getBlockTitleStore();a().hc({environment:r,store:t}),(0,p().C)({store:t}),(0,s().z)({store:e})}else e?(c().VN({environment:r,blockPropertyValueOverlayStore:o}),c().ho({environment:r,blockPropertyValueOverlayStore:o,store:t,property:e,surface:"list",collectionContextStore:n})):c().VN({environment:r,blockPropertyValueOverlayStore:o});f(t)}async function x(e,t,o,n,r,i,l){const a=await S().T.formulas.load();b((0,v().cO)(e,t,o,n,r,l,a),o,t,i,e)}async function C(e,t,o,n,r,i,l){const a=await S().T.formulas.load();b((0,v().o6)(e,t,o,n,r,l,a),o,t,i,e)}function w(e,t){f(e),t()}function k(e,t,o){c().VN({environment:e,blockPropertyValueOverlayStore:t}),a().Lt({environment:e,store:o}),f(o)}function I(e){const{environment:t,newStore:o,previousStore:n}=e;a().hc({environment:t,store:o}),(0,p().C)({store:o}),y().A.setState({store:o,editMode:"new",previousStore:n})}function A(e){var t;const{transaction:o,environment:a,results:s,collectionContextStore:c,isFullScreen:u,groupsPointer:p,insertAtIndex:S,editInPeek:y,from:v}=e;c.searchQueryStore.state&&(0,m().S)({searchQuery:"",collectionContextStore:c,isFullScreen:u});const f=null===(t=c.groupsStore.getGroupState(p))||void 0===t?void 0:t.resultsStore;if(!f)return;let b;S>0&&(b=s[S]);const x=(0,d().Q)({environment:a,collectionContextStore:c,groupsPointer:p,insertAtIndex:S,shouldCoerce:!0,templateStore:c.defaultPageTemplateStore.state,transaction:o,from:{createBlock:v},inMemoryRecordCache:a.defaultRecordCache.inMemoryRecordCache});if(!x)return;const C=x.coercionSucceeded,w=x.newStore;return a.device.isMobile?i().uK({environment:a,store:w,pageVisitSource:n().y8.Create}):C&&!y?I({environment:a,newStore:w,previousStore:b}):l().VU({environment:a,store:w,peekMode:(0,g().hH)(c),resultsStore:f,collectionContextStore:c,pageVisitSource:n().y8.Create}),r().vH(a,{from:v,type:"page",new_page_id:w.id,creating_block_id:w.id,...(0,h().sl)(c)}),w}},160438:(e,t,o)=>{o.r(t),o.d(t,{arrowStraightRightFillSmallIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"1.99 2.94 12.01 10.12",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M13.78 7.47 9.46 3.15A.75.75 0 0 0 8.4 4.21l3.04 3.04H2.702C2.315 7.25 2 7.586 2 8s.315.75.703.75h8.736L8.4 11.79a.75.75 0 0 0 1.061 1.06l4.32-4.32a.75.75 0 0 0 0-1.06"})},r=(0,o(340498).wt)("arrowStraightRightFillSmall",n)},167170:(e,t,o)=>{o.d(t,{_:()=>r});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"3.29 3.29 13.41 13.41",svg:(0,o(474848).jsx)("path",{d:"M3.3 4.825c0-.842.683-1.525 1.525-1.525h3.15c.842 0 1.525.683 1.525 1.525v10.35c0 .842-.683 1.525-1.525 1.525h-3.15A1.525 1.525 0 0 1 3.3 15.175zm1.525-.275a.275.275 0 0 0-.275.275v10.35c0 .152.123.275.275.275h3.15a.275.275 0 0 0 .275-.275V4.825a.275.275 0 0 0-.275-.275zm5.675.275v3.15c0 .842.683 1.525 1.525 1.525h3.15c.842 0 1.525-.683 1.525-1.525v-3.15c0-.842-.683-1.525-1.525-1.525h-3.15c-.842 0-1.525.683-1.525 1.525m1.525-.275h3.15c.152 0 .275.123.275.275v3.15a.275.275 0 0 1-.275.275h-3.15a.275.275 0 0 1-.275-.275v-3.15c0-.152.123-.275.275-.275m0 5.95c-.842 0-1.525.683-1.525 1.525v3.15c0 .842.683 1.525 1.525 1.525h3.15c.842 0 1.525-.683 1.525-1.525v-3.15c0-.842-.683-1.525-1.525-1.525zm-.275 1.525c0-.152.123-.275.275-.275h3.15c.152 0 .275.123.275.275v3.15a.275.275 0 0 1-.275.275h-3.15a.275.275 0 0 1-.275-.275z"})},r=(0,o(340498).wt)("layout",n)},170356:(e,t,o)=>{o.d(t,{NS:()=>u,Pq:()=>g,Z3:()=>d,sw:()=>p});o(296540);var n=()=>o(484714),r=()=>o(297872),i=()=>o(404277),l=()=>o(678553),a=()=>o(45552),s=()=>o(722872),c=o(474848);const d=8,u=8,p=32,m={height:p+d-2,paddingTop:d-2};function g({title:e,helpButton:t,onCancel:o,desktopMinWidth:l,desktopMaxWidth:d,desktopWidth:u,children:p}){const{device:m}=(0,n().v3)();return(0,c.jsx)(r().A,{capture:!0,allowEsc:!0,allowUndo:!0,render:n=>{let r;return r=m.isMobile?{menuType:s().gu.Modal,title:e,right:(0,c.jsx)(a().DoneMenuText,{}),onClickRight:o,...n}:{menuType:s().gu.Popup,...l&&{minWidth:l},...d&&{maxWidth:d},...u&&{width:u},...n},(0,c.jsx)(i().A,{...r,header:e&&(0,c.jsx)(S,{title:e,helpButton:t}),children:p})}})}function S({title:e,helpButton:t}){return(0,n().v3)().device.isMobile?null:(0,c.jsx)(l().Ay,{style:m,title:e,right:t})}},171559:(e,t,o)=>{o.d(t,{Fp:()=>s,ML:()=>a,Pe:()=>i});var n=()=>o(645873);const r=new(n().O2)("formEditorActionButtons",(()=>Promise.all([o.e(75134),o.e(9304),o.e(9773),o.e(36556),o.e(40537),o.e(55373),o.e(36192),o.e(96346),o.e(44711),o.e(53321),o.e(90825),o.e(16471),o.e(37353),o.e(29151),o.e(87248),o.e(83048),o.e(87249),o.e(71621),o.e(88924),o.e(92845),o.e(56369),o.e(5834),o.e(48486),o.e(2411),o.e(89296),o.e(46414),o.e(9294),o.e(11676),o.e(91256),o.e(40563),o.e(67494),o.e(44584),o.e(53141),o.e(4422),o.e(4330),o.e(55162),o.e(55753),o.e(28866),o.e(22001),o.e(71386),o.e(4351),o.e(6331),o.e(69144),o.e(42660),o.e(55997),o.e(40828),o.e(12341),o.e(96402),o.e(84166),o.e(70359),o.e(29595),o.e(16448),o.e(10442),o.e(16434),o.e(45769),o.e(46080),o.e(75902),o.e(99809),o.e(78405),o.e(33675),o.e(3165),o.e(31842),o.e(94995),o.e(77729),o.e(6626),o.e(51859),o.e(69095)]).then(o.bind(o,22039)))),i=(0,n().jQ)(r,(e=>e.FormEditorActionButtons)),l=new(n().O2)("conditionalLogicTooltip",(()=>o.e(16130).then(o.bind(o,879022)))),a=(0,n()._h)(l,(e=>e.ConditionalLogicTooltip)),s=(0,n()._h)(l,(e=>e.ConditionalLogicUpsellTooltip))},175213:(e,t,o)=>{o.d(t,{G:()=>i});var n=()=>o(314529),r=()=>o(242422);function i(e,t){(0,n().DO_NOT_USE_trackLegacy)(e,"delete_property",t),r().default.logEvent("delete_property")}},186348:(e,t,o)=>{o.d(t,{h:()=>u});o(898992),o(672577);var n=()=>o(56366),r=()=>o(401497),i=()=>o(785285),l=()=>o(898244),a=()=>o(713998),s=()=>o(254947),c=()=>o(100622),d=()=>o(534177);function u({conditionalColor:e,store:t,schema:o,viewType:c}){const d=(0,n().K8)((()=>{if(t&&null!=e&&e.background&&(0,i().IY)(e.background))return t.getPropertyValue(e.conditional_filter.property)}),[t,e]);return(0,r().IS)((t=>{if(null==e||!e.background)return{conditionalColorStyles:{background:void 0}};let n;var r;(0,i().IY)(e.background)?n=function(e){const{propertyValue:t,propertyId:o,schema:n}=e;if(!n)return;const r=n[o];if(!r)return;if(l().DD(r)){const e=a().RZ(t,r);if(!e)return;const o=a().FE(r.options??[],e);if(o)return m(o);const n=r.options??[],i=r.groups??[],l=n.find((t=>t.value===e)),c=l&&i.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(l.id)}));if(c){const e=c.color??s().ml[c.name];return e?m(e):void 0}return}if(l().P8(r)){const e=a().L3(t,r.options??[]);if(!e)return;const o=a().FE(r.options??[],e);return o?m(o):void 0}if(l().Ou(r)){const e=a().o2(t,r.options??[]);if(!e||0===e.length)return;const o=e[0];if(!o)return;const n=a().FE(r.options??[],o);return n?m(n):void 0}return}({propertyValue:d,propertyId:e.conditional_filter.property,schema:o}):n=null==e||null===(r=e.background)||void 0===r?void 0:r.color;return{conditionalColorStyles:p({blockBackgroundColor:n,theme:t,viewType:c})}}),[e,d,o,c]).conditionalColorStyles}function p({blockBackgroundColor:e,theme:t,viewType:o}){if("map"===o&&e){var n;const o=c().Ld[e];if(o&&o in t&&null!==(n=t[o])&&void 0!==n&&null!==(n=n.icon)&&void 0!==n&&n.accentPrimary)return{background:t[o].icon.accentPrimary}}return{background:e?(0,c().k5)(e,t).background:void 0}}function m(e){switch(e){case"default":return"default_background";case"gray":return"gray_background";case"brown":return"brown_background";case"orange":return"orange_background";case"yellow":return"yellow_background";case"green":return"teal_background";case"blue":return"blue_background";case"purple":return"purple_background";case"pink":return"pink_background";case"red":return"red_background";default:(0,d().HB)(e)}}},187391:(e,t,o)=>{o.d(t,{N:()=>c});o(296540);var n=()=>o(401497),r=()=>o(761940),i=()=>o(69708),l=()=>o(760217),a=()=>o(320260),s=o(474848);function c(e){const t=(0,n().IS)((e=>({icon:{width:20,height:20,color:e.icon.primary}})),[]);return(0,s.jsx)(l().A,{...e,title:(0,s.jsx)(i().sA,{...r().PQ.manageInCalendar}),icon:(0,s.jsx)(a().y,{style:t.icon})})}},198688:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);var n=o(474848);const r=function(){const e=(0,o(401497).IS)((e=>({separator:{height:14,width:1,marginInlineStart:6,marginInlineEnd:6,background:e.darkDividerColor}})),[]);return(0,n.jsx)("div",{style:e.separator})}},199734:(e,t,o)=>{o.d(t,{U:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("collectionSearch",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M0 6.35938C0 9.86719 2.85156 12.7188 6.35938 12.7188C7.66406 12.7188 8.85938 12.3203 9.85938 11.6406L13.4531 15.2344C13.6719 15.4609 13.9766 15.5625 14.2812 15.5625C14.9453 15.5625 15.4219 15.0625 15.4219 14.4141C15.4219 14.1016 15.3125 13.8125 15.1016 13.5938L11.5312 10.0156C12.2734 8.99219 12.7188 7.72656 12.7188 6.35938C12.7188 2.85156 9.86719 0 6.35938 0C2.85156 0 0 2.85156 0 6.35938ZM1.65625 6.35938C1.65625 3.76562 3.75781 1.65625 6.35938 1.65625C8.95312 1.65625 11.0625 3.76562 11.0625 6.35938C11.0625 8.95312 8.95312 11.0625 6.35938 11.0625C3.75781 11.0625 1.65625 8.95312 1.65625 6.35938Z"})})},216128:(e,t,o)=>{o.d(t,{R:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 16 16",fittedViewBox:"3.41 3.05 9.98 9.9",directional:!0,svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M4.482 3.238a.625.625 0 1 0-.884.884L7.476 8l-3.878 3.878a.625.625 0 0 0 .884.884l4.32-4.32a.625.625 0 0 0 0-.884z"}),(0,n.jsx)("path",{d:"M8.882 3.238a.625.625 0 0 0-.884.884L11.876 8l-3.878 3.878a.625.625 0 0 0 .884.884l4.32-4.32a.625.625 0 0 0 0-.884z"})]})},i=(0,o(340498).wt)("arrowChevronDoubleForwardSmall",r)},241181:(e,t,o)=>{o.d(t,{p:()=>i});var n=o(296540),r=()=>o(56366);function i({collectionStore:e,layoutModule:t}){const o=(0,r().K8)((()=>Boolean(null==e?void 0:e.getNormalizedPropertyGroups({publicPageDataFallbackEnabled:!0}))),[e]);return(0,n.useMemo)((()=>!(!t||!e)&&("properties"===t.type&&"pinned"!==t.variant&&o)),[e,o,t])}},244407:(e,t,o)=>{o.d(t,{q:()=>b});var n=o(296540),r=()=>o(56366),i=()=>o(401497),l=()=>o(8741),a=()=>o(62616),s=()=>o(340498),c=()=>o(69708),d=()=>o(908201),u=()=>o(187820),p=()=>o(859428),m=()=>o(635462),g=()=>o(852353),S=()=>o(697650),h=()=>o(673730),y=()=>o(177618),v=()=>o(745266),f=o(474848);function b(e){const{collectionViewStore:t,placement:o}=e,b=(0,d().ET)(),C=(0,c().tz)(),w=(0,r().K8)((()=>{const e=t.getParentBlockStore();return Boolean(null==e?void 0:e.hasSingleSourceAndNoLinkedCollections())}),[t]),k=(0,r().K8)((()=>b.isMultiSourceView),[b]),I=(0,r().K8)((()=>{var e;const o=null===(e=t.getParentBlockStore())||void 0===e?void 0:e.id;return!!o&&((0,m().s)(o)&&b.isInHomeWidgetStore.state)}),[b.isInHomeWidgetStore,t]),A=(0,r().K8)((()=>{if(!w)return;const e=t.getName(),o=t.getType(),n=(0,y().OO)({collectionViewName:e,collectionViewType:o});if(!o)return{tooltipFirstLine:n,tooltipSecondLine:void 0};const r=t.getFormat().description;if(r)return{tooltipFirstLine:n,tooltipSecondLine:r};const i=t.getCollectionStore();if(i){var l,a;const e=(0,S().getCollectionNameOrDefault)({intl:C,collectionStore:i});if((null===(l=i.getParentBlockStore())||void 0===l?void 0:l.id)===(null===(a=t.getParentBlockStore())||void 0===a?void 0:a.id))return{tooltipFirstLine:n,tooltipSecondLine:(0,f.jsx)(c().sA,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} Form {Form} Chart {Chart view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:g().to[o],collection:e}},"viewTab.tooltip.2")}}return{tooltipFirstLine:n,tooltipSecondLine:(0,f.jsx)(c().sA,{id:"collectionTabBar.viewTab.tooltip.default",defaultMessage:"{viewType} view",values:{viewType:g().to[o]}},"viewTab.tooltip.2")}}),[t,C,w],{useDeepEqual:!0}),T=(0,r().K8)((()=>{if(w)return;const e=t.getCollectionStore(),o=(0,S().getCollectionNameOrDefault)({intl:C,collectionStore:e}),n=t.getName(),r=t.getType()??"table",i=t.getFormat().collection_view_icon,l=t.getFormat().description,c=(0,y().OO)({collectionViewName:n,collectionViewType:r}),d=null==e?void 0:e.getIcon();return{dataSourceIcon:d?(0,f.jsx)(u().B6,{disabled:!0,bucket:"secure",store:e,icon:d,iconRecordCategory:"collection",isEmptyPage:!1,size:s().Ev.sm}):(0,a().c)({height:s().Ev.sm,width:s().Ev.sm}),dataSourceName:o,viewType:r,viewIcon:i,viewTitle:c,viewDescription:l,collectionStore:e}}),[t,C,w],{useDeepEqual:!0}),j=(0,r().K8)((()=>{var e;const o=t.getCollectionStore(),n=t.getParentBlockStore();return o&&n&&(null===(e=o.getParentBlockStore())||void 0===e?void 0:e.id)!==n.id}),[t]),M=(0,i().IS)((e=>({tooltip:I?{marginBottom:-5,marginInlineStart:8}:w?{}:{padding:"8px 10px"},tooltipSecondLine:{color:e.text.inverseSecondary},collectionViewSection:{color:e.text.inverseSecondary,marginTop:6},row:{display:"flex",alignItems:"flex-start",gap:5},viewTextContainer:{display:"flex",flexDirection:"column"},homeOffset:{marginInlineStart:-8},iconContainer:{position:"relative",display:"inline-flex"},pageLinkIndicator:{position:"absolute",bottom:-2,insetInlineEnd:-2.5,width:11,height:11,fill:"dark"===e.mode?e.background.secondary:e.text.inversePrimary,stroke:e.text.primary,strokeWidth:3,paintOrder:"stroke fill"}})),[I,w]),{render:P}=e,R=(0,n.useCallback)((e=>I?(0,f.jsx)("div",{style:M.homeOffset,children:P(e)}):P(e)),[I,P,M.homeOffset]),_=(0,n.useCallback)((e=>{if(I||k)return(0,f.jsx)(c().sA,{id:"collectionTabBar.myTasksWidget.tooltip",defaultMessage:"See all your tasks in one place"});if(A)return(0,f.jsxs)("div",{...e,style:h().Q$,children:[A.tooltipFirstLine,(0,f.jsx)("div",{style:M.tooltipSecondLine,children:A.tooltipSecondLine})]});if(T){const{dataSourceIcon:t,dataSourceName:o,viewType:n,viewIcon:r,viewTitle:i,viewDescription:a}=T;return(0,f.jsxs)("div",{...e,style:h().Q$,children:[(0,f.jsxs)("div",{style:M.row,children:[(0,f.jsxs)("div",{style:M.iconContainer,children:[t,j?(0,l().arrowDiagonalUpRightSmallIcon)(M.pageLinkIndicator):void 0]}),(0,f.jsx)("div",{children:o})]}),(0,f.jsxs)("div",{style:{...M.row,...M.collectionViewSection},children:[(0,f.jsx)(x,{}),(0,f.jsx)(v().h,{color:"light",viewType:n,viewIcon:r,size:s().Ev.sm,shouldUseNoticon:!0}),(0,f.jsxs)("div",{style:M.viewTextContainer,children:[(0,f.jsx)("div",{children:i}),a?(0,f.jsx)("div",{children:a}):void 0]})]})]})}}),[I,k,A,T,j,M.tooltipSecondLine,M.row,M.collectionViewSection,M.viewTextContainer,M.iconContainer,M.pageLinkIndicator]);return(0,f.jsx)(p().A,{placement:o??(I?"top":"bottom"),originGap:I?0:void 0,alignment:"start",delayThreshold:500,style:M.tooltip,render:R,renderTooltip:_})}function x(){const e=(0,i().IS)((()=>{const e=s().Ev.sm;return{svg:{width:e,height:e,viewBox:`0 0 ${e} ${e}`,fill:"none",marginTop:2,marginInlineStart:4},rect:{width:e,height:e},path:{stroke:"white",strokeOpacity:"0.283",strokeWidth:"1.5",strokeLinecap:"round"}}}),[]);return(0,f.jsxs)("svg",{style:e.svg,children:[(0,f.jsx)("rect",{style:e.rect}),(0,f.jsx)("path",{d:"M2.5 1V5.5C2.5 7.70914 4.29086 9.5 6.5 9.5H11",style:e.path})]})}},271084:(e,t,o)=>{o.d(t,{k:()=>r});o(581454);class n extends(()=>o(757695))().Store{getInitialState(){}waitUntilLoaded(){return this.waitUntil((()=>Boolean(this.state)))}getSortedUserIds(){return Object.entries(this.state||{}).sort((([e,t],[o,n])=>n-t)).map((([e,t])=>e))}}const r=new n;(0,o(852832).exposeDebugValue)("UserSimilarityStore",r)},279900:(e,t,o)=>{function n(e){let t,o,n;return async(...r)=>t?(n=r,o||(o=t.then((()=>(o=void 0,t=e(...n),t))),o)):(t=e(...r),t)}o.d(t,{A:()=>n})},286993:(e,t,o)=>{o.d(t,{c:()=>c});o(581454),o(296540);var n=()=>o(56366),r=()=>o(496603),i=()=>o(908201),l=()=>o(812119),a=()=>o(62856),s=o(474848);function c(e){const{isFullScreen:t,hasGroups:o,hasPartialResults:c,hasSearchQuery:d,overrideNumShimmerRows:u}=e,p=(0,i().Ks)(),m=(0,n().K8)((()=>null==p?void 0:p.isInHomeWidgetStore.state),[p]);if(!(0,a().A)(!0,0,100))return null;let g=1;void 0!==u?g=u:o||c||d||(g=t?10:3);const S=g>1?["50%","30%","40%","40%","30%","30%","40%","40%","30%","30%"]:["35%"],h=r().Hn(g).map((e=>(0,s.jsx)(l().J,{isInHomeWidget:m,widthPercentage:e<S.length?S[e]:void 0},e)));return(0,s.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",marginInlineStart:m?8:3},children:h})}},299177:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().Store{getInitialState(){return{}}}const r=new n;o(852832).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",r);const i=r},307736:(e,t,o)=>{o.d(t,{C:()=>r});var n=()=>o(941541);class r{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=({value:e,passThroughData:t})=>{let o=!0;this.didEmit||(this.didEmit=!0,o=!1),this.lastValue===e?o=!1:this.lastValue=e,o&&this.onEmit(e,t)},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=n().Ay.addListener(this.listenerEventKey,void 0,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&n().Ay.removeListener(this.listener,this.environment)}}},316369:(e,t,o)=>{o.d(t,{w:()=>k});o(581454),o(296540);var n=()=>o(726637),r=()=>o(484714),i=()=>o(56366),l=()=>o(45941),a=()=>o(30626),s=()=>o(69708),c=()=>o(496603),d=()=>o(436696),u=()=>o(896628),p=()=>o(231297),m=()=>o(722872),g=()=>o(760217),S=()=>o(406699),h=()=>o(285790),y=()=>o(404277),v=()=>o(939740),f=()=>o(417392),b=()=>o(89924),x=o(474848);function C(e){const{limit:t}=e;return(0,x.jsx)(s().sA,{defaultMessage:"{limit} pages",values:{limit:t.limit},id:"database.FirstLoadLimitSelectOption.limitPagesTitle"})}const w=(0,s().YK)({firstLoadLimitActionButtonAriaLabel:{defaultMessage:"Load limit settings menu",id:"database.firstLoadLimitActionButton.ariaLabel"}});function k({format:e,collectionContextStore:t}){const o=(0,r().v3)(),l=Boolean(n().A.isMobile),c=(0,s().tz)(),m=(0,i().K8)((()=>{var e;return(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType())??"unknown"}),[t]);return l?null:(0,x.jsx)(S().A,{popupType:f().nl.Popup,renderOrigin:e=>(0,x.jsx)(h().A,{icon:a()._,style:{marginInlineStart:4,marginInlineEnd:4},ariaLabel:c.formatMessage(w.firstLoadLimitActionButtonAriaLabel),...e}),alignmentToOrigin:"end",placementToOrigin:"bottom",originGap:8,render:n=>(0,x.jsx)(A,{currentLimit:I({format:e,viewType:m}),onAccept:e=>function(e,t,o){const n=t.collectionViewStore();if(!n)return;if(!n.getType())return;p().createAndCommit({userAction:"FirstLoadLimitActionButton.handleFirstLoadLimitAccept",environment:o,canUndo:!0,perform:t=>{u().zA({stores:[n],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),(0,d().X)({environment:o,collectionContextStore:t,action:"set_first_load_limit"})}(e,t,o),onClose:n.close,showTitle:!0})})}function I(e){const{format:t,viewType:o}=e;return(0,l().i3)({limit:t.inline_collection_first_load_limit,isGrouped:Boolean(t.collection_group_by),viewType:o})}function A(e){const t=Boolean(n().A.isMobile),{currentLimit:o,onAccept:r,onClose:i,showTitle:a}=e,d=(0,c().oE)(l().X9.map(((e,t)=>{const n={key:t,render:t=>(0,x.jsx)(g().A,{...t,disabled:!1,title:(0,x.jsx)(C,{limit:e}),isChecked:(0,c().n4)(o,e)}),action:()=>r(e)};return n}))),u=[{key:0,render:e=>(0,x.jsx)(b().A,{enableActionSheetTitle:!0,title:a&&(0,x.jsx)(s().sA,{defaultMessage:"Show on first load",id:"database.firstLoadLimitSelectMenu.firstLoadLimitSetting"}),...e}),items:d}];let p;return p=t?{menuType:m().gu.ActionSheet}:{menuType:m().gu.Popup,width:200},(0,x.jsx)(y().A,{...p,children:(0,x.jsx)(v().Ay,{type:v().Oh.Vertical,sections:u,onAccept:i,initialFocus:void 0})})}},344482:(e,t,o)=>{o.d(t,{A:()=>r});o(898992),o(672577);class n extends(()=>o(959180))().A{findTableHeaderCell(e,t){return this.find((o=>o.collectionContextStore===e&&o.property===t))}}const r=new n},350646:(e,t,o)=>{o.d(t,{k:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"1.27 3.53 17.42 12.94",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10.375 6.775c.345 0 .625.28.625.625v3.15a.625.625 0 1 1-1.25 0V7.4c0-.345.28-.625.625-.625m0 6.775a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5"}),(0,n.jsx)("path",{d:"M4.066 8.914a6.477 6.477 0 0 1 12.859 1.029 3.494 3.494 0 0 1-1.725 6.532H5.121a3.855 3.855 0 0 1-1.056-7.56m6.384-4.14a5.226 5.226 0 0 0-5.2 4.716l-.047.482-.48.075a2.605 2.605 0 0 0 .406 5.178H15.2a2.244 2.244 0 0 0 .853-4.32l-.41-.169.024-.443q.008-.146.008-.293a5.225 5.225 0 0 0-5.225-5.225"})]})},i=(0,o(340498).wt)("cloudExclamation",r)},358898:(e,t,o)=>{o.d(t,{fz:()=>a,m7:()=>r,tr:()=>l,w6:()=>i});var n=()=>o(402014);const r=32,i=Object.freeze({display:"flex",width:r,height:"100%",alignItems:"center",justifyContent:"center"});function l(e){(0,n().SQ)({event:e,context:n().y$.EditorMouseDown,callback:()=>{}})}function a(e,t){return!e&&t}},371513:(e,t,o)=>{o.d(t,{b:()=>r});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"1.62 3.62 16.75 12.75",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M16.25 3.625c1.174 0 2.125.951 2.125 2.125v8.5a2.125 2.125 0 0 1-2.125 2.125H3.75a2.125 2.125 0 0 1-2.125-2.125v-8.5c0-1.174.951-2.125 2.125-2.125zm-12.5 1.25a.875.875 0 0 0-.875.875v8.5c0 .483.392.875.875.875h2.7V4.875zm3.8 10.25h8.7a.875.875 0 0 0 .875-.875v-8.5a.875.875 0 0 0-.875-.875h-8.7z"})},r=(0,o(340498).wt)("sidebarLeft",n)},372267:(e,t,o)=>{o.d(t,{NK:()=>h,cO:()=>b,nq:()=>g,o6:()=>f,uM:()=>y});o(898992),o(354520),o(672577);var n=()=>o(242422),r=()=>o(584262),i=()=>o(726317),l=()=>o(416504),a=()=>o(496603),s=()=>o(468882),c=()=>o(177618),d=()=>o(909470),u=()=>o(492414),p=()=>o(972435),m=()=>o(765957);function g(e){return{display:"flex",flexGrow:1,textDecoration:"none",overflow:"hidden",borderRadius:6,..."single"===e?{height:30}:{minHeight:30}}}function S(e,t){return(0,s().B2)(t[e])}function h(e){const{environment:t,store:o,collectionContextStore:n}=e,{mainEditorCurrentBlockStore:r}=m().default.state;return c().wy({environment:t,store:o,mainEditorCurrentBlockStore:r,collectionContextStore:n,fullyQualified:!1})}function y(e){return(0,u().Ay)({store:e,fullyQualified:!1,pageVisitSource:r().y8.LinkInPage})}function v(e,t,o,r,a,s){return t.isDefined()?r.filter((r=>{const c="title"!==r&&a;return!i().r({property:r,schema:o,block:t.getModel(),getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,l().P)(),intl:p().A.getIntl(),experimentService:n().default,collectionFeatureGates:(0,d().i)(),formulasModule:s,spaceIdCreator:e.idCreator.getSpaceIdCreatorSync(t.getModel().space_id)})||c})):[]}function f(e,t,o,n,r,i,l){const s=t.state,c=s.isOpen?s.property:"title",d=v(e,o,n,r,i,l),u=d.findIndex((e=>e===c)),p=a().Uk(d,((e,t)=>t<u&&S(e,n)));return p||(i?"title":function(e,t){return a().Uk(e,(e=>S(e,t)))}(d,n))}function b(e,t,o,n,r,i,l){const a=t.state,s=a.isOpen?a.property:"title",c=v(e,o,n,r,i,l),d=c.findIndex((e=>e===s)),u=c.find(((e,t)=>t>d&&S(e,n)));return u||(i?"title":function(e,t){return e.find((e=>S(e,t)))}(c,n))}},389657:(e,t,o)=>{o.d(t,{A:()=>E});var n=o(296540),r=()=>o(484714),i=()=>o(56366),l=()=>o(401497),a=()=>o(718827),s=()=>o(252291),c=()=>o(30537),d=()=>o(471095),u=()=>o(701751),p=o(474848);const m={viewBox:"0 0 20 20",fittedViewBox:"3.97 1.95 14.91 15.65",svg:(0,p.jsx)("path",{d:"M11.92 5.43a3.48 3.48 0 0 1 6.96 0v2.095a.625.625 0 1 1-1.25 0V5.43a2.23 2.23 0 1 0-4.46 0v1.92h.43a2.425 2.425 0 0 1 2.425 2.425v5.4A2.425 2.425 0 0 1 13.6 17.6H6.4a2.425 2.425 0 0 1-2.425-2.425v-5.4A2.425 2.425 0 0 1 6.4 7.35h5.52zm-1.357 7.373a1.35 1.35 0 1 0-1.126 0v1.247a.563.563 0 0 0 1.126 0z"})},g=(0,o(340498).wt)("lockOpenFill",m);var S=()=>o(105819),h=()=>o(798880),y=()=>o(695608),v=()=>o(69708),f=()=>o(314529);function b(e,t){(0,f().DO_NOT_USE_trackLegacy)(e,"edit_lock_toggle",t)}var x=()=>o(896628),C=()=>o(231297),w=()=>o(544198),k=()=>o(722872),I=()=>o(455425),A=()=>o(712505),T=()=>o(870092),j=()=>o(575143),M=()=>o(406699),P=()=>o(404277),R=()=>o(939740),_=()=>o(89924),B=()=>o(859428),V=()=>o(198688);const E=function({store:e,disableTooltip:t,hideText:o,isInlineCollection:n,buttonStyle:i}){const{isMobile:l}=(0,r().Y0)();return l?(0,p.jsx)(W,{store:e,hideText:o}):(0,p.jsx)(H,{store:e,disableTooltip:t,hideText:o,isMobile:l,isInlineCollection:n,buttonStyle:i})};function F(e,t,o){return{display:"flex",alignItems:"center",whiteSpace:"nowrap",gap:4,fontSize:e?12:14,borderRadius:4,padding:"0 6px",marginInlineEnd:2,height:24,marginTop:e?1:0,marginInlineStart:e?0:-5,...t&&{marginInlineStart:e?8:12,marginInlineEnd:0},...o}}function O(e,t,o,n,r){return{...F(e,n,r),color:o.text.tertiary,fill:o.icon.tertiary}}function D(e,t,o,n,r){return{...F(e,n,r),paddingInlineStart:5,border:`1px solid ${o.blue.border.accentPrimary}`,color:o.blue.text.accentPrimary,fill:o.blue.icon.accentPrimary}}function L({store:e}){const t=(0,l().DP)(),o=(0,i().K8)((()=>e.getFormat().block_locked_by),[e]),n=(0,v().tz)(),r=(0,i().K8)((()=>o&&(0,y().c6)(n,T().L.createChildStore(e,{table:h().oo,id:o}).getModel())),[o,n,e]);return o?(0,p.jsx)("div",{children:(0,p.jsx)(v().sA,{defaultMessage:"Locked by {lockedByPerson}{br}to prevent accidental editing.{br}<prompttext>Click to unlock</prompttext>",id:"pageLockIndicator.lockedTooltip",values:{lockedByPerson:(0,p.jsx)("b",{children:r}),br:(0,p.jsx)("br",{}),prompttext:e=>(0,p.jsx)("span",{style:{color:t.text.inverseSecondary},children:e})}})}):null}function z(e,t){I().$.relockBlock({userId:t.userId,blockId:t.id});const o=t.getType();if(o){const{collectionId:n,ownedCollectionCount:r,linkedCollectionCount:i}=(0,w().P)(t,{skipPages:!0});b(e,{from:"topbar",block_type:o,locked:!0,collection_id:n,owned_collection_count:r,linked_collection_count:i})}}function K({store:e,close:t}){const o=(0,r().v3)(),i=(0,n.useCallback)((()=>{!function(e,t){I().$.temporarilyUnlockBlock({userId:t.userId,blockId:t.id});const o=t.getType();if(o){const{collectionId:n,ownedCollectionCount:r,linkedCollectionCount:i}=(0,w().P)(t,{skipPages:!0});b(e,{from:"topbar",block_type:o,locked:!1,collection_id:n,owned_collection_count:r,linked_collection_count:i})}}(o,e),t()}),[o,e,t]),l=(0,n.useCallback)((()=>{!function(e,t){C().createAndCommit({userAction:"PageLockTopbarIndicator.handlePermanentUnlockClick",environment:e,canUndo:!0,perform:o=>{x()._l({environment:e,store:t,isLocked:!1,transaction:o})}});const o=t.getType();if(o){const{collectionId:n,ownedCollectionCount:r,linkedCollectionCount:i}=(0,w().P)(t,{skipPages:!0});b(e,{from:"topbar",block_type:o,locked:!1,collection_id:n,owned_collection_count:r,linked_collection_count:i})}}(o,e),t()}),[o,e,t]),a=[{key:"temp_unlock",render:e=>(0,p.jsx)(j().A,{...e,svg:S().pencilLineIcon,title:(0,p.jsx)(v().sA,{defaultMessage:"Unlock for me",id:"pageLockIndicator.temporaryUnlockOption.label"})}),action:()=>{i()}},{key:"perm_unlock",render:e=>(0,p.jsx)(j().A,{...e,svg:u().p,title:(0,p.jsx)(v().sA,{defaultMessage:"Unlock for everyone",id:"pageLockIndicator.permanentUnlockOption.label"})}),action:()=>{l()}}];return(0,p.jsx)(P().A,{menuType:k().gu.Popup,children:(0,p.jsx)(R().Ay,{type:R().Oh.Vertical,onAccept:t,sections:[{key:"unlock_options",render:e=>(0,p.jsx)(_().A,{...e}),items:a}],initialFocus:void 0})})}function H({store:e,disableTooltip:t,hideText:o,isMobile:u,isInlineCollection:m,buttonStyle:S}){const h=(0,l().DP)(),y=(0,r().v3)(),f=(0,n.useCallback)((()=>z(y,e)),[y,e]),b=(0,i().K8)((()=>e.isLockedForAllUsers()),[e]),x=(0,i().K8)((()=>I().$.isTemporarilyUnlocked({userId:e.userId,blockId:e.id})),[e.id,e.userId]),C=(0,i().K8)((()=>A().default.state.open&&A().default.state.targetStore.id===e.id),[e.id]);return b?x?(0,p.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[C?(0,p.jsx)(V().A,{}):void 0,(0,p.jsxs)(a().Ay,{style:D(u,0,h,m,S),onClick:f,hoveredStyle:{background:h.outlineBlueButtonHoveredBackground},pressedStyle:{background:h.outlineBlueButtonPressedBackground},children:[(0,p.jsx)(s().I,{icon:g}),o?void 0:(0,p.jsx)("div",{style:{lineHeight:1},children:(0,p.jsx)(v().sA,{defaultMessage:"Re-lock",id:"pageLockIndicator.relockButton.label"})})]})]}):(0,p.jsx)(B().A,{renderTooltip:()=>(0,p.jsx)(L,{store:e}),disableTooltip:t,render:t=>(0,p.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[C?(0,p.jsx)(V().A,{}):void 0,(0,p.jsx)(M().A,{popupType:c().n.Popup,renderOrigin:({onClick:e})=>(0,p.jsxs)(a().Ay,{style:O(u,0,h,m,S),onClick:e,...t,children:[(0,p.jsx)(s().I,{icon:d().i}),o?void 0:(0,p.jsx)("div",{style:{lineHeight:1},children:(0,p.jsx)(v().sA,{defaultMessage:"Locked",id:"pageLockIndicator.lockedButton.label"})})]}),render:({close:t})=>(0,p.jsx)(K,{store:e,close:t})})]})}):null}function W({store:e,hideText:t}){const o=(0,l().DP)(),u=(0,r().v3)(),m=(0,n.useCallback)((()=>z(u,e)),[u,e]),S=(0,i().K8)((()=>e.isLockedForAllUsers()),[e]),h=(0,i().K8)((()=>I().$.isTemporarilyUnlocked({userId:e.userId,blockId:e.id})),[e.id,e.userId]),{WindowSizeStore:y}=u,f=(0,i().K8)((()=>y.getSafePaddingLeftCSS(10)),[y]),b=(0,i().K8)((()=>y.getSafePaddingRightCSS(14)),[y]);return S?h?(0,p.jsxs)(a().Ay,{onClick:m,style:{display:"flex",alignItems:"center",width:"100%",height:"100%",gap:6,paddingInlineStart:f,paddingInlineEnd:b,color:o.blue.text.accentPrimary,fill:o.blue.icon.accentPrimary},children:[(0,p.jsx)(s().I,{icon:g}),t?void 0:(0,p.jsx)("div",{children:(0,p.jsx)(v().sA,{defaultMessage:"Re-lock",id:"pageLockIndicator.mobileRelockButton.label"})})]}):(0,p.jsx)(M().A,{popupType:c().n.Popup,renderOrigin:({onClick:e})=>(0,p.jsxs)(a().Ay,{onClick:e,style:{display:"flex",alignItems:"center",gap:6,height:"100%",paddingInlineStart:f,paddingInlineEnd:b},children:[(0,p.jsx)(s().I,{icon:d().i}),t?void 0:(0,p.jsx)("div",{children:(0,p.jsx)(v().sA,{defaultMessage:"Locked",id:"pageLockIndicator.mobileLockedButton.label"})})]}),render:({close:t})=>(0,p.jsx)(K,{store:e,close:t})}):null}},391381:(e,t,o)=>{o.d(t,{x:()=>c});var n=()=>o(962845),r=()=>o(792002),i=()=>o(693202),l=()=>o(778417),a=()=>o(699847),s=()=>o(72159);function c(e){var t;(0,a().l)();const{environment:o,store:c,canSelectAllBlocks:d}=e,u=(0,r().s6)(c),p={startIndex:0,endIndex:u?u.endIndex:0};d&&"empty"!==i().default.state.mode&&(0,r().GZ)(null===(t=(0,n().cR)("textSelectionActions",i().default.state.multiSelection))||void 0===t?void 0:t.selection,p)?l().Ub(o):(0,s().t)({store:c,selection:p})}},395546:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>r,infoCircleSmallIcon:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 16 16",fittedViewBox:"1.87 1.87 12.25 12.25",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M7.9 4.425a.775.775 0 1 0 0 1.55.775.775 0 0 0 0-1.55M6.95 6.5a.625.625 0 1 0 0 1.25h.425V10H6.95a.625.625 0 1 0 0 1.25h2.1a.625.625 0 1 0 0-1.25h-.425V7.125A.625.625 0 0 0 8 6.5z"}),(0,n.jsx)("path",{d:"M8 1.875a6.125 6.125 0 1 0 0 12.25 6.125 6.125 0 0 0 0-12.25M3.125 8a4.875 4.875 0 1 1 9.75 0 4.875 4.875 0 0 1-9.75 0"})]})},i=(0,o(340498).wt)("infoCircleSmall",r)},403733:(e,t,o)=>{o.r(t),o.d(t,{arrowStraightDownSmallIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"3.05 2.12 9.9 11.76",svg:(0,o(474848).jsx)("path",{d:"M8 2.125a.61.61 0 0 0-.625.599v9.017L4.122 8.488a.625.625 0 1 0-.884.884l4.32 4.32c.244.244.64.244.884 0l4.32-4.32a.625.625 0 0 0-.884-.884l-3.253 3.253V2.724A.61.61 0 0 0 8 2.125"})},r=(0,o(340498).wt)("arrowStraightDownSmall",n)},424139:(e,t,o)=>{o.r(t),o.d(t,{emojiFaceIcon:()=>i,iconDefinition:()=>r});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.25 15.26",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M8.045 11.706a.625.625 0 0 0-1.036.698A3.6 3.6 0 0 0 10.005 14c1.245 0 2.35-.637 2.996-1.596a.625.625 0 0 0-1.036-.698 2.37 2.37 0 0 1-1.96 1.044 2.36 2.36 0 0 1-1.96-1.044m-.68-2.041c.49 0 .88-.46.88-1.02s-.39-1.02-.88-1.02-.88.46-.88 1.02.39 1.02.88 1.02m6.15-1.02c0 .56-.39 1.02-.88 1.02s-.88-.46-.88-1.02.39-1.02.88-1.02.88.46.88 1.02"}),(0,n.jsx)("path",{d:"M10 2.375a7.625 7.625 0 1 0 0 15.25 7.625 7.625 0 0 0 0-15.25M3.625 10a6.375 6.375 0 1 1 12.75 0 6.375 6.375 0 0 1-12.75 0"})]})},i=(0,o(340498).wt)("emojiFace",r)},457688:(e,t,o)=>{o.d(t,{A:()=>f,S:()=>y});var n=o(296540),r=()=>o(726637),i=()=>o(484714),l=()=>o(56366),a=()=>o(493552),s=()=>o(764880),c=()=>o(69708),d=()=>o(678553),u=()=>o(453697),p=o(474848);const m="Body/Regular",g="Body/Semibold",S="Body-sm/Regular",h=n.forwardRef(((e,t)=>{const{actor:n,defaultUserTitle:i="name_only",useEmailAsTooltip:a,tooltip:c,tooltipPlacement:m,hoveredStyle:g,disabledFeedback:S,customUserTitleStyles:h,iconSizeOverride:f}=e,b=(0,l().K8)((()=>n.asActor&&n.isUser()?n.email:void 0),[n]),x=a&&b?b:c,C=f||(r().A.isMobile?d().nd:d().pg),w="name_and_email"===i||"name_and_email_unless_right"===i&&!Boolean(e.right)?(0,p.jsx)(v,{actor:null==n?void 0:n.asActor,customStyles:h}):(0,p.jsx)(y,{customStyles:h,actor:null==n?void 0:n.asActor});let k;return(0,s().H3)(n)?k=(0,p.jsx)(o(256863).A,{botValue:null==n?void 0:n.asActor,size:C}):(0,s().ps)(n)?k=(0,p.jsx)(u().A,{userValue:null==n?void 0:n.asActor,size:C}):(0,s().h2)(n)?k=(0,p.jsx)(u().A,{userValue:void 0,size:C}):(0,o(534177).HB)(n),(0,p.jsx)(o(859428).A,{placement:m??"bottom",alignment:"start",textWrap:!0,render:n=>(0,p.jsx)(o(760217).A,{...(0,o(553965).A)(n,e),icon:k,title:w,disabledFeedback:S,className:"notranslate",ref:t,hoveredStyle:g}),disableTooltip:!x,renderTooltip:()=>x})}));function y(e){const{actor:t,customStyles:o}=e,n=(0,i().v3)(),s=(0,c().tz)(),d=t&&t.id===n.currentUser.id,u=(0,l().K8)((()=>t&&t.getDisplayName(s)),[t,s]),g=r().A.isMobile?S:m;return d?(0,p.jsx)(c().sA,{id:"UserMenuItem.fullName.authorLabel",defaultMessage:"<author>{fullName}</author> <you>(You)</you>",values:{author:e=>(0,p.jsx)(a().D,{as:"span",styleKey:g,style:o,children:e}),fullName:u,you:e=>(0,p.jsx)(a().D,{as:"span",colorVariant:"secondary",styleKey:g,style:o,children:e})}}):u?(0,p.jsx)(a().D,{textOverflow:"ellipsis",styleKey:g,style:o,children:u}):(0,p.jsx)(a().D,{styleKey:g,style:o,children:(0,p.jsx)(c().sA,{id:"UserMenuItem.fullName.unknownAuthorLabel",defaultMessage:"Unknown author"})})}function v(e){const{actor:t,customStyles:o}=e,n=(0,c().tz)(),i=(0,l().K8)((()=>t&&t.getDisplayName(n)),[t,n]),{email:s,showEmail:d}=(0,l().K8)((()=>{const e=t&&t.asActor&&t.isUser()?t.email:void 0;return{email:e,showEmail:i!==e}}),[t,i]),u=r().A.isMobile?"Body-sm/Regular":g,h=r().A.isMobile?S:m;return i?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(a().D,{textOverflow:"ellipsis",as:"span",styleKey:u,style:o,children:i}),d?(0,p.jsx)(a().D,{textOverflow:"ellipsis",as:"span",styleKey:h,style:o,children:` ${s}`}):void 0]}):(0,p.jsx)(a().D,{styleKey:g,style:o,children:(0,p.jsx)(c().sA,{id:"UserMenuItem.fullName.unknownAuthorLabel",defaultMessage:"Unknown author"})})}h.displayName="UserMenuItem";const f=h},478834:(e,t,o)=>{o.d(t,{y:()=>r});class n extends(()=>o(757695))().Store{getInitialState(){return{}}requestOpenExternalSyncSettings(e,t){this.setState({pendingOpenSource:e,pendingOpenFrom:t})}clearPendingOpen(){this.setState({pendingOpenSource:void 0,pendingOpenFrom:void 0})}}const r=new n},481975:(e,t,o)=>{o.d(t,{s:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"4.77 3.05 5.58 9.9",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M10.162 3.238a.625.625 0 0 0-.884 0l-4.32 4.32a.625.625 0 0 0 0 .884l4.32 4.32a.625.625 0 1 0 .884-.884L6.284 8l3.878-3.878a.625.625 0 0 0 0-.884"})},r=(0,o(340498).wt)("arrowChevronSingleLeftSmall",n)},499872:(e,t,o)=>{o.d(t,{b:()=>r});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"4.75 3.52 11.53 12.95",svg:(0,o(474848).jsx)("path",{d:"m7.006 16.267 8.523-4.971a1.5 1.5 0 0 0 0-2.592L7.006 3.733A1.5 1.5 0 0 0 4.75 5.028v9.944a1.5 1.5 0 0 0 2.256 1.295"})},r=(0,o(340498).wt)("mediaPlayFill",n)},500733:(e,t,o)=>{o.d(t,{I:()=>l});o(581454);var n=()=>o(496603),r=()=>o(231297),i=()=>o(654062);function l(e){const{collectionContextStore:t,environment:o,query:l,property:a,newAggregation:s}=e,c=t.collectionViewStore();if(!c)return;let d=l.aggregations?[...l.aggregations]:[];const u=(l.aggregations||[]).findIndex((e=>e.property===a));d=u<0?n().oE([...d,s]):n().oE(d.map(((e,t)=>u===t?s:e)));const p={...l,aggregations:d};!t.isClientModeEnabledStore.state&&s&&t.asyncAggregationStatusStore.setState({calculating:!0,aggregation:s,changingType:!0}),r().createAndCommit({userAction:"TableAggregationRow.handleTableAggregationChange",environment:o,canUndo:!0,perform:e=>{(0,i().F)({collectionViewStore:c,update:{query2:p},transaction:e})}})}},505776:(e,t,o)=>{o.d(t,{A:()=>r});class n extends(()=>o(757695))().Store{constructor(...e){super(...e),this.updatePreviewState=e=>{this.update((t=>({...t,previewCanvasState:e(t.previewCanvasState)})))}}getInitialState(){return{chart:void 0,responsiveChartOptions:void 0,previewCanvasState:void 0,exportBackgroundColor:"gradient"}}}const r=n},508390:(e,t,o)=>{o.d(t,{LA:()=>k,jJ:()=>I});o(296540);var n=()=>o(484714),r=()=>o(56366),i=()=>o(401497),l=()=>o(718827),a=()=>o(98126),s=()=>o(584262),c=()=>o(403733),d=()=>o(340498),u=()=>o(69708),p=()=>o(124311),m=()=>o(857783),g=()=>o(778417),S=()=>o(316369),h=()=>o(152077),y=()=>o(635462),v=()=>o(325383),f=()=>o(888643),b=()=>o(519200),x=()=>o(540355),C=o(474848);const w=30,k=33;function I(e){const{style:t,iconStyle:o,store:k,format:I,collectionContextStore:A,groupsPointer:T,incrementLimitsInRelatedGroups:j,isFullScreen:M}=e,P=(0,n().v3)(),R=(0,r().K8)((()=>A.groupsStore.getGroupState(T)),[A,T]),_=(0,r().K8)((()=>(0,v().Kk)({collectionContextStore:A,groupsPointer:T})),[A,T]),B=(0,r().O$)(A.isInHomeWidgetStore),V=(0,h().lU)(),E="PersonalHome"===V||"TeamHome"===V,F=(0,i().IS)((e=>({homeContainer:{display:"flex",alignItems:"center",justifyContent:"center"},button:{display:"flex",alignItems:"center",justifyContent:"center",height:w,borderRadius:6,whiteSpace:"break-spaces",fontSize:14,...B?{textAlign:"center",width:"fit-content",marginInlineStart:12,marginBottom:0,padding:4}:{},...t},loadingContainer:{marginTop:1,marginInlineStart:8,marginInlineEnd:8},icon:{width:d().Ev.sm,height:d().Ev.sm,marginInlineEnd:6,fill:e.icon.tertiary,...o},text:{color:e.text.tertiary,width:"100%",fontSize:B?14:void 0},hoveredStyle:{..._?{background:e.whiteButtonBackground}:{background:e.tableRowHoveredBackground}}})),[B,t,o,_]),O=(0,r().K8)((()=>k.canEdit()),[k]);return R?B||E?(0,C.jsx)("div",{style:F.homeContainer,children:(0,C.jsx)(l().Ay,{onClick:e=>function(e,t,o){const n=e.metaKey||e.ctrlKey?"tab":void 0,r=(0,y().s)(o.id)?s().y8.PersonalHomeTileTasks:s().y8.PersonalHomeTileCustomDb;m().uK({environment:t,store:o,pageVisitSource:r,openInNew:n})}(e,P,k),onMouseDown:b().t,style:F.button,children:(0,C.jsx)("div",{style:F.text,children:(0,C.jsx)(u().sA,{id:"database.viewAllButtonTitle",defaultMessage:"View all"})})})}):(0,C.jsxs)(l().Ay,{onClick:e=>function(e,t,o,n,r,i){const l=o.groupsStore.getGroupState(n);if(!l)return;const a=l.reducerResultStore.state;(0,f().k)(e),g().IU({environment:t}),a&&(0,x().H)({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:i,currentResultCount:a.blockIds.length,groupsPointer:l.groupsPointer,incrementLimitsInRelatedGroups:r}});(0,p().K)(t)}(e,P,A,T,j,M),onMouseDown:b().t,disabled:_,hoveredStyle:F.hoveredStyle,style:F.button,children:[(0,c().arrowStraightDownSmallIcon)(F.icon),(0,C.jsx)("div",{style:F.text,children:(0,C.jsx)(u().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),_?(0,C.jsx)("div",{style:F.loadingContainer,children:(0,C.jsx)(a().A,{size:"sm"})}):O&&(0,C.jsx)(S().w,{collectionContextStore:A,format:I})]}):null}},513402:(e,t,o)=>{o.r(t),o.d(t,{arrowUpDownSmallIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"1.67 2.48 12.66 11.03",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M11.349 2.672a.625.625 0 0 0-.884 0L7.666 5.471a.625.625 0 1 0 .884.883l1.732-1.73v8.262a.625.625 0 1 0 1.25 0V4.623l1.73 1.731a.625.625 0 0 0 .885-.883zM5.093 2.49a.625.625 0 0 0-.625.624v8.263l-1.73-1.731a.625.625 0 1 0-.885.883l2.798 2.799c.244.244.64.244.884 0l2.798-2.798a.625.625 0 0 0-.883-.884l-1.732 1.73V3.115a.625.625 0 0 0-.625-.625"})},r=(0,o(340498).wt)("arrowUpDownSmall",n)},517288:(e,t,o)=>{o.d(t,{O:()=>c});var n=()=>o(383594),r=()=>o(972435),i=()=>o(486666),l=()=>o(129522),a=()=>o(116008),s=()=>o(441467);function c(e){const{environment:t,blockStore:o,rect:c,skipOpeningDiscussionOnSubmit:d,formulasModule:u}=e,p=c??l().K.getRect(o);if(!p)return;const m=p.width,g=p.height,S=p.right-m;a().A.setState({open:!0,rect:new DOMRect(S,p.top,m,g),type:"block",content:"reaction",blockStore:o,blockId:o.id,emoji:void 0}),n().W(t,{originGap:4,originRect:p,popupWidth:i().jv,popupHeight:i().GF,isSmallWidth:!1,title:r().A.formatMessage(s().DZ.emojiPicker),currentTab:"emoji",onCancel:()=>a().A.reset(),tabs:[{type:"emoji",title:r().A.formatMessage(s().DZ.emojiTitle),hideRandomButton:!0,onChange:e=>{const o=a().A.state;o.open&&"reaction"===o.content&&(a().A.setState({...o,emoji:e}),(0,s().i5)({environment:t,skipOpeningDiscussion:d,formulasModule:u}),n().I())}}]})}},527580:(e,t,o)=>{o.d(t,{TK:()=>a,YC:()=>l,ui:()=>i});var n=()=>o(645873);const r={pageVerification:new(n().O2)("pageVerification",(()=>Promise.all([o.e(55753),o.e(91598),o.e(48046),o.e(61505),o.e(50775),o.e(94891)]).then(o.bind(o,80826)))),pageVerificationBadge:new(n().O2)("pageVerificationBadge",(()=>Promise.all([o.e(55162),o.e(71003),o.e(55753),o.e(28866),o.e(74562),o.e(47160),o.e(91598),o.e(48046),o.e(42056),o.e(76677),o.e(43223),o.e(15517),o.e(61505),o.e(94300),o.e(50775),o.e(79421),o.e(41412)]).then(o.bind(o,422283)))),pageVerificationMenuRenderer:new(n().O2)("pageVerificationMenuRenderer",(()=>Promise.all([o.e(55162),o.e(71003),o.e(55753),o.e(28866),o.e(74562),o.e(47160),o.e(91598),o.e(48046),o.e(42056),o.e(76677),o.e(43223),o.e(15517),o.e(61505),o.e(94300),o.e(50775),o.e(79421),o.e(26207)]).then(o.bind(o,196770))))},i=(0,n()._h)(r.pageVerification,(e=>e.PageAddVerificationButton)),l=(0,n()._h)(r.pageVerificationBadge,(e=>e.PageVerificationBadge)),a=(0,n()._h)(r.pageVerificationMenuRenderer,(e=>e.PageVerificationMenuRenderer))},540355:(e,t,o)=>{o.d(t,{H:()=>r});var n=()=>o(314529);function r(e){const{collectionContextStore:t,environment:o,incrementLimitArgs:r}=e;t.groupsStore.incrementLimit(e.incrementLimitArgs),t.loadingDetailsStore.setState({type:"load_more_blocks",group:r.groupsPointer}),(0,n().DO_NOT_USE_trackLegacy)(o,"collection_load_more_blocks")}},556148:(e,t,o)=>{o.d(t,{$u:()=>p,Dp:()=>s,Gd:()=>c,Hh:()=>h,Hl:()=>d,RT:()=>m,Xw:()=>S,Yg:()=>g,yA:()=>u});o(898992),o(672577),o(581454);var n=()=>o(177618),r=()=>o(38337),i=()=>o(405417),l=()=>o(695625),a=()=>o(236030);let s=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down",e}({});function c(e,t){const o=t.permissionScopesStore.state;return!e&&o.canEditContent}function d(e,t){let o=e;for(;null!==o;){if(o.classList.contains(t))return o;o=o.parentElement}}function u(e,t){const o=t?[t]:[];return(0,i().v2)(o[0],e)}function p(e){return(0,n().f5)({collectionContextStore:e})?a().Fh:0}function m(e){let t=e;for(;null!==t&&!t.classList.contains(r().WvK);)t=t.parentElement;if(null===t)return;return{col:parseInt(t.getAttribute("data-col-index")??"0"),row:parseInt(t.getAttribute("data-row-index")??"0")}}function g(e,t,o,n){return{col:o.findIndex((e=>e.property===t)),row:n.findIndex((t=>e===t))}}function S(e,t){if(!t)return;const o=l().T.findSelectablesFromStore(e).map((e=>e.getNode())).find((e=>t.contains(e)));return o?o.getBoundingClientRect():void 0}function h(e){const t=e.state;return!t.isOpen||0===t.additionalStores.length}},556402:(e,t,o)=>{o.d(t,{i:()=>r});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.37 3.62 15.25 14",svg:(0,o(474848).jsx)("path",{d:"M2.375 5.75c0-1.174.951-2.125 2.125-2.125h11c1.174 0 2.125.951 2.125 2.125v7.5a2.125 2.125 0 0 1-2.125 2.125H12v1h1.5a.625.625 0 1 1 0 1.25h-7a.625.625 0 1 1 0-1.25H8v-1H4.5a2.125 2.125 0 0 1-2.125-2.125zM4.5 4.875a.875.875 0 0 0-.875.875v7.5c0 .483.392.875.875.875h11a.875.875 0 0 0 .875-.875v-7.5a.875.875 0 0 0-.875-.875z"})},r=(0,o(340498).wt)("display",n)},566910:(e,t,o)=>{o.d(t,{e:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"0.97 2.72 18.06 14.56",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M3.893 2.875a.626.626 0 0 1 .79-.02l.092.088.126.146.016.035.072.105 11.273 13.15a.624.624 0 0 1-1.036.678l-1.615-1.884c-1.12.408-2.339.633-3.611.633-3.757 0-7.049-1.946-8.707-4.843l-.155-.283a1.46 1.46 0 0 1 0-1.359l.155-.283c.89-1.554 2.249-2.835 3.898-3.688L3.826 3.757l-.072-.105a.626.626 0 0 1 .14-.777M6.031 6.33c-1.564.744-2.842 1.913-3.653 3.33l-.134.243a.21.21 0 0 0 0 .197l.134.243c1.426 2.49 4.292 4.214 7.622 4.214.958 0 1.877-.144 2.734-.406l-1.1-1.284a3.3 3.3 0 0 1-1.634.438l-.17-.004a3.307 3.307 0 0 1-3.132-3.133l-.004-.17c0-.777.269-1.492.718-2.056zm2.904 3.387q-.037.135-.038.281a1.104 1.104 0 0 0 1.218 1.097zM10 4.194c3.878 0 7.26 2.075 8.862 5.127l.074.164c.125.332.125.7 0 1.032l-.074.163a9.3 9.3 0 0 1-2.987 3.327l-.82-.955c1.15-.764 2.084-1.779 2.7-2.953l.02-.048a.2.2 0 0 0 0-.1l-.02-.049C16.382 7.282 13.438 5.445 10 5.445q-.705 0-1.378.1l-.94-1.098A10.7 10.7 0 0 1 10 4.194"}),(0,n.jsx)("path",{d:"M10.17 6.694a3.307 3.307 0 0 1 3.136 3.303l-.005.17a3.3 3.3 0 0 1-.116.702L9.624 6.713A3 3 0 0 1 10 6.691z"})]})},i=(0,o(340498).wt)("eyeSlash",r)},569397:(e,t,o)=>{o.r(t),o.d(t,{arrowStraightRightSmallIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"2.12 3.05 11.76 9.9",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M9.372 3.238a.625.625 0 1 0-.884.884l3.253 3.253H2.75a.625.625 0 0 0 0 1.25h8.991l-3.253 3.253a.625.625 0 0 0 .884.884l4.32-4.32a.625.625 0 0 0 0-.884z"})},r=(0,o(340498).wt)("arrowStraightRightSmall",n)},588047:(e,t,o)=>{o.d(t,{k:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"2.42 2.11 11.16 12.13",svg:(0,o(474848).jsx)("path",{d:"M8 2.115c-.854 0-1.569.554-1.824 1.315a3.96 3.96 0 0 0-2.138 3.518v.895c0 .655-.238 1.287-.669 1.78l-.616.704c-.75.858-.141 2.202 1 2.202H5.89a2.156 2.156 0 0 0 4.218 0h2.139c1.14 0 1.75-1.344.999-2.202l-.616-.704a2.7 2.7 0 0 1-.669-1.78v-.895A3.96 3.96 0 0 0 9.824 3.43 1.92 1.92 0 0 0 8 2.115m-.669 1.839A.68.68 0 0 1 8 3.365c.34 0 .623.253.669.589l.048.353.33.138a2.71 2.71 0 0 1 1.665 2.503v.895c0 .958.348 1.882.978 2.603l.616.704a.078.078 0 0 1-.058.129H3.752a.078.078 0 0 1-.058-.129l.616-.704c.63-.72.978-1.645.978-2.603v-.895c0-1.126.686-2.093 1.665-2.503l.33-.138zM8 13.084c-.394 0-.735-.226-.9-.555h1.8c-.165.33-.506.556-.9.556"})},r=(0,o(340498).wt)("bellSmall",n)},598900:(e,t,o)=>{o.d(t,{f:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"3.62 1.34 8.75 12.93",svg:(0,o(474848).jsx)("path",{d:"M9.332 1.38a.575.575 0 0 0-.662.204l-4.936 6.84a.575.575 0 0 0 .466.911h2.398l-.315 4.32a.575.575 0 0 0 1.039.378l4.944-6.832a.575.575 0 0 0-.466-.912H9.401l.309-4.328a.575.575 0 0 0-.378-.582M7.216 8.185H5.324l3.095-4.289-.209 2.927a.575.575 0 0 0 .574.616h1.89l-3.097 4.28.212-2.917a.575.575 0 0 0-.573-.617"})},r=(0,o(340498).wt)("lightningSmall",n)},615927:(e,t,o)=>{o.d(t,{Ay:()=>d,P6:()=>c,l1:()=>s});o(296540);var n=()=>o(401497),r=()=>o(718827),i=()=>o(406094),l=()=>o(284371),a=o(474848);const s=16;function c(e){const t=(0,n().IS)((()=>({button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[]);return(0,a.jsx)(r().Ay,{style:t.button,onClick:e.onClick,children:e.children})}const d=function(e){const{title:t,description:o,icon:r,style:c,titleStyle:d,buttonText:u,buttonOnClick:p,buttonIcon:m,secondaryButtonText:g,secondaryButtonOnClick:S}=e,h=(0,n().IS)((e=>({wrapper:{minHeight:250,height:1,display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"center",padding:s,...c},title:{fontSize:17,fontWeight:l().Wy.medium,color:e.text.tertiary,textAlign:"center",marginBottom:-2,...d},description:{margin:"0 auto",textAlign:"center",fontSize:14,color:e.text.tertiary},button:{marginTop:12,fontSize:14,fontWeight:l().Wy.medium,color:e.text.primary}})),[c,d]);return(0,a.jsxs)("div",{style:h.wrapper,children:[r,(0,a.jsx)("div",{style:h.title,children:t}),o?(0,a.jsx)("div",{style:h.description,children:o}):void 0,u?(0,a.jsx)(i().A,{size:"lg",onClick:p,style:h.button,iconLeading:m?{icon:m,size:"xs"}:void 0,children:u}):void 0,g?(0,a.jsx)(i().A,{size:"lg",onClick:S,style:h.button,children:g}):void 0]})}},621866:(e,t,o)=>{o.d(t,{i:()=>i});var n=()=>o(645873);const r={ConfigureViewsMainModuleAddViewButton:new(n().O2)("ConfigureViewsMainModuleAddViewButton",(async()=>await Promise.all([o.e(75134),o.e(9773),o.e(36556),o.e(40537),o.e(55373),o.e(36192),o.e(96346),o.e(44711),o.e(53321),o.e(90825),o.e(62475),o.e(3151),o.e(98629),o.e(87249),o.e(71621),o.e(88924),o.e(92845),o.e(56369),o.e(5834),o.e(48486),o.e(2411),o.e(89296),o.e(46414),o.e(9294),o.e(11676),o.e(91256),o.e(40563),o.e(67494),o.e(44584),o.e(53141),o.e(4422),o.e(4330),o.e(55162),o.e(55753),o.e(28866),o.e(22001),o.e(71386),o.e(4351),o.e(6331),o.e(69144),o.e(12341),o.e(96402),o.e(84166),o.e(16448),o.e(45769),o.e(74562),o.e(37384),o.e(3259),o.e(13955),o.e(76677),o.e(45147),o.e(15517),o.e(94995),o.e(98339),o.e(55776),o.e(51444),o.e(13297),o.e(4802),o.e(62032),o.e(32487),o.e(28058),o.e(75422),o.e(50856),o.e(36359),o.e(92924),o.e(25204),o.e(52986),o.e(45732),o.e(30443),o.e(88208)]).then(o.bind(o,965731))))},i=(0,n()._h)(r.ConfigureViewsMainModuleAddViewButton,(e=>e.ConfigureViewsMainModuleAddViewButton))},623186:(e,t,o)=>{o.d(t,{Od:()=>v,U$:()=>f,aN:()=>h,z7:()=>y});o(16280),o(898992),o(354520),o(672577),o(581454);var n=o(296540),r=()=>o(484714),i=()=>o(56366),l=()=>o(69708),a=()=>o(496603),s=()=>o(821062),c=()=>o(896628),d=()=>o(231297),u=()=>o(33791),p=()=>o(862292),m=()=>o(645873),g=()=>o(395963),S=()=>o(517223);function h(e){return(0,i().K8)((()=>!!e&&(0,u().v)({collectionStore:e,collectionViewBlockStore:e.getParentBlockStore(),checkNavigableAncestorLocked:!1})),[e])}function y({store:e,format:t,schema:o,collectionStore:n,propertyIds:a,propertyGroupId:c}){const d=(0,r().v3)(),u=(0,l().tz)(),{value:g}=(0,m().fJ)(p().T.formulas);return(0,i().K8)((()=>(0,S().e7)({store:e,format:t,schema:o,collectionStore:n,propertyIds:a,propertyGroupId:c,intl:u,environment:d,formulasModule:g})),[e,t,o,n,a,c,u,d,g],{equalityFn:s().k})}function v({collectionStore:e,format:t}){const o=(0,r().v3)();return(0,n.useCallback)((n=>{const r=t.collection_page_properties||[],i=[...(0,a().oE)(n.map((e=>r.find((t=>t.property===e))))),...r.filter((e=>!n.includes(e.property)))];d().createAndCommit({userAction:"PageProperties.handleReorder",environment:o,canUndo:!0,perform:t=>{c().zA({stores:[e],update:{collection_page_properties:i},transaction:t})}})}),[e,o,t.collection_page_properties])}function f({collectionStore:e,propertyGroupId:t}){const o=(0,r().v3)();return(0,n.useCallback)((n=>{if(!t)throw new Error("cannot reorder properties for property group -- no property group id provided");d().createAndCommit({userAction:"PagePropertiesGroup.handleReorder",environment:o,canUndo:!0,perform:o=>{(0,g()._h)({collectionStore:e,newPartialPropertyIds:n,groupId:t,transaction:o})}})}),[e,o,t])}},636740:(e,t,o)=>{function n(e){const{dateRangeStart:t,dateRangeEnd:o,collectionContextStore:n}=e;n.dateRangeStartStore.setState(t),n.dateRangeEndStore.setState(o)}o.d(t,{r:()=>n})},637096:(e,t,o)=>{o.d(t,{W:()=>d});var n=o(296540),r=()=>o(484714),i=()=>o(56366),l=()=>o(40970),a=()=>o(765957),s=()=>o(645200),c=()=>o(583238);function d(e){const{collectionContextStore:t,entrypoint:o}=e,d=(0,r().v3)(),u=(0,i().O$)(a().AppStoreSidebarSpaceStore),p=(0,i().K8)((()=>(0,c().mX)()),[]);return(0,n.useCallback)((()=>{const e=t.collectionViewStore(),n=t.collectionStore(),r=null==n?void 0:n.getParentBlockStore();e&&n&&r&&u&&(l().tC(d,{is_calendar_connected:p,collection_id:n.id,collection_view_id:e.id,collection_view_block_id:r.id,entrypoint:o}),s().Op({environment:d,collectionViewStore:e,spaceStore:u,from:"openInCalendarButton"}))}),[d,t,u,p,o])}},641514:(e,t,o)=>{o.d(t,{A:()=>s});o(296540);var n=()=>o(484714),r=()=>o(30537),i=()=>o(676007),l=()=>o(417392),a=o(474848);function s(e){const{isMobile:t}=(0,n().Y0)();return t?(0,a.jsx)(l().Ay,{ariaLabel:e.ariaLabel,open:e.isOpen,popupType:r().n.SlideUp,origin:e.origin,onDismiss:e.onDismiss,render:e.render,style:e.style}):(0,a.jsx)(i().a,{ariaLabel:e.ariaLabel,open:e.isOpen,preventHideChildrenWhileOpening:!0,render:e.render,onDismiss:e.onDismiss,style:e.style,innerStyle:e.innerStyle,showCloseIcon:e.showCloseIcon})}},648046:(e,t,o)=>{function n(e){return{type:"aggregation",aggregation:{property:e,aggregator:"empty",enforceMaxAggregationLimit:!0}}}o.d(t,{S:()=>n})},701751:(e,t,o)=>{o.d(t,{p:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"3.97 1.94 14.91 15.66",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10.55 12.808a1.35 1.35 0 1 0-1.1 0v1.242a.55.55 0 1 0 1.1 0z"}),(0,n.jsx)("path",{d:"M15.4 1.95a3.48 3.48 0 0 0-3.48 3.48v1.92H6.4a2.425 2.425 0 0 0-2.425 2.425v5.4A2.425 2.425 0 0 0 6.4 17.6h7.2a2.425 2.425 0 0 0 2.425-2.425v-5.4A2.425 2.425 0 0 0 13.6 7.35h-.43V5.43a2.23 2.23 0 1 1 4.46 0v2.095a.625.625 0 1 0 1.25 0V5.43a3.48 3.48 0 0 0-3.48-3.48M5.225 9.775c0-.649.526-1.175 1.175-1.175h7.2c.649 0 1.175.526 1.175 1.175v5.4c0 .649-.526 1.175-1.175 1.175H6.4a1.175 1.175 0 0 1-1.175-1.175z"})]})},i=(0,o(340498).wt)("lockOpen",r)},738418:(e,t,o)=>{o.d(t,{G:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("info",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M7.97266 14.9453C11.7871 14.9453 14.9453 11.7803 14.9453 7.97266C14.9453 4.1582 11.7803 1 7.96582 1C4.1582 1 1 4.1582 1 7.97266C1 11.7803 4.16504 14.9453 7.97266 14.9453ZM7.97266 13.7832C4.74609 13.7832 2.16895 11.1992 2.16895 7.97266C2.16895 4.74609 4.73926 2.16211 7.96582 2.16211C11.1924 2.16211 13.7764 4.74609 13.7832 7.97266C13.79 11.1992 11.1992 13.7832 7.97266 13.7832ZM7.91113 5.53906C8.41016 5.53906 8.7998 5.14258 8.7998 4.64355C8.7998 4.14453 8.41016 3.74805 7.91113 3.74805C7.41895 3.74805 7.02246 4.14453 7.02246 4.64355C7.02246 5.14258 7.41895 5.53906 7.91113 5.53906ZM6.77637 11.7324H9.55859C9.83887 11.7324 10.0576 11.5273 10.0576 11.2471C10.0576 10.9805 9.83887 10.7686 9.55859 10.7686H8.71094V7.28906C8.71094 6.91992 8.52637 6.67383 8.17773 6.67383H6.89258C6.6123 6.67383 6.39355 6.88574 6.39355 7.15234C6.39355 7.43262 6.6123 7.6377 6.89258 7.6377H7.62402V10.7686H6.77637C6.49609 10.7686 6.27734 10.9805 6.27734 11.2471C6.27734 11.5273 6.49609 11.7324 6.77637 11.7324Z"})})},739375:(e,t,o)=>{o.d(t,{RY:()=>S,er:()=>m,ir:()=>h,xc:()=>p,yv:()=>g});var n=()=>o(242422),r=()=>o(726637),i=()=>o(484714),l=()=>o(56366),a=()=>o(929219),s=()=>o(891360),c=()=>o(506050),d=()=>o(748197),u=()=>o(353890);function p(){const e=(0,i().v3)(),t=(0,l().O$)(a().e),{state:o,canEdit:n,isEnabled:r,store:d}=(0,u().s)(),p=(0,l().K8)((()=>c().L.state.dismissed.includes("nux")),[]),g=(0,l().K8)((()=>{const e=s().W.state;return e&&"available"===e.type?e.usage:1/0}),[]);return m({environment:e,state:o,isOnline:t,canUse:r&&n,hasSeenNux:p,usage:g,creatorId:(0,l().K8)((()=>d.getCreatedById()??""),[d])})}function m(e){const{environment:t,isOnline:o,canUse:n,state:r,hasSeenNux:i,usage:l,creatorId:a}=e;return a===t.currentUser.id&&(!i&&(!!o&&(!!n&&("initial"===r.state&&0===l))))}function g({disableExposureLogging:e=!1}={}){const t=(0,l().O$)(a().e);return(0,l().K8)((()=>n().default.checkGate({gateName:"ai_meeting_notes_demo_available",disableExposureLogging:e})&&t),[t,e])}function S({disableExposureLogging:e=!1}={}){return n().default.checkGate({gateName:"ai_meeting_notes_demo_available",disableExposureLogging:e})&&a().A.state.online}function h(e){var t;const{environment:o,state:i,isOnline:l,canUse:a,dismissedAnnotations:c,store:u}=e;if(r().A.isMobile)return!1;if(c.includes("demo-banner"))return!1;if(!d().c.state.demoVideoModalOpenForBlockId&&"initial"!==i.state)return!1;const p="available"===(null===(t=s().W.state)||void 0===t?void 0:t.type)?s().W.state.usage:1/0,g=u.getCreatedById()??"";if(!m({environment:o,isOnline:l,canUse:a,state:i,hasSeenNux:c.includes("nux-overlay"),usage:p,creatorId:g}))return!1;if(!S())return!1;return"on"===n().default.getEligibleGroup({experimentId:"ai_meeting_notes_demo_nux_banner",defaultGroup:"control",disableExposureLogging:!1})}},748539:(e,t,o)=>{o.d(t,{f:()=>n});const n=new(o(645873).O2)("pageCovers",(async()=>{const{pageCovers:e}=await o.e(40198).then(o.bind(o,519737));return e}))},777045:(e,t,o)=>{o.d(t,{w:()=>a});o(296540);var n=()=>o(56366),r=()=>o(489242),i=()=>o(69708),l=o(474848);function a(e){const{collectionContextStore:t}=e,o=(0,i().tz)(),a=(0,n().K8)((()=>{var e;return t.databaseType?(0,r().Mw)(o,t.databaseType):(0,r()._o)(o,null===(e=t.collectionStore())||void 0===e?void 0:e.getModel())}),[t,o]);return(0,l.jsx)(l.Fragment,{children:a})}},777932:(e,t,o)=>{o.d(t,{A:()=>r});class n extends(()=>o(757695))().Store{getInitialState(){return{isDuplicating:!1}}}const r=new n},782473:(e,t,o)=>{o.d(t,{Nu:()=>l,Sw:()=>n,gO:()=>r,j$:()=>i});const n=220,r=24,i=-7,l=-3},812119:(e,t,o)=>{o.d(t,{J:()=>l});o(296540);var n=()=>o(401497),r=()=>o(710149),i=o(474848);function l(e){const{widthPercentage:t,isInHomeWidget:o}=e,l=(0,n().IS)((e=>({rowContainer:{display:"flex",height:30,alignItems:"center",gap:1,alignSelf:"stretch"},circleShimmer:{width:o?12:16,height:o?12:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:t||"35%",height:10,flexShrink:0,borderRadius:12,marginInlineStart:2,backgroundColor:e.lightDividerColor},column:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,flex:"1 0 0"}})),[t,o]);return(0,i.jsx)("div",{style:l.rowContainer,children:(0,i.jsxs)("div",{style:l.column,children:[(0,i.jsx)(r().A,{style:l.circleShimmer}),(0,i.jsx)(r().A,{style:l.rowShimmer})]})})}},817942:(e,t,o)=>{o.d(t,{A5:()=>p,MR:()=>v,Mx:()=>s,Pb:()=>S,WL:()=>y,hg:()=>c,kZ:()=>h,pv:()=>d,vV:()=>g});o(581454);var n=o.n(o(32485)),r=o(296540),i=()=>o(11048),l=()=>o(455994),a=o(474848);const s=r.forwardRef((function(e,t){const{children:r,type:s,gap:c,withBottomPadding:d,style:u,onMouseDown:p,onClick:m,onDoubleClick:g,onContextMenu:S,suppressMargin:h}=e,y=(0,o(551619).n$)(s),v=(0,o(56366).K8)((()=>l().A.getPanelState("peek").isOpen&&"static_sidebar"===l().A.getPanelState("peek").displayStyle),[]);return(0,a.jsx)(i().A,{name:"PageLayout",children:(0,a.jsx)("div",{className:n()("layout",{"layout-wide":"wide"===s,"layout-wide-right-margin-expanded":"wide-right-margin-expanded"===s,"layout-side-peek":"side-peek"===s,"layout-center-peek":"center-peek"===s&&!v,"layout-center-peek-with-layout-panel":"center-peek"===s&&v,"layout-home":"home"===s,"layout-meet":"meet"===s,"layout-home-phone":"home-phone"===s,"layout-home-redesign-desktop":"home-redesign-desktop"===s,"layout-form":"form"===s,"layout-form-viewer":"form-viewer"===s,"layout-form-viewer-embed":"form-viewer-embed"===s,"layout-phone":"phone"===s,"layout-tablet":"tablet"===s,"layout-template-preview":"template-preview"===s,"layout-chat":"chat"===s,"layout-layout-editor":"layout-editor"===s,"layout-layout-editor-wide":"layout-editor-wide"===s,"layout-layout-editor-narrow":"layout-editor-narrow"===s,"layout-marketplace":"marketplace"===s,"layout-marketplace-mobile":"marketplace-mobile"===s,"layout-team-home":"team-home"===s,"layout-team-home-mobile":"team-home-mobile"===s,"layout-create-post":"create-post"===s,"layout-fullscreen-ai":"fullscreen-ai"===s,"layout-narrowscreen-ai":"narrowscreen-ai"===s,"layout-presentation-mode":"presentation-mode"===s,"layout-person-profile":"person-profile"===s,"layout-suppress-margin":h}),style:{paddingBottom:d?y:void 0,gap:c,...u},ref:t,onMouseDown:p,onClick:m,onDoubleClick:g,onContextMenu:S,children:r})})})),c="layout-content",d="layout-full",u="layout-margin-right",p="hide-scrollbar",m="layout-column",g=r.forwardRef((function(e,t){return(0,a.jsx)(i().A,{name:"PageLayoutContent",children:(0,a.jsx)("div",{className:n()(c,e.className),style:e.style,ref:t,children:e.children})})}));function S(e){return(0,a.jsx)(i().A,{name:"PageLayoutFull",children:(0,a.jsx)("div",{className:d,style:e.style,children:e.children})})}function h(e){return(0,a.jsx)(i().A,{name:"PageLayoutMarginRight",children:(0,a.jsx)("div",{className:u,style:{...e.style,pointerEvents:"none"},children:e.children})})}function y(e){return(0,a.jsx)(i().A,{name:"PageLayoutColumn",children:(0,a.jsx)("div",{className:n()(m,e.className),style:{"--min-column-width":e.minWidth?`${e.minWidth}px`:"100%",...e.style},children:e.children})})}function v(e){return(0,a.jsx)(i().A,{name:"PageLayoutTwoColumn",children:(0,a.jsxs)(y,{minWidth:e.minWidth,className:e.className,style:e.style,children:[e.left,e.right]})})}},825225:(e,t,o)=>{o.d(t,{y:()=>c});var n=()=>o(56366),r=()=>o(908201),i=()=>o(862292),l=()=>o(909470),a=()=>o(645873),s=()=>o(186348);function c(e){const t=(0,r().Ks)(),{schema:o,viewType:c}=(0,n().K8)((()=>{var e;return{schema:null==t||null===(e=t.collectionStore())||void 0===e?void 0:e.getSchema(),viewType:null==t?void 0:t.getViewType()}}),[t]),{value:d}=(0,a().fJ)(i().T.formulas),u=(0,n().K8)((()=>{var o,n;if(!e||!t)return;const r=null===(o=t.conditionalColorStore((0,l().i)()))||void 0===o||null===(o=o.state)||void 0===o?void 0:o.getBlockConditionalColor({blockStore:e,propertyMapping:null===(n=t.collectionStore())||void 0===n?void 0:n.getPropertyMapping(),shouldReturnAllMatchingColorRules:!1,formulasModule:d});return r&&r.length>0?r[0]:void 0}),[e,t,d]);return(0,s().h)({conditionalColor:u,store:e,schema:o,viewType:c})}},845094:(e,t,o)=>{o.d(t,{DG:()=>l,lC:()=>i});var n=()=>o(645873);const r={postInstallTourTooltip:new(n().O2)("workflowTemplateTourTooltip",(()=>o.e(99013).then(o.bind(o,901175)))),onboardingPills:new(n().O2)("onboardingPills",(()=>o.e(96431).then(o.bind(o,191294))))},i=(0,n()._h)(r.postInstallTourTooltip,(e=>e.WorkflowTemplateTourTooltip)),l=(0,n()._h)(r.onboardingPills,(e=>e.PostInstallPills))},866976:(e,t,o)=>{o.r(t),o.d(t,{CollectionViewBlockErrorBoundary:()=>i,CollectionViewBlockWithErrorBoundary:()=>l});var n=o(296540),r=o(474848);class i extends n.Component{componentDidCatch(e){throw o(449412).lE("collections"),e}render(){const{collectionViewBlockRef:e,...t}=this.props;return(0,r.jsx)(o(867396).A,{...t,ref:e})}}const l=n.forwardRef(((e,t)=>(0,r.jsx)(i,{...e,collectionViewBlockRef:t})))},867396:(e,t,o)=>{o.d(t,{A:()=>my,p:()=>py});o(898992),o(581454),o(908872),o(737550);var n=()=>o(906745),r=o(296540),i=()=>o(314529),l=()=>o(564884),a=()=>o(993905),s=()=>o(726637),c=()=>o(17022),d=()=>o(402014),u=()=>o(616068),p=()=>o(908006),m=()=>o(484714),g=()=>o(852507),S=()=>o(118884),h=()=>o(56366),y=()=>o(401497),v=()=>o(929219),f=()=>o(757695),b=()=>o(737658),x=()=>o(107041),C=()=>o(921997),w=()=>o(558842),k=()=>o(201980),I=()=>o(496603),A=()=>o(534177),T=()=>o(436696),j=()=>o(934839),M=()=>o(661920),P=()=>o(257615),R=()=>o(778417),_=()=>o(231297),B=()=>o(865454),V=()=>o(589895),E=()=>o(473336),F=()=>o(147503),O=()=>o(424599),D=()=>o(447453),L=()=>o(527438),z=()=>o(450510),K=()=>o(719549),H=(o(672577),()=>o(493260)),W=()=>o(177618),N=()=>o(760077);var G=()=>o(359454),$=()=>o(584262),U=()=>o(799954),q=()=>o(284371),X=()=>o(187820),Y=()=>o(16006),Q=()=>o(492414),Z=()=>o(478726),J=()=>o(747100),ee=()=>o(953418),te=()=>o(321909),oe=()=>o(712505),ne=()=>o(148832),re=(o(354520),()=>o(59226)),ie=()=>o(252291),le=()=>o(955363),ae=()=>o(764781),se=()=>o(126617),ce=()=>o(424139),de=()=>o(566910),ue=()=>o(167170),pe=()=>o(742852),me=()=>o(105819),ge=()=>o(617668),Se=()=>o(340498),he=()=>o(69708),ye=()=>o(430923),ve=()=>o(896628),fe=()=>o(384944),be=()=>o(391381),xe=()=>o(599945),Ce=o(474848);const we=function(e){const{store:t,titleStyle:o,actionButton:n,addViewButton:r}=e,i=s().A.isMobile,l=(0,h().K8)((()=>t.getParentBlockStore()),[t]);return(0,Ce.jsx)("div",{children:(0,Ce.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,Ce.jsx)(xe().c,{step:"demo_collection",store:l,children:(0,Ce.jsx)(Y().A,{store:t,style:o})}),i?null:r,n]})})};var ke=()=>o(145214),Ie=()=>o(760217),Ae=()=>o(406699),Te=()=>o(285790),je=()=>o(296798),Me=()=>o(404277),Pe=()=>o(939740),Re=()=>o(45552),_e=()=>o(417392),Be=()=>o(89924),Ve=()=>o(712855),Ee=()=>o(106412),Fe=()=>o(722872),Oe=()=>o(792002),De=()=>o(955450),Le=()=>o(400851);const ze=(0,he().YK)({actionsButtonAriaLabel:{defaultMessage:"Collection actions",id:"database.source.actionsButtonAriaLabel"},editDataSourceIconTitle:{defaultMessage:"Edit data source icon",id:"database.source.editDataSourceIcon.title"},editDatabaseIconTitle:{defaultMessage:"Edit database icon",id:"database.source.editDatabaseIcon.title"},editDataSourceLayoutTitle:{defaultMessage:"Edit data source layout",id:"database.source.editDataSourceLayout.title"},editDatabaseLayoutTitle:{defaultMessage:"Edit database layout",id:"database.source.editDatabaseLayout.title"}}),Ke=Object.freeze({property:!0}),He=r.memo((function(e){const{isHovered:t,collectionContextStore:o,addViewButton:n,showHoverActionsStore:r}=e,[i,l,a]=(0,h().K8)((()=>[o.collectionStore(),o.collectionViewBlockStore(),o.permissionScopesStore.state]),[o]),s=(0,h().K8)((()=>o.viewsModuleContextStore.isInLayoutBuilder()),[o]),c=(0,h().K8)((()=>{const e=o.collectionStore();if(!e)return!1;const t=e.getNameStore();return Boolean((0,Oe().j_)(t))}),[o]),d=(0,h().K8)((()=>{var e;return Boolean((null==i||null===(e=i.getParentBlockStore())||void 0===e?void 0:e.id)===(null==l?void 0:l.id))}),[i,l]),u=(0,h().K8)((()=>Boolean(null==i?void 0:i.isSyncedCollection())),[i]),p=(0,Ee().Zp)(),m=(d||c)&&a.canConfigureCollection&&!(null!=p&&p.disableEditingName)&&!u,g=(0,y().IS)((()=>({container:{display:"flex",alignItems:"center",minWidth:0,width:"max-content",maxWidth:"100%",marginInlineEnd:4},titleStyle:{fontWeight:q().Wy.bold,fontSize:22,minWidth:0,maxWidth:"100%",width:"100%",...c?{whiteSpace:"nowrap",overflow:"auto",scrollbarWidth:"none",msOverflowStyle:"none","&::-webkit-scrollbar":{display:"none"}}:{display:"-webkit-box",lineClamp:1,WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},marginInlineEnd:4}})),[c]);return i&&(null!=p&&p.disableContentPointerEvents||s)?(0,Ce.jsxs)("div",{style:g.container,children:[(0,Ce.jsx)(Ge,{collectionContextStore:o,disabled:!0}),(0,Ce.jsx)(we,{store:i,titleStyle:g.titleStyle})]}):m?(0,Ce.jsx)(Ne,{isHovered:t,collectionContextStore:o,showHoverActionsStore:r,titleStyle:g.titleStyle,addViewButton:n}):(0,Ce.jsx)(We,{isHovered:t,addViewButton:n,collectionContextStore:o,showHoverActionsStore:r,titleStyle:g.titleStyle})})),We=r.memo((function(e){const{isHovered:t,collectionContextStore:o,showHoverActionsStore:n,titleStyle:i,addViewButton:l}=e,a=(0,m().v3)(),c=s().A.isMobile,{collectionStore:d,collectionViewBlockStore:u}=(0,h().K8)((()=>({collectionStore:o.collectionStore(),collectionViewBlockStore:o.collectionViewBlockStore()})),[o]),{isSystemCollection:p,href:g}=(0,h().K8)((()=>{const e=Boolean(null==d?void 0:d.isSystemCollection());return{isSystemCollection:e,href:e?void 0:(0,W().t2)(o)}}),[o,d]),S=(0,y().IS)((()=>({container:{display:"flex",alignItems:"center",minWidth:0,width:"max-content",maxWidth:"100%",marginInlineEnd:4},containerInner:{paddingInlineStart:4,paddingInlineEnd:4,display:"flex",alignItems:"center",borderRadius:6},containerHovered:{background:"none"}})),[]),v=(0,r.useCallback)((()=>{(0,T().X)({environment:a,collectionContextStore:o,action:"click_collection_name_link_button"})}),[a,o]);return d&&u?(0,Ce.jsxs)(je().A,{disabled:p,style:S.container,innerStyle:S.containerInner,hoveredStyle:S.containerHovered,href:g,onClick:v,children:[(0,Ce.jsx)(Ge,{collectionContextStore:o,disabled:!0}),(0,Ce.jsx)(we,{addViewButton:t?l:void 0,actionButton:t||c?(0,Ce.jsx)($e,{showHoverActionsStore:n,collectionContextStore:o}):void 0,store:d,titleStyle:i})]}):null})),Ne=r.memo((function(e){const{isHovered:t,collectionContextStore:n,addViewButton:i,showHoverActionsStore:l,titleStyle:a}=e,c=(0,m().v3)(),d=(0,m().Y0)(),u=s().A.isMobile,p=(0,he().tz)(),g=(0,h().K8)((()=>n.collectionStore()),[n]),S=(0,h().K8)((()=>n.collectionViewBlockStore()),[n]),v=(0,h().K8)((()=>null==g?void 0:g.getNameStore()),[g]),f=(0,h().K8)((()=>(0,o(697650).getCollectionPlaceholderName)({collectionStore:g,intl:p})),[g,p]),b=(0,h().K8)((()=>!!v&&Boolean((0,Oe().j_)(v))),[v]),x=(0,h().K8)((()=>!Boolean(null==v?void 0:v.getValue())),[v]),C=(0,te().y)(),w=(0,y().IS)((e=>({container:{display:"flex",alignItems:"center",minWidth:0,width:"max-content",maxWidth:"100%",...C?{}:{marginInlineStart:4,marginInlineEnd:4}},titleIcons:{display:"flex",alignItems:"center",opacity:t||u?1:0,flexShrink:0},text:{minWidth:0,flex:1,maxWidth:"100%",overflow:"hidden",...a,...d.isSafari&&!b&&x?{display:"block",...q().RC}:{}},placeholder:{WebkitTextFillColor:e.pageTitlePlaceholderTextColor,cursor:"text"}})),[a,t,C,u,b,x,d.isSafari]),k=(0,r.useMemo)((()=>(0,Ce.jsxs)("div",{style:w.titleIcons,children:[u?null:i,(0,Ce.jsx)($e,{showHoverActionsStore:l,collectionContextStore:n})]})),[i,u,n,l,w.titleIcons]),I=(0,r.useCallback)((()=>{R().IU({environment:c})}),[c]),A=(0,r.useCallback)((()=>{const e=!Boolean(null==v?void 0:v.getValue());s().A.isMobile&&v&&e&&(0,be().x)({environment:c,store:v,canSelectAllBlocks:!1}),(0,T().X)({environment:c,collectionContextStore:n,action:"click_collection_name_input"})}),[v,c,n]);return g&&S&&v?(0,Ce.jsxs)("div",{style:w.container,children:[(0,Ce.jsx)(Ge,{collectionContextStore:n,disabled:!1}),(0,Ce.jsx)(Ve().A,{store:v,style:w.text,disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableMobileActionBar:!1,disableComment:!0,placeholder:f,onEnter:I,onEsc:I,onClick:A,disableShiftEnter:!0,pasteBehavior:"inline",inPageFind:o(792540).Os.none,placeholderStyle:w.placeholder,disabledMentionTypes:Ke},v.id),k]}):null})),Ge=r.memo((function(e){const{disabled:t,collectionContextStore:n}=e,i=(0,m().v3)(),{collectionStore:l,collectionViewBlockStore:a}=(0,h().K8)((()=>({collectionStore:n.collectionStore(),collectionViewBlockStore:n.collectionViewBlockStore()})),[n]),s=(0,h().K8)((()=>null==l?void 0:l.getIcon()),[l]),c=(0,h().K8)((()=>{var e;return Boolean((null==l||null===(e=l.getParentBlockStore())||void 0===e?void 0:e.id)===(null==a?void 0:a.id))}),[l,a]),d=(0,h().K8)((()=>null==a?void 0:a.getType()),[a]),u=(0,y().IS)((e=>({iconStyle:{width:22,height:22,marginInlineEnd:4},container:{position:"relative",width:24,height:24,marginInlineEnd:4,display:"flex",alignItems:"center",justifyContent:"center"},arrowContainer:{width:20,marginInlineEnd:4},pageLinkIndicatorIcon:{position:"absolute",width:"50%",height:"50%",insetInlineEnd:0,bottom:0,fill:"dark"===e.mode?e.text.primary:"#3E3C38",stroke:"dark"===e.mode?e.background.secondary:"white",strokeWidth:"dark"===e.mode?"1.85px":"1.5px"}})),[]),p=(0,r.useCallback)((e=>{const t=l&&l.getIconStore();t&&_().createAndCommit({userAction:"CollectionViewBlockSource.handleRecordIconChange",environment:i,canUndo:!0,perform:o=>{fe().KY({store:t,value:e,transaction:o})}})}),[l,i]);return l&&a?s||c?s?(0,Ce.jsxs)("div",{style:u.container,children:[t?(0,Ce.jsx)(X().B6,{disabled:!0,bucket:"secure",store:l,icon:s,iconRecordCategory:"collection",isEmptyPage:!1,style:u.iconStyle,size:22}):(0,Ce.jsx)(X().B6,{disabled:!1,bucket:"secure",store:l,icon:s,iconRecordCategory:"collection",isEmptyPage:!1,style:u.iconStyle,size:22,iconLoggingData:{recordTable:l.table,source:"inline_collection",block_type:d,collection_id:l.id},onChange:p}),c?void 0:(0,o(500066).G)(u.pageLinkIndicatorIcon)]}):null:(0,Ce.jsx)("div",{style:u.arrowContainer,children:(0,Ce.jsx)(ie().I,{icon:le().arrowDiagonalUpRightIcon})}):null}));const $e=r.memo((function(e){const{showHoverActionsStore:t,collectionContextStore:n}=e,i=s().A.isMobile,l=(0,he().tz)(),a=(0,h().O$)(t),c=function(e){const t=Ye(e),o=qe(e),n=Xe(e);return Object.values(t).some((e=>e))||Object.values(o).some((e=>e))||n}(n),d=(0,y().IS)((()=>({container:{display:"flex"},buttonPopup:{width:240},iconStyle:{width:Se().Ev.sm,height:Se().Ev.sm}})),[]),u=(0,r.useCallback)((e=>(0,Ce.jsx)(Te().A,{icon:i?o(803960).arrowChevronSingleDownIcon:se().ellipsisSmallIcon,iconStyle:d.iconStyle,ariaLabel:l.formatMessage(ze.actionsButtonAriaLabel),...e})),[l,i,d.iconStyle]),p=(0,r.useCallback)((e=>(0,Ce.jsx)(Ue,{parent:e,collectionContextStore:n})),[n]);return c?(0,Ce.jsx)(ke().A,{visible:a,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:d.container,children:(0,Ce.jsx)(Ae().A,{popupType:i?_e().nl.BottomSheet:_e().nl.Popup,bottomSheetInitialState:"half",render:p,renderOrigin:u,style:d.buttonPopup,originGap:4})}):null})),Ue=r.memo((function(e){const{parent:t,collectionContextStore:n}=e,i=s().A.isMobile??!1,l=(0,Ce.jsx)(he().sA,{defaultMessage:"Data source actions",id:"database.collectionNameActionsPopup.title"}),{collectionStore:a,collectionViewStore:c}=(0,h().K8)((()=>({collectionStore:n.collectionStore(),collectionViewStore:n.collectionViewStore()})),[n]),d=function({collectionContextStore:e,collectionViewStore:t}){const n=(0,m().v3)(),i=(0,he().tz)(),l=Ye(e);return(0,r.useMemo)((()=>{const r=[...l.addView?[{key:"add_view",render:t=>(0,Ce.jsx)(Ae().A,{popupType:Ae().z.BottomSheet,render:t=>(0,Ce.jsx)(ye().zS,{collectionContextStore:e,onClose:t.close,hideAddDataSource:!1}),renderOrigin:e=>(0,Ce.jsx)(Ie().A,{...t,...e,title:(0,Ce.jsx)(he().sA,{id:"database.source.addView.title",defaultMessage:"Add a new view"}),icon:(0,Ce.jsx)(ie().I,{icon:ge().plusIcon})})},"add-new-views"),action:()=>{}}]:[],...l.copyLinkAndDuplicateView?[{key:"copy_link_to_view",render:e=>(0,Ce.jsx)(Ie().A,{...e,icon:(0,Ce.jsx)(ie().I,{icon:pe().linkIcon}),title:(0,Ce.jsx)(he().sA,{id:"database.source.copyLinkToView.title",defaultMessage:"Copy link to view"})}),action:()=>{t&&((0,T().X)({environment:n,collectionContextStore:e,action:"view_action_menu_copy_link"}),F().GH({environment:n,collectionContextStore:e,collectionViewStore:t}))}},{key:"duplicate_view",render:e=>(0,Ce.jsx)(Ie().A,{...e,icon:(0,Ce.jsx)(ie().I,{icon:ae().V}),title:(0,Ce.jsx)(he().sA,{id:"database.source.duplicateView.title",defaultMessage:"Duplicate view"})}),action:()=>{t&&(0,o(873864).v)({environment:n,collectionContextStore:e,collectionViewStore:t,collectionSettingsStore:e.settingsStore,intl:i,from:"view_action_menu_duplicate"})}}]:[]];return r.filter((e=>null!==e))}),[t,e,n,i,l])}({collectionContextStore:n,collectionViewStore:c}),u=function({collectionContextStore:e,parent:t,collectionStore:n,collectionViewStore:i}){const l=(0,m().v3)(),a=(0,he().tz)(),s=qe(e),c=(0,h().uB)(void 0,o(663173).A),d=(0,r.useRef)(null),u=(0,h().K8)((()=>e.collectionViewBlockStore()),[e]),p=(0,h().K8)((()=>{var t;return(null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.hasMultipleOwnedOrLinkedCollections())??!1}),[e]);return(0,r.useMemo)((()=>{const r=e=>{const t=null==n?void 0:n.getIconStore();t&&t.getValue()!==e&&(_().createAndCommit({userAction:"updateCollectionIcon",environment:l,canUndo:!0,perform:o=>{fe().KY({store:t,value:e,transaction:o})}}),o(383594).I())},m=[...s.showViewDatabaseItem?[{key:"view",render:e=>(0,Ce.jsx)(Ie().A,{...e,title:(0,Ce.jsx)(he().sA,{id:"database.source.viewDatabase.title",defaultMessage:"View database"}),icon:(0,Ce.jsx)(ie().I,{icon:le().arrowDiagonalUpRightIcon})}),action:n=>{(0,o(239529).q)({environment:l,collectionContextStore:e,event:n.event,buttonPopupParent:t})}}]:[],...s.showEditNameItem?[{key:"edit_name",render:e=>(0,Ce.jsx)(Ie().A,{...e,title:p?(0,Ce.jsx)(he().sA,{id:"database.source.editDataSourceTitle.title",defaultMessage:"Edit data source title"}):(0,Ce.jsx)(he().sA,{id:"database.source.editTitle.title",defaultMessage:"Edit database title"}),icon:(0,Ce.jsx)(ie().I,{icon:me().pencilLineIcon})}),action:()=>{const o=null==n?void 0:n.getNameStore();o&&((0,be().x)({environment:l,store:o,canSelectAllBlocks:!1}),t.close(),(0,T().X)({environment:l,collectionContextStore:e,action:"click_source_edit_title"}))}},{key:"edit_icon",render:e=>(0,Ce.jsx)(Ie().A,{...e,ref:e=>{d.current=e},title:p?(0,Ce.jsx)(he().sA,{...ze.editDataSourceIconTitle}):(0,Ce.jsx)(he().sA,{...ze.editDatabaseIconTitle}),icon:(0,Ce.jsx)(ie().I,{icon:ce().emojiFaceIcon})}),action:()=>{d.current&&n&&(0,X().sg)({node:d.current,currentTab:"emoji",fileUploadParams:{bucket:"secure",store:n},environment:l,intl:a,disabled:!1,fileUploadStore:c,onChange:r})}}]:[],...s.showEditLayoutItem&&u?[{key:"edit_layout",render:e=>(0,Ce.jsx)(Ie().A,{...e,icon:(0,Ce.jsx)(ie().I,{icon:ue()._}),title:p?(0,Ce.jsx)(he().sA,{...ze.editDataSourceLayoutTitle}):(0,Ce.jsx)(he().sA,{...ze.editDatabaseLayoutTitle})}),action:()=>{n&&((0,o(447934).nh)({environment:l,blockStore:u,collectionStore:n,collectionViewStore:i,from:"collection_view_action_menu"}),t.close())}}]:[],...s.showHideTitleItem?[{key:"hide_title",render:e=>(0,Ce.jsx)(Ie().A,{...e,icon:(0,Ce.jsx)(ie().I,{icon:de().e}),title:p?(0,Ce.jsx)(he().sA,{id:"database.source.hideDataSourceTitles.title",defaultMessage:"Hide data source titles"}):(0,Ce.jsx)(he().sA,{id:"database.source.hideTitle.title",defaultMessage:"Hide database title"})}),action:()=>{_().createAndCommit({userAction:"CollectionViewBlockSource.showTitleItem",environment:l,canUndo:!0,perform:t=>{if(!i)return;const o=e.collectionViewBlockStore();o&&ve().zA({stores:[o],update:{hide_inline_collection_name:!0},transaction:t})}}),t.close(),(0,T().X)({environment:l,collectionContextStore:e,action:"click_source_hide_title"})}}]:[]];return m.filter((e=>null!==e))}),[i,l,e,t,n,a,c,d,p,s,u])}({collectionContextStore:n,parent:t,collectionStore:a,collectionViewStore:c}),p=function({collectionContextStore:e}){const t=Xe(e),n=(0,o(637096).W)({collectionContextStore:e,entrypoint:"view_menu"});return(0,r.useMemo)((()=>t?{key:"calendar",render:e=>(0,Ce.jsx)(o(187391).N,{...e}),action:()=>{n()}}:void 0),[t,n])}({collectionContextStore:n}),g=function({viewActions:e,actionsMenuListItems:t,manageInCalendarButton:o}){return(0,r.useMemo)((()=>[e.length>0?{key:"view_actions",render:e=>(0,Ce.jsx)(Be().A,{...e}),items:e}:null,t.length>0?{key:"actions",render:t=>(0,Ce.jsx)(Be().A,{...t,topBorder:e.length>0}),items:t}:null,o?{key:"calendar",render:o=>(0,Ce.jsx)(Be().A,{...o,topBorder:e.length>0||t.length>0}),items:[o]}:null].filter((e=>null!==e))),[e,t,o])}({viewActions:d,actionsMenuListItems:u,manageInCalendarButton:p});return a?(0,Ce.jsx)(Me().A,{menuType:i?Fe().gu.Modal:Fe().gu.Popup,title:l,right:(0,Ce.jsx)(Re().DoneMenuText,{}),onClickRight:t.close,children:(0,Ce.jsx)(Pe().Ay,{type:Pe().Oh.Vertical,onAccept:t.close,sections:g,initialFocus:void 0})}):null}));function qe(e){const t=(0,h().K8)((()=>e.collectionStore()),[e]),o=(0,m().v3)(),n=(0,h().K8)((()=>e.collectionViewBlockStore()),[e]),r=(0,h().K8)((()=>(null==t?void 0:t.isSyncedCollection())??!1),[t]),i=(0,h().K8)((()=>e.permissionScopesStore.state.canConfigureCollection),[e]),l=(0,h().O$)(e.canConfigureBlockStore),a=(0,Le().X)({environment:o,blockStore:n,from:"viewsModule"});return{showViewDatabaseItem:(0,h().K8)((()=>{var o,n;const r=Boolean(null==t?void 0:t.isSystemCollection()),i=null===(o=e.collectionViewBlockStore())||void 0===o?void 0:o.id,l=null==t||null===(n=t.getParentBlockStore())||void 0===n?void 0:n.id,a=l&&i&&l===i;return!(e.isFullScreenStore.state&&a)&&!r}),[e,t]),showEditNameItem:i&&!r,showHideTitleItem:l,showEditLayoutItem:i&&a}}function Xe(e){const t=(0,De().K)({collectionContextStore:e}),o=(0,re().X)("notion_calendar_db_integration_non_time_views");return t&&o}function Ye(e){return{addView:s().A.isMobile??!1,copyLinkAndDuplicateView:(0,h().K8)((()=>{var t;return 1===(null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.getCollectionViewStores().length)}),[e])}}const Qe=r.memo((function(e){const{store:t,collectionContextStore:n,isFullScreen:i,canEdit:l,showHoverActionsStore:a,paddingLeft:s,addViewButton:c}=e,d=(0,m().v3)(),[u,p]=(0,r.useState)(!1),g=(0,h().K8)((()=>{var e;return"page"===(null===(e=n.collectionViewStore())||void 0===e?void 0:e.getType())}),[n]),S=(0,h().K8)((()=>{const e=oe().default.state;return(0,J().RX)(t)||!(0,J().cq)(t)&&e.open&&e.isClosing}),[t]),v=(0,h().K8)((()=>n.collectionStore()),[n]),f=(0,h().K8)((()=>n.collectionViewBlockStore()),[n]),b=(0,h().K8)((()=>Boolean(null==v?void 0:v.isSyncedCollection())),[v]),x=(0,h().K8)((()=>Math.min(Z().x6,d.WindowSizeStore.state.width)),[d.WindowSizeStore]),C=(0,te().y)(),w=(0,y().IS)((()=>{const e=`${(i?s??0:0)+(C?U().dE.paddingInlineStart:0)}px`;return{containerHoverArea:{flexGrow:1,minWidth:0},container:{display:"flex",alignItems:"center",justifyContent:"space-between",width:S?x:"100%",boxSizing:S?"content-box":void 0,paddingTop:4,paddingBottom:4,paddingInlineEnd:0,paddingInlineStart:e,...(i||S)&&(0,ee().z4)(d)&&{position:"sticky",insetInlineStart:0}},nameContainer:{display:"flex",alignItems:"center",minWidth:0,flex:1,overflow:"hidden"},flex:{display:"flex"},button:{margin:0},syncedContainer:{paddingInlineStart:4}}}),[i,s,C,S,x,d]),k=(0,r.useCallback)((()=>{p(!0)}),[]),I=(0,r.useCallback)((()=>{p(!1)}),[]);return g?(0,Ce.jsx)(Ze,{store:t,collectionContextStore:n,isFullScreen:i,paddingLeft:s}):v&&f?(0,Ce.jsxs)("div",{onMouseEnter:k,onMouseLeave:I,style:w.containerHoverArea,children:[(0,Ce.jsxs)("div",{style:w.container,children:[(0,Ce.jsx)("div",{style:w.nameContainer,children:(0,Ce.jsx)(He,{collectionContextStore:n,showHoverActionsStore:a,addViewButton:c,isHovered:u})}),b?(0,Ce.jsx)("div",{style:w.flex,children:(0,Ce.jsx)(o(346436).A,{canEdit:l,store:f,buttonStyle:w.button})}):null]}),(0,Ce.jsx)("div",{style:w.syncedContainer,children:(0,Ce.jsx)(o(948049).A,{collectionStore:v,collectionContextStore:n})})]}):null})),Ze=r.memo((function({store:e,collectionContextStore:t,isFullScreen:n,paddingLeft:r}){const i=(0,m().v3)(),l=(0,h().K8)((()=>{var o,n;let r=null===(o=t.collectionViewStore())||void 0===o?void 0:o.getFormat().page_pointer;var i;r||"viewsMain"!==(null===(n=t.viewsModuleContextStore)||void 0===n?void 0:n.getViewModuleType())||(r=null===(i=t.viewsModuleContextStore)||void 0===i||null===(i=i.currentPageStore())||void 0===i?void 0:i.pointer);if(!r)return;const l=t.collectionViewBlockStore();if(!l)return;const a=l&&l.id===r.id?l:ne().B.createChildStore(l,{table:r.table,id:r.id,spaceId:r.spaceId});return!(null!=a&&a.isPageBlock()||null!=a&&a.isCollectionView())||a&&a.id===e.id?void 0:a}),[t,e.id]),a=(0,h().K8)((()=>null==l?void 0:l.getBlockTitleStore()),[l]),s=(0,h().K8)((()=>{if(l)return(0,Q().Ay)({store:l,fullyQualified:!1,pageVisitSource:$().y8.CollectionViewTypePage})}),[l]),c=(0,te().y)(),d=(0,y().IS)((e=>({container:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",paddingTop:4,paddingBottom:4,paddingInlineStart:`${(n?r??0:0)+(c?U().dE.paddingInlineStart:0)}px`,paddingInlineEnd:0,...n&&(0,ee().z4)(i)&&{position:"sticky",insetInlineStart:0},...c?{}:{marginInlineStart:4,marginInlineEnd:4}},nameContainer:{display:"flex",alignItems:"center",minWidth:0,width:"max-content",maxWidth:"100%",marginInlineEnd:4},containerInner:{paddingInlineStart:4,paddingInlineEnd:4,display:"flex",alignItems:"center",borderRadius:6},icon:{marginInlineEnd:6},title:{fontSize:22,fontWeight:q().Wy.bold,color:e.text.primary,minWidth:0,width:"100%",display:"-webkit-box",lineClamp:1,WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"}})),[n,i,r,c]),u=(0,h().K8)((()=>null==l?void 0:l.getIcon()),[l]);if(!l||!a)return null;return(0,Ce.jsx)("div",{style:d.container,children:(0,Ce.jsx)(o(97294).N,{href:s,style:d.nameContainer,children:(0,Ce.jsxs)("div",{style:d.containerInner,children:[(0,Ce.jsx)(X().B6,{disabled:!0,bucket:"secure",store:l,icon:u,iconRecordCategory:"pageBlock",isEmptyPage:!1,style:d.icon,size:22}),(0,Ce.jsx)(Y().A,{store:l,style:d.title})]})})})}));o(18107),o(967357),o(803949);var Je=()=>o(998531),et=()=>o(179034),tt=()=>o(741496),ot=()=>o(388821),nt=()=>o(951177);const rt=new(o(178624).R)({key:"notion/async_clipboard_store",namespace:"AsyncClipboardStore",important:!0,trackingType:"necessary"});async function it(e,{lastActionWasCut:t,valuePromise:o}){const n=(0,nt().hB)(e);rt.setState({eventId:n,waitingForCopy:!0,lastActionWasCut:void 0,value:void 0});const r=await o;if(!r)return void rt.setState({});const{recordMaps:i,...l}=r;rt.setState({eventId:n,waitingForCopy:!1,lastActionWasCut:t,value:{...l,recordMapsJson:st(i)}})}function lt(e){const t=rt.getState(),o=(0,nt().hB)(e);if(!t||!o||t.eventId!==o)return Promise.resolve(void 0);const{waitingForCopy:n,value:r,lastActionWasCut:i}=t;return n?new Promise((e=>{rt.addListener(function(e,t){return function o(n){const r=n.getState();if(!r)return void n.removeListener(o);const{waitingForCopy:i,value:l,lastActionWasCut:a}=r;i||r.eventId!==e||(n.removeListener(o),t(l?{lastActionWasCut:a||!1,value:{...l,recordMaps:at(l.recordMapsJson)}}:void 0))}}(o,e))})):r?Promise.resolve({lastActionWasCut:i||!1,value:{...r,recordMaps:at(r.recordMapsJson)}}):Promise.resolve(void 0)}function at(e){return new Map(e.map((([e,t])=>[e,ot().RecordMap.create(t)])))}function st(e){return[...e.entries()].map((([e,t])=>[e,t.toJson()]))}var ct=()=>o(884107),dt=()=>o(60867),ut=()=>o(899453),pt=()=>o(391214),mt=()=>o(675925),gt=()=>o(908201),St=()=>o(659602),ht=()=>o(335722),yt=()=>o(855801),vt=()=>o(405417),ft=()=>o(645873),bt=()=>o(502438),xt=()=>o(693202);const Ct=r.memo((function(){const e=(0,m().v3)(),t=(0,gt().ET)(),{value:n}=(0,ft().fJ)(St().g),{value:i}=(0,ft().fJ)(ht().S),l=(0,h().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.id}),[t]),a=(0,h().K8)((()=>{if(xt().default.isEditingStore.state)return!1;const e=bt().default.state.stores.at(0),t=null==e?void 0:e.getModel();if(void 0===e||void 0===t)return!1;if(void 0===(0,vt().oC)(e))return!1;const n=(0,o(236162).zN)({block:t,getRecordModel:e.getRecordModel});return void 0!==n&&n.id===l}),[l]),s=r.useCallback((async o=>{(await ct().R.clipboardActions.load()).copy({event:o,environment:e,markdownLinkifyIt:n});const r=bt().default.state.stores;it(o,{lastActionWasCut:!1,valuePromise:wt(e).then((o=>{const{result:n,status:i}=o;if("failed"===i)return;for(const r of n){var l;(0,tt().N)(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:r.id,block_type:r.getType(),isBulk:!0,collection_id:null===(l=t.collectionStore())||void 0===l?void 0:l.id})}const a=n.length>0;for(const c of r){var s;(0,tt().N)(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:c.id,block_type:c.getType(),isBulk:a,collection_id:null===(s=t.collectionStore())||void 0===s?void 0:s.id})}return kt({environment:e,subitems:n})}))})}),[t,e,n]),c=r.useCallback((async o=>{(await ct().R.clipboardActions.load()).copy({event:o,environment:e,markdownLinkifyIt:n});const r=t.collectionStore();if(null!=r&&r.isExternallyImportedAndSyncedCollection())return;const i=bt().default.state.stores,a=wt(e),s=wt(e).then((t=>{const{result:o,status:n}=t;if("failed"===n)return;for(const i of o)(0,tt().N)(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:i.id,block_type:i.getType(),isBulk:!0,collection_id:l});const r=o.length>0;for(const a of i)(0,tt().N)(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:a.id,block_type:a.getType(),isBulk:r,collection_id:l});return kt({environment:e,subitems:o})}));await it(o,{lastActionWasCut:!0,valuePromise:s});const c=bt().default.getState().stores,d=(await a).result;await dt().vX({blocks:c,subitems:d,environment:e,canUndo:!0,skipConfirmation:!0})}),[t,l,e,n]),d=r.useCallback((async o=>{var r,a,s,c;const d=await ct().R.clipboardActions.load(),u=await lt(o),m=await yt().VI.loadLocalSubtree.load(),g=await yt().VI.localDuplicate.load();rt.setState({...rt.getState(),lastActionWasCut:!1});const S=bt().default.getState().stores;if(!u){_().createAndCommit({userAction:"CollectionViewKeyboardArea.defaultPaste",environment:e,canUndo:!0,perform:t=>{var r;(0,mt().o)(e,{action:"paste",block_type:null===(r=S[0])||void 0===r?void 0:r.getType(),from:"collection_view_keyboard_shortcut"},(r=>{d.paste({environment:e,event:o,disableEmbedMenu:!0,transaction:t,onPasteFiles:d.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:i}),r()}))}});const t=bt().default.state.stores[0];if(void 0===t)return;return void(0,tt().N)(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:!1,collection_id:l})}const h=t.collectionViewBlockStore();if(!h)return;const y=t.collectionStore();if(!y)return;if(y.isExternallyImportedAndSyncedCollection())return;const{recordMaps:v,subitemFormat:f,childRelationSchema:b,parentRelationSchema:x}=u.value;if(!(v&&f&&b&&x))return;const C=[...v.entries()].map((([e])=>ne().B.createChildStore(y,{table:et().ev,id:e})));await Promise.all(C.map((e=>e.load())));const w=!(u.lastActionWasCut&&function(e,t){const o=t.map((t=>ne().B.createChildStore(e,t.pointer)));if(o.find((e=>!e.isReady)))return!1;return!o.find((e=>e.getAlive()))}(y,C));let k=[],I=vt().n9(t),A=null===(r=I)||void 0===r?void 0:r.parentRelationProperty,T=null===(a=I)||void 0===a?void 0:a.childRelationSchema,j=null===(s=I)||void 0===s?void 0:s.parentRelationSchema,M=null===(c=I)||void 0===c?void 0:c.subitemFormat;const P=t.permissionScopesStore.state.canConfigureCollection;for(const t of C)(0,tt().N)(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:u.value.isBulk,collection_id:l});if(_().createAndCommit({userAction:"CollectionViewKeyboardArea.pasteWithSubitems",environment:e,canUndo:!0,perform:r=>{if(!M&&P){dt().VI({transaction:r,collectionContextStore:t,environment:e})&&(I=vt().n9(t),I&&(A=I.parentRelationProperty,T=I.childRelationSchema,j=I.parentRelationSchema,M=I.subitemFormat))}var l;if(!(A&&T&&j&&M))return void(0,mt().o)(e,{action:"paste",block_type:null===(l=S[0])||void 0===l?void 0:l.getType(),from:"collection_view_keyboard_shortcut"},(t=>{d.paste({environment:e,event:o,disableEmbedMenu:!0,transaction:r,onPasteFiles:d.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:i}),t()}));const a=w?dt().B2({blocks:C,environment:e,transaction:r,recordMaps:v,migrateSubitemFormat:{from:f,to:M},collectionContextStore:t,originalSubitemSchemas:{subitemRelationSchema:b,parentRelationSchema:x},analyticsFrom:u.lastActionWasCut?"cut":"copy",loadLocalSubtreeModule:m,localDuplicateModule:g}):dt().fA({blocks:C,transaction:r,from:f,to:M,environment:e,originAction:"paste"});!function(e){const{environment:t,selectedBlocks:o,blocksToInsert:n,subitemFormat:r,collectionContextStore:i,transaction:l}=e,a=i.collectionStore();if(!a)return;const s=o.at(-1),c=vt().Px(n,r);if(0===c.length)return;if(s){const e=vt().W5(i,s),o=function(e,t){if(e)return t;if(t.recordStoreUIParentStore instanceof ne().B&&t.recordStoreUIParentStore.isPageBlock())return t.recordStoreUIParentStore}(Boolean(null==e?void 0:e.isExpanded),s);c.forEach((e=>{dt().VT({environment:t,blockStore:e,collectionStore:a,subitemFormat:r,transaction:l}),o&&ut().j$({environment:t,sourceStore:e,destStore:o,propertyWithInverse:{property:r.inverse,inverse:r.property},transaction:l,position:{type:"after"}})}))}else c.forEach((e=>{dt().VT({environment:t,blockStore:e,collectionStore:a,subitemFormat:r,transaction:l})}))}({environment:e,selectedBlocks:S,blocksToInsert:a,subitemFormat:M,collectionContextStore:t,transaction:r}),pt().LE({environment:e,blocksToInsert:a,target:S,transaction:r,replaceEmptyTextBlock:!1,preventSetSelection:!0}),k=a}}),!(A&&T&&j&&M))return;const B=vt().BK({blocks:k,parentRelationProperty:A,parentRelationSchema:j,collectionViewBlockStore:h});p().default.afterNextFlush((()=>{p().default.afterNextFlush((()=>{R().td({environment:e,stores:B})}))}))}),[t,l,e,n,i]);return(0,Ce.jsx)(Je().N,{debugName:`CollectionViewKeyboardArea-${l}`,capture:!0,priority:a?0:-1,onCopy:s,onCut:c,onPaste:d})}));function wt(e){const t=bt().default.getState().stores;return dt().zM({environment:e,blocks:t})}function kt({subitems:e,environment:t}){const n=bt().default.getState().stores,r=n.at(0);if(!r)return;const i=(0,vt().oC)(r);if(!i)return;const l=[...n,...e],a=I().oE(l.map((e=>{const n=(0,o(59110).loadLocalSubtree)({environment:t,blockId:e.id,inMemoryRecordCache:e.inMemoryRecordCache,options:{allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0}}).recordMap;return n&&[e.id,n]}))),s=new Map(a),{subitemFormat:c,childRelationSchema:d,parentRelationSchema:u}=i;return{recordMaps:s,subitemFormat:c,childRelationSchema:d,parentRelationSchema:u,isBulk:e.length>0}}const It=new(ft().O2)("lazyCreateHasSchemaChangedForQueryStore",(async()=>await o.e(42050).then(o.bind(o,366518))));var At=()=>o(835066),Tt=()=>o(297872),jt=()=>o(199896),Mt=()=>o(157856),Pt=()=>o(789550),Rt=()=>o(862292);async function _t(e){const t=await Rt().T.formulas.load();t.setFormulaParsingInstrumentation((()=>{class n extends t.FormulaParsingInstrumentation{constructor(...e){super(...e),this.pendingMetricsMap={},this.throttledFlushMetrics=I().nF((()=>{this.flushMetrics()}),15*o(615234).TD,{trailing:!0})}flushMetrics(){0!==Object.keys(this.pendingMetricsMap).length&&((0,l().u)({environment:e,event:{eventName:"collections_formula_parsing_cache_stats",eventProperties:(0,o(720665).MU)((0,A().WP)(this.pendingMetricsMap).map((([e,t])=>[n.metricNameToEventProperty[e],t??0])))}}),this.pendingMetricsMap={})}incrMetricImpl(e){this.pendingMetricsMap[e]=(this.pendingMetricsMap[e]??0)+1,this.throttledFlushMetrics()}}return n.metricNameToEventProperty={"formulas.parsing.weak_map_cache.hit":"weak_map_cache_hit","formulas.parsing.weak_map_cache.miss":"weak_map_cache_miss"},new n}))}var Bt=()=>o(635462),Vt=()=>o(38337),Et=()=>o(476492),Ft=()=>o(69447),Ot=()=>o(638146),Dt=()=>o(966080),Lt=()=>o(933765),zt=()=>o(807054),Kt=()=>o(53798),Ht=()=>o(891078),Wt=()=>o(406792),Nt=()=>o(117296),Gt=()=>o(665579),$t=()=>o(644914),Ut=()=>o(765957),qt=()=>o(463830),Xt=()=>o(478834),Yt=()=>o(53137),Qt=()=>o(230062),Zt=()=>o(961581),Jt=()=>o(977390),eo=()=>o(606932),to=()=>o(548821),oo=()=>o(865241),no=()=>o(472090),ro=()=>o(50764),io=()=>o(845094),lo=()=>o(307736),ao=(o(823215),()=>o(624919)),so=()=>o(99895);const co={formula:{initialResult:"collections_formula_initial_result_duration",mountToFirstResult:"collections_formula_mount_to_first_result"},relation:{initialResult:"collections_relation_initial_result_duration",mountToFirstResult:"collections_relation_mount_to_first_result"},rollup:{initialResult:"collections_rollup_initial_result_duration_v2",mountToFirstResult:"collections_rollup_mount_to_first_result_v2"}};function uo(){return{formula:(0,re().X)("formulas_enable_clientside_metrics"),relation:(0,re().X)("relation_enable_clientside_metrics"),rollup:(0,re().X)("rollup_enable_clientside_metrics")}}const po=Symbol("DONE_WITH_INITIAL_RENDER");function mo(e){const{collectionContextStore:t}=e,o=function(e){const{collectionContextStore:t,mountedBeforeInitialPageRender:o}=e,n=(0,m().v3)(),i=(0,r.useRef)(new(so().G)((()=>({done:!1,didTrackFirstResult:!1,pageIdToStatus:new Map})))),l=uo();return{trackMount:(0,r.useCallback)((({pageId:e,propertyId:t,propertyType:o})=>{if(!l[o])return;const n=i.current;if(n===po)return;const r=n.get(t);if(r.done)return;const a=performance.now();r.pageIdToStatus.has(e)||r.pageIdToStatus.set(e,{mountTime:a,gotFirstResult:!1}),(0,A().O9)(r.earliestMountTime)||(r.earliestMountTime=a)}),[l]),trackResult:(0,r.useCallback)((({pageId:e,propertyId:r,propertyType:a,endTime:s,context:c})=>{if(!l[a])return;const d=i.current;if(d===po)return;const u=d.get(r);if(u.done)return;const{initialResult:m,mountToFirstResult:g}=co[a],S=u.pageIdToStatus.get(e);if(!S)return void(0,ao().NK)(`Property result duration performance entry for ${e}/${r} not found`);const h=I().Bj((()=>({...(0,Et().kz)(t),is_navigation:!o,...c})));u.didTrackFirstResult||(u.didTrackFirstResult=!0,(0,A().O9)(u.earliestMountTime)?Wt().default.measure({metricName:g,startTime:u.earliestMountTime,endTime:s},{environment:n,shouldSendIfStatsigNotInitialized:!0,data:h()}):(0,ao().NK)(`Missing earliestMountTime for property ${r}`)),S.gotFirstResult||(S.gotFirstResult=!0,Wt().default.measure({metricName:m,startTime:S.mountTime,endTime:s},{environment:n,shouldSendIfStatsigNotInitialized:!0,data:h()})),p().default.afterNextFlush((()=>{u.didTrackFirstResult&&[...u.pageIdToStatus.values()].every((e=>e.gotFirstResult))&&d.set(r,{done:!0}),[...d.values()].every((e=>e.done))&&(i.current=po)}))}),[t,l,n,o])}}(e);return(0,g().w)((()=>{t.propertyResultDurationTracker||(t.propertyResultDurationTracker=o)})),null}function go(e){const t=uo();return r.useMemo((()=>Object.values(t).some((e=>e))),[t])?(0,Ce.jsx)(mo,{...e}):null}var So=()=>o(116225),ho=()=>o(106065),yo=()=>o(604577);function vo(e,t,o,n){return{render_started_at:o.cvbBlockRenderStart,mounted_at:o.cvbBlockRenderMount,items_started_at:o.itemsStart,items_visible:o.itemsVisible,query_request_count:t.queryCollectionRequests.length,query_request_times:t.queryCollectionRequests,collection_reducer_request_count:Object.keys(t.collectionReducerRequests).length,collection_reducer_request_times:Object.values(t.collectionReducerRequests),page_origin_time:(0,Wt().getPageOriginOrPrewarmedTabAppStartTime)(e),cvb_bundle_timing:fo(),lazy_render_started_at:n,prefetch_stats:yo().X.getTraversalStats()}}function fo(){const e=ho().H6.CollectionViewBlock.getLoadingMetrics();if(null!=e&&e.resolvedAt&&null!=e&&e.startedAt)return{started_at:e.startedAt,resolved_at:e.resolvedAt,duration_ms:e.resolvedAt-e.startedAt}}var bo=()=>o(736316);class xo extends f().Store{getInitialState(){return{stage:"NOT_TRACKING"}}}function Co(e,t,o,n,i,l,a){const s=(0,m().v3)(),c=(0,h().uB)(void 0,xo),d=(0,r.useRef)(0),u=(0,r.useRef)(t),g=(0,r.useRef)(),S=(0,r.useRef)(void 0),y=(0,r.useRef)(void 0),v=(0,r.useRef)(!0),f=(0,r.useRef)(!1),b=(0,r.useCallback)((()=>{"NOT_TRACKING"===c.state.stage&&(c.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"INITIAL"}),S.current=performance.now())}),[c]),x=(0,r.useCallback)((e=>{"NOT_TRACKING"===c.state.stage&&(c.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"NAVIGATION"}),e&&(g.current=e))}),[c]),C=(0,r.useCallback)((()=>{if(null==a||a(),o.current)return;const t=c.state.stage;if("COUNTING_VISIBLE_ITEMS"===t){if(d.current++,1===d.current){const e=performance.now();p().default.afterNextFlush((()=>{"COUNTING_VISIBLE_ITEMS"===c.state.stage&&c.setState({stage:"SHOULD_TRACK",endTime:e,source:c.state.source})}))}}else"NOT_TRACKING"===t&&v.current&&(v.current=!1,Wt().default.DO_NOT_USE_measureFromPageOriginLegacy({metricName:"missed_database_items_visible",endTime:performance.now()},{environment:s,data:Et().ax({environment:s,collectionContextStore:e,visibleItemsCount:1,wasInitialRenderEmpty:f.current,isPrewarmedTab:(0,zt().isPrewarmedTabInitialRender)(s),cvbLoadingStateOnInitialRender:i})}))}),[e,o,s,c,i,a]),w=(0,r.useCallback)((()=>{y.current||(y.current=performance.now())}),[]),k=(0,r.useCallback)((t=>{t.state&&"COUNTING_VISIBLE_ITEMS"===c.state.stage&&(f.current=!0,e.isEmptyStore.removeListener(k),C())}),[e.isEmptyStore,C,c]),I=(0,r.useCallback)((async t=>{if(!o.current&&"SHOULD_TRACK"===t.state.stage){const o=(0,zt().isPrewarmedTabInitialRender)(s),c=o?Zt().A.state.prewarmedTabAppStartTimeOverride:void 0,p=Et().ax({environment:s,collectionContextStore:e,visibleItemsCount:d.current||0,wasInitialRenderEmpty:f.current,isPrewarmedTab:o,cvbLoadingStateOnInitialRender:i}),m=s.RouterStore.state.route,h="page"===m.name&&m.blockId?V().Ob.lookupViewIds(m.blockId).length:0;if("INITIAL"===t.state.source){var r,a;const i=(0,E().A)(null===(r=e.collectionViewStore())||void 0===r?void 0:r.id),d=null===(a=s.prefetchCache)||void 0===a?void 0:a.getPrefetchAnalytic(i),m={cvbBlockRenderStart:u.current,cvbBlockRenderMount:S.current,itemsStart:y.current,itemsVisible:t.state.endTime},g=function(e){const{subMetricsTimes:t}=e,{cvbBlockRenderStart:o,cvbBlockRenderMount:n,itemsStart:r,itemsVisible:i}=t,l={"collections.await_page_chunk_end_to_cvb_start":void 0,"collections.cvb_start_to_cvb_mount":void 0,"collections.cvb_mount_to_items_start":void 0,"collections.items_start_to_items_visible":void 0},{await_page_chunk_start_to_await_page_chunk_end:a}=Zt().A.state.subMetricsStore.state,s=({startTime:t,endTime:o})=>{if(e.isPrewarmedTab){if(o<=e.prewarmedTabNavigationStart)return 0;if(t<e.prewarmedTabNavigationStart&&o>e.prewarmedTabNavigationStart)return o-e.prewarmedTabNavigationStart}return o-t};return o&&a&&(l["collections.await_page_chunk_end_to_cvb_start"]=s({startTime:a.endTime,endTime:o}),(0,bo().f)({name:"collections.await_page_chunk_end_to_cvb_start",startTime:a.endTime,endTime:o})),o&&n&&(l["collections.cvb_start_to_cvb_mount"]=s({startTime:o,endTime:n}),(0,bo().f)({name:"collections.cvb_start_to_cvb_mount",startTime:o,endTime:n})),n&&r&&(l["collections.cvb_mount_to_items_start"]=s({startTime:n,endTime:r}),(0,bo().f)({name:"collections.cvb_mount_to_items_start",startTime:n,endTime:r})),r&&i&&(l["collections.items_start_to_items_visible"]=s({startTime:r,endTime:i}),(0,bo().f)({name:"collections.items_start_to_items_visible",startTime:r,endTime:i})),l}(o&&"number"==typeof c?{subMetricsTimes:m,isPrewarmedTab:!0,prewarmedTabNavigationStart:c}:{subMetricsTimes:m,isPrewarmedTab:!1}),v={...p,sub_metrics:g,initial_render_timings:vo(s,e.timingTracker.finishTracking(),m,null==l?void 0:l.current),includes_page_origin_to_app_start:!0,is_swv2:await(0,zt().isSWV2)()};n&&Wt().default.measureFromPageOrigin({metricName:"initial_database_items_visible",endTime:t.state.endTime},{environment:s,data:v,shouldSendIfStatsigNotInitialized:!0}),u.current&&(Wt().default.DO_NOT_USE_measureLegacy({metricName:"collections.initial_mount_to_items_visible",startTime:u.current,endTime:t.state.endTime},{environment:s,data:v,shouldSendIfStatsigNotInitialized:!0}),"hit-match"===(null==d?void 0:d.type)&&void 0!==d.finished_at&&d.finished_at>u.current&&Wt().default.DO_NOT_USE_measureLegacy({metricName:"collections.initial_mount_waiting_for_api",startTime:u.current,endTime:d.finished_at},{environment:s,data:p}),(v.is_full_screen||1===h)&&So().u4({name:"database_visit",args:{database_visit_id:v.database_visit_id}}))}else if("NAVIGATION"===t.state.source){if(g.current){const e={...p,wasm_sqlite_initialized:Zt().A.state.metricDataStore.state.wasm_sqlite_initialized,...eo().A.getDatabaseNavigationMetrics(g.current)};Wt().default.DO_NOT_USE_measureLegacy({metricName:"collections.navigation_items_visible",startTime:g.current,endTime:t.state.endTime},{environment:s,data:e})}if(u.current){const o={cvbBlockRenderStart:u.current,cvbBlockRenderMount:S.current,itemsStart:y.current,itemsVisible:t.state.endTime},n=vo(s,e.timingTracker.finishTracking(),o,null==l?void 0:l.current);Wt().default.DO_NOT_USE_measureLegacy({metricName:"collections.navigation_mount_to_items_visible",startTime:u.current,endTime:t.state.endTime},{environment:s,data:{...p,initial_render_timings:n}}),(p.is_full_screen||1===h)&&So().u4({name:"database_visit",args:{database_visit_id:p.database_visit_id}})}}else t.state.source;t.setState({stage:"COMPLETED"}),d.current=0}}),[e,o,s,n,i,l]);return(0,r.useEffect)((()=>(c.addListener(I),()=>{c.removeListener(I)})),[I,c]),(0,r.useEffect)((()=>(e.isEmptyStore.addListener(k),()=>{e.isEmptyStore.removeListener(k)})),[e.isEmptyStore,k]),{handleInitialDatabaseRender:b,handleNavigationDatabaseRender:x,handleItemMount:C,handleItemsRenderStart:w}}function wo(e){const{collectionContextStore:t,collectionViewBlockRenderStartTime:o,didDelayOffscreenRenderRef:n,mountedBeforeInitialPageRender:r,cvbLoadingStateOnInitialRender:i,lazyRenderStartedAtRef:l,trackPendingCollectionItemRender:a}=e,{handleInitialDatabaseRender:s,handleNavigationDatabaseRender:c,handleItemMount:d,handleItemsRenderStart:u}=Co(t,o,n,r,i,l,a);return t.databaseItemsVisibleTracker||(t.databaseItemsVisibleTracker={handleInitialDatabaseRender:s,handleNavigationDatabaseRender:c,handleItemMount:d,handleItemsRenderStart:u}),null}var ko=()=>o(688742),Io=()=>o(671593),Ao=()=>o(666144);async function To(e){const{environment:t,collectionContextStore:o,blockIdToMinimumVersion:n}=e;await async function(e,t){return await Promise.all((0,A().WP)(t).map((async([t,o])=>Ao().sy({environment:e,inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache,pointer:{table:et().ev,id:t},userId:e.currentUser.id,minimumVersion:o}))))}(t,n),o.resultSetStore.addLocalChange(Object.keys(n))}var jo=()=>o(638681);const Mo=jo().union([jo().isUndefined(),jo().object({required:{blockIdToVersion:jo().record(jo().string(),jo().number())},optional:{hasMore:jo().boolean()}})]);class Po{constructor(e,t){this.deferredCollectionEmit=void 0,this.queuedBlockIdsToRefetch=void 0,this.isServerRequestRequired=void 0,this.collectionContextStore=void 0,this.environment=void 0,this.handleCollectionSchemaChange=e=>{if(!this.collectionContextStore.isClientModeEnabledStore.state&&e.state){var t,o;const e=`${null===(t=this.collectionContextStore.collectionStore())||void 0===t?void 0:t.id}:${null===(o=this.collectionContextStore.collectionStore())||void 0===o||null===(o=o.getModel())||void 0===o?void 0:o.getVersion()}`;this.throttledRefetch({src:"change_schema",trigger:e})}},this.isServerQueryCollectionRequiredForCollectionEmit=(e,t)=>{const o=this.collectionContextStore.isClientModeEnabledStore.state;if(o&&t&&"collectionTypedView"===this.collectionContextStore.contextType)return!0;const n=Boolean(e&&(0,Io().Xj)(Mo,e)&&e.hasMore);if(o&&!n)return!1;const r=this.collectionContextStore.remoteRequestStore.state;if(!r)return!0;return!!(0,A().WP)(r.loader.reducers||{}).some((([e,t])=>"results"!==t.type))||!(e&&(0,Io().Xj)(Mo,e)&&!e.hasMore)},this.throttledRefetch=(0,o(279900).A)((e=>this.refetchFromRemote({...e,queuedTimestamp:Date.now()}))),this.processCollectionRefetch=async e=>{const t=this.queuedBlockIdsToRefetch,o=this.isServerRequestRequired;if(this.reset(),o){var n;const o=null===(n=(0,A().uv)(t))||void 0===n?void 0:n[0],r=t[o];this.throttledRefetch({src:e,trigger:`${o}:${r}`})}t&&await To({environment:this.environment,collectionContextStore:this.collectionContextStore,blockIdToMinimumVersion:t})},this.refetchFromRemote=async e=>{const t=this.collectionContextStore.throttleMsStore.state;await Promise.all([(0,K().M)(this.environment,this.collectionContextStore,e),(0,o(763824).wR)(t)])},this.deferredCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={},this.collectionContextStore=e,this.environment=t}reset(){this.deferredCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={}}addBlockIdToRefetch(e,t){this.queuedBlockIdsToRefetch[e]=Math.max(this.queuedBlockIdsToRefetch[e]??0,t)}async handleCollectionEmit(e){const{src:t,passThroughData:o,shouldDeferCollectionEmit:n,isCollectionTypeChange:r}=e;if((0,Io().Xj)(Mo,o)&&null!=o&&o.blockIdToVersion&&(0,A().WP)(o.blockIdToVersion).forEach((([e,t])=>this.addBlockIdToRefetch(e,t))),this.isServerRequestRequired=this.isServerRequestRequired||this.isServerQueryCollectionRequiredForCollectionEmit(o,r),!n)return await this.processCollectionRefetch(t);this.deferredCollectionEmit=!0}async maybeProcessDeferredCollectionEmit(e){if(this.deferredCollectionEmit)return await this.processCollectionRefetch(e)}subscribeToSchemaChanges(e){e.addListener(this.handleCollectionSchemaChange)}unsubscribeFromSchemaChanges(){var e;null===(e=this.collectionContextStore.hasSchemaChangedForQueryStore)||void 0===e||e.removeListener(this.handleCollectionSchemaChange)}}o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698);var Ro=()=>o(718827),_o=()=>o(631524),Bo=()=>o(66689),Vo=()=>o(59674),Eo=()=>o(713998),Fo=()=>o(371513),Oo=()=>o(236262),Do=()=>o(10521),Lo=()=>o(44729),zo=()=>o(581350),Ko=()=>o(988268);o(944114);function Ho({collectionContextStore:e,property:t,blockStores:o}){const n=e.normalizedFormatStore.state.collection_group_by;if((null==n?void 0:n.property)!==t)return;const r=function(e,t){const o=new Map,n=t.groupsStore.getAllGroupStates(),r=(0,I().E$)(e,bt().default.state.stores);if(!r.length)return o;for(const i of r){const e=n.find((e=>e.groupUiParentStore===i.getRecordStoreUIParent()));e&&o.set(i,e.resultsStore)}return o}(o,e),i=[];for(const[l,a]of r.entries())a.state.includes(l)||i.push(l);i.length&&R().DN({stores:(0,I().R9)(bt().default.state.stores,i)})}var Wo=()=>o(334684),No=()=>o(454305),Go=()=>o(852353),$o=()=>o(742943);class Uo extends f().Store{getInitialState(){return{textStoresBeingEdited:[]}}getNumberOfTextStoresBeingEdited(){return this.state.textStoresBeingEdited.length}textStoresWithEmptyProperty(e){return this.state.textStoresBeingEdited.filter((t=>{const o=t.getPropertyValue(e);return""===k().q4_(o)}))}}var qo=()=>o(859428),Xo=()=>o(398217);const Yo=32;function Qo(e){return{boxShadow:`1px 0 0 ${e.regularDividerColor}`,marginInlineEnd:1}}const Zo=(0,he().YK)({delete:{id:"CollectionsBulkActionsToolbar.deleteButton.tooltip",defaultMessage:"Delete"},addToSidebarSection:{id:"CollectionsBulkActionsToolbar.addToSidebarSectionButton.tooltip",defaultMessage:"Add to {sectionName} in sidebar"}});function Jo(e){const{marginLeft:t}=e,n=(0,m().v3)(),i=(0,r.useRef)(null),l=(0,r.useRef)(void 0),s=(0,gt().ET)(),c=(0,h().K8)((()=>s.collectionViewBlockStore()),[s]),d=(0,h().uB)(void 0,Uo),[u,p]=(0,r.useState)(!1),{selectedItems:g,selectedItemCount:S}=(0,h().K8)((()=>{const e=bt().default.state.stores;return{selectedItems:e,selectedItemCount:e.length}}),[]),v=(0,h().K8)((()=>d.getNumberOfTextStoresBeingEdited()),[d]),f=(0,h().K8)((()=>{var e;return!!(0,W().f5)({collectionContextStore:s})&&(!g.some((e=>{var t;return null===(t=e.getAssociatedCollectionStore())||void 0===t?void 0:t.isExternallyImportedAndSyncedCollection()}))&&(v>0||g.length>=1&&(0,W().Rd)(g,null===(e=s.collectionViewBlockStore())||void 0===e?void 0:e.id)))}),[s,v,g]);(0,h().K8)((()=>{const e=(0,Ko().j)().state;e.isOpen?l.current=e.property:l.current&&Ho({collectionContextStore:s,property:l.current,blockStores:g})}),[s,g],{debugName:"cleanUpSelection"});const b=(0,h().K8)((()=>c&&"suggest"!==o(77246).Uv.getMode(c)&&(!s.isLibraryBlock()||g.every((e=>e.canEdit())))),[c,g,s]),x=(0,h().K8)((()=>(0,$o().IE)(s)),[s]),C=(0,r.useCallback)((e=>{e||p(!1)}),[]),w=(0,y().IS)((e=>({inner:{display:"inline-flex",justifyContent:"center",alignItems:"center",borderRadius:5,background:e.popoverBackground,boxShadow:e.shadowSM,height:Yo},outer:{position:"sticky",top:1,insetInlineStart:t??0,zIndex:999,visibility:u?"visible":"hidden",width:"fit-content"},outerLayoutAdjust:{marginBottom:-Yo},blockActionMenuButton:{width:30,height:"100%",borderRadius:void 0,borderStartEndRadius:5,borderEndEndRadius:5},blockActionMenuButtonIcon:{fill:e.text.primary}})),[u,t]);return(0,Ce.jsx)(o(109488).A,{capture:f,render:e=>(0,Ce.jsxs)(ke().A,{visible:f,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onAnimationEnd:C,ref:i,...e,style:w.outer,children:[(0,Ce.jsx)(a().s,{allowSelectionWithin:!1,style:{width:"fit-content"},children:(0,Ce.jsxs)("div",{style:w.inner,children:[(0,Ce.jsx)(on,{selectedItemCount:S,numTextStoresBeingEdited:v}),(0,Ce.jsx)(dn,{collectionsBulkActionsToolbarStore:d,selectedItems:g,marginLeft:t,setIsReadyToRender:p,outerContainerRef:i}),x?(0,Ce.jsx)(en,{libraryViewName:x}):void 0,b?(0,Ce.jsx)(tn,{environment:n,collectionContextStore:s,selectedItems:g}):void 0,(0,Ce.jsx)(o(496889).A,{store:g[0],fadeIn:!1,style:w.blockActionMenuButton,hoveredStyle:w.blockActionMenuButton,iconStyle:w.blockActionMenuButtonIcon,extraAnalyticsData:{isFromBulkActionsToolbar:!0},isFromCollectionView:!0})]})}),(0,Ce.jsx)("div",{style:w.outerLayoutAdjust})]})})}function en(e){const{libraryViewName:t}=e,o=(0,y().IS)((e=>({button:{borderRadius:0,height:"100%",border:0,...Qo(e)}})),[]),n=(0,$o().D9)(t);return(0,Ce.jsx)(_o().p,{iconLeading:Fo().b,style:o.button,onClick:()=>function({libraryViewName:e}){"favorites"===e||"shared"===e||"private"===e||"recents"===e||(0,A().HB)(e)}({libraryViewName:t}),children:(0,Ce.jsx)(he().sA,{...Zo.addToSidebarSection,values:{sectionName:n}})})}function tn(e){const{environment:t,collectionContextStore:o,selectedItems:n}=e,r=(0,y().IS)((e=>({trashButton:{borderRadius:0,height:"100%",border:0,...Qo(e),width:28},trashButtonIcon:{width:20},trashButtonIconHovered:{fill:e.red.icon.accentPrimary}})),[]),i=(0,he().tz)();return(0,Ce.jsx)(qo().A,{renderTooltip:()=>(0,Ce.jsx)(he().sA,{...Zo.delete}),render:e=>(0,Ce.jsx)(Te().A,{...e,ariaLabel:i.formatMessage(Zo.delete),icon:()=>(0,Oo().trashIcon)(r.trashButtonIcon),style:r.trashButton,hoveredStyle:r.trashButtonIconHovered,hasBackground:!0,colorVariant:"primary",showShadow:!0,onClick:async()=>{var e;(0,tt().N)(t,{analyticsName:Do().AY.deleteName.defaultMessage,from:"bulk_actions_toolbar",block_type:"page",collection_id:null===(e=o.collectionStore())||void 0===e?void 0:e.id}),await pt().Af({environment:t,blocks:n,shouldCheckSuggestEdit:!0,overrideRemoveBlockFunc:(e,t)=>{var n,r;(null===(n=e.getAssociatedCollectionStore())||void 0===n?void 0:n.id)===(null===(r=o.collectionStore())||void 0===r?void 0:r.id)&&Lo().by({childStore:e,transaction:t})}})}}),placement:"top"})}function on(e){const{selectedItemCount:t,numTextStoresBeingEdited:o}=e,n=(0,m().v3)(),i=(0,r.useMemo)((()=>o>0?o:Math.max(1,t)),[o,t]),l=(0,r.useCallback)((()=>R().IU({environment:n})),[n]),a=(0,y().IS)((e=>({button:{color:e.blue.text.accentPrimary,fontSize:14,whiteSpace:"nowrap",height:"100%",alignItems:"center",display:"flex",paddingInlineEnd:10,paddingInlineStart:10,borderStartStartRadius:5,borderEndStartRadius:5,fontVariantNumeric:"tabular-nums",...Qo(e)}})),[]);return(0,Ce.jsx)(Ro().Ay,{style:a.button,onClick:l,children:(0,Ce.jsx)(he().sA,{id:"SelectedItemCountWidget.numItemsSelected",defaultMessage:"{itemsSelectedCount} selected",values:{itemsSelectedCount:i}})})}const nn=6,rn=450,ln=2,an=32,sn=150,cn=new Set(["title","rollup","formula","button"]);function dn(e){const{outerContainerRef:t,collectionsBulkActionsToolbarStore:o,selectedItems:n,marginLeft:i,setIsReadyToRender:l}=e,a=(0,gt().ET)(),s=(0,r.useRef)(null),c=(0,r.useRef)([]),d=(0,h().O$)(a.normalizedSchemaStore),u=(0,h().K8)((()=>a.databaseType===Bo().TC&&n.some((e=>e.getPropertyValue(Vo().y.MeetingNoteToCalendarEventRelation)))),[a,n]),p=!(0,h().O$)(v().e),m=(0,h().K8)((()=>{var e;const t=a.normalizedFormatStore.state;return((null==t||null===(e=t.table_properties)||void 0===e?void 0:e.filter((e=>{const t=a.collectionStore(),{property:o,visible:r}=e,i=d[o];return!(p&&(0,A().O9)(i)&&(0,Wo().$)({propertyType:i.type,propertySchema:i,allowAIProperty:!0}))&&((0,Eo()._f)(null==t?void 0:t.getModel(),o)?!u:r&&i&&!cn.has(i.type)&&(0,Go().g2)({propertySchema:i,property:o,blockStores:n,collectionSchema:d,collectionStore:t,spaceStore:null==t?void 0:t.getSpaceStore()}))})))??[]).slice(0,nn)}),[a,d,n,u,p]),[g,S]=(0,r.useState)(nn),[f,b]=(0,r.useState)(!1);(0,r.useEffect)((()=>{c.current.length>0&&c.current.forEach((e=>{var t;e&&(e.rightEdge=(null===(t=e.element)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect().right)??0)}))}),[c]),function({outerContainerRef:e,propertyButtonsContainerRef:t,propertyButtonRefs:o,marginLeft:n,setIsReadyToRender:i,setShowIconsOnly:l,setHiddenButtonsIndex:a}){(0,r.useEffect)((()=>{const r=I().sg((()=>{var r,s,c;const d=(null===(r=e.current)||void 0===r?void 0:r.getBoundingClientRect().right)??window.innerWidth,u=((null===(s=e.current)||void 0===s?void 0:s.getBoundingClientRect().width)??window.innerWidth)-(n??0),p=(null===(c=t.current)||void 0===c?void 0:c.getBoundingClientRect().left)??0,m=d-sn;let g=o.current.findIndex((e=>e.rightEdge>m));g=-1!==g?g:nn;let S=o.current.findIndex(((e,t)=>p+t*an>m));S=-1!==S?S:nn;const h=g<ln||u<=rn;l(h),a(h?S:g),i(!0)}),150,{maxWait:150,leading:!0,trailing:!1});if(e.current){const t=new ResizeObserver((e=>{r()}));return r(),t.observe(e.current),()=>{t.disconnect()}}}),[n,e,o,t,a,i,l])}({propertyButtonsContainerRef:s,propertyButtonRefs:c,outerContainerRef:t,marginLeft:i,setIsReadyToRender:l,setHiddenButtonsIndex:S,setShowIconsOnly:b});const x=(0,y().IS)((()=>({container:{display:"flex"}})),[]);return(0,Ce.jsx)("div",{ref:s,style:x.container,children:m.map(((e,t)=>{var n;let i=null===(n=c.current[t])||void 0===n?void 0:n.element;if(!i){const e=r.createRef();c.current[t]={element:e,rightEdge:0},i=e}const l=t>=g;return(0,Ce.jsx)("div",{ref:i,children:(0,Ce.jsx)(un,{collectionsBulkActionsToolbarStore:o,schema:d,property:e.property,isHidden:l,showIconsOnly:f},e.property)},e.property)}))})}function un(e){const{property:t,schema:o,collectionsBulkActionsToolbarStore:n,isHidden:i,showIconsOnly:l}=e,a=(0,m().v3)(),s=(0,gt().ET)(),c=(0,r.useRef)(null),d=(0,h().uB)(void 0,No().A),u=o[t],p=(0,h().K8)((()=>!(s.permissionScopesStore.state.canEditContent||"collectionTypedView"===s.contextType)),[s]),g=(0,y().IS)((e=>({button:{display:i?"none":"flex",paddingInlineStart:8,paddingInlineEnd:8,height:Yo,alignItems:"center",...Qo(e)},property:{maxWidth:"250px",textOverflow:"ellipsis"},icon:{fill:e.text.primary}})),[i]),S=(0,r.useCallback)((async e=>{var o,r;if(!c.current)return;const i=bt().default.state.stores;e.stopPropagation(),e.preventDefault();const l=null===(o=c.current)||void 0===o?void 0:o.getBoundingClientRect();if(i.length<1)return;const u=i[0].getAssociatedCollectionStore();s&&l&&u&&await zo().V({environment:a,store:i[0],additionalStores:i.slice(1),property:t,rect:l,surface:"table",collectionStore:u,blockPropertyValueOverlayStore:(0,Ko().j)(),collectionContextStore:s,statusSetCheckbox:"checkbox"===(null===(r=s.getPropertyFormat(t))||void 0===r?void 0:r.statusShowAs),mouseStore:d,preventClearSelection:!0,collectionsBulkActionsToolbarStore:n})}),[c,s,a,t,d,n]),v=(0,r.useCallback)((()=>null==u?void 0:u.name),[u]),f=(0,r.useCallback)((e=>u?(0,Ce.jsx)(Ro().Ay,{...e,ariaLabel:u.name,ref:c,style:g.button,disabled:p,onClick:S,children:(0,Ce.jsx)(Xo().mA,{style:g.property,propertySchema:u,hideName:l,showIcon:!0,property:t,iconStyle:g.icon})}):null),[S,p,t,u,l,g.button,g.icon,g.property]);return u?(0,Ce.jsx)(qo().A,{renderTooltip:v,render:f,disableTooltip:!l,placement:"top"}):null}const pn=r.memo((function(e){const{isFullScreen:t,leftRightPaddingStore:o,leftRightMarginStore:n,overrideViewType:r}=e,i=(0,gt().ET)(),l=(0,h().K8)((()=>(0,W().f5)({collectionContextStore:i,overrideViewType:r})),[i,r]),a=(0,h().K8)((()=>{var e;if(!l)return 0;return(t?(null===(e=o.state)||void 0===e?void 0:e.paddingLeft)??0:0)+(n.state.marginLeft??0)-2}),[l,n,o,t]);return l?(0,Ce.jsx)(Jo,{marginLeft:a}):null}));var mn=()=>o(124092),gn=()=>o(863330);const Sn=new(ft().O2)("CollectionTasksEmptyStateModal",(async()=>await Promise.all([o.e(62032),o.e(47536)]).then(o.bind(o,462032)))),hn=(0,ft()._h)(Sn,(e=>e.CollectionTasksEmptyStateModal));var yn=()=>o(162674),vn=()=>o(610101),fn=()=>o(132389);const bn="noWritableDbs";function xn(e){const{collectionContextStore:t,onAddTaskClick:n,from:i}=e,l=(0,m().v3)(),a=(0,r.useRef)(null),s=(0,h().O$)(t.isInHomeWidgetStore),c=(0,h().K8)((()=>t.collectionStoresStore.state.length>0),[t.collectionStoresStore]),d=(0,h().K8)((()=>{const e=t.collectionStoresStore.state;return Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())))}),[t.collectionStoresStore]),u=(0,h().K8)((()=>(0,W().h6)(t)),[t]),p=(0,h().K8)((()=>!t.isFullScreenStore.state),[t]),g=(0,r.useCallback)((e=>{F().Ub({environment:l,handleAddItemClick:n,buttonRef:a,event:e})}),[l,n,a]),S=(0,y().IS)((e=>({container:{width:"100%",height:p?"calc(100% - 4px)":void 0,paddingTop:p?32:120,paddingBottom:32,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",fontSize:14,color:e.text.tertiary},icon:(0,Gt().Xx)(e)})),[p]),v=(0,r.useMemo)((()=>c?(0,Ce.jsx)(qo().A,{disableTooltip:d,placement:"bottom",renderTooltip:()=>(0,Ce.jsx)(he().sA,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"tasksEmptyState.addTask.tooltip.noWritableDbs",values:{br:(0,Ce.jsx)("br",{})}}),render:e=>(0,Ce.jsx)(mn().p,{...e,colorPalette:"blue",ref:a,disabled:!d,disabledFeedback:!d,onClick:e=>{(0,yn().bS)({environment:l,from:i}),g(e)},iconLeading:{icon:gn().plusSmallIcon,size:"sm"},children:u})}):(0,Ce.jsx)(mn().p,{colorPalette:"blue",onClick:()=>{(0,yn().bS)({environment:l,from:i}),vn().A.setState(!0)},children:(0,Ce.jsx)(he().sA,{defaultMessage:"Dont see your tasks?",id:"tasksEmptyState.noDatabases.title"})})),[c,d,u,l,i,g]);return s&&!c?(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)(hn,{from:i}),(0,Ce.jsx)(Nt().Ww,{feature:"tasks",onSetup:()=>{(0,yn().bS)({environment:l,from:i}),vn().A.setState(!0)}})]}):(0,Ce.jsxs)("div",{style:S.container,children:[(0,Ce.jsx)(hn,{from:i}),(0,o(166292).S)(S.icon),(0,Ce.jsx)(fn().A,{size:16}),d?(0,Ce.jsx)(he().sA,{defaultMessage:"No matching tasks.",id:"tasksEmptyState.noMatchingTasks.title"}):(0,Ce.jsx)(he().sA,{defaultMessage:"See all tasks assigned to you here.",id:"tasksEmptyState.noTasks.title"}),(0,Ce.jsx)(fn().A,{size:16}),v]})}var Cn=()=>o(11048),wn=()=>o(710149),kn=()=>o(661179);function In({store:e,collectionViewStore:t,collectionContextStore:o}){let n,r=t.getFormat().page_pointer;const i=o.viewsModuleContextStore;if(!r&&"viewsMain"===(null==i?void 0:i.getViewModuleType())){const e=i.currentPageStore();e&&(r=e.pointer,n=e)}if(r)return n??=e.id===r.id?e:ne().B.createChildStore(e,{table:r.table,id:r.id,spaceId:r.spaceId}),n.isPageBlock()||n.isCollectionView()?n:void 0}var An=()=>o(222299),Tn=()=>o(551619);const jn=new(ft().O2)("views-main-builder-modules",(()=>Promise.all([o.e(9773),o.e(36556),o.e(40537),o.e(44711),o.e(53321),o.e(87249),o.e(71621),o.e(88924),o.e(92845),o.e(56369),o.e(46414),o.e(37384),o.e(13955),o.e(94995),o.e(32487),o.e(52273),o.e(61660),o.e(70605)]).then(o.bind(o,984318)))),Mn=(0,ft()._h)(jn,(e=>e.ViewsMainBuilderModules));var Pn=()=>o(778781),Rn=()=>o(729923),_n=()=>o(9768);const Bn=r.memo((function(e){const{modules:t,store:n,collectionStore:r,context:i,disabled:l,templatePickerMenuListStore:a,pageLayoutRef:s,collectionContextStore:c,editorContentContainerRef:d}=e,u=(0,m().v3)(),p=(0,h().K8)((()=>r.getSchema()),[r]),g=(0,h().K8)((()=>(0,o(577814).A)({environment:u,store:n,pageViewBlockStore:void 0})),[u,n]),S=(0,Ce.jsx)(Ce.Fragment,{children:t.map((e=>(0,Ce.jsx)(Vn,{module:e,store:n,context:i,disabled:l,collectionSchema:p,collectionStore:r,modules:t,templatePickerMenuListStore:a,pageLayoutRef:s,pageDiscussionsRenderState:g,editorContentContainerRef:d},e.id)))});return c?(0,Ce.jsx)(gt().RI,{value:c,children:S}):S}));function Vn({module:e,store:t,context:n,disabled:i,collectionSchema:l,collectionStore:a,modules:s,templatePickerMenuListStore:c,pageLayoutRef:d,pageDiscussionsRenderState:u,editorContentContainerRef:p}){const g=(0,m().v3)(),S=(0,_n().Br)({layoutModule:e,area:"views_main_tab_modules",collectionSchema:l,collectionStore:a,pageMainModules:s,showDetailsPanelToggleButtonBelowTitle:!1}),y=(0,_n().Jh)({layoutModule:e,area:"views_main_tab_modules",collectionSchema:l,collectionStore:a,showDetailsPanelToggleButtonBelowTitle:!1,modules:s}),v=(0,h().K8)((()=>!(0,o(864994).g)({environment:g,layoutArea:"views_main_tab_modules",moduleType:e.type,pageViewBlockContext:n})),[g,e.type,n]);return(0,o(120997).p)(e,"views_main_tab_modules")?(0,Pn().gx)(e)?(0,Ce.jsx)(o(483832).v,{context:n,disabled:i,propertyId:e.propertyId,store:t,pageModule:e,wrapper:y,stackPropertyLabelAndValue:v},`${e.id}-${t.id}`):(0,Pn().i_)(e)?(0,Ce.jsx)(r.Fragment,{children:(0,Ce.jsx)(o(578405).h,{context:n,disabled:i,store:t,wrapper:y,layoutModule:e,customization:{neverShowPropertiesElsewhereInLayout:!0,stackPropertyLabelAndValue:v,disableContainerPadding:!0,disableLastRowBottomPadding:v},showDefaultTitle:!0})},`${e.id}-${t.id}`):"editor"===e.type?(0,Ce.jsx)(Rn().p,{context:n,disabled:i,handlePlaceholderWrapClick:e=>An().YB(e,t,g),pageBlockStore:t,pathToBlockId:e.pathToBlockId,templatePickerMenuListStore:c,pageViewBlockAccessor:()=>(null==d?void 0:d.current)??null,editorWrapper:n===to().Rr.DraftPostInInlineComposer?void 0:y,ref:p}):"relationsGroup"===e.type?(0,Ce.jsx)(o(996262).z,{pageStore:t,wrapper:y,disabled:i,context:n,showDefaultTitle:S}):"deleted_property"===e.type?null:"discussions"===e.type?(0,Ce.jsx)(o(257502).d,{store:t,wrapper:y,showDefaultTitle:S,discussionLocation:"page_discussion",pageDiscussionsRenderState:u}):void(0,A().HB)(e):null}var En=()=>o(817942),Fn=()=>o(255824);const On=r.memo((function(e){const{store:t,canEdit:n,templatePickerMenuListStore:i,collectionStore:l,collectionViewStore:a,isFullScreen:s,editorContentContainerRef:c}=e,d=(0,m().v3)(),u=(0,m().Y0)(),p=(0,r.useRef)(null),g=(0,h().K8)((()=>t.isNonEditableState()),[t]),S=(0,Fn().a)(),y=(0,gt().ET)(),v=(0,o(933951).sS)({pageStore:t,collectionStore:l,pageViewBlockStore:void 0}),{layoutTabModules:f,viewsMainTabId:b}=(0,h().K8)((()=>{const e=null==v?void 0:v.views_main_tab_modules;if(!e)return{layoutTabModules:void 0,viewsMainTabId:void 0};const t=null==a?void 0:a.getFormat().page_layout_pointer;if(!t)return{layoutTabModules:void 0,viewsMainTabId:void 0};return{layoutTabModules:e[t.views_main_tab_id],viewsMainTabId:t.views_main_tab_id}}),[a,v]),x=(0,Tn().n$)(),C=(0,h().K8)((()=>(0,J().cq)(t)?to().Rr.PeekView:y.isFullScreenStore.state?to().Rr.CollectionPageViewFullScreen:to().Rr.CollectionPageView),[y,t]),w=(0,Ht().VE)(t),k=(0,h().K8)((()=>{const e=o(129522).K.findBlockFromStore(t);if(e)return"collectionContextStore"in e?e.collectionContextStore:void 0}),[t]),I=(0,h().K8)((()=>(0,o(299772).NS)(w,t,C,u)),[w,t,C,u]),A=!n||g||S,T=S&&b?(0,Ce.jsx)("div",{style:{paddingTop:12,paddingInlineEnd:4},children:(0,Ce.jsx)(Mn,{viewsMainTabId:b,pageLayoutType:I})}):f&&l?(0,Ce.jsx)(En().Mx,{ref:p,type:I,suppressMargin:!0,style:{paddingTop:12,paddingBottom:s?x:void 0},children:(0,Ce.jsx)(Bn,{context:C,modules:f,store:t,disabled:A,collectionStore:l,templatePickerMenuListStore:i,pageLayoutRef:p,collectionContextStore:k,editorContentContainerRef:c})}):(0,Ce.jsx)(En().Mx,{ref:p,type:I,style:{justifyContent:"center",paddingTop:12,paddingBottom:s?x:void 0},suppressMargin:!s,children:(0,Ce.jsx)(Rn().p,{context:C,disabled:A,handlePlaceholderWrapClick:e=>An().YB(e,t,d),pageBlockStore:t,templatePickerMenuListStore:i,pageViewBlockAccessor:()=>p.current,ref:c})});return(0,Ce.jsx)(Cn().A,{name:"PageView",children:T})})),Dn=r.memo(r.forwardRef((function({store:e,collectionViewStore:t,style:n,isFullScreen:i,editorContentContainerRef:l,templatePickerMenuListStore:a,isViewsModule:s},c){const d=(0,gt().ET)(),u=(0,h().K8)((()=>d.collectionStore()),[d]),p=(0,h().K8)((()=>"collectionSystemView"===d.contextType),[d]),m=(0,h().K8)((()=>In({store:e,collectionViewStore:t,collectionContextStore:d})),[e,t,d]),g=!(0,Ht().bx)(m,p);return(0,r.useEffect)((()=>{"rendered"!==Ut().default.state.renderPhase&&Ut().default.setPageRendered()}),[]),(0,r.useEffect)((()=>{d.onItemMount(m)}),[d,m]),s?m?(0,Ce.jsx)("div",{style:n,children:(0,Ce.jsx)(On,{canEdit:!g,disabled:g,store:m,collectionViewStore:t,templatePickerMenuListStore:a,collectionStore:u,isFullScreen:i,editorContentContainerRef:l})}):null:(0,Ce.jsx)(o(485601).c,{disabled:!1,displayName:"CollectionPagePageContent",ref:c,style:n,children:(0,Ce.jsx)(Cn().A,{name:"CollectionPageView",children:m?(0,Ce.jsx)(On,{canEdit:!g,disabled:g,store:m,collectionViewStore:t,templatePickerMenuListStore:a,collectionStore:u,isFullScreen:i,editorContentContainerRef:l}):null})})})));var Ln=()=>o(611648),zn=()=>o(735695),Kn=()=>o(236030),Hn=()=>o(378518),Wn=()=>o(2143),Nn=()=>o(466088);function Gn(e){const{style:t,children:o}=e,n=(0,y().IS)((()=>({scroller:{height:"100%",maxHeight:"inherit",...t}})),[t]);return(0,Ce.jsx)(Wn().H,{type:Ln().A.Y,style:n.scroller,children:o})}function $n({store:e,children:t,isFullScreen:n,currentViewType:i,isInPeek:l,isInHomeWidget:a,handleEditorClick:s,isRootOrDirectChild:c,leftRightPaddingStore:d,paddingBottom:u,viewSettingsPlacementStore:p,paddingLeft:g,format:S,isMyTasksEmpty:y,isHomeCustomDbEmpty:v,isInFrameWhenSidePeekOpen:f,handleHorizontalScrollerMount:b,handleEditorMouseDown:x,isUnlistedView:C,isPreviewing:w}){const k=(0,gt().ET)(),I=(0,Ee().Zp)(),T=(0,m().v3)(),{isPhone:j}=(0,m().Y0)(),M=(0,h().K8)((()=>(0,Nn().w)(T)),[T]),P=(0,h().K8)((()=>function(e){const{environment:t,isFullScreen:o,isInPeek:n,isPreviewing:r,isUnlistedView:i,isSettingsView:l,collectionViewType:a}=e;return r&&r.enableHorizontalScroll?Ln().A.X:r&&!r.enableHorizontalScroll||"page"===a||"feed"===a?Ln().A.None:i?Ln().A.All:n||l?Ln().A.X:o&&(0,ee().z4)(t)?Ln().A.None:Ln().A.X}({environment:T,isFullScreen:n,isPreviewing:!!w&&{enableHorizontalScroll:(null==I?void 0:I.enableHorizontalScroll)??!1},isInPeek:l,isUnlistedView:Boolean(C),isSettingsView:"collectionSettings"===k.contextType,collectionViewType:i})),[C,T,n,w,l,k,i,I]),R=(0,h().K8)((()=>!("collectionSystemView"===k.contextType)&&a&&function(e){switch(e){case"table":case"board":case"gallery":case"list":case"timeline":case"chart":case"page":case"form_editor":case"chat":case"dashboard":return!0;case"calendar":case"map":case"feed":case"custom":return!1;default:return(0,A().HB)(e)}}(i)),[k,a,i]),_=(0,h().K8)((()=>z().B2({blockStore:e,isFullScreen:n,collectionContextStore:k})),[e,n,k]),B=(0,h().K8)((()=>{const t=d.state,o=k.settingsStore.state.open,r=k.isInHomeWidgetStore.state&&k.isEditableHomeCollectionStore.state;let l={};return C&&(l=j?{height:M?Kn().gK:Kn().NH,width:void 0}:{height:Kn().PN,width:void 0}),{flexGrow:1,flexShrink:0,...e.isNonEditableState()&&{cursor:"default"},..."timeline"===i&&k.collectionStore()&&!n&&!(0,Hn().Od)({environment:T,format:S,isFullScreen:n,isRootChild:c})&&t&&{marginInlineStart:t.paddingLeft,marginInlineEnd:t.paddingRight,marginBottom:u},...o&&!n&&"sidebar"===p.state&&{minHeight:zn().iZ},...r?{paddingInlineEnd:8,paddingInlineStart:"list"===i?8:16}:{},...a&&!R?{maxHeight:"inherit"}:{},...y||v||!R?{height:"100%"}:{},...!f||"timeline"===i||a||C?{}:{position:"sticky",insetInlineStart:0,paddingInlineStart:g,width:(0,$t().Uh)(T)},..."chart"===i&&f&&!a?{paddingInlineStart:g}:{},..."page"===i?{zIndex:86}:{},..._&&{marginInlineStart:-Kn().Fh},...l,..."custom"===i&&{height:"100%"}}}),[d,k,c,e,i,n,T,S,u,p,a,R,y,v,f,g,_,C,j,M]),V=(0,Fn().a)(),E=(0,h().K8)((()=>V&&"page"===i?Ln().A.All:l||a?Ln().A.None:o(620689).u5(T)),[T,l,a,V,i]),F=(0,r.useCallback)((e=>{s(e,i)}),[s,i]),O=(0,Ce.jsx)(Wn().H,{type:P,className:Vt().ohG,preventType:E,onClick:F,style:B,ref:b,children:t});return R?(0,Ce.jsx)(Gn,{style:{..."list"===i?{paddingBottom:8}:"timeline"===i?{paddingBottom:0}:{paddingBottom:16},...a&&"feed"!==i?{paddingTop:12}:{}},children:O}):O}var Un=()=>o(543886),qn=()=>o(405170),Xn=()=>o(956675),Yn=()=>o(24374),Qn=()=>o(62371),Zn=()=>o(857783),Jn=()=>o(281948),er=()=>o(242422),tr=()=>o(821062),or=()=>o(406094),nr=()=>o(493552),rr=()=>o(8741),ir=()=>o(112412);const lr={viewBox:"0 0 16 16",fittedViewBox:"2.56 2.22 10.88 11.55",svg:(0,Ce.jsx)("path",{d:"M3.14 2.225a.575.575 0 1 0 0 1.15h9.72a.575.575 0 1 0 0-1.15zm.36 2.027a.935.935 0 0 0-.935.935v1.44c0 .516.419.935.935.935h1.44a.935.935 0 0 0 .935-.935v-1.44a.935.935 0 0 0-.935-.935zm.215 2.16v-1.01h1.01v1.01zm3.565-2.16a.935.935 0 0 0-.935.935v1.44c0 .516.419.935.935.935h1.44a.935.935 0 0 0 .935-.935v-1.44a.935.935 0 0 0-.935-.935zm.215 2.16v-1.01h1.01v1.01zm3.565-2.16a.935.935 0 0 0-.935.935v1.44c0 .516.419.935.935.935h1.44a.935.935 0 0 0 .935-.935v-1.44a.935.935 0 0 0-.935-.935zm.215 2.16v-1.01h1.01v1.01zM3.14 8.438a.575.575 0 1 0 0 1.15h9.72a.575.575 0 1 0 0-1.15zm.36 2.027a.935.935 0 0 0-.935.935v1.44c0 .516.419.935.935.935h1.44a.935.935 0 0 0 .935-.935V11.4a.935.935 0 0 0-.935-.935zm.215 2.16v-1.01h1.01v1.01zm3.565-2.16a.935.935 0 0 0-.935.935v1.44c0 .516.419.935.935.935h1.44a.935.935 0 0 0 .935-.935V11.4a.935.935 0 0 0-.935-.935zm.215 2.16v-1.01h1.01v1.01zm3.565-2.16a.935.935 0 0 0-.935.935v1.44c0 .516.419.935.935.935h1.44a.935.935 0 0 0 .935-.935V11.4a.935.935 0 0 0-.935-.935zm.215 2.16v-1.01h1.01v1.01z"})},ar=(0,Se().wt)("squareGridBelowLinesSmall",lr);var sr=()=>o(970330),cr=()=>o(895876),dr=()=>o(90654),ur=()=>o(766854),pr=(o(430670),()=>o(564787)),mr=()=>o(9559),gr=()=>o(898244),Sr=()=>o(416504),hr=()=>o(519831),yr=()=>o(708830),vr=()=>o(722101),fr=()=>o(73223),br=()=>o(909470),xr=()=>o(972435),Cr=()=>o(337567),wr=()=>o(861841),kr=()=>o(622811),Ir=()=>o(267639),Ar=()=>o(174254),Tr=()=>o(476297),jr=()=>o(636081),Mr=()=>o(180252),Pr=()=>o(537551);function Rr(e){var t;const{store:o,groupsPointer:n,environment:r,collectionContextStore:i,transaction:l}=e;if(!o.isDefined())return;const a=i.normalizedSchemaStore.state,s=i.relativeVariableStore.state,c=null===(t=i.viewsModuleContextStore.currentPageStore())||void 0===t?void 0:t.id,d=new Map,u=new Map,p=new Map;for(const m of n){const e=jr().jV({block:o.getModel(),schema:a,propertyMapping:void 0,userFilterContext:{userId:r.currentUser.id,userTimeZone:(0,Sr().P)(),userStartOfWeek:Mr().XX.state},group:m,groupBy:i.getGroupByAndGroupFormats().groupBy,getRecordModel:o.getRecordModel,intl:xr().A.getIntl(),relativeVariableResult:s,currentPageInRelatedCollection:c,resultCache:d,regExpCache:u,formatDateCache:p,experimentService:er().default,spaceIdCreator:r.idCreator.getSpaceIdCreatorSync(o.getModel().space_id)});(0,Pr().l)({environment:r,blockStore:o,properties:e,transaction:l})}}var _r=()=>o(482871),Br=()=>o(802634);function Vr(e){const{groupsPointer:t,collectionContextStore:o,blocks:n,formulasModule:r,environment:i}=e,l=[];return t.forEach((e=>{var t,a;const s=null==o||null===(t=o.collectionStore())||void 0===t?void 0:t.getSchema()[e.property],c=null==o||null===(a=o.collectionStore())||void 0===a?void 0:a.getSchema(),d=new Map,u=new Map,p=new Map,m=n.flatMap((t=>{const o=t.getModel();if(s&&c&&o)return(0,mr().W)({property:e.property,schema:c,block:o,getRecordModel:t.getRecordModel,collectionRequestContext:{userId:void 0,userTimeZone:(0,Sr().P)(),depth:0,intl:xr().A.getIntl(),visitedProperties:new Set,resultCache:d,regExpCache:u,formatDateCache:p,experimentService:er().default,collectionFeatureGates:(0,br().i)()},exportedFilePaths:!1,formulasModule:r,spaceIdCreator:i.idCreator.getSpaceIdCreatorSync(t.getSpaceId())})})).filter((e=>!I().b0(e)));l.push(...m)})),I().Mp(l,I().n4)}function Er(e){var t,o,n,r;const{environment:i,collectionStore:l,targetStore:a,droppedDirection:s,droppedStores:c,transaction:d,duplicate:u,collectionContextStore:p,groupsPointer:m,subitemPath:g,formulasModule:S,duplicateActions:h}=e;if(null!=l&&l.pathIsDead())return;if(c.some((e=>(0,Cr().pQ)(e.id))))return;if(c.some((e=>{const t=e.getDiscussionStores();for(const o of t)if(o.isSuggestionDiscussion())return!0})))return;if(e.collapsedGroup&&function(e){var t;const{environment:o,droppedStores:n,duplicate:r,collectionContextStore:i,groupsPointer:l,transaction:a,duplicateActions:s}=e,c=i.collectionStore(),d=i.collectionViewStore(),u=null===(t=n[0])||void 0===t?void 0:t.getAssociatedCollectionStore(),p=u&&u.id===(null==c?void 0:c.id),m=i.hasSingleCollection()&&r,g=(0,Ir().T)({environment:o,droppedStores:n,duplicate:m,transaction:a,collectionStore:c,duplicateActions:s});for(const S of g){const e=c??S.getAssociatedCollectionStore();e&&(0,kr().j)({environment:o,store:S,collectionStore:e,collectionContextStore:i,groupsPointer:l,shouldCoerce:!0,transaction:a})}d&&(0,_r().z)({resultIds:g.map((e=>e.id)),collectionViewStore:d,collectionContextStore:i,transaction:a}),a.postSubmitCallbacks.push((async e=>{!e&&c&&(p||await dt().Bz({droppedStores:n,createdStores:g,collectionStore:c,environment:o,collectionContextStore:i,groupsPointer:l,shouldDuplicate:r}))}))}({environment:i,collectionContextStore:p,groupsPointer:m,droppedStores:c,duplicate:u,transaction:d,duplicateActions:h}),!a)return;const y=p.collectionViewStore();if(!y)return;const v=null===(t=c[0])||void 0===t?void 0:t.getAssociatedCollectionStore(),f=v&&v.id===(null==l?void 0:l.id),b=null===(o=p.groupsStore.getGroupState(m))||void 0===o?void 0:o.groupUiParentStore;if(!b)return;const x=Vr({groupsPointer:m,collectionContextStore:p,blocks:c,formulasModule:S,environment:i}),C=(null===(n=p.groupsStore.getGroupState(m))||void 0===n?void 0:n.resultsStore.state)||[],w=c.every((e=>e.isExternalObjectInstancePageBlockStore()))&&!(null!=l&&l.isSyncedCollection()&&(null===(r=c[0])||void 0===r?void 0:r.getParentId())===(null==l?void 0:l.id)),k=p.hasSingleCollection()&&(w||u);if(s===wr().bH.Onto){R().IU({environment:i});const e=a.getContentStore(),t=(0,Ir().T)({environment:i,droppedStores:c,duplicate:k,transaction:d,collectionStore:l,duplicateActions:h});for(const o of t)vr().BC({parentStore:e,appendStore:o,transaction:d});return[]}let A=!1,T=[];if(!k&&l){const e=function(e){const{environment:t,droppedStores:o,collectionStore:n,transaction:r}=e;if(!o.length)return;const i=(0,Br().K)({environment:t,stores:o,spaceId:n.getSpaceId(),transaction:r});for(const l of i){if(l.getParentTable()===hr().Vl||l.getAssociatedCollectionStore())return;if(!Lo().X$({childStore:l,parentStore:n,transaction:r}))return}return i}({environment:i,droppedStores:c,collectionStore:l,transaction:d});A=void 0!==e,T=e??[]}const j=(0,vt().kY)([...(null==g?void 0:g.map((e=>e.value.store.pointer)))??[]]),M=p.subitemExpandedStore.state.get(j),P=g&&g.length>1||(null==M?void 0:M.isExpanded)&&s===wr().bH.Below,_=p.groupsStore.getAllGroupStates();c.forEach((e=>{const t=_.find((t=>t.resultsStore.state.includes(e)));t&&!P&&Rr({environment:i,store:e,collectionContextStore:p,groupsPointer:t.groupsPointer,transaction:d})}));const B=(0,Ir().T)({environment:i,droppedStores:c,duplicate:k,transaction:d,collectionStore:l,duplicateActions:h});A||(T=(0,Br().K)({environment:i,stores:B,spaceId:a.getSpaceId(),transaction:d})),d.postSubmitCallbacks.push((async e=>{!e&&l&&(f||await dt().Bz({droppedStores:c,createdStores:B,collectionStore:l,environment:i,collectionContextStore:p,groupsPointer:m,alreadyMovedToCollection:A,shouldDuplicate:k}))}));for(const I of T){const e=l??I.getAssociatedCollectionStore();e&&(0,kr().j)({environment:i,store:I,collectionStore:e,collectionContextStore:p,groupsPointer:Boolean(P)?[]:m,shouldCoerce:!0,transaction:d,alreadyMovedToCollection:A})}l&&function(e){var t,o,n;const{environment:r,isInsertingAsSubitem:i,shouldDuplicate:l,collectionContextStore:a,collectionStore:s,droppedStores:c,wrappedStores:d,targetSubitemExpandedState:u,subitemPath:p,targetStore:m,transaction:g}=e,S=a.currentSubitemFormatStoreForCollectionStore.state,h=null==S?void 0:S.inverse,y=h&&a.normalizedSchemaStore.state[h],v=null==S?void 0:S.property,f=v&&a.normalizedSchemaStore.state[v],b=null===(t=a.collectionViewStore())||void 0===t?void 0:t.getType(),x=null===(o=a.collectionViewStore())||void 0===o?void 0:o.getFormat();if(null!==(n=a.collectionViewStore())&&void 0!==n&&null!==(n=n.getCollectionStore())&&void 0!==n&&n.isExternallyImportedAndSyncedCollection())return;const C=(null==x?void 0:x.subitem_display_mode)??"show",w=S&&b&&(0,pr().qS)(b)&&y&&(0,gr().nC)(y)&&"flattened"!==C&&"disabled"!==C,k=(0,vt().oC)(c[0]);null!=k&&k.subitemFormat&&S&&f&&(0,gr().nC)(f)&&dt().Ch({blocksToDuplicate:[...c],duplicatedBlocks:[...d],environment:r,shouldDuplicate:l,originSubitemFormat:k.subitemFormat,destinationSubitemFormat:S,transaction:g,subitemRelationSchema:f,relationPropertyCollectionId:s.id});const I=S?(0,vt().Ku)(d,S):void 0,A=I?d.filter(((e,t)=>I.includes(t))):[];for(const T of A){if(w){const e=(0,vt().eO)({store:T,subitemFormat:S,propertySchema:y});for(const t of e){const e=ne().B.createChildStore(T,t);ut().c3({environment:r,sourceStore:e,destStore:T,propertyWithInverse:S,transaction:g})}}if(i){const e=null!=u&&u.isExpanded?"into":"below";(0,Ar().i)({environment:r,collectionContextStore:a,collectionStore:s,subitemPath:p&&(null==p?void 0:p.length)>0?p:[new(yr().PH)((0,vt().f5)(m),[])],store:m,before:"into"===e,insertBlockStore:T,insertDirection:e,transaction:g})}}}({environment:i,isInsertingAsSubitem:Boolean(P),shouldDuplicate:k,collectionContextStore:p,collectionStore:l,droppedStores:c,wrappedStores:T,targetSubitemExpandedState:M,subitemPath:g,targetStore:a,transaction:d});const V=C.filter((e=>!B.includes(e))),E=V.indexOf(a),F=s===wr().bH.Above||s===wr().bH.Left?E:E+1,O=[...V.slice(0,F),...T,...V.slice(F)];(0,_r().z)({resultIds:O.map((e=>e.id)),collectionViewStore:y,collectionContextStore:p,transaction:d});const D=Vr({groupsPointer:m,collectionContextStore:p,blocks:B,formulasModule:S,environment:i}),L=I().n4(x.sort(),D.sort());f&&L&&(0,Tr().f)({environment:i,collectionContextStore:p});if(!p.collectionViewBlockStore())return;const z=P?a:b,K=T.map((e=>ne().B.createChildStore(z,{table:et().ev,id:e.id})));return R().td({environment:i,stores:K}),function(e,t){var o,n;(null===(o=e.collectionViewStore())||void 0===o?void 0:o.getFormat().app_config_uri)===Bo().Lu&&"sprint_board"===(null===(n=Ut().default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.getFormat().special_page_for_pm_launch)&&fr().tutorialAdvanceToStepAfter(t,"sprints-onboarding","sprint-task-tooltip")}(p,d),K}var Fr=()=>o(157071),Or=()=>o(357643),Dr=()=>o(319357),Lr=()=>o(873509),zr=()=>o(606273),Kr=()=>o(549500);const Hr=(0,he().YK)({setupAndDemoTitle:{id:"meetings.demoBanner.title",defaultMessage:"Setup and demo AI Meeting Notes"},setupAndDemoSubtitle:{id:"meetings.demoBanner.subtitle",defaultMessage:"Perfect for your next meeting, interview, brainstorm, "},playDemoVideo:{id:"meetings.demoBanner.playDemoVideo",defaultMessage:"Play demo video"},today:{id:"meetings.demoBanner.today",defaultMessage:"Today"}});function Wr(){const[e,t]=(0,r.useState)(!0),n=(0,m().v3)(),i=(0,he().tz)(),l=(0,r.useCallback)((()=>{t(!e)}),[e]),a=(0,y().IS)((e=>({outerContainer:{paddingBottom:20},groupHeader:{display:"flex",alignItems:"center",height:33,position:"relative",zIndex:87,width:"100%",background:e.background.primary,fontSize:14},headerContent:{display:"flex",alignItems:"center",overflow:"hidden"},groupValue:{maxWidth:400,lineHeight:"24px",marginInlineStart:6},toggleButton:{flexShrink:0},demoBannerContainer:{display:"flex",gap:14,alignItems:"center",width:"100%",padding:"5px 10px"},videoThumbnail:{width:72,height:40,borderRadius:4,backgroundImage:`url(${o(148307).A.images.aiMeetingNotes.demoThumbnailPng})`,backgroundSize:"cover",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},playButton:{position:"absolute"},playIcon:{width:20,height:20,fill:e.background.primary},textContainer:{display:"flex",flexDirection:"column",gap:2,flex:1,minWidth:0,justifyContent:"center"}})),[]),s=(0,Ce.jsxs)("div",{style:a.demoBannerContainer,children:[(0,Ce.jsx)("div",{style:a.videoThumbnail,children:(0,Ce.jsx)(Te().A,{style:a.playButton,icon:o(499872).b,iconStyle:a.playIcon,onClick:async()=>{const[e,t]=await Promise.all([Kr().$0.load(),Kr().S7.load()]),r=e.createAndNavigateToTranscriptionBlock({environment:n,from:"meetings_empty_state",title:"new_page"});r&&t.openTranscriptionDemoWithPermissions({environment:n,blockStore:r,demoTriggerSource:"meetings_empty_state"}).catch((e=>{o(165358).log({level:"error",from:"MyMeetingsCollectionViewEmptyState",type:"openTranscriptionDemoWithPermissionsFailed",error:(0,o(229833).convertErrorToLog)(e)})}))},ariaLabel:i.formatMessage(Hr.playDemoVideo),disableBackground:!0})}),(0,Ce.jsxs)("div",{style:a.textContainer,children:[(0,Ce.jsx)(nr().D,{styleKey:"Body/Medium",colorPalette:"blue",colorVariant:"secondary",children:(0,Ce.jsx)(he().sA,{...Hr.setupAndDemoTitle})}),(0,Ce.jsx)(nr().D,{styleKey:"Body/Medium",colorVariant:"tertiary",children:(0,Ce.jsx)(he().sA,{...Hr.setupAndDemoSubtitle})})]})]});return(0,Ce.jsxs)("div",{style:a.outerContainer,children:[(0,Ce.jsx)("div",{style:a.groupHeader,children:(0,Ce.jsxs)("div",{style:a.headerContent,children:[(0,Ce.jsx)(zr().f,{isSidebar:!1,open:e,fill:!0,onClick:l,style:a.toggleButton}),(0,Ce.jsx)("div",{style:a.groupValue,children:(0,Ce.jsx)(nr().D,{styleKey:"Body/Medium",colorVariant:"primary",children:(0,Ce.jsx)(he().sA,{...Hr.today})})})]})}),e?s:void 0]})}var Nr=()=>o(384446);const Gr=(0,he().YK)({noResults:{id:"collectionView.emptyState.noResults",defaultMessage:"No results"},noResultsTooltip:{id:"collectionView.emptyState.noResultsTooltip",defaultMessage:"There is nothing to show in this view, and you do not have permission to create new items."},editGroups:{id:"collectionView.emptyState.editGroups",defaultMessage:"Edit groups"},clearSearch:{id:"collectionView.emptyState.clearSearch",defaultMessage:"Clear search"},editFilters:{id:"collectionView.emptyState.editFilter",defaultMessage:"Edit filters"}});const $r=r.memo((function(e){const{collectionContextStore:t,paddingLeft:n,paddingRight:i,groupByKeyToOpen:l,headerWidth:a,groupsPointer:c}=e,d=(0,m().v3)(),u=s().A.isMobile,p=(0,he().tz)(),{isPhone:g}=(0,m().Y0)(),{value:S}=(0,ft().fJ)(yt().VI.duplicateActions),v=(0,h().O$)(t.isFullScreenStore),f=(0,h().O$)(t.searchQueryStore),b=(0,h().O$)(t.viewsModuleContextStore),x=(0,h().K8)((()=>t.collectionViewStore()),[t]),C=(0,h().K8)((()=>t.getViewType()??"table"),[t]),w=(0,h().K8)((()=>t.collectionViewBlockStore()),[t]),k=(0,h().K8)((()=>t.collectionStore()),[t]),I=(0,Nr().X5)(t),A=(0,o(739375).yv)({disableExposureLogging:!0});(0,r.useEffect)((()=>{I&&A&&er().default.checkGate({gateName:"ai_meeting_notes_demo_available"})}),[I,A]);const T=(0,h().K8)((()=>(0,Lr().N)({collectionContextStore:t}).length>0),[t]),j=(0,h().K8)((()=>(0,ro().E)(d)&&t.permissionScopesStore.state.canEditContent),[d,t.permissionScopesStore]),M=(0,h().K8)((()=>t.permissionScopesStore.state.canConfigureCollection),[t.permissionScopesStore]),P=r.useCallback((async e=>{const o=await Rt().T.formulas.load();_().createAndCommit({userAction:"CollectionViewEmptyState.handleDrop",environment:d,canUndo:!0,perform:n=>{if(!k||!w)return;const r=(0,Qn().H2)(t.normalizedFormatStore.state,"board"===C?"board_columns_by":"collection_group_by","board"===C?"board_columns":"collection_groups");let i;if(r){const e=t.normalizedSchemaStore.state[r.property];if(e&&(0,Qn().Eg)(e)){const t=(0,Qn().ro)(e);t&&(i={property:r.property,value:t})}}Er({environment:d,collectionContextStore:t,collectionStore:k,targetStore:w,droppedDirection:wr().bH.Above,groupsPointer:c??(i?[i]:[]),droppedStores:e.droppedStores,duplicate:e.duplicate,collapsedGroup:!1,formulasModule:o,transaction:n,duplicateActions:S})}})}),[d,t,w,k,C,c,S]),R=(0,r.useMemo)((()=>{if(x){if(""!==f)return{title:p.formatMessage(Gr.clearSearch),onClick:()=>{t.searchQueryStore.setState("")},iconLeading:void 0};if(T)return{title:p.formatMessage(Gr.editFilters),onClick:()=>{g?F().R8({collectionSettingsStore:t.settingsStore,item:{type:"phoneFilterAndSort"}}):Boolean(b)?t.filtersBarOpenStore.state?t.filterBarFlashTriggerStore.update((e=>e+1)):t.filtersBarOpenStore.setState(!0):F().R8({collectionSettingsStore:t.settingsStore,item:{type:"filters"}})},iconLeading:ir().filterSmallIcon};if(M){const e=l??"collection_group_by";return{title:p.formatMessage(Gr.editGroups),onClick:()=>{F().R8({collectionSettingsStore:t.settingsStore,item:{type:"group",groupByKey:e,groupsFormatKey:"board"===C||"gallery"===C?Qn().Hw[e]:Qn().V1}})},iconLeading:ar}}}}),[x,T,p,t.settingsStore,t.filtersBarOpenStore,t.filterBarFlashTriggerStore,t.searchQueryStore,g,l,f,C,M,b]),B=(0,y().IS)((()=>{const e=function(e){const{isFullScreen:t,isMobile:o,isInViewsModule:n,groupsPointer:r}=e;return r&&r.length>0?72:t||o||n?144:72}({isFullScreen:v,isMobile:Boolean(u),isInViewsModule:Boolean(b),groupsPointer:c});return{container:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",flexWrap:"wrap",alignContent:"center",gap:u?16:12,..."timeline"===C?{position:"relative",width:"100%",height:c?e:"100%"}:{position:"sticky",insetInlineStart:n,height:e,width:a-n-i,marginInlineStart:"gallery"===C?void 0:`-${n}px`,marginInlineEnd:"gallery"===C?void 0:`-${i}px`}},noResultsContainer:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:4}}}),[v,u,b,C,c,n,a,i]);if(!w)return null;if(I&&A)return(0,Ce.jsx)(Wr,{});const V=c&&1===c.length?`collection_view_empty_state_${w.id}_${(0,Qn().Ix)(c.at(0))}`:`collection_view_empty_state_${w.id}`;return(0,Ce.jsx)(o(13679).A,{store:w,droppable:j,render:()=>(0,Ce.jsxs)(o(218557).Tl,{dropTargetKey:V,style:B.container,canNativeDropOnto:!1,keepTextSelectionOnDrop:!0,shouldShowDropZone:j,canAcceptDrop:()=>j,canDropOnto:j,onSelectableDrop:P,className:Vt()._XL,children:[void 0!==R?(0,Ce.jsx)(Ur,{...R}):void 0,j?(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)(qr,{collectionContextStore:t,groupsPointer:c,viewType:C}),(0,Ce.jsx)(Xr,{collectionContextStore:t})]}):void 0,j||void 0!==R?void 0:(0,Ce.jsx)(qo().A,{placement:"top",render:e=>(0,Ce.jsx)(nr().D,{styleKey:"Body/Regular",colorVariant:"tertiary",colorPalette:"gray",children:(0,Ce.jsxs)("div",{...e,style:B.noResultsContainer,children:[(0,Ce.jsx)(he().sA,{...Gr.noResults}),(0,Ce.jsx)(ie().I,{icon:o(406533).questionMarkCircleIcon})]})}),renderTooltip:()=>(0,Ce.jsx)(he().sA,{...Gr.noResultsTooltip})})]})})}));function Ur(e){const{title:t,onClick:o,iconLeading:n}=e,r=s().A.isMobile,i=(0,y().IS)((()=>({plainButton:{fontSize:r?17:14}})),[r]);return(0,Ce.jsx)(or().A,{onClick:o,colorPalette:"gray",style:i.plainButton,size:r?"xl":void 0,iconLeading:n?{icon:n,size:"sm"}:void 0,children:t})}function qr(e){const{collectionContextStore:t,viewType:n,groupsPointer:i}=e,l=(0,m().v3)(),a=s().A.isMobile,c=(0,h().O$)(t.isFullScreenStore),d=(0,h().O$)(t.viewsModuleContextStore),u=(0,h().O$)(t.isInPeekRendererStore),p=(0,h().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[t]),g=(0,r.useCallback)((()=>{let e=t.collectionViewBlockStore(),r=t;if(null!=d&&d.collectionViewBlockStore){e=d.collectionViewBlockStore;const t=(0,o(799832).U)(e);t&&(r=t)}e&&(t.searchQueryStore.state&&(0,Or().S)({searchQuery:"",collectionContextStore:t,isFullScreen:c}),_().createAndCommit({userAction:"CollectionViewEmptyState.handleAddPage",environment:l,canUndo:!0,perform:a=>{let s;const c=t.isMultiSourceView?"center_peek":(0,W().hH)(t);if("table"!==n&&"list"!==n&&"timeline"!==n)s=(0,o(248662).T)({transaction:a,store:e,collectionContextStore:r,environment:l,shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,from:{createBlock:"collection_view_empty_state"},showMoveTo:!1,peekModeOverride:c}),s&&sr().vH(l,{from:"collection_view_empty_state",type:"page",new_page_id:s.id,creating_block_id:e.id,...(0,Et().sl)(t)});else{const e=(0,ur().Q)({environment:l,collectionContextStore:t,groupsPointer:i??[],shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:a,from:{createBlock:"collection_view_empty_state"},inMemoryRecordCache:l.defaultRecordCache.inMemoryRecordCache});if(!e)return;if(s=e.newStore,e.coercionSucceeded){const e=()=>{s&&("table"===n||"timeline"===n?dr().ho({isNewBlock:!0,environment:l,blockPropertyValueOverlayStore:u?qn().A:Un().A,store:s,property:"title",surface:"table",collectionContextStore:t}):"list"===n?(0,Fr().v7)({environment:l,newStore:s,previousStore:void 0}):(0,A().HB)(n))};t.registerCallbackForItemMounted(s,e)}else Jn().VU({environment:l,store:s,peekMode:c,collectionContextStore:t,pageVisitSource:$().y8.Create,resultsStore:void 0})}}}))}),[t,d,l,c,n,i,u]),S=(0,y().IS)((()=>({plainButton:{fontSize:a?17:14}})),[a]),v=a?"xl":void 0;return(0,Ce.jsx)(or().A,{onClick:g,colorPalette:"gray",iconLeading:{icon:gn().plusSmallIcon,size:"sm"},style:S.plainButton,size:v,children:(0,Ce.jsx)(he().sA,{defaultMessage:"New {itemType}",id:"collectionView.emptyState.addNewPage",values:{itemType:(0,cr().$O)(p)}})})}function Xr(e){const{collectionContextStore:t}=e,o=(0,m().v3)(),n=(0,he().tz)(),r=s().A.isMobile,i=(0,h().K8)((()=>(0,W().fG)({collectionContextStore:t,environment:o,intl:n})),[t,o,n]),l=(0,y().IS)((()=>({plainButton:{fontSize:r?17:14}})),[r]);if(!i)return null;const a=r?"xl":void 0;return(0,Ce.jsx)(Dr().O,{collectionContextStore:t,groupFormat:void 0,onAddOrLink:void 0,renderLinkButton:e=>(0,Ce.jsx)(or().A,{...e,colorPalette:"gray",iconLeading:{icon:rr().arrowDiagonalUpRightSmallIcon,size:"sm"},style:l.plainButton,size:a,children:(0,Ce.jsx)(he().sA,{defaultMessage:"Link existing",id:"collectionView.emptyState.linkExisting"})})})}class Yr extends f().Store{getInitialState(){}}const Qr=Yr;var Zr=()=>o(101981),Jr=()=>o(325383),ei=()=>o(396671),ti=()=>o(700500),oi=()=>o(557281),ni=()=>o(901389),ri=()=>o(712257),ii=()=>o(797535),li=()=>o(543665),ai=()=>o(800002);const si=(0,he().YK)({optionAlreadyExists:{id:"handleCollectionAddGroupButtonAccept.optionAlreadyExists",defaultMessage:"Option already exists"}});async function ci(e){const{update:t,collectionContextStore:o,groupsFormatKey:n,collectionStore:r,environment:i,schema:l,groupBy:a}=e,s=l[a.property];if(!s)return;const c="relation"===s.type&&(0,gr().zO)(s),d=c&&new(li().m)(i,{table:hr().Vl,id:c});d&&await d.load(),_().createAndCommit({userAction:"collectionGroupActions.handleCollectionAddGroupButtonAccept",environment:i,canUndo:!0,perform:e=>{if(t.newGroups){if(t.newGroup){const e=t.newGroup;if((0,gr().DQ)(s)){var l;const t="select"===e.value.type||"multi_select"===e.value.type?e.value.value:"status"===e.value.type&&"by_option"===(null===(l=e.value.value)||void 0===l?void 0:l.type)?e.value.value.option:void 0;if(t){var a;if(null===(a=s.options)||void 0===a?void 0:a.find((e=>e.value.toLowerCase()===t.toLowerCase())))return void ni().f1(xr().A.formatMessage(si.optionAlreadyExists))}}}(0,ai().o)({collectionContextStore:o,newGroups:t.newGroups,groupsFormatKey:n,transaction:e}),ri().RZ({transaction:e,newGroups:t.newGroups,collectionContextStore:o,environment:i})}if(t.newSchema&&(0,ii().I)({environment:i,collectionStore:r,update:{schema:t.newSchema},transaction:e}),t.newPage&&"relation"===s.type&&d){const o=(0,k().x9d)(t.newPage.name),n=fe().Wv({environment:i,id:t.newPage.id,type:ti().xd.page,spaceId:t.newPage.spaceId,properties:{title:o},inMemoryRecordCache:r.inMemoryRecordCache,transaction:e});Lo().X$({parentStore:d,childStore:n,transaction:e});const l=d.getDefaultTemplatePageStore();l&&oi().n5({title:{text:o},environment:i,store:ne().B.createChildStore(d,n.pointer),templateStore:l,isKeyboard:!1,isCreateIn:!1,transaction:e,from:"collection_group_actions"})}}})}var di=()=>o(934201);function ui(e){const{isMobile:t,collectionContextStore:o,groupBy:n,subGroupBy:r}=e,i=o.groupsStore,l=(0,W().CG)(o,t),a=i.getAllGroupStates(),s=r?"intersection":"independent",c=o.getViewType(),d=o.normalizedFormatStore.state,u="board"===c?null==d?void 0:d.board_cover:"gallery"===c?null==d?void 0:d.gallery_cover:void 0,p={type:s,defaultLimit:l,loadContentCover:Boolean(u&&"page_content"===u.type),groupOverrides:{}};for(const m of a){const e=m.currentLimit.state;if(e===l)continue;const t=m.groupsPointer;if("independent"!==s||1!==t.length){if("intersection"===s&&2===t.length&&r){const o=t.at(1),i=t.at(0);if(!o||o.value.type!==n.type)continue;if(!i||i.value.type!==r.type)continue;const l=(0,Qn().AC)(o.value),a=(0,Qn().AC)(i.value);p.groupOverrides[(0,Qn().A)([a,l])]={limit:e}}}else{const o=t.at(0);if(!o||o.value.type!==n.type)continue;const r=(0,Qn().AC)(o.value);p.groupOverrides[r]={limit:e}}}return p}var pi=()=>o(206267),mi=()=>o(968021);const gi=30,Si=4,hi=4,yi=(0,he().YK)({addGroup:{defaultMessage:"New group",id:"database.boardView.addGroupButtonTitle"}}),vi=r.memo((function({style:e,groupBy:t,groupFormatKey:n,currentGroups:i,schema:l,groupsLimitStore:a,collectionContextStore:c,parentStore:d,onAccept:u,disabled:p}){const g=(0,m().v3)(),S=s().A.isMobile,v=(0,he().tz)(),f=l[t.property],b=(0,h().uB)(void 0,qt().A),x=(0,y().IS)((t=>({button:{display:"flex",marginTop:Si,marginBottom:hi,width:"max-content",fontSize:S?mi().hN:mi().Mi,...e}})),[S,e]),C=(0,r.useCallback)((e=>{!function({schema:e,groupBy:t,groupFormatKey:o,currentGroups:n,groupsLimitStore:r,collectionContextStore:i,onAccept:l,environment:a,buttonPopupStore:s,update:c}){var d;const{newGroupValue:u}=c,p=e[t.property],m=r.state;if(!p||!(0,Qn().Eg)(p))return;"board"===i.getViewType()?(0,T().X)({environment:a,collectionContextStore:i,action:"board_add_group"}):(0,T().X)({environment:a,collectionContextStore:i,action:"add_group"});s.reset();const g=(null===(d=i.collectionViewStore())||void 0===d?void 0:d.getFormatStore().getKeyStore(o).getValue())??[];if(gr().lx(p)){if(p.type!==u.type)return;if(void 0===u.value)return;const o=p.options||[],r={id:pi().JW(),value:u.value,color:(0,gr().Zd)(o)},i=[...o,r],a={...p,options:i},s={...e,[t.property]:a},c={property:t.property,value:u,hidden:!1};l({newGroups:(0,di().DF)({groupByFormat:t,currentGroups:n,formatGroups:g,newGroupFormat:c,groupsLimit:m}),newSchema:s,newGroup:c})}else if("person"===p.type||"relation"===p.type||(0,Qn().Vs)(p.type)){const e={property:t.property,value:u,hidden:!1};l({newGroups:(0,di().DF)({groupByFormat:t,currentGroups:n,formatGroups:g,newGroupFormat:e,groupsLimit:m}),newPage:c.newPage,newGroup:e})}else(0,Qn()._o)(p.type)||"status"===p.type||"number"===p.type||"created_by"===p.type||"last_edited_by"===p.type||"formula"===p.type||"checkbox"===p.type||"location"===p.type||(0,A().HB)(p.type)}({schema:l,groupBy:t,groupFormatKey:n,currentGroups:i,groupsLimitStore:a,collectionContextStore:c,onAccept:u,environment:g,buttonPopupStore:b,update:e})}),[b,c,i,g,t,n,a,u,l]),w=(0,r.useCallback)((()=>{!function(e){e.reset()}(b)}),[b]),k=(0,r.useCallback)((()=>(0,Ce.jsx)(o(271080).p,{groupFormat:void 0,groupBy:t,currentGroups:i,schema:l,onChange:C,onClose:w,parentStore:d})),[i,t,C,w,d,l]);return f&&(0,Qn().Eg)(f)?(0,Ce.jsx)(Ae().A,{render:k,buttonPopupStore:b,popupType:S?Ae().z.BottomSheet:Ae().z.Popup,renderOrigin:e=>(0,Ce.jsx)(_o().p,{...e,colorPalette:"gray",colorVariant:"tertiary",iconLeading:{icon:S?ge().plusIcon:gn().plusSmallIcon,size:S?"default":"sm"},style:x.button,disabled:p,children:v.formatMessage(yi.addGroup)})}):null}),tr().A);var fi=()=>o(970560),bi=()=>o(725976);function xi({nodeRef:e,width:t,isFirst:n,children:i,clipLeftExtra:l}){const a=(0,r.useMemo)(o(498212).Ay,[]),[s,c]=(0,r.useState)(0),[d,u]=(0,r.useState)(0),{ceiling:p,floor:m,stickyHorizontally:g}=(0,r.useContext)(bi().m),S=(0,r.useContext)(fi().e),y=(0,r.useContext)(o(150866).j8),v=(0,r.useRef)(null),f=(0,r.useRef)(null),b=(0,r.useRef)(null),x=(0,r.useRef)(null),C=(0,r.useRef)(null),[w,k]=(0,r.useState)("in"),[I,A]=(0,r.useState)("in"),[T,j]=(0,r.useState)("in"),M=(0,r.useCallback)((e=>{for(const o of e){var t;const e=o.isIntersecting?"in":o.boundingClientRect.y<((null===(t=o.rootBounds)||void 0===t?void 0:t.y)||0)?"above":"below";o.target===b.current?j(e):o.target===v.current?k(e):o.target===C.current&&A(e)}}),[]);(0,r.useEffect)((()=>{if(!y.current||!v.current||!C.current)return;const e=-1*(d+0),t=-1*(s+0+((null==S?void 0:S.stickyCeilingPortalsHeight)||0)),o=new IntersectionObserver(M,{root:y.current,threshold:[0,1],rootMargin:`${-1*((null==S?void 0:S.stickyCeilingPortalsHeight)||0)}px 0px ${e}px 0px`});o.observe(v.current);const n=new IntersectionObserver(M,{root:y.current,threshold:[0,1],rootMargin:`${t}px 0px 0px 0px`});n.observe(C.current);const r=new IntersectionObserver(M,{root:y.current,threshold:[0],rootMargin:`${t}px 0px ${e}px 0px`});return b.current&&r.observe(b.current),()=>{o.disconnect(),r.disconnect(),n.disconnect()}}),[M,null==S?void 0:S.stickyCeilingPortalsHeight,y,s,d]);const{effectiveTopMarkerState:P,ceilingIsSticky:R,floorIsSticky:_,ceilingIsTransitioning:B,floorIsTransitioning:V}=function({isFirst:e,parentTopMarkerState:t,contentMarkerState:o,topMarkerState:n,bottomMarkerState:r}){const i="in"===o?"in"===n?"in":"above":o,l=e&&t&&"below"!==i?t:i,a="in"===o?"in"===r?"in":"below":o,s=a,c="above"===l&&"above"!==s,d="below"!==l&&"below"===s,u=!c&&"above"===l,p=!d&&"below"===s;return{effectiveTopMarkerState:l,effectiveBottomMarkerState:s,ceilingIsSticky:c,floorIsSticky:d,ceilingIsTransitioning:u,floorIsTransitioning:p}}({isFirst:n,parentTopMarkerState:null==S?void 0:S.topMarkerState,contentMarkerState:T,topMarkerState:w,bottomMarkerState:I}),E=(0,r.useCallback)(((e,t)=>{("ceiling"===e?c:u)((e=>e+t))}),[]),F=(0,r.useRef)([]),O=(0,r.useRef)([]),D=(0,r.useCallback)(((e,t)=>{const o="ceiling"===e?F:O;return o.current.push(t),()=>{o.current.splice(o.current.indexOf(t),1)}}),[]),L=(0,r.useMemo)((()=>({id:a,ceilingIsSticky:R,ceilingIsTransitioning:B,containerNode:e,floorIsSticky:_,floorIsTransitioning:V,topMarkerState:P,provideHeight:E,ceilingTransitionRef:f,floorTransitionRef:x,stickyCeilingPortalsHeight:s,registerPortal:D})),[a,R,B,_,e,E,P,f,x,V,s,D]),z=-1*(0,r.useContext)(o(155129).X),{horizontalScroller:K}=(0,r.useContext)(Pt().R)||{},H=(0,h().K8)((()=>null==K?void 0:K.getStore().state.elementRef),[K]),W=(0,o(141333).Xg)(H??{current:null}),N=H?`${W}px`:"100%";return(0,r.useEffect)((()=>{if(!p||!m||!e.current||g)return;const t=F.current;for(let e=0;e<t.length;e++){const o=t[e].parentElement;o&&(o.style.width=R?N:"initial")}const o=O.current;for(let e=0;e<o.length;e++){const t=o[e].parentElement;t&&(t.style.width=_?N:"initial")}}),[R,p,a,_,m,e,N,g]),(0,r.useEffect)((()=>{if(!e.current||!y.current||g)return;const t=e.current.closest(`.${Vt().XGs}.${Vt().Dkd}`),o=e.current.closest(`.${Vt().XGs}.${Vt().RYy}`);if(!t||!o)return;const n=t.closest(".layout");let r=null;const i=e=>{e.target===n&&a(e)},a=(...e)=>{r||(r=requestAnimationFrame((()=>{r=null;const e=t.scrollLeft,n=t.getBoundingClientRect(),i=o.getBoundingClientRect(),a=n.x-i.x,s=e-a;if(R&&p){const t=F.current,o=void 0===l||0===l?0:l-a;for(let r=0;r<t.length;r++)t[r].style.marginInlineStart=-1*s+"px",t[r].style.marginInlineEnd=`${s}px`,t[r].style.clipPath=`rect(-100px ${e+n.width}px calc(100% + 100px) ${e+o}px)`,t[r].style.setProperty("--sticky-horizontal-offset",(0===o?-1*a:0)+"px")}else{const e=F.current;for(let t=0;t<e.length;t++)e[t].style.marginInlineStart="",e[t].style.marginInlineEnd="",e[t].style.clipPath="",e[t].style.removeProperty("--sticky-horizontal-offset")}if(_&&m){const t=O.current;for(let o=0;o<t.length;o++)t[o].style.marginInlineStart=-1*s+"px",t[o].style.marginInlineEnd=`${s}px`,t[o].style.clipPath=`rect(-10px ${e+n.width}px calc(100% + 10px) ${e}px)`}else{const e=O.current;for(let t=0;t<e.length;t++)e[t].style.marginInlineStart="",e[t].style.marginInlineEnd="",e[t].style.clipPath=""}})))};a(),t.addEventListener("scroll",a,{passive:!0});const s=new ResizeObserver(a);return s.observe(y.current),s.observe(t),s.observe(o),null==n||n.addEventListener("transitionend",i),()=>{t.removeEventListener("scroll",a),r&&cancelAnimationFrame(r),null==n||n.removeEventListener("transitionend",i),s.disconnect()}}),[a,R,_,e,y,B,p,m,g,l,z]),(0,Ce.jsxs)(fi().e.Provider,{value:L,children:[(0,Ce.jsx)("div",{ref:x,style:{position:"absolute",zIndex:999,width:"100%"}}),(0,Ce.jsx)("div",{ref:v,style:{height:0,marginTop:-0,pointerEvents:"none",width:t}}),(0,Ce.jsx)("div",{ref:b,style:{contain:"layout",width:t},children:i}),(0,Ce.jsx)("div",{ref:C,style:{height:0,marginTop:-0,pointerEvents:"none",width:t,clear:"both",transform:"translateY(0px)"}}),(0,Ce.jsx)("div",{ref:f,style:{position:"absolute",zIndex:999,width:"100%",transform:`translateY(-${s}px)`}})]})}function Ci(e){const{environment:t,groupFormat:n,collectionContextStore:r}=e,i=r.collectionViewStore();if(!i)return;const l=r.groupsStore.getGroupState(n);if(!l)return;const a=o(763884).K.get({userId:t.currentUser.id,key:(0,o(801742).i)(i.id,n)});l.toggleStateStore.setState(a??!0)}var wi=()=>o(588316),ki=()=>o(852302),Ii=()=>o(888643),Ai=()=>o(519200),Ti=()=>o(116952);function ji(e){const{environment:t,collectionContextStore:o,groupFormat:n,newGroupFormat:r,groupsFormatKey:i,currentGroups:l,transaction:a}=e,s=o.collectionStore();!(0,Qn().OF)(n.value,r.value)&&s&&(0,Ti().a)({environment:t,collectionStore:s,property:n.property,oldValue:n.value,newValue:r.value,preventPublishAppEventsForBlockUpdates:!1,transaction:a});const c=l.map((e=>(0,Qn().OF)(n.value,e.value)?r:e));(0,ai().o)({collectionContextStore:o,newGroups:c,groupsFormatKey:i,transaction:a})}function Mi(e){const{newGroupValue:t,groupFormat:o,schema:n,collectionContextStore:r,currentGroups:i,groupsFormatKey:l,collectionStore:a,environment:s}=e,c=n[o.property];if(!c)return;if(!(0,Qn().Eg)(c))return;const d=o.value;if((0,gr().lx)(c)){if(d.type!==c.type)return;if(t.type!==c.type)return;if(void 0===t.value)return;const e=c.options||[],n=t.value,u=e.map((e=>e.value===d.value?{...e,value:n}:e)),p={...c,options:u},m={...o,value:{...d,value:n}};_().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:s,canUndo:!0,perform:e=>{ji({environment:s,collectionContextStore:r,groupFormat:o,newGroupFormat:m,currentGroups:i,transaction:e,groupsFormatKey:l}),(0,ii()._)({environment:s,collectionStore:a,propertyId:o.property,newPropertySchema:p,transaction:e})}})}else if("person"!==c.type)if((0,Qn().Vs)(c.type)){if(d.type!==c.type)return;if(t.type!==c.type)return;if(!t.value||"exact"!==t.value.type)return;const e={...o,value:t};_().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:s,canUndo:!0,perform:t=>{ji({environment:s,collectionContextStore:r,groupFormat:o,newGroupFormat:e,currentGroups:i,groupsFormatKey:l,transaction:t})}})}else"status"===c.type||(0,Qn()._o)(c.type)||"created_by"===c.type||"last_edited_by"===c.type||"number"===c.type||"checkbox"===c.type||"formula"===c.type||"relation"===c.type||"location"===c.type||(0,A().HB)(c.type);else{if(d.type!==c.type)return;if(t.type!==c.type)return;const e={...o,value:t};_().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:s,canUndo:!0,perform:t=>{ji({environment:s,collectionContextStore:r,groupFormat:o,newGroupFormat:e,currentGroups:i,groupsFormatKey:l,transaction:t})}})}}var Pi=()=>o(89849),Ri=()=>o(871151),_i=()=>o(100622),Bi=()=>o(654062),Vi=()=>o(314660),Ei=()=>o(575143),Fi=()=>o(893952),Oi=()=>o(161479);const Di=(0,o(583835).Dv)("deleteGroup");var Li=()=>o(357625);var zi=()=>o(604656);const Ki="color";const Hi=function({parent:e,groupFormat:t,collectionContextStore:o,groupsFormatKey:n,format:i,query:l,currentGroups:a,schema:s}){const c=(0,m().v3)(),d=(0,he().tz)(),{device:u}=c,p=(0,h().O$)(v().e),g=(0,h().K8)((()=>I().oE([Gi({environment:c,groupFormat:t,collectionContextStore:o,groupsFormatKey:n,format:i,query:l,currentGroups:a,intl:d,isOnline:p}),Ni(c,s,t,o)])),[c,t,o,n,i,l,a,d,s,p]),S=(0,r.useCallback)((t=>{"string"==typeof t.key&&t.key.includes(Ki)||e.close()}),[e]);let y;return y=u.isMobile?{menuType:Fe().gu.Modal,title:(0,Ce.jsx)(he().sA,{defaultMessage:"Action",id:"database.collectionGroupActionMenu.title"}),right:(0,Ce.jsx)(Re().DoneMenuText,{}),onClickRight:e.close}:{menuType:Fe().gu.Popup},(0,Ce.jsx)(Me().A,{...y,children:(0,Ce.jsx)(Pe().Ay,{type:Pe().Oh.Vertical,initialFocus:0,sections:g,onAccept:S})})};async function Wi(e,t,o,n,r,i){const l=t.collectionStore();if(!l)return;const a=n.value;if("relation"===a.type&&(0,Qn().WO)(a.value)){const e=ne().B.createChildStore(l,{id:a.value.id,table:et().ev});await e.load();const t=e.getAssociatedCollectionStore();await(null==t?void 0:t.load())}_().createAndCommit({userAction:"CollectionGroupActionMenu.handleDelete",environment:e,canUndo:!0,perform:a=>{!function(e){const{environment:t,collectionStore:o,groupsFormatKey:n,property:r,groupFormat:i,currentGroups:l,collectionContextStore:a,transaction:s,intl:c}=e,d=o.getSchema(),u=d[i.property],p=l.filter((e=>!(0,Qn().OF)(i.value,e.value)));(0,ai().o)({collectionContextStore:a,newGroups:p,groupsFormatKey:n,transaction:s});const m=i.value;if(u&&(0,gr().lx)(u)&&m.type===u.type&&o){const e=(u.options||[]).filter((e=>e.value!==m.value)),n={...u,options:e},r={...d,[i.property]:n};(0,ii().I)({environment:t,collectionStore:o,update:{schema:r},transaction:s})}const g=t.currentUser.id,S=new Map,h=new Map,y=new Map,v=o.pointer.spaceId,f=t.idCreator.getSpaceIdCreatorSync(v??"");o.inMemoryRecordCache.forEachRecord(g,(async({model:e})=>{if(e.table!==et().ev)return;const n=ne().B.createChildStore(o,e.pointer);if(jr().xw({block:e,groupBy:a.getGroupByAndGroupFormats().groupBy,schema:d,property:r,value:m,intl:c,timeZone:(0,Sr().P)(),getRecordModel:o.getRecordModel,resultCache:S,regExpCache:h,formatDateCache:y,experimentService:er().default,collectionFeatureGates:(0,br().i)(),spaceIdCreator:f}))if(e.parent_id===o.id)Lo().by({childStore:n,transaction:s});else{const e=n.getAssociatedCollectionStore();e&&e.id===o.id&&("page"===n.getType()||"collection_view_page"===n.getType()&&!n.isCollectionViewPageWithContent())&&await pt().Af({environment:t,blocks:[n],shouldCheckSuggestEdit:!0})}})),o.isDefaultRecordCache()&&s.postSubmitCallbacks.push((async e=>{const n=await Li().UT(t,Di,{collection:{id:o.id,spaceId:(0,Oi().e)(o.pointer.spaceId)},property:r,value:m},{spaceIds:[]}).next();if(n.value.error)throw n.value.error}))}({environment:e,collectionStore:l,property:n.property,groupFormat:n,currentGroups:o,groupsFormatKey:r,collectionContextStore:t,transaction:a,intl:i})}}),(0,T().X)({environment:e,collectionContextStore:t,action:"delete_group"})}function Ni(e,t,o,n){const r=o.value;if(void 0===r.value)return;const i=t[o.property];if(!i)return;if("select"!==i.type&&"multi_select"!==i.type)return;if(r.type!==i.type)return;const l=(i.options||[]).find((e=>e.value===r.value));if(!l)return;const a=_i().tS.map((r=>{const i={key:`${Ki}_${r}`,render:e=>(0,Ce.jsx)(Fi().A,{...e,color:r,isChecked:l.color===r}),action:()=>{!function(e,t,o,n,r){const i=n[o.property];if(!i)return;if(!gr().lx(i))return;const l=r.collectionStore();if(!l)return;const a=o.value;if(a.type!==i.type)return;const s=(i.options||[]).map((t=>t.value===a.value?{...t,color:e}:t)),c={...i,options:s},d={...n,[o.property]:c};_().createAndCommit({userAction:"CollectionGroupActionMenu.handleSelectPropertyColorPickerChange",environment:t,canUndo:!0,perform:e=>{(0,ii().I)({environment:t,collectionStore:l,update:{schema:d},transaction:e})}}),(0,T().X)({environment:t,collectionContextStore:r,action:"group_change_color"})}(r,e,o,t,n)}};return i}));return{key:"collection color section",render:e=>(0,Ce.jsx)(Be().A,{...e,title:(0,Ce.jsx)(he().sA,{defaultMessage:"Colors",id:"database.collectionGroupActionMenu.colorSectionTitle"}),topBorder:!0}),items:a}}function Gi(e){var t;const{environment:o,groupFormat:n,collectionContextStore:r,groupsFormatKey:i,format:l,query:a,currentGroups:s,intl:c,isOnline:d}=e,u=[],p=n.value,m=r.permissionScopesStore.state,g="board_columns"===i?void 0===a.aggregations:void 0===l.collection_group_aggregation;d&&u.push({key:"editGroups",render:e=>(0,Ce.jsx)(Ei().A,{...e,title:(0,Ce.jsx)(he().sA,{defaultMessage:"Edit groups",id:"database.collectionGroupActionMenu.editGroupsTitle"}),svg:Ri().p}),action:()=>{F().a2({collectionSettingsStore:r.settingsStore,item:{type:"group",groupByKey:"collection_groups"===i?"collection_group_by":"board_columns_by",groupsFormatKey:i}})}}),d&&(g?u.push({key:"addAggregation",render:e=>(0,Ce.jsx)(Ei().A,{...e,title:(0,Ce.jsx)(he().sA,{defaultMessage:"Show aggregation",id:"database.collectionGroupActionMenu.addAggregationTitle"}),svg:Pi().eyeIcon}),action:()=>function(e,t,o,n){const r=n.collectionViewStore();if(r)if("board_columns"===t){const t={...o,aggregations:[Qn().VR]};_().createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,canUndo:!0,perform:e=>{(0,Bi().F)({collectionViewStore:r,update:{query2:t},transaction:e})}})}else _().createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,canUndo:!0,perform:e=>{ve().zA({stores:[r],update:{collection_group_aggregation:Qn().VR},transaction:e})}})}(o,i,a,r)}):u.push({key:"removeAggregation",render:e=>(0,Ce.jsx)(Ei().A,{...e,title:(0,Ce.jsx)(he().sA,{defaultMessage:"Hide aggregation",id:"database.collectionGroupActionMenu.removeAggregationTitle"}),svg:de().e}),action:()=>function(e,t,o,n){const r=n.collectionViewStore();if(r)if("board_columns"===t){const t={...o,aggregations:null};_().createAndCommit({userAction:"CollectionGroupActionMenu.handleHideGroupAggregation",environment:e,canUndo:!0,perform:e=>{(0,Vi().f)({collectionViewStore:r,update:t,transaction:e})}})}else _().createAndCommit({userAction:"CollectionGroupActionMenu.handleHideGroupAggregation",environment:e,canUndo:!0,perform:e=>{ve().zA({stores:[r],update:{collection_group_aggregation:null},transaction:e})}})}(o,i,a,r)})),n.hidden||n.hiddenByDefault?u.push({key:"show",render:e=>(0,Ce.jsx)(Ei().A,{...e,title:(0,Ce.jsx)(he().sA,{defaultMessage:"Show group",id:"database.collectionGroupActionMenu.showButtonTitle"}),svg:Pi().eyeIcon}),action:()=>{(0,zi().m)({environment:o,collectionContextStore:r,groupsFormatKey:i,groupFormat:n,action:"toggle_group_visibility",currentGroups:s})}}):u.push({key:"hide",render:e=>(0,Ce.jsx)(Ei().A,{...e,title:(0,Ce.jsx)(he().sA,{defaultMessage:"Hide group",id:"database.collectionGroupActionMenu.hideButtonTitle"}),svg:de().e}),action:()=>{(0,zi().m)({environment:o,collectionContextStore:r,groupsFormatKey:i,groupFormat:n,action:"toggle_group_visibility",currentGroups:s})}}),void 0===p.value||!m.canEditContent||m.isSyncedCollection||"collectionTypedView"===r.contextType||m.isExternallyImportedAndSyncedCollection||(0,b().TR)(null===(t=r.collectionViewStore())||void 0===t?void 0:t.getCollectionSource())||u.push({key:"delete",render:e=>(0,Ce.jsx)(Ei().A,{...e,title:(0,Ce.jsx)(he().sA,{defaultMessage:"Delete pages",id:"database.collectionGroupActionMenu.deleteButtonTitle"}),svg:Oo().trashIcon}),action:()=>function(e,t,o,n,r,i){ni().ui({message:(0,Ce.jsx)(he().sA,{defaultMessage:"Are you sure? All pages inside this group will be deleted.",id:"database.collectionGroupActionMenu.deleteDialogMessage"}),showCancel:!0,keepFocus:!1,items:[{label:"Delete",color:"red",onAccept:()=>Wi(e,t,o,n,r,i)}]})}(o,r,s,n,i,c)});const S={key:"collection group",render:e=>(0,Ce.jsx)(Be().A,{...e}),items:u};return S}var $i=()=>o(356246),Ui=()=>o(67657),qi=()=>o(98126);function Xi(e,t){const{calculating:o,aggregation:n}=e.asyncAggregationStatusStore.state;return n?o&&(0,I().n4)(t,n):o}function Yi({collectionContextStore:e,aggregation:t,children:o}){const{isCalculating:n,changingType:i}=(0,h().K8)((()=>({isCalculating:Xi(e,t),changingType:e.asyncAggregationStatusStore.state.changingType})),[e,t]),l=function(e,t){const o=(0,r.useRef)(e);return(0,r.useEffect)((()=>{t||void 0===e&&"-"===e||(o.current=e)}),[t,e]),o.current}(o,n);return n?i?(0,Ce.jsx)(qi().k,{}):(0,Ce.jsx)("span",{style:{opacity:.5},children:l??o}):(0,Ce.jsx)(Ce.Fragment,{children:o})}var Qi=()=>o(142680);const Zi=(0,he().YK)({propertyAggregation:{id:"collection.aggregation.propertyType",defaultMessage:"{aggregationType} in {propertyName}{calculating, select, true { (Calculating)} other {}}"},aggregationType:{id:"collection.aggregation.aggregationType",defaultMessage:"{aggregationType}{calculating, select, true { (Calculating)} other {}}"},aggregationCalculating:{id:"collection.aggregation.calculating",defaultMessage:"Calculating"}});var Ji=()=>o(662971),el=()=>o(478184),tl=()=>o(722372),ol=()=>o(553965);function nl({schema:e,groupFormat:t,format:o,groupAggregationKey:n,collectionContextStore:r,disabled:i,groupsResultStore:l}){const a=s().A.isMobile,c=(0,h().K8)((()=>o[n]||{aggregator:"count"}),[o,n]),d=(0,y().IS)((e=>({button:{fontWeight:q().Wy.medium,color:e.text.tertiary,height:24}})),[]);return(0,Ce.jsx)(qo().A,{renderTooltip:()=>(0,Ce.jsx)(pl,{schema:e,collectionContextStore:r,aggregation:c}),render:s=>(0,Ce.jsx)(Ae().A,{popupType:a?Ae().z.BottomSheet:Ae().z.Popup,renderOrigin:o=>(0,Ce.jsx)(_o().p,{disabled:i,style:d.button,...(0,ol().A)((0,ol().A)(s,o),{onClick:Ii().k}),children:(0,Ce.jsx)(ul,{collectionContextStore:r,schema:e,aggregation:c,groupFormat:t,groupsResultStore:l})}),disabled:i,render:t=>(0,Ce.jsx)(dl,{aggregation:c,parent:t,collectionContextStore:r,format:o,groupAggregationKey:n,schema:e})})})}function rl({aggregationType:e,isSelected:t,label:o,props:n}){const r=tl().cx[e];return(0,Ce.jsx)(qo().A,{placement:"right",delayThreshold:0,render:e=>(0,Ce.jsx)(Ie().A,{title:o,isChecked:t,...(0,ol().A)(e,n)}),renderTooltip:()=>(0,Ce.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[r?(0,Ce.jsx)("img",{src:(0,el().L)(r),style:{borderRadius:6,width:140,marginTop:4}}):void 0,tl().fp[e]]})},n.key)}function il(e,t,o,n,r){const i=o.collectionViewStore();i&&(o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),_().createAndCommit({userAction:"CollectionGroupAggregation.handleChangeAggregation",environment:t,canUndo:!0,perform:t=>{(0,Bi().F)({collectionViewStore:i,update:{format:{...n,[r]:e}},transaction:t})}})),(0,T().X)({environment:t,collectionContextStore:o,action:"change_aggregation"})}function ll(e,t,o,n,r,i,l){const a=tl().zY[o];return{key:o,render:t=>(0,Ce.jsx)(rl,{isSelected:e,aggregationType:o,label:a,props:t}),action:()=>{il({aggregator:o,enforceMaxAggregationLimit:t},n,r,i,l)}}}function al(e,t,o,n,r){const{enforceMaxAggregationLimit:i,disabled:l}=(0,tl().NT)(e),a={...e,enforceMaxAggregationLimit:!i};return{key:"aggregationLimitToggle",render:e=>(0,Ce.jsx)(Qi().A,{on:i,disabled:l,menuListItemProps:e}),action:()=>il(a,t,o,n,r)}}function sl(e,t,o,n,r,i,l,a){const{device:c}=n,d=s().A.isMobile,u=tl().zY[t],p=I().oE(o.map((o=>function(e,t,o,n,r,i,l,a,s){const c=i[t];if(!c)return;const d=c.name;return{key:`${t}${o}`,render:t=>(0,Ce.jsx)(rl,{isSelected:e,aggregationType:o,label:d,props:t}),action:()=>{il({aggregator:o,property:t,enforceMaxAggregationLimit:n},r,l,a,s)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,!(!e.enforceMaxAggregationLimit||!(0,Ui().AS)(t))&&e.enforceMaxAggregationLimit,n,r,i,l,a)))),m=p.findIndex((o=>o.key===`${e.property}${t}`));return{key:t+u,render:(e,t)=>(0,Ce.jsx)(Ji().A,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,Ce.jsx)(Ie().A,{...e,ref:t,title:u}),renderExtension:(e,o)=>{let n;return n=d?{menuType:Fe().gu.Modal,title:u,right:c.isPhone?(0,Ce.jsx)(Re().DoneMenuText,{}):void 0,onClickRight:o.close,...e}:{menuType:Fe().gu.Popup,width:200,...e},(0,Ce.jsx)(Me().A,{...n,children:(0,Ce.jsx)(Pe().Ay,{type:Pe().Oh.Vertical,initialFocus:m,sections:[{key:"results",render:e=>(0,Ce.jsx)(Be().A,{...e}),items:p}],onAccept:t.onAccept})})}}),action:()=>null}}function cl(e,t,o,n,r,i){const l={};for(const u of Ui().VD)l[u]=ll(e.aggregator===u,e.enforceMaxAggregationLimit??!1,u,t,o,n,r);const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Ui().wG)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(i);if(a.length>0)for(const u of Ui().CG)"show_unique"!==u&&(l[u]=sl(e,u,a,t,i,o,n,r));const s=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Ui().OC)(o)}))}(i);if(s.length>0)for(const u of Ui().Sn)l[u]=sl(e,u,s,t,i,o,n,r);const c=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Ui().fo)(o)}))}(i);if(c.length>0)for(const u of Ui().zE)l[u]=sl(e,u,c,t,i,o,n,r);const d=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Ui().s_)(o)}))}(i);if(d.length>0)for(const u of $i().QO)l[u]=sl(e,u,d,t,i,o,n,r);return l}function dl({aggregation:e,parent:t,collectionContextStore:o,format:n,groupAggregationKey:r,schema:i}){const l=(0,m().v3)(),a=s().A.isMobile,{actions:c,initialFocus:d}=function(e,t,o,n,r,i){const l=s().A.isMobile,a=[];let c=0,d=0;const u=cl(e,t,o,n,r,i);let p=0;return Object.entries(Ui().Kn).forEach((([i,s])=>{const m=[];for(const t of s)u[t]&&(m.push(u[t]),e.aggregator===t&&(c=p,d=m.length-1));const g=[];if("count_aggregations"===i&&g.push({key:"limitToggleSection",render:e=>(0,Ce.jsx)(Be().A,{...e}),items:[al(e,t,o,n,r)]}),g.push({key:"aggregations",render:e=>(0,Ce.jsx)(Be().A,{topBorder:!0,...e}),items:m}),m.length>0){p++;const e=tl().jA[i],t={key:e,render:(t,o)=>(0,Ce.jsx)(Ji().A,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,Ce.jsx)(Ie().A,{...t,ref:o,title:e}),renderExtension:(t,n)=>{let r;return r=l?{menuType:Fe().gu.Modal,title:e,right:(0,Ce.jsx)(Re().DoneMenuText,{}),onClickRight:n.close,...t}:{menuType:Fe().gu.Popup,width:250,...t},(0,Ce.jsx)(Me().A,{...r,children:(0,Ce.jsx)(Pe().Ay,{type:Pe().Oh.Vertical,initialFocus:d,sections:g,onAccept:(e,t,r)=>{"aggregationLimitToggle"!==e.key&&(n.close(),o.onAccept&&o.onAccept(e,t,r))}})})}}),action:()=>null};a.push(t)}})),{actions:a,initialFocus:c}}(e,l,o,n,r,i);let u;return u=a?{menuType:Fe().gu.Modal,title:(0,Ce.jsx)(he().sA,{defaultMessage:"Aggregation",id:"database.collectionGroupAggregation.title"}),right:(0,Ce.jsx)(Re().DoneMenuText,{}),onClickRight:t.close}:{menuType:Fe().gu.Popup,width:200},(0,Ce.jsx)(Me().A,{...u,children:(0,Ce.jsx)(Pe().Ay,{type:Pe().Oh.Vertical,initialFocus:d,sections:[{key:"aggregation section",render:e=>(0,Ce.jsx)(Be().A,{...e}),items:c}],onAccept:t.close})})}function ul(e){const t=(0,h().K8)((()=>{var t;const o=e.groupsResultStore.state;if(!o)return;const n=(0,Qn().Ix)(e.groupFormat);return null===(t=o.aggregationResults)||void 0===t?void 0:t[n]}),[e.groupFormat,e.groupsResultStore]);let o,n;if((0,Ui().G9)(e.aggregation)){const t=e.schema[e.aggregation.property];!t||"formula"!==t.type&&"number"!==t.type||(o=t.number_format),t&&"date"===t.type&&(n=t.date_format)}return(0,Ce.jsx)(Yi,{aggregation:e.aggregation,collectionContextStore:e.collectionContextStore,children:t?(0,tl().rv)({numberFormat:o,dateFormat:n,aggregation:e.aggregation,userTimeZone:(0,Sr().P)(),value:t.aggregationResult,numberPrecision:void 0}):""})}function pl({schema:e,collectionContextStore:t,aggregation:o}){const n=(0,he().tz)(),r=tl().zY[(0,Ui().V1)(o)],i=(0,h().K8)((()=>Xi(t,o)),[t,o]);if((0,Ui().G9)(o)){const t=e[o.property];if(t){const e=t.name;return(0,Ce.jsx)(Ce.Fragment,{children:n.formatMessage(Zi.propertyAggregation,{aggregationType:r,propertyName:e,calculating:i})})}}return(0,Ce.jsx)(Ce.Fragment,{children:n.formatMessage(Zi.aggregationType,{aggregationType:r,calculating:i})})}var ml=()=>o(330918);function gl(e){const{onMount:t,isInPeekRenderer:n,style:i,paddingTop:l,disabled:a,stickyStyle:s,transitionStickyStyle:c,groupFormat:d,collectionContextStore:u,format:p,groupAggregationKey:g,stickyWrapStyle:S}=e,[v,f]=(0,r.useState)(void 0),b=(0,m().v3)(),x=(0,Ee().Zp)(),C=(0,r.useRef)(null);(0,r.useEffect)((()=>{null==t||t()}),[t]),(0,r.useEffect)((()=>{const e=u.collectionViewBlockStore();e&&f(new(ne().B)(b,{table:et().ev,id:e.id}))}),[u,b]);const w=(0,h().K8)((()=>u.groupsStore.getGroupState(d)),[u.groupsStore,d]),k=(0,r.useMemo)((()=>{if((0,Qn().D1)(d.value)&&(0,Qn().WO)(d.value.value))return new(ne().B)(b,d.value.value)}),[b,d.value]),I=(0,h().K8)((()=>Boolean((null==k?void 0:k.isReady())&&!(null!=k&&k.canRead()))),[k]),A=(0,h().K8)((()=>null==w?void 0:w.toggleStateStore.state),[w]),T=(0,h().O$)(u.permissionScopesStore),j=(0,h().K8)((()=>!a&&u.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})&&!I&&!(0,Nr().Id)(u)),[u,a,I]),M=(0,h().O$)(u.isInHomeWidgetStore),P=(0,h().K8)((()=>void 0!==p[g]&&!(null!=x&&x.hideAggregation)),[p,g,x]),B=(0,W().Oz)(u),V=(0,h().K8)((()=>M?"transparent":(null==B?void 0:B.background)||void 0),[B,M]),E=(0,h().O$)(u.isUnlistedViewStore),F=(0,y().IS)((t=>{const o=E||n?t.background.elevated:t.background.primary;return{topLevelDiv:{position:"relative",zIndex:87,width:"100%",background:void 0===V?o:V,fontSize:14,overflow:e.stickyLeft?void 0:"auto",...i},stickyWrapStyle:{display:"flex",alignItems:"center",height:e.height??33,paddingTop:l,...e.stickyLeft&&{position:"sticky",insetInlineStart:e.isFullScreen||e.isRootChild?e.paddingLeft:0},...!A&&{marginBottom:e.toggleClosedMarginBottom},...S}}}),[V,n,A,l,e.height,e.isFullScreen,e.isRootChild,e.paddingLeft,e.stickyLeft,e.toggleClosedMarginBottom,i,S,E]),O=(0,r.useCallback)((()=>{if(!w)return;R().IU({environment:b});const e=!A;(0,o(361743).J)({environment:b,groupFormat:d,toggleStateStore:w.toggleStateStore,newValue:e,collectionContextStore:u})}),[u,b,d,w,A]),D=(0,r.useCallback)((()=>(0,Ce.jsx)(zr().f,{isSidebar:!1,open:A??!1,fill:!0,onClick:O,onMouseDown:Ai().t,style:{flexShrink:0}})),[O,A]),{value:L}=(0,ft().fJ)(yt().VI.duplicateActions),z=(0,r.useCallback)((async e=>{const{droppedStores:t,duplicate:o}=e,n=C.current;if(!(n&&n instanceof Element))return;const r=await Rt().T.formulas.load();_().createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:b,canUndo:!0,perform:e=>Er({environment:b,collectionContextStore:u,groupsPointer:[d],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:r,duplicateActions:L})})}),[u,L,b,d]),K=(0,r.useMemo)((()=>({...s,paddingInlineStart:e.paddingLeft-2})),[s,e.paddingLeft]);return w&&v?(0,Ce.jsx)(ki().g,{stickyAttachPoint:M?"no-stick":"ceiling",stickyStyle:K,transitionStickyStyle:c,nodeRef:C,children:(0,Ce.jsxs)("div",{style:F.topLevelDiv,ref:C,children:[(0,Ce.jsx)("div",{style:F.stickyWrapStyle,children:(0,Ce.jsx)("div",{style:{display:"flex",alignItems:"center",position:e.stickyLeft?"sticky":void 0,insetInlineStart:e.paddingLeft,overflow:"hidden"},children:(0,Ce.jsxs)(jt().Ay,{store:v,canDropOnto:!a&&!A,onSelectableDrop:z,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[d],style:{display:"flex",alignItems:"center",height:"100%",overflow:"hidden"},canSelect:!1,children:[D(),(0,Ce.jsx)(vl,{collectionGroupHeaderProps:e}),P?(0,Ce.jsx)(hl,{groupsResultStore:e.groupsResultStore,disabled:e.disabled,format:e.format,schema:e.schema,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,groupAggregationKey:e.groupAggregationKey}):void 0,!a&&T.canConfigureBlock?(0,Ce.jsx)(yl,{groupFormat:e.groupFormat,currentGroups:e.currentGroups,format:e.format,schema:e.schema,query:e.query,collectionContextStore:e.collectionContextStore,groupsFormatKey:e.groupsFormatKey,isGroupHoveredStore:e.isGroupHoveredStore}):void 0,j?(0,Ce.jsx)(fl,{collectionGroupHeaderProps:e,isGroupHoveredStore:e.isGroupHoveredStore}):void 0]})})}),e.children]})}):null}const Sl=r.memo(gl);function hl({disabled:e,format:t,schema:o,collectionContextStore:n,groupFormat:r,groupsResultStore:i,groupAggregationKey:l}){const a=!(0,h().O$)(v().e),s=(0,h().O$)(n.canConfigureBlockStore);return a?null:(0,Ce.jsx)(nl,{groupsResultStore:i,groupFormat:r,disabled:e||!s,groupAggregationKey:l,format:t,schema:o,collectionContextStore:n})}function yl({groupFormat:e,currentGroups:t,format:o,schema:n,query:r,collectionContextStore:i,groupsFormatKey:l,isGroupHoveredStore:a}){const c=(0,he().tz)(),d=s().A.isMobile,u=(0,h().O$)(a),[p,m]=(0,wi().A)(),g=(0,y().IS)((()=>({button:{transition:d?void 0:"opacity 100ms ease-in-out",opacity:d?void 0:u||m?1:0}})),[d,m,u]);return(0,Ce.jsx)(Ae().A,{popupType:d?Ae().z.BottomSheet:Ae().z.Popup,renderOrigin:e=>(0,Ce.jsx)(Te().A,{ariaLabel:c.formatMessage({id:"actionButtonComponent.ariaLabel",defaultMessage:"Show group options"}),ref:p,icon:se().ellipsisSmallIcon,style:g.button,...e}),onClick:Ii().k,render:a=>(0,Ce.jsx)(Hi,{parent:a,groupFormat:e,currentGroups:t,format:o,schema:n,query:r,collectionContextStore:i,groupsFormatKey:l})})}function vl({collectionGroupHeaderProps:e}){const t=(0,m().v3)(),{groupFormat:o,schema:n,disabled:r,currentGroups:i,groupBy:l,collectionContextStore:a}=e,s=(0,h().O$)(a.permissionScopesStore);return(0,Ce.jsx)(ml().d,{groupBy:l,groupFormat:o,currentGroups:i,schema:n,disabled:r||!s.canConfigureCollection||s.isSyncedCollection||"formula"===l.type,isHiddenGroup:!1,onChange:o=>function(e,t,o){const{collectionContextStore:n}=o,r=n.collectionStore();r&&(Mi({...e,environment:t,collectionStore:r,...o}),(0,T().X)({environment:t,collectionContextStore:n,action:"rename_group"}))}(o,t,e),style:{maxWidth:400,lineHeight:"24px"},uncategorizedIconStyle:{marginInlineStart:2},collectionContextStore:a,source:"collection_group_header"})}function fl({collectionGroupHeaderProps:e,isGroupHoveredStore:t}){const o=(0,he().tz)(),n=s().A.isMobile,r=(0,m().v3)(),i=(0,h().O$)(t),[l,a]=(0,wi().A)(),c=(0,y().IS)((()=>({button:{transition:n?void 0:"opacity 100ms ease-in-out",opacity:n?void 0:i||a?1:0}})),[n,a,i]);return(0,Ce.jsx)(qo().A,{renderTooltip:()=>(0,Ce.jsx)(he().sA,{defaultMessage:"Create new",id:"database.collectionGroupHeader.actions.addNewPage.tooltip"}),render:t=>(0,Ce.jsx)(Te().A,{ariaLabel:o.formatMessage({id:"collectionGroupHeader.actions.addNewPage.ariaLabel",defaultMessage:"Add new page in group"}),ref:l,icon:gn().plusSmallIcon,onClick:()=>function(e,t){const{groupFormat:o,collectionContextStore:n,isFullScreen:r,onGroupHeaderAddItem:i}=t;n.groupsStore.getGroupState(o)&&(0,ro().E)(e)&&(n.searchQueryStore.state&&(0,Or().S)({searchQuery:"",collectionContextStore:n,isFullScreen:r}),_().createAndCommit({userAction:"CollectionGroupHeader.handleAddItemClick",environment:e,canUndo:!0,perform:r=>{const l=(0,ur().Q)({environment:e,collectionContextStore:n,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,templateStore:n.defaultPageTemplateStore.state,transaction:r,from:{createBlock:"group_header"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});l&&(i(l.newStore,l.coercionSucceeded,t),sr().vH(e,{from:"group_add_item_top",type:"page",new_page_id:l.newStore.id,creating_block_id:l.newStore.id,...(0,Et().sl)(n)}))}}))}(r,e),style:c.button,...t})})}const bl=f().Store.createClass(!1,{name:"IsGroupHoveredStore"}),xl=r.memo((function({renderGroupResults:e,groupFormat:t,groupsDisplayState:o,disabled:n,groupsFormatKey:i,groupAggregationKey:l,groupsResultStore:a,format:s,schema:c,query:d,collectionContextStore:u,onGroupHeaderAddItem:p,renderHeader:g,getGroupStyle:S,stickyLeft:v,paddingLeft:f,isFullScreen:b,index:x,isRootChild:C,isInPeekRenderer:w,groupBy:k,isLast:I}){const A=(0,m().v3)(),T=(0,r.useRef)(null),j=(0,h().uB)(void 0,bl),[M,P,R,_,B]=(0,h().K8)((()=>{const r=u.groupsStore.getGroupState(t),m=r?r.toggleStateStore:null,h=!!m&&m.state?e(t):null,y={groupFormat:t,currentGroups:o.currentGroups,disabled:n,groupsFormatKey:i,groupAggregationKey:l,groupsResultStore:a,format:s,schema:c,query:d,collectionContextStore:u,isFullScreen:b,isInPeekRenderer:w,onGroupHeaderAddItem:p,stickyLeft:v,index:x,paddingLeft:f,isRootChild:C,groupBy:k,isGroupHoveredStore:j},A=g?g(y):(0,Ce.jsx)(Sl,{...y});return[r,m,S&&m?S({groupFormat:t,index:x,isLast:I,toggleStateStore:m,isFullScreen:b,groupsDisplayState:o}):void 0,h,A]}),[u,t,e,o,n,i,l,a,s,c,d,b,w,p,v,x,f,C,k,j,g,S,I]),V=(0,h().K8)((()=>u.collectionViewStore()),[u]);(0,r.useEffect)((()=>{Ci({environment:A,collectionContextStore:u,groupFormat:t})}),[V]);const E=(0,r.useCallback)((()=>{j.setState(!0)}),[j]),F=(0,r.useCallback)((()=>{j.setState(!1)}),[j]),O=(0,y().IS)((()=>({container:{width:"100%",position:"relative",...R}})),[R]);return M&&P?(0,Ce.jsx)("div",{style:O.container,onMouseEnter:E,onMouseLeave:F,ref:T,children:(0,Ce.jsxs)(xi,{nodeRef:T,isFirst:0===x,children:[B,_]})}):null}),tr().A);var Cl=()=>o(45941),wl=()=>o(403733);const kl=10,Il=r.memo((function(e){const{type:t,groupsLimitStore:o,collectionContextStore:n,style:r}=e,i=(0,m().v3)(),l=(0,h().K8)((()=>(0,Jr().Mw)({collectionContextStore:n,isForColumnGroups:"board"===t})),[n,t]),a=(0,y().IS)((e=>{const o=s().A.isMobile;return{hovered:{background:e.whiteButtonBackground},icon:{width:o?Se().Ev.default:Se().Ev.sm,height:o?Se().Ev.default:Se().Ev.sm,fill:e.icon.tertiary,..."default"===t?{marginInlineEnd:8}:{}},button:{display:"flex",alignItems:"center",fontSize:o?mi().hN:mi().Mi,paddingTop:2,paddingBottom:2,paddingInlineEnd:8,color:e.text.tertiary,fontWeight:q().Wy.regular,..."board"===t?{background:void 0,marginInlineEnd:12,width:"fit-content",...r}:{height:28,marginTop:4,marginBottom:4}}}}),[r,t]);return"default"===t?(0,Ce.jsxs)(_o().p,{onClick:()=>function(e,t,o){const n=(0,Cl().TW)({isLowerMobileGroupsLimitEnabled:Boolean(s().A.isMobile)&&er().default.checkGate({gateName:"collection_lower_load_limits_on_mobile"})});o.setState(o.state+n),t.loadingDetailsStore.setState({type:"load_more_groups"}),Al(e)}(i,n,o),onMouseDown:Ai().t,disabled:l,hoveredStyle:l?a.hovered:{},style:{...a.button,...r},children:[(0,wl().arrowStraightDownSmallIcon)(a.icon),(0,Ce.jsx)(he().sA,{id:"database.groups.loadMoreButtonDefault",defaultMessage:"Load more"}),l?(0,Ce.jsx)("div",{style:{marginTop:1,marginInlineStart:8},children:(0,Ce.jsx)(qi().A,{size:"sm"})}):void 0]}):(0,Ce.jsxs)(_o().p,{onClick:()=>function(e,t,o){const n=(0,Cl().TW)({isLowerMobileGroupsLimitEnabled:Boolean(s().A.isMobile)&&er().default.checkGate({gateName:"collection_lower_load_limits_on_mobile"})});o.setState(o.state+n),t.loadingDetailsStore.setState({type:"load_more_columns"}),Al(e)}(i,n,o),onMouseDown:Ai().t,disabled:l,hoveredStyle:l?a.hovered:{},style:a.button,children:[(0,Ce.jsx)("div",{style:{marginInlineEnd:8},children:l?(0,Ce.jsx)("div",{style:{marginInlineStart:4},children:(0,Ce.jsx)(qi().A,{size:"sm"})}):(0,se().ellipsisSmallIcon)(a.icon)}),(0,Ce.jsx)("span",{style:{flexGrow:1},children:(0,Ce.jsx)(he().sA,{id:"database.groups.loadMoreButtonBoard",defaultMessage:"Load more groups"})})]})}),tr().A);function Al(e){(0,i().DO_NOT_USE_trackLegacy)(e,"collection_load_more_groups")}function Tl(e){const{format:t,isFullScreen:o,paddingLeft:n,isRootChild:r}=e,i=(0,m().v3)(),l=(0,h().K8)((()=>(0,Hn().iw)({environment:i,format:t,isFullScreen:o,isRootChild:r})),[i,t,o,r]),a=(0,h().K8)((()=>"collectionTypedView"===e.collectionContextStore.contextType),[e.collectionContextStore]),s=(0,h().K8)((()=>(0,Hn().Od)({environment:i,isRootChild:r,isFullScreen:o,format:t})?Hn().HV:n),[i,t,o,r,n]);return l||a?null:(0,Ce.jsx)("div",{style:{width:"100%",height:gi+hi+Si,display:"flex"},children:(0,Ce.jsx)(vi,{groupFormatKey:"collection_groups",groupBy:e.groupBy,currentGroups:e.currentGroups,schema:e.schema,groupsLimitStore:e.groupsLimitStore,collectionContextStore:e.collectionContextStore,onAccept:e.onAccept,parentStore:e.parentStore,style:{position:"sticky",insetInlineStart:e.isFullScreen?s:32,width:"max-content",paddingInlineStart:4,paddingInlineEnd:8}})})}function jl(e){const{format:t,isFullScreen:o,isRootChild:n}=e,r=(0,m().v3)(),i=(0,h().K8)((()=>(0,Hn().iw)({environment:r,format:t,isFullScreen:o,isRootChild:n})),[r,t,o,n]),l=(0,h().K8)((()=>(0,Hn().Od)({environment:r,isRootChild:n,isFullScreen:o,format:t})?Hn().HV:e.paddingLeft),[r,t,o,n,e.paddingLeft]);return i?null:(0,Ce.jsx)(Il,{type:"default",groupsLimitStore:e.groupsLimitStore,collectionContextStore:e.collectionContextStore,style:{position:"sticky",insetInlineStart:o?l:32,width:"max-content",paddingInlineStart:4,paddingInlineEnd:8}})}const Ml=(0,Se().wt)("collectionGroupAccordion",{svg:(0,Ce.jsx)("path",{d:"M6.741 0a1 1 0 01.875 1.485l-2.742 4.94a1 1 0 01-1.748 0L.384 1.485A1 1 0 011.26 0h5.48z"}),viewBox:"0 0 8 7"});var Pl=()=>o(395361),Rl=()=>o(721908),_l=()=>o(540355),Bl=()=>o(228927),Vl=()=>o(569912);class El extends f().Store{getInitialState(){return{}}}var Fl=()=>o(190033),Ol=()=>o(508390),Dl=()=>o(690825);var Ll=()=>o(522419),zl=()=>o(675074),Kl=()=>o(120672);function Hl(e){const{environment:t,collectionStore:o,targetStore:n,droppedDirection:r,files:i,transaction:l,collectionContextStore:a,groupsPointer:s,formulasModule:c,duplicateActions:d}=e,u=a.collectionViewStore(),p=(0,Kl().y)(t);if(!u)return;const m=o.inMemoryRecordCache,g=zl().$C({environment:t,files:i,inMemoryRecordCache:m,pageWidth:p,transaction:l,spaceId:o.pointer.spaceId}).map(((e,n)=>{const r=i[n],a=fe().Wv({environment:t,type:"page",inMemoryRecordCache:m,properties:{title:(0,k().x9d)(Ll().v5(r.name))},transaction:l,spaceId:o.pointer.spaceId});return vr().BC({parentStore:a.getContentStore(),appendStore:e,transaction:l}),a}));Er({environment:t,collectionStore:o,targetStore:n,droppedDirection:r,collectionContextStore:a,groupsPointer:s,droppedStores:g,duplicate:!1,transaction:l,collapsedGroup:!1,formulasModule:c,duplicateActions:d})}var Wl=()=>o(187174);var Nl=()=>o(790515),Gl=()=>o(968913),$l=()=>o(851802),Ul=()=>o(645302),ql=()=>o(544073),Xl=()=>o(945895),Yl=()=>o(160811),Ql=()=>o(61188);function Zl(e){const{analyticsName:t,belowDropZoneMargin:o,blockPropertyValueOverlayStore:n,canDrag:i,canDrop:l,collectionContextStore:a,direction:s,disabled:c,disableScrollToRevealHorizontal:d,disableSelectable:u,dropzoneGap:p,getItemSelectableStyle:g,groupsPointer:S,handleOpenPeekPage:v,isLast:f,itemSelectableHaloStyle:b,onSelectableEnter:x,onSelectableInsertRow:C,passesFilter:w,renderItem:k,itemProps:I,store:A,subitemPath:T,toggleButton:j,touchDragOnly:P}=e,R=(0,m().v3)(),B=(0,Ee().Zp)(),{value:V}=(0,ft().fJ)(yt().VI.duplicateActions),E=(0,h().K8)((()=>(0,Gl().Wi)(R,A.id)),[A,R]),F=(0,h().K8)((()=>A.canEdit()),[A]),O=(0,h().K8)((()=>A.getAssociatedCollectionStore()),[A]),D=(0,h().K8)((()=>{var e;return null===(e=a.collectionViewStore())||void 0===e?void 0:e.getType()}),[a]),L=(0,h().K8)((()=>"collectionTypedView"===a.contextType),[a]),z=(0,h().K8)((()=>{const e=a.groupsStore.getGroupState(S);return null==e?void 0:e.resultsStore}),[a,S]),K=(0,h().K8)((()=>W().NM(A)),[A]),H=(0,h().K8)((()=>W().f5({collectionContextStore:a})?60:void 0),[a]),N=(0,h().K8)((()=>{const e=Xl().A.state;return e.isActive&&e.store===A}),[A]),G=(0,h().K8)((()=>{var e;const t=wr().Ay.state;if(!t.isDragging)return!1;const o=null===(e=t.currentDropZone)||void 0===e?void 0:e.direction;return t.draggedStores.some((e=>e.isCollectionView()))&&o===wr().bH.Below}),[]),$=!c&&F&&!E,U=e.shouldShowHoverMenu&&$,q=s!==ra.Vertical&&l,X=s!==ra.Vertical&&l,Y=s===ra.Vertical&&l,Q=(0,y().IS)((e=>({haloStyle:{...W().wh(e,K),...("board"===D||"gallery"===D)&&{borderRadius:kl},...b}})),[D,b,K]),Z=(0,r.useCallback)((e=>{const{insertStores:t,transaction:o}=e;return O?(0,Yl().D)({environment:R,collectionStore:O,collectionContextStore:a,groupsPointer:S,insertStores:t,store:A,before:!1,transaction:o}):[]}),[O,a,R,S,A]),J=(0,r.useCallback)((e=>{const{insertStores:t,transaction:o}=e;return O?(0,Yl().D)({environment:R,collectionStore:O,collectionContextStore:a,groupsPointer:S,insertStores:t,store:A,before:!0,transaction:o}):[]}),[O,a,R,S,A]),ee=(0,r.useCallback)((async e=>{const{droppedDirection:t,duplicate:o}=e;if(!O)return[];const n=Wt().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Wt().default.DO_NOT_USE_measureAfterNextFlushLegacy(n,{environment:R,getData:()=>Et().tv({collectionContextStore:a,is_native_drop:!1,is_empty:!1})});const r=t!==wr().bH.Onto?(0,di().f0)({stores:e.droppedStores,collectionContextStore:a}):e.droppedStores;if(0===r.length&&L)return void ni().f1((0,Ce.jsx)(he().sA,{...di().K0.unsupportedGroupAction}));const i=await Rt().T.formulas.load();_().createAndCommit({userAction:"CollectionGroupResultsItem.handleDrop",environment:R,canUndo:!0,perform:e=>{!Er({environment:R,collectionStore:L?void 0:O,targetStore:A,droppedDirection:t,collectionContextStore:a,groupsPointer:S,droppedStores:r,duplicate:o,transaction:e,subitemPath:T,collapsedGroup:!1,formulasModule:i,duplicateActions:V})&&L&&ni().f1((0,Ce.jsx)(he().sA,{...di().K0.unsupportedGroupAction}))}})}),[O,a,V,R,S,L,A,T]),te=(0,r.useCallback)((async e=>{const{files:t,droppedDirection:o}=e;if(!O)return[];const n=Wt().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Wt().default.DO_NOT_USE_measureAfterNextFlushLegacy(n,{environment:R,getData:()=>Et().tv({collectionContextStore:a,is_native_drop:!0,is_empty:!1})});const r=await Rt().T.formulas.load();_().createAndCommit({userAction:"CollectionGroupResultsItem.handleNativeDrop",environment:R,canUndo:!0,perform:e=>{Hl({environment:R,collectionStore:O,targetStore:A,droppedDirection:o,collectionContextStore:a,groupsPointer:S,files:t,transaction:e,formulasModule:r,duplicateActions:V})}})}),[O,a,V,R,S,A]),oe=(0,r.useCallback)((e=>({transaction:t})=>{if(!O)return[];const o=(0,Ql().u)({environment:R,collectionContextStore:a,groupsPointer:S,store:A,before:"above"===e,collectionStore:O,transaction:t,subitemPath:T,subitemInsertDirection:"below"});if(sr().vH(R,{...Et().sl(a),type:"page",from:"below"===e?"table_insert_below":"table_insert_above",new_page_id:null==o?void 0:o.id,creating_block_id:null==o?void 0:o.id}),o&&C&&C(A,o),o&&n){const e=()=>{dr().ho({isNewBlock:!0,environment:R,blockPropertyValueOverlayStore:n,store:o,property:"title",surface:"table",collectionContextStore:a})};a.registerCallbackForItemMounted(o,e)}}),[O,n,a,R,S,C,A,T]),ne=(0,r.useCallback)((e=>{oe("above")(e)}),[oe]),re=(0,r.useCallback)((e=>{oe("below")(e)}),[oe]),ie=(0,r.useCallback)((()=>{const e=a.collectionViewStore();Wt().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag"),null==v||v(),M().Ey({collectionContextStore:a,resultsStore:z});const t=null==e?void 0:e.getType();if(t){const e=a.normalizedFormatStore.state.collection_peek_mode,o=e||ql().C9[t];Ul().bn(R,{is_peek:!0,from:t,peek_mode:o})}}),[a,R,v,z]),le=(0,r.useCallback)((e=>{const{transaction:t}=e;S.length>0&&Rr({store:A,transaction:t,groupsPointer:S,collectionContextStore:a,environment:R}),Lo().by({childStore:A,transaction:t})}),[a,R,S,A]),ae=(0,h().K8)((()=>g?g(f):void 0),[g,f]),se=(0,h().K8)((()=>a.isLibraryBlock()),[a]);(0,r.useEffect)((()=>{a.onItemMount(A)}),[A,a]);const ce=r.createElement(k,{handleOpenPeekPage:ie,collectionContextStore:a,...I,...E?{disabled:!0}:{},store:A,key:A.id,isLast:f,toggleButton:j,subitemPath:T,passesFilter:w});return u?ce:(0,Ce.jsx)(jt().Ay,{analyticsName:t,belowDropZoneMargin:o,canDrag:i,canDropBelow:Y,canDropLeft:q,canDropOnto:l,canDropRight:X,canInsertAbove:l,canInsertBelow:l,canNativeDropBelow:Y&&!L,canNativeDropLeft:q&&!L,canNativeDropRight:X&&!L,canSelect:$||se,canTriggerContextMenu:$,className:Vt().E4t,disableScrollToRevealHorizontal:d,dropzoneGap:p,dropzoneMustBeWithinHorizontalBound:!0,dropzoneShouldNeverUseOrigin:!0,groupsPointer:S,haloStyle:Q.haloStyle,isLastItem:f,onEnter:x,onInsertAbove:J,onInsertBelow:Z,onInsertRowAbove:ne,onInsertRowBelow:re,onNativeDrop:te,onRemove:le,onSelectableDrop:ee,shouldForceRenderSelectionHalo:K,shouldShowCommentMenu:!1,shouldShowDropZone:l&&!G,shouldShowHalo:!(N||null!=B&&B.isPreviewing),shouldShowHoverMenu:U,showBlockMenuInput:!0,store:A,style:ae,touchDragOnly:P,verticalDropZoneExtraLeftEdgeOffset:H,children:ce})}const Jl=r.memo(Zl,tr().A);function ea(e){const{store:t,collectionContextStore:n,subitemPath:l,titleColumnIndex:a,nestedCreateSubitemButton:c,getItemSelectableStyle:d,paddingLeft:u}=e,p=(0,m().v3)(),g=Boolean(s().A.isMobile),{value:S}=(0,ft().fJ)(Rt().T.formulas),v=(0,y().DP)(),{currentSubitemFormatStoreForUiDisplayStore:f,subitemExpandedStore:b,subitemTreeStore:x}=n,C=(0,h().K8)((()=>W().Dj({store:t,collectionContextStore:n})),[n,t]),w=(0,h().K8)((()=>{var e;return null===(e=n.collectionViewStore())||void 0===e?void 0:e.getType()}),[n]),k=(0,h().K8)((()=>n.isSystemCollection()),[n]),A=(0,h().K8)((()=>l&&l.length>0?l:(0,yr().Qe)(x.state.children,(e=>e.value.store===t))),[l,x,t],{useDeepEqual:!0}),T=(0,r.useMemo)((()=>A?(0,vt().kY)(A.map((e=>e.value.store))):""),[A]),j=(0,h().K8)((()=>b.state.get(T)),[b,T]),M=Boolean(null==j?void 0:j.isExpanded),P=(0,h().O$)(f),_=(0,h().K8)((()=>{if(!C||!P)return;const e=C.getSchema()[P.property];return void 0!==e&&(0,gr().nC)(e)?e:void 0}),[C,P]),B=(0,h().K8)((()=>{var e;return _&&"relation"===_.type&&(0,gr().zO)(_)===(null===(e=n.collectionStore())||void 0===e?void 0:e.id)&&_.property}),[n,_]),V=(0,h().K8)((()=>{if(!P||!_)return!1;return 0===(0,vt().eO)({store:t,subitemFormat:P,propertySchema:_}).length}),[t,P,_]),E=(0,h().K8)((()=>{var e;const t=null===(e=n.collectionViewStore())||void 0===e?void 0:e.getFormat();if(!(null==t?void 0:t.subitem_property))return!1;const r=(null==t?void 0:t.subitem_display_mode)??"show",i=(0,vt().g0)(n),l=(0,o(539297).x)(w);switch(i){case"subitems":return V;case"parents":return!l&&"show"===r&&!V;default:return!1}}),[n,w,V]),F=(0,h().K8)((()=>{const e=!B||w&&(0,pr().qS)(w)?void 0:{property:B,filter:{operator:"is_empty"}};return!(!P||!C)&&(0,vt().Ch)({store:t,collectionStore:C,subitemFormat:P,subitemPathKey:T,collectionContextStore:n,propertyFilters:[...e&&B?[{id:B,filter:e}]:[],...n.currentPropertyFiltersStore.state],combinatorFilter:n.currentCombinatorFilterStore.state,currentUserId:p.currentUser.id,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map,formulasModule:S,spaceIdCreator:p.idCreator.getSpaceIdCreatorSync(t.getSpaceId()??"")}).length>0}),[n,w,p.currentUser.id,B,C,T,t,P,S,p.idCreator]),O=(0,re().X)("collection_property_permissions"),D=(0,h().K8)((()=>!(!C||!P)&&(!!(F||M||g||"timeline"===w)||k&&t.canEdit()&&(void 0===a||0===a)&&(0,o(396301).IX)(t))),[C,P,k,t,a,F,M,g,w]),L=(0,h().K8)((()=>{if(!C||!P)return!1;const e=n.permissionScopesStore.state.canEditContent;return!(O&&!e&&!F)&&$l().A.getState().hoveredStore===t}),[O,n.permissionScopesStore,F,C,t,P]),z=(0,h().K8)((()=>{const e=(0,Nl().AU)({collectionContextStore:n,collectionStore:C,environment:p});if(e)return(0,o(214388).oR)(e)}),[n,C,p]),K=(0,r.useCallback)((()=>{const e=b.state;if(M){e.delete(T);const o=bt().default.state.stores.filter((e=>t.uiContains(e)));o.length>0&&R().DN({stores:(0,I().R9)(bt().default.state.stores,o)}),function(e,t){(0,i().DO_NOT_USE_trackLegacy)(e,"subitem_toggle_block_close",t)}(p,{...(0,Et().sl)(n),depth:(null==A?void 0:A.length)||0}),b.emit()}else e.set(T,{isExpanded:!0,limit:20}),function(e,t){(0,i().DO_NOT_USE_trackLegacy)(e,"subitem_toggle_block_open",t)}(p,{...(0,Et().sl)(n),depth:(null==A?void 0:A.length)||0}),z&&e&&_&&P?(0,vt().eI)({blockStore:t,subitemExpandedStore:b,subitemFormat:P,propertySchema:_,compiledFilter:z,pathKey:T,forceStoresToLoad:!1,visitedIds:new Set,resultCache:new Map,regExpCache:new Map,spaceIdCreator:p.idCreator.getSpaceIdCreatorSync(t.getSpaceId()??""),formatDateCache:new Map}).then((()=>{b.emit()})):b.emit()}),[b,M,T,p,n,null==A?void 0:A.length,t,z,_,P]),H=(0,h().K8)((()=>{const o=x.state;return o&&A&&o.children.length>0?(0,vt().ag)(o).value.store===t:e.isLast}),[x,e.isLast,t,A]),N=(0,o(991114).C)(),G=(0,h().K8)((()=>{var e;const o=t.getModel();if(!z||!o)return!0;const n=null===(e=t.getAssociatedCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return z({block:o,getRecordModel:t.getRecordModel,propertyMapping:n,formulaTimeoutTimestampMs:Date.now()+N,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map,experimentService:er().default,formulasModule:S,spaceIdCreator:t.environment.idCreator.getSpaceIdCreatorSync(t.getSpaceId())})}),[t,z,N,S]),$=(0,h().K8)((()=>(0,Gl().Wi)(p,t.id)),[p,t]),U=(0,re().X)("do_not_reduce_opacity_on_collection_table_borders"),q=(0,h().K8)((()=>{const e=!G&&!(U&&("table"===w||"list"===w))||$||E;return()=>({...d?d(H):{},...e?{opacity:.5}:{}})}),[U,w,d,G,$,H,E]);(0,Wl().Yb)((async()=>{const e=t.getModel();await t.load();const o=t.getRecordModel;if(!D||!e||!z||!_||!o||!P||G)return;(0,vt().eO)({store:t,subitemFormat:P,propertySchema:_}).length>0||(await(0,vt().eI)({blockStore:t,subitemExpandedStore:b,subitemFormat:P,propertySchema:_,compiledFilter:z,pathKey:T,forceStoresToLoad:!0,visitedIds:new Set,resultCache:new Map,regExpCache:new Map,spaceIdCreator:p.idCreator.getSpaceIdCreatorSync(t.getSpaceId()??""),formatDateCache:new Map}),b.emit())}),[D,z,G,T,t,b,P,_,p.idCreator]);const X=(0,Ce.jsx)(Jl,{...e,passesFilter:G,isLast:H,getItemSelectableStyle:q,subitemPath:A,toggleButton:D||L?(0,Ce.jsx)(zr().f,{isSidebar:!1,open:M,fill:!0,onClick:K,color:F||M?v.icon.primary:v.icon.secondary,disabled:A&&A.length>=pr().x2}):void 0});if(!M||!A||0===A.length||A.length>=pr().x2)return X;const Y=A[A.length-1].children,Q=C&&void 0!==c,Z=j&&Y.length>0&&Y.length===j.limit;return(0,Ce.jsxs)(Ce.Fragment,{children:[X,Y.map((t=>{const o=t.value.store;return(0,r.createElement)(ta,{...e,key:o.id,store:o,subitemPath:[...A,t]})})),Q?c({store:t,parentStore:C,subitemPath:A,indentLevel:A.length,titleColumnIndex:a,passesFilter:G}):null,Z?(0,Ce.jsx)(oa,{collectionContextStore:n,pathKey:T,titleColumnIndex:a,limit:j.limit,indentLevel:A.length,paddingLeft:u}):null]})}const ta=r.memo(ea,tr().A),oa=r.memo((function(e){const{collectionContextStore:t,pathKey:o,titleColumnIndex:n,limit:i,indentLevel:l,paddingLeft:a}=e,s=(0,r.useCallback)((()=>{const{subitemExpandedStore:e}=t;e.state.set(o,{isExpanded:!0,limit:i+20}),e.emit()}),[t,i,o]),c=(0,h().K8)((()=>{var e;return"title"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[t]),d=(0,y().IS)((e=>{const t=(0,z().si)({columnIndex:0,titleColumnIndex:n,indentLevel:l,isSubitemToggleOnTitleColumn:c});return{button:{width:"100%",paddingInlineStart:t,fontSize:14,borderBottom:`1px solid ${e.tableDividerColor}`},buttonInner:{height:32,width:"fit-content",display:"flex",alignItems:"center",position:"sticky",insetInlineStart:a+t,lineHeight:q().K_.UIRegular.desktop},buttonHovered:{background:e.tableRowHoveredBackground},icon:{width:Se().Ev.sm,height:Se().Ev.sm,marginInlineEnd:6,fill:e.icon.tertiary},label:{color:e.text.tertiary}}}),[n,l,c,a]);return(0,Ce.jsx)(Ro().Ay,{onClick:s,onMouseDown:Ai().t,style:d.button,hoveredStyle:d.buttonHovered,children:(0,Ce.jsxs)("div",{style:d.buttonInner,children:[(0,wl().arrowStraightDownSmallIcon)(d.icon),(0,Ce.jsx)("span",{style:d.label,children:(0,Ce.jsx)(he().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})})]})})})),na=r.createContext(null);na.displayName="CollectionGroupContainerContext";let ra=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}({});function ia(e){const{collectionContextStore:t,disabled:o,analyticsName:n,direction:i,disableRequest:l,onSelectableEnter:a,canDrop:s,canDrag:c,groupsPointer:d,loadContentCover:u,emptyDroppableSize:p,emptyDroppableStyle:g,virtualizeResults:S,timelineType:y,paddingLeft:v,paddingRight:f,headerWidth:b,shouldShowShimmer:x}=e,C=(0,m().v3)(),w=(0,h().K8)((()=>t.getViewType()),[t]),k=(0,h().K8)((()=>t.collectionViewBlockStore()),[t]),A=(0,r.useMemo)((()=>{if(k)return new(ne().B)(C,k.pointer)}),[k,C]),{groupState:T,reducer:j}=(0,h().K8)((()=>{const e=t.groupsStore.getGroupState(d);if(!e)return{groupState:void 0,reducer:void 0};const o=e.currentLimit.state,n=t.normalizedSchemaStore.state,r=I().oE(d.map((e=>(0,jr().K8)({schema:n,propertyMapping:void 0,groupBy:t.getGroupByAndGroupFormats().groupBy,group:e,timeZone:(0,Sr().P)()}))));return{groupState:e,reducer:{type:"results",filter:r.length>0?{operator:"and",filters:r}:void 0,limit:o,loadContentCover:u}}}),[t,d,u]),M=(0,h().K8)((()=>{if(t.shouldDelayRenderStore.state)return[];const e=t.groupsStore.getGroupState(d);return(null==e?void 0:e.resultsStore.state)??[]}),[t.groupsStore,t.shouldDelayRenderStore,d]),P=(0,h().K8)((()=>{if("collectionTypedView"!==t.contextType)return t.collectionStore()}),[t]),R=(0,h().K8)((()=>{const e=t.normalizedSchemaStore.state;return d.some((t=>{const o=e[t.property];if("relation"===(null==o?void 0:o.type)&&null!=o&&o.property){const t=e[o.property];if("relation"===(null==t?void 0:t.type)&&1===t.limit)return!0}return!1}))}),[t,d]),_=i===ra.Vertical;var B;M.length>0&&(null===(B=t.databaseItemsVisibleTracker)||void 0===B||B.handleItemsRenderStart());(0,r.useEffect)((()=>t.renderEmitter.emit()));const V=(0,h().K8)((()=>t.permissionScopesStore.state.canEditContent),[t.permissionScopesStore]),E=""!==(0,h().O$)(t.searchQueryStore),F=(0,h().K8)((()=>(0,Lr().N)({collectionContextStore:t}).length>0),[t]),O=d.length>0,D=0===M.length,L=y&&"table"===y,z=!x&&"board"!==w&&"calendar"!==w&&!(O&&"table"!==w&&"list"!==w&&!L)&&D&&(L||("list"===w||"table"===w)&&(E||F)||("list"===w||"table"===w||L||"gallery"===w)&&!1===V),K=p||void 0;return(0,Ce.jsxs)(Ce.Fragment,{children:[z?(0,Ce.jsx)($r,{collectionContextStore:t,paddingLeft:v,paddingRight:f,headerWidth:b,groupsPointer:d}):(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)("div",{style:{..._?{height:K}:{width:K},...g},children:(0,Ce.jsx)(aa,{collectionContextStore:t,disabled:o,analyticsName:n,direction:i,canDrop:s,groupsPointer:d,instanceCollectionViewBlockStore:A,resultStores:M,droppedIntoCollectionStore:P,onSelectableEnter:a})}),S?(0,Ce.jsx)(ca,{collectionContextStore:t,groupsPointer:d,resultComponentProps:e,canDrag:c&&!R,groupState:T,resultStores:M}):M.map(((t,o,n)=>(0,Ce.jsx)(ua,{store:t,isLast:o===n.length-1,...e,canDrag:c&&!R},t.id)))]}),(0,Ce.jsx)(pa,{collectionContextStore:t,groupsPointer:d,disableRequest:l,resultsReducer:j})]})}const la=r.memo(ia,tr().A);function aa(e){const{collectionContextStore:t,disabled:o,analyticsName:n,direction:i,onSelectableEnter:l,canDrop:a,groupsPointer:s,instanceCollectionViewBlockStore:c,resultStores:d,droppedIntoCollectionStore:u}=e,p=(0,m().v3)(),g=(0,h().K8)((()=>"collectionTypedView"===t.contextType),[t]),S=(0,h().O$)(t.isInHomeWidgetStore),y=(0,h().K8)((()=>W().f5({collectionContextStore:t})?60:void 0),[t]),{value:v}=(0,ft().fJ)(yt().VI.duplicateActions),f=(0,r.useCallback)((async e=>{const o=await Rt().T.formulas.load();return function(e,t,o,n,r,i,l){const{droppedDirection:a,duplicate:s}=e,c=o.collectionViewBlockStore();if(!c)return;const d=Wt().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Wt().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:t,getData:()=>Et().tv({collectionContextStore:o,is_native_drop:!1,is_empty:!0})});const u="collectionTypedView"===o.contextType,p=(0,di().f0)({stores:e.droppedStores,collectionContextStore:o});if(0===p.length&&u)return void ni().f1(xr().A.formatMessage(di().K0.unsupportedGroupAction));_().createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableDrop",environment:t,canUndo:!0,perform:e=>{!Er({environment:t,collectionStore:l,targetStore:c,droppedDirection:a,collectionContextStore:o,groupsPointer:n,droppedStores:p,duplicate:s,transaction:e,collapsedGroup:!1,formulasModule:r,duplicateActions:i})&&u&&ni().f1(xr().A.formatMessage(di().K0.unsupportedGroupAction))}})}(e,p,t,s,o,v,u)}),[t,u,v,p,s]),b=(0,r.useCallback)((async t=>{const o=await Rt().T.formulas.load();return function(e,t,o,n,r,i,l){const{files:a,droppedDirection:s}=e;if(!l)return;const c=o.collectionViewBlockStore();if(!c)return;const d=Wt().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Wt().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:t,getData:()=>Et().tv({collectionContextStore:o,is_native_drop:!0,is_empty:!0})}),_().createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableNativeDrop",environment:t,canUndo:!0,perform:e=>{Hl({environment:t,collectionStore:l,targetStore:c,droppedDirection:s,collectionContextStore:o,groupsPointer:n,files:a,transaction:e,formulasModule:r,duplicateActions:i})}})}(t,p,e.collectionContextStore,e.groupsPointer,o,v,u)}),[u,v,p,e.collectionContextStore,e.groupsPointer]);if(!c)return null;const x=i!==ra.Vertical&&(!o&&0===d.length),C=i===ra.Vertical&&!o;return(0,Ce.jsx)(jt().Ay,{store:c,canSelect:!1,canEditText:!1,shouldShowHalo:!S,canDrag:!1,canDropLeft:a&&x,canNativeDropLeft:a&&x&&!g,canDropBelow:a&&C,canNativeDropBelow:a&&C&&!g,canTriggerContextMenu:!1,isLastItem:0===d.length,showBlockMenuInput:!1,shouldShowHoverMenu:!1,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:f,onNativeDrop:b,analyticsName:n,shouldShowDropZone:a,onEnter:l,groupsPointer:s,verticalDropZoneExtraLeftEdgeOffset:y,style:i===ra.Vertical?void 0:{width:"100%",height:"100%"}})}function sa({collectionContextStore:e,groupsPointer:t,resultComponentProps:o,canDrag:n,groupState:i,resultStores:l}){var a;const c=0!==t.length,d=c,[u,p]=(0,r.useState)(!d),[g,S]=(0,r.useState)(0),y=(0,r.useContext)(Pt().R),v=(0,r.useRef)(null),f=(0,r.useRef)(null),b=l.length<=0,x=(0,r.useContext)(na);(0,r.useEffect)((()=>{if(!c)return;const e=new ResizeObserver((()=>{var e;null===(e=f.current)||void 0===e||e.call(f)}));if(null!=x&&x.current)return e.observe(x.current),()=>e.disconnect();console.error("Missing block to observer resizes on, this will result in a broken virtualizer")}),[x,c]);const C=(0,h().K8)((()=>{var e;return null==y||null===(e=y.verticalScroller)||void 0===e?void 0:e.getStore().state.element}),[null==y?void 0:y.verticalScroller]);(0,r.useEffect)((()=>{if(v.current&&d&&!u&&!b){if(null==C||!C.deref())return;const e=new IntersectionObserver((e=>{e[0].isIntersecting&&p(!0)}),{root:C.deref(),rootMargin:"300px 0px 300px 0px"});return e.observe(v.current),()=>e.disconnect()}}),[u,b,C,d]);const w=(0,r.useCallback)((e=>{if(v.current=e,null==C||!C.deref())return;const t=()=>{let t=e,o=0;for(;t&&t!==document.body&&t!==C.deref();)o+=t.offsetTop,t=t.offsetParent;S(o)};t(),f.current=t}),[C]),k=(0,r.useCallback)((e=>l[e].id),[l]),I=(0,Dl().Te)({count:l.length,estimateSize:()=>34,scrollMargin:g,getScrollElement:()=>(null==C?void 0:C.deref())??null,getItemKey:k,overscan:u?10:1,initialOffset:null==C||null===(a=C.deref())||void 0===a?void 0:a.scrollTop});return function({virtualizer:e,resultsStores:t,collectionContextStore:o,groupState:n}){const i=(0,r.useRef)({fetching:!1,previousTotal:0}),l=(0,m().v3)(),a=e.getVirtualItems(),c=t.length+1,d=(0,h().K8)((()=>{var e;return(null==n||null===(e=n.reducerResultStore)||void 0===e||null===(e=e.state)||void 0===e?void 0:e.hasMore)??!1}),[null==n?void 0:n.reducerResultStore]);(0,r.useEffect)((()=>{if(null!=n&&n.groupsPointer.length)return;const{fetching:e,previousTotal:t}=i.current;e&&t!==c&&(i.current={fetching:!1,previousTotal:0})}),[null==n?void 0:n.groupsPointer.length,c]),(0,r.useEffect)((()=>{if(!d||null==n||!n.groupsPointer||n.groupsPointer.length>0||i.current.fetching)return;const[r]=a.slice(-1);if(!r||c<=0)return;const u=s().A.isMobile&&c<50?.5:.67;r.index-e.options.overscan>c*u&&(i.current={fetching:!0,previousTotal:c},o.infiniteScrollLongTaskObserver.observe(),(0,_l().H)({collectionContextStore:o,environment:l,incrementLimitArgs:{isFullScreen:!0,currentResultCount:t.length,groupsPointer:null==n?void 0:n.groupsPointer,incrementLimitsInRelatedGroups:!1}}))}),[o,l,null==n?void 0:n.groupsPointer,d,t.length,c,a,e.options.overscan])}({virtualizer:I,resultsStores:l,collectionContextStore:e,groupState:i}),(0,r.useEffect)((()=>{e.virtualizedModule.setRowVirtualizer({virtualizer:I,groupsPointer:t})}),[e,I,t]),b?null:(0,Ce.jsx)("div",{ref:w,style:{height:I.getTotalSize(),width:"100%",position:"relative"},children:I.getVirtualItems().map((e=>{const t=l[e.index],r=l.length-1===e.index;return(0,Ce.jsx)("div",{"data-index":e.index,ref:I.measureElement,style:{position:"absolute",top:0,insetInlineStart:0,width:"100%",transform:`translateY(${(e.start??0)-I.options.scrollMargin}px)`},children:(0,Ce.jsx)(ua,{store:t,isLast:r,...o,canDrag:n},t.id)},e.key.toString())}))})}const ca=r.memo(sa,tr().A);function da(e){const{isLast:t,collectionContextStore:o,dropzoneGap:n,itemProps:i,renderItem:l,groupsPointer:a,shouldShowHoverMenu:s,canDrag:c,disabled:d,format:u,getItemSelectableStyle:p,handleOpenPeekPage:m,belowDropZoneMargin:g,analyticsName:S,direction:y,onSelectableEnter:v,canDrop:f,disableScrollToRevealHorizontal:b,touchDragOnly:x,blockPropertyValueOverlayStore:C,onSelectableInsertRow:w,disableSelectable:k,titleColumnIndex:I,nestedCreateSubitemButton:A,itemSelectableHaloStyle:T,paddingLeft:j}=e,M=(0,h().K8)((()=>c&&e.store.canEdit()),[c,e.store]),P=(0,h().K8)((()=>W().Dj({store:e.store,collectionContextStore:o})),[o,e.store]),R=(0,r.useMemo)((()=>[]),[]);return P?(0,Ce.jsx)(ta,{getItemSelectableStyle:p,itemSelectableHaloStyle:T,store:e.store,canDrag:M,itemProps:i,renderItem:l,collectionContextStore:o,groupsPointer:a,shouldShowHoverMenu:s,canDrop:f&&!d,format:u,handleOpenPeekPage:m,belowDropZoneMargin:g,analyticsName:S,disabled:d,direction:y,dropzoneGap:n,onSelectableEnter:v,disableScrollToRevealHorizontal:b,touchDragOnly:x,isLast:t,subitemPath:R,titleColumnIndex:I,blockPropertyValueOverlayStore:C,onSelectableInsertRow:w,disableSelectable:k,nestedCreateSubitemButton:A,paddingLeft:j}):null}const ua=r.memo(da,tr().A);function pa({collectionContextStore:e,groupsPointer:t,disableRequest:o,resultsReducer:n}){const r=(0,h().K8)((()=>e.groupsStore.getGroupState(t)),[e,t]),i=(0,h().K8)((()=>er().default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]),l=t.length>0;return o||!n||!r||l?null:(0,Ce.jsx)(Zr().A,{id:Yn().XL,reducer:n,groupsPointer:t,collectionContextStore:e,resultStore:r.reducerResultStore,debounceWait:i})}var ma=()=>o(573451),ga=()=>o(860118);const Sa=Object.freeze({fontSize:15,lineHeight:1.5,minHeight:22.5,fontWeight:q().Wy.medium,width:"auto"}),ha=Object.freeze({fontSize:17,lineHeight:1.5,minHeight:25.5,fontWeight:q().Wy.medium,width:"auto"});function ya(e){const{isMobile:t}=e;return t?ha:Sa}function va(e,t,o,n,r){const i=o.getViewType();if(!t.isDefined()||!i)return[];return(0,Go().Wp)({viewType:i,format:o.normalizedFormatStore.state,visible:!0}).filter((i=>n&&i.property!==gr().rn||(0,ga().T)({block:t.getModel(),property:i.property,schema:o.normalizedSchemaStore.state,getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,Sr().P)(),intl:xr().A.getIntl(),experimentService:er().default,collectionFeatureGates:(0,br().i)(),formulasModule:r,spaceIdCreator:e.idCreator.getSpaceIdCreatorSync(t.getSpaceId()??"")})))}function fa(e){const t=e.getViewType();if("board"===t||"gallery"===t){const o=e.normalizedFormatStore.state;return(0,Go().qI)(o,t)}return!1}var ba=()=>o(110525),xa=()=>o(577142),Ca=()=>o(777045),wa=()=>o(541056);const ka=r.memo(r.forwardRef((function(e,t){const{groupsPointer:o,groupFormat:n,collectionContextStore:i,isSingleColumn:l,isButtonOnOwnRow:a,coverHeight:c,hasVisibleProperties:d,isFullScreen:u}=e,p=(0,m().v3)(),g=(0,he().tz)(),S=(0,r.useContext)(ba().n),v=(0,h().K8)((()=>W().fG({collectionContextStore:i,environment:p,intl:g})),[i,p,g]),f=(0,r.useCallback)((e=>{S?S(e):(0,xa().navigate)({environment:p,url:e})}),[p,S]),b=(0,r.useCallback)((()=>{if(!(0,ro().E)(p))return void(0,wa().Q)(p);const e=i.groupsStore.getGroupState(o);e&&_().createAndCommit({userAction:"CollectionGalleryView.handleAddItemClick",environment:p,canUndo:!0,perform:t=>{const{mainEditorCurrentBlockStore:n}=Ut().default.state,r=(0,ur().Q)({environment:p,collectionContextStore:i,groupsPointer:o,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:t,from:{createBlock:"gallery"},inMemoryRecordCache:p.defaultRecordCache.inMemoryRecordCache});if(!r)return;const l=W().wy({environment:p,store:r.newStore,mainEditorCurrentBlockStore:n,collectionContextStore:i})??(0,Q().Ay)({store:r.newStore,pageVisitSource:$().y8.Create});f(l),M().Ey({collectionContextStore:i,resultsStore:e.resultsStore}),sr().vH(p,{from:"gallery_view_add_item_bottom",type:"page",new_page_id:r.newStore.id,creating_block_id:r.newStore.id,...(0,Et().sl)(i)})}})}),[p,i,o,f]),x=(0,y().IS)((e=>{const{fontSize:t}=ya({isMobile:Boolean(s().A.isMobile)}),o=W().rU({isMobile:Boolean(s().A.isMobile)}),n=c>0&&u&&!l&&!a,r=n&&d?c+o:n?c:o;return{wrapper:{display:"flex",flexDirection:"column",alignItems:"stretch"},addItemButton:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:t,borderRadius:kl,boxShadow:"dark"===e.mode?`${e.darkDividerColor} 0px 0px 0px 1px`:`${e.regularDividerColor} 0px 0px 0px 1px`,padding:s().A.isMobile?"12px 14px 12px 14px":"9px 14px 8px",minHeight:r,height:"100%"},linkExistingButton:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:t,borderRadius:kl,padding:s().A.isMobile?"12px 14px 12px 14px":"9px 14px 8px",marginTop:8},buttonContent:{display:"flex",alignItems:"center",marginInlineStart:-6,color:e.icon.tertiary},buttonIcon:{width:t,height:t,marginInlineStart:l?void 0:-1,marginInlineEnd:6,fill:e.icon.tertiary}}}),[c,u,l,a,d]),C=(0,r.useCallback)((e=>(0,Ce.jsx)(Ro().Ay,{style:x.linkExistingButton,...e,children:(0,Ce.jsxs)("div",{style:x.buttonContent,children:[(0,le().arrowDiagonalUpRightIcon)(x.buttonIcon),(0,Ce.jsx)(he().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})),[x]);return(0,Ce.jsxs)("div",{ref:t,style:x.wrapper,children:[(0,Ce.jsx)(Ro().Ay,{onClick:b,onMouseDown:Ai().t,style:x.addItemButton,children:(0,Ce.jsxs)("div",{style:x.buttonContent,children:[(0,ge().plusIcon)(x.buttonIcon),(0,Ce.jsx)(Ca().w,{collectionContextStore:i})]})}),v?(0,Ce.jsx)(Dr().O,{collectionContextStore:i,groupFormat:n,renderLinkButton:C}):null]})})));var Ia=()=>o(312788),Aa=()=>o(651124),Ta=()=>o(988662),ja=()=>o(27542),Ma=()=>o(752773),Pa=()=>o(557155),Ra=()=>o(765101),_a=()=>o(34556),Ba=()=>o(739041),Va=()=>o(468882);function Ea(e,t,o,n,r){const i=o.getViewType();if("board"===i||"gallery"===i){const l=(0,Go().yT)(t);R().hc({environment:e,store:t}),(0,Fl().z)({store:l}),(0,ma().C)({store:t}),r&&(0,Ba().u)(e,"board_item_edit_mode_enter",{...(0,Et().sl)(o),block_id:t.id,from:r,view_type:i}),n.setState("existing")}}function Fa(e,t,o,n,r,i,l,a){const s=r.normalizedSchemaStore.state,c=n.state;if(!c.isOpen)return;const d=va(t,o,r,l,a).map((e=>e.property)),u=d.findIndex((e=>e===c.property));let m;if("tab"===e){const e=d.find(((e,t)=>t>u&&(0,Va().B2)(s[e])))||d.find(((e,t)=>!l&&(0,Va().B2)(s[e])));m=e}else{const e=I().Uk(d,((e,t)=>t<u&&(0,Va().B2)(s[e])))||I().Uk(d,((e,t)=>!l&&(0,Va().B2)(s[e])));m=e}m?p().default.afterNextFlush((()=>{dr().ho({environment:t,blockPropertyValueOverlayStore:n,store:o,property:m,surface:"page",collectionContextStore:r})})):l&&p().default.afterNextFlush((()=>{Ea(t,o,r,i)})),dr().VN({environment:t,blockPropertyValueOverlayStore:n}),i.preventEmptyDelete()}function Oa(e,t,o,n,r,i,l,a){const s=n.normalizedSchemaStore.state,c=va(t,o,n,l,a).map((e=>e.property));let d;if("tab"===e){d=c.length>0?c[0]:void 0}else{d=I().Uk(c,((e,t)=>{const o=s[e];return(0,Va().B2)(o)}))}d&&dr().ho({environment:t,blockPropertyValueOverlayStore:r,store:o,property:d,surface:"page",collectionContextStore:n}),i.preventEmptyDelete()}function Da(e,t,n,r){const i=t.getViewType();"board"!==i&&"gallery"!==i||((0,o(299709).E)({environment:e,collectionContextStore:t,block_id:n.id,property:"title",property_type:"text",from:i}),r.preventEmptyDelete())}var La=()=>o(751735);function za(e){const{viewType:t,colorStyle:o,theme:n,backgroundColor:r}=e;return r||("board"===t?(null==o?void 0:o.cardBackgroundColor)||n.boardItemDefaultBackground:n.collectionGalleryPreviewCardBackground)}function Ka(e){const{backgroundColor:t,colorStyle:o,theme:n,isInHomeWidget:r,viewType:i}=e;return t?(0,La().e$)(t,.2):r?za({viewType:i,colorStyle:o,theme:n,backgroundColor:t}):(null==o?void 0:o.cardHoveredBackgroundColor)||n.cardHoveredBackground}function Ha(e){const{backgroundColor:t,colorStyle:o,theme:n,isInHomeWidget:r,viewType:i}=e;return t?(0,La().e$)(t,.3):r?za({viewType:i,colorStyle:o,theme:n,backgroundColor:t}):(null==o?void 0:o.cardPressedBackgroundColor)||n.cardPressedBackground}var Wa=()=>o(825225);class Na extends f().Store{getInitialState(){return"existing"}preventEmptyDelete(){"new_empty"===this.state&&(this.setState("new"),Xl().A.state.isActive&&Xl().A.setState({...Xl().A.state,transient:!1}))}}const Ga=Na;var $a=()=>o(523389),Ua=()=>o(483545);function qa(e){const{navigate:t}=(0,r.useContext)(Ia().E),n=(0,m().v3)(),i=(0,m().Y0)(),{value:l}=(0,ft().fJ)(Rt().T.formulas),a=(0,h().K8)((()=>e.collectionContextStore.normalizedFormatStore.state),[e.collectionContextStore.normalizedFormatStore]),s=(0,h().K8)((()=>e.collectionContextStore.getViewType()),[e.collectionContextStore]),c=(0,h().K8)((()=>e.collectionContextStore.permissionScopesStore.state),[e.collectionContextStore.permissionScopesStore]),d=(0,h().K8)((()=>Xl().A.state.isActive&&Xl().A.state.store===e.store),[e.store]),u=(0,h().K8)((()=>c.canEditContent&&e.store.canEdit()),[c.canEditContent,e.store]),p=(0,h().K8)((()=>oe().default.state.open&&oe().default.state.targetStore.id===e.store.id),[e.store.id]),g=(0,h().K8)((()=>{const t=(0,W().hH)(e.collectionContextStore);return(0,Va().lA)(t,!1)}),[e.collectionContextStore]),S=(0,h().K8)((()=>(0,W().wy)({environment:n,store:e.store,mainEditorCurrentBlockStore:Ut().default.state.mainEditorCurrentBlockStore,collectionContextStore:e.collectionContextStore,fullyQualified:!1})),[n,e.store,e.collectionContextStore]),y=(0,h().K8)((()=>fa(e.collectionContextStore)),[e.collectionContextStore]),v=(0,h().K8)((()=>{const t=s?(0,Go().Wp)({viewType:s,format:a,visible:!0}):[],o=va(n,e.store,e.collectionContextStore,d,l);return t.length>0&&t.length!==o.length}),[n,a,d,e.collectionContextStore,e.store,s,l]),f=(0,h().K8)((()=>{var t;const o=xt().default.state;return!("editing"!==o.mode||!e.blockPropertyValueOverlayStore.state.isOpen)&&(null===(t=(0,Pa().H)(o.multiSelection))||void 0===t?void 0:t.store)===(0,Go().yT)(e.store)}),[e.store,e.blockPropertyValueOverlayStore]),b=(0,h().K8)((()=>!(c.isLocked||!c.canEditContent||c.isSyncedCollection||c.isExternallyImportedAndSyncedCollection)&&("collectionTypedView"===e.collectionContextStore.contextType||e.store.canEdit())),[c.canEditContent,c.isExternallyImportedAndSyncedCollection,c.isLocked,c.isSyncedCollection,e.collectionContextStore,e.store]),x=e.lastProxiedUrl&&e.coverFormat&&"contain"!==e.coverAspectFormat&&u,C=b&&!d&&!f&&(y||v),w=d&&!p&&!e.disablePeekButton,k=!e.controlArgs.isRepositioning&&!e.disableMoreButton;return i.isMobile?null:(0,Ce.jsxs)(o(608581).A,{isVisible:e.controlArgs.isVisible,position:"top",children:[x&&!e.controlArgs.isRepositioning?(0,Ce.jsx)(Ro().Ay,{style:Ua().k,onClick:t=>e.controlArgs.handleRepositionClick(t,e.lastProxiedUrl),children:(0,Ce.jsx)(he().sA,{defaultMessage:"Reposition",id:"collectionViewCardItem.action.reposition"})}):void 0,x&&e.controlArgs.isRepositioning?(0,Ce.jsx)(Ro().Ay,{style:Ua().k,onClick:e.controlArgs.handleSavePositionClick,children:(0,Ce.jsx)(he().sA,{defaultMessage:"Save position",id:"collectionViewCardItem.action.savePosition"})}):void 0,x&&e.controlArgs.isRepositioning?(0,Ce.jsx)(Ro().Ay,{style:Ua().k,onClick:e.controlArgs.handleCancelClick,children:(0,Ce.jsx)(he().sA,{defaultMessage:"Cancel",id:"collectionViewCardItem.action.cancel"})}):void 0,C?(0,Ce.jsx)(qo().A,{renderTooltip:()=>(0,Ce.jsx)(he().sA,{defaultMessage:"Edit",id:"collectionCardItem.edit.tooltip"}),render:t=>(0,Ce.jsx)(Ro().Ay,{style:Ua().k,onClick:()=>{Ea(n,e.store,e.collectionContextStore,e.editModeStore,"click")},...t,children:(0,Ce.jsx)(ie().I,{icon:$a().pencilLineSmallIcon,size:"sm"})})}):void 0,w?(0,Ce.jsx)(qo().A,{renderTooltip:()=>g.tooltip,render:o=>(0,Ce.jsx)(Ro().Ay,{style:Ua().k,onClick:()=>{S&&(t({environment:n,url:S}),e.editModeStore.preventEmptyDelete())},...o,children:(0,Ce.jsx)(ie().I,{icon:g.icon,size:"sm"})})}):void 0,k?(0,Ce.jsx)(qo().A,{renderTooltip:()=>(0,Ce.jsx)(he().sA,{defaultMessage:"Rename, delete, move to and more",id:"collectionViewCardItem.repositionAction.tooltip"}),render:t=>(0,Ce.jsx)(Ro().Ay,{style:Ua().k,onClick:t=>{R().Lt({environment:n,store:e.store}),o(901265).it({environment:n,stores:bt().default.state.stores,left:t.clientX,top:t.clientY,showInput:!0,actionSectionGroupKey:"block_in_collection",analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{collectionContextStore:e.collectionContextStore}})},...t,children:(0,Ce.jsx)(ie().I,{icon:se().ellipsisSmallIcon,size:"sm"})})}):void 0]})}const Xa=r.memo(qa);var Ya=()=>o(726643);function Qa({propertyFormat:e,store:t,blockPropertyValueOverlayStore:o,collectionContextStore:n,disabled:i,editModeStore:l,isCardSelected:a}){const s=(0,m().v3)(),{value:c}=(0,ft().fJ)(Rt().T.formulas),{collectionStore:d,canEdit:u}=(0,h().K8)((()=>({collectionStore:t.getAssociatedCollectionStore(),canEdit:t.canEdit()})),[t]),{viewType:p,collectionViewStore:g,isTableWrapped:S}=(0,h().K8)((()=>({viewType:n.getViewType(),collectionViewStore:n.collectionViewStore(),isTableWrapped:Boolean(n.normalizedFormatStore.state.table_wrap)})),[n]),v=(0,h().K8)((()=>n.permissionScopesStore.state.isLocked||!n.permissionScopesStore.state.canEditContent),[n.permissionScopesStore]),f=(0,r.useCallback)((()=>Fa("tab",s,t,o,n,l,a,c)),[s,t,o,n,l,a,c]),b=(0,r.useCallback)((()=>Fa("untab",s,t,o,n,l,a,c)),[s,t,o,n,l,a,c]),x=(0,r.useCallback)((()=>function(e,t,o,n){dr().VN({environment:e,blockPropertyValueOverlayStore:t}),R().Lt({environment:e,store:o}),n.preventEmptyDelete()}(s,o,t,l)),[s,o,t,l]),C=(0,h().K8)((()=>{if(d)return d.getSchema()[e.property]}),[d,e.property]),w=(0,re().X)("card_customization"),k=(0,h().K8)((()=>g&&w?g.getCardLayoutMode():Aa().WH),[g,w]),I=(0,r.useMemo)((()=>{if("compact"!==k||!C)return!1;return new Set(["text","button","url","file"]).has(C.type)}),[k,C]),A=(0,y().IS)((()=>({wrapperStyle:{...I?{width:"100%"}:{}}})),[I]);return d?(0,Ce.jsx)("div",{style:A.wrapperStyle,children:(0,Ce.jsx)(Ya().BlockPropertyRouter,{store:t,property:e.property,disabled:i||!u,locked:v,surface:"gallery"===p?"gallery":"board",tableWrap:S||Boolean(e.wrap),blockPropertyValueOverlayStore:o,collectionStore:d,showIfEmpty:a,onEnter:x,onEsc:x,onBgClick:x,onTab:f,onUntab:b,collectionViewStore:g},e.property)}):null}const Za=r.memo(Qa);var Ja=()=>o(532940),es=()=>o(749804),ts=()=>o(819527);const os=(0,he().YK)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewCardItem.untitledBlock"},typeAName:{defaultMessage:"Type a name",id:"collectionViewCardItem.itemName.placeholder"}}),ns=Object.freeze({property:!0}),rs=r.memo((function(e){const{store:t,collectionContextStore:o,editModeStore:n,onTextEsc:i,onTextEnter:l,blockPropertyValueOverlayStore:a,isCardSelected:c}=e,d=(0,m().v3)(),u=(0,he().tz)(),{value:p}=(0,ft().fJ)(Rt().T.formulas),{collectionViewBlockId:g,collectionViewId:S,viewType:v}=(0,h().K8)((()=>{var e,t;return{collectionViewId:null===(e=o.collectionViewStore())||void 0===e?void 0:e.id,collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id,viewType:o.getViewType()}}),[o]),f=(0,h().K8)((()=>va(d,t,o,c,p).length>0),[d,t,o,c,p]),b=(0,h().K8)((()=>(0,vt().Kk)({collectionContextStore:o,blockStore:t})),[t,o]),{titleStore:x,icon:C,isEmptyPage:w,hasError:k}=(0,h().K8)((()=>({titleStore:(0,Go().yT)(t),icon:t.getIcon(),isEmptyPage:t.isEmptyPage(),hasError:t.hasError()})),[t]),I=(0,h().K8)((()=>(0,X().Te)(t)),[t]),A=(0,h().K8)((()=>(Boolean(t.getIcon())||!t.isEmptyPage())&&o.shouldShowPageIcon()),[t,o]),T=(0,h().K8)((()=>{var e;return c?u.formatMessage(os.typeAName):(null===(e=t.getModel())||void 0===e?void 0:e.getEmptyTitlePlaceholder({getRecordModel:t.getRecordModel,userTimeZone:(0,Sr().P)(),intl:u}))||u.formatMessage(os.untitledBlock)}),[c,u,t]),j=(0,h().K8)((()=>t.canEdit()&&o.permissionScopesStore.state.canEditContent),[t,o]),M=(0,r.useCallback)((()=>{Oa("tab",d,t,o,a,n,c,p)}),[d,t,o,n,a,c,p]),P=(0,r.useCallback)((()=>{Oa("untab",d,t,o,a,n,c,p)}),[d,t,o,n,a,c,p]),B=(0,r.useCallback)((()=>{(0,_a().x)(),(0,es().I)({environment:d});t.canEdit()&&o.permissionScopesStore.state.canEditContent&&("new_empty"===n.state?i(t):"new"===n.state?l(t):R().Lt({environment:d,store:t}),n.preventEmptyDelete())}),[d,t,o.permissionScopesStore,n,i,l]),V=(0,r.useCallback)((()=>{(0,_a().x)();t.canEdit()&&o.permissionScopesStore.state.canEditContent&&("new_empty"===n.state?i(t):R().Lt({environment:d,store:t}),n.preventEmptyDelete())}),[t,o.permissionScopesStore,n,i,d]),E=(0,r.useCallback)((()=>{Da(d,o,t,n)}),[d,t,o,n]),F=(0,r.useCallback)((e=>{const o=t.getIconStore();o&&_().createAndCommit({userAction:"CollectionViewCardItemTitle.handleRecordIconChange",environment:d,canUndo:!0,perform:t=>{fe().KY({store:o,value:e,transaction:t})}})}),[d,t]),O=(0,y().IS)((e=>({titleWrap:{position:"relative",width:"gallery"===v?"100%":"auto",display:"flex",alignItems:"center",paddingInlineStart:ts().w_,paddingInlineEnd:ts().w_,paddingBottom:f?6:s().A.isMobile?12:8,paddingTop:b?4:s().A.isMobile?12:8},recordIcon:{float:"inline-start",borderRadius:5,width:24,height:24,marginTop:0,marginInlineEnd:4,marginInlineStart:-2,alignSelf:"flex-start"},warningIcon:{fill:e.palette.orange[500],paddingBottom:6,paddingTop:6,display:"inline-block",verticalAlign:"bottom",...s().A.isMobile?{width:Se().Ev.default,marginInlineStart:0,marginInlineEnd:4}:{width:Se().Ev.sm,marginInlineStart:0,marginInlineEnd:6}},text:{pointerEvents:c?void 0:"none",cursor:c?"text":void 0,flexGrow:1,padding:"0 1px",whiteSpace:"pre-wrap",...ya({isMobile:Boolean(s().A.isMobile)})}})),[f,c,b,v]),D=(0,r.useMemo)((()=>({type:"page_property_value_match",propertyId:"title",collectionViewId:S,collectionViewBlockId:g})),[g,S]),L=(A||c)&&!k;return(0,Ce.jsxs)("div",{style:O.titleWrap,children:[L?j?(0,Ce.jsx)(X().B6,{disabled:!1,bucket:"secure",style:O.recordIcon,progressContainerStyle:O.recordIcon,icon:C,iconRecordCategory:I,store:t,size:s().A.isMobile?24:20,isEmptyPage:w,onChange:F}):(0,Ce.jsx)(X().B6,{disabled:!0,icon:C,iconRecordCategory:I,isEmptyPage:w,size:s().A.isMobile?24:20,style:O.recordIcon,isInCollectionView:!0}):null,k?(0,Ja().exclamationMarkTriangleIcon)(O.warningIcon):null,(0,Ce.jsx)(Ve().A,{store:x,disabled:!c,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:B,onEsc:V,onTab:M,onUntab:P,onChange:E,placeholder:T,style:O.text,disableSelectAllBlocks:!0,pasteBehavior:"inline",inPageFind:D,disabledMentionTypes:ns})]})}));function is(e,t){const{navigate:o}=(0,r.useContext)(Ia().E),{store:n,onTextEsc:i,onTextEnter:l,onShiftEnter:a,handleOpenPeekPage:s,collectionContextStore:c,blockPropertyValueOverlayStore:d}=e,u=(0,m().v3)(),p=(0,r.useRef)(null),{value:S}=(0,ft().fJ)(Rt().T.formulas),y=(0,h().uB)(void 0,No().A),v=(0,h().uB)(void 0,Ga),f=(0,h().r6)((()=>{const t=Xl().A.state;return t.isActive&&t.store===e.store}),[e.store]),b=(0,h().O$)(f),x=(0,h().K8)((()=>bt().default.state.stores.includes(n)),[n]),C=(0,h().K8)((()=>{var e,t,o;return!(n.getSpaceId()!==(null===(e=Ut().default.state.sidebarSpaceStore)||void 0===e?void 0:e.id))&&((null===(t=c.collectionViewStore())||void 0===t?void 0:t.getFormat().app_config_uri)===Bo().Lu&&n.getFormat().app_config_uri===Bo().e4&&"sprint_board"===(null===(o=Ut().default.state.mainEditorCurrentBlockStore)||void 0===o?void 0:o.getFormat().special_page_for_pm_launch))}),[n,c]),w=(0,h().K8)((()=>{const e=Ut().default.state.mainEditorCurrentBlockStore;return(0,W().wy)({environment:u,store:n,mainEditorCurrentBlockStore:e,collectionContextStore:c,fullyQualified:!1})}),[u,c,n]),k=(0,r.useCallback)((()=>{Ea(u,n,c,v,"space")}),[u,n,c,v]),I=(0,r.useCallback)((()=>{(0,_a().x)(),v.preventEmptyDelete()}),[v]),A=(0,r.useCallback)((()=>{l(n)}),[l,n]),T=(0,r.useCallback)((()=>{Fa("tab",u,n,d,c,v,b,S)}),[u,n,d,c,v,b,S]),j=(0,r.useCallback)((()=>{Fa("untab",u,n,d,c,v,b,S)}),[u,n,d,c,v,b,S]),M=(0,r.useCallback)((()=>{_().createAndCommit({userAction:"CollectionViewCardItem.handleShiftEnter",environment:u,canUndo:!0,perform:e=>{a({blocks:bt().default.state.stores,transaction:e})}})}),[u,a]),P=(0,r.useCallback)((e=>{"new_empty"!==v.state||e.state||c.defaultPageTemplateStore.state||(i(n),e.removeListener(P))}),[c.defaultPageTemplateStore,v,i,n]);return(0,g().l)((()=>{var t;const o=xt().default.state,n=Xl().A.state,r=n.isActive&&n.transient,i="editing"===o.mode&&(null===(t=(0,Pa().H)(o.multiSelection))||void 0===t?void 0:t.store)===(0,Go().yT)(e.store);i&&r?v.setState("new_empty"):i?v.setState("new"):v.setState("existing")})),(0,r.useEffect)((()=>(f.state&&"new_empty"===v.state&&f.addListener(P),()=>{f.removeListener(P)})),[v,f,P]),(0,Ht().NW)(n,t,(0,r.useMemo)((()=>({renderedType:"page",getBlockStore:()=>n,getNode:()=>p.current,activate:()=>{w&&(s(),o({environment:u,url:w}))}})),[u,s,w,n,o]),(0,Ce.jsx)(Je().N,{debugName:"CollectionViewCardItem",capture:b,onEsc:I,onEnter:A,onSpace:k,onTab:T,onUntab:j,children:(0,Ce.jsxs)(Je().N,{debugName:"CollectionViewCardItem",capture:x,onShiftEnter:M,onSpace:e=>e.stopPropagation(),children:[(0,Ce.jsx)(as,{...e,ref:p,mouseStore:y,editModeStore:v,isCardSelected:b,peekUrl:w}),C?(0,Ce.jsx)(Ra().Ni,{origin:p}):void 0]})}))}const ls=r.memo(r.forwardRef(is)),as=r.memo(r.forwardRef((function(e,t){var n;const{store:i,disabled:l,peekUrl:a,editModeStore:s,handleOpenPeekPage:c,collectionContextStore:d,blockPropertyValueOverlayStore:u,mouseStore:p,isCardSelected:g,coverFormat:S,coverAspectFormat:v,colorStyle:f,coverSizeFormat:b,coverWidth:x,coverHeight:C}=e,w=(0,m().v3)(),k=(0,m().Y0)().isMobile,I=(0,Ee().Zp)(),{value:A}=(0,ft().fJ)(Rt().T.formulas),[T,j]=(0,r.useState)(void 0),M=null===(n=(0,Wa().y)(i))||void 0===n?void 0:n.background,P=(0,h().K8)((()=>(0,Gl().Wi)(w,i.id)),[w,i]),R=(0,h().K8)((()=>p.state.mouseEntered),[p]),{viewType:B,isInHomeWidget:V}=(0,h().K8)((()=>({viewType:d.getViewType(),isInHomeWidget:d.isInHomeWidgetStore.state})),[d]),E=(0,h().K8)((()=>(0,Q().Ay)({store:i,fullyQualified:!1,pageVisitSource:$().y8.LinkInPage})),[i]),F=(0,h().K8)((()=>fa(d)),[d]),O=(0,h().K8)((()=>va(w,i,d,g,A)),[w,i,d,g,A]),D=(0,h().K8)((()=>(0,vt().xC)({collectionContextStore:d,blockStore:i})),[d,i]),L=(0,h().K8)((()=>(0,vt().Kk)({collectionContextStore:d,blockStore:i})),[d,i]),z=(0,h().K8)((()=>(0,o(299545).oC)(i,{recursivelyLoadAllDiscussions:!1})>0),[i]),K=(0,re().X)("card_customization"),H=(0,h().K8)((()=>{var e;return d.collectionViewStore&&K?null===(e=d.collectionViewStore())||void 0===e?void 0:e.getCardLayoutMode():Aa().WH}),[d,K]),W=(0,r.useCallback)((e=>{j(e)}),[j]),N=(0,r.useCallback)((e=>{c(),s.preventEmptyDelete()}),[s,c]),G=(0,r.useCallback)((()=>{Qt().A.state||p.setState({...p.state,mouseEntered:!0})}),[p]),U=(0,Rl().d)(G,100),X=(0,r.useCallback)((()=>{p.setState({...p.state,mouseEntered:!1})}),[p]),Y=(0,Pl().Y)(X,100),Z=(0,r.useCallback)((e=>{_().createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:w,canUndo:!0,perform:t=>{ve().G8({store:i,coverPosition:e.imagePosition,transaction:t}),e.reset()}})}),[w,i]),J=(0,r.useCallback)((e=>P||null!=I&&I.disableContentPointerEvents?null:(0,Ce.jsx)(Xa,{store:i,collectionContextStore:d,blockPropertyValueOverlayStore:u,coverFormat:S,coverAspectFormat:v,lastProxiedUrl:T,editModeStore:s,controlArgs:e,disablePeekButton:null==I?void 0:I.disablePageLinks,disableMoreButton:null==I?void 0:I.disablePageLinks})),[u,d,I,v,S,s,T,i,P]),ee=(0,y().IS)((e=>{const t=za({viewType:B,colorStyle:f,theme:e,backgroundColor:M}),o=V?e.homeShadow.card.base:`${e.shadow.base.sm}, 0 0 0 1px ${(null==f?void 0:f.borderColor)||e.border.secondaryTranslucent}`;return{linkBox:{borderRadius:kl,position:R?"relative":"static",overflow:"hidden",transition:"background 100ms ease-out",background:t,..."board"===B?{marginBottom:k?10:8}:{height:"100%"},boxShadow:o},linkBoxInner:{userSelect:g?void 0:"none",WebkitUserSelect:g?void 0:"none",height:"100%",..."board"===B?{minHeight:40}:{display:"flex",flexDirection:"column"}},linkBoxHovered:{background:Ka({backgroundColor:M,colorStyle:f,theme:e,isInHomeWidget:V,viewType:B}),boxShadow:o},linkBoxPressed:{background:Ha({backgroundColor:M,colorStyle:f,theme:e,isInHomeWidget:V,viewType:B}),boxShadow:o},propertiesWrapper:{paddingTop:F?0:8,lineHeight:1.5,display:"flex",flexDirection:"compact"===H?"row":"column",flexWrap:"compact"===H?"wrap":void 0,marginInlineStart:"compact"===H?6:0,marginInlineEnd:"compact"===H?6:0,..."board"===B?{paddingBottom:6}:{paddingBottom:8,...V&&{flexWrap:"wrap"}}},iconsWrapper:{display:"flex",alignItems:"center",paddingInlineEnd:10,paddingBottom:z?4:8,paddingInlineStart:!z||L||F?10:4,paddingTop:"gallery"===B&&0===O.length?8:0,marginTop:"board"===B&&z?-2:0},commentsIndicatorWrapper:{display:"flex",alignItems:"center",color:e.text.tertiary,fill:e.text.tertiary,fontWeight:q().Wy.medium,fontSize:12}}}),[M,B,f,R,k,V,g,z,L,F,O.length,H]);return"board"!==B&&"gallery"!==B?null:(0,Ce.jsxs)(je().A,{ref:t,href:E,metaHref:k?E:a,onMouseEnter:U,onMouseMove:U,onMouseLeave:Y,onClick:N,style:ee.linkBox,innerStyle:ee.linkBoxInner,hoveredStyle:g?{background:ee.linkBox.background}:ee.linkBoxHovered,pressedStyle:g?{background:ee.linkBox.background}:ee.linkBoxPressed,disableForOffline:P,children:[(0,Ce.jsx)(o(801678).A,{store:i,source:B,mouseStore:p,renderControl:J,small:"small"===b,onFlushTemporaryPosition:Z,render:({imagePosition:e})=>S&&(0,Ce.jsx)(o(358006).z,{variant:"gallery",store:i,coverWidth:x,coverHeight:C,coverFormat:S,coverAspectFormat:v,coverSizeFormat:b,coverPosition:e,showEmptyGalleryCover:"gallery"===B,onLoadProxiedImage:W,isInHomeWidget:d.isInHomeWidgetStore.state})}),D?(0,Ce.jsx)("div",{style:{paddingInlineEnd:6,paddingTop:8,paddingBottom:0,paddingInlineStart:6,maxWidth:"100%"},children:(0,Ce.jsx)(ja().n,{blockStore:i,collectionContextStore:d})}):void 0,F?(0,Ce.jsx)(rs,{collectionContextStore:d,store:i,blockPropertyValueOverlayStore:u,onTextEsc:e.onTextEsc,onTextEnter:e.onTextEnter,editModeStore:e.editModeStore,isCardSelected:e.isCardSelected}):null,O.length>0?(0,Ce.jsx)("div",{style:ee.propertiesWrapper,children:O.map((e=>(0,Ce.jsx)(Za,{store:i,disabled:l,blockPropertyValueOverlayStore:u,collectionContextStore:d,editModeStore:s,isCardSelected:g,propertyFormat:e},e.property)))}):void 0,z||L?(0,Ce.jsxs)("div",{style:ee.iconsWrapper,children:[L?(0,Ce.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,Ce.jsx)(Ma().W,{blockStore:i,collectionContextStore:d})}):void 0,(0,Ce.jsx)(Ta().g,{store:i,iconStyle:ee.commentsIndicatorWrapper,buttonStyle:{position:"relative",marginInlineStart:L?-3:0}})]}):void 0]})}))),ss=r.memo((function(e){const{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:a,style:s,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:S,coverSizeFormat:h,coverHeight:y,coverWidth:v,onTextEnter:f,onTextEsc:b,onShiftEnter:x,blockPropertyValueOverlayStore:C,handleOpenPeekPage:w,collectionContextStore:k}=e;return(0,Ce.jsx)(xe().c,{store:t,step:"demo_collection_record",children:(0,Ce.jsx)(ls,{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:a,style:s,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:S,coverSizeFormat:h,coverHeight:y,coverWidth:v,colorStyle:void 0,onTextEnter:f,onTextEsc:b,onShiftEnter:x,blockPropertyValueOverlayStore:C,handleOpenPeekPage:w,collectionContextStore:k})})}));var cs=()=>o(62856);function ds(e){const t=e.minHeight||Ss,o=(0,y().IS)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,background:e.largeShimmerColor,minHeight:t}})),[t]);return(0,Ce.jsx)(wn().A,{style:o.card})}function us(e){const{hasPartialResults:t}=e;if(!(0,cs().A)(!0,0,100))return null;const n=e.coverHeight??o(963575).A.card.desktop.medium.height,r=t?void 0:n+40,i=t?1:3,l=I().Hn(i,(e=>(0,Ce.jsx)(ds,{minHeight:r},e)));return(0,Ce.jsx)(Ce.Fragment,{children:l})}const ps=r.memo((function(e){var t;const{groupFormat:o,store:n,format:i,disabled:l,collectionContextStore:a,schema:c,blockPropertyValueOverlayStore:d,isFullScreen:u,collectionGalleryViewStore:p,headerWidth:m,paddingLeft:g,paddingRight:S}=e,v=(0,r.useRef)(null),f=(0,r.useRef)(null),[b,x]=(0,r.useState)(!1),C=(0,r.useMemo)((()=>o?[o]:[]),[o]),w=m<=gs,k=(0,h().K8)((()=>a.groupsStore.anyGroupHasResults()),[a]),I=(0,h().K8)((()=>a.groupsStore.getGroupState(C)),[a,C]),A=(0,h().K8)((()=>p.state.coverHeight),[p]),{reducerResult:T,hasPartialResults:j}=(0,h().K8)((()=>{const e=null==I?void 0:I.reducerResultStore.state;return{reducerResult:e,hasPartialResults:void 0!==e&&(null==e?void 0:e.blockIds.length)>0}}),[I]),M=(0,h().K8)((()=>(0,Jr().iv)({collectionContextStore:a,groupsPointer:C,hasPartialResults:j})),[a,C,j]),P=(0,h().K8)((()=>W().XQ({collectionContextStore:a,reducerResult:T,isFullScreen:u})),[a,T,u]),{canEditContent:R,isSyncedCollection:_}=(0,h().O$)(a.permissionScopesStore),B=(0,h().K8)((()=>n.isSystemBlock()),[n]),V=(0,h().K8)((()=>n.canEdit()&&("collectionTypedView"===a.contextType||R)),[n,a,R]),E=(0,h().O$)(a.isInHomeWidgetStore);(0,r.useEffect)((()=>f.current&&v.current?x(f.current.offsetTop>v.current.offsetTop):x(!1)),[f,v,null==T?void 0:T.blockIds]);const F=(0,y().IS)((e=>{const t=i.collection_group_by,n=i.gallery_cover_size,{fontSize:r}=ya({isMobile:Boolean(s().A.isMobile)});return{container:{paddingBottom:o?16:void 0},resultsWrapper:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${w?"100%":`${W().rq(n)}px`}, 1fr))`,gridRowGap:16,gridColumnGap:16,paddingTop:t?1:16,paddingBottom:4,...E?{paddingInlineStart:8,paddingInlineEnd:8}:{}},loadMoreButton:{fontSize:r},loadMoreButtonIcon:{width:r,height:r},renderLoadMoreButtonDivider:{width:"100%",borderTop:o?void 0:`1px solid ${e.tableDividerColor}`,marginTop:4,marginBottom:4}}}),[i.collection_group_by,i.gallery_cover_size,o,E,w]);if(!I)return null;const O=void 0!==o,D=!E&&k&&!l&&V&&!_&&(j||!M)&&!B,L=Boolean(null===(t=i.gallery_properties)||void 0===t||null===(t=t.filter((e=>e.visible)))||void 0===t?void 0:t.length);return(0,Ce.jsxs)("div",{style:F.container,children:[(0,Ce.jsxs)("div",{style:F.resultsWrapper,children:[(0,Ce.jsx)(ms,{collectionContextStore:a,groupFormat:o,format:i,schema:c,disabled:l,store:n,blockPropertyValueOverlayStore:d,collectionGalleryViewStore:p,isSingleColumn:w,paddingLeft:g,paddingRight:S,headerWidth:m,shouldShowShimmer:M}),(0,Ce.jsx)("div",{ref:v,style:{display:"none"}}),M?(0,Ce.jsx)(us,{hasGroups:O,hasPartialResults:j,coverHeight:A}):null,D?(0,Ce.jsx)(ka,{ref:f,collectionContextStore:a,groupsPointer:C,groupFormat:o,isSingleColumn:w,isButtonOnOwnRow:b,coverHeight:i.gallery_cover&&A?A:0,hasVisibleProperties:L,isFullScreen:u}):null]}),P?(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)("div",{style:F.renderLoadMoreButtonDivider}),(0,Ce.jsx)(Ol().jJ,{groupsPointer:C,store:n,collectionContextStore:a,format:i,isFullScreen:u,incrementLimitsInRelatedGroups:!1,style:F.loadMoreButton,iconStyle:F.loadMoreButtonIcon})]}):null]})})),ms=r.memo((function(e){const{collectionContextStore:t,groupFormat:o,format:n,schema:i,disabled:l,store:a,blockPropertyValueOverlayStore:s,collectionGalleryViewStore:c,isSingleColumn:d,paddingLeft:u,paddingRight:p,headerWidth:g,shouldShowShimmer:S}=e,y=(0,m().v3)(),v=(0,r.useMemo)((()=>o?[o]:[]),[o]),f=(0,h().O$)(t.permissionScopesStore),b=(0,h().K8)((()=>a.canEdit()&&("collectionTypedView"===t.contextType||f.canEditContent)),[t,f.canEditContent,a]),x=(0,r.useCallback)((e=>{const t=e.blocks;if(t.length>0){const e=t[0],o=e.getBlockTitleStore();R().hc({environment:y,store:e}),(0,Fl().z)({store:o}),(0,ma().C)({store:e})}}),[y]),C=(0,r.useCallback)((e=>{const o=t.collectionStore(),n=e.getTitleStore();if(!n)return;k().q4_(n.getValue())?R().Lt({environment:y,store:e}):o&&_().createAndCommit({userAction:"CollectionGalleryView.handleItemTextEsc",environment:y,canUndo:!0,perform:t=>{Lo().by({childStore:e,transaction:t})}})}),[t,y]),w=(0,r.useMemo)((()=>d?{position:"absolute",top:6,insetInlineStart:0,insetInlineEnd:0,height:4}:{position:"absolute",top:16,bottom:4,width:4,height:"none"}),[d]),{gallery_cover:I,gallery_cover_aspect:A,gallery_cover_size:T}=n,j=!l&&b&&!f.isSyncedCollection,{coverHeight:M,coverWidth:P}=(0,h().O$)(c),B=(0,r.useMemo)((()=>({format:n,schema:i,onTextEnter:C,onTextEsc:C,onShiftEnter:x,disabled:l,coverFormat:I,coverAspectFormat:A,coverSizeFormat:T,coverHeight:M,coverWidth:P,blockPropertyValueOverlayStore:s,collectionContextStore:t})),[s,t,M,P,A,I,T,l,n,x,C,i]);return(0,Ce.jsx)(la,{collectionContextStore:t,groupsPointer:v,format:n,canDrag:j,onSelectableEnter:x,itemProps:B,renderItem:ss,canDrop:!0,disabled:l,shouldShowHoverMenu:!1,direction:d?ra.Vertical:ra.Horizontal,belowDropZoneMargin:6,emptyDroppableSize:4,dropzoneGap:10,analyticsName:"gallery",emptyDroppableStyle:w,loadContentCover:I&&"page_content"===I.type,paddingLeft:u,paddingRight:p,headerWidth:g,shouldShowShimmer:S})})),gs=480,Ss=40,hs=r.memo((function(e){const{store:t,format:o,collectionContextStore:n,isFullScreen:i,isPreviewing:l,isRootChild:a,blockPropertyValueOverlayStore:c,disabled:d,schema:u,paddingBottom:p,paddingLeft:g,paddingRight:S,minWidth:v,headerWidth:f}=e,b=(0,m().v3)(),x=(0,r.useRef)(null),C=(0,h().uB)(void 0,El),{coverWidth:w,coverHeight:k}=(0,h().O$)(C),I=(0,h().K8)((()=>W().mM(n,i)),[n,i]),A=(0,h().O$)(n.isInHomeWidgetStore),T=(0,h().K8)((()=>Boolean(n.viewsModuleContextStore.getViewModuleType())),[n]),j=(0,r.useCallback)((()=>{if(x.current){const e=x.current.getNode();if(e){const t=e.querySelector(`.${Vt().E4t}`);if(null!==t&&t instanceof HTMLDivElement)return t.offsetWidth}}return W().rq(o.gallery_cover_size)}),[o.gallery_cover_size]),M=(0,r.useCallback)((e=>{C.setState({coverHeight:C.state.coverHeight,coverWidth:e||j()})}),[C,j]),P=(0,r.useCallback)((()=>j()*(9/16)),[j]),R=(0,r.useCallback)((e=>{C.setState({coverWidth:C.state.coverWidth,coverHeight:e||P()})}),[C,P]),_=(0,r.useCallback)((e=>{var t;const o=n.isLoadingStore.state,r=null===(t=n.groupsStore.getGroupState([]))||void 0===t||null===(t=t.reducerResultStore)||void 0===t?void 0:t.state;e<ko().B.incrementScrollOffset&&r&&!o&&null!=r&&r.hasMore&&(0,_l().H)({collectionContextStore:n,environment:b,incrementLimitArgs:{isFullScreen:i,currentResultCount:r.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[n,b,i]),B=(0,r.useCallback)((()=>{const e=P(),t=j();k!==e&&R(e),w!==t&&M(t)}),[P,j,k,w,R,M]),V=(0,Pl().Y)(B,100),E=(0,Rl().d)(B,100);(0,r.useEffect)((()=>{M(j()),R()}),[j,R,M,null==o?void 0:o.gallery_cover_size]),(0,r.useEffect)((()=>{const e=s().A.isMobile;return(0,Dt().P)(window,"resize",E),e&&(0,Dt().P)(window,"orientationchange",V),()=>{(0,Lt().O)(window,"resize",E),e&&(0,Lt().O)(window,"orientationchange",V)}}),[V,E]);const F=(0,y().IS)((()=>({container:{paddingBottom:p,paddingInlineStart:g,paddingInlineEnd:S,minWidth:v}})),[v,p,g,S]),O=o.collection_group_by,D=(0,Ee().Zp)();return(0,Vl().A)((e=>(0,Ce.jsxs)("div",{style:F.container,className:Vt().wx0,children:[(0,Ce.jsx)(jt().Ay,{location:"collectionGalleryView",store:t,shouldShowHalo:!i&&!A&&!l,canSelect:!i&&!T,disablePointerEvents:null==D?void 0:D.disableContentPointerEvents,analyticsName:"gallery",...e,ref:x,children:O?(0,Ce.jsx)(ys,{blockPropertyValueOverlayStore:c,collectionContextStore:n,collectionGalleryViewStore:C,disabled:d,format:o,isFullScreen:i,isRootChild:a,paddingLeft:g,paddingRight:S,headerWidth:f,schema:u,store:t}):(0,Ce.jsx)(ps,{blockPropertyValueOverlayStore:c,collectionContextStore:n,collectionGalleryViewStore:C,disabled:d,format:o,groupFormat:void 0,isFullScreen:i,headerWidth:f,schema:u,store:t,paddingLeft:g,paddingRight:S})}),I?void 0:(0,Ce.jsx)(Bl().A,{onChange:_})]})))}),tr().A),ys=r.memo((function(e){const{collectionContextStore:t,store:o,format:n,disabled:i,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:c,paddingLeft:d,paddingRight:u,isRootChild:p,headerWidth:g,collectionGalleryViewStore:S}=e,h=(0,m().v3)(),y=(0,r.useCallback)((e=>(0,Ce.jsx)(vs,{collectionGroupHeaderProps:e})),[]),v=(0,r.useCallback)((e=>{if(s().A.isMobile)Zn().uK({environment:h,store:e,pageVisitSource:$().y8.Create});else{const o="collectionTypedView"===t.contextType;Jn().VU({environment:h,store:e,peekMode:W().hH(t),showMoveTo:o,resultsStore:void 0,collectionContextStore:t,pageVisitSource:$().y8.Create})}}),[t,h]),f=(0,r.useCallback)((e=>(0,Ce.jsx)(ps,{store:o,format:n,disabled:i,collectionContextStore:t,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:c,collectionGalleryViewStore:S,groupFormat:e,headerWidth:g,paddingLeft:d,paddingRight:u})),[o,n,i,t,l,a,c,S,g,d,u]),b=(0,r.useCallback)((e=>({})),[]);return(0,Ce.jsx)(Ps,{reducerId:Yn().X8,store:o,collectionContextStore:t,disabled:i,isFullScreen:c,isRootChild:p,paddingLeft:d,paddingRight:u,stickyLeft:!1,renderHeader:y,onGroupHeaderAddItem:v,renderGroupResults:f,getGroupStyle:b,headerWidth:g})})),vs=r.memo((function(e){const{collectionGroupHeaderProps:t}=e,o=(0,h().O$)(t.collectionContextStore.isInHomeWidgetStore),{stickyStyle:n}=(0,y().IS)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${e.background.primary}`}})),[]);return(0,Ce.jsx)(Sl,{...t,height:o?Go().ag:48,stickyStyle:n})}));function fs(e){const{width:t}=e,o=(0,m().v3)(),n=(0,h().K8)((()=>o.WindowSizeStore.state.width<=gs),[o]),r=(0,y().IS)((e=>({container:{display:"flex",flexDirection:"column",alignItems:"flexStart",alignSelf:"stretch",paddingBottom:12,height:t},groupContainer:{display:"flex",height:46,alignItems:"center",alignSelf:"stretch"},itemsContainer:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${n?"100%":`${t}px`}, 1fr))`,gap:16,paddingTop:1,paddingBottom:4,width:"100%",height:"100%"},iconContainer:{display:"flex",width:22,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,marginInlineStart:8,borderRadius:12,backgroundColor:e.lightDividerColor}})),[t,n]);return(0,Ce.jsxs)("div",{style:r.container,children:[(0,Ce.jsxs)("div",{style:r.groupContainer,children:[(0,Ce.jsx)("div",{style:r.iconContainer,children:Ml(r.icon)}),(0,Ce.jsx)(wn().A,{style:r.groupShimmer})]}),(0,Ce.jsxs)("div",{style:r.itemsContainer,children:[(0,Ce.jsx)(ds,{}),(0,Ce.jsx)(ds,{}),(0,Ce.jsx)(ds,{})]})]})}function bs(e){const{isFullScreen:t,galleryCoverSize:o}=e,n=t?2:1,r=(0,W().rq)(o),i=I().Hn(n,(e=>(0,Ce.jsx)(fs,{width:r},e)));return(0,Ce.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:i})}function xs(){const e=(0,y().IS)((e=>({container:{padding:"8px 0px",width:"100%"},groupContainer:{display:"flex",height:36,paddingInlineEnd:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",paddingInlineStart:16,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch",borderBottom:`1px solid ${e.regularDividerColor}`},lastRowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:100,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:60,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerLong:{width:200,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},firstColumn:{display:"flex",width:360,height:34,padding:"7px 8px",alignItems:"center",gap:6},column:{display:"flex",width:200,height:34,padding:"6px 8px",alignItems:"center",gap:6}})),[]);return(0,Ce.jsxs)("div",{style:e.container,children:[(0,Ce.jsxs)("div",{style:e.groupContainer,children:[(0,Ce.jsx)("div",{style:e.iconContainer,children:Ml(e.icon)}),(0,Ce.jsx)(wn().A,{style:e.groupShimmer})]}),(0,Ce.jsxs)("div",{style:e.rowsContainer,children:[(0,Ce.jsxs)("div",{style:e.rowContainer,children:[(0,Ce.jsxs)("div",{style:e.firstColumn,children:[(0,Ce.jsx)(wn().A,{style:e.circleShimmer}),(0,Ce.jsx)(wn().A,{style:e.rowShimmerShort})]}),(0,Ce.jsx)("div",{style:e.column,children:(0,Ce.jsx)(wn().A,{style:e.rowShimmerShort})}),(0,Ce.jsx)("div",{style:e.column,children:(0,Ce.jsx)(wn().A,{style:e.rowShimmerShort})}),(0,Ce.jsx)("div",{style:e.column,children:(0,Ce.jsx)(wn().A,{style:e.rowShimmerShort})})]}),(0,Ce.jsxs)("div",{style:e.rowContainer,children:[(0,Ce.jsxs)("div",{style:e.firstColumn,children:[(0,Ce.jsx)(wn().A,{style:e.circleShimmer}),(0,Ce.jsx)(wn().A,{style:e.rowShimmerLong})]}),(0,Ce.jsx)("div",{style:e.column,children:(0,Ce.jsx)(wn().A,{style:e.rowShimmer})}),(0,Ce.jsx)("div",{style:e.column,children:(0,Ce.jsx)(wn().A,{style:e.rowShimmer})}),(0,Ce.jsx)("div",{style:e.column,children:(0,Ce.jsx)(wn().A,{style:e.rowShimmer})})]}),(0,Ce.jsxs)("div",{style:e.lastRowContainer,children:[(0,Ce.jsxs)("div",{style:e.firstColumn,children:[(0,Ce.jsx)(wn().A,{style:e.circleShimmer}),(0,Ce.jsx)(wn().A,{style:e.rowShimmerLong})]}),(0,Ce.jsx)("div",{style:e.column,children:(0,Ce.jsx)(wn().A,{style:e.rowShimmer})}),(0,Ce.jsx)("div",{style:e.column,children:(0,Ce.jsx)(wn().A,{style:e.rowShimmer})}),(0,Ce.jsx)("div",{style:e.column,children:(0,Ce.jsx)(wn().A,{style:e.rowShimmer})})]})]})]})}function Cs(e){const{isFullScreen:t}=e,o=t?2:1,n=I().Hn(o,(e=>(0,Ce.jsx)(xs,{},e)));return(0,Ce.jsx)("div",{style:{display:"flex",paddingTop:8,paddingInlineStart:4,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",width:"100%"},children:n})}function ws(){const e=(0,y().IS)((e=>({rowsContainer:{paddingTop:8},rowContainer:{display:"flex",height:28,alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0"},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginInlineStart:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:"50%",height:10,flexShrink:0,borderRadius:12,marginInlineStart:12,backgroundColor:e.lightDividerColor}})),[]);return(0,Ce.jsxs)("div",{style:e.rowsContainer,children:[(0,Ce.jsx)("div",{style:e.rowContainer,children:(0,Ce.jsx)(wn().A,{style:e.rowShimmerShort})}),(0,Ce.jsx)("div",{style:e.rowContainer,children:(0,Ce.jsx)(wn().A,{style:e.rowShimmer})})]})}var ks=()=>o(812119);function Is(){const e=(0,y().IS)((e=>({container:{display:"flex",padding:"8px 0px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},groupContainer:{display:"flex",height:36,paddingInlineEnd:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor}})),[]),t=(0,gt().Ks)(),o=(0,h().K8)((()=>null==t?void 0:t.isInHomeWidgetStore.state),[t]),n=["50%","30%","40%"].map(((e,t)=>(0,Ce.jsx)(ks().J,{widthPercentage:e,isInHomeWidget:o},t)));return(0,Ce.jsxs)("div",{style:e.container,children:[(0,Ce.jsxs)("div",{style:e.groupContainer,children:[(0,Ce.jsx)("div",{style:e.iconContainer,children:Ml(e.icon)}),(0,Ce.jsx)(wn().A,{style:e.groupShimmer})]}),(0,Ce.jsx)("div",{style:e.rowsContainer,children:n})]})}function As(e){const{isFullScreen:t}=e,o=t?2:1,n=I().Hn(o,(e=>(0,Ce.jsx)(Is,{},e)));return(0,Ce.jsx)("div",{style:{display:"flex",padding:"8px 4px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},children:n})}function Ts(e){const{viewType:t,isFullScreen:o,galleryCoverSize:n}=e;if(!(0,cs().A)(!0,0,100))return null;switch(t){case"table":return(0,Ce.jsx)(Cs,{isFullScreen:o});case"list":return(0,Ce.jsx)(As,{isFullScreen:o});case"gallery":return(0,Ce.jsx)(bs,{isFullScreen:o,galleryCoverSize:n});case"timeline":return(0,Ce.jsx)(ws,{});default:return null}}const js=new Set(["dropzone","table"]),Ms=new Set(["item","table"]),Ps=r.memo((function(e){const{collectionContextStore:t,disabled:n,getGroupStyle:i,headerWidth:l,isFullScreen:a,isRootChild:c,onGroupHeaderAddItem:d,paddingLeft:u,paddingRight:p,reducerId:m,renderGroupResults:g,renderHeader:S,stickyLeft:v,store:f,timelineType:b}=e,x=s().A.isMobile,C=(0,h().O$)(t.isInPeekRendererStore),w=(0,h().K8)((()=>{var e;return null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()}),[t]),k=(0,h().O$)(t.permissionScopesStore),I=(0,h().O$)(t.normalizedFormatStore),A=null==I?void 0:I.collection_group_by,T=null==I?void 0:I.board_columns_by,j=(0,h().O$)(t.groupsLimitStore),M=(0,h().O$)(t.normalizedSchemaStore),P=(0,h().K8)((()=>t.normalizedQueryStore.state??{}),[t.normalizedQueryStore]),R=(0,h().K8)((()=>{if("board"===w&&A&&T)return;if(!A||!I)return;if(b&&js.has(b))return;const e=ui({collectionContextStore:t,isMobile:Boolean(x),groupBy:A});return(0,Xn().p)({groupBy:A,schema:M,format:I,groupsFormatKey:Qn().V1,limit:j,aggregation:I.collection_group_aggregation,blockResults:e})}),[w,A,T,I,b,t,x,M,j],{useDeepEqual:!0}),_=(0,h().uB)(e.groupsResultStore,Qr),B=(0,h().O$)(_),V=(0,ei().d)("board"===w?{subGroupBy:A,reducerResult:B}:{groupBy:A,reducerResult:B}),E=(0,h().K8)((()=>!(b&&Ms.has(b))&&(0,Jr().c_)({collectionContextStore:t,displayState:V})),[t,V,b]),F=(0,h().K8)((()=>{const{visibleGroups:e}=V;return 0===e.length&&!t.shouldShowSpinnerStore.state||e.length>0}),[t,V]),O=(0,h().K8)((()=>(0,di().Zl)(V,t,!1)),[V,t]),D=(0,h().K8)((()=>!n&&!k.isLocked&&k.canConfigureBlock&&!E&&A&&(0,Qn().pP)(A,k.canConfigureCollection)&&"collectionTypedView"!==t.contextType&&!(0,o(443239).u)(A.property)&&F),[F,t,k.canConfigureBlock,k.canConfigureCollection,k.isLocked,n,A,E]),L=(0,h().K8)((()=>er().default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]),z=(0,y().IS)((()=>({container:{position:"relative"},buttonWrapper:{display:"flex",flexDirection:Boolean(b)?"column":"row",marginTop:"board"===w?-12:void 0,marginBottom:8,position:"sticky",insetInlineStart:u?u+2:0,width:"fit-content"}})),[u,b,w]),K=!("board"===w||"dropzone"===b||"item"===b)&&!E&&0===V.visibleGroups.length&&0===V.pinnedGroups.groups.length,H=(0,r.useCallback)((()=>K?(0,Ce.jsx)($r,{collectionContextStore:t,paddingLeft:u,paddingRight:p,headerWidth:l}):(0,Ce.jsxs)("div",{style:z.container,children:[A?V.visibleGroups.map(((e,o)=>(0,Ce.jsx)(xl,{collectionContextStore:t,groupsDisplayState:V,groupFormat:e,groupBy:A,groupsResultStore:_,disabled:n,groupsFormatKey:Qn().V1,groupAggregationKey:Qn().FJ,format:I,schema:M,query:P,isInPeekRenderer:C,isFullScreen:a,isRootChild:c,paddingLeft:u,stickyLeft:v,renderGroupResults:g,renderHeader:S,onGroupHeaderAddItem:d,getGroupStyle:i,index:o,isLast:o===V.visibleGroups.length-1},(0,Qn().Ix)(e)))):void 0,E?(0,Ce.jsx)(Ts,{viewType:w,isFullScreen:a,galleryCoverSize:I.gallery_cover_size}):void 0,(0,Ce.jsxs)("div",{style:z.buttonWrapper,children:[O?(0,Ce.jsx)(Rs,{timelineType:b,collectionContextStore:t,format:I,isFullScreen:a,isRootChild:c,paddingLeft:u,stickyLeft:v}):void 0,D?(0,Ce.jsx)(_s,{timelineType:b,store:f,collectionContextStore:t,schema:M,format:I,isFullScreen:a,isRootChild:c,paddingLeft:u,groupsDisplayState:V,groupBy:A}):void 0]})]})),[t,n,I,i,A,V,_,l,a,C,c,d,u,p,P,g,S,M,D,K,O,E,v,f,z.buttonWrapper,z.container,b,w]);return I?R?(0,Ce.jsx)(Zr().A,{id:m,reducer:R,collectionContextStore:t,resultStore:_,render:H,debounceWait:L}):H():null}),tr().A);function Rs(e){const{collectionContextStore:t,timelineType:o,format:n,isFullScreen:r,isRootChild:i,paddingLeft:l,stickyLeft:a}=e,s=(0,y().IS)((()=>({container:{display:"flex"},loadMoreButton:a?{position:"sticky",insetInlineStart:l}:{}})),[l,a]);return"dropzone"===o?null:"item"===o?(0,Ce.jsx)(jl,{type:"default",collectionContextStore:t,groupsLimitStore:t.groupsLimitStore,format:n,isFullScreen:r,isRootChild:i,paddingLeft:l}):(0,Ce.jsx)("div",{style:s.container,children:(0,Ce.jsx)(Il,{type:"default",collectionContextStore:t,groupsLimitStore:t.groupsLimitStore,style:s.loadMoreButton})})}function _s(e){const{collectionContextStore:t,format:o,groupBy:n,groupsDisplayState:i,isFullScreen:l,isRootChild:a,paddingLeft:s,schema:c,store:d,timelineType:u}=e,p=(0,m().v3)(),g=(0,r.useCallback)((e=>{if(!n)return;const o=t.collectionStore();o&&ci({update:e,collectionContextStore:t,groupsFormatKey:Qn().V1,collectionStore:o,environment:p,groupBy:n,schema:c})}),[t,p,n,c]);return n?"dropzone"===u?null:"item"===u?(0,Ce.jsx)(Tl,{groupFormatKey:"collection_groups",collectionContextStore:t,parentStore:d,groupsLimitStore:t.groupsLimitStore,groupBy:n,currentGroups:i.currentGroups,schema:c,format:o,paddingLeft:s,isFullScreen:l,isRootChild:a,onAccept:g}):(0,Ce.jsx)(vi,{groupFormatKey:"collection_groups",collectionContextStore:t,parentStore:d,groupsLimitStore:t.groupsLimitStore,groupBy:n,currentGroups:i.currentGroups,schema:c,onAccept:g}):null}var Bs=()=>o(312296),Vs=()=>o(439264);function Es(e){return(0,W().rq)(e.board_cover_size)}function Fs(e){const{disableBoardColorColumns:t,isInHomeWidget:o,isMobile:n}=e;if(o)return 0;return(t?4:8)+(n?12:0)}function Os(e){const{displayState:t,format:o,permissionScopes:n}=e,{visibleGroups:r}=t,i=o.board_columns_by;return!!i&&(0!==r.length&&(n.canConfigureBlock&&!n.isSyncedCollection&&(0,Qn().pP)(i,n.canConfigureCollection)))}const Ds=r.memo((function({format:e,schema:t,collectionContextStore:o,store:n,currentGroups:r,disabled:i}){const l=(0,m().v3)(),a=(0,h().K8)((()=>o.contextType),[o]);return e.board_columns_by?"collectionTypedView"===a?null:(0,Ce.jsx)(vi,{groupFormatKey:"board_columns",groupBy:e.board_columns_by,schema:t,currentGroups:r,onAccept:n=>function(e){const{update:t,collectionContextStore:o,schema:n,format:r,environment:i}=e,l=o.collectionStore();if(!l)return;const a=r.board_columns_by;if(!a)return;ci({update:t,collectionContextStore:o,groupsFormatKey:"board_columns",collectionStore:l,schema:n,groupBy:a,environment:i})}({update:n,collectionContextStore:o,schema:t,format:e,environment:l}),groupsLimitStore:o.boardColumnsLimitStore,parentStore:n,collectionContextStore:o}):null}));const Ls=r.memo((function(e){const{render:t,collectionContextStore:o,groupsResultStore:n,groupsReducer:r}=e;return r?(0,Ce.jsx)(Zr().A,{id:Yn().rx,reducer:r,collectionContextStore:o,resultStore:n,render:t}):(0,Ce.jsx)(Ce.Fragment,{children:t()})}));var zs=()=>o(615927);const Ks=r.memo((function(e){const{collectionContextStore:t,isFullScreen:o,paddingLeft:n,paddingRight:i,paddingBottom:l}=e,a=(0,h().O$)(t.canConfigureBlockStore),s=t.settingsStore,c=(0,r.useCallback)((()=>{(0,D().O)({collectionContextStore:t,collectionSettingsStore:s}),F().a2({collectionSettingsStore:s,item:{type:"properties",timelineViewTab:"table"}})}),[t,s]);return(0,Ce.jsx)(zs().Ay,{title:(0,Ce.jsx)(he().sA,{defaultMessage:"No group by property",id:"database.boardView.missingSelectPropertyTitle"}),description:a?(0,Ce.jsx)(he().sA,{defaultMessage:"<opensettingslink>Add a property to group by</opensettingslink> to your database in order to display a Board view.",id:"database.boardView.missingSelectProperty",values:{opensettingslink:e=>(0,Ce.jsx)(zs().P6,{onClick:c,children:e})}}):(0,Ce.jsx)(he().sA,{defaultMessage:"Board views require a property to group by in order to display.",id:"database.boardView.missingSelectPropertyNoPermissions"}),style:{paddingInlineStart:n,paddingInlineEnd:i,paddingBottom:o?void 0:l}})}));function Hs(e){var t;const{transaction:o,environment:n,collectionContextStore:r,isFullScreen:i,groupsPointer:l,insertAtIndex:a,from:s,transient:c}=e,d=null===(t=r.groupsStore.getGroupState(l))||void 0===t?void 0:t.resultsStore;if(!d)return;r.searchQueryStore.state&&(0,Or().S)({searchQuery:"",collectionContextStore:r,isFullScreen:i});const u=(0,ur().Q)({environment:n,collectionContextStore:r,groupsPointer:l,insertAtIndex:a,shouldCoerce:!0,templateStore:r.defaultPageTemplateStore.state,transaction:o,from:{createBlock:s},inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache});if(!u)return;const p=u.coercionSucceeded,m=u.newStore;if(n.device.isMobile)Zn().uK({environment:n,store:m,pageVisitSource:$().y8.Create});else if(p){const e=m.getBlockTitleStore();R().hc({environment:n,store:m}),(0,Fl().z)({store:e}),(0,ma().C)({store:m,transient:c})}else{const e="collectionTypedView"===r.contextType;Jn().VU({environment:n,store:m,peekMode:(0,W().hH)(r),showMoveTo:e,resultsStore:d,collectionContextStore:r,pageVisitSource:$().y8.Create})}sr().vH(n,{from:s,type:"page",new_page_id:m.id,creating_block_id:m.id,...(0,Et().sl)(r)})}const Ws=r.memo((function(e){const{collectionContextStore:t,textColor:o,hoverColor:n,groupsPointer:i,isFullScreen:l,shouldShowSpinner:a}=e,c=(0,m().v3)(),d=(0,y().IS)((e=>{const t=o||e.text.tertiary,{fontSize:r}=ya({isMobile:Boolean(s().A.isMobile)});return{addItemButton:{width:"100%",color:t,borderRadius:kl,boxShadow:Ns({theme:e,color:o}),paddingInlineStart:ts().w_,paddingInlineEnd:ts().w_,minHeight:(0,W().rU)({isMobile:Boolean(s().A.isMobile)}),fontSize:r,gap:9},addItemButtonHover:{background:n},spinner:{marginTop:0,marginInlineEnd:0,marginBottom:0,marginInlineStart:"auto"}}}),[o,n]),u=(0,r.useCallback)((()=>{(0,ro().E)(c)?_().createAndCommit({userAction:"BoardGroupAddItemButton.handleClick",environment:c,canUndo:!0,perform:e=>{Hs({transaction:e,environment:c,collectionContextStore:t,isFullScreen:l,groupsPointer:i,from:"board_group_add_item_bottom",transient:!1})}}):(0,wa().Q)(c)}),[t,c,i,l]);return(0,Ce.jsxs)(_o().p,{iconLeading:{icon:gn().plusSmallIcon,size:Boolean(s().A.isMobile)?"default":"sm",style:{marginInlineStart:2}},colorPalette:"gray",colorVariant:"tertiary",size:"lg",style:d.addItemButton,hoveredStyle:d.addItemButtonHover,onClick:u,onMouseDown:Ai().t,children:[(0,Ce.jsx)(Ca().w,{collectionContextStore:t}),a?(0,Ce.jsx)("div",{style:d.spinner,children:(0,Ce.jsx)(qi().A,{size:"sm"})}):null]})}));function Ns(e){const{theme:t,color:o}=e,n=function(e,t){if(void 0===e)return"";try{return(0,La().X4)(e,t)}catch(o){return""}}(o,.1);return""!==n?`${n} 0px 0px 0px 1px`:"dark"===t.mode?`${_i().IF.whiteWithAlpha(.05)} 0px 0px 0px 1px`:`${t.regularDividerColor} 0px 0px 0px 1px`}const Gs=r.memo((function(e){const{color:t,collectionContextStore:o,groupFormat:n,isHovered:i}=e,l=(0,y().IS)((e=>{const o=t||e.text.tertiary,{fontSize:n}=ya({isMobile:Boolean(s().A.isMobile)});return{linkButton:{visibility:i?"visible":"hidden",marginTop:8,width:"100%",color:o,borderRadius:kl,paddingTop:12,paddingInlineEnd:16,paddingBottom:12,paddingInlineStart:16,fontSize:n}}}),[t,i]),a=(0,r.useCallback)((e=>(0,Ce.jsx)(_o().p,{iconLeading:{icon:le().arrowDiagonalUpRightIcon,size:Boolean(s().A.isMobile)?"default":"sm"},colorPalette:"gray",colorVariant:"tertiary",size:"lg",style:l.linkButton,...e,children:(0,Ce.jsx)(he().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})})),[l.linkButton]);return(0,Ce.jsx)(Dr().O,{collectionContextStore:o,groupFormat:n,renderLinkButton:a})})),$s=r.memo((function(e){const{blockPropertyValueOverlayStore:t,blockResizerStore:o,bulletedListFormatStore:n,collectionContextStore:r,colorStyle:i,coverAspectFormat:l,coverFormat:a,coverSizeFormat:s,disableCommentMenu:c,disabled:d,disableDrag:u,disableHoverMenu:p,handleOpenPeekPage:m,hideContent:g,isFirstItem:S,isLastItem:h,isQuickFind:y,numberedListCounterStore:v,onShiftEnter:f,onTextEnter:b,onTextEsc:x,store:C,style:w}=e;return(0,Ce.jsx)(ls,{blockPropertyValueOverlayStore:t,blockResizerStore:o,bulletedListFormatStore:n,collectionContextStore:r,colorStyle:i,coverAspectFormat:l,coverFormat:a,coverHeight:void 0,coverSizeFormat:s,coverWidth:void 0,disableCommentMenu:c,disabled:d,disableDrag:u,disableHoverMenu:p,handleOpenPeekPage:m,hideContent:g,isFirstItem:S,isLastItem:h,isQuickFind:y,numberedListCounterStore:v,onShiftEnter:f,onTextEnter:b,onTextEsc:x,store:C,style:w})}),tr().A);function Us(e){const t=e.minHeight||Ss,o=(0,y().IS)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:kl,backgroundColor:e.largeShimmerColor,minHeight:t,width:"100%",marginBottom:4}})),[t]);return(0,Ce.jsx)(wn().A,{style:o.card})}function qs(){return(0,cs().A)(!0,0,100)?(0,Ce.jsx)(Us,{}):null}const Xs=r.memo((function(e){const{groupsPointer:t,schema:o,format:n,collectionContextStore:i,store:l,disabled:a,blockPropertyValueOverlayStore:c,isFullScreen:u,anyGroupHasResults:p,hoveredGroupStore:g,paddingLeft:S,paddingRight:v,headerWidth:f}=e,b=(0,y().DP)(),x=(0,m().v3)(),{isMobile:C}=(0,m().Y0)(),w=(0,he().tz)(),k=(0,h().K8)((()=>{const e=t.at(-1);return(0,di().$e)({environment:x,groupFormat:e,schema:o,format:n,theme:b})}),[t,o,n,x,b]),A=(0,h().K8)((()=>{const e=i.groupsStore.getGroupState(t);return Boolean(null==e?void 0:e.reducerResultStore.state)}),[t,i]),T=(0,h().K8)((()=>i.groupsStore.getGroupState(t)),[i,t]),j=(0,h().K8)((()=>(0,W().mM)(i,u)),[i,u]),M=(0,h().K8)((()=>null==T?void 0:T.reducerResultStore.state),[T]),R=(0,h().K8)((()=>i.permissionScopesStore.state.isSyncedCollection),[i.permissionScopesStore]),B=(0,h().O$)(i.isInHomeWidgetStore),V=(0,h().K8)((()=>!a&&A&&i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!B})),[a,A,i,B]),E=(0,h().K8)((()=>(0,W().XQ)({reducerResult:M,collectionContextStore:i,isFullScreen:u})),[M,i,u]),F=(0,h().K8)((()=>(0,Jr().iv)({collectionContextStore:i,groupsPointer:t,hasPartialResults:p})),[i,t,p]),O=(0,h().K8)((()=>p&&i.shouldShowSpinnerStore.state&&"load_general"===i.loadingDetailsStore.state.type),[i,p]),D=(0,h().K8)((()=>(0,W().fG)({collectionContextStore:i,environment:x,intl:w})),[x,i,w]),L=(0,h().K8)((()=>s().A.isMobile||(0,Qn().Mn)(g.state,t.at(-1))),[g,t]),z=(0,r.useCallback)((e=>{const{target:t}=e;!C&&t instanceof HTMLElement&&(0,d().SQ)({event:e,context:d().y$.EditorMouseDown,callback:()=>{e.preventDefault(),P().jD({environment:x,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}),[x,C]),K=(0,r.useCallback)((()=>{const e=t.at(-1);e&&g.state!==e&&g.setState(e)}),[t,g]),H=(0,y().IS)((()=>{const e=Boolean(n.collection_group_by);return{container:{flex:"none",paddingInlineStart:8,paddingInlineEnd:8,paddingBottom:8,marginInlineEnd:12,marginBottom:16,boxSizing:"content-box",width:Zs(n),height:e?void 0:"max-content",...k&&A&&{backgroundColor:k.backgroundColor,...e?{borderRadius:kl}:{borderEndStartRadius:kl,borderEndEndRadius:kl}}},loadMoreButton:{borderRadius:kl,fontSize:s().A.isMobile?16:14,paddingTop:5,paddingInlineEnd:4,paddingBottom:5,paddingInlineStart:11,height:void 0},loadMoreButtonIcon:{width:s().A.isMobile?16:14,height:s().A.isMobile?16:14}}}),[k,n,A]),N=function(e){return e?e.board_cover:void 0}(n),G=(0,r.useMemo)((()=>({format:n,schema:o,onTextEnter:e=>function(e,t,o,n,r,i){if(!(0,ro().E)(i)||!o.collectionStore())return oc(e,o,r,t,i);const l=Js(t,o);if(!l)return;const a=l.state.findIndex((t=>t===e))+1;_().createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:i,canUndo:!0,perform:e=>{Hs({transaction:e,environment:i,collectionContextStore:o,isFullScreen:n,groupsPointer:t,insertAtIndex:a,from:"board_group_enter_add_item",transient:!0})}})}(e,t,i,u,l,x),onShiftEnter:e=>tc(e,t,i,u,x),coverFormat:N,coverAspectFormat:Ys(n),coverSizeFormat:Qs(n),colorStyle:k,onTextEsc:e=>oc(e,i,l,t,x),disabled:a,blockPropertyValueOverlayStore:c,collectionContextStore:i})),[c,i,k,N,a,x,n,t,u,o,l]);if(!T)return null;const $=!a&&!R,U=Boolean(n.collection_group_by),q=!p&&U&&F;return(0,Ce.jsxs)("div",{className:Vt().mVR,style:H.container,onMouseDown:z,onClick:ec,onMouseMove:K,children:[(0,Ce.jsx)(la,{collectionContextStore:i,groupsPointer:t,format:n,canDrag:$,paddingLeft:S,paddingRight:v,headerWidth:f,shouldShowShimmer:q,onSelectableEnter:e=>tc(e,t,i,u,x),itemProps:G,canDrop:!0,renderItem:$s,disabled:a,direction:ra.Vertical,shouldShowHoverMenu:!1,belowDropZoneMargin:2,emptyDroppableSize:U?8:3,analyticsName:"board",loadContentCover:N&&"page_content"===N.type}),q?(0,Ce.jsx)(qs,{}):null,E?(0,Ce.jsx)(Ol().jJ,{groupsPointer:t,store:l,collectionContextStore:i,format:n,isFullScreen:u,incrementLimitsInRelatedGroups:!0,style:H.loadMoreButton,iconStyle:H.loadMoreButtonIcon}):null,V?(0,Ce.jsxs)(Ce.Fragment,{children:[E?(0,Ce.jsx)("div",{style:{width:"100%",borderTop:`1px solid ${b.tableDividerColor}`,marginTop:4,marginBottom:4}}):void 0,(0,Ce.jsx)(Ws,{groupsPointer:t,collectionContextStore:i,isFullScreen:u,textColor:null==k?void 0:k.textColor,hoverColor:null==k?void 0:k.cardHoveredBackgroundColor,shouldShowSpinner:O})]}):void 0,D?(0,Ce.jsx)(Gs,{groupFormat:I().HV(t),collectionContextStore:i,color:null==k?void 0:k.textColor,isHovered:L}):void 0,j?void 0:(0,Ce.jsx)(Bl().A,{onChange:e=>function(e,t,o,n,r){const i=t.isLoadingStore.state,l=t.groupsStore.getGroupState(n),a=null==l?void 0:l.reducerResultStore.state;e<ko().B.incrementScrollOffset&&!i&&a&&a.hasMore&&((0,_l().H)({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:o,currentResultCount:a.blockIds.length,groupsPointer:n,incrementLimitsInRelatedGroups:!1}}),t.loadingDetailsStore.setState({type:"load_general"}))}(e,i,u,t,x)})]})}));function Ys(e){return e?e.board_cover_aspect:void 0}function Qs(e){return e?e.board_cover_size:void 0}function Zs(e){const t=e.board_cover_size;return(0,W().rq)(t)}function Js(e,t){const o=t.groupsStore.getGroupState(e);return null==o?void 0:o.resultsStore}function ec(e){(0,d().SQ)({event:e,context:d().y$.Click,callback:()=>{}})}function tc(e,t,o,n,r){const{blocks:i,transaction:l}=e;if(0===i.length)return;const a=i[0];if(!(0,ro().E)(r)||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const s=Js(t,o);if(!s)return;Hs({transaction:l,environment:r,collectionContextStore:o,isFullScreen:n,groupsPointer:t,insertAtIndex:s.state.findIndex((e=>e===a))+1,from:"board_group_enter_add_item",transient:!0})}function oc(e,t,o,n,r){const l=t.collectionStore(),a=e.getTitleStore();if(!a)return;if((0,k().q4_)(a.getValue()))R().Lt({environment:r,store:e});else if(l){const l=Js(n,t);if(!l)return;const a=l.state.findIndex((t=>t===e))-1,s=t.collectionViewStore(),c=t.collectionViewBlockStore();if(s&&c&&function(e,t){(0,i().DO_NOT_USE_trackLegacy)(e,"board_item_delete_newly_created",t)}(r,{...(0,Et().sl)(t),block_id:o.id}),_().createAndCommit({userAction:"BoardGroupResults.handleItemTextEsc",environment:r,canUndo:!0,perform:t=>{Lo().by({childStore:e,transaction:t})}}),a>=0){const e=l.state[a];R().Lt({environment:r,store:e})}}}function nc(e){const{height:t,boardCoverSize:o,showGroupHeader:n,areColumnsColored:r,disableBoardColorColumns:i,isInHomeWidget:l,numBoardColumns:a=3}=e,c=(0,y().IS)((e=>({container:{display:"flex",alignItems:"flex-start",paddingTop:Fs({disableBoardColorColumns:i,isMobile:Boolean(s().A.isMobile),isInHomeWidget:l})},groupHeader:{backgroundColor:e.largeShimmerColor,height:16,marginBottom:10,borderRadius:12,width:"50%",opacity:n?1:0},group:{marginTop:r?20:12,marginInlineEnd:10,width:"100%",minWidth:(0,W().rq)(o)+16}})),[r,o,i,l,n]);return(0,Ce.jsx)("div",{style:c.container,children:Array.from({length:a},((e,o)=>(0,Ce.jsxs)("div",{style:c.group,children:[(0,Ce.jsx)(wn().A,{style:c.groupHeader}),(0,Ce.jsx)(Us,{minHeight:t})]},o)))})}const rc=r.memo((function(e){const{selectedAggregation:t,parent:o,onChange:n,collectionContextStore:i,schema:l}=e,a=(0,m().v3)(),{isMobile:s}=(0,m().Y0)(),c=s?{menuType:Fe().gu.Modal,title:(0,Ce.jsx)(he().sA,{defaultMessage:"Aggregation",id:"database.mobileBoardAggregationMenu.title"}),right:(0,Ce.jsx)(Re().DoneMenuText,{}),onClickRight:o.close}:{menuType:Fe().gu.Popup,width:200},{sections:d,initialFocus:u}=(0,r.useMemo)((()=>{const{actions:e,initialFocus:o}=function(e,t,o,n,r){const{device:i}=t,l=[];let a=0,s=0;const c=function(e,t,o,n,r){const i={};for(const a of Ui().VD)i[a]=cc(e.aggregator===a,e.enforceMaxAggregationLimit??!1,a,o,n,t);const l=Object.keys(r).filter((e=>{const t=r[e];return t&&(0,Ui().wG)(t)&&!("rollup"===t.type&&"status"===t.target_property_type)}));if(l.length>0)for(const a of Ui().CG)"show_unique"!==a&&(i[a]=sc(e,a,l,t,r,o,n));return lc.forEach((({supportCheck:l,aggregationTypes:a})=>{const s=Object.keys(r).filter((e=>{const t=r[e];return t&&l(t)}));if(s.length>0)for(const c of a)i[c]=sc(e,c,s,t,r,o,n)})),i}(e,t,o,n,r);let d=0;return Object.entries(Ui().Kn).forEach((([t,n])=>{const r=[];for(const o of n)c[o]&&(r.push(c[o]),e.aggregator===o&&(a=d,s=r.length-1));const u=[];if("count_aggregations"===t&&u.push({key:"limitToggleSection",render:e=>(0,Ce.jsx)(Be().A,{...e}),items:[ac(e,o)]}),u.push({key:"aggregations",render:e=>(0,Ce.jsx)(Be().A,{topBorder:!0,...e}),items:r}),r.length>0){d++;const e=tl().jA[t],o={key:e,render:(t,o)=>(0,Ce.jsx)(Ji().A,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,Ce.jsx)(Ie().A,{...t,ref:o,title:e}),renderExtension:(t,n)=>{let r;return r=i.isMobile?{menuType:Fe().gu.Modal,title:e,right:(0,Ce.jsx)(Re().DoneMenuText,{}),onClickRight:n.close,...t}:{menuType:Fe().gu.Popup,width:250,...t},(0,Ce.jsx)(Me().A,{...r,children:(0,Ce.jsx)(Pe().Ay,{type:Pe().Oh.Vertical,initialFocus:s,sections:u,onAccept:(e,t,r)=>{"aggregationLimitToggle"!==e.key&&(n.close(),o.onAccept&&o.onAccept(e,t,r))}})})}}),action:()=>null};l.push(o)}})),{actions:l,initialFocus:a}}(t,a,n,i,l);return{sections:[{key:"aggregation section",render:e=>(0,Ce.jsx)(Be().A,{...e}),items:e}],initialFocus:o}}),[i,a,n,l,t]);return(0,Ce.jsx)(Me().A,{...c,children:(0,Ce.jsx)(Pe().Ay,{type:Pe().Oh.Vertical,initialFocus:u,sections:d,onAccept:o.close})})})),ic=r.memo((function(e){const{aggregationType:t,isSelected:o,label:n,innerProps:i}=e,l=tl().cx[t],a=(0,y().IS)((()=>({container:{width:140,whiteSpace:"normal"},image:{borderRadius:6,width:140,marginTop:4}})),[]),s=(0,r.useCallback)((e=>(0,Ce.jsx)(Ie().A,{title:n,isChecked:o,...(0,ol().A)(e,i)})),[o,i,n]),c=(0,r.useCallback)((()=>(0,Ce.jsxs)("div",{style:a.container,children:[l?(0,Ce.jsx)("img",{src:(0,el().L)(l),style:a.image}):void 0,tl().fp[t]]})),[l,a.container,a.image,t]);return(0,Ce.jsx)(qo().A,{placement:"right",delayThreshold:0,render:s,renderTooltip:c})}));const lc=[{supportCheck:Ui().OC,aggregationTypes:Ui().Sn},{supportCheck:Ui().fo,aggregationTypes:Ui().zE},{supportCheck:Ui().s_,aggregationTypes:$i().QO}];function ac(e,t){const{enforceMaxAggregationLimit:o,disabled:n}=(0,tl().NT)(e),r={...e,enforceMaxAggregationLimit:!o};return{key:"aggregationLimitToggle",render:e=>(0,Ce.jsx)(Qi().A,{on:o,disabled:n,menuListItemProps:e}),action:()=>{t(r)}}}function sc(e,t,o,n,r,i,l){const{device:a}=n,s=tl().zY[t],c=I().oE(o.map((o=>function(e,t,o,n,r,i,l,a){const s=r[t];if(!s)return;const c=s.name;return{key:`${t}${o}`,render:t=>(0,Ce.jsx)(ic,{isSelected:e,aggregationType:o,label:c,innerProps:t}),action:()=>{dc({aggregator:o,property:t,enforceMaxAggregationLimit:n},i,l,a)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,!(!e.enforceMaxAggregationLimit||!(0,Ui().AS)(t))&&e.enforceMaxAggregationLimit,r,i,l,n)))),d=c.findIndex((o=>o.key===`${e.property}${t}`));return{key:`${t}${s}`,render:(e,t)=>(0,Ce.jsx)(Ji().A,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,Ce.jsx)(Ie().A,{...e,ref:t,title:s}),renderExtension:(e,o)=>{let n;return n=a.isMobile?{menuType:Fe().gu.Modal,title:s,right:(0,Ce.jsx)(Re().DoneMenuText,{}),onClickRight:o.close,...e}:{menuType:Fe().gu.Popup,width:200,...e},(0,Ce.jsx)(Me().A,{...n,children:(0,Ce.jsx)(Pe().Ay,{type:Pe().Oh.Vertical,initialFocus:d,sections:[{key:"results",render:e=>(0,Ce.jsx)(Be().A,{...e}),items:c}],onAccept:(e,n,r)=>{o.close(),t.onAccept&&t.onAccept(e,n,r)}})})}}),action:()=>null}}function cc(e,t,o,n,r,i){const l=tl().zY[o];return{key:o,render:t=>(0,Ce.jsx)(ic,{isSelected:e,aggregationType:o,label:l,innerProps:t}),action:()=>{dc({aggregator:o,enforceMaxAggregationLimit:t},n,r,i)}}}function dc(e,t,o,n){o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),t(e),(0,T().X)({environment:n,collectionContextStore:o,action:"board_change_aggregation"})}const uc=r.memo((function(e){const{aggregation:t,schema:o,groupFormat:n,groupsResultStore:i,collectionContextStore:l,disabled:a,color:c,onChange:d}=e,u=s().A.isMobile,p=!(0,h().O$)(v().e),m=(0,y().IS)((e=>({button:{fontWeight:q().Wy.regular,color:c||e.text.tertiary,padding:"0 6px",minHeight:20,minWidth:20,borderRadius:4,height:void 0,lineHeight:void 0}})),[c]),g=(0,r.useCallback)((()=>(0,Ce.jsx)(pc,{aggregation:t,schema:o,collectionContextStore:l})),[t,l,o]),S=(0,r.useCallback)((e=>(0,Ce.jsx)(Ae().A,{popupType:u?Ae().z.BottomSheet:Ae().z.Popup,renderOrigin:r=>(0,Ce.jsx)(_o().p,{disabled:a,style:m.button,...(0,ol().A)(e,r),children:(0,Ce.jsx)(mc,{schema:o,aggregation:t,collectionContextStore:l,groupFormat:n,groupsResultStore:i})}),disabled:a,render:e=>(0,Ce.jsx)(rc,{parent:e,selectedAggregation:t,onChange:d,collectionContextStore:l,schema:o})})),[u,a,m.button,o,t,l,n,i,d]);return p?null:(0,Ce.jsx)(qo().A,{renderTooltip:g,render:S})}));function pc({aggregation:e,schema:t,collectionContextStore:o}){const n=(0,he().tz)(),r=(0,h().K8)((()=>!!Boolean(e)&&Xi(o,e)),[o,e]);if(e){const o=tl().zY[(0,Ui().V1)(e)];if((0,Ui().G9)(e)){const i=t[e.property];if(i){const e=i.name;return(0,Ce.jsx)(Ce.Fragment,{children:n.formatMessage(Zi.propertyAggregation,{aggregationType:o,propertyName:e,calculating:r})})}}return(0,Ce.jsx)(Ce.Fragment,{children:n.formatMessage(Zi.aggregationType,{aggregationType:o,calculating:r})})}return(0,Ce.jsx)(he().sA,{defaultMessage:"Aggregate",id:"database.boardAggregation.tooltip"})}function mc(e){const t=(0,h().K8)((()=>{var t;const o=e.groupsResultStore.state;if(!o)return;const n=(0,Qn().Ix)(e.groupFormat);return null===(t=o.aggregationResults)||void 0===t?void 0:t[n]}),[e.groupFormat,e.groupsResultStore]);let o,n;if((0,Ui().G9)(e.aggregation)){const t=e.schema[e.aggregation.property];!t||"formula"!==t.type&&"number"!==t.type||(o=t.number_format),t&&"date"===t.type&&(n=t.date_format)}return(0,Ce.jsx)(Yi,{aggregation:e.aggregation,collectionContextStore:e.collectionContextStore,children:t?(0,tl().rv)({numberFormat:o,dateFormat:n,aggregation:e.aggregation,userTimeZone:(0,Sr().P)(),value:t.aggregationResult,numberPrecision:void 0}):""})}const gc=r.memo((function(e){const{hoveredGroupStore:t,groupFormat:o,schema:n,format:i,groupsResultStore:l,collectionContextStore:a,disabled:c,hidden:d,isPopup:u,query:p,currentGroups:g,isFullScreen:S}=e,v=(0,m().v3)(),f=(0,he().tz)(),b=(0,y().DP)(),x=(0,Ee().Zp)(),C=(0,h().K8)((()=>!!s().A.isMobile||(0,Qn().Mn)(t.state,o)),[t,o]),w=(0,h().K8)((()=>(0,di().$e)({environment:v,groupFormat:o,schema:n,format:i,theme:b})),[o,n,i,v,b]),k=(0,h().O$)(a.canConfigureBlockStore),I=(0,r.useMemo)((()=>{if((0,Qn().D1)(o.value)&&(0,Qn().WO)(o.value.value))return new(ne().B)(v,o.value.value)}),[v,o.value]),A=(0,h().K8)((()=>Boolean((null==I?void 0:I.isReady())&&!(null!=I&&I.canRead()))),[I]),T=(0,h().K8)((()=>a.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})&&!A),[a,A]),j=(0,h().K8)((()=>(0,W().fG)({collectionContextStore:a,environment:v,intl:f})),[a,v,f]),M=(0,h().K8)((()=>{const e=a.collectionStore();return(!(null==e?void 0:e.inMemoryRecordCache.isTemporaryData)||null==x||!x.isPreviewing)&&(p.aggregations&&p.aggregations.length>0)}),[a,p,x]),P=(0,r.useCallback)((()=>{t.state!==o&&t.setState(o)}),[o,t]),R=(0,y().IS)((()=>{const e=Es(i),t=Boolean(i.collection_group_by);return{container:{display:"flex",alignItems:"center",fontSize:14,width:e,paddingInlineStart:8,paddingInlineEnd:8,marginInlineEnd:12,marginBottom:d?4:0,boxSizing:"content-box",flexShrink:0,...u&&{padding:s().A.isMobile?"6px 16px":"8px 12px 4px",width:"none",minWidth:e},...w&&!d&&{backgroundColor:w.backgroundColor,...t?{borderRadius:kl}:{borderStartStartRadius:kl,borderStartEndRadius:kl}}},spacer:{flexGrow:1}}}),[w,i,d,u]);return(0,Ce.jsxs)("div",{style:R.container,onMouseMove:P,children:[(0,Ce.jsx)(Sc,{boardGroupHeaderProps:e}),M?(0,Ce.jsx)(hc,{groupsResultStore:l,disabled:c,query:p,schema:n,collectionContextStore:a,groupFormat:o,hidden:d,boardSelectStyle:w}):null,(0,Ce.jsx)("div",{style:R.spacer}),!c&&k?(0,Ce.jsx)(yc,{hidden:d,groupFormat:o,currentGroups:g,format:i,schema:n,query:p,collectionContextStore:a,boardSelectStyle:w,isHovered:C}):null,T?(0,Ce.jsx)(vc,{format:i,groupFormat:o,collectionContextStore:a,isFullScreen:S,hidden:d,isHovered:C,boardSelectStyle:w}):null,j?(0,Ce.jsx)(fc,{groupFormat:o,collectionContextStore:a,hidden:d,isHovered:C,boardSelectStyle:w}):null]})}));function Sc(e){const{boardGroupHeaderProps:t}=e,{groupFormat:o,schema:n,disabled:i,currentGroups:l,format:a,groupBy:s,collectionContextStore:c}=t,d=(0,m().v3)(),u=(0,h().O$)(c.canConfigureBlockStore),p=(0,h().K8)((()=>c.groupsStore.getGroupState(o)),[c,o]),g=(0,r.useCallback)((e=>{const o=c.collectionStore();o&&(Mi({...e,environment:d,groupsFormatKey:"board_columns",collectionStore:o,...t}),(0,T().X)({environment:d,collectionContextStore:c,action:"rename_group"}))}),[t,c,d]),S=(0,y().IS)((()=>({container:{maxWidth:Es(a)-70}})),[a]);return p?(0,Ce.jsx)(ml().d,{collectionContextStore:c,groupBy:s,groupFormat:o,currentGroups:l,schema:n,disabled:i||!u,isHiddenGroup:!1,onChange:g,style:S.container,source:"board_group_header"}):null}function hc(e){const{disabled:t,query:o,schema:n,collectionContextStore:i,groupFormat:l,hidden:a,boardSelectStyle:s,groupsResultStore:c}=e,d=(0,m().v3)(),u=(0,h().O$)(i.canConfigureBlockStore),p=(0,r.useCallback)((e=>{const t=i.collectionViewStore();if(!t)return;const n=e?[e]:[],r={...o,aggregations:n};_().createAndCommit({userAction:"BoardGroupHeader.handleAggregationChange",environment:d,canUndo:!0,perform:e=>{(0,Bi().F)({collectionViewStore:t,update:{query2:r},transaction:e})}})}),[i,d,o]),g=(0,y().IS)((e=>({container:{color:bc({theme:e,hidden:a,boardSelectStyle:s})}})),[a,s]),S=o.aggregations?o.aggregations[0]:void 0;return S?(0,Ce.jsx)(uc,{groupFormat:l,groupsResultStore:c,disabled:t||!u,aggregation:S,schema:n,collectionContextStore:i,color:g.container.color,onChange:p}):null}function yc(e){const{hidden:t,groupFormat:o,currentGroups:n,format:i,schema:l,query:a,collectionContextStore:c,boardSelectStyle:d,isHovered:u}=e,p=(0,he().tz)(),m=(0,y().IS)((e=>{const o=bc({theme:e,hidden:t,boardSelectStyle:d});return{button:xc({hidden:t,isHovered:u}),icon:{width:Se().Ev.sm,height:Se().Ev.sm,fill:o}}}),[t,d,u]),g=(0,r.useCallback)((e=>(0,Ce.jsx)(Te().A,{style:m.button,icon:se().ellipsisSmallIcon,iconStyle:m.icon,ariaLabel:p.formatMessage({defaultMessage:"More group options",id:"database.boardGroupHeader.actions.moreGroupOptions.tooltip"}),...e})),[p,m.button,m.icon]),S=(0,r.useCallback)((e=>(0,Ce.jsx)(Hi,{parent:e,groupFormat:o,currentGroups:n,format:i,query:a,schema:l,collectionContextStore:c,groupsFormatKey:"board_columns"})),[c,i,o,n,l,a]);return(0,Ce.jsx)(Ae().A,{popupType:s().A.isMobile?Ae().z.BottomSheet:Ae().z.Popup,renderOrigin:g,render:S})}function vc(e){const{navigate:t}=(0,r.useContext)(Ia().E),{format:o,groupFormat:n,collectionContextStore:i,isFullScreen:l,hidden:a,isHovered:s,boardSelectStyle:c}=e,d=(0,m().v3)(),{isMobile:u}=(0,m().Y0)(),p=(0,he().tz)(),g=(0,r.useContext)(ba().n),S=(0,r.useCallback)((()=>{if(!(0,ro().E)(d))return;const e="collectionTypedView"===i.contextType,r=Boolean(o.collection_group_by);i.searchQueryStore.state&&(0,Or().S)({searchQuery:"",collectionContextStore:i,isFullScreen:l});const a=i.groupsStore.getGroupState(n);if(!a)return;const s=a.resultsStore;_().createAndCommit({userAction:"BoardGroupHeader.handleAddItemClick",environment:d,canUndo:!0,perform:o=>{const l=(0,ur().Q)({environment:d,collectionContextStore:i,groupsPointer:[n],insertAtIndex:0,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:o,from:{createBlock:"board_group_header"},inMemoryRecordCache:d.defaultRecordCache.inMemoryRecordCache});if(!l)return;const a=l.coercionSucceeded,c=l.newStore;if(u){const e=(0,Q().Ay)({store:c,pageVisitSource:$().y8.Create});g?g(e):t({environment:d,url:e})}else if(a&&!r){const e=c.getBlockTitleStore();R().hc({environment:d,store:c}),(0,Fl().z)({store:e}),(0,ma().C)({store:c})}else Jn().VU({environment:d,store:c,peekMode:(0,W().hH)(i),showMoveTo:e,resultsStore:s,collectionContextStore:i,pageVisitSource:$().y8.Create});sr().vH(d,{from:"board_group_add_item_top",type:"page",new_page_id:c.id,creating_block_id:c.id,...(0,Et().sl)(i)})}})}),[d,i,o.collection_group_by,n,l,u,g,t]),v=(0,h().K8)((()=>{var e;return null===(e=i.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[i]),f=(0,r.useMemo)((()=>{const e=(0,cr().$O)(v);return p.formatMessage({defaultMessage:"New {newItemName}",id:"database.boardView.actions.addNewItem.tooltip"},{newItemName:e})}),[v,p]),b=(0,y().IS)((e=>{const t=bc({theme:e,hidden:a,boardSelectStyle:c});return{button:xc({hidden:a,isHovered:s}),icon:{width:Se().Ev.sm,height:Se().Ev.sm,fill:t}}}),[c,a,s]),x=(0,r.useCallback)((()=>f),[f]),C=(0,r.useCallback)((e=>(0,Ce.jsx)(Te().A,{icon:gn().plusSmallIcon,onClick:S,style:b.button,iconStyle:b.icon,ariaLabel:f,...e})),[S,f,b.button,b.icon]);return(0,Ce.jsx)(qo().A,{renderTooltip:x,render:C})}function fc(e){const{groupFormat:t,collectionContextStore:o,hidden:n,isHovered:i,boardSelectStyle:l}=e,a=(0,he().tz)(),s=(0,h().K8)((()=>{var e;return null===(e=o.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[o]),c=(0,r.useMemo)((()=>{const e=(0,cr().$O)(s);return a.formatMessage({defaultMessage:"Link existing {newItemName}",id:"database.boardView.actions.linkExistingItem.tooltip"},{newItemName:e})}),[s,a]),d=(0,y().IS)((e=>{const t=bc({theme:e,hidden:n,boardSelectStyle:l});return{button:xc({hidden:n,isHovered:i}),icon:{width:Se().Ev.sm,height:Se().Ev.sm,fill:t}}}),[l,n,i]),u=(0,r.useCallback)((()=>c),[c]),p=(0,r.useCallback)(((e,t)=>(0,Ce.jsx)(Te().A,{icon:rr().arrowDiagonalUpRightSmallIcon,style:d.button,iconStyle:d.icon,...e,...t,ariaLabel:c})),[c,d.button,d.icon]);return(0,Ce.jsx)(Dr().O,{collectionContextStore:o,groupFormat:t,renderLinkButton:e=>(0,Ce.jsx)(qo().A,{renderTooltip:u,render:t=>p(t,e)})})}function bc(e){const{theme:t,hidden:o,boardSelectStyle:n}=e;return!o&&n?n.textColor:t.text.tertiary}function xc(e){const{hidden:t,isHovered:o}=e;return t?{}:{transition:"opacity 100ms ease-in-out",opacity:o?1:0}}const Cc=r.memo((function(e){const{collectionContextStore:t,columnsDisplayState:n,groupsResultStore:i,currentGroups:l,disableBoardColorColumns:a,disabled:c,format:d,headerPlaceholderHeight:u,hiddenGroups:p,hoveredGroupStore:g,isFullScreen:S,isInPeekRenderer:v,isRootChild:f,paddingLeft:b,paddingRight:x,query:C,schema:w,visibleGroups:k}=e,I=(0,m().v3)(),A=(0,m().Y0)(),T=Boolean(s().A.isMobile),j=(0,r.useRef)(null),M=(0,h().O$)(t.canConfigureBlockStore),P=(0,h().K8)((()=>(0,di().K3)({device:A,isFullScreen:S,isRootChild:f})),[A,S,f]),R=(0,h().O$)(t.isInHomeWidgetStore),_=(0,W().Oz)(t),B=(0,y().IS)((e=>{const t=R?"transparent":(null==_?void 0:_.background)||(v?e.background.elevated:e.background.primary),o=Fs({disableBoardColorColumns:a,isInHomeWidget:R,isMobile:T});return{header:{position:"absolute",background:t,height:40+o,paddingTop:o,zIndex:85,display:"flex",boxShadow:`calc(var(--direction, 1) * -3px) 0 0 ${t}`,minWidth:"100%"},stickyHeader:{paddingInlineStart:b,paddingInlineEnd:x},spacer:{height:"calc(100% + 17px)",...R?{}:{background:v?e.background.elevated:e.background.primary},width:20,marginInlineStart:-20,marginTop:-17}}}),[R,null==_?void 0:_.background,v,a,T,b,x]),V=(0,h().K8)((()=>{const e=t.normalizedFormatStore.state.board_columns_by;if(!e)return!1;const o=(0,Qn().Nf)(e);return M&&o.includes("manual")}),[t.normalizedFormatStore,M]),E=(0,r.useCallback)(((e,o)=>(0,Ce.jsx)(wc,{schema:w,collectionContextStore:t,format:d,query:C,disabled:c,isFullScreen:S,hoveredGroupStore:g,groupFormat:k[o],currentGroups:l,groupsResultStore:i})),[t,l,c,d,g,S,C,i,w,k]),F=(0,r.useCallback)((e=>{(0,o(864403).r)({environment:I,collectionContextStore:t,groupByKey:"board_columns_by",groupsFormatKey:"board_columns",newGroupIds:e,currentGroups:n.currentGroups,containsAllGroups:!1})}),[t,n.currentGroups,I]);if(0===k.length&&0===p.length&&0===n.pinnedGroups.groups.length)return null;const O=k.map((e=>(0,Qn().Ix)(e)));return d.board_columns_by?(0,Ce.jsx)(ki().g,{stickyAttachPoint:R?"no-stick":"ceiling",absoluteHeight:u,nodeRef:j,stickyStyle:B.stickyHeader,children:(0,Ce.jsxs)("div",{style:B.header,ref:j,children:[P?(0,Ce.jsx)("div",{style:B.spacer}):void 0,V?(0,Ce.jsx)(Vs().Ay,{direction:"horizontal",keys:O,renderKey:E,onDrop:F}):O.map(((e,o)=>(0,Ce.jsx)(wc,{schema:w,collectionContextStore:t,format:d,query:C,disabled:c,isFullScreen:S,hoveredGroupStore:g,groupFormat:k[o],currentGroups:l,groupsResultStore:i},(0,Qn().Ix)(k[o]))))]})}):null})),wc=r.memo((function({groupFormat:e,currentGroups:t,schema:o,collectionContextStore:n,format:r,query:i,disabled:l,isFullScreen:a,hoveredGroupStore:s,groupsResultStore:c}){return(0,h().K8)((()=>n.groupsStore.getGroupState([e])),[n,e])&&r.board_columns_by?(0,Ce.jsx)(gc,{currentGroups:t,groupFormat:e,query:i,schema:o,format:r,groupBy:r.board_columns_by,collectionContextStore:n,hoveredGroupStore:s,disabled:l,hidden:!1,isPopup:!1,isFullScreen:a,groupsResultStore:c}):null}));const kc=r.memo((function(e){const{collectionContextStore:t,columnsDisplayState:n,disabled:r}=e,i=n.pinnedGroups;return(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)(_o().p,{colorPalette:"gray",colorVariant:"tertiary",iconLeading:{icon:o(991941).M,size:"sm"},style:{width:"fit-content",gap:8},onClick:()=>{const e=t.settingsStore;F().R8({collectionSettingsStore:e,item:{type:"group",groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}})},children:(0,Ce.jsx)(he().sA,{...di().K0.pinnedGroups})}),(0,Ce.jsx)("div",{style:{marginInlineStart:24,marginTop:8},children:i.groups.map((e=>{const o=(0,Qn().Ix)(e),l=i.aggregations[o]??0;return(0,Ce.jsx)(Ic,{groupFormat:e,count:l,collectionContextStore:t,columnsDisplayState:n,disabled:r},(0,Qn().Ix)(e))}))})]})}));function Ic(e){const{groupFormat:t,collectionContextStore:n,columnsDisplayState:i,disabled:l}=e,a=(0,m().v3)(),s=(0,he().tz)(),c=r.useRef(null),d=(0,h().O$)(n.normalizedFormatStore),u=(0,h().O$)(n.normalizedSchemaStore),p=(0,h().O$)(n.temporaryStateStore),[g,S]=r.useState(!1),v=(0,h().K8)((()=>{const e=n.collectionViewBlockStore();return e?new(ne().B)(a,{table:et().ev,id:e.id}):null}),[a,n]),{value:f}=(0,ft().fJ)(yt().VI.duplicateActions),b=r.useCallback((async e=>{const{droppedStores:t,duplicate:o,groupFormat:r}=e,i=c.current;if(!i)return;if(!(i instanceof Element))return;const l=await Rt().T.formulas.load();_().createAndCommit({userAction:"BoardPinnedGroup.handleDrop",environment:a,canUndo:!0,perform:e=>Er({environment:a,collectionContextStore:n,groupsPointer:[r],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:l,duplicateActions:f})})}),[n,f,a]),x=r.useCallback((()=>{(0,zi().m)({environment:a,collectionContextStore:n,groupsFormatKey:"board_columns",groupFormat:t,currentGroups:i.currentGroups,action:"toggle_group_pin"})}),[a,n,t,i]),C=d.board_columns_by,w=r.useMemo((()=>{if(!C)return null;const e=Es(d);return(0,Ce.jsx)(ml().d,{collectionContextStore:n,currentGroups:i.currentGroups,groupBy:C,groupFormat:t,schema:u,disabled:!0,isHiddenGroup:!1,style:{fontSize:14,cursor:"inherit",maxWidth:e-24,overflow:"hidden",textOverflow:"ellipsis"},source:"collection_settings"})}),[n,i.currentGroups,d,C,t,u]),k=(0,y().IS)((e=>({container:{display:"flex",alignItems:"center",paddingTop:2,paddingBottom:2},pinIcon:{width:16,height:16,fill:e.text.tertiary}})),[]);if(!C)return null;if(!v)return null;const I={onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1)};return(0,Ce.jsx)("div",{ref:c,children:(0,Ce.jsxs)(jt().Ay,{location:"boardPinnedGroup",analyticsName:"board_pinned_group",store:v,canDropOnto:!l,shouldShowDropZone:!0,dropzoneMustBeWithinHorizontalBound:!0,dropzoneShouldNeverUseOrigin:!0,onSelectableDrop:async e=>{await b({...e,groupFormat:t})},style:k.container,children:[(0,Ce.jsxs)(_o().p,{onClick:()=>{(0,o(701311).d)({collectionContextStore:n,environment:a,groupFormat:t,groupBy:C,temporaryViewState:p,title:w})},hoveredStyle:{cursor:"pointer"},children:[w,(0,Ce.jsx)("span",{style:{opacity:.5,fontSize:14,marginInlineStart:8},children:(0,o(72135).ZV)(e.count,"number",s,"compact")})]}),l?null:(0,Ce.jsx)(qo().A,{renderTooltip:e=>(0,Ce.jsx)(he().sA,{...e,...di().K0.unpinGroup}),render:e=>(0,Ce.jsx)(Te().A,{...(0,ol().A)(e,I),ariaLabel:s.formatMessage(di().K0.unpinGroup),icon:g?o(230979).N:o(68207).S,iconStyle:k.pinIcon,onClick:x})})]})},(0,Qn().Ix)(t))}const Ac=r.memo((function(e){const{args:t,collectionContextStore:o,isInPeekRenderer:n,format:i,setSubgroupsMounted:l,visibleGroups:a}=e,s=(0,h().O$)(o.isInHomeWidgetStore),c=(0,r.useMemo)((()=>function(e){const{format:t,visibleGroups:o}=e;return o.length*(Es(t)+16+12)}({format:i,visibleGroups:a})),[i,a]),{stickyStyle:d}=(0,y().IS)((e=>s?{stickyStyle:{}}:{stickyStyle:{background:n?e.background.elevated:e.background.primary,boxShadow:`0 1px 0 ${n?e.background.elevated:e.background.primary}`}}),[s,n]);return(0,Ce.jsx)(Sl,{...t,height:s?Go().ag:36,stickyStyle:d,style:{...t.style,minWidth:c},onMount:l})})),Tc=f().Store.createClass(void 0,{name:"GroupsReducerResultStore"}),jc=f().Store.createClass(void 0,{name:"HoveredGroupStore"}),Mc=r.memo((function(e){const{store:t,format:n,schema:i,collectionContextStore:l,isFullScreen:a,isPreviewing:c,paddingLeft:u,paddingRight:p,paddingBottom:g,disabled:S,query:v,blockPropertyValueOverlayStore:f,isInPeekRenderer:b,isRootChild:x,headerWidth:C}=e,w=(0,m().v3)(),k=s().A.isMobile,I=(0,y().DP)(),A=(0,he().tz)(),T=(0,r.useRef)(null),j=(0,h().uB)(void 0,Tc),M=(0,h().O$)(j),R=(0,h().uB)(void 0,jc),[B,V]=(0,r.useState)(!1),E=(0,h().r6)((()=>{var e,t;const o=l.collectionViewStore();if(!o)return[void 0,void 0];return[null==o||null===(e=o.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_group_by").getValue(),null==o||null===(t=o.getFormatStore())||void 0===t?void 0:t.getKeyStore("board_columns_by").getValue()]}),[l],{useDeepEqual:!0}),{collectionStore:F,collectionViewStore:O}=(0,h().K8)((()=>({collectionStore:l.collectionStore(),collectionViewStore:l.collectionViewStore()})),[l]),D=(0,h().K8)((()=>"collectionTypedView"===l.contextType),[l]),L=(0,h().O$)(l.permissionScopesStore),z=(0,h().K8)((()=>!Boolean((0,di().$e)({environment:w,groupFormat:void 0,schema:i,format:n,theme:I}))),[w,n,i,I]),K=(0,ei().d)({groupBy:n.board_columns_by,reducerResult:M}),H=(0,ei().d)({subGroupBy:n.collection_group_by,reducerResult:M}),N=(0,h().K8)((()=>l.groupsStore.anyGroupHasResults()),[l]),G=(0,h().K8)((()=>{var e;const t=n.board_columns_by;if(!t)return;const o=n.collection_group_by?{groupBy:n.collection_group_by,groupsFormatKey:"collection_groups",limit:l.groupsLimitStore.state,subGroupAggregation:n.collection_group_aggregation}:void 0,r=ui({collectionContextStore:l,isMobile:Boolean(k),groupBy:t,subGroupBy:n.collection_group_by});return(0,Xn().p)({groupBy:t,schema:i,format:n,groupsFormatKey:"board_columns",limit:l.boardColumnsLimitStore.state,aggregation:null===(e=v.aggregations)||void 0===e?void 0:e.at(0),returnPinnedGroups:!0,subGroupArgs:o,blockResults:r})}),[l,n,k,v.aggregations,i],{useDeepEqual:!0}),U=(0,Ht().bx)(t,S),q=(0,r.useMemo)((()=>U),[U]),X=(0,r.useCallback)((()=>{F&&F.isDefined()&&O&&L.canConfigureBlock&&_().createAndCommit({userAction:"Board.updateOrCreateColumnsByProperty",environment:w,canUndo:!0,perform:e=>{const t=(0,o(586686).I)(i);if(!t)return;const n=i[t];n&&(0,Qn().Eg)(n)&&(ve().zA({stores:[O],update:{board_columns_by:(0,Qn().V0)({property:t,propertySchema:n,isCollectionTypedView:D})},transaction:e}),fe().zv({store:O,data:{type:"board"},transaction:e}))}})}),[F,O,w,D,L.canConfigureBlock,i]);(0,r.useEffect)((()=>{F&&!n.board_columns_by&&t.isDefined()&&F.isDefined()&&X()}),[l,F,w,n.board_columns_by,A,i,t,X]),(0,r.useEffect)((()=>{const e=()=>V(!1);return E.addListener(e),()=>E.removeListener(e)}),[E]);const Y=(0,r.useCallback)((()=>R.setState(void 0)),[R]),Q=(0,r.useCallback)((e=>{const o=K.visibleGroups;return(0,Ce.jsx)("div",{style:Vs().Z0,children:o.map(((r,s)=>{const c=s===o.length-1,d=e?[e,r]:[r],m=0!==K.hiddenGroups.length;return l.groupsStore.getGroupState(d)?(0,Ce.jsx)(Xs,{store:t,hoveredGroupStore:R,query:v,schema:i,format:n,groupsPointer:d,collectionContextStore:l,isFullScreen:a,disabled:S||!q,isLast:c&&!m,blockPropertyValueOverlayStore:f,anyGroupHasResults:N,paddingLeft:u,paddingRight:p,headerWidth:C},(0,Qn().Hm)(d)):null}))})}),[N,f,q,l,K.hiddenGroups.length,K.visibleGroups,S,n,C,R,a,u,p,v,i,t]),Z=(0,r.useCallback)((()=>{V(!0)}),[V]),J=(0,r.useCallback)((e=>(0,Ce.jsx)(Ac,{collectionContextStore:l,isInPeekRenderer:b,format:n,setSubgroupsMounted:Z,visibleGroups:K.currentGroups,args:e})),[l,K.currentGroups,n,b,Z]),ee=(0,r.useCallback)((e=>{k?Zn().uK({environment:w,store:e,pageVisitSource:$().y8.Create}):Jn().VU({environment:w,store:e,peekMode:W().hH(l),showMoveTo:D,resultsStore:void 0,collectionContextStore:l,pageVisitSource:$().y8.Create})}),[l,w,D,k]),te=N,oe=B,ne=(0,h().O$)(l.shouldShowSpinnerStore),re=ne&&!oe&&!te,ie=(0,h().O$)(l.isInHomeWidgetStore),le=(0,h().K8)((()=>Boolean(l.viewsModuleContextStore.getViewModuleType())),[l]),{visibleGroups:ae,hiddenGroups:se,currentGroups:ce}=K,de=n.collection_group_by,ue=a?480:ie?220:360,pe=Fs({disableBoardColorColumns:z,isInHomeWidget:ie,isMobile:Boolean(k)}),me=40+pe,ge=(0,Ee().Zp)(),Se=(0,r.useCallback)((e=>{const{target:t}=e;!k&&0===e.button&&t instanceof HTMLElement&&(0,d().SQ)({event:e,context:d().y$.EditorMouseDown,callback:()=>{e.preventDefault(),P().jD({environment:w,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}),[w,k]),ye=(0,r.useCallback)((()=>({})),[]),be=(0,y().IS)((()=>({container:{position:"relative",marginInlineStart:u,marginInlineEnd:p,float:"inline-start"},selectable:{display:"flex",position:"relative",flexGrow:1,paddingBottom:g},groupsWrapper:{display:"flex",flexDirection:"column",position:"relative",marginTop:me}})),[me,g,u,p]),xe=(0,r.useCallback)((()=>{const e=0===K.currentGroups.length&&0===K.pinnedGroups.groups.length,o=n.collection_group_by&&0===H.currentGroups.length;if(!re&&(e||o)){let t="board_columns_by";return!e&&n.collection_group_by&&0===H.visibleGroups.length&&(t="collection_group_by"),(0,Ce.jsx)($r,{collectionContextStore:l,groupByKeyToOpen:t,paddingLeft:u,paddingRight:p,headerWidth:C})}return(0,Vl().A)((e=>(0,Ce.jsx)("div",{className:Vt().okd,style:be.container,...e,ref:T,children:(0,Ce.jsx)(xi,{nodeRef:T,children:(0,Ce.jsxs)(jt().Ay,{location:"collectionBoard",style:be.selectable,store:t,shouldShowHalo:!a&&!ie&&!c,canSelect:!a&&!le,disablePointerEvents:null==ge?void 0:ge.disableContentPointerEvents,onMouseDown:Se,analyticsName:"board",onMouseLeave:Y,children:[re&&ie?null:(0,Ce.jsx)(Cc,{collectionContextStore:l,columnsDisplayState:K,currentGroups:ce,disableBoardColorColumns:z,disabled:S,groupsResultStore:j,format:n,headerPlaceholderHeight:me,hiddenGroups:se,hoveredGroupStore:R,isFullScreen:a,isInPeekRenderer:b,isRootChild:x,paddingLeft:u,paddingRight:p,query:v,schema:i,visibleGroups:ae}),re?(0,Ce.jsx)(nc,{height:ue,numBoardColumns:ae.length,boardCoverSize:n.board_cover_size,areColumnsColored:!z,showGroupHeader:0===ae.length,disableBoardColorColumns:z,isInHomeWidget:ie}):null,ae.length>0?(0,Ce.jsx)("div",{style:be.groupsWrapper,children:de?(0,Ce.jsx)(Ps,{reducerId:Yn().bq,store:t,groupsResultStore:j,collectionContextStore:l,disabled:S,isFullScreen:a,isRootChild:x,paddingLeft:u,paddingRight:p,stickyLeft:!k,renderGroupResults:Q,getGroupStyle:ye,renderHeader:J,onGroupHeaderAddItem:ee,headerWidth:C}):Q(void 0)}):null,(0,Ce.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:"fit-content",height:"fit-content",marginTop:pe+6},children:[(0,di().Zl)(K,l,!0)?(0,Ce.jsx)(Il,{type:"board",groupsLimitStore:l.boardColumnsLimitStore,collectionContextStore:l}):void 0,Os({displayState:K,format:n,permissionScopes:L})?(0,Ce.jsx)(Ds,{format:n,schema:i,collectionContextStore:l,store:t,currentGroups:ce,disabled:ne}):void 0,K.pinnedGroups.groups.length>0&&!re?(0,Ce.jsx)(kc,{collectionContextStore:l,columnsDisplayState:K,disabled:S}):void 0]})]})})})))}),[K,n,H.currentGroups.length,H.visibleGroups.length,re,l,u,p,C,be.container,be.selectable,be.groupsWrapper,t,a,ie,c,le,null==ge?void 0:ge.disableContentPointerEvents,Se,Y,ce,z,S,j,me,se,R,b,x,v,i,ae,ue,de,k,Q,ye,J,ee,pe,L,ne]);return n.board_columns_by?(0,Ce.jsx)(Ls,{collectionContextStore:l,groupsResultStore:j,groupsReducer:G,render:xe}):(0,Ce.jsx)(Ks,{collectionContextStore:l,isFullScreen:a,paddingLeft:u,paddingRight:p,paddingBottom:g})}));var Pc=()=>o(587682),Rc=()=>o(862e3),_c=()=>o(811481),Bc=()=>o(604995),Vc=()=>o(183558),Ec=()=>o(636740),Fc=()=>o(833880),Oc=()=>o(253021),Dc=()=>o(747671),Lc=()=>o(597777);function zc(e){const{blockPropertyValueOverlayStore:t,calendarBy:n,calendarViewRange:i,canEditCalendar:l,collectionContextStore:a,columnIndex:s,currentlyViewedMonth:c,endOfDay:d,format:u,items:p,query:m,sortedResultsStore:g,schema:S,shouldShowShimmer:h,startOfDay:v}=e,f=(0,Bc().vY)({firstDate:v,secondDate:c}),b=(0,Bc().c_)(v),x=!f&&!b&&"week"!==i,C=(0,y().IS)((e=>({button:{width:"100%",height:44,borderRadius:6},dayNumber:{height:28,color:x?e.text.tertiary:b?e.white:void 0,...b?{width:28,lineHeight:"28px",borderRadius:"100%",textAlign:"center",background:_i().Tj.red,marginInlineStart:"auto",marginInlineEnd:"auto"}:{display:"flex",alignItems:"center",justifyContent:"center"}},eventDot:{width:8,height:8,background:e.icon.secondary,borderRadius:"100%",marginTop:2,marginInlineStart:"auto",marginInlineEnd:"auto"}})),[b,x]),w=(0,r.useMemo)((()=>p.find((e=>(0,Lc().m6)(v,d,e.start,e.end?e.end:void 0)))),[p,v,d]),k=(0,Bc().wN)(v),I=(0,r.useCallback)((e=>(0,Ce.jsxs)(Ro().Ay,{style:C.button,...e,children:[(0,Ce.jsx)("div",{style:C.dayNumber,className:h?`notion-shimmer-calendar-transition notion-shimmer-text animation-delay-${s}`:"notion-shimmer-calendar-transition",children:k}),w?(0,Ce.jsx)("div",{style:C.eventDot}):void 0]})),[C,h,s,k,w]),A=(0,r.useCallback)((e=>(0,Ce.jsx)(o(824622).iq,{collectionContextStore:a,initialStartOfDay:v,format:u,schema:S,query:m,calendarBy:n,disabled:!l,onDismiss:e.close,blockPropertyValueOverlayStore:t,resultsStore:g})),[a,v,u,S,m,n,l,t,g]);return(0,Ce.jsx)(Ae().A,{popupType:Ae().z.SlideUp,renderOrigin:I,render:A},k.toString())}const Kc=(0,r.memo)(zc);function Hc(e){const{blockPropertyValueOverlayStore:t,calendarBy:o,calendarViewRange:n,canEditCalendar:i,collectionContextStore:l,currentlyViewedMonth:a,format:s,items:c,query:d,sortedResultsStore:u,schema:p,shouldShowShimmer:m,showWeekends:g,startOfWeek:S}=e,h=(0,y().IS)((e=>({container:{display:"flex",boxShadow:`0 -1px 0 ${e.tableDividerColor}`,paddingTop:8,paddingBottom:8,fontSize:14}})),[]),v=g?7:5,f=(0,r.useMemo)((()=>[...Array(v).keys()].map((e=>{const t=(0,Bc().K1)({date:S,daysToAdd:e});return{startOfDay:t,endOfDay:(0,Bc().P9)(t)}}))),[v,S]);return(0,Ce.jsx)("div",{style:h.container,children:f.map(((e,r)=>(0,Ce.jsx)(Kc,{blockPropertyValueOverlayStore:t,calendarBy:o,canEditCalendar:i,collectionContextStore:l,columnIndex:r,currentlyViewedMonth:a,endOfDay:e.endOfDay,format:s,items:c,query:d,sortedResultsStore:u,schema:p,shouldShowShimmer:m,startOfDay:e.startOfDay,calendarViewRange:n},e.startOfDay.toString())))},S.toString())}const Wc=(0,r.memo)(Hc);var Nc=()=>o(689094),Gc=()=>o(465364);const $c=30,Uc=(0,he().YK)({addItemLabel:{defaultMessage:"Add an item",id:"database.calendarView.addItemButtonTooltip"},linkExistingLabel:{defaultMessage:"Link an existing item",id:"database.calendarView.linkExistingButtonTooltip"},linkExistingCompleteToast:{defaultMessage:"{pageTitle} linked and {numUpdates, plural, one {{numUpdates} property} other {{numUpdates} properties}} updated",id:"database.calendarView.linkExistingToast"}});function qc(e){const{blockStore:t,calendarStore:n,collectionContextStore:i,columnIndex:l,startOfDay:a,canEditCalendar:s,isInHomeWidget:c,isInPeekRenderer:d,isTypedMsvCollection:u,currentlyViewedMonth:p,calendarBy:g,propertySchema:S,calendarViewRange:v,shouldShowShimmer:f}=e,b=(0,m().v3)(),x=(0,he().tz)(),C=(0,r.useContext)(ba().n),{navigate:w}=(0,r.useContext)(Ia().E),k=(0,h().O$)(Ut().AppStoreMainEditorCurrentBlockStore),I=(0,h().K8)((()=>i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[i]),{dayStoreMap:A,isDragging:T,hoveredDay:j}=(0,h().K8)((()=>({dayStoreMap:n.state.dayStoreMap,isDragging:n.state.isDragging,hoveredDay:n.state.isDragging?void 0:n.state.hoveredDay})),[n]),{pointer:P,userId:R,inMemoryRecordCache:B}=(0,h().K8)((()=>t),[t]),V=(0,r.useMemo)((()=>{const e=A.get(a);if(e)return e;const t=new(ne().B)(b,P,{userId:R,inMemoryRecordCache:B});return A.set(a,t),t}),[A,b,B,P,a,R]),E=(0,Bc().vY)({firstDate:a,secondDate:p}),F=(0,Bc().c_)(a),O=(0,Bc().sm)(a),D="date"===S.type,L=!E&&!F&&"week"!==v,z=!T&&j===a&&(D||F)&&I&&s,K=(0,r.useMemo)((()=>1!==(0,Bc().wN)(a)||F?(0,Bc().wN)(a):`${new Intl.DateTimeFormat(x.locale,{month:"short",day:"numeric"}).format(new Date(a))} `),[x.locale,F,a]),H=(0,r.useCallback)((()=>{const{performResult:e}=_().createAndCommit({userAction:"Calendar.createBlockInDay",environment:b,canUndo:!0,perform:e=>{const t=(0,ur().Q)({environment:b,collectionContextStore:i,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:e,from:{createBlock:"calendar"},inMemoryRecordCache:b.defaultRecordCache.inMemoryRecordCache});if(!t)return;const o=t.newStore.getAssociatedCollectionStore(),n=(null==o?void 0:o.getMappedProperty(g))??g;Gc().D5({type:"timestamp",environment:b,store:t.newStore,propertyId:n,timestampMs:a,transaction:e});const r=W().wy({environment:b,store:t.newStore,mainEditorCurrentBlockStore:k,collectionContextStore:i,showMoveTo:u})??(0,Q().Ay)({store:t.newStore,pageVisitSource:$().y8.Create});return C?C(r):w({environment:b,url:r}),M().Ey({collectionContextStore:i,resultsStore:void 0}),t.newStore}});return e}),[g,i,b,u,k,w,C,a]),N=(0,r.useCallback)(((e,t,n)=>{const r=t.getAssociatedCollectionStore(),i=(null==r?void 0:r.getMappedProperty(g))??g;if(Gc().D5({type:"timestamp",environment:b,store:t,propertyId:i,timestampMs:a,transaction:e}),n){var l;const e=Object.keys(n).length+(i in n?0:1),r=(null===(l=t.getModel())||void 0===l?void 0:l.getRenderTitleWithEmojiOrPlaceholder({getRecordModel:t.getRecordModel,userTimeZone:(0,Sr().P)(),intl:x}))||"",a=r.length>53?`${r.slice(0,50)}`:r;(0,o(223393).r)({item:{label:x.formatMessage(Uc.linkExistingCompleteToast,{pageTitle:a,numUpdates:e})},undoFunc:()=>{}})}}),[g,b,a,x]),{value:G}=(0,ft().fJ)(yt().VI.duplicateActions),U=(0,r.useCallback)((e=>{_().createAndCommit({userAction:"Calendar.renderDay",environment:b,canUndo:!0,perform:t=>{const o=i.collectionStore();if(!o&&"collectionTypedView"!==i.contextType)return;const n=Wt().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Wt().default.DO_NOT_USE_measureAfterNextFlushLegacy(n,{environment:b,getData:()=>Et().tv({collectionContextStore:i,is_native_drop:!1,is_empty:!1})}),Gc().M9({...e,environment:b,startOfDay:a,calendarBy:g,collectionStore:o,collectionContextStore:i,transaction:t,duplicateActions:G})}})}),[g,i,G,b,a]),q=(0,r.useCallback)((()=>{if(s&&(0,ro().E)(b)&&I){const e=H();sr().vH(b,{type:"page",from:"calendar_day_double_click",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,Et().sl)(i)})}}),[s,b,I,H,i]),X=(0,y().IS)((e=>{const t=(()=>{if(O)return c?(0,La().X4)(e.tableHomeDividerColor,.05):e.background.secondary})(),o=L?e.text.tertiary:F?e.white:void 0;return{selectable:{position:"relative",flexGrow:1,flexShrink:0,flexBasis:0,borderInlineEnd:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,cursor:"default",background:t},dayNumber:{position:"absolute",fontSize:14,top:4,height:24,lineHeight:"24px",color:o,...F?{insetInlineEnd:4,width:24,borderRadius:"100%",textAlign:"center",background:e.calendarTodayBackground}:{insetInlineEnd:10,textAlign:"end",transition:"color 100ms ease-out"}}}}),[c,d,F,O,L]),Y=(0,Ee().Zp)();return(0,Ce.jsxs)(jt().Ay,{location:"calendarDay",style:X.selectable,store:V,canDropOnto:s&&D,onSelectableDrop:U,onDoubleClick:q,analyticsName:"calendar_day",shouldShowDropZone:!0,children:[!z||null!=Y&&Y.disablePageLinks?void 0:(0,Ce.jsx)(Xc,{collectionContextStore:i,createBlockFunc:H,updateBlockDayProperty:N}),(0,Ce.jsx)("div",{style:X.dayNumber,...F?{"data-testid":"today-day-number"}:{},className:f?`${Vt().yWO} notion-shimmer-text animation-delay-${l} notion-shimmer-calendar-transition`:`${Vt().yWO} notion-shimmer-calendar-transition`,children:K})]},a.toString())}function Xc({collectionContextStore:e,createBlockFunc:t,updateBlockDayProperty:o}){const n=(0,m().v3)(),i=(0,he().tz)(),l=(0,h().K8)((()=>W().fG({collectionContextStore:e,environment:n,intl:i})),[e,n,i]),a=(0,r.useCallback)((()=>{if((0,ro().E)(n)){const o=t();sr().vH(n,{type:"page",from:"calendar_day_add_button",new_page_id:null==o?void 0:o.id,creating_block_id:null==o?void 0:o.id,...(0,Et().sl)(e)})}else(0,wa().Q)(n)}),[n,t,e]),s=(0,y().IS)((e=>({iconToolbar:{position:"absolute",display:"flex",top:6,insetInlineStart:6,padding:2,borderRadius:8,background:e.popoverBackground,boxShadow:e.shadowMD},iconButton:{width:20,height:20}})),[]),c=(0,r.useCallback)(((e,t)=>(0,Ce.jsx)(Te().A,{ariaLabel:i.formatMessage(Uc.addItemLabel),icon:Nc().W,style:s.iconButton,onClick:a,...(0,ol().A)(e,{onMouseDown:Ai().t})})),[a,i,s.iconButton]);return(0,Ce.jsxs)("div",{style:s.iconToolbar,children:[(0,Ce.jsx)(qo().A,{renderTooltip:()=>i.formatMessage(Uc.addItemLabel),render:c}),l?(0,Ce.jsx)(qo().A,{renderTooltip:()=>i.formatMessage(Uc.linkExistingLabel),render:t=>(0,Ce.jsx)(Dr().O,{collectionContextStore:e,renderLinkButton:e=>(0,Ce.jsx)(Te().A,{ariaLabel:i.formatMessage(Uc.linkExistingLabel),icon:le().arrowDiagonalUpRightIcon,style:s.iconButton,...e,...(0,ol().A)(t,{onMouseDown:Ai().t})}),onAddOrLink:o})}):null]})}const Yc=(0,r.memo)(qc);var Qc=()=>o(869190),Zc=()=>o(693954),Jc=()=>o(603820),ed=()=>o(338931),td=()=>o(771989);const od=2,nd=3;function rd(e,t){const{navigate:o}=(0,r.useContext)(Ia().E),{store:n,collectionContextStore:i,handleOpenPeekPage:l}=e,a=(0,m().v3)(),s=(0,r.useRef)(null),c=(0,r.useCallback)((()=>{const e=function(e){const{environment:t,store:o,collectionContextStore:n}=e,{mainEditorCurrentBlockStore:r}=Ut().default.state;return W().wy({environment:t,store:o,mainEditorCurrentBlockStore:r,collectionContextStore:n,fullyQualified:!1})}({environment:a,store:n,collectionContextStore:i});e&&(l(),o({environment:a,url:e}))}),[i,a,l,n,o]),d=(0,r.useMemo)((()=>({store:n,renderedType:"page",getNode:()=>s.current,getBlockStore:()=>n,activate:c})),[c,n]);(0,h().K8)((()=>{i.onItemMount(n)}),[i,n]);const u=(0,Ce.jsx)("div",{ref:s,children:(0,Ce.jsx)(ld,{...e})});return(0,Ht().NW)(n,t,d,u)}const id=r.forwardRef(rd);function ld(e){const{store:t,row:o,schema:n,format:r,disabled:i,calendarBy:l,showWeekends:a,collectionContextStore:s,includeTime:c,handleOpenPeekPage:d,blockPropertyValueOverlayStore:u,calendarStore:p}=e,g=(0,m().v3)(),{value:S}=(0,ft().fJ)(Rt().T.formulas),y=n[l],v=(0,h().K8)((()=>!i&&"date"===(null==y?void 0:y.type)&&!s.permissionScopesStore.state.isSyncedCollection),[s.permissionScopesStore,i,null==y?void 0:y.type]),{start:f,end:b,startOfWeek:x,endOfWeek:C,startColumn:w,columnCount:k}=(0,ed().Gj)({startUnixTimestampMS:e.start,endUnixTimestampMS:e.end,startOfWeekUnixTimestampMS:e.startOfWeek,endOfWeekUnixTimestampMS:e.endOfWeek}),A=(0,h().K8)((()=>{const e=r.calendar_properties?r.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[],o=e.filter((e=>(0,ga().T)({block:t.getModel(),property:e,schema:n,getRecordModel:t.getRecordModel,userId:g.currentUser.id,userTimeZone:(0,Sr().P)(),intl:xr().A.getIntl(),experimentService:er().default,collectionFeatureGates:(0,br().i)(),formulasModule:S,spaceIdCreator:g.idCreator.getSpaceIdCreatorSync(t.getSpaceId()??"")})));return o.concat(I().R9(e,o))}),[g.currentUser.id,r.calendar_properties,n,t,S,g.idCreator]),T=(0,h().K8)((()=>(0,vt().jz)({collectionContextStore:s})),[s]);if(!y||!(0,Rc().$)(y))return null;const j=A.length+(T?1:0),M=f<x,P=void 0!==b&&b>C;return(0,Ce.jsxs)(ad,{store:t,row:o,numRows:j,columnCount:k,startIsBeforeStartOfWeek:M,endIsAfterEndOfWeek:P,startColumn:w,disabled:i,isEditableDate:v,calendarBy:l,showWeekends:a,handleOpenPeekPage:d,children:[T?(0,Ce.jsx)("span",{style:{paddingInlineEnd:4,paddingInlineStart:8,maxWidth:"100%",overflowX:"hidden",textOverflow:"ellipsis"},children:(0,Ce.jsx)(ja().n,{blockStore:t,collectionContextStore:s})}):void 0,(0,Ce.jsx)(ud,{store:t,collectionContextStore:s,disabled:i,start:f,startOfWeek:x,end:b,endOfWeek:C,includeTime:c,propertySchema:y}),(0,Ce.jsx)(md,{store:t,sortedProperties:A,startIsBeforeStartOfWeek:M,disabled:i,blockPropertyValueOverlayStore:u}),v?(0,Ce.jsx)(gd,{store:t,start:f,startOfWeek:x,end:b,endOfWeek:C,calendarBy:l,calendarStore:p}):void 0]})}function ad(e){var t;const{store:o,children:n,columnCount:i,row:l,numRows:a,startColumn:s,disabled:c,isEditableDate:d,calendarBy:u,showWeekends:p,handleOpenPeekPage:g,startIsBeforeStartOfWeek:S,endIsAfterEndOfWeek:v}=e,f=(0,m().v3)(),b=(0,gt().ET)(),x=(0,Ee().Zp)(),C=(0,h().K8)((()=>W().NM(o)),[o]),w=(0,h().K8)((()=>(0,Gl().Wi)(f,o.id)),[f,o.id]),k=dd(a,(0,h().K8)((()=>{var e;return null===(e=b.collectionViewStore())||void 0===e?void 0:e.getFormat()}),[b])),I=$c+k*l,A=(0,h().uB)(void 0,td().A),T=(0,h().K8)((()=>Qt().A.state?!0===A.state.dragging:$l().A.state.hoveredStore===o),[o,A]),j=p?7:5,M=null===(t=(0,Wa().y)(o))||void 0===t?void 0:t.background,P=(0,y().IS)((e=>({selectable:{position:"absolute",paddingTop:3,paddingBottom:3,paddingInlineStart:S?0:6,paddingInlineEnd:v?0:6,width:v?`calc(100% / ${j} * ${i} - 1px)`:`calc(100% / ${j} * ${i})`,insetInlineStart:`calc(100% / ${j} * ${s})`,height:k,top:I},haloStyle:{...W().wh(e,C),borderRadius:6,marginTop:2,marginBottom:2,marginInlineStart:S?0:5,marginInlineEnd:v?0:5},linkBoxStyle:{height:"100%",background:M??e.calendarItemBackground,borderStartStartRadius:6,borderStartEndRadius:6,borderEndStartRadius:6,borderEndEndRadius:6,boxShadow:e.shadowXS,...v&&{borderStartEndRadius:0,borderEndEndRadius:0},...S&&{borderStartStartRadius:0,borderEndStartRadius:0},...w&&{opacity:.5}},linkBoxHoveredStyle:{opacity:w?.5:1,background:M?(0,La().e$)(M,.2):e.calendarItemHoveredBackground},linkBoxInnerStyle:{display:"flex",position:"relative",paddingTop:2,paddingBottom:2,height:"100%",alignItems:"flex-start",flexDirection:"column"}})),[i,v,k,j,C,s,S,I,w,M]),R=(0,r.useCallback)((e=>{const t=o.getAssociatedCollectionStore();return t?Gc().jo({environment:f,collectionStore:t,collectionContextStore:b,store:o,insertStores:e.insertStores,calendarBy:u,transaction:e.transaction}):[]}),[u,b,f,o]),_=(0,r.useCallback)((e=>{const{transaction:t}=e;o.getAssociatedCollectionStore()&&Lo().by({childStore:o,transaction:t})}),[o]),[B,V]=(0,h().K8)((()=>{const{mainEditorCurrentBlockStore:e}=Ut().default.state,t=W().wy({environment:f,store:o,mainEditorCurrentBlockStore:e,collectionContextStore:b,fullyQualified:!1});return[(0,Q().Ay)({store:o,fullyQualified:!1,pageVisitSource:$().y8.LinkInPage}),t]}),[f,b,o]),E=(0,h().O$)(b.isInHomeWidgetStore);return(0,Ce.jsx)(jt().Ay,{location:"calendarItem",store:o,style:P.selectable,canSelect:!c,shouldShowHalo:!(E||null!=x&&x.isPreviewing),shouldForceRenderSelectionHalo:C,haloStyle:P.haloStyle,canTriggerContextMenu:!c,showBlockMenuInput:!0,canDrag:d,onInsertAbove:R,onInsertBelow:R,onRemove:_,canInsertAbove:d,canInsertBelow:d,analyticsName:"calendar",shouldShowDropZone:!0,className:Vt().E4t,draggableStore:A,children:(0,Ce.jsx)(je().A,{style:P.linkBoxStyle,hoveredStyle:P.linkBoxHoveredStyle,pressedStyle:P.linkBoxHoveredStyle,innerStyle:P.linkBoxInnerStyle,onClick:g,href:B,metaHref:V,hovered:T,disableForOffline:w,children:n})},o.id)}const sd=24,cd=36;function dd(e,t){var o;return((null==t?void 0:t.table_wrap)||!0===(null==t||null===(o=t.calendar_properties)||void 0===o||null===(o=o.find((e=>"title"===e.property)))||void 0===o?void 0:o.wrap)?cd:sd)+e*mi().CL+2*od+2*nd}function ud(e){const{store:t,collectionContextStore:o,disabled:i,start:l,startOfWeek:a,end:s,endOfWeek:c,includeTime:d,propertySchema:u}=e,p=(0,m().v3)(),g=l<a,S=s&&s>c,v=(0,h().K8)((()=>(0,vt().Kk)({collectionContextStore:o,blockStore:t})),[o,t]),f="time_format"in u?u.time_format:Lc().CE,[b,x,C]=(0,h().K8)((()=>[t.getIcon(),t.isEmptyPage(),t.hasError()]),[t]),w=(0,r.useCallback)((e=>{const o=t.getIconStore();o&&_().createAndCommit({userAction:"CalendarItem.handleRecordIconChange",environment:p,canUndo:!0,perform:t=>{fe().KY({store:o,value:e,transaction:t})}})}),[p,t]),k=(0,h().K8)((()=>{var e,t,n;const r=null===(e=o.collectionViewStore())||void 0===e?void 0:e.getFormat().calendar_properties;return(null===(t=o.collectionViewStore())||void 0===t?void 0:t.getFormat().table_wrap)||!0===(null==r||null===(n=r.find((e=>"title"===e.property)))||void 0===n?void 0:n.wrap)}),[o]),I=(0,y().IS)((e=>({titleContainer:{paddingInlineStart:6,paddingInlineEnd:6,overflow:"hidden",...g&&{paddingInlineStart:12},...S&&{paddingInlineEnd:11},width:"100%",...k?{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"17px",height:cd,paddingTop:2}:{height:sd,whiteSpace:"nowrap"},overflowWrap:"break-word",textOverflow:"ellipsis",fontSize:14,fontWeight:q().Wy.semibold},recordIconStyle:{display:"inline",float:"inline-start",marginInlineEnd:3,paddingTop:k?2:4},iconWarningStyle:{display:"inline",float:"inline-start",marginInlineStart:1,marginInlineEnd:5,width:10,height:16,paddingTop:k?2:4,fill:e.palette.orange[500]},subitemCountIndicatorContainer:{display:"flex",alignItems:"center",float:"inline-end",paddingTop:k?2:4},timeStyle:{color:e.text.secondary,float:"inline-end",fontSize:10,marginInlineStart:4,height:14,paddingTop:k?2:4},subitemsWrapperStyle:{paddingInlineEnd:0,paddingInlineStart:4}})),[S,g,k]),A=d&&s&&n().IX.fromDateTimes(a,c).contains(s)&&l.day!==s.day,T=(0,h().K8)((()=>o.shouldShowPageIcon()&&(void 0!==b||!x)&&!C),[o,b,x,C]),j=(0,h().K8)((()=>(0,X().Te)(t)),[t]);return(0,Ce.jsxs)("div",{style:I.titleContainer,children:[T?i?(0,Ce.jsx)(X().B6,{disabled:!0,icon:b,iconRecordCategory:j,isEmptyPage:x,size:14,style:I.recordIconStyle}):(0,Ce.jsx)(X().B6,{disabled:!1,store:t,bucket:"secure",icon:b,iconRecordCategory:j,isEmptyPage:x,size:14,style:I.recordIconStyle,onChange:w}):void 0,C?(0,Zc().Q)(I.iconWarningStyle):void 0,(0,Ce.jsx)(pd,{store:t,titlePropertyIsWrapped:k}),v?(0,Ce.jsx)("div",{style:I.subitemCountIndicatorContainer,children:(0,Ce.jsx)(Ma().W,{blockStore:t,collectionContextStore:o,wrapperStyle:I.subitemsWrapperStyle})}):void 0,d&&n().IX.fromDateTimes(a,c).contains(l)?(0,Ce.jsxs)("div",{style:I.timeStyle,children:[(0,Qc().PS)({dateTime:l,humanReadable:!1,timeFormat:f}),A?(0,Ce.jsxs)("span",{children:["  ",(0,Qc().PS)({dateTime:s,humanReadable:!1,timeFormat:f})]}):void 0]}):void 0,(0,Ce.jsx)(Y().A,{store:t,shouldWrap:k})]})}function pd(e){const{store:t,titlePropertyIsWrapped:o}=e,n=(0,y().IS)((e=>({discussionIndicatorStyle:{display:"flex",alignItems:"center",color:e.text.tertiary,fontSize:12,flexShrink:0},discussionIndicatorContainerStyle:{float:"inline-end",marginInlineStart:4,marginTop:o?-2:1}})),[o]);return(0,Ce.jsx)(Ta().g,{store:t,iconStyle:n.discussionIndicatorStyle,buttonStyle:n.discussionIndicatorContainerStyle,size:12})}function md(e){const{store:t,sortedProperties:o,startIsBeforeStartOfWeek:n,disabled:r,blockPropertyValueOverlayStore:i}=e,l=(0,gt().ET)(),a=(0,h().K8)((()=>l.permissionScopesStore.state.isLocked||!l.permissionScopesStore.state.canEditContent),[l.permissionScopesStore]),[s,c]=(0,h().K8)((()=>[W().Dj({store:t,collectionContextStore:l}),l.collectionViewStore()]),[t,l]);return s?(0,Ce.jsx)("div",{style:{paddingInlineStart:6,paddingInlineEnd:6,overflow:"hidden",width:"100%",...n&&{paddingLeft:12}},children:o.map((e=>(0,Ce.jsx)(Ya().BlockPropertyRouter,{store:t,property:e,disabled:r,locked:a,surface:"calendar",tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:s,collectionViewStore:c},e)))}):null}function gd(e){const{store:t,calendarStore:o,start:n,startOfWeek:i,end:l,endOfWeek:a,calendarBy:s}=e,c=(0,m().v3)(),d=(0,y().IS)((()=>({leftDragHandle:{position:"absolute",top:0,insetInlineStart:-4,height:"100%",width:12,cursor:"col-resize"},rightDragHandle:{position:"absolute",top:0,insetInlineEnd:-4,height:"100%",width:12,cursor:"col-resize"}})),[]),u=(0,r.useCallback)((e=>{Gc().GB({calendarStore:o,x:e.currentX,y:e.currentY,calendarBy:s})}),[o,s]),p=(0,r.useCallback)((()=>{_().createAndCommit({userAction:"CalendarItem.handleDraggableDragEnd",environment:c,canUndo:!0,perform:e=>{Gc().eW({environment:c,transaction:e,calendarStore:o,calendarBy:s})}})}),[s,o,c]),g=(0,r.useCallback)((()=>{Gc().Pt({calendarStore:o})}),[o]),S=n>=i&&(0,Ce.jsx)(Jc().A,{render:e=>(0,Ce.jsx)("div",{className:Vt().rvW,style:d.leftDragHandle,...e}),onDraggableDragStart:()=>{Gc().v7({calendarStore:o,targetStore:t,direction:Dc().Q.Left})},onDraggableDragMove:u,onDraggableDragEnd:p,onDraggableDragCancel:g}),h=(!l||l&&l<a)&&(0,Ce.jsx)(Jc().A,{render:e=>(0,Ce.jsx)("div",{className:Vt().mvP,style:d.rightDragHandle,...e}),onDraggableDragStart:e=>{Gc().v7({calendarStore:o,targetStore:t,direction:Dc().Q.Right})},onDraggableDragMove:u,onDraggableDragEnd:p,onDraggableDragCancel:g});return(0,Ce.jsxs)(Ce.Fragment,{children:[S,h]})}function Sd(e){const{blockPropertyValueOverlayStore:t,blockStore:o,calendarBy:n,calendarStore:i,calendarViewRange:l,canEditCalendar:a,collectionContextStore:s,collectionViewStore:c,currentlyViewedMonth:d,endOfWeek:u,format:p,isInHomeWidget:g,isInPeekRenderer:S,isTypedMsvCollection:v,items:f,propertySchema:b,schema:x,shouldShowShimmer:C,showWeekends:w,sortedResultsStore:k,startOfWeek:I}=e,A=(0,m().v3)(),{isDragging:T,targetStore:j,temporaryValue:P}=(0,h().K8)((()=>{const{isDragging:e}=i.state;return{isDragging:e,targetStore:e?i.state.targetStore:void 0,temporaryValue:e?i.state.temporaryValue:void 0}}),[i]),{targetStoreCollectionStoreSchema:R,targetStoreCollectionStoreCalendarBy:_}=(0,h().K8)((()=>{const e=null==j?void 0:j.getAssociatedCollectionStore();return{targetStoreCollectionStoreSchema:null==e?void 0:e.getSchema(),targetStoreCollectionStoreCalendarBy:null==e?void 0:e.getMappedProperty(n)}}),[j,n]),B=(0,r.useCallback)((()=>{Wt().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag"),M().Ey({collectionContextStore:s,resultsStore:k});const e=s.normalizedFormatStore.state.collection_peek_mode,t=e||ql().C9.calendar;Ul().bn(A,{is_peek:!0,from:"calendar",peek_mode:t})}),[s,A,k]),V=w?7:5,E=(0,r.useMemo)((()=>{const e=[];f.forEach((o=>{const r=ne().B.createChildStore(c,{table:et().ev,id:o.id});T&&j===r&&P||e.push((0,Ce.jsx)(hd,{blockPropertyValueOverlayStore:t,calendarBy:n,calendarStore:i,collectionContextStore:s,endOfWeek:u,format:p,handleOpenPeekPage:B,item:o,schema:x,showWeekends:w,startOfWeek:I,store:r},o.id))}));const o=T&&P&&(0,Bc().uo)(P,(0,Sr().P)());if(T&&P&&o&&(0,Lc().m6)(I,u,o.start,o.end)&&j&&null!=j&&j.id){const r=f.find((e=>e.id===j.id));e.push((0,Ce.jsx)(hd,{blockPropertyValueOverlayStore:t,calendarBy:_??n,calendarStore:i,collectionContextStore:s,endOfWeek:u,format:p,handleOpenPeekPage:B,schema:R??x,showWeekends:w,startOfWeek:I,store:j,item:{id:j.id,start:o.start,end:o.end,row:r?r.row:0,includeTime:"datetime"===P.type||"datetimerange"===P.type}},j.id))}return e}),[t,n,i,s,c,u,p,B,T,f,x,w,I,j,_,R,P]),F=(0,r.useMemo)((()=>Math.max(0,...f.map((e=>e.row)))),[f]),O=(0,h().K8)((()=>(0,vt().jz)({collectionContextStore:s})),[s]),D=(0,y().IS)((()=>{const e=(p.calendar_properties?p.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[]).length+(O?1:0),t="week"===l?372:124,o=dd(e,p);return{container:{position:"relative",display:"flex",height:Math.max((F+1)*o+$c+4,t)}}}),[l,p,F,O]);return(0,Ce.jsxs)("div",{style:D.container,children:[[...Array(V).keys()].map((e=>{const t=(0,Bc().K1)({date:I,daysToAdd:e});return(0,Ce.jsx)(Yc,{blockStore:o,calendarStore:i,collectionContextStore:s,columnIndex:e,startOfDay:t,calendarBy:n,currentlyViewedMonth:d,canEditCalendar:a,isInHomeWidget:g,isInPeekRenderer:S,isTypedMsvCollection:v,propertySchema:b,calendarViewRange:l,shouldShowShimmer:C},e)})),E]},I.toString())}function hd(e){const{blockPropertyValueOverlayStore:t,calendarBy:o,calendarStore:n,collectionContextStore:r,endOfWeek:i,format:l,handleOpenPeekPage:a,item:s,schema:c,showWeekends:d,startOfWeek:u,store:p}=e,{canEdit:m,collectionStore:g}=(0,h().K8)((()=>({canEdit:p.canEdit(),collectionStore:p.getAssociatedCollectionStore()})),[p]),{collectionStoreSchema:S,collectionStoreCalendarBy:y}=(0,h().K8)((()=>({collectionStoreSchema:null==g?void 0:g.getSchema(),collectionStoreCalendarBy:null==g?void 0:g.getMappedProperty(o)})),[g,o]);return g?(0,Ce.jsx)(id,{collectionContextStore:r,store:p,startOfWeek:u,endOfWeek:i,showWeekends:d,start:s.start,end:s.end,row:s.row,includeTime:s.includeTime,format:l,schema:S??c,calendarBy:y??o,disabled:!m,calendarStore:n,blockPropertyValueOverlayStore:t,handleOpenPeekPage:a},p.id):null}const yd=(0,r.memo)(Sd);function vd(e){const{blockPropertyValueOverlayStore:t,blockStore:o,calendarStore:n,canEditCalendar:r,collectionContextStore:i,currentlyViewedMonth:l,format:a,isInHomeWidget:s,isInPeekRenderer:c,isTypedMsvCollection:d,query:u,resultStore:p,schema:g,sortedResultsStore:S,weeks:v}=e,{isPhone:f}=(0,m().Y0)(),b=(0,h().K8)((()=>{var e,t;return(void 0===(null===(e=p.getState())||void 0===e?void 0:e.blockIds)||0===(null===(t=p.getState())||void 0===t?void 0:t.blockIds.length))&&(0,Jr().iv)({collectionContextStore:i,groupsPointer:[],hasPartialResults:!1})}),[i,p]),{collectionViewStore:x,calendarViewRange:C,showWeekends:w}=(0,h().K8)((()=>{const e=i.collectionViewStore(),t=null==e?void 0:e.getFormatStore();return{collectionViewStore:e,calendarViewRange:(null==t?void 0:t.getKeyStore("calendar_view_range").getValue())??"month",showWeekends:(null==t?void 0:t.getKeyStore("calendar_show_weekends").getValue())??!0}}),[i]);var k;v&&v.length>0&&(null===(k=i.databaseItemsVisibleTracker)||void 0===k||k.handleItemsRenderStart());const I=(0,y().IS)((e=>({container:f?{}:{boxShadow:`calc(var(--direction, 1) * -1px) 0 0 ${e.tableDividerColor}`,marginTop:1,overflow:"hidden"}})),[f]),{calendar_by:A}=u;if(!A)return null;const T=g[A];return T&&x?(0,Ce.jsx)("div",{style:I.container,children:v?v.map((e=>f?(0,Ce.jsx)(Wc,{blockPropertyValueOverlayStore:t,calendarBy:A,calendarViewRange:C,canEditCalendar:r,collectionContextStore:i,currentlyViewedMonth:l,format:a,items:e.items,query:u,schema:g,shouldShowShimmer:b,showWeekends:w,sortedResultsStore:S,startOfWeek:e.start},e.start):(0,Ce.jsx)(yd,{blockPropertyValueOverlayStore:t,blockStore:o,calendarBy:A,calendarStore:n,calendarViewRange:C,canEditCalendar:r,collectionContextStore:i,collectionViewStore:x,currentlyViewedMonth:l,endOfWeek:e.end,format:a,isInHomeWidget:s,isInPeekRenderer:c,isTypedMsvCollection:d,items:e.items,propertySchema:T,schema:g,shouldShowShimmer:b,showWeekends:w,sortedResultsStore:S,startOfWeek:e.start},e.start))):void 0}):null}const fd=(0,r.memo)(vd);var bd=()=>o(662303),xd=()=>o(287940);const Cd=(0,he().YK)({previousMonthButtonAriaLabel:{id:"database.calendarViewHeader.previousMonthButton.ariaLabel",defaultMessage:"Previous Month"},nextMonthButtonAriaLabel:{id:"database.calendarViewHeader.nextMonthButton.ariaLabel",defaultMessage:"Next Month"},todayButtonLabel:{id:"database.calendarViewHeader.todayButton.label",defaultMessage:"Today"}}),wd=r.memo((function(e){const{currentlyViewedMonth:t,calendarViewRange:n,setNewCalendarStart:i,isInHomeWidget:l,dateRangeStart:a,isInPeekRenderer:s,stickyStyle:c,collectionContextStore:d,weeks:u,userSettingsStartOfWeekStore:p}=e,g=(0,he().tz)(),{isPhone:S}=(0,m().Y0)(),v=(0,r.useRef)(null),f=(0,W().Oz)(d),b=(0,h().K8)((()=>{const e=p.state,t=d.collectionViewStore(),o=null==t?void 0:t.getFormatStore();return(null==o?void 0:o.getKeyStore("calendar_show_weekends").getValue())??!0?(0,Qc().zI)(e,bd().locale):(0,Qc().rj)(bd().locale)}),[d,p]),x=(0,r.useMemo)((()=>{const e=(0,Qc().W_)(t,"month_year_long",bd().locale);if("month"===n)return e;if(!u||void 0===u[0])return"";const o=u[0];if((0,Bc().vY)({firstDate:o.start,secondDate:o.end}))return e;return`${(0,Qc().W_)(o.start,(0,Bc().St)({firstDate:o.start,secondDate:o.end})?"month_short":"month_year_short",bd().locale)} - ${(0,Qc().W_)(o.end,"month_year_short",bd().locale)}`}),[t,n,u]),C=(0,r.useCallback)((()=>{const e=p.state,t="month"===n?(0,Bc().mK)((0,Bc().Mw)(Date.now()),e):(0,Bc().mK)(Date.now(),e);i({newCalendarStart:t,calendarViewRange:n,startOfWeek:e})}),[n,i,p]),w=(0,r.useCallback)((e=>{const t=p.state,o=(0,Bc().to)(a,t);if("month"===n){const r="left"===e?-1:1,l=(0,Bc().mK)((0,Bc().Mw)((0,Bc().AQ)({date:o,monthsToAdd:r})),t);i({newCalendarStart:l,calendarViewRange:n,startOfWeek:t})}else{const o="left"===e?-7:7,r=(0,Bc().mK)((0,Bc().K1)({date:a,daysToAdd:o}),t);i({newCalendarStart:r,calendarViewRange:n,startOfWeek:t})}}),[p,a,n,i]),k=(0,r.useCallback)((()=>{w("left")}),[w]),I=(0,r.useCallback)((()=>{w("right")}),[w]),A=(0,y().IS)((e=>{const t=S?e.background.primary:null!=f&&f.background?f.background:s?e.background.elevated:e.background.primary;return{container:{...!l&&{position:"absolute",insetInlineStart:0,insetInlineEnd:0,zIndex:85,background:t}},icon:{width:Se().Ev.default,height:Se().Ev.default},monthSwitcher:{display:"flex",height:42,alignItems:"center",marginBottom:2},monthHeader:{fontWeight:q().Wy.semibold,marginInlineStart:8,marginInlineEnd:8,lineHeight:1,fontSize:S?16:14},spacer:{flexGrow:1},weekdayNamesContainer:{display:"flex",marginTop:S?8:0,boxShadow:`0 1px 0 ${e.tableDividerColor}`},weekdayName:{flexGrow:1,flexBasis:0,textAlign:"center",fontSize:12,color:e.text.tertiary,height:24}}}),[f,l,s,S]);return(0,Ce.jsx)(ki().g,{stickyAttachPoint:l?"no-stick":"ceiling",nodeRef:v,stickyStyle:c,transitionStickyStyle:c,absoluteHeight:98,children:(0,Ce.jsxs)("div",{style:A.container,ref:v,children:[(0,Ce.jsxs)("div",{style:A.monthSwitcher,children:[(0,Ce.jsx)("div",{style:A.monthHeader,children:x}),(0,Ce.jsx)("div",{style:A.spacer}),(0,Ce.jsx)(xd().A,{collectionContextStore:d,entrypoint:"calendar_view"}),(0,Ce.jsx)(Te().A,{ariaLabel:g.formatMessage(Cd.previousMonthButtonAriaLabel),icon:o(879765).$,iconStyle:A.icon,onClick:k}),(0,Ce.jsx)(_o().p,{size:"sm",onClick:C,children:(0,Ce.jsx)(he().sA,{...Cd.todayButtonLabel})}),(0,Ce.jsx)(Te().A,{ariaLabel:g.formatMessage(Cd.nextMonthButtonAriaLabel),icon:o(222334).arrowChevronSingleRightIcon,iconStyle:A.icon,onClick:I})]}),(0,Ce.jsx)("div",{style:A.weekdayNamesContainer,className:Vt().VO,children:b.map((([e,t])=>(0,Ce.jsx)("div",{style:A.weekdayName,children:t},e)))})]})})})),kd=r.memo((function(e){const{blockPropertyValueOverlayStore:t,collectionContextStore:n,store:i,format:l,query:a,schema:s,isFullScreen:c,isInPeekRenderer:u,isPreviewing:p,maxHeight:v,minWidth:b,paddingBottom:x,paddingLeft:C,paddingRight:w}=e,k=(0,he().tz)(),A=(0,m().v3)(),T=A.currentUser.id,{isPhone:j,isMobile:M}=(0,m().Y0)(),{value:B}=(0,ft().fJ)(Rt().T.formulas),V=(0,r.useRef)(null),E=(0,r.useRef)(null),O=(0,o(93583).A)(E,V),L=(0,h().uB)(void 0,Dc().a),z=(0,h().uB)(void 0,f().Store),K=(0,h().K8)((()=>n.collectionViewStore()),[n]),H=null==K?void 0:K.id,W=(0,h().K8)((()=>n.collectionStore()),[n]),N=(0,Ht().bx)(i,!1),G=(0,h().O$)(Qt().A),$=(0,h().O$)(n.isLoadingStore),U=(0,h().K8)((()=>"collectionTypedView"===n.contextType),[n]),q=(0,h().O$)(n.isInHomeWidgetStore),X=(0,h().K8)((()=>Boolean(n.viewsModuleContextStore.getViewModuleType())),[n]),Y=(0,h().O$)(n.dateRangeStartStore),Q=(0,h().O$)(n.dateRangeEndStore),Z=(0,h().O$)(n.canConfigureBlockStore),J=(0,h().O$)(n.permissionScopesStore),ee=(0,h().O$)(L),{dayStoreMap:te,startingMonth:oe,isDragging:re}=ee,ie=re?void 0:ee.hoveredDay,le=N,ae=(0,h().K8)((()=>{var e;return(null==K||null===(e=K.getFormatStore())||void 0===e?void 0:e.getKeyStore("calendar_view_range").getValue())??"month"}),[K]),se=c&&!M&&"month"===ae,ce=(0,h().K8)((()=>{const e=Mr().XX.state;return se||!Y?oe:(0,Bc().Mw)((0,Bc().to)(Y,e))}),[se,Y,oe]),de=(0,h().K8)((()=>(0,Fc().j2)({collectionContextStore:n})),[n],{useDeepEqual:!0}),ue=(0,h().K8)((()=>{if(!K)return[];const e=z.state;if(!e||!e.blockIds)return[];const t=e.blockIds.map((e=>ne().B.createChildStore(K,{id:e,table:et().ev})))||[];return(0,Fc().oq)({collectionContextStore:n,results:t,getRecordValue:i.getRecordValue,intl:k,formulasModule:B})}),[K,z,n,i.getRecordValue,k,B],{useDeepEqual:!0}),pe=(0,h().r6)((()=>K&&ue&&(null==ue?void 0:ue.flatMap((e=>e.items.map((e=>ne().B.createChildStore(K,{table:et().ev,id:e.id}))))))||[]),[K,ue],{useDeepEqual:!0,debugName:"sortedResultsStore"});(0,h().O$)(pe);const[me,ge]=(0,r.useState)();(0,r.useEffect)((()=>{var e;null!==(e=V.current)&&void 0!==e&&e.parentElement&&ge((0,Kt().NM)(V.current.parentElement))}),[]);const Se=(0,r.useCallback)((e=>{const{newCalendarStart:t,calendarViewRange:o,startOfWeek:r}=e,i=(0,Bc().to)(t,r);let l;"month"===o?(l=se?(0,Bc().to)((0,Bc().AQ)({date:i,monthsToAdd:1}),r):(0,Bc().to)((0,Bc().Xf)(i),r),me&&se&&(me.scrollTop=0)):l=i,(0,Ec().r)({dateRangeStart:t,dateRangeEnd:l,collectionContextStore:n}),L.update((e=>({...e,startingMonth:(0,Bc().Mw)((0,Bc().to)(t,r))}))),H&&(0,Oc().LQ)({newCalendarStart:t,newCalendarEnd:l,collectionViewId:H,currentUserId:T})}),[n,L,se,me,H,T]),ye=(0,r.useCallback)((()=>{W&&W.isDefined()&&K&&Z&&_().createAndCommit({userAction:"Calendar.createCalendarProperty",environment:A,canUndo:!0,perform:e=>{let t,o=(0,_c().z)(s);if(!o&&J){o=(0,Vc().Ay)();t={[o]:{name:k.formatMessage({id:"database.calendarView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}if(!o)return;(0,Vi().f)({collectionViewStore:K,update:{calendar_by:o},transaction:e});const r=n.settingsStore;(0,D().O)({collectionContextStore:n,collectionSettingsStore:r}),F().a2({collectionSettingsStore:r,item:{type:"property",property:o,formatKey:void 0,selectNameInitial:!0}}),fe().zv({store:K,data:{type:"calendar"},transaction:e}),t&&(0,Bs().F)({environment:A,collectionStore:W,update:t,transaction:e})}})}),[W,K,A,Z,s,k,J,n]),ve=(0,r.useCallback)((()=>{W&&W.isDefined()&&K&&Z&&_().createAndCommit({userAction:"Calendar.updateCalendarBy",environment:A,canUndo:!0,perform:e=>{const t=(0,_c().z)(s);t&&((0,Vi().f)({collectionViewStore:K,update:{calendar_by:t},transaction:e}),fe().zv({store:K,data:{type:"calendar"},transaction:e}))}})}),[W,K,A,Z,s]),be=(0,r.useCallback)((e=>{if(!K||!H)return;const t=(0,Oc().dI)({collectionViewId:H,currentUserId:T}),o=e.state,n=(0,Bc().mK)(t,o),r=(0,Bc().mK)(new Date((0,Bc().to)(t,o)).getDate()>7?(0,Bc().Mw)(t):t,o),i="month"===ae?r:n;L.update((e=>({...e,startingMonth:r.valueOf()}))),Se({newCalendarStart:i,calendarViewRange:ae,startOfWeek:o})}),[K,H,T,ae,L,Se]),xe=(0,r.useCallback)((()=>{if(!E.current||!se)return;const e=I().Ul(Array.from(te.entries()).map((([e,t])=>({store:t,timestamp:e}))),(({timestamp:e})=>e)),t=E.current.getBoundingClientRect(),n=e.find((({store:e})=>{const n=o(695625).T.getRectFromStore(e);if(!n)return;const r=(null==me?void 0:me.scrollTop)??0,i=n.top<=t.top+r,l=n.bottom>=t.top+r;return i&&l}));if(n){const e=Mr().XX.state,t=(0,Bc().Mw)((0,Bc().K1)({date:(0,Bc().to)(n.timestamp,e),daysToAdd:1}));t!==oe&&L.update((e=>({...e,startingMonth:t})))}}),[L,te,se,oe,null==me?void 0:me.scrollTop]),we=(0,Rl().d)(xe,100),ke=(0,r.useCallback)((e=>{if(e<ko().B.incrementScrollOffset&&!$&&se){const e=Mr().XX.state,t=(0,Bc().to)((0,Bc().AQ)({date:Q,monthsToAdd:2}),e);(0,Ec().r)({dateRangeStart:Y,dateRangeEnd:t,collectionContextStore:n})}}),[n,Q,Y,$,se]),Ie=(0,r.useCallback)((e=>{const{target:t}=e;!j&&t instanceof HTMLElement&&(0,d().SQ)({event:e,context:d().y$.EditorMouseDown,callback:()=>{e.preventDefault(),P().jD({environment:A,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[i],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}})}),[A,j,i]),Ae=(0,r.useCallback)((e=>{if(!G&&(0,Fc().kc)(ee)){const t=function(e,t){R().AP();const{selectableRectMap:n}=o(666710).default.state,r=Array.from(te.keys()),i=Array.from(te.values());for(const[o,l]of n.entries())if(l&&Pc().ux(l,e,t)&&i.indexOf(o.props.store)>=0)return r.find((e=>te.get(e)===o.props.store))}(e.clientX,e.clientY);ie!==t&&L.update((e=>({...e,hoveredDay:t})))}}),[L,ee,te,ie,G]),Te=(0,Rl().d)(Ae,100);(0,g().l)((()=>{be(Mr().XX),Mr().XX.addListener(be)})),(0,S().X)((()=>{Mr().XX.removeListener(be)})),(0,r.useEffect)((()=>{G&&(0,Fc().kc)(ee)&&L.update((e=>({...e,hoveredDay:void 0}))),a.calendar_by||ve()}),[L,ee,G,a.calendar_by,ve]),(0,r.useEffect)((()=>{const e=V.current,t=null==e?void 0:e.parentElement,o=me;return t&&((0,Dt().P)(t,"mousemove",Te),o&&(0,Dt().P)(o,"scroll",we)),()=>{t&&(0,Lt().O)(t,"mousemove",Te),o&&(0,Lt().O)(o,"scroll",we)}}),[Te,we,me]);const je=(0,y().IS)((()=>({scroller:{height:"calc(100% - 66px)",maxHeight:v?v-(j?74:66):"inherit",paddingBottom:16,maskImage:"none",WebkitMaskImage:"none",...q?{paddingTop:12}:{}},scrollOffset:q?{height:"100%",maxHeight:"inherit"}:{},selectable:{position:"relative",paddingInlineStart:1,...q&&{height:"100%",maxHeight:"inherit"}},container:{paddingBottom:x,paddingInlineStart:C,paddingInlineEnd:w,minWidth:b,...q&&{height:"100%",maxHeight:"inherit"}},sticky:{paddingInlineStart:C,paddingInlineEnd:w,minWidth:b}})),[q,j,v,b,x,C,w]),Me=(0,Ee().Zp)(),Pe=(0,r.useCallback)((()=>(0,Vl().A)((e=>(0,Ce.jsx)(xi,{nodeRef:E,children:(0,Ce.jsx)(Bl().A,{onChange:ke,style:je.scrollOffset,children:(0,Ce.jsx)("div",{ref:O,style:je.container,className:Vt().G1r,children:(0,Ce.jsxs)(jt().Ay,{location:"collectionCalendar",store:i,onMouseDown:Ie,style:je.selectable,shouldShowHalo:!c&&!q&&!p,canSelect:!c&&!X,analyticsName:"calendar",disablePointerEvents:null==Me?void 0:Me.disableContentPointerEvents,...e,children:[null!=Me&&Me.disableContentPointerEvents?void 0:(0,Ce.jsx)(wd,{collectionContextStore:n,weeks:ue,userSettingsStartOfWeekStore:Mr().XX,dateRangeStart:Y,currentlyViewedMonth:ce,setNewCalendarStart:Se,calendarViewRange:ae,isInHomeWidget:q,isInPeekRenderer:u,stickyStyle:je.sticky}),q?(0,Ce.jsx)(Gn,{style:je.scroller,children:(0,Ce.jsx)(fd,{blockPropertyValueOverlayStore:t,collectionContextStore:n,blockStore:i,calendarStore:L,resultStore:z,sortedResultsStore:pe,format:l,query:a,schema:s,weeks:ue,isInPeekRenderer:u,currentlyViewedMonth:ce,canEditCalendar:le,isInHomeWidget:q,isTypedMsvCollection:U})}):(0,Ce.jsx)(fd,{blockPropertyValueOverlayStore:t,collectionContextStore:n,blockStore:i,calendarStore:L,resultStore:z,sortedResultsStore:pe,format:l,query:a,schema:s,weeks:ue,isInPeekRenderer:u,currentlyViewedMonth:ce,canEditCalendar:le,isInHomeWidget:q,isTypedMsvCollection:U})]})})})})))),[ke,je.scrollOffset,je.container,je.selectable,je.sticky,je.scroller,O,i,Ie,c,q,p,X,null==Me?void 0:Me.disableContentPointerEvents,n,ue,Y,ce,Se,ae,u,t,L,z,pe,l,a,s,le,U]),{calendar_by:Re}=a;if(!Re)return(0,Ce.jsx)(Id,{collectionContextStore:n,isFullScreen:c,paddingBottom:x,paddingLeft:C,paddingRight:w,createCalendarProperty:ye});const _e=s[Re];return _e&&(0,Rc().$)(_e)?de?(0,Ce.jsx)(Zr().A,{id:Yn().Lo,resultStore:z,collectionContextStore:n,reducer:de,render:Pe}):null:(0,Ce.jsx)(Id,{collectionContextStore:n,isFullScreen:c,paddingBottom:x,paddingLeft:C,paddingRight:w,createCalendarProperty:ye})}));function Id(e){const{collectionContextStore:t,isFullScreen:o,paddingBottom:n,paddingLeft:r,paddingRight:i,createCalendarProperty:l}=e,a=(0,h().O$)(t.canConfigureBlockStore),s=(0,y().IS)((()=>({container:{paddingInlineStart:r,paddingInlineEnd:i,paddingBottom:o?void 0:n}})),[o,n,r,i]);return(0,Ce.jsx)(zs().Ay,{style:s.container,title:(0,Ce.jsx)(he().sA,{defaultMessage:"No date property",id:"database.calendarView.missingDatePropertyTitle"}),description:a?(0,Ce.jsx)(he().sA,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Calendar view.",id:"database.calendarView.missingDateProperty",values:{opensettingslink:e=>(0,Ce.jsx)(zs().P6,{onClick:()=>{l()},children:e})}}):(0,Ce.jsx)(he().sA,{defaultMessage:"Calendar views require a date property in order to display.",id:"database.calendarView.missingDatePropertyNoPermissions"})})}var Ad=()=>o(872539);function Td(e){const t=(0,m().v3)(),{store:o,collectionContextStore:n,disabled:l,groupsPointer:a,collectionStore:c,subitemPath:d,indentLevel:u,onSubitemCreate:p,paddingLeft:g}=e,S=(0,h().K8)((()=>{var e;return null===(e=n.collectionViewStore())||void 0===e?void 0:e.getType()}),[n]),v=(0,h().K8)((()=>{var e;return"title"===(null===(e=n.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[n]),f=(0,Tn().Sm)(o),b=(0,h().K8)((()=>(0,z().si)({columnIndex:0,titleColumnIndex:0,indentLevel:u,isSubitemToggleOnTitleColumn:v})),[u,v]),x=(0,y().IS)((t=>{const{fontSize:o,iconSize:n}=s().A.isMobile||"list"===S?{fontSize:mi().hN,iconSize:Se().Ev.default}:{fontSize:mi().Mi,iconSize:Se().Ev.sm};return{newRowButtonWrapper:{display:"flex",alignItems:"center",height:s().A.isMobile?Kn().Um:Kn().tt,width:"100%",paddingInlineStart:b,borderBottom:`1px solid ${t.tableDividerColor}`,insetInlineStart:0,insetInlineEnd:0,..."timeline"===S&&{borderTop:"none"},...e.styles},newRowButton:{display:"inline-flex",alignItems:"center",fontSize:o,height:28,borderRadius:6,paddingInlineStart:6,paddingInlineEnd:8,marginInlineStart:22,position:"sticky",insetInlineStart:g+b+22},newRowContainer:{display:"inline-flex",alignItems:"center",position:"sticky",insetInlineStart:b+8,color:t.text.tertiary},newIcon:{width:n,height:n,marginInlineEnd:s().A.isMobile?8:6,marginInlineStart:s().A.isMobile?2:void 0,fill:t.icon.tertiary},newText:{color:t.text.tertiary}}}),[S,b,e.styles,g]),C=(0,h().K8)((()=>n.isSystemCollection()),[n]),w=(0,h().K8)((()=>{const e=n.permissionScopesStore.state,t=c.isSyncedCollection();return(!l||C)&&e.canEditContent&&!t}),[n,l,c,C]),k=(0,r.useCallback)((e=>{C?_().createAndCommit({userAction:"CollectionNestedCreateSubitemButton.createdPage",environment:t,canUndo:!0,perform:e=>{const n=Ad().rU({environment:t,store:o,transaction:e,navigateToParent:!1,from:"library"});n&&p(n)}}):(_().createAndCommit({userAction:"CollectionNestedCreateSubitemButton.handleClick",environment:t,canUndo:!0,perform:r=>{const i=(0,Ql().u)({environment:t,collectionContextStore:n,groupsPointer:a,store:o,before:!1,collectionStore:c,transaction:r,subitemPath:d,subitemInsertDirection:"into",from:"cvb_new_subitem",event:e});i&&p(i)}}),function(e,t){(0,i().DO_NOT_USE_trackLegacy)(e,"create_subitem",t)}(t,{...(0,Et().sl)(n)}))}),[n,t,a,c,o,d,p,C]);return!w||f?null:(0,Ce.jsx)("div",{style:x.newRowButtonWrapper,children:(0,Ce.jsx)(Ro().Ay,{onClick:k,onMouseDown:Ai().t,style:x.newRowButton,children:(0,Ce.jsxs)("span",{style:x.newRowContainer,children:[(0,gn().plusSmallIcon)(x.newIcon),(0,Ce.jsx)("span",{style:x.newText,children:C?(0,Ce.jsx)(he().sA,{defaultMessage:"Add new",id:"database.tableView.nest.addNew"}):(0,Ce.jsx)(he().sA,{defaultMessage:"New sub-item",id:"database.tableView.nest.addSubitem"})})]})})})}var jd=()=>o(996494),Md=()=>o(209199),Pd=()=>o(372267);const Rd=r.memo((function(e){const{property:t,propertyIndex:o,showProperties:n,blockPropertyValueOverlayStore:i,store:l,schema:a,collectionContextStore:s,disabled:c,isEditing:d,mouseIsEntered:u}=e,p=(0,m().v3)(),g=(0,h().K8)((()=>W().Dj({store:l,collectionContextStore:s})),[l,s]),S=(0,h().K8)((()=>s.collectionViewStore()),[s]),y=(0,h().O$)(s.isInHomeWidgetStore),v=(0,h().O$)(s.isUnlistedViewStore),f=(0,h().O$)(s.isInlineViewStore),{isLocked:b,canEditContent:x}=(0,h().O$)(s.permissionScopesStore),C=(0,r.useMemo)((()=>{if("title"!==t)return!1;return u&&!y&&!(v&&f)}),[y,f,v,u,t]),w=(0,h().K8)((()=>l.canEdit()),[l]),k=d||y,I=(0,r.useCallback)((async()=>Fr().V_(p,i,l,a,n,s,d)),[p,i,l,a,n,s,d]),A=(0,r.useCallback)((async()=>Fr().Un(p,i,l,a,n,s,d)),[p,i,l,a,n,s,d]),T=(0,r.useCallback)((()=>Fr().lY(p,i,l)),[p,i,l]),j=(0,r.useCallback)((()=>Fr().PH(l)),[l]);return g?(0,Ce.jsx)(Ya().BlockPropertyRouter,{store:l,property:t,propertyIndex:o,disabled:c||!w,locked:b||!x,surface:"list",tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:g,collectionViewStore:S,forceMouseEntered:C,showIfEmpty:k,onBgClick:T,onEnter:T,onEsc:T,onTab:A,onUntab:I,onClick:j},t):null}));function _d(e){const{collectionContextStore:t,toggleButton:o,subitemPath:n}=e,r=(0,h().O$)(t.currentSubitemFormatStoreForUiDisplayStore),i=s().A.isMobile,l=(null==n?void 0:n.length)??0,a=Math.max((l-1)*vt().yy,0)+vt().Pi,c=(0,y().IS)((()=>({noToggleIndent:{minWidth:a+vt().yy},toggleIndent:{minWidth:a},container:{paddingTop:i?8:4,display:"flex"}})),[a,i]);return r?o?(0,Ce.jsxs)("div",{style:c.container,children:[(0,Ce.jsx)("div",{style:c.toggleIndent}),o]}):(0,Ce.jsx)("div",{style:c.noToggleIndent}):null}const Bd=r.forwardRef((function(e,t){var n;const{store:i,schema:l,blockPropertyValueOverlayStore:a,handleOpenPeekPage:c,collectionContextStore:d,onShiftEnter:u,toggleButton:p,subitemPath:g,showProperties:v,disabled:f,isLast:b}=e,x=(0,he().tz)(),C=Boolean(e.passesFilter),w=(0,m().v3)(),{isPhone:k}=(0,m().Y0)(),I=(0,re().X)("client_rtl_support"),A=(0,h().K8)((()=>d.shouldShowPageIcon()),[d]),T=(0,r.useRef)(null),j=(0,r.useRef)(null),[M,P]=(0,r.useState)(!1),[R,_]=(0,r.useState)(!1),[B,V]=(0,r.useState)(!1),[E,F]=(0,r.useState)(!1),O=(0,h().K8)((()=>{const e=Xl().A.state;return Boolean(e.isActive&&e.store.id===i.id)}),[i.id]),D=(0,h().K8)((()=>{const e=jd().A.state;return e.store&&e.store.id===i.id?e.editMode:void 0}),[i.id]),L=(0,Rl().d)((()=>{Qt().A.state||F(!0)}),100),z=(0,Pl().Y)((()=>{F(!1)}),100),K=(0,Rl().d)((()=>{V(!0)}),100),H=(0,Rl().d)((()=>{_(!0)}),100),W=(0,h().K8)((()=>bt().default.state.stores.length>0&&bt().default.state.stores[0].id===i.id),[i.id]),N=(0,r.useCallback)((()=>{const e=Pd().NK({environment:w,store:i,collectionContextStore:d});e&&(c(),(0,xa().navigate)({environment:w,url:e}))}),[w,c,i,d]),G=(0,h().K8)((()=>i.getBlockTitleStore()),[i]),$=(0,h().K8)((()=>Pd().uM(i)),[i]),U=(0,h().K8)((()=>Pd().NK({environment:w,store:i,collectionContextStore:d})),[w,i,d]),q=(0,h().K8)((()=>v.map((e=>i.getPropertyValue(e)))),[v,i]),X=(0,r.useCallback)((()=>{Fr().zU(i,c)}),[i,c]),Y=(0,r.useCallback)((()=>{j.current&&P(j.current.scrollWidth>j.current.clientWidth)}),[]),Q=(0,Rl().d)(Y,100),Z=(0,h().K8)((()=>(0,Gl().Wi)(w,i.id)),[w,i]),J=ts().kG+ts().mA,ee=null===(n=(0,Wa().y)(i))||void 0===n?void 0:n.background,te=(0,re().X)("do_not_reduce_opacity_on_collection_table_borders"),oe=(0,h().K8)((()=>Boolean(d.normalizedFormatStore.state.collection_group_by)),[d])&&!b,ne=(0,y().IS)((e=>({container:{display:"flex",position:"relative"},linkBox:{position:"relative",...Pd().nq(O?"multi":"single"),...ee&&{background:ee}},mobileLinkBox:{flexGrow:1,textDecoration:"none",overflow:"hidden",borderBottom:oe?`1px solid ${e.border.secondary}`:void 0,borderImage:A&&oe?`linear-gradient(to right, transparent ${J+ts().qR}px, ${e.border.secondary} ${J+ts().qR}px) 1`:void 0,...ee&&{background:ee}},linkBoxInner:{display:"flex",alignItems:"center",paddingInlineStart:4,userSelect:O?void 0:"none",WebkitUserSelect:O?void 0:"none",opacity:!C&&te?.5:1},mobileLinkBoxInner:{paddingInlineStart:ts().qR,paddingInlineEnd:4,paddingBottom:4,paddingTop:4},propertiesWithTitleContainer:{display:"flex",alignItems:"center"},propertiesAfterTitleContainer:{display:"flex",alignItems:"center",paddingInlineStart:s().A.isMobile&&A?J-ts().iH:s().A.isMobile?0:6,paddingBottom:s().A.isMobile?6:4},hoveredStyle:{background:Fd({isEditing:O,backgroundColor:ee,theme:e})},pressedStyle:{background:Ed({isEditing:O,backgroundColor:ee,theme:e})},overflowButtonArea:{position:"absolute",insetInlineEnd:-28,top:"50%",transform:"translateY(-50%)",width:28,height:"100%",cursor:"pointer"},overflowButton:{position:"absolute",insetInlineEnd:0,top:"50%",transform:"translateY(-50%)",display:"flex",width:20,height:20,borderRadius:4,justifyContent:"center",alignItems:"center",isolation:"isolate",zIndex:2,backdropFilter:"blur(8px)",background:e.background.elevated,transition:"none",paddingInlineStart:2,paddingInlineEnd:0},overflowIcon:{width:12,height:12,fill:e.icon.tertiary,marginInlineStart:-2}})),[O,ee,A,J,C,te,oe]);(0,r.useEffect)((()=>{O&&"new"===D&&(0,Fl().z)({store:G})}),[O,D,G]),(0,r.useEffect)((()=>(window.addEventListener("resize",Q),()=>window.removeEventListener("resize",Q))),[Q]),(0,r.useEffect)((()=>{Q()}),[Q,q]),(0,S().X)((()=>{jd().A.reset(),Xl().A.reset()}));const ie=(0,r.useMemo)((()=>v.indexOf("title")),[v]),le=k&&v.length>0,ae=(0,Ce.jsx)(_d,{collectionContextStore:d,toggleButton:p,subitemPath:g}),se=(e,t)=>(0,Ce.jsx)(Rd,{blockPropertyValueOverlayStore:a,collectionContextStore:d,disabled:f,isEditing:O,mouseIsEntered:E,property:e,propertyIndex:t,showProperties:v,schema:l,store:i},e);let ce;if(le){const[e,t]=[v.slice(0,ie+1),v.slice(ie+1)];ce=(0,Ce.jsxs)("div",{style:ne.container,dir:I&&(0,Md().A1)()?"rtl":"ltr",ref:T,children:[ae,(0,Ce.jsxs)(je().A,{ref:j,href:$,metaHref:U,external:!1,style:ne.mobileLinkBox,innerStyle:ne.mobileLinkBoxInner,disableForOffline:Z,children:[(0,Ce.jsx)("div",{style:ne.propertiesWithTitleContainer,children:e.map(se)}),t.length>0?(0,Ce.jsx)("div",{style:ne.propertiesAfterTitleContainer,children:t.map(se)}):void 0]})]})}else{const e=x.formatMessage({id:"collectionList.overflow.tooltip",defaultMessage:"See all properties"});ce=(0,Ce.jsx)(Je().N,{debugName:"ListItem",capture:W,onShiftEnter:u,children:(0,Ce.jsxs)("div",{style:ne.container,dir:I&&(0,Md().A1)()?"rtl":"ltr",ref:T,onMouseEnter:H,onMouseLeave:()=>_(!1),children:[ae,(0,Ce.jsx)(je().A,{ref:j,href:$,metaHref:U,altHref:U,onClick:X,external:!1,style:ne.linkBox,innerStyle:ne.linkBoxInner,hoveredStyle:ne.hoveredStyle,pressedStyle:ne.pressedStyle,onMouseEnter:L,onMouseMove:L,onMouseLeave:z,disableForOffline:Z,children:v.map(se)}),M?(0,Ce.jsx)("div",{style:ne.overflowButtonArea,children:B||R?(0,Ce.jsx)(qo().A,{renderTooltip:()=>e,placement:"bottom",render:t=>(0,Ce.jsx)(Te().A,{icon:o(569397).arrowStraightRightSmallIcon,iconStyle:ne.overflowIcon,ariaLabel:e,style:ne.overflowButton,onClick:N,onMouseEnter:K,onMouseLeave:()=>V(!1),...t})}):null}):null]})})}return(0,Ht().NW)(i,t,(0,r.useMemo)((()=>({renderedType:"page",getBlockStore:()=>i,getNode:()=>T.current,activate:N})),[i,N]),ce)})),Vd=r.memo(Bd);function Ed(e){const{isEditing:t,backgroundColor:o,theme:n}=e;return o?(0,La().e$)(o,.3):t?"transparent":n.buttonPressedBackground}function Fd(e){const{isEditing:t,backgroundColor:o,theme:n}=e;return o?(0,La().e$)(o,.2):t?"transparent":n.buttonHoveredBackground}function Od(){return{marginTop:1,marginBottom:1}}const Dd=r.memo((function(e){const{groupFormat:t,store:o,format:n,disabled:i,collectionContextStore:l,schema:a,blockPropertyValueOverlayStore:s,paddingLeft:c,paddingRight:d,headerWidth:u,shouldShowShimmer:p}=e,g=(0,m().v3)(),S=(0,r.useMemo)((()=>t?[t]:[]),[t]),y=(0,r.useMemo)((()=>(n.list_properties?n.list_properties:[]).filter((e=>e.visible)).map((({property:e})=>e))),[n]),v=(0,h().O$)(l.permissionScopesStore),f=(0,h().K8)((()=>l.groupsStore.getGroupState(S)),[S,l]),b=(0,h().K8)((()=>!i&&o.canEdit()&&v.canEditContent&&!v.isSyncedCollection),[i,o,v]),x=(0,r.useCallback)((()=>{if(!f)return;const e=l.collectionStore();if(!e||!l.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const t=bt().default.state.stores[0];if(!t)return;const o=l.subitemTreeStore.state,n=(0,yr().Qe)(o.children,(e=>e.value.store===t)),r=n?(0,vt().kY)(n.map((e=>e.value.store))):"",i=l.subitemExpandedStore.state.get(r),a=Boolean(null==i?void 0:i.isExpanded);_().createAndCommit({userAction:"ListView.onItemShiftEnter",environment:g,canUndo:!0,perform:o=>{const r=(0,Ql().u)({environment:g,collectionContextStore:l,groupsPointer:f.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:n,subitemInsertDirection:a?"into":"below",from:"list_selection_overlay_shift_enter"});r&&Fr().v7({environment:g,newStore:r,previousStore:t})}}),(0,Ba().u)(g,"list_item_edit_mode_enter",{...(0,Et().sl)(l),block_id:t.id,from:"shiftEnter",view_type:"list"})}),[l,g,f]),C=(0,r.useCallback)(((e,t)=>{Fr().v7({environment:g,newStore:t,previousStore:e})}),[g]),w=(0,r.useMemo)((()=>({blockPropertyValueOverlayStore:s,collectionContextStore:l,disabled:i,onShiftEnter:x,schema:a,showProperties:y,collectionViewBlockStore:o})),[s,l,i,x,a,y,o]),k=(0,r.useCallback)((e=>{const{store:t,parentStore:o,subitemPath:n,indentLevel:r}=e;if(o)return(0,Ce.jsx)(Td,{store:t,collectionStore:o,subitemPath:n,indentLevel:r,collectionContextStore:l,disabled:i,groupsPointer:S,paddingLeft:c,styles:{borderBottom:void 0,borderTop:void 0},onSubitemCreate:e=>{(0,ma().C)({store:e,transient:!1}),jd().A.setState({store:e,editMode:"new",previousStore:void 0})}})}),[l,i,S,c]);return f?(0,Ce.jsx)(la,{collectionContextStore:l,groupsPointer:S,format:n,canDrag:b,itemProps:w,renderItem:Vd,canDrop:!0,disabled:i,shouldShowHoverMenu:!0,direction:ra.Vertical,analyticsName:"list",getItemSelectableStyle:Od,emptyDroppableSize:0,onSelectableInsertRow:C,nestedCreateSubitemButton:k,paddingLeft:c,paddingRight:d,headerWidth:u,shouldShowShimmer:p}):null}));const Ld=r.memo((function(e){const{store:t,format:o,paddingBottom:n,paddingLeft:i,paddingRight:l,isFullScreen:a,isPreviewing:c,isRootChild:d,minWidth:u,disabled:p,collectionContextStore:g,headerWidth:S}=e,v=(0,m().v3)(),f=(0,h().K8)((()=>W().mM(g,a)),[g,a]),b=(0,h().K8)((()=>null==g?void 0:g.isInHomeWidgetStore.state),[g]),x=(0,h().K8)((()=>"collectionSystemView"===(null==g?void 0:g.contextType)),[g]),C=(0,h().K8)((()=>Boolean(g.viewsModuleContextStore.getViewModuleType())),[g]),w=o.collection_group_by,k=(0,r.useCallback)(((e,t,o)=>{if(s().A.isMobile)Zn().uK({environment:v,store:e,pageVisitSource:$().y8.Create});else if(t)Fr().v7({environment:v,newStore:e,previousStore:void 0});else{const{groupFormat:t}=o,n=t?[t]:[],r=g.groupsStore.getGroupState(n),i="collectionTypedView"===g.contextType;Jn().VU({environment:v,store:e,peekMode:W().hH(g),showMoveTo:i,resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:g,pageVisitSource:$().y8.Create})}}),[v,g]),I=(0,r.useCallback)((()=>({})),[]),A=(0,r.useCallback)((e=>(0,Ce.jsx)(zd,{collectionGroupHeaderProps:e})),[]),T=(0,r.useCallback)((o=>(0,Ce.jsx)(Ps,{reducerId:Yn().FD,store:t,collectionContextStore:g,disabled:p,isFullScreen:a,isRootChild:d,paddingLeft:i,paddingRight:l,headerWidth:S,stickyLeft:!1,renderGroupResults:function(t){return(0,Ce.jsx)(Kd,{...e,groupFormat:t})},getGroupStyle:I,renderHeader:A,onGroupHeaderAddItem:k})),[e,g,p,I,k,S,a,d,i,l,t,A]),j=(0,r.useCallback)((e=>{const t=g.isLoadingStore.state,o=g.groupsStore.getGroupState([]);if(!o)return;if("collectionSystemView"===g.contextType)return;const n=o.reducerResultStore.state;e<ko().B.incrementScrollOffset&&n&&!t&&n.hasMore&&(0,_l().H)({collectionContextStore:g,environment:v,incrementLimitArgs:{isFullScreen:a,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[g,v,a]),M=(0,y().IS)((()=>({container:{paddingBottom:b?0:n,paddingInlineStart:i,paddingInlineEnd:l,minWidth:u},selectable:{display:"flex",flexDirection:"column",paddingTop:w||b||x?void 0:4,paddingBottom:4}})),[n,i,l,u,w,b,x]),P=(0,Ee().Zp)();return(0,Vl().A)((o=>(0,Ce.jsxs)("div",{style:M.container,className:Vt()._OD,children:[(0,Ce.jsx)(jt().Ay,{location:"collectionListView",store:t,shouldShowHalo:!a&&!b&&!c,canSelect:!a&&!C,disablePointerEvents:null==P?void 0:P.disableContentPointerEvents,analyticsName:"list",style:M.selectable,...o,children:w?T(w):(0,Ce.jsx)(Kd,{...e,groupFormat:w})}),f?void 0:(0,Ce.jsx)(Bl().A,{onChange:j})]})))}));function zd(e){const{collectionGroupHeaderProps:t}=e,{collectionContextStore:o}=t,n=(0,h().O$)(o.isInHomeWidgetStore),r=(0,y().IS)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${e.background.primary}`}})),[]);return(0,Ce.jsx)(Sl,{...t,height:n?Go().ag:48,stickyStyle:r.stickyStyle})}const Kd=r.memo((function(e){const{store:t,format:n,schema:i,disabled:l,groupFormat:a,isFullScreen:c,collectionContextStore:d,blockPropertyValueOverlayStore:u,paddingLeft:p,paddingRight:m,headerWidth:g}=e,S=void 0!==a,v=(0,r.useMemo)((()=>a?[a]:[]),[a]),{groupState:f,isEmpty:b}=(0,h().K8)((()=>{const e=d.groupsStore.getGroupState(v);return{groupState:e,isEmpty:0===(null==e?void 0:e.resultsStore.state.length)}}),[d,v]),x=(0,h().O$)(null==f?void 0:f.reducerResultStore),C=""!==(0,h().O$)(d.searchQueryStore),w=(0,h().K8)((()=>(0,Lr().N)({collectionContextStore:d}).length>0),[d]),k=(0,h().K8)((()=>d.groupsStore.anyGroupHasResults()),[d]),{canEditContent:I,isSyncedCollection:A}=(0,h().K8)((()=>{const e=d.permissionScopesStore.state;return{canEditContent:e.canEditContent,isSyncedCollection:e.isSyncedCollection}}),[d]),T=(0,h().K8)((()=>"collectionTypedView"===d.contextType),[d]),j=(0,h().O$)(d.isInHomeWidgetStore),M=b&&(C||w),P=(0,h().K8)((()=>k&&!l&&t.canEdit()&&(I||T)&&!A&&!M&&!(0,Nr().Id)(d)),[k,l,t,I,T,A,M,d]),R=(0,h().K8)((()=>void 0!==x&&(null==x?void 0:x.blockIds.length)>0),[x]),_=(0,h().K8)((()=>(0,Jr().iv)({collectionContextStore:d,groupsPointer:v,hasPartialResults:R})),[d,v,R]),B=(0,h().K8)((()=>W().XQ({collectionContextStore:d,reducerResult:x,isFullScreen:c})),[d,x,c]),V=(0,y().IS)((e=>({container:{paddingBottom:s().A.isMobile?0:a?j?8:16:void 0},groupLoadMoreButton:{fontSize:mi().hN,marginTop:s().A.isMobile?4:void 0,paddingInlineStart:3},groupLoadMoreIcon:{width:Se().Ev.sm,height:Se().Ev.sm,marginInlineEnd:8},spacer:{width:"100%",borderTop:a||j?void 0:`1px solid ${e.tableDividerColor}`,marginTop:4,marginBottom:4}})),[a,j]);return f?(0,Ce.jsxs)("div",{style:V.container,children:[(0,Ce.jsx)(Dd,{groupFormat:a,store:t,format:n,disabled:l,collectionContextStore:d,schema:i,blockPropertyValueOverlayStore:u,paddingLeft:p,paddingRight:m,headerWidth:g,shouldShowShimmer:_}),_?(0,Ce.jsx)(o(286993).c,{isFullScreen:c,hasGroups:S,hasPartialResults:R,hasSearchQuery:C,overrideNumShimmerRows:j&&!R?6:void 0}):void 0,P?(0,Ce.jsxs)(Ce.Fragment,{children:[B?(0,Ce.jsx)("div",{style:V.spacer}):void 0,(0,Ce.jsx)(Hd,{collectionContextStore:d,isFullScreen:c,groupState:f,groupFormat:a})]}):void 0,B?(0,Ce.jsx)(Ol().jJ,{groupsPointer:v,store:t,collectionContextStore:d,format:n,isFullScreen:c,incrementLimitsInRelatedGroups:!1,style:V.groupLoadMoreButton,iconStyle:V.groupLoadMoreIcon}):void 0]}):null})),Hd=r.memo((function(e){const{groupState:t,groupFormat:o,collectionContextStore:n,isFullScreen:i}=e,l=(0,m().v3)(),a=(0,he().tz)(),c=(0,h().O$)(n.isInHomeWidgetStore),d=(0,h().K8)((()=>W().fG({collectionContextStore:n,environment:l,intl:a})),[n,l,a]),u=(0,r.useCallback)((()=>{if(!(0,ro().E)(l))return void(0,wa().Q)(l);const e=n.currentSubitemFormatStoreForUiDisplayStore.state;_().createAndCommit({userAction:"ListView.handleAddItemClick",environment:l,canUndo:!0,perform:o=>{Fr().hn({transaction:o,environment:l,results:t.resultsStore.state,collectionContextStore:n,isFullScreen:i,groupsPointer:t.groupsPointer,insertAtIndex:t.resultsStore.state.length,from:e?"list_view_add_parent_item_bottom":"list_view_add_item_bottom"})}})}),[l,t,n,i]),p=(0,y().IS)((e=>({button:{display:"flex",alignItems:"center",height:(0,z().sG)({isMobile:Boolean(s().A.isMobile)}),borderRadius:6,fontSize:s().A.isMobile?mi().hN:mi().Mi,color:e.text.tertiary,paddingInlineStart:4,paddingInlineEnd:12},icon:{...c?{width:Se().Ev.xxs,height:Se().Ev.xxs,marginInlineStart:10,marginInlineEnd:6}:{width:s().A.isMobile?Se().Ev.default:Se().Ev.sm,height:s().A.isMobile?Se().Ev.default:Se().Ev.sm,marginInlineStart:s().A.isMobile?2:4,marginInlineEnd:8},fill:e.icon.tertiary},buttonContainer:{display:"flex"}})),[c]);return d?(0,Ce.jsxs)("div",{style:p.buttonContainer,children:[(0,Ce.jsxs)(Ro().Ay,{onClick:u,onMouseDown:Ai().t,style:p.button,children:[(0,gn().plusSmallIcon)(p.icon),(0,Ce.jsx)(Ca().w,{collectionContextStore:n})]}),(0,Ce.jsx)(Dr().O,{collectionContextStore:n,groupFormat:o,renderLinkButton:e=>(0,Ce.jsxs)(Ro().Ay,{style:p.button,...e,children:[(0,le().arrowDiagonalUpRightIcon)(p.icon),(0,Ce.jsx)(he().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})]}):(0,Ce.jsxs)(Ro().Ay,{onClick:u,onMouseDown:Ai().t,style:p.button,children:[(0,gn().plusSmallIcon)(p.icon),(0,Ce.jsx)(Ca().w,{collectionContextStore:n})]})}));class Wd extends f().Store{getInitialState(){return{}}getCurrentFormat(e){return this.state.temporaryFormat?this.state.temporaryFormat:e}getCurrentProperties(e,t){return this.getCurrentFormat(t)[e]||[]}}const Nd=Wd;var Gd=()=>o(675592);function $d({isPhone:e,elementWidth:t,paddingLeft:o,paddingRight:n,propertyWidths:r}){let i=t-o-n,l=0;for(let s=0;s<r.length;s++){if(i-=r[s]??0,l=s,i<=0)break}const a=l+1;return r.length>a+(e?2:5)}const Ud=r.memo((function({collectionContextStore:e,tableProperties:t,paddingLeft:n,paddingRight:i,children:l}){const a=(0,m().v3)(),{isPhone:s}=(0,m().Y0)(),c=(0,r.useRef)(null),d=(0,r.useContext)(Pt().R),u=(0,r.useMemo)((()=>t.filter((e=>e.visible))),[t]),p=(0,h().K8)((()=>{var e;return null==d||null===(e=d.horizontalScroller)||void 0===e?void 0:e.getStore().state.element}),[d]),g=(0,h().K8)((()=>{const t=e.frozoneStore.state.frozenIndex;return void 0===t?0:t+1}),[e]),S=(0,h().K8)((()=>u.map((e=>(0,z().oe)({environment:a,propertyFormat:e})))),[a,u]),[y,v]=(0,r.useState)((()=>{var e;return $d({isPhone:s,elementWidth:(null==p||null===(e=p.deref())||void 0===e?void 0:e.clientWidth)??0,paddingLeft:n,paddingRight:i,propertyWidths:S})})),f=(0,r.useCallback)((e=>{oe().default.state.open&&oe().default.state.mode===o(868840).A||v($d({isPhone:s,elementWidth:e.width,paddingLeft:n,paddingRight:i,propertyWidths:S}))}),[n,i,S,s]);(0,o(188709).tK)(c,f);const b=(0,r.useCallback)((e=>e+g>S.length-1?35:S[e+g]??35),[S,g]),x=(0,Dl().Te)({enabled:y,count:u.length,estimateSize:b,scrollMargin:n,getScrollElement:()=>(null==p?void 0:p.deref())??null,getItemKey:e=>u[e].property||e,overscan:2,horizontal:!0,isRtl:(0,Md().A1)()}),C=x.getVirtualItems(),[w,k]=(0,r.useMemo)((()=>C.length>0?[C[0].start-n,x.getTotalSize()+n-C[C.length-1].end]:[0,0]),[C,x,n]),I=0===C.length?0:g+C[0].index,A=0===C.length?0:C[C.length-1].index+1,{propertiesInRange:T,propertiesInRangeIndices:j}=(0,r.useMemo)((()=>0===C.length?{propertiesInRange:[],propertiesInRangeIndices:[]}:{propertiesInRange:u.slice(I,A),propertiesInRangeIndices:Array.from({length:A-I},((e,t)=>I+t))}),[C.length,A,I,u]),M=(0,r.useMemo)((()=>({propertiesInRange:T,propertiesInRangeIndices:j,beforeWidth:w,afterWidth:k})),[k,w,T,j]);return(0,Ce.jsx)(Gd().Pr.Provider,{value:x,children:(0,Ce.jsx)(Gd().Z6.Provider,{value:y,children:(0,Ce.jsx)(Gd().Wm.Provider,{value:M,children:l})})})}));var qd=()=>o(124311),Xd=()=>o(316369),Yd=()=>o(969197),Qd=()=>o(358898),Zd=()=>o(421107),Jd=()=>o(308631);const eu=r.memo((function(e){const{disabled:t,property:n,schema:i,collectionContextStore:l,groupFormat:a,propertyFormat:s,isHovered:c,aggregation:d,onChange:u,forViewType:p}=e,g=(0,m().v3)(),{isMobile:S}=(0,m().Y0)(),v=(0,he().tz)(),f=(0,h().K8)((()=>l.permissionScopesStore.state.isLocked),[l]),[b,x]=(0,r.useState)(void 0),C=(0,r.useMemo)((()=>Boolean((null==s?void 0:s.width)&&s.width<100)),[s]),w=(0,h().K8)((()=>Xi(l,d)),[l,d]),k=(0,h().K8)((()=>{var e;if(!d)return;const t=null===(e=l.collectionStore())||void 0===e?void 0:e.getSpaceId(),o=g.idCreator.getSpaceIdCreatorSync(t??"");return{type:"aggregation",filter:a?(0,jr().Yy)({schema:i,propertyMapping:void 0,groupBy:l.getGroupByAndGroupFormats().groupBy,group:a,timeZone:(0,Sr().P)(),experimentService:er().default,spaceIdCreator:o}):void 0,aggregation:d}}),[i,a,d,l,g]),A=(0,r.useCallback)((({aggregationType:e,enforceMaxAggregationLimit:t})=>{if(e){const o={aggregator:e,property:n,enforceMaxAggregationLimit:t};u(n,o),x(o),(0,T().X)({environment:g,collectionContextStore:l,action:"table_change_aggregation"})}else u(n,void 0),(0,T().X)({environment:g,collectionContextStore:l,action:"table_remove_aggregation"})}),[g,u,n,l]),j=(0,y().IS)((()=>({buttonContainer:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%",marginInlineEnd:4},buttonStyle:{display:"flex",alignItems:"center",justifyContent:"center",padding:"0px 6px",borderRadius:6,overflow:"hidden",whiteSpace:"nowrap",userSelect:"auto",WebkitUserSelect:"auto",transition:"background 0.2s ease"}})),[]);(0,r.useEffect)((()=>{b&&!Xi(l,b)&&(0,I().n4)(d,b)&&x(void 0)}),[w,b,l,d]);const M=(0,r.useMemo)((()=>C&&null!=d&&d.aggregator?tl().zY[(0,Ui().V1)(d)]:void 0),[C,d]),P=(0,r.useMemo)((()=>d?(0,o(436477).H)(n,d,a):""),[a,n,d]),R=(0,r.useCallback)(((e,t)=>{if(t){var o;const r=e["timeline"===p?Yn().qK:Yn().Tt];if("groups"!==r.type)return;const i=(0,Qn().Ix)(t[0]),l=null===(o=r.propertyAggregationResults)||void 0===o||null===(o=o[i])||void 0===o?void 0:o[n];return l?{aggregationResult:l,type:"aggregation"}:void 0}}),[n,p]),_=(0,r.useCallback)((e=>k?(0,Ce.jsx)(Zr().A,{id:P,collectionContextStore:l,reducer:k,groupsPointer:a?[a]:void 0,resultLookupFn:R,isDerivedReducer:!0,render:o=>(0,Ce.jsx)(qo().A,{alignment:C?"center":"end",disableTooltip:!w&&!M,renderTooltip:()=>w?v.formatMessage(Zi.aggregationCalculating):M,render:r=>(0,Ce.jsx)(Ro().Ay,{disabled:t||f,style:j.buttonStyle,...(0,ol().A)(r,e),children:(0,Ce.jsx)(tu,{resultStore:o,aggregation:d,schema:i,property:n,hideLabelText:C})})})},P):(0,Ce.jsx)(Ro().Ay,{disabled:t,style:j.buttonStyle,...e,children:(0,Ce.jsx)(ou,{disabled:t,isHovered:c,hideLabelText:C})})),[d,P,l,k,a,t,j.buttonStyle,c,C,R,w,M,v,i,n,f]),B=(0,r.useCallback)((({close:e})=>(0,Ce.jsx)(o(680341).v,{currentAggregation:d,property:n,schema:i,onChange:A,onClose:e,source:"tableAggregation"})),[A,d,n,i]);return(0,Ce.jsx)("div",{style:j.buttonContainer,children:(0,Ce.jsx)(Ae().A,{popupType:S?Ae().z.SlideUp:Ae().z.Popup,disabled:t||f,renderOrigin:_,render:B})})})),tu=r.memo((function(e){const{aggregation:t,resultStore:n,schema:i,property:l,hideLabelText:a}=e,s=(0,gt().ET)(),{isMobile:c}=(0,m().Y0)(),d=(0,y().IS)((e=>({container:{display:"flex",alignItems:"center"},valueStyle:{color:e.text.secondary,height:"100%"},aggregationTypeNameStyle:{fontWeight:500,color:e.text.tertiary,fontSize:c?12:10,textTransform:"uppercase",letterSpacing:1,marginInlineEnd:4,userSelect:"none",WebkitUserSelect:"none"}})),[c]),u=(0,h().O$)(n),p=(0,r.useMemo)((()=>{if(!t)return;let e=tl().SE[(0,Ui().V1)(t)];return(0,Ui().ET)(t.aggregator)&&(e=t.aggregator.groupName in Jd().OR?Jd().OR[t.aggregator.groupName]:t.aggregator.groupName),e}),[t]),{numberFormat:g,numberPrecision:S}=(0,h().K8)((()=>{const e=i[l];if(!e)return{};if(e&&("formula"===e.type||"number"===e.type)){const o=e.number_format,n=e.number_precision;return{numberFormat:o,numberPrecision:t?(0,tl().zI)(t.aggregator,n):n}}if("rollup"===e.type&&e.relation_property&&e.target_property&&"number"===e.target_property_type&&void 0!==i[e.relation_property]){var n;const r=i[e.relation_property],l=(0,o(685889).pg)(s,r),a=null==l||null===(n=l.getModel())||void 0===n?void 0:n.getNormalizedSchema(),c=null==a?void 0:a[e.target_property];if("number"===(null==c?void 0:c.type)){const e=c.number_format,o=c.number_precision;return{numberFormat:e,numberPrecision:t?(0,tl().zI)(t.aggregator,o):o}}}return{}}),[i,l,t,s]);if(!p)return null;const v=(0,Ce.jsx)("span",{style:d.valueStyle,children:t?(0,Ce.jsx)(Yi,{aggregation:t,collectionContextStore:s,children:u?(0,tl().rv)({numberFormat:g,dateFormat:void 0,aggregation:t,userTimeZone:(0,Sr().P)(),value:u.aggregationResult,numberPrecision:S}):void 0}):void 0},"value");return a?v:(0,Ce.jsxs)("div",{style:d.container,children:[(0,Ce.jsx)("span",{style:d.aggregationTypeNameStyle,children:p},"type"),v]})})),ou=r.memo((function(e){const{disabled:t,isHovered:n,hideLabelText:r}=e,i=(0,y().IS)((e=>({placeholderWrapper:{display:"flex",alignItems:"center",opacity:s().A.isMobile?0:1,height:26},placeholderText:{color:e.text.tertiary}})),[]);return t||!n&&!s().A.isMobile?null:(0,Ce.jsx)(ke().A,{animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:i.placeholderWrapper,children:(0,Ce.jsx)("div",{style:i.placeholderWrapper,children:r?(0,Ce.jsx)("span",{style:i.placeholderText,children:(0,Ce.jsx)(ie().I,{icon:o(153057).A,size:"xs",colorVariant:"tertiary"})},"placeholder"):(0,Ce.jsx)("span",{style:i.placeholderText,children:(0,Ce.jsx)(he().sA,{defaultMessage:"Calculate",id:"database.tableView.aggregationPlaceholder"})},"placeholder")})})})),nu=r.memo((function({collectionContextStore:e,disabled:t,groupFormat:o,isFullScreen:n,isInPeekRenderer:i,query:l,schema:s,showPropertyFormats:c,showRightActionsSpacer:u,pageCount:p,style:g,paddingLeft:S,paddingRight:f,disableSticky:b,forViewType:x}){const C=(0,m().v3)(),{isPhone:w,isMobile:k}=(0,m().Y0)(),I=(0,y().DP)(),A=(0,h().K8)((()=>e.frozoneStore.state.frozenIndex),[e.frozoneStore]),{unfrozenIndexAddendum:T,frozenPropertyFormats:j,unfrozenPropertyFormats:M}=(0,h().K8)((()=>{const e=c;let t=[],o=e;const n=(0,W().qi)(A);return void 0!==A&&(t=e.slice(0,n),o=e.slice(n)),{unfrozenIndexAddendum:n,frozenPropertyFormats:t,unfrozenPropertyFormats:o}}),[A,c]),P=(0,h().O$)(e.isInHomeWidgetStore),R=(0,h().K8)((()=>{var e;return Boolean(null===(e=l.aggregations)||void 0===e?void 0:e.length)}),[l.aggregations]),_=(0,r.useMemo)((()=>p>0&&!t),[p,t]),B=(0,h().O$)(kn().A),V=(0,W().Oz)(e),E=(0,y().IS)((e=>{const r=P?void 0:(null==V?void 0:V.background)||(i?e.background.elevated:e.background.primary);return{aggregationRow:{borderTop:_?`1px solid ${e.border.secondaryTranslucent}`:"none",display:"flex",background:r,zIndex:85,fontSize:14,height:(0,z().sG)({isMobile:k})+(n&&!o?B:0),minWidth:"100%",clipPath:"polygon(0% -20%, 100% -20%, 100% 100%, 0% 100%)",insetInlineStart:0,boxSizing:"border-box",...g},stickyStyle:{paddingInlineStart:S,paddingInlineEnd:f,fontVariantNumeric:"lining-nums tabular-nums"},container:{display:"flex",paddingInlineEnd:!t&&u?32:0},innerContainer:{display:"flex"}}}),[P,null==V?void 0:V.background,i,k,n,o,B,g,S,f,t,u,_]),F=(0,h().K8)((()=>void 0!==A&&(0,z().wy)({environment:C,collectionContextStore:e,isPhone:w,theme:I})),[A,C,e,w,I]),O=(0,r.useCallback)((e=>{(0,d().SQ)({event:e,context:d().y$.EditorMouseDown,callback:()=>{}})}),[]),D=(0,r.useCallback)(((n,r)=>(0,Ce.jsx)(ru,{propertyFormat:n,groupFormat:o,disabled:t,collectionContextStore:e,schema:s,query:l,forViewType:x},n.property)),[e,t,o,l,s,x]),L=!P&&(R||n),K=(0,r.useRef)(null),H=(0,Ce.jsx)(a().s,{allowSelectionWithin:!1,style:E.aggregationRow,onMouseDown:O,ref:K,children:(0,Ce.jsx)("div",{style:E.container,children:(0,Ce.jsxs)("div",{style:E.innerContainer,children:[void 0!==A?(0,Ce.jsx)("div",{style:{...F,display:"flex"},children:j.map(D)}):void 0,M.map(((e,t)=>D(e,t+T)))]})})});return!(0,h().O$)(v().e)?null:L?(0,Ce.jsx)(ki().g,{stickyAttachPoint:b?"no-stick":"floor",stickyStyle:E.stickyStyle,nodeRef:K,children:H}):H})),ru=r.memo((function({propertyFormat:e,groupFormat:t,disabled:n,collectionContextStore:i,query:l,schema:a,forViewType:s}){var c;const d=(0,m().v3)(),[u,p]=(0,r.useState)(!1),g=(0,h().K8)((()=>i.permissionScopesStore.state.isLocked),[i.permissionScopesStore]),S=(0,y().IS)((()=>({wrapper:{display:"flex",width:e.width}})),[e.width]),v=(0,r.useCallback)(((e,t)=>{(0,o(500733).I)({environment:d,collectionContextStore:i,query:l,property:e,newAggregation:t})}),[i,l,d]),f=!n&&!g&&u,b=(0,r.useCallback)((()=>{p(!0)}),[p]),x=(0,r.useCallback)((()=>{p(!1)}),[p]);return(0,Ce.jsx)("div",{style:S.wrapper,onMouseEnter:b,onMouseLeave:x,children:(0,Ce.jsx)(eu,{groupFormat:t,propertyFormat:e,disabled:n,isHovered:f,aggregation:null===(c=l.aggregations)||void 0===c?void 0:c.find((t=>t.property===e.property)),property:e.property,collectionContextStore:i,schema:a,onChange:v,forViewType:s})})})),iu=r.memo(r.forwardRef((function(e,t){var o;const{collectionContextStore:n,handleAddRowClick:i,numberOfBlankRows:l,isBlockPropertyValueOverlayOpen:a,propertyFormats:s,query:c}=e,[d,u]=(0,r.useState)(0),p=(0,r.useCallback)((()=>{u(0)}),[]),m=Boolean(null===(o=c.aggregations)||void 0===o?void 0:o.length),g=(0,y().IS)((e=>{const{button:t}=(0,z().BJ)({theme:e,hideTextWithTransition:!1,hideTextWithoutTransition:a});return{button:{...t,transition:"background 0.2s ease",borderBottom:`1px solid ${e.border.secondaryTranslucent}`,paddingInlineStart:0},buttonHovered:{background:e.tableRowHoveredBackground},lastRow:{...!m&&{marginBottom:6}},text:{fontSize:14,color:e.text.tertiary,display:"inline-flex",alignItems:"center",height:"100%",opacity:1,transition:"opacity 0.2s ease",...a&&{display:"none"}}}}),[a,m]);return 0===s.length?null:(0,Ce.jsx)("div",{onMouseLeave:p,ref:t,children:Array.from({length:l}).map(((e,t)=>(0,Ce.jsx)(Ro().Ay,{className:Vt().Mbm,onClick:i,onMouseDown:Ai().t,style:{...g.button,...t===l-1&&g.lastRow},hoveredStyle:g.buttonHovered,onMouseEnter:()=>u(t),children:(0,Ce.jsx)("span",{style:g.text,children:(0,Ce.jsx)(lu,{propertyFormats:s,collectionContextStore:n,isRowHovered:d===t})})},`row-${t}`)))})})));function lu(e){const{propertyFormats:t,collectionContextStore:o,isRowHovered:n}=e;return(0,Ce.jsx)(Ce.Fragment,{children:t.map(((e,t)=>(0,Ce.jsx)(au,{propertyFormat:e,collectionContextStore:o,isRowHovered:n,isFirstColumn:0===t},e.property)))})}function au(e){const{propertyFormat:t,collectionContextStore:o,isRowHovered:n,isFirstColumn:r}=e,i=(0,m().v3)(),l=s().A.isMobile,a=(0,h().K8)((()=>(0,z().oe)({environment:i,propertyFormat:t})),[t,i]),c=(0,y().IS)((e=>({tableCell:{display:"flex",width:a,height:"100%",position:"relative",borderInlineEnd:`1px solid ${e.border.secondaryTranslucent}`},icon:{width:Se().Ev.sm,height:Se().Ev.sm,marginInlineStart:l?0:1,marginInlineEnd:7,fill:e.icon.tertiary},newPageLabel:{display:"flex",alignItems:"center",paddingInlineStart:8,minWidth:100,...l&&{fontSize:17,color:e.text.tertiary}}})),[a,l]);return(0,Ce.jsx)("div",{style:c.tableCell,children:n&&r?(0,Ce.jsxs)("div",{style:c.newPageLabel,children:[(0,gn().plusSmallIcon)(c.icon),(0,Ce.jsx)(Ca().w,{collectionContextStore:o})]}):void 0})}var su=()=>o(534513),cu=()=>o(338381),du=()=>o(40845),uu=()=>o(634201);const pu={position:"absolute",display:"flex",opacity:.5,zIndex:81},mu=function(e){const t=(0,r.useRef)(null),n=(0,r.useRef)(),i=(0,h().uB)(e.store,o(170253).A),l=(0,h().O$)(i),{direction:a,sectionedKeys:s,sectionStyles:c,keys:d,disableVerticalEdgeScroll:u,disableHorizontalEdgeScroll:p,disabled:m,renderKey:g}=e,S={..."horizontal"===a?Vs().Z0:Vs().Bb,...l.isDragging&&{position:"relative",zIndex:1,width:l.savedContainerRect.width,height:l.savedContainerRect.height},...e.style};function y(e){return"string"==typeof e?e:e.key}const v=(0,h().K8)((()=>d.map(((e,t)=>{const o=y(e),n=g(o,t,t===d.length-1);if(l.isDragging&&l.draggingKey===o){const{savedKeyRects:e,savedContainerRect:r,currentXOffset:i,currentYOffset:s}=l,c=e[t];let d,u;"vertical"===a?(d=(0,du().A)(c.top+s,r.top,r.top+r.height-c.height)-r.top,u=c.left-r.left):(d=c.top-r.top,u=(0,du().A)(c.left+i,r.left,r.left+r.width-c.width)-r.left);const p={...pu,left:u,top:d,width:c.width,height:c.height,zIndex:1};return(0,Ce.jsx)("div",{style:p,children:n},o)}}))),[d,g,a,l]);function f(){const{direction:o}=e;return!n.current&&t.current&&(n.current="vertical"===o?(0,Kt().NM)(t.current):(0,Kt().T8)(t.current)),n.current}const b=m?{}:{onDraggableDragCancel:()=>{l.isDragging&&i.reset()},onDraggableDragEnd:()=>{if(l.isDragging){const{keys:t,onDrop:o}=e,{startKeyPosition:n,currentKeyPosition:r}=l;if(n!==r){const e=I().o8(t);e.splice(r,0,e.splice(n,1)[0]);const i=y(t[n]);o(e.map(y),{key:i,startPosition:n,endPosition:r})}e.onDragEnd&&e.onDragEnd(),i.reset()}},onDraggableDragStart:o=>{o.preventDefault();const{keys:n}=e,r=t.current;if(!r)return;if(!(r instanceof Element))return;const l=cu().EV(o.target,(e=>cu().vq(e)&&e.classList.contains(Vt().wAf))),a=cu().EV(o.target,(e=>e.parentNode===l));if(l&&a){const t=uu().PE(r.children).indexOf(l),o=uu().PE(l.children).indexOf(a);let c=0;const d=Object.keys(s);for(let e=0;e<t;e++)c+=s[d[e]].length;c+=o;const u=n[c];if("object"==typeof u&&!u.draggable)return;const p=r.getBoundingClientRect(),m=I().Bq(Object.keys(s).map(((e,t)=>s[e].map(((e,o)=>r.children[t].children[o].getBoundingClientRect()))))),g=f();if(g){const t=y(n[c]);e.onDraggingKeyChanged&&e.onDraggingKeyChanged(t),i.setState({isDragging:!1,willDrag:!0,currentXOffset:0,currentYOffset:0,draggingKey:t,startKeyPosition:c,startScrollX:g.scrollLeft,startScrollY:g.scrollTop,currentKeyPosition:c,savedContainerRect:p,savedKeyRects:m})}}},onDraggableDragMove:t=>{!l.isDragging&&l.willDrag&&l.draggingKey&&(0,su().A)(t.startX,t.startY,t.currentX,t.currentY)>=o(450183).t[t.device]&&(i.setState({currentXOffset:l.currentXOffset,currentYOffset:l.currentYOffset,startScrollX:l.startScrollX,startScrollY:l.startScrollY,startKeyPosition:l.startKeyPosition,currentKeyPosition:l.currentKeyPosition,savedKeyRects:l.savedKeyRects,savedContainerRect:l.savedContainerRect,draggingKey:l.draggingKey,isDragging:!0,willDrag:!1}),e.onDragStart&&e.onDragStart());const n=f();if(l.isDragging&&n){const{savedKeyRects:e,startScrollX:o,startScrollY:r}=l,a=n.scrollLeft-o,s=n.scrollTop-r,c=I().wq(e,(e=>(0,su().A)(t.currentX+a,t.currentY+s,e.left+e.width/2,e.top+e.height/2)));if(c){const o=e.indexOf(c);i.setState({...l,currentXOffset:t.diffX+a,currentYOffset:t.diffY+s,currentKeyPosition:o})}}}};return(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)(Jc().A,{...b,forceTouch:!0,allowDragWhileTextEditing:!0,disableVerticalEdgeScroll:u||"horizontal"===a,disableHorizontalEdgeScroll:p||"vertical"===a,render:o=>{let n=0;return(0,Ce.jsx)("div",{ref:t,style:S,...o,children:Object.entries(s).map((([t,o])=>{const r=((e,t)=>(0,Ce.jsx)("div",{className:Vt().wAf,style:null==c?void 0:c[e],children:t},e))(t,o.map(((t,o)=>((t,o)=>{const n=y(t),r=e.keys.map(y),i=g(n,o,r.length-1===o);let a="";if(l.isDragging){const{startKeyPosition:t,currentKeyPosition:n}=l;t===n?a="":"horizontal"===e.direction?n===o&&o<t?a=`inset 4px 0 ${_i().IF.blueWithAlpha(.5)}`:n===o&&o>t&&(a=`inset -4px 0 ${_i().IF.blueWithAlpha(.5)}`):"vertical"===e.direction&&(n===o&&o<t?a=`inset 0 4px ${_i().IF.blueWithAlpha(.5)}`:n===o&&o>t&&(a=`inset 0 -4px ${_i().IF.blueWithAlpha(.5)}`))}return(0,Ce.jsx)("div",{style:{display:"flex",flexDirection:"vertical"===e.direction?"column":"horizontal"===e.direction?"row":(0,A().HB)(e.direction),boxShadow:a},children:i},n)})(t,o+n))));return n+=o.length,r}))})}}),v]})};var gu=()=>o(112961);function Su({collectionContextStore:e}){const t=(0,m().v3)(),n=(0,h().O$)(e.normalizedSchemaStore),i=(0,r.useMemo)((()=>Object.keys(n).length<=1),[n]),l=(0,y().IS)((e=>({dotsIcon:{width:Se().Ev.sm,height:Se().Ev.sm,fill:(0,o(852424).P0)({theme:e,willShowOnTooltip:!1})},button:{display:i?"none":"flex",alignItems:"center",justifyContent:"center",borderRadius:6,width:s().A.isMobile?32:28,height:s().A.isMobile?32:28}})),[i]),a=(0,r.useCallback)((()=>{(0,D().O)({collectionContextStore:e,collectionSettingsStore:e.settingsStore}),(0,T().X)({environment:t,collectionContextStore:e,action:"click_table_header_dot_menu"}),F().a2({collectionSettingsStore:e.settingsStore,item:{type:"propertyVisibility",timelineViewTab:"timeline"}})}),[e,t]);return(0,Ce.jsx)(qo().A,{renderTooltip:()=>(0,Ce.jsx)(he().sA,{defaultMessage:"Show or hide properties",id:"collectionTable.configureColumnsButton.showOrHideProperties"}),render:e=>(0,Ce.jsx)(Ro().Ay,{...e,style:l.button,onMouseDown:Qd().tr,onClick:a,className:Vt().LcC,children:(0,Ce.jsx)("div",{style:Qd().w6,children:(0,se().ellipsisSmallIcon)(l.dotsIcon)})})})}const hu=r.memo((function(e){const{isCollectionViewBlockSelected:t,passesFilter:o,isScrolled:n,isCheckbox:r,isShimmerRow:i}=e,l=(0,y().IS)((e=>{let r="";return r="dark"===e.mode?"transparent":o&&!t?e.frozenColumnDividerShadowBackgroundFiltered:e.frozenColumnDividerShadowBackground,{container:{display:"flex",flexDirection:"row",height:"100%"},border:{position:"absolute",insetInlineEnd:0,width:1,height:i?35:"100%",background:o&&!t||"dark"===e.mode?e.tableDividerColor:e.tableFrozenFilterDividerColor},shadow:{position:"absolute",top:0,insetInlineEnd:-3,width:3,height:i?34:"100%",background:r},animate:{opacity:n?1:0}}}),[i,o,t,n]);return(0,Ce.jsxs)("div",{style:l.container,children:[r?null:(0,Ce.jsx)("div",{style:l.border}),(0,Ce.jsx)(ke().A,{visible:!0,animate:l.animate,children:(0,Ce.jsx)("div",{style:l.shadow})})]})})),yu=r.memo((function(e){const{checkedState:t,onClick:n,checkboxType:l,collectionContextStore:a,isBlockHovered:s,passesFilter:c,disabled:d,frozoneProps:u}=e,p=(0,m().v3)(),[g,S]=(0,r.useState)(!1),v=(0,r.useRef)(null);(0,r.useEffect)((()=>{v.current&&(v.current.indeterminate="partial"===t)}),[t]);const f=(0,h().O$)(wr().Hf),b=(0,r.useCallback)((e=>{if(d)return;n(e);const t=(0,Et().sl)(a)||{};(0,i().DO_NOT_USE_trackLegacy)(p,"collection_multi_select_checkbox_clicked",{...t,checkbox_type:l})}),[d,l,a,p,n]),x=(0,r.useMemo)((()=>!1===t&&!g||f?s?.6:null!=u&&u.shouldShowStickyMultiSelectColumn?.4:0:1),[t,g,f,s,null==u?void 0:u.shouldShowStickyMultiSelectColumn]),C=(0,y().IS)((e=>{const t=null!=u&&u.shouldShowStickyMultiSelectColumn?x>0?1:0:x;return{multiSelectCheckbox:{background:null!=u&&u.isScrolled?null==u?void 0:u.frozenStyles.background:void 0,borderBottom:e.tableDividerColor,height:"100%"},multiSelectCheckboxInner:{height:"100%"},label:{height:"100%",alignItems:"flex-start",justifyContent:"center",display:"flex",cursor:d?void 0:"pointer",zIndex:1},container:{width:`${Kn().tG}px`,height:`${Kn().tG}px`,display:"flex",justifyContent:"center",alignItems:"center"},animate:{opacity:t}}}),[x,d,null==u?void 0:u.frozenStyles.background,null==u?void 0:u.isScrolled,null==u?void 0:u.shouldShowStickyMultiSelectColumn]),w=(0,r.useCallback)((()=>{S(!0)}),[]),k=(0,r.useCallback)((()=>{S(!1)}),[]);return(0,Ce.jsxs)(ke().A,{animate:C.animate,style:C.multiSelectCheckbox,onMouseEnter:w,onMouseLeave:k,children:[(0,Ce.jsx)("div",{style:C.multiSelectCheckboxInner,children:(0,Ce.jsx)("label",{style:C.label,onClick:Ii().k,onMouseDown:Ai().t,children:(0,Ce.jsx)("div",{style:C.container,children:(0,Ce.jsx)(o(729108).S,{ref:v,checked:t,onClick:b,disabled:d,size:16})})})}),null!=u&&u.shouldFreezeMultiSelectColumn?(0,Ce.jsx)(hu,{isCollectionViewBlockSelected:null==u?void 0:u.isCollectionViewBlockSelected,passesFilter:c,isCheckbox:!0,isScrolled:!0}):null]})})),vu=r.memo((function(e){const{groupsPointer:t,collectionContextStore:o,hasMoreReducerResults:n,frozoneProps:i}=e,l=(0,m().v3)(),a=(0,r.useCallback)((()=>{const e=(0,vt().v2)(t[0],o),n=o.isLibraryBlock();return e.filter((e=>e.canEdit()||n))}),[o,t]),s=(0,h().K8)((()=>0===a().length),[a]),{checkedState:c,allVisibleItemsChecked:d}=(0,h().K8)((()=>{const e=a(),t=e.length;if(0===t)return{checkedState:!1,allVisibleItemsChecked:!0};const o=bt().default.state.stores.filter((t=>e.includes(t))).length;return{checkedState:0!==o&&(o===t&&!n||"partial"),allVisibleItemsChecked:o===t}}),[a,n]),u=(0,r.useCallback)((e=>{var t;const n=a(),r=bt().default.state.stores,i=(0,z().ut)({collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id})?[]:r;!1===c||"partial"===c&&!d?R().td({environment:l,stores:I().KC(i,n)}):(!0===c||"partial"===c&&d)&&R().td({environment:l,stores:I().FF(i,...n)}),e.stopPropagation(),e.preventDefault()}),[c,o,l,a,d]),p=(0,h().K8)((()=>(0,W().f5)({collectionContextStore:o})),[o]),g=(0,y().IS)((()=>({wrapper:{...null==i?void 0:i.frozenStyles,...-1===(null==i?void 0:i.frozenIndex)&&{background:void 0}},checkboxContainer:p?{position:"absolute",insetInlineStart:-Kn().Fh,background:-1===(null==i?void 0:i.frozenIndex)||null==i?void 0:i.frozenStyles.background}:{display:"contents"}})),[null==i?void 0:i.frozenIndex,null==i?void 0:i.frozenStyles,p]);return(0,Ce.jsx)("div",{style:g.wrapper,children:(0,Ce.jsx)("div",{style:g.checkboxContainer,children:(0,Ce.jsx)(yu,{passesFilter:!0,checkedState:c,onClick:u,checkboxType:"group",collectionContextStore:o,frozoneProps:i?{...i,isCollectionViewBlockSelected:!1}:void 0,disabled:s})})})}));var fu=()=>o(37250),bu=()=>o(59400),xu=()=>o(232930),Cu=()=>o(953006),wu=()=>o(285176),ku=()=>o(782473);function Iu(e){const{origin:t,propertyType:o}=e,n=(0,m().v3)();return(0,Ce.jsx)(Cu().k,{origin:t,placementToOrigin:"bottom",header:function(){switch(o){case"owner":return(0,Ce.jsx)(he().sA,{id:"WikiPropertiesOnboardingTooltip.header.ownerProperty",defaultMessage:"Owner"});case"verification":return(0,Ce.jsx)(he().sA,{id:"WikiPropertiesOnboardingTooltip.header.verificationProperty",defaultMessage:"Verification"});case"tags":return(0,Ce.jsx)(he().sA,{id:"WikiPropertiesOnboardingTooltip.header.tagsProperty",defaultMessage:"Add tags and more"});default:(0,A().HB)(o)}}(),content:function(){switch(o){case"owner":return(0,Ce.jsx)(he().sA,{defaultMessage:"Owners are responsible for keeping the page updated. By default, the owner is the page creator",id:"WikiPropertiesOnboardingTooltip.content.ownerProperty",values:{bold:e=>(0,Ce.jsx)("span",{style:{fontWeight:q().Wy.semibold},children:e})}});case"verification":return(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)(he().sA,{defaultMessage:"Page owners can mark a page as verified or expired, to help viewers understand whether they can trust the content",id:"WikiPropertiesOnboardingTooltip.content.verificationProperty"}),(0,Ce.jsx)(wu().o,{href:(0,xu().x)("guides.wikis"),style:{color:_i().Tj.uiLightGray}})]});case"tags":return(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)(he().sA,{defaultMessage:"Customize your wiki with tags or other database properties",id:"WikiPropertiesOnboardingTooltip.content.tagsProperty"}),(0,Ce.jsx)(wu().o,{href:(0,xu().x)("guides.databaseProperties"),style:{color:_i().Tj.uiLightGray}})]});default:(0,A().HB)(o)}}(),numSteps:3,currStepIndex:function(){switch(o){case"owner":return 0;case"verification":return 1;case"tags":return 2;default:(0,A().HB)(o)}}(),onCloseClick:()=>{fu().ZP(n)},onPrimaryButtonClick:()=>fu().A6(n),onBackButtonClick:()=>fu().Jz(n),enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerLength:ku().gO,pointerOffset:ku().j$,style:{width:ku().Sw}})}var Au=()=>o(790748);function Tu({setIsHovered:e}){const[t,n]=(0,o(554283).B)();(0,r.useEffect)((()=>{e(n)}),[n,e]);const i=(0,y().IS)((e=>({container:{display:"inline-flex",alignItems:"center"},icon:{width:14,fill:n?e.icon.secondary:e.icon.tertiary,marginInlineStart:5,marginTop:1}})),[n]);return(0,Ce.jsx)("div",{ref:t,style:i.container,children:(0,o(738418).G)(i.icon)})}var ju=()=>o(964447),Mu=()=>o(267584),Pu=()=>o(30537);const Ru=(0,he().YK)({relation:{defaultMessage:"This relation links to another workspace. Cross-workspace features are limited, so syncing may break and filtering, sorting, and search will not work.",id:"collection.tableHeaderCell.crossSpaceRelationError.message"},formula:{defaultMessage:"This formula links to another workspace. Cross-workspace features are limited, so syncing may break and filtering, sorting, and search will not work.",id:"collection.tableHeaderCell.crossSpaceFormulaError.message"},linkedView:{defaultMessage:"This view references content from another workspace. Cross-workspace functionality is limited, so some content may not sync correctly.",id:"collection.tableHeaderCell.crossSpaceLinkedViewError.message"}}),_u=r.memo((function({type:e}){const t=(0,m().v3)(),n=(0,he().tz)(),i=(0,r.useRef)(null),l=(0,y().IS)((e=>({icon:{fill:e.orange.icon.accentPrimary},text:{width:300,color:e.text.secondary,padding:"12px 16px",fontSize:14},footer:{display:"flex",flexDirection:"row",justifyContent:"space-between",borderTop:`1px solid ${e.border.secondary}`},button:{width:"auto"},dismissButton:{color:e.blue.text.accentPrimary},learnMoreButton:{color:e.text.secondary},learnMoreIcon:{marginInlineEnd:0}})),[]),a=(0,xu().x)("guides.duplicateToSpace"),s=(0,r.useCallback)((()=>(0,Ce.jsxs)(Me().A,{menuType:Fe().gu.Popup,children:[(0,Ce.jsx)(Be().A,{style:l.text,children:n.formatMessage(Ru[e])}),(0,Ce.jsx)(Pe().Ay,{type:Pe().Oh.Vertical,initialFocus:void 0,sections:[{key:"footer",items:[{key:"dismiss",action:()=>{var e;null===(e=i.current)||void 0===e||e.setOpen(!1)},render:e=>(0,Ce.jsx)(Ie().A,{...e,title:(0,Ce.jsx)(he().sA,{defaultMessage:"Dismiss",id:"collection.tableHeaderCell.crossSpaceRelationError.dismiss"}),buttonStyle:{...l.button,...l.dismissButton}})},{key:"learn-more",action:e=>{var o,n,r;null===(o=(n=e.event).preventDefault)||void 0===o||o.call(n),null===(r=i.current)||void 0===r||r.setOpen(!1),(0,xa().navigate)({environment:t,url:a,openInNew:"tab"})},render:e=>(0,Ce.jsx)(Ie().A,{...e,title:(0,Ce.jsx)(he().sA,{defaultMessage:"Learn more",id:"collection.tableHeaderCell.crossSpaceRelationError.learnMore"}),icon:(0,Ce.jsx)(ie().I,{icon:o(721479).questionMarkCircleSmallIcon,size:"sm"}),desktopIconStyle:l.learnMoreIcon,buttonStyle:{...l.button,...l.learnMoreButton},href:a,external:!0})}],render:e=>(0,Ce.jsx)(Be().A,{...e,style:l.footer})}]})]})),[l,n,t,a,e]),c=(0,r.useCallback)((t=>(0,Ce.jsx)(Te().A,{icon:Zc().Q,iconStyle:l.icon,ariaLabel:n.formatMessage(Ru[e]),...t})),[l,n,e]);return(0,Ce.jsx)(Ae().A,{popupType:Pu().n.Popup,render:s,renderOrigin:c,ref:i})}));function Bu(e){const{propertySchema:t}=e,o=Vu({propertySchema:t}),n=(0,y().IS)((()=>({icon:{padding:2,marginInlineStart:5}})),[]);return o?(0,Ce.jsx)(ie().I,{icon:Ja().exclamationMarkTriangleIcon,colorPalette:"yellow",colorVariant:"accentPrimary",style:n.icon}):null}function Vu(e){const{propertySchema:t}=e,o=!(0,h().O$)(v().e);if(!t||!o)return!1;const n="formula"===t.type,r=(0,gr().$M)(t)&&(0,A().O9)((0,gr().om)(t)),i=(0,A().O9)((0,Eo().Dz)(t));return n||r||i}var Eu=()=>o(913687),Fu=()=>o(912720),Ou=()=>o(840094),Du=()=>o(790392);function Lu(e){const{collectionContextStore:t,collectionViewBlockStore:o,property:n,propertySchema:r}=e,i=(0,h().K8)((()=>o.getSpaceId()),[o]),l="button"===(null==r?void 0:r.type)&&(0,A().O9)(r.automation_id)?Du().d.createChildStore(o,{id:r.automation_id,table:Fu().yB,spaceId:i}):void 0;return(0,Ou().cN)({automationStore:l,property:n,propertySchema:r,collectionContextStore:t})}function zu(e){const{collectionContextStore:t,collectionStore:n,collectionViewBlockStore:i,isCrossSpaceFormula:l,isCrossSpaceRelation:a,isHoveringDescriptionIcon:s,property:c,propertySchema:d,render:u,isNameTruncated:p}=e,m=(0,h().K8)((()=>(0,gr().$M)(d)&&(0,gr().om)(d)),[d]),g=void 0!==(null==d?void 0:d.description)&&d.description.length>0,S=(0,o(763870).i)({collectionStore:n,property:c,propertySchema:d}),v=(0,A().O9)(S)&&(0,A().O9)(n),f=Vu({propertySchema:d}),b=(0,A().O9)(m)&&!1!==m&&(0,A().O9)(m.auto_update_on_edit)&&!f,x=Lu({collectionContextStore:t,collectionViewBlockStore:i,property:c,propertySchema:d}),C=Boolean(d.name)&&p||g||v||b||f||x,w=(0,y().IS)((e=>({description:{color:e.text.inverseSecondary},personPropertyPermissionsTooltip:{color:e.text.inverseSecondary},aiUpdate:{color:e.text.inverseSecondary},offlineWarning:{color:e.text.inverseSecondary},buttonError:{color:e.text.inverseSecondary}})),[]),k=(0,r.useCallback)((e=>(0,Ce.jsxs)("div",{...e,style:o(673730).Q$,children:[C?(0,Ce.jsx)("div",{children:d.name}):void 0,g?(0,Ce.jsx)("div",{style:w.description,children:d.description}):void 0,v?(0,Ce.jsx)(o(408839).t,{propertySchema:d,property:c,collectionStore:n,style:w.personPropertyPermissionsTooltip,blockStore:void 0}):void 0,b?(0,Ce.jsx)("div",{style:w.aiUpdate,children:(0,Ce.jsx)(he().sA,{...Eu().A.keptUpToDateWithNotionAITooltip})}):void 0,f?(0,Ce.jsx)("div",{style:w.offlineWarning,children:(0,Ce.jsx)(he().sA,{..."formula"===d.type?Eu().A.offlineWarningFormula:Eu().A.offlineWarningAutoUpdate})}):void 0,x?(0,Ce.jsx)("div",{style:w.buttonError,children:(0,Ce.jsx)(he().sA,{...Eu().A.buttonPropertyErrorTooltip})}):void 0]})),[C,d,g,w.description,w.personPropertyPermissionsTooltip,w.aiUpdate,w.offlineWarning,w.buttonError,n,v,c,b,f,x]);return(0,Ce.jsx)(qo().A,{alignment:"start",tooltipClassName:Vt().StS,disableTooltip:a||l||!C,delayThreshold:s?0:500,renderTooltip:k,render:u})}const Ku=r.memo((function(e){const{allowHidingTitle:t,collectionContextStore:n,collectionViewBlockStore:i,columnIndex:l,disableCellRightBorder:a,disabled:c,format:u,formatKey:p,handleTemporaryNewPropertyInsertion:g,isLast:S,paddingTop:v,property:f,renderSpacer:b,schema:x,width:C}=e,w=(0,m().v3)(),k=x[f],I=(0,y().DP)(),A=(0,o(379771).Q)(f),T=r.useMemo((()=>{if(!A)return null;const e=I.background.primary;return"jira"===A?(0,o(280746).jiraIcon)({width:12,height:12,stroke:e,strokeWidth:1,paintOrder:"stroke fill",vectorEffect:"non-scaling-stroke"}):(0,o(769145).salesforceIcon)({width:12,height:12,stroke:e,strokeWidth:1,paintOrder:"stroke fill",vectorEffect:"non-scaling-stroke"})}),[A,I.background.primary]),j=(0,r.useRef)(null),M=(0,r.useRef)(null),{value:P}=(0,ft().fJ)(Rt().T.formulas),{value:_}=(0,ft().fJ)(Rt().T.formulaConstants),{value:B}=(0,ft().fJ)(Rt().T.formulaPermissions),[V,E]=(0,r.useState)(!1);(0,r.useEffect)((()=>{!function(){const e=M.current;e&&E(e.scrollWidth>e.clientWidth+1)}()}),[C,null==k?void 0:k.name]),(0,Au().b)(o(344482).A,(()=>({collectionContextStore:n,property:f,getNode:()=>j.current})),[n,f]);const F=(0,h().K8)((()=>{var e;return null===(e=n.collectionViewStore())||void 0===e?void 0:e.getCollectionStore()}),[n]),O=(0,Mu().n_)({collectionContextStore:n,property:f,propertySchema:k}),[D,L]=(0,r.useState)(!1),z=(0,r.useCallback)((e=>{L(e)}),[L]),K=(0,h().O$)(n.canConfigureBlockStore),H=(0,h().uB)(void 0,qt().A),W=(0,h().K8)((()=>o(792415).A.state.publicPageData),[]),{frozenIndex:N,isScrolled:G}=(0,h().O$)(n.frozoneStore),$=N===l,U=(0,h().K8)((()=>{var e;if("relation"!==(null==k?void 0:k.type))return!1;const t=null===(e=n.collectionStore())||void 0===e?void 0:e.getSpaceId();return(0,gr().o2)(t,k)}),[n,k]),[{value:q=!1}]=(0,Wl().Yb)((async()=>{var e;if("formula"!==(null==k?void 0:k.type))return!1;const t=n.collectionStore(),r=null===(e=n.collectionStore())||void 0===e?void 0:e.pointer;if(!(t&&r&&P&&_&&B))return!1;const i=t.getSpaceId(),l=(0,br().i)(),a=(0,o(502856).MC)({collectionFeatureGates:l,experimentService:er().default,getRecordModel:t.getRecordModel,loadRecordModel:t.loadRecordModel,spaceIdCreator:w.idCreator.getSpaceIdCreatorSync(i)}),s={type:"block",collection:r},c={kind:_.FormulaContextValueKind.ThisRow,type:s},d={sourceProperty:f,valueTypes:[c],handleDataRequest:a,publicPageDataCollection:{id:null==W?void 0:W.collectionId,schema:null==W?void 0:W.collectionSchema},spaceId:t.getSpaceId(),featureGates:l};return!(await B.hasAccessToProperty({collectionPointer:r,collectionSchema:x,context:d,propertyId:f,hasAccessFn:B.hasSameSpaceAccess}))}),[null==k?void 0:k.type,n,P,_,B,f,null==W?void 0:W.collectionId,null==W?void 0:W.collectionSchema,x,w.idCreator]),X=(0,r.useCallback)((()=>{(0,es().I)({environment:w}),R().IU({environment:w}),(0,o(404779).y)()}),[w]),Y=(0,r.useCallback)((e=>{s().A.isMobile||(e.preventDefault(),(0,d().SQ)({event:e,context:d().y$.EditorContextMenu,callback:()=>{X(),H.setState({open:!0})}}))}),[X,H]),Q=Lu({collectionContextStore:n,collectionViewBlockStore:i,property:f,propertySchema:k}),Z=(0,y().IS)((e=>({container:{display:"flex",flexShrink:0,overflow:"hidden",fontSize:14,padding:0,width:C,borderInlineEnd:a?void 0:`1px solid ${e.border.secondaryTranslucent}`,background:O?"dark"===e.mode?"rgba(255, 255, 255, 0.045)":"rgba(55, 53, 47, 0.03)":void 0},button:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingInlineStart:8,paddingInlineEnd:8,paddingTop:v},buttonHovered:{background:e.tableRowHoveredBackground},property:{fontSize:14,flex:"1 1 auto",...s().A.isMobile&&{fontSize:15,color:e.text.tertiary}},icon:{...s().A.isMobile&&{fill:e.text.tertiary}},buttonErrorIcon:{width:14,height:14,marginInlineStart:5,fill:e.icon.secondary},menuWrapper:{marginInlineStart:-6}})),[C,a,v,O]),J=(0,r.useCallback)(((e,t)=>{var r;return k?(0,Ce.jsxs)(Ro().Ay,{style:Z.button,hoveredStyle:Z.buttonHovered,disabled:c,...(0,ol().A)(e,t),children:[b?b(S):void 0,(0,Ce.jsx)(Xo().mA,{property:f,propertySchema:k,textRef:M,showIcon:!0,iconStyle:Z.icon,showIntegrationIconOverlay:T,badge:(0,Ce.jsxs)(Ce.Fragment,{children:[F?(0,Ce.jsx)(o(897941).$,{collectionStore:F,property:f,propertySchema:k,blockStore:void 0}):void 0,"button"===k.type&&Q?(0,Zc().Q)(Z.buttonErrorIcon):void 0,Boolean(null===(r=k.description)||void 0===r?void 0:r.length)&&!s().A.isMobile?(0,Ce.jsx)(Tu,{setIsHovered:z}):void 0,(0,Ce.jsx)(Xo().Jv,{propertySchema:k}),(0,Ce.jsx)(o(534239).Zr,{propertyId:f,propertySchema:k,collectionContextStore:n}),(0,Ce.jsx)(o(367424).D,{propertySchema:k}),(0,Ce.jsx)(Bu,{propertySchema:k})]}),style:Z.property}),U?(0,Ce.jsx)(_u,{type:"relation"}):void 0,q?(0,Ce.jsx)(_u,{type:"formula"}):void 0,$?(0,Ce.jsx)(hu,{isCollectionViewBlockSelected:!1,passesFilter:!0,isScrolled:Boolean(G)}):void 0]}):null}),[k,Z.button,Z.buttonHovered,Z.icon,Z.buttonErrorIcon,Z.property,c,b,S,F,f,Q,z,n,U,q,$,G,T]),ee=(0,r.useCallback)((e=>k?(0,Ce.jsx)(zu,{collectionContextStore:n,collectionViewBlockStore:i,collectionStore:F,propertySchema:k,property:f,isCrossSpaceRelation:U,isCrossSpaceFormula:q,isHoveringDescriptionIcon:D,isNameTruncated:V,render:t=>J(t,e)}):null),[n,F,i,q,U,D,f,k,J,V]),te=(0,r.useCallback)((e=>(0,Ce.jsx)(gu().$m,{allowHidingTitle:t,collectionContextStore:n,handleTemporaryNewPropertyInsertion:g,columnIndex:l,format:u,formatKey:p,parent:e,property:f,schema:x})),[t,n,g,l,u,p,f,x]);return k?(0,Ce.jsxs)("div",{ref:j,style:Z.container,className:Vt().P2l,onContextMenu:Y,children:[(0,Ce.jsx)(ju().dT,{origin:j,store:n}),(0,Ce.jsx)(Ae().A,{popupType:s().A.isMobile?_e().nl.BottomSheet:_e().nl.Popup,bottomSheetInitialState:"half",disabled:!K,originGap:0,popupWrapStyle:Z.menuWrapper,alignmentToOrigin:"start",buttonPopupStore:H,renderOrigin:ee,render:te,onClick:X})]}):null}));var Hu=()=>o(708685);const Wu={position:"absolute",insetInlineEnd:0,width:0,flexGrow:0,zIndex:1},Nu=r.memo((function({leftFormat:e,height:t,onTemporaryResize:n,onAccept:i,onCancel:l,propertySchema:a,resultStore:s}){const c=(0,r.useRef)(void 0),{isPhone:d}=(0,m().Y0)(),[u,p]=(0,r.useState)(!1),[g,S]=(0,r.useState)(!1),h=!d&&(g||u),y=(0,r.useCallback)((t=>{const o=c.current;if(!o||!o.width)return;const n=Math.max(o.width+t.diffX*((0,Md().A1)()?-1:1),qu(a,e,o.width,t.optionKey));return{...o,width:n}}),[e,a]),v=(0,r.useCallback)((t=>{t.preventDefault(),c.current=e,S(!0)}),[e]),f=(0,r.useCallback)((e=>{const t=y(e);t&&n(t)}),[y,n]),b=(0,r.useCallback)((e=>{const t=y(e);t&&i(t),S(!1)}),[y,i]),x=(0,r.useCallback)((()=>{l(),c.current=void 0,S(!1)}),[l]),C=(0,r.useCallback)((t=>{const n=s.state?s.state.blockIds:[],r=I().oE(n.map((t=>{const n=o(57618).A.findBlockPropertyValueByBlockId(t,e.property),r=null==n?void 0:n.getNode();if(r)return function(e){const t=e.cloneNode(!0);let o=!1;"relative"===(null==e?void 0:e.style.position)&&(e.style.position="unset",o=!0);const n=getComputedStyle(e);for(let l=0;l<n.length;l++){const e=n[l],o=n.getPropertyValue(e);t.style[e]=o}o&&(e.style.position="relative");t.id="notion-table-view-cell-shadow",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.width="auto",t.style.opacity="0",t.style.display="flex",t.style.position="absolute";const r=t.querySelectorAll("*");for(const l of r)l.style&&(l.style.pointerEvents="none",l.style.width="auto");document.body.appendChild(t);const i=t.getBoundingClientRect();return t.remove(),null!=i&&i.width?Math.ceil(i.width)+1:void 0}(r)})));if(e.width){const t={...e,width:Math.min(800,Math.max(Math.max(...r),qu(a,e,e.width)))};i(t)}}),[e,i,a,s]),w=(0,r.useCallback)((e=>(0,Ce.jsx)("div",{style:h?Yu(t):Xu(t),onDoubleClick:C,...e})),[C,t,h]);return(0,Ce.jsx)("div",{style:Wu,onMouseMove:()=>p(!0),onMouseLeave:()=>p(!1),children:(0,Ce.jsx)(Jc().A,{onDraggableDragStart:v,onDraggableDragMove:f,onDraggableDragEnd:b,onDraggableDragCancel:x,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:w})})}));const Gu=32,$u=64,Uu=100;function qu(e,t,o,n=!1){if(n)return Gu;const r=function(e,t){var o;if("checkbox"===(null==e?void 0:e.type))return Gu;if("status"===(null==e?void 0:e.type)&&"checkbox"===t.statusShowAs)return Gu;if(("number"===(null==e?void 0:e.type)||"formula"===(null==e?void 0:e.type)&&"number"===(0,Hu().getFormulaPropertySchemaResultType)(e))&&"ring"===(null==e||null===(o=e.show_as)||void 0===o?void 0:o.type))return Gu;if("auto_increment_id"===(null==e?void 0:e.type))return $u;return Uu}(e,t);return o&&o<r?Gu:r}function Xu(e){return{width:5,marginInlineStart:-3,marginTop:-1,height:e,transition:"background 200ms ease-out",background:_i().IF.blueWithAlpha(0),cursor:"col-resize"}}function Yu(e){return{...Xu(e),background:_i().IF.blueWithAlpha(.8)}}const Qu=r.memo((function({store:e,collectionContextStore:t,schema:n,query:i,disabled:l,formatKey:a,disableCellRightBorder:s,renderSpacer:c,allowHidingTitle:d,paddingTop:u,showRightActions:p,showPropertyFormats:g,resultStore:S,format:v,tableStore:f,height:b,groupsPointer:x,property:C,index:w,isLast:k}){const I=(0,m().v3)(),{isMobile:A,isPhone:j}=(0,m().Y0)(),M=(0,r.useRef)(null),P=(0,h().K8)((()=>f.getCurrentFormat(v)),[v,f],{useDeepEqual:!0}),R=g[w],{wikiOnboardingPhase:B,showWikiTooltip:V}=(0,h().K8)((()=>{var r,i,l,a;const s=fu().WH(),c="notion://wiki_collection"===(null===(r=t.collectionStore())||void 0===r?void 0:r.getFormatStore().getKeyStore("app_config_uri").getValue())&&e.isCollectionViewPageWithContent()&&e.id===(null===(i=t.collectionViewBlockStore())||void 0===i?void 0:i.id),d=c&&("notion://wiki/owner_property"===C||C===o(931075)._e.Owner)&&"owner"===s,u=c&&"verification"===(null===(l=n[C])||void 0===l?void 0:l.type)&&"verification"===s,p=c&&"multi_select"===(null===(a=n[C])||void 0===a?void 0:a.type)&&"tags"===s;return{wikiOnboardingPhase:s,showWikiTooltip:!A&&(d||u||p)}}),[t,A,C,n,e]),E=(0,h().K8)((()=>s||k&&!(0,Qd().fz)(l,p)),[s,l,k,p]),F=(0,h().K8)((()=>(0,z().oe)({environment:I,propertyFormat:R})),[I,R]),O=(0,h().K8)((()=>{const e=f.getCurrentFormat(P);return f.getCurrentProperties(a,e)}),[P,a,f],{useDeepEqual:!0}),D=(0,r.useCallback)(((e,t)=>{const o=f.getCurrentFormat(P),n={property:Kn().uR,width:Kn().XJ,visible:!0},r=[...f.getCurrentProperties(a,o)];"left"===e?r.splice(w,0,n):r.splice(w+1,0,n);const i={...o,[a]:r},l=x.length>0?x[0].value:void 0;return t&&f.setState({...f.state,temporaryFormat:i,showNewPropertyMenuForGroup:l}),r}),[f,P,a,w,x]),L=(0,r.useCallback)((()=>{f.setState({...f.state,temporaryFormat:void 0,showNewPropertyMenuForGroup:void 0})}),[f]),K=(0,r.useCallback)((e=>{const t=f.getCurrentFormat(P),o=f.getCurrentProperties(a,t).map((t=>t.property===e.property?e:t)),n={...t,[a]:o};f.setState({...f.state,temporaryFormat:n})}),[f,a,P]),H=(0,r.useCallback)((e=>{const o=t.collectionViewStore();if(!o)return;const n=f.getCurrentFormat(P),r=f.getCurrentProperties(a,P).map((t=>t.property===e.property?e:t)),i={...n,[a]:r};_().createAndCommit({userAction:"TableHeaderRow.handleColumnResizeAccept",environment:I,canUndo:!0,perform:e=>{(0,Bi().F)({collectionViewStore:o,update:{format:i},transaction:e})}}),f.setState({...f.state,temporaryFormat:void 0}),(0,T().X)({environment:I,collectionContextStore:t,action:"table_resize_columns"})}),[t,I,P,a,f]),W=(0,r.useCallback)((()=>{f.setState({...f.state,temporaryFormat:void 0})}),[f]),N=(0,y().IS)((()=>({container:{display:"flex",position:"relative"}})),[]),G=(0,h().K8)((()=>{const e=x.length>0?x[0].value:void 0;return!f.state.showNewPropertyMenuForGroup||f.state.showNewPropertyMenuForGroup===e}),[f,x]);return(0,Ce.jsxs)("div",{style:N.container,ref:V?M:null,children:[V?(0,Ce.jsx)(Iu,{origin:M,propertyType:B}):void 0,C===Kn().uR?(0,Ce.jsx)(_e().Ay,{popupType:_e().nl.Popup,popupWrapStyle:{boxShadow:"none",overflow:void 0,background:"none"},open:G,origin:(0,Ce.jsx)("div",{style:{width:Kn().XJ,height:32}}),onDismiss:L,alignmentToOrigin:"start",trapFocus:!0,render:()=>(0,Ce.jsx)(bu().FZ,{collectionContextStore:t,collectionSettingsStore:t.settingsStore,handleClosePopup:L,newPropertyFormat:O})}):F?(0,Ce.jsx)(Ku,{format:P,schema:n,query:i,property:C,handleTemporaryNewPropertyInsertion:D,width:F,collectionViewBlockStore:e,collectionContextStore:t,disabled:l,formatKey:a,isLast:k,disableCellRightBorder:E,allowHidingTitle:d,renderSpacer:c,paddingTop:u,columnIndex:w,groupsPointer:x}):null,l||j?void 0:(0,Ce.jsx)(Nu,{leftFormat:R,onTemporaryResize:K,onAccept:H,onCancel:W,height:b,propertySchema:n[C],resultStore:S})]},C)})),Zu=f().Store.createClass(void 0,{name:"ReducerResultStore"}),Ju=r.memo((function({allowHidingTitle:e,children:t,collectionContextStore:n,disabled:i,disableHorizontalEdgeScroll:l,disableTopBorder:a,format:s,formatKey:c,frozoneProps:d,groupFormat:u,hasMoreReducerResults:p,height:m,isInHomeWidget:g,isInPeekRenderer:S,minWidth:v,paddingLeft:f,paddingRight:b,paddingTop:x,query:C,renderSpacer:w,resultStore:k,schema:I,showHoverActionsStore:A,showPropertyFormats:T,showRightActions:j,store:M,tableStore:P}){const R=(0,r.useRef)(null),_=(0,re().X)("client_rtl_support"),B=(0,h().K8)((()=>(0,W().f5)({collectionContextStore:n})),[n]),V=(0,h().O$)(n.canConfigureBlockStore),E=(0,h().K8)((()=>n.permissionScopesStore.state.canConfigureCollection),[n]),F=(0,h().uB)(k,Zu),O=(0,r.useMemo)((()=>u?[u]:[]),[u]),D=(0,r.useMemo)((()=>(0,Qd().fz)(i,j)&&(E||V)),[i,j,E,V]),L=(0,h().K8)((()=>!!A&&A.state),[A]),z=(0,h().K8)((()=>{var e;return null===(e=n.collectionViewStore())||void 0===e?void 0:e.getType()}),[n]),K=(0,h().O$)(n.isUnlistedViewStore),H=(0,re().X)("adoption_enable_ai_property_suggestion"),N=(0,W().Oz)(n),G=(0,y().IS)((e=>{const t=g?"transparent":K?e.background.elevated:(null==N?void 0:N.background)||(S?e.background.elevated:e.background.primary);return{buttonContainer:{display:"flex",justifyContent:"center",alignItems:"center",height:Kn().sH},headerRow:{display:"flex",background:t,zIndex:87,height:m,color:e.text.secondary,boxShadow:`calc(var(--direction, 1) * -3px) 0 0 ${t}, inset 0 -1px 0 ${e.border.secondaryTranslucent}${a?"":`, inset 0 1px 0 ${e.border.secondaryTranslucent}`}`,minWidth:v,insetInlineStart:"timeline"===z?void 0:0,insetInlineEnd:"timeline"===z?void 0:0,position:"relative",boxSizing:"border-box"},stickyStyle:{paddingInlineStart:f,paddingInlineEnd:b,minWidth:v,background:t,borderInlineEnd:"timeline"===z?`1px solid ${e.border.secondaryTranslucent}`:void 0,"--timeline-box-shadow":"timeline"===z?"0px":void 0},transitionStickyStyle:{..."timeline"===z?{borderInlineEnd:void 0}:{}}}}),[g,m,a,v,z,f,b,K,S,null==N?void 0:N.background]);return(0,Ce.jsx)(ki().g,{stickyAttachPoint:g?"no-stick":"ceiling",absoluteHeight:m,nodeRef:R,stickyStyle:G.stickyStyle,transitionStickyStyle:G.transitionStickyStyle,children:(0,Ce.jsxs)("div",{className:Vt().FYj,style:G.headerRow,dir:_&&(0,Md().A1)()?"rtl":"ltr",ref:R,children:[B?(0,Ce.jsx)(vu,{groupsPointer:O,collectionContextStore:n,frozoneProps:d,hasMoreReducerResults:Boolean(p)}):void 0,(0,Ce.jsx)(ep,{showRightActions:j,store:M,collectionContextStore:n,schema:I,query:C,disabled:i,formatKey:c,disableCellRightBorder:!0,renderSpacer:w,allowHidingTitle:e,paddingTop:x,frozoneProps:d,disableTopBorder:a,backgroundColor:G.headerRow.background,disableHorizontalEdgeScroll:l,showPropertyFormats:T,format:s,height:m,tableStore:P,groupsPointer:O,resultStore:F}),(0,Ce.jsxs)(ke().A,{visible:D,animate:{opacity:L?1:0},style:G.buttonContainer,children:[E?H?(0,Ce.jsx)(gu().rJ,{collectionContextStore:n}):(0,Ce.jsx)(o(928196).L,{collectionContextStore:n}):null,V?(0,Ce.jsx)(Su,{collectionContextStore:n}):null]}),t]})})})),ep=r.memo((function({allowHidingTitle:e,backgroundColor:t,collectionContextStore:o,disableHorizontalEdgeScroll:n,disableTopBorder:i,disabled:l,format:a,formatKey:s,frozoneProps:c,groupsPointer:d,height:u,paddingTop:p,query:g,renderSpacer:S,resultStore:v,schema:f,showPropertyFormats:b,showRightActions:x,store:C,tableStore:w}){const k=(0,m().v3)(),A=(0,h().O$)(o.canConfigureBlockStore),j=(0,h().O$)(o.isInHomeWidgetStore),{frozenIndex:M,unfrozenIndexAddendum:P,stickyLeft:R}=(0,r.useMemo)((()=>{const e=null==c?void 0:c.frozenIndex;return{frozenIndex:e,unfrozenIndexAddendum:(0,W().qi)(e),stickyLeft:null==c?void 0:c.frozenStyles.insetInlineStart}}),[null==c?void 0:c.frozenIndex,null==c?void 0:c.frozenStyles.insetInlineStart]),{showProperties:B,frozenShowProperties:V,unfrozenShowProperties:E}=(0,r.useMemo)((()=>{const e=b.map((e=>e.property)),[t,o]=[e.slice(0,P),e.slice(P)];return{showProperties:e,frozenShowProperties:t,unfrozenShowProperties:o}}),[b,P]),F=(0,r.useCallback)((e=>{const t=o.collectionViewStore();if(!t)return;const n=w.getCurrentFormat(a),r=I().Ul(w.getCurrentProperties(s,a),(t=>{const o=e.indexOf(t.property);return o>=0?o:1/0})),i={...n,[s]:r};_().createAndCommit({userAction:"TableHeaderRow.handleColumnReorder",environment:k,canUndo:!0,perform:e=>{(0,Bi().F)({collectionViewStore:t,update:{format:i},transaction:e})}}),(0,T().X)({environment:k,collectionContextStore:o,action:"table_reorder_columns"})}),[o,k,a,s,w]),O=(0,y().IS)((e=>({flex:{display:"flex"},frozenStyle:{display:"flex",...null==c?void 0:c.frozenStyles,insetInlineStart:j?Kn().hj:R??0,boxShadow:`calc(var(--direction, 1) * -3px) 0 0 ${t}, inset 0 -1px 0 ${e.border.secondaryTranslucent}${i?"":`, inset 0 1px 0 ${e.border.secondaryTranslucent}`}`}})),[t,i,null==c?void 0:c.frozenStyles,j,R]),D=(0,r.useMemo)((()=>({frozen:V,unfrozen:E})),[V,E]),L=(0,r.useMemo)((()=>({frozen:O.frozenStyle,unfrozen:{display:"flex"}})),[O.frozenStyle]),z=(0,r.useCallback)(((t,n,r)=>(0,Ce.jsx)(Qu,{collectionContextStore:o,store:C,schema:f,query:g,disabled:l,format:a,formatKey:s,allowHidingTitle:e,showPropertyFormats:b,resultStore:v,showRightActions:x,disableCellRightBorder:!0,renderSpacer:S,paddingTop:p,tableStore:w,groupsPointer:d,height:u,property:t,index:n,isLast:r},t)),[e,o,l,a,s,d,u,p,g,S,v,f,b,x,C,w]);return l||!A?(0,Ce.jsxs)("div",{style:Vs().Z0,children:[(0,Ce.jsx)("div",{style:O.frozenStyle,children:V.map(((e,t)=>z(e,t,t===B.length-1)))}),E.map(((e,t)=>z(e,t+P,t===B.length-1)))]}):(0,W().Eh)(M)?(0,Ce.jsx)(mu,{style:O.flex,direction:"horizontal",keys:B,sectionedKeys:D,sectionStyles:L,renderKey:z,onDrop:F,disableHorizontalEdgeScroll:n}):(0,Ce.jsx)(Vs().Ay,{direction:"horizontal",keys:B,renderKey:z,onDrop:F,disableHorizontalEdgeScroll:n})}));function tp(e){const{children:t,isCollectionViewBlockSelected:o,passesFilter:n,shouldFreeze:r}=e,i=(0,y().IS)((()=>({container:{display:"flex",background:o&&n?_i().IF.blueWithAlpha(.14):void 0}})),[o,n]);return r?(0,Ce.jsx)(ke().A,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:i.container,children:t},"halo"):(0,Ce.jsx)(Ce.Fragment,{children:t})}var op=()=>o(828634);function np({store:e,collectionContextStore:t,children:o,anyWrapping:n}){return(0,Gd().DV)()&&n?(0,Ce.jsx)(rp,{store:e,collectionContextStore:t,children:o}):(0,Ce.jsx)("div",{style:{display:"flex"},children:o})}function rp({store:e,collectionContextStore:t,children:o}){const n=(0,m().WS)(),i=(0,r.useRef)(null),l=(0,r.useRef)(null),a=t.virtualizedModule.getBlockHeightsCache(),s=(0,h().O$)(a.getBlockHeightStore(e.id)),c=(0,r.useCallback)((()=>{a.expandHeightToTallestCached(e.id)}),[a,e]);(0,op().tK)(0===s?i:l,c);const d=(0,y().IS)((()=>{const e=n?Kn().Um:Kn().tt;return{row:{display:"flex",...s?{height:Math.max(s,e),overflowY:"clip"}:{}}}}),[s,n]);return(0,Ce.jsx)("div",{ref:i,style:d.row,children:o})}var ip=()=>o(871399);const lp=r.memo((function(e){const{store:t,passesFilter:o,canEdit:n,frozoneProps:i}=e,l=(0,gt().ET)(),a=(0,m().v3)(),s=(0,h().K8)((()=>bt().default.state.stores.includes(t)),[t]),c=(0,h().K8)((()=>{var e;return ip().default.state.isOpen&&(null===(e=ip().default.state.currentStore)||void 0===e?void 0:e.id)===t.id}),[t]),d=(0,r.useCallback)((e=>{var o;(0,z().ut)({collectionViewBlockId:null===(o=l.collectionViewBlockStore())||void 0===o?void 0:o.id})?R().td({environment:a,stores:[t]}):R().Lt({environment:a,store:t,selectMode:R().gj()?R().SB.MULTI_SELECT_FROM_BOUNDARY:R().SB.TOGGLE}),e.stopPropagation()}),[l,a,t]),u=(0,h().K8)((()=>n||l.isLibraryBlock()),[n,l]);return(0,Ce.jsx)(yu,{checkedState:s,onClick:d,checkboxType:"single_row",collectionContextStore:l,isBlockHovered:c,frozoneProps:i,passesFilter:o,disabled:!u})}));function ap(e,t){const n=(0,gt().Ks)(),{schema:r,viewType:i}=(0,h().K8)((()=>{var e;return{schema:null==n||null===(e=n.collectionStore())||void 0===e?void 0:e.getSchema(),viewType:null==n?void 0:n.getViewType()}}),[n]),l=(0,re().X)("collection_view_conditional_colors_property_level"),{value:a}=(0,ft().fJ)(Rt().T.formulas),s=(0,h().K8)((()=>{var o,r;if(l&&e&&n)return null===(o=n.conditionalColorStore((0,br().i)()))||void 0===o||null===(o=o.state)||void 0===o?void 0:o.getPropertyConditionalColor({blockStore:e,propertyId:t,propertyMapping:null===(r=n.collectionStore())||void 0===r?void 0:r.getPropertyMapping(),formulasModule:a})}),[e,n,l,t,a]);return(0,o(186348).h)({conditionalColor:s,store:e,schema:r,viewType:i})}var sp=()=>o(579372),cp=()=>o(923925);const dp={AIFillNoseyOverlay:new(ft().O2)("AIFillNoseyOverlay",(()=>o.e(59764).then(o.bind(o,190696))))},up=(0,ft()._h)(dp.AIFillNoseyOverlay,(e=>e.AIFillNoseyOverlay)),pp=r.memo((function(e){const{toggleButton:t,subitemPath:o,shouldShowMultiSelectCheckbox:n,propertyIndex:r}=e,i=(0,y().IS)((()=>{const e=(null==o?void 0:o.length)??0,t=Math.max((e-1)*vt().yy,0)+vt().Pi,i=s().A.isMobile?Kn().Um:Kn().tt;return{hiddenContainer:{minWidth:t+vt().yy,...0===r&&n&&{marginInlineStart:-8,marginInlineEnd:4}},buttonContainer:{display:"flex",marginTop:(i-vt().yy)/2,...0===r&&n&&{marginInlineStart:-8,marginInlineEnd:0,gap:4}},width:{width:t}}}),[r,n,null==o?void 0:o.length]);return t?(0,Ce.jsxs)("div",{style:i.buttonContainer,children:[(0,Ce.jsx)("div",{style:i.width}),t]}):(0,Ce.jsx)("div",{style:i.hiddenContainer})})),mp=(0,ft()._h)(sp().C,(e=>e.DatabaseOnboardingTourtip)),gp=r.memo((function(e){const{blockPropertyValueOverlayStore:t,canEdit:n,collectionStore:i,collectionViewStore:l,disableCellBorderRight:a,disabled:s,disableHorizontalEdgeScroll:c,disableLastCellBorderRight:d,forceMouseEntered:u,groupFormat:p,handleOpenPeekPage:g,hasColumnVirtualizer:S,index:f,isCollectionViewBlockSelected:b,isLastColumn:x,isLocked:C,isRightMostFrozenColumn:w,isScrolled:k,isSubitemToggleOnTitleColumn:T,normalizedTableSelection:j,onOpenProperty:M,onPropertyBgClick:P,onPropertyClick:R,onPropertyContextMenu:_,onPropertyEnter:B,onPropertyEsc:V,onPropertyTab:E,onPropertyUntab:F,onShiftEnter:O,passesFilter:D,propertyFormat:L,rowIndex:K,schema:H,shouldCaptureKeyboard:W,shouldSetCellHeight:N,shouldShowMultiSelectCheckbox:G,store:$,subitemFormat:U,subitemPath:q,tableWrap:X,titleColumnIndex:Y,toggleButton:Q}=e,{property:Z,wrap:J}=L,ee=(0,r.useRef)(null),te=(0,m().v3)(),oe=(0,he().tz)(),ne=(0,re().X)("table_row_value_tooltip"),ie=(0,gt().ET)(),le=(0,h().K8)((()=>(0,z().oe)({environment:te,propertyFormat:L})),[te,L]),ae=(null==q?void 0:q.length)??0,se=U&&(0,z().BC)({columnIndex:f,titleColumnIndex:Y,isSubitemToggleOnTitleColumn:T}),ce=(0,r.useMemo)((()=>{if(void 0!==le){if(se){const e=(0,z().si)({columnIndex:f,indentLevel:ae,titleColumnIndex:Y,isSubitemToggleOnTitleColumn:T});return le-e}return le}}),[ae,f,T,se,Y,le]),de=s||!n,ue=!(0,h().O$)(v().e),pe=(0,Eo()._g)({schema:H,property:L.property}),me=(0,re().X)("collection_view_conditional_colors_property_level"),{background:ge}=ap($,Z)??{},Se=(0,Mu().n_)({collectionContextStore:ie,property:Z,propertySchema:pe}),ye=ue&&(0,A().O9)(pe)&&(0,Wo().$)({propertyType:pe.type,propertySchema:pe,allowAIProperty:!0}),[ve,fe]=(0,h().K8)((()=>{const e=ie.collectionViewBlockStore();if(!e)return[!1,!1];const t=Zd().A.state;if(!t.isActive||!(0,Zd().g)(t.selectionKey,{collectionViewBlockStore:e,groupFormat:p})||!j)return[!1,!1];const o=j,{start:n,end:r}=o,i=K===n.row||K===r.row||I().r4(K,n.row,r.row),l=f===n.col||f===r.col||I().r4(f,n.col,r.col);return[i&&l,K===n.row&&f===n.col]}),[ie,p,f,j,K]),be=(0,h().K8)((()=>{const e=ie.frozoneStore.state.frozenIndex;return void 0!==e&&f<=e}),[ie,f]),xe=(0,o(736230).V)({collectionContextStore:ie,blockId:$.id,property:Z,featureEnabled:S}),we=(0,h().K8)((()=>{if(!ne)return;const e=ie.permissionScopesStore.state;if(!(!n&&!e.canEditContent&&!X&&!J&&["text","title"].includes((null==pe?void 0:pe.type)??"")))return;const t=$.getPropertyValue(Z);if(!t||0===t.length)return;const r=(0,o(450648).r4)({textValue:t,getRecordModel:$.getRecordModel,userTimeZone:(0,Sr().P)(),intl:oe});return 8*r.trim().length>((ce?ce-16:void 0)??0)?r.trim():void 0}),[n,ie,ce,oe,ne,Z,null==pe?void 0:pe.type,J,$,X]),ke=(0,cp().f)({tutorialType:"database_onboarding",stepType:"database_onboarding_status_property_tooltip",additionalChecks:e=>"database_onboarding_status_property_tooltip"===(null==e?void 0:e.stepType)&&(null==e?void 0:e.databasePageId)===$.id&&(null==e?void 0:e.statusPropertyId)===Z}),Ie=(0,cp().f)({tutorialType:"database_onboarding",stepType:"database_onboarding_database_page_tooltip",additionalChecks:e=>"database_onboarding_database_page_tooltip"===(null==e?void 0:e.stepType)&&(null==e?void 0:e.databasePageId)===$.id&&0===f}),Ae=ke||Ie,Te=(0,r.useCallback)((()=>{R($,Z,H)}),[R,Z,H,$]),je=({isWithinFrozenColumns:e,isCollectionViewBlockSelected:t,theme:o})=>e&&t?o.tableFrozenSelectedDividerColor:o.border.secondaryTranslucent,Me=(0,re().X)("do_not_reduce_opacity_on_collection_table_borders"),Pe=(0,y().IS)((e=>{const t=me?ge:void 0;let o;return o=void 0!==t?Se?(0,La().e0)(t,"dark"===e.mode?.04:-.04):t:Se?"dark"===e.mode?"rgba(255, 255, 255, 0.045)":"rgba(55, 53, 47, 0.03)":void 0,{tableCell:{display:"flex",width:le||void 0,height:xe?void 0:"100%",position:"relative",borderInlineEnd:a||w||x&&d?"none":`1px solid ${je({isWithinFrozenColumns:be,isCollectionViewBlockSelected:b,theme:e})}`,opacity:ye?.4:1,background:o,borderBottom:me?`1px solid ${e.border.secondaryTranslucent}`:void 0},tableSelectionOverlay:{borderRadius:fe?2:void 0,background:ve?_i().IF.blueWithAlpha(.07):void 0,boxShadow:fe?`inset 0 0 0 2px ${e.simpleTableSelectionBorder}`:void 0,position:"absolute",pointerEvents:"none",top:0,height:"100%",zIndex:84,width:"100%",insetInlineStart:0},propertyValueContainer:{display:"flex",overflowX:"clip",height:"100%",width:ce||void 0,opacity:!D&&Me?.5:1,color:Se?e.text.secondary:void 0},tourtip:{boxShadow:e.buttonBlueFocusRing,borderRadius:4}}}),[le,xe,a,w,x,d,be,b,ye,ve,fe,ce,D,Me,ge,Se,me]),Re=(0,Ce.jsxs)(Je().N,{debugName:"TableRow",capture:W,onShiftEnter:O,children:[(0,Ce.jsx)(Ya().BlockPropertyRouter,{collectionStore:i,store:$,property:Z,disabled:de,locked:C,width:ce,surface:"table",forceMouseEntered:!!Ie||u,tableWrap:Boolean(X||J),isLast:x,indentLevel:0===f&&q?q.length:void 0,onTab:E,onUntab:F,onEnter:B,onClick:Te,onEsc:V,onBgClick:P,onContextMenu:_,collectionViewStore:l,shouldSetCellHeight:N,onOpenProperty:M,blockPropertyValueOverlayStore:t,disableHorizontalEdgeScroll:c,handleOpenPeekPage:g,propertyIndex:f,shouldShowMultiSelectCheckbox:G},Z),w?(0,Ce.jsx)(hu,{isCollectionViewBlockSelected:b,passesFilter:D,isScrolled:k}):void 0]}),_e=(0,r.useRef)(null),Be=(0,Ce.jsxs)("div",{ref:_e,className:Vt().WvK,"data-row-index":K,"data-col-index":f,style:Pe.tableCell,children:[se?(0,Ce.jsx)(pp,{subitemFormat:U,toggleButton:Q,subitemPath:q,shouldShowMultiSelectCheckbox:G,propertyIndex:f}):null,(0,Ce.jsx)("div",{style:Pe.propertyValueContainer,children:Re}),ve?(0,Ce.jsx)("div",{style:Pe.tableSelectionOverlay}):void 0,(0,Ce.jsx)(up,{rowStore:$,property:Z,collectionStore:i})]});return we?(0,Ce.jsx)(qo().A,{placement:"top",renderTooltip:()=>we,render:e=>(0,Ce.jsx)("div",{...e,children:Be}),textWrap:!0}):Ae?(0,Ce.jsxs)("div",{ref:ee,style:Pe.tourtip,children:[(0,Ce.jsx)(mp,{contentRef:ee,tutorialStepId:ke?"database_onboarding_status_property_tooltip":"database_onboarding_database_page_tooltip",type:"database_onboarding"}),Be]}):Be})),Sp=r.memo((function(e){const{blockPropertyValueOverlayStore:t,propertyFormats:o,propertyFormatsMap:n,visiblePropertiesLength:r,store:i,tableWrap:l,shouldSetCellHeight:a,indexAddendum:s,frozoneProps:c,normalizedTableSelection:d,canEdit:u,isInHomeWidget:p,...m}=e,g=(0,gt().ET)(),S=(0,h().K8)((()=>g.collectionViewStore()),[g]),y=(0,h().K8)((()=>W().Dj({store:i,collectionContextStore:g})),[i,g]),v=(0,h().K8)((()=>!t.state.isOpen&&bt().default.state.stores.length>0&&bt().default.state.stores[0].id===i.id),[i.id,t]),f=(0,h().O$)(g.currentSubitemFormatStoreForUiDisplayStore),b=(0,h().K8)((()=>"title"===(null==S?void 0:S.getFormatStore().getKeyStore("table_subitem_toggle_column").getValue())),[S]),x=(0,h().K8)((()=>g.frozoneStore.state.frozenIndex),[g]),C=(0,h().K8)((()=>{if(!u)return;if(p)return;if(g.isInlineViewStore.state&&g.isUnlistedViewStore.state)return;const e=ip().default.state;return Boolean(e.isOpen&&e.currentStore===i)}),[u,g,p,i]),w=r??o.length;return(0,Ce.jsx)(Ce.Fragment,{children:o.map(((e,o)=>{const r=(null==n?void 0:n[o])??o+(s??0);return(0,Ce.jsx)(gp,{index:r,store:i,propertyFormat:e,isLastColumn:r===w-1,isRightMostFrozenColumn:x===r,collectionViewStore:S,collectionStore:y,tableWrap:l,shouldSetCellHeight:a,forceMouseEntered:"title"===e.property?C:void 0,shouldCaptureKeyboard:v,subitemFormat:f,isSubitemToggleOnTitleColumn:b,blockPropertyValueOverlayStore:t,isScrolled:(null==c?void 0:c.isScrolled)??!1,normalizedTableSelection:d,canEdit:u,isInHomeWidget:p,...m},e.property)}))})})),hp=r.memo((function({propertyFormats:e,...t}){const{propertiesInRange:o,propertiesInRangeIndices:n,beforeWidth:r,afterWidth:i}=(0,Gd().UB)();return(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)("div",{style:{width:`${r}px`}}),(0,Ce.jsx)(Sp,{...t,propertyFormats:o,propertyFormatsMap:n}),(0,Ce.jsx)("div",{style:{width:`${i}px`}})]})})),yp=r.memo(r.forwardRef((function(e,t){const{disabled:o,store:n,groupFormat:i,collectionContextStore:l,propertyFormats:a,frozoneProps:s,shouldShowMultiSelectCheckbox:c,isLast:d,isInHomeWidget:u,isCollectionViewBlockSelected:p,allRows:g,isInEphemeralView:S,normalizedTableSelection:v,unfrozenIndexAddendum:f,frozenPropertyFormats:b,unfrozenPropertyFormats:x,tableWrap:C,shouldSetCellHeight:w,isNonEditable:k,shouldShowRightActionSpacer:I,...A}=e,{handleOpenPeekPage:T}=e,j=Boolean(e.passesFilter),M=(0,r.useRef)(null),P=(0,m().v3)(),R=(0,h().K8)((()=>!o&&n.canEdit()),[o,n]),_=(0,r.useMemo)((()=>g.findIndex((e=>e===n))),[g,n]),B=null==s?void 0:s.frozenIndex,V=void 0!==B,E=-1===B,F=(0,h().K8)((()=>{if(void 0===B)return!1;const e=Zd().A.state,t=l.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,Zd().g)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:i})||!v)return!1;const o=v,{start:n}=o;return _===n.row&&n.col<=B}),[i,l,v,B,_]),{background:O}=(0,Wa().y)(n)??{},D=(0,re().X)("collection_view_conditional_colors_property_level"),L=(0,r.useMemo)((()=>V?{...null==s?void 0:s.frozenStyles,...F?{zIndex:86}:{zIndex:85},...E?{background:void 0}:{},...u?{insetInlineStart:Kn().hj}:{},...!O||E||D?{}:{background:O}}:{}),[V,null==s?void 0:s.frozenStyles,F,E,u,O,D]),z=(0,y().IS)((e=>{const t={display:"flex",width:"100%",...O&&!D&&{background:O}},o={...d&&u?{}:{borderBottom:`1px solid ${e.border.secondaryTranslucent}`}};return{tableViewRowStyle:{...t,...D?{flex:"0 0 fit-content"}:o},tableViewRowStyleWithBorder:{...t,...o},checkboxContainer:{position:"absolute",insetInlineStart:-Kn().Fh,...!E&&{background:null==s?void 0:s.frozenStyles.background,height:"100%"}}}}),[E,null==s?void 0:s.frozenStyles.background,u,d,O,D]),K=(0,r.useCallback)((()=>{const{mainEditorCurrentBlockStore:e}=Ut().default.state,t=W().wy({environment:P,store:n,mainEditorCurrentBlockStore:e,collectionContextStore:l,fullyQualified:!1,overridePeekMode:S?"center_peek":void 0});t&&(T(),(0,xa().navigate)({environment:P,url:t}))}),[l,P,T,S,n]),H=(0,Gd().DV)(),N=C||a.some((e=>e.wrap)),G=(0,re().X)("client_rtl_support"),$=(0,Ce.jsxs)(r.Fragment,{children:[(0,Ce.jsx)("div",{className:Vt().Eo4,style:z.tableViewRowStyle,dir:G&&(0,Md().A1)()?"rtl":"ltr",ref:M,children:(0,Ce.jsx)(xe().c,{store:n,step:"demo_collection_record",children:(0,Ce.jsxs)(np,{collectionContextStore:l,store:n,anyWrapping:N,children:[(0,Ce.jsx)("div",{style:L,children:(0,Ce.jsx)(tp,{isCollectionViewBlockSelected:p,passesFilter:j,shouldFreeze:!E,children:(0,Ce.jsxs)(Ce.Fragment,{children:[c?(0,Ce.jsx)(ke().A,{animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},config:{timingFunction:"ease-out"},children:(0,Ce.jsx)("div",{style:z.checkboxContainer,children:(0,Ce.jsx)(lp,{store:n,passesFilter:j,frozoneProps:s,canEdit:R})})}):void 0,(0,Ce.jsx)(Sp,{store:n,canEdit:R,propertyFormats:b,visiblePropertiesLength:b.length,shouldSetCellHeight:w,indexAddendum:0,rowIndex:_,disabled:o,groupFormat:i,tableWrap:C,isLocked:k,isCollectionViewBlockSelected:p,passesFilter:j,shouldShowMultiSelectCheckbox:c,frozoneProps:s,normalizedTableSelection:v,isInHomeWidget:u,...A})]})})}),H?(0,Ce.jsx)(hp,{store:n,canEdit:R,propertyFormats:x,visiblePropertiesLength:x.length,shouldSetCellHeight:w,indexAddendum:f,rowIndex:_,disabled:o,groupFormat:i,tableWrap:C,isLocked:k,isCollectionViewBlockSelected:p,passesFilter:j,shouldShowMultiSelectCheckbox:c,frozoneProps:s,normalizedTableSelection:v,isInHomeWidget:u,...A}):(0,Ce.jsx)(Sp,{store:n,canEdit:R,propertyFormats:x,visiblePropertiesLength:x.length,shouldSetCellHeight:w,indexAddendum:f,rowIndex:_,disabled:o,groupFormat:i,tableWrap:C,isLocked:k,isCollectionViewBlockSelected:p,passesFilter:j,shouldShowMultiSelectCheckbox:c,frozoneProps:s,normalizedTableSelection:v,isInHomeWidget:u,...A})]})})}),D?(0,Ce.jsx)("div",{style:{...z.tableViewRowStyleWithBorder,flex:"1 0 fit-content"}}):null,I?(0,Ce.jsx)("div",{style:{...z.tableViewRowStyleWithBorder,display:"flex",justifyContent:"flex-start",flexGrow:1,width:64}}):null]});return(0,Ht().NW)(n,t,(0,r.useMemo)((()=>({renderedType:"table_row",getNode:()=>M.current,getBlockStore:()=>n,activate:K})),[K,n]),$)})));const vp=function(e){const{frozenColumnRepositionStore:t,frozenIndex:o,maxFrozenIndex:n,xForFirstCellInRow:i,showPropertyFormats:l,frozenSectionWidth:a}=e,s=(0,m().v3)(),c=(0,gt().Ks)(),d=(0,r.useRef)(null),u=(0,r.useRef)(null),[p,g]=r.useState({x:0,y:0,width:0,maxY:0,isEntered:!1,isMouseDown:!1}),[S,v]=r.useState(0),[f,b]=r.useState(0),x=(0,h().K8)((()=>t.state.isRepositioning||p.isMouseDown),[t,p.isMouseDown]),C=(0,h().K8)((()=>t.state.newFrozenIndex),[t]),w=(0,h().K8)((()=>!!c&&(0,W().f5)({collectionContextStore:c})),[c]),k=(0,h().K8)((()=>null==c?void 0:c.frozoneStore.state.isScrolled),[c]),A=(0,h().K8)((()=>!k&&-1===o&&w?-4:0),[o,k,w]),T=(0,h().K8)((()=>p.isEntered||x),[p.isEntered,x]),j=(0,h().K8)((()=>t.state.newFrozenColumnXPosition),[t]),M=(0,r.useContext)(Pt().R),P=null==M?void 0:M.horizontalScroller,R=(0,r.useCallback)((()=>{var e,t,o;if(!P||!d.current)return 0;const n=(null===(e=d.current.getBoundingClientRect())||void 0===e?void 0:e.top)??0,r=null===(t=P.getNode())||void 0===t?void 0:t.getElementsByClassName(Vt().FYj);return(r&&r.length>0?null===(o=r[0].getBoundingClientRect())||void 0===o?void 0:o.top:0)-n}),[P]),_=(0,r.useCallback)((()=>{var e,t,o,n,r;if(!P||!d.current)return 0;const i=(null===(e=d.current)||void 0===e||null===(e=e.getBoundingClientRect())||void 0===e?void 0:e.bottom)??0,l=null===(t=P.getNode())||void 0===t?void 0:t.getElementsByClassName(Vt().Eo4),a=l&&l.length>0?null===(o=l[l.length-1].getBoundingClientRect())||void 0===o?void 0:o.bottom:0,s=null===(n=P.getNode())||void 0===n?void 0:n.getElementsByClassName(Vt().Mbm),c=s&&s.length>0?null===(r=s[s.length-1].getBoundingClientRect())||void 0===r?void 0:r.bottom:0;return Math.max(a,c)-i}),[P]),B=(0,h().K8)((()=>{var e;const t=null===(e=d.current)||void 0===e?void 0:e.getBoundingClientRect();return t&&void 0!==a?new DOMRect(t.x+a+p.x+10,t.y+p.y+10,3,3):void 0}),[a,p]),V=(0,h().K8)((()=>{const e=(null==c?void 0:c.frozoneStore.state.scrollerLeftOffset)??0,t=(0,$t().kf)(s),o=Math.max(t-e,0);return c&&(0,z().QP)(s,c)?o:0}),[c,s]),E=(0,h().K8)((()=>c&&(0,W().f5)({collectionContextStore:c})),[c]),F=(0,r.useCallback)((e=>{if(void 0===o||void 0===n||void 0===a||null===d.current||null===u.current)return;const r=d.current.getBoundingClientRect(),s=e.clientX-r.x;if(null==c||c.frozoneStore.setState({...null==c?void 0:c.frozoneStore.state,tryShowHiddenFrozenColumn:s<42}),!T)return;const p=R();v(p);const m=_();b(m);const S=2+a,h=Math.max(s-S,-S),y=e.clientY-r.y-14,f=r.bottom-r.top-14+m,C=x?p:-14,w=Math.max(Math.min(y,f),C);if(g((e=>({...e,x:x?h:0,y:w}))),x){const e=l,r=u.current.getBoundingClientRect();let c=s,d=i,p=-1,m=d,g=Math.abs(d-c);for(let t=0;t<e.length&&!(t>n);t++){const n=e[t];d+=(null==n?void 0:n.width)??0,k&&t===o+1&&(c-=r.x);const i=Math.abs(d-c);i<g&&(g=i,m=d,p=t)}t.setState({...t.state,newFrozenIndex:p,newFrozenColumnXPosition:m-a-1})}}),[o,n,a,null==c?void 0:c.frozoneStore,T,R,_,x,l,i,t,k]);(0,r.useEffect)((()=>{const e=I().nF((e=>{F(e)}),25);return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[F]);const O=(0,r.useCallback)((e=>{x||(F(e.nativeEvent),g((e=>({...e,isEntered:!0,isMouseDown:!1}))))}),[x,F]),D=(0,r.useCallback)((e=>{x||g((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[x]),L=(0,r.useCallback)((e=>{g((e=>({...e,isMouseDown:!0})))}),[]),K=(0,r.useCallback)((e=>{x&&g((e=>({...e,isEntered:!0})))}),[x]),H=(0,r.useCallback)((e=>{g((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[]),N=(0,r.useCallback)((e=>{x&&g((e=>({...e,x:0,isEntered:!1,isMouseDown:!1})))}),[x]),G=(0,y().IS)((e=>{const t=void 0!==C&&void 0!==o&&C<=o;return{repositionerContainer:{zIndex:87,display:"flex",position:"absolute",width:"100%",height:"100%",cursor:x?"grabbing":"grab",pointerEvents:x?void 0:"none"},repositionerOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)",height:"100%"},repositionerInsideStickyWrapper:{position:"sticky",insetInlineStart:V+(E?Kn().Fh:0),height:"100%"},tooltipContainer:{position:"absolute",insetInlineStart:-1!==a||k?a??0:5,zIndex:30,height:"100%"},tooltipOrigin:{position:"absolute",insetInlineStart:-3,top:0,width:8,pointerEvents:"auto",cursor:x?"grabbing":"grab",height:"100%"},tooltipColumn:{position:"absolute",insetInlineStart:x?p.x-1:-1,top:x?S:0,width:2,height:x?`calc(100% + ${f-S}px`:"100%",background:"dark"===e.mode?e.palette.gray[500]:e.palette.gray[200]},ghostColumnBase:{position:"absolute",top:x?S:0,width:1,height:x?`calc(100% + ${f-S}px`:"100%",background:e.palette.uiBlue[300]},frozenGhostColumn:{insetInlineStart:j,opacity:x&&t?1:0},unfrozenGhostColumn:{insetInlineStart:(a??0)+(j??0),opacity:T&&x&&!t?1:0},tooltipDraggable:{position:"absolute",insetInlineStart:x?p.x-2:-2,top:p.y,width:4,height:28,background:e.palette.uiBlue[600],borderRadius:4}}}),[C,o,x,V,E,a,k,p.x,p.y,S,f,j,T]);return(0,Ce.jsx)("div",{className:Vt().FZs,style:G.repositionerContainer,onMouseEnter:K,onMouseLeave:H,onMouseUp:N,children:(0,Ce.jsxs)("div",{style:G.repositionerOutsideStickyWrapper,ref:u,children:[(0,Ce.jsx)("div",{style:G.repositionerInsideStickyWrapper,ref:d,children:(0,Ce.jsx)(qo().A,{renderTooltip:()=>x&&void 0!==C&&C!==o?(0,Ce.jsx)(he().sA,{id:"tableView.selectionOverlay.repositioner.dynamicTooltip",defaultMessage:"Freeze {numColumns} {numColumns, select, 1 {column} other {columns}}",values:{numColumns:C+1}}):(0,Ce.jsx)(he().sA,{id:"tableView.selectionOverlay.repositioner.tooltip",defaultMessage:"Drag horizontally to freeze columns"}),delayThreshold:300,forceVisibleState:x||void 0,placement:"right",originRect:B,render:e=>(0,Ce.jsxs)(ke().A,{animate:{translateX:A,opacity:T?1:0},...e,style:G.tooltipContainer,children:[(0,Ce.jsx)("div",{style:G.tooltipOrigin,onMouseEnter:O,onMouseLeave:D,onMouseDown:L}),(0,Ce.jsx)("div",{style:{...G.ghostColumnBase,...G.frozenGhostColumn}}),(0,Ce.jsx)("div",{style:G.tooltipColumn}),(0,Ce.jsx)("div",{style:G.tooltipDraggable})]})})}),(0,Ce.jsx)("div",{style:{...G.ghostColumnBase,...G.unfrozenGhostColumn}})]})})},fp={tableSelectionOverlayActions:new(ft().O2)("tableSelectionOverlayActions",(async()=>await o.e(95496).then(o.bind(o,339016)))),tableSelectionOverlayPropertyActions:new(ft().O2)("tableSelectionOverlayPropertyActions",(async()=>await Promise.all([o.e(95496),o.e(40589)]).then(o.bind(o,233035))))};var bp=()=>o(556148);class xp extends f().Store{getInitialState(){}}const Cp=xp;class wp extends f().Store{getInitialState(){return{isRepositioning:!1,newFrozenIndex:void 0,newFrozenColumnXPosition:void 0}}}const kp=wp,Ip=new Set(["rollup","formula","verification"]);function Ap(e){const{dragAndFillStore:t,frozenIndex:o,rowsWrapRect:n,schema:i,selection:l,selectionStartRectStore:a,showPropertyFormats:s}=e,c=(0,gt().ET)(),d=(0,h().O$)(t),u=(0,h().K8)((()=>{var e;const t=(null==d?void 0:d.start)||l.start,o=s[t.col];return o?null===(e=i[o.property])||void 0===e?void 0:e.type:void 0}),[d,l,s,i]),p=(0,h().O$)(a),m=(0,h().K8)((()=>void 0!==o&&l.start.col<=o),[o,l]),g=(0,h().O$)(c.isInHomeWidgetStore),S=(0,h().K8)((()=>(0,W().f5)({collectionContextStore:c})),[c]),v=(0,y().IS)((e=>{const t=m?91:85,o=m?"sticky":void 0;let n=0;g?n=Kn().hj:S&&(n=Kn().Fh);return{dragAndFillContainer:{zIndex:t,display:"flex",position:"relative"},dragAndFillOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)"},dragAndFillInsideStickyWrapper:{position:o,insetInlineStart:n},tooltipContainer:p?{position:"absolute",insetInlineStart:p.left+p.width-6-(S?Kn().Fh:0)}:{},tooltipOrigin:{position:"absolute",insetInlineStart:0,top:p?p.bottom-7:void 0,width:10,height:15,pointerEvents:"auto",cursor:"ns-resize"},tooltipCircle:{position:"absolute",insetInlineStart:0,top:p?p.bottom-5:void 0,width:9,height:9,border:`2px solid ${e.simpleTableSelectionBorder}`,transform:d?"scale(1.3)":void 0,transition:"transform 0.2s ease",background:e.background.primary,borderRadius:"50%",cursor:"ns-resize"},tooltipText:{color:e.text.inverseSecondary,maxWidth:200,...q().RC}}}),[m,g,S,p,d]),f=(0,r.useMemo)((()=>{if(p&&n)return new DOMRect(p.x+n.x+p.width-4,p.y+n.y+p.height-4,7,7)}),[p,n]),b=(0,r.useCallback)((()=>(0,Ce.jsx)(he().sA,{id:"tableView.selectionOverlay.dragAndFill.tooltip",defaultMessage:"Drag vertically to fill value"})),[]),x=(0,r.useCallback)((e=>(0,Ce.jsx)("div",{...e,style:v.dragAndFillContainer,children:(0,Ce.jsx)("div",{style:v.dragAndFillOutsideStickyWrapper,children:(0,Ce.jsx)("div",{style:v.dragAndFillInsideStickyWrapper,children:(0,Ce.jsxs)("div",{style:v.tooltipContainer,children:[(0,Ce.jsx)("div",{style:v.tooltipOrigin}),(0,Ce.jsx)("div",{className:Vt().yle,style:v.tooltipCircle})]})})})})),[v]);return p?!u||(0,gr().F_)(u)||Ip.has(u)?null:(0,Ce.jsx)(qo().A,{renderTooltip:b,delayThreshold:300,forceVisibleState:!!d||void 0,originRect:f,placement:"right",render:x}):null}function Tp(e){const{selectionStartRectStore:t,selectionEndRectStore:o}=e,n=(0,gt().ET)(),r=(0,h().O$)(t),i=(0,h().O$)(o),l=(0,h().K8)((()=>(0,bp().$u)(n)),[n]),a=(0,y().IS)((e=>{if(!r||!i)return{border:{}};const t=Math.min(r.left,i.left),o=Math.min(r.top,i.top),n=Math.max(r.right,i.right),a=Math.max(r.bottom,i.bottom);return{border:{position:"absolute",insetInlineStart:t-l+1,top:o+1,width:n-t-2,height:a-o-2,border:`solid ${e.simpleTableSelectionBorder}`,borderWidth:1,borderRadius:2,zIndex:-1,pointerEvents:"none"}}}),[r,i,l]);return r&&i?(0,Ce.jsx)("div",{style:a.border}):null}const jp=r.memo((function(e){const{groupFormat:t}=e,n=(0,m().v3)(),i=(0,r.useContext)(ba().n),l=(0,Gd().PD)(),a=(0,r.useRef)(null),s=(0,r.useRef)(void 0),c=(0,re().X)("improved_drag_and_fill"),d=(0,re().X)("multi_cell_selection_border"),{value:u}=(0,ft().fJ)(St().g),{value:p}=(0,ft().fJ)(ht().S),{value:g}=(0,ft().fJ)(Rt().T.formulas),S=(0,r.useMemo)((()=>fp.tableSelectionOverlayActions.load()),[]),y=(0,h().uB)(void 0,Cp),v=(0,h().uB)(void 0,kp),f=(0,h().r6)((()=>(0,vt().v2)(t,e.collectionContextStore)),[t,e.collectionContextStore]),b=(0,h().K8)((()=>(0,W().f5)({collectionContextStore:e.collectionContextStore})),[e.collectionContextStore]),x=(0,h().K8)((()=>e.collectionContextStore.normalizedSchemaStore.state),[e.collectionContextStore]),C=(0,h().r6)((()=>{const n=e.collectionContextStore.collectionViewBlockStore();if(!n)return;const r=Zd().A.state;if(!r.isActive||!(0,Zd().g)(r.selectionKey,{collectionViewBlockStore:n,groupFormat:t}))return;const i=(0,z().yR)(r.selection,e.showPropertyFormats.length,f.state.length);return o(4319).kn(f.state[i.start.row]),i}),[e.collectionContextStore,e.showPropertyFormats.length,t,f],{useDeepEqual:!0}),w=(0,h().O$)(C),k=(0,h().K8)((()=>{const e=C.state;return e&&e.start.col===e.end.col&&e.start.row===e.end.row}),[C]),I=(0,h().K8)((()=>{const e=C.state;return e&&e.start.row===e.end.row}),[C]),A=c?I:k,T=(0,h().r6)((()=>{const t=C.state;if(!t)return;if(!a.current)return;const o=t.start,n=e.showPropertyFormats,r=f.state[o.row],i=(0,bp().Xw)(r,a.current);if(!i)return;const l=a.current.getBoundingClientRect(),s=i.height,c=i.top-l.top-1,d=n[o.col].width||0,u=s+1;let p=(0,bp().$u)(e.collectionContextStore);for(let e=0;e<o.col;e++){const t=n[e];t.width&&(p+=t.width)}return new DOMRect(p-1,c,d+1,u)}),[f,C,e.collectionContextStore,e.showPropertyFormats]),j=(0,h().r6)((()=>{const t=C.state;if(!t)return;if(!a.current)return;const o=t.end,n=e.showPropertyFormats,r=f.state[o.row],i=(0,bp().Xw)(r,a.current);if(!i)return;const l=a.current.getBoundingClientRect(),s=i.height,c=i.top-l.top-1,d=n[o.col].width||0,u=s+1;let p=(0,bp().$u)(e.collectionContextStore);for(let e=0;e<o.col;e++){const t=n[e];t.width&&(p+=t.width)}return new DOMRect(p-1,c,d+1,u)}),[f,C,e.collectionContextStore,e.showPropertyFormats]),M=(0,h().r6)((()=>I?j.state:void 0),[j,I]),P=c?M:T,R=(0,h().r6)((()=>e.collectionContextStore.frozoneStore.state.frozenIndex),[e.collectionContextStore]),_=(0,h().K8)((()=>{const t=e.collectionContextStore,o=t.collectionViewStore(),n=t.frozoneStore.state.scrollerWidth;return null==o?void 0:o.getTableMaxFrozenColumnIndex(n,t.normalizedFormatStore.state)}),[e.collectionContextStore]),B=(0,h().r6)((()=>{const t=R.state;if(void 0!==t){let o=(0,bp().$u)(e.collectionContextStore);const n=e.showPropertyFormats;for(let e=0;e<=t&&!(e>=n.length);e++){const t=n[e];t.width&&(o+=t.width)}return o-1-(b?Kn().Fh:0)}}),[R,b,e.collectionContextStore,e.showPropertyFormats]),V=(0,h().K8)((()=>(0,bp().$u)(e.collectionContextStore)-(b?Kn().Fh:0)),[e.collectionContextStore,b]),E=(0,h().K8)((()=>{let t=!1;const o=(0,bp().yA)(e.collectionContextStore,e.groupFormat),n=o.length,r=bt().default.state.stores.filter((e=>o.includes(e))).length;return t=0!==n&&0!==r&&(r===n||"indeterminate"),void 0!==R.state&&!y.state&&!t&&!Zd().A.state.isActive&&void 0===e.tableStore.state.temporaryFormat&&e.collectionContextStore.permissionScopesStore.state.canConfigureBlock}),[y,R,e.collectionContextStore,e.groupFormat,e.tableStore]);(0,r.useEffect)((()=>{a.current&&(s.current=new MutationObserver((()=>{T.recompute()})),s.current.observe(a.current,{attributes:!0,childList:!0,characterData:!0,subtree:!0}));const e=s.current;return()=>{e&&e.disconnect()}}),[T]);const F=(0,r.useCallback)((async t=>{(await S).handleDirection({shortcutOrKeyboardEvent:t,direction:bp().Dp.Left,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:f.state,frozenSectionWidth:B.state,frozenIndex:R.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,columnVirtualizer:l})}),[S,n,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,e.disableHorizontalEdgeScroll,C,f,B,R,l]),O=(0,r.useCallback)((async t=>{(await S).handleDirection({shortcutOrKeyboardEvent:t,direction:bp().Dp.Right,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:f.state,frozenSectionWidth:B.state,frozenIndex:R.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,columnVirtualizer:l})}),[S,f,n,R,B,C,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,l]),D=(0,r.useCallback)((async t=>{(await S).handleDirection({shortcutOrKeyboardEvent:t,direction:bp().Dp.Up,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:f.state,frozenSectionWidth:B.state,frozenIndex:R.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,columnVirtualizer:l})}),[S,f,n,R,B,C,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,l]),L=(0,r.useCallback)((async t=>{(await S).handleDirection({shortcutOrKeyboardEvent:t,direction:bp().Dp.Down,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:f.state,frozenSectionWidth:B.state,frozenIndex:R.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,columnVirtualizer:l})}),[S,f,n,R,B,C,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,l]),K=(0,r.useCallback)((async t=>{(await S).handleDirection({shortcutOrKeyboardEvent:t,direction:bp().Dp.Up,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:f.state,frozenSectionWidth:B.state,frozenIndex:R.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,columnVirtualizer:l})}),[S,f,n,R,B,C,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,l]),H=(0,r.useCallback)((async t=>{(await S).handleDirection({shortcutOrKeyboardEvent:t,direction:bp().Dp.Down,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:f.state,frozenSectionWidth:B.state,frozenIndex:R.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,columnVirtualizer:l})}),[S,f,n,R,B,C,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,l]),N=(0,r.useCallback)((async t=>{(await S).handleEnter({shortcutEvent:t,environment:n,schema:x,showPropertyFormats:e.showPropertyFormats,disabled:e.disabled,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,collectionContextStore:e.collectionContextStore,normalizedTableSelection:C.state,allRows:f.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[S,f,n,C,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.disabled,e.showPropertyFormats,x]),G=(0,r.useCallback)((async t=>{t.preventDefault();(await S).handleDirection({shortcutOrKeyboardEvent:t,direction:bp().Dp.Right,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:f.state,frozenSectionWidth:B.state,frozenIndex:R.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,columnVirtualizer:l})}),[S,f,n,R,B,C,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,l]),$=(0,r.useCallback)((async t=>{t.preventDefault();(await S).handleDirection({shortcutOrKeyboardEvent:t,direction:bp().Dp.Left,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:f.state,frozenSectionWidth:B.state,frozenIndex:R.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,columnVirtualizer:l})}),[S,f,n,R,B,C,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,l]),U=(0,r.useCallback)((async e=>{(await S).handleEsc({keyboardEvent:e,environment:n,normalizedTableSelection:C.state,allRows:f.state})}),[f,n,C,S]),q=(0,r.useCallback)((async()=>{(await S).handleDelete({environment:n,collectionContextStore:e.collectionContextStore,disabled:e.disabled,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:f.state})}),[f,n,C,e.collectionContextStore,e.disabled,e.showPropertyFormats,S]),X=(0,r.useCallback)((async t=>{(await S).handleCut({clipboardEvent:t,environment:n,collectionContextStore:e.collectionContextStore,disabled:e.disabled,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:f.state,formulasModule:g})}),[S,n,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,C,f,g]),Y=(0,r.useCallback)((async t=>{(await S).handleCopy({clipboardEvent:t,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,allRows:f.state,formulasModule:g,normalizedTableSelection:C.state,environment:n})}),[S,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,f,g,C,n]),Q=(0,r.useCallback)((async t=>{const o=await S,r=await ct().R.clipboardActions.load();o.handlePaste({clipboardEvent:t,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,schema:x,showPropertyFormats:e.showPropertyFormats,markdownLinkifyIt:u,tinyMceMicrosoftWordPasteFilter:p,disabled:e.disabled,allRows:f.state,clipboardActions:r,normalizedTableSelection:C.state})}),[S,f,n,u,C,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,x,p]),Z=(0,r.useCallback)((async()=>{(await S).handleCommandEnter({environment:n,collectionContextStore:e.collectionContextStore,normalizedTableSelection:C.state,allRows:f.state,overrideLinkClick:i})}),[f,n,C,i,e.collectionContextStore,S]),J=(0,r.useCallback)((async()=>{(await S).handleShiftEnter({environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:f.state,selectionStartRectStore:T,frozenSectionWidth:B.state,frozenIndex:R.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[S,f,n,R,B,C,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,T]),ee=(0,r.useCallback)((async()=>{(await S).handleCommandShiftEnter({environment:n,normalizedTableSelection:C.state,allRows:f.state})}),[S,f,n,C]),te=(0,r.useCallback)((async t=>{(await S).handleDuplicate({keyboardEvent:t,environment:n,disabled:e.disabled,schema:x,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:C.state,allRows:f.state})}),[S,f,n,C,x,e.disabled,e.showPropertyFormats]),oe=(0,r.useCallback)((async t=>{(await S).handleKeypress({keyboardEvent:t,environment:n,schema:x,showPropertyFormats:e.showPropertyFormats,disabled:e.disabled,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,collectionContextStore:e.collectionContextStore,normalizedTableSelection:C.state,allRows:f.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[S,f,n,C,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.disabled,e.showPropertyFormats,x]),ne=(0,r.useCallback)((async e=>{(await S).handleMoveTo({shortcutOrKeyboardEvent:e,environment:n,normalizedTableSelection:C.state,allRows:f.state})}),[S,f,n,C]),ie=(0,r.useCallback)((async t=>{(await S).handleDragStart({dragEvent:t,environment:n,collectionContextStore:e.collectionContextStore,showPropertyFormats:e.showPropertyFormats,paddingLeft:e.paddingLeft,disabled:e.disabled,dragAndFillStore:y,frozenColumnRepositionStore:v,frozenIndex:R.state,allRows:f.state,normalizedTableSelection:C.state})}),[S,f,y,n,v,R,C,e.collectionContextStore,e.showPropertyFormats,e.disabled,e.paddingLeft]),le=(0,r.useCallback)((async t=>{(await S).handleDragMove({dragEvent:t,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,dragAndFillStore:y,frozenColumnRepositionStore:v,normalizedTableSelection:C.state,allRows:f.state,selectionStartRectStore:T})}),[S,f,y,n,v,C,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,T]),ae=(0,r.useCallback)((async()=>{(await S).handleDragEnd({environment:n,collectionContextStore:e.collectionContextStore,showPropertyFormats:e.showPropertyFormats,schema:x,dragAndFillStore:y,frozenColumnRepositionStore:v,normalizedTableSelection:C.state,allRows:f.state})}),[S,f,y,n,v,C,e.collectionContextStore,e.showPropertyFormats,x]),se=(0,r.useCallback)((async()=>{(await S).handleDragCancel({dragAndFillStore:y,frozenColumnRepositionStore:v})}),[y,v,S]);return(0,Ce.jsx)(Je().N,{debugName:"TableSelectionOverlay",capture:void 0!==w,onLeft:F,onRight:O,onUp:D,onDown:L,onMoveUp:K,onMoveDown:H,onEnter:N,onTab:G,onUntab:$,onEsc:U,onDelete:q,onBackspace:q,onCut:X,onCopy:Y,onPaste:Q,onCommandEnter:Z,onShiftEnter:J,onCommandShiftEnter:ee,onDuplicate:te,onKeypress:oe,onMoveTo:ne,children:(0,Ce.jsx)(Jc().A,{disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,onDraggableDragStart:ie,onDraggableDragMove:le,onDraggableDragEnd:ae,onDraggableDragCancel:se,render:t=>{var o;return(0,Ce.jsxs)("div",{ref:a,style:{position:"relative",minWidth:e.minWidth,isolation:"auto"},...t,children:[(0,bp().Gd)(Boolean(e.disableHorizontalEdgeScroll),e.collectionContextStore)&&w&&(A||y.state)?(0,Ce.jsx)(Ap,{dragAndFillStore:y,frozenIndex:R.state,rowsWrapRect:null===(o=a.current)||void 0===o?void 0:o.getBoundingClientRect(),schema:x,selection:w,selectionStartRectStore:P,showPropertyFormats:e.showPropertyFormats}):null,!k&&d?(0,Ce.jsx)(Tp,{selectionStartRectStore:T,selectionEndRectStore:j}):null,E?(0,Ce.jsx)(vp,{frozenColumnRepositionStore:v,xForFirstCellInRow:V,maxFrozenIndex:_,showPropertyFormats:e.showPropertyFormats,frozenIndex:R.state,frozenSectionWidth:B.state}):void 0,(0,Ce.jsx)(Mp,{...e,allRowsStore:f,selectionStartRectStore:T,normalizedTableSelectionStore:C,frozenSectionWidthStore:B,frozenIndexStore:R})]})}})})}),tr().A),Mp=r.memo((function(e){const t=(0,m().v3)(),o=(0,r.useMemo)((()=>fp.tableSelectionOverlayActions.load()),[]),n=(0,r.useMemo)((()=>fp.tableSelectionOverlayPropertyActions.load()),[]),i=(0,r.useMemo)((()=>({onPropertyTab:async()=>{(await n).handlePropertyTabOrUntab({type:"tab",environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyUntab:async()=>{(await n).handlePropertyTabOrUntab({type:"untab",environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyEnter:async()=>{(await n).handlePropertyEnter({environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyClick:async(o,r,i)=>{(await n).handlePropertyClick({store:o,property:r,schema:i,environment:t,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore})},onPropertyEsc:async()=>{(await n).handlePropertyEsc({environment:t,collectionContextStore:e.collectionContextStore,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})},onPropertyBgClick:async()=>{(await n).handlePropertyBgClick(t,e.blockPropertyValueOverlayStore,e.showPropertyFormats,e.collectionContextStore,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore,e.normalizedTableSelectionStore.state,e.frozenSectionWidthStore.state,e.frozenIndexStore.state,e.disableHorizontalEdgeScroll)},onPropertyContextMenu:async o=>{(await n).handlePropertyContextMenu({mouseEvent:o,environment:t,collectionContextStore:e.collectionContextStore,allRows:e.allRowsStore.state,normalizedTableSelection:e.normalizedTableSelectionStore.state})},onOpenProperty:async o=>{(await n).handlePropertyOpenProperty({openProperty:o,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,disableHorizontalEdgeScroll:Boolean(e.disableHorizontalEdgeScroll),collectionContextStore:e.collectionContextStore,environment:t})},onSelectableEnter:async n=>{(await o).handleRowSelectableEnter({onEnterArgs:n,environment:t,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore})}})),[o,n,t,e.allRowsStore,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.frozenIndexStore,e.frozenSectionWidthStore,e.groupFormat,e.normalizedTableSelectionStore,e.selectionStartRectStore,e.showPropertyFormats]);return(0,Ce.jsx)(Ce.Fragment,{children:e.render(i)})}),tr().A);function Pp(e){const{isFullScreen:t,hasGroups:o,propertyWidths:n,hasPartialResults:r,hasSearchQuery:i,frozoneProps:l}=e,a=(0,m().v3)(),s=(0,y().DP)(),c=(0,m().Y0)().isPhone,d=(0,gt().Ks)(),u=(0,cs().A)(!0,0,100),p=(0,h().K8)((()=>Boolean(null==d?void 0:d.normalizedFormatStore.state.hide_table_vertical_lines)),[d]),g=l.isScrolled,S=l.frozenIndex,v=void 0!==S,f=(0,h().K8)((()=>{if(!d)return!1;const e=d.collectionViewBlockStore();return!!e&&(0,Yd().d1)(e)}),[d]),b=(0,h().K8)((()=>d?(0,z().wy)({environment:a,collectionContextStore:d,isPhone:c,theme:s}):{}),[d,a,c,s]),x=(0,h().K8)((()=>Boolean(null==d?void 0:d.isInHomeWidgetStore.state)),[null==d?void 0:d.isInHomeWidgetStore]),C=(0,y().IS)((e=>{let t="0x 16px";return v?t=void 0:x&&(t=0),{container:{display:"flex",flexDirection:"row",alignItems:"flex-start"},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},frozenColumnsContainer:{display:"flex",flexDirection:"row",...b,...-1===S?{background:void 0}:{}},rowContainer:{display:"flex",alignItems:"flex-start",padding:t,borderBottom:`1px solid ${e.border.secondaryTranslucent}`,width:"100%"},rowShimmer:{height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor,marginInlineStart:v?0:8},column:{display:"flex",height:32,padding:"0px 8px",alignItems:"center",borderInlineEnd:p?void 0:`1px solid ${e.border.secondaryTranslucent}`}}}),[v,x,b,S,p]);if(!u||!d)return null;const w=n.map(((e,t)=>(0,Ce.jsx)("div",{style:{...C.column,width:e},children:(0,Ce.jsx)(wn().A,{style:{...C.rowShimmer,width:.6*(e-16)}})},t)));let k=null,I=[];if(v&&void 0!==S){const e=w.slice(0,S+1);k=(0,Ce.jsxs)("div",{style:C.frozenColumnsContainer,children:[(0,Ce.jsx)(tp,{isCollectionViewBlockSelected:f,passesFilter:!0,shouldFreeze:-1!==S,children:e}),e.length>0?(0,Ce.jsx)(hu,{isCollectionViewBlockSelected:f,passesFilter:!0,isShimmerRow:!0,isScrolled:g}):null]}),I=w.slice(S+1,w.length)}else I=w;let A=1;o||r||i||(A=t?10:3);const T=[...Array(A)].map(((e,t)=>(0,Ce.jsxs)("div",{style:C.rowContainer,children:[k,I]},t)));return(0,Ce.jsx)("div",{style:C.container,children:(0,Ce.jsx)("div",{style:C.rowsContainer,children:T})})}const Rp=r.memo((function(e){var t;const{blockPropertyValueOverlayStore:n,collectionContextStore:i,disabled:l,format:a,groupFormat:c,isFullScreen:d,isInPeekRenderer:u,minWidth:p,paddingBottom:g,paddingLeft:S,paddingRight:v,query:f,schema:b,showHoverActionsStore:x,store:C,tableStore:w,headerWidth:k}=e,I=(0,m().v3)(),A=Boolean(s().A.isMobile),{isPhone:T}=(0,m().Y0)(),j=(0,he().tz)(),M=(0,y().DP)(),P=(0,r.useContext)(ba().n),R=(0,Ee().Zp)(),B=Boolean(c),V=(0,r.useMemo)((()=>c?[c]:[]),[c]),E=(0,h().K8)((()=>i.groupsStore.getGroupState(V)),[i.groupsStore,V]),{reducerResult:F,isReady:O,hasPartialResults:D,pageCount:L,shouldShowShimmer:K}=(0,h().K8)((()=>{const e=null==E?void 0:E.reducerResultStore.state,t=void 0!==e,o=(null==e?void 0:e.blockIds.length)||0,n=void 0!==e&&e.blockIds.length>0;return{reducerResult:e,isReady:t,hasPartialResults:n,pageCount:o,shouldShowShimmer:(0,Jr().iv)({collectionContextStore:i,groupsPointer:V,hasPartialResults:n})}}),[i,E,V]),H=0===L&&O&&!K,N=(0,h().K8)((()=>(0,Jr().Kk)({collectionContextStore:i,groupsPointer:V})),[i,V]),G=(0,h().O$)(i.permissionScopesStore),U=(0,Ht().bx)(e.store,e.disabled)&&!G.isSyncedCollection&&G.canEditContent,{showPropertyFormats:q,titleColumnIndex:X,propertyWidths:Y,totalPropertyWidth:Z}=(0,h().K8)((()=>{const e=(0,z().GW)(a,w).filter((e=>e.visible)),t=e.findIndex((({property:e})=>"title"===e)),o=e.map((({width:e})=>e||Aa().kp));return{showPropertyFormats:e,titleColumnIndex:t,propertyWidths:o,totalPropertyWidth:e.reduce(((e,t)=>e+(t.width||0)),0)}}),[a,w],{useDeepEqual:!0}),J=(0,h().K8)((()=>(0,z().Ty)(a,w)),[a,w],{useDeepEqual:!0}),ee=Z+(G.canEditContent?Qd().m7:0),te=(0,h().O$)(i.isInHomeWidgetStore),oe=(0,h().O$)(i.isUnlistedViewStore),ne=(0,h().O$)(i.isInlineViewStore),re=oe&&ne,ie=(0,h().K8)((()=>(0,Bt().s)(C.id)),[C]),le=(0,h().K8)((()=>W().fG({collectionContextStore:i,environment:I,intl:j})),[i,I,j]),ae=(0,h().K8)((()=>(0,Lr().N)({collectionContextStore:i}).length>0),[i]),se=(0,h().K8)((()=>""!==i.searchQueryStore.state),[i]),ce=H&&(ae||se),{shouldShowAddRowButton:de,canAddRow:ue}=(0,h().K8)((()=>{const e=O&&!te&&(U||"collectionTypedView"===i.contextType)&&Boolean(i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}));return ce?{shouldShowAddRowButton:!1,canAddRow:e}:{shouldShowAddRowButton:e,canAddRow:e}}),[ce,O,te,U,i]),pe=!ce&&O&&!K&&0===L&&de&&!ae&&!B,me=d?5:3,ge=Boolean(null===(t=f.aggregations)||void 0===t?void 0:t.length),ye=!ce&&ge&&!oe&&!(null!=R&&R.hideAggregation),ve=(0,h().K8)((()=>W().XQ({collectionContextStore:i,reducerResult:F,isFullScreen:d})),[i,d,F]),fe=(0,h().K8)((()=>{const e=(0,vt().v2)(V[0],i);return bt().default.state.stores.filter((t=>e.includes(t))).length>0}),[V,i]),be=(0,h().K8)((()=>{const{isScrolled:e,frozenIndex:t,tryShowHiddenFrozenColumn:o}=i.frozoneStore.state;if(void 0===t)return{isScrolled:!1,frozenIndex:void 0,frozenStyles:{},shouldFreezeMultiSelectColumn:!1,shouldShowStickyMultiSelectColumn:!1,isCollectionViewBlockSelected:!1};const n={...(0,z().wy)({environment:I,collectionContextStore:i,isPhone:T,theme:M}),display:"flex"},r=Boolean(e&&-1===t),l=Boolean(r&&(o||fe)),a=i.collectionViewBlockStore(),s=!!a&&(0,Yd().d1)(a);return{isScrolled:Boolean(e),frozenIndex:t,frozenStyles:n,shouldFreezeMultiSelectColumn:r,shouldShowStickyMultiSelectColumn:l,isCollectionViewBlockSelected:s}}),[fe,i,I,T,M],{useDeepEqual:!0}),xe=(0,h().K8)((()=>{const e=i.collectionViewStore();return U&&A&&!(null!=e&&e.isSyncedCollection())}),[U,i,A]),we=(0,h().O$)(i.defaultPageTemplateStore),ke=(0,h().K8)((()=>{var e,t;const o=null===(e=i.collectionStore())||void 0===e?void 0:e.id;return(n.state.isOpen&&(null===(t=n.state.collectionContextStore)||void 0===t||null===(t=t.collectionStore())||void 0===t?void 0:t.id))===o}),[n,i]),Ie=(0,r.useCallback)((()=>{if(!E)return;const e=i.collectionStore();if(!e||!i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const t=bt().default.state.stores[0];if(!t)return;const o=i.subitemTreeStore.state,r=(0,yr().Qe)(o.children,(e=>e.value.store===t));if(!r)return;const l=r?(0,vt().kY)(r.map((e=>e.value.store))):"",a=i.subitemExpandedStore.state.get(l);Boolean(null==a?void 0:a.isExpanded)&&_().createAndCommit({userAction:"TableGroupResults.onItemShiftEnter",environment:I,canUndo:!0,perform:o=>{const l=(0,Ql().u)({environment:I,collectionContextStore:i,groupsPointer:E.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:r,subitemInsertDirection:"into",from:"table_group_results_shift_enter"});if(l&&n){const e=()=>{dr().ho({isNewBlock:!0,environment:I,blockPropertyValueOverlayStore:n,store:l,property:"title",surface:"table",collectionContextStore:i})};i.registerCallbackForItemMounted(l,e)}}})}),[n,i,I,E]),Ae=(0,r.useCallback)((e=>{const t=new(o(838256).aD)(I,"handleAddRowClick");if(!(0,ro().E)(I)||!E)return t.fail("invalid_state"),void(0,wa().Q)(I);i.searchQueryStore.state&&(0,Or().S)({searchQuery:"",collectionContextStore:i,isFullScreen:d}),_().createAndCommit({userAction:"TableGroupResults.handleAddRowClick",environment:I,canUndo:!0,perform:e=>{const o=(0,ur().Q)({environment:I,collectionContextStore:i,groupsPointer:c?[c]:[],shouldCoerce:!0,templateStore:we,transaction:e,from:{createBlock:"table_group_results"},tracker:t,inMemoryRecordCache:I.defaultRecordCache.inMemoryRecordCache});if(!o)return;const r=o.newStore;if(A){const e=(0,Q().Ay)({store:r,fullyQualified:!1,pageVisitSource:$().y8.Create});return void(P?P(e):(0,xa().navigate)({environment:I,url:e}))}if(o.coercionSucceeded){const t=()=>{dr().ho({isNewBlock:!0,environment:I,blockPropertyValueOverlayStore:n,store:r,property:"title",surface:"table",collectionContextStore:i})};i.registerCallbackForItemMounted(r,t),e.postSubmitCallbacks.push((async e=>{if(!e)return i.virtualizedModule.waitToScrollToBlock({blockStore:r,groupsPointer:V})}))}else Jn().VU({environment:I,store:r,peekMode:W().hH(i),resultsStore:E.resultsStore,collectionContextStore:i,pageVisitSource:$().y8.Create});const l=i.currentSubitemFormatStoreForCollectionStore.state;sr().vH(I,{from:l?"table_add_parent_item_bottom":"table_add_item_bottom",type:"page",new_page_id:r.id,creating_block_id:r.id,...(0,Et().sl)(i)})}})}),[I,E,i,d,c,we,A,P,n,V]),Te=(0,r.useCallback)((e=>{E&&((0,Ii().k)(e),F&&(0,_l().H)({collectionContextStore:i,environment:I,incrementLimitArgs:{isFullScreen:d,currentResultCount:F.blockIds.length,groupsPointer:E.groupsPointer,incrementLimitsInRelatedGroups:!1}}),(0,qd().K)(I))}),[i,I,E,d,F]),je=(0,W().Oz)(i),Me=(0,y().IS)((e=>{const{button:t,buttonInner:o,icon:n}=(0,z().BJ)({theme:e,hideTextWithTransition:pe,hideTextWithoutTransition:pe&&ke});return{wrapper:{position:"relative",marginBottom:12},iconStyle:n,viewAllButton:{borderTop:`1px solid ${e.border.secondaryTranslucent}`,paddingTop:6,paddingBottom:6},loadMoreButton:{...t,borderBottom:`1px solid ${e.border.secondaryTranslucent}`,whiteSpace:"break-spaces"},loadMoreButtonHovered:{...N?{background:e.whiteButtonBackground}:{background:e.tableRowHoveredBackground}},loadMoreButtonInner:{...o,position:"sticky",insetInlineStart:S+10},text:{color:e.text.tertiary,flexGrow:1,fontSize:A?mi().hN:mi().Mi},addRowButtonWrapper:{...t,display:"flex",alignItems:"center",gap:4,position:"sticky",insetInlineStart:S+2,width:"fit-content",paddingInlineStart:2,paddingInlineEnd:2},addRowButton:{display:"inline-flex",height:28,borderRadius:6,paddingInlineStart:6,paddingInlineEnd:8,background:(null==je?void 0:je.background)||(u?e.background.elevated:e.background.primary)},addRowButtonHovered:{background:e.buttonHoveredBackground},addRowButtonInner:{...o,fontSize:A?mi().hN:mi().Mi},linkExistingButton:{paddingInlineStart:6,paddingInlineEnd:8,borderRadius:6},linkExistingButtonInner:{display:"flex",alignItems:"center",gap:8,fontSize:A?mi().hN:mi().Mi,height:28,color:e.text.tertiary},linkExistingIcon:{width:A?Se().Ev.default:Se().Ev.sm,height:A?Se().Ev.default:Se().Ev.sm,fill:e.icon.tertiary},aggregationRow:{...(!O||te)&&{opacity:0,pointerEvents:"none",insetInlineStart:0,insetInlineEnd:0}},spinner:{marginTop:1,marginInlineStart:8,marginInlineEnd:8}}}),[pe,ke,N,S,null==je?void 0:je.background,u,A,O,te]),Pe=(0,r.useCallback)((e=>(0,Ce.jsx)(_p,{args:e,store:C,collectionContextStore:i,collectionViewFormat:J,blockPropertyValueOverlayStore:n,groupFormat:c,groupsPointer:V,propertyFormats:q,schema:b,canDrag:xe,disabled:l,titleColumnIndex:X,onShiftEnter:Ie,frozoneProps:be,isInHomeWidget:te,isFullScreen:d,isInEphemeralView:re,paddingLeft:S,paddingRight:v,headerWidth:k,shouldShowShimmer:K})),[C,i,J,n,c,V,q,b,xe,l,X,Ie,be,te,d,re,S,v,k,K]);return E?(0,Ce.jsxs)("div",{style:Me.wrapper,children:[(0,Ce.jsx)(Ju,{store:C,format:J,groupFormat:c,schema:b,query:f,collectionContextStore:i,isInPeekRenderer:u,minWidth:p,paddingBottom:g,paddingLeft:S,paddingRight:v,blockPropertyValueOverlayStore:n,resultStore:E.reducerResultStore,showPropertyFormats:q,showRightActions:!re&&!ie,showHoverActionsStore:x,allowHidingTitle:!1,tableStore:w,formatKey:"table_properties",disabled:l||!G.canConfigureBlock,disableTopBorder:!0,height:Kn().sH,frozoneProps:be,isInHomeWidget:te,hasMoreReducerResults:Boolean(null==F?void 0:F.hasMore)}),(0,Ce.jsx)(jp,{store:C,collectionContextStore:i,minWidth:p,blockPropertyValueOverlayStore:n,showPropertyFormats:q,disabled:!U,groupFormat:c,tableStore:w,paddingLeft:S,render:Pe}),K?(0,Ce.jsx)(Pp,{isFullScreen:d,hasGroups:void 0!==c,propertyWidths:Y,hasPartialResults:D,hasSearchQuery:se,frozoneProps:be}):void 0,pe?(0,Ce.jsx)(iu,{collectionContextStore:i,handleAddRowClick:Ae,numberOfBlankRows:me,propertyFormats:q,isBlockPropertyValueOverlayOpen:ke,query:f}):void 0,(0,Ce.jsx)("div",{style:{width:ee}}),ve?te?(0,Ce.jsx)(Ol().jJ,{groupsPointer:V,store:C,collectionContextStore:i,format:a,isFullScreen:d,incrementLimitsInRelatedGroups:!1,style:Me.viewAllButton}):(0,Ce.jsx)(Ro().Ay,{onMouseDown:Ai().t,onClick:Te,disabled:N,hoveredStyle:Me.loadMoreButtonHovered,style:Me.loadMoreButton,children:(0,Ce.jsxs)("span",{style:Me.loadMoreButtonInner,children:[(0,wl().arrowStraightDownSmallIcon)(Me.iconStyle),(0,Ce.jsx)("div",{style:Me.text,children:(0,Ce.jsx)(he().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),N?(0,Ce.jsx)("div",{style:Me.spinner,children:(0,Ce.jsx)(qi().A,{size:"sm"})}):U&&(0,Ce.jsx)(Xd().w,{collectionContextStore:i,format:a})]})}):void 0,de&&!pe?(0,Ce.jsxs)("div",{style:Me.addRowButtonWrapper,children:[(0,Ce.jsx)(Ro().Ay,{onClick:Ae,onMouseDown:Ai().t,style:Me.addRowButton,hoveredStyle:Me.addRowButtonHovered,className:Vt().$0P,children:(0,Ce.jsxs)("span",{style:Me.addRowButtonInner,children:[(0,gn().plusSmallIcon)(Me.iconStyle),(0,Ce.jsx)(Ca().w,{collectionContextStore:i})]})}),le?(0,Ce.jsx)(Dr().O,{collectionContextStore:i,groupFormat:c,renderLinkButton:e=>(0,Ce.jsx)(Ro().Ay,{style:Me.linkExistingButton,...e,children:(0,Ce.jsxs)("span",{style:Me.linkExistingButtonInner,children:[(0,rr().arrowDiagonalUpRightSmallIcon)(Me.linkExistingIcon),(0,Ce.jsx)(he().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})}):void 0]}):void 0,ye?(0,Ce.jsx)(nu,{pageCount:L,collectionContextStore:i,disabled:l||!ue,groupFormat:c,isFullScreen:d,isInPeekRenderer:u,paddingLeft:S,paddingRight:v,query:f,schema:b,showPropertyFormats:q,showRightActionsSpacer:G.canConfigureCollection,style:Me.aggregationRow}):void 0]}):null})),_p=r.memo((function(e){const{args:t,blockPropertyValueOverlayStore:o,canDrag:n,collectionContextStore:i,collectionViewFormat:l,disabled:a,frozoneProps:s,groupFormat:c,groupsPointer:d,isFullScreen:u,isInHomeWidget:p,onShiftEnter:g,propertyFormats:S,schema:v,store:f,titleColumnIndex:b,isInEphemeralView:x,paddingLeft:C,paddingRight:w,headerWidth:k,shouldShowShimmer:I}=e,A=(0,m().v3)(),T=(0,h().K8)((()=>Boolean(i.normalizedFormatStore.state.hide_table_vertical_lines)),[i.normalizedFormatStore]),j=(0,h().K8)((()=>W().f5({collectionContextStore:i})),[i]),M=(0,h().K8)((()=>f.isNonEditableState()),[f]),P=(0,te().y)(),R=(0,y().IS)((()=>({itemSelectableHalo:{borderRadius:3,zIndex:86,...P&&{borderRadius:0,inset:0,bottom:1}},itemSelectableStyle:{display:"flex",height:"calc(100% + 2px)"}})),[P]),_=(0,r.useCallback)((()=>R.itemSelectableStyle),[R]),B=(0,r.useCallback)((e=>{const{store:t,parentStore:n,subitemPath:r,indentLevel:l}=e;if(n)return(0,Ce.jsx)(Td,{store:t,collectionStore:n,subitemPath:r,indentLevel:l,collectionContextStore:i,disabled:a,groupsPointer:d,paddingLeft:C,onSubitemCreate:e=>{if(!o)return;i.registerCallbackForItemMounted(e,(()=>{dr().ho({isNewBlock:!0,environment:A,blockPropertyValueOverlayStore:o,store:e,property:"title",surface:"table",collectionContextStore:i})}))}})}),[o,i,a,A,d,C]),V=(0,h().K8)((()=>{const e=i.collectionViewBlockStore();return!(!e||i.isFullScreenStore.state)&&(0,Yd().d1)(e)}),[i]),E=(0,h().K8)((()=>(0,vt().v2)(c,i)),[c,i]),F=(0,h().K8)((()=>{const e=Zd().A.state;if(e.isActive)return(0,z().yR)(e.selection,S.length,E.length)}),[E.length,S.length],{useDeepEqual:!0}),O=null==s?void 0:s.frozenIndex,D=(0,h().K8)((()=>W().qi(O)),[O]),[L,K]=(0,r.useMemo)((()=>void 0!==O?[S.slice(0,O+1),S.slice(O+1)]:[[],S]),[O,S]),H=(0,h().K8)((()=>{var e;return Boolean(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("table_wrap").getValue())}),[i]),N=(0,h().K8)((()=>{var e;return Boolean("timeline"===(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType())||!H&&!S.some((e=>e.wrap)))}),[i,S,H]),G=(0,h().K8)((()=>{const e=i.permissionScopesStore.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[i.permissionScopesStore]),$=(0,h().K8)((()=>{var e;return!p&&"timeline"!==(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType())}),[i,p]),U=(0,Gd().DV)(),q=(0,r.useMemo)((()=>({schema:v,collectionContextStore:i,propertyFormats:S,onPropertyTab:t.onPropertyTab,onPropertyUntab:t.onPropertyUntab,onPropertyEnter:t.onPropertyEnter,onPropertyClick:t.onPropertyClick,onPropertyEsc:t.onPropertyEsc,onPropertyBgClick:t.onPropertyBgClick,onPropertyContextMenu:t.onPropertyContextMenu,onOpenProperty:t.onOpenProperty,disabled:a,blockPropertyValueOverlayStore:o,disableCellBorderRight:T,disableHorizontalEdgeScroll:!1,disableLastCellBorderRight:M,disableTableWrap:!1,onShiftEnter:g,titleColumnIndex:b,groupFormat:c,frozoneProps:s,shouldShowMultiSelectCheckbox:j,isInHomeWidget:p,isCollectionViewBlockSelected:V,allRows:E,isInEphemeralView:x,normalizedTableSelection:F,unfrozenIndexAddendum:D,frozenPropertyFormats:L,unfrozenPropertyFormats:K,tableWrap:H,shouldSetCellHeight:N,isNonEditable:G,shouldShowRightActionSpacer:$,hasColumnVirtualizer:U})),[t.onOpenProperty,t.onPropertyBgClick,t.onPropertyClick,t.onPropertyContextMenu,t.onPropertyEnter,t.onPropertyEsc,t.onPropertyTab,t.onPropertyUntab,o,i,a,T,g,S,v,b,c,s,j,M,p,V,E,x,F,D,L,K,H,N,G,$,U]),X=u;return(0,Ce.jsx)(la,{collectionContextStore:i,groupsPointer:d,format:l,canDrag:n,itemProps:q,canDrop:!0,renderItem:yp,disabled:a,direction:ra.Vertical,getItemSelectableStyle:_,itemSelectableHaloStyle:R.itemSelectableHalo,shouldShowHoverMenu:!0,analyticsName:"table",emptyDroppableSize:0,touchDragOnly:!0,onSelectableEnter:t.onSelectableEnter,blockPropertyValueOverlayStore:o,titleColumnIndex:b,nestedCreateSubitemButton:B,virtualizeResults:X,paddingLeft:C,paddingRight:w,headerWidth:k,shouldShowShimmer:I})}),tr().A),Bp=r.memo((function(e){const{store:t,paddingBottom:o,paddingLeft:n,paddingRight:i,collectionContextStore:l,format:a,schema:s,disabled:c,isFullScreen:d,isRootChild:u,isInPeekRenderer:p,isPreviewing:g,query:S,showHoverActionsStore:v,blockPropertyValueOverlayStore:f,minWidth:b,placementStore:x,headerWidth:C}=e,w=(0,m().v3)(),k=(0,h().uB)(void 0,Nd),I=(0,r.useRef)(null),A=a.collection_group_by,T=d&&!A,j=(0,h().K8)((()=>(0,z().GW)(a,k)),[a,k]),M=(0,h().K8)((()=>(0,W().mM)(l,d)),[l,d]),P=(0,h().O$)(l.isInHomeWidgetStore),R=(0,h().K8)((()=>Boolean(l.viewsModuleContextStore.getViewModuleType())),[l]),_=(0,h().K8)((()=>{const e=l.settingsStore.state.open,t="sidebar"===x.state;return e&&t}),[l.settingsStore,x]),B=r.useCallback((e=>{const t=l.isLoadingStore.state,o=l.groupsStore.getGroupState([]),n=null==o?void 0:o.reducerResultStore.state;e<ko().B.incrementScrollOffset&&n&&!t&&n.hasMore&&(l.infiniteScrollLongTaskObserver.observe(),(0,_l().H)({collectionContextStore:l,environment:w,incrementLimitArgs:{isFullScreen:d,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}}))}),[l,w,d]),V=(0,y().IS)((()=>({selectable:{position:"relative",marginInlineEnd:_?zn().vE:void 0},container:{position:"relative",float:"inline-start",minWidth:"100%",WebkitUserSelect:"none",fontVariantNumeric:"lining-nums tabular-nums",paddingBottom:o,paddingInlineStart:n,paddingInlineEnd:i,marginTop:4}})),[o,n,i,_]),E=(0,Ee().Zp)();return(0,Vl().A)((e=>{const r=(0,Ce.jsx)(jt().Ay,{location:"collectionTableView",store:t,shouldShowHalo:!d&&!P&&!g,canSelect:!d&&!R,disablePointerEvents:null==E?void 0:E.disableContentPointerEvents,analyticsName:"table",style:V.selectable,...e,children:A?(0,Ce.jsx)(Vp,{collectionContextStore:l,store:t,format:a,schema:s,query:S,isFullScreen:d,isRootChild:u,isInPeekRenderer:p,paddingLeft:n,paddingBottom:o,paddingRight:i,minWidth:b,tableStore:k,showHoverActionsStore:v,blockPropertyValueOverlayStore:f,disabled:c,headerWidth:C}):(0,Ce.jsx)(Fp,{collectionContextStore:l,store:t,format:a,schema:s,query:S,isFullScreen:d,isInPeekRenderer:p,paddingLeft:n,paddingRight:i,headerWidth:C,paddingBottom:o,minWidth:b,tableStore:k,showHoverActionsStore:v,blockPropertyValueOverlayStore:f,disabled:c,groupFormat:void 0})});return(0,Ce.jsx)("div",{className:Vt().EOV,style:V.container,ref:I,children:(0,Ce.jsxs)(na.Provider,{value:I,children:[A?(0,Ce.jsx)(Ud,{collectionContextStore:l,tableProperties:j,paddingLeft:n,paddingRight:i,children:r}):(0,Ce.jsx)(xi,{nodeRef:I,children:(0,Ce.jsx)(Ud,{collectionContextStore:l,tableProperties:j,paddingLeft:n,paddingRight:i,children:r})}),M||T?void 0:(0,Ce.jsx)(Bl().A,{onChange:e=>B(e)})]})})}))})),Vp=r.memo((function({collectionContextStore:e,store:t,format:o,schema:n,query:i,disabled:l,isFullScreen:a,paddingLeft:s,paddingRight:c,isRootChild:d,isInPeekRenderer:u,showHoverActionsStore:p,blockPropertyValueOverlayStore:g,minWidth:S,paddingBottom:h,tableStore:y,headerWidth:v}){const f=(0,m().v3)(),b=(0,r.useCallback)((()=>({})),[]),x=(0,r.useCallback)(((t,o)=>{if(f.device.isMobile)Zn().uK({environment:f,store:t,pageVisitSource:$().y8.Create});else{const{groupFormat:n}=o,r=n?[n]:[],i=e.groupsStore.getGroupState(r),l="collectionTypedView"===e.contextType;Jn().VU({environment:f,store:t,peekMode:(0,W().hH)(e),showMoveTo:l,resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:e,pageVisitSource:$().y8.Create})}}),[e,f]);return(0,Ce.jsx)(Ps,{reducerId:Yn().Tt,store:t,collectionContextStore:e,disabled:l,isFullScreen:a,isRootChild:d,paddingLeft:s,paddingRight:c,stickyLeft:!0,headerWidth:v,renderGroupResults:r=>(0,Ce.jsx)(Fp,{store:t,format:o,schema:n,query:i,collectionContextStore:e,showHoverActionsStore:p,isFullScreen:a,isInPeekRenderer:u,disabled:l,blockPropertyValueOverlayStore:g,minWidth:S,paddingBottom:h,paddingLeft:s,paddingRight:c,headerWidth:v,tableStore:y,groupFormat:r}),getGroupStyle:b,renderHeader:e=>(0,Ce.jsx)(Ep,{args:e,isInPeekRenderer:u}),onGroupHeaderAddItem:(e,t,o)=>{x(e,o)}})})),Ep=r.memo((function({args:e,isInPeekRenderer:t}){const{collectionContextStore:o}=e,n=(0,h().O$)(o.isInHomeWidgetStore),r=(0,y().IS)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${t?e.background.elevated:e.background.primary}`}})),[t]);return(0,Ce.jsx)(Sl,{...e,height:n?Go().ag:Kn().n1,paddingTop:0,toggleClosedMarginBottom:8,stickyStyle:r.stickyStyle})})),Fp=r.memo((function({groupFormat:e,store:t,format:o,schema:n,query:r,collectionContextStore:i,showHoverActionsStore:l,isFullScreen:a,isInPeekRenderer:s,disabled:c,blockPropertyValueOverlayStore:d,minWidth:u,paddingBottom:p,paddingLeft:m,paddingRight:g,headerWidth:S,tableStore:y}){const v=(0,h().uB)(y,Nd);return(0,h().K8)((()=>i.groupsStore.getGroupState(e?[e]:[])),[i,e])?(0,Ce.jsx)(Rp,{tableStore:v,groupFormat:e,store:t,format:o,schema:n,query:r,collectionContextStore:i,showHoverActionsStore:l,isFullScreen:a,isInPeekRenderer:s,disabled:c,blockPropertyValueOverlayStore:d,minWidth:u,paddingBottom:p,paddingLeft:m,paddingRight:g,headerWidth:S}):null}));var Op=()=>o(317406),Dp=()=>o(839106);class Lp extends f().Store{constructor(){super("groupsReducerResultStore")}getInitialState(){}}function zp({collectionContextStore:e,isFullScreen:t,paddingBottom:o,createDateProperty:n}){const r=(0,h().O$)(e.canConfigureBlockStore),i=(0,y().IS)((()=>({container:{paddingBottom:t?void 0:o}})),[t,o]);return(0,Ce.jsx)(zs().Ay,{style:i.container,title:(0,Ce.jsx)(he().sA,{defaultMessage:"No date property",id:"database.timelineView.missingDatePropertyTitle"}),description:r?(0,Ce.jsx)(he().sA,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Timeline view.",id:"database.timelineView.missingDateProperty",values:{opensettingslink:e=>(0,Ce.jsx)(zs().P6,{onClick:()=>{n()},children:e})}}):(0,Ce.jsx)(he().sA,{defaultMessage:"Timeline views require a date property in order to display.",id:"database.timelineView.missingDatePropertyNoPermissions"})})}var Kp=()=>o(396182);function Hp({timelineState:e}){const t=(0,Kp().I)(),o=(0,r.useCallback)((()=>{0===(new Date).getSeconds()&&t("TimelineBackground","TimelineBackground/handleSeconds")}),[t]);(0,r.useEffect)((()=>{const e=setInterval(o,1e3);return()=>clearInterval(e)}),[o]);const n=(0,h().O$)(e.zoomLevelStore),{startTimestamp:i,endTimestamp:l}=(0,h().O$)(e.currentRangeStore);return(0,Ce.jsxs)("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"hidden",cursor:"default"},children:[(0,Ce.jsx)(Up,{zoomLevel:n,startTimestamp:i,endTimestamp:l}),(0,Ce.jsx)(qp,{zoomLevel:n,startTimestamp:i,endTimestamp:l}),(0,Ce.jsx)($p,{zoomLevel:n,startTimestamp:i})]})}const Wp=r.memo(Hp,tr().A),Np=r.memo((function({start:e,zoomLevel:t,startTimestamp:o}){const n=(0,y().IS)((n=>{const r=e.plus({day:2}).startOf("day"),i=(0,Hn().w0)(t,e.valueOf()-o);return{weekendIndicator:{position:"absolute",insetInlineStart:i,width:(0,Hn().w0)(t,r.valueOf()-o)-i,height:"100%",background:n.timelineDarkerBackground}}}),[e,o,t]);return(0,Ce.jsx)("div",{style:n.weekendIndicator},e.valueOf())}),tr().A),Gp=r.memo((function({time:e,zoomLevel:t,startTimestamp:o}){const n=(0,y().IS)((n=>({verticalDivider:{position:"absolute",insetInlineStart:(0,Hn().w0)(t,e-o),height:"100%",borderInlineEnd:`1px solid ${n.regularDividerColor}`}})),[o,e,t]);return(0,Ce.jsx)("div",{style:n.verticalDivider},e)}),tr().A),$p=r.memo((function({zoomLevel:e,startTimestamp:t}){const o=(0,y().IS)((o=>{const r=n().c9.now().startOf("minute");return{nowVerticalDivider:{position:"absolute",insetInlineStart:Math.floor((0,Hn().w0)(e,r.valueOf()-t)),height:"100%",borderInlineEnd:`1px solid ${o.timelineRed}`}}}),[t,e]);return(0,Ce.jsx)("div",{style:o.nowVerticalDivider})}),tr().A),Up=r.memo((function({zoomLevel:e,startTimestamp:t,endTimestamp:o}){const{showWeekendIndicators:r}=Hn().eM[e];if(!r)return null;let i=(0,Hn().DY)(n().c9.fromMillis(t),"day");const l=[];for(;i.valueOf()<o;)6===i.weekday&&l.push((0,Ce.jsx)(Np,{start:i,zoomLevel:e,startTimestamp:t},i.valueOf())),i=(0,Hn().Vz)(i,"day");return(0,Ce.jsx)(Ce.Fragment,{children:l})}),tr().A),qp=r.memo((function({zoomLevel:e,startTimestamp:t,endTimestamp:o}){const{verticalDividerUnit:r}=Hn().eM[e];if(!r)return null;const i=[];let l=(0,Hn().DY)(n().c9.fromMillis(t),r);for(;l.valueOf()<o;)i.push((0,Ce.jsx)(Gp,{time:l.valueOf(),zoomLevel:e,startTimestamp:t},l.valueOf())),l=(0,Hn().Vz)(l,r);return(0,Ce.jsx)(Ce.Fragment,{children:i})}),tr().A);var Xp=()=>o(324254);const Yp=r.memo((function(e){const{zoomLevel:t,onChange:o}=e,n=(0,m().Y0)(),i=(0,r.useCallback)((e=>(0,Ce.jsx)(_o().p,{size:"sm",colorPalette:"gray",iconTrailing:Xp().arrowChevronSingleDownSmallIcon,...e,children:(0,Ce.jsx)(Qp,{zoomLevel:t})})),[t]),l=(0,r.useCallback)((e=>(0,Ce.jsx)(Zp,{parent:e,zoomLevel:t,onChange:o})),[t,o]);return(0,Ce.jsx)(Ae().A,{popupType:n.isMobile?_e().nl.SlideUp:_e().nl.Popup,originGap:8,renderOrigin:i,render:l})})),Qp=r.memo((function(e){const{zoomLevel:t}=e;return"hours"===t?(0,Ce.jsx)(he().sA,{id:"database.timelineView.zoomLevel.hours",defaultMessage:"Hours"}):"day"===t?(0,Ce.jsx)(he().sA,{id:"database.timelineView.zoomLevel.day",defaultMessage:"Day"}):"week"===t?(0,Ce.jsx)(he().sA,{id:"database.timelineView.zoomLevel.week",defaultMessage:"Week"}):"bi_week"===t?(0,Ce.jsx)(he().sA,{id:"database.timelineView.zoomLevel.biWeek",defaultMessage:"Bi-week"}):"month"===t?(0,Ce.jsx)(he().sA,{id:"database.timelineView.zoomLevel.month",defaultMessage:"Month"}):"quarter"===t?(0,Ce.jsx)(he().sA,{id:"database.timelineView.zoomLevel.quarter",defaultMessage:"Quarter"}):"year"===t?(0,Ce.jsx)(he().sA,{id:"database.timelineView.zoomLevel.year",defaultMessage:"Year"}):"5_years"===t?(0,Ce.jsx)(he().sA,{id:"database.timelineView.zoomLevel.years",defaultMessage:"5 Years"}):void(0,A().HB)(t)})),Zp=r.memo((function(e){const{zoomLevel:t,onChange:o,parent:n}=e,{isMobile:i}=(0,m().Y0)(),l=(0,r.useMemo)((()=>[{key:"calendar by section",render:e=>(0,Ce.jsx)(Be().A,{...e}),items:Aa().Ui.map((e=>{const t={key:e,render:t=>(0,Ce.jsx)(Ie().A,{...t,title:(0,Ce.jsx)(Qp,{zoomLevel:e})}),action:()=>{o(e),n.close()}};return t}))}]),[o,n]),a=(0,r.useCallback)((e=>{const o=i?{menuType:Fe().gu.Modal,title:(0,Ce.jsx)(he().sA,{defaultMessage:"Select a zoom level",id:"database.timelineView.mobileTimelineZoomPicker.title"}),right:(0,Ce.jsx)(Re().DoneMenuText,{}),onClickRight:n.close,...e}:{menuType:Fe().gu.Popup,width:180,...e};return(0,Ce.jsx)(Me().A,{...o,children:(0,Ce.jsx)(Pe().Ay,{type:Pe().Oh.Vertical,sections:l,initialFocus:Aa().Ui.indexOf(t)})})}),[i,n.close,l,t]);return(0,Ce.jsx)(Tt().A,{capture:!0,allowEsc:!0,render:a})})),Jp=6,em=Hn().tp+Hn().lH,tm=r.memo((function({timelineState:e,scrollerLeftOffset:t,paddingLeft:i,showTable:l,isFullScreen:a,isRootChild:s,isReady:c,collectionContextStore:d,isInPeekRenderer:u,format:p,paddingRight:g}){const S=(0,y().DP)(),v=(0,m().v3)(),f=(0,h().K8)((()=>{const o=e.zoomLevelStore.state,{primaryDisplayUnit:r,secondaryDisplayUnit:s}=Hn().eM[o],c=e.scrollLeftStore.state,{startTimestamp:d}=e.currentRangeStore.state;if(void 0!==c){const e=d+(0,Hn().C1)(o,c+t+(!l&&a?i:0));return(0,Hn().DY)(n().c9.fromMillis(e),r).startOf(s).valueOf()}}),[e,t,i,l,a]),b=(0,m().Y0)(),x=(0,h().O$)(e.zoomLevelStore),C=(0,h().K8)((()=>e.outerSizeObserver.rect.state.width),[e]),{secondaryDisplayUnit:w}=Hn().eM[x],k=(0,h().K8)((()=>(0,Hn().DG)({environment:v,isFullScreen:a,isRootChild:s})),[v,a,s]),I=(0,h().O$)(d.canConfigureBlockStore),A=!l&&k&&I,T=(0,W().Oz)(d),j=(null==T?void 0:T.background)||(u?S.background.elevated:S.background.primary),M=u?S.cardContentBackgroundTransparent:S.contentBackgroundTransparent,P=(0,y().IS)((e=>({secondaryDisplayUnit:{position:"absolute",top:1,insetInlineStart:"calc(-1 * var(--sticky-horizontal-offset, 0px))",paddingInlineStart:a&&!l?t+i:t,display:"flex",alignItems:"center",height:em,paddingTop:Jp+(b.isMobile?2:0),background:j,fontSize:14,fontWeight:q().Wy.medium},outerContainer:{position:"sticky",insetInlineStart:0,width:C,zIndex:2,height:0},controlBarRight:{position:"absolute",top:1,insetInlineEnd:"var(--sticky-horizontal-offset, 0px)",paddingInlineEnd:g,display:"flex",alignItems:"center",height:em,paddingTop:Jp+1,background:j},hideTableIcon:{paddingInlineStart:4,paddingInlineEnd:4,marginInlineStart:2,marginInlineEnd:4,marginTop:b.isIOS?0:1,height:22,fill:e.icon.tertiary}})),[j,b.isIOS,b.isMobile,a,C,i,g,t,l]),R=(0,r.useRef)(null),B=(0,r.useCallback)((t=>{Op().k3({timelineState:e,environment:v,zoomLevel:t,centerTimestamp:(0,Hn().o$)(e)}),(0,Dp().z2)(v,(0,Dp().ZR)({environment:v,collectionContextStore:d,timelineState:e,isFullScreen:a,isRootChild:s}))}),[e,v,d,a,s]);return(0,Ce.jsx)(ki().g,{stickyAttachPoint:"ceiling",nodeRef:R,noPlaceholder:!0,children:(0,Ce.jsxs)("div",{style:P.outerContainer,ref:R,children:[f?(0,Ce.jsxs)("div",{style:P.secondaryDisplayUnit,children:[A?(0,Ce.jsx)(qo().A,{render:t=>(0,Ce.jsx)(_o().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i){const l=n.collectionViewStore();if(!l)return;_().createAndCommit({userAction:"TimelineControlBar.handleShowTableClick",environment:e,canUndo:!0,perform:e=>{const o=(0,Hn().iH)(t,!0);ve().zA({stores:[l],update:o,transaction:e})}}),(0,Dp().VD)(e,{...(0,Dp().ZR)({environment:e,collectionContextStore:n,timelineState:o,isFullScreen:r,isRootChild:i}),show:!0})}(v,p,e,d,a,s),style:P.hideTableIcon,...t,children:(0,Ce.jsx)(ie().I,{icon:o(216128).R,size:"sm",colorVariant:"secondary"})}),renderTooltip:()=>(0,Ce.jsx)(he().sA,{id:"database.timelineView.controlHeader.showTableButton.title",defaultMessage:"Show table"})}):void 0,(0,Ce.jsx)("span",{style:{paddingInlineStart:A||b.isPhone?0:a||l?16:2},children:(0,Hn().Kx)(f,w)}),c||l?void 0:(0,Ce.jsx)(om,{}),(0,Ce.jsx)("div",{style:{width:30,marginInlineEnd:-30,height:"100%",backgroundImage:`linear-gradient(calc(var(--direction) * 90deg), ${j} 20%, ${M} 100%)`}})]}):void 0,(0,Ce.jsxs)("div",{style:P.controlBarRight,children:[(0,Ce.jsx)("div",{style:{width:30,marginInlineStart:-30,height:"100%",backgroundImage:`linear-gradient(calc(var(--direction) * -90deg), ${j} 20%, ${M} 100%)`}}),(0,Ce.jsx)(xd().A,{collectionContextStore:d,entrypoint:"timeline_view"}),(0,Ce.jsx)(Yp,{zoomLevel:x,onChange:B}),(0,Ce.jsx)(_o().p,{size:"sm",colorPalette:"gray",onClick:()=>function(e,t,o,n,r,i,l){const a=t.zoomLevelStore.state,s=t.outerSizeObserver.rect.state.width,c=(0,Hn().Ho)({environment:e,paddingLeft:o,format:n,isFullScreen:r,isRootChild:i}),d=(s-c)/2,u=(0,Hn().o$)(t),p=u-(0,Hn().C1)(a,d);Op().k3({timelineState:t,environment:e,zoomLevel:a,centerTimestamp:p}),(0,Dp().i6)(e,{...(0,Dp().ZR)({environment:e,collectionContextStore:l,timelineState:t,isFullScreen:r,isRootChild:i}),type:"left"})}(v,e,i,p,a,s,d),style:{marginInlineStart:4,paddingInlineStart:4,paddingInlineEnd:4},children:(0,Ce.jsx)(ie().I,{icon:o(481975).s,size:"sm",colorVariant:"secondary"})}),(0,Ce.jsx)(_o().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i,l){const a=t.zoomLevelStore.state,s=(0,Hn().uW)({timestamp:Date.now(),environment:e,timelineState:t,paddingLeft:o,format:n});Op().k3({timelineState:t,environment:e,zoomLevel:a,centerTimestamp:s}),(0,Dp().AP)(e,{...(0,Dp().ZR)({environment:e,collectionContextStore:r,timelineState:t,isFullScreen:i,isRootChild:l})})}(v,e,i,p,d,a,s),children:(0,Ce.jsx)(he().sA,{id:"database.timelineView.controlHeader.todayButton.title",defaultMessage:"Today"})}),(0,Ce.jsx)(_o().p,{size:"sm",colorPalette:"gray",onClick:()=>function(e,t,o,n,r,i,l){const a=t.zoomLevelStore.state,s=t.outerSizeObserver.rect.state.width,c=(0,Hn().Ho)({environment:e,paddingLeft:o,format:n,isFullScreen:r,isRootChild:i}),d=(s-c)/2,u=(0,Hn().o$)(t),p=u+(0,Hn().C1)(a,d);Op().k3({timelineState:t,environment:e,zoomLevel:a,centerTimestamp:p}),(0,Dp().i6)(e,{...(0,Dp().ZR)({environment:e,collectionContextStore:l,timelineState:t,isFullScreen:r,isRootChild:i}),type:"right"})}(v,e,i,p,a,s,d),style:{paddingInlineStart:4,paddingInlineEnd:4},children:(0,Ce.jsx)(ie().I,{icon:o(906380).arrowChevronSingleRightSmallIcon,size:"sm",colorVariant:"secondary"})})]})]})})}));function om(){return(0,cs().A)(!0,400,0)?(0,Ce.jsx)(qi().A,{style:{marginInlineStart:8,marginTop:1}}):null}class nm extends f().Store{getInitialState(){return new Set}}class rm extends(()=>o(959180))().A{constructor(...e){super(...e),this.itemsRefStore=new nm}findTimelineItems(e){return this.getMembersByDOMOrder({filter:t=>e.uiContains(t.props.store)})}register(e){const t=super.register(e);return this.itemsRefStore.state.has(e)||this.itemsRefStore.setState(new Set(this.itemsRefStore.state).add(e)),t}unregister(e){if(super.unregister(e),this.itemsRefStore.state.has(e)){const t=new Set(this.itemsRefStore.state);t.delete(e),this.itemsRefStore.setState(t)}}getItemsRefStore(){return this.itemsRefStore}}const im=new rm;(0,o(852832).exposeDebugValue)("GlobalTimelineItemRegistry",im);var lm=()=>o(126912),am=()=>o(259464);const sm=15,cm=33,dm=12,um={position:"absolute",insetInlineStart:0,top:0,zIndex:86,width:"100%",height:"100%",pointerEvents:"none"};function pm(e){const{startItemPosition:t,value:o}=e;return t&&o?(o&&t&&o.left<=t.left&&(o.right<t.left?o.left=o.right:(o.left=t.left+dm,o.top=o.top-sm)),o):o}function mm(e){const{startItem:t,endItem:o,endRelationPointer:n,timelineState:i,disabled:l,isFullScreen:a,isRootChild:s,relationType:c,isUserDrawnTemp:d,isNewSubitemPlaceholder:u,renderEmitter:g}=e,S=(0,gt().ET)(),v=(0,m().v3)(),f=(0,Kp().I)(),[b,x]=(0,r.useState)(!1),C=(0,y().DP)(),[w,k]=(0,r.useState)(null),[I,A]=(0,r.useState)(null),T=(0,r.useCallback)((e=>{k(e.state)}),[]),j=(0,r.useCallback)((e=>{A(e.state)}),[]),M=(0,r.useCallback)((()=>{p().default.afterNextFlush((()=>{f("CollectionTimelineRelationArrow","CollectionTimelineRelationArrow/resetTopPositions")}))}),[f]);(0,r.useEffect)((()=>(k(t.stores.nodeStore.state),A(o?o.stores.nodeStore.state:null),t.stores.nodeStore.addListener(T),null==o||o.stores.nodeStore.addListener(j),null==g||g.addListener(M),S.filtersBarOpenStore.addListener(M),()=>{t.stores.nodeStore.removeListener(T),null==o||o.stores.nodeStore.removeListener(j),null==g||g.removeListener(M),S.filtersBarOpenStore.removeListener(M)})),[t,o,g,T,j,M,S.filtersBarOpenStore]);const P=(0,h().K8)((()=>wr().Ay.state.isDragging&&wr().Ay.state.draggedStores.includes(t.props.store)),[t]),R=(0,h().K8)((()=>o&&wr().Ay.state.isDragging&&wr().Ay.state.draggedStores.includes(o.props.store)),[o]),_=(0,h().K8)((()=>{const e=wr().Ay.state;return e.isDragging?e.currentY-e.startY:0}),[]),B=w&&w.getBoundingClientRect().y+(P?_:0),V=(0,h().K8)((()=>{const e=t.itemPositionStore.state;return B&&e?{left:e.left,right:"subitem"===c?e.left+dm:e.right,top:"subitem"===c?B+sm:B}:void 0}),[c,t.itemPositionStore,B]),E=I&&I.getBoundingClientRect().y+(R?_:0),F=(0,h().K8)((()=>{const e=E&&null!=o&&o.itemPositionStore.state?{...o.itemPositionStore.state,top:E}:void 0;return"subitem"===c?pm({startItemPosition:t.itemPositionStore.state,value:e}):e}),[o,E,c,t.itemPositionStore]),O=(0,h().O$)(t.dateValueStore),D=(0,h().K8)((()=>null==o?void 0:o.dateValueStore.state),[o]),L=(0,h().K8)((()=>void 0!==i.dragStateStore.state),[i]),z=(0,h().K8)((()=>void 0!==i.drawStateStore.state),[i]),K=(0,h().O$)(i.hoveredItemStore),H=b&&!L&&!z,W=(0,r.useCallback)((()=>{n&&!l&&Op().cd({dependency:{store:t.props.store,relationPointer:n},collectionContextStore:S,environment:v,timelineState:i,isFullScreen:a,isRootChild:s})}),[t,l,n,S,v,i,a,s]),N=(0,r.useCallback)((()=>{x(!0)}),[x]),G=(0,r.useCallback)((()=>{x(!1)}),[x]),$=(0,r.useCallback)((e=>{if(F)return(0,Ce.jsx)(gm,{topOffset:e,endPosition:F,handleCloseButtonClick:W})}),[F,W]),U=(0,h().K8)((()=>S.permissionScopesStore.state.canEditContent),[S.permissionScopesStore]),q=K===t.props.store,X=o&&K===o.props.store,Y=q||X||H||"subitem"===c?1:.7;let Q;const Z=(0,h().K8)((()=>t.props.store.canEdit()),[t.props.store]),J=(0,h().K8)((()=>"subitem"!==c&&(Z&&("collectionTypedView"===S.contextType||U))),[c,Z,S,U]);"subitem"===c?Q=C.collectionUnsetDependencyArrow:O&&D&&(Q=O<=D?C.collectionValidDependencyArrow:C.text.uiRedSecondary);const ee=(0,y().IS)((()=>({svgStyle:{zIndex:"dependency"===c&&(H||X)?86:83}})),[c,H,X]);return V?d?(0,Ce.jsx)(Sm,{startPosition:V,timelineState:i}):u?(0,Ce.jsx)(hm,{startPosition:V,timelineState:i}):t!==o&&F?(0,Ce.jsx)(ym,{startPosition:V,endPosition:F,strokeOpacity:Y,strokeColorOverride:Q,svgStyle:ee.svgStyle,cornerRadiusOverride:"subitem"===c?8:void 0,relationType:c,handleMouseMove:N,handleMouseLeave:G,renderChildren:J&&H?$:void 0}):null:null}function gm(e){const{topOffset:t,endPosition:o,handleCloseButtonClick:n}=e,r=(0,y().IS)((e=>({icon:{background:e.white,borderRadius:5,fill:e.red.icon.accentPrimary,height:Se().Ev.sm,width:Se().Ev.sm}})),[]);return(0,Ce.jsx)(Ce.Fragment,{children:(0,Ce.jsx)("foreignObject",{width:16,height:16,x:o.left-16,y:o.top-t+8,style:{cursor:"pointer",pointerEvents:"all"},onClick:n,children:(0,lm().xMarkCircleFillSmallIcon)(r.icon)})})}function Sm(e){const{startPosition:t,timelineState:o}=e,n=(0,h().K8)((()=>{const e=o.drawStateStore.state;if(!e||void 0===e.xOffsetPx||void 0===e.yOffsetPx)return;return{left:t.right+e.xOffsetPx+18,top:t.top+e.yOffsetPx}}),[t,o.drawStateStore]);return n?(0,Ce.jsx)(ym,{startPosition:t,endPosition:n,strokeOpacity:1,relationType:"dependency"}):null}function hm(e){var t;const{startPosition:o,timelineState:n}=e,r=(0,y().DP)(),i=(0,h().O$)(n.dateRangePlaceholderStore),l=(0,h().K8)((()=>null!=i&&i.active?i.date:void 0),[i]),a=null!=i&&i.active?null===(t=i.newTimelineItemProps)||void 0===t?void 0:t.subitemPath:void 0,s=a?a[a.length-1].children.length:0,c=o.top+s*cm+sm+5,d=(0,h().K8)((()=>{const e=(0,Hn().BD)({timelineState:n,dateValue:l,placeholderDate:l,subitemPlaceholderDate:void 0}),t=c&&e?{...e,top:c}:void 0;return pm({startItemPosition:o,value:t})}),[l,c,o,n]);return d?(0,Ce.jsx)(ym,{startPosition:o,endPosition:d,strokeOpacity:1,strokeColorOverride:r.collectionUnsetDependencyArrow,relationType:"subitem"}):null}function ym(e){const{startPosition:t,endPosition:o,strokeColorOverride:n,cornerRadiusOverride:i,strokeOpacity:l,relationType:a,svgStyle:s,handleMouseMove:c,handleMouseLeave:d}=e,u=(0,gt().ET)(),p=(0,y().DP)(),[m,g]=(0,r.useState)(0),S=t.right,v=t.top+sm-m,f=o.left-3,b=o.top+sm-m,x=(0,h().K8)((()=>{if(n)return n;return(0,Hn().tH)(u)&&t.right&&o.left?t.right<o.left?p.collectionValidDependencyArrow:p.text.uiRedSecondary:p.collectionUnsetDependencyArrow}),[u,o.left,t.right,n,p]);return(0,Ce.jsx)("svg",{style:{...um,...s},ref:e=>{e&&g(e.getBoundingClientRect().top)},children:(0,Ce.jsx)(am().A,{startPoint:{x:S,y:v},endPoint:{x:f,y:b},style:{stroke:x,strokeWidth:Hn().cC,strokeOpacity:l},useRightAngles:"subitem"===a,showArrowHead:"dependency"===a&&!e.renderChildren,cornerRadiusOverride:i,handleMouseMove:c,handleMouseLeave:d,children:e.renderChildren?e.renderChildren(m):void 0})})}function vm(e){const{timelineState:t,disabled:o,isReady:n,isFullScreen:i,isRootChild:l,renderEmitter:a}=e,s=(0,gt().ET)(),c=(0,r.useCallback)((()=>{t.drawStateStore.setState(void 0)}),[t.drawStateStore]),d=(0,h().K8)((()=>s.collectionViewBlockStore()),[s]),u=(0,h().K8)((()=>s.settingsStore.state.open),[s]);if((0,r.useEffect)((()=>{var e;!u&&null!==(e=t.drawStateStore.state)&&void 0!==e&&e.tryToCompleteDrawnArrow&&c()}),[u,t.drawStateStore,c]),!n||!d)return null;const p=im.findTimelineItems(d);return(0,Ce.jsx)(Ce.Fragment,{children:p.map((e=>{const{store:n,groupFormat:s}=e.props,c=null==s?void 0:s.value,d=c?(0,Qn().AC)(c):"noGroup";return(0,Ce.jsxs)(r.Fragment,{children:[(0,Ce.jsx)(fm,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:l,renderEmitter:a,relationType:"dependency"},`${n.id}-${d}-${n.key}-dependency`),(0,Ce.jsx)(fm,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:l,renderEmitter:a,relationType:"subitem"},`${n.id}-${d}-${n.key}-subitem`)]},`${n.id}-${d}-${n.key}`)}))})}function fm(e){const{startItem:t,timelineState:o,disabled:n,isFullScreen:i,isRootChild:l,relationType:a,renderEmitter:s}=e,{store:c,schema:d}=t.props,u=(0,gt().ET)(),p=(0,h().K8)((()=>"dependency"===a?o.drawStateStore.state:void 0),[o.drawStateStore,a]),m=(0,h().K8)((()=>(null==p?void 0:p.startStore)===c),[c,p]),g=(0,h().K8)((()=>m&&!(null!=p&&p.tryToCompleteDrawnArrow)),[p,m]),S=(0,h().K8)((()=>"dependency"===a?m&&p?p.temporaryDependencyRelationPointers:(0,Hn().GW)(u,c,d):"subitem"===a?(0,Hn().s0)(u,c,d):[]),[a,m,p,u,c,d]),y=(0,h().K8)((()=>u.collectionViewBlockStore()),[u]),v=(0,h().K8)((()=>{var e;const n=o.dateRangePlaceholderStore.state;if("subitem"!==a||null==n||!n.active||!n.newTimelineItemProps)return;const r=n.newTimelineItemProps.subitemPath;return(r?null===(e=r[r.length-1])||void 0===e?void 0:e.value.store:void 0)===t.props.store?n:void 0}),[a,t.props.store,o.dateRangePlaceholderStore]),f=(0,h().K8)((()=>[...im.getItemsRefStore().state]),[]);return y?(0,Ce.jsxs)(Ce.Fragment,{children:[S.map((e=>{if(c.id===e.id)return null;const d=f.filter((t=>t.props.store.id===e.id));return(0,Ce.jsx)(r.Fragment,{children:d.map((r=>{const c=r.props.store,d=r.props.groupFormat;return(0,Ce.jsx)(mm,{startItem:t,endItem:r,endRelationPointer:e,timelineState:o,disabled:n,isFullScreen:i,isRootChild:l,renderEmitter:s,relationType:a},`${c.id}-${null==d?void 0:d.value.value}-${c.key}`)}))},e.id)})),"dependency"===a&&g?(0,Ce.jsx)(mm,{isUserDrawnTemp:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:l,relationType:"dependency"}):void 0,"subitem"===a&&v?(0,Ce.jsx)(mm,{isNewSubitemPlaceholder:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:l,relationType:"subitem"}):void 0]}):null}var bm=()=>o(106150);function xm({collectionContextStore:e,isFullScreen:t,disabled:o,format:n,showTable:i,canEditCollectionTimeline:l}){return(0,r.useCallback)((r=>{const{groupFormat:a,groupsDisplayState:s}=r,c=n.collection_group_by,d=e.groupsStore.getGroupState(a),u=Boolean(a&&!(null!=d&&d.toggleStateStore.state)),{currentGroups:p,visibleGroups:m,hiddenGroups:g}=s,S=function(e,t,o,n){if(!e)return!0;const r=o.indexOf(e);return!t&&!o.find(((e,t)=>{if(t<r){const t=n.groupsStore.getGroupState([e]);return null==t?void 0:t.toggleStateStore.state}return!1}))}(a,u,p,e),h=null==d?void 0:d.reducerResultStore.state,y=W().XQ({collectionContextStore:e,reducerResult:h,isFullScreen:t}),v=a===m[m.length-1],f=(0,di().Zl)(s,e,!1),b=e.permissionScopesStore.state,x=v&&!o&&b.canConfigureBlock&&c&&(0,Qn().pP)(c,b.canConfigureCollection),C=h&&0===h.blockIds.length;return{groupHeader:Boolean(a&&(!i||!S)),tableHeaderRow:Boolean(i&&!u&&!S),tableAggregationRow:Boolean(i&&!u),addItemRow:Boolean(l&&!u),hiddenGroupsButton:Boolean(v&&g.length>0),groupsLoadMoreButton:Boolean(v&&f),loadMoreButton:Boolean(!u&&y),tableEmptyRow:Boolean(i&&!u&&C),extraGroupMarginBottom:Boolean(i&&u),addGroupButton:Boolean(x)}}),[l,e,o,n.collection_group_by,t,i])}const Cm=function({store:e,collectionContextStore:t,groupFormat:o}){const n=(0,m().v3)(),r=(0,h().K8)((()=>wm(e)),[e]),{value:i}=(0,ft().fJ)(Rt().T.formulas),{value:l}=(0,ft().fJ)(yt().VI.duplicateActions);return(0,Ce.jsx)(jt().Ay,{store:e,style:{width:"100%",height:bm().V+1},canDropBelow:!0,canNativeDropBelow:!0,shouldShowDropZone:!0,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,canInsertAbove:!0,canInsertBelow:!0,onInsertBelow:r?km(r,n,e,t,o):void 0,onInsertAbove:r?Im(r,n,e,t,o):void 0,onSelectableDrop:r=>function(e,t,o,n,r,i,l){const{droppedDirection:a,droppedStores:s,duplicate:c}=e,d=wm(o);if(!d)return;const u=n.subitemTreeStore.state,p=(0,yr().Qe)(u.children,(e=>e.value.store===o)),m=Wt().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Wt().default.DO_NOT_USE_measureAfterNextFlushLegacy(m,{environment:t,getData:()=>Et().tv({collectionContextStore:n,is_native_drop:!1,is_empty:!1})});const g="collectionTypedView"===n.contextType;_().createAndCommit({userAction:"TimelineDroppableRow.handleDrop",environment:t,canUndo:!0,perform:e=>{Er({environment:t,collectionStore:g?void 0:d,targetStore:o,droppedDirection:a,collectionContextStore:n,groupsPointer:r?[r]:[],droppedStores:s,duplicate:c,transaction:e,subitemPath:p,collapsedGroup:!1,formulasModule:i,duplicateActions:l})}})}(r,n,e,t,o,i,l),onNativeDrop:r=>function(e,t,o,n,r,i,l){const{files:a,droppedDirection:s}=e,c=wm(r);if(!c)return;const d=o.collectionViewBlockStore(),u=Wt().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Wt().default.DO_NOT_USE_measureAfterNextFlushLegacy(u,{environment:t,getData:()=>Et().tv({collectionContextStore:o,is_native_drop:!0,is_empty:!1})}),d&&_().createAndCommit({userAction:"TimelineDroppableRow.handleNativeDrop",environment:t,canUndo:!0,perform:e=>{Hl({environment:t,collectionStore:c,targetStore:d,droppedDirection:s,collectionContextStore:o,groupsPointer:n?[n]:[],files:a,transaction:e,formulasModule:i,duplicateActions:l})}})}(r,n,t,o,e,i,l),onRemove:t=>function(e,t){const{transaction:o}=e,n=wm(t);if(!n)return;Lo().by({childStore:t,transaction:o})}(t,e),analyticsName:"timeline"},e.id)};function wm(e){return e.getAssociatedCollectionStore()}function km(e,t,o,n,r){return i=>{const{insertStores:l,transaction:a}=i,s="collectionTypedView"===n.contextType;return(0,Yl().D)({environment:t,collectionStore:s?void 0:e,collectionContextStore:n,groupsPointer:r?[r]:[],insertStores:l,store:o,before:!1,transaction:a})}}function Im(e,t,o,n,r){return i=>{const{insertStores:l,transaction:a}=i,s="collectionTypedView"===n.contextType;return(0,Yl().D)({environment:t,collectionStore:s?void 0:e,collectionContextStore:n,groupsPointer:r?[r]:[],insertStores:l,store:o,before:!0,transaction:a})}}function Am({store:e,groupFormat:t,collectionContextStore:o,canEdit:n,disabled:i,format:l,paddingLeft:a,paddingRight:s,headerWidth:c,shouldShowShimmer:d}){const u=(0,m().v3)(),{value:p}=(0,ft().fJ)(Rt().T.formulas),[g]=(0,r.useState)((()=>new(ne().B)(u,e.pointer))),S=(0,h().K8)((()=>o.groupsStore.getGroupState(t)),[o,t]),y=(0,h().O$)(o.permissionScopesStore),v=(0,h().K8)((()=>o.collectionViewStore()),[o]),f=(0,h().K8)((()=>n&&y.canEditContent&&!y.isSyncedCollection&&u.device.isMobile&&!(null!=v&&v.isSyncedCollection())),[n,v,u,y]),{value:b}=(0,ft().fJ)(yt().VI.duplicateActions),x=(0,r.useMemo)((()=>{if(g)return(0,Ce.jsx)(jt().Ay,{store:g,shouldShowDropZone:n,canDropBelow:n,canNativeDropBelow:n,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:e=>function(e,t,o,n,r,i){const{droppedDirection:l,droppedStores:a,duplicate:s}=e,c=o.collectionStore();if(!c)return;const d=o.groupsStore.getGroupState(t);if(!d)return;const u=o.collectionViewBlockStore(),p=Wt().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Wt().default.DO_NOT_USE_measureAfterNextFlushLegacy(p,{environment:n,getData:()=>Et().tv({collectionContextStore:o,is_native_drop:!1,is_empty:!0})}),u&&_().createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableDrop",environment:n,canUndo:!0,perform:e=>{Er({environment:n,collectionStore:c,targetStore:u,droppedDirection:l,collectionContextStore:o,groupsPointer:d.groupsPointer,droppedStores:a,duplicate:s,transaction:e,collapsedGroup:!1,formulasModule:r,duplicateActions:i})}})}(e,t,o,u,p,b),onNativeDrop:e=>function(e,t,o,n,r,i){const{files:l,droppedDirection:a}=e,s=t.collectionStore();if(!s)return;const c=t.collectionViewBlockStore(),d=Wt().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Wt().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:n,getData:()=>Et().tv({collectionContextStore:t,is_native_drop:!0,is_empty:!0})}),c&&_().createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableNativeDrop",environment:n,canUndo:!0,perform:e=>{Hl({environment:n,collectionStore:s,targetStore:c,droppedDirection:a,collectionContextStore:t,groupsPointer:o?[o]:[],files:l,transaction:e,formulasModule:r,duplicateActions:i})}})}(e,o,t,u,p,b),analyticsName:"timeline",style:{width:"100%"}})}),[g,n,t,o,u,p,b]),C=(0,r.useMemo)((()=>({groupFormat:t,collectionContextStore:o,isLast:!1,handleOpenPeekPage:I().lQ})),[t,o]);return S?(0,Ce.jsxs)(Ce.Fragment,{children:[x,(0,Ce.jsx)(la,{collectionContextStore:o,groupsPointer:S.groupsPointer,format:l,canDrag:f,disableRequest:!0,itemProps:C,canDrop:!0,renderItem:Cm,disabled:i,direction:ra.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,touchDragOnly:!0,disableSelectable:!0,nestedCreateSubitemButton:jm,paddingLeft:a,paddingRight:s,headerWidth:c,shouldShowShimmer:d,timelineType:"dropzone"})]}):null}const Tm=r.memo(Am,tr().A);function jm(e){return(0,Ce.jsx)("div",{style:{width:"100%",height:bm().V+1}})}function Mm({timelineState:e,...t}){const{collectionContextStore:o,isFullScreen:n,paddingLeft:r,isInPeekRenderer:i}=t,l=(0,h().O$)(o.isInHomeWidgetStore),a=(0,h().K8)((()=>e.outerSizeObserver.rect.state.width),[e]),s=(0,y().IS)((e=>({outerDiv:{position:"sticky",insetInlineStart:0,width:a,height:Hn().tp,zIndex:87},headerStyle:{width:"100%",height:"100%",paddingInlineStart:n?r:32,zIndex:void 0,transition:"background 200ms ease-in-out, border 200ms  ease-in-out",background:"transparent",borderBottom:"1px solid transparent"},stickyStyle:{...l?{}:{background:e.background.primary,boxShadow:`0 -1px 0 ${e.tableDividerColor}`}}})),[n,l,a,r]);return(0,Ce.jsx)("div",{style:s.outerDiv,children:(0,Ce.jsx)(Sl,{...t,style:s.headerStyle,stickyStyle:s.stickyStyle,preventToggleBackground:i})})}var Pm=()=>o(381175);const Rm=new(ft().O2)("TimelineItemDateRange",(async()=>await o.e(11922).then(o.bind(o,117686)))),_m=(0,ft()._h)(Rm,(e=>e.TimelineItemDateRange)),Bm={viewBox:"0 0 16 16",fittedViewBox:"2 2.94 12 10.12",directional:!0,svg:(0,Ce.jsx)("path",{d:"M2.22 8.53a.75.75 0 0 1 0-1.06l4.32-4.32A.75.75 0 0 1 7.6 4.21L4.56 7.25h8.737c.388 0 .703.336.703.75s-.315.75-.703.75H4.56l3.04 3.04a.75.75 0 0 1-1.061 1.06z"})},Vm=(0,Se().wt)("arrowStraightLeftFillSmall",Bm);var Em=function(e){return e[e.Hidden=0]="Hidden",e[e.VisibleInItem=1]="VisibleInItem",e[e.VisibleOutOfItem=2]="VisibleOutOfItem",e[e.NotDefined=3]="NotDefined",e}(Em||{});function Fm({store:e,type:t,timelineState:n,scrollerLeftOffset:i,paddingLeft:l,format:a,itemPositionStore:s,dateValueStore:c,isDraggingViaTimelineItemStore:d,collectionContextStore:u,isFullScreen:p,isInPeekRenderer:g,isRootChild:S}){const v=(0,m().v3)(),f=(0,r.useRef)(Em.NotDefined),b=(0,r.useRef)(null),x=(0,r.useRef)(null),[C,w]=(0,r.useState)(!1),k="left"===t?Vm:o(160438).arrowStraightRightFillSmallIcon,I=(0,h().O$)(n.outerSizeObserver.rect),A=(0,h().r6)((()=>{const e=s.state;if(e){const{left:o,right:r}=e;if(d.state)return Em.Hidden;const l=n.scrollLeftStore.state;if(void 0!==l){if("left"===t){const e=l+i;if(e-r>0)return Em.VisibleOutOfItem;if(e-o>0)return Em.VisibleInItem}else{const e=l+I.width;if(o-e>0)return Em.VisibleOutOfItem;if(r-e>0)return Em.VisibleInItem}return Em.Hidden}}return Em.NotDefined}),[d,s,I,i,n,t]),T=(0,y().IS)((e=>({arrow:{display:"flex",alignItems:"center",width:16,height:16,flexShrink:0,pointerEvents:"auto",background:C?e.icon.primary:e.icon.secondary,borderRadius:4,border:`1px solid ${e.background.primary}`,..."left"===t&&{marginInlineStart:8,marginInlineEnd:4},..."right"===t&&{marginInlineEnd:8,marginInlineStart:4}},icon:{height:12,fill:g?e.background.elevated:e.background.primary},wrap:{position:"sticky",insetInlineStart:"left"===t?i:I.width-220,width:220,height:Kn().sH-6,marginTop:2,display:"flex",alignItems:"center",cursor:"pointer",flexDirection:"right"===t?"row-reverse":void 0,whiteSpace:"nowrap",textOverflow:"ellipsis"}})),[C,g,I,i,t]);(0,r.useLayoutEffect)((()=>{j()}),[]),(0,r.useEffect)((()=>(A.addListener(j),()=>{A.removeListener(j)})),[]),(0,r.useEffect)((()=>{A.enqueueRecompute()}));const j=(0,r.useCallback)((()=>{const e=b.current,t=x.current;if(e&&t){const o=A.state,n=o===Em.VisibleInItem||o===Em.VisibleOutOfItem;e.style.opacity=""+(n?1:0),e.style.transform=`scale(${n?1:.3})`,t.style.pointerEvents=o===Em.VisibleOutOfItem?"":"none";f.current!==Em.NotDefined&&o!==Em.NotDefined&&!e.style.transition&&(e.style.transition="transform 160ms ease-in-out, opacity 160ms ease-in-out"),f.current=o}}),[A]),M=(0,r.useCallback)((()=>{const o=c.state,r=n.zoomLevelStore.state,{snapUnit:i}=Hn().eM[r],s=(0,Hn().C1)(r,200);if(o)if("left"===t){const{start:e}=(0,Hn().yl)(o,i),t=(0,Hn().zb)({timestamp:e.valueOf(),environment:v,timelineState:n,paddingLeft:l,format:a})-s;Op().k3({timelineState:n,environment:v,zoomLevel:r,centerTimestamp:t})}else{const{end:e}=(0,Hn().yl)(o,i),t=(0,Hn()._r)({timestamp:e.valueOf(),timelineState:n})+s;Op().k3({timelineState:n,environment:v,zoomLevel:r,centerTimestamp:t})}w(!1),R().Lt({environment:v,store:e}),(0,Dp().iT)(v,{...(0,Dp().ZR)({environment:v,collectionContextStore:u,timelineState:n,isFullScreen:p,isRootChild:S}),type:t})}),[u,c,v,a,p,S,l,e,n,t]),P=(0,r.useCallback)((()=>{v.device.isPhone||Qt().A.state||w(!0)}),[v]),_=(0,r.useCallback)((()=>{v.device.isPhone||w(!1)}),[v]);return(0,Ce.jsxs)("div",{style:T.wrap,onMouseOver:P,onMouseOut:_,onMouseDown:Ai().t,onClick:M,ref:x,children:[(0,Ce.jsx)("div",{style:T.arrow,ref:b,children:k(T.icon)}),C?(0,Ce.jsx)(Dm,{dateValueStore:c,timelineState:n,isInPeekRenderer:g}):void 0]})}const Om=r.memo(Fm,tr().A);function Dm({dateValueStore:e,timelineState:t,isInPeekRenderer:o}){const n=(0,y().IS)((e=>({dateRange:{fontSize:12,paddingInlineStart:4,paddingInlineEnd:4,borderRadius:4,background:o?e.peekTimelineBackground:e.timelineBackground,pointerEvents:"none"}})),[o]),r=(0,h().O$)(e),i=(0,h().O$)(t.zoomLevelStore);return r?(0,Ce.jsx)("span",{style:n.dateRange,children:(0,Hn().tX)(r,i)}):null}class Lm extends f().Store{getInitialState(){return null}}function zm({store:e,timelineState:t,scrollerLeftOffset:o,paddingLeft:i,format:l,query:a,schema:s,blockPropertyValueOverlayStore:c,disabled:p,showProperties:g,collectionContextStore:S,isFullScreen:v,isRootChild:f,toggleButton:b,groupFormat:x,subitemPath:C,isInPeekRenderer:w,handleOpenPeekPage:k}){const I=(0,m().v3)(),{value:A}=(0,ft().fJ)(Rt().T.formulas),T=(0,r.useRef)(null),[j]=(0,r.useState)((()=>e.clone())),M=(0,r.useRef)(null),R=(0,h().K8)((()=>{const o=t.dateRangePlaceholderStore.state;if(o.active&&o.store===e&&!o.newTimelineItemProps&&(0,Qn().Mn)(o.groupFormat,x))return o.date}),[x,e,t]),B=(0,h().r6)((()=>{const o=t.dragStateStore.state;if(R)return R;if(o){const t=o.stores.indexOf(e);if(t>=0)return o.temporaryValues[t]}return Km(e,a,s,I,A)}),[I,R,a,s,e,t,A],{useDeepEqual:!0}),V=(0,h().O$)(B),E=(0,h().K8)((()=>{const e=(0,yr().dC)(C);if(!e||Boolean(V))return;const t=e.value.store,o=im.findTimelineItems(t);if(o.length>0){return o[0].dateValueStore.state}}),[V,C]),F=(0,h().r6)((()=>(0,Hn().BD)({timelineState:t,dateValue:V,placeholderDate:R,subitemPlaceholderDate:E})),[V,R,E,t]),O=(0,h().uB)(void 0,Lm);(0,Au().b)(im,(()=>({getNode:()=>T.current,props:{store:e,groupFormat:x,schema:s},stores:{nodeStore:O},dateValueStore:B,itemPositionStore:F})),[e,T,B,x,s,F,O]);const D=(0,h().O$)(F),L=(0,h().K8)((()=>{var e;return null===(e=S.groupsStore.getGroupState(x))||void 0===e?void 0:e.reducerResultStore}),[x,S]),z=(0,Ee().Zp)(),K=Boolean(D&&!D.isPlaceholder&&!(null!=z&&z.disableContentPointerEvents)),H=(0,h().r6)((()=>{const o=t.dragStateStore.state,n=wr().Ay.state;return Boolean(o&&o.stores.includes(e)&&n.isDragging&&n.draggedStores.includes(e))}),[e,t]);(0,h().O$)(H);const N=(0,h().K8)((()=>e.getAssociatedCollectionStore()),[e]),G=(0,r.useCallback)((o=>{const n=t.dateRangePlaceholderStore.state,r=S.groupsStore.getGroupState(x);if(r)if(n.active){const{date:o}=n;_().createAndCommit({userAction:"TimelineItem.handleClick",environment:I,canUndo:!0,perform:t=>{Op().Xt({environment:I,store:e,query:a,schema:s,date:o,transaction:t})}}),t.dateRangePlaceholderStore.setState({active:!1})}else{const{horizontalScroller:n}=t,i=t.scrollLeftStore.state,l=F.state,a=M.current;if(!n||void 0===i||!l||!a)return;const s=n.getBoundingClientRect(),c=i+((0,Md().A1)()?s.right-o.clientX:o.clientX-s.left),p=M.current;if(!p)return;const m=p.lastElementChild;if(!m)return;const g=i+(m.getBoundingClientRect().right-s.left);c>l.right&&c<=g&&(0,d().SQ)({event:o,context:d().y$.Click,callback:()=>{(0,u().Z)()||Jn().VU({environment:I,store:e,openInNew:(0,Pm().V)(o),peekMode:(0,W().hH)(S),resultsStore:r.resultsStore,collectionContextStore:S,pageVisitSource:$().y8.PeekOpen})}})}}),[S,I,x,F,a,s,e,t]),U=(0,r.useCallback)((()=>{t.dateRangePlaceholderStore.setState({active:!1})}),[t]),q=(0,r.useCallback)((e=>{const{target:t}=e;!I.device.isMobile&&t instanceof HTMLElement&&(0,d().SQ)({event:e,context:d().y$.EditorMouseDown,callback:()=>{e.preventDefault(),P().jD({environment:I,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}),[I]),X=(0,r.useCallback)((o=>{const r=t.dragStateStore.state,i=t.drawStateStore.state,{horizontalScroller:l}=t,c=t.scrollLeftStore.state,d=t.zoomLevelStore.state,u=t.currentRangeStore.state,{snapUnit:m,getDateRangePlaceholderDuration:g}=Hn().eM[d];if(!i&&Qt().A.state||r||Km(e,a,s,I,A)||!l||void 0===c||p)return;const S=l.getBoundingClientRect(),h=c+((0,Md().A1)()?S.right-o.clientX:o.clientX-S.left),y=(0,Hn().C1)(d,h),v=n().c9.fromMillis(u.startTimestamp+y),f=(0,Hn().DY)(v,m),b=(0,Hn().DY)(g(v),m),C=(0,Bc().p6)(f.valueOf(),(0,Sr().P)()),w=(0,Hn().oJ)({startValue:C,snapUnit:m,desiredStart:f,desiredEnd:b});t.dateRangePlaceholderStore.setState({active:!0,store:e,parentStore:N,groupFormat:x,date:w,newTimelineItemProps:void 0,existingTimelineItemProps:{query:a,schema:s}})}),[I,t,e,x,p,a,s,N,A]),Y=(0,r.useCallback)((e=>{O.setState(e)}),[O]),Q=(0,y().IS)((()=>({scrollArrows:{display:"flex",height:0,position:"relative",zIndex:86},dateRange:{display:"flex",height:bm().V+1,width:"100%",cursor:"default",isolation:"auto"}})),[]);if(!L)return null;const Z=Boolean(D);return(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsxs)("div",{ref:T,style:Q.scrollArrows,children:[K?(0,Ce.jsx)(Om,{store:e,type:"left",timelineState:t,scrollerLeftOffset:o,itemPositionStore:F,dateValueStore:B,paddingLeft:i,format:l,isDraggingViaTimelineItemStore:H,collectionContextStore:S,isFullScreen:v,isInPeekRenderer:w,isRootChild:f}):void 0,K?(0,Ce.jsx)(Om,{store:e,type:"right",timelineState:t,scrollerLeftOffset:o,itemPositionStore:F,dateValueStore:B,paddingLeft:i,format:l,isDraggingViaTimelineItemStore:H,collectionContextStore:S,isInPeekRenderer:w,isFullScreen:v,isRootChild:f}):void 0]}),(0,Ce.jsx)("div",{style:Q.dateRange,onMouseDown:q,onMouseMove:X,onMouseLeave:U,onClick:G,className:Vt().ZLF,ref:Y,children:Z?(0,Ce.jsx)(_m,{store:e,parentStore:N,toggleButton:b,clonedStore:j,itemPositionStore:F,dateValueStore:B,query:a,schema:s,timelineState:t,blockPropertyValueOverlayStore:c,disabled:p,showProperties:g,scrollerLeftOffset:o,isDraggingViaTimelineItemStore:H,collectionContextStore:S,isFullScreen:v,isInPeekRenderer:w,isRootChild:f,intl:xr().A.getIntl(),propertiesWrapElementRef:M,resultStore:L,handleOpenPeekPage:k}):void 0})]})}function Km(e,t,o,n,r){return(0,Hn().GM)({store:e,query:t,schema:o,userId:n.currentUser.id,intl:xr().A.getIntl(),formulasModule:r})}var Hm=()=>o(496506);function Wm(e){const{store:t,parentStore:i,timelineState:l,scrollerLeftOffset:a,query:s,schema:c,blockPropertyValueOverlayStore:u,disabled:p,showProperties:g,collectionContextStore:S,isFullScreen:v,isRootChild:f,toggleButton:b,groupFormat:x,canEditTimelineItems:C,subitemPath:w,paddingLeft:k,showTable:I}=e,A=(0,m().v3)(),{isMobile:T}=(0,m().Y0)(),[j,M]=(0,r.useState)(),R=(0,y().IS)((()=>({container:{display:"flex",height:(0,z().sG)({isMobile:T})+1,width:"100%",cursor:"default",isolation:"auto"}})),[T]);(0,r.useEffect)((()=>{M(null==t?void 0:t.clone())}),[t]);const B=(0,h().K8)((()=>{var e;return null===(e=S.groupsStore.getGroupState(x))||void 0===e?void 0:e.reducerResultStore}),[S.groupsStore,x]),V=(0,h().K8)((()=>{const e=l.dateRangePlaceholderStore.state;if(e.active&&e.store===t&&e.newTimelineItemProps&&e.parentStore===i&&(0,Qn().Mn)(e.groupFormat,x))return e.date}),[x,i,t,l.dateRangePlaceholderStore]),E=(0,o(346923).l)(V),F=(0,h().K8)((()=>(0,Hn().BD)({timelineState:l,dateValue:E,placeholderDate:V,subitemPlaceholderDate:void 0})),[E,V,l]),O=(0,h().K8)((()=>Boolean(F)),[F]),D=(0,h().K8)((()=>!S.isInHomeWidgetStore.state&&!t&&!O&&S.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[S,O,t]),L=(0,h().O$)(S.isInPeekRendererStore),K=(0,r.useMemo)((()=>new(Hm().ComputedStore)((()=>F),{debugName:"itemPositionStore"})),[F]),H=(0,r.useMemo)((()=>new(Hm().ComputedStore)((()=>E),{debugName:"dateValueStore"})),[E]),W=(0,r.useMemo)((()=>new(Hm().ComputedStore)((()=>!1),{debugName:"isDraggingViaTimelineItemStore"})),[]);return B?(0,Ce.jsxs)("div",{style:R.container,onMouseDown:e=>function(e,t){const{target:o}=e;if(t.device.isMobile||!(o instanceof HTMLElement))return;(0,d().SQ)({event:e,context:d().y$.EditorMouseDown,callback:()=>{e.preventDefault(),P().jD({environment:t,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,A),onMouseMove:e=>function(e,t,o,r,i,l,a,s,c,d,u,p){var m;const g=t.drawStateStore.state,S=t.dragStateStore.state,{horizontalScroller:h}=t,y=t.scrollLeftStore.state,v=t.zoomLevelStore.state,f=t.currentRangeStore.state,{snapUnit:b,getDateRangePlaceholderDuration:x}=Hn().eM[v];if(!g&&Qt().A.state||S||!h||void 0===y||i)return;const C=null===(m=d.groupsStore.getGroupState(r))||void 0===m?void 0:m.resultsStore;if(!C)return;const w=h.getBoundingClientRect(),k=y+((0,Md().A1)()?w.right-e.clientX:e.clientX-w.left),I=(0,Hn().C1)(v,k),A=n().c9.fromMillis(f.startTimestamp+I),T=(0,Hn().DY)(A,b),j=(0,Hn().DY)(x(A),b),M=(0,Bc().p6)(T.valueOf(),(0,Sr().P)()),P=(0,Hn().oJ)({startValue:M,snapUnit:b,desiredStart:T,desiredEnd:j});t.dateRangePlaceholderStore.setState({active:!0,store:o,parentStore:u,groupFormat:r,date:P,newTimelineItemProps:{query:l,schema:a,resultsStore:C,isFullScreen:s,canEditTimelineItems:c,subitemPath:p},existingTimelineItemProps:void 0})}(e,l,t,x,p,s,c,v,C,S,i,w),onMouseLeave:()=>function(e){e.dateRangePlaceholderStore.setState({active:!1})}(l),onClick:e=>function(e,t,o,n,r,i,l,a,s,c,d,u){const p=r.dateRangePlaceholderStore.state;if(p.active){const{date:e}=p,m=u?u.length>0?"timeline_add_subitem_bottom":"timeline_add_parent_item_bottom":"timeline_add_item_bottom";if(!(0,ro().E)(t))return void(0,wa().Q)(t);_().createAndCommit({userAction:"TimelineItemNew.handleClick",environment:t,canUndo:!0,perform:r=>{const p=Op().dO({environment:t,transaction:r,date:e,store:c,parentStore:d,query:o,schema:n,isFullScreen:i,groupFormat:l,canEditTimelineItems:a,collectionContextStore:s,subitemPath:u,from:m});sr().vH(t,{from:m,type:"page",new_page_id:null==p?void 0:p.id,creating_block_id:null==p?void 0:p.id,...(0,Et().sl)(s)})}}),r.dateRangePlaceholderStore.setState({active:!1})}}(0,A,s,c,l,v,x,C,S,t,i,w),className:Vt().ZLF,children:[O?(0,Ce.jsx)(_m,{store:i?void 0:t,parentStore:i,toggleButton:b,clonedStore:j,itemPositionStore:K,dateValueStore:H,query:s,schema:c,timelineState:l,blockPropertyValueOverlayStore:u,disabled:p,showProperties:g,scrollerLeftOffset:a,isDraggingViaTimelineItemStore:W,collectionContextStore:S,isFullScreen:v,isInPeekRenderer:L,isRootChild:f,intl:xr().A.getIntl(),resultStore:B,handleOpenPeekPage:Gm}):void 0,D?(0,Ce.jsx)(qm,{parentStore:i,collectionContextStore:S,paddingLeft:k,isFullScreen:v,showTable:I}):void 0]}):null}const Nm=r.memo(Wm);function Gm(){}function $m({isMobile:e}){return{display:"flex",alignItems:"center",gap:6,paddingBottom:2,fontSize:14,height:(0,z().sG)({isMobile:e}),lineHeight:q().K_.UIRegular.desktop}}function Um(e,t,o){return{position:"sticky",insetInlineStart:t&&!o?e+8:8,display:"flex",alignItems:"center"}}function qm({parentStore:e,collectionContextStore:t,paddingLeft:o,isFullScreen:n,showTable:r}){const{isMobile:i}=(0,m().Y0)(),l=(0,y().DP)(),a=(0,h().O$)(t.currentSubitemFormatStoreForUiDisplayStore),s=(0,h().K8)((()=>{var t;return a&&e?null===(t=e.getSchema()[a.property])||void 0===t?void 0:t.name:""}),[a,e]);return(0,Ce.jsx)("div",{style:Um(o,n,r),children:(0,Ce.jsxs)("div",{style:$m({isMobile:i}),children:[(0,Ce.jsx)(ie().I,{icon:gn().plusSmallIcon,size:"sm",colorVariant:"secondary"}),(0,Ce.jsx)("span",{style:{color:l.text.secondary},children:e&&s?(0,Ce.jsx)(he().sA,{defaultMessage:"New page in {propertyName}",id:"database.timelineView.nest.addSubitemWithPropertyName",values:{propertyName:s}}):(0,Ce.jsx)(he().sA,{defaultMessage:"New",id:"database.timelineView.item.addRowButton"})})]})})}function Xm(e){const{store:t,parentStore:o,subitemPath:n,timelineState:r,disabled:i,query:l,format:a,schema:s,collectionContextStore:c,blockPropertyValueOverlayStore:d,isFullScreen:u,isRootChild:p,groupFormat:m,paddingLeft:g,showTimelineProperties:S,scrollerLeftOffset:y,showTable:v,canEditTimelineItems:f,isInPeekRenderer:b,isReady:x,canEdit:C}=e,w=(0,h().K8)((()=>c.groupsStore.getGroupState(m)),[c,m]),k=(0,h().O$)(c.permissionScopesStore),I=(0,h().K8)((()=>"collectionTypedView"===c.contextType),[c]);return(0,h().O$)(c.isInHomeWidgetStore)||!w||!x||!C&&!I||k.isSyncedCollection?null:(0,Ce.jsx)(Nm,{store:t,disabled:i||!k.canEditContent&&!I,timelineState:r,schema:s,query:l,format:a,scrollerLeftOffset:y,paddingLeft:g,showProperties:S,blockPropertyValueOverlayStore:d,collectionContextStore:c,isFullScreen:u,showTable:v,isRootChild:p,groupFormat:m,canEditTimelineItems:f,isInPeekRenderer:b,parentStore:o,subitemPath:n})}const Ym=function(e){const{collectionContextStore:t,schema:o,groupFormat:n,query:r,showTable:i,store:l,format:a,isFullScreen:s,paddingLeft:c,paddingRight:d,isInPeekRenderer:u,timelineState:p,blockPropertyValueOverlayStore:g,isRootChild:S,isReady:y,canEdit:v,disabled:f,scrollerLeftOffset:b,headerWidth:x}=e,C=(0,m().v3)(),w=(0,h().K8)((()=>{if(n)return;if(!r.timeline_by)return;const e=t.groupsStore.getGroupState(n);if(!e)return;const l=e.currentLimit.state,a=I().oE([n&&(0,jr().K8)({schema:o,propertyMapping:void 0,groupBy:t.getGroupByAndGroupFormats().groupBy,group:n,timeZone:(0,Sr().P)()}),!i&&{property:r.timeline_by,filter:{operator:"is_not_empty"}}]);return{type:"results",filter:a.length>0?{operator:"and",filters:a}:void 0,limit:l}}),[t,o,n,r,i]),k=(0,h().K8)((()=>t.groupsStore.getGroupState(n)),[t,n]),A=n?[n]:[],T=(0,h().K8)((()=>null==k?void 0:k.reducerResultStore.state),[null==k?void 0:k.reducerResultStore]),j=(0,h().K8)((()=>W().XQ({collectionContextStore:t,reducerResult:T,isFullScreen:s})),[t,T,s]),M=(0,h().K8)((()=>W().Cn({query:r,schema:o})),[r,o]),P=(0,h().K8)((()=>(a.timeline_properties||[]).filter((({visible:e})=>e)).map((({property:e})=>e))),[a]);return k?(0,Ce.jsxs)(Ce.Fragment,{children:[w?(0,Ce.jsx)(Zr().A,{id:A.length>0?`results:${(0,Qn().Hm)(A)}`:Yn().MZ,reducer:w,groupsPointer:A,collectionContextStore:t,resultStore:k.reducerResultStore}):void 0,(0,Ce.jsx)(Zm,{groupFormat:n,format:a,collectionContextStore:t,store:l,schema:o,query:r,isInPeekRenderer:u,timelineState:p,blockPropertyValueOverlayStore:g,showTimelineProperties:P,paddingLeft:c,paddingRight:d,isFullScreen:s,isRootChild:S,isReady:y,canEdit:v,canEditTimelineItems:M,disabled:f,showTable:i,scrollerLeftOffset:b,headerWidth:x}),j?(0,Ce.jsx)("div",{style:{width:"100%"},children:i?(0,Ce.jsx)("div",{style:{height:Ol().LA}}):(0,Ce.jsx)(Ol().jJ,{style:{position:"sticky",insetInlineStart:s?c:3,width:"max-content",height:Ol().LA},groupsPointer:A,store:l,collectionContextStore:t,format:a,isFullScreen:s,incrementLimitsInRelatedGroups:!1})}):void 0,(0,Ce.jsx)(Xm,{...e,store:void 0,indentLevel:0,handleOpenPeekPage:()=>Qm(t,n,C),canEditTimelineItems:M,showTimelineProperties:P})]}):null};function Qm(e,t,o){const n=e.groupsStore.getGroupState(t);if(!n)return;Wt().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag");const r=e.collectionViewStore();M().Ey({collectionContextStore:e,resultsStore:n.resultsStore});const i=null==r?void 0:r.getFormat().collection_peek_mode,l=i||ql().C9.timeline;Ul().bn(o,{is_peek:!0,from:"timeline",peek_mode:l})}function Zm(e){const t=(0,m().v3)(),{groupFormat:o,format:n,collectionContextStore:r,disabled:i,query:l,schema:a,blockPropertyValueOverlayStore:s,isFullScreen:c,isRootChild:d,showTable:u,canEditTimelineItems:p,scrollerLeftOffset:g,timelineState:S,paddingLeft:y,paddingRight:v,showTimelineProperties:f,isInPeekRenderer:b,headerWidth:x}=e,C=(0,h().K8)((()=>({disabled:i,timelineState:S,schema:a,query:l,format:n,scrollerLeftOffset:g,paddingLeft:y,showProperties:f,blockPropertyValueOverlayStore:s,collectionContextStore:r,isFullScreen:c,showTable:u,isRootChild:d,groupFormat:o,canEditTimelineItems:p,isInPeekRenderer:b,handleOpenPeekPage:()=>Qm(r,o,t),isLast:!1})),[r,o,n,t,i,l,a,s,c,d,u,p,g,S,y,f,b]),w=(0,h().K8)((()=>r.groupsStore.getGroupState(o)),[r,o]);return w?(0,Ce.jsx)(la,{disableSelectable:!0,collectionContextStore:r,groupsPointer:w.groupsPointer,format:n,canDrag:!1,disableRequest:!0,itemProps:C,canDrop:!1,renderItem:zm,disabled:!0,direction:ra.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,nestedCreateSubitemButton:o=>function(e,t,o){return(0,Ce.jsx)(Xm,{...o,store:e.store,indentLevel:e.indentLevel,parentStore:e.parentStore,subitemPath:e.subitemPath,handleOpenPeekPage:()=>Qm(o.collectionContextStore,o.groupFormat,t),canEditTimelineItems:o.canEditTimelineItems,showTimelineProperties:o.showTimelineProperties})}(o,t,e),timelineType:"item",paddingLeft:y,paddingRight:v,headerWidth:x,shouldShowShimmer:!1}):null}const Jm=r.memo((function({store:e,collectionContextStore:t,timelineState:o,disabled:n,isFullScreen:i,isInPeekRenderer:l,paddingLeft:a,paddingRight:c,headerWidth:d,isRootChild:u,format:p,schema:m,query:g,showTable:S,groupsReducerResultStore:y,canEditCollectionTimeline:v,isReady:f,blockPropertyValueOverlayStore:b,tableStore:x,scrollerLeftOffset:C,onGroupHeaderAddItem:w}){const k=(0,r.useCallback)((e=>{if(!S)return(0,Ce.jsx)(Mm,{timelineState:o,...e})}),[S,o]),I=(0,h().K8)((()=>(0,z().Ty)(p,x)),[p,x]),A=(0,r.useCallback)((r=>(0,Ce.jsx)(Ym,{store:e,groupFormat:r,schema:m,query:g,isInPeekRenderer:l,timelineState:o,collectionContextStore:t,blockPropertyValueOverlayStore:b,paddingLeft:a,paddingRight:c,format:I,isFullScreen:i,isRootChild:u,isReady:f,canEdit:v,disabled:n,showTable:S,scrollerLeftOffset:C,headerWidth:d})),[b,v,t,I,n,d,i,l,f,u,a,c,g,m,C,S,e,o]),T=function({collectionContextStore:e,isFullScreen:t,disabled:o,format:n,showTable:i,canEditCollectionTimeline:l}){const a=xm({collectionContextStore:e,isFullScreen:t,disabled:o,format:n,showTable:i,canEditCollectionTimeline:l});return(0,r.useCallback)((e=>{const t=a(e),o=(0,z().sG)({isMobile:Boolean(s().A.isMobile)});let n=0,r=0;return t.groupHeader&&i&&(n+=Hn().tp+Hn().lH),t.tableHeaderRow&&(n+=Hn().MR-1),t.tableAggregationRow&&(r+=o),t.addItemRow||(r+=1),t.tableEmptyRow&&(r+=o),t.hiddenGroupsButton&&i&&(r+=44),t.groupsLoadMoreButton&&i&&(r+=36),t.addGroupButton&&i&&(r+=gi+hi+Si),{paddingTop:n,paddingBottom:r,minHeight:Hn().tp}}),[a,i])}({collectionContextStore:t,isFullScreen:i,disabled:n,format:p,showTable:S,canEditCollectionTimeline:v});return p.collection_group_by?(0,Ce.jsx)(ki().l,{children:(0,Ce.jsx)(Ps,{reducerId:Yn().qK,store:e,collectionContextStore:t,disabled:n,isFullScreen:i,isRootChild:u,paddingLeft:a,paddingRight:c,stickyLeft:!1,renderGroupResults:A,getGroupStyle:T,renderHeader:k,onGroupHeaderAddItem:w,timelineType:"item",groupsResultStore:y,headerWidth:d})}):A()}));const eg=r.memo((function({store:e,collectionContextStore:t,disabled:o,isFullScreen:n,isRootChild:i,paddingLeft:l,paddingRight:a,headerWidth:c,onGroupHeaderAddItem:d,format:u,groupsReducerResultStore:p,canEditCollectionTimeline:m,showTable:g}){const S=(0,r.useCallback)((()=>null),[]),h=function({collectionContextStore:e,isFullScreen:t,disabled:o,format:n,showTable:i,canEditCollectionTimeline:l}){const a=s().A.isMobile,c=xm({collectionContextStore:e,isFullScreen:t,disabled:o,format:n,showTable:i,canEditCollectionTimeline:l});return(0,r.useCallback)((e=>{if(!e)return{paddingTop:0,paddingBottom:0};const t=c(e),o=(0,z().sG)({isMobile:Boolean(a)})-1;let n=0,r=0;return t.groupHeader&&(n+=Hn().tp+Hn().lH-1),t.tableHeaderRow&&(n+=Hn().MR),t.tableEmptyRow&&(n+=o),t.addItemRow&&(r+=bm().V),t.loadMoreButton&&(r+=Ol().LA),t.tableAggregationRow&&(r+=o-1),t.addItemRow||(r-=1),t.hiddenGroupsButton&&(r+=44),t.groupsLoadMoreButton&&(r+=36),t.addGroupButton&&(r+=gi+hi+Si),{paddingTop:n,paddingBottom:r}}),[a,c])}({collectionContextStore:t,isFullScreen:n,disabled:o,format:u,showTable:g,canEditCollectionTimeline:m}),y=(0,r.useCallback)((n=>(0,Ce.jsx)(Tm,{store:e,groupFormat:n,collectionContextStore:t,canEdit:m,format:u,disabled:o&&m,paddingLeft:l,paddingRight:a,headerWidth:c,shouldShowShimmer:!1})),[t,e,u,o,m,l,a,c]);return u.collection_group_by?(0,Ce.jsx)(Ps,{reducerId:Yn().qK,store:e,collectionContextStore:t,disabled:o,isFullScreen:n,isRootChild:i,paddingLeft:l,paddingRight:a,headerWidth:c,stickyLeft:!1,renderGroupResults:y,getGroupStyle:h,renderHeader:S,onGroupHeaderAddItem:d,timelineType:"dropzone",groupsResultStore:p}):(0,Ce.jsx)("div",{style:h(void 0),children:y(void 0)})}));const tg=function({isGrouped:e,format:t,collectionContextStore:n,isFullScreen:r,isRootChild:i,timelineState:l}){const a=(0,m().v3)(),{device:s}=a;return(0,Ce.jsx)(qo().A,{render:c=>(0,Ce.jsx)(_o().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i){const l=o.collectionViewStore();if(!l)return;_().createAndCommit({userAction:"TimelineHideTableButton.handleHideTableClick",environment:e,canUndo:!0,perform:e=>{const o=(0,Hn().iH)(t,!1);ve().zA({stores:[l],update:o,transaction:e})}}),(0,Dp().VD)(e,{...(0,Dp().ZR)({environment:e,collectionContextStore:o,timelineState:i,isFullScreen:n,isRootChild:r}),show:!1})}(a,t,n,r,i,l),style:{position:"absolute",top:e?s.isIOS?3:4:s.isIOS?7:8,insetInlineEnd:e?6:8,zIndex:84},...c,children:(0,Ce.jsx)(ie().I,{icon:o(430042).R,size:"sm",colorVariant:"tertiary"})}),renderTooltip:()=>(0,Ce.jsx)(he().sA,{id:"database.timelineView.tableGroupResults.hideTableButton.title",defaultMessage:"Hide table"})})};function og(){const e=(0,y().IS)((e=>({rowContainer:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0",borderBottom:`1px solid ${e.regularDividerColor}`},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginInlineStart:12,backgroundColor:e.lightDividerColor}})),[]);return(0,Ce.jsx)("div",{style:e.rowContainer,children:(0,Ce.jsx)(wn().A,{style:e.rowShimmer})})}const ng=function(e){const{showTablePropertyFormatsStore:t,groupFormat:o,isFullScreen:n,collectionContextStore:i,blockPropertyValueOverlayStore:l,isReady:a,store:s,disabled:c,format:d,schema:u,isInPeekRenderer:p,query:m,paddingBottom:g,tableStore:S,timelineState:y,isRootChild:v,canEdit:f,paddingLeft:b,paddingRight:x,headerWidth:C}=e,w=(0,h().K8)((()=>t.state.findIndex((e=>"title"===e.property))),[t]),k=(0,r.useMemo)((()=>o?[o]:[]),[o]),I=(0,h().K8)((()=>i.groupsStore.getGroupState(k)),[i,k]),A=(0,h().K8)((()=>null==I?void 0:I.reducerResultStore.state),[I]),T=(0,h().K8)((()=>(0,W().XQ)({collectionContextStore:i,reducerResult:A,isFullScreen:n})),[i,A,n]),j=(0,h().O$)(i.shouldShowSpinnerStore),M=(0,h().O$)(i.permissionScopesStore),P=(0,h().O$)(t),R=(0,h().O$)(i.isInHomeWidgetStore),_=(0,h().K8)((()=>"collectionTypedView"===i.contextType),[i]),B=a&&0===(null==A?void 0:A.blockIds.length)&&!j,V=(0,h().K8)((()=>Boolean(!R&&a&&(f||_)&&!M.isSyncedCollection)&&!B),[R,a,f,_,M.isSyncedCollection,B]);return I?(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)(lg,{store:s,format:d,schema:u,query:m,collectionContextStore:i,disabled:c,paddingBottom:g,isInPeekRenderer:p,blockPropertyValueOverlayStore:l,tableStore:S,showTablePropertyFormats:P,timelineState:y,isFullScreen:n,isRootChild:v,groupFormat:o,isInHomeWidget:R,paddingLeft:b,paddingRight:x}),(0,Ce.jsx)(Sg,{store:s,schema:u,collectionContextStore:i,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:t,canEdit:f,format:d,tableStore:S,paddingLeft:b,paddingRight:x,headerWidth:C,disabled:c,groupFormat:o,titleColumnIndex:w,groupsPointer:k,shouldShowShimmer:j}),j?(0,Ce.jsx)(og,{}):void 0,T?(0,Ce.jsx)(ug,{collectionContextStore:i,format:d,canEdit:f,groupFormat:o,isFullScreen:n,groupsPointer:k}):void 0,V?(0,Ce.jsx)(dg,{collectionContextStore:i,isFullScreen:n,groupFormat:o,blockPropertyValueOverlayStore:l,isInPeekRenderer:p}):void 0,(0,Ce.jsx)(nu,{groupFormat:o,pageCount:(null==A?void 0:A.blockIds.length)??0,style:ig(a,o,n,b),disabled:c||!M.canConfigureBlock,schema:u,query:m,collectionContextStore:i,isInPeekRenderer:p,isFullScreen:n,showPropertyFormats:P,showRightActionsSpacer:!1,paddingLeft:b,paddingRight:x,disableSticky:!0,forViewType:"timeline"})]}):null};function rg(){}function ig(e,t,o,n){return{...!e&&{opacity:0,pointerEvents:"none"},...!o&&!t&&{position:"sticky",insetInlineStart:n},...o&&!t&&{insetInlineStart:n}}}function lg({groupFormat:e,store:t,format:o,schema:n,query:r,collectionContextStore:i,disabled:l,paddingBottom:a,isInPeekRenderer:s,blockPropertyValueOverlayStore:c,tableStore:d,showTablePropertyFormats:u,timelineState:p,isFullScreen:m,isRootChild:g,isInHomeWidget:S,paddingLeft:y,paddingRight:v}){const f=(0,h().K8)((()=>i.groupsStore.getGroupState(e)),[i,e]),b=(0,h().O$)(i.permissionScopesStore),x=(0,h().K8)((()=>i.viewIsFlushToTopbar()),[i]);if(!f)return null;const C=Boolean(e);return(0,Ce.jsx)(Ju,{store:t,format:o,schema:n,query:r,collectionContextStore:i,isInPeekRenderer:s,minWidth:void 0,paddingBottom:a,blockPropertyValueOverlayStore:c,showPropertyFormats:u,showRightActions:!1,allowHidingTitle:!0,tableStore:d,formatKey:"timeline_table_properties",disabled:l||!b.canConfigureBlock,disableHorizontalEdgeScroll:!0,height:(0,Hn().Zk)(C),paddingTop:C?0:Hn().jI-Hn().MR,disableTopBorder:!x||C,groupFormat:e,isInHomeWidget:S,hasMoreReducerResults:!1,paddingLeft:y,paddingRight:v,children:!C&&b.canConfigureBlock?(0,Ce.jsx)(tg,{isGrouped:!1,format:o,collectionContextStore:i,timelineState:p,isFullScreen:m,isRootChild:g}):void 0})}function ag(e,t,o){return{display:"flex",alignItems:"center",height:(0,z().sG)({isMobile:o}),width:"100%",paddingInlineStart:8,fontSize:14,lineHeight:q().K_.UIRegular.desktop,background:e?t.background.elevated:t.background.primary}}function sg(e){return{width:Se().Ev.sm,height:Se().Ev.sm,marginInlineEnd:6,fill:e.icon.tertiary}}function cg(e,t,o,n,r,i){const{device:l}=e,a=n?[n]:[],s=t.groupsStore.getGroupState(a);if(!(0,ro().E)(e)||!s)return;t.searchQueryStore.state&&(0,Or().S)({searchQuery:"",collectionContextStore:t,isFullScreen:o});const c=t.currentSubitemFormatStoreForCollectionStore.state;_().createAndCommit({userAction:"TimelineTableGroupResults.handleAddRowClick",environment:e,canUndo:!0,perform:o=>{const a=(0,ur().Q)({environment:e,collectionContextStore:t,groupsPointer:n?[n]:[],shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:o,from:{createBlock:"timeline_table_group_results"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(a){if(l.isMobile){!function(e,t,o){o?o(e):(0,xa().navigate)({environment:t,url:e})}((0,Q().Ay)({store:a.newStore,fullyQualified:!1,pageVisitSource:$().y8.Create}),e,i)}else if(a.coercionSucceeded){const o=()=>{dr().ho({environment:e,blockPropertyValueOverlayStore:r,store:a.newStore,property:"title",surface:"table",collectionContextStore:t,disableHorizontalEdgeScroll:!0})};t.registerCallbackForItemMounted(a.newStore,o)}else{const o=n?[n]:[],r=t.groupsStore.getGroupState(o);Jn().VU({environment:e,store:a.newStore,peekMode:(0,W().hH)(t),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:t,pageVisitSource:$().y8.Create})}sr().vH(e,{from:c?"timeline_add_parent_item_bottom":"timeline_add_item_bottom",type:"page",new_page_id:a.newStore.id,creating_block_id:a.newStore.id,...(0,Et().sl)(t)})}}})}function dg({collectionContextStore:e,isFullScreen:t,groupFormat:o,blockPropertyValueOverlayStore:n,isInPeekRenderer:i}){const l=(0,m().v3)(),a=(0,y().DP)(),s=(0,r.useContext)(ba().n),c=(0,r.useCallback)((()=>cg(l,e,t,o,n,s)),[l,e,t,o,n,s]);return(0,Ce.jsxs)(Ro().Ay,{onClick:c,style:ag(i,a,l.device.isMobile),className:Vt().$0P,onMouseDown:Ai().t,children:[(0,gn().plusSmallIcon)(sg(a)),(0,Ce.jsx)("span",{style:{color:a.text.tertiary},children:(0,Ce.jsx)(he().sA,{defaultMessage:"New",id:"database.timelineView.addRowButton"})})]})}function ug({groupsPointer:e,collectionContextStore:t,format:o,canEdit:n,groupFormat:r,isFullScreen:i}){const l=(0,y().DP)(),a=(0,m().v3)(),s=(0,h().K8)((()=>t.groupsStore.getGroupState(e)),[t,e]),c=(0,h().K8)((()=>(0,Jr().Kk)({collectionContextStore:t,groupsPointer:e})),[t,e]);return s?(0,Ce.jsxs)(Ro().Ay,{onMouseDown:Ai().t,onClick:e=>function(e,t,o,n,r){const i=t.groupsStore.getGroupState(o);if(!i)return;const l=i.reducerResultStore.state;(0,Ii().k)(e),R().IU({environment:r}),l&&(0,_l().H)({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:n,currentResultCount:l.blockIds.length,groupsPointer:i.groupsPointer,incrementLimitsInRelatedGroups:!1}}),(0,qd().K)(r)}(e,t,r,i,a),disabled:c,hoveredStyle:c?{background:l.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:Ol().LA,width:"100%",paddingInlineStart:8,paddingBottom:2,fontSize:14,lineHeight:q().K_.UIRegular.desktop,boxShadow:`0 -1px 0 ${l.tableDividerColor}`,borderBottom:`1px solid ${l.tableDividerColor}`,whiteSpace:"break-spaces"},children:[(0,wl().arrowStraightDownSmallIcon)(sg(l)),(0,Ce.jsx)("span",{style:{color:l.text.tertiary,flexGrow:1},children:(0,Ce.jsx)(he().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),c?(0,Ce.jsx)("div",{style:{marginTop:1,marginInlineStart:8,marginInlineEnd:8},children:(0,Ce.jsx)(qi().A,{size:"sm"})}):n&&(0,Ce.jsx)(Xd().w,{collectionContextStore:t,format:o})]}):null}function pg(e){const t=(0,m().v3)(),o=Boolean(s().A.isMobile),{store:n,parentStore:r,subitemPath:i,indentLevel:l,groupsPointer:a,collectionContextStore:c,disabled:d,blockPropertyValueOverlayStore:u,paddingLeft:p}=e;return r?(0,Ce.jsx)(Td,{store:n,collectionStore:r,subitemPath:i,indentLevel:l,collectionContextStore:c,disabled:d,groupsPointer:a,paddingLeft:p,onSubitemCreate:e=>function(e,t,o,n){if(o){const r=()=>{dr().ho({isNewBlock:!0,environment:n,blockPropertyValueOverlayStore:o,store:e,property:"title",surface:"table",collectionContextStore:t,disableHorizontalEdgeScroll:!0})};t.registerCallbackForItemMounted(e,r)}}(e,c,u,t),styles:{height:(0,z().sG)({isMobile:o})+1}}):null}const mg=[];function gg({args:e,schema:t,disabled:o,collectionContextStore:n,blockPropertyValueOverlayStore:i,showTablePropertyFormatsStore:l,canEdit:a,format:s,groupFormat:c,titleColumnIndex:d,paddingLeft:u,paddingRight:p,headerWidth:g,shouldShowShimmer:S}){(0,y().DP)();const v=(0,m().Y0)(),f=(0,h().K8)((()=>n.collectionViewStore()),[n]),{groupsPointer:b}=e,x=(0,h().K8)((()=>n.groupsStore.getGroupState(b)),[n,b]),C=(0,h().O$)(l),w=(0,h().K8)((()=>!a&&v.isMobile&&!(null!=f&&f.isSyncedCollection())),[a,v,f]),k=(0,h().O$)(n.isInHomeWidgetStore),I=(0,h().K8)((()=>{const e=n.collectionViewBlockStore();return!(!e||n.isFullScreenStore.state)&&(0,Yd().d1)(e)}),[n]),A=(0,h().K8)((()=>(0,vt().v2)(c,n)),[c,n]),T=(0,h().K8)((()=>n.isUnlistedViewStore.state&&n.isInlineViewStore.state),[n]),j=(0,h().K8)((()=>{const e=Zd().A.state;if(e.isActive)return(0,z().yR)(e.selection,C.length,A.length)}),[A,C]),M=mg,P=C,R=(0,h().K8)((()=>{const e=n.permissionScopesStore.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[n.permissionScopesStore]),_=(0,r.useMemo)((()=>({schema:t,collectionContextStore:n,propertyFormats:C,onPropertyTab:e.onPropertyTab,onPropertyUntab:e.onPropertyUntab,onPropertyEnter:e.onPropertyEnter,onPropertyClick:e.onPropertyClick,onPropertyEsc:e.onPropertyEsc,onPropertyBgClick:e.onPropertyBgClick,onPropertyContextMenu:e.onPropertyContextMenu,onOpenProperty:e.onOpenProperty,disabled:o,blockPropertyValueOverlayStore:i,showRightActionsSpacer:!1,disableHorizontalEdgeScroll:!0,disableCellBorderRight:!1,disableLastCellBorderRight:!0,onShiftEnter:rg,titleColumnIndex:d,groupFormat:c,shouldShowMultiSelectCheckbox:!1,isInHomeWidget:k,isCollectionViewBlockSelected:I,allRows:A,isInEphemeralView:T,normalizedTableSelection:j,unfrozenIndexAddendum:0,frozenPropertyFormats:M,unfrozenPropertyFormats:P,tableWrap:!1,shouldSetCellHeight:!0,isNonEditable:R,shouldShowRightActionSpacer:!1,hasColumnVirtualizer:!1})),[A,e.onOpenProperty,e.onPropertyBgClick,e.onPropertyClick,e.onPropertyContextMenu,e.onPropertyEnter,e.onPropertyEsc,e.onPropertyTab,e.onPropertyUntab,i,n,o,M,c,I,T,k,R,j,C,t,d,P]);if(!f||!x)return null;return(0,Ce.jsx)(la,{collectionContextStore:n,groupsPointer:b,disableRequest:!0,format:s,canDrag:w,shouldShowShimmer:S,itemProps:_,renderItem:yp,canDrop:!1,disabled:o,direction:ra.Vertical,getItemSelectableStyle:()=>({display:"flex",width:"fit-content",height:33}),shouldShowHoverMenu:!0,analyticsName:"timeline",emptyDroppableSize:0,onSelectableEnter:e.onSelectableEnter,disableScrollToRevealHorizontal:!0,blockPropertyValueOverlayStore:i,titleColumnIndex:d,nestedCreateSubitemButton:({store:e,parentStore:t,subitemPath:r,indentLevel:l})=>(0,Ce.jsx)(pg,{collectionContextStore:n,disabled:o,blockPropertyValueOverlayStore:i,store:e,parentStore:t,subitemPath:r,indentLevel:l,groupsPointer:b,paddingLeft:u}),paddingLeft:u,paddingRight:p,headerWidth:g,timelineType:"table"})}function Sg({groupFormat:e,groupsPointer:t,store:o,schema:n,collectionContextStore:i,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:a,canEdit:s,format:c,tableStore:d,paddingLeft:u,paddingRight:p,headerWidth:m,disabled:g,titleColumnIndex:S,shouldShowShimmer:y}){const v=(0,h().K8)((()=>i.collectionViewStore()),[i]),f=(0,h().K8)((()=>i.groupsStore.getGroupState(e)),[i,e]),b=(0,h().O$)(a),x=(0,r.useCallback)((o=>(0,Ce.jsx)(gg,{schema:n,disabled:g,collectionContextStore:i,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:a,canEdit:s,format:c,groupFormat:e,titleColumnIndex:S,paddingLeft:u,paddingRight:p,headerWidth:m,shouldShowShimmer:y,args:{...o,groupsPointer:t}})),[n,g,i,l,a,s,c,e,S,u,p,m,y,t]);return v&&f?(0,Ce.jsx)(jp,{store:o,collectionContextStore:i,minWidth:void 0,blockPropertyValueOverlayStore:l,showPropertyFormats:b,disabled:!s,disableHorizontalEdgeScroll:!0,groupFormat:e,render:x,tableStore:d,paddingLeft:u}):null}const hg=r.memo((function({store:e,tableStore:t,collectionContextStore:o,timelineState:n,format:i,schema:l,query:a,isFullScreen:s,groupBy:c,paddingLeft:d,paddingRight:u,headerWidth:p,paddingBottom:m,scrollerLeftOffset:g,isInPeekRenderer:S,isInHomeWidget:v,computedOuterHeight:f,blockPropertyValueOverlayStore:b,isRootChild:x,isReady:C,disabled:w,canEditCollectionTimeline:k,viewIsFlushToTopbar:I,groupsReducerResultStore:A,onGroupHeaderAddItem:T}){const j=(0,r.useRef)(null),M=(0,h().r6)((()=>{const e=(0,z().Ty)(i,t);return(e&&e.timeline_table_properties?e.timeline_table_properties:[]).filter((e=>e.visible))}),[i,t],{useDeepEqual:!0});(0,h().O$)(M);const P=(0,h().K8)((()=>M.state.reduce(((e,t)=>e+(t.width||0)),0)),[M]),R=(0,y().IS)((e=>({selectable:{whiteSpace:"nowrap",...!v&&{background:S?e.background.elevated:e.background.primary},paddingInlineStart:d,boxSizing:"border-box",borderInlineEnd:`1px solid ${e.tableDividerColor}`,boxShadow:e.timelineTableBoxShadow,clipPath:"polygon(0% 0%, 120% 0%, 120% 100%, 0% 100%)",width:P+d,height:v?"100%":f},tableGroupHeaderSticky:{borderInlineEnd:`1px solid ${e.tableDividerColor}`,"--timeline-box-shadow":"0px"},tableGroupHeaderTransition:{borderInlineEnd:void 0},tableGroupHeader:{boxShadow:void 0}})),[v,S,d,P,f]),_=(0,h().K8)((()=>(0,z().Ty)(i,t)),[i,t]),B=(0,r.useCallback)((r=>(0,Ce.jsx)(ng,{store:e,groupFormat:r,schema:l,query:a,isInPeekRenderer:S,timelineState:n,collectionContextStore:o,blockPropertyValueOverlayStore:b,showTablePropertyFormatsStore:M,tableStore:t,paddingLeft:d,paddingRight:u,headerWidth:p,paddingBottom:m,format:_,isFullScreen:s,isRootChild:x,isReady:C,canEdit:k,disabled:w&&k})),[b,k,o,w,_,s,S,C,x,m,d,u,a,l,M,e,t,n,p]),V=(0,r.useCallback)((e=>{const t=o.permissionScopesStore.state;return(0,Ce.jsx)(Sl,{...e,height:Hn().tp,paddingTop:Hn().lH,stickyStyle:R.tableGroupHeaderSticky,transitionStickyStyle:R.tableGroupHeaderTransition,style:0!==e.index||I?R.tableGroupHeader:{},stickyWrapStyle:{marginBottom:Hn().lH},children:0===e.index&&t.canConfigureBlock?(0,Ce.jsx)(tg,{isGrouped:!0,format:i,collectionContextStore:o,timelineState:n,isFullScreen:s,isRootChild:x}):void 0})}),[o,i,s,x,R.tableGroupHeader,R.tableGroupHeaderSticky,R.tableGroupHeaderTransition,n,I]),E=(0,r.useCallback)((()=>({})),[]),F=(0,r.useCallback)((()=>(0,Ce.jsx)(Ps,{reducerId:Yn().qK,store:e,collectionContextStore:o,disabled:w,isFullScreen:s,isRootChild:x,paddingLeft:d,paddingRight:u,headerWidth:p,stickyLeft:!1,renderGroupResults:B,getGroupStyle:E,renderHeader:V,onGroupHeaderAddItem:T,timelineType:"table",groupsResultStore:A})),[o,w,E,A,s,x,T,d,u,V,B,e,p]);return(0,Ce.jsx)("div",{style:{position:"sticky",insetInlineStart:0,height:0,width:P,zIndex:3},children:(0,Ce.jsx)(jt().Ay,{style:R.selectable,store:e,shouldShowHalo:!1,canSelect:!1,analyticsName:"timeline",children:(0,Ce.jsx)(bi().q,{name:"timeline-side-table",stickyHorizontally:!0,horizontalWidthLimiter:g,children:c?F():(0,Ce.jsx)(xi,{nodeRef:j,children:(0,Ce.jsx)("div",{ref:j,children:B(void 0)})})})})})}));var yg=()=>o(402390);function vg(e){const{shouldShowShimmer:t,children:o}=e,n=(0,cs().A)(t,0,100)?"notion-shimmer-timeline-transition notion-shimmer-timeline":"notion-shimmer-timeline-transition";return(0,Ce.jsx)("div",{className:n,style:{height:"100%"},children:o})}const fg=4,bg=22,xg=110,Cg=7,wg=22,kg=12,Ig=4,Ag=32;function Tg(e){var t;const{collectionContextStore:o,isInPeekRenderer:i,timelineState:l,query:a,schema:s}=e,c=(0,m().Y0)(),d=(0,he().tz)(),u=(0,r.useRef)(null),{value:p}=(0,ft().fJ)(Rt().T.formulas),g=(0,Kp().I)(),S=(0,r.useCallback)((()=>{0===(new Date).getSeconds()&&g("TimelineTimeBar","TimelineTimeBar/handleSeconds")}),[g]);(0,r.useEffect)((()=>{const e=setInterval(S,1e3);return()=>clearInterval(e)}),[S]);const{primaryDisplayUnit:v,activeRangeType:f}=(0,h().K8)((()=>{const e=l.zoomLevelStore.state;return Hn().eM[e]}),[l]),b=(0,Hn().LH)(v),x=n().c9.now(),C=b?x.startOf("minute"):x.startOf("day"),w=x.startOf("minute"),k=(0,h().K8)((()=>!o.groupsStore.anyGroupHasNonEmptyResults()&&(0,Jr().iv)({collectionContextStore:o,groupsPointer:[],hasPartialResults:!1})),[o]),A=new(Hm().ComputedStore)((()=>{const e=o.collectionStore();if(!e)return;const t=l.dragStateStore.state,n=l.zoomLevelStore.state,r=l.hoveredItemStore.state,i=l.dateRangePlaceholderStore.state,{activeRangeType:c}=Hn().eM[n];if(!c)return;let u;if(t)u=t.temporaryValues.map((e=>(0,Hn().yl)(e,"day")));else if(i.active)u=[(0,Hn().yl)(i.date,"day")];else{const{stores:t}=bt().default.state,n=t.filter((t=>t.getAssociatedCollectionId()===e.id)),i=I().sb(I().oE([...n,r]));u=I().oE(i.map((e=>{const t=(0,Hn().GM)({store:e,query:a,schema:s,userId:o.getCurrentUserId(),intl:d,formulasModule:p});if(t)return(0,Hn().yl)(t,"day")})))}const m=I().wq(u,(({start:e})=>e.valueOf())),g=I().Sk(u,(({end:e})=>e.valueOf()));return m&&g?{start:m.start.valueOf(),end:g.end.valueOf()}:void 0}),{debugName:"activeRangeStore"}),T=null===(t=(0,W().Oz)(o))||void 0===t?void 0:t.background,j=(0,y().IS)((e=>({wrapper:{position:"absolute",insetInlineStart:0,top:0,width:"100%",background:T||(i?e.background.elevated:e.background.primary),boxSizing:"border-box"},controlBar:{height:em,position:"relative",overflow:"hidden"},primaryTimeBar:{height:Ag,boxShadow:`inset 0 -1px 0 0 ${e.tableDividerColor}`,boxSizing:"border-box",position:"relative",overflow:"hidden"},stickyStyle:{outline:void 0,"--timeline-box-shadow":"0px"},transitionStickyStyle:{display:"none"}})),[T,i]);return(0,Ce.jsx)(ki().g,{stickyAttachPoint:"ceiling",nodeRef:u,stickyStyle:j.stickyStyle,transitionStickyStyle:j.transitionStickyStyle,noPlaceholder:!0,children:(0,Ce.jsxs)("div",{style:j.wrapper,ref:u,children:[(0,Ce.jsx)("div",{style:j.controlBar,children:c.isPhone?void 0:(0,Ce.jsx)(Og,{timelineState:l})}),(0,Ce.jsxs)("div",{style:j.primaryTimeBar,children:[(0,Ce.jsx)(vg,{shouldShowShimmer:k,children:(0,Ce.jsx)(Fg,{timelineState:l,nowTimeStartOfPrimaryDisplayUnit:C})}),"highlight_days"===f?(0,Ce.jsx)(Lg,{timelineState:l,activeRangeStore:A}):void 0,(0,Ce.jsx)(Dg,{timelineState:l,time:C}),"display_range"===f?(0,Ce.jsx)(Lg,{timelineState:l,activeRangeStore:A}):void 0]}),(0,Ce.jsx)(_g,{timelineState:l,time:w})]})})}function jg(e){const{time:t,isNowIndicator:o,timelineState:n}=e,r=n.zoomLevelStore.state,{startTimestamp:i}=n.currentRangeStore.state,{primaryDisplayUnit:l,primaryDisplayUnitAlignment:a}=Hn().eM[r],s=(0,Hn().DY)(t,l),c=(0,Hn().Vz)(t,l),d=(0,Hn().w0)(r,s.valueOf()-i),u=(0,Hn().w0)(r,t.valueOf()-i),p=(0,Hn().w0)(r,c.valueOf()-i)-d,m=o?Ig:0;return{left:("range_start"===a?u-p/2:u)-m,width:p+2*m}}function Mg(e){return{color:e.text.primary,fontSize:kg}}function Pg(e){return{background:e.timelineRed,width:wg,height:wg,borderRadius:wg/2,position:"absolute",insetInlineStart:`calc(50% - ${wg/2}px)`,top:`calc(50% - ${wg/2}px)`}}function Rg(e){const{time:t,accent:o,timelineState:n}=e,i=(0,h().O$)(n.zoomLevelStore),{left:l,width:a}=(0,h().K8)((()=>jg({time:t,isNowIndicator:!1,timelineState:n})),[t,n]),s=(0,y().IS)((e=>({container:{position:"absolute",top:0,insetInlineStart:l,width:a,height:Ag-4,display:"flex",alignItems:"start",lineHeight:Ag-4+"px"},text:{fontSize:kg,margin:"0 auto"},singleColor:{color:o?e.text.primary:e.text.tertiary},twoColorDarker:{color:o?e.text.primary:e.text.secondary},twoColorLighter:{color:o?e.text.secondary:e.text.tertiary}})),[o,l,a]),c=(0,r.useMemo)((()=>{const{primaryDisplayUnit:t}=Hn().eM[i],o=e.time.setLocale(bd().locale),n=(0,Hn().IW)(),r=o.toFormat("t").startsWith(o.toFormat("a"));if("fifteen_minutes"===t){if(n)return(0,Ce.jsx)("span",{style:s.singleColor,children:o.toFormat("H:mm")});{const e=(0,Ce.jsx)("span",{style:{...s.twoColorDarker,paddingInlineEnd:r?void 0:3},children:o.toFormat("h:mm")}),t=(0,Ce.jsx)("span",{style:{...s.twoColorLighter,paddingInlineEnd:r?3:void 0},children:o.toFormat("a")});return r?(0,Ce.jsxs)(Ce.Fragment,{children:[t,e]}):(0,Ce.jsxs)(Ce.Fragment,{children:[e,t]})}}if("hour"===t){if(n)return(0,Ce.jsx)("span",{style:s.singleColor,children:o.toFormat("H:mm")});{const e=(0,Ce.jsx)("span",{style:{...s.twoColorDarker,paddingInlineEnd:r?void 0:3},children:o.toFormat("h")}),t=(0,Ce.jsx)("span",{style:{...s.twoColorLighter,paddingInlineEnd:r?3:void 0},children:o.toFormat("a")});return r?(0,Ce.jsxs)(Ce.Fragment,{children:[t,e]}):(0,Ce.jsxs)(Ce.Fragment,{children:[e,t]})}}return"day"===t||"week"===t?"week"===i||"bi_week"===i?(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)("span",{style:{...s.twoColorLighter,paddingInlineEnd:3},children:o.toFormat("ccccc")}),(0,Ce.jsx)("span",{style:{...s.twoColorDarker,padding:"2px 7px"},children:o.toFormat("d")})]}):(0,Ce.jsx)("span",{style:s.singleColor,children:o.toFormat("d")}):"month"===t?(0,Ce.jsx)("span",{style:s.singleColor,children:o.toFormat("M")}):void(0,A().HB)(t)}),[i,e.time,s.singleColor,s.twoColorDarker,s.twoColorLighter]);return(0,Ce.jsx)("div",{style:s.container,children:(0,Ce.jsx)("div",{style:s.text,children:c})})}function _g(e){const{time:t,timelineState:o}=e,n=(0,h().O$)(o.zoomLevelStore),i=(0,h().K8)((()=>o.currentRangeStore.state.startTimestamp),[o.currentRangeStore]),l=(0,r.useMemo)((()=>Math.floor((0,Hn().w0)(n,t.valueOf()-i))),[n,t,i]),a=(0,y().IS)((e=>({container:{position:"absolute",insetInlineStart:l-Cg/2+.5,top:Math.floor(Ag+em-Cg/2+.5),width:Cg,height:Cg,background:e.timelineRed,borderRadius:"100%"}})),[l]);return(0,Ce.jsx)("div",{style:a.container})}function Bg(e){const{time:t,timelineState:o,intl:n}=e,{isMobile:i}=(0,m().Y0)(),l=(0,h().O$)(o.zoomLevelStore),a=(0,h().K8)((()=>o.currentRangeStore.state.startTimestamp),[o.currentRangeStore]),s=(0,r.useMemo)((()=>(0,Hn().w0)(l,t.valueOf()-a)),[l,t,a]),c=(0,r.useMemo)((()=>{const{secondaryDisplayUnit:e}=Hn().eM[l];return(0,Hn().u7)((0,yg().H)(n),t.valueOf(),e)}),[l,n,t]),d=(0,y().IS)((e=>({container:{position:"absolute",top:0,insetInlineStart:s,height:Ag,color:e.text.primary,fontSize:14,fontWeight:q().Wy.medium,verticalAlign:"middle",paddingTop:Jp+(i?2:7),display:"flex",alignItems:"center"}})),[i,s]);return(0,Ce.jsx)("div",{style:d.container,children:c},s)}function Vg({start:e,end:t,rangeWidth:o}){const n=(0,y().DP)();return e&&t?o>=xg?(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)("div",{style:Mg(n),children:(0,Qc().W_)(e.valueOf(),"month_day",bd().locale)}),(0,Ce.jsx)("div",{style:{flexGrow:1}}),(0,Ce.jsx)("div",{style:Mg(n),children:(0,Qc().W_)(t.valueOf(),"month_day",bd().locale)})]}):(0,Ce.jsxs)("div",{style:Mg(n),children:[(0,Qc().W_)(e.valueOf(),"month_day",bd().locale),"  ",e.month===t.month?(0,Qc().W_)(t.valueOf(),"day",bd().locale):(0,Qc().W_)(t.valueOf(),"month_day",bd().locale)]}):(0,Ce.jsx)("div",{style:Mg(n),children:(0,Qc().W_)(e.valueOf(),"month_day",bd().locale)})}function Eg(e,t,o,n){const r=e.setLocale(bd().locale),i=(0,Hn().LH)(o),l=(0,Hn().IW)();return i?l?(0,Ce.jsx)("span",{style:{color:n.timelineRed},children:r.toFormat("H:mm")}):(0,Ce.jsx)("span",{style:{color:n.timelineRed,paddingInlineEnd:3},children:r.toFormat("t")}):"week"===t||"bi_week"===t?(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)("span",{style:{color:n.text.tertiary,paddingInlineEnd:3},children:r.toFormat("ccccc")}),(0,Ce.jsxs)("div",{style:{position:"relative"},children:[(0,Ce.jsx)("div",{style:Pg(n)}),(0,Ce.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})]}):(0,Ce.jsxs)("div",{style:{position:"relative"},children:[(0,Ce.jsx)("div",{style:Pg(n)}),(0,Ce.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})}function Fg({nowTimeStartOfPrimaryDisplayUnit:e,timelineState:t}){const o=(0,h().O$)(t.zoomLevelStore),{startTimestamp:r,endTimestamp:i}=(0,h().O$)(t.currentRangeStore),l=Hn().eM[o],{primaryDisplayUnit:a,hidePrimaryIndicatorIntersectionOffset:s}=l,c=s||0,d=(0,h().K8)((()=>jg({time:e,isNowIndicator:!0,timelineState:t})),[e,t]),u=d.left+c,p=d.left+d.width-c,m=[];let g=(0,Hn().DY)(n().c9.fromMillis(r),a);const S=(0,h().K8)((()=>jg({time:g,isNowIndicator:!1,timelineState:t})),[g,t]);for(;g.valueOf()<i;){const e=S.left+c,o=S.left+S.width-c;void 0!==s&&(u>=e&&u<=o||p>=e&&p<=o)||m.push((0,Ce.jsx)(Rg,{timelineState:t,time:g,accent:!1},g.valueOf()));const n=(0,Hn().Vz)(g,a);g=n}return(0,Ce.jsx)(Ce.Fragment,{children:m})}function Og({timelineState:e}){const t=(0,he().tz)(),o=(0,h().O$)(e.zoomLevelStore),{startTimestamp:r,endTimestamp:i}=(0,h().O$)(e.currentRangeStore),l=Hn().eM[o],{primaryDisplayUnit:a,secondaryDisplayUnit:s}=l,c=[];let d=(0,Hn().DY)(n().c9.fromMillis(r),s);for(;d.valueOf()<i;){c.push((0,Ce.jsx)(Bg,{timelineState:e,intl:t,time:d},d.valueOf()));const o=(0,Hn().Vz)(d,s);d=(0,Hn().zj)(o,a)}return(0,Ce.jsx)(Ce.Fragment,{children:c})}function Dg({time:e,timelineState:t}){const o=(0,y().DP)(),n=(0,h().O$)(t.zoomLevelStore),{primaryDisplayUnit:r}=Hn().eM[n],{left:i,width:l}=(0,h().K8)((()=>jg({time:e,isNowIndicator:!0,timelineState:t})),[e,t]);return(0,Ce.jsx)("div",{style:{position:"absolute",top:0,insetInlineStart:i,width:l,height:Ag-4,display:"flex",alignItems:"center",fontWeight:500},children:(0,Ce.jsx)("div",{style:{fontSize:kg,margin:"0 auto",display:"flex"},children:Eg(e,n,r,o)})},i)}function Lg({timelineState:e,activeRangeStore:t}){const o=(0,y().DP)(),r=(0,h().O$)(e.zoomLevelStore),{startTimestamp:i,endTimestamp:l}=(0,h().O$)(e.currentRangeStore),a=Hn().eM[r],{activeRangeType:s}=a,c=(0,h().O$)(t);if(c){const t=(0,Hn().DY)(n().c9.fromMillis(c.start),"day"),a=(0,Hn().w0)(r,t.valueOf()-i);if("highlight_days"===s){const s=[];let d=n().c9.fromMillis(Math.max(t.valueOf(),(0,Hn().DY)(n().c9.fromMillis(i),"day").valueOf()));for(;d.valueOf()<c.end&&d.valueOf()<l;){s.push(d);d=(0,Hn().Vz)(d,"day")}const u=(0,Hn().w0)(r,d.valueOf()-i)-a+2*fg,p=s.map(((t,o)=>(0,Ce.jsx)(Rg,{timelineState:e,time:t,accent:0===o||o===s.length-1},`${t.toString()}-${o}`)));return(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)("div",{style:{position:"absolute",top:0,insetInlineStart:a-fg,width:u,marginTop:(Ag-bg)/2-2,height:bg,background:o.timelineDarkerBackground,borderRadius:bg/2}}),p]})}{const e=(0,Hn().DY)(n().c9.fromMillis(c.end),"day"),l=(0,Hn().NB)(n().c9.fromMillis(c.end),"day"),s=(0,Hn().w0)(r,e.valueOf()-i)-a+2*fg;return(0,Ce.jsx)("div",{style:{display:"flex",alignItems:"center",position:"absolute",top:0,insetInlineStart:a-fg,minWidth:s,marginTop:(Ag-bg)/2-2,height:bg,background:o.timelineDarkerBackground,borderRadius:bg/2,paddingInlineStart:6,paddingInlineEnd:6},children:(0,Ce.jsx)(Vg,{start:t,end:t.valueOf()!==l.valueOf()?l:void 0,rangeWidth:s})})}}return null}const zg=r.memo(r.forwardRef((function({store:e,collectionContextStore:t,query:n,schema:i,format:l,paddingLeft:a,paddingRight:c,isFullScreen:d,isPreviewing:u,isRootChild:p,disabled:v,isInPeekRenderer:f,paddingBottom:b,showHoverActionsStore:x,blockPropertyValueOverlayStore:C,headerWidth:w},k){const I=(0,he().tz)(),A=function({isFullScreen:e,isRootChild:t}){const[o]=(0,r.useState)((()=>(0,Hn().o8)({isFullScreen:e,isRootChild:t})));return o}({isFullScreen:d,isRootChild:p}),T=(0,m().v3)(),j=s().A.isMobile;(0,g().l)((()=>{const e=t.collectionViewStore();e&&Op().n_({timelineState:A,environment:T,collectionViewStore:e,collectionContextStore:t}),(0,Dp().iH)(T,(0,Dp().ZR)({environment:T,collectionContextStore:t,timelineState:A,isFullScreen:d,isRootChild:p}))})),function({collectionContextStore:e,query:t,schema:o,environment:n}){(0,r.useEffect)((()=>{const r=e.collectionStore();if(r&&!t.timeline_by&&r.isDefined()){const t=e.permissionScopesStore.state,r=e.collectionStore();if(!r||!r.isDefined())return;const i=e.collectionViewStore();if(!i||!t.canConfigureBlock)return;_().createAndCommit({userAction:"Timeline.updateTimelineBy",environment:n,canUndo:!0,perform:e=>{let t;const l=W().HG(o);l&&((0,Vi().f)({collectionViewStore:i,update:{timeline_by:l},transaction:e}),fe().zv({store:i,data:{type:"timeline"},transaction:e}),t&&(0,Bs().F)({environment:n,collectionStore:r,update:t,transaction:e}))}})}}),[t,e,o,n])}({collectionContextStore:t,query:n,schema:i,environment:T}),function(e){(0,r.useEffect)((()=>{const t=()=>{Qt().A.state&&e.hoveredItemStore.setState(void 0)};return Qt().A.addListener(t),()=>{Qt().A.removeListener(t)}}),[e])}(A),function({environment:e,collectionContextStore:t,timelineState:o,isFullScreen:n,isRootChild:i}){(0,r.useEffect)((()=>{const r=o.drawStateStore.state;if(null!=r&&r.tryToCompleteDrawnArrow){(0,Hn().tH)(t)&&_().createAndCommit({userAction:"TimelineItemDependencyDrawHandle.completeUserDrawnArrow",environment:e,canUndo:!0,perform:r=>{Op().sd({timelineState:o,environment:e,transaction:r,collectionContextStore:t,isFullScreen:n,isRootChild:i})}})}}))}({environment:T,collectionContextStore:t,timelineState:A,isFullScreen:d,isRootChild:p}),(0,S().X)((()=>{A.destroyed=!0,A.outerSizeObserver.destroy(),A.timelineSizeObserver.destroy(),A.horizontalScroller&&(A.horizontalScroller.scrollLeft=0,(0,Lt().O)(A.horizontalScroller,"scroll",L))}));const M=(0,h().uB)(void 0,Nd),P=(0,h().uB)(void 0,Lp),R=(0,h().O$)(t.isInHomeWidgetStore),B=(0,r.useCallback)((()=>{const{horizontalScroller:e,outerSizeObserver:t}=A;if(!e)return;const o=A.zoomLevelStore.state,{startTimestamp:n,endTimestamp:r}=A.currentRangeStore.state,i=e.scrollLeft,l=(0,Hn().Ul)(i,e.scrollWidth,e.clientWidth),a=t.rect.state.width,s=(0,Hn().w0)(o,r-n),c=(0,Hn().o$)(A);if(l<Hn().XK){const e=-(0,Hn().C1)(o,Hn().E6);A.currentRangeStore.setState({startTimestamp:n+e,endTimestamp:r+e}),Op().k3({timelineState:A,environment:T,zoomLevel:o,centerTimestamp:c})}else if(l+a>s-Hn().XK){const e=(0,Hn().C1)(o,Hn().E6);A.currentRangeStore.setState({startTimestamp:n+e,endTimestamp:r+e}),Op().k3({timelineState:A,environment:T,zoomLevel:o,centerTimestamp:c})}}),[A,T]),V=(0,Pl().U)(B,200),E=(0,h().K8)((()=>Boolean(t.remoteErrorStore.state&&!t.remoteResultStore.state)),[t]),O=(0,r.useRef)(!1),L=(0,r.useCallback)((()=>{const{horizontalScroller:e,savePreference:t}=A;if(!e)return;const o=e.scrollLeft,n=(0,Hn().Ul)(o,e.scrollWidth,e.clientWidth),r=A.scrollLeftStore.state;T.device.isIOS&&void 0!==r&&0===n&&r>Hn().XK?e.scrollLeft=((0,Md().A1)()?-1:1)*r:(t&&t(),A.scrollLeftStore.setState(n),(0,Hn().nS)(T)?V():B())}),[A,T,V,B]),z=(0,r.useCallback)((()=>{const{startTimestamp:e,endTimestamp:t}=A.currentRangeStore.state;Op().bu({timelineState:A,centerTimestamp:(e+t)/2})}),[A]),K=(0,r.useRef)(null),H=(0,r.useCallback)((e=>{if(e){K.current=e;const{outerSizeObserver:t}=A;t.observe(e);const o=(0,Kt().T8)(e);o&&(A.horizontalScroller=o,(0,Dt().P)(o,"scroll",L),O.current=!0,z())}}),[L,z,A]);(0,r.useEffect)((()=>{if(E&&O.current){if(!A.horizontalScroller)return;(0,Lt().O)(A.horizontalScroller,"scroll",L),O.current=!1,A.horizontalScroller.scrollLeft=0}if(!E&&!O.current){if(!K.current)return;const e=A.horizontalScroller;e&&((0,Dt().P)(e,"scroll",L),O.current=!0,z())}}),[E,z,O,L,A]);const N=(0,h().K8)((()=>t.viewIsFlushToTopbar()),[t]),G=(0,r.useRef)(null),U=(0,h().K8)((()=>{const e=A.zoomLevelStore.state,{startTimestamp:t,endTimestamp:o}=A.currentRangeStore.state;return(0,Hn().w0)(e,o-t)}),[A]),q=(0,h().K8)((()=>!u&&(0,Hn().Od)({environment:T,isRootChild:p,isFullScreen:d,format:l})?Hn().HV:a),[u,p,d,l,a,T]),X=(0,h().K8)((()=>(0,Hn().Ho)({environment:T,paddingLeft:q,format:l,isFullScreen:d,isRootChild:p})),[T,l,d,p,q]);(0,Au().b)(o(403750).A,(()=>({getNode:()=>G.current,customizeEdgeScrollRect(e){const t=X;return Pc().z8.from({top:e.top,height:e.height,left:e.left+t,width:e.width-t})}})),[X]),(0,r.useImperativeHandle)(k,(()=>({addBlockToView({store:e,transaction:o}){const r=e.getAssociatedCollectionStore()??t.collectionStore();if(r)return Op().$N({environment:T,store:e,timelineState:A,query:n,collectionStore:r,collectionContextStore:t,groupFormat:void 0,transaction:o})}})));const Y=(0,h().K8)((()=>(0,Hn().iw)({environment:T,format:l,isFullScreen:d,isRootChild:p})),[T,l,d,p]),Q=(0,h().K8)((()=>Boolean(t.normalizedFormatStore.state.collection_group_by)),[t.normalizedFormatStore]),Z=(0,h().K8)((()=>t.groupsStore.anyGroupHasResults()),[t]),J=(0,h().K8)((()=>Boolean(t.viewsModuleContextStore.getViewModuleType())),[t]),ee=(0,Ee().Zp)(),te=(0,h().K8)((()=>W().mM(t,d)),[t,d]),oe=(0,h().K8)((()=>{const{timelineSizeObserver:e}=A,o=(e.rect.state.height||120)+b+(d?0:72)+(!d&&Y?28:0)+(d&&j?72:0);return t.groupsStore.getAllGroupStates().every((e=>0===e.resultsStore.state.length))?Math.max(o,144+(0,Hn().Zk)(Q)):o}),[A,b,d,Y,j,Q,t.groupsStore]),ne=function(e,t){const o=(0,Ht().bx)(e,!1);return(0,h().K8)((()=>{const e=t.permissionScopesStore.state;return o&&!e.isSyncedCollection}),[o,t])}(e,t),re=(0,r.useCallback)((e=>{if(e){const{timelineSizeObserver:t}=A;t.observe(e)}}),[A]),ie=(0,r.useCallback)(((e,o,n)=>{if(T.device.isMobile)Zn().uK({environment:T,store:e,pageVisitSource:$().y8.Create});else{const{groupFormat:o}=n,r=o?[o]:[],i=t.groupsStore.getGroupState(r),l="collectionTypedView"===t.contextType;Jn().VU({environment:T,store:e,peekMode:W().hH(t),showMoveTo:l,resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:t,pageVisitSource:$().y8.Create})}}),[T,t]),le=(0,r.useCallback)((e=>{const o=t.isLoadingStore.state,n=t.groupsStore.getGroupState([]);if(!n)return;const r=n.reducerResultStore.state;e<ko().B.incrementScrollOffset&&r&&!o&&r.hasMore&&(0,_l().H)({collectionContextStore:t,environment:T,incrementLimitArgs:{isFullScreen:d,currentResultCount:r.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[t,T,d]),ae=(0,r.useCallback)((()=>{const e=t.collectionStore();if(e&&!n.timeline_by&&e.isDefined()){const e=t.permissionScopesStore.state,o=t.collectionStore();if(!o||!o.isDefined())return;const n=t.collectionViewStore();if(!n||!e.canConfigureBlock)return;_().createAndCommit({userAction:"Timeline.createTimelineProperty",environment:T,canUndo:!0,perform:r=>{let l,a=W().HG(i);if(!a&&e.canConfigureCollection){a=(0,Vc().Ay)();l={[a]:{name:I.formatMessage({id:"database.timelineView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}if(!a)return;(0,Vi().f)({collectionViewStore:n,update:{timeline_by:a},transaction:r});const s=t.settingsStore;(0,D().O)({collectionContextStore:t,collectionSettingsStore:s}),F().a2({collectionSettingsStore:s,item:{type:"property",property:a,formatKey:void 0,selectNameInitial:!0}}),fe().zv({store:n,data:{type:"timeline"},transaction:r}),l&&(0,Bs().F)({environment:T,collectionStore:o,update:l,transaction:r})}})}}),[n,t,i,T,I]),se=(0,y().IS)((e=>({container:{position:"relative",float:"inline-start",minWidth:"100%",width:U,...R?{}:{background:f?e.peekTimelineBackground:e.timelineBackground},...!d&&!Y&&!R&&{borderBottom:`1px solid ${e.tableDividerColor}`},...(!Z||R)&&{minHeight:150},...d&&{paddingBottom:b},height:R?"100%":oe}})),[oe,d,R,f,Z,b,U,Y]),{timeline_by:ce}=n;if(!ce)return(0,Ce.jsx)(zp,{collectionContextStore:t,isFullScreen:d,paddingBottom:b,createDateProperty:ae});const de=i[ce];return de&&(0,Rc().$)(de)?(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)("div",{ref:H}),N||u?void 0:(0,Ce.jsx)("div",{style:{height:4}}),(0,Vl().A)((o=>(0,Ce.jsx)(xi,{nodeRef:G,width:U,clipLeftExtra:X||(d?0:q),children:(0,Ce.jsx)("div",{style:se.container,className:Vt().dBr,ref:G,...o,children:(0,Ce.jsxs)(jt().Ay,{store:e,analyticsName:"timeline",shouldShowHalo:!d&&!R&&!u,canSelect:!d&&!J,disablePointerEvents:null==ee?void 0:ee.disableContentPointerEvents,style:R?{height:"100%"}:{},children:[(0,Ce.jsx)(Wp,{timelineState:A}),(0,Ce.jsxs)("div",{style:{position:"absolute",width:"100%",zIndex:0,top:Hn().jI},ref:re,children:[(0,Ce.jsx)(Jm,{store:e,schema:i,query:n,showTable:Y,collectionContextStore:t,timelineState:A,disabled:v,isFullScreen:d,isRootChild:p,isInPeekRenderer:f,paddingLeft:q,paddingRight:c,groupsReducerResultStore:P,format:l,canEditCollectionTimeline:ne,isReady:Z,blockPropertyValueOverlayStore:C,tableStore:M,scrollerLeftOffset:X,onGroupHeaderAddItem:ie,headerWidth:w}),(0,Ce.jsx)(vm,{timelineState:A,disabled:v,isReady:Z,renderEmitter:t.renderEmitter,isFullScreen:d,isRootChild:p})]}),(0,Ce.jsx)(Tg,{isInPeekRenderer:f,timelineState:A,query:n,schema:i,scrollerLeftOffset:X,collectionContextStore:t,showTable:Y}),null!=ee&&ee.disableContentPointerEvents?void 0:(0,Ce.jsx)(tm,{timelineState:A,isInPeekRenderer:f,paddingLeft:q,paddingRight:!d&&p?8:c,format:l,scrollerLeftOffset:X,isFullScreen:d,isRootChild:p,showTable:Y,collectionContextStore:t,isReady:Z}),Y?(0,Ce.jsx)(hg,{store:e,collectionContextStore:t,groupBy:l.collection_group_by,paddingLeft:q,disabled:v,isFullScreen:d,isRootChild:p,format:l,schema:i,query:n,tableStore:M,scrollerLeftOffset:X,isInPeekRenderer:f,paddingRight:c,paddingBottom:b,isInHomeWidget:R,computedOuterHeight:oe,timelineState:A,blockPropertyValueOverlayStore:C,viewIsFlushToTopbar:N,isReady:Z,canEditCollectionTimeline:ne,groupsReducerResultStore:P,onGroupHeaderAddItem:ie,headerWidth:w}):void 0,(0,Ce.jsx)("div",{style:{paddingTop:Hn().jI,pointerEvents:"none"},children:(0,Ce.jsx)(eg,{store:e,collectionContextStore:t,disabled:v,isFullScreen:d,paddingLeft:q,paddingRight:c,headerWidth:w,isRootChild:p,format:l,groupsReducerResultStore:P,canEditCollectionTimeline:ne,onGroupHeaderAddItem:ie,showTable:Y})}),te?void 0:(0,Ce.jsx)(Bl().A,{onChange:le})]})})})))]}):(0,Ce.jsx)(zp,{collectionContextStore:t,isFullScreen:d,paddingBottom:b,createDateProperty:ae})})));const Kg=new(ft().O2)("CollectionChartView",(async()=>await Promise.all([o.e(9773),o.e(36556),o.e(40537),o.e(62475),o.e(3151),o.e(98629),o.e(42838),o.e(27634),o.e(4330),o.e(3259),o.e(45732),o.e(37160),o.e(95541),o.e(22)]).then(o.bind(o,409429)))),Hg=(0,ft()._h)(Kg,(e=>e.CollectionChartView)),Wg=new(ft().O2)("CollectionDashboardView",(async()=>await o.e(54470).then(o.bind(o,347710)))),Ng=(0,ft()._h)(Wg,(e=>e.CollectionDashboardView)),Gg=new(ft().O2)("CollectionFormEditorView",(async()=>await Promise.all([o.e(9773),o.e(36556),o.e(40537),o.e(44711),o.e(53321),o.e(87249),o.e(71621),o.e(88924),o.e(92845),o.e(56369),o.e(46414),o.e(37384),o.e(13955),o.e(94995),o.e(32487),o.e(52273),o.e(61660),o.e(23133)]).then(o.bind(o,766911)))),$g=(0,ft()._h)(Gg,(e=>e.CollectionFormEditorView));var Ug=()=>o(753851);const qg=r.memo((function({store:e,collectionViewStore:t,isDisabled:n,isFullScreen:i,isInPeekRenderer:l,isPreviewing:a,isRootChild:s,paddingLeft:c,paddingRight:d,paddingBottom:u,headerSizeObserver:p,viewType:g,timelineViewRef:S,showHoverActionsStore:y,isInFrameWhenSidePeekOpen:v,query:f,schema:b,format:x,maxHeight:C,placementStore:w,templatePickerMenuListStore:k,editorContentContainerRef:I}){const A=(0,gt().ET)(),T=(0,h().O$)(A.shouldShowSpinnerStore),[j,M]=(0,h().K8)((()=>["collectionSystemView"===A.contextType,A.isInHomeWidgetStore.state]),[A]),P=(0,Nr().X5)(A),R=!(0,Ht().bx)(e,j&&!P||n),_=(0,h().K8)((()=>In({store:e,collectionViewStore:t,collectionContextStore:A})),[e,t,A]),B=!(0,Ht().bx)(_,j);(0,r.useEffect)((()=>{"rendered"!==Ut().default.state.renderPhase&&Ut().default.setPageRendered()}),[]);const V=function({isFullScreen:e,viewType:t,isInFrameWhenSidePeekOpen:n,isInHomeWidget:r,isInPeekRenderer:i,isPreviewing:l,isRootChild:a,store:s}){const c=(0,m().v3)();return(0,h().K8)((()=>{const{device:d}=c,u=d.isPhone,p=("gallery"===t||("calendar"===t||"list"===t)&&e)&&n,m=(0,$t().zo)(c,i),g=oe().default.state;return r||l?void 0:e||a?u?`calc(100% - ${2*(0,Ug().F)(c)}px - ${m}px)`:i?`calc(100% - ${2*oe().PeekModePadding.horizontal[g.mode]}px - ${m}px)`:n?(0,$t().Uh)(c)+(p?(0,$t().Ql)(c):0):e?`calc(100% - ${2*(0,o(103018).W)(c)}px - ${m}px)`:(0,Z().Ck)(s,void 0,d)?`calc(100% - ${2*(0,Ug().F)(c)}px - ${m}px)`:Z().x6-2*(0,Ug().F)(c)-m:`calc(100% - ${m}px)`}),[c,t,e,n,i,r,l,a,s])}({isFullScreen:i,viewType:g,isInFrameWhenSidePeekOpen:v,isInHomeWidget:M,isInPeekRenderer:l,isPreviewing:a,isRootChild:s,store:e}),E=l?qn().A:Un().A,F=(0,h().K8)((()=>p.rect.state.width),[p.rect]);return"table"===g?(0,Ce.jsx)(Bp,{schema:b,format:x,query:f,store:e,collectionContextStore:A,showHoverActionsStore:y,isFullScreen:i,isInPeekRenderer:l,isPreviewing:a,paddingLeft:c,paddingRight:d,minWidth:V,paddingBottom:u,disabled:R,blockPropertyValueOverlayStore:E,isRootChild:s,placementStore:w,headerWidth:F},t.id):"board"===g?(0,Ce.jsx)(Mc,{schema:b,format:x,query:f,store:e,collectionContextStore:A,isFullScreen:i,isInPeekRenderer:l,isPreviewing:a,paddingLeft:c,paddingRight:d,paddingBottom:u,disabled:R,blockPropertyValueOverlayStore:E,isRootChild:s,headerWidth:F},t.id):"page"===g?_?(0,Ce.jsx)(Xg,{targetStore:_,collectionViewStore:t,disabled:B,templatePickerMenuListStore:k,isFullScreen:i,editorContentContainerRef:I}):null:"calendar"===g?(0,Ce.jsx)(kd,{schema:b,format:x,query:f,store:e,collectionContextStore:A,isFullScreen:i,isInPeekRenderer:l,isPreviewing:a,paddingLeft:c,paddingRight:d,maxHeight:C,minWidth:V,paddingBottom:u,disabled:R,blockPropertyValueOverlayStore:E,isRootChild:s,headerWidth:F},t.id):"list"===g?(0,Ce.jsx)(Ld,{schema:b,format:x,query:f,store:e,collectionContextStore:A,isFullScreen:i,isInPeekRenderer:l,isPreviewing:a,paddingLeft:c,paddingRight:v&&!M?24:d,minWidth:V,paddingBottom:u,disabled:R,blockPropertyValueOverlayStore:E,isRootChild:s,headerWidth:F},t.id):"gallery"===g?(0,Ce.jsx)(hs,{schema:b,format:x,query:f,store:e,collectionContextStore:A,isFullScreen:i,isInPeekRenderer:l,isPreviewing:a,paddingLeft:c,paddingRight:d,paddingBottom:u,headerWidth:F,minWidth:V,disabled:R,blockPropertyValueOverlayStore:E,isRootChild:s},t.id):"timeline"===g?(0,Ce.jsx)(zg,{schema:b,format:x,query:f,store:e,collectionContextStore:A,isFullScreen:i,isRootChild:s,isInPeekRenderer:l,isPreviewing:a,minWidth:V,paddingBottom:u,disabled:R,blockPropertyValueOverlayStore:E,showHoverActionsStore:y,ref:S,paddingLeft:c,paddingRight:d,headerWidth:F},t.id):"form_editor"===g?(0,Ce.jsx)(Yg,{collectionViewStore:t,collectionContextStore:A,paddingLeft:c,paddingRight:d},t.id):"chart"===g?(0,Ce.jsx)(Qg,{collectionViewStore:t,isPreviewing:a,paddingLeft:c,paddingRight:d,headerSizeObserver:p,collectionContextStore:A}):"dashboard"===g?(0,Ce.jsx)(Ng,{collectionContextStore:A,paddingLeft:c,paddingRight:d},t.id):"feed"===g?(0,Ce.jsx)(o(732430).jS,{collectionViewStore:t,collectionContextStore:A,blockPropertyValueOverlayStore:E,paddingLeft:c,paddingRight:d,paddingBottom:u,disabled:R}):"map"===g?(0,Ce.jsx)(o(495748).wC,{collectionContextStore:A,paddingLeft:c,paddingRight:d,query:f,format:x,schema:b,store:e,renderGroupResults:e=>(0,Ce.jsx)(la,{disabled:!1,canDrag:!1,canDrop:!1,direction:ra.Vertical,collectionContextStore:A,format:x,groupsPointer:[],shouldShowHoverMenu:!1,emptyDroppableSize:0,analyticsName:"map",paddingLeft:c,paddingRight:d,headerWidth:F,shouldShowShimmer:T,...e})}):null}));function Xg({targetStore:e,collectionViewStore:t,disabled:o,templatePickerMenuListStore:n,isFullScreen:r,editorContentContainerRef:i}){const l=(0,gt().ET)(),a=(0,h().K8)((()=>l.collectionStore()),[l]);return(0,Ce.jsx)(On,{canEdit:!o,disabled:o,store:e,collectionViewStore:t,templatePickerMenuListStore:n,collectionStore:a,isFullScreen:r,editorContentContainerRef:i})}const Yg=r.memo((function({collectionViewStore:e,collectionContextStore:t,paddingLeft:n,paddingRight:r}){const i=(0,y().IS)((e=>({disabledBuilderWrapper:{minHeight:void 0,height:void 0,marginTop:120-zs().l1,marginBottom:120-zs().l1,padding:0,paddingInlineStart:n,paddingInlineEnd:r},disabledBuilderTitle:{fontSize:14,fontWeight:q().Wy.regular},disabledBuilderIcon:{fill:e.icon.tertiary,height:72,margin:"0 auto"},offlineErrorWrapper:{padding:0,marginInlineStart:n,marginInlineEnd:r,height:zn().iZ},offlineErrorIcon:{width:25,height:25,fill:e.text.secondary},offlineErrorTitle:{fontSize:14,color:e.text.secondary,fontWeight:void 0}})),[n,r]),l=!(0,h().O$)(v().e);return s().A.isMobile?(0,Ce.jsx)(zs().Ay,{style:i.disabledBuilderWrapper,title:(0,Ce.jsx)("span",{style:i.disabledBuilderTitle,children:(0,Ce.jsx)(he().sA,{id:"formsInner.disabledBuilder.title",defaultMessage:"Forms can only be edited on desktop"})}),icon:(0,o(556402).i)(i.disabledBuilderIcon)}):l?(0,Ce.jsx)(zs().Ay,{style:i.offlineErrorWrapper,title:(0,Ce.jsx)(he().sA,{id:"formsInner.offlineBuilder.title",defaultMessage:"Go online to edit this form"}),titleStyle:i.offlineErrorTitle,icon:(0,o(553034).C)(i.offlineErrorIcon)}):(0,Ce.jsx)($g,{collectionContextStore:t,paddingLeft:n,paddingRight:r},e.id)}));function Qg({collectionViewStore:e,isPreviewing:t,paddingLeft:o,paddingRight:n,headerSizeObserver:r,collectionContextStore:i}){const l=(0,h().K8)((()=>r.rect.state.width),[r]);return(0,Ce.jsx)(Hg,{collectionContextStore:i,isPreviewing:t,headingWidth:l,paddingLeft:o,paddingRight:n},e.id)}const Zg=r.memo(qg);var Jg=()=>o(132855),eS=()=>o(611520),tS=()=>o(572088),oS=()=>o(817126),nS=()=>o(991249),rS=()=>o(412236);const iS=(0,he().YK)({plus:{id:"subscriptionTier.plus",defaultMessage:"Plus"},business:{id:"subscriptionTier.business",defaultMessage:"Business"},enterprise:{id:"subscriptionTier.enterprise",defaultMessage:"Enterprise"}});function lS({isFullScreen:e,paddingLeft:t,paddingRight:n,paddingBottom:r}){const i=(0,gt().ET)(),l=(0,h().K8)((()=>{const e=i.collectionStore();return null==e?void 0:e.getFormat().integration_id}),[i]),a=(0,o(462853).l)(l);return l?a?(0,Ce.jsx)(aS,{isFullScreen:e,paddingLeft:t,paddingRight:n,paddingBottom:r,integrationId:l,featureName:a}):(0,Ce.jsx)(sS,{isFullScreen:e,paddingLeft:t,paddingRight:n,paddingBottom:r,integrationId:l}):null}function aS({isFullScreen:e,paddingLeft:t,paddingRight:o,paddingBottom:n,integrationId:r,featureName:i}){const l=(0,m().v3)(),a=(0,he().tz)(),s=(0,gt().ET)(),[c,d]=(0,h().K8)((()=>[s.settingsStore,s.collectionStore()]),[s]),u=(0,h().K8)((()=>c.state.open),[c]),p=(0,h().K8)((()=>{if(d)return d.getIcon()}),[d]),g=(0,h().K8)((()=>Yt().A.integrations.state.find((e=>e.id===r))),[r]),S=(0,y().IS)((e=>({integrationTitle:{fontSize:17,fontWeight:q().Wy.medium,textAlign:"center"},upgradeDescription:{fontSize:17,fontWeight:q().Wy.medium,textAlign:"center",color:e.text.tertiary,marginTop:12}})),[]),v=(0,oS().uF)({featureName:i});if(!r||!g||null==v||!v.upsell)return(0,Ce.jsx)(sS,{isFullScreen:e,paddingLeft:t,paddingRight:o,paddingBottom:n,integrationId:r});const{isAvailable:f,upsell:b,upsellTier:x}=v;return"none"!==b.type&&x?f&&b?(0,Ce.jsx)(sS,{isFullScreen:e,paddingLeft:t,paddingRight:o,paddingBottom:n,integrationId:r,featureName:i}):(0,Ce.jsx)("div",{style:{paddingInlineStart:t,paddingInlineEnd:o,paddingTop:8,paddingBottom:e?void 0:n,height:250,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,Ce.jsxs)("div",{style:{paddingInlineEnd:u?zn().vE:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Ce.jsx)(X().B6,{icon:p,iconRecordCategory:"collection",size:48,disabled:!0,isEmptyPage:!1}),(0,Ce.jsx)("div",{style:S.integrationTitle,children:(0,Ce.jsx)(he().sA,{defaultMessage:"{integrationName}",id:"collectionViewBlock.externalCollectionUpsell.title",values:{integrationName:g.name}})}),(0,Ce.jsx)("div",{style:S.upgradeDescription,children:(0,Ce.jsx)(he().sA,{defaultMessage:"Upgrade to {subscriptionTier} to use this feature. {learnMoreLink}",id:"collectionViewBlock.externalCollectionUpsell.description",values:{subscriptionTier:a.formatMessage(iS[x]),learnMoreLink:(0,Ce.jsx)(rS().V,{})}})}),(0,Ce.jsx)(or().A,{size:"md",iconLeading:{icon:Jg().arrowInCircleUpFillIcon,size:"default",colorPalette:"blue",colorVariant:"accentPrimary"},style:{marginTop:12},onClick:()=>{nS().K(l,{from:"collection_synced_database",upsell:b})},children:(0,Ce.jsx)(he().sA,{defaultMessage:"Upgrade",id:"collectionViewBlock.externalCollectionUpsell.upgradeButton.label"})})]})}):(0,Ce.jsx)(sS,{isFullScreen:e,paddingLeft:t,paddingRight:o,paddingBottom:n,integrationId:r})}function sS({isFullScreen:e,paddingLeft:t,paddingRight:o,paddingBottom:n,integrationId:r,featureName:i}){const l=(0,y().DP)(),a=(0,gt().ET)(),[s,c,d]=(0,h().K8)((()=>[a.permissionScopesStore.state,a.settingsStore,a.collectionStore()]),[a]),u=(0,h().K8)((()=>c.state.open),[c]),p=(0,h().K8)((()=>{if(d)return d.getIcon()}),[d]),{isMobileBrowser:g}=(0,m().Y0)(),S=(0,h().K8)((()=>{if(!d)return!1;const e=d.getFormat().integration_id,t=Yt().A.integrations.state.find((t=>t.id===e));return!(!e||!t)&&(0,tS().jw)(e).length>0}),[d]),v=(0,h().K8)((()=>Yt().A.integrations.state.find((e=>e.id===r))),[r]);if(!v)return null;const f=!(g&&!S);return(0,Ce.jsxs)("div",{style:{paddingInlineStart:t,paddingInlineEnd:o,paddingTop:8,paddingBottom:e?void 0:n,minHeight:250,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",gap:32},children:[(0,Ce.jsxs)("div",{style:{paddingInlineEnd:u?zn().vE:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Ce.jsx)(X().B6,{icon:p,iconRecordCategory:"collection",size:48,disabled:!0,isEmptyPage:!1}),(0,Ce.jsx)("div",{style:{fontSize:17,fontWeight:q().Wy.medium,color:l.text.tertiary,textAlign:"center",marginBottom:-2},children:(0,Ce.jsx)(he().sA,{defaultMessage:"{integrationName}",id:"collectionViewBlock.setExternalSource.title",values:{integrationName:v.name}})}),s.canConfigureBlock?(0,Ce.jsx)("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,textAlign:"center",color:l.text.tertiary},children:f?(0,Ce.jsx)(he().sA,{defaultMessage:"<button>Link to {integrationName}</button> to continue",id:"collectionViewBlock.setExternalSourceButton.title",values:{integrationName:v.name,button:e=>(0,Ce.jsx)(Ro().Ay,{style:{display:"inline",padding:"1px 2px",borderRadius:4,textDecoration:"underline"},onClick:()=>{F().Ho({collectionSettingsStore:c})},children:e})}}):void 0}):void 0]}),i?(0,Ce.jsx)(eS().G2,{featureName:i,source:"collection_synced_database"}):null]})}const cS={viewBox:"0 0 20 20",fittedViewBox:"0.5 3.09 17.07 16.41",svg:(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)("path",{d:"M4.5 11.5a4 4 0 1 1 0 8 4 4 0 0 1 0-8m-.09 5.468a.463.463 0 1 0 0 .926.463.463 0 0 0 0-.926m.077-3.761c-.675 0-1.316.39-1.471 1.009a.331.331 0 1 0 .641.16c.062-.248.371-.508.83-.508.54 0 .846.337.846.611 0 .166-.101.346-.316.477l-.008.005-.44.3-.003.002c-.31.215-.51.563-.51.943a.331.331 0 0 0 .662 0c0-.145.077-.297.223-.398l.427-.291c.356-.22.626-.589.626-1.037 0-.769-.746-1.273-1.507-1.273"}),(0,Ce.jsx)("path",{d:"M7.09 3.099c.338 0 .658.152.872.415L9.066 4.87h5.877a2.625 2.625 0 0 1 2.625 2.625v5.755a2.625 2.625 0 0 1-2.625 2.625H9.584q.015-.186.016-.375-.001-.447-.077-.875h5.42c.76 0 1.375-.616 1.375-1.375V8.664H3.625v1.813a5 5 0 0 0-1.25.387v-6.64c0-.622.504-1.125 1.125-1.125zM3.625 7.564h12.693v-.069c0-.76-.615-1.375-1.375-1.375H9.008c-.338 0-.66-.153-.873-.415L7.03 4.35H3.625z"})]})},dS=(0,Se().wt)("folderQuestionMark",cS);function uS({viewType:e,isFullScreen:t,paddingLeft:o,paddingRight:n,paddingBottom:i}){const l=(0,m().v3)(),a=(0,gt().ET)(),s=(0,h().O$)(a.canConfigureBlockStore),c=(0,y().DP)(),d=(0,r.useMemo)((()=>({style:{paddingInlineStart:o,paddingInlineEnd:n,paddingBottom:t?void 0:i},icon:dS({height:48,fill:c.icon.tertiary,margin:"0 auto"})})),[t,i,o,n,c.icon.tertiary]),u=(0,r.useCallback)((()=>{!function(e,t){var o;const n=e.settingsStore,r=(null===(o=e.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())??[],i=e.collectionViewStore(),l=1===r.length&&r[0].id===(null==i?void 0:i.id)&&void 0===r[0].getCollectionStore();(0,D().O)({collectionContextStore:e,collectionSettingsStore:n}),F().R8({collectionSettingsStore:n,item:l?{type:"createViewSource",existingCollectionStore:void 0,createdCollectionRecordPointerMap:void 0,analytics:void 0}:{type:"linkToDatabase",existingCollectionStore:void 0,analytics:void 0}}),(0,T().X)({environment:t,collectionContextStore:e,action:"click_select_data_source"})}(a,l)}),[a,l]);return s?(0,Ce.jsx)(zs().Ay,{title:e?(0,Ce.jsx)(he().sA,{defaultMessage:"New {viewType}",id:"database.viewSettings.createView.newViewType",values:{viewType:Go().to[e].toLocaleLowerCase()}}):(0,Ce.jsx)(he().sA,{defaultMessage:"New view",id:"database.viewSettings.createView.newView"}),buttonText:(0,Ce.jsx)(he().sA,{defaultMessage:"Link a data source",id:"collectionViewBlock.linkDatabase"}),buttonOnClick:u,...d}):(0,Ce.jsx)(zs().Ay,{title:(0,Ce.jsx)(he().sA,{defaultMessage:"No data source",id:"collectionViewBlock.noSourcePlaceholder.title"}),description:(0,Ce.jsx)(he().sA,{defaultMessage:"This block is not connected to any data source.",id:"collectionViewBlock.noSourcePlaceholder.description"}),...d})}const pS={viewBox:"0 0 20 20",fittedViewBox:"3.12 1.12 13.76 16.76",svg:(0,Ce.jsx)("path",{d:"M8.983 1.32a.875.875 0 0 1 1.228 1.234l-.06.066L8.64 4.125H10l.354.01A6.875 6.875 0 1 1 3.125 11a.875.875 0 1 1 1.75 0 5.125 5.125 0 1 0 5.389-5.118L10 5.875H8.639l1.5 1.508.06.067a.875.875 0 0 1-1.3 1.167L5.905 5.61l-.057-.064a.876.876 0 0 1 .06-1.174L8.917 1.38z"})},mS=(0,Se().wt)("arrowCircleSpinCounterClockwiseFill",pS);function gS({collectionContextStore:e,viewType:t,maxHeight:o}){const n=(0,m().v3)(),r=(0,y().IS)((e=>({container:{position:"absolute",inset:0,backgroundColor:e.background.primary,zIndex:2,display:"flex",alignItems:"flex-start",justifyContent:"center",paddingTop:o?void 0:25}})),[o]),i=(0,h().O$)(e.remoteErrorStore),l=(0,h().K8)((()=>{const t=e.remoteResultStore.state;if(!t)return!0;return Object.values(t.reducerResults).every((e=>"results"===e.type&&0===e.blockIds.length||"groups"===e.type&&0===(e.blockResults??[]).length))}),[e]);return i&&"chart"!==t&&l?(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)("div",{style:r.container,children:(0,Ce.jsx)(zs().Ay,{title:(0,Ce.jsx)(he().sA,{id:"collectionRemoteError.title",defaultMessage:"Something went wrong"}),buttonText:(0,Ce.jsx)(he().sA,{id:"collectionRemoteError.tryAgain",defaultMessage:"Try again"}),buttonIcon:mS,buttonOnClick:()=>{(0,K().M)(n,e,{src:"manual_retry"})}})}),(0,Ce.jsx)("div",{style:{height:o??"200px"}})]}):null}const SS={UnlistedCollectionViewDismissButton:new(ft().O2)("UnlistedCollectionViewDismissButton",(async()=>await Promise.all([o.e(75134),o.e(99223),o.e(58795),o.e(77213),o.e(9603),o.e(44560),o.e(62579),o.e(14163),o.e(14310),o.e(14529),o.e(25770),o.e(52274)]).then(o.bind(o,356951)))),UnlistedCollectionViewMoreButton:new(ft().O2)("UnlistedCollectionViewMoreButton",(async()=>await Promise.all([o.e(75134),o.e(99223),o.e(58795),o.e(9773),o.e(36556),o.e(40537),o.e(77213),o.e(9603),o.e(44560),o.e(87249),o.e(71621),o.e(88924),o.e(92845),o.e(56369),o.e(5834),o.e(48486),o.e(2411),o.e(62579),o.e(14163),o.e(14310),o.e(14529),o.e(25770),o.e(95541),o.e(1397),o.e(44745)]).then(o.bind(o,928564)))),CollectionViewAgentsSettingsButton:new(ft().O2)("CollectionViewAgentsSettingsButton",(async()=>await Promise.all([o.e(75134),o.e(99223),o.e(58795),o.e(9773),o.e(36556),o.e(40537),o.e(77213),o.e(9603),o.e(44560),o.e(87249),o.e(71621),o.e(62579),o.e(14163),o.e(14310),o.e(14529),o.e(25770),o.e(97829),o.e(1637)]).then(o.bind(o,549120)))),CollectionViewSettingsButton:new(ft().O2)("CollectionViewSettingsButton",(async()=>await Promise.all([o.e(75134),o.e(99223),o.e(58795),o.e(77213),o.e(9603),o.e(44560),o.e(62579),o.e(14163),o.e(14310),o.e(14529),o.e(25770),o.e(4802),o.e(21871)]).then(o.bind(o,308758)))),CollectionViewBlock:new(ft().O2)("CollectionViewBlock",(async()=>await Promise.resolve().then(o.bind(o,866976)))),RestrictedCollectionView:new(ft().O2)("RestrictedCollectionView",(async()=>await Promise.all([o.e(75134),o.e(99223),o.e(58795),o.e(77213),o.e(9603),o.e(44560),o.e(62579),o.e(14163),o.e(14310),o.e(14529),o.e(25770),o.e(22114),o.e(24515)]).then(o.bind(o,216610)))),UISpacePermissionGroupToken:new(ft().O2)("UISpacePermissionGroupToken",(async()=>await Promise.resolve().then(o.bind(o,27356))))},hS=((0,ft()._h)(SS.UnlistedCollectionViewDismissButton,(e=>e.default)),(0,ft()._h)(SS.UnlistedCollectionViewMoreButton,(e=>e.default)),(0,ft()._h)(SS.CollectionViewSettingsButton,(e=>e.CollectionViewSettingsButton)),(0,ft()._h)(SS.CollectionViewAgentsSettingsButton,(e=>e.CollectionViewAgentsSettingsButton)),(0,ft()._h)(SS.UISpacePermissionGroupToken,(e=>e.UISpacePermissionGroupToken)),(0,ft().jQ)(SS.CollectionViewBlock,(e=>e.CollectionViewBlockWithErrorBoundary)),(0,ft()._h)(SS.RestrictedCollectionView,(e=>e.RestrictedCollectionView))),yS=r.memo((function({collectionContentWrapperStyle:e,collectionContextStore:t,store:o,collectionStore:n,collectionViewStore:r,showHoverActionsStore:i,viewSettingsPlacementStore:l,templatePickerMenuListStore:c,leftRightPaddingStore:d,leftRightMarginStore:u,headerHeightStore:p,currentViewType:g,query:S,schema:v,format:f,maxHeight:b,fullWidth:x,scrollerLeftPadding:C,contentEditableVoidLeft:k,additionalCollectionViewInnerHorizontalPadding:I,rootRef:T,timelineViewRef:j,editorContentContainerRef:M,headerSizeObserver:P,isDisabled:R,isFullScreen:_,isInPeek:B,isPreviewing:V,isRootOrDirectChild:E,isPlaceholderExternalCollection:F,isMyTasksEmpty:O,isInFrameWhenSidePeekOpen:D,showHomeCustomDbEmptyState:L,showMyTasksEmptyState:z,isInHomeWidget:K,isHomeCustomDbEmpty:H,isUnlistedView:W,isViewModule:N,handleAddItemClick:G,handleEditorClick:$,handleHorizontalScrollerMount:U,handleEditorMouseDown:q,handleContentMount:X}){const Y=Boolean(s().A.isMobile),Q=(0,m().WS)(),Z=_?(0,w().Px)(X,T):X,{paddingLeft:J,paddingRight:ee}=(0,h().K8)((()=>{var e,t;const o=I??0;return{paddingLeft:((null===(e=d.state)||void 0===e?void 0:e.paddingLeft)??0)+o,paddingRight:((null===(t=d.state)||void 0===t?void 0:t.paddingRight)??0)+o}}),[d,I]),te=(0,h().K8)((()=>"collectionSettings"===t.contextType?0:_?"timeline"===g?96:Y?90:180:"timeline"===g||"gallery"===g?0:W?16:kn().A.state),[t,_,g,W,Y]),oe=(0,h().K8)((()=>function(e){switch(e){case"chat":case"custom":case"page":case"dashboard":return!1;case"table":case"board":case"calendar":case"list":case"gallery":case"timeline":case"chart":case"feed":case"map":case"form_editor":return!0;default:(0,A().HB)(e)}}(g)&&t.hasSingleCollection()),[g,t]),[ne,re,ie]=(0,h().K8)((()=>[null==n?void 0:n.isReady(),null==n?void 0:n.isDefined(),null==n?void 0:n.canRead()]),[n]),le=(0,y().DP)(),ae=(0,h().K8)((()=>{var o,n;const r={flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",position:"relative",marginInlineStart:null===(o=u.state)||void 0===o?void 0:o.marginLeft,marginInlineEnd:null===(n=u.state)||void 0===n?void 0:n.marginRight,...!_&&!V&&{...C&&{marginInlineStart:-C},maxHeight:b?b-p.state:"inherit",...K&&t.isEditableHomeCollectionStore.state?(0,Gt().V$)({isPhone:Q,theme:le}):{},width:x,insetInlineStart:k},...e};return{shimmer:{backgroundColor:le.largeShimmerColor,height:48,marginBottom:10,width:"100%"},content:r,pageViewContent:{...r,position:void 0,marginInlineStart:void 0,maxWidth:"100%"},contentInner:_||V?{..."custom"===g&&{height:"100%"}}:{position:"relative",...K?{height:"100%",maxHeight:"inherit"}:{},..."custom"===g&&{height:"100%"}}}}),[u,_,V,C,b,p,K,t.isEditableHomeCollectionStore,Q,le,x,k,e,g]);return(0,Ce.jsx)(Cn().A,{name:"CollectionViewBlockContent",children:(()=>{if(oe){if(!n)return(0,Ce.jsx)(a().s,{ref:Z,allowSelectionWithin:!1,style:ae.content,children:(0,Ce.jsx)(uS,{viewType:g,isFullScreen:_,paddingLeft:J,paddingRight:ee,paddingBottom:te})});if(!ne)return(0,Ce.jsx)(a().s,{ref:Z,allowSelectionWithin:!1,style:ae.content,children:(0,Ce.jsx)("div",{style:ae.shimmer,children:(0,Ce.jsx)(wn().A,{emphasized:!1,style:ae.shimmer})})});if(!re)return ie?(0,Ce.jsx)(a().s,{ref:Z,allowSelectionWithin:!1,style:ae.content,children:(0,Ce.jsx)(uS,{viewType:g,isFullScreen:_,paddingLeft:J,paddingRight:ee,paddingBottom:te})}):(0,Ce.jsx)(a().s,{ref:Z,allowSelectionWithin:!1,style:ae.content,children:(0,Ce.jsx)(hS,{collectionStore:n,paddingLeft:J,paddingRight:ee})})}if(F)return(0,Ce.jsx)(a().s,{ref:Z,allowSelectionWithin:!1,style:ae.content,children:(0,Ce.jsx)(lS,{isFullScreen:_,paddingLeft:J,paddingRight:ee,paddingBottom:te})});if(O&&"calendar"!==g)return(0,Ce.jsx)(a().s,{ref:Z,allowSelectionWithin:!1,style:ae.content,children:(0,Ce.jsx)(xn,{collectionContextStore:t,onAddTaskClick:G,from:K?"home_tile_tasks":"home_tasks"})});if(L)return(0,Ce.jsx)(a().s,{ref:Z,allowSelectionWithin:!1,style:ae.content,children:(0,Ce.jsx)(Nt().Y8,{collectionContextStore:t,onAddItemClick:G,from:K?"home_tile_custom_db":"home_custom_db"})});const e=(0,Ce.jsx)(Zg,{store:o,collectionViewStore:r,viewType:g,isDisabled:R,isFullScreen:Boolean(_),isInPeekRenderer:B,isPreviewing:V,isRootChild:E,paddingLeft:J,paddingRight:ee,paddingBottom:te,headerSizeObserver:P,timelineViewRef:j,showHoverActionsStore:i,isInFrameWhenSidePeekOpen:D,query:S,schema:v,format:f,maxHeight:b,placementStore:l,templatePickerMenuListStore:c,editorContentContainerRef:M}),s=z?e:(0,Ce.jsx)($n,{store:o,paddingLeft:C,isPreviewing:V,isFullScreen:Boolean(_),currentViewType:g,isInPeek:B,isInHomeWidget:K,isUnlistedView:W,viewSettingsPlacementStore:l,format:f,isMyTasksEmpty:O,isHomeCustomDbEmpty:H,isInFrameWhenSidePeekOpen:D,handleEditorMouseDown:q,isRootOrDirectChild:E,leftRightPaddingStore:d,paddingBottom:te,handleHorizontalScrollerMount:U,handleEditorClick:$,children:e});if("page"===g)return(0,Ce.jsx)(Dn,{store:o,collectionViewStore:r,isFullScreen:Boolean(_),editorContentContainerRef:M,templatePickerMenuListStore:c,isViewsModule:N,style:ae.pageViewContent});const u=(0,Ce.jsx)("div",{style:ae.contentInner,children:s});return(0,Ce.jsxs)(a().s,{ref:Z,allowSelectionWithin:!0,style:ae.content,children:[(0,Ce.jsx)(gS,{collectionContextStore:t,viewType:g,maxHeight:b}),u]})})()})}));o(16280);function vS(e){const{collectionContextStore:t,headerSizeObserver:o,contentSizeObserver:n,settingsHeaderSizeObserver:i,placementStore:l,placementToOrigin:a="bottom",alignmentToOrigin:s="start",marginTop:c=-1,originGap:d,headerRef:u,handleAddItemClick:p}=e,g=(0,m().v3)(),S=(0,h().O$)(l),[y,v]=(0,r.useState)(!1),[f,b]=(0,r.useState)(!0),x=(0,h().O$)(t.isInPeekRendererStore),C=(0,h().O$)(t.isFullScreenStore),[w,k]=(0,r.useState)(!1),I=(0,h().K8)((()=>function(e){const t=e.settingsStore.state;return t.open&&!0!==t.hideSettingsPopup}(t)),[t]),A=(0,h().K8)((()=>function(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}(e.collectionContextStore)),[e.collectionContextStore]),T=(0,h().K8)((()=>{const e=o.rect.state;return 0!==e.width?(0,L().wW)(t,g.device.isMobile,e.width):"popup"}),[t,g.device.isMobile,o.rect]);(0,r.useEffect)((()=>{I&&(o.recompute(),i.recompute(),l.setState(T)),I&&!C&&"form_editor"!==A&&(v(!0),b(!1))}),[I,C,l,o,i,A,T]);const j=(0,h().K8)((()=>function(e){var t;return null===(t=e.settingsStore.state.ref)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect()}(t)||DOMRect.fromRect({x:(0,Md().A1)()?i.rect.state.left+2:i.rect.state.right-2,y:i.rect.state.y-2,width:0,height:i.rect.state.height})),[t,i.rect]);return(0,r.useEffect)((()=>{if(y){const e=null==u?void 0:u.current;if(e){const t=e.getBoundingClientRect();g.WindowSizeStore.state.height-t.top<zn().iZ&&((0,ee().vq)(e,{edgeDist:0,animate:!1}),o.recompute(),i.recompute())}v(!1),b(!0)}}),[t,g.WindowSizeStore,o,i,x,y,u]),(0,r.useEffect)((()=>{k(!(!I||!f))}),[I,f]),"sidebar"===S?(0,Ce.jsx)(fS,{collectionContextStore:t,headerSizeObserver:o,contentSizeObserver:n,paddingRight:e.paddingRight,shouldScrollIntoView:y,headerHeightStore:e.headerHeightStore,settingsOpen:w,isInPeekRenderer:x}):(0,Ce.jsx)(bS,{collectionContextStore:t,placementToOrigin:a,alignmentToOrigin:s,originGap:d??0,marginTop:c,settingsOpen:w,shouldScrollIntoView:y,originRect:j,handleAddItemClick:p})}function fS(e){const{collectionContextStore:t,headerSizeObserver:o,contentSizeObserver:n,paddingRight:r,shouldScrollIntoView:i,settingsOpen:l}=e,a=(0,m().v3)(),s=(0,h().K8)((()=>{const e=o.rect.state;return a.WindowSizeStore.state.height-(e.top+Ft().Lq)}),[a.WindowSizeStore,o.rect]),c=(0,h().K8)((()=>n.rect.state.height),[n.rect]),u=(0,h().O$)(t.isInPeekRendererStore),p=(0,h().O$)(e.headerHeightStore),g=(0,h().K8)((()=>t.allowScrollingWhenCollectionSettingsSidebarOpen()),[t]),S=(0,y().IS)((e=>({topLevelDiv:{position:"absolute",top:p,insetInlineEnd:-r,background:u?e.background.elevated:e.background.primary,borderInlineStart:`1px solid ${e.tableDividerColor}`,borderImage:`linear-gradient(180deg, ${e.background.primary} 0px, ${e.tableDividerColor} 12px) 1 100%`,paddingInlineEnd:r,zIndex:88,...g?{height:c,minHeight:s}:{height:s}}})),[p,r,u,g,c,s]);return l?(0,Ce.jsx)(Tt().A,{capture:!0,allowMobileAutoScroll:!0,allowUndo:!0,render:e=>(0,Ce.jsx)(ke().A,{initial:{opacity:0,translateX:12},animate:{opacity:1,translateX:0},exit:{opacity:0,translateX:12},style:S.topLevelDiv,className:Vt().N11,...(0,ol().A)({onMouseDown:e=>function(e,t){(0,d().SQ)({event:e,context:d().y$.EditorMouseDown,callback:()=>{(0,es().I)({environment:t})}})}(e,a)},e),children:(0,Ce.jsxs)("div",{style:{display:"flex",...g?{height:"fit-content",position:"sticky",top:0}:{height:"100%"}},children:[(0,Ce.jsx)(xS,{collectionContextStore:t,shouldScrollIntoView:i,isSidebar:!0}),(0,Ce.jsx)("div",{style:{width:r}})]})})}):null}function bS(e){const{collectionContextStore:t,placementToOrigin:o,alignmentToOrigin:n,originGap:i,marginTop:l,settingsOpen:a,shouldScrollIntoView:s,originRect:c,origin:d=(0,Ce.jsx)("div",{}),handleAddItemClick:u}=e,p=(0,m().v3)(),g=(0,r.useCallback)((e=>(0,Ce.jsx)(xS,{collectionContextStore:t,shouldScrollIntoView:s,isSidebar:e,handleAddItemClick:u})),[t,s,u]),S=function({collectionContextStore:e}){const t=(0,m().v3)(),o=(0,m().WS)(),n=(0,h().K8)((()=>t.WindowSizeStore.isLandscape()),[t.WindowSizeStore]);return(0,h().K8)((()=>"chart"===(null==e?void 0:e.getViewType())&&o&&!n),[e,o,n])}({collectionContextStore:t}),y=(0,r.useCallback)((async t=>{var o;await e.collectionContextStore.abortDismissSettings()||(null===(o=e.onDismiss)||void 0===o||o.call(e),function(e,t){F().os({collectionSettingsStore:t.settingsStore})}(0,e.collectionContextStore))}),[e]);return(0,Ce.jsx)(_e().Ay,{popupType:p.device.isMobile?_e().nl.BottomSheet:_e().nl.Popup,bottomSheetInitialState:S?"half":"full",className:`${Vt().N11} ${Vt().xeF}`,open:a,placementToOrigin:o,alignmentToOrigin:n,style:{marginTop:l},origin:d,originGap:i,render:g,onDismiss:y,originRect:c,keepFocus:!0,trapFocus:!0,preventScaleTransition:!0,preventOpacityTransition:!0})}function xS({isSidebar:e,collectionContextStore:t,shouldScrollIntoView:o,handleAddItemClick:n}){const r=(0,h().K8)((()=>s().A.isMobile?L().Bd.MobileSheet:L().Bd.ViewSettings),[]);return o?null:(0,Ce.jsx)(bu().m$,{context:r,collectionContextStore:t,collectionSettingsStore:t.settingsStore,fullHeight:e,handleAddItemClick:n})}const CS=r.memo((function({store:e,leftRightPaddingStore:t,viewSettingsPlacementStore:o,headerHeightStore:n,headerSizeObserver:r,contentSizeObserver:i,settingsHeaderSizeObserver:l,currentViewType:a,isInHomeWidget:s,placementToOrigin:c,alignmentToOrigin:d,headerRef:u,handleAddItemClick:p}){const m=(0,gt().Ks)(),g=(0,h().K8)((()=>(0,J().RX)(e)?{paddingLeft:0,paddingRight:0}:t.state),[t,e]),S=(0,h().K8)((()=>{var e;return void 0!==(null==m||null===(e=m.viewsModuleContextStore.getState())||void 0===e?void 0:e.viewsModule)}),[null==m?void 0:m.viewsModuleContextStore]),y="form_editor"===a,v=(0,h().K8)((()=>{var e;if(c)return c;if(!y)return;return!(null==m||!m.settingsStore.state.open)&&(0,A().Xk)(["formQuestionCreateSettings","formQuestionEditSettings"],null===(e=(0,I().$1)(null==m?void 0:m.settingsStore.state.stack))||void 0===e?void 0:e.type)?"right":"bottom"}),[c,y,null==m?void 0:m.settingsStore]),f=d??(s?"end":void 0),b=y?"right"===v?24:12:void 0,x=(0,h().K8)((()=>(null==m?void 0:m.isInlineViewStore.state)&&(null==m?void 0:m.isUnlistedViewStore.state)),[null==m?void 0:m.isInlineViewStore,null==m?void 0:m.isUnlistedViewStore]);return S?null:g&&m?(0,Ce.jsx)(vS,{collectionContextStore:m,headerSizeObserver:r,contentSizeObserver:i,settingsHeaderSizeObserver:l,headerHeightStore:n,placementStore:o,marginTop:x?-10:void 0,placementToOrigin:v,alignmentToOrigin:f,originGap:b,headerRef:u,...g,handleAddItemClick:p}):null}));var wS=()=>o(606712);const kS=(0,he().YK)({defaultAddViewAriaLabel:{id:"collectionViewTabBar.addView",defaultMessage:"Add view"},defaultAddViewTooltip:{id:"collectionViewTabBar.addViewTooltip",defaultMessage:"Add a new view"},linkedAddViewAriaLabel:{id:"collectionViewTabBar.linkedAddView",defaultMessage:"Add view"},linkedAddViewTooltip:{id:"collectionViewTabBar.linkedAddViewTooltip",defaultMessage:"Add a new view"},viewsModuleAddViewAriaLabel:{id:"collectionViewTabBar.viewsModuleAddView",defaultMessage:"Add tab"},viewsModuleAddViewTooltip:{id:"collectionViewTabBar.viewsModuleAddViewTooltip",defaultMessage:"Add a new tab"}}),IS=r.memo((function(e){const{renderState:t,collectionContextStore:o,preventRectangularSelection:n,variant:r}=e,i=(0,h().K8)((()=>"viewsMain"===o.viewsModuleContextStore.getViewModuleType()),[o]),l=(0,y().IS)((()=>({flex:{display:"flex"}})),[]);return t.showAddViewButton?(0,Ce.jsx)(ke().A,{visible:t.addViewButtonAnimatedIn,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:l.flex,onMouseDown:n,children:i?(0,Ce.jsx)(AS,{variant:r}):(0,Ce.jsx)(TS,{collectionContextStore:o,variant:r})}):null})),AS=r.memo((function(e){const{variant:t}=e,n=(0,he().tz)(),i=(0,y().IS)((e=>({button:{..."pills"===t?{height:28,width:28,borderRadius:"100%"}:void 0,background:e.blue.background.secondary},hoveredButton:{color:e.blue.text.accentPrimary,background:(0,wS().R)({color:e.blue.background.secondary,mode:e.mode})},pressedButton:{color:e.blue.text.accentPrimary,background:(0,wS().y)({color:e.blue.background.secondary,mode:e.mode})},icon:{fill:e.blue.icon.accentPrimary,height:Se().Ev.sm,width:Se().Ev.sm}})),[t]),l=(0,r.useCallback)((()=>(0,Ce.jsx)(he().sA,{...kS.viewsModuleAddViewTooltip})),[]),a=(0,r.useCallback)(((e,t)=>(0,Ce.jsx)(Te().A,{ariaLabel:n.formatMessage(kS.viewsModuleAddViewAriaLabel),className:Vt().Tel,icon:gn().plusSmallIcon,style:i.button,hoveredStyle:i.hoveredButton,pressedStyle:i.pressedButton,iconStyle:i.icon,...t,...e})),[n,i.button,i.hoveredButton,i.icon,i.pressedButton]),s=(0,r.useCallback)((e=>(0,Ce.jsx)(qo().A,{renderTooltip:l,render:t=>a(t,e)})),[a,l]);return(0,Ce.jsx)(o(621866).i,{renderOrigin:s})})),TS=r.memo((function(e){const{collectionContextStore:t,variant:o}=e,n=(0,he().tz)(),i=(0,h().K8)((()=>{var e;return null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isLinkedCollectionView()}),[t]),l=(0,y().IS)((()=>({button:{..."pills"===o?{height:28,width:28,borderRadius:"100%"}:void 0},icon:{height:Se().Ev.sm,width:Se().Ev.sm}})),[o]),a=(0,r.useCallback)((e=>(0,Ce.jsx)(ye().zS,{collectionContextStore:t,onClose:e.close,hideAddDataSource:!1})),[t]),c=(0,r.useCallback)((()=>(0,Ce.jsx)(he().sA,{...i?kS.linkedAddViewTooltip:kS.defaultAddViewTooltip})),[i]),d=(0,r.useCallback)(((e,t)=>(0,Ce.jsx)(Te().A,{ariaLabel:n.formatMessage(i?kS.linkedAddViewAriaLabel:kS.defaultAddViewAriaLabel),className:Vt().Tel,icon:gn().plusSmallIcon,style:l.button,iconStyle:l.icon,...t,...e})),[n,i,l.button,l.icon]),u=(0,r.useCallback)((e=>(0,Ce.jsx)(qo().A,{renderTooltip:c,render:t=>d(t,e)})),[d,c]);return(0,Ce.jsx)(Ae().A,{popupType:s().A.isMobile?Ae().z.BottomSheet:Ae().z.Popup,alignmentToOrigin:"start",originGap:4,render:a,renderOrigin:u},"suggested-views")}));var jS=()=>o(392459),MS=()=>o(556048);function PS(e){const{origin:t}=e,o=(0,m().v3)();return(0,Ce.jsx)(Cu().k,{origin:t,placementToOrigin:"bottom",header:(0,Ce.jsx)(he().sA,{id:"WikiHomeOnboardingTooltip.header",defaultMessage:"Welcome to your new wiki!"}),content:(0,Ce.jsx)(he().sA,{defaultMessage:"Viewers will have the same reading experience as before, but editors have new features to keep content up to date",id:"WikiHomeOnboardingTooltip.content"}),onCloseClick:()=>{fu().A6(o)},enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerPosition:"18%",pointerLength:ku().gO,pointerOffset:ku().Nu,style:{width:ku().Sw}})}function RS(e){const{origin:t}=e,o=(0,m().v3)();return(0,Ce.jsx)(Cu().k,{origin:t,placementToOrigin:"right",header:(0,Ce.jsx)(he().sA,{id:"WikiViewsOnboardingTooltip.header",defaultMessage:"New views"}),content:(0,Ce.jsx)(he().sA,{defaultMessage:"The <bold>All pages</bold> and <bold>Pages I own</bold> views will give you an overview of pages in your wiki",id:"WikiViewsOnboardingTooltip.content",values:{bold:e=>(0,Ce.jsx)("span",{style:{fontWeight:q().Wy.semibold},children:e})}}),onCloseClick:()=>{fu().A6(o)},pointerPosition:"50%",pointerLength:ku().gO,pointerOffset:ku().j$,enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,style:{width:ku().Sw}})}function _S(e){const{collectionContextStore:t,isPlaceholderExternalCollection:o,previewContext:n,showOnlyCurrentView:r}=e;return"collectionSettings"!==t.contextType&&(!(r||o||null!=n&&n.disableHeaderPointerEvents)&&(!!t.permissionScopesStore.state.canConfigureBlock&&(!t.isMultiSourceView&&!t.isLibraryBlock())))}const BS={default:{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:120,MORE_BUTTON_MAX_WIDTH:100,ADD_VIEW_BUTTON_MAX_WIDTH:105,VIEW_TAB_PADDING:40},pills:{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:120,MORE_BUTTON_MAX_WIDTH:85,ADD_VIEW_BUTTON_MAX_WIDTH:28,VIEW_TAB_PADDING:52}},VS=5;function ES({viewStores:e,shouldTryToShowAddViewButton:t,variant:n,viewSelectContainerSizeObserver:i,previousViewSelectState:l}){const a=(0,gt().ET)(),{MORE_BUTTON_MAX_WIDTH:s,ADD_VIEW_BUTTON_MAX_WIDTH:c,VIEW_TAB_PADDING:d}=(0,r.useMemo)((()=>BS[n]),[n]),u=(0,r.useRef)(new Map),p=(0,r.useCallback)((e=>{let t=u.current.get(e.id);t||(t=new(o(773363).k)({style:{fontSize:`${q().J.UIRegular.desktop}px`,fontWeight:q().Wy.medium}}),u.current.set(e.id,t));const n=(0,W().OO)({collectionViewName:e.getName(),collectionViewType:e.getType()}),r=t.measure(n);return Math.min(d+r.width,ts().PB)}),[d]);return(0,h().K8)((()=>{var o;const n=a.collectionViewStore();if(!n)return;if("collectionSettings"===a.contextType)return[];const r=Math.max(s,t?c:0);let d=((null===(o=i.current)||void 0===o?void 0:o.rect.state.width)??0)-r;const u=[],m=p(n);if(!FS({itemWidth:m,availableSpace:d,wasVisible:"dropdown"!==l.current}))return u;u.push(n),d-=m;const g=e.filter((e=>e.id!==n.id));for(const e of g.slice(0,-1)){const t=p(e);if(!(t<=d))break;u.push(e),d-=t}if(u.length===g.length){const e=g[g.length-1];FS({itemWidth:p(e),availableSpace:d,wasVisible:"allTabsVisible"===l.current})&&u.push(e)}const S=u.filter((e=>e.id!==n.id)),h=e.findIndex((e=>e.id===n.id));return S.splice(h,0,n),S}),[a,s,t,c,p,e,l,i])}function FS({itemWidth:e,availableSpace:t,wasVisible:o}){return o?e<=t+VS:e<=t-VS}var OS=()=>o(745266),DS=()=>o(115512),LS=()=>o(374562),zS=()=>o(522827);function KS(e){var t;const{collectionContextStore:o,collectionViewStore:n,schema:r}=e,i=o.collectionStore();if(!i)return n.getName();const l=i.getPropertyMapping(),a=n.getName(),s=null==l?void 0:l[Bo().yx.TaskToSprintRelation];if(!r||!s||a!==xr().A.formatMessage(LS().DZ.tasksCurrentSprintV2ViewName))return n.getName();const c=r[s],d=c&&(0,gr().nC)(c)?(0,gr().Nv)(c):void 0;if(!d)return n.getName();const u=null===(t=(0,zS().ax)(o,"current",d,i))||void 0===t?void 0:t.getBlockTitleStore().getValue();return u?`${xr().A.formatMessage(LS().DZ.tasksCurrentSprintV2ViewNamePrefix)}: ${u[0]}`:n.getName()}function HS(e){const{collectionViewStore:t,collectionContextStore:n}=e,[r,i]=(0,h().K8)((()=>{const e=n.settingsStore.state;return[e.open,e.stack.at(-1)]}),[n.settingsStore]),l=(0,h().O$)(n.viewsModuleContextStore),a=(0,h().K8)((()=>{var e;return null===(e=n.collectionViewStore())||void 0===e?void 0:e.id}),[n]),s=(0,h().K8)((()=>t.getCollectionStore()),[t]),c=(0,h().K8)((()=>{if(!t.isDefined())return;return(null==t?void 0:t.getFormatStore().getKeyStore("app_config_uri").getValue())===Bo().Lu&&null!=s&&s.isDefined()?{name:KS({collectionContextStore:n,collectionViewStore:t,schema:s.getSchema()}),type:t.getType()}:{name:t.getName(),type:t.getType()}}),[t,s,n]),d=r&&i&&("duplicateExistingView"===i.type||"createView"===i.type);return!c||a===t.id&&d&&!l?(0,Ce.jsx)(he().sA,{defaultMessage:"New view",id:"collectionTabBar.newViewPlaceholder.title"}):(0,Ce.jsx)(o(31902).A,{collectionViewName:c.name,collectionViewType:c.type})}var WS=()=>o(244407);const NS=(0,ft()._h)(sp().C,(e=>e.DatabaseOnboardingTourtip)),GS=r.memo((function(e){var t,n;const{collectionViewStore:i,collectionContextStore:l,hideUnderline:a,onViewClick:s,disabled:c,variant:u="default"}=e,p=(0,m().v3)(),{isMobile:g}=(0,m().Y0)(),S=(0,re().X)("allow_empty_view_name"),v=(0,r.useRef)(null),[f,b]=(0,r.useState)(!1),x=(0,o(937199).v$)(),C=(0,Ee().Zp)(),[w,k]=(0,h().K8)((()=>{var e;return[l.viewsModuleContextStore.isInLayoutBuilder(),null===(e=l.viewsModuleContextStore.getViewsModule())||void 0===e?void 0:e.id]}),[l.viewsModuleContextStore]),I=(0,h().K8)((()=>l.collectionViewStore()),[l]),A=(0,h().K8)((()=>l.collectionViewBlockStore()),[l]),j=(0,h().O$)(l.isInHomeWidgetStore),M=(0,cp().f)({tutorialType:"database_onboarding",stepType:"database_onboarding_board_view_tooltip",additionalChecks:e=>"database_onboarding_board_view_tooltip"===(null==e?void 0:e.stepType)&&(null==e?void 0:e.collectionBoardViewId)===i.id}),{isDefinedCollectionViewStore:P,viewIcon:R,viewType:_,viewName:B}=(0,h().K8)((()=>({isDefinedCollectionViewStore:null==i?void 0:i.isDefined(),viewIcon:null==i?void 0:i.getFormat().collection_view_icon,viewType:null==i?void 0:i.getType(),viewName:null==i?void 0:i.getName()})),[i]),V=(0,h().K8)((()=>{var e,t;return!((null==A?void 0:A.getSpaceId())!==(null===(e=Ut().default.state.sidebarSpaceStore)||void 0===e?void 0:e.id))&&i.getFormat().app_config_uri===Bo().Lu&&"sprint_board"===(null===(t=Ut().default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.getFormat().special_page_for_pm_launch)}),[i,A]),E=(0,h().K8)((()=>{var e;return!0===(null===(e=Ut().default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.getFormat().is_asana_imported_project)&&l.isInPeekRendererStore.state}),[l]),F=(0,h().K8)((()=>{var e;const t=null===(e=l.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores();return t&&t.length>1}),[l]),O=(0,r.useCallback)((()=>{b(!1)}),[]),{renderMenu:L,hasMenuItems:z}=(0,o(939556).y)({collectionViewStore:i,collectionContextStore:l,onClose:O}),K=(0,r.useCallback)((()=>{!z||null!=C&&C.disableHeaderPointerEvents||b(!0)}),[C,z]),H=(0,r.useCallback)((e=>{e.preventDefault(),(0,d().SQ)({event:e,context:d().y$.EditorContextMenu,callback:K})}),[K]),N=(0,r.useCallback)((e=>{const t=l.collectionViewStore();if(!t)return;const n=l.viewsModuleContextStore.state?void 0:(0,Pm().V)(e);if(s({currentCollectionViewStore:t,newCollectionViewStore:i,openInNew:n}),t.id===i.id?K():(0,o(180762).t)({environment:p,collectionContextStore:l,collectionViewId:i.id,openInNew:n,isFullScreen:l.isFullScreenStore.state,isRootChild:l.isRootChildStore.state,isInPeekRenderer:l.isInPeekRendererStore.state}),w&&x){var r;const e=null===(r=l.viewsModuleContextStore.getViewsModule())||void 0===r?void 0:r.id;e&&(x.setModuleSelection({type:"existing_module",moduleId:e,isDragging:!1}),(0,D().O)({collectionContextStore:l,collectionSettingsStore:l.settingsStore,closeOnEscape:!1}))}(0,T().X)({environment:p,collectionContextStore:l,action:"click_view_tab",new_view_type:i.getType(),new_view_id:i.id}),M&&fr().tutorialGoToNextStep(p,"database_onboarding")}),[l,s,K,i,w,x,p,M]),G=(null==I?void 0:I.id)===i.id,$=G&&w&&"existing_module"===(null==x||null===(t=x.currentModuleSelection)||void 0===t?void 0:t.type)&&x.currentModuleSelection.moduleId===k,U=w?G&&!$:("pills"!==u||!j)&&("pills"===u?f||G:f),X="pills"!==u&&!a&&G&&F,Y=(null===(n=(0,W().Oz)(l))||void 0===n?void 0:n.background)??"none",Q=(0,y().IS)((e=>({originContainer:{display:"flex",alignItems:"center",background:w?void 0:Y,height:"100%",...X&&{borderBottom:`2px solid ${e.text.primary}`,paddingTop:2},..."pills"===u&&{marginInlineEnd:1}},tooltipOriginContainer:{display:"flex",alignItems:"center",height:ts().r2,fontSize:14,fontWeight:q().Wy.medium,color:G?e.text.primary:e.text.secondary,maxWidth:ts().PB,..."pills"===u&&{borderRadius:20,flexShrink:0,lineHeight:1.2,minWidth:0,padding:"6px 12px",whiteSpace:"nowrap",height:g?ts().G1:ts().r2},...w?$?(0,DS().nl)({width:3,color:e.blue.border.accentPrimary}):(0,DS().nl)({width:1.5,color:e.blue.border.strong}):void 0,...w&&{marginInlineEnd:4,transition:"box-shadow 0.3s"},...M&&{borderRadius:20,boxShadow:e.buttonBlueFocusRing}},tooltipOriginContainerHovered:w?{...(0,DS().nl)({width:3,color:e.blue.border.strong}),background:"none"}:"dark"===e.mode?{background:e.gray.background.secondaryTranslucent}:{},tooltipOriginContainerPressed:w?{...(0,DS().nl)({width:3,color:e.blue.border.accentPrimary}),background:"none"}:{},collectionViewIcon:{marginInlineEnd:S&&""===B?0:6,...j&&{fill:e.text.secondary,transform:"scale(0.75)"}},collectionViewTabTitle:{...q().RC,marginTop:1,...j&&{color:e.text.secondary,fontSize:q().J.UISmall.desktop,fontWeight:q().Wy.medium},...g&&{fontSize:15}}})),[Y,S,G,$,w,j,g,X,u,B,M]),Z=(0,r.useCallback)((e=>(0,Ce.jsxs)(_o().p,{"aria-selected":G,role:"tab",ref:v,size:"pills"===u?"lg":"md",style:Q.tooltipOriginContainer,hovered:U,hoveredStyle:Q.tooltipOriginContainerHovered,pressedStyle:Q.tooltipOriginContainerPressed,onClick:N,disabled:c,...e,children:[(0,Ce.jsx)(OS().h,{color:G?"regular":"light",viewIcon:R,viewType:_,style:Q.collectionViewIcon}),(0,Ce.jsx)("span",{style:Q.collectionViewTabTitle,children:(0,Ce.jsx)(HS,{collectionContextStore:l,collectionViewStore:i})})]},i.id)),[l,i,c,N,U,G,Q.collectionViewIcon,Q.collectionViewTabTitle,Q.tooltipOriginContainer,Q.tooltipOriginContainerHovered,Q.tooltipOriginContainerPressed,u,R,_]);return P&&I&&A?(0,Ce.jsx)(_e().Ay,{popupType:g?_e().nl.BottomSheet:_e().nl.Popup,alignmentToOrigin:"start",open:f,render:L,onDismiss:O,trapFocus:!0,origin:(0,Ce.jsxs)("div",{className:Vt().f_$,style:Q.originContainer,onContextMenu:H,children:[V?(0,Ce.jsx)(Ra().U7,{origin:v}):null,E?(0,Ce.jsx)(ju().gO,{origin:v,store:l}):null,M?(0,Ce.jsx)(NS,{contentRef:v,type:"database_onboarding",tutorialStepId:"database_onboarding_board_view_tooltip"}):null,(0,Ce.jsx)(WS().q,{collectionViewStore:i,render:Z})]})}):null})),$S=r.memo((function(e){const{collectionContextStore:t,showHoverActionsStore:n,isPlaceholderExternalCollection:i,showOnlyCurrentView:l,onViewClick:a,disabled:c,variant:u="default"}=e,p=(0,m().v3)(),g=(0,m().WS)(),S=s().A.isMobile,v=(0,re().X)("allow_empty_view_name"),f=(0,te().y)(),b=(0,r.useRef)(null),x=(0,r.useRef)(null),C=(0,r.useRef)(new(no().E)({throttleMs:50})),w=(0,r.useRef)("allTabsVisible"),k=(0,h().O$)(n),[I,A]=(0,r.useState)(!1),j=(0,r.useCallback)((()=>{A(!0)}),[]),M=(0,r.useCallback)((()=>{A(!1)}),[]),P=(0,Ee().Zp)(),R=(0,r.useRef)(null),{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:B}=(0,r.useMemo)((()=>BS[u]),[u]),{isInCollectionViewPageWithContent:V,isEditingViewsModuleInPageBuilder:E}=(0,h().K8)((()=>{var e;return{isInCollectionViewPageWithContent:null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isCollectionViewPageWithContent(),isEditingViewsModuleInPageBuilder:t.viewsModuleContextStore.isInLayoutBuilder()}}),[t]),F=(0,h().O$)(t.canConfigureBlockStore),O=(0,h().O$)(t.isFullScreenStore),D=(0,h().O$)(t.isInHomeWidgetStore),L=(0,h().K8)((()=>{var e;const o=null===(e=t.collectionViewStore())||void 0===e||null===(e=e.getParentBlockStore())||void 0===e?void 0:e.id;return!!o&&((0,Bt().s)(o)&&t.isInHomeWidgetStore.state)}),[t]),z=(0,h().O$)(t.isEditableHomeCollectionStore),K=(0,h().K8)((()=>{var e;return l?[]:(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[]}),[t,l]),H=(0,h().K8)((()=>_S({collectionContextStore:t,isPlaceholderExternalCollection:i,previewContext:P,showOnlyCurrentView:l})),[t,i,P,l]);(0,r.useEffect)((()=>{const e=C.current;return()=>{e.destroy()}}),[C]);const W=ES({viewStores:K,shouldTryToShowAddViewButton:H,variant:u,viewSelectContainerSizeObserver:C,previousViewSelectState:w}),N=(0,r.useMemo)((()=>null==W?void 0:W.reduce(((e,t)=>(e[t.id]=t,e)),{})),[W]),G=(0,h().K8)((()=>"collectionSettings"===t.contextType),[t]),$=(0,h().K8)((()=>{const e=t.collectionViewStore();if(null!=e&&e.isDefined())return e}),[t]),U=(0,h().K8)((()=>{const e=t.collectionViewStore();if(null!=e&&e.isDefined())return e.getType()}),[t]),X=(0,r.useMemo)((()=>{const e=(null==W?void 0:W.length)||0,t=K.length-e,o=W&&(0===e||1===e&&K.length>1),n=G?"allTabsVisible":o||g||V||z?"dropdown":t>0?"someTabsNotVisible":"allTabsVisible";return{showMoreViewsButton:"someTabsNotVisible"===n||"dropdown"===n,showAddViewButton:H&&"allTabsVisible"===n&&I,addViewButtonAnimatedIn:O||k||E,viewSelectState:n,moreViewsCount:t}}),[W,K.length,g,V,z,I,H,O,k,E,G]);(0,r.useEffect)((()=>{w.current=X.viewSelectState}),[X.viewSelectState]);const Y=(0,r.useCallback)((e=>{e&&C.current.observe(e)}),[C]),Q=(0,r.useCallback)((()=>{(0,T().X)({environment:p,collectionContextStore:t,action:"click_views_dropdown"})}),[t,p]),Z=(0,r.useCallback)((e=>{const n=t.collectionViewBlockStore();n&&_().createAndCommit({userAction:"CollectionViewTabBar.handleViewTabsDrop",environment:p,canUndo:!0,perform:t=>{(0,o(92253).i)({collectionViewBlockStore:n,newViewIds:e,transaction:t})}})}),[t,p]),J=(0,r.useCallback)((e=>{(0,d().SQ)({event:e,context:d().y$.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]),ee=(0,h().K8)((()=>{const e=t.collectionViewStore();if(null!=e&&e.isDefined())return e.getName()}),[t]),oe=(0,y().IS)((e=>{const t=c||D,o=t&&"pills"!==u||"pills"===u?0:5,n="form_editor"===U&&s().A.isMobile?B:g?"100%":ts().PB;return{draggableContainer:{height:"100%"},tabContainer:{display:"flex",alignItems:"center",height:ts().r2,...S&&{height:ts().G1},fontSize:t?q().J.UISmall.desktop:14,fontWeight:t?q().Wy.regular:q().Wy.medium,color:t?e.text.secondary:e.text.primary,maxWidth:n,..."pills"===u&&{background:D?"none":"rgba(55, 53, 47, 0.06)",borderRadius:20,flexShrink:0,lineHeight:1.2,minWidth:0,paddingTop:6,paddingBottom:6,paddingInlineStart:10,paddingInlineEnd:10,whiteSpace:"nowrap"}},moreViewsContainer:{display:"flex",alignItems:"center",height:ts().r2,...S&&{height:ts().G1},fontSize:q().J.UIRegular.desktop,color:e.text.secondary,..."pills"===u&&{borderRadius:20,flexShrink:0,lineHeight:1.2,minWidth:0,paddingTop:6,paddingBottom:6,paddingInlineStart:10,paddingInlineEnd:10,whiteSpace:"nowrap"}},viewIcon:{marginInlineStart:o,marginInlineEnd:v&&""===ee?0:6,...L&&{transform:"scale(0.75)"}},viewTitle:{...q().RC,marginInlineEnd:4,...D&&{fontWeight:q().Wy.medium},...S&&{fontSize:15}},tabChevron:{width:Se().Ev.sm,height:Se().Ev.sm,fill:e.icon.tertiary},viewSelectContainer:{display:"flex",alignItems:"center",height:"100%",marginTop:-3,flexGrow:g?0:10,overflow:"hidden",...f?{marginInlineStart:0}:{marginInlineStart:-4},...E&&{paddingInlineStart:2}},innerContainer:{display:"contents"},viewSelectInner:{display:"flex",alignItems:"center",flexShrink:1,height:"100%",...g&&{width:"100%"}}}}),[c,D,S,u,v,ee,L,g,E,U,B,f]),ne=(0,r.useCallback)(((e,o)=>{if(!N)return null;const n=N[e];if(!n)return null;const i=r.createRef();return(0,Ce.jsx)(US,{collectionContextStore:t,store:n,isFirst:0===o,onViewClick:a,disabled:c,showOnlyCurrentView:l,variant:u,origin:i})}),[t,c,a,l,N,u]),ie=(0,r.useMemo)((()=>W&&N&&"dropdown"!==X.viewSelectState?!F||null!=P&&P.disableHeaderPointerEvents?W.map(((e,o)=>{const n=r.createRef();return(0,Ce.jsx)(US,{collectionContextStore:t,store:e,isFirst:0===o,onViewClick:a,disabled:c,showOnlyCurrentView:l,variant:u,origin:n},e.id)})):(0,Ce.jsx)(Vs().Ay,{keys:Object.keys(N),renderKey:ne,onDrop:Z,direction:"horizontal",style:oe.draggableContainer,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0}):null),[W,X.viewSelectState,F,null==P?void 0:P.disableHeaderPointerEvents,N,oe.draggableContainer,ne,Z,t,a,c,l,u]),le=(0,r.useCallback)(((e,o)=>{if(!$)return;const n=$.getType(),r=$.getFormat().collection_view_icon,i=c||D;return(0,Ce.jsxs)(_o().p,{ref:b,style:oe.tabContainer,hovered:"pills"===u&&!D||void 0,size:"pills"===u?"lg":"md",disabled:c,...(0,ol().A)(e,o),children:[(0,Ce.jsx)(OS().h,{color:i?"lightGray":"regular",viewType:n,viewIcon:r,style:oe.viewIcon,size:i?Se().Ev.sm:void 0}),(0,Ce.jsx)("span",{style:oe.viewTitle,children:(0,Ce.jsx)(HS,{collectionContextStore:t,collectionViewStore:$})}),c?null:(0,Xp().arrowChevronSingleDownSmallIcon)(oe.tabChevron)]})}),[t,$,c,D,oe.tabChevron,oe.tabContainer,oe.viewIcon,oe.viewTitle,u]),ae=(0,r.useCallback)((e=>{const o=t.collectionViewStore();if(null!=o&&o.isDefined()){if("dropdown"===X.viewSelectState){var n;const r="page"===o.getType()&&(null===(n=t.collectionStore())||void 0===n?void 0:n.getFormat().app_config_uri)===Bo().pW;return(0,Ce.jsxs)(Ce.Fragment,{children:[!s().A.isMobile&&r&&"home"===fu().WH()?(0,Ce.jsx)(PS,{origin:b}):null,(0,Ce.jsx)(WS().q,{collectionViewStore:o,render:t=>le(e,t)})]})}return"someTabsNotVisible"===X.viewSelectState?(0,Ce.jsx)(_o().p,{style:oe.moreViewsContainer,size:"pills"===u?"lg":"md",...e,children:(0,Ce.jsx)("span",{children:(0,Ce.jsx)(he().sA,{defaultMessage:"{moreViewsCount} more",id:"collectionTabBar.showMoreViews.title",values:{moreViewsCount:X.moreViewsCount}})})}):void 0}}),[t,X.viewSelectState,X.moreViewsCount,le,oe.moreViewsContainer,u]),se=(0,r.useCallback)((e=>{var o;const n=(null===(o=t.collectionStore())||void 0===o?void 0:o.getFormat().app_config_uri)===Bo().pW;return(0,Ce.jsxs)(Ce.Fragment,{children:[!s().A.isMobile&&"views"===fu().WH()&&n?(0,Ce.jsx)(RS,{origin:x}):void 0,(0,Ce.jsx)("div",{ref:x,children:(0,Ce.jsx)(ye().W5,{collectionContextStore:t,onClose:e.close,onViewClick:a})})]})}),[t,a]);return(0,Ce.jsx)(io().lC,{collectionContextStore:t,step:"views",containerRef:R,children:(0,Ce.jsx)("div",{role:"tablist",tabIndex:-1,onMouseEnter:j,onMouseLeave:M,style:oe.viewSelectContainer,ref:Y,children:(0,Ce.jsxs)("div",{ref:R,style:oe.viewSelectInner,children:[ie,X.showMoreViewsButton?(0,Ce.jsx)("div",{onMouseDown:J,style:oe.innerContainer,children:(0,Ce.jsx)(Ae().A,{alignmentToOrigin:"start",originGap:4,popupType:g?_e().nl.BottomSheet:_e().nl.Popup,render:se,renderOrigin:ae,onClick:Q})}):null,(0,Ce.jsx)(IS,{renderState:X,collectionContextStore:t,preventRectangularSelection:J,variant:u})]})})})}));function US(e){const{collectionContextStore:t,store:n,origin:r,isFirst:i,onViewClick:l,disabled:a,showOnlyCurrentView:s,variant:c}=e,d=(0,h().K8)((()=>Boolean(o(666803).Ay.state.showOnboardingTour&&"database-views-and-filters-tooltip"===(0,o(739135).gt)(Ut().default.state.currentUserSettingsStore,"jira-sync-onboarding"))),[]),u=(0,y().IS)((()=>({jiraOnboardingContainer:{boxShadow:o(638013).p.inputBlueFocusRing.light,borderRadius:6}})),[]);return i&&d?(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)("div",{ref:r,style:u.jiraOnboardingContainer,children:(0,Ce.jsx)(GS,{collectionContextStore:t,collectionViewStore:n,onViewClick:l,disabled:a,hideUnderline:s,variant:c},n.id)}),(0,Ce.jsx)(MS().dM,{origin:r})]}):(0,Ce.jsx)(GS,{collectionContextStore:t,collectionViewStore:n,onViewClick:l,disabled:a,hideUnderline:s,variant:c},n.id)}var qS=()=>o(250031),XS=()=>o(658199),YS=()=>o(21140);const QS=r.memo((function(e){const{collectionContextStore:t}=e,o=(0,h().K8)((()=>{const e=t.collectionViewStore(),o=null==e?void 0:e.getParentBlockStore();return o&&o.pathIsDead()}),[t]),{parentBlockStore:n,isCollectionOrParentBlockDead:r}=(0,h().K8)((()=>{const e=t.collectionStore(),o=null==e?void 0:e.getParentBlockStore(),n=!1===(null==e?void 0:e.getAlive()),r=o&&(null==o?void 0:o.pathIsDead());return{parentBlockStore:o,isCollectionOrParentBlockDead:n||r}}),[t]);return n&&(!o&&r)?(0,Ce.jsx)(ZS,{parentBlockStore:n}):null})),ZS=r.memo((function({parentBlockStore:e}){const t=(0,m().v3)(),{isMobile:n}=(0,m().Y0)(),l=n?YS().wt:YS().Ye,a=(0,y().IS)((e=>({layoutComponent:{color:e.text.secondary,background:e.palette.gray[30],paddingTop:16,paddingInlineEnd:16,paddingBottom:16,paddingInlineStart:12,borderRadius:4,fontSize:14},trashIcon:{width:24,height:24,flexShrink:0,marginInlineEnd:10,padding:2},viewCollectionButton:{fontWeight:q().Wy.semibold}})),[]),s=(0,r.useCallback)((()=>{(0,i().DO_NOT_USE_trackLegacy)(t,"view_deleted_database_from_deleted_collection_view_banner"),o(867201).Y({environment:t,store:e,pageVisitSource:$().y8.LinkInPage})}),[t,e]);return(0,Ce.jsxs)(l,{style:a.layoutComponent,alignItems:"center",justifyContent:n?"":"space-between",children:[(0,Ce.jsxs)(YS().Ye,{alignItems:"center",children:[(0,Oo().trashIcon)(a.trashIcon),(0,Ce.jsx)(he().sA,{id:"collectionViewBlock.deletedContainerBanner.collectionInTrash",defaultMessage:"The original database has been deleted and cannot be edited"})]}),(0,Ce.jsx)(_o().p,{style:a.viewCollectionButton,onClick:s,colorPalette:"gray",colorVariant:"tertiary",iconTrailing:o(940563).arrowStraightRightIcon,children:(0,Ce.jsx)(he().sA,{id:"collectionViewBlock.deletedContainerBanner.collection.viewCollectionButton",defaultMessage:"View database"})})]})}));var JS=()=>o(650829);const eh=new(ft().O2)("DashboardWidgetMoreMenu",(()=>o.e(94835).then(o.bind(o,473390)))),th=(0,ft()._h)(eh,(e=>e.DashboardWidgetMoreMenu));var oh=()=>o(99042),nh=()=>o(152077),rh=()=>o(726483),ih=()=>o(559378);function lh(){const e=(0,gt().Ks)(),t=(0,h().K8)((()=>Boolean(null==e?void 0:e.shouldShowSpinnerStore.state)),[null==e?void 0:e.shouldShowSpinnerStore]);return(0,cs().A)(t,500,100)?(0,Ce.jsx)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginInlineEnd:4},children:(0,Ce.jsx)(qi().A,{style:{width:14,height:14}})}):null}const ah=r.memo(lh);var sh=()=>o(344417);var ch=()=>o(623580),dh=()=>o(19676);const uh=(0,he().YK)({searchLabel:{id:"database.searchButton.tooltip",defaultMessage:"Search"},searchInputPlaceholder:{id:"database.searchInputPlaceholder",defaultMessage:"Type to search..."}}),ph=r.memo((function(e){const{collectionContextStore:t,isFullScreen:o,currentViewType:n,isInHomeWidget:i}=e,l=(0,he().tz)(),a=(0,h().K8)((()=>t.searchOpenStore.state),[t]),s=(0,r.useCallback)((()=>l.formatMessage(uh.searchLabel)),[l]),c=(0,r.useCallback)((e=>(0,Ce.jsx)(mh,{ignoreAreaEvents:e,collectionContextStore:t,isFullScreen:o,currentViewType:n,isSearchOpen:a})),[t,o,n,a]),d=(0,r.useCallback)((e=>(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)(gh,{tooltipEvents:e,collectionContextStore:t,isInHomeWidget:i}),(0,Ce.jsx)(ke().A,{visible:a,animate:{width:150,opacity:1},initial:{width:0,opacity:0},exit:{width:0,opacity:0},children:(0,Ce.jsx)(Tt().A,{capture:a,allowEsc:!0,render:c})})]})),[t,c,a,i]);return(0,Ce.jsx)(qo().A,{renderTooltip:s,render:d})}),tr().A);function mh({ignoreAreaEvents:e,collectionContextStore:t,isFullScreen:n,currentViewType:l,isSearchOpen:a}){const s=(0,m().v3)(),c=(0,he().tz)(),{isPhone:d}=(0,m().Y0)(),u=(0,h().O$)(t.searchQueryStore),[p,g]=(0,r.useState)(!1),S=(0,y().IS)((e=>({input:{fontSize:14,lineHeight:1,paddingInlineEnd:4,color:e.text.primary,marginBottom:1},ignoreArea:{display:"flex",alignItems:"center",overflow:"hidden"}})),[]),v=(0,r.useCallback)((()=>{bt().default.reset(),xt().default.reset(),Zd().A.reset(),g(!0)}),[]),f=(0,r.useCallback)((()=>{t.searchQueryStore.setState(""),t.searchOpenStore.setState(!1)}),[t]),b=(0,r.useCallback)((()=>{t.searchQueryStore.state||f(),g(!1)}),[t,f]),x=(0,r.useCallback)((e=>{27===e.keyCode&&f()}),[f]),C=(0,r.useCallback)((e=>{(0,Or().S)({searchQuery:e.target.value,collectionContextStore:t,isFullScreen:Boolean(n)});const o=(0,Et().L0)(t.collectionStore());!function(e,t){(0,i().DO_NOT_USE_trackLegacy)(e,"collection_search",t)}(s,{view_type:l,...o})}),[t,l,s,n]),w=(0,Pl().Y)(C,250);return r.useEffect((()=>{t.searchOpenStore.state&&v()}),[t.searchOpenStore,v]),(0,Ce.jsxs)("div",{...e,style:S.ignoreArea,children:[(0,Ce.jsx)(ch().A,{style:S.input,right:(0,Ce.jsx)(JS().LazyAssistantCollectionSearchInputButton,{collectionContextStore:t}),format:ch().C.Transparent,value:u,onChange:w,placeholder:c.formatMessage(uh.searchInputPlaceholder),focusInitial:a,showClearButton:!0,onFocus:v,onBlur:b,onCancel:f,onClick:Ii().k,onClearButtonClick:f,onKeyDown:x}),d?(0,Ce.jsx)(o(594739).A,{show:p}):null]})}function gh({tooltipEvents:e,collectionContextStore:t,isInHomeWidget:n}){const i=(0,he().tz)(),l=(0,m().v3)(),{isPhone:a}=(0,m().Y0)(),c=(0,y().IS)((e=>{const{button:t,icon:o}=(0,dh().i)({theme:e,isInHomeWidget:n,isMobile:Boolean(s().A.isMobile)});return{button:t,icon:o}}),[n]),d=(0,h().K8)((()=>0===t.collectionStoresStore.state.length),[t]),u=(0,r.useCallback)((()=>{t.searchOpenStore.update((e=>!e)),(0,T().X)({environment:l,collectionContextStore:t,action:"click_topbar_search"})}),[t,l]);return(0,Ce.jsx)(Te().A,{...e,icon:a?o(207207).J:sh().u,iconStyle:c.icon,style:c.button,disabled:d,onClick:u,ariaLabel:i.formatMessage(uh.searchLabel)})}var Sh=()=>o(261503);function hh(){const e=(0,m().v3)(),{isMobile:t}=(0,m().Y0)(),n=(0,gt().ET)(),i=(0,h().K8)((()=>n.settingsStore.state.open&&rh()._T({tab:(0,Sh().S)(n.settingsStore)})),[n]),l=(0,h().O$)(n.isInHomeWidgetStore),a=(0,h().K8)((()=>n.aliveAutomationCountStore.state>0),[n]),s=(0,h().K8)((()=>n.collectionViewBlockStore()),[n]),c=(0,h().K8)((()=>{var e;return null===(e=Ut().default.getState().mainEditorCurrentBlockStore)||void 0===e?void 0:e.pathIsDead()}),[]),d=(0,h().K8)((()=>{const e=n.collectionStore(),t=null==e?void 0:e.getParentBlockStore();return null==t?void 0:t.pathIsDead()}),[n]),u=(0,h().K8)((()=>null==s?void 0:s.isLocked()),[s]),{disabled:p,tooltipCopy:g,ariaLabel:S}=function({hasAutomations:e,isPageInTrash:t,isParentCollectionInTrash:o}){const n=!(0,h().O$)(v().e),i=(0,r.useMemo)((()=>(o||t)&&!e),[e,t,o]);if(n&&!e)return{disabled:!0,tooltipCopy:xr().A.formatMessage(yh.disableAutomationsSettingsButtonOfflineTooltip),ariaLabel:xr().A.formatMessage(yh.disableAutomationsSettingsButtonOfflineAriaLabel)};if(i)return{disabled:!0,tooltipCopy:xr().A.formatMessage(yh.disableAutomationsSettingsButtonTrashTooltip),ariaLabel:xr().A.formatMessage(yh.disableAutomationsSettingsButtonTrashAriaLabel)};return{disabled:!1,tooltipCopy:xr().A.formatMessage(yh.openAutomationsSettingsButtonTooltip),ariaLabel:xr().A.formatMessage(yh.openAutomationsSettingsButtonAriaLabel)}}({hasAutomations:a,isPageInTrash:c,isParentCollectionInTrash:d}),f=(0,y().IS)((e=>{const{button:o,icon:n}=(0,dh().i)({theme:e,isInHomeWidget:l,isMobile:t});return{button:o,icon:{...n,fill:a?e.blue.icon.accentPrimary:e.icon.secondary}}}),[a,l,t]),b=(0,h().K8)((()=>n.collectionStore()),[n]),[{value:x}]=(0,Wl().Yb)((async()=>await rh().rc({collectionStore:b})),[b]),C=(0,r.useCallback)((t=>{const o=n.settingsStore,r=o.state.open,i=(0,Sh().S)(o);r&&"automationSettings"===(null==i?void 0:i.type)?F().os({collectionSettingsStore:o}):a||u||c||d||!x?((0,D().O)({collectionContextStore:n,collectionSettingsStore:o}),F().R8({collectionSettingsStore:o,item:{source:"collection_thunderbolt_icon",type:"automationSettings"}})):F().js({environment:e,collectionSettingsStore:o,collectionContextStore:n})}),[e,n,a,u,c,d,x]);return(0,Ce.jsx)(qo().A,{renderTooltip:()=>g,render:e=>(0,Ce.jsx)(Te().A,{ariaLabel:S,className:Vt().Jnf,icon:o(598900).f,style:f.button,iconStyle:f.icon,hovered:i,onClick:C,disabled:p,...e})})}const yh=(0,he().YK)({openAutomationsSettingsButtonTooltip:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.tooltip"},openAutomationsSettingsButtonAriaLabel:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.ariaLabel"},disableAutomationsSettingsButtonTrashTooltip:{defaultMessage:"Cant add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.trash.tooltip"},disableAutomationsSettingsButtonTrashAriaLabel:{defaultMessage:"Cant add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.trash.ariaLabel"},disableAutomationsSettingsButtonOfflineTooltip:{defaultMessage:"Unavailable while offline",id:"database.collectionViewBlock.disableAutomationsSettingsButton.offline.tooltip"},disableAutomationsSettingsButtonOfflineAriaLabel:{defaultMessage:"Unavailable while offline",id:"database.collectionViewBlock.disableAutomationsSettingsButton.offline.ariaLabel"}}),vh=r.memo(hh);var fh=()=>o(187696);function bh(e){(0,i().DO_NOT_USE_trackLegacy)(e,"collection_empty_organize_by_menu_view")}var xh=()=>o(415651);class Ch extends f().Store{getInitialState(){return{query:"",limit:20}}}var wh=()=>o(305390);const kh=(0,he().YK)({searchPlaceholder:{defaultMessage:"Search for a page",id:"collectionEmptyOrganizeByMenu.searchPlaceholder"}}),Ih=f().Store.createClass(void 0,{name:"ResultStore"});function Ah({collectionViewBlockStore:e,collectionViewType:t,property:n,collectionContextStore:i,onClose:l,onAddPage:a}){const c=(0,m().v3)(),d=(0,h().uB)(void 0,Ch),u=(0,h().uB)(void 0,Ih),p=(0,h().K8)((()=>d.state.query),[d]),g=(0,h().O$)(u),S=(0,he().tz)(),y=(0,h().K8)((()=>{const{query:e,limit:t}=d.state;return{type:"results",filter:{operator:"and",filters:[{property:n,filter:{operator:"is_empty"}}]},limit:t,searchQuery:e}}),[n,d]),v=(0,r.useCallback)((e=>{d.setState({query:e.target.value,limit:Mh})}),[d]),f=(0,r.useCallback)((e=>{const t=d.state.limit,o=i.isLoadingStore.state;e<jh&&g&&g.hasMore&&!o&&d.setState({...d.state,limit:t+Mh})}),[i,g,d]),b=(0,r.useCallback)((()=>{let r;switch(t){case"calendar":r=s().A.isMobile?(0,Ce.jsx)(he().sA,{defaultMessage:"Click to add date.",id:"collectionEmptyOrganizeByMenu.addResultToCalendar.prompt.basic"}):(0,Ce.jsx)(he().sA,{defaultMessage:"Click or drag to calendar to add date.",id:"collectionEmptyOrganizeByMenu.addResultToCalendar.prompt"});break;case"timeline":r=(0,Ce.jsx)(he().sA,{defaultMessage:"Click to add to the timeline",id:"collectionEmptyOrganizeByMenu.addResultToTimeline.prompt"});break;case"map":r=null;break;default:(0,A().HB)(t)}return g?g&&0===g.blockIds.length?(0,Ce.jsx)(Be().A,{title:r,children:(0,Ce.jsx)(o(64e3).A,{title:(0,Ce.jsx)(he().sA,{defaultMessage:"No results",id:"collectionEmptyOrganizeByMenu.noResults.title"})})}):(0,Ce.jsx)(Pe().Ay,{type:Pe().Oh.Vertical,sections:[{key:"results",render:e=>(0,Ce.jsx)(Be().A,{...e,title:r}),items:Bh(g.blockIds,i,e,n,a,c,t)}],initialFocus:p?0:void 0}):(0,Ce.jsx)(Be().A,{children:(0,Ce.jsx)(_h,{})})}),[e,t,g,i,n,a,c,p]);return(0,Ce.jsxs)(o(170356).Pq,{title:void 0,onCancel:l,desktopWidth:320,children:[(0,Ce.jsx)(Be().A,{isInput:!0,children:(0,Ce.jsx)(o(419357).Ay,{placeholder:S.formatMessage(kh.searchPlaceholder),focus:!s().A.isMobile||void 0,focusAfterAnimation:!0,value:p,onChange:v})}),(0,Ce.jsx)(Zr().A,{id:"empty_organize_by_results",reducer:y,collectionContextStore:i,render:b,resultStore:u}),(0,Ce.jsx)(Bl().A,{onChange:f})]})}const Th=r.memo(Ah,tr().A),jh=200,Mh=20;function Ph({props:e,store:t,disabled:o,url:n,collectionViewType:i}){const l=(0,m().v3)(),a=r.useRef(null),c="calendar"===i&&!s().A.isMobile,d="map"===i,u=(0,Ce.jsx)(wh().A,{...e,ref:a,store:t,hidePath:!0,disabled:o,href:d?n:void 0,onClick:d?()=>{bh(l)}:e.onClick,right:d?void 0:(0,Ce.jsx)(Rh,{url:n,store:t,disabled:o,environment:l}),dontShrinkRight:!0});return c?(0,Ce.jsx)(jt().Ay,{canSelect:!1,canDrag:!o,canEditText:!1,store:t,shouldShowDropZone:!0,getGhostElement:()=>function(e){if(e.current){return[xh().up(e.current)]}return[]}(a),analyticsName:"calendar_no_date_item",children:u}):u}function Rh({url:e,store:t,disabled:o,environment:n}){return void 0===e?null:(0,Ce.jsx)(_o().p,{size:"sm",href:e,disabled:o,onClick:()=>{bh(n)},children:(0,Ce.jsx)(he().sA,{defaultMessage:"Open",id:"collectionEmptyOrganizeByMenu.view.button.label"})},t.id)}function _h(){return(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)(wn().A,{style:{display:"flex",height:16,marginTop:4,marginInlineStart:12,marginInlineEnd:12,borderRadius:12,width:"50%"}}),(0,Ce.jsx)(wn().A,{style:{display:"flex",height:16,marginTop:6,marginInlineStart:12,marginInlineEnd:12,marginBottom:6,borderRadius:12,width:"75%"}})]})}function Bh(e,t,o,n,r,l,a){const s=e.map((e=>ne().B.createChildStore(o,{table:et().ev,id:e}))).filter((e=>!(0,fh().b)(e.getPropertyStore(n).getValue()))).map((e=>{const{mainEditorCurrentBlockStore:o}=Ut().default.state;if(!o)return;const n=(0,W().wy)({environment:l,store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1}),s={key:e.id,render:t=>(0,Ce.jsx)(Ph,{props:t,store:e,disabled:!e.canEdit(),url:n,collectionViewType:a}),action:()=>{e.canEdit()&&(r(e),function(e){(0,i().DO_NOT_USE_trackLegacy)(e,"collection_empty_organize_by_menu_add")}(l))}};return s}));return I().oE(s)}function Vh({emptyTotal:e,emptyProperty:t,collectionViewType:o,timelineViewRef:n}){const i=(0,m().v3)(),l=s().A.isMobile,a=(0,gt().ET)(),c=(0,h().K8)((()=>a.collectionViewBlockStore()),[a]),d=(0,r.useCallback)((()=>{(0,T().X)({environment:i,collectionContextStore:a,action:"click_topbar_empty_organize_by"})}),[a,i]),u=(0,y().IS)((e=>({buttonStyle:(0,dh().y)({theme:e})})),[]),p=(0,r.useCallback)((e=>{const t=e.getAssociatedCollectionStore(),r=null==n?void 0:n.current;if(!t)return;const{performResult:l}=_().createAndCommit({userAction:"CollectionViewBlock.insertedStore",environment:i,canUndo:!0,perform:n=>"calendar"===o?(0,Gc().$N)({environment:i,store:e,collectionStore:t,collectionContextStore:a,startDayOfWeek:Mr().XX.state,transaction:n}):"timeline"===o&&r?r.addBlockToView({store:e,transaction:n}):"map"===o?e:void 0});l&&R().td({environment:i,stores:[l]})}),[a,o,i,n]),g=(0,r.useCallback)((e=>c?(0,Ce.jsx)(Th,{collectionViewBlockStore:c,property:t,onClose:e.close,onAddPage:p,collectionViewType:o,collectionContextStore:a}):null),[a,c,o,t,p]);if(!(0,h().O$)(v().e))return null;const S=l?Pu().n.SlideUp:Pu().n.Popup;return(0,Ce.jsx)(Ae().A,{popupType:S,placementToOrigin:"bottom",alignmentToOrigin:"start",originGap:4,render:g,onClick:d,renderOrigin:t=>{const n=e>=Ui().iY?Ui().iY-1+"+":e;return(0,Ce.jsx)(_o().p,{colorPalette:"gray",style:u.buttonStyle,...t,children:"map"===o?(0,Ce.jsx)(he().sA,{defaultMessage:"No place ({emptyTotalCount})",id:"collectionViewBlock.action.noPlaceButton.noProperty.label",values:{emptyTotalCount:n}}):(0,Ce.jsx)(he().sA,{defaultMessage:"No date ({emptyTotalCount})",id:"collectionViewBlock.action.noDateButton.noProperty.label",values:{emptyTotalCount:n}})})}})}const Eh=r.memo(Vh);var Fh=()=>o(942125);const Oh=(0,he().YK)({filterLabel:{defaultMessage:"Filter",id:"collectionViewBlock.action.filter.title"}}),Dh=r.memo((function(e){const{createFilterSettingsStore:t}=e,n=(0,m().v3)(),{isMobile:i,isPhone:l}=(0,m().Y0)(),a=!(0,h().O$)(v().e),s=(0,gt().ET)(),c=(0,h().K8)((()=>t.state.open),[t]),d=(0,h().O$)(s.isInHomeWidgetStore),u=(0,h().K8)((()=>(0,Lr().N)({collectionContextStore:s}).length>0),[s]),p=(0,h().K8)((()=>(0,Fh().I6)(s)),[s]),g=(0,h().K8)((()=>{var e;return a&&"chart"===(null===(e=s.collectionViewStore())||void 0===e?void 0:e.getType())}),[a,s]),S=g?xr().A.formatMessage(Do().AY.unavailableOfflineTooltip):xr().A.formatMessage(Oh.filterLabel),f=(0,r.useCallback)((()=>{var e;const r=null===(e=s.collectionViewStore())||void 0===e?void 0:e.id,i=s.isEphemeralView(),a=(0,o(427537).H)(s)?s.currentCombinatorFilterStore.state:void 0,c=s.currentPropertyFiltersStore.state,u=s.filtersBarOpenStore.state;r&&!l&&((0,o(914701).E)({userId:n.currentUser.id,collectionViewId:r,isOpen:!u}),s.filtersBarOpenStore.setState(u)),d||i?u||c.length>0||a?F().R8({collectionSettingsStore:s.settingsStore,item:{type:"filters"}}):(F().R8({collectionSettingsStore:s.settingsStore,item:{type:"createFilter"}}),ri().Ms(s)):u||c.length>0||a?s.filtersBarOpenStore.setState(!u):(F().R8({collectionSettingsStore:t,item:{type:"createFilter"}}),ri().Ms(s)),(0,T().X)({environment:n,collectionContextStore:s,action:"click_topbar_filter"})}),[s,t,n,d,l]),b=(0,r.useCallback)((()=>{F().os({collectionSettingsStore:t})}),[t]),x=(0,y().IS)((e=>{const{button:t,icon:o}=(0,dh().i)({theme:e,isInHomeWidget:d,isMobile:i});return{button:t,icon:{...o,fill:u?e.blue.icon.accentPrimary:e.icon.secondary},tempFilterIndicator:{position:"absolute",top:3,insetInlineEnd:2,background:e.orange.icon.accentPrimary,border:`1px solid ${e.background.primary}`,width:9,height:9,borderRadius:9},iconContainer:{position:"relative"}}}),[d,u,i]),C=(0,r.useCallback)((()=>S),[S]),w=(0,r.useCallback)((()=>(0,Ce.jsx)(bu().m$,{context:L().Bd.TopbarFilterPopup,collectionContextStore:s,collectionSettingsStore:t,hideDesktopHeader:!0})),[s,t]);return(0,Ce.jsx)(_e().Ay,{trapFocus:!0,popupType:i?Ae().z.SlideUp:Ae().z.Popup,open:c,placementToOrigin:"bottom",alignmentToOrigin:"start",origin:(0,Ce.jsx)(qo().A,{renderTooltip:C,render:e=>(0,Ce.jsxs)("div",{style:x.iconContainer,children:[(0,Ce.jsx)(Te().A,{...e,ariaLabel:S,icon:ir().filterSmallIcon,iconStyle:x.icon,style:x.button,onClick:f,disabled:g}),p?(0,Ce.jsx)("div",{style:x.tempFilterIndicator}):void 0]})}),onDismiss:b,originGap:4,render:w})}));const Lh=(0,he().YK)({followLabel:{defaultMessage:"Follow",id:"collectionViewBlock.action.follow.title"}});function zh({createFollowSettingsStore:e}){const{isMobile:t}=(0,m().Y0)(),n=(0,gt().ET)(),i=(0,y().IS)((e=>{const{button:o,icon:n}=(0,dh().i)({theme:e,isInHomeWidget:!1,isMobile:t});return{button:o,icon:n,iconContainer:{position:"relative"}}}),[t]),l=(0,r.useMemo)((()=>xr().A.formatMessage(Lh.followLabel)),[]),a=(0,h().K8)((()=>e.state.open),[e]),s=(0,r.useCallback)((()=>{F().R8({collectionSettingsStore:e,item:{type:"follow"}})}),[e]),c=(0,r.useCallback)((()=>{F().os({collectionSettingsStore:e})}),[e]),d=(0,r.useCallback)((()=>l),[l]),u=(0,r.useCallback)((()=>(0,Ce.jsx)(bu().m$,{context:L().Bd.TopbarFollowPopup,collectionContextStore:n,collectionSettingsStore:e,hideDesktopHeader:!0})),[n,e]);return(0,Ce.jsx)(_e().Ay,{trapFocus:!0,popupType:t?Ae().z.BottomSheet:Ae().z.Popup,open:a,placementToOrigin:"bottom",alignmentToOrigin:"start",origin:(0,Ce.jsx)(qo().A,{renderTooltip:d,render:e=>(0,Ce.jsx)("div",{style:i.iconContainer,children:(0,Ce.jsx)(Te().A,{...e,ariaLabel:l,icon:o(588047).k,iconStyle:i.icon,style:i.button,onClick:s})})}),onDismiss:c,originGap:4,render:u})}function Kh({store:e,viewType:t}){const n=(0,m().v3)(),{isMobile:i}=(0,m().Y0)(),l=(0,gt().ET)(),a=(0,h().K8)((()=>{var t;return(0,Q().Ay)({store:e,fullyQualified:!1,pageVisitSource:$().y8.Expand,demoSettingsStore:ih().A,collectionViewId:null===(t=l.collectionViewStore())||void 0===t?void 0:t.id})}),[e,l]),s=(0,h().O$)(l.isInHomeWidgetStore),c=(0,y().IS)((e=>(0,dh().i)({theme:e,isInHomeWidget:s,isMobile:i})),[i,s]),d=(0,r.useCallback)((()=>{var r,i;return(0,o(989992).p)(n,{view_type:t,collection_id:null===(r=l.collectionStore())||void 0===r?void 0:r.id,collection_view_id:null===(i=l.collectionViewStore())||void 0===i?void 0:i.id,collection_view_block_id:e.id})}),[n,t,e,l]),u=xr().A.formatMessage(o(65402).D.openFullscreenButton),p=(0,r.useMemo)((()=>i?o(47218).arrowExpandDiagonalBottomLeftToTopRightIcon:o(662984).arrowExpandDiagonalBottomLeftToTopRightSmallIcon),[i]);return(0,Ce.jsx)(qo().A,{renderTooltip:()=>u,render:e=>(0,Ce.jsx)(Te().A,{ariaLabel:u,href:a,onClick:d,icon:p,style:c.button,iconStyle:c.icon,...e})})}const Hh=r.memo(Kh);var Wh=()=>o(959462);const Nh=(0,he().YK)({offlineLabelOneView:{defaultMessage:"The top {numPages} pages are available offline",id:"collectionViewBlock.offlineIndicator.labelOneView"},offlineLabelMultipleViews:{defaultMessage:"The top {numPages} pages in the first view are available offline",id:"collectionViewBlock.offlineIndicator.labelMultipleViews"},lastSyncedOn:{defaultMessage:"Last synced on {date}",id:"collectionViewBlock.offlineIndicator.lastSyncedOn"}});function Gh(){const e=(0,gt().ET)(),{isMobile:t}=(0,m().Y0)(),n=(0,h().O$)(e.isInHomeWidgetStore),i=(0,y().IS)((e=>{const{button:o,icon:r}=(0,dh().i)({theme:e,isInHomeWidget:n,isMobile:t});return{icon:r,iconContainer:{position:"relative",...o},secondaryText:{color:e.text.secondary}}}),[n,t]),l=(0,h().K8)((()=>{var t;return null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.id}),[e]),a=(0,h().K8)((()=>{var t;return(null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.getCollectionViewIds().length)??0}),[e]),s=(0,h().K8)((()=>er().default.getConfigKey("offline_query_collection_settings","limit")),[]),c=(0,h().K8)((()=>{var e;return void 0!==l&&"success"===(null===(e=Wh().A.state.offlinePages)||void 0===e||null===(e=e[l])||void 0===e?void 0:e.download_status)}),[l]),d=(0,h().K8)((()=>{var e;return c&&void 0!==l?null===(e=Wh().A.state.offlinePages)||void 0===e||null===(e=e[l])||void 0===e?void 0:e.last_downloaded_at:void 0}),[l,c]),u=d?xr().A.formatMessage(Nh.lastSyncedOn,{date:new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"}).format(d)}):void 0,p=xr().A.formatMessage(1===a?Nh.offlineLabelOneView:Nh.offlineLabelMultipleViews,{numPages:s}),g=(0,r.useCallback)((()=>(0,Ce.jsxs)("div",{style:{width:200},children:[(0,Ce.jsx)("div",{children:p}),u?(0,Ce.jsx)("div",{style:i.secondaryText,children:u}):void 0]})),[p,u,i.secondaryText]);return d?(0,Ce.jsx)(qo().A,{renderTooltip:g,render:e=>(0,Ce.jsx)("div",{style:i.iconContainer,...e,children:(0,o(350646).k)(i.icon)}),textWrap:!0}):null}const $h=r.memo(Gh);const Uh=(0,he().YK)({filterSortLabel:{defaultMessage:"Filter and Sort",id:"collectionViewBlock.action.filterSort.title"}}),qh=r.memo((function(e){const{phoneFilterSortSettingsStore:t}=e,n=(0,gt().ET)(),{isMobile:i}=(0,m().Y0)(),l=(0,h().K8)((()=>{const e=n.currentSortsStore.state.length>0,t=(0,Nl().tG)(n)>0;return e||t}),[n]),a=(0,h().K8)((()=>(0,Fh().ye)(n)||(0,Fh().gv)(n)),[n]),s=!(0,h().O$)(v().e),c=(0,h().K8)((()=>{var e;return s&&"chart"===(null===(e=n.collectionViewStore())||void 0===e?void 0:e.getType())}),[s,n]),d=c?xr().A.formatMessage(Do().AY.unavailableOfflineTooltip):xr().A.formatMessage(Uh.filterSortLabel),u=(0,y().IS)((e=>{const{button:t,icon:o}=(0,dh().i)({theme:e,isInHomeWidget:!1,isMobile:i});return{button:t,icon:{...o,fill:l?e.blue.icon.accentPrimary:e.icon.secondary},iconContainer:{position:"relative"},diffDot:{position:"absolute",top:3,insetInlineEnd:2,background:e.orange.icon.accentPrimary,border:`1px solid ${e.background.primary}`,width:9,height:9,borderRadius:9}}}),[l,i]),p=(0,h().K8)((()=>t.state.open),[t]),g=(0,r.useCallback)((()=>(0,Ce.jsx)(bu().m$,{context:L().Bd.MobileSheet,collectionContextStore:n,collectionSettingsStore:t,hideDesktopHeader:!0})),[n,t]),S=(0,r.useCallback)((()=>{F().R8({collectionSettingsStore:t,item:{type:"phoneFilterAndSort"}})}),[t]),f=(0,r.useCallback)((()=>{F().os({collectionSettingsStore:t})}),[t]);return(0,Ce.jsx)(_e().Ay,{trapFocus:!0,open:p,popupType:_e().nl.BottomSheet,origin:(0,Ce.jsxs)("div",{style:u.iconContainer,children:[(0,Ce.jsx)(Te().A,{ariaLabel:d,icon:o(170350).filterIcon,iconStyle:u.icon,style:u.button,onClick:S,disabled:c}),a?(0,Ce.jsx)("div",{style:u.diffDot}):void 0]}),onDismiss:f,render:g})}));const Xh=r.memo((function(e){const{store:t,handleAddItemClick:n}=e,i=(0,m().v3)(),{isMobile:l,isPhone:a}=(0,m().Y0)(),s=(0,r.useRef)(null),c=(0,gt().ET)(),d=(0,h().K8)((()=>c.isMultiSourceView),[c]),u=(0,Nr().X5)(c),p=(0,h().K8)((()=>(0,W().h6)(c)),[c]),g=(0,h().K8)((()=>{if(!c.isMultiSourceView)return;const e=c.collectionStoresStore.state;if(!e)return"loading";if(0===e.length)return"noDbs";const t=Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())));return t?void 0:bn}),[c]),S=(0,y().IS)((()=>({buttonWrapper:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",marginInlineStart:a?12:6},buttonStyle:{fontSize:14,height:a?32:28},mainButtonStyle:{...a&&{width:32,fontSize:17}},iconStyle:{...a&&{width:17,marginInlineEnd:0}}})),[a]),v=(0,r.useCallback)((e=>{F().Ub({environment:i,handleAddItemClick:n,buttonRef:s,event:e})}),[i,n,s]),f=(0,r.useCallback)((e=>{d?v(e):n(e)}),[d,v,n]),b=(0,r.useRef)(null),x=(0,r.useCallback)((e=>(0,Ce.jsx)("div",{style:S.buttonWrapper,ref:b,children:(0,Ce.jsx)(io().lC,{collectionContextStore:c,containerRef:b,step:"new_page",children:(0,Ce.jsx)(o(430102).I,{ref:s,title:a?void 0:p,iconLeading:a?o(73822).plusFillIcon:void 0,color:"blue",onClick:f,mainButtonTooltip:g===bn?(0,Ce.jsx)(he().sA,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"collectionViewBlock.addItem.tooltip.noWritableDbs",values:{br:(0,Ce.jsx)("br",{})}}):void 0,onDropdownClick:e.onClick,style:S.buttonStyle,className:Vt().kel,disabled:Boolean(g),disableDropdown:d||u,mainButtonStyle:S.mainButtonStyle,iconStyle:S.iconStyle})})})),[S.buttonWrapper,S.buttonStyle,S.mainButtonStyle,S.iconStyle,c,a,p,f,g,d,u]);return(0,Ce.jsx)(o(776547).m,{store:t,popupType:l?Pu().n.BottomSheet:Pu().n.Popup,renderOrigin:x,placementToOrigin:"bottom"})}));const Yh=(0,he().YK)({sortLabel:{defaultMessage:"Sort",id:"collectionViewBlock.action.sort.title"}});function Qh({createSortSettingsStore:e}){const t=(0,gt().ET)(),{isMobile:n}=(0,m().Y0)(),i=(0,m().v3)(),l=(0,h().K8)((()=>e.state.open),[e]),a=(0,h().K8)((()=>t.currentSortsStore.state.length>0),[t]),s=(0,h().K8)((()=>(0,Fh().gv)(t)),[t]),c=(0,h().O$)(t.isInHomeWidgetStore),d=(0,r.useCallback)((()=>{const o=t.permissionScopesStore.state.canConfigureBlock?t.currentCombinatorFilterStore.state:void 0,n=t.currentPropertyFiltersStore.state,r=t.filtersBarOpenStore.state,l=a||r||n.length>0||o;c&&F().R8({collectionSettingsStore:t.settingsStore,item:{type:a?"sort":"createSort"}}),l?c||(t.filtersBarOpenStore.setState(!r),a?F().R8({collectionSettingsStore:t.filterBarSortSettingsStore,item:{type:"sort"}}):F().R8({collectionSettingsStore:e,item:{type:"createSort"}})):c||F().R8({collectionSettingsStore:e,item:{type:"createSort"}}),(0,T().X)({environment:i,collectionContextStore:t,action:"click_topbar_sort"})}),[t,e,i,a,c]),u=(0,r.useCallback)((()=>{F().os({collectionSettingsStore:e})}),[e]),p=xr().A.formatMessage(Yh.sortLabel),g=(0,y().IS)((e=>{const{button:t,icon:o}=(0,dh().i)({theme:e,isInHomeWidget:c,isMobile:n});return{icon:{...o,fill:a?e.blue.icon.accentPrimary:e.icon.secondary,transform:"rotate(180deg)"},button:t,tempSortIndicator:{position:"absolute",top:3,insetInlineEnd:2,background:e.orange.icon.accentPrimary,border:`1px solid ${e.background.primary}`,width:9,height:9,borderRadius:9}}}),[a,c,n]);return(0,Ce.jsx)(_e().Ay,{popupType:n?Ae().z.SlideUp:Ae().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",open:l,origin:(0,Ce.jsx)(qo().A,{renderTooltip:()=>p,render:e=>(0,Ce.jsxs)("div",{style:{position:"relative"},children:[(0,Ce.jsx)(Te().A,{...e,ariaLabel:p,icon:o(513402).arrowUpDownSmallIcon,iconStyle:g.icon,style:g.button,onClick:d}),s?(0,Ce.jsx)("div",{style:g.tempSortIndicator}):void 0]})}),onDismiss:u,originGap:4,render:()=>(0,Ce.jsx)(bu().m$,{context:L().Bd.TopbarSortPopup,collectionContextStore:t,collectionSettingsStore:e,hideDesktopHeader:!0}),trapFocus:!0})}const Zh=r.memo(Qh);function Jh(){const e=(0,m().v3)(),t=(0,gt().ET)(),n=(0,h().K8)((()=>{var e;return null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id}),[t]),i=(0,y().IS)((e=>({button:{display:"flex",alignItems:"center",fontSize:14,fontWeight:q().Wy.medium,color:e.text.secondary},searchIcon:{width:Se().Ev.sm,height:Se().Ev.sm,fill:e.icon.secondary,marginInlineEnd:6}})),[]),l=(0,r.useCallback)((()=>{if(!n)return;if(o(430483).zD.isMiniSearchModalEnabled()){const e=o(786601).A.state.query;if(e){const t=(0,k().ld4)(n,void 0),o=(0,k().Omw)(t);e.setValue([o,[" "]])}}else o(250484).Ay.updateFilters({ancestors:[n]});o(260488).su({environment:e,analyticsFrom:"wiki-home-collection-view"})}),[e,n]);return n?(0,Ce.jsxs)(_o().p,{style:i.button,onClick:l,children:[(0,sh().u)(i.searchIcon),(0,Ce.jsx)(he().sA,{defaultMessage:"Search",id:"database.collectionViewBlock.pageView.search"})]}):null}const ey=r.memo(Jh);const ty=(0,he().YK)({feedbackButtonTooltip:{defaultMessage:"Share feedback on using Posts",id:"collectionViewBlock.action.postsFeedback.tooltip"}});function oy(e){const{theme:t}=e,n=(0,m().v3)(),{isMobile:i}=(0,m().Y0)(),l=xr().A.formatMessage(ty.feedbackButtonTooltip),a=(0,r.useCallback)((()=>l),[l]);return(0,Ce.jsx)(qo().A,{renderTooltip:a,render:e=>(0,Ce.jsx)(_o().p,{...e,ariaLabel:l,iconLeading:{icon:$a().pencilLineSmallIcon,size:"xs"},colorPalette:"gray",onClick:()=>{(0,o(27579).L)({environment:n,url:"https://notion.notion.site/1caefdeead058012a151c3f764a4135b"})},style:(0,dh().i)({theme:t,isInHomeWidget:!0,isFeedbackButton:!0,isMobile:i}).button,children:(0,Ce.jsx)(he().sA,{defaultMessage:"Feedback",id:"TeamHome.feedback.label"})})})}const ny=new(ft().O2)("MinimizableCollectionViewBlockHeaderActions",(async()=>await o.e(94516).then(o.bind(o,150177)))),ry=(0,ft()._h)(ny,(e=>e.MinimizableCollectionViewBlockHeaderActions)),iy=new(ft().O2)("DashboardHeaderActions",(async()=>await o.e(58419).then(o.bind(o,537798)))),ly=(0,ft()._h)(iy,(e=>e.DashboardHeaderActions)),ay=r.memo((function(e){const{collectionContextStore:t,createFilterSettingsStore:n,createSortSettingsStore:i,phoneFilterSortSettingsStore:l,createFollowSettingsStore:a,currentViewType:c,handleAddItemClick:u,headerSizeObserver:p,isFullScreen:g,isInHomeWidget:S,isPlaceholderExternalCollection:b,minimizedActionViewStore:x,settingsHeaderSizeObserver:C,showHoverActionsStore:w,store:k,timelineViewRef:I,containerStyleOverrides:A}=e,T=(0,m().v3)(),{isPhone:j,isMobileNative:M}=(0,m().Y0)(),P=(0,re().X)("download_for_offline"),R=(0,h().K8)((()=>(0,o(578136).D)({isMobileNative:M})),[M]),_=(0,nh().WA)(),B=(0,y().DP)(),V=(0,o(792485).S)(),E=(0,h().K8)((()=>t.collectionViewStore()),[t]),F=(0,h().K8)((()=>"view"===o(411671).A.getMode(T,k).permission),[T,k]),O=(0,h().K8)((()=>(0,Nn().w)(T)),[T]),D=(0,h().K8)((()=>({blockId:ih().A.getCurrentStepBlockId(),subStep:ih().A.getCurrentStepSubStep()??""})),[]),z=(0,h().K8)((()=>{const e=V&&V.publicEditModeStore.state.hasPublicPermission;return!(!ih().A.isActiveDemo()||!e)&&(!s().A.isMobile&&D.blockId===k.id)}),[D.blockId,V,k.id]),K=(0,h().K8)((()=>t.isLibraryBlock()?["filter","sort","viewSettings"]:e.allowedActions),[t,e.allowedActions]),H=(0,h().O$)(t.wasCreatedThisSessionStore),W=(0,h().K8)((()=>{const e=t.resultSetStore.state;return((null==e?void 0:e.blockIds.size)??0)<3}),[t.resultSetStore]),N=(0,h().O$)(t.normalizedSchemaStore),G=(0,h().K8)((()=>{var e;return"page"===t.getViewType()&&"viewsMain"===t.viewsModuleContextStore.getViewModuleType()&&void 0===(null==E||null===(e=E.getFormat())||void 0===e?void 0:e.page_pointer)}),[t,E]),[$,q]=(0,r.useState)(!1);(0,r.useEffect)((()=>{H&&W&&Object.keys(N).length<=1||q(!0)}),[$,H,W,N]);const X=(0,h().K8)((()=>(void 0!==t.collectionStore()||"collectionTypedView"===t.contextType)&&!b&&C.rect.state.width>=L().xO),[t,b,C]),Y=(0,h().K8)((()=>!!z||w.state),[z,w]),Q=(0,h().K8)((()=>{const e=p.rect.state;return!s().A.isMobile&&e.width>0&&e.width<400}),[p.rect]),{isUnlisted:Z,isUnlistedFromSemanticQuery:J}=(0,h().K8)((()=>{const e=null==E?void 0:E.getUnlistedStatus(),t=!0===(null==e?void 0:e.isUnlisted);return{isUnlisted:t,isUnlistedFromSemanticQuery:t&&!0===(null==e?void 0:e.isUnlistedFromSemanticQuery)}}),[E]),ee=(0,h().K8)((()=>{if(Q||g||j||Z||!k.canEditCollection())return null;const e=C.rect.state.width<=L().xO;return(0,Ce.jsx)(o(389657).A,{store:k,isInlineCollection:!0,hideText:e,buttonStyle:{marginInlineStart:4}})}),[g,j,Z,C.rect,Q,k]),oe=(0,h().K8)((()=>{const e=C.rect.state.width<=L().xO;return(0,Ce.jsx)(MS().GL,{store:k,collectionContextStore:t,hideText:e})}),[C.rect,k,t]),ne=(0,h().K8)((()=>{var e,o,n;if(!K||K.includes("emptyOrganizeBy"))switch(c){case"timeline":return null===(e=t.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by;case"calendar":return null===(o=t.normalizedQueryStore.state)||void 0===o?void 0:o.calendar_by;case"map":return null===(n=t.normalizedQueryStore.state)||void 0===n?void 0:n.map_by;default:return}}),[K,t.normalizedQueryStore,c]),ie=(0,h().uB)(void 0,f().Store),le=(0,r.useMemo)((()=>{if(ne)return(0,o(648046).S)(ne)}),[ne]),ae=(0,h().K8)((()=>{if(le){const e=ie.state;return e&&"aggregation"===e.type&&"number"===e.aggregationResult.type&&e.aggregationResult.value?e.aggregationResult.value:0}}),[le,ie]),se=(0,h().K8)((()=>{if(!ne||!ae||!X||Q||"calendar"!==c&&"timeline"!==c&&"map"!==c)return null;const e=t.permissionScopesStore.state,o=t.collectionStore();return"collectionTypedView"===t.contextType||o&&e.canEditContent?(0,Ce.jsx)(Eh,{emptyTotal:ae,emptyProperty:ne,collectionViewType:c,timelineViewRef:I}):null}),[t,c,ne,ae,X,Q,I]),ce=(0,r.useMemo)((()=>j?(0,Ce.jsx)(qh,{phoneFilterSortSettingsStore:l}):null),[l,j]),de=(0,r.useMemo)((()=>$?!X||"page"===c||"form_editor"===c||"dashboard"===c||K&&!K.includes("filter")?null:z&&"filter"===D.subStep?(0,Ce.jsx)(oh().F,{subStep:"filter",step:"demo_collection",children:(0,Ce.jsx)(Dh,{createFilterSettingsStore:n})}):(0,Ce.jsx)(Dh,{createFilterSettingsStore:n}):null),[$,X,c,K,z,D.subStep,n]),ue=(0,h().K8)((()=>{if(!$)return null;if(!X||"page"===c||"form_editor"===c||"map"===c||"dashboard"===c||K&&!K.includes("sort"))return null;if("chart"===c){var e,o;const n=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getChartConfig();if("placeholder"===(null==n?void 0:n.type)||"results-advanced"!==(null==n||null===(o=n.chartFormat)||void 0===o?void 0:o.mainSort))return null}return z&&"sort"===D.subStep?(0,Ce.jsx)(oh().F,{subStep:"sort",step:"demo_collection",children:(0,Ce.jsx)(Zh,{createSortSettingsStore:i})}):(0,Ce.jsx)(Zh,{createSortSettingsStore:i})}),[$,X,c,K,z,D.subStep,i,t]),pe=(0,h().K8)((()=>$?!X||"chart"===c||"page"===c||"dashboard"===c||b||!(0,rh().aS)(t)||F||K&&!K.includes("automations")?null:z&&"automations"===D.subStep?(0,Ce.jsx)(oh().F,{subStep:"automations",step:"demo_collection",children:(0,Ce.jsx)(vh,{})}):(0,Ce.jsx)(vh,{}):null),[$,X,c,b,t,F,K,z,D.subStep]),me=(0,re().X)("database_agents"),ge=(0,h().K8)((()=>$?!me||!X||"chart"===c||"page"===c||"dashboard"===c||b||F||K&&!K.includes("agents")?null:(0,Ce.jsx)(ho().pe,{}):null),[$,me,X,c,b,F,K]),Se=(0,h().K8)((()=>j&&t.searchOpenStore.state),[j,t]),he=(0,h().K8)((()=>j?(0,Ce.jsx)(gh,{collectionContextStore:t,isInHomeWidget:Boolean(S)}):null),[j,t,S]),ye=(0,h().K8)((()=>j?(0,Ce.jsx)(ke().A,{visible:Se,animate:{opacity:1,translateX:0},initial:{opacity:0,translateX:-50},exit:{opacity:0,translateX:-50},style:{position:"absolute",insetInlineStart:0},children:(0,Ce.jsx)(mh,{collectionContextStore:t,isFullScreen:Boolean(g),currentViewType:c,isSearchOpen:Se})}):null),[j,t,Se,g,c]),ve=(0,h().K8)((()=>{return $?!X||"form_editor"===c||"chart"===c||"dashboard"===c||Q||K&&!K.includes("search")||b?null:"page"===c?null!==(e=t.collectionViewBlockStore())&&void 0!==e&&e.isCollectionViewPageWithContent()?(0,Ce.jsx)(ey,{}):null:(0,Ce.jsx)(ph,{collectionContextStore:t,isFullScreen:Boolean(g),currentViewType:c,isInHomeWidget:Boolean(S)}):null;var e}),[$,X,c,Q,K,b,t,g,S]),fe=(0,h().K8)((()=>{var e;return!X||K&&!K.includes("ai")||b||null!=t&&null!==(e=t.collectionStore())&&void 0!==e&&e.isSyncedCollection()?null:(0,Ce.jsx)(JS().LazyAssistantCollectionViewButton,{collectionContextStore:t})}),[t,b,X,K]),be=(0,r.useMemo)((()=>j||g||F||K&&!K.includes("fullScreen")?null:(0,Ce.jsx)(Hh,{store:k,viewType:c})),[g,k,c,K,F,j]),xe=(0,h().K8)((()=>F||K&&!K.includes("viewSettings")||b?null:z&&"settings"===D.subStep?(0,Ce.jsx)(oh().F,{subStep:"settings",step:"demo_collection",children:(0,Ce.jsx)(ho().XA,{collectionContextStore:t,settingsHeaderSizeObserver:C,buttonAndIconStyle:(0,dh().i)({theme:B,isInHomeWidget:Boolean(S),isMobile:Boolean(s().A.isMobile)})})}):(0,Ce.jsx)("div",{style:{position:"relative"},children:(0,Ce.jsx)(ho().XA,{collectionContextStore:t,settingsHeaderSizeObserver:C,buttonAndIconStyle:(0,dh().i)({theme:B,isInHomeWidget:Boolean(S),isMobile:Boolean(s().A.isMobile)})})})),[t,S,b,C,B,K,z,D,F]),we=(0,h().K8)((()=>!O&&X&&null!=K&&K.includes("saveOrOpenOverflow")?(0,Ce.jsx)(ho().fV,{collectionContextStore:t,shouldHideSaveViewOption:J}):null),[X,K,t,J,O]),Ie=(0,h().K8)((()=>"page"===c||"form_editor"===c||b||!t.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})||K&&!K.includes("addItem")||(0,o(915508).R)(t)?null:(0,Ce.jsx)(Xh,{store:k,settingsHeaderSizeObserver:C,handleAddItemClick:u})),[c,b,t,K,k,C,u]),Ae=(0,h().K8)((()=>{var e;return(null===(e=k.inMemoryRecordCache)||void 0===e?void 0:e.isTemporaryData)??!1}),[k]),Te=(0,r.useMemo)((()=>"form_editor"!==c||K&&!K.includes("formActionButtons")||Ae?null:(0,Ce.jsx)(o(171559).Pe,{collectionContextStore:t,showCompactDesktopHeader:Q})),[c,K,Q,t,Ae]),je=(0,h().K8)((()=>null!=K&&K.includes("closeCollectionViewInModal")&&t.isUnlistedViewStore.state?(0,Ce.jsx)(ho().YL,{}):null),[K,t]),Me=(0,h().K8)((()=>K&&!K.includes("dashboardBuildMode")||!t.isDashboardView()?null:(0,Ce.jsx)(ly,{collectionContextStore:t})),[t,K]),Pe=(0,h().K8)((()=>K&&!K.includes("dashboardWidgetActionsMenu")||!t.isDashboardWidget()?null:(0,Ce.jsx)(th,{collectionContextStore:t})),[t,K]),Re=(0,h().K8)((()=>{const e=t.collectionViewStore(),o=t.collectionStore();return!(!e||!o)&&o.getSpaceId()!==e.getSpaceId()}),[t]),_e=(0,r.useCallback)((e=>{(0,d().SQ)({event:e,context:d().y$.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]),Be=(0,h().O$)(v().e),Ve=(0,r.useMemo)((()=>Be||!P?null:(0,Ce.jsx)($h,{})),[Be,P]),Ee=(0,r.useMemo)((()=>"feed"===c&&R&&_?(0,Ce.jsx)(oy,{theme:B}):null),[c,B,_,R]),Fe=(0,h().K8)((()=>t.databaseType),[t]),Oe=(0,nh().Vs)(),De=(0,h().K8)((()=>{var e;return(null===(e=t.collectionStore())||void 0===e?void 0:e.isUserAllowedToFollow())??!1}),[t]),Le=(0,r.useMemo)((()=>$&&X&&"feed"===c&&R?Fe||Oe&&!De?null:(0,Ce.jsx)(zh,{createFollowSettingsStore:a}):null),[c,a,R,$,X,Fe,Oe,De]),ze=(0,te().y)(),Ke=(0,y().IS)((()=>({container:{height:"100%",flexGrow:1,...ze&&{paddingInlineEnd:U().dE.paddingInlineEnd},...A},phoneSearchInputContainer:{position:"relative",display:"flex",alignItems:"center",overflow:"hidden"},phoneInputButtons:{display:"flex",alignItems:"center",pointerEvents:Se?"none":"auto"}})),[ze,A,Se]);if(G)return null;if(j)return(0,Ce.jsxs)(ke().A,{visible:Y,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center"},children:[(0,Ce.jsx)(ah,{}),Ve,Re?(0,Ce.jsx)(_u,{type:"linkedView"}):void 0,be,he,(0,Ce.jsxs)("div",{style:Ke.phoneSearchInputContainer,children:[(0,Ce.jsxs)(ke().A,{animate:{opacity:Se?0:1},style:Ke.phoneInputButtons,children:[ce,xe,Ie,Te,we]}),ye]})]});const He=(0,Ce.jsxs)(Ce.Fragment,{children:[(0,Ce.jsx)(ah,{}),Ee,Ve,Re?(0,Ce.jsx)(_u,{type:"linkedView"}):void 0,ee,oe,le?(0,Ce.jsx)(Zr().A,{id:Yn().au,collectionContextStore:t,reducer:le,resultStore:ie}):void 0,se,Le,de,ue,pe,ge,fe,ve,be,xe,we,Ie,Te,je,Me,Pe]});return(0,Ce.jsx)("div",{style:Ke.container,children:s().A.isMobile?(0,Ce.jsx)(ke().A,{visible:Y,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},onMouseDown:_e,children:He}):(0,Ce.jsx)(ry,{settingsHeaderSizeObserver:C,isFullScreen:g,collectionContextStore:t,viewSettingsButton:xe,minimizedActionViewStore:x,children:He})})}));var sy=function(e){return e[e.TabBar=0]="TabBar",e[e.Source=1]="Source",e[e.None=2]="None",e}(sy||{});function cy(e){const{currentViewType:t,store:o,isFullScreen:n,hideViewTabBar:i,collectionViewHeaderText:l,headerActionsBehavior:s,allowedActions:c,isInHomeWidget:u,isMyTasksPage:p,isHomeCustomDbPage:g,showHoverActionsStore:S,headerSizeObserver:v,isPlaceholderExternalCollection:b,handleEditorMouseDown:x,handleHeaderMouseMove:C,handleHeaderMouseLeave:k,handleHeaderMount:I,handleSettingsHeaderMount:A,leftRightPaddingStore:T,headerHeightStore:j,canEdit:M,contentSizeObserver:P,settingsHeaderSizeObserver:R,viewSettingsPlacementStore:_,showOnlyCurrentView:B,switchViewMetric:V,handleAddItemClick:E,timelineViewRef:O,createFilterSettingsStore:D,filterBarCreateFilterSettingsStore:L,headerWrapStyle:z,headerRef:K,headerStyleOverrides:H,minimizedActionViewStore:N,createFollowSettingsStore:G}=e,$=(0,m().v3)(),{isPhone:U}=(0,m().Y0)(),q=(0,re().X)("client_rtl_support"),X=(0,gt().ET)(),Y=(0,Ee().Zp)(),Q=(0,h().K8)((()=>X.collectionStore()),[X]),Z=(0,h().uB)(void 0,f().Store),J=(0,r.useMemo)((()=>{if(p){return{type:"results",filter:{operator:"and",filters:[]},limit:1}}}),[p]),ee=(0,h().uB)(void 0,f().Store),te=(0,r.useMemo)((()=>{if(g)return{type:"results",filter:{operator:"and",filters:[]},limit:1}}),[g]),oe=(0,h().uB)(void 0,qt().A),ne=(0,h().uB)(void 0,f().Store.createClass({open:!1,stack:[]},{name:"createSortSettingsStore"})),ie=(0,h().uB)(void 0,f().Store.createClass({open:!1,stack:[]},{name:"phoneFilterSortSettingsStore"}));(0,r.useEffect)((()=>{F().d9({environment:$,collectionContextStore:X})}),[$,X]);const le=(0,h().O$)(T),ae=(0,h().O$)(j),se=(0,h().K8)((()=>o.isNonEditableState()),[o]),ce=(0,h().K8)((()=>{var e;return Boolean(!b&&!(null!=Y&&Y.hideViewBlockSource)&&X.shouldShowSourceStore.state&&!X.isUnlistedViewStore.state&&(null===(e=X.collectionStore())||void 0===e?void 0:e.canRead()))}),[X,b,Y]),de=(0,r.useCallback)((({currentCollectionViewStore:e,newCollectionViewStore:t,openInNew:o})=>{if(e.id!==t.id&&!o){const o=e.getType(),r=t.getType();if(o&&r){var n;if(V)V.current={from:o,to:r,metric:Wt().default.DO_NOT_USE_markLegacy("collections.switch_view_lag"),sizeHintAtStart:null===(n=X.remoteResultStore.state)||void 0===n?void 0:n.sizeHint};"form_editor"===o&&X.isClientModeEnabledStore.setState(!1),"form_editor"===r&&F().os({collectionSettingsStore:X.settingsStore})}}}),[X.isClientModeEnabledStore,X.remoteResultStore,X.settingsStore,V]),ue=(0,h().K8)((()=>{var e;return(null===(e=X.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[]}),[X]),pe=(0,h().K8)((()=>_S({collectionContextStore:X,isPlaceholderExternalCollection:b,previewContext:Y,showOnlyCurrentView:B})),[X,b,Y,B]),me=(0,r.useMemo)((()=>({showMoreViewsButton:!1,showAddViewButton:pe,addViewButtonAnimatedIn:!0,viewSelectState:"allTabVisible",moreViewsCount:0})),[pe]),ge=(0,r.useCallback)((e=>{(0,d().SQ)({event:e,context:d().y$.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]),Se=(0,r.useMemo)((()=>(0,Ce.jsx)(IS,{renderState:me,collectionContextStore:X,preventRectangularSelection:ge,variant:"default"})),[X,ge,me]),he=(0,h().K8)((()=>i?sy.None:u||n||!ce||1!==(null==ue?void 0:ue.length)||X.isInViewTabLayout()?sy.TabBar:sy.Source),[i,null==ue?void 0:ue.length,n,ce,u,X]),ye=(0,h().K8)((()=>Boolean(null==Q?void 0:Q.isSyncedCollection())),[Q]),ve=(0,h().K8)((()=>ye&&he===sy.Source),[ye,he]),fe=(0,y().IS)((e=>({headerPositioningStyle:{insetInlineStart:null==le?void 0:le.paddingLeft,paddingInlineStart:u?Gt().Fq:void 0,width:"100%"},headerStyle:{display:"flex",alignItems:ve?"flex-start":"center",...!ve&&{height:ae},insetInlineStart:null==le?void 0:le.paddingLeft,paddingInlineStart:u?Gt().Fq:void 0,width:"100%",...U&&{gap:10,justifyContent:"space-between"},...H},selectableStyle:{position:"relative"},headerActionsStyle:{...ve&&{marginTop:6}}})),[ae,H,u,null==le?void 0:le.paddingLeft,ve,U]),be=(0,r.useMemo)((()=>{switch(he){case sy.TabBar:return(0,Ce.jsx)($S,{collectionContextStore:X,showHoverActionsStore:S,isPlaceholderExternalCollection:b,showOnlyCurrentView:B??!1,onViewClick:de,disabled:p,variant:"pills"});case sy.Source:return(0,Ce.jsx)(Qe,{store:o,collectionContextStore:X,isFullScreen:n,showHoverActionsStore:S,canEdit:M,addViewButton:Se});case sy.None:return null}}),[he,Se,X,S,b,B,de,p,o,n,M]),xe=(0,r.useMemo)((()=>"hidden"===s?null:(0,Ce.jsx)(ay,{showHoverActionsStore:S,isFullScreen:n,store:o,currentViewType:t,collectionContextStore:X,isPlaceholderExternalCollection:b,settingsHeaderSizeObserver:R,createFilterSettingsStore:D,createSortSettingsStore:ne,phoneFilterSortSettingsStore:ie,createFollowSettingsStore:G,isInHomeWidget:u,handleAddItemClick:E,headerSizeObserver:v,timelineViewRef:O,allowedActions:c,minimizedActionViewStore:N,containerStyleOverrides:fe.headerActionsStyle})),[s,S,n,o,t,X,b,R,D,ne,ie,G,u,E,v,O,c,N,fe.headerActionsStyle]);return(0,Ce.jsxs)(a().s,{allowSelectionWithin:!0,style:z,onMouseDown:x,onMouseMove:C,onMouseLeave:k,ref:(0,w().Px)(I,K),children:[n?(0,Ce.jsx)(CS,{currentViewType:t,headerSizeObserver:v,contentSizeObserver:P,settingsHeaderSizeObserver:R,headerHeightStore:j,viewSettingsPlacementStore:_,store:o,leftRightPaddingStore:T,isInHomeWidget:u,headerRef:K,handleAddItemClick:E}):void 0,le?(0,Ce.jsxs)(jt().Ay,{store:o,shouldShowCopyLinkButton:se,analyticsName:(0,W().LI)(t),style:fe.selectableStyle,shouldShowHalo:!(n||u||null!=Y&&Y.isPreviewing),children:[(0,Ce.jsxs)("div",{style:fe.headerStyle,ref:A,children:[be,l,xe]}),J?(0,Ce.jsx)(Zr().A,{id:"tasks_results",collectionContextStore:X,reducer:J,resultStore:Z}):void 0,te?(0,Ce.jsx)(Zr().A,{id:"custom_db_results",collectionContextStore:X,reducer:te,resultStore:ee}):void 0]}):void 0,(0,Ce.jsxs)("div",{style:fe.headerPositioningStyle,dir:q&&(0,Md().A1)()?"rtl":"ltr",children:[(0,Ce.jsx)(QS,{collectionContextStore:X}),(0,Ce.jsx)(dy,{collectionContextStore:X,showHoverActionsStore:S,filterBarCreateFilterSettingsStore:L,saveControlMoreActionsButtonPopupStore:oe,currentViewType:t,isInHomeWidget:u})]})]})}function dy({collectionContextStore:e,showHoverActionsStore:t,filterBarCreateFilterSettingsStore:o,saveControlMoreActionsButtonPopupStore:n,currentViewType:r,isInHomeWidget:i}){const l=(0,m().v3)(),a=(0,m().WS)(),s=(0,h().K8)((()=>(0,qS().J)(l)),[l]),c=(0,h().O$)(e.filtersBarOpenStore),d=(0,h().O$)(e.shouldShowSourceStore),u=(0,h().O$)(e.completeSprintButtonContextStore),p=d?8:12;return"page"===r||"form_editor"===r||"feed"===r&&(s||a)||i||a?null:c?(0,Ce.jsx)(jS().N9,{collectionContextStore:e,showHoverActionsStore:t,createFilterSettingsStore:o,saveControlMoreActionsButtonPopupStore:n}):u?(0,Ce.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:a?12:8,paddingTop:p},children:[(0,Ce.jsx)("div",{style:{flex:1}}),(0,Ce.jsx)(XS().A,{collectionContextStore:e})]}):null}const uy=r.memo(r.forwardRef((function(e,t){const{store:k,isFullScreen:R,productUseCase:O,viewsModuleContext:H,overrideViewType:N,headerActionsBehavior:G="default",overridePaddingLeft:$,overridePaddingRight:U,fullWidth:q,headerText:X,hideViewTabBar:Y,headerAllowedActions:Q,maxHeight:ee,disabled:te,forceLocalQueryCollection:ne=!1,isUnlistedView:re,viewId:ie,onMount:le,setCollectionContextStore:ae,showOnlyCurrentView:se,additionalCollectionViewInnerHorizontalPadding:ce,templatePickerMenuListStore:de,mountedBeforeInitialPageRender:ue,navigationStartTime:pe,cvbLoadingStateOnInitialRender:me,lazyRenderStartedAtRef:ge,trackPendingCollectionItemRender:Se,editorContentContainerRef:he,handleAddItemClickOverride:ye,collectionContentWrapperStyle:ve,headerActionsWrapperStyle:fe}=e,be=(0,y().DP)(),xe=(0,m().Y0)(),{isPhone:we}=xe,ke=(0,r.useRef)(null),Ie=(0,m().v3)(),Ae=(0,Ee().Zp)(),Te=(null==Ae?void 0:Ae.isPreviewing)??!1,je=(0,r.useMemo)((()=>new(ko().B)(Ie)),[Ie]),Me=(0,r.useContext)(Pt().R),Pe=(0,h().uB)(void 0,o(505776).A),Re=(0,r.useMemo)((()=>new(no().E)),[]),_e=(0,r.useMemo)((()=>new(no().E)),[]),Be=(0,r.useMemo)((()=>new(no().E)),[]),Ve=(0,r.useRef)(null),Fe=(0,r.useRef)(),Oe=(0,r.useRef)(null),[De]=(0,r.useState)((()=>performance.now())),Le=(0,r.useRef)(new Map),ze=(0,r.useRef)(),Ke=(0,r.useRef)(null);Ke.current||(Ke.current=new Po(je,Ie)),(0,r.useEffect)((()=>{je.previewContextStore.setState(Ae)}),[Ae,je]),(0,r.useEffect)((()=>{const e=Ke.current;return async function(){const{createHasSchemaChangedForQueryStore:t}=await It.load();je.hasSchemaChangedForQueryStore=t(je),null==e||e.subscribeToSchemaChanges(je.hasSchemaChangedForQueryStore)}(),()=>{null==e||e.unsubscribeFromSchemaChanges()}}),[Ke,je]);const{didDelayOffscreenRenderRef:He,collectionViewVisibilityStore:We}=function({collectionContextStore:e,isFullScreen:t,rootRef:n,trackPendingCollectionItemRender:i,collectionRefetcher:l}){const a=(0,r.useRef)(t),s=(0,r.useRef)(!1),c=(0,h().K8)((()=>o(735372).Ay.isOpen()),[]),d=(0,h().uB)(void 0,f().Store.createClass(!0,{name:"collectionViewVisibilityStore"})),u=(0,r.useRef)(null);return(0,r.useEffect)((()=>{if(!n.current)return;if(a.current)return;if(c)return a.current=!0,void e.shouldDelayRenderStore.setState(!1);if(!n.current.parentElement)return;const t=new IntersectionObserver((t=>{const o=t.reduce(((e,t)=>t.time>e.time?t:e),t[0]);if(d.setState(o.isIntersecting),a.current)return;const n=!o.isIntersecting;n?(s.current=!0,null==i||i()):a.current=!0,e.shouldDelayRenderStore.setState(n)}));t.observe(n.current.parentElement),u.current=t}),[e,c,n,i,l,d]),(0,r.useEffect)((()=>()=>{var e;return null===(e=u.current)||void 0===e?void 0:e.disconnect()}),[]),{didDelayOffscreenRenderRef:s,collectionViewVisibilityStore:d}}({collectionContextStore:je,isFullScreen:R,rootRef:ke,trackPendingCollectionItemRender:Se,collectionRefetcher:Ke.current});(0,r.useEffect)((()=>{const e=()=>{var e;We.state&&(null===(e=Ke.current)||void 0===e||e.maybeProcessDeferredCollectionEmit("msg"))};return We.addListener(e),()=>{We.removeListener(e)}}),[We,Ke]);const Ne=(0,r.useCallback)((()=>{var e;return!oo().A.state.isVisible||(!(!oe().default.isCenterPeekOpen()||null!==(e=oe().default.peekTargetStore.state)&&void 0!==e&&e.uiContains(k))||!Boolean(R)&&!We.state)}),[R,We,k]),Ge=(0,r.useRef)(),$e=(0,r.useRef)(),[Ue,qe]=(0,r.useState)(!1),[Xe,Ye]=(0,r.useState)(!1),[Ze,Je]=(0,r.useState)(!1),et=(0,h().uB)(void 0,f().Store.createClass({open:!1,stack:[]},{name:"createFilterSettingsStore"})),tt=(0,h().uB)(void 0,f().Store.createClass({open:!1,stack:[]},{name:"createFollowSettingsStore"})),ot=(0,h().uB)(void 0,f().Store.createClass({open:!1,stack:[]},{name:"filterBarCreateFilterSettingsStore"})),nt=(0,h().uB)(void 0,f().Store.createClass({open:!1,stack:[]},{name:"createSortSettingsStore"})),rt=(0,h().uB)(void 0,f().Store.createClass(void 0,{name:"viewSettingsPlacementStore"})),it=(0,h().uB)(void 0,qt().A);(0,o(265793).b)(je);const lt=(0,r.useCallback)((()=>{var e;return N??(null===(e=je.collectionViewStore())||void 0===e?void 0:e.getType())}),[N,je]),at=(0,h().r6)((()=>(0,J().cq)(k)),[k]),st=(0,h().O$)(at),ct=(0,h().O$)(je.isInHomeWidgetStore),dt=(0,h().K8)((()=>{const e=je.viewsModuleContextStore;return Boolean(e.getViewModuleType())}),[je]),ut=(0,h().K8)((()=>(0,J().RX)(k)),[k]),pt=(0,Mt().Lc)(),mt="nested"===(null==pt?void 0:pt.layout),St=(0,h().r6)((()=>{const e=(0,$t().Uh)(Ie)-Z().x6;if(ut&&!R&&!(0,Z().Ck)(k,void 0,xe)&&e>0&&!ct)return e/2}),[Ie,ut,R,k,xe,ct]),ht=(0,h().O$)(St),yt=(0,h().K8)((()=>{var e;return(null===(e=Ve.current)||void 0===e?void 0:e.getStore().state.elementRef)??{current:null}}),[Ve]),vt=(0,r.useCallback)((e=>{var t,o;if(je.isInHomeWidgetStore.state)return;const n=je.normalizedFormatStore.state,r=null===(t=yt.current)||void 0===t?void 0:t.clientWidth;je.frozoneStore.setState({isScrolled:!1,scrollerWidth:r,scrollerLeftOffset:(null==Ve||null===(o=Ve.current)||void 0===o||null===(o=o.getClientRect())||void 0===o?void 0:o.left)??0,scrollerLeftPadding:St.state,frozenIndex:null==e?void 0:e.getTableFrozenColumnIndex(r,n),tryShowHiddenFrozenColumn:!1})}),[je,yt,St]),bt=(0,h().K8)((()=>k.isRootOrDirectChild()),[k]),xt=(0,h().K8)((()=>(0,At().dC)(Ie,k)),[Ie,k]),wt=(0,Mt().Lc)(),kt=Boolean(wt),ao=(0,h().r6)((()=>{const e=lt(),t=(0,W().l0)({environment:Ie,store:k,isFullScreen:R,isInFeedView:kt,sizeObserver:Re,viewType:e,collectionContextStore:je});return t&&void 0!==$&&(t.paddingLeft=$),t&&void 0!==U&&(t.paddingRight=U),t&&bt&&xt&&(0,Z().Ck)(k,void 0,xe)&&"page"!==e&&(t.paddingRight+=At().Qb),t}),[lt,Ie,k,R,Re,je,$,U,bt,xt,xe,kt]);(0,h().O$)(ao);const so=(0,r.useCallback)((e=>{const t=e.target;null!==t&&t instanceof HTMLElement&&(0,o(819121).p)(t)&&Je(!0)}),[Je]),co=(0,r.useCallback)((()=>{Je(!1)}),[Je]),uo=(0,r.useCallback)((()=>{Qt().A.state||qe(!0)}),[qe]),po=(0,r.useCallback)((()=>{qe(!1)}),[qe]),mo=(0,r.useCallback)((()=>{var e,t;if(ct)return;const o=null===(e=Ve.current)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.getBoundingClientRect().width,n=je.frozoneStore.state.scrollerWidth,r=null===(t=Ve.current)||void 0===t||null===(t=t.getNode())||void 0===t?void 0:t.getBoundingClientRect().left,i=je.frozoneStore.state.scrollerLeftOffset;if(o===n&&r===i)return;const l=je.collectionViewStore(),a=je.normalizedFormatStore.state;je.frozoneStore.update((e=>({...e,scrollerWidth:o,scrollerLeftOffset:r,scrollerLeftPadding:St.state,frozenIndex:null==l?void 0:l.getTableFrozenColumnIndex(o,a),tryShowHiddenFrozenColumn:!1})))}),[je,Ve,St,ct]),So=(0,r.useCallback)((()=>{var e,t;const o=null===(e=Ve.current)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.scrollLeft,n=null===(t=ao.state)||void 0===t?void 0:t.paddingLeft;if(void 0===o||void 0===n)return;const r=o>n;r!==je.frozoneStore.state.isScrolled&&(je.frozoneStore.setState({...je.frozoneStore.state,isScrolled:r}),mo())}),[je,mo,ao]),ho=(0,r.useRef)(!1);!function({environment:e,collectionContextStore:t}){const o=(0,r.useCallback)((o=>{o.state.online||(0,K().M)(e,t,{src:"initial_load"})}),[e,t]);(0,g().l)((()=>{v().A.state.online&&v().A.addListener(o)})),(0,S().X)((()=>{v().A.removeListener(o)}))}({environment:Ie,collectionContextStore:je});const{collectionViewStore:yo,collectionStore:vo}=(0,h().K8)((()=>{var e;const t=je.collectionViewStore(),n=je.collectionStore(),r=Ie.currentUser.id,i=null==t?void 0:t.id,l=null==n?void 0:n.id,a=k.getCollectionViewStores(),s=a.map((e=>e.id)),c=null!==(e=a[0])&&void 0!==e&&e.isDefined()?a[0]:void 0,d=k.id,u=(0,Ot().cf)({userId:r,viewBlockId:d}),p=Ie.RouterStore.state.route,m=k.getParentTable()===o(144081).zx,g=k.inMemoryRecordCache===Ie.defaultRecordCache.inMemoryRecordCache;let S;const h=e=>!!re||(!!s.includes(e)||"collectionSettings"===je.contextType);if(ie&&h(ie)?S=ie:m&&g&&"page"===p.name&&p.collectionViewId&&h(p.collectionViewId)?S=p.collectionViewId:t&&h(t.id)?S=t.id:u&&h(u)?S=u:c&&h(c.id)&&(S=c.id),S){const e=o(913530).p.createChildStore(k,{table:o(869558).Gy,id:S});if(e.isDefined()){S!==u&&(0,Ot().st)({userId:r,viewBlockId:d,viewId:S});const n=null==t?void 0:t.inMemoryRecordCache,a=null==e?void 0:e.inMemoryRecordCache,s=n!==a&&((null==n?void 0:n.name)===B().SJ||(null==a?void 0:a.name)===B().SJ),c=e.getCollectionStore();e&&(!ho.current||S!==i||s||c&&c.id!==l)&&(ho.current=!0,je.forceLocalQueryCollection=ne,(0,o(3167).d)({environment:Ie,collectionViewBlockStore:k,collectionViewStore:e,collectionStore:c,collectionContextStore:je,isFullScreen:R??!1,productUseCase:O,isRootChild:k.isRootOrDirectChild(),isInPeekRenderer:st,viewsModuleContext:H}))}}return{collectionViewStore:je.collectionViewStore(),collectionStore:je.collectionStore()}}),[k,je,Ie,R,O,st,H,ne,re,ie]),{frozenIndex:fo,tableFrozenColumnIndex:bo}=(0,h().K8)((()=>({frozenIndex:je.frozoneStore.state.frozenIndex,tableFrozenColumnIndex:null==yo?void 0:yo.getTableFrozenColumnIndex(je.frozoneStore.state.scrollerWidth,je.normalizedFormatStore.state)})),[je.frozoneStore,je.normalizedFormatStore,yo]);(0,r.useEffect)((()=>{void 0===fo&&yo&&vt(yo)}),[je,yo,fo,vt]);const xo=(0,r.useRef)(!1);(0,r.useEffect)((()=>(xo.current=!0,()=>{xo.current=!1})),[]);const Co=(0,r.useRef)(!0);(0,r.useEffect)((()=>{if(Co.current){const e=lt();e&&(c().e.withListenerIgnored((()=>{const t=je.collectionStore(),o=(0,Et().L0)(t),n=je.collectionViewStore(),r=null==n?void 0:n.getChartType(),i=null==n?void 0:n.getChartPlaceholderType();(0,l().u)({environment:Ie,event:{eventName:"database_visit",eventProperties:{collection_id:null==t?void 0:t.id,collection_view_id:null==n?void 0:n.id,collection_view_block_id:k.id,owned_collection_count:k.getOwnedCollectionStores().length,linked_collection_count:k.getLinkedCollectionStores().length,type:e,is_full_screen:R,is_peek:at.state,peek_mode:oe().default.state.mode,database_visit_id:je.visitSessionId,chart_type:"placeholder"===r?i:r,is_chart_placeholder:"placeholder"===r,product_use_case:O,...o}}})})),Co.current=!1)}}),[]);const{value:Io}=(0,ft().fJ)(Rt().T.formulas);(0,r.useEffect)((()=>{(0,A().O9)(Io)&&je.formulasCodeStore.setState(Io)}),[Io,je.formulasCodeStore]),(0,r.useEffect)((()=>{_t(Ie)}),[Ie]),(0,r.useEffect)((()=>{c().e.withListenerIgnored((()=>{const e=je.collectionViewStore();if(e&&"collectionTypedView"===je.contextType){const t=je.databaseType,n=lt();t&&n&&(0,o(999202).W)(Ie,"type_aggregated_database_visit",`type_aggregated_database_visit-${t}`,60,{collection_view_id:e.id,collection_view_block_id:k.id,type:n,databaseType:t,is_my_tasks:(0,o(696746).NY)("myTasks")===k.id})}}))}),[]),(0,r.useEffect)((()=>{const e=Wt().default.DO_NOT_USE_markLegacy("collections.collection_view_block_render");Wt().default.DO_NOT_USE_measureAfterNextFlushLegacy(e,{environment:Ie,getData:()=>({...(0,Et().kz)(je),is_first_render:Co.current})})})),$e.current&&c().e.withListenerIgnored((()=>{if(!$e.current)return;const{from:e,to:t,metric:o,sizeHintAtStart:n}=$e.current;Wt().default.DO_NOT_USE_measureAfterNextFlushLegacy(o,{environment:Ie,getData:()=>{const o=(0,Et().kz)(je),{view_type:r,row_count_category:i,...l}=o;return{from:e,to:t,did_trigger_fetch:je.isLoadingStore.state,row_count_category:(0,Et().Cu)(n),...l}}}),$e.current=void 0})),(0,r.useEffect)((()=>{const e=()=>{var e;if(!je.isLoadedStore.state||!xo.current||je.wasCreatedThisSessionStore.state||je.didFireLoadEventsStore.state)return;je.didFireLoadEventsStore.setState(!0);const t=Ie.RouterStore.state;let r;"page"===t.route.name&&(r=t.route.mobileData);const l=null===(e=je.collectionViewStore())||void 0===e?void 0:e.getType(),a=()=>({...(0,Et().kz)(je),wasm_sqlite_initialized:Zt().A.state.metricDataStore.state.wasm_sqlite_initialized,collectionViewType:l,...eo().A.getDatabaseNavigationMetrics(pe)}),s=je.isFullScreenStore.state;var c,d;if(s)if(!Zt().A.state.initialRenderCompleted&&ue){var u;o(915086).setInitialRenderCompleted(),n().oh.hackyOffsetParsesCorrectly()||(0,i().DO_NOT_USE_trackLegacy)(Ie,"luxon_hacky_offset_parses_correctly_false");const e=()=>{var e,t;const n=(0,Et().kz)(je),i=je.collectionViewStore(),a=null==i?void 0:i.id,s=(0,E().A)(a);return{...n,is_push:(null===(e=r)||void 0===e?void 0:e.isPush)??!1,collectionViewType:l,initial_route:Ie.RouterStore.state.initialRoute.name,prefetchCache:null===(t=Ie.prefetchCache)||void 0===t||null===(t=t.getPrefetchAnalytic(s))||void 0===t?void 0:t.type,cvb_loading_state:me,wasm_sqlite_initialized:Zt().A.state.metricDataStore.state.wasm_sqlite_initialized,is_mobile_background_launch:(0,o(248566).A)(),sub_metrics:zt().getSubMetricsAndMetricDataForTracking({isPrewarmedTab:!1}).sub_metrics,includes_page_origin_to_app_start:!0}};Wt().default.measureFromPageOriginAfterNextFlush("initial_database_render",{environment:Ie,getData:e,shouldSendIfStatsigNotInitialized:!0});const t=SS.CollectionViewBlock.getLoadingMetrics();var p,m;if(null!=t&&t.startedAt)Wt().default.DO_NOT_USE_measureLegacy({metricName:"collection_view_block_bundle_load_and_parse",startTime:t.startedAt,endTime:t.resolvedAt},{environment:Ie,data:{did_prefetch:"hit-match"===(null===(p=Ie.prefetchCache)||void 0===p||null===(p=p.getPrefetchAnalytic((0,E().A)(null===(m=je.collectionViewStore())||void 0===m?void 0:m.id)))||void 0===p?void 0:p.type),is_full_screen:s}});null===(u=je.databaseItemsVisibleTracker)||void 0===u||u.handleInitialDatabaseRender()}else{var g;const{timings:e}=eo().A.popTimings();e&&Wt().default.DO_NOT_USE_measureAfterNextFlushLegacy({metricName:"navigation_database_render",startTime:e.navigationStart},{environment:Ie,getData:a}),Jt().A.state.isMeasuring&&Jt().A.update((e=>({...e,isMeasuring:!1}))),null===(g=je.databaseItemsVisibleTracker)||void 0===g||g.handleNavigationDatabaseRender(null==e?void 0:e.navigationStart)}else ue?null===(c=je.databaseItemsVisibleTracker)||void 0===c||c.handleInitialDatabaseRender():(pe&&Wt().default.DO_NOT_USE_measureAfterNextFlushLegacy({metricName:"navigation_database_render",startTime:pe},{environment:Ie,getData:a}),null===(d=je.databaseItemsVisibleTracker)||void 0===d||d.handleNavigationDatabaseRender(pe))};return je.isLoadedStore.addListener(e),e(),()=>{je.isLoadedStore.removeListener(e)}}),[je,Ie,ue,me,pe]),(0,h().K8)((()=>{for(const t of k.getCollectionViewStores())t.getValue();const e=je.collectionStore();if(e){e.getTemplatePageStores().map((e=>e.getValue()))}}),[k,je]),(0,r.useEffect)((()=>{const e=()=>!oe().default.isCenterPeekOpen()&&oo().A.state.isVisible,t=()=>{var t;e()&&(null===(t=Ke.current)||void 0===t||t.maybeProcessDeferredCollectionEmit("page_show"))},o=()=>{var t;e()&&(null===(t=Ke.current)||void 0===t||t.maybeProcessDeferredCollectionEmit("exit_peek"))};return oo().A.addListener(t),oe().default.addListener(o),()=>{oo().A.removeListener(t),oe().default.removeListener(o)}}),[Ke]),(0,r.useEffect)((()=>{const e=e=>{o(778708).bE({environment:Ie,sprintSettingsContext:e.state})};return je.sprintSettingsContextStore.addListener(e),()=>{je.sprintSettingsContextStore.removeListener(e)}}),[je,Ie]),(0,r.useEffect)((()=>{const e=async e=>{if(e.state){const e=je.collectionViewBlockStore(),t=je.collectionViewStore(),o=je.collectionStore();if(!e||!t||!o)return;await(0,K().M)(Ie,je,{src:"relative_variables_stale",queuedTimestamp:Date.now()})}};return je.relativeVariablesAreStaleStore.addListener(e),()=>{je.relativeVariablesAreStaleStore.removeListener(e)}}),[je,Ie,ne]);const{contextType:Ao,databaseType:To,remoteCollectionIds:jo}=(0,h().K8)((()=>({contextType:je.contextType,databaseType:je.databaseType,remoteCollectionIds:je.remoteCollectionIdsStore.state})),[je]);(0,r.useEffect)((()=>{if(ze.current)return;if("collectionTypedView"!==Ao||!To)return;const e=new(lo().C)(Ie,(0,C().aW)({spaceId:k.getSpaceId(),databaseType:To}),((e,t)=>{var o;null===(o=Ke.current)||void 0===o||o.handleCollectionEmit({src:"msg",passThroughData:t,shouldDeferCollectionEmit:Ne(),isCollectionTypeChange:!0})}));e.subscribe(),ze.current=e;const t=ze.current;return()=>{t.unsubscribe()}}),[je,Ie,Ke,k,Ao,To,Ne]),(0,r.useEffect)((()=>{null==ae||ae(je)}),[ae,je]),(0,r.useEffect)((()=>{null==le||le(lt())}),[]),(0,r.useEffect)((()=>{void 0===bo||ct||je.frozoneStore.setState({...je.frozoneStore.state,frozenIndex:bo})}),[je.frozoneStore,ct,bo]),(0,r.useEffect)((()=>{const e=e=>{const t=Array.from(Le.current.keys()??[]),o=I().R9(t,e),n=I().R9(e,t);for(const i of o){var r;null===(r=Le.current.get(i))||void 0===r||r.unsubscribe(),Le.current.delete(i)}for(const i of n){const e=new(lo().C)(Ie,(0,C().eG)(i),((e,t)=>{var o;null===(o=Ke.current)||void 0===o||o.handleCollectionEmit({src:"msg",passThroughData:t,shouldDeferCollectionEmit:Ne(),isCollectionTypeChange:!1})}));e.subscribe(),Le.current.set(i,e)}};if(vo)e([vo.id]);else if("collectionTypedView"===Ao){e(jo??[]);const t=t=>{e(t.state)};return je.remoteCollectionIdsStore.addListener(t),()=>{je.remoteCollectionIdsStore.removeListener(t)}}}),[je.remoteCollectionIdsStore,Ke,vo,Ao,Ie,jo,k,Ne]),(0,r.useEffect)((()=>{const e=Le.current;return()=>{if(e)for(const t of e.values())t.unsubscribe()}}),[]);const Mo=(0,r.useMemo)((()=>({onFocus:so,onBlur:co,onMouseMove:uo,onMouseLeave:po})),[so,co,uo,po]);(0,r.useEffect)((()=>{var e;const t=null===(e=Ve.current)||void 0===e?void 0:e.getNode();return t&&(0,Dt().P)(t,"scroll",So),()=>{t&&(0,Lt().O)(t,"scroll",So)}}),[So]),(0,r.useEffect)((()=>()=>{(0,o(436371).u)({collectionContextStore:je})}),[je]),(0,r.useEffect)((()=>()=>{Re.destroy(),_e.destroy(),Be.destroy()}),[Re,_e,Be]),(0,r.useEffect)((()=>()=>{var e;null==Fe||null===(e=Fe.current)||void 0===e||e.disconnect()}),[]),(0,V().L)({collectionContextStore:je,isFullScreen:Boolean(R),wasCreatedThisSessionStore:je.wasCreatedThisSessionStore,environment:Ie,didDelayOffscreenRenderRef:He});const Ro=(0,h().K8)((()=>{var e;return null===(e=Ut().AppStoreCurrentUserSettingsStore.state)||void 0===e?void 0:e.getSettings()}),[]),_o=(0,h().K8)((()=>Yt().A.getState().loaded),[]);(0,r.useEffect)((()=>{var e;if(!k.isCollectionView())return;const t=null===(e=je.collectionStore())||void 0===e?void 0:e.getFormat();if(!t)return;const n=(0,J().cq)(k)?o(612587).A:o(150193).A,r=(0,o(703596).W)({collectionFormat:t,userSettings:Ro,collectionStore:je.collectionStore(),collectionContextStore:je});r.shouldShowBanner?j().HQ({bannerStore:n,id:r.bannerId,contentKey:r.contentKey,styleKey:r.styleKey,blockStore:k,...k.isCollectionView()&&{context:to().Rr.CollectionViewBlockFullScreen}}):(j().zA({bannerStore:n,id:"JiraTwoWaySyncInfoBanner"}),j().zA({bannerStore:n,id:"AuthMissingForJiraSyncedCollectionPageBanner"}))}),[je,k,Ie,Ro,vo,_o]);const{pendingOpenSource:Bo,pendingOpenFrom:Vo}=(0,h().O$)(Xt().y);(0,r.useEffect)((()=>{var e;const t=null===(e=je.collectionStore())||void 0===e?void 0:e.getFormat();if(!t)return;const o=je.settingsStore;t.external_collection_type&&t.synced_collection_external_url&&Bo&&(F().eM({collectionSettingsStore:o,source:Bo,openedFrom:Vo}),Xt().y.clearPendingOpen())}),[je,Bo,Vo]);const Eo=(0,h().r6)((()=>{var e;const t=null==vo?void 0:vo.isSyncedCollection(),o=!0===(null==vo||null===(e=vo.getFormat().sync_state)||void 0===e?void 0:e.syncing);return Boolean(t&&o&&!s().A.isMobile)}),[vo]);(0,h().O$)(Eo),(0,r.useEffect)((()=>{const e=async t=>{const n=await o(559506).callApi({eventName:"getExternalCollectionSyncState",environment:Ie,data:t});if("success"===n.type&&n.data.result){const o=n.data.result,r=je.numberChildrenReceivedStore,i=je.numberChildrenUnfurledStore;r.setState(o.numberChildrenReceived),i.setState(o.numberChildrenUnfurled),i.state/r.state<1&&(Ge.current=setTimeout((async()=>{await e(t)}),1e4))}},t=async()=>{if(Eo){const t=je.collectionStore(),o=null==t?void 0:t.getFormat().uri,n=null==t?void 0:t.getFormat().bot_id,r=null==t?void 0:t.id;if(!o||!n||!r)return;await e({uri:o,botId:n,collectionId:r})}};return Eo.addListener(t),()=>{Eo.removeListener(t),clearTimeout(Ge.current)}}),[Eo,je,Ie]);const Fo=te||Boolean(null==Ae?void 0:Ae.disableContentPointerEvents),Oo=(0,Ht().bx)(k,Fo),Do=(0,h().K8)((()=>!!vo&&(0,x().Qu)(vo.getValue())),[vo]),Lo=(0,h().K8)((()=>(0,Bt().s)(k.id)),[k]),zo=(0,h().K8)((()=>(0,o(665020).W)(k.id)),[k]),Ko=(0,h().K8)((()=>!!Lo&&je.isEmptyStore.state),[Lo,je]),Ho=(0,h().K8)((()=>!!zo&&je.isEmptyStore.state),[zo,je]),Wo=(0,h().K8)((()=>(0,o(860116).I)(k.getAssociatedLayoutStore())),[k]),No=(0,h().K8)((()=>ct&&Lo&&0===je.collectionStoresStore.state.length&&je.isLoadedStore.state),[ct,Lo,je]),Go=(0,h().K8)((()=>ct&&zo&&0===je.collectionStoresStore.state.length&&k.getCollectionViewStores().length<=1),[ct,zo,je,k]),$o=(0,h().r6)((()=>{if(!bt||!xt||!(0,Z().Ck)(k,void 0,xe)||k.isCollectionViewPageWithContent())return{marginLeft:void 0,marginRight:void 0};return{marginLeft:void 0,marginRight:-(At().Qb/2)}}),[xe,bt,xt,k]);(0,h().O$)($o);const Uo=(0,h().r6)((()=>{var e;if(No||Go)return 0;const t="viewsMain"===(null===(e=je.viewsModuleContextStore)||void 0===e?void 0:e.getViewModuleType());return X||"hidden"!==G||!Y?t?Ft().WK:re||je.isInHomeWidgetStore.state?Ft().nh:Ft().Lq:0}),[No,Go,je,X,G,Y,re]);(0,h().O$)(Uo);const qo=function(e){const{collectionContextStore:t,previewContext:o,isPlaceholderExternalCollection:n}=e;return(0,h().K8)((()=>{var e,r,i;return Boolean(!n&&!(null!=o&&o.hideViewBlockSource)&&t.shouldShowSourceStore.state&&!t.isUnlistedViewStore.state&&!t.isInViewTabLayout()&&(null===(e=t.collectionStore())||void 0===e?void 0:e.canRead())&&"custom"!==(null===(r=t.collectionViewStore())||void 0===r?void 0:r.getType())&&"chat"!==(null===(i=t.collectionViewStore())||void 0===i?void 0:i.getType()))}),[t,o,n])}({collectionContextStore:je,previewContext:Ae,isPlaceholderExternalCollection:Do}),Xo=(0,h().K8)((()=>{var e;return(null===(e=je.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[]}),[je]),Yo=(0,r.useMemo)((()=>{const e=1===(null==Xo?void 0:Xo.length);return qo&&(R||!e)&&!ct}),[qo,Xo,R,ct]),Qo=(0,h().K8)((()=>{if(Ue||Xe||Ze||R)return!0;if("always_show"===G)return!0;if(s().A.isMobile)return!0;if("form_editor"===lt())return!0;if(je.settingsStore.state.open)return!0;if(je.searchOpenStore.state)return!0;if(nt.state.open)return!0;if(tt.state.open)return!0;if(et.state.open)return!0;if(ot.state.open)return!0;if(je.filterBarSortSettingsStore.state.open)return!0;if(Array.from(je.filterBarItemSettingsStoreMap.values()).some((e=>e.state.open)))return!0;return!!it.state.open}),[Ue,Xe,Ze,R,G,lt,je,nt,tt,et,ot,it]),Zo=(0,h().r6)((()=>!je.isInHomeWidgetStore.state||Qo),[Qo,je]);(0,h().O$)(Zo);const Jo=(0,h().r6)((()=>je.collectionActionsMinimizedStore.state&&!R?W().xE.Collapsed:W().xE.Expanded),[je.collectionActionsMinimizedStore,R]);(0,h().O$)(Jo);const en=(0,h().K8)((()=>{const e=lt();return!!e&&(0,L().II)({currentViewType:e,isPlaceholderExternalCollection:Do,collectionContextStore:je,allowedActions:Q,settingsHeaderSizeObserver:_e})}),[lt,je,Q,Do,_e]);(0,h().K8)((()=>{en&&F().IW({collectionSettingsStore:je.settingsStore,showAddItemButton:!0})}),[en,je]);const tn=(0,r.useCallback)((e=>{if(ye)return void ye(e);if(!je.collectionViewBlockStore()||!(0,ro().E)(Ie))return;const t=je.isMultiSourceView;(0,o(885173).U)({userAction:"CollectionViewBlock.handleAddItemClick",environment:Ie,collectionContextStore:je,collectionViewBlockStore:k,shouldCoerce:!0,templateStore:je.defaultPageTemplateStore.state,useCrdt:!0,showMoveTo:t,peekModeOverride:ct?"center_peek":void 0,from:{createBlock:"cvb_add_item"}}),(0,T().X)({environment:Ie,collectionContextStore:je,action:"click_topbar_new_item"})}),[je,Ie,k,ct,ye]),on=(0,r.useCallback)((e=>{const{target:t}=e;if(!yo||s().A.isMobile||!(t instanceof HTMLElement))return;const o=lt();o&&0===e.button&&"form_editor"!==o&&(0,d().SQ)({event:e,context:d().y$.EditorMouseDown,callback:()=>{e.preventDefault(),P().jD({environment:Ie,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:"board"===o||"table"===o})}})}),[Ie,yo,lt]),nn=(0,r.useCallback)(((e,t)=>{(0,d().SQ)({event:e,context:d().y$.Click,callback:()=>{if(at.state||M().Cx(Ie),"page"===t&&!(0,u().Z)()){const{clientX:t,clientY:n,target:r}=e;p().default.afterNextFlush((()=>{_().createAndCommit({userAction:"CollectionViewBlock.PageView.click",environment:Ie,canUndo:!0,perform:e=>{(0,o(487297).t)(Ie,{x:t,y:n,target:r instanceof Element?r:void 0},e,Wo)}})}))}}})}),[Ie,at,Wo]),rn=(0,r.useMemo)((()=>I().sg(mo,100)),[mo]),ln=(0,r.useCallback)((()=>{Qt().A.state||Ye(!0)}),[Ye]),an=(0,r.useCallback)((()=>{Ye(!1)}),[Ye]),sn=(0,r.useCallback)((e=>{e&&Re.observe(e)}),[Re]),cn=(0,r.useCallback)((e=>{e&&Be.observe(e)}),[Be]),dn=(0,r.useCallback)((e=>{e&&_e.observe(e)}),[_e]),un=(0,r.useCallback)((e=>{var t,o;const n=null==e||null===(t=e.getNode())||void 0===t?void 0:t.classList.contains(Vt().Dkd);Ve.current=n?e:(null==Me?void 0:Me.horizontalScroller)||null;const r=je.collectionViewStore();vt(r);const i=null===(o=Ve.current)||void 0===o?void 0:o.getNode();"undefined"!=typeof ResizeObserver&&i&&(Fe.current=new ResizeObserver(rn),Fe.current.observe(i))}),[je,rn,vt,Me]),mn=(0,h().K8)((()=>{var e,t,n,r;if("form_editor"!==lt()&&je.settingsStore.state.open&&"sidebar"===rt.state&&!0!==o(184701).b.state.visible)return(0,Ce.jsx)("div",{style:{paddingInlineStart:null===(e=ao.state)||void 0===e?void 0:e.paddingLeft,paddingInlineEnd:null===(t=ao.state)||void 0===t?void 0:t.paddingRight,marginInlineStart:null===(n=$o.state)||void 0===n?void 0:n.marginLeft,marginInlineEnd:null===(r=$o.state)||void 0===r?void 0:r.marginRight,borderTop:`1px solid ${be.tableDividerColor}`,height:12}})}),[je,$o,ao,be,rt,lt]),gn=(0,h().K8)((()=>{const e=null==vo?void 0:vo.getValue();return Boolean(e&&(0,x().SJ)(e))}),[vo]),Sn=(0,h().K8)((()=>{var e;const t=lt();if(t)return(0,z().B2)({blockStore:k,isFullScreen:Boolean(R),collectionContextStore:je})||kt&&"feed"!==t?0:-((null===(e=ao.state)||void 0===e?void 0:e.paddingLeft)??0)}),[lt,k,R,ao,je,kt]),[hn,yn,vn]=(0,h().K8)((()=>[je.normalizedSchemaStore.state,je.normalizedQueryStore.state,je.normalizedFormatStore.state]),[je]),fn=(0,h().K8)((()=>{if("collectionTypedView"===je.contextType)return G;if("collectionSystemView"===je.contextType){const e=je.collectionViewStore(),t=null==e?void 0:e.getCollectionSource();return(0,b().TR)(t)?"default":"hidden"}return"dashboard"===(null==yo?void 0:yo.getType())||vo&&!1!==vo.canRead()&&vo.isDefined()?G??"default":"hidden"}),[je,vo,yo,G]),bn=(0,r.useRef)(null),xn=(0,h().K8)((()=>{var e,t,o,n;const r=lt(),i=ut&&!oe().default.isSidePeekOpeningStore.state&&!re,l=i?R?{paddingInlineStart:(null==ao||null===(e=ao.state)||void 0===e?void 0:e.paddingLeft)??0,paddingInlineEnd:16}:{paddingInlineStart:0,paddingInlineEnd:((null==ao||null===(t=ao.state)||void 0===t?void 0:t.paddingRight)??0)+16}:(null==ao?void 0:ao.state)&&{paddingInlineStart:ao.state.paddingLeft,paddingInlineEnd:ao.state.paddingRight},a=(0,$t().Uh)(Ie),s=(0,Z().Ck)(k,void 0,xe)||R?a:Math.min(Z().x6,a);return{minHeight:Uo.state,paddingInlineStart:null==l?void 0:l.paddingInlineStart,paddingInlineEnd:null==l?void 0:l.paddingInlineEnd,width:q,position:"relative",insetInlineStart:kt&&"feed"!==r?0:-((null==l?void 0:l.paddingInlineStart)??0),flexShrink:0,...(R||Te||i)&&{position:"sticky",zIndex:86,insetInlineStart:0,width:!ut||!l||R||Te||re?void 0:s-l.paddingInlineStart/2},...k.isNonEditableState()&&{cursor:"default"},marginInlineStart:null===(o=$o.state)||void 0===o?void 0:o.marginLeft,marginInlineEnd:null===(n=$o.state)||void 0===n?void 0:n.marginRight,...fe}}),[ut,re,R,ao,Ie,k,xe,Uo,q,Te,$o,kt,lt,fe]),Cn=(0,r.useCallback)((e=>{(0,D().O)({collectionContextStore:je,collectionSettingsStore:je.settingsStore,hideSettingsHeader:!0,ref:e,initialStack:[{type:"linkToDatabase",existingCollectionStore:vo,analytics:void 0}]})}),[je,vo]),{currentViewType:wn,paddingLeft:kn}=(0,h().K8)((()=>{var e;return{currentViewType:lt(),paddingLeft:null===(e=ao.state)||void 0===e?void 0:e.paddingLeft}}),[lt,ao]);let In;if(yo&&hn&&yn&&vn&&wn)if(mt)In=(0,Ce.jsx)(gy,{store:k});else if(gn)In=(0,Ce.jsx)(gt().RI,{value:je,children:(0,Ce.jsx)(a().s,{allowSelectionWithin:!0,style:xn,onMouseDown:on,onMouseMove:ln,onMouseLeave:an,onClick:nn,ref:(0,w().Px)(sn,ke),children:(0,Ce.jsx)(jt().Ay,{store:k,shouldShowHoverMenu:!0,analyticsName:(0,W().LI)(wn),shouldShowHalo:!R&&!Te&&!ct,canSelect:!(R||Te||ct||dt),children:(0,Ce.jsx)(o(361873).A,{store:k,style:{width:"auto"},disabled:!1})})})});else if(Go)In=(0,Ce.jsx)(gt().RI,{value:je,children:(0,Ce.jsx)("div",{ref:ke,...Mo,style:{display:"contents"},children:(0,Ce.jsxs)("div",{style:(0,Gt().V$)({isPhone:we,theme:be}),ref:bn,children:[(0,Ce.jsx)("div",{style:{position:"relative"},children:(0,Ce.jsx)(CS,{currentViewType:wn,headerSizeObserver:Re,contentSizeObserver:Be,settingsHeaderSizeObserver:_e,headerHeightStore:Uo,viewSettingsPlacementStore:rt,store:k,leftRightPaddingStore:ao,isInHomeWidget:ct,placementToOrigin:"right",alignmentToOrigin:"center",headerRef:bn})}),(0,Ce.jsx)(Nt().Ww,{feature:"custom_db",onSetup:Cn})]})})});else{const e=(0,Ce.jsx)(yS,{collectionContentWrapperStyle:ve,collectionContextStore:je,store:k,collectionStore:vo,collectionViewStore:yo,currentViewType:wn,isDisabled:Fo,isFullScreen:Boolean(R),isInPeek:st,isPreviewing:Te,isRootOrDirectChild:bt,headerSizeObserver:Re,timelineViewRef:Oe,showHoverActionsStore:Zo,handleAddItemClick:tn,isPlaceholderExternalCollection:Do,isMyTasksEmpty:Ko,isInFrameWhenSidePeekOpen:ut,query:yn,schema:hn,format:vn,showHomeCustomDbEmptyState:Go,maxHeight:ee,viewSettingsPlacementStore:rt,templatePickerMenuListStore:de,editorContentContainerRef:he,showMyTasksEmptyState:No,isInHomeWidget:ct,isUnlistedView:re,isHomeCustomDbEmpty:Ho,handleHorizontalScrollerMount:un,handleEditorMouseDown:on,handleEditorClick:nn,leftRightPaddingStore:ao,handleContentMount:cn,rootRef:ke,isViewModule:dt,additionalCollectionViewInnerHorizontalPadding:ce,scrollerLeftPadding:ht,headerHeightStore:Uo,fullWidth:q,contentEditableVoidLeft:Sn,leftRightMarginStore:$o});In=(0,Ce.jsx)(gt().RI,{value:je,children:(0,Ce.jsx)(o(532564).Z,{value:Pe,children:(0,Ce.jsxs)("div",{ref:ke,...Mo,style:{display:"contents"},children:[R?void 0:(0,Ce.jsx)("div",{style:{position:"relative"},children:(0,Ce.jsx)(CS,{currentViewType:wn,headerSizeObserver:Re,contentSizeObserver:Be,settingsHeaderSizeObserver:_e,headerHeightStore:Uo,viewSettingsPlacementStore:rt,store:k,leftRightPaddingStore:ao,isInHomeWidget:ct,headerRef:bn,handleAddItemClick:tn})}),(0,Ce.jsx)(Ct,{}),(0,Ce.jsx)(pn,{isFullScreen:Boolean(R),leftRightPaddingStore:ao,leftRightMarginStore:$o,overrideViewType:N}),Yo?(0,Ce.jsx)(a().s,{allowSelectionWithin:!0,onMouseDown:on,onMouseMove:ln,onMouseLeave:an,ref:(0,w().Px)(sn,bn),style:{position:"sticky",insetInlineStart:0},children:(0,Ce.jsx)("div",{style:{marginBottom:6},children:(0,Ce.jsx)(Qe,{store:k,collectionContextStore:je,showHoverActionsStore:Zo,isFullScreen:Boolean(R),canEdit:Oo,paddingLeft:kn})})}):void 0,(0,Ce.jsx)(cy,{currentViewType:wn,store:k,headerWrapStyle:xn,headerActionsBehavior:fn,allowedActions:Q,hideViewTabBar:Y??!1,showHoverActionsStore:Zo,headerSizeObserver:Re,isFullScreen:Boolean(R),isInHomeWidget:ct,isMyTasksPage:Lo,isHomeCustomDbPage:zo,isPlaceholderExternalCollection:Do,collectionViewHeaderText:X,handleEditorMouseDown:on,handleHeaderMouseMove:ln,handleHeaderMouseLeave:an,handleHeaderMount:sn,handleSettingsHeaderMount:dn,leftRightPaddingStore:ao,headerHeightStore:Uo,canEdit:Oo,viewSettingsPlacementStore:rt,contentSizeObserver:Be,settingsHeaderSizeObserver:_e,handleAddItemClick:tn,timelineViewRef:Oe,filterBarCreateFilterSettingsStore:ot,createFilterSettingsStore:et,createFollowSettingsStore:tt,switchViewMetric:$e,showOnlyCurrentView:Boolean(se),headerRef:bn,headerStyleOverrides:{...re&&{paddingInlineStart:24,paddingInlineEnd:24,paddingTop:12}},minimizedActionViewStore:Jo}),"form_editor"===wn?(0,Ce.jsx)(Tt().N,{capture:!0,allowSearch:!0,allowEsc:!0,allowUndo:!0,allowOpenLinkMenu:!0,allowBackspace:!0,allowMenuList:!0,wrapperTag:"div",children:e}):e,mn,(0,Ce.jsx)(io().DG,{collectionContextStore:je,paddingLeft:kn}),(0,Ce.jsx)(wo,{collectionContextStore:je,collectionViewBlockRenderStartTime:De,didDelayOffscreenRenderRef:He,mountedBeforeInitialPageRender:ue,cvbLoadingStateOnInitialRender:me,lazyRenderStartedAtRef:ge,trackPendingCollectionItemRender:Se}),(0,Ce.jsx)(go,{collectionContextStore:je,mountedBeforeInitialPageRender:Boolean(ue)})]})})})}else In=null;return(0,Ht().NW)(k,t,(0,h().K8)((()=>({renderedType:"collection_view_page"===k.getType()?"collection_view_page":"collection_view",getBlockStore:()=>k,getNode:()=>ke.current,collectionContextStore:je,resetLeftScrollAfterFlush:()=>{p().default.afterNextFlush((()=>{var e;const t=null===(e=Ve.current)||void 0===e?void 0:e.getNode();if(t){t.scrollLeft=0;const e=(0,Kt().T8)(t);e&&(e.scrollLeft=0)}}))},handleCreated:()=>py(Ie,je)})),[k,je,Ie]),In)})));function py(e,t){R().IU({environment:e}),p().default.afterNextFlush((()=>{const o=t.collectionStore(),n=t.collectionViewStore(),r=t.collectionViewBlockStore(),i=t.settingsStore;if(!r)return;const l=r.getCollectionStoreIfSingleSource(),a=null==n?void 0:n.getType(),s=null!=n&&n.id?(0,H().v)(null==n?void 0:n.id):void 0;if(null!=s&&s.shouldOpenDashboardBuildMode&&t.setIsInDashboardBuildMode(!0),o&&(0,x().Qu)(o.getValue()))F().Ho({collectionSettingsStore:i});else if(l)"form_editor"!==a?((0,D().O)({collectionContextStore:t,collectionSettingsStore:i}),F().R8({collectionSettingsStore:i,item:{type:"createViewSource",existingCollectionStore:l,createdCollectionRecordPointerMap:void 0,analytics:void 0}}),"chart"===a&&t.isCreatingNewChartCollectionStore.setState(!0)):(0,G().P)({environment:e,collectionContextStore:t});else if(o)n?(!function(e){const{collectionStore:t,collectionViewStore:o,collectionViewBlockStore:n,collectionContextStore:r,environment:i}=e,l=null==o?void 0:o.id,a=l?(0,H().v)(l):void 0,s=W().Mf({collectionStore:t,sourceCollectionViewBlockStore:n,currentCollectionViewBlockStore:n,currentCollectionViewStore:o,constraints:(0,H().v)(o.id)}).find((e=>{var t;return e.id===(null==a||null===(t=a.viewPointer)||void 0===t?void 0:t.id)}));s&&(0,N().U)({viewToDuplicateStore:s,collectionContextStore:r,collectionViewStore:o,environment:i})}({collectionStore:o,collectionViewStore:n,collectionViewBlockStore:r,collectionContextStore:t,environment:e}),(0,D().O)({collectionContextStore:t,collectionSettingsStore:i}),F().R8({collectionSettingsStore:i,item:{type:"duplicateExistingView"}})):(0,O().M)({environment:e,collectionStore:o,collectionContextStore:t,collectionSettingsStore:i});else{const e=null==s?void 0:s.viewSettingsStack;"skip"!==(null==e?void 0:e.type)&&(0,D().O)({collectionContextStore:t,collectionSettingsStore:i,initialStack:null==e?void 0:e.stack})}}))}const my=uy;function gy({store:e}){const t=(0,m().v3)(),n=(0,y().DP)();return(0,h().K8)((()=>{const r=e.getSpaceId();return(0,Ce.jsx)(Ce.Fragment,{children:o(921855).S5({environment:t,textValue:{value:[k().Ey_(e.pointer.id,[["p",e.pointer.id,r]])],spaceId:r},parentStore:e,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disabled:!1,emojiType:(0,o(712030).FN)(t),theme:n,katex:t.KatexStore.getKatex(),formulaValueTypes:[]})})}),[t,e,n])}},879526:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,infoCircleFillIcon:()=>r});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.26 15.25",svg:(0,o(474848).jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M8.65 8.25a.625.625 0 1 0 0 1.25h.725v3.25H8.65a.625.625 0 1 0 0 1.25h2.7a.625.625 0 1 0 0-1.25h-.725V8.875A.625.625 0 0 0 10 8.25zM10.7 6.3a.8.8 0 1 0-1.6 0 .8.8 0 0 0 1.6 0"})},r=(0,o(340498).wt)("infoCircleFill",n)},888325:(e,t,o)=>{function n(e){return`${e.table}:${e.id}`}o.d(t,{_:()=>n})},915508:(e,t,o)=>{function n(e){return e.isDashboardView()}o.d(t,{R:()=>n})},923925:(e,t,o)=>{o.d(t,{f:()=>a});var n=()=>o(56366),r=()=>o(541235),i=()=>o(739135),l=()=>o(765957);function a(e){const{stepType:t,tutorialType:o,additionalChecks:a}=e,s=(0,n().O$)(l().AppStoreCurrentUserSettingsStore);return(0,n().K8)((()=>{var e;const n=(0,i().gt)(s,o),l=null==s||null===(e=s.getSettings())||void 0===e||null===(e=e.tutorial_step_settings)||void 0===e?void 0:e[o];if(!l)return!1;const c=(0,r().Ud)(t,l);return!(n!==t||(null==c?void 0:c.stepType)!==t)&&(!a||!c||a(c))}),[s,t,o,a])}},928196:(e,t,o)=>{o.d(t,{L:()=>m});var n=o(296540),r=()=>o(726637),i=()=>o(56366),l=()=>o(69708),a=()=>o(436696),s=()=>o(968021),c=()=>o(147503),d=o(474848);const u=(0,o(645873)._h)(o(579372).C,(e=>e.DatabaseOnboardingTourtip)),p=["relation"],m=n.memo((function(e){const{collectionContextStore:t,aiSuggestion:m=null,hasTooltipSuggestion:g=!1,onSuggestionChange:S,onUserAddedProperty:h}=e,y=(0,o(484714).v3)(),v=(0,n.useRef)(null),f=(0,n.useRef)(null),b=(0,i().O$)(t.normalizedSchemaStore),x=(0,n.useMemo)((()=>Object.keys(b).length<=1),[b]),C=(0,i().uB)(void 0,o(463830).A),w=(0,i().O$)(C).open,k=(0,i().K8)((()=>{const e=t.collectionStore();return null==e?void 0:e.id}),[t]),I=(0,o(923925).f)({tutorialType:"database_onboarding",stepType:"database_onboarding_add_property_tooltip",additionalChecks:e=>"database_onboarding_add_property_tooltip"===e.stepType&&e.collectionId===k}),A=(0,o(401497).IS)((e=>{const t={display:"flex",alignItems:"center",justifyContent:"start",height:o(236030).cR,width:"100%",paddingInlineStart:6,paddingInlineEnd:6,fontSize:r().A.isMobile?s().hN:s().Mi};return{addColumnContainer:{display:"flex",alignItems:"center",justifyContent:"start",gap:4},longButton:t,longButtonAnchor:{...t,width:378},smallButton:{display:"flex",alignItems:"center",justifyContent:"center",width:r().A.isMobile?32:28,height:r().A.isMobile?32:28},popupWrapStyle:{boxShadow:"none",overflow:void 0,background:"none"},tourtip:I?{boxShadow:e.buttonBlueFocusRing,borderRadius:4}:{}}}),[I]),T=(0,n.useCallback)((()=>{v.current&&(0,o(953418).$v)({element:v.current,environment:y,blockAlignment:"center",inlineAlignment:"nearest",behavior:"smooth",additionalPadding:{left:20,right:20}})}),[y]),j=(0,n.useCallback)((()=>{C.setState({...C.state,open:!1})}),[C]),M=(0,n.useCallback)((e=>{const{propertyType:n,isSuggestedProperty:i,propertyName:l,propertyIcon:a,selectOptions:s}=e;o(36629).nZ({environment:y,collectionContextStore:t,propertyType:n,isSuggestedProperty:i,propertyName:l,propertyIcon:a,selectOptions:s,from:"table",shouldOpenEditMenu:!1}),i||null==h||h(),r().A.isMobile&&!p.includes(n)?c().os({collectionSettingsStore:t.settingsStore}):j()}),[t,y,j,h]),P=(0,n.useCallback)((()=>{t.collectionStore()&&((0,o(749804).I)({environment:y}),o(778417).IU({environment:y}),(0,o(404779).y)(),(0,a().X)({environment:y,collectionContextStore:t,action:"click_new_property"}),c().R8({collectionSettingsStore:t.settingsStore,item:{type:"propertyType",onAccept:M}}))}),[t,y,M]),R=(0,n.useCallback)((e=>{const n="single_suggestion"===(null==m?void 0:m.suggestionType)||"multiple_suggestions"===(null==m?void 0:m.suggestionType),r=w?A.longButtonAnchor:x?{...A.longButton,...n?{width:"fit-content"}:{}}:A.smallButton,i=(0,d.jsx)(o(631524).p,{ref:v,testId:"add-column-button",style:r,onMouseDown:o(358898).tr,iconLeading:{icon:x?o(617668).plusIcon:o(863330).plusSmallIcon,size:x?"default":"sm"},colorPalette:"gray",...e,children:x&&!n?(0,d.jsx)(l().sA,{defaultMessage:"Add property",id:"collectionTable.addColumnContainer.addProperty"}):null});return I?(0,d.jsxs)("div",{style:A.tourtip,ref:f,children:[i,(0,d.jsx)(u,{tutorialStepId:"database_onboarding_add_property_tooltip",contentRef:f,type:"database_onboarding"})]}):g&&null!=m&&m.suggestionProperty?(0,d.jsxs)("div",{style:A.tourtip,ref:f,children:[i,(0,d.jsx)(o(112961).i7,{originRef:f,property:m.suggestionProperty,collectionContextStore:t,onPropertyAdded:()=>{null==S||S(null)}})]}):x?i:(0,d.jsx)(o(859428).A,{placement:"top",renderTooltip:()=>(0,d.jsx)(l().sA,{defaultMessage:"Add property",id:"collectionTable.addColumnContainer.addProperty"}),render:e=>(0,d.jsx)("div",{...e,children:i})})}),[A.smallButton,w,x,A.longButton,A.longButtonAnchor,A.tourtip,I,null==m?void 0:m.suggestionProperty,null==m?void 0:m.suggestionType,t,g,S]),_=(0,n.useCallback)((()=>(0,d.jsx)(o(59400).FZ,{collectionContextStore:t,collectionSettingsStore:t.settingsStore,handleClosePopup:j,scrollOriginIntoView:T,onAccept:M})),[t,j,T,M]),B=(0,n.useCallback)((()=>{(0,a().X)({environment:y,collectionContextStore:t,action:"click_new_property"})}),[y,t]),V=(0,i().O$)(t.canConfigureBlockStore),E=(0,i().K8)((()=>t.permissionScopesStore.state.isExternallyImportedAndSyncedCollection),[t.permissionScopesStore]),F=(0,o(59226).X)("jira_notion_only_properties");return E&&!F?null:r().A.isMobile?R({onClick:P}):(0,d.jsx)("div",{style:A.addColumnContainer,children:(0,d.jsx)(o(406699).A,{popupType:o(30537).n.Popup,disabled:!V,originGap:0,alignmentToOrigin:"start",buttonPopupStore:C,renderOrigin:R,render:_,onClick:B,onClose:j,popupWrapStyle:A.popupWrapStyle,preventScaleTransition:!0,preventOpacityTransition:!0,disableFlippingPlacement:!0})})}))},939556:(e,t,o)=>{o.d(t,{y:()=>x});o(898992),o(430670),o(581454);var n=o(296540),r=()=>o(59226),i=()=>o(726637),l=()=>o(484714),a=()=>o(56366),s=()=>o(69708),c=()=>o(496603),d=()=>o(404277),u=()=>o(939740),p=()=>o(89924),m=()=>o(320865),g=()=>o(106412),S=()=>o(722872),h=()=>o(645873),y=()=>o(955450),v=()=>o(637096),f=o(474848);const b={getCollectionViewActionMenuSections:new(h().O2)("getCollectionViewActionMenuSections",(async()=>await o.e(67561).then(o.bind(o,704971))))};function x({collectionViewStore:e,collectionContextStore:t,onClose:o}){const x=(0,l().v3)(),C=(0,s().tz)(),w=(0,g().Zp)(),k=(0,y().K)({collectionContextStore:t}),I=(0,r().X)("notion_calendar_db_integration_non_time_views"),A=(0,v().W)({collectionContextStore:t,entrypoint:"view_menu"}),T=(0,h().fJ)(b.getCollectionViewActionMenuSections),j=(0,a().K8)((()=>"resolved"===T.status&&T.value?T.value.getMenuSections({collectionViewStore:e,collectionContextStore:t,onClose:o,environment:x,intl:C,previewContext:w,canSeeCalendarButton:k&&I,openInCalendar:A}):[[{key:"loading-view-action-menu-sections",render:()=>(0,f.jsx)(m().A,{}),action:()=>{}}]]),[T,t,e,k,I,A,x,C,w,o]),M=j.flatMap((e=>e)).length>0;return{renderMenu:(0,n.useCallback)((()=>{if(!M)return null;const e=i().A.isMobile?{menuType:S().gu.Modal,title:(0,f.jsx)(s().sA,{defaultMessage:"View options",id:"database.viewSettings.viewActionMenu.title"})}:{menuType:S().gu.Popup,width:220};return(0,f.jsx)(d().A,{...e,children:(0,f.jsx)(u().Ay,{type:u().Oh.Vertical,initialFocus:void 0,sections:c().oE(j.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,f.jsx)(p().A,{...e,topBorder:0!==t}),items:e}})))})})}),[M,j]),hasMenuItems:M}}},940563:(e,t,o)=>{o.r(t),o.d(t,{arrowStraightRightIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.37 3.97 15.26 12.06",directional:!0,svg:(0,o(474848).jsx)("path",{d:"m17.442 9.558-5.4-5.4a.625.625 0 0 0-.884.884l4.333 4.333H3a.625.625 0 1 0 0 1.25h12.491l-4.333 4.333a.625.625 0 1 0 .884.884l5.4-5.4a.62.62 0 0 0 0-.884"})},r=(0,o(340498).wt)("arrowStraightRight",n)},955450:(e,t,o)=>{o.d(t,{K:()=>c});var n=()=>o(59226),r=()=>o(484714),i=()=>o(56366),l=()=>o(106412),a=()=>o(765957),s=()=>o(583238);function c(e){const{collectionContextStore:t}=e,o=(0,r().v3)(),c=(0,l().Zp)(),d=(0,i().O$)(t.normalizedSchemaStore),u=(0,i().K8)((()=>t.collectionViewStore()),[t]),p=(0,i().K8)((()=>null==u?void 0:u.getType()),[u]),m=(0,n().X)("notion_calendar_db_integration_non_time_views"),g=(0,i().K8)((()=>(0,s().JF)({environment:o,spaceStore:a().default.state.sidebarSpaceStore,schema:d,collectionContextType:t.contextType,collectionViewType:p,enableForNonTimeBasedViews:m})),[o,d,t,p,m]);return Boolean(g)&&!(null!=c&&c.disablePageLinks)}},966759:(e,t,o)=>{o.d(t,{i:()=>i});var n=()=>o(476492),r=()=>o(175213);function i(e){const{environment:t,collectionContextStore:o,property_type:i,from:l,property:a,...s}=e,c=(0,n().sl)(o)||{};(0,r().G)(t,{property:a,property_type:i,from:l,...s,...c})}},988268:(e,t,o)=>{o.d(t,{j:()=>l});var n=()=>o(747100),r=()=>o(543886),i=()=>o(405170);function l(){return n().Gb()?i().A:r().A}},991941:(e,t,o)=>{o.d(t,{M:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"3.37 1.53 9.26 12.92",svg:(0,o(474848).jsx)("path",{d:"m10.225 6.095-.11-1.14.18-.16c.64-.57 1.01-1.4 1.01-2.26v-.38c0-.34-.28-.62-.62-.62h-5.36c-.34 0-.62.28-.62.62v.38c0 .86.37 1.68 1.01 2.26l.18.16-.11 1.14c-1.44.58-2.41 2-2.41 3.55v.5c0 .34.28.62.63.62h3.23v2.34c0 .14.03.27.09.4l.35.75c.05.11.14.18.26.2h.06c.09 0 .19-.04.26-.11l.06-.08.35-.77c.06-.12.09-.26.09-.4v-2.34h3.26c.34 0 .62-.28.62-.62v-.5c0-1.56-.96-2.98-2.41-3.55zm-3.66 1.05c.23-.08.4-.29.42-.53l.18-1.85c.02-.2-.06-.4-.21-.53l-.42-.38c-.32-.28-.52-.66-.58-1.08h4.07c-.06.42-.26.8-.58 1.08l-.42.38c-.15.13-.23.33-.21.53l.18 1.85c.02.24.19.45.42.53l.19.06c1 .34 1.7 1.27 1.75 2.32h-6.73c.05-1.05.74-1.98 1.75-2.32z"})},r=(0,o(340498).wt)("pinSmall",n)}}]);