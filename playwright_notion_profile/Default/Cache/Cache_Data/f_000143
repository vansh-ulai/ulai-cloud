"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[4902,33336],{8264:(e,t,n)=>{n.d(t,{o:()=>R});n(898992),n(354520),n(672577),n(581454);var o=n(296540),i=()=>n(59226),r=()=>n(993905),a=()=>n(484714),s=()=>n(56366),c=()=>n(401497),l=()=>n(631524),d=()=>n(493552),u=()=>n(69708),p=()=>n(534177),m=()=>n(549500),v=()=>n(285790),g=()=>n(296798),f=()=>n(859428),h=()=>n(645200),S=()=>n(320260),y=()=>n(583238),b=()=>n(928074),k=()=>n(765957),A=()=>n(870092),T=()=>n(711207),_=()=>n(195260),x=()=>n(760979),w=()=>n(353890),I=()=>n(155089),C=()=>n(645873);const M=new(C().O2)("TranscriptionBlockCalendarAttendeesList",(async()=>n.e(30603).then(n.bind(n,955079)))),B=(0,C()._h)(M,(e=>e.TranscriptionBlockCalendarAttendeesList));var D=n(474848);const E=(0,u().YK)({openCalendar:{id:"transcriptionBlockCalendarHeader.openCalendar",defaultMessage:"Open in Notion Calendar"}});function R(e){const{calendarEvent:t,id:n,title:i}=e,s=(0,a().v3)(),l=(0,c().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:6},group:{display:"flex",flexDirection:"row",gap:8},secondaryGroup:{display:"block"}})),[]),d=(0,o.useCallback)((e=>{if(e.preventDefault(),e.stopPropagation(),t){const e=(0,y().i$)({eventUid:t.uid,startTimeIso:t.startTime.toISO()});h().yd({baseUrl:e,environment:s,from:"transcriptionBlockTitle"})}}),[s,t]);return(0,D.jsxs)(r().s,{allowSelectionWithin:!0,style:l.container,children:[(0,D.jsxs)("div",{style:l.group,children:[(0,D.jsx)(N,{calendarEvent:t,onClick:d}),(0,D.jsx)("div",{style:l.secondaryGroup,children:(0,D.jsx)(j,{calendarEvent:t,id:n,title:i,onClick:d})})]}),(0,D.jsx)(P,{})]})}function N(e){const{calendarEvent:t,onClick:n}=e,o=(0,u().tz)(),i=(0,c().IS)((e=>({container:{marginTop:4,alignSelf:"flex-start"},icon:{width:24,height:24,color:e.text.primary}})),[]);return(0,D.jsx)(f().A,{renderTooltip:()=>(0,D.jsx)(u().sA,{...E.openCalendar}),render:e=>(0,D.jsx)("div",{...e,style:i.container,children:(0,D.jsx)(v().A,{icon:()=>(0,D.jsx)(S().y,{style:i.icon,dateNumber:t.startTime.day}),ariaLabel:o.formatMessage(E.openCalendar),onClick:n})})})}function j(e){const{calendarEvent:t,id:n,title:o,onClick:i}=e,r=(0,y().i$)({eventUid:t.uid,startTimeIso:t.startTime.toISO()}),a=(0,c().IS)((()=>({titleLink:{display:"inline"},titleLinkHoveredOrPressed:{background:"transparent"},heading:{cursor:"pointer",display:"inline",marginInlineEnd:8}})),[]);return(0,D.jsxs)(g().A,{href:r,style:a.titleLink,hoveredStyle:a.titleLinkHoveredOrPressed,pressedStyle:a.titleLinkHoveredOrPressed,children:[(0,D.jsx)(I().C,{disabled:!0,id:n,onClick:i,title:o,style:a.heading}),(0,D.jsx)(B,{calendarEvent:t})]})}function P(){const{store:e}=(0,w().s)(),t=(0,a().v3)(),n=(0,x().z)(),r=(0,o.useMemo)((()=>(null==n?void 0:n.attendeeIds)??[]),[n]),v=(0,_().G)(r),g=(0,s().K8)((()=>!(0,b().Aj)({store:e})),[e]),f=(0,c().IS)((e=>({actionRow:{display:"flex",flexDirection:"row",alignItems:"center",gap:6,flexWrap:"wrap",color:e.text.secondary},buttonRow:{display:"flex",flexDirection:"row",alignItems:"center"},button:{height:24,borderRadius:6}})),[]),h=(0,o.useCallback)((()=>{(0,T().FP)({environment:t,store:e})}),[t,e]),S=(0,s().K8)((()=>{const{sidebarSpaceStore:e}=k().default.state;if(!e)return[];const o=((null==n?void 0:n.attendeeIds)??[]).map((t=>A().L.createChildStore(e,{table:"notion_user",id:t}))).filter((e=>e.isReady()&&e.isDefined()));return[o.find((e=>e.id===t.currentUser.id)),...o.filter((e=>e.id!==t.currentUser.id))].filter(p().O9)}),[n,t.currentUser.id]),y=(0,i().X)("ai_meeting_notes_title_redesign");return(0,s().K8)((()=>{var t;if(!n)return!1;if(!y)return!1;if(!Object.values(v).includes("none"))return!1;if(!n)return!1;if(Boolean(null===(t=e.getFormat())||void 0===t||null===(t=t.transcription_calendar_event)||void 0===t?void 0:t.has_dismissed_sharing))return!1;const o=e.getNavigableBlockStore();return!(null==o||!o.isDefined())&&(!!o.canEditMembership()&&(0!==S.length&&!g))}),[n,e,v,S,y,g])?(0,D.jsxs)("div",{style:f.actionRow,children:[(0,D.jsx)(d().D,{styleKey:"Body/Medium",children:(0,D.jsx)(u().sA,{id:"transcriptionBlock.addCalendarEventSuggestion.shareLabel",defaultMessage:"Share this page with event participants?"})}),(0,D.jsxs)("div",{style:f.buttonRow,children:[(0,D.jsx)(m().sz,{children:e=>(0,D.jsx)(l().p,{...e,style:f.button,colorPalette:"gray",children:(0,D.jsx)(u().sA,{id:"transcriptionBlock.addCalendarEventShareSuggestion.shareAcceptButton",defaultMessage:"Share"})}),users:S,rolesMap:v}),(0,D.jsx)(l().p,{onClick:h,style:f.button,colorPalette:"gray",children:(0,D.jsx)(u().sA,{id:"transcriptionBlock.addCalendarEventShareSuggestion.dismissButton",defaultMessage:"Dismiss"})})]})]}):null}},8741:(e,t,n)=>{n.r(t),n.d(t,{arrowDiagonalUpRightSmallIcon:()=>i,iconDefinition:()=>o});n(296540);const o={viewBox:"0 0 16 16",fittedViewBox:"3.65 3.66 8.68 8.68",directional:!0,svg:(0,n(474848).jsx)("path",{d:"M5.603 3.663a.625.625 0 1 0 0 1.25h4.6l-6.37 6.371a.615.615 0 0 0 .013.87.616.616 0 0 0 .87.014l6.371-6.372v4.601a.625.625 0 1 0 1.25 0v-6.11a.625.625 0 0 0-.625-.624z"})},i=(0,n(340498).wt)("arrowDiagonalUpRightSmall",o)},27356:(e,t,n)=>{n.r(t),n.d(t,{UISpacePermissionGroupToken:()=>h});var o=n(296540),i=()=>n(726637),r=()=>n(484714),a=()=>n(56366),s=()=>n(401497),c=()=>n(784892),l=()=>n(437607),d=()=>n(914462),u=()=>n(69708),p=()=>n(284371),m=()=>n(764353),v=()=>n(848401),g=()=>n(580648),f=n(474848);function h(e){const{parentStore:t,style:n,format:h}=e,S=e.groupPointer.id,y=e.groupPointer.spaceId,b=(0,l().S4)({spacePermissionGroupId:S,spaceId:y}),k=(0,a().K8)((()=>{if(e.groupModel)return e.groupModel;if(!t)return;return m().C.createChildStore(t,b).getModel()}),[t,b,e.groupModel]),A=(0,r().Y0)(),{outerStyle:T,avatarWrapStyle:_}=(0,s().IS)((e=>({outerStyle:{display:"flex",alignItems:"center",minWidth:0},avatarWrapStyle:{width:"none",minHeight:"none",marginInlineEnd:6},badgeStyle:{borderRadius:4,background:e.legacyDefaultSelectColor,fontSize:i().A.isMobile?11:9,lineHeight:A.isAndroid?1.5:1,textTransform:"uppercase",letterSpacing:"0.04em"}})),[A]),x=(0,u().tz)(),w=(0,a().K8)((()=>(0,d().n)({intl:x,permissionGroupModel:k})),[x,k]),I=(0,o.useCallback)((e=>h===c().NY.Inline?(0,f.jsx)(g().o,{group:k,size:e}):(0,f.jsxs)("div",{style:T,children:[(0,f.jsx)("div",{style:_,children:(0,f.jsx)(g().o,{group:k,size:e})}),(0,f.jsx)("div",{style:{...p().RC},children:w})]})),[h,T,_,k,w]);return(0,f.jsx)(v().Ay,{...e,style:{margin:0,...n},renderAvatar:I})}},28834:(e,t,n)=>{n.d(t,{Nr:()=>u,Q:()=>d});n(16280),n(944114),n(816573),n(878100),n(177936),n(748140),n(821903),n(491134),n(128845),n(237467),n(444732),n(979577),n(898992),n(823215),n(672577),n(430670),n(803949),n(581454);class o{constructor(e,t){this._inputSampleRate=void 0,this._outputSampleRate=void 0,this._inputSampleRate=e,this._outputSampleRate=t}downsample(e){return this.downSampleAudioFrame(e,this._inputSampleRate,this._outputSampleRate)}downSampleAudioFrame(e,t,n){if(n===t||n>t)return e;const o=t/n,i=Math.round(e.length/o),r=new Float32Array(i);let a=0,s=0;for(;s<i;){const t=Math.round((s+1)*o);let n=0,i=0;for(;a<t&&a<e.length;)n+=e[a++],i++;r[s++]=n/i}return r}}var i=()=>n(165358),r=()=>n(229833),a=()=>n(909557),s=()=>n(673903),c=()=>n(426175),l=()=>n(524007);n(814603),n(147566),n(198721);const d="ms_change";class u{constructor(e){this._mediaStreams=void 0,this._emitter=void 0,this.recorder=void 0,this.onDataReceived=void 0,this.onStop=void 0,this.environment=void 0,this.startController=void 0,this.audioBuffer=[],this.currentStreamId=null,this.sampleRate=void 0,this.includeSystemAudio=void 0,this.saveAudioFileMetadata=void 0,this.handleDeviceChange=async()=>{var e;const t=null===(e=this.mediaStreams)||void 0===e||null===(e=e.flatMap((e=>e.getAudioTracks())))||void 0===e||null===(e=e.map((e=>e.getSettings())))||void 0===e?void 0:e.find((e=>void 0!==e)),o=this.getPreferredOrDefaultDevice();if(!t||o&&(o.deviceId!==t.deviceId||o.groupId!==t.groupId)){this.stop({triggerOnStop:!1,triggerFlushToOPFS:!0});try{await this.start()}catch(i){this.destroy((0,n(319625).A)(i))}}},this._emitter=(0,n(827380).A)(),this.recorder=new p,this.onDataReceived=e.onDataReceived,this.onStop=e.onStop,this.includeSystemAudio=e.includeSystemAudio,this.environment=e.environment,this.sampleRate=e.sampleRate??16e3,this.saveAudioFileMetadata=e.saveAudioFileMetadata}get emitter(){return this._emitter}get isStoringLocalAudio(){return void 0!==this.saveAudioFileMetadata&&void 0!==u.meetingNotesCache}set mediaStreams(e){if(this._mediaStreams)for(const n of this._mediaStreams)for(const e of n.getTracks())e.stop();for(const o of e??[])for(const e of o.getTracks())e.addEventListener("ended",(async()=>{if(o.getTracks().every((e=>"ended"===e.readyState))){"denied"===(await n(927648).Ay.checkPermissions(this.includeSystemAudio)).audio&&this.stop({triggerOnStop:!0,error:new(a().d1)("Audio permission denied")})}}));for(const o of e??[]){var t;const e=null==o||null===(t=o.getAudioTracks()[0])||void 0===t?void 0:t.getSettings();n(964576).A.setState(c().X8.state.find((t=>t.deviceId===(null==e?void 0:e.deviceId))))}this._mediaStreams=e,this._emitter.emit(d)}get mediaStreams(){return this._mediaStreams}getPreferredOrDefaultDevice(){var e;return(null===(e=c().X8.state)||void 0===e?void 0:e.find((e=>{var t;return e.deviceId===(null===(t=l().d.state)||void 0===t?void 0:t.deviceId)})))??c().X8.state[0]}async start(){if(void 0===this.startController||this.startController.signal.aborted){this.startController=new AbortController;const t=this.startController.signal;if(null===this.currentStreamId){this.currentStreamId=(0,n(206267).JW)().slice(-4);try{u.meetingNotesCache&&void 0!==this.saveAudioFileMetadata&&await u.meetingNotesCache.trimCache(9)}catch(e){i().log({level:"error",from:"audioRecorderHelpers",type:"trimCacheError",error:(0,r().convertErrorToLog)(e)})}}this.audioBuffer=[];const o=this.getPreferredOrDefaultDevice(),d=(0,s().E)(),p=await d.getUserMedia({audio:{deviceId:o?{exact:o.deviceId}:void 0,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,channelCount:1}});if(await c().Ay.updateMediaDevices(),this.includeSystemAudio){i().log({level:"info",from:"audioRecorderHelpers",type:"getDisplayMediaAttempt",data:{miscDataToConvertToString:{includeSystemAudio:this.includeSystemAudio}}});try{const e=await d.getDisplayMedia({audio:!0,systemAudio:this.includeSystemAudio?"include":void 0});this.mediaStreams=[p,e]}catch(e){if(i().log({level:"error",from:"audioRecorderHelpers",type:"getDisplayMediaFailed",error:(0,r().convertErrorToLog)(e),data:{miscDataToConvertToString:{includeSystemAudio:this.includeSystemAudio}}}),e instanceof Error&&"NotReadableError"===e.name)throw new(a().$W);throw new(a().Yh)}}else this.mediaStreams=[p];if(t.aborted){for(const e of this.mediaStreams??[])for(const t of e.getTracks())t.stop();return}if(await this.recorder.record(this.mediaStreams??[],(e=>{t.aborted||(void 0!==this.saveAudioFileMetadata&&(this.audioBuffer.push(...e),this.maybeWriteAudioBufferToOPFS({forceWrite:!1})),this.onDataReceived(e))}),this.sampleRate),t.aborted)return this.recorder.releaseMediaResources(),void(this.mediaStreams=void 0);l().d.addListener(this.handleDeviceChange),c().X8.addListener(this.handleDeviceChange)}}maybeWriteAudioBufferToOPFS(e){var t;const o=10*this.sampleRate;if(void 0!==this.saveAudioFileMetadata&&(e.forceWrite||this.audioBuffer.length>o)&&u.meetingNotesCache&&null!==(t=this.environment.currentUser)&&void 0!==t&&t.id&&this.currentStreamId){var a;const{blockStore:e}=this.saveAudioFileMetadata,t=e.id,o=null===(a=(0,n(540144).y1)(e,"transcript"))||void 0===a?void 0:a.id;if(void 0===o)return;u.meetingNotesCache.write((0,n(631616).G9)({userId:this.environment.currentUser.id,blockId:t,transcriptTabId:o,recordingId:this.currentStreamId,fileType:"PCM_F32_16000_MONO"}),new Float32Array(this.audioBuffer).buffer).catch((e=>{i().log({level:"error",from:"audioRecorderHelpers",type:"writeToOPFSFailed",error:(0,r().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:t}}})})),this.audioBuffer=[]}}stop(e){const{error:t,triggerOnStop:n=!0,triggerFlushToOPFS:o=!1}=e||{};if(void 0!==this.startController&&!this.startController.signal.aborted){var i;if(this.startController.abort(),this.recorder.releaseMediaResources(),this.mediaStreams=void 0,(n||o)&&this.maybeWriteAudioBufferToOPFS({forceWrite:!0}),n)this.currentStreamId=null,null===(i=this.onStop)||void 0===i||i.call(this,t);l().d.removeListener(this.handleDeviceChange),c().X8.removeListener(this.handleDeviceChange)}}destroy(e){l().d.removeListener(this.handleDeviceChange),c().X8.removeListener(this.handleDeviceChange),this.stop({triggerOnStop:!0,error:e})}}u.meetingNotesCache=(0,n(870991).bB)();class p{constructor(){this._audioWorkletNode=void 0,this._sourceNodes=void 0,this._audioContext=void 0}set sourceNodes(e){this._sourceNodes&&this._sourceNodes.forEach((e=>e.disconnect())),this._sourceNodes=e}set audioWorkletNode(e){this._audioWorkletNode&&this._audioWorkletNode.disconnect(),this._audioWorkletNode=e}set audioContext(e){this._audioContext&&this._audioContext.close(),this._audioContext=e}get audioContext(){return this._audioContext}async record(e,t,i){if(this.releaseMediaResources(),this.audioContext=(0,s().G)(i),Boolean(this.audioContext.audioWorklet))try{const r=new o(this.audioContext.sampleRate,i),a=this.audioContext,s=e.map((e=>a.createMediaStreamSource(e)));await this.audioContext.audioWorklet.addModule(new URL(n(986850),n.b));const c=new AudioWorkletNode(this.audioContext,"pcm-processor");c.port.onmessage=e=>{if(e.data){const n=e.data,o=r.downsample(n);t(o)}},s.forEach((e=>e.connect(c))),this._audioWorkletNode=c,this._sourceNodes=s}catch{console.info("unable to create worklet"),this.releaseMediaResources()}else this.releaseMediaResources()}releaseMediaResources(){this.sourceNodes=void 0,this.audioWorkletNode=void 0,this.audioContext=void 0}}},53528:(e,t,n)=>{n.d(t,{OH:()=>s,T2:()=>c,do:()=>l});var o=()=>n(597777),i=()=>n(869190),r=()=>n(604995),a=()=>n(416504);function s(e){const{dateTime:t,intl:n,shortenDateAndRange:o}=e,a=r().C6.toPersistedDate(t.valueOf());return i().ZF({value:a,allowRelativeDates:!0,intl:n,shortenDateAndRange:o,displayInUserTimezone:!0})}function c(e){const{dateTime:t,intl:n,userTimeZone:o,displayInUserTimezone:a,alwaysIncludeTimezone:s}=e,c=r().C6.toPersistedDateTime(t.valueOf(),t.zoneName);return i().ZF({value:c,allowRelativeDates:!0,intl:n,userTimeZone:o,displayInUserTimezone:a,alwaysIncludeTimezone:s})}function l(e){const{luxonRange:t,intl:n}=e,s=r().C6.toPersistedDateRange(t),c=i().ZF({value:s,allowRelativeDates:!1,shortenDateAndRange:!0,intl:n,displayInUserTimezone:!0}),l=t.end.setZone((0,a().P)()),d=i().fU({start_time:l.toFormat(o().GE),humanReadable:!1,intl:n});return n.formatMessage({id:"verification.timeRange",defaultMessage:"{formattedDateRange} at {formattedEndTime}"},{formattedDateRange:c,formattedEndTime:d})}},65767:(e,t,n)=>{n.d(t,{l:()=>i});n(296540);var o=n(474848);const i=(0,n(340498).wt)("closeThick",{viewBox:"0 0 8 8",svg:(0,o.jsx)("polygon",{points:"8 1.01818182 6.98181818 0 4 2.98181818 1.01818182 0 0 1.01818182 2.98181818 4 0 6.98181818 1.01818182 8 4 5.01818182 6.98181818 8 8 6.98181818 5.01818182 4"})})},73223:(e,t,n)=>{n.r(t),n.d(t,{checkIsTutorialDone:()=>g,dismissTutorial:()=>d,resetTutorials:()=>u,tutorialAdvanceToStep:()=>p,tutorialAdvanceToStepAfter:()=>m,tutorialGoToNextStep:()=>c,tutorialGoToPrevStep:()=>l,tutorialGoToStep:()=>v});var o=()=>n(541235),i=()=>n(231297),r=()=>n(755199),a=()=>n(739135),s=()=>n(765957);function c(e,t,n){var o;const{currentUserSettingsStore:i}=s().default.state;if(!i)return;const c=null===(o=i.getSettings())||void 0===o?void 0:o.tutorials;n?r().mJ({userSettingsStore:i,transaction:n,data:{tutorials:{...c,[t]:(0,a().i9)(i,t)}}}):f({userAction:"TutorialActions.nextStep",environment:e,perform:e=>{r().mJ({userSettingsStore:i,transaction:e,data:{tutorials:{...c,[t]:(0,a().i9)(i,t)}}})},userId:i.id})}function l(e,t){var n;const{currentUserSettingsStore:o}=s().default.state;if(!o)return;const i=null===(n=o.getSettings())||void 0===n?void 0:n.tutorials;f({userAction:"TutorialActions.prevStep",environment:e,perform:e=>{r().mJ({userSettingsStore:o,transaction:e,data:{tutorials:{...i,[t]:(0,a().KD)(o,t)}}})},userId:o.id})}function d(e,t){var n;const{currentUserSettingsStore:i}=s().default.state;if(!i)return;const a=null===(n=i.getSettings())||void 0===n?void 0:n.tutorials;(null==a?void 0:a[t])!==o().YD&&f({userAction:"TutorialActions.dismissTutorial",environment:e,perform:e=>{r().mJ({userSettingsStore:i,transaction:e,data:{tutorials:{...a,[t]:o().YD}}})},userId:i.id})}function u(e){const{currentUserSettingsStore:t}=s().default.state;t&&f({userAction:"TutorialActions.resetTutorialsDebug",environment:e,perform:e=>{r().mJ({userSettingsStore:t,transaction:e,data:{tutorials:{}}})},userId:t.id})}function p(e,t,n){var i;const{currentUserSettingsStore:c}=s().default.state;if(!c||(0,a().x$)(c,t))return;const l=(0,a().gt)(c,t);o().c$[t].steps.findIndex((e=>e.id===l))>=o().c$[t].steps.findIndex((e=>e.id===n))||r().mJ({userSettingsStore:c,transaction:e,data:{tutorials:{...null===(i=c.getSettings())||void 0===i?void 0:i.tutorials,[t]:n}}})}function m(e,t,n){if((0,a().ll)(n))return;const o=(0,a().tb)(t,n);o&&p(e,t,o)}function v(e,t,n,o){var i;const{currentUserSettingsStore:a}=s().default.state;if(!a)return;const c=null===(i=a.getSettings())||void 0===i?void 0:i.tutorials;o?r().mJ({userSettingsStore:a,transaction:o,data:{tutorials:{...c,[t]:n}}}):f({userAction:"TutorialActions.nextStep",environment:e,perform:e=>{r().mJ({userSettingsStore:a,transaction:e,data:{tutorials:{...c,[t]:n}}})},userId:a.id})}function g(e){const{currentUserSettingsStore:t}=s().default.state;return!!t&&(0,a().x$)(t,e)}function f(e){return i().createAndCommit({...e,canUndo:!1})}},74e3:(e,t,n)=>{n.d(t,{$:()=>r,u:()=>i});var o=()=>n(805952);function i(){return Object.entries(o().Cu)}function r(e){return o().Cu[e][1]}},77279:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});class o extends(()=>n(757695))().Store{getInitialState(){return{discussionIdToExpansionStartPointMap:{}}}}const i=new o},89849:(e,t,n)=>{n.r(t),n.d(t,{eyeIcon:()=>r,iconDefinition:()=>i});n(296540);var o=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"0.96 4.19 18.07 11.62",svg:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("path",{d:"M10.17 6.694a3.307 3.307 0 0 1 3.135 3.303l-.005.17a3.305 3.305 0 0 1-3.3 3.137l-.17-.004a3.307 3.307 0 0 1-3.132-3.133l-.004-.17A3.307 3.307 0 0 1 10 6.69zm-.17 2.2a1.104 1.104 0 0 0 0 2.207 1.103 1.103 0 0 0 0-2.207"}),(0,o.jsx)("path",{d:"M10 4.194c3.878 0 7.26 2.075 8.862 5.127l.073.163c.126.333.126.7 0 1.033l-.073.163c-1.602 3.052-4.984 5.126-8.862 5.126-3.757 0-7.049-1.946-8.707-4.843l-.156-.283a1.46 1.46 0 0 1 0-1.359l.156-.283C2.95 6.141 6.243 4.194 10 4.194m0 1.251c-3.33 0-6.196 1.724-7.622 4.214l-.134.243a.21.21 0 0 0 0 .197l.134.243c1.426 2.49 4.292 4.214 7.622 4.214 3.437 0 6.38-1.837 7.756-4.457l.018-.048a.2.2 0 0 0 0-.1l-.018-.049C16.38 7.282 13.437 5.445 10 5.445"})]})},r=(0,n(340498).wt)("eye",i)},97059:(e,t,n)=>{n.d(t,{s:()=>i});n(296540);const o={viewBox:"0 0 16 16",fittedViewBox:"1.82 1.82 12.68 12.68",svg:(0,n(474848).jsx)("path",{d:"M8 1.825a.575.575 0 0 0-.575.575V4a.575.575 0 0 0 1.15 0V2.4A.575.575 0 0 0 8 1.825m4.367 1.809a.575.575 0 0 0-.814 0l-1.131 1.131a.575.575 0 1 0 .813.813l1.132-1.131a.575.575 0 0 0 0-.813m-7.92 0a.575.575 0 0 0-.813.813l1.13 1.131a.575.575 0 1 0 .814-.813zm3.248 3.071a.7.7 0 1 0-.99.99l.77.77.99-.99zm4.305.72a.575.575 0 0 0 0 1.15h1.6a.575.575 0 1 0 0-1.15zm-9.6 0a.575.575 0 1 0 0 1.15H4a.575.575 0 0 0 0-1.15zm11.895 5.88-5.37-5.37-.99.99 5.37 5.37a.7.7 0 0 0 .99-.99m-8.717-2.883a.575.575 0 0 0-.813 0l-1.131 1.131a.575.575 0 1 0 .813.813l1.131-1.131a.575.575 0 0 0 0-.813M8 11.425a.575.575 0 0 0-.575.575v1.6a.575.575 0 1 0 1.15 0V12A.575.575 0 0 0 8 11.425"})},i=(0,n(340498).wt)("magicWandSmall",o)},99874:(e,t,n)=>{n.r(t),n.d(t,{createClient:()=>c,generateNewClientSessionId:()=>a,getCurrentClientSessionId:()=>s});n(814603),n(147566),n(198721);var o=()=>n(726637),i=()=>n(206267);let r=i().JW();function a(){r=i().JW()}function s(){return r}function c(e){let t=o().A.audioProcessor.url;const{maxReconnectDelayMs:i,minReconnectDelayMs:a,jwtToken:s}=e,c=new URLSearchParams({sessionId:r});s&&c.set("token",s);const l=`${t}?${c.toString()}`;return new(n(502681))(l,{reconnect:{max:i,min:a,"reconnect timeout":2500,retries:1e20},timeout:2500,credentials:!0,transport:{withCredentials:!0},transportOverrides:{transports:["websocket"]}})}},112799:(e,t,n)=>{n.d(t,{a:()=>c,E:()=>s});n(16280);var o=n(296540),i=()=>n(484714),r=(n(898992),n(672577),()=>n(427704));r().GJ.downloadMac,r().GJ.downloadMacUniversal,r().GJ.downloadMacIntel,r().GJ.downloadMacAppleSilicon,r().GJ.downloadWindows,r().GJ.downloadWindowsArm;const a=[{route:r().GJ.downloadMac,architecture:"universal",operatingSystem:"mac",target:"macUniversal"},{route:r().GJ.downloadMacIntel,architecture:"x86",operatingSystem:"mac",target:"mac"},{route:r().GJ.downloadMacUniversal,architecture:"universal",operatingSystem:"mac",target:"macUniversal"},{route:r().GJ.downloadMacAppleSilicon,architecture:"arm",operatingSystem:"mac",target:"macArm64"},{route:r().GJ.downloadWindows,architecture:"x86",operatingSystem:"windows",target:"windows"},{route:r().GJ.downloadWindowsArm,architecture:"arm",operatingSystem:"windows",target:"windowsArm64"}];function s(){const e=(0,o.useRef)(null),t=(0,i().Y0)();return(0,o.useEffect)((()=>{c(t).then((t=>{e.current=t??null})).catch((e=>{throw new Error(e)}))}),[t]),e}async function c(e){var t;if(!("userAgentData"in navigator))return e.isMac?r().GJ.downloadMacUniversal:r().GJ.downloadWindows;const n=navigator.userAgentData,o=await(null==n||null===(t=n.getHighEntropyValues)||void 0===t?void 0:t.call(n,["architecture"])),i=function(e,t){const n=function(e=""){const t=e.toLowerCase();return t.startsWith("arm")?"arm":t.startsWith("x86")||"intel"===t?"x86":null}(e);if(!n||"mac"!==t&&"windows"!==t)return null;const o=a.find((e=>e.architecture===n&&e.operatingSystem===t));return(null==o?void 0:o.route)||null}(null==o?void 0:o.architecture,e.os);return i||null}},135428:(e,t,n)=>{n.d(t,{Vj:()=>s,ax:()=>c,iI:()=>l,iw:()=>a,u3:()=>r,uJ:()=>d});n(898992),n(354520),n(581454),n(737550);var o=()=>n(906745),i=()=>n(604995);const r="–",a=" ";function s({start:e,end:t,locale:n,timeZone:i}){const s=o().c9.fromISO(e),l=o().c9.fromISO(t),d=function({start:e,end:t}){const n=t.diff(e);if(n.as("hours")>12)return!0;const o=e.hour<12,i=t.hour<12;return o!==i}({start:s,end:l}),u=c({time:s,showAmPm:d,locale:n,timeZone:i}),p=c({time:l,showAmPm:!0,locale:n,timeZone:i});return`${u}${a}${r}${a}${p}`}function c({time:e,showAmPm:t,locale:n,timeZone:r}){const s=l(n),c=0!==e.minute||!s,d={...o().c9.TIME_SIMPLE,hour:"numeric",minute:c?"2-digit":void 0,timeZone:(0,i().lW)(r)};return s&&!t?e.setLocale(n).toLocaleParts(d).filter((e=>"dayPeriod"!==e.type)).map((e=>e.value.trim())).join(""):e.toLocaleString({...d,hour12:s},{locale:n}).replace(" ",a)}const l=(0,n(496603).Bj)((function(e){return o().c9.fromObject({hour:13}).setLocale(e).toLocaleParts(o().c9.TIME_SIMPLE).some((e=>"dayPeriod"===e.type))}));function d({time:e,locale:t,timeZone:n}){const r=l(t);return e.toLocaleString({...o().c9.DATETIME_MED,hour:"numeric",minute:"2-digit",year:void 0,month:void 0,day:void 0,timeZone:(0,i().lW)(n),hour12:r},{locale:t}).replaceAll(" ",a)}},155089:(e,t,n)=>{n.d(t,{C:()=>v});n(296540);var o=()=>n(56366),i=()=>n(401497),r=()=>n(251481),a=()=>n(69708),s=()=>n(284371),c=()=>n(11048),l=()=>n(712855),d=()=>n(792540),u=()=>n(353890),p=n(474848);const m=Object.freeze({property:!0});function v(e){const{disabled:t=!1,id:n,onClick:v,title:g,style:f}=e,{store:h}=(0,u().s)(),S=(0,a().tz)(),y=(0,o().K8)((()=>h.getBlockTitleStore()),[h]),b=(0,i().IS)((e=>({title:{margin:0,fontSize:22,fontWeight:s().Wy.semibold,lineHeight:"1.4",color:e.text.primary,cursor:"text",...f}})),[f]);return g?(0,p.jsx)(c().A,{name:"TranscriptionBlockHeading",children:(0,p.jsx)("div",{style:b.title,children:g})}):(0,p.jsx)(c().A,{name:"TranscriptionBlockHeading",children:(0,p.jsx)(l().A,{id:n,tagName:"h2",style:b.title,store:y,inPageFind:d().Os.block_match,placeholder:S.formatMessage(r().i.placeholder),onClick:v,disabled:t,disableEnter:!0,disableSlashCommands:!0,pasteBehavior:"inline",disabledMentionTypes:m})})}},173783:(e,t,n)=>{n.d(t,{A:()=>a});n(296540);var o=()=>n(658985),i=()=>n(903047),r=n(474848);function a(e){const t=(0,i().E)(e),n=(0,o().$)(t.icon);return(0,r.jsx)("div",{style:t.iconContainer,children:n})}},175882:(e,t,n)=>{n.r(t),n.d(t,{exclamationMarkTriangleSmallIcon:()=>r,iconDefinition:()=>i});n(296540);var o=n(474848);const i={viewBox:"0 0 16 16",fittedViewBox:"1.49 1.87 13.01 11.75",svg:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("path",{d:"M7.9 5.281a.625.625 0 0 0-.625.625v2.5a.625.625 0 0 0 1.25 0v-2.5a.625.625 0 0 0-.625-.625m0 4.7a.725.725 0 1 0 0 1.45.725.725 0 0 0 0-1.45"}),(0,o.jsx)("path",{d:"M9.58 2.788c-.702-1.217-2.458-1.217-3.16 0l-4.677 8.1c-.702 1.216.176 2.737 1.58 2.737h9.354c1.405 0 2.283-1.52 1.58-2.738zm-2.078.625a.575.575 0 0 1 .996 0l4.677 8.1a.575.575 0 0 1-.498.862H3.324a.575.575 0 0 1-.498-.863z"})]})},r=(0,n(340498).wt)("exclamationMarkTriangleSmall",i)},176412:(e,t,n)=>{n.d(t,{L:()=>i});n(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"0.97 2.72 18.06 14.56",svg:(0,n(474848).jsx)("path",{d:"M3.893 2.875a.626.626 0 0 1 .79-.02l.091.088.128.148.015.033.072.105 11.27 13.148a.623.623 0 0 1-1.033.68l-1.616-1.884c-1.12.408-2.338.633-3.61.633-3.757 0-7.049-1.946-8.707-4.843l-.155-.283a1.46 1.46 0 0 1 0-1.359l.155-.283c.89-1.554 2.25-2.834 3.898-3.687L3.825 3.757l-.072-.105a.626.626 0 0 1 .14-.777M7.41 7.941a3.3 3.3 0 0 0-.717 2.056l.004.17A3.307 3.307 0 0 0 9.83 13.3l.17.004c.595 0 1.151-.161 1.634-.437l-1.52-1.773a1.104 1.104 0 0 1-1.18-1.377zM10 4.194c3.878 0 7.26 2.075 8.862 5.127l.074.164c.125.332.125.7 0 1.032l-.074.163a9.3 9.3 0 0 1-2.987 3.327l-2.69-3.138a3.3 3.3 0 0 0 .116-.702l.005-.17a3.31 3.31 0 0 0-3.136-3.303L10 6.691a3 3 0 0 0-.377.022L7.682 4.447A10.7 10.7 0 0 1 10 4.194"})},i=(0,n(340498).wt)("eyeSlashFill",o)},195260:(e,t,n)=>{n.d(t,{G:()=>l});n(581454);var o=()=>n(56366),i=()=>n(928074),r=()=>n(68263),a=()=>n(329443);function s(e){const{userId:t,store:n,hasInaccessiblePermissions:o}=e,i=(0,a().zt)({userId:t,store:n}).role;return i&&(0,r().PW)(i)&&"none"!==i?i:o?void 0:"none"}var c=()=>n(353890);function l(e){const{store:t}=(0,c().s)(),n=(0,o().K8)((()=>!(0,i().Aj)({store:t})),[t]);return(0,o().K8)((()=>Object.fromEntries(e.map((e=>[e,s({userId:e,store:t,hasInaccessiblePermissions:n})])))),[t,e,n])}},219348:(e,t,n)=>{n.d(t,{DV:()=>h,EQ:()=>v,Mu:()=>g,Nr:()=>f,cP:()=>u,m0:()=>m,m2:()=>d,s8:()=>p});n(898992),n(354520),n(672577);var o=()=>n(242422),i=()=>n(56366),r=()=>n(84520),a=()=>n(821062),s=()=>n(72234),c=()=>n(231297),l=()=>n(765957);const d={"baseball-cap":"permanent",bow:"permanent",cat:"permanent",cherry:"permanent",cowboy:"permanent",crown:"permanent",duck:"permanent",firefighter:"permanent",flower:"permanent",glasses:"permanent",headphone:"permanent",leaf:"permanent",magician:"permanent",mustache:"permanent",paprika:"permanent",pencil:"permanent",propeller:"permanent","safety-hat":"permanent",scarf:"permanent","seasonal-bat":"october25","seasonal-demon":"october25","seasonal-frankenstein":"october25","seasonal-pumpkin":"october25"};function u(e){const{store:t,from:n}=e;if(t.update((e=>({...e,isOpen:!0,openCount:e.openCount+1,from:n||"unknown"}))),e.shouldSetSeenPersonalizationSettingsModal){const{sidebarSpaceViewStore:t}=l().default.state;t&&c().createAndCommit({environment:e.environment,userAction:"AgentPersonalizationSettings.markSeen",canUndo:!1,perform:e=>{const n=t.getSettings()||{},o={...n,agent_personalization_settings:{...n.agent_personalization_settings||{},has_already_seen_personalization_settings_modal:!0}};s().AG(t,e,o)}})}}function p(e){const{store:t}=e;t.update((e=>({...e,isOpen:!1})))}function m(e){const{store:t}=e;return t.state.isOpen}function v(e){const{store:t}=e;return t.state.from||"unknown"}function g(e){var t;const{environment:n,agentName:o,customizationItems:i,newPageIdToAdd:r,contextPageId:d}=e,{sidebarSpaceViewStore:u}=l().default.state;if(!u)return;const p=null===(t=u.getSettings())||void 0===t?void 0:t.agent_personalization_settings;let m=(null==p?void 0:p.recently_used_pages)||[];r&&(m=m.filter((e=>e.page_id!==r)),m.unshift({page_id:r,used_at:Date.now()}),m=m.slice(0,10));const v={name:o,customization_items:i,context_page_id:d,recently_used_pages:m.length>0?m:void 0,has_already_seen_personalization_settings_modal:(null==p?void 0:p.has_already_seen_personalization_settings_modal)||!0};(0,a().A)(v,p)||c().createAndCommit({environment:n,userAction:"AgentPersonalizationSettings.save",canUndo:!0,perform:e=>{const t=u.getSettings()||{},n={...t,agent_personalization_settings:{...t.agent_personalization_settings||{},...v}};s().AG(u,e,n)}})}function f(){return(0,i().K8)((()=>{const e=o().default.getConfigKey("agent_seasonal_accessories","batch"),t=o().default.getConfigKey("agent_seasonal_accessories","batch_expiration_time"),n=t&&new Date(t)<new Date;return r().sy.filter((t=>{const o=d[t];return"permanent"===o||o===e&&!n}))}),[])}function h(e){const t=f();return(0,i().K8)((()=>{var n,i;const a=null==e||null===(n=e.getSettings())||void 0===n?void 0:n.agent_personalization_settings;if(null!=a&&null!==(i=a.customization_items)&&void 0!==i&&i[0]){const e=a.customization_items[0];if(t.includes(e))return e}const s=o().default.getEligibleGroup({experimentId:"nosy_default_accessory"}),c=(null==a?void 0:a.has_already_seen_personalization_settings_modal)??!1;if(s&&"control"!==s&&!c){const e=r().sy.find((e=>e===s));if(e)return e}}),[e,t])}},233124:(e,t,n)=>{n.d(t,{D_:()=>s,E_:()=>a,Im:()=>c,K_:()=>d,rP:()=>l,uB:()=>r});var o=()=>n(314529),i=()=>n(564884);function r(e,t){e&&(0,o().DO_NOT_USE_trackLegacy)(e,"dictation_modal_open",t)}function a(e,t){e&&(0,o().DO_NOT_USE_trackLegacy)(e,"dictation_modal_close",t)}function s(e,t){e&&(0,i().u)({environment:e,event:{eventName:"dictation_start",eventProperties:t}})}function c(e,t){e&&(0,o().DO_NOT_USE_trackLegacy)(e,"dictation_end",t)}function l(e,t){e&&(0,o().DO_NOT_USE_trackLegacy)(e,"dictation_error",t)}function d(e,t){e&&(0,o().DO_NOT_USE_trackLegacy)(e,"update_dictation_language",t)}},262089:(e,t,n)=>{n.d(t,{ys:()=>j,zz:()=>D,YE:()=>N,ZQ:()=>E,bH:()=>B,Ux:()=>C,gA:()=>R,L6:()=>M,$I:()=>O,Ep:()=>_e,UJ:()=>Q,UC:()=>ve,$g:()=>he,rJ:()=>Se,sN:()=>ye,A7:()=>se,lW:()=>ge});n(16280);var o=()=>n(242422),i=()=>n(726637),r=()=>n(165358),a=()=>n(416845),s=()=>n(206267),c=()=>n(220719),l=()=>n(229833),d=()=>n(745875),u=()=>n(763824),p=()=>n(532313),m=()=>n(720665),v=()=>n(671593),g=()=>n(559506),f=()=>n(881383),h=()=>n(909557),S=()=>n(165121),y=()=>n(765957);const b=!1;var k=()=>n(314529),A=()=>n(908006);function T(e,t){A().default.afterNextFlush((()=>{o().default.checkGate({gateName:"audio_processor_client_send_request_metric_enabled"})&&(0,k().DO_NOT_USE_trackLegacy)(e,"audio_processor.client.send_request",t)}))}var _=()=>n(99874),x=()=>n(638681);const w=x().union([x().object({required:{audioDuration:x().number(),id:x().string(),status:x().literal("complete"),text:x().string()},optional:{}}),x().object({required:{audioDuration:x().number(),id:x().string(),reason:x().string(),status:x().literal("error")},optional:{}}),x().object({required:{audioDuration:x().number(),id:x().string(),status:x().literal("ignore")},optional:{}}),x().object({required:{audioDuration:x().number(),id:x().string(),status:x().literal("pending")},optional:{}})]),I=x().union([x().object({required:{settings:x().object({required:{max_block_char_size:x().number(),transcription_model:x().literals("baseten_diarization","fireworks_diarization","no_diarization","openai_diarization")},optional:{}}),type:x().literal("audio_writer_settings")},optional:{}}),x().object({required:{message:x().string(),name:x().literal("ForbiddenError"),status:x().literal(403),type:x().literal("forbidden")},optional:{}}),x().object({required:{currentS:x().number(),limitS:x().number(),type:x().literal("free_trial_limit_update")},optional:{}}),x().object({required:{message:x().string(),type:x().literal("openai_error")},optional:{status:x().number()}}),x().object({required:{requestId:x().string(),result:x().unknown(),status:x().literals("error","ok"),type:x().literal("response")},optional:{}}),x().object({required:{audioSessionId:x().string(),isAudioSessionComplete:x().boolean(),isSegmentComplete:x().boolean(),segmentId:x().string(),transcription:x().lazy((()=>w)),type:x().literal("transcription")},optional:{segmentSortkey:x().number(),speakerName:x().string()}}),x().object({required:{message:x().string(),name:x().literal("UpgradeRequiredError"),status:x().literal(403),type:x().literal("upgrade_required")},optional:{}}),x().object({required:{message:x().string(),name:x().literal("UserRateLimitResponse"),retryAfterSec:x().union([x().isUndefined(),x().number()]),status:x().literal(429),type:x().literal("rate_limited")},optional:{}}),x().object({required:{talking:x().boolean(),type:x().literal("vad")},optional:{}})]),C="transcription",M="vad",B="rate_limited",D="forbidden",E="openai_error",R="upgrade_required",N="free_trial_info",j="audio_writer_settings",P={OPENING:1,CLOSED:2,OPEN:3},O=(0,n(827380).A)(),z={primusV8:async()=>Promise.all([n.e(2681),n.e(36733)]).then(n.bind(n,99874))},L=!1,F=90*m().TD;function U(e){return{_id:e,charactersSent:0,requestsSent:0,requestsTimedOut:0,responsesReceivedWithoutHandlers:0,successfulResponsesReceived:0,unsuccessfulResponsesReceived:0,invalidMessagesReceived:0,notificationsReceived:0,messagesReceived:0}}const W=new(n(999752).O)(20),V=new Map,q="audioProcessorInternals",H=new(r().BatchedLogger)({from:q,team:"no-team-specified",type:"BulkDebug",level:"info",maxLength:250,logToConsole:L});let K,$,G=U(0),Y=0,Z=n(882362).u,J=!1,X="uninitialized";function Q(){return"open"===X}const ee=!0;function te(e){H.log({level:"info",team:"editor",from:q,type:e})}function ne(e,t="info",n){r().log({level:t,from:q,team:"editor",type:`primusClient${e}`,data:{miscDataToConvertToString:{sessionId:(0,_().getCurrentClientSessionId)(),...n}}})}function oe(){K=function(e){var t;const n=null==e||null===(t=e.socket)||void 0===t||null===(t=t.transport)||void 0===t||null===(t=t.query)||void 0===t?void 0:t.transport;if("websocket"===n||"polling"===n)return n}(this),te(`ping:${K}`),Ie(`Incoming primus ping received from server via ${K}.`)}function ie(e){switch(H.log({level:"info",team:"editor",from:q,type:"readyStateChange",data:{message:e}}),e){case"end":X="closed";break;case"open":X="open";break;case"opening":X="opening"}}async function re(e){if($){if($&&!ce({connectionState:X,primusClient:$}))return ae(e);if($)return $}try{return $=await le(e),$}catch(t){throw $=void 0,X="failed_to_create",r().log({level:"error",from:q,team:"editor",type:"primusClientCreationFailed",error:(0,l().convertErrorToLog)(t),data:{miscDataToConvertToString:{sessionId:(0,_().getCurrentClientSessionId)()}}}),t}}async function ae(e){try{var t;return X="creating",null===(t=$)||void 0===t||t.destroy(),$=void 0,$=await le(e),$}catch(n){throw $=void 0,X="failed_to_create",r().log({level:"error",from:q,team:"editor",type:"primusClientRecreationFailed",error:(0,l().convertErrorToLog)(n),data:{miscDataToConvertToString:{sessionId:(0,_().getCurrentClientSessionId)(),connectionState:X}}}),n}}async function se(e){return $&&_e(e),re(e)}function ce(e){const{connectionState:t,primusClient:n}=e;return("open"!==t||n.readyState!==P.CLOSED)&&"failed_to_create"!==t||(ne("NotHealthy","info",{connectionState:t,clientReadyState:n.readyState}),!1)}async function le(e){if(b)throw new Error("AudioProcessor is disabled");X="creating";const{createClient:t}=await z.primusV8();let n;if(o().default.checkGate({gateName:"audio_processor_auth_client_fetch_jwt_enabled"}))try{n=await p().L5({fn:async()=>{const t=await g().callApi({eventName:"getAudioProcessorAuthToken",environment:e,data:{}});if("success"===t.type)return t.data.accessToken;throw t.error},handleError:(e,t,n)=>{n>0&&r().log({level:"info",from:q,team:"editor",type:"audioProcessorAuthTokenRetry",data:{miscDataToConvertToString:{retryCount:n,isLastAttempt:t,sessionId:(0,_().getCurrentClientSessionId)(),errorMessage:e instanceof Error?e.message:"Unknown error"}}});return(0,a().US)(e)&&!e.retryable||t?{status:"throw",error:e}:{status:"retry"}},retryAttemptsMS:[500,1e3,2e3],retryAttemptRandomOffsetMS:200,initialInput:void 0})}catch(c){throw r().log({level:"error",from:q,team:"editor",type:"failedToGetAudioProcessorToken",error:(0,l().convertErrorToLog)(c),data:{miscDataToConvertToString:{sessionId:(0,_().getCurrentClientSessionId)()}}}),new Error(`Failed to get audio processor auth token after retries: ${c instanceof Error?c.message:"Unknown error"}`)}const i=t({minReconnectDelayMs:.5*m().TD,maxReconnectDelayMs:2*m().TD,jwtToken:n});i.on("data",ke);const s=new Promise(((e,t)=>{let n=!1;i.on("open",(()=>{n||(n=!0,S().A.setState("connected"),te("open"),ne("Open"),G=U(G._id+1),me=0,L&&function(){const e=Date.now(),t=20;function n(){const o={...W.getStats()};if(0===o.queue&&0===o.running)return Ie(`Queues emptied after ${Date.now()-e} ms`),void(de=void 0);de=window.setTimeout(n,t)}de&&window.clearTimeout(de),Ie("Starting measurement of time until send queues are empty."),n()}(),e(i))})),i.on("error",(e=>{if(!n){let o;n=!0,S().A.setState("disconnected"),o="TransportError"===e.type?{level:"info",from:q,team:"no-team-specified",type:"primusTransportError",error:(0,l().convertErrorToLog)(e)}:{level:"error",from:q,team:"no-team-specified",type:"unknownPrimusError",error:(0,l().convertErrorToLog)(e)};(0,d().rQ)(1)&&r().log(o),H.log(o),t(new Error(`Primus connection error: ${e.message||e}`))}})),i.on("timeout",(()=>{n||(n=!0,S().A.setState("disconnected"),te("timeout"),ne("Timeout"),t(new Error("Primus connection timeout")))}))}));i.on("reconnected",(e=>{X="open",S().A.setState("connected"),function(e){e&&e>1e4?fe():J=!1;r().log({level:"info",team:"editor",from:q,type:"onConnectionReconnected",data:{miscDataToConvertToString:{sessionId:(0,_().getCurrentClientSessionId)()}}})}(null==e?void 0:e.duration),H.log({level:"info",team:"editor",from:q,type:"reconnected",data:{message:`Reconnected in ${null==e?void 0:e.duration} ms`}})})),i.on("reconnect",(()=>{S().A.setState("disconnected"),te("reconnect"),ne("Reconnect")})),i.on("reconnect scheduled",(e=>{(void 0===(null==e?void 0:e.attempt)||void 0===(null==e?void 0:e.duration)||e.attempt>2||e.duration>5e3||void 0===S().A.state)&&S().A.setState("disconnected"),H.log({level:"info",team:"editor",from:q,type:"reconnect scheduled",data:{message:`Reconnecting in ${null==e?void 0:e.scheduled} ms, attempt ${null==e?void 0:e.attempt} of ${null==e?void 0:e.retries}`}})})),i.on("reconnect timeout",(()=>{S().A.setState("disconnected"),te("reconnect timeout"),ne("ReconnectTimeout")})),i.on("reconnect failed",(()=>{X="closed",S().A.setState("disconnected"),te("reconnect failed"),ne("ReconnectFailed")})),i.on("destroy",(()=>{X="closed",te("destroy"),ne("Destroy")})),i.on("close",(()=>{X="closed",S().A.setState("disconnected"),te("close"),ne("Close")})),i.on("online",(()=>{te("online"),ne("Online")})),i.on("offline",(()=>{X="closed",S().A.setState("disconnected"),te("offline"),ne("Offline")})),i.on("incoming::ping",oe),i.on("readyStateChange",ie),i.on("end",(()=>{X="closed",S().A.setState("disconnected"),te("end"),i.off("readyStateChange",ie),Te(i,e),r().log({level:"info",from:q,team:"editor",type:"connectionEnded",data:{miscDataToConvertToString:{sessionId:(0,_().getCurrentClientSessionId)()}}})})),window.__primusClient_audioProcessor=i;return u().V1(s,1e4,{customError:()=>new we(1e4)}).catch((e=>{throw e instanceof we&&s.then((e=>{e.end()})).catch((e=>{})),e}))}let de,ue,pe,me=0;function ve(e){if(pe)throw new Error("Having more than one onRestartAudioProcessorConnectionHandler is not currently supported");pe=e}function ge(){pe=void 0}function fe(){var e;J=!1,W.cancel(),function(){for(const e of V.values())window.clearTimeout(e.timeout),e.reject(new Error("Cancelled pending requests"));V.clear()}(),null===(e=pe)||void 0===e||e()}async function he(e){var t,n;const{base64Audio:o,environment:i,language:r,onRequestSent:a}=e,s=null===(t=y().default.state.currentUserStore)||void 0===t?void 0:t.id,c=null===(n=y().default.state.sidebarSpaceStore)||void 0===n?void 0:n.id;var l;if(s&&c)return null===(l=be({method:"audioData",request:{base64Audio:o,language:r,userId:s,spaceId:c},environment:i,onRequestSent:a}))||void 0===l?void 0:l.response;{const e=s||c?s?"Space":"User":"Both";throw(0,f().stopDictation)({environment:i,error:new(h().eY)(e),from:"missing_user_or_space"}),new Error("missing_user_or_space")}}function Se(e){var t;const{environment:n,rootBlockId:o}=e,i=null===(t=y().default.state.sidebarSpaceStore)||void 0===t?void 0:t.id;be({method:"transcriptionInfo",request:{rootBlockId:o,spaceId:(0,c().o9)(i)},environment:n})}function ye(e){const{environment:t,setting_type:n,model:o,rootBlockId:i,disableToast:r}=e}function be(e){if(b)return;const{method:t,request:n,environment:a}=e;T(a,{status:"enqueued",endpoint:t});const c=W.enqueue((()=>{const c=s().JW();!function(e,t){A().default.afterNextFlush((()=>{o().default.checkGate({gateName:"audio_processor_client_send_request_metric_enabled"})&&((0,k().DO_NOT_USE_trackLegacy)(e,"audio_processor.client.send_request.queue_running_size",{value:t.running}),(0,k().DO_NOT_USE_trackLegacy)(e,"audio_processor.client.send_request.queue_backup_size",{value:t.queue}))}))}(a,W.getStats());const d=u().yX(),p=Date.now(),m=ee?window.setTimeout((()=>{"open"===X&&(G.requestsTimedOut+=1,H.log({level:"info",team:"editor",from:q,type:"requestTimeout",data:{requestId:c,time:Date.now()-p}}))}),F):void 0;V.set(c,{resolve:d.resolve,reject:d.reject,timeout:m,sendTime:p}),H.log({level:"info",team:"editor",from:q,type:"requestSent",data:{requestId:c,method:t}});const v={type:`${i().A.audioProcessor.api}/${t}`,requestId:c,...n};G.requestsSent+=1,"open"!==X&&r().rateLimitedLog({level:"warning",from:q,team:"editor",type:"attemptedToWriteToWebsocketWhenNotOpen",data:{miscDataToConvertToString:{requestId:c,userId:a.currentUser.id,connectionState:X,sessionId:(0,_().getCurrentClientSessionId)()}}}),async function(e){const{message:t,environment:n,onRequestSent:o}=e,i=JSON.stringify(t);G.charactersSent+=i.length,Y<i.length&&(Y=i.length);const a=await async function(e){if($)return ce({connectionState:X,primusClient:$})?$:re(e)}(n);a?(a.write(t),null==o||o()):("open"===X?(X="creating",ae(n).catch((e=>{}))):"closed"!==X&&"failed_to_create"!==X||ue||(X="creating",ae(n).catch((e=>{})),r().rateLimitedLog({level:"warning",from:q,team:"editor",type:"clientClosedWhenWriteToSocket",data:{miscDataToConvertToString:{connectionState:X,sessionId:(0,_().getCurrentClientSessionId)(),scheduledToReconnect:Boolean(ue)}}})),r().rateLimitedLog({level:"warning",from:q,team:"editor",type:"noClientWhenWriteToSocket",data:{miscDataToConvertToString:{connectionState:X,sessionId:(0,_().getCurrentClientSessionId)(),scheduledToReconnect:Boolean(ue)}}}))}({message:v,environment:a,onRequestSent:e.onRequestSent}).catch((e=>{H.log({level:"error",team:"editor",from:q,type:"socketWriteError",error:e}),r().log({level:"error",from:q,team:"editor",type:"failedToWriteToSocket",error:(0,l().convertErrorToLog)(e),data:{miscDataToConvertToString:{sessionId:(0,_().getCurrentClientSessionId)()}}})})),d.promise.then((e=>{T(a,{status:"success",endpoint:t})})).catch((e=>{const n=W.getStats();T(a,{status:"failure",endpoint:t,queue_running_size:n.running,queue_backup_size:n.queue})}));const g=u().nQ(1e3,d.promise).then((({timeout:e,result:n})=>{if(e){const e=W.getStats();return T(a,{status:"failure",endpoint:t,queue_running_size:e.running,queue_backup_size:e.queue,queue_timeout:!0}),r().rateLimitedLog({level:"error",from:"audioProcessorInternals",team:"editor",type:"requestTimeout",error:(0,l().convertErrorToLog)(new Error("Request timed out")),data:{miscDataToConvertToString:{requestId:c,method:t,sessionId:(0,_().getCurrentClientSessionId)()}}}),{result:"timeout"}}return n}));return g}));return{response:c.catch((e=>{e instanceof xe&&!J?(J=!0,te("connectionResetDueToFailedRequest"),_e(a),Ie(`sendRequest() for ${t} returned server error (${e.message}), resetting connection`,n)):Ie(`sendRequest() cancelled or errored for ${t} (${e.message})`,n)})),asyncQueuePromise:c}}function ke(e){G.messagesReceived+=1;const t=(0,v().tf)(I,e);if(t)return G.invalidMessagesReceived+=1,void r().log({level:"warning",team:"editor",from:q,type:"ValidationError",data:{miscDataToConvertToString:{...e,sessionId:(0,_().getCurrentClientSessionId)()}},error:(0,l().convertErrorToLog)(t)});const n=e;switch(n.type){case"response":{const{requestId:e,status:t,result:o}=n,i=V.get(e);let a;if(V.delete(e),n.result&&"object"==typeof n.result&&"internalProcessingTimeMs"in n.result&&"number"==typeof n.result.internalProcessingTimeMs&&(a=n.result.internalProcessingTimeMs),H.log({level:"info",team:"editor",from:q,type:"responseReceived",data:{requestId:e,response:t,time:i&&Date.now()-i.sendTime,internalProcessingTimeMs:a}}),!i)return void(G.responsesReceivedWithoutHandlers+=1);window.clearTimeout(i.timeout),"ok"===t?(G.successfulResponsesReceived+=1,i.resolve(o)):(r().log({level:"error",from:q,team:"editor",type:"unsuccessfulAudioProcessorRequestError",data:{miscDataToConvertToString:{status:t,result:o,sessionId:(0,_().getCurrentClientSessionId)()}}}),G.unsuccessfulResponsesReceived+=1,i.reject(new xe(o)));break}case"transcription":O.emit(C,n);break;case"vad":O.emit(M,n);break;case"rate_limited":O.emit(B,n);break;case"forbidden":O.emit(D,n);break;case"upgrade_required":O.emit(R,n);break;case"free_trial_limit_update":O.emit(N,n);break;case"openai_error":O.emit(E,n);break;case"audio_writer_settings":O.emit(j,n)}}function Ae(e){void 0!==ue&&clearTimeout(ue),me++;const t=2*m().TD+3*Math.random()*m().TD;me%10==0&&r().log({level:"info",from:q,team:"editor",type:"reconnectAttemptCount",data:{miscDataToConvertToString:{reconnectAttemptCount:me,sessionId:(0,_().getCurrentClientSessionId)()}}}),ue=Z.setTimeout((()=>{ue=void 0,re(e).then((e=>{var n;r().log({level:"info",from:q,team:"editor",type:"recreatePrimusClientSuccess",data:{miscDataToConvertToString:{socketReconnect:`SocketId: ${null==e||null===(n=e.socket)||void 0===n?void 0:n.id}`,reconnectAttemptCount:me,delayMs:t,sessionId:(0,_().getCurrentClientSessionId)()}}}),me=0})).catch((n=>{r().log({level:"error",from:q,team:"editor",type:"recreatePrimusClientFailure",error:n,data:{miscDataToConvertToString:{reconnectAttemptCount:me,delayMs:t,sessionId:(0,_().getCurrentClientSessionId)()}}}),Ae(e)}))}),t)}function Te(e,t,n=!0){var o;r().log({level:"info",from:q,team:"editor",type:"audioProcessorEnd",data:{miscDataToConvertToString:{socketReconnect:`SocketId: ${null==e||null===(o=e.socket)||void 0===o?void 0:o.id}`,createNewConnection:n,sessionId:(0,_().getCurrentClientSessionId)()}}}),Z.setTimeout((()=>{void 0!==e&&e.destroy()}),0),$=void 0,fe(),n&&Ae(t)}function _e(e){if(void 0!==ue&&(clearTimeout(ue),ue=void 0),$){const t={type:`${i().A.audioProcessor.api}/destroySession`,requestId:s().JW()};$.write(t),$.removeAllListeners("end"),Te($,e,!1),(0,_().generateNewClientSessionId)()}}class xe extends Error{constructor(e){super(e),this.name="FailedAudioProcessorRequestError"}}class we extends Error{constructor(e){super(`Primus connection timeout after ${e}ms`),this.name="PrimusConnectionTimeoutError"}}function Ie(...e){L&&console.info("audioProcessorInternals:",...e)}},265665:(e,t,n)=>{n.d(t,{j:()=>l});var o=n(296540),i=()=>n(484714),r=()=>n(401497),a=()=>n(284371),s=()=>n(859428);var c=n(474848);function l({children:e,style:t,tooltipStyle:n,placement:l="bottom"}){const{isSafari:d}=(0,i().Y0)(),u=(0,o.useRef)(null),p=function(e){const[t,n]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{const{current:t}=e;if(!t)return void n(!1);const o="ResizeObserver"in window?new ResizeObserver((([e])=>{n(e.target.scrollWidth>e.target.clientWidth)})):void 0;return null==o||o.observe(t),()=>null==o?void 0:o.unobserve(t)}),[]),t}(u),m=(0,r().IS)((()=>({overflowText:{...a().RC,...t}})),[t]);return(0,c.jsx)(s().A,{delayThreshold:500,placement:l,textWrap:!0,style:n,forceVisibleState:!(d||!p)&&void 0,renderTooltip:()=>p?e:void 0,render:t=>(0,c.jsx)("div",{ref:u,style:m.overflowText,...t,children:e})})}},271380:(e,t,n)=>{n.r(t),n.d(t,{checkCanStartTranscription:()=>W,ensureTranscriptionIsInActive:()=>H,insertEmptyText:()=>X,pauseTranscription:()=>K,runSummarization:()=>G,setTranscriptionStateAndTrack:()=>Z,startTranscription:()=>V,stopTranscription:()=>q,updatePreferredSummarizationFormat:()=>Y,updateTranscriptionModel:()=>J});var o=()=>n(564884),i=()=>n(584262),r=()=>n(700500),a=()=>n(416845),s=()=>n(388821),c=()=>n(155792),l=()=>n(798880),d=()=>n(763824),u=()=>n(498212),p=()=>n(534177),m=()=>n(896628),v=()=>n(722101),g=()=>n(384944),f=()=>n(666144),h=()=>n(778417),S=()=>n(471995),y=()=>n(903864),b=()=>n(812182),k=()=>n(231297),A=()=>n(107527),T=()=>n(348869),_=()=>n(595345),x=()=>n(807700),w=()=>n(492414),I=()=>n(594794),C=()=>n(972435),M=()=>n(300789),B=()=>n(999544),D=()=>n(765957),E=()=>n(909557),R=()=>n(52447),N=()=>n(540144),j=()=>n(964345),P=()=>n(632503),O=()=>n(748197),z=()=>n(881383),L=()=>n(723545),F=()=>n(460739);const U=(0,n(69708).YK)({genericError:{id:"transcriptionBlockActions.genericError",defaultMessage:"Something went wrong while summarizing your transcript."},failedToStartDictation:{id:"transcriptionBlockActions.failedToStartDictation",defaultMessage:"Unable to start transcription"},systemAudioMacHardwareError:{id:"transcriptionBlockActions.systemAudioMacHardwareError",defaultMessage:"AI Meeting Notes failed to start. You may need to update to the latest version of macOS."},systemAudioMacHardwareErrorRequiresMacOS13:{id:"transcriptionBlockActions.systemAudioMacHardwareErrorRequiresMacOS13",defaultMessage:"Transcribing on AI Meeting Notes requires macOS 13 or later."},systemAudioWindowsHardwareError:{id:"transcriptionBlockActions.systemAudioWindowsHardwareError",defaultMessage:"AI Meeting Notes failed to start. You may need to update to the latest version of Windows."}});async function W(e){var t;const{environment:n,blockStore:i}=e;if(!(null===(t=D().default.state.currentUserStore)||void 0===t?void 0:t.id))return!1;if((0,x().l)(i))return!1;await i.load(),b().UW("transcription_error_notification");const r=t=>{k().createAndCommit({userAction:"transcriptionBlockActions.failedToStartDictation",environment:n,canUndo:!1,perform:t=>{Z({...e,transaction:t,state:{state:"paused"}})}}),t&&S().D6({label:C().A.formatMessage(t),helpUrl:(0,N().zv)()})},a=await(0,F().HT)(n);switch(a){case"requiresMacOS13":return r(U.systemAudioMacHardwareErrorRequiresMacOS13),!1;case"showSetupModal":return r(),O().c.openTranscriptionSetupModal(),(0,o().u)({environment:n,event:{eventName:"transcription_block_setup_modal_opened",eventProperties:{}}}),!1;case"noBrowserSupport":return r(U.failedToStartDictation),!1;case"startDictation":return!0;default:(0,p().HB)(a)}}async function V(e){var t,n;const{environment:o,blockStore:r}=e,s=null===(t=D().default.state.currentUserStore)||void 0===t?void 0:t.id;if(!s)return;await r.load(),b().UW("transcription_error_notification");if(!(await W(e)))return;const c=t=>{k().createAndCommit({userAction:"transcriptionBlockActions.failedToStartDictation",environment:o,canUndo:!1,perform:t=>{Z({...e,transaction:t,state:{state:"paused"}})}}),t&&S().D6({label:C().A.formatMessage(t),helpUrl:(0,N().zv)()})};if(O().c.setSettingsOpenForBlockId(void 0),b().UW("transcription_idle_notification"),(0,R().M)(o)){const e=r.pointer.spaceId,t=o.currentUser.id;if(e&&t){var u;const n=(0,w().J8)({store:r,scrollToBlockId:r.id,fullyQualified:!0,pageVisitSource:i().y8.TranscriptionBlockNotification});null===(u=o.mobileNative)||void 0===u||u.startMeetingNotes(r.id,t,e,n)}return}try{O().c.setLoadingState(r.id,!0);if((await(0,d().nQ)(5e3,z().DictationManager.startDictation({environment:o,blockStore:r,from:"transcription_block",transcriptionStartedFrom:e.from,includeSystemAudio:(0,F().u)(o)}))).timeout)throw new(E().Tn)}catch(v){return void((0,a().US)(v)&&("DictationSystemAudioFailedError"===v.name||"DictationStartTimeoutError"===v.name)&&o.device.isElectronMac?(c(),O().c.openTranscriptionSetupModal()):(0,a().US)(v)&&"DictationSystemAudioHardwareError"===v.name&&o.device.isElectron?c(o.device.isElectronMac?U.systemAudioMacHardwareError:U.systemAudioWindowsHardwareError):c(U.failedToStartDictation))}finally{O().c.setLoadingState(r.id,!1)}const p=null===(n=j().Ay.state.audioRecorder)||void 0===n?void 0:n.isStoringLocalAudio,m={state:"transcribing",transcriber_id:s,transcriber_table:l().oo,session_id:(0,_().qY)(),is_recording:p};k().createAndCommit({userAction:"transcriptionBlockActions.initializeTitleAndStartTranscription",environment:o,canUndo:!1,perform:t=>{Z({...e,transaction:t,state:m})}})}async function q(e){await $({...e,shouldStopDictation:!0})}async function H(e){var t;const{environment:n,blockStore:o,from:i}=e,r=null===(t=o.getFormat())||void 0===t?void 0:t.transcription_state;return r&&"transcribing"!==r.state?"initial"!==(null==r?void 0:r.state)&&"idle"!==(null==r?void 0:r.state)&&"paused"!==(null==r?void 0:r.state)&&"summarizing"!==r.state&&void(0,p().HB)(r):(await K({environment:n,blockStore:o,shouldStopDictation:!1,from:i}),!0)}async function K(e){await $({...e,disableSummarization:!0,state:{state:"paused"}})}async function $(e){const{environment:t,blockStore:n,state:o,disableSummarization:i,shouldStopDictation:r,from:a}=e;O().c.setSettingsOpenForBlockId(void 0),b().UW("transcription_idle_notification"),o&&Z({environment:t,blockStore:n,state:o,from:a}),r&&z().DictationManager.stopDictation({environment:t,from:"transcription_block"}),i||await G({environment:t,blockStore:n,from:a})}async function G(e){const{environment:t,blockStore:n,from:o}=e,i=n.pointer.spaceId;if(!i)return;Z({environment:t,blockStore:n,state:{state:"summarizing",step:"thinking",thinkingSteps:[]},from:o});const r={...n.pointer,spaceId:i},a=O().c.getSummarizationAbortController(n.id);null==a||a.abort();const l=O().c.createSummarizationAbortController(n.id);try{var d;let e=!1;await(0,T().g)({environment:t,onResponse:o=>{if("summarize-transcript-error"===o.type)return void S().D6({label:C().A.formatMessage(U.genericError)});if("summarize-transcript-record-map"===o.type){const e=o.recordMap;f()._O({environment:t,recordMap:s().RecordMapWithRole.create(e),inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,debugSource:"transcriptionBlockActions.runSummarization"})}const i=O().c.getTabState(n.id),r=(0,N().y1)(n,"summary");r&&i!==(null==r?void 0:r.id)&&!e&&(e=!0,O().c.setTabState(n.id,r.id))},data:{transcript:[{id:(0,I().Z1)({environment:t,table:c().mS,spaceId:i}),type:"config",value:{type:"summarize-transcript",transcriptPointer:r,language:(0,P().F)(t.currentUser.id),summaryTabId:(0,u().Ay)(),transcriptionModel:(0,N().RW)(null===(d=n.getFormat())||void 0===d?void 0:d.transcription_model)??"unknown",from:o}},{id:(0,I().Z1)({environment:t,table:c().mS,spaceId:i}),type:"summarize-transcript"}],traceId:n.id,spaceId:i,generateTitle:!1},abortSignal:l.signal}),t.device.isBrowser&&!(0,B().Xh)("ai_meeting_notes_browser_summary_app_download")&&(0,M().HH)(t,"ai_meeting_notes_browser_summary_app_download")}catch(p){if((0,A().zf)(l,p))return;Z({environment:t,blockStore:n,state:{state:"idle"},from:"summary_error"})}finally{O().c.clearSummarizationAbortController(n.id)}}async function Y(e){var t;const{environment:n,blockStore:o,format:i}=e;if((null===(t=o.getFormat())||void 0===t?void 0:t.transcription_summarization_format_type)===i)return;k().createAndCommit({userAction:"transcriptionBlockActions.updatePreferredSummarizationFormat",environment:n,canUndo:!0,perform:e=>{m().zA({stores:[o],update:{transcription_summarization_format_type:i},transaction:e})}});"idle"!==(0,N().by)(o).state||(0,x().l)(o)||await G({environment:n,blockStore:o,from:"format_updated"})}function Z(e){const{environment:t,blockStore:n,state:i,transaction:r,from:a}=e;(0,L().K)({environment:t,blockStore:n,state:i,transaction:r}),(0,o().u)({environment:t,event:{eventName:"transcription_state_updated",eventProperties:{from:a,block_id:n.id,space_id:n.pointer.spaceId,new_state:i.state}}})}function J(e){var t;const{environment:n,blockStore:o,transcriptionModel:i}=e,r=(0,N().f1)(i);(null===(t=o.getFormat())||void 0===t?void 0:t.transcription_model)!==r&&k().createAndCommit({userAction:"transcriptionBlockActions.updateTranscriptionModel",environment:n,canUndo:!1,perform:e=>{m().zA({stores:[o],update:{transcription_model:r},transaction:e})}})}function X(e){const{environment:t,store:n,transaction:o}=e,i=g().Wv({environment:t,type:r().xd.text,inMemoryRecordCache:n.inMemoryRecordCache,transaction:o,spaceId:n.pointer.spaceId});v().BC({parentStore:n.getContentStore(),appendStore:i,transaction:o});const a=n.getContentStores()[0];h().hc({environment:t,store:a});const s=a.getBlockTitleStore();(0,y().e)({store:s})}},289190:(e,t,n)=>{n.d(t,{m:()=>i});class o extends(()=>n(757695))().Store{getInitialState(){return{type:"uninitialized"}}isWriting(){return"filling"===this.state.type&&!this.state.haveAllBlocksCompletedAutofill&&!this.state.didInterruptStreaming}setIsWriting(e){const{propertySchema:t,stores:o,sessionIdForAnalytics:i,collectionId:r}=e,a=i||n(206267).JW();return this.setState({type:"filling",propertySchema:t,collectionId:r,numBlocksToAutofill:o.length,numBlocksAutofilled:0,sessionId:a,didInterruptStreaming:!1,haveAllBlocksCompletedAutofill:!1}),a}}const i=new o},321172:(e,t,n)=>{n.d(t,{XP:()=>f,T:()=>h,Tk:()=>g});n(898992),n(354520),n(581454),n(296540);var o=()=>n(179034),i=()=>n(69708),r=()=>n(314529);var a=()=>n(242422);var s=()=>n(901389),c=()=>n(939555),l=()=>n(380682),d=()=>n(712505),u=()=>n(212640),p=()=>n(538233),m=()=>n(437487),v=n(474848);function g(e){var t;const{environment:n,store:i}=e;m().Ay.reset(),d().default.state.open?u().A.setState({...u().A.state,open:!0}):p().A.setState({...p().A.state,open:!0}),function(e,t){(0,r().DO_NOT_USE_trackLegacy)(e,"open_page_share",t),a().default.logEvent("open_page_share")}(n,{share_menu_session_id:m().Ay.state.sessionId,...i&&i.table===o().ev&&i.isCollectionView()?{collection_id:null===(t=i.getCollectionStore())||void 0===t?void 0:t.id,collection_view_block_id:i.id}:{}})}function f(e){const{environment:t,store:n}=e;d().default.state.open?u().A.setState({...u().A.state,open:!1}):p().A.setState({...p().A.state,open:!1}),l().A.setState({...l().A.state,siteSettingContentType:"initial"});const{collection_view_block_id:i,collection_view_id:a,collection_id:s}=n&&n.table===o().ev&&n.isCollectionView()?{collection_view_block_id:n.id,collection_view_id:(0,c().I)(n,t),collection_id:null===(v=n.getCollectionStoreIfSingleSource())||void 0===v?void 0:v.id}:{collection_view_block_id:void 0,collection_view_id:void 0,collection_id:void 0};var v;!function(e,t){(0,r().DO_NOT_USE_trackLegacy)(e,"close_page_share",t)}(t,{share_menu_session_id:m().Ay.state.sessionId,collection_id:s,collection_view_id:a,collection_view_block_id:i})}async function h(e){const{inviteTargetsStore:t}=e,n=(0,v.jsx)(i().sA,{id:"shareMenu.closeInviteDialog.confirmationMessage",defaultMessage:"Your changes have not been saved. Discard changes?"}),o=(0,v.jsx)(i().sA,{id:"shareMenu.closeInviteDialog.confirmationButton.label",defaultMessage:"Yes"}),r=(0,v.jsx)(i().sA,{id:"shareMenu.closeInviteDialog.cancelButton.label",defaultMessage:"Cancel"});if(t.state.inviteTargets.length>0){return(await s().Gh({message:n,acceptLabel:o,cancelLabel:r})).accept}return!1}},372938:(e,t,n)=>{n.r(t),n.d(t,{CurrentlyListeningTranscriptionBlockIndicator:()=>rt,DictationAvatar:()=>F,DictationBubble:()=>Y,StopDictationButton:()=>xe,StopDictationButtonMobile:()=>Re,StopDictationListener:()=>We,TranscriptionBlockSharingButtonPopup:()=>kt,TranscriptionBlockTitle:()=>Dt,TranscriptionSetupModal:()=>et,activeTranscriptionHelpers:()=>c(),audioProcessDetectionActions:()=>s(),autoStartTranscriptionActions:()=>a(),dictationActions:()=>i(),hooks:()=>T(),idleTranscriptionActions:()=>o,transcriptionBlockActions:()=>r(),transcriptionCreateActions:()=>l(),transcriptionErrorActions:()=>k(),transcriptionNotificationActions:()=>b(),useGetHighestPriorityEligibleAnnotation:()=>A()});var o={};n.r(o),n.d(o,{showIdleTranscriptionToast:()=>y});var i=()=>n(881383),r=()=>n(271380),a=()=>n(899206),s=()=>n(725081),c=()=>n(911063),l=()=>n(533336),d=()=>n(564884),u=()=>n(120282),p=()=>n(100622),m=()=>n(812182),v=()=>n(972435),g=()=>n(765957),f=()=>n(148832),h=()=>n(540144),S=()=>n(811031);function y(e,t){var n;const{pointer:o}=t,i=g().AppStoreSidebarSpaceStore.state;if(!i)return;const a=f().B.createChildStore(i,o);if(null==a||!a.isTranscriptionBlock()||"transcribing"!==(0,h().by)(a).state)return;const s=(0,h().RW)(null===(n=a.getFormat())||void 0===n?void 0:n.transcription_model);(0,d().u)({environment:e,event:{eventName:"idle_transcription_toast_shown",eventProperties:{block_id:a.id,transcription_model:s}}}),m().Iz({id:"transcription_idle",icon:()=>(0,u().a)({color:p().Tj.invertedTextColor,height:16,width:16}),presentationType:"persistent",title:v().A.getIntl().formatMessage({id:"idleTranscriptionToast.title",defaultMessage:"Still there?"}),message:v().A.getIntl().formatMessage({id:"idleTranscriptionToast.message",defaultMessage:"Notion AI is recording your audio but hasn't heard from you in a while."}),onDismiss:()=>{(0,d().u)({environment:e,event:{eventName:"idle_transcription_toast_dismissed",eventProperties:{block_id:a.id,transcription_model:s}}})},actions:{primary:{title:v().A.getIntl().formatMessage({id:"idleTranscriptionToast.action.stop",defaultMessage:"Stop"}),onAction:()=>{(0,S().K)({environment:e,blockStore:a}),(0,r().stopTranscription)({environment:e,blockStore:a,from:"transcription_idle_notification"}),m().UW("transcription_idle_notification"),(0,d().u)({environment:e,event:{eventName:"idle_transcription_toast_stop_button_clicked",eventProperties:{block_id:a.id,transcription_model:s}}})}},secondary:{title:v().A.getIntl().formatMessage({id:"idleTranscriptionToast.action.goToBlock",defaultMessage:"Go to meeting note"}),onAction:()=>{m().UW("transcription_idle_notification"),(0,S().K)({environment:e,blockStore:a}),(0,d().u)({environment:e,event:{eventName:"idle_transcription_toast_navigation_button_clicked",eventProperties:{block_id:a.id,transcription_model:s}}})}}}})}var b=()=>n(637368),k=()=>n(872903),A=()=>n(538864),T=()=>n(673657),_=(n(581454),n(296540)),x=()=>n(56366),w=()=>n(496603),I=()=>n(614415),C=()=>n(645873),M=()=>n(964345),B=()=>n(484714),D=()=>n(401497),E=()=>n(718827),R=()=>n(69708),N=()=>n(620689),j=()=>n(783793),P=()=>n(859428),O=()=>n(126126),z=n(474848);const L=18;function F({enableClickToScroll:e=!1,rootStore:t,noMarginRight:n=!1,noOutline:o=!1,noTooltip:i=!1}){const r=(0,T().useIsDictatingToPage)(t),a=(0,B().v3)(),s=(0,_.useCallback)((e=>e.UIUserAvatarSelfBorder),[]),c=(0,O().XE)(s,!0),l=(0,D().IS)((e=>({tooltip:{color:e.text.inverseSecondary,minWidth:150,paddingTop:2,paddingBottom:2,lineHeight:1.3},avatarContainer:{backgroundColor:e.assistantCornerButtonBackground,display:"flex",alignItems:"center",justifyContent:"center"}})),[]),d=(0,x().O$)(M().b);return!r&&t?null:(0,z.jsx)(P().A,{textWrap:!0,disableTooltip:i,renderTooltip:()=>(0,z.jsxs)("div",{children:[(0,z.jsx)("div",{children:(0,z.jsx)(R().sA,{defaultMessage:"Transcribing your words",id:"topbar.presenceIndicator.dictation.tooltip.description"})}),(0,z.jsx)("div",{style:l.tooltip,children:(0,z.jsx)(R().sA,{defaultMessage:"Click to see where",id:"topbar.presenceIndicator.dictation.tooltip.action"})})]}),render:t=>{const i=(0,z.jsx)("div",{style:{...c.avatarOuterOutline,...o?{outline:"none"}:{},...n?{marginInlineEnd:0}:{},width:L,height:L},children:(0,z.jsx)("div",{style:{...c.avatarBorder,...l.avatarContainer},children:(0,z.jsx)(j().x_,{variant:"avatar",shadowVariant:"none"})})});return e&&d?(0,z.jsx)(E().Ay,{...t,onClick:()=>N().BL([d],!0,a),style:c.button,hoveredStyle:c.buttonHovered,pressedStyle:c.buttonPressed,children:i}):(0,z.jsx)("div",{...t,style:{cursor:"default"},children:i})}})}n(944114),n(898992),n(803949);var U=()=>n(534177),W=()=>n(171333),V=()=>n(141333);function q(e){let t=[];return e.nodeType===Node.TEXT_NODE?t.push(e):e.childNodes.forEach((e=>{t=t.concat(q(e))})),t}function H({scrollerStore:e,blockId:t,children:n,framerMotion:o}){const i=(0,x().K8)((()=>e.state.elementRef??{current:null}),[e]),r=(0,V().yE)(i),[a,s]=(0,_.useState)(),[c,l]=(0,_.useState)(),d=(0,W().lB)(e),u=(0,W().ht)(e),p=null==d?void 0:d.getNode(),m=null==p?void 0:p.querySelector(".notion-page-content"),v=null==m?void 0:m.querySelector(`[data-block-id="${t}"]`);(0,_.useEffect)((()=>{if(m){let e;const t=new MutationObserver((t=>{(0,U().O9)(e)&&cancelAnimationFrame(e),e=requestAnimationFrame((()=>s(Date.now())))}));return t.observe(m,{subtree:!0,characterData:!0,childList:!0}),()=>{t.disconnect(),(0,U().O9)(e)&&cancelAnimationFrame(e)}}}),[m]),(0,_.useEffect)((()=>{if(p){let e;const t=new ResizeObserver((()=>{(0,U().O9)(e)&&cancelAnimationFrame(e),e=requestAnimationFrame((()=>s(Date.now())))}));return t.observe(p),()=>{t.disconnect(),(0,U().O9)(e)&&cancelAnimationFrame(e)}}}),[p]),(0,_.useLayoutEffect)((()=>{if(!v||!p){const e=setTimeout((()=>{l(void 0)}),200);return()=>{clearTimeout(e)}}{const e=document.createRange(),t=v.querySelector('[data-content-editable-leaf="true"]')??v,n=q(t),o=p.getBoundingClientRect();if(n.length>0){const t=n[n.length-1];e.selectNodeContents(t),e.collapse(!1);const i=e.getBoundingClientRect(),a=i.top+r-o.top,s=i.right-o.left+5;l({top:a,left:s})}else{const e=t.getBoundingClientRect(),n=window.getComputedStyle(t),i=parseInt(n.paddingTop,10),a=isNaN(i)?0:i,s=parseInt(n.paddingBottom,10),c=isNaN(s)?0:s,d=parseInt(n.paddingRight,10),u=isNaN(d)?0:d,p=e.top+a+c+r-o.top,m=e.left-o.left+u;l({top:p,left:m})}}}),[v,p,a,r]);const g=(0,U().O9)(c);(0,_.useEffect)((()=>{if(u&&g)switch(u){case"Page":return M().Ay.setState({...M().Ay.state,blockRenderedInPage:!0}),()=>{M().Ay.setState({...M().Ay.state,blockRenderedInPage:!1})};case"PeekView":return M().Ay.setState({...M().Ay.state,blockRenderedInPeekView:!0}),()=>{M().Ay.setState({...M().Ay.state,blockRenderedInPeekView:!1})}}}),[u,g]);const f=(0,_.useRef)(null),{motion:h}=o;return c?(0,z.jsx)(h.div,{ref:f,initial:{transform:`translate(${c.left}px, ${c.top}px)`},animate:{transform:`translate(${c.left}px, ${c.top}px)`},transition:{duration:.2},style:{display:"block",position:"absolute",top:0,insetInlineStart:3,width:0,height:0,zIndex:112},children:n}):null}function K(e){const{value:t}=(0,C().fJ)(I().fM);return t?(0,z.jsx)(H,{...e,framerMotion:t}):null}function $(e){const{framerMotion:t}=e,{motion:n}=t,o=(0,I().sM)(t);(0,_.useEffect)((()=>{(async()=>{await o.start((e=>({y:[0,-7,0],transition:{duration:.6,delay:.15*e,repeat:1/0,repeatDelay:1,ease:"easeInOut"}})))})()}),[o]);const i=(0,D().IS)((e=>({dotStyle:{width:6,height:6,flexShrink:0,backgroundColor:e.icon.quaternary,borderRadius:"50%"}})),[]);return(0,z.jsx)(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},style:{display:"flex",justifyContent:"center",alignItems:"center",gap:3},children:[...Array(3)].map(((e,t)=>(0,z.jsx)(n.div,{custom:t,animate:o,style:i.dotStyle},t)))})}function G(){const{value:e}=(0,C().fJ)(I().fM);return e?(0,z.jsx)($,{framerMotion:e}):null}function Y({scrollerStore:e}){const t=(0,x().K8)((()=>{const e=M().Ay.state.block&&M().Ay.state.rootBlock?[{type:"active",rootBlockId:M().Ay.state.rootBlock.id,id:M().Ay.state.block.id}]:[],t=Object.values(M().Ay.state.passiveBlockMap).map((({dictatingBlockStore:e,rootBlockStore:t})=>({type:"passive",rootBlockId:t.id,id:e.id})));return w().hS([...e,...t],"id")}),[],{useDeepEqual:!0}),n=(0,x().O$)(M().Gq),o=(0,x().O$)(M().Mq),{value:i}=(0,C().fJ)(I().fM);if(!i)return null;const{AnimatePresence:r}=i;return(0,z.jsx)(z.Fragment,{children:t.map((t=>(0,z.jsx)(K,{blockId:t.id,scrollerStore:e,children:(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,z.jsx)(F,{noMarginRight:!0,noOutline:!0,noTooltip:!0}),(0,z.jsx)(r,{children:n||o?(0,z.jsx)("div",{style:{transform:"translateY(3px)"},children:(0,z.jsx)(G,{})}):void 0})]})},t.rootBlockId)))})}var Z=n(440961),J=()=>n(205262),X=()=>n(75435),Q=()=>n(252291),ee=()=>n(854705),te=()=>n(406699),ne=()=>n(745766),oe=()=>n(463830),ie=()=>n(712505),re=()=>n(405689),ae=()=>n(631524),se=()=>n(158115),ce=()=>n(721479),le=()=>n(284371),de=()=>n(760217),ue=()=>n(939740),pe=()=>n(89924),me=()=>n(426175),ve=()=>n(524007),ge=()=>n(632503),fe=()=>n(805952),he=()=>n(38337),Se=()=>n(865060),ye=()=>n(74e3);function be(e){const t=(0,B().v3)(),{parent:n}=e,o=(0,x().K8)((()=>Object.keys(fe().Cu).indexOf((0,ge().F)(t.currentUser.id))),[t.currentUser.id]),i=[{key:"languages",render:e=>(0,z.jsx)(pe().A,{...e,topBorder:0!==e.index}),items:(0,ye().u)().map((([e,[o]])=>{const i={key:e,render:e=>(0,z.jsx)(de().A,{...e,title:o}),action:()=>{(0,Se().X)(t,e),n.close()}};return i}))}];return(0,z.jsx)("div",{className:he().OLz,style:{display:"flex",flexDirection:"column",minWidth:150,maxWidth:"max-content"},children:(0,z.jsx)(ue().Ay,{type:ue().Oh.Vertical,initialFocus:o,sections:i})})}function ke(e){const{languagePopupStore:t}=e,n=(0,B().v3)(),o=(0,x().K8)((()=>(0,ge().F)(n.currentUser.id)),[n.currentUser.id]);(0,_.useEffect)((()=>{me().Ay.updateMediaDevices()}),[]);const i=(0,D().IS)((e=>({container:{padding:"8px 0px",display:"flex",flexDirection:"column",alignItems:"flex-start",width:300,gap:8},microphoneText:{marginInlineStart:12,fontSize:12,fontWeight:le().Wy.medium,color:e.text.secondary},microphoneSection:{display:"flex",flexDirection:"column",width:"100%"},languageText:{fontSize:14,color:e.text.primary},languageSection:{padding:"0px 14px",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},line:{width:"100%",height:1,backgroundColor:e.icon.tertiary,opacity:.3},languageButtonStyle:{fontSize:14,display:"flex",alignItems:"center",gap:10,color:e.text.secondary},helpSection:{padding:"5px 14px",display:"flex",alignItems:"center",justifyContent:"flex-start",gap:4,cursor:"pointer"},helpText:{fontSize:12,color:e.text.tertiary}})),[]),{value:r}=(0,C().fJ)(I().fM);if(!r)return null;const{motion:a}=r;return(0,z.jsxs)("div",{style:i.container,children:[(0,z.jsxs)("div",{style:i.microphoneSection,children:[(0,z.jsx)("div",{style:i.microphoneText,children:"Microphone"}),(0,z.jsx)(Ae,{})]}),(0,z.jsx)("div",{style:i.line}),(0,z.jsxs)("div",{style:i.languageSection,children:[(0,z.jsx)("div",{style:i.languageText,children:"Language"}),(0,z.jsx)(te().A,{buttonPopupStore:t,renderOrigin:e=>(0,z.jsxs)(ae().p,{style:i.languageButtonStyle,...e,children:[o,(0,z.jsx)(Q().I,{icon:se().arrowChevronSingleRightFillSmallIcon,size:"xs",colorVariant:"tertiary"})]}),stopClickPropagation:!0,popupType:te().z.Popup,render:e=>(0,z.jsx)(be,{parent:e})})]}),(0,z.jsx)("div",{style:i.line}),(0,z.jsxs)(a.div,{style:i.helpSection,onClick:()=>window.open("https://www.notion.so/help/audio-dictation","_blank"),variants:{hover:{opacity:.6},tap:{opacity:1}},whileHover:"hover",whileTap:"tap",transition:{duration:.2},children:[(0,z.jsx)(Q().I,{icon:ce().questionMarkCircleSmallIcon,size:"sm",colorVariant:"tertiary"}),(0,z.jsx)("div",{style:i.helpText,children:"Learn about Dictation"})]})]})}function Ae(){const e=(0,x().O$)(me().X8),t=(0,x().O$)(me().dc),n=(0,x().K8)((()=>e.findIndex((e=>e.deviceId===(null==t?void 0:t.deviceId)))),[e,t]),o=[{key:"devices",render:e=>(0,z.jsx)(pe().A,{...e,topBorder:0!==e.index}),items:e.map((e=>({key:e.deviceId,render:n=>(0,z.jsx)(de().A,{...n,title:e.label,isChecked:e.deviceId===(null==t?void 0:t.deviceId)}),action:()=>{ve().d.setState(e)}})))}];return(0,z.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:(0,z.jsx)(ue().Ay,{type:ue().Oh.Vertical,initialFocus:n,sections:o})})}const Te=document.body;function _e({rootStore:e,framerMotion:t}){const n=(0,B().WS)(),o=(0,T().useIsDictatingToPage)(e),r=(0,B().v3)(),a=(0,x().K8)((()=>M().Ay.state.audioRecorder),[]),s=(0,x().uB)(void 0,oe().A),c=(0,x().uB)(void 0,oe().A),l=(0,x().O$)(X().b),d=(0,_.useCallback)((()=>{(0,i().stopDictation)({environment:r,from:"button"})}),[r]),u=(0,_.useCallback)((e=>{null==e||e.stopPropagation(),e&&(0,J().V)(e)||(c.state.open?c.reset():s.state.open?s.reset():s.setState({...s.state,open:!0}))}),[s,c]),[p,m]=(0,_.useState)(!1),v=(0,_.useCallback)((()=>{m(!0)}),[]),g=(0,_.useCallback)((()=>{m(!1)}),[]),[f,h]=(0,_.useState)(!1),S=(0,_.useCallback)((()=>{h(!0)}),[]),y=(0,_.useCallback)((()=>{h(!1)}),[]),b=(0,D().IS)((e=>({dictationButtonStyle:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:25,gap:2,height:24,cursor:"pointer",paddingTop:6,paddingInlineEnd:2,paddingBottom:6,paddingInlineStart:2,backgroundColor:"dark"===e.mode?"#2D2D2D":"#F1F0EF",...(0,ne().g)({noDrag:r.device.isElectron&&!l})},downChevronContainer:{display:"flex",alignItems:"center",justifyContent:"center",height:20,width:20,borderRadius:20},redSquare:{width:10,height:10,borderRadius:2,backgroundColor:p?"dark"===e.mode?e.palette.red[500]:"rgba(191, 67, 64, 1)":"dark"===e.mode?e.palette.red[700]:e.palette.red[500]},redSquareContainer:{width:20,height:20,borderRadius:20,display:"flex",alignItems:"center",justifyContent:"center"}})),[r.device.isElectron,l,p]),k=(0,_.useMemo)((()=>(0,z.jsx)(Q().I,{icon:ee().arrowChevronSingleDownFillSmallIcon,size:"xs",colorVariant:f?"secondary":"tertiary"})),[f]),A=(0,x().K8)((()=>{var t;return ie().default.isCenterPeekOpen()&&(null===(t=ie().default.peekTargetStore.state)||void 0===t?void 0:t.id)!==(null==e?void 0:e.id)}),[null==e?void 0:e.id]),w=(0,_.useRef)(null),[I,C]=(0,_.useState)(null);(0,_.useEffect)((()=>{if(!w.current)return void C(null);const e=w.current.getBoundingClientRect();C({top:e.top+window.scrollY,left:e.left+window.scrollX})}),[A]);const R=(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(E().Ay,{style:b.redSquareContainer,onClick:d,onMouseEnter:v,onMouseLeave:g,children:(0,z.jsx)("div",{style:b.redSquare})}),e?(0,z.jsx)(re().t,{rootBlockId:null==e?void 0:e.id}):void 0,(0,z.jsx)(E().Ay,{className:"notion-dictation-button-up-chevron",style:b.downChevronContainer,onClick:u,onMouseEnter:S,onMouseLeave:y,children:k})]}),N=(0,O().Uo)({environment:r,isShowingTabBar:l,isShowingInFeed:!1}),{motion:j}=t;return o&&a&&!n?(0,z.jsx)("div",{style:{marginInlineStart:N.marginInlineStart,marginTop:N.marginTop,marginInlineEnd:.5*Number(N.marginInlineStart)*-1},children:(0,z.jsx)(te().A,{buttonPopupStore:s,renderOrigin:()=>(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(j.div,{ref:w,className:"notion-dictation-button",style:b.dictationButtonStyle,onClick:d,initial:{opacity:0,x:15},animate:{opacity:1,x:0},transition:{duration:.4},children:R}),A?(0,Z.createPortal)((0,z.jsx)("div",{className:"notion-dictation-button-duplicate",style:{...b.dictationButtonStyle,position:"fixed",top:(null==I?void 0:I.top)||0,insetInlineStart:(null==I?void 0:I.left)||0,zIndex:1e7},onClick:d,children:R}),Te):void 0]}),stopClickPropagation:!0,popupType:r.device.isMobile?te().z.SlideUp:te().z.Popup,popupWrapStyle:{top:6},render:()=>(0,z.jsx)(ke,{languagePopupStore:c})})}):null}function xe(e){const{value:t}=(0,C().fJ)(I().fM);return t?(0,z.jsx)(_e,{...e,framerMotion:t}):null}var we=()=>n(363901);const Ie=(0,n(340498).wt)("stopDictation",{viewBox:"0 0 36 36",svg:(0,z.jsxs)("svg",{width:"36",height:"36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,z.jsx)("rect",{width:"36",height:"36",rx:"18",fill:"#D34F43",fillOpacity:".1"}),(0,z.jsx)("path",{d:"M12.2 21.7v-8.3c0-.5.2-.9.5-1.2.3-.3.7-.4 1.2-.4h8.2c.5 0 .9.1 1.2.4.3.3.5.7.5 1.2v8.3c0 .5-.2.9-.5 1.2-.3.3-.7.4-1.2.4h-8.2c-.5 0-1-.1-1.2-.4-.3-.3-.5-.7-.5-1.2Z",fill:"#D44C47"})]})});var Ce=()=>n(235921),Me=()=>n(111043),Be=()=>n(991699),De=()=>n(110750),Ee=()=>n(594635);function Re(){const e=(0,B().v3)(),{isMobileNative:t,isPhone:n}=(0,B().Y0)(),o=(0,x().K8)((()=>{const e=Ce().A.isOnboarding(),t=Be().A.state.open;return e||t}),[]),r=(0,x().K8)((()=>{var e;return!o&&M().Ay.getState().enabled&&!M().Ay.getState().loading&&!(null!==(e=M().Ay.getState().rootBlock)&&void 0!==e&&e.isTranscriptionBlock())}),[o]),a=(0,_.useCallback)((()=>(0,i().stopDictation)({environment:e,from:"mobile_bar_button"})),[e]);return(0,_.useEffect)((()=>{o&&a()}),[o,a]),function(e){const t=(0,x().O$)(Ee().A);(0,_.useEffect)((()=>{t&&(e(),Ee().A.reset())}),[t,e])}(a),function(e){const t=(0,B().v3)(),n=(0,x().K8)((()=>{const e=M().kj.state;if(e)return!e.isDictatableBlock()||e.pathIsDead()}),[]),o=(0,x().K8)((()=>!M().Y$.state&&M().gZ.state),[]),i=(0,x().O$)(M().ei),r=(0,_.useRef)(!0),a=(0,x().K8)((()=>(0,De().Xz)(t.TabbedRouterStore.state)),[t]);(0,_.useEffect)((()=>{(0,U().O9)(n)&&n&&e()}),[n,e]),(0,_.useEffect)((()=>{if(o&&(0,U().O9)(i)&&!i.isTranscriptionBlock()){const t=setTimeout((()=>{e()}),250);return()=>{clearTimeout(t)}}}),[o,e,i]),(0,_.useEffect)((()=>{t.device.isMobileNative&&a&&(r.current?r.current=!1:e())}),[t,a,r,e])}(a),r&&t&&n?(0,z.jsx)(Ne,{handleClick:a}):null}function Ne(e){const{handleClick:t}=e,n=(0,B().v3)(),o=(0,we().A)(!0);!function(){const{mobileNative:e}=(0,B().v3)();(0,_.useEffect)((()=>(null==e||e.requestKeepScreenOn(!0),()=>{null==e||e.requestKeepScreenOn(!1)})),[e])}();const i=(0,Me().o)(),[r,a]=(0,x().K8)((()=>[n.WindowSizeStore.getSafePaddingLeftPx(16),n.WindowSizeStore.getSafePaddingRightPx(16)]),[n.WindowSizeStore]),s=(0,D().IS)((e=>({container:{position:"absolute",width:"100%",bottom:i,minHeight:50,paddingTop:"6px",paddingBottom:"6px",paddingInlineEnd:a,paddingInlineStart:r,border:`1px solid ${e.border.secondary}`,background:e.background.primary},dictationButtonStyle:{display:"flex",justifyContent:"space-between",verticalAlign:"center",cursor:"pointer",gridAutoFlow:"column",placeItems:"center",gap:10,alignItems:"center"},icon:{color:e.red.icon.accentPrimary}})),[i,r,a]),c=(0,_.useMemo)((()=>Ie({width:36,height:36,...s.icon})),[s.icon]),l=(0,x().O$)(M().Di);return(0,z.jsx)("div",{style:{...s.container,zIndex:1e7},...o,children:(0,z.jsxs)("div",{className:"notion-dictation-button",style:{...s.dictationButtonStyle},children:[(0,z.jsx)("div",{style:{maxWidth:480,width:"100%",justifyContent:"center",display:"flex",verticalAlign:"middle"},children:l?(0,z.jsx)(re().t,{fillWidth:!0,rootBlockId:l}):void 0}),(0,z.jsx)("div",{onClick:t,children:c})]})})}var je=()=>n(165358),Pe=()=>n(44551);var Oe=()=>n(651382),ze=()=>n(615234),Le=()=>n(866515);var Fe=()=>n(249696);const Ue=(0,R().YK)({title:{id:"stopDictationListener.notification.title",defaultMessage:"Meeting note stopped due to inactivity"},body:{id:"stopDictationListener.notification.body",defaultMessage:"Notion AI could not detect your audio for a while"}});function We(){const e=(0,B().v3)(),t=(0,R().tz)(),n=(0,x().K8)((()=>M().Ay.state.tabId),[]),o=(0,x().O$)(M().ei),a=(0,x().K8)((()=>(0,U().O9)(o)&&o.isTranscriptionBlock()),[o]),s=(0,x().K8)((()=>{const e=M().kj.state;if(e&&e.isDefined())return!e.isDictatableBlock()||e.pathIsDead()}),[]),c=(0,x().K8)((()=>!M().Y$.state),[]);(0,_.useEffect)((()=>{var t,n,o,r;(0,U().O9)(s)&&s&&(je().log({level:"info",from:"stopDictationListener",type:"block_not_dictatable",data:{miscDataToConvertToString:{rootBlockId:null===(t=M().ei.state)||void 0===t?void 0:t.id,dictationBlockId:null===(n=M().kj.state)||void 0===n?void 0:n.id,isDictatableBlock:(null===(o=M().kj.state)||void 0===o?void 0:o.isDictatableBlock())??"undefined",isDictationBlockPathDead:(null===(r=M().kj.state)||void 0===r?void 0:r.pathIsDead())??"undefined"}}}),(0,i().stopDictation)({environment:e,from:"block_not_dictatable"}))}),[s,e]),(0,_.useEffect)((()=>{if(c&&!a){const t=setTimeout((()=>{c||(0,i().stopDictation)({environment:e,from:"block_not_visible"})}),350);return()=>{clearTimeout(t)}}}),[c,a,e]);const l=function(){const e=(0,Fe().W)(),t=(0,x().O$)(M().ei),[n,o]=(0,_.useState)(void 0),i=(0,_.useCallback)((()=>{if(null==t||!t.isTranscriptionBlock())return;const e=M().Ay.state.lastReceivedTranscriptionAt;if(!e)return;const n=Date.now()-e;n>=15*ze().Xb?o("should_stop"):n>=Number(ze().Xb)?o("should_notify"):o(void 0)}),[t]);return(0,Le().n)(i,20*ze().TD,Boolean(e&&t)),n}();return function(){const e=(0,B().v3)(),t=(0,x().O$)(M().gZ),n=(0,x().O$)(M().Di),o=(0,_.useCallback)((()=>{if(!t||!n)return;const o=M().Ay.state.transcriptionLastSentAt;if(!o)return;const i=Date.now()-o;if(i>=5*ze().TD){var r,a;const o=null===(r=e.currentUser)||void 0===r?void 0:r.id,s=null===(a=g().default.state.sidebarSpaceStore)||void 0===a?void 0:a.id;je().log({level:"warning",from:"dictationIdleDetection",type:"idleAudioSending",data:{miscDataToConvertToString:{rootBlockId:n,currentUserId:o,currentSpaceId:s,timeSinceLastSentMs:i,isDictationEnabled:t}}})}}),[t,n,e]);(0,Le().n)(o,10*ze().TD,Boolean(t))}(),(0,_.useEffect)((()=>{if(!l||null==o||!o.isTranscriptionBlock())return i={id:"transcription_idle"},void(null===Pe().electronApi||void 0===Pe().electronApi||null===(a=Pe().electronApi.dismissToastInAllTabs)||void 0===a||a.call(Pe().electronApi,i));var i,a;if("should_notify"===l&&(0,Oe().B)(e,{toastId:"transcription_idle",pointer:o.pointer}),"should_stop"===l){(0,r().stopTranscription)({environment:e,blockStore:o,from:"transcription_idle"});new Notification(t.formatMessage(Ue.title),{body:t.formatMessage(Ue.body),silent:!1}).addEventListener("click",(()=>{(0,S().N)({environment:e,blockStore:o,tabId:n})}))}}),[l,e,n,o,t]),null}n(354520);var Ve=()=>n(160432),qe=()=>n(148307),He=()=>n(187174),Ke=()=>n(209969),$e=()=>n(297872),Ge=()=>n(559273),Ye=()=>n(676007),Ze=()=>n(232930),Je=()=>n(460739),Xe=()=>n(748197);const Qe=(0,R().YK)({transcriptionSetupModal:{id:"transcriptionBlock.transcriptionSetupModal.ariaLabel",defaultMessage:"AI Meeting Notes Setup"},getStarted:{id:"transcriptionBlock.transcriptionSetupModal.getStarted",defaultMessage:"AI Meeting Notes Setup"},setupDescription:{id:"transcriptionBlock.transcriptionSetupModal.setupDescription",defaultMessage:"One-time setup to capture notes effortlessly."},imageAlt:{id:"transcriptionBlock.transcriptionSetupModal.imageAlt",defaultMessage:"AI Meeting Notes setup image"},troubleshootingText:{id:"transcriptionBlock.transcriptionSetupModal.troubleshootingText",defaultMessage:"If you’ve already completed setup but still see this, try these <link>troubleshooting steps</link>"}});function et(){const e=(0,B().Y0)(),t=(0,x().K8)((()=>Xe().c.state.transcriptionSetupModalOpen&&e.isElectron),[e]);return(0,z.jsx)(Ye().a,{ariaLabel:v().A.formatMessage(Qe.transcriptionSetupModal),open:t,render:()=>(0,z.jsx)(tt,{}),transitionAppearance:"none",onDismiss:()=>{Xe().c.closeTranscriptionSetupModal()}})}function tt(){const e=(0,D().IS)((e=>({wrapper:{display:"flex",flexDirection:"column",width:"100%",maxWidth:480,border:`1px solid ${e.regularDividerColor}`,borderRadius:12},header:{display:"flex",flexDirection:"column",gap:4,padding:"20px 25px 5px",backgroundColor:e.background.secondaryTranslucent},title:{display:"flex",flexDirection:"row",alignItems:"center",fontSize:24,fontWeight:600,color:e.text.primary},description:{marginBottom:15,fontSize:17,lineHeight:"24px",color:e.text.secondary},troubleshooting:{marginBottom:15,fontSize:14,lineHeight:"20px",color:e.text.secondary},troubleshootingLink:{color:e.blue.text.accentPrimary,textDecoration:"none",cursor:"pointer"},body:{display:"flex",flexDirection:"column",gap:8,padding:"25px 25px 20px",borderRadius:12,position:"relative"},controlRowContainerInvertedBorder:{backgroundColor:e.background.secondaryTranslucent}})),[]),t=(0,B().v3)(),[n]=(0,_.useState)((0,Je().xw)()),[o,i]=(0,_.useState)([]),[r,a]=(0,_.useState)(!1),[s]=(0,He().Yb)((async()=>{let e,r=o;const a=n.filter((e=>!o.includes(e.id)));for(const n of a){const i=await n.hasCompleted({environment:t,isConfirmation:!1});i&&!o.includes(n.id)&&(r=[...r,n.id]),i||e||(e=n)}return i(r),e}),[t,n,o]);return(0,_.useEffect)((()=>{if(s.value&&r){const e=setInterval((async()=>{const n=s.value;if(!n)return void clearInterval(e);await n.hasCompleted({environment:t,isConfirmation:!0})&&(i([...o,n.id]),clearInterval(e))}),3e3);return()=>{clearInterval(e)}}}),[s,t,r,o]),(0,z.jsx)($e().A,{capture:!0,allowUndo:!1,allowEsc:!0,allowTabUntab:!1,render:i=>(0,z.jsxs)("div",{...i,style:e.wrapper,children:[(0,z.jsxs)("div",{style:e.header,children:[(0,z.jsx)("div",{style:e.title,children:(0,z.jsx)(R().sA,{...Qe.getStarted})}),(0,z.jsx)("div",{style:e.description,children:(0,z.jsx)(R().sA,{...Qe.setupDescription})}),(0,z.jsx)("div",{style:e.troubleshooting,children:(0,z.jsx)(R().sA,{...Qe.troubleshootingText,values:{link:t=>(0,z.jsx)("a",{href:(0,Ze().x)("guides.meetingNotes.troubleshootCommonIssues"),target:"_blank",rel:"noopener noreferrer",style:e.troubleshootingLink,children:t})}})})]}),(0,z.jsxs)("div",{style:e.body,children:[(0,z.jsx)("div",{style:{...e.controlRowContainerInvertedBorder,width:"16px",height:"16px",position:"absolute",top:0,insetInlineStart:0,clipPath:"path('M16 0C7.16344 0 0 7.16344 0 16V0H16Z')"}}),(0,z.jsx)("div",{style:{...e.controlRowContainerInvertedBorder,width:"16px",height:"16px",position:"absolute",top:0,insetInlineEnd:0,clipPath:"path('M0 0C8.83656 0 16 7.16344 16 16V0H0Z')"}}),n.map((e=>{var n,i;return(0,z.jsx)(nt,{step:e,isCompleted:o.includes(e.id),isFirstIncompleteStep:(null===(i=s.value)||void 0===i?void 0:i.id)===e.id,onAction:()=>{e.action({environment:t,isConfirmation:!1}),(0,d().u)({environment:t,event:{eventName:"transcription_block_setup_modal_action_clicked",eventProperties:{step:e.id}}}),a(!0)}},`${e.id}-${null===(n=s.value)||void 0===n?void 0:n.id}`)}))]})]})})}function nt(e){const{step:t,isFirstIncompleteStep:n,onAction:o,isCompleted:i}=e,r=(0,D().IS)((e=>({stepContainer:{display:"flex"},checkIcon:{width:24,height:24,marginInlineEnd:12,marginTop:3,fill:i?e.blue.icon.accentPrimary:e.icon.tertiary},content:{flex:1},stepTitle:{display:"flex",alignItems:"center",fontSize:19,fontWeight:le().Wy.semibold,marginBottom:4,color:i?e.blue.text.accentPrimary:e.text.primary},container:{display:"flex",flexDirection:"row",alignContent:"flex-start",alignItems:"flex-start",width:"100%",gap:20},image:{width:"135px",marginTop:8,flexShrink:0,borderRadius:4},description:{display:"flex",flexDirection:"column",marginBottom:5,marginTop:5,color:e.text.secondary},actionButton:{marginTop:12,alignSelf:"flex-start"}})),[i,n]);return(0,z.jsxs)("div",{style:r.stepContainer,children:[(0,Ke().checkmarkCircleFillIcon)(r.checkIcon),(0,z.jsxs)("div",{style:r.content,children:[(0,z.jsx)("div",{style:r.stepTitle,children:(0,z.jsx)(R().sA,{...t.title})}),n?(0,z.jsxs)("div",{style:r.container,children:["microphone"===t.id||"system-audio"===t.id?(0,z.jsx)(Ge().A,{src:qe().A.images.aiMeetingNotes.setupPng,alt:v().A.formatMessage(Qe.imageAlt),style:r.image,placeholderLoadedStyle:{width:"auto"}}):null,(0,z.jsxs)("div",{style:r.description,children:[(0,z.jsx)(R().sA,{...t.description}),(0,z.jsx)(Ve().A,{colorPalette:"blue",style:r.actionButton,onClick:o,children:(0,z.jsx)(R().sA,{...t.actionText})})]})]}):null]})]})}var ot=()=>n(852517),it=()=>n(674266);function rt(){const e=(0,B().v3)(),t=(0,ot().$)(),[n,o]=(0,_.useState)(!1),i=(0,D().IS)((e=>({wrapper:{borderRadius:34,background:e.background.elevated},container:{display:"flex",alignItems:"center",justifyContent:"center",boxShadow:e.shadowSM,borderRadius:34,paddingTop:8,paddingInlineEnd:14,paddingBottom:8,paddingInlineStart:12,minWidth:100,background:e.background.elevated,gap:6,transition:"background 0.3s ease-in-out"},hoveredStyle:{background:n?e.outlinefrontSecondaryButtonPressedBackground:e.buttonHoveredBackground}})),[n]),r=(0,_.useCallback)((()=>{t&&(0,S().K)({environment:e,blockStore:t})}),[e,t]),a=(0,x().O$)(M().gZ);return t?(0,z.jsx)(P().A,{renderTooltip:()=>n?(0,z.jsx)(R().sA,{defaultMessage:"Stop recording",id:"currentlyListeningTranscriptionBlockIndicator.stopRecording"}):(0,z.jsx)(R().sA,{defaultMessage:"Return to meeting note",id:"currentlyListeningTranscriptionBlockIndicator.returnToTranscription"}),render:e=>(0,z.jsx)("div",{style:i.wrapper,children:(0,z.jsxs)(E().Ay,{...e,style:i.container,hoveredStyle:i.hoveredStyle,onClick:r,children:[(0,z.jsx)(re().t,{fillWidth:!0,fakeSoundwave:!a,rootBlockId:t.id}),(0,z.jsx)(at,{store:t,setIsHovering:o})]})})}):null}function at(e){const{store:t,setIsHovering:n}=e,o=(0,B().v3)(),i=(0,_.useCallback)((()=>{(0,r().stopTranscription)({environment:o,blockStore:t,from:"currently_listening_transcription_block"}),(0,S().K)({environment:o,blockStore:t})}),[o,t]);return(0,z.jsx)(E().Ay,{onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),onClick:i,children:(0,z.jsx)(it().w,{disabled:!1})})}var st=()=>n(729108),ct=()=>n(89849),lt=()=>n(566910),dt=()=>n(68263),ut=()=>n(579627),pt=()=>n(404277),mt=()=>n(678553),vt=()=>n(453697),gt=()=>n(347160),ft=()=>n(722872),ht=()=>n(329443),St=()=>n(928074),yt=()=>n(711207),bt=()=>n(353890);function kt(e){const{users:t,children:n,rolesMap:o}=e,i=(0,_.useMemo)((()=>new(oe().A)),[]);return(0,z.jsx)(te().A,{buttonPopupStore:i,popupType:te().z.Popup,originGap:4,alignmentToOrigin:"start",onClick:e=>{e.stopPropagation(),e.preventDefault()},render:()=>(0,z.jsx)(At,{users:t,rolesMap:o,buttonPopupStore:i}),renderOrigin:n})}function At(e){const{users:t,rolesMap:n,buttonPopupStore:o}=e,{store:i}=(0,bt().s)(),r=(0,B().v3)(),a=(0,R().tz)(),[s,c]=(0,_.useState)("editor"),[l,d]=(0,_.useState)(t.filter((e=>e.id!==r.currentUser.id&&"none"===(n[e.id]??"none")))),u=(0,x().K8)((()=>!(0,St().Aj)({store:i})),[i]),p=(0,x().K8)((()=>{const e=i.getNavigableBlockStore();return!(null==e||!e.isDefined())&&e.canEditMembership()}),[i]),m=(0,x().K8)((()=>t.filter((e=>e.isDefined()))),[t]),v=(0,_.useCallback)((e=>{const t=l.includes(e);d(t?l.filter((t=>t.id!==e.id)):[...l,e])}),[l]),g=(0,_.useCallback)((e=>{(0,dt().PW)(e)&&c(e)}),[c]),f=(0,_.useCallback)((()=>{const e=i.getNavigableBlockStore();if(!e)return;const t=l.map((e=>{const t=e.getModel();if(t)return{type:"existingUser",value:t}})).filter(U().O9);ut().eP({environment:r,store:e,inviteTargets:t,inviteRole:s,isOnboarding:!1,invite:{inviteOrigin:"transcription_block"}}),d([]),o.setState({open:!1}),(0,yt().FP)({environment:r,store:i})}),[r,i,l,s,o]),h=(0,D().IS)((e=>({you:{color:e.gray.text.accentPrimary}})),[]),S=(0,z.jsx)(pe().A,{topBorder:!0,extraPadding:!0,children:(0,z.jsx)(mt().Ay,{left:(0,z.jsx)(gt().Ay,{table:"block",type:"user_permission",availableRoleItems:[{role:"editor"},{role:"read_and_write"},{role:"comment_only"},{role:"reader"}],role:s,onChange:g,upgradeButtonName:"user_permission_item"}),right:(0,z.jsx)(Ve().A,{colorPalette:"blue",onClick:f,disabled:0===l.length||!p,children:(0,z.jsx)(R().sA,{id:"transcriptionBlock.calendarAttendeesList.shareButton",defaultMessage:"Share page"})})})}),y=(0,_.useCallback)((()=>[{key:"users",render:e=>(0,z.jsx)(pe().A,{...e,title:(0,z.jsx)(R().sA,{id:"transcriptionBlock.attendeeList.eventParticipants.title",defaultMessage:"Event participants"})}),items:m.map((e=>({key:e.id,action:()=>{},render:t=>{const o={displayName:e.getDisplayName(a),email:e.getEmail()},i=n[e.id],s=e.id===r.currentUser.id;return(0,z.jsx)(de().A,{...t,focused:!1,left:(0,z.jsx)(vt().A,{userStore:e,size:24,avatarShouldShowShadow:!0}),disabled:s,title:s?(0,z.jsx)(R().sA,{id:"transcriptionBlock.calendarAttendeeList.shareMenu.you",defaultMessage:"{name} <gray>(You)</gray>",values:{name:o.displayName,gray:e=>(0,z.jsx)("span",{style:h.you,children:e})}}):o.displayName,caption:o.email,body:(0,z.jsx)(_t,{role:i,hasInaccessiblePermissions:u}),right:s?null:(0,z.jsx)(st().S,{size:16,checked:l.includes(e),style:{marginInlineEnd:8},onClick:()=>{v(e)}}),onClick:()=>{v(e)}})}})))}]),[m,a,n,l,r.currentUser.id,v,h.you,u]);return(0,z.jsx)(pt().A,{menuType:ft().gu.Popup,maxHeight:"min(448px, 40vh)",footer:S,children:(0,z.jsx)(ue().Ay,{type:ue().Oh.Vertical,sections:y(),initialFocus:void 0,resetFocusOnMouseOut:!0})})}const Tt=(0,R().YK)({mayHaveAccess:{id:"transcriptionBlock.sharingButtonPopup.mayHaveAccess",defaultMessage:"May have access"}});function _t(e){const{role:t,hasInaccessiblePermissions:n}=e,o=(0,R().tz)(),i=t?(0,ht().qZ)(t):n?o.formatMessage(Tt.mayHaveAccess):(0,ht().qZ)("none"),r=(0,D().IS)((e=>({row:{display:"flex",alignItems:"center",gap:6,color:"none"===t?e.red.text.secondary:e.gray.text.secondary},icon:{height:12,width:12}})),[t]);return(0,z.jsxs)("div",{style:r.row,children:["none"===t?(0,lt().e)(r.icon):(0,ct().eyeIcon)(r.icon),(0,z.jsx)("div",{children:i})]})}var xt=()=>n(201980),wt=()=>n(19976),It=()=>n(760979),Ct=()=>n(155089);const Mt=(0,R().YK)({loadingPlaceholder:{defaultMessage:"Generating title",id:"TranscriptionBlockTitle.loading.placeholder"}});function Bt(e){const{id:t}=e,{state:o,disabled:i}=(0,bt().s)(),r=o.state,a=(0,R().tz)(),s=function(){const{store:e,state:t}=(0,bt().s)(),n=t.state,o=(0,It().z)(),i=(0,x().K8)((()=>(0,xt().AhH)(e.getTitleValue())>0),[e]),[r,a]=(0,_.useState)(i&&!o);if((0,_.useEffect)((()=>{i&&!o&&a(!0),o&&a(!1)}),[i,o]),o)return{type:"calendar-event",event:o};if(i)return{type:"title"};if("summarizing"===n)return{type:"summarizing"};if(r||"idle"===n)return{type:"idle"};return{type:"not-rendered"}}(),c=(0,B().Y0)(),l=(0,n(59226).X)("ai_meeting_notes_title_redesign"),d=(0,D().IS)((()=>({container:l?{padding:"0px 4px",cursor:"default"}:{cursor:"default",paddingTop:16,paddingInlineEnd:c.isPhone?wt().p8:wt().LP,paddingInlineStart:(c.isPhone?wt().p8:wt().LP)+8,minHeight:"45px"}})),[c.isPhone,l]);return"calendar-event"===s.type?(0,z.jsx)("div",{style:d.container,children:(0,z.jsx)(n(8264).o,{calendarEvent:s.event,id:t})}):"title"===s.type?(0,z.jsx)("div",{style:d.container,children:(0,z.jsx)(Ct().C,{disabled:i||"summarizing"===r,id:t})}):"summarizing"===s.type?(0,z.jsx)("div",{style:d.container,children:(0,z.jsx)(n(895432).N,{animate:!0,styleKey:"Title-lg/Semibold",text:a.formatMessage(Mt.loadingPlaceholder)})}):"idle"===s.type?(0,z.jsx)("div",{style:d.container,children:(0,z.jsx)(Ct().C,{disabled:i,id:t})}):"not-rendered"===s.type?null:void(0,U().HB)(s)}const Dt=_.memo(Bt)},380682:(e,t,n)=>{n.d(t,{A:()=>i});class o extends(()=>n(757695))().Store{getInitialState(){return{siteSettingContentType:"initial"}}}const i=new o},388182:(e,t,n)=>{n.d(t,{A:()=>o});const o=n(757695).Store.createValue({open:!1},{name:"ConfirmOverwriteModalStore"})},402528:(e,t,n)=>{n.d(t,{Jf:()=>A,Zr:()=>_,bO:()=>I,kO:()=>T});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(581454),n(737550);var o=()=>n(496506),i=()=>n(584262),r=()=>n(165358),a=()=>n(970412),s=()=>n(559506),c=()=>n(471995),l=()=>n(364499),d=()=>n(899206),u=()=>n(533336),p=()=>n(972435),m=()=>n(588703),v=()=>n(812109),g=()=>n(379560),f=()=>n(321172),h=()=>n(765957),S=()=>n(712505),y=()=>n(148832),b=()=>n(649021);const k=(0,n(69708).YK)({unableToCreateTranscriptionBlockForCalendarEvent:{id:"calendarEventActions.unableToCreateTranscriptionBlockForCalendarEvent",defaultMessage:"A transcription block could not be created for this calendar event."},sharedBlockWithParticipants:{id:"upcomingMeetings.sharedBlockWithParticipants",defaultMessage:"Participants in your workspace have edit access to this page."},sharedBlockWithParticipantsCta:{id:"upcomingMeetings.sharedBlockWithParticipants.cta",defaultMessage:"Manage access"},transcriptionBlockAlreadyExists:{id:"upcomingMeetings.transcriptionBlockAlreadyExists",defaultMessage:"A meeting note already exists for this calendar event."}});async function A(e){const{environment:t,event:n,from:o,parent:a}=e;let s=!1;const d=h().default.state.sidebarSpaceStore;if(!d)return{createdNewTranscriptionBlock:!1};let v=await _({event:n,environment:t,spaceStore:d});if(v)u().navigateToTranscriptionBlock({environment:t,blockStore:v,pageVisitSource:i().y8.UpcomingMeetingCalendarEvent,peekMode:"side_peek"});else{if(v=function(e){const{environment:t,from:n,event:o,parent:a}=e,s=u().createAndNavigateToTranscriptionBlock({environment:t,from:n,title:"title_with_event",pageVisitSource:i().y8.UpcomingMeetingCalendarEvent,peekMode:"side_peek",calendarEvent:o,sharedNote:!0,parent:a});return s||(r().log({level:"error",from:"calendarEventActions",type:"unableToCreateTranscriptionBlockForCalendarEvent",data:{miscDataToConvertToString:{eventId:o.id,from:n,parentId:a&&"string"!=typeof a?a.id:a}}}),void c().D6({label:p().A.formatMessage(k.unableToCreateTranscriptionBlockForCalendarEvent)}))}({environment:t,from:o,event:n,parent:a}),!v)return{createdNewTranscriptionBlock:!1};s=!0}return await S().default.waitUntil((()=>{var e;return S().default.isSidePeekOpen()&&Boolean(null===(e=S().default.peekTargetStore.state)||void 0===e?void 0:e.isReady())})),"upcoming_meeting_add_meeting_note"!==o||s||c().D6({label:p().A.formatMessage(k.transcriptionBlockAlreadyExists)}),async function(e){const{environment:t,event:n,transcriptionBlockStore:o,createdNewTranscriptionBlock:i}=e;if(!i||!o)return;o.isReady()||await o.load();const r=(0,m().r)({environment:t,store:o});if(r)return;if(!I(n))return;(0,l().L)({item:{label:p().A.formatMessage(k.sharedBlockWithParticipants)},showButton:!0,buttonText:p().A.formatMessage(k.sharedBlockWithParticipantsCta),onClick:()=>{(0,f().Tk)({environment:t,store:o})}})}({environment:t,event:n,createdNewTranscriptionBlock:s,transcriptionBlockStore:v}),{createdNewTranscriptionBlock:s,transcriptionBlockStore:v}}async function T(e){const{environment:t,event:n}=e,{createdNewTranscriptionBlock:o,transcriptionBlockStore:i}=await A({environment:t,from:"upcoming_meeting_start_transcribing",event:n});return await(0,d().startTranscribingBlockOnPageFromTrustedSource)({environment:t,from:"upcoming_meeting_start_transcribing"}),{createdNewTranscriptionBlock:o,transcriptionBlockStore:i}}async function _(e){const{event:t,spaceStore:n,environment:o}=e,{blockAttachments:i}=t;let c;const l=s().callApi({environment:o,eventName:"getTranscriptionBlockForEvent",data:{eventUid:t.uid,spaceId:n.id}});null!=i&&i.length&&(c=w({event:t,spaceStore:n}));const d=await l;if("failed"===d.type)return c;const u=d.data.transcriptionBlockPointers,p=new Set(u.map((e=>e.id))),m=new Set((null==i?void 0:i.map((e=>e.id)))??[]),f=(0,a()._)(p,m);return 0===f.size||(r().log({level:"warning",from:"maybeGetTranscriptionBlockStoreFromEvent",type:"missingTranscriptionRecordPointer",data:{miscDataToConvertToString:{missingPointers:Array.from(f),verifiedPointers:Array.from(p),localPointers:Array.from(m),eventId:t.id,spaceId:n.id}}}),g().A.updateStateForSidebarSpaceView((e=>{const o=null==e?void 0:e.events.get((0,v().z)(t));return o?(o.blockAttachments=[...Array.from(f).map((e=>({spaceId:n.id,table:"block",id:e}))),...o.blockAttachments??[]],e):e})),c=w({event:t,spaceStore:n})),c}const x=4e3;async function w(e){var t,n;const{event:i,spaceStore:r,timeoutMs:a=x}=e,s=(null===(t=i.blockAttachments)||void 0===t?void 0:t.map((e=>y().B.createChildStore(r,e))))??[];if(0===s.length)return;const c=new(o().ComputedStore)((()=>(0,b().g)({event:i,transcriptionBlockStores:s})),{debugName:`getPrimaryTranscriptionBlockStoreFromEvent-${i.uid}`});let l=c.getState();return"LOADING"===l.reason&&(l=await new Promise((e=>{const t=window.setTimeout((()=>{e(void 0),c.removeListener(n)}),a),n=o=>{"LOADING"!==o.getState().reason&&(e(o.getState()),clearTimeout(t),c.removeListener(n))};c.addListener(n)}))),null!==(n=l)&&void 0!==n&&n.primaryTranscriptionBlockStore?l.primaryTranscriptionBlockStore:void 0}function I(e){var t;return null===(t=e.attendees)||void 0===t?void 0:t.some((e=>e.notionUserId&&!e.self))}},405689:(e,t,n)=>{n.d(t,{t:()=>A});n(944114),n(816573),n(878100),n(177936),n(748140),n(821903),n(491134),n(128845),n(237467),n(444732),n(979577),n(898992),n(803949),n(581454),n(908872);var o=n(296540),i=()=>n(242422),r=()=>n(484714),a=()=>n(56366),s=()=>n(401497),c=()=>n(534177),l=()=>n(828634),d=()=>n(28834);var u=()=>n(964576),p=()=>n(964345);class m extends(()=>n(769985))().u{constructor(){super({getInitialState:()=>{},effect:()=>(this.setState((0,n(673903).G)(24e3)),()=>{this.setState(void 0)}),debugName:"SharedAudioContextStore"})}getInitialState(){}setState(e){this.instanceState&&this.instanceState.close(),super.setState(e)}}const v=new m;var g=n(474848);const f=50,h=7e3,S=50,y=14e3,b=3,k=3.9;function A(e){const{fillWidth:t=!1,forceRender:n=!1,fakeSoundwave:m=!1,rootBlockId:A}=e,{isMobile:T,isIOS:_,isMac:x}=(0,r().Y0)(),w=(0,a().K8)((()=>{if(!T)return;const e=i().default.getConfigKey("mobile_dictation_visualizer","lowshelf_filter_gain");if(_){var t;const n=null===(t=u().A.state)||void 0===t?void 0:t.label;if((0,c().O9)(n)&&"iPhone Microphone"!==n)return;return e+6}return e}),[T,_]),I=T?S:f,C=T?y:h,M=(0,o.useMemo)((()=>function(e=f,t=h){const n=(e+t)/2;return{frequencyRangeMin:e,frequencyRangeMax:t,frequencyLowerQuarter:(e+n)/2,frequencyUpperQuarter:(n+t)/2}}(I,C)),[I,C]),B=(0,a().K8)((()=>p().Ay.state.rootBlock&&p().Ay.state.rootBlock.id===A),[A]),D=(0,a().K8)((()=>p().Ay.state.audioRecorder),[]),E=(0,a().O$)(v),R=(0,o.useRef)(null),[N,j]=(0,o.useState)(8),[P,O]=(0,o.useState)([]),z=b,L=k;!function(e){const{isEnabled:t,numBars:n,barHeights:i,setBarHeights:r}=e,a=(0,o.useRef)(null);(0,o.useEffect)((()=>{if(a.current&&cancelAnimationFrame(a.current),!t)return;i.length!==n&&r(new Array(n).fill(3));const e={lastFrameTime:Date.now(),isSpeaking:!0,speakingBlendFactor:1,nextStateChangeTime:Date.now()+3e3+3e3*Math.random(),lastStateChangeTime:Date.now(),activityLevel:.8+.4*Math.random(),currentHeights:Array(n).fill(3)},o=Array(n).fill(0).map((()=>Math.random()*Math.PI*2)),s=Array(n).fill(0).map((()=>.85+.3*Math.random())),c=Array(n).fill(0).map((()=>.8+.4*Math.random())),l=.6+.15*Math.random(),d=.9+.2*Math.random(),u=2.8+1.2*Math.random(),p=()=>{const t=Date.now(),i=Math.min(.05,(t-e.lastFrameTime)/1e3);if(e.lastFrameTime=t,t>e.nextStateChangeTime){e.isSpeaking?e.isSpeaking=Math.random()>.85:e.isSpeaking=!0,e.lastStateChangeTime=t;const n=e.isSpeaking?1400:200,o=e.isSpeaking?3800:500,i=n+Math.random()*(o-n);e.nextStateChangeTime=t+i,e.isSpeaking&&(e.activityLevel=.9+.6*Math.random())}const m=e.isSpeaking?e.speakingBlendFactor:Math.max(.35,.45*e.speakingBlendFactor),v=e.isSpeaking?1:.4,g=e.isSpeaking?5:4.5;Math.abs(e.speakingBlendFactor-v)>.01?e.speakingBlendFactor<v?e.speakingBlendFactor=Math.min(v,e.speakingBlendFactor+i*g):e.speakingBlendFactor=Math.max(v,e.speakingBlendFactor-i*g):e.speakingBlendFactor=v;const f=.25*Math.sin(6e-4*t)+.85,h=e.activityLevel*f,S=Math.max(0,.7*Math.sin(.001*t)+.3),y=S>.55&&m>.5,b=y?1+.8*(S-.55):1,k=Array(n).fill(0).map(((r,a)=>{const p=a/(n-1),v=1-2*Math.abs(p-.5),g=Math.pow(v,.5),f=.006*t,S=Math.sin(f*s[a]+o[a])*c[a]+.5*Math.sin(2.2*f*s[(a+3)%n]+o[(a+2)%n])+.3*Math.sin(f*u*s[(a+1)%n]+o[(a+5)%n]),k=.7+.45*Math.sin(f*l+.1*a)+.35*Math.sin(f*d+o[a]),A=3+(S+1.2)*(y?6:5.5)*g*k*(m*h*b),T=A>e.currentHeights[a],_=Math.min(1,i*(T?25:16));return e.currentHeights[a]=e.currentHeights[a]*(1-_)+A*_,Math.max(3,Math.min(15,e.currentHeights[a]))}));r(k),a.current=requestAnimationFrame(p)};return a.current=requestAnimationFrame(p),()=>{a.current&&cancelAnimationFrame(a.current)}}),[t,n,i.length,r])}({isEnabled:m,numBars:N,barHeights:P,setBarHeights:O});const F=(0,o.useCallback)((()=>{if(t&&(D||n||m)&&R.current){const e=R.current.clientWidth,t=z+L,n=Math.max(1,Math.floor(e/t));j(n),O(new Array(n).fill(3))}}),[t,D,n,m,z,L]),U=(0,l().wY)(R),W=null==U?void 0:U.width;(0,o.useEffect)((()=>{W&&F()}),[W,F]),(0,o.useEffect)((()=>{if(n&&!m||!B&&D)O(new Array(N).fill(3));else if(D&&E&&!m){const e=new AbortController,t=e.signal,n=()=>{const{mediaStreams:e}=D;if(e&&e.length>0){const n=E.createChannelMerger(e.length),o=E.createAnalyser();o.fftSize=2048;const i=e.map((t=>{const o=[],i=E.createMediaStreamSource(t);if(o.push(i),(0,c().O9)(w)){const t=E.createGain();t.gain.setValueAtTime(w/e.length,E.currentTime),o.push(t)}else{var r;const e=null===(r=t.getAudioTracks().pop())||void 0===r?void 0:r.label;if(x&&e&&e.includes("Built-in")){const e=E.createGain();e.gain.setValueAtTime(6,E.currentTime),o.push(e)}}const a=E.createBiquadFilter();a.type="highpass",a.frequency.setValueAtTime(M.frequencyLowerQuarter,E.currentTime),o.push(a);const s=E.createBiquadFilter();return s.type="lowpass",s.frequency.setValueAtTime(M.frequencyUpperQuarter,E.currentTime),o.push(s),o.push(n),o}));n.connect(o),i.forEach((e=>{for(let t=0;t<e.length-1;t++)e[t].connect(e[t+1])}));const r=()=>{i.forEach((e=>{e.forEach((e=>e.disconnect()))})),n.disconnect(),o.disconnect()};E.resume();const a=new Uint8Array(o.frequencyBinCount),s=()=>{if(t.aborted)return void r();o.getByteFrequencyData(a);const e=E.sampleRate/2/o.frequencyBinCount,n=Math.round(M.frequencyRangeMin/e),i=Math.round(M.frequencyRangeMax/e),c=a.slice(n,i+1),l=Math.floor(c.length/N),d=[];for(let t=0;t<N;t++){const e=c.slice(t*l,t<N-1?(t+1)*l:c.length+1),n=e.reduce(((e,t)=>e+t),0)/e.length,o=Math.max(3,Math.min(12,n/3));d.push(o)}O(d),requestAnimationFrame(s)},l=requestAnimationFrame(s);return()=>{cancelAnimationFrame(l),r()}}};let o=n();const i=()=>{"function"==typeof o&&o(),o=n()};return D.emitter.on(d().Q,i),()=>{D.emitter.off(d().Q,i),"function"==typeof o&&o(),e.abort()}}}),[D,N,E,n,w,M,m,B,x]);const V=(0,s().IS)((e=>({barStyle:{flexShrink:0,bottom:"0",width:`${z}px`,backgroundColor:e.icon.tertiary,borderRadius:t?"4px":"1px"}})),[z,t]);return(0,g.jsx)("div",{ref:R,style:{height:"20px",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",gap:L,flex:t?1:void 0},children:P.map(((e,t)=>(0,g.jsx)("div",{style:{...V.barStyle,height:`${e}px`}},t)))})}},426175:(e,t,n)=>{n.d(t,{Ay:()=>l,X8:()=>s,dc:()=>c});n(944114),n(898992),n(354520),n(672577),n(908872);var o=()=>n(496506),i=()=>n(673903);class r extends(()=>n(757695))().Store{async updateMediaDevices(){try{const e=await async function(){const e=(0,i().E)();return(await e.enumerateDevices()).reduce(((e,t)=>{if(t.kind&&t.label&&t.deviceId&&t.groupId)switch(t.kind){case"videoinput":e.videoInput.push(t);break;case"audioinput":e.audioInput.push(t);break;case"audiooutput":e.audioOutput.push(t)}return e}),{videoInput:[],audioInput:[],audioOutput:[]})}();this.setState(e)}catch{}}constructor(){super();try{(0,i().E)().addEventListener("devicechange",(()=>{this.updateMediaDevices()}))}catch{}n(927648).Ay.addListener((()=>{this.updateMediaDevices()}))}getInitialState(){return{videoInput:[],audioInput:[],audioOutput:[]}}}const a=new r,s=new(o().ComputedStore)((()=>{var e,t;return(null===(e=a.state)||void 0===e||null===(e=e.audioInput)||void 0===e||null===(t=e.filter)||void 0===t?void 0:t.call(e,(e=>null==e?void 0:e.label)))??[]}),{debugName:"AudioInputDevicesStore"}),c=new(o().ComputedStore)((()=>{var e;const t=n(964576).A.state,o=null===(e=n(524007).d.state)||void 0===e?void 0:e.label,i=s.state.find((e=>e.label===o));return t||(i||s.state[0])}),{debugName:"SelectedAudioInputDeviceStore"}),l=a},427636:(e,t,n)=>{n.d(t,{A:()=>i});n(296540);var o=n(474848);const i=function(e){const{botStore:t,avatarSize:i,shouldShowBadge:r,style:a,inline:s}=e,c=(0,n(69708).tz)(),l=(0,n(484714).Y0)(),d=(0,n(56366).K8)((()=>null==t?void 0:t.getDisplayName(c)),[t,c]),{outerStyle:u,avatarWrapStyle:p,badgeStyle:m}=(0,n(401497).IS)((e=>({outerStyle:{display:"flex",alignItems:"center",minWidth:0,...a},avatarWrapStyle:s?{width:"none",minHeight:"none",marginInlineEnd:6}:{marginInlineEnd:6},badgeStyle:{padding:"2px 6px",borderRadius:4,color:e.text.secondary,background:e.legacyDefaultSelectColor,fontSize:n(726637).A.isMobile?11:9,lineHeight:l.isAndroid?1.5:1,textTransform:"uppercase",letterSpacing:"0.04em",marginInlineStart:8,marginTop:1}})),[a,s,l]);return(0,o.jsxs)("div",{style:u,children:[(0,o.jsx)("div",{style:p,children:(0,o.jsx)(n(256863).A,{botStore:t,size:i})}),(0,o.jsx)("div",{style:{...n(284371).RC},children:d}),r?(0,o.jsx)("div",{style:m,children:"Bot"}):void 0]})}},448693:(e,t,n)=>{n.d(t,{Ay:()=>b,t_:()=>k,v7:()=>A});n(296540);var o=()=>n(484714),i=()=>n(56366),r=()=>n(764880),a=()=>n(784892),s=()=>n(534177),c=()=>n(313364),l=()=>n(258836),d=()=>n(842677),u=()=>n(870092),p=()=>n(427636),m=()=>n(256863),v=()=>n(848401),g=()=>n(994006),f=()=>n(453697),h=n(474848);function S(e){const t=(0,o().v3)(),{actor:n,format:r,hasTooltip:S,tooltipHeader:b,hasPersonHoverCard:k}=e,A=(0,i().K8)((()=>{const e=n.asActor;return e&&d().RecordStores.createUniqueRootStore(t,e.pointer)}),[n,t]);return(0,h.jsx)(v().Ay,{...e,renderAvatar:e=>{if(A)return A instanceof l().v?r===a().NY.Inline?(0,h.jsx)(m().A,{botStore:A,size:e,style:y}):(0,h.jsx)(p().A,{botStore:A,avatarSize:e,inline:!0,style:y}):A instanceof u().L?r===a().NY.Inline?(0,h.jsx)(f().A,{userStore:A,size:e,avatarShouldShowShadow:!0,hasTooltip:S??!0,style:y,tooltipHeader:b,hasPersonHoverCard:k}):(0,h.jsx)(g().A,{userStore:A,avatarSize:e,inline:!0,hasTooltip:S,hasPersonHoverCard:k,style:y,tooltipHeader:b}):void(A instanceof c().p||(0,s().HB)(A))}})}const y={minWidth:0};S.Format=a().NY;const b=S;function k(e){const{userValue:t,...n}=e;return(0,h.jsx)(S,{actor:(0,r().MR)(t),...n})}function A(e){const{botValue:t,...n}=e;return(0,h.jsx)(S,{actor:(0,r().oC)(t),...n})}k.Format=v().mI,A.Format=v().mI},448801:(e,t,n)=>{n.d(t,{i:()=>i});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698);var o=()=>n(371562);o();function i(e,t){const n=o().create({arrays:{detectMove:!1,includeValueOnMove:!0}}).diff(e,t);if(!n)return{beforeOps:{},removeOps:new Set};let i=[],r=[];for(const o in n)"_t"!==o&&("_"===o[0]?i.push(parseInt(o.slice(1),10)):1===n[o].length&&r.push({index:parseInt(o,10),value:n[o][0]}));const a={},s=new Set,c=[...e];i=i.sort(((e,t)=>e-t));for(let o=i.length-1;o>=0;o--){const e=i[o],t=c.splice(e,1)[0];s.add(t)}r=r.sort(((e,t)=>e.index-t.index));for(let o=0;o<r.length;o++){const e=r[o];a[e.value]=c[e.index],c.splice(e.index,0,e.value)}return{beforeOps:a,removeOps:s}}},460739:(e,t,n)=>{n.d(t,{HT:()=>h,xw:()=>f,u:()=>k,MZ:()=>b,Qy:()=>S});n(16280);var o=()=>n(564884),i=()=>n(836095),r=()=>n(75435),a=()=>n(44551);function s(e){var t;null===a().electronApi||void 0===a().electronApi||null===(t=a().electronApi.openSystemSettings)||void 0===t||t.call(a().electronApi,e)}var c=()=>n(577142),l=()=>n(767877),d=()=>n(112799),u=()=>n(844514),p=()=>n(673903),m=()=>n(927648);const v=(0,n(69708).YK)({latestVersionStepTitle:{id:"transcriptionSetupSteps.latestVersionStepTitle",defaultMessage:"Update the Notion app"},latestVersionStepDescription:{id:"transcriptionSetupSteps.latestVersionStepDescription",defaultMessage:"Update to the latest version of the Notion app to use AI Meeting Notes."},latestVersionStepActionText:{id:"transcriptionSetupSteps.latestVersionStepActionText",defaultMessage:"Update my Notion app"},microphoneStepTitle:{id:"transcriptionSetupSteps.microphoneStepTitle",defaultMessage:"Enable microphone access"},microphoneStepDescription:{id:"transcriptionSetupSteps.microphoneStepDescription",defaultMessage:"This allows Notion AI to transcribe what you say."},microphoneStepActionText:{id:"transcriptionSetupSteps.microphoneStepActionText",defaultMessage:"Enable microphone access"},systemAudioStepTitle:{id:"transcriptionSetupSteps.systemAudioStepTitle",defaultMessage:"Enable screen & system audio access"},systemAudioStepDescription:{id:"transcriptionSetupSteps.systemAudioStepDescription",defaultMessage:"This allows Notion AI to transcribe what everyone else is saying (even on headphones)."},systemAudioStepActionText:{id:"transcriptionSetupSteps.systemAudioStepActionText",defaultMessage:"Enable access"},restartAppStepTitle:{id:"transcriptionSetupSteps.restartAppStepTitle",defaultMessage:"Restart Notion"},restartAppStepDescription:{id:"transcriptionSetupSteps.restartAppStepDescription",defaultMessage:"Final step! Restart your Notion app to apply the permissions."},restartAppStepActionText:{id:"transcriptionSetupSteps.restartAppStepActionText",defaultMessage:"Restart Notion app"}}),g=[{id:"desktop-app-version",title:v.latestVersionStepTitle,description:v.latestVersionStepDescription,hasCompleted:e=>Promise.resolve(k(e.environment)),actionText:v.latestVersionStepActionText,action:async e=>{const t=await(0,d().a)(e.environment.device);t?await(0,i().P)(n(726637).A.domainBaseUrl+t):await(0,i().P)("https://www.notion.so/desktop")}},{id:"microphone",title:v.microphoneStepTitle,description:v.microphoneStepDescription,hasCompleted:async e=>{if(e.environment.device.isElectronWindows)return!0;if(e.environment.device.isElectron){if("granted"===await async function(e){var t;return null===a().electronApi||void 0===a().electronApi||null===(t=a().electronApi.getMediaAccessStatus)||void 0===t?void 0:t.call(a().electronApi,e)}("microphone"))return!0;if(e.isConfirmation)try{return await S(),!0}catch{return!1}}return!1},actionText:v.microphoneStepActionText,action:async e=>{try{await S()}catch(t){t instanceof Error&&t.name===m().nY&&s("microphone")}}},{id:"system-audio",title:v.systemAudioStepTitle,description:v.systemAudioStepDescription,hasCompleted:async e=>{if(e.environment.device.isElectronWindows)return!0;if(e.isConfirmation){if(await y())return!0}return Promise.resolve(void 0!==m().Ay.getHasAttemptedScreenRecordingPermissions())},actionText:v.systemAudioStepActionText,action:async e=>{const t=await y();m().Ay.setHasAttemptedScreenRecordingPermissions(t?m().a3:m().JS),t&&t===m().a3||s("screen-recording")}},{id:"restart-app",title:v.restartAppStepTitle,description:v.restartAppStepDescription,hasCompleted:async e=>{if(e.environment.device.isElectron&&e.isConfirmation){if("allowed"===await y())return!0}return Promise.resolve(!1)},actionText:v.restartAppStepActionText,action:async()=>{var e;return null===a().electronApi||void 0===a().electronApi||null===(e=a().electronApi.relaunch)||void 0===e||e.call(a().electronApi),Promise.resolve()}}];function f(){return g}async function h(e){if((0,u().C)(e))return"startDictation";if(e.device.isMobile)return"startDictation";if(e.device.isBrowser)return"noBrowserSupport";if(e.device.isElectron&&e.device.isMac&&void 0!==e.device.osVersion[0]&&e.device.osVersion[0]>10&&e.device.osVersion[0]<=12)return"requiresMacOS13";const t=await async function(e,t){for(const n of t)if(!(await n.hasCompleted({environment:e,isConfirmation:!1})))return n}(e,f());return"desktop-app-version"===(null==t?void 0:t.id)||"microphone"===(null==t?void 0:t.id)?"showSetupModal":"startDictation"}async function S(){const e=(0,p().E)(),t=await e.getUserMedia({audio:!0});for(const n of t.getTracks())n.stop()}async function y(){try{const e=await(0,n(763824).nQ)(5e3,(0,m().Kj)());return e.timeout?m().JS:e.result}catch{return m().JS}}async function b(e){const{environment:t,registered:n,source:i,url:r}=e;if(n)return(0,o().u)({environment:t,event:{eventName:"open_transcription_block_in_desktop_app_clicked",eventProperties:{source:i}}}),void(await(0,l().e)({environment:t,url:r}));await async function(e,t){const n=await(0,d().a)(e.device);if(!n)return;(0,o().u)({environment:e,event:{eventName:"download_app_for_transcription_clicked",eventProperties:{source:t}}}),(0,c().navigate)({environment:e,url:n,openInNew:"tab"})}(t,i)}function k(e){const t=r().A.state.transcriptionSupportLevel;return Boolean(t)}},482871:(e,t,n)=>{n.d(t,{z:()=>d});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(430670),n(581454);var o=()=>n(898244),i=()=>n(448801),r=()=>n(179034),a=()=>n(722101),s=()=>n(878710),c=(n(354520),()=>n(496603));function l(e){const{collectionContextStore:t,collectionViewStore:n,transaction:i}=e,l=n.getPageSortStore(),d=l.getValue(),u=t.groupsStore.getAllGroupStates(),p=function(e){const{pageSort:t,currentResults:n}=e;if(!t||t.length<=o().WF)return[];const i=t.filter((e=>!n.has(e)));return c().sb([...i.reverse(),...c().o8(t).reverse()]).slice(0,t.length-o().WF)}({pageSort:d,currentResults:new Set(u.flatMap((e=>e.resultsStore.state.map((e=>e.id)))))});for(const o of p)a().TF({parentStore:l,childToRemoveStore:(0,s().v3)(l,{table:r().ev,id:o}),transaction:i})}function d(e){const{resultIds:t,collectionViewStore:n,collectionContextStore:c,transaction:d}=e,u=n.getPageSortStore(),p=u.getValue()||[],{beforeOps:m}=(0,i().i)(p,t.slice(0,o().WF));for(const[o,i]of Object.entries(m))if(i){const e=(0,s().v3)(n,{table:r().ev,id:i});a().nc({parentStore:u,insertStore:(0,s().v3)(n,{table:r().ev,id:o}),beforeStore:e,transaction:d})}else{const e=t.findIndex((e=>e===o)),i=t[e-1],c=i?(0,s().v3)(n,{table:r().ev,id:i}):void 0;a().WH({parentStore:u,insertStore:(0,s().v3)(n,{table:r().ev,id:o}),afterStore:c,transaction:d})}l({collectionContextStore:c,collectionViewStore:n,transaction:d})}},484705:(e,t,n)=>{n.d(t,{k:()=>u});var o=n(296540),i=()=>n(564884),r=()=>n(312788),a=()=>n(484714),s=()=>n(69708),c=()=>n(104012),l=()=>n(540144),d=n(474848);function u({blockId:e,isDemo:t=!1}){const{navigate:n}=(0,o.useContext)(r().E),u=(0,a().v3)(),p=(0,o.useCallback)((()=>{(0,i().u)({environment:u,event:{eventName:"transcription_permission_error_help_clicked",eventProperties:{is_demo:t,block_id:e}}}),n({environment:u,url:(0,l().zv)()})}),[u,t,e,n]);return(0,d.jsx)(c().Ag,{onClick:p,children:(0,d.jsx)(s().sA,{defaultMessage:"Get help",id:"dictation.permission.snackbar.getHelpButton.title"})})}},491848:(e,t,n)=>{n.d(t,{w:()=>i});n(898992),n(672577);var o=()=>n(755199);function i({collectionContextStore:e,transaction:t}){const n="collectionTypedView"===e.contextType,i=e.databaseType,r=e.collectionStoresStore.state,a=r.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly()))||r[0];!n&&a&&o().ee({transaction:t,databaseType:i,collectionId:a.id})}},520689:(e,t,n)=>{n.d(t,{i:()=>i});var o=()=>n(44551);async function i(){return null!==o().electronApi&&void 0!==o().electronApi&&o().electronApi.getMeetingNotificationNonce?await o().electronApi.getMeetingNotificationNonce():""}},524007:(e,t,n)=>{n.d(t,{d:()=>o});const o=new(n(178624).R)({key:"preferred_audio_input_device",namespace:n(553737).cd,important:!0,trackingType:"preference"})},533336:(e,t,n)=>{n.r(t),n.d(t,{appendTranscriptionBlockToPage:()=>E,createAndNavigateToTranscriptionBlock:()=>N,createTranscriptionBlock:()=>j,navigateToTranscriptionBlock:()=>R});n(944114),n(898992),n(354520);var o=()=>n(906745),i=()=>n(584262),r=()=>n(700500),a=()=>n(597777),s=()=>n(604995),c=()=>n(416504),l=()=>n(201980),d=()=>n(534177),u=()=>n(557281),p=()=>n(669548),m=()=>n(44729),v=()=>n(579627),g=()=>n(857783),f=()=>n(281948),h=()=>n(185544),S=()=>n(319975),y=()=>n(231297),b=()=>n(87017),k=()=>n(495506),A=(n(672577),()=>n(379560)),T=()=>n(338931);var _=()=>n(211716),x=()=>n(972435),w=()=>n(812109),I=()=>n(765957),C=()=>n(148832),M=()=>n(543665),B=()=>n(711207);const D=(0,n(69708).YK)({newPage:{id:"transcriptionCreateActions.newPage.title",defaultMessage:"Try AI Meeting Notes "}});function E(e){const{environment:t,from:n}=e;y().createAndCommit({userAction:"transcriptionCreateActions.appendTranscriptionBlock",environment:t,canUndo:!0,perform:e=>{(0,b().insertBlockBelow)({environment:t,createBlockItem:k().ry[r().xd.transcription],analyticsFrom:n??"quick_templates",selection:[],transaction:e})}})}function R(e){const{environment:t,origin:n,peekMode:o,blockStore:i,pageVisitSource:r}=e;o?f().VU({environment:t,openInNew:void 0,store:i,peekMode:o,pageVisitSource:r,resultsStore:void 0,collectionContextStore:void 0}):g().uK({environment:t,store:i,visitType:_().ig.Link,pageVisitSource:r,origin:n})}function N(e){const{environment:t,from:n,title:o,origin:r,parent:a,calendarEvent:s,peekMode:c,sharedNote:l,pageVisitSource:d=i().y8.Create}=e;let u;if(u=j(l?{environment:t,from:n,title:o,parent:a,calendarEvent:s,sharedNote:l}:{environment:t,from:n,title:o,parent:a,calendarEvent:s}),u)return R({environment:t,blockStore:u.pageStore,pageVisitSource:d,origin:r,peekMode:c}),u.transcriptionBlockStore}function j(e){const{environment:t,from:n,title:i,parent:g,calendarEvent:f,sharedNote:b}=e,_=I().default.state.sidebarSpaceStore,E=I().default.state.sidebarSpaceViewStore;if(!_||!E)return;const{performResult:R}=y().createAndCommit({userAction:"transcriptionCreateActions.createTranscriptionBlock",environment:t,canUndo:!1,perform:e=>{var y;const w=null===(y=I().default.state.sidebarSpaceViewStore)||void 0===y||null===(y=y.getSettings())||void 0===y||null===(y=y.default_meeting_notes_location)||void 0===y?void 0:y.collection,R="private"===g||"none"===g||"collection"===(null==g?void 0:g.table)||!g,N=R?h().IT({environment:t,spaceStore:_,spaceViewStore:E,parent:g??w??"private",transaction:e}):C().B.createChildStore(E,g);if(!N.isType(r().xd.page))return;if(b){const n=[];for(const e of f.attendees??[])e.notionUserId&&n.push({type:"user_permission",role:"editor",user_id:e.notionUserId});n.length&&v().zP({environment:t,store:N,permissionItems:n,transaction:e})}if(R){const n=function(e,t){var n,i,r;let u,p;switch(e){case"title_with_event":let e;if(t){const{startTime:n}=B().Wm(t);e={summary:t.summary,startDateTime:n}}else e=function(){const e=A().A.getEvents(),t=A().A.getCurrentAccounts();if(!e||0===e.length)return;const n=e.filter((e=>!e.isAllDay&&o().c9.fromISO(e.start.dateTime,{zone:e.start.timeZone}).toISODate()===o().c9.now().toISODate())),i=(0,T().y6)({events:n,accounts:t,thresholds:void 0,filters:void 0}).find((e=>{const t=e.attendees??[];return!(e.isAllDay||"accepted"!==e.responseStatus||!e.summary||t.length<1)}));if(null!=i&&i.summary&&!i.isAllDay){const e=o().c9.fromISO(i.start.dateTime,{zone:i.start.timeZone});return{summary:i.summary,startDateTime:e}}}();u=null!==(n=e)&&void 0!==n&&n.summary?[`${e.summary} `]:void 0,p=null===(i=e)||void 0===i?void 0:i.startDateTime;break;case"new_page":u=[x().A.getIntl().formatMessage(D.newPage)];break;default:u=void 0,p=void 0}const m=(0,c().P)();p=(null===(r=p)||void 0===r?void 0:r.setZone(m))??o().c9.now();const v=[u,l().wmz(l().Ww9({type:"datetime",start_date:p.toFormat(s().tr),start_time:p.toFormat(a().GE),time_zone:m,date_format:"relative"}),[[l().BQP.Bold]])].filter(d().O9);return v}(i,f),r=N.getBlockTitleStore();S().yr({environment:t,store:r,tokens:n,transaction:e,index:0})}else if(w){const o=M().m.createChildStore(_,w);if(o){const i=o.getDefaultTemplatePageStore();i&&u().n5({title:"template",environment:t,store:N,templateStore:i,isKeyboard:!1,isCreateIn:!1,transaction:e,from:n})}}const j=k().ry.transcription,P=p().w({environment:t,transaction:e,inMemoryRecordCache:_.inMemoryRecordCache,from:n,selection:[],spaceId:_.id,createBlockItem:j});return f&&(B().Ud({blockStore:P,event:f,transaction:e,environment:t}),B().bk({blockStore:P,event:f,transaction:e,environment:t})),m().Ti({childStore:P,parentStore:N,transaction:e}),{createdTranscriptionBlock:P,createdPage:N}}});return R?(A().A.updateStateForSidebarSpaceView((e=>{const t=R.createdTranscriptionBlock.pointer;return e&&f?(e.events.append((0,w().z)(f),{...f,blockAttachments:[t,...f.blockAttachments??[]]},{keepOrdering:!0}),e):e})),{transcriptionBlockStore:R.createdTranscriptionBlock,pageStore:R.createdPage}):void 0}},541235:(e,t,n)=>{n.d(t,{Ud:()=>a,YD:()=>r,c$:()=>o,q_:()=>i});const o={"sprints-onboarding":{steps:[{id:"current-sprint-view-tooltip"},{id:"sprint-task-tooltip"},{id:"complete-sprint-button-tooltip"}]},"enhanced-qna-onboarding":{steps:[{id:"find-in-tooltip"},{id:"mention-tooltip"}]},"jira-sync-onboarding":{steps:[{id:"all-projects-tooltip"},{id:"all-issues-tooltip"},{id:"database-views-and-filters-tooltip"},{id:"settings-to-setup-projects-and-issues"}]},"project-management-import-onboarding":{steps:[{id:"your-teamspace-tooltip"},{id:"all-projects-tooltip"},{id:"navigate-to-project-tasks-tooltip"},{id:"project-customization-tooltip"},{id:"related-tasks-database-views-tooltip"}]},"ai-comment-onboarding":{steps:[{id:"ai-comment-onboarding-tooltip"}]},database_onboarding:{steps:[{id:"database_onboarding_status_property_tooltip"},{id:"database_onboarding_add_property_tooltip"},{id:"database_onboarding_database_page_tooltip"},{id:"database_onboarding_board_view_tooltip"}]}},i="completed",r="dismissed";function a(e,t){return null==t?void 0:t[e]}},563884:(e,t,n)=>{n.d(t,{k:()=>i});n(296540);var o=n(474848);const i=(0,n(340498).wt)("calendar",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M3.24902 14.7764H12.6621C14.1455 14.7764 14.918 14.0107 14.918 12.5479V4.22852C14.918 2.76562 14.1455 2 12.6621 2H3.24902C1.77246 2 1 2.75879 1 4.22852V12.5479C1 14.0107 1.77246 14.7764 3.24902 14.7764ZM3.24219 13.416C2.6748 13.416 2.36035 13.1221 2.36035 12.5205V6.23145C2.36035 5.62988 2.6748 5.33594 3.24219 5.33594H12.6689C13.2363 5.33594 13.5508 5.62988 13.5508 6.23145V12.5205C13.5508 13.1221 13.2363 13.416 12.6689 13.416H3.24219ZM6.63965 7.69434H7.04297C7.28906 7.69434 7.37109 7.61914 7.37109 7.37988V6.97656C7.37109 6.73047 7.28906 6.65527 7.04297 6.65527H6.63965C6.39355 6.65527 6.31152 6.73047 6.31152 6.97656V7.37988C6.31152 7.61914 6.39355 7.69434 6.63965 7.69434ZM8.875 7.69434H9.27832C9.51758 7.69434 9.59961 7.61914 9.59961 7.37988V6.97656C9.59961 6.73047 9.51758 6.65527 9.27832 6.65527H8.875C8.62891 6.65527 8.54688 6.73047 8.54688 6.97656V7.37988C8.54688 7.61914 8.62891 7.69434 8.875 7.69434ZM11.1035 7.69434H11.5068C11.7529 7.69434 11.835 7.61914 11.835 7.37988V6.97656C11.835 6.73047 11.7529 6.65527 11.5068 6.65527H11.1035C10.8643 6.65527 10.7822 6.73047 10.7822 6.97656V7.37988C10.7822 7.61914 10.8643 7.69434 11.1035 7.69434ZM4.41113 9.89551H4.80762C5.05371 9.89551 5.13574 9.82031 5.13574 9.57422V9.1709C5.13574 8.93164 5.05371 8.85645 4.80762 8.85645H4.41113C4.16504 8.85645 4.08301 8.93164 4.08301 9.1709V9.57422C4.08301 9.82031 4.16504 9.89551 4.41113 9.89551ZM6.63965 9.89551H7.04297C7.28906 9.89551 7.37109 9.82031 7.37109 9.57422V9.1709C7.37109 8.93164 7.28906 8.85645 7.04297 8.85645H6.63965C6.39355 8.85645 6.31152 8.93164 6.31152 9.1709V9.57422C6.31152 9.82031 6.39355 9.89551 6.63965 9.89551ZM8.875 9.89551H9.27832C9.51758 9.89551 9.59961 9.82031 9.59961 9.57422V9.1709C9.59961 8.93164 9.51758 8.85645 9.27832 8.85645H8.875C8.62891 8.85645 8.54688 8.93164 8.54688 9.1709V9.57422C8.54688 9.82031 8.62891 9.89551 8.875 9.89551ZM11.1035 9.89551H11.5068C11.7529 9.89551 11.835 9.82031 11.835 9.57422V9.1709C11.835 8.93164 11.7529 8.85645 11.5068 8.85645H11.1035C10.8643 8.85645 10.7822 8.93164 10.7822 9.1709V9.57422C10.7822 9.82031 10.8643 9.89551 11.1035 9.89551ZM4.41113 12.0898H4.80762C5.05371 12.0898 5.13574 12.0146 5.13574 11.7754V11.3721C5.13574 11.126 5.05371 11.0508 4.80762 11.0508H4.41113C4.16504 11.0508 4.08301 11.126 4.08301 11.3721V11.7754C4.08301 12.0146 4.16504 12.0898 4.41113 12.0898ZM6.63965 12.0898H7.04297C7.28906 12.0898 7.37109 12.0146 7.37109 11.7754V11.3721C7.37109 11.126 7.28906 11.0508 7.04297 11.0508H6.63965C6.39355 11.0508 6.31152 11.126 6.31152 11.3721V11.7754C6.31152 12.0146 6.39355 12.0898 6.63965 12.0898ZM8.875 12.0898H9.27832C9.51758 12.0898 9.59961 12.0146 9.59961 11.7754V11.3721C9.59961 11.126 9.51758 11.0508 9.27832 11.0508H8.875C8.62891 11.0508 8.54688 11.126 8.54688 11.3721V11.7754C8.54688 12.0146 8.62891 12.0898 8.875 12.0898Z"})})},580648:(e,t,n)=>{n.d(t,{o:()=>l});n(296540);var o=()=>n(56366),i=()=>n(914462),r=()=>n(69708),a=()=>n(173783),s=()=>n(187820),c=n(474848);function l(e){const{group:t}=e,n=e.size??20,l=(0,r().tz)(),d=(0,o().K8)((()=>{if(t&&t.icon)return{pointer:t.pointer,icon:t.icon}}),[t]),u=(0,o().K8)((()=>(0,i().n)({intl:l,permissionGroupModel:t})),[l,t]);return(0,c.jsx)("div",{children:d?(0,c.jsx)(s().B6,{disabled:!0,size:n,icon:d,isEmptyPage:!1,title:u}):(0,c.jsx)(a().A,{size:n})})}},595345:(e,t,n)=>{n.d(t,{$g:()=>o().$g,UJ:()=>o().UJ,qY:()=>i().getCurrentClientSessionId,sN:()=>o().sN});var o=()=>n(262089),i=()=>n(99874)},625194:(e,t,n)=>{n.d(t,{m:()=>a});var o=n(296540),i=()=>n(96330),r=n(474848);const a=o.memo((function(e){const{textValue:t}=e,n=(0,o.useMemo)((()=>(0,i().X1)((0,i().eC)(t))),[t]);return(0,r.jsx)("span",{children:n})}))},627503:(e,t,n)=>{n.d(t,{a:()=>i});n(296540);const o={viewBox:"0 0 16 16",fittedViewBox:"1.37 1.37 13.25 13.25",svg:(0,n(474848).jsx)("path",{d:"M3.25 1.375c-1.036 0-1.875.84-1.875 1.875v6c0 1.036.84 1.875 1.875 1.875h1.625v1.625c0 1.036.84 1.875 1.875 1.875h6c1.036 0 1.875-.84 1.875-1.875v-6c0-1.036-.84-1.875-1.875-1.875h-1.625V3.25c0-1.036-.84-1.875-1.875-1.875zM2.625 3.25c0-.345.28-.625.625-.625h6c.345 0 .625.28.625.625v1.625H6.75c-1.036 0-1.875.84-1.875 1.875v3.125H3.25a.625.625 0 0 1-.625-.625zm3.5 3.5c0-.345.28-.625.625-.625h6c.345 0 .625.28.625.625v6c0 .345-.28.625-.625.625h-6a.625.625 0 0 1-.625-.625z"})},i=(0,n(340498).wt)("duplicateSmall",o)},637368:(e,t,n)=>{n.r(t),n.d(t,{isExplainableTranscriptionStopReason:()=>w,meetingNotificationClicked:()=>I,showTranscriptionRecordingStoppedToast:()=>_});var o=()=>n(584262),i=()=>n(120282),r=()=>n(530199),a=()=>n(100622),s=()=>n(939768),c=()=>n(520689),l=()=>n(857783),d=()=>n(27579),u=()=>n(577142),p=()=>n(812182),m=()=>n(492414),v=()=>n(972435),g=()=>n(321032),f=()=>n(402528),h=()=>n(32254),S=()=>n(379560),y=()=>n(765957),b=()=>n(148832),k=()=>n(540144),A=()=>n(811031),T=()=>n(533336);function _(e,t){const{pointer:n,from:r}=t,s=y().AppStoreSidebarSpaceStore.state;if(!s)return;const c=b().B.createChildStore(s,n);if(null==c||!c.isTranscriptionBlock()||"transcribing"===(0,k().by)(c).state)return;if(!w(r))return;const d=c.pathIsAccessibleAndAlive(),u=x[r];p().Iz({id:"transcription_recording_stopped",icon:()=>(0,i().a)({color:a().Tj.invertedTextColor,height:16,width:16}),presentationType:"persistent",title:v().A.getIntl().formatMessage({id:"transcriptionRecordingStopped.toast.title",defaultMessage:"Your meeting has stopped recording"}),message:v().A.getIntl().formatMessage(u),actions:d?{primary:{title:v().A.getIntl().formatMessage({id:"transcriptionRecordingStopped.toast.action.goToMeetingNote",defaultMessage:"Go to meeting note"}),onAction:()=>{p().UW("transcription_recording_stopped"),l().uK({environment:e,store:c,pageVisitSource:o().y8.TranscriptionRecordingStoppedNotification})}}}:void 0})}const x=(0,n(69708).YK)({block_not_available:{id:"transcriptionRecordingStopped.toast.subtitle.blockNotAvailable",defaultMessage:"You no longer have access to this meeting note."},block_not_dictatable:{id:"transcriptionRecordingStopped.toast.subtitle.blockNotDictatable",defaultMessage:"The meeting note was deleted or is no longer accessible."},space_switch:{id:"transcriptionRecordingStopped.toast.subtitle.spaceSwitch",defaultMessage:"The meeting note is in another workspace."},missing_user_or_space:{id:"transcriptionRecordingStopped.toast.subtitle.missingUserOrSpace",defaultMessage:"Something went wrong with your account."},audio_recorder_stopped:{id:"transcriptionRecordingStopped.toast.subtitle.audioRecorderStopped",defaultMessage:"Something went wrong while recording your audio."},transcription_block_stopped:{id:"transcriptionRecordingStopped.toast.subtitle.transcriptionBlockStopped",defaultMessage:"The meeting note was stopped."}});function w(e){return"button"!==e&&"mobile_bar_button"!==e&&"rate_limit"!==e&&"upgrade_required"!==e&&"transcription_error"!==e&&"shortcut"!==e&&"block_action"!==e&&"topbar_menu"!==e&&"native_action"!==e&&"template_picker"!==e&&"horizontal_template_picker"!==e&&"quick_add"!==e&&"new_page_and_dictate_shortcut"!==e&&"new_page_and_dictate_action"!==e&&"transcription_block"!==e&&"forbidden"!==e&&"start_transcription_error"!==e&&"block_not_visible"!==e}function I(e){var t,n,i;const{environment:a,notification:l}=e,p=y().AppStoreSidebarSpaceStore.state,v=null===(t=l.transcriptionState)||void 0===t?void 0:t.state,k=null===(n=l.transcriptionState)||void 0===n?void 0:n.blockId;if(p&&v&&k){const e=b().B.createChildStore(p,{id:k,table:"block",spaceId:p.id});return void(0,A().K)({environment:a,blockStore:e})}const _=l.event?S().A.getEvent(l.event):void 0;"joinMeeting"===l.intent&&null!=_&&null!==(i=_.conferencing)&&void 0!==i&&i.url?(0,d().L)({environment:a,url:_.conferencing.url}):async function(e){var t;const{environment:n,event:i,autoStart:a}=e,l=null===(t=S().A.getHomeCalendarStateForSpaceView())||void 0===t?void 0:t.botId,d=y().AppStoreSidebarSpaceStore.state,p=i&&d?await(0,f().Zr)({event:i,spaceStore:d,environment:n}):void 0;if(p)return void C({environment:n,blockStore:p,autoStart:a});if(i&&l)!async function(e){const{environment:t,autoStart:n}=e,i=await async function(e){const{environment:t,event:n,calendarBotId:o,from:i,autoStart:a}=e,l=await(0,h().NC)({environment:t,botId:o,event:n,meetingNote:n.meetingNote,from:i});if("failed"===l.type)return;let d=l.data.page.url;if(a){const e=await(0,c().i)();e&&(d=s().O$(d,{[r().Gh]:e}))}return d}(e);if((0,g().R)(t,{botId:e.calendarBotId,payload:{type:"track",payload:{event:"meetingNoteClicked",eventId:e.event.id,product:"notion",from:e.from}}}),i)(0,u().navigate)({environment:t,url:i});else{const e=(0,T().createTranscriptionBlock)({environment:t,from:"audio_process_detection",title:"none"});if(null!=e&&e.transcriptionBlockStore&&n){const n=(0,m().Ay)({store:e.transcriptionBlockStore,pageVisitSource:o().y8.TranscriptionBlockNotification});(0,u().navigate)({environment:t,url:n})}}}({environment:n,event:i,from:"calendar_event_notification",calendarBotId:l,autoStart:a});else{const e=(0,T().createTranscriptionBlock)({environment:n,from:"audio_process_detection",title:"none"});null!=e&&e.transcriptionBlockStore&&C({environment:n,blockStore:e.transcriptionBlockStore,autoStart:a})}}({environment:a,event:_,autoStart:l.autoStart})}async function C(e){const{environment:t,blockStore:n,autoStart:i}=e,r=i?await(0,c().i)():void 0,a=(0,m().Ay)({store:n,pageVisitSource:o().y8.TranscriptionBlockNotification,autoStartTranscriptionNonce:r});(0,u().navigate)({environment:t,url:a})}},649021:(e,t,n)=>{n.d(t,{d:()=>p,g:()=>m});n(944114),n(898992),n(823215),n(354520),n(581454);var o=()=>n(906745),i=()=>n(416504),r=()=>n(540144),a=()=>n(90857),s=()=>n(148832),c=()=>n(684475),l=()=>n(833733);const d=o().dw.fromObject({hours:6}),u=o().dw.fromObject({hours:24});function p(e){const t=c().Ku.getLastEvaluatedNow(),n=l().wK.getState(),o=(0,i().P)(),r=t.minus(d),p=t.plus(u),m={};for(const i of n){const t=(0,a().S6)(i,o),n=(0,a().JF)(i,o);if(!(t<r||n>p))for(const o of i.blockAttachments??[])m[i.id]??={event:i,transcriptionBlockStores:[]},m[i.id].transcriptionBlockStores.push(s().B.createChildStore(e,o))}return m}function m(e){const{event:t,transcriptionBlockStores:n}=e;if(0===n.length)return{primaryTranscriptionBlockStore:void 0,reason:"NO_ALIVE_TRANSCRIPTION_BLOCKS"};if(!function(e){return e.every((e=>e.isReady()))}(n))return{primaryTranscriptionBlockStore:void 0,reason:"LOADING"};const o=function(e){return e.filter((e=>e.pathIsAccessibleAndAlive()&&e.isTranscriptionBlock()))}(n);if(0===o.length)return{primaryTranscriptionBlockStore:void 0,reason:"NO_ALIVE_TRANSCRIPTION_BLOCKS"};if(1===o.length){const e=o[0];return{primaryTranscriptionBlockStore:e,state:(0,r().by)(e),reason:"ONLY_ONE_TRANSCRIPTION_BLOCK"}}const i=function(e){return e.filter((e=>"transcribing"===(0,r().by)(e).state))}(n);if(1===i.length){const e=i[0];return{primaryTranscriptionBlockStore:e,state:(0,r().by)(e),reason:"ACTIVE_TRANSCRIBING"}}const a=0===i.length?o:i;if(!function(e){return e.every((e=>e.getPermissionItemsStore().isReady()))}(a))return{primaryTranscriptionBlockStore:void 0,reason:"LOADING"};const s=function(e,t){var n,o;const i=null===(n=t.attendees)||void 0===n?void 0:n.map((e=>e.notionUserId)).filter((e=>void 0!==e));let r;for(const c of e){var a;let e=0;for(const n of i??[])c.getUserPermissionForId(n)&&e++;const t=(null===(a=r)||void 0===a?void 0:a.overlappingPermissions)??0;var s;e!==t?e>t&&(r={stores:[c],overlappingPermissions:e}):(r??={stores:[],overlappingPermissions:e},null===(s=r)||void 0===s||s.stores.push(c))}return(null===(o=r)||void 0===o?void 0:o.stores)??[]}(a,t);if(1===s.length){const e=s[0];return{primaryTranscriptionBlockStore:e,state:(0,r().by)(e),reason:"MOST_PERMISSIVE"}}const c=function(e){var t;let n;for(const r of e){var o,i;const e=null===(o=r.getModel())||void 0===o?void 0:o.getCreatedTime();void 0!==e&&(e>((null===(i=n)||void 0===i?void 0:i.createdTime)??0)&&(n={blockStore:r,createdTime:e}))}return null===(t=n)||void 0===t?void 0:t.blockStore}(a);if(void 0===c)return{primaryTranscriptionBlockStore:void 0,reason:"NO_ALIVE_TRANSCRIPTION_BLOCKS"};const l=c;return{primaryTranscriptionBlockStore:l,state:(0,r().by)(l),reason:"MOST_RECENT"}}},651382:(e,t,n)=>{n.d(t,{B:()=>r});var o=()=>n(44551),i=()=>n(502220);function r(e,t){if(o().electronApi){var n;null===o().electronApi||void 0===o().electronApi||null===(n=o().electronApi.pushToastInMainTab)||void 0===n||n.call(o().electronApi,t)}else{const n=i().v[t.toastId];n&&n(e,t)}}},654734:(e,t,n)=>{n.d(t,{A:()=>l});var o=n(296540),i=()=>n(597777),r=()=>n(869190),a=()=>n(604995),s=()=>n(416504),c=n(474848);const l=function(e){const t=(0,n(69708).tz)(),l=(0,n(401497).DP)(),p=(0,n(396182).I)(),m=(0,o.useRef)(),v=(0,o.useCallback)((()=>{const t=e.value;if(!t)return;const o=a().q8(t,(0,s().P)());if(!o)return;const i=o.valueOf(),r=i-Date.now();r<0||r>n(720665).nD||m.current&&m.current.timestamp===i||(m.current&&clearTimeout(m.current.timer),m.current={timestamp:i,timer:setTimeout((()=>p("DateBox","DateBox/createReminderTimer")),r)})}),[p,e.value]),g=(0,o.useCallback)((()=>{m.current&&(clearTimeout(m.current.timer),m.current=void 0)}),[]);(0,o.useEffect)((()=>{v()}),[v]),(0,o.useEffect)((()=>()=>{g()}),[g]);const{value:f,withComma:h}=e,S=(0,n(56366).K8)((()=>f?(0,r().ZF)({value:f,date_format:e.dateFormat,time_format:e.timeFormat,userTimeZone:(0,s().P)(),allowRelativeDates:!0,intl:t,shortenDateAndRange:e.shortenDateAndRange,displayInUserTimezone:e.displayInUserTimezone,getToday:n(838924).x1}):void 0),[t,e.dateFormat,e.displayInUserTimezone,e.shortenDateAndRange,e.timeFormat,f]);if(!f)return null;const y=a().AA(f,(0,s().P)(),n(662303).locale);let b;if((0,i().Lh)(f)){const e=a().Zs(f,(0,s().P)());b=e?{color:l.errorText}:{color:n(100622).Tj.blue}}const k=(0,c.jsxs)(c.Fragment,{children:[S,(0,i().Lh)(f)?(0,n(599987).P)({display:"inline-block",width:"1em",marginInlineStart:6,marginInlineEnd:2,paddingBottom:4,verticalAlign:"middle"}):void 0,h?", ":null]});return e.disableTooltip?(0,c.jsx)("div",{className:e.className,style:{...e.style,...b},children:k}):(0,c.jsx)(n(859428).A,{renderTooltip:()=>(0,c.jsxs)(c.Fragment,{children:[e.tooltipHeader,(0,c.jsxs)("div",{style:u(l,e.tooltipHeader),children:[d(y.start),y.end?` → ${d(y.end)}`:""]})]}),render:t=>(0,c.jsx)("div",{className:e.className,style:{...e.style,...b},...t,children:k}),placement:e.tooltipPlacement})};function d(e){return(0,r().eV)({value:e,preset:"medium"})}function u(e,t){return t?{color:e.text.inverseSecondary}:{}}},658985:(e,t,n)=>{n.d(t,{$:()=>i});n(296540);var o=n(474848);const i=(0,n(340498).wt)("membersFilled",{viewBox:"0 0 30 30",svg:(0,o.jsx)("path",{d:"M20.31 14.731c2.22 0 4.097-1.967 4.097-4.513 0-2.485-1.887-4.391-4.098-4.391-2.2 0-4.097 1.937-4.087 4.411 0 2.526 1.866 4.493 4.087 4.493zm-11.725.233c1.937 0 3.57-1.724 3.57-3.935 0-2.17-1.653-3.823-3.57-3.823-1.917 0-3.57 1.683-3.56 3.844 0 2.19 1.633 3.914 3.56 3.914zm-5.588 9.21h7.606c-1.085-1.552.082-4.615 2.374-6.42-1.116-.72-2.566-1.248-4.392-1.248-4.533 0-7.464 3.337-7.464 6.085 0 1.004.507 1.582 1.876 1.582zm10.994-.01h12.637c1.673 0 2.251-.508 2.251-1.44 0-2.607-3.316-6.198-8.57-6.198-5.263 0-8.57 3.59-8.57 6.197 0 .933.578 1.44 2.252 1.44z"})})},674266:(e,t,n)=>{n.d(t,{w:()=>r});n(296540);var o=()=>n(401497),i=n(474848);function r({disabled:e}){const t=(0,o().IS)((t=>({icon:{width:12,height:12,borderRadius:3,backgroundColor:e?t.icon.tertiary:t.red.icon.accentPrimary}})),[e]);return(0,i.jsx)("div",{style:t.icon})}},684475:(e,t,n)=>{n.d(t,{Ku:()=>c});n(944114);var o=()=>n(906745),i=()=>n(20022);const r={START:[-10,-5,-1,0],END:[0,1]},a=30*n(615234).TD;class s extends(()=>n(769985))().u{constructor(e){const t=()=>{var e;null===(e=this.clearNextTickTimeout)||void 0===e||e.call(this),this.clearNextTickTimeout=void 0,this.maybeScheduleNextTick()};super({getInitialState:()=>({lastEvaluatedNowMillis:Date.now()}),effect:()=>(this.clearNextTickTimeout||this.maybeScheduleNextTick(),this.calendarMeetingsStore.addListener(t),()=>{this.listenerCount()>0||(this.calendarMeetingsStore.removeListener(t),this.clearNextTickTimeout&&(this.clearNextTickTimeout(),this.clearNextTickTimeout=void 0))})}),this.clearNextTickTimeout=void 0,this.calendarMeetingsStore=e}getLastEvaluatedNow(){return o().c9.fromMillis(this.getState().lastEvaluatedNowMillis)}maybeScheduleNextTick(){this.clearNextTickTimeout||0!==this.listenerCount()&&0!==this.calendarMeetingsStore.getState().length&&this.scheduleNextTick()}scheduleNextTick(){const e=this.calendarMeetingsStore.getState(),t=o().c9.now();let n;for(const a of e){const e=[{anchorTime:a.start.dateTime,offsets:r.START},{anchorTime:a.end.dateTime,offsets:r.END}];for(const{anchorTime:i,offsets:r}of e)for(const e of r){const r=o().c9.fromISO(i).plus({minutes:e});r<t||(n??=r,n.diff(r).as("seconds")>=0&&(n=r))}}if(!n)return;const i=n.diff(o().c9.now()).as("milliseconds");this.clearNextTickTimeout=this.setTimeoutWithThrottlingObserver((()=>{this.clearNextTickTimeout=void 0,this.setState({lastEvaluatedNowMillis:o().c9.now().toMillis()}),this.maybeScheduleNextTick()}),i)}setTimeoutWithThrottlingObserver(e,t){var r,s;if(null===i().Ht||void 0===i().Ht||!i().Ht.powerSuspend||null===i().Ht||void 0===i().Ht||!i().Ht.powerResume||!n(982254).A.state.isActiveTab){const n=setTimeout((()=>{e()}),t);return()=>{clearTimeout(n)}}let c=!1;const l=()=>{c=!0},{powerSuspend:d,powerResume:u}=i().Ht,p=[];p.push(null===(r=d.addListener)||void 0===r?void 0:r.call(d,l)),p.push(null===(s=u.addListener)||void 0===s?void 0:s.call(u,l));const m=o().c9.now().plus({milliseconds:t});let v=setTimeout((()=>{const t=o().c9.now();e(),v=setTimeout((()=>{if(p.forEach((e=>null==e?void 0:e())),c)return;const e=t.diff(m).as("milliseconds");e>a&&n(165358).log({level:"warning",from:"CalendarEventTickerStore",type:"timerStalled",data:{documentVisibilityState:document.visibilityState,miscDataToConvertToString:{timeSinceExpectedExecutionTime:e,expectedExecutionTime:m.toMillis(),actualExecutionTime:t.toMillis()}}})}),1e3)}),t);return()=>{clearTimeout(v),p.forEach((e=>null==e?void 0:e()))}}}const c=new s(n(833733).wK);(0,n(852832).exposeDebugValue)("CalendarEventTickerStore",c)},711207:(e,t,n)=>{n.d(t,{FP:()=>p,Mh:()=>h,Ud:()=>g,Wm:()=>m,_p:()=>S,bk:()=>v,uJ:()=>f});n(944114),n(898992),n(354520),n(581454);var o=()=>n(906745),i=()=>n(534177),r=()=>n(559506),a=()=>n(896628),s=()=>n(319975),c=()=>n(749804),l=()=>n(231297),d=()=>n(321032),u=()=>n(379560);function p(e){var t;const{environment:n,store:o}=e,i=null===(t=o.getFormat())||void 0===t?void 0:t.transcription_calendar_event;i&&l().createAndCommit({userAction:"transcriptionCalendarActions.dismissCalendarSharingSuggestion",environment:n,canUndo:!0,perform:e=>{a().zA({stores:[o],update:{transcription_calendar_event:{...i,has_dismissed_sharing:!0}},transaction:e})}})}function m(e){return{startTime:e.isAllDay?o().c9.fromISO(e.start.date):o().c9.fromISO(e.start.dateTime,{zone:e.start.timeZone}),endTime:e.isAllDay?o().c9.fromISO(e.end.date):o().c9.fromISO(e.end.dateTime,{zone:e.end.timeZone})}}function v(e){const{blockStore:t,event:n,transaction:o,environment:i}=e,r=t.getTitleStore();r&&(s().jQ({environment:i,store:r,transaction:o,selection:{startIndex:0,endIndex:1/0},updateSelection:!1}),n.summary&&s().yr({environment:i,store:r,index:0,tokens:[[n.summary]],transaction:o}))}function g(e){var t,n;const{blockStore:o,event:r,attendeeIds:s,transaction:c,environment:l}=e,{startTime:d,endTime:u}=m(r),p=s??(null===(t=r.attendees)||void 0===t?void 0:t.map((e=>e.notionUserId)).filter(i().O9))??[],v=null===(n=l.currentUser)||void 0===n?void 0:n.id;v&&!p.includes(v)&&p.push(v),a().zA({stores:[o],update:{transcription_calendar_event:{uid:r.uid,startTime:d.toISO(),endTime:u.toISO(),attendeeIds:p}},transaction:c})}async function f(e){var t;const{environment:n,blockStore:i,event:r,source:s}=e,p=r.isAllDay?o().c9.fromISO(r.start.date):o().c9.fromISO(r.start.dateTime,{zone:r.start.timeZone}),m=r.isAllDay?o().c9.fromISO(r.end.date):o().c9.fromISO(r.end.dateTime,{zone:r.end.timeZone}),f=S({environment:n,event:r});l().createAndCommit({userAction:"transcriptionCalendarActions.addCalendarEventToTranscriptionBlock",environment:n,canUndo:!0,perform:e=>{a().zA({stores:[i],update:{transcription_calendar_event:{uid:r.uid,startTime:p.toISO(),endTime:m.toISO(),attendeeIds:[]}},transaction:e}),v({blockStore:i,event:r,transaction:e,environment:n})}}),(0,c().I)({environment:n});const h=await f;l().createAndCommit({userAction:"transcriptionCalendarActions.addCalendarAttendeesToTranscriptionBlock",environment:n,canUndo:!0,perform:e=>{g({blockStore:i,event:r,attendeeIds:h.map((e=>e.id)),transaction:e,environment:n})}});const y=null===(t=u().A.getHomeCalendarStateForSpaceView())||void 0===t?void 0:t.botId;y&&(0,d().R)(n,{botId:y,payload:{type:"track",payload:{event:"transcriptionBlockCalendarEventAdded",eventId:r.uid,source:s}}})}function h(e){const{environment:t,blockStore:n}=e;l().createAndCommit({userAction:"transcriptionCalendarActions.removeCalendarEventFromTranscriptionBlock",environment:t,canUndo:!0,perform:e=>{const o=n.getTitleStore();o&&s().jQ({environment:t,store:o,transaction:e,selection:{startIndex:0,endIndex:1/0}}),a().zA({stores:[n],update:{transcription_calendar_event:void 0},transaction:e})}}),(0,c().I)({environment:t})}async function S(e){var t;const{environment:n,event:o}=e,a=(null===(t=o.attendees)||void 0===t?void 0:t.map((e=>e.email)).filter(i().O9))??[];if(0===a.length)return[];const s=await r().callApi({eventName:"findUsers",environment:n,data:{emails:a}});return"success"!==s.type?[]:s.data.values.map((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.value})).filter(i().O9)}},725081:(e,t,n)=>{n.r(t),n.d(t,{sendEventNotification:()=>C,sendNotificationForDictationInterrupted:()=>w,sendNotificationForRunningAudioProcess:()=>x});var o=()=>n(906745),i=()=>n(564884),r=()=>n(242422),a=()=>n(662303),s=()=>n(416504),c=()=>n(69708),l=()=>n(948889),d=()=>n(338931),u=()=>n(972435),p=()=>n(90857),m=()=>n(135428),v=()=>n(379560),g=()=>n(765957),f=()=>n(666976),h=()=>n(271380),S=()=>n(811031),y=()=>n(637368);const b=(0,c().YK)({zoom:{id:"audioProcessDetectionActions.zoom",defaultMessage:"In a Zoom meeting?"},safari:{id:"audioProcessDetectionHelpers.audioProcess.safari",defaultMessage:"In a meeting?"},chrome:{id:"audioProcessDetectionHelpers.audioProcess.chrome",defaultMessage:"In a meeting?"},teams:{id:"audioProcessDetectionHelpers.audioProcess.teams",defaultMessage:"In a Teams meeting?"},edge:{id:"audioProcessDetectionHelpers.audioProcess.edge",defaultMessage:"In a meeting?"},brave:{id:"audioProcessDetectionHelpers.audioProcess.brave",defaultMessage:"In a meeting?"},arc:{id:"audioProcessDetectionHelpers.audioProcess.arc",defaultMessage:"In a meeting?"},firefox:{id:"audioProcessDetectionHelpers.audioProcess.firefox",defaultMessage:"In a meeting?"}}),k=(0,c().YK)({body:{id:"audioProcessDetectionActions.notification.body",defaultMessage:"Start AI Meeting Notes for this meeting"}}),A=(0,c().YK)({defaultEventTitle:{id:"calendarMeetingNoteNotification.defaultEventTitle",defaultMessage:"Meeting"},allDayTimeLabel:{id:"calendarMeetingNoteNotification.allDayTimeLabel",defaultMessage:"All-day"},takeNotes:{id:"calendarMeetingNoteNotification.takeNotesBody",defaultMessage:"{startTime} · Start AI Meeting Notes"}}),T=(0,c().YK)({zoom:{id:"audioProcessDisplayNames.zoom",defaultMessage:"Zoom"},safari:{id:"audioProcessDisplayNames.safari",defaultMessage:"Safari"},chrome:{id:"audioProcessDisplayNames.chrome",defaultMessage:"Chrome"},teams:{id:"audioProcessDisplayNames.teams",defaultMessage:"Teams"},edge:{id:"audioProcessDisplayNames.edge",defaultMessage:"Edge"},brave:{id:"audioProcessDisplayNames.brave",defaultMessage:"Brave"},arc:{id:"audioProcessDisplayNames.arc",defaultMessage:"Arc"},firefox:{id:"audioProcessDisplayNames.firefox",defaultMessage:"Firefox"}}),_=(0,c().YK)({meeting:{id:"customNotificationTitleMessages.meeting",defaultMessage:"Meeting detected"}});function x(e,t){var n,c;if(e.device.isMobile||!r().default.checkGate({gateName:"meeting_notes_audio_process_notification"}))return;if(!((null===(n=g().AppStoreSidebarSpaceViewStore.getState())||void 0===n?void 0:n.isAiMeetingNotesAudioProcessDetectionNotificationEnabled())??!0))return;const h=(0,f().A)(e),S=null===(c=v().A.getHomeCalendarStateForSpaceView())||void 0===c?void 0:c.botId,x=v().A.getEvents(),w=v().A.getCurrentAccounts(),I=(0,d()._X)(x,w),C=function(e){const{processName:t,event:n,isCustomNotification:o}=e;if(n)return n.summary||u().A.formatMessage(A.defaultEventTitle);if(o)return u().A.formatMessage(_.meeting);return u().A.formatMessage(b[t])}({processName:t,event:I,isCustomNotification:h}),M=function(e){const{event:t,processName:n,isCustomNotification:i}=e;if(i)return t?t.isAllDay?u().A.formatMessage(A.allDayTimeLabel):(0,m().Vj)({start:t.start.dateTime,end:t.end.dateTime,locale:a().locale,timeZone:(0,s().P)()}):u().A.formatMessage(T[n]);if(t){const e=t.isAllDay?u().A.formatMessage(A.allDayTimeLabel):(0,m().ax)({time:o().c9.fromISO(t.start.dateTime),showAmPm:!0,locale:a().locale,timeZone:(0,s().P)()});return u().A.formatMessage(A.takeNotes,{startTime:e})}return u().A.formatMessage(k.body)}({processName:t,event:I,isCustomNotification:h}),B=Notification.permission;if((0,i().u)({environment:e,event:{eventName:"audio_process_notification_sent",eventProperties:{type:h?"custom":"system",permission:h?"granted":B,calendar_bot_id:S,has_calendar_event:Boolean(I),process:t}}}),h)(0,l().w)({title:C,body:M,event:I?(0,p().ft)(I):void 0,autoStart:!0});else{const t=new Notification(C,{body:M,silent:!0});t.addEventListener("click",(()=>{y().meetingNotificationClicked({environment:e,notification:{...t,autoStart:!1}})}))}}function w(e){const{environment:t,blockStore:n,title:o,message:i,canRestart:r,tabId:a}=e;if(t.device.isMobile)return;const s=new Notification(o,{body:i,silent:!1,requireInteraction:!0}),c=()=>{(0,S().N)({environment:t,blockStore:n,tabId:a})},l=r?()=>{c(),(0,h().startTranscription)({environment:t,blockStore:n,from:"resume_from_click_error_notification"})}:c;s.addEventListener("click",l)}const I=(0,c().YK)({defaultEventTitle:{id:"calendarMeetingNoteNotification.defaultEventTitle",defaultMessage:"Meeting"}});function C(e,t,n){const o=e.summary?e.summary:u().A.formatMessage(I.defaultEventTitle),i=(0,m().Vj)({start:e.start.dateTime,end:e.end.dateTime,locale:a().locale,timeZone:(0,s().P)()});(0,l().w)({title:o,body:i,event:(0,p().ft)(e),intent:t,autoStart:n??!1})}},739135:(e,t,n)=>{n.d(t,{KD:()=>l,gt:()=>d,i9:()=>c,ll:()=>a,tb:()=>s,x$:()=>r});var o=()=>n(541235),i=()=>n(496603);function r(e,t){return a(d(e,t))}function a(e){return void 0!==e&&(e===o().q_||e===o().YD)}function s(e,t){if(a(t))return;const n=o().c$[e],i=n.steps.findIndex((e=>e.id===t));return-1===i?n.steps[0].id:i===n.steps.length-1?o().q_:n.steps[i+1].id}function c(e,t){const n=d(e,t);if(n&&!a(n))return s(t,n)}function l(e,t){const n=d(e,t);if(n)return function(e,t){const n=o().c$[e];var r;if(a(t))return null===(r=(0,i().HV)(n.steps))||void 0===r?void 0:r.id;const s=n.steps.findIndex((e=>e.id===t));return-1!==s&&0!==s?n.steps[s-1].id:void 0}(t,n)}function d(e,t){var n;if(!e)return;const i=((null===(n=e.getSettings())||void 0===n?void 0:n.tutorials)||{})[t];return void 0===i?o().c$[t].steps[0].id:i}},766854:(e,t,n)=>{n.d(t,{H:()=>k,Q:()=>b});n(898992),n(672577);var o=()=>n(242422),i=()=>n(929219),r=()=>n(700500),a=()=>n(179034),s=()=>n(201980),c=()=>n(557281),l=()=>n(384944),d=()=>n(381678),u=()=>n(476492),p=()=>n(646736),m=()=>n(406792),v=()=>n(765957),g=()=>n(148832),f=()=>n(622811),h=()=>n(491848),S=()=>n(482871);function y(e,t,n){const i=(0,d()._)(e),r=null==i?void 0:i.id;if(!r||!n)return;if(!o().default.checkGate({gateName:"full_access_for_created_collection_pages"}))return;if(t.canAdmin())return;const a=t.getSpaceStore();return a&&(0,p().dp)(a,r).isMember()?[{role:"editor",type:"user_permission",user_id:r}]:void 0}function b(e){const{collectionContextStore:t,transaction:n}=e;return(0,h().w)({collectionContextStore:t,transaction:n}),k(e)}function k(e){var t,n,o;const{environment:d,collectionContextStore:p,groupsPointer:h,insertAtIndex:b,shouldCoerce:k,templateStore:A,transaction:T,from:_,tracker:x,inMemoryRecordCache:w,isKeyboard:I,title:C}=e,M=m().default.DO_NOT_USE_markLegacy("collections.add_item_lag");m().default.DO_NOT_USE_measureAfterNextFlushLegacy(M,{environment:d,getData:()=>({...u().kz(p),from:_.createBlock})});const B="collectionTypedView"===p.contextType,D=p.databaseType,E=p.collectionStoresStore.state,R=E.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly()))||E[0],N=null===(t=v().default.state.sidebarSpaceStore)||void 0===t?void 0:t.id,j=v().default.state.currentUserSettingsStore,P=B&&D&&N&&j&&[...j.getAllPreferredCollections(N),...j.getPreferredCollectionsOfType(N,D)]||[];let O;const z=h[0];if("group_header"===_.createBlock&&"location"===z.value.type){const e=z.value.value;if(e){O=E.find((t=>t.id===e.id&&(t.canEdit()||t.canEditCollection()||t.canEditContentOnly())))}}else O=function(e,t){for(const n of e){const e=t.find((e=>e.id===n&&(e.canEdit()||e.canEditCollection()||e.canEditContentOnly())));if(e)return e}}(P,E);const L=O??R,F=null==L?void 0:L.getSpaceId(),U=p.collectionViewStore(),W=p.getViewType(),V=l().Wv({environment:d,type:r().xd.page,inMemoryRecordCache:w,transaction:T,spaceId:F,tracker:x,permissions:y(d,L,F),properties:{title:(0,s().x9d)(C)}});if(!L||!U||!W)return{coercionSucceeded:!0,newStore:V};const q=null===(n=p.groupsStore.getGroupState(h))||void 0===n?void 0:n.groupUiParentStore;if(!q)return{coercionSucceeded:!0,newStore:V};const H=g().B.createChildStore(q,{table:a().ev,id:V.id});A&&i().A.state.online&&c().n5({title:"template",environment:d,store:V,templateStore:A,isKeyboard:I??!1,isCreateIn:!1,transaction:T,from:_.initCollection??"collection_group_actions"});const K=(0,f().j)({environment:d,store:V,collectionStore:L,collectionContextStore:p,groupsPointer:h,shouldCoerce:k,transaction:T}),$=(null===(o=p.groupsStore.getGroupState(h))||void 0===o||null===(o=o.reducerResultStore.state)||void 0===o?void 0:o.blockIds)||[],G=void 0!==b?b:$.length;if(p.permissionScopesStore.state.canEditContent||B){const e=[...$.slice(0,G),H.id,...$.slice(G)];(0,S().z)({resultIds:e,collectionViewStore:U,collectionContextStore:p,transaction:T})}return{coercionSucceeded:K,newStore:H}}},811031:(e,t,n)=>{n.d(t,{K:()=>p,N:()=>m});n(898992),n(672577),n(737550);var o=()=>n(584262),i=()=>n(44551);function r(e){var t;null===i().electronApi||void 0===i().electronApi||null===(t=i().electronApi.navigateToBlockInTab)||void 0===t||t.call(i().electronApi,e)}var a=()=>n(857783),s=()=>n(620689),c=()=>n(695625),l=()=>n(982254),d=()=>n(911063);function u(e,t){const n=c().T.findScrollToSelectablesFromIds([t]);return 0!==n.length&&(s().pb({environment:e,handle:n[0],vertical:{reveal:"top"},horizontal:void 0,animate:!0}),!0)}function p(e){const{environment:t,blockStore:n}=e;if(u(t,n.id))return;const i=(0,d().getActiveTranscriptionBlockStore)();if((null==i?void 0:i.id)===n.id)return void a().uK({environment:t,store:n,pageVisitSource:o().y8.TranscriptionBlockPopup});const s=l().A.state.tabs.find((e=>{var t;return null===(t=e.activeBlocks)||void 0===t?void 0:t.some((e=>e.pointer.id===n.id))}));s&&r({tabId:s.id,pointer:n.pointer,source:o().y8.TranscriptionBlockPopup})}function m(e){const{environment:t,blockStore:n,tabId:i}=e;u(t,n.id)||(i&&i!==l().A.state.currentTab.id?r({tabId:i,pointer:n.pointer,source:o().y8.TranscriptionBlockPopup}):a().uK({environment:t,store:n,pageVisitSource:o().y8.TranscriptionBlockPopup}))}},833733:(e,t,n)=>{n.d(t,{RM:()=>s,wK:()=>c,xM:()=>a});n(944114),n(898992),n(354520),n(672577),n(581454);var o=()=>n(906745),i=()=>n(379560),r=()=>n(765957);function a(e){var t;const{event:n,currentUserEmail:i,eligibleCalendars:r}=e;if(!r.includes(n.calendarId))return!1;if(!((null===(t=n.attendees)||void 0===t||null===(t=t.find((e=>e.self)))||void 0===t?void 0:t.email)===i)&&!n.isOwner)return!1;if("outOfOffice"===n.eventType||"focusTime"===n.eventType)return!1;if(n.isAllDay||!("dateTime"in n.start)||!("dateTime"in n.end))return!1;const a=o().c9.fromISO(n.start.dateTime);return!(o().c9.fromISO(n.end.dateTime).diff(a).as("hours")>=8)}function s(){var e;const t=null===(e=r().default.state.currentUserStore)||void 0===e?void 0:e.getEmail();if(!t)return[];const n=i().A.getCurrentAccountIds().filter((e=>{var t;return"notion"!==(null===(t=i().A.getAccount(e))||void 0===t?void 0:t.provider)})).find((e=>{const n=i().A.getAccount(e);return(null==n?void 0:n.email)===t}));return n?i().A.getCalendarsForAccount(n).map((e=>e.id)):[]}const c=new(n(496506).ComputedStore)((()=>{var e;const t=i().A.getDateTimeEvents(),n=null===(e=r().default.state.currentUserStore)||void 0===e?void 0:e.getEmail(),o=s();if(!n)return[];const c=[];for(const i of t)a({event:i,currentUserEmail:n,eligibleCalendars:o})&&c.push(i);return c}),{debugName:"CalendarMeetingsStore"})},837622:(e,t,n)=>{n.d(t,{A:()=>u});var o=n(296540),i=()=>n(56366),r=()=>n(401497),a=()=>n(201980),s=()=>n(116008),c=()=>n(921855),l=()=>n(735372),d=n(474848);const u=o.memo((function(e){const{parentStore:t,withComma:u,linkifyUrls:p,disableCommentHighlight:m,disableLinks:v,shouldTruncate:g,clampLines:f,textValue:h}=e,S=(0,n(484714).v3)(),y=(0,r().DP)(),b=(0,n(712030).Ol)();(0,o.useEffect)((()=>{void 0!==h&&S.KatexStore.loadIfNeeded((()=>h))}),[S.KatexStore,h]);const{collectionContextStore:k,property:A}=(0,o.useContext)(n(971003).L8),{collectionViewBlockId:T,collectionViewId:_}=(0,i().K8)((()=>{var e,t;return{collectionViewId:null==k||null===(e=k.collectionViewStore())||void 0===e?void 0:e.id,collectionViewBlockId:null==k||null===(t=k.collectionViewBlockStore())||void 0===t?void 0:t.id}}),[k]),x=(0,i().K8)((()=>S.KatexStore.getKatex()),[S.KatexStore]),w=(0,i().K8)((()=>{const e=l().qu.state,n=l().wb.state;return e&&A&&h?c().nu({textValue:h,blockId:t.id,textProps:{type:"page_property_value_match",collectionViewBlockId:T,collectionViewId:_,propertyId:A},find:e,currentFocusedResult:n}):h}),[A,h,t.id,T,_]),I=(0,i().K8)((()=>{if(s().A.getPropertyId()!==A||s().A.getBlockStore()!==t)return w;const e=s().A.getMultiSelection();return e?a().Mwp({textValue:w,selection:{startIndex:e.start.index,endIndex:e.end.index},annotation:[a().Ifu.TemporaryComment]}):h?a().Mwp({textValue:w,selection:{startIndex:0,endIndex:a().qAZ(h).length},annotation:[a().Ifu.TemporaryComment]}):w}),[t,A,h,w]),C=(0,i().K8)((()=>void 0===I?null:c().S5({environment:S,textValue:I&&{value:I,spaceId:(0,n(161479).e)(t.pointer.spaceId)},parentStore:t,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disableCommentAnnotations:m??!1,disabled:!0,theme:y,disableLinks:v??!1,emojiType:b,katex:x,formulaValueTypes:[],stopLinkPropagation:!0,linkTargetBlank:!0})),[I,S,t,m,y,v,b,x]),M=(0,o.useMemo)((()=>{if(!p||void 0===h)return null;const e=(0,a().k4p)(h);return(0,n(735577).A)(e)?(0,n(713998).MO)(h):null}),[p,h]),B=(0,r().IS)((e=>({text:{...g&&!f?n(284371).RC:void 0,...g&&f?{...(0,n(115512).pA)(f),overflow:"hidden",textOverflow:"ellipsis"}:{}}})),[g,f]);return(0,d.jsxs)("span",{style:B.text,children:[M?(0,d.jsx)(n(97294).N,{href:M,style:{display:"inline",pointerEvents:"auto",...(0,n(468882).w_)(y)},external:!0,onClick:e=>e.stopPropagation(),children:C}):C,u?", ":null]})}))},848401:(e,t,n)=>{n.d(t,{Ay:()=>m,mI:()=>u,vb:()=>p});n(296540);var o=()=>n(401497),i=()=>n(718827),r=()=>n(784892),a=()=>n(65767),s=()=>n(69708),c=()=>n(284371),l=n(474848);const d=(0,s().YK)({removeTokenLabel:{defaultMessage:"Remove {title}",id:"uiGenericToken.removeTokenLabel"},removeTokenLabelGeneric:{defaultMessage:"Remove Item",id:"uiGenericToken.removeTokenLabelGeneric"}}),u=r().NY,p={[r().NY.ExtremeSmall]:{height:12,fontSize:10,margin:"0 4px 0 0",marginEditState:"0 6px 0 0",closeIconSize:8,avatarSize:14},[r().NY.ExtraSmall]:{height:14,fontSize:12,margin:"0 6px 0 0",marginEditState:"0 6px 0 0",closeIconSize:8,avatarSize:14},[r().NY.Small]:{height:18,fontSize:12,margin:"0 6px 6px 0",marginEditState:"0 6px 6px 0",closeIconSize:8,avatarSize:16},[r().NY.CompactEssential]:{height:20,fontSize:14,margin:"0 10px 6px 0",marginEditState:"0 6px 6px 0",closeIconSize:8,avatarSize:20},[r().NY.Medium]:{height:20,fontSize:14,margin:"0 10px 6px 0",marginEditState:"0 6px 6px 0",closeIconSize:8,avatarSize:20},[r().NY.Inline]:{height:20,fontSize:14,closeIconSize:8,avatarSize:20,margin:"0 -5px 0 0",marginEditState:"0 6px 0 0"},[r().NY.Large]:{height:24,fontSize:16,margin:"0 8px 8px 0",marginEditState:"0 8px 8px 0",closeIconSize:10,avatarSize:24}};function m({avatarSize:e,format:t,isSingle:n,onClickRemove:r,renderAvatar:u,showRemoveButton:m,shouldShrink:v,style:g,title:f}){const h=(0,s().tz)(),{height:S,fontSize:y,margin:b,marginEditState:k,closeIconSize:A,avatarSize:T}=p[t],_=e??T,x=(0,o().IS)((()=>({root:{display:"flex",alignItems:"center",flexShrink:v?1:0,minWidth:0,height:S,borderRadius:6,fontSize:y,lineHeight:"120%",margin:n?0:m?k:b,...g}})),[y,S,n,b,k,v,m,g]);return(0,l.jsxs)("div",{style:x.root,children:[null==u?void 0:u(_),(0,l.jsx)("div",{className:"notranslate",style:{...c().RC},children:f}),m?(0,l.jsx)(i().Ay,{ariaLabel:void 0!==f?h.formatMessage(d.removeTokenLabel,{title:f}):h.formatMessage(d.removeTokenLabelGeneric),onClick:r,style:{display:"flex",alignItems:"center",justifyContent:"center",width:S,height:S,marginInlineStart:2,marginInlineEnd:2,flexGrow:0,flexShrink:0,borderRadius:6},children:(0,a().l)({width:A,height:A,opacity:.5})}):null]})}},852517:(e,t,n)=>{n.d(t,{$:()=>c});n(944114),n(581454);var o=()=>n(56366),i=()=>n(765957),r=()=>n(540144),a=()=>n(964345),s=()=>n(748197);function c(){return(0,o().K8)((()=>{var e;const t=Object.values(a().Ay.state.passiveBlockMap).map((({rootBlockStore:e})=>e)),n=a().ei.state,o=[];n&&n.isTranscriptionBlock()&&o.push(n);for(const i of t)i.isTranscriptionBlock()&&o.push(i);const c=null===(e=i().default.state.currentUserStore)||void 0===e?void 0:e.id;if(c)for(const i of o){const e=(0,r().by)(i);if(i.pathIsDead()||"transcribing"!==e.state||e.transcriber_id!==c)continue;if(!s().c.getVisibilityStatus(i.id))return i}}),[])}},865060:(e,t,n)=>{n.d(t,{X:()=>a});var o=()=>n(595345),i=()=>n(233124),r=()=>n(632503);function a(e,t){(0,i().K_)(e,{from_language:(0,r().Y)().state,to_language:t,dictation_session_id:(0,o().qY)()}),(0,r().Y)().set(e,t)}},872903:(e,t,n)=>{n.r(t),n.d(t,{displayDictationGenericErrorSnackbar:()=>S,displayDictationPermissionSnackbar:()=>f,displayDictationUsageErrorSnackbar:()=>h,showTranscriptionErrorToast:()=>y});n(296540);var o=()=>n(564884),i=()=>n(532940),r=()=>n(69708),a=()=>n(534177),s=()=>n(471995),c=()=>n(812182),l=()=>n(765957),d=()=>n(148832),u=()=>n(484705),p=()=>n(914649),m=()=>n(271380),v=()=>n(811031),g=n(474848);p().JS,p().rP,p().JC;function f(e){var t;s().D6({label:(t=e,t===p().JS?(0,g.jsx)(r().sA,{defaultMessage:"No microphone permission. Allow access to your microphone in system settings",id:"dictation.permission.microphone.snackbar.error"}):t===p().rP?(0,g.jsx)(r().sA,{defaultMessage:"No microphone available. Connect your microphone in system settings",id:"dictation.unavailable.microphone.snackbar.error"}):t===p().JC?(0,g.jsx)(r().sA,{defaultMessage:"An unknown error occurred when trying to access the microphone.",id:"dictation.permission.unknown.snackbar.error"}):void(0,a().HB)(t)),right:(0,g.jsx)(u().k,{})})}function h(){s().D6({label:(0,g.jsx)(r().sA,{defaultMessage:"Audio usage limit reached. Try again later.",id:"dictation.usage.snackbar.error"})})}function S(){s().D6({label:(0,g.jsx)(r().sA,{defaultMessage:"Dictation failed. Please try again.",id:"dictation.generic.snackbar.error"})})}function y(e,t){const{pointer:n,tabId:a,title:s,message:u,name:p,canRestart:f}=t,h=l().AppStoreSidebarSpaceStore.state;if(!h)return;const S=d().B.createChildStore(h,n);if(!S.isTranscriptionBlock())return;const y={title:(0,g.jsx)(r().sA,{defaultMessage:"Go to meeting note",id:"dictation.error.toast.action.goToBlock"}),onAction:()=>{c().UW("transcription_error_notification"),(0,v().N)({environment:e,blockStore:S,tabId:a}),(0,o().u)({environment:e,event:{eventName:"error_transcription_toast_navigation_button_clicked",eventProperties:{block_id:S.id,error_name:p}}})}};c().HK({id:"transcription_error_notification",icon:i().exclamationMarkTriangleIcon,presentationType:"persistent",variant:"error",title:s,message:u,onDismiss:()=>{(0,o().u)({environment:e,event:{eventName:"error_transcription_toast_dismissed",eventProperties:{block_id:S.id,error_name:p}}})},actions:{primary:f?{title:(0,g.jsx)(r().sA,{defaultMessage:"Resume",id:"dictation.error.toast.action.resume"}),onAction:()=>{c().UW("transcription_error_notification"),(0,v().N)({environment:e,blockStore:S,tabId:a}),(0,m().startTranscription)({environment:e,blockStore:S,from:"transcription_error_toast"}),(0,o().u)({environment:e,event:{eventName:"error_transcription_toast_resume_button_clicked",eventProperties:{block_id:S.id,error_name:p}}})}}:y,secondary:f?y:void 0}})}},881383:(e,t,n)=>{n.r(t),n.d(t,{AudioSessionBlockWriter:()=>ee,DictationManager:()=>se,StreamingDictationManager:()=>pe,startDictation:()=>ce,stopDictation:()=>le,updateActiveBlocks:()=>de});n(16280),n(18107),n(944114),n(816573),n(878100),n(177936),n(967357),n(748140),n(821903),n(491134),n(128845),n(237467),n(444732),n(979577),n(898992),n(823215),n(354520),n(672577),n(803949),n(581454);var o=()=>n(700500),i=()=>n(165358),r=()=>n(201980),a=()=>n(220719),s=()=>n(999752),c=()=>n(319625),l=()=>n(229833),d=()=>n(534177),u=()=>n(651382),p=()=>n(896628),m=()=>n(44729),v=()=>n(384944),g=()=>n(319975),f=()=>n(190033),h=()=>n(231297),S=()=>n(595345),y=()=>n(262089),b=()=>n(87017),k=()=>n(495506),A=()=>n(972435),T=()=>n(254619),_=()=>n(765957),x=()=>n(148832),w=()=>n(891360),I=()=>n(233124);n(410838);class C{constructor({id:e,isCompleteReceived:t,sortKey:n}){this.id=void 0,this.lastUpdated=void 0,this.text=void 0,this.isCompleteReceived=void 0,this.sortKey=void 0,this.transcriptions=void 0,this.id=e,this.lastUpdated=Date.now(),this.isCompleteReceived=Boolean(t),this.transcriptions=new Map,this.sortKey=n}updateText(){const e=Array.from(this.transcriptions.values()).findLast((e=>"complete"===e.status));this.text=e?e.text:void 0}setTranscription(e,t){this.transcriptions.set(e,t),this.updateText(),this.lastUpdated=Date.now()}setIsCompleteReceived(e){!this.isCompleteReceived&&e&&(this.isCompleteReceived=!0)}getId(){return this.id}getText(){return this.text}getSortKey(){return this.sortKey??0}getMsSinceLastUpdate(){return Date.now()-this.lastUpdated}isSettled(){return Date.now()-this.lastUpdated>n(615234).Xb||this.isCompleteReceived&&this.transcriptions.values().every((({status:e})=>"pending"!==e))}}var M=()=>n(914649),B=()=>n(372938),D=()=>n(909557),E=()=>n(28834);function R(e){let t;const n=[];for(const i of e.segments){var o;const r=i.getText();if(!r)continue;const a=i.isSettled()||e.forceSettled||!1;(null===(o=t)||void 0===o?void 0:o.settled)!==a?(t&&n.push(t),t={text:r,settled:a,segmentId:i.getId()}):t.text=`${t.text} ${r}`}return t&&n.push(t),n.length>0&&e.indent&&(n[0].text=` ${n[0].text}`),n}n(737550);function N(e){return!!(0,r().BEe)(e)&&e[1].some(r().Si1)}var j=()=>n(74e3);const P=/([\?\!\.])\s/;function O(e){const t=e.split(P);for(let n=1;n<t.length;n++){const e=t[n];[".","?","!"].includes(e)&&(t[n-1]+=e,t[n]="")}return t.filter((function(e){return void 0!==e&&""!==e}))}var z=()=>n(540144),L=()=>n(927648),F=()=>n(964345),U=()=>n(632503),W=()=>n(748197);var V=()=>n(872903),q=()=>n(242422),H=()=>n(44551);const K=[],$=(0,n(496603).nF)((()=>{const e=[...K];K.length=0,async function(e){var t;null===H().electronApi||void 0===H().electronApi||null===(t=H().electronApi.writeSessionLogs)||void 0===t||t.call(H().electronApi,e)}(e)}),1e3);function G({messages:e,...t}){K.push({...t,timestamp:new Date,args:Array.isArray(e)?e:[e]}),$()}function Y(e,t){q().default.checkGate({gateName:"enable_transcription_session_logging"})&&function(e,t,...n){G({level:"info",messages:n,processName:e,sessionId:t})}("transcriptions",e,t)}function Z(e,t,n){q().default.checkGate({gateName:"enable_transcription_session_logging"})&&function(e,t,...n){G({level:"error",messages:n,processName:e,sessionId:t})}("transcriptions",e,{...n,error:(0,c().A)(t)})}var J;let X=250;class Q{constructor(){this.segments=void 0,this.segments=new Map}setSegment(e){this.segments.set(e.getId(),e)}getSegment(e){return this.segments.get(e)}getSortedSegments(){return[...this.segments.values()].sort(((e,t)=>e.getSortKey()-t.getSortKey()))}deleteSegment(e){this.segments.delete(e)}isSettled(){return this.getSortedSegments().every((e=>e.isSettled()))}}class ee{constructor(e){this.id=void 0,this.env=void 0,this.rootBlockId=void 0,this.isCompleteReceived=void 0,this.blockStore=void 0,this.onUpdateBlock=void 0,this.segmentManager=void 0,this.speakerName=void 0;const{id:t,env:n,rootBlockId:o,blockStore:i,onUpdateBlock:r}=e;this.id=t,this.env=n,this.isCompleteReceived=!1,this.rootBlockId=o,this.blockStore=i,this.onUpdateBlock=r,this.segmentManager=new Q}getOrCreateSegment(e,t){const n=this.segmentManager.getSegment(e);if(n)return n;const o=new C({id:e,sortKey:null==t?void 0:t.sortKey});return this.segmentManager.setSegment(o),o}getBlockStore(){return this.blockStore}setBlockStore(e){var t;this.blockStore=e,null===(t=this.onUpdateBlock)||void 0===t||t.call(this,e)}logInsert({final:e,...t}){Y(this.rootBlockId,{...t,type:"insert:"+(e?"final":"temp"),sessionId:this.id,blockId:this.blockStore.id})}logDelete(e){Y(this.rootBlockId,{...e,type:"delete",sessionId:this.id,blockId:this.blockStore.id})}isStreamingModel(){var e;const t=new(x().B)(this.env,{table:n(179034).ev,id:this.rootBlockId});if(!t.isTranscriptionBlock())return!1;const o=(0,z().RW)(null===(e=t.getFormat())||void 0===e?void 0:e.transcription_model);return"baseten_diarization"===o||"fireworks_diarization"===o||"openai_diarization"===o||"no_diarization"!==o&&void 0!==o&&void(0,d().HB)(o)}setIsCompleteReceived(e){!this.isCompleteReceived&&e&&(this.isCompleteReceived=!0)}getId(){return this.id}isSettled(){return this.isCompleteReceived&&this.segmentManager.isSettled()}setSpeakerName(e){this.speakerName=e}writeToBlock(e=!1){const t=this.blockStore.getParentBlockStore();if(!this.blockStore.isDictatableBlock()||!t)return;let n=!1;const o=[],i=[];for(const r of[...this.segmentManager.getSortedSegments()])n||!e&&!r.isSettled()?(n=!0,i.push(r)):(o.push(r),this.segmentManager.deleteSegment(r.getId()));const{serverCommitResult:a,transactionId:s}=h().createAndCommit({userAction:"dictationActions.writeToBlock",environment:this.env,canUndo:!1,perform:n=>{let a,s=0;const c=this.blockStore.getBlockTitleStore(),l=(0,r().ooo)(c.getValue());for(let e=0;e<l.length;e++){if(N(l[e])){a=e;break}s+=(0,r().WWE)(l[e])}if(void 0!==a){if(0===o.length){const t=function(e){const{tokens:t,...n}=e,o=R(n);return o.length===t.length&&o.every((({text:e,settled:n},o)=>{const i=t[o];return!(N(i)?n:!n)&&e===(0,r().N8A)(i)}))}({segments:i,tokens:l.slice(a),forceSettled:e,indent:s>0});if(t)return}this.logDelete({transactionId:n.id,index:s}),g().jQ({environment:this.env,store:c,selection:{startIndex:s,endIndex:1/0},transaction:n,updateSelection:!1})}const d=function(e){const{text:t,maxLength:n=1/0,initialLength:o=0}=e;if(0===n)throw new Error("Max length must be >0");let i=o,r="";const a=[];for(const s of t)r=""===r?s:`${r} ${s}`,i=r.length,i>=n&&(a.push(r),r="",i=0);return r&&a.push(r),a}({text:O(ie([...o.values()])),initialLength:s,maxLength:X});for(const e of d){const o=this.isStreamingModel();if(!o){const t=s>0?` ${e}`:e;this.logInsert({transactionId:n.id,text:t,index:s,settled:!0,final:!0}),oe({environment:this.env,audioSessionId:this.id,blockStore:this.blockStore,index:s,transcriptions:[{text:t,settled:!0}],transaction:n,speakerName:this.speakerName}),s+=t.length}if(s>X){const e=ne({environment:this.env,parentBlockStore:t,siblingBlockStore:this.blockStore,transaction:n});this.setBlockStore(e),s=0}if(o){const t=s>0?` ${e}`:e;this.logInsert({transactionId:n.id,text:t,index:s,settled:!0,final:!0}),oe({environment:this.env,audioSessionId:this.id,blockStore:this.blockStore,index:s,transcriptions:[{text:t,settled:!0}],transaction:n,speakerName:this.speakerName}),s+=t.length}}const u=R({segments:i,forceSettled:e,indent:s>0});0!==u.length&&(u.forEach((({text:e,settled:t})=>{this.logInsert({transactionId:n.id,text:e,index:s,settled:t,final:!1})})),oe({environment:this.env,audioSessionId:this.id,blockStore:this.blockStore,index:s,transcriptions:u,transaction:n,speakerName:this.speakerName}))}});a.catch((e=>{Z(this.rootBlockId,e,{type:"transactionError",transactionId:s})}))}}function te(e){return h().createAndCommit({userAction:"dictationActions.createDictationBlock",environment:e.environment,canUndo:!1,perform:t=>ne({...e,transaction:t})})}function ne(e){var t,n;const{environment:i,parentBlockStore:r,siblingBlockStore:a,transaction:s}=e,c=(null==a?void 0:a.getDictationRoleModel())??o().xd.text,l=null===(t=F().ei.state)||void 0===t?void 0:t.isTranscriptionBlock();if(i.device.isMobile&&!l&&!r.isTranscriptionBlock()){const e=b().insertBlockBelow({environment:i,selection:a?[a]:[],createBlockItem:k().ry[c],transaction:s,analyticsFrom:"dictation",preventSetSelection:!0});return(0,f().z)({store:e.getBlockTitleStore()}),e}const d=r.isTranscriptionBlock()?null===(n=r.getContentStores().find((e=>{const t=r.getFormat().transcription_transcript_id;return e.id===t})))||void 0===n?void 0:n.getContentStore():r.getContentStore();if(!d)throw new Error("No parent dictation content store found");const u=v().Wv({environment:i,type:c,inMemoryRecordCache:r.inMemoryRecordCache,transaction:s});return m().NI({parentStore:d,childStore:x().B.createChildStore(d,u.pointer),after:null==a?void 0:a.id,transaction:s}),u}function oe(e){var t,n;const{environment:o,audioSessionId:i,blockStore:a,index:s,transcriptions:c,transaction:l,speakerName:d}=e;if(!a.isDictatableBlock())return;const u=[],m=c.filter((e=>Boolean(e.text)));for(const[p,g]of m.entries()){const{text:e,settled:t}=g,n=p===m.length-1?e:`${e} `,o=t?(0,r().Ey_)(n):(0,r().Ey_)(n,[(0,r().lf7)(M().h5,i,g.segmentId)]);u.push(o)}g().yr({environment:o,index:s,store:a.getBlockTitleStore(),tokens:u,transaction:l,updateSelection:!1}),d&&(null===(t=a.getFormat().transcript_metadata)||void 0===t?void 0:t.speaker_name)!==d&&p().zA({stores:[a],update:{transcript_metadata:{...a.getFormat().transcript_metadata,speaker_name:d}},transaction:l});const v=null===(n=F().ei.state)||void 0===n?void 0:n.isTranscriptionBlock();o.device.isMobile&&!v&&(0,f().z)({store:a.getBlockTitleStore()})}function ie(e){return e.map((e=>e.getText())).filter((e=>Boolean(e))).join(" ").trim()}function re(e){return new Promise(((t,n)=>{try{const o=new Blob(e),i=new FileReader;i.readAsDataURL(o),i.onloadend=()=>{var e;const o=null===(e=i.result)||void 0===e?void 0:e.toString().split(",")[1];o?t(o):n(new Error("No base64Audio"))}}catch(o){n(o)}}))}function ae(e,t,o){if((0,d().O9)(o)&&!o.pathIsDead()&&o.id!==t.id){const i=(0,T().N)(t),r=(0,T().N)(o);if((0,d().O9)(i)&&(0,d().O9)(r)&&i.id===r.id){const i=(0,n(227894).g)(o);if((()=>{for(const e of i)if(e instanceof x().B){if(e.id===t.id)return!0;if(e.id===r.id)return!1}return!1})()){const t=o.getParentBlockStore();if(o.isEmptyDictatableBlock()&&[...F().Ay.state.audioSessionBlockWriters.values()].every((e=>e.getBlockStore().id!==o.id)))return o;if(t)return te({environment:e,parentBlockStore:t,siblingBlockStore:o}).performResult}}}return te({environment:e,parentBlockStore:t}).performResult}class se{static async getAllProcessableFramesAsBase64(e){const t=16*Math.max(1,e),n=Math.floor(this.audioBuffer.length/t);if(n>0){const e=n*t,o=this.audioBuffer.slice(0,e);return this.audioBuffer=this.audioBuffer.slice(e),this.audioEncoderQueue.enqueue((()=>re([new Float32Array(o)])))}return!1}static getDictationAudioRecorder(e){const{environment:t,includeSystemAudio:n,blockStore:o,saveLocalRecordings:r=!1}=e,a=F().Ay.state.audioRecorder;a&&a.destroy();const s=r&&o.isTranscriptionBlock()?{blockStore:o}:void 0;return new(E().Nr)({environment:t,onDataReceived:n=>{F().gZ.state&&(this.audioBuffer.push(...n),this.getAllProcessableFramesAsBase64(96).then((n=>{if(n){const r=(0,j().$)((0,U().F)(t.currentUser.id));(0,S().$g)({base64Audio:n,environment:t,language:r,onRequestSent:()=>{F().Ay.setState({...F().Ay.state,transcriptionLastSentAt:Date.now()})}}).catch((e=>{i().log({level:"error",from:"dictationActions",type:"sendAudioDataFailed",error:(0,l().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:o.id}}})}));const a=F().ei.state;if(a&&a.isTranscriptionBlock()){"transcribing"!==(0,z().by)(a).state&&le({environment:e.environment,from:"transcription_block_stopped"})}}})).catch((e=>{i().log({level:"error",from:"dictationActions",type:"audioRecorderFailed",error:(0,l().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:o.id}}})})))},onStop:e=>{e&&i().log({level:"error",from:"dictationActions",type:"audioRecorderStopped",error:(0,l().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:o.id}}}),le({environment:t,error:e,from:"audio_recorder_stopped"})},includeSystemAudio:n,saveAudioFileMetadata:s})}static get dictationIsActive(){return Boolean(this.startController&&!this.startController.signal.aborted)}static async startDictation(e){const{environment:t,blockStore:o,from:r}=e,s=o,d=s.isTranscriptionBlock();try{this.stopDictation({environment:t,from:r}),this.startController=new AbortController;const o=this.startController.signal;let f;if(F().Ay.setState({...F().Ay.state,environment:t,tabId:t.device.isElectron?n(982254).A.state.currentTab.id:void 0,loading:!0}),e.preCreateDictationBlock&&s){const{performResult:e}=te({environment:t,parentBlockStore:s});f=e,await n(908006).default.afterNextFlush((()=>{(0,n(903864).e)({store:e.getBlockTitleStore()})}))}const b=(0,S().qY)();(0,I().uB)(t,{dictation_session_id:b,from:r});if(!d||!(0,n(789370).x)())throw new Error("Target is not dictatable.");const k=await(0,z().Y2)({environment:t}),A=this.getDictationAudioRecorder({...e,blockStore:s,saveLocalRecordings:k});ue.start(s.id);try{var u;await A.start();const i=L().Ay.state;if(L().Ay.setState({...i,audio:L().a3}),o.aborted)throw new Error("start dictation aborted");const r=d?null===(u=function(e){const{environment:t,transcriptionBlockStore:n}=e,o=(0,z().y1)(n,"transcript");if(o)return o;const{performResult:i}=h().createAndCommit({userAction:"transcriptionBlockTabActions.getOrCreateTranscriptionTabBlockStore",environment:t,perform:e=>{const o=v().Wv({environment:t,type:"text",inMemoryRecordCache:n.inMemoryRecordCache,transaction:e});m().NI({transaction:e,parentStore:n,childStore:o});const i=v().Wv({environment:t,type:"text",inMemoryRecordCache:n.inMemoryRecordCache,transaction:e});return m().NI({transaction:e,parentStore:o,childStore:i}),p().zA({transaction:e,stores:[n],update:{transcription_transcript_id:o.id}}),o},canUndo:!1});return i}({environment:t,transcriptionBlockStore:s}))||void 0===u?void 0:u.getContentStores().at(-1):n(502438).default.state.stores.slice(-1).pop();await(0,y().A7)(t),F().Ay.setState({...F().Ay.state,audioRecorder:A,enabled:!0,talking:!1,rootBlock:s,block:f??ae(t,s,r),lastReceivedTranscriptionAt:Date.now(),transcriptionLastSentAt:Date.now()});const c=W().c.getModelOverride(s.id);(0,y().rJ)({environment:t,rootBlockId:(0,a().o9)(s.id)}),(0,S().sN)({environment:t,setting_type:"model_override",model:c,rootBlockId:s.id,disableToast:"none"===c}),(0,y().UC)((()=>{(0,y().rJ)({environment:t,rootBlockId:(0,a().o9)(null==s?void 0:s.id)});const e=W().c.getModelOverride((0,a().o9)(null==s?void 0:s.id));(0,S().sN)({environment:t,setting_type:"model_override",model:e,rootBlockId:s.id,disableToast:"none"===e})})),(0,I().D_)(t,{dictation_session_id:b,block_id:s.id,transcription_started_from:e.transcriptionStartedFrom})}catch(g){if(!o.aborted)try{const{audio:n}=await L().Ay.checkPermissions(e.includeSystemAudio);(0,I().rP)(t,{type:"mic_permissions",dictation_session_id:b,reason:n})}catch(g){i().log({level:"error",from:"dictationActions",type:"checkPermissionsFailed",error:(0,l().convertErrorToLog)(g),data:{miscDataToConvertToString:{dictationSessionId:b,rootBlockId:s.id}}})}if(A.destroy((0,c().A)(g)),d){const{audio:t,screenRecording:n}=await L().Ay.checkPermissions(e.includeSystemAudio);throw i().log({level:"error",from:"dictationActions",type:"dictationFailedToStart",error:(0,l().convertErrorToLog)(g),data:{miscDataToConvertToString:{dictation_session_id:b,transcription_id:s.id,audioPermissions:t,screenRecordingPermissions:n}}}),Z(s.id,g,{type:"dictationStartError",from:r}),g}}}catch(g){if(this.stopDictation({environment:t,from:"start_transcription_error",error:(0,c().A)(g)}),d)throw g}finally{F().Ay.setState({...F().Ay.state,loading:!1})}}static stopDictation(e){const t=F().Ay.state.rootBlock;if((0,y().lW)(),this.startController&&!this.startController.signal.aborted){this.startController.abort();const{environment:r,error:a,from:s}=e,c=(0,S().qY)();if((0,I().E_)(r,{dictation_session_id:c,from:s}),(0,n(637368).isExplainableTranscriptionStopReason)(s)&&!a){const g=F().Ay.state.rootBlock;g&&(0,u().B)(r,{toastId:"transcription_recording_stopped",pointer:g.pointer,from:s})}const d=F().Ay.state.tabId;function p(e){const{canRestart:o,name:i,title:a,message:s,notificationBody:c}=e;null!=t&&t.isTranscriptionBlock()&&((0,u().B)(r,{toastId:"transcription_error",pointer:t.pointer,tabId:d,title:a,message:s,name:i,canRestart:o}),(0,n(725081).sendNotificationForDictationInterrupted)({environment:r,blockStore:t,title:a,message:c||s,canRestart:o&&(null==t?void 0:t.isTranscriptionBlock()),tabId:d}))}const m=F().Ay.state.audioRecorder,v=F().Ay.state.enabled;F().Ay.setState({...F().Ay.state,audioRecorder:void 0,enabled:!1,loading:!1,rootBlock:void 0,block:void 0,tabId:void 0,lastReceivedTranscriptionAt:void 0,transcriptionLastSentAt:void 0}),null==m||m.destroy(a),a&&(i().log({level:"error",from:"dictationActions",type:"dictationError",error:(0,l().convertErrorToLog)(a),data:{miscDataToConvertToString:{dictation_session_id:c,block_id:(null==t?void 0:t.id)??""}}}),t&&Z(t.id,a,{type:"dictationError",from:s}),a instanceof D().XG?((0,I().rP)(r,{type:"throttle",dictation_session_id:c}),(0,V().displayDictationUsageErrorSnackbar)()):a instanceof D().eY?((0,I().rP)(r,{type:"missing_user_or_space",dictation_session_id:c,reason:a.message}),(0,V().displayDictationGenericErrorSnackbar)()):a instanceof D().d1?((0,I().rP)(r,{type:"mic_permissions",dictation_session_id:c,reason:L().Ay.state.audio}),(0,V().displayDictationPermissionSnackbar)(M().JS)):a instanceof D().Rv?((0,I().rP)(r,{type:"forbidden",dictation_session_id:c}),p({canRestart:!1,name:a.name,title:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.forbidden.title",defaultMessage:"Unable to transcribe"}),message:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.forbidden.message",defaultMessage:"You do not have permission to run transcription."})})):a instanceof D().Dg?((0,I().rP)(r,{type:"upgrade_required",dictation_session_id:c}),p({canRestart:!1,name:a.name,title:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.upgradeRequired.title",defaultMessage:"You have used all of your free AI Meeting Notes minutes"}),message:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.upgradeRequired.message",defaultMessage:"Upgrade your workspace for full access to AI Meeting Notes."})})):a instanceof D().E6?p({canRestart:!0,name:a.name,title:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.openAI.title",defaultMessage:"Transcription paused"}),message:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.openAI.message",defaultMessage:"We are experiencing high demand. Please wait and try again."}),notificationBody:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.openAI.notification",defaultMessage:"We are experiencing high demand. Please wait and click to resume."})}):a instanceof Error&&p({canRestart:!0,name:a.name,title:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.general.title",defaultMessage:"Transcription paused"}),message:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.general.message",defaultMessage:"Something went wrong. Please try again."}),notificationBody:A().A.intl.formatMessage({id:"dictationActions.stopDictation.error.general.notification",defaultMessage:"Something went wrong. Please click to resume."})}));try{(0,y().Ep)(r)}catch(o){}finally{ue.stop(null==t?void 0:t.id);const f=F().Ay.state.audioSessionBlockWriters;let h=!1;for(const b of f.values())b.writeToBlock(!0),f.delete(b.getId()),h=!0;h&&F().Ay.emit(),v&&(0,I().Im)(r,{dictation_session_id:c,block_id:(null==t?void 0:t.id)??""}),null!=t&&t.isTranscriptionBlock()&&e.environment&&B().transcriptionBlockActions.ensureTranscriptionIsInActive({environment:e.environment,blockStore:t,from:e.from})}}}}async function ce(e){return se.startDictation(e)}function le(e){const{environment:t,error:n,from:o}=e;se.stopDictation({environment:t,error:n,from:o})}async function de(e){const t=_().default.state.sidebarSpaceStore;if(!t)return;const n={};for(const i of e){var o;const e=i.pointer,r=x().B.createChildStore(t,e);if(await r.load(),!r.isTranscriptionBlock()||r.id===(null===(o=F().Ay.state.rootBlock)||void 0===o?void 0:o.id))continue;const a=(0,z().y1)(r,"transcript");if(!a)continue;await a.load();const s=a.getContentStores().at(-1);s&&(await s.load(),n[e.id]={rootBlockStore:r,dictatingBlockStore:s})}F().Ay.setState({...F().Ay.state,passiveBlockMap:{...F().Ay.state.passiveBlockMap,...n}})}se.startController=void 0,se.audioBuffer=[],se.audioEncoderQueue=new(s().O)(1);class ue{constructor(){if(ue.instance)return ue.instance;ue.instance=this}static start(e){Y(e,{type:"start"}),this.listening||(this.listening=!0,y().$I.on(y().Ux,ue.processTranscriptionResult),y().$I.on(y().L6,ue.processVadEvent),y().$I.on(y().bH,ue.processRateLimitEvent),y().$I.on(y().zz,ue.processForbiddenEvent),y().$I.on(y().gA,ue.processUpgradeRequiredEvent),y().$I.on(y().YE,ue.processFreeTrialLimitEvent),y().$I.on(y().ZQ,ue.processOpenAIErrorEvent),y().$I.on(y().ys,ue.processAudioWriterSettingsEvent))}static stop(e){e&&Y(e,{type:"stop"}),this.listening&&(this.listening=!1,y().$I.off(y().Ux,ue.processTranscriptionResult),y().$I.off(y().L6,ue.processVadEvent),y().$I.off(y().bH,ue.processRateLimitEvent),y().$I.off(y().zz,ue.processForbiddenEvent),y().$I.off(y().gA,ue.processUpgradeRequiredEvent),y().$I.off(y().YE,ue.processFreeTrialLimitEvent),y().$I.off(y().ZQ,ue.processOpenAIErrorEvent),y().$I.off(y().ys,ue.processAudioWriterSettingsEvent))}static processOpenAIErrorEvent(e){if(429===e.status||503===e.status){var t;const{environment:n}=F().Ay.state;n&&le({environment:n,error:new(D().E6)(e.message,e.status),from:"transcription_error"}),i().log({level:"error",from:"dictationActions",type:"openAIError",error:(0,l().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:null===(t=F().Ay.state.rootBlock)||void 0===t?void 0:t.id}}})}}static processForbiddenEvent(e){var t;const{environment:n}=F().Ay.state;n&&le({environment:n,error:new(D().Rv)("Not eligible for dictation"),from:"forbidden"}),i().log({level:"error",from:"dictationActions",type:"forbidden",error:(0,l().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:null===(t=F().Ay.state.rootBlock)||void 0===t?void 0:t.id}}})}static processFreeTrialLimitEvent(e){w().W.setState({type:"available",usage:e.currentS,limit:e.limitS})}static processAudioWriterSettingsEvent(e){X=e.settings.max_block_char_size;const t=e.settings.transcription_model;t&&F().Ay.state.rootBlock&&F().Ay.state.environment&&B().transcriptionBlockActions.updateTranscriptionModel({environment:F().Ay.state.environment,blockStore:F().Ay.state.rootBlock,transcriptionModel:t})}static processUpgradeRequiredEvent(e){var t,n,o;const{environment:r}=F().Ay.state;w().W.setState({type:"unavailable"}),r&&le({environment:r,error:new(D().Dg)("Free usage used up, workspace upgrade is required"),from:"upgrade_required"}),i().log({level:"info",from:"dictationActions",type:"upgrade_required",error:(0,l().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:null===(t=F().Ay.state.rootBlock)||void 0===t?void 0:t.id,userId:null===(n=_().default.state.currentUserStore)||void 0===n?void 0:n.id,spaceId:null===(o=_().default.state.sidebarSpaceStore)||void 0===o?void 0:o.id}}})}static processRateLimitEvent(e){var t;const{environment:n}=F().Ay.state;w().W.setState({type:"rateLimited",retryAfterSec:e.retryAfterSec}),n&&le({environment:n,error:new(D().XG)("Audio usage limit reached"),from:"rate_limit"}),i().log({level:"error",from:"dictationActions",type:"rateLimit",error:(0,l().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:null===(t=F().Ay.state.rootBlock)||void 0===t?void 0:t.id}}})}static processVadEvent(e){F().Ay.setState({...F().Ay.state,talking:e.talking})}static updateDictationBlock(e){F().Ay.setState({...F().Ay.state,block:e})}static processTranscriptionResult(e){const{audioSessionId:t,segmentId:o,isSegmentComplete:i,segmentSortkey:r,isAudioSessionComplete:a,transcription:s,speakerName:c}=e,{enabled:l,rootBlock:d,audioSessionBlockWriters:u,environment:p,block:m}=F().Ay.state;"complete"===s.status&&null!=d&&d.isTranscriptionBlock()&&p&&((0,n(564884).u)({environment:p,event:{eventName:"meeting_note_transcription_received",eventProperties:{block_id:d.id,audio_duration:s.audioDuration,text_length:s.text.length}}}),Y(d.id,{type:"transcription",status:s.status,sessionId:t,isSessionComplete:a,segmentId:o,isSegmentComplete:i,transcriptionId:s.id,text:s.text}));let v=!1;if(!u.has(t)&&p&&l)if(d){const e=ae(p,d,m),n=new ee({id:t,env:p,rootBlockId:d.id,blockStore:e,onUpdateBlock:e=>{t===F().Ay.state.latestSessionId&&ue.updateDictationBlock(e)}});u.set(t,n),v=!0,F().Ay.setState({...F().Ay.state,block:e,latestSessionId:t})}else le({environment:p,from:"block_not_available"});const g=u.get(t);if(g){g.setIsCompleteReceived(a);const e=g.getOrCreateSegment(o,{sortKey:r});e.setIsCompleteReceived(i),e.setTranscription(s.id,s),c&&g.setSpeakerName(c)}for(const n of u.values())n.writeToBlock();for(const n of[...u.values()].filter((e=>e.isSettled())))u.delete(n.getId()),v=!0,l&&p&&d&&F().Ay.state.latestSessionId===n.getId()&&F().Ay.setState({...F().Ay.state,block:ae(p,d,F().Ay.state.block)});l&&F().Ay.setState({...F().Ay.state,lastReceivedTranscriptionAt:Date.now()}),v&&F().Ay.emit()}}ue.instance=void 0,ue.listening=!1;class pe{static getAllProcessableFramesAsBase64(e){const t=16*Math.max(1,e),n=Math.floor(this.audioBuffer.length/t);if(n>0){const e=n*t,o=this.audioBuffer.slice(0,e);return this.audioBuffer=this.audioBuffer.slice(e),this.audioEncoderQueue.enqueue((()=>re([o])))}return Promise.resolve(!1)}static async start(e){try{this.stop(),this.startController=new AbortController,this.env=e.environment,this.isActive=!0,this.currentTranscript="",this.segments.clear(),this.transcriptionListener=e.onTranscription,this.onErrorListener=e.onError,this.streamingSessionId=(0,S().qY)(),this.audioRecorder=new(E().Nr)({environment:e.environment,onDataReceived:t=>{this.audioBuffer=new Float32Array([...this.audioBuffer,...t]),this.getAllProcessableFramesAsBase64(96).then((t=>{if(t){const n=(0,j().$)((0,U().F)(e.environment.currentUser.id));(0,S().$g)({base64Audio:t,environment:e.environment,language:n}).catch((()=>{}))}})).catch((()=>{}))},onStop:()=>{pe.stop()},includeSystemAudio:!1}),await this.audioRecorder.start(),y().$I.on(y().Ux,this.handleTranscriptionEvent)}catch(t){this.onErrorListener&&t instanceof Error&&this.onErrorListener(t),this.stop()}}static stop(){var e;this.isActive&&(this.isActive=!1,this.startController&&!this.startController.signal.aborted&&this.startController.abort(),y().$I.off(y().Ux,this.handleTranscriptionEvent),null===(e=this.audioRecorder)||void 0===e||e.destroy(),(0,y().Ep)((0,a().o9)(this.env)),this.audioRecorder=void 0,this.streamingSessionId=void 0,this.env=void 0)}}J=pe,pe.startController=void 0,pe.env=void 0,pe.audioBuffer=new Float32Array,pe.audioEncoderQueue=new(s().O)(1),pe.audioRecorder=void 0,pe.streamingSessionId=void 0,pe.isActive=!1,pe.transcriptionListener=void 0,pe.onErrorListener=void 0,pe.segments=new Map,pe.currentTranscript="",pe.handleTranscriptionEvent=e=>{var t;const n=e.segmentId;let o=J.segments.get(n);o||(o=new C({id:n,sortKey:e.segmentSortkey}),J.segments.set(n,o)),o.setIsCompleteReceived(e.isSegmentComplete),o.setTranscription(e.transcription.id,e.transcription);const i=ie(Array.from(J.segments.values()));J.currentTranscript=i,null===(t=J.transcriptionListener)||void 0===t||t.call(J,J.currentTranscript)}},888643:(e,t,n)=>{n.d(t,{k:()=>i});var o=()=>n(402014);function i(e){(0,o().SQ)({event:e,context:o().y$.Click,callback:()=>{}})}},899206:(e,t,n)=>{n.r(t),n.d(t,{startTranscribingBlockOnPageFromTrustedSource:()=>s,startTranscribingBlockOnPageFromUntrustedSource:()=>c});var o=()=>n(520689),i=()=>n(486674),r=()=>n(540144),a=()=>n(271380);async function s(e){const{environment:t,from:n}=e,o=(0,i().a)();if(!o)return;const s=(0,r().Ql)(o);s.sort(((e,t)=>t.getCreatedTime()-e.getCreatedTime()));const c=s[0];c&&await(0,a().startTranscription)({environment:t,blockStore:c,from:n})}async function c(e){const{environment:t,from:n,nonce:i}=e;if(await(0,o().i)()===i)return s({environment:t,from:n})}},903047:(e,t,n)=>{n.d(t,{E:()=>i});var o=()=>n(401497);function i(e){const{size:t,style:n}=e;return(0,o().IS)((e=>({icon:{width:.6*t,height:.6*t,fill:e.text.secondary},iconContainer:{width:t,height:t,borderRadius:"100%",background:e.regularDividerColor,display:"flex",alignItems:"center",justifyContent:"center",...n}})),[t,n])}},909557:(e,t,n)=>{n.d(t,{$W:()=>a,Dg:()=>d,E6:()=>u,Rv:()=>l,Tn:()=>s,XG:()=>c,Yh:()=>r,d1:()=>i,eY:()=>p});var o=()=>n(416845);class i extends o().WX{constructor(e){super({level:"error",status:500,name:"DictationAudioRecorderFailedError",message:e||"Audio recorder failed",retryable:!1})}}class r extends o().WX{constructor(){super({level:"error",status:500,name:"DictationSystemAudioFailedError",message:"System audio failed",retryable:!1})}}class a extends o().WX{constructor(){super({level:"error",status:500,name:"DictationSystemAudioHardwareError",message:"System audio hardware error",retryable:!1})}}class s extends o().WX{constructor(){super({level:"error",status:500,name:"DictationStartTimeoutError",message:"Dictation start timeout",retryable:!0})}}class c extends o().WX{constructor(e){super({level:"error",status:429,name:"DictationRateLimitError",message:e||"Rate limit exceeded",retryable:!1})}}class l extends o().WX{constructor(e){super({level:"error",status:403,name:"DictationForbiddenError",message:e||"Access forbidden",retryable:!1})}}class d extends o().WX{constructor(e){super({level:"error",status:403,name:"DictationUpgradeRequiredError",message:e||"Workspace upgrade required",retryable:!1})}}class u extends o().WX{constructor(e,t){super({level:"error",status:t&&(0,n(513416).Mh)(t)?t:500,name:"DictationOpenAIError",message:e,retryable:!0})}}class p extends o().WX{constructor(e){super({level:"error",status:400,name:"DictationMissingUserOrSpaceError",message:e||"Missing user or space information",retryable:!1})}}},911063:(e,t,n)=>{n.r(t),n.d(t,{getActiveTranscriptionBlockStore:()=>i});var o=()=>n(964345);function i(){const e=o().ei.state;if(null!=e&&e.isTranscriptionBlock())return e}},939555:(e,t,n)=>{n.d(t,{I:()=>i});var o=()=>n(765957);function i(e,t){if(function(e){return e===o().default.state.mainEditorCurrentBlockStore}(e)){const{RouterStore:e}=t,n=e.state.route;if("page"===n.name)return n.collectionViewId}}},964576:(e,t,n)=>{n.d(t,{A:()=>i});class o extends(()=>n(757695))().Store{constructor(){super()}getInitialState(){}}const i=new o},977870:(e,t,n)=>{n.d(t,{c:()=>i});class o extends(()=>n(757695))().Store{getInitialState(){return{wasGetVisibleUsersCalled:!1}}}const i=new o;n(852832).exposeDebugValue("GetVisibleUsersStore",i)},981305:(e,t,n)=>{n.d(t,{B:()=>r});n(16280);var o=n(296540),i=()=>n(472090);function r(e,t,n=0){(0,o.useEffect)((()=>{const o=new(i().E)({throttleMs:n});if(!e.current)throw new Error("ref.current is null");return o.observe(e.current),o.rect.addListener(t),()=>{o.destroy()}}),[t])}},986850:(e,t,n)=>{e.exports=n.p+"dbc10b469ee58d20.js"}}]);