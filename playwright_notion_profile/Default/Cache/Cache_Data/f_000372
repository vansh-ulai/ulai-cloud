"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[20370,30443,92821],{346:(e,t,o)=>{o.d(t,{MG:()=>m,T1:()=>g,a1:()=>v,dt:()=>S,kg:()=>y,lC:()=>h,n_:()=>f});var n=o(296540),i=()=>o(484714),r=()=>o(56366),l=()=>o(187174),s=()=>o(645873),a=()=>o(941463),c=()=>o(441199),d=()=>o(749687),u=()=>o(737230),p=()=>o(756114);const g=new(s().O2)("PerformanceToolbar",(()=>Promise.all([o.e(71386),o.e(45624)]).then(o.bind(o,688201)))),m=(0,s()._h)(g,(e=>e.PerformanceToolbar)),S=(0,s()._h)(g,(e=>e.PerformanceToolbarSettings));function y(){const e=(0,i().v3)();return(0,r().K8)((()=>(0,p().D)(e,e.RouterStore.state)),[e])}function f(){const e=(0,i().v3)(),t=x("performanceToolbarStore"),o=x("isPerformanceToolbarVisible");return(0,r().K8)((()=>!(!t||!o)&&o(e,e.RouterStore.state,t.state)),[o,e,t])}function h(){const e=x("performanceToolbarStore");return(0,r().K8)((()=>!!e&&e.state.isPerformanceToolbarMounted),[e])}function v(){const e=(0,i().v3)(),t=x("createPerformanceToolbarMouseListeners"),o=x("performanceToolbarStore"),{sidebarExpanded:l,sidebarWidth:s,secondarySidebarExpanded:p,secondarySidebarWidth:g,updateSidebarExpanded:m,updateSidebarWidth:S}=(0,r().K8)((()=>({sidebarExpanded:d().sidebarExpandedStore.state,sidebarWidth:d().sidebarWidthStore.state,secondarySidebarExpanded:c().default.isOpen(),secondarySidebarWidth:a().Ay.getWidth(),updateSidebarExpanded:u().Ay.state.expanded,updateSidebarWidth:u().Ay.state.width})),[]);return(0,n.useEffect)((()=>{if(o&&t)return t(e,(e=>o.update((t=>({...t,isMouseNearPerformanceToolbar:e})))),l,s,p,g,m,S)}),[t,e,o,l,s,p,g,m,S])}function x(e){const t=y(),[{value:o}]=(0,l().Yb)((()=>t?g.load().then((t=>t[e])):Promise.resolve(void 0)),[e,t]);return o}},3197:(e,t,o)=>{o.d(t,{t:()=>a});var n=o(296540),i=()=>o(183558),r=()=>o(248064),l=()=>o(384130),s=()=>o(937199);function a(e){const{setModuleSelection:t,layoutStore:o}=(0,s().LH)(),a=(0,r().h)(),{dismissTooltip:c}=(0,l().J)();return(0,n.useCallback)((()=>{var n;"form"===(null===(n=o.getModel())||void 0===n?void 0:n.getLayoutType())&&"form_conditional_modules"!==e.area?a({layoutModule:{type:"placeholder",id:(0,i().Ay)()},position:e.afterModuleId?{type:"module_relative",area:e.area,direction:"below",relativeToModuleId:e.afterModuleId}:void 0}):(t({type:"new_module",isDragging:!1,..."views_main_tab_modules"===e.area?{area:"views_main_tab_modules",viewsMainTabId:e.viewsMainTabId}:{area:e.area}}),"page_main"===e.area&&c())}),[o,e,a,t,c])}},18953:(e,t,o)=>{o.d(t,{H:()=>r});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"4.53 2.55 11.03 14.94",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M13.105 4.184a1.475 1.475 0 1 1-2.934-.309 1.475 1.475 0 0 1 2.934.309m-5.297 7.25-.753 2.994-2.334 2.101a.55.55 0 0 0 .737.817l2.582-2.325.72-2.864-.662-.476a2.3 2.3 0 0 1-.29-.247"}),(0,n.jsx)("path",{d:"M11.681 8.169q.127.206.208.442l.567 1.67a.55.55 0 0 0 .66.354l2.032-.527a.55.55 0 1 0-.276-1.065l-1.539.4-.403-1.186a3.296 3.296 0 0 0-3.278-2.232l-3.02.145a.55.55 0 0 0-.513.438l-.501 2.42a.55.55 0 0 0 1.077.223l.415-2.002 1.654-.08-.03.294-.603 2.18a1.45 1.45 0 0 0 .516 1.537l3.05 2.335-2.08 1.51a.55.55 0 1 0 .647.89l2.579-1.873a.64.64 0 0 0 .013-1.026l-2.168-1.659z"})]})},r=(0,o(340498).wt)("figureRun",i)},38e3:(e,t,o)=>{o.d(t,{$:()=>p,Q:()=>g});o(16280);var n=()=>o(179034),i=()=>o(869558),r=()=>o(44729),l=()=>o(384944),s=()=>o(231297),a=()=>o(594794),c=()=>o(972435),d=()=>o(913530),u=()=>o(435930);function p(e){const{environment:t,layoutStore:o,transaction:n,options:i}=e,{inMemoryRecordCache:s}=o,a=o.getSpaceId(),c=o.getParentPointer();if(!c||"collection"!==c.table)throw new Error("Invalid state: no collection pointer");if(!a)throw new Error("Cannot add collection view to views main module -- Invalid state: no space id");const d=l().Wv({environment:t,type:"collection_view",inMemoryRecordCache:s,transaction:n});r().NI({childStore:d,parentStore:o,transaction:n});const{collectionViewStore:u}=g({environment:t,transaction:n,layoutStore:o,collectionViewBlockStore:d,options:i});return{collectionViewStore:u,collectionViewBlockStore:d}}function g(e){const{environment:t,transaction:o,layoutStore:r,collectionViewBlockStore:p,options:g}=e,{inMemoryRecordCache:m}=r,S=r.getParentPointer();if(!S||"collection"!==S.table)throw new Error("Invalid state: no collection pointer");const y=r.getSpaceId();if(!y)throw new Error("Cannot add collection view to views main module -- Invalid state: no space id");const f=(0,a().JH)({environment:t,table:i().Gy,spaceId:y}),h={id:f.id,type:"page",parent_id:p.pointer.id,parent_table:n().ev,space_id:y,alive:!0,name:c().A.formatMessage(u().s.editor),format:{collection_pointer:S,hide_linked_collection_name:!0}};return null!=g&&g.viewsTabId&&(h.format={...h.format,page_layout_pointer:{...r.pointer,views_main_tab_id:g.viewsTabId}}),l().eC({environment:t,table:i().Gy,value:h,inMemoryRecordCache:m,transaction:o}),s().applyOperation({store:p,operation:{pointer:p.pointer,path:["view_ids"],command:"listBefore",args:{id:f.id}},transaction:o}),{collectionViewStore:d().p.createChildStore(p,f)}}},48382:(e,t,o)=>{o.d(t,{z:()=>p});o(296540);var n=()=>o(614525),i=()=>o(364871),r=()=>o(56366),l=()=>o(69708),s=()=>o(436696),a=()=>o(873864),c=o(474848);const d=function({collectionContextStore:e,collectionSettingsStore:t}){const n=(0,o(484714).v3)(),i=(0,l().tz)(),d=(0,r().O$)(e.permissionScopesStore),u=(0,r().K8)((()=>!d.canConfigureBlock||"collectionTypedView"===e.contextType),[e,d]),{viewName:p,viewType:g}=(0,r().K8)((()=>{var t,o;return{viewName:null===(t=e.collectionViewStore())||void 0===t?void 0:t.getName(),viewType:null===(o=e.collectionViewStore())||void 0===o?void 0:o.getType()}}),[e]),m=!(0,r().O$)(o(929219).e);if(u||!g)return null;let S=(0,c.jsx)(l().sA,{defaultMessage:"Duplicate view",id:"database.viewSettings.mainTab.duplicateButton.title"});return"chart"===g?S=(0,c.jsx)(l().sA,{defaultMessage:"Duplicate chart",id:"database.viewSettings.mainTab.duplicateButton.title.chart"}):p&&(S=(0,c.jsx)(l().sA,{defaultMessage:"Duplicate {viewName}",id:"database.viewSettings.mainTab.duplicateButton.title.viewName",values:{viewName:p}})),(0,c.jsx)(o(497222).A,{icon:o(764781).V,title:S,onClick:()=>function(e,t,o,n){const i=t.collectionViewStore();i&&((0,a().v)({environment:e,collectionContextStore:t,collectionViewStore:i,collectionSettingsStore:o,intl:n,from:"view_settings_duplicate"}),(0,s().X)({environment:e,collectionContextStore:t,action:"click_duplicate",original_view_type:i.getType()}))}(n,e,t,i),disabled:m})};var u=()=>o(448701);function p({collectionContextStore:e,collectionSettingsStore:t}){return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(u().z,{collectionContextStore:e}),(0,c.jsx)(n().A,{collectionContextStore:e}),(0,c.jsx)(d,{collectionContextStore:e,collectionSettingsStore:t}),(0,c.jsx)(i().A,{collectionContextStore:e,collectionSettingsStore:t})]})}},58488:(e,t,o)=>{o.d(t,{I:()=>a});o(296540);var n=()=>o(56366),i=()=>o(348241),r=()=>o(908201),l=()=>o(937199),s=o(474848);function a(e){const{children:t}=e,o=(0,r().ET)(),a=(0,n().O$)(o.formsBaseLayoutEditorContextValueStore),c=(0,n().O$)(o.formsSpecificLayoutEditorContextValueStore);return a&&c?(0,s.jsx)(l().Op.Provider,{value:a,children:(0,s.jsx)(i().zi.Provider,{value:c,children:t})}):null}},63667:(e,t,o)=>{o.d(t,{k:()=>m});o(296540);var n=()=>o(56366),i=()=>o(401497),r=()=>o(713998),l=()=>o(852424),s=()=>o(340498),a=()=>o(859428),c=()=>o(852353),d=()=>o(553965),u=()=>o(937199),p=()=>o(478573),g=o(474848);function m(e){const{propertyId:t}=e,{collectionStore:o}=(0,u().LH)(),m=(0,i().DP)(),S=(0,n().K8)((()=>{if(!o)return;const e=o.getSchema();return(0,r()._g)({schema:e,property:t})}),[o,t]);if(!S)return null;const y=S.type;return(0,g.jsx)(a().A,{textWrap:!0,placement:"left",renderTooltip:()=>e.tooltip,disableTooltip:!e.tooltip,render:t=>(0,g.jsx)(p().A,{...(0,d().A)(t,e),icon:(0,g.jsx)(l().zB,{size:s().Ev.sm,theme:m,icon:S.icon,type:y}),name:S.name,subText:c().dC[y],disabled:e.disabled})})}},72645:(e,t,o)=>{o.d(t,{b:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("plusMedium",{viewBox:"0 0 16 16",svg:(0,n.jsx)("g",{children:(0,n.jsx)("path",{d:"M2 8a.77.77 0 01.237-.566.762.762 0 01.566-.244h4.394V2.803a.77.77 0 01.237-.566A.773.773 0 018 2c.225 0 .416.079.573.237a.773.773 0 01.237.566V7.19h4.387c.22 0 .409.081.566.244A.773.773 0 0114 8a.781.781 0 01-.237.573.785.785 0 01-.566.23H8.81v4.401a.764.764 0 01-.237.56A.781.781 0 018 14a.773.773 0 01-.566-.237.764.764 0 01-.237-.559V8.803H2.803a.785.785 0 01-.566-.23A.781.781 0 012 8z"})})})},73956:(e,t,o)=>{o.r(t),o.d(t,{checkmarkFillSmallIcon:()=>i,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"2.87 2.88 10.25 10.24",svg:(0,o(474848).jsx)("path",{d:"M12.756 2.987a.75.75 0 0 1 .257 1.029l-5.244 8.74a.75.75 0 0 1-1.213.102L3.06 8.78a.75.75 0 0 1 1.14-.976l2.818 3.289 4.709-7.848a.75.75 0 0 1 1.029-.257"})},i=(0,o(340498).wt)("checkmarkFillSmall",n)},80659:(e,t,o)=>{o.d(t,{$:()=>i});var n=()=>o(66689);function i(e){return e!==n().Lu}},83486:(e,t,o)=>{o.d(t,{Y:()=>g});o(296540);var n=()=>o(484714),i=()=>o(56366),r=()=>o(105819),l=()=>o(69708),s=()=>o(436696),a=()=>o(89924),c=()=>o(147503),d=()=>o(647702),u=()=>o(497222),p=o(474848);function g(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,g=(0,n().v3)(),m=(0,i().K8)((()=>{const e=t.permissionScopesStore.state;return!(0,d().K)({collectionContextStore:t,permissionScopes:e})}),[t]);return(0,p.jsx)(a().A,{title:(0,p.jsx)(l().sA,{defaultMessage:"SCIM properties",id:"database.viewSettings.mainTab.editScimPropertiesSection.title"}),topBorder:!0,extraPadding:!0,children:(0,p.jsx)(u().A,{icon:r().pencilLineIcon,title:(0,p.jsx)(l().sA,{defaultMessage:"Edit properties",id:"database.viewSettings.mainTab.editScimPropertiesButton.title"}),disabled:m,showChevron:!m,onClick:()=>{(0,s().X)({environment:g,collectionContextStore:t,action:"click_edit_scim_properties"}),c().a2({collectionSettingsStore:o,item:{type:"editScimProperties"}})}})},"edit-scim-properties")}},95347:(e,t,o)=>{o.d(t,{Dj:()=>k,NE:()=>P,Ro:()=>I,hw:()=>T,rD:()=>_});o(944114),o(898992),o(672577),o(581454),o(737550);var n=o(296540),i=()=>o(484714),r=()=>o(56366),l=()=>o(401497),s=()=>o(489242),a=()=>o(455348),c=()=>o(496603),d=()=>o(154017),u=()=>o(36629),p=()=>o(231297),g=()=>o(845147),m=()=>o(413955),S=()=>o(374562),y=()=>o(235059),f=()=>o(652079),h=()=>o(969956),v=()=>o(147503),x=()=>o(334955),b=()=>o(180762),C=()=>o(765957),w=()=>o(666429),j=()=>o(455338),A=()=>o(234675);function _(e){return(0,r().K8)((()=>{var t;if(!e)return;const o=null===(t=e.collectionStore())||void 0===t?void 0:t.getDatabaseType();return o?(0,y().l)((0,m().appConfigs)(),o):void 0}),[e])}function I(e,t){return(0,r().K8)((()=>{const o=e.collectionStore(),n=e.collectionViewBlockStore(),i=[],r=[];if(!o||!n)return{addedFeatures:i,suggestedFeatures:r};for(const l of t)l.isFeatureAdded(l,e)?i.push(l):r.push(l);return{addedFeatures:i,suggestedFeatures:r}}),[t,e])}function k(e){const{collectionContextStore:t,feature:o,appConfig:n}=e;if((0,A().l)(o))return o.isFeatureAdded(o,t);if((0,f().l)(o)||(0,h().u)(o))return M({collectionContextStore:t,feature:o});const i=function(e,t){return c().oE(e.variants.map((e=>{const o=null==t?void 0:t.find((t=>t.uri===e));if(o&&(0,f().l)(o))return o})))}(o,null==n?void 0:n.allFeatures);return i.some((e=>M({collectionContextStore:t,feature:e})))}function M(e){const{collectionContextStore:t,feature:o}=e,n=t.collectionStore();if(o.uri===(0,S().md)().uri)return Boolean(t.currentSubitemFormatStoreForCollectionStore.state);if(o.uri===(0,S().J4)().uri){const e=(0,x().QZ)({feature:"timeline_arrows_by",collectionContextStore:t});return Boolean(e)}const i=a().u9.derivePropertyUris((null==n?void 0:n.getSchema())??{},null==n?void 0:n.getPropertyMapping());return o.dependencies.some((e=>{const o="property"===e.type&&function(e){var t;const{collectionContextStore:o,dependency:n,propertyUris:i}=e,r=null===(t=o.collectionStore())||void 0===t?void 0:t.getDatabaseType();if(n.collectionUri===r)return(0,s().LE)(n.uri)&&i.has(n.uri);if((0,s().XA)(n.collectionUri))return(0,s().M7)(n.uri)&&i.has(n.uri);return!1}({dependency:e,collectionContextStore:t,propertyUris:i}),n="collection_view"===e.type&&function(e){var t;const{collectionContextStore:o,dependency:n}=e,i=o.collectionViewBlockStore(),r=null===(t=o.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.app_config_uri;if(!i||!r)return!1;var l,a;return n.collectionUri===r?n.collectionViewBlockUri===i.getFormat().app_config_uri&&n.uri in((null===(l=i.getFormat())||void 0===l?void 0:l.app_uri_map)??{}):!!(0,s().XA)(n.collectionUri)&&n.uri in((null===(a=i.getFormat())||void 0===a?void 0:a.app_uri_map)??{})}({dependency:e,collectionContextStore:t});return o||n}))}function T(e,t){const o=(0,i().v3)(),l=function(e){const t=(0,i().v3)(),o=_(e),l=(0,r().O$)(C().AppStoreSidebarSpaceViewStore),s=(0,r().K8)((()=>e.collectionViewBlockStore()),[e]);return(0,n.useCallback)(((n,i)=>{if(!s||!o||!l)return;const r=s.getParentStore();if(!r||"block"!==r.table&&"space"!==r.table&&"team"!==r.table)return;if(1!==n.dependencies.length)return;const a=n.dependencies[0];p().createAndCommit({userAction:"CollectionViewSuggestedViews.createView",environment:t,canUndo:!0,perform:c=>{var u;g().applyTypedFeatures({environment:t,spaceViewStore:l,appParentStore:r,appUri:o.uri,features:[{type:"simple",featureUri:n.uri}],appCollectionViewBlockStores:[s],createOrModify:"modify",transaction:c});const p=((null===(u=s.getFormat())||void 0===u?void 0:u.app_uri_map)??{})[a.uri];(0,b().t)({environment:t,collectionContextStore:e,collectionViewId:p,isFullScreen:e.isFullScreenStore.state,isRootChild:e.isRootChildStore.state,isInPeekRenderer:e.isInPeekRendererStore.state}),(0,d().b)({environment:t,collectionContextStore:e,view_type:a.value.type,view_config_uri:n.uri,feature:{id:p,from:i,type:n.uri},from:"addButton"})}})}),[s,o,l,t,e])}(e),s="more_settings";return(0,n.useCallback)((async n=>{if(n.uri===(0,S().md)().uri)v().a2({collectionSettingsStore:t,item:{type:"subitemV2",from:s}});else if(n.uri===(0,S().J4)().uri)v().a2({collectionSettingsStore:t,item:{type:"dependencies",from:s}});else{const t=n.dependencies[0];"collection_view"===t.type||"collection_view_block"===t.type||"sub_external_collection"===t.type?(l(n,s),w().Ay.setState({...w().Ay.state,shouldReset:!1}),(0,j().t)({featureName:n.name})):(await u().h3({environment:o,feature:n,collectionContextStore:e,addFeatureFrom:s}),(0,j().t)({featureName:n.name}))}}),[o,e,t,l,s])}function P(){return(0,l().IS)((()=>({featureIconWrapper:{height:28,width:28,padding:"6px 0px",borderRadius:4},featureIcon:{width:16,height:16,alignItems:"center",margin:"auto"}})),[])}},131849:(e,t,o)=>{o.d(t,{a:()=>l});var n=()=>o(484714),i=()=>o(56366),r=()=>o(486130);function l(e){const t=(0,n().v3)();return(0,i().K8)((()=>{if(t.currentUser.id&&e)return e.isMemberOrGuest(t.currentUser.id,r()._.getSpacePermissionGroupIds({userId:t.currentUser.id,spaceId:e.getSpaceId()}))}),[t.currentUser.id,e])}},147361:(e,t,o)=>{o.d(t,{r:()=>T});o(581454);var n=o(296540),i=()=>o(401497),r=()=>o(451306),l=()=>o(496603),s=()=>o(534177),a=()=>o(378518),c=()=>o(259464);o(16280);class d{constructor(){this.stiffness=50,this.damping=10,this.precision=.001,this.currentValue=0,this.endValue=0,this.velocity=0}isAtRest(){return Math.abs(this.endValue-this.currentValue)<=this.precision}setEndValue(e){this.endValue=e;const t=this.isAtRest();return t&&this.setAtRest(),t}jumpToEnd(){this.currentValue=this.endValue}step(e){let t=e;do{let e;t>d.timestep?(t-=d.timestep,e=d.timestep):(e=t,t=0);const[o,n]=this.rk4(this.currentValue,this.velocity,e);this.velocity=n,this.currentValue=o}while(t>0);const o=this.isAtRest();return o&&this.setAtRest(),o}setAtRest(){this.currentValue=this.endValue,this.velocity=0}rk4(e,t,o){const n=e,i=t,r=this.computeAccel(n,i,0),l=e+.5*i*o,s=t+.5*r*o,a=this.computeAccel(l,s,o/2),c=e+.5*s*o,d=t+.5*a*o,u=this.computeAccel(c,d,o/2),p=e+d*o,g=t+u*o;return[e+o/6*(i+2*s+2*d+g),t+o/6*(r+2*a+2*u+this.computeAccel(p,g,o))]}computeAccel(e,t,o){return this.stiffness*d.stiffnessMultiplier*(this.endValue-e)-this.damping*d.dampingMultiplier*t}}d.stiffnessMultiplier=1e-5,d.dampingMultiplier=.005,d.timestep=1e3/60;const u=d;function*p(e,t){const o=new u;for(o.currentValue=e,o.endValue=t,o.stiffness=35;;){const e=yield o.currentValue;if(o.step(e)){yield o.currentValue;break}}}function*g(e,t,o){let n=0;for(;n<o;){n+=(yield e+n/o*(t-e))}}function*m(e){for(const[t,o]of l().yU(e,e.slice(1)))(0,s().O9)(t)&&(0,s().O9)(o)&&(yield*p(t,o))}function*S(e,t){let o=0;for(;!(0,s().O9)(t)||o<t;){o+=(yield e)}}function*y(e){let t=0;for(;;){const o={};for(const n of(0,s().uv)(e)){const i=e[n].next(t);if(i.done)return;o[n]=i.value}t=yield o}}var f=()=>o(402838),h=o(474848);const v="inactive-task-filter",x="active-task-filter",b="mouse-cursor-filter",C=80,w=24,j=8,A=10,_=264,I=110,k=C/2;function*M(e){yield*y({x:e,opacity:S(1)})}function T(e){const{mode:t}=e,o=(0,i().IS)((e=>({wrap:{margin:"0px 10px",border:`1px solid ${e.regularDividerColor}`,borderRadius:6,alignItems:"center",position:"relative",height:I+2}})),[1]),r=(0,n.useRef)(null),l=(0,f().s)(r),s=l?l.width-2:_;return(0,h.jsx)("div",{style:o.wrap,ref:r,children:(0,h.jsx)(P,{mode:t,sceneWidth:s})})}function P(e){const{mode:t,sceneWidth:o}=e,d=(0,i().IS)((e=>({svgArrowTheme:{stroke:e.collectionValidDependencyArrow,strokeWidth:a().cC},invalidArrow:{stroke:e.text.uiRedSecondary},svgContainer:{position:"absolute",width:"100%",height:"100%",backgroundColor:e.palette.gray[30]}})),[]),u=(0,n.useMemo)((()=>({*none(){for(;;)yield*M(m([o/2,o/2+C/2+C/4,o/2-C/2-C/4,o/2]))},*preserve_gap(){for(;;)yield*M(m([o/2,o/2+C/2,o/2-C/2,o/2]))},*consume_gap(){for(;;){yield*M(m([o/2,o/2-C/2,o/2+C/2,o/2+C]));const e=500;yield*y({x:S(o/2+C),opacity:g(1,0,e)}),yield*y({x:S(o/2),opacity:g(0,1,e)})}}})),[o]),{x:p,opacity:f}=function(e){const t=(0,n.useMemo)((()=>e()),[e]),[o,i]=(0,n.useState)((()=>{const e=t.next(0);if(e.done)throw new Error("Generator must provide at least one result");return e.value}));return(0,n.useEffect)((()=>{const e=t.next(0);e.done||i(e.value);let o=Date.now(),n=0;return n=requestAnimationFrame((function e(){n=requestAnimationFrame(e);const r=Date.now(),l=r-o;o=r;const s=t.next(l);s.done||i(s.value)})),()=>cancelAnimationFrame(n)}),[t]),o}(u[t??"none"]),v={x:o/2-2*C,y:A},x={x:p-C/2,y:A+w+j},b={x:o/2+C,y:A+2*(w+j)},_={x:x.x+C/2,y:x.y+w/2};return(0,s().O9)(t)&&("consume_gap"===t?(v.x=Math.min(v.x,x.x-C),b.x=Math.max(b.x,x.x+C)):"preserve_gap"===t?(v.x=v.x+p-o/2,b.x=b.x+p-o/2):(0,s().HB)(t)),(0,h.jsxs)("svg",{style:d.svgContainer,children:[l().y1(o/2-2*C,o,k).map(((e,t)=>(0,h.jsx)(F,{startPoint:{x:e,y:0},endPoint:{x:e,y:I}},t))),(0,h.jsx)(c().A,{startPoint:{x:x.x+C,y:x.y+w/2},endPoint:{x:b.x-2,y:b.y+w/2},...(0,r().AH)(d.svgArrowTheme,x.x+C>b.x?d.invalidArrow:void 0,{opacity:f}),showArrowHead:!0}),(0,h.jsx)(c().A,{startPoint:{x:v.x+C,y:v.y+w/2},endPoint:{x:x.x-2,y:x.y+w/2},...(0,r().AH)(d.svgArrowTheme,x.x<v.x+C?d.invalidArrow:void 0,{opacity:f}),showArrowHead:!0}),(0,h.jsx)(B,{point:v,opacity:f}),(0,h.jsx)(B,{point:x,active:!0,opacity:f}),(0,h.jsx)(B,{point:b,opacity:f}),(0,h.jsx)(V,{point:_,opacity:f}),(0,h.jsx)(D,{})]})}function B(e){const{point:t,active:o,opacity:n}=e,r=(0,i().DP)(),l=o?"dark"===r.mode?"#28456C":"#E7F3F8":r.background.elevated;return(0,h.jsx)("g",{transform:`translate(${t.x-4},${t.y-2})`,opacity:n,children:(0,h.jsx)("rect",{filter:`url(#${o?x:v})`,width:C,height:w,x:"4",y:"2",fill:l,rx:"3"})})}function F(e){const{startPoint:t,endPoint:o}=e,n=(0,i().DP)(),r="dark"===n.mode?n.palette.gray[300]:"#E3E2E0";return(0,h.jsx)("line",{x1:t.x,y1:t.y,x2:o.x,y2:o.y,stroke:r,strokeDasharray:"3 4"})}function V(e){const{point:t,opacity:o}=e;return(0,h.jsxs)("g",{filter:`url(#${b})`,transform:`translate(${t.x},${t.y})`,opacity:o,children:[(0,h.jsx)("path",{fill:"#32302C",d:"M14 12.25h-3.334l2.193 5.294-2.309.956-2.194-5.294L6 15.563l-.75-.75V3.94l1.06-.44L14 11.19v1.06z"}),(0,h.jsx)("path",{stroke:"#fff",fill:"#32302C",strokeWidth:"0.5",d:"M14 12.5h.25v-1.413l-.073-.073-7.69-7.69-.12-.12-.154.065-1.059.44L5 3.775v11.142l.073.073.75.75.177.177.177-.177 2.092-2.091 2.05 4.948.096.23.23-.095 2.31-.956.231-.096-.096-.231-2.05-4.948H14z"})]})}function D(){return(0,h.jsxs)("defs",{children:[(0,h.jsxs)("filter",{id:v,width:C+8,height:w+8,x:"0",y:"0",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,h.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,h.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,h.jsx)("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_637_7659"}),(0,h.jsx)("feOffset",{}),(0,h.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,h.jsx)("feColorMatrix",{values:"0 0 0 0 0.0707 0 0 0 0 0.0693 0 0 0 0 0.0693 0 0 0 0.1 0"}),(0,h.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_637_7659"}),(0,h.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,h.jsx)("feOffset",{dy:"2"}),(0,h.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,h.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,h.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),(0,h.jsx)("feBlend",{in2:"effect1_dropShadow_637_7659",result:"effect2_dropShadow_637_7659"}),(0,h.jsx)("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_637_7659",result:"shape"})]}),(0,h.jsxs)("filter",{id:x,width:C+8,height:w+8,x:"0",y:"0",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,h.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,h.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,h.jsx)("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_637_5084"}),(0,h.jsx)("feOffset",{}),(0,h.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,h.jsx)("feColorMatrix",{values:"0 0 0 0 0.2 0 0 0 0 0.494118 0 0 0 0 0.662745 0 0 0 0.2 0"}),(0,h.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_637_5084"}),(0,h.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,h.jsx)("feOffset",{dy:"2"}),(0,h.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,h.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,h.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),(0,h.jsx)("feBlend",{in2:"effect1_dropShadow_637_5084",result:"effect2_dropShadow_637_5084"}),(0,h.jsx)("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_637_5084",result:"shape"})]}),(0,h.jsxs)("filter",{id:b,width:"17.75",height:"24.244",x:"0.75",y:"0.91",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,h.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,h.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,h.jsx)("feOffset",{dy:"2"}),(0,h.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,h.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,h.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.2 0"}),(0,h.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_637_4925"}),(0,h.jsx)("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow_637_4925",result:"shape"})]})]})}},148079:(e,t,o)=>{o.d(t,{A:()=>d});o(296540);var n=()=>o(484714),i=()=>o(56366),r=()=>o(401497),l=()=>o(413267),s=()=>o(69708),a=()=>o(250202),c=o(474848);function d(e){const{menuProps:t,property:o,defaultProperty:n,isChecked:r,propertySchema:l,collectionContextStore:s,handleDefaultPropertySelect:d,handlePropertySelect:p,...g}=e,m=(0,i().O$)(s.canConfigureBlockStore);return(0,c.jsx)(a().G,{...t,disabled:!m,propertySchema:l,format:a().e.Name,onClick:()=>d(o),right:(0,c.jsx)(u,{property:o,isChecked:o===n,collectionContextStore:s,defaultProperty:void 0})})}function u(e){const{property:t,defaultProperty:o,isChecked:a,collectionContextStore:d}=e,u=(0,n().WS)(),p=(0,i().K8)((()=>{var e;return null===(e=d.collectionStore())||void 0===e||null===(e=e.getName())||void 0===e?void 0:e.toString()}),[d]),g=(0,r().IS)((e=>({defaultText:{color:e.text.secondary,fontSize:12,fontWeight:500,textTransform:"uppercase",marginInlineEnd:4}})),[]);return(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,c.jsx)("div",{style:{...g.defaultText},children:t===o?(0,c.jsx)(s().sA,{defaultMessage:"Default",id:"database.viewSettings.setViewPropertyDefault.defaultProperty.tag",values:{databaseName:p}}):void 0}),a?(0,c.jsx)("div",{style:{...u?{marginInlineStart:"auto",marginInlineEnd:20,minWidth:0,flexShrink:0}:{marginInlineStart:"auto",marginInlineEnd:12,minWidth:0,flexShrink:0},width:u?16:14,flexShrink:0},children:(0,l().b)()}):void 0]})}},167068:(e,t,o)=>{o.d(t,{A:()=>l});var n=o(296540),i=o(474848);function r({...e}){const t=(0,o(69708).tz)(),n=(0,o(401497).IS)((e=>({buttonStyle:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,height:24,width:24},threeDotIcon:{width:12,height:12,fill:e.icon.secondary}})),[]),r=t.formatMessage({defaultMessage:"View options",id:"PersonalHomePanel.moreDropdownButton.tooltip"});return(0,i.jsx)(o(718827).Ay,{ariaLabel:r,style:n.buttonStyle,...e,children:(0,o(30626)._)(n.threeDotIcon)})}const l=n.memo(r)},197730:(e,t,o)=>{o.d(t,{Sk:()=>l,we:()=>r,yQ:()=>i});var n=()=>o(534177);const i=["small","medium","large","extra_large"];function r(e){switch(e){case"small":return 300;case"medium":return 400;case"large":return 600;case"extra_large":return 800;default:(0,n().HB)(e)}}function l(e){var t;return(null==e||null===(t=e.map_config)||void 0===t?void 0:t.height)||"medium"}},212441:(e,t,o)=>{o.d(t,{GS:()=>go,gt:()=>co,CJ:()=>po,Ct:()=>fo});o(16280),o(898992),o(354520);var n=o(296540),i=()=>o(59226),r=()=>o(242422),l=()=>o(312788),s=()=>o(484714),a=()=>o(56366),c=()=>o(401497),d=()=>o(929219),u=()=>o(757695),p=()=>o(584262),g=()=>o(743472),m=()=>o(651124),S=()=>o(187174),y=()=>o(47218),f=()=>o(582684),h=()=>o(202017),v=()=>o(89849),x=()=>o(566910),b=()=>o(200582),C=()=>o(340498),w=o(474848);const j={viewBox:"0 0 16 16",fittedViewBox:"2.37 2.37 11.26 11.26",svg:(0,w.jsx)("path",{d:"M11.8 2.375c-.788 0-1.46.5-1.715 1.2H5.05a2.525 2.525 0 1 0 0 5.05h6.05a1.275 1.275 0 1 1 0 2.55H5.915a1.826 1.826 0 1 0 0 1.25H11.1a2.525 2.525 0 1 0 0-5.05H5.05a1.275 1.275 0 1 1 0-2.55h5.035a1.826 1.826 0 1 0 1.715-2.45M11.225 4.2v-.005a.575.575 0 1 1 0 .01z"})},A=(0,C().wt)("pathRoundEndsSmall",j);var _=()=>o(406533),I=()=>o(871151),k=()=>o(969523),M=()=>o(69708),T=()=>o(496603),P=()=>o(208459),B=()=>o(436696),F=()=>o(989992),V=()=>o(980151),D=()=>o(231297),E=()=>o(837570),R=()=>o(83486);function O({collectionContextStore:e,collectionSettingsStore:t}){const o=(0,a().K8)((()=>e.isPeopleCollection()),[e]),n=(0,c().IS)((e=>({section:{paddingBottom:12,marginBottom:12,marginInline:6}})),[]);return(0,w.jsx)("div",{style:n.section,children:o?(0,w.jsx)(R().Y,{collectionContextStore:e,collectionSettingsStore:t}):void 0})}var K=()=>o(718827),N=()=>o(284371),L=()=>o(147503),z=()=>o(497222),U=()=>o(417392),W=()=>o(89924),H=()=>o(908201);const G=n.memo((function({handleAddItemClick:e,store:t,disableTemplatesDropdown:i}){const{isMobile:r}=(0,s().Y0)(),l=(0,H().ET)(),d=(0,a().K8)((()=>l.settingsStore),[l]),u=(0,s().v3)(),p=(0,n.useRef)(null),g=(0,n.useCallback)((t=>{L().Ub({environment:u,handleAddItemClick:e,buttonRef:p,event:t})}),[u,e,p]),m=(0,c().IS)((e=>({newPageIcon:{fill:e.blue.icon.accentPrimary},desktopTitle:{color:e.blue.text.accentPrimary,fontWeight:N().Wy.medium}})),[]),S=(0,n.useCallback)((t=>{i?g(t):e(t),L().os({collectionSettingsStore:d})}),[i,g,e,d]);return(0,w.jsx)(o(776547).m,{store:t,popupType:r?U().nl.BottomSheet:U().nl.Popup,renderOrigin:e=>(0,w.jsx)(K().Ay,{ref:p,ignoreLocalHoverState:!0,children:(0,w.jsxs)(W().A,{children:[(0,w.jsx)(z().A,{icon:o(480034).q,iconStyle:m.newPageIcon,title:(0,w.jsx)(M().sA,{defaultMessage:"New page",id:"database.collectionViewAddItemButton.newPageButton.title"}),showChevron:!1,desktopTitleStyle:m.desktopTitle,onClick:S}),i?void 0:(0,w.jsx)(z().A,{icon:o(920495).n,title:(0,w.jsx)(M().sA,{defaultMessage:"Page templates",id:"database.collectionViewAddItemButton.pageTemplatesButton.title"}),showChevron:!0,onClick:e.onClick})]})}),placementToOrigin:"left"})}));var $=()=>o(654062),Q=()=>o(637558),Y=()=>o(315564),q=()=>o(916727),J=()=>o(125565);function X(e){const{style:t}=e,o=(0,c().DP)(),n=(0,s().WS)(),i=(0,w.jsx)("div",{style:{marginTop:1},children:(0,Y().S)({width:14,marginInlineEnd:8,height:void 0})}),r=(0,w.jsx)(J().A,{style:{color:o.text.primary,lineHeight:N().K_.UISmall.desktop},isSmall:!0,children:(0,w.jsx)(M().sA,{defaultMessage:"You’re a content editor",id:"database.viewSettings.mainTab.contentOnlyEditorPill.title"})});return(0,w.jsx)(q().F,{icon:i,title:r,style:n?{backgroundColor:o.background.secondary,boxShadow:o.shadow2XS,margin:void 0,borderRadius:void 0,...t}:{background:"rgba(196, 196, 196, 0.13)",margin:"8px 14px",...t},showCloseButton:!1,children:(0,w.jsx)(J().A,{style:{marginInlineStart:22},isSmall:!0,isMultiline:!0,children:(0,w.jsx)(M().sA,{defaultMessage:"Content editors can edit pages, but cannot change view and database settings.",id:"database.viewSettings.mainTab.contentOnlyEditorPill.subtitle"})})})}var Z=()=>o(462032),ee=()=>o(152077),te=()=>o(635462),oe=()=>o(852353),ne=()=>o(726483),ie=()=>o(492414),re=()=>o(267584),le=()=>o(37433),se=()=>o(384446),ae=()=>o(287940),ce=()=>o(955450),de=()=>o(162674),ue=(o(581454),()=>o(252291)),pe=()=>o(160432),ge=()=>o(218275);const me={viewBox:"0 0 16 16",fittedViewBox:"4.37 7.37 7.25 1.26",svg:(0,w.jsx)("path",{d:"M5 7.375a.625.625 0 1 0 0 1.25h6a.625.625 0 1 0 0-1.25z"})},Se=(0,C().wt)("dashSmall",me);var ye=()=>o(519831),fe=()=>o(285790),he=()=>o(939740),ve=()=>o(676007),xe=()=>o(305390),be=()=>o(132389),Ce=()=>o(543665),we=()=>o(384944);var je=()=>o(696746);class Ae extends u().Store{getInitialState(){return{type:"closed"}}}const _e=new Ae,Ie=32,ke=10,Me=(0,M().YK)({learnAboutTasks:{id:"tasksSelectSources.modal.learnAboutTasks",defaultMessage:"Learn about tasks"},done:{id:"tasksSelectSources.modal.done",defaultMessage:"Done"},ariaLabel:{id:"tasksSelectSources.modal.ariaLabel",defaultMessage:"Select task database sources"},removeTaskDatabase:{id:"tasksSelectSources.modal.removeTaskDatabase",defaultMessage:"Remove task database"},usedForMyTasks:{id:"tasksSelectSources.modal.usedForMyTasks",defaultMessage:"{taskDbCount} of {taskDbLimit} Selected Sources"},modalTitle:{id:"tasksSelectSources.modal.title",defaultMessage:"Add task sources"},modalSubtitle:{id:"tasksSelectSources.modal.subtitle",defaultMessage:"Select up to {limit} sources. Tasks from these databases will appear in “My tasks.”"}});function Te(){const e=(0,M().tz)(),t=(0,a().O$)(_e),o="open"===t.type?t.collectionContextStore:void 0,n=(0,c().IS)((e=>({modal:{background:e.glass.wash},container:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},columnsContainer:{display:"flex",flexDirection:"row",gap:24,width:"100%",height:358,marginBottom:24},leftColumn:{flex:1},rightColumn:{flex:1},modalInner:{width:768,padding:Ie}})),[]),i=()=>{_e.setState({type:"closed"})};return"closed"===t.type?null:(0,w.jsx)(ve().a,{open:!0,showCloseIcon:!0,ariaLabel:e.formatMessage(Me.ariaLabel),style:n.modal,innerStyle:n.modalInner,onDismiss:i,render:()=>(0,w.jsxs)("div",{style:n.container,children:[(0,w.jsx)(Pe,{}),(0,w.jsxs)("div",{style:n.columnsContainer,children:[(0,w.jsx)("div",{style:n.leftColumn}),(0,w.jsx)("div",{style:n.rightColumn,children:(0,w.jsx)(Be,{collectionContextStore:o})})]}),(0,w.jsx)(Ve,{onDone:i})]})})}function Pe(){const e=(0,M().tz)(),t=(0,c().IS)((e=>({titleContainer:{width:"100%",marginBottom:24,display:"flex",flexDirection:"column",alignItems:"center",gap:8},title:{color:e.text.primary,textAlign:"center",fontSize:17,fontWeight:590,lineHeight:"22px"},subtitle:{color:e.text.secondary,textAlign:"center",fontSize:14,fontWeight:400,lineHeight:"18px"}})),[]);return(0,w.jsxs)("div",{style:t.titleContainer,children:[(0,w.jsx)("div",{style:t.title,children:e.formatMessage(Me.modalTitle)}),(0,w.jsx)("div",{style:t.subtitle,children:e.formatMessage(Me.modalSubtitle,{limit:ke})})]})}function Be(e){const t=(0,M().tz)(),{collectionContextStore:o}=e,n=(0,c().IS)((e=>({rightColumnContainer:{borderRadius:16,border:`1px solid ${e.regularDividerColor}`,background:e.white,height:"100%",overflow:"auto",padding:16}})),[]),i=(0,a().K8)((()=>{if(!o)return[];const e=o.collectionViewStore();if(!e)return[];const t=o.collectionViewBlockStore(),n=e.getCollectionSource();if("typed"!==(null==n?void 0:n.type))return[];return(n.aggregatedCollections??[]).map((o=>Ce().m.createChildStore(t??e,{table:ye().Vl,id:o.collectionPointer.id})))}),[o]).map((e=>({key:e.id,render:t=>o?(0,w.jsx)(Fe,{store:e,collectionContextStore:o,menuItemProps:t}):null,action:()=>{}}))),r={key:"used-for-my-tasks",items:i,render:e=>(0,w.jsx)(W().A,{title:t.formatMessage(Me.usedForMyTasks,{taskDbCount:i.length,taskDbLimit:ke}),...e})};return(0,w.jsx)("div",{style:n.rightColumnContainer,children:(0,w.jsx)(he().Ay,{type:he().Oh.Vertical,initialFocus:void 0,sections:[r]})})}function Fe(e){const t=(0,M().tz)(),{store:o,collectionContextStore:i,menuItemProps:r}=e,[l,a]=(0,n.useState)(!1),d=(0,s().v3)(),u=(0,n.useCallback)((()=>{!function(e){const{environment:t,collectionContextStore:o,collectionPointerToRemove:n}=e,i=o.collectionViewStore();if(!i)return;const r=i.getCollectionSource();if(!r||"typed"!==r.type)return;const l=(r.aggregatedCollections??[]).filter((e=>e.collectionPointer.id!==n.id)),s=i.getFormatStore().getKeyStore("collection_view_source");D().createAndCommit({userAction:"removeAggregatedCollection",environment:t,canUndo:!0,perform:e=>{we().KY({store:s,transaction:e,value:{...r,aggregatedCollections:l}})}})}({environment:d,collectionContextStore:i,collectionPointerToRemove:o.pointer})}),[d,i,o.pointer]),p=(0,n.useCallback)((()=>{a(!0)}),[]),g=(0,n.useCallback)((()=>{a(!1)}),[]),m=(0,c().IS)((e=>({removeButton:{opacity:l?1:0,transition:"opacity 0.15s ease",border:`1px solid ${e.regularDividerColor}`,background:e.white,boxShadow:e.shadow.base.sm}})),[l]);return(0,w.jsx)(xe().A,{...r,store:o,onMouseEnter:p,onMouseLeave:g,onClick:u,right:(0,w.jsx)(fe().A,{icon:Se,size:"sm",colorVariant:"secondary",ariaLabel:t.formatMessage(Me.removeTaskDatabase),style:m.removeButton,onClick:u})})}function Ve(e){const t=(0,M().tz)(),{onDone:o}=e,n=(0,c().IS)((e=>({footer:{width:"100%",display:"flex",flexDirection:"row",justifyContent:"space-between"},learnMoreButton:{display:"flex",flexDirection:"row",alignItems:"center",fontSize:14,color:e.text.tertiary,padding:4,borderRadius:4},doneButton:{height:36,padding:"0 12px"}})),[]);return(0,w.jsxs)("div",{style:n.footer,children:[(0,w.jsxs)(K().Ay,{style:n.learnMoreButton,href:je().hI,external:!0,children:[t.formatMessage(Me.learnAboutTasks),(0,w.jsx)(be().A,{size:2}),(0,w.jsx)(ue().I,{icon:ge().arrowUpRightSquareSmallIcon,size:"sm",colorVariant:"tertiary"})]}),(0,w.jsx)(pe().A,{colorPalette:"blue",style:n.doneButton,onClick:o,children:t.formatMessage(Me.done)})]})}var De=()=>o(885749),Ee=()=>o(665579),Re=()=>o(610101),Oe=()=>o(765957),Ke=()=>o(559378),Ne=()=>o(411671),Le=()=>o(647702),ze=()=>o(65402),Ue=()=>o(720088),We=()=>o(705602),He=()=>o(735695),Ge=()=>o(635019),$e=()=>o(446966),Qe=()=>o(989219);function Ye(e){const{collectionContextStore:t,right:o,onClick:n,menuListItemProps:i}=e,r=(0,a().K8)((()=>t.databaseType),[t]);return(0,w.jsx)(z().A,{icon:$e().E,title:(0,w.jsx)(M().sA,{...(0,Qe().mv)({feature:"subitem",databaseType:r})}),right:o,showChevron:!0,onClick:n,menuListItemProps:i})}var qe=()=>o(812480),Je=()=>o(614525),Xe=()=>o(364871),Ze=()=>o(704640),et=()=>o(395859),tt=()=>o(542984),ot=()=>o(564884),nt=()=>o(785285),it=()=>o(933152),rt=()=>o(755199),lt=()=>o(370493),st=()=>o(147294);function at(e){const{collectionContextStore:t,collectionSettingsStore:o,disabled:i=!1}=e,r=(0,s().v3)(),l=(0,a().K8)((()=>{var e;return null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()}),[t]),d=(0,a().K8)((()=>t.normalizedFormatStore.state.conditional_color_rules),[t.normalizedFormatStore]),u=(0,a().O$)(t.canConfigureBlockStore),p=function(){const e=(0,st().oG)("conditional_color_feature"),t=(0,a().K8)((()=>{var e;return Boolean(null===(e=Oe().default.state.currentUserSettingsStore)||void 0===e?void 0:e.hasClickedConditionalColorButton())}),[]);return e&&!t}(),g=(0,n.useCallback)((()=>{!function(e){const{environment:t}=e,{currentUserSettingsStore:o}=Oe().default.state;if(!o)return;D().createAndCommit({environment:t,userAction:"userClickedConditionalColorButton",canUndo:!1,cellTarget:"main",perform:e=>rt().mJ({userSettingsStore:o,transaction:e,data:{collection_conditional_color_button_clicked_at:Date.now()}})})}({environment:r});const e=d&&d.length>0;L().a2({collectionSettingsStore:o,item:e?{type:"conditionalColors"}:{type:"createConditionalColor"}}),(0,ot().u)({environment:r,event:{eventName:"conditional_color_menu_click",eventProperties:(0,lt().JO)({collectionContextStore:t})}})}),[t,o,d,r]),m=(0,c().IS)((()=>({titleContainer:{display:"flex",alignItems:"center"}})),[]);return l&&(0,nt().fu)(l)?(0,w.jsx)(z().A,{icon:it().M,title:(0,w.jsxs)("div",{style:m.titleContainer,children:[(0,w.jsx)(M().sA,{defaultMessage:"Conditional color",id:"database.viewSettings.mainTab.colorButton.title"}),(0,w.jsx)(st().Ee,{newBadgeKey:"conditional_color_feature",keyType:"date",didUserEngage:!p})]}),showChevron:!0,onClick:g,disabled:i||!u}):null}var ct=()=>o(536583),dt=()=>o(594952),ut=()=>o(617668),pt=()=>o(236262),gt=()=>o(232930),mt=()=>o(937199),St=()=>o(3197),yt=()=>o(112698),ft=()=>o(329304),ht=()=>o(204330),vt=()=>o(95441),xt=()=>o(58488);function bt(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,n=(0,i().X)("forms_apply_template"),r=(0,a().K8)((()=>t.collectionViewStore()),[t]),l=(0,a().K8)((()=>{if(!r)throw new Error("No CollectionViewStore found");return r.getFormBlockStore()}),[r]),s=(0,a().K8)((()=>{const e=t.collectionViewBlockStore();return!!e&&e.getCollectionViewIds().length>1}),[t]);return r&&l?(0,w.jsxs)(xt().I,{children:[(0,w.jsxs)(W().A,{children:[(0,w.jsx)(Ct,{}),(0,w.jsx)(go,{collectionSettingsStore:o,collectionContextStore:t}),(0,w.jsx)(wt,{collectionSettingsStore:o,collectionContextStore:t}),n?(0,w.jsx)(jt,{collectionSettingsStore:o}):void 0]}),(0,w.jsx)(W().A,{extraPadding:!0,topBorder:!0,children:(0,w.jsx)(tt().Q,{collectionContextStore:t,collectionSettingsStore:o,disabled:!0})}),(0,w.jsxs)(W().A,{topBorder:!0,children:[s?(0,w.jsx)(At,{collectionSettingsStore:o,collectionContextStore:t,collectionViewStore:r,formBlockStore:l}):void 0,(0,w.jsx)(_t,{})]})]}):null}function Ct(){const{canEditLayout:e}=(0,mt().LH)(),t=(0,St().t)({area:"form_layout_schema"});return(0,w.jsx)(z().A,{icon:ut().plusIcon,title:(0,w.jsx)(M().sA,{id:"formEditSettings.newQuestion.title",defaultMessage:"New question"}),onClick:t,disabled:!e})}function wt({collectionSettingsStore:e,collectionContextStore:t}){const{userId:o,spaceId:n}=(0,a().K8)((()=>{var e,o;return{userId:null===(e=Oe().default.state.currentUserStore)||void 0===e?void 0:e.id,spaceId:null===(o=t.collectionStore())||void 0===o?void 0:o.getSpaceId()}}),[t]),r=(0,i().X)("upgrade_system_forms"),l=(0,ft()._X)({name:"form_customization",spaceId:n,userId:o}),s="unavailable"===(null==l?void 0:l.type)&&l.upsell;return(0,w.jsx)(z().A,{onClick:()=>{L().a2({collectionSettingsStore:e,item:{type:"formCustomizeSettings"}})},icon:dt().I,title:(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",height:20,gap:5},children:[(0,w.jsx)(M().sA,{defaultMessage:"Customize form",id:"formEditSettings.customizeForm.title"}),s?r?(0,w.jsx)(ht().R,{display:"icon",upsell:l.upsell,source:"forms_customize_settings",showPlanName:!0}):(0,w.jsx)(yt().B,{upsell:l.upsell,analyticsName:"forms_customize_settings"}):void 0]}),showChevron:!0})}function jt({collectionSettingsStore:e}){return(0,w.jsx)(z().A,{onClick:()=>{L().a2({collectionSettingsStore:e,item:{type:"formSelectTemplate"}})},icon:ct().d,title:(0,w.jsx)(M().sA,{defaultMessage:"Select template",id:"formEditSettings.selectTemplate.title"}),showChevron:!0})}function At({collectionContextStore:e,collectionSettingsStore:t,collectionViewStore:o,formBlockStore:i}){const{canEditLayout:r}=(0,mt().LH)(),l=(0,s().v3)(),a=(0,M().tz)(),c=(0,n.useCallback)((async()=>{await L().nl({intl:a,environment:l,collectionContextStore:e,collectionViewStore:o,collectionSettingsStore:t,additionalBlocksToDelete:[i],from:"view_settings"})}),[a,l,e,o,t,i]);return(0,w.jsx)(z().A,{icon:pt().trashIcon,title:(0,w.jsx)(M().sA,{id:"formEditSettings.deleteForm.title",defaultMessage:"Delete form"}),onClick:c,disabled:!r})}function _t(){return(0,w.jsx)(vt().A,{title:(0,w.jsx)(M().sA,{defaultMessage:"Learn about forms",id:"formEditSettings.learnAboutForms.title"}),href:(0,gt().x)("guides.forms"),analyticsFrom:"form_edit_settings"})}var It=()=>o(448701),kt=()=>o(62616),Mt=()=>o(206267),Tt=()=>o(810521);function Pt({collectionContextStore:e}){const t=(0,s().v3)(),o=(0,n.useMemo)((()=>Mt().JW()),[]),i=(0,w.jsx)(M().sA,{defaultMessage:"Manage data sources",id:"database.viewSettings.mainTab.manageDataSources.title"}),r=(0,n.useCallback)((()=>{var n;(0,Tt().trackManageDataSources)(t,{data_source_session_id:o,collection_view_block_id:null===(n=e.collectionViewBlockStore())||void 0===n?void 0:n.id}),L().a2({collectionSettingsStore:e.settingsStore,item:{type:"manageDataSources",analytics:{dataSourceSessionId:o,dataSourceFrom:"manage_data_sources"}}})}),[t,o,e]);return(0,w.jsx)(z().A,{showChevron:!0,icon:kt().c,title:i,onClick:r})}var Bt=()=>o(197730);const Ft=(0,M().YK)({small:{defaultMessage:"Small",id:"database.viewSettings.layoutTab.mapHeight.small"},medium:{defaultMessage:"Medium",id:"database.viewSettings.layoutTab.mapHeight.medium"},large:{defaultMessage:"Large",id:"database.viewSettings.layoutTab.mapHeight.large"},extra_large:{defaultMessage:"Extra large",id:"database.viewSettings.layoutTab.mapHeight.extra_large"}}),Vt=(0,M().YK)({mapStyle:{defaultMessage:"Style",id:"database.viewSettings.mapTab.mapStyle.title"}}),Dt=n.memo((function({collectionSettingsStore:e}){const t=(0,s().v3)(),i=(0,M().tz)(),r=(0,H().ET)(),l=(0,a().K8)((()=>r.collectionViewStore()),[r]),d=(0,a().O$)(r.isInHomeWidgetStore),u=(0,a().K8)((()=>{var e;const t=null===(e=r.collectionViewBlockStore())||void 0===e?void 0:e.id;return!!t&&(0,te().s)(t)}),[r]),p=(0,n.useMemo)((()=>u?{feature:"tasks",from:"tasks_more_menu"}:{feature:"custom_db",from:"custom_db_more_menu"}),[u]),g=(0,n.useCallback)((()=>{Oe().default.state.sidebarSpaceViewStore&&V().WO({environment:t,currentSpaceViewStore:Oe().default.state.sidebarSpaceViewStore,...p})}),[t,p]),m=!(0,a().O$)(r.canConfigureBlockStore),S=(0,c().IS)((()=>({layoutSection:{paddingTop:0,paddingBottom:4},heightSection:{paddingTop:4},heightSectionMobile:{boxShadow:"none"},titleStyle:{opacity:m?.4:void 0}})),[m]),y=(0,a().K8)((()=>r.isPeopleCollection()),[r]);return l?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(W().A,{extraPadding:!0,style:S.layoutSection,children:(0,w.jsx)(fo,{collectionContextStore:r,collectionSettingsStore:e})}),(0,w.jsx)(W().A,{extraPadding:!0,topBorder:!0,style:S.heightSection,title:i.formatMessage(Vt.mapStyle),mobileStyle:S.heightSectionMobile,desktopTitleStyle:S.titleStyle,mobileTitleStyle:S.titleStyle,children:(0,w.jsx)(Rt,{collectionContextStore:r,disabled:m})}),(0,w.jsx)(Et,{collectionContextStore:r,collectionSettingsStore:e,disabled:m}),(0,w.jsxs)(W().A,{extraPadding:!0,topBorder:!0,children:[(0,w.jsx)(o(48382).z,{collectionContextStore:r,collectionSettingsStore:e}),d?(0,w.jsx)(z().A,{icon:x().e,title:i.formatMessage(De().u.hide),showChevron:!1,onClick:g}):null]}),y?(0,w.jsx)(R().Y,{collectionContextStore:r,collectionSettingsStore:e}):void 0]}):null}));function Et(e){const{collectionContextStore:t,collectionSettingsStore:o,disabled:n}=e;return(0,w.jsxs)(W().A,{extraPadding:!0,topBorder:!0,children:[(0,w.jsx)(tt().Q,{collectionContextStore:t,collectionSettingsStore:o,disabled:n}),(0,w.jsx)(Ze().A,{collectionContextStore:t,collectionSettingsStore:o,disabled:n}),(0,w.jsx)(at,{collectionContextStore:t,collectionSettingsStore:o,disabled:n})]})}function Rt({collectionContextStore:e,disabled:t}){const i=(0,s().v3)(),r=(0,M().tz)(),l=(0,a().K8)((()=>(0,Bt().Sk)(e.normalizedFormatStore.state)),[e]),c=(0,n.useCallback)((t=>{const n=e.collectionViewStore();n&&D().createAndCommit({userAction:"MapSettingsMain.handleMapHeightChange",environment:i,canUndo:!0,perform:e=>{o(896628).zA({stores:[n],update:{map_config:{height:t}},transaction:e})}})}),[e,i]),d=(0,n.useMemo)((()=>Bt().yQ.map((e=>({key:e,type:"button",title:r.formatMessage(Ft[e])})))),[r]);return(0,w.jsx)(o(828973).A,{title:(0,w.jsx)(M().sA,{defaultMessage:"Height",id:"database.viewSettings.layoutTab.mapHeight.title"}),collectionContextStore:e,selectedKey:l,popupStyle:{minWidth:190},options:d,onChange:c,disabled:t})}o(944114),o(737550);var Ot=()=>o(3284),Kt=()=>o(457056),Nt=()=>o(589407),Lt=()=>o(18953),zt=()=>o(173614),Ut=()=>o(167170),Wt=()=>o(374562),Ht=()=>o(406699),Gt=()=>o(811979),$t=()=>o(404277),Qt=()=>o(45552),Yt=()=>o(739222),qt=()=>o(95347),Jt=()=>o(722872),Xt=()=>o(329443),Zt=()=>o(447934),eo=()=>o(400851),to=()=>o(463830),oo=()=>o(527438);function no(e){const{collectionContextStore:t,collectionSettingsStore:o,isConfiguringViewsMainModule:n}=e,i=(0,s().Y0)(),r=!(0,a().O$)(d().e),l=function({collectionContextStore:e}){return(0,a().K8)((()=>{const t=e.permissionScopesStore.state;if(!(t.canConfigureCollection||t.canConfigureBlock))return!0;const o=e.collectionStore();return!o||((0,Xt().qe)(o)||(0,Xt().X6)(o))}),[e])}({collectionContextStore:t})||r,c=(0,a().uB)(void 0,to().A),u=(0,a().O$)(c).open,p=(0,w.jsx)(M().sA,{defaultMessage:"More settings",id:"database.viewSettings.mainTab.moreSettingsButton.title"});return(0,w.jsx)(Gt().A,{focused:!1,buttonPopupStore:c,alignmentToOrigin:"end",placementToOrigin:"bottom",popupType:i.isMobile?Ht().z.BottomSheet:Ht().z.Popup,bottomSheetInitialState:"half",renderOrigin:e=>(0,w.jsx)(z().A,{...e,icon:Nt().ellipsisIcon,title:p,showChevron:!0,rotateChevron:u,disabled:l}),render:e=>(0,w.jsx)(io,{title:p,collectionContextStore:t,collectionSettingsStore:o,onClose:e.close,isConfiguringViewsMainModule:n})})}function io({title:e,collectionContextStore:t,collectionSettingsStore:o,onClose:i,isConfiguringViewsMainModule:r}){const{isMobile:l}=(0,s().Y0)(),c=function({collectionContextStore:e,collectionSettingsStore:t,onClose:o,isConfiguringViewsMainModule:i}){const r=(0,s().v3)(),l=(0,qt().rD)(e),c=(0,Wt().md)(),d=(0,Wt().J4)(),{canHaveSprints:u,canTurnIntoTasks:p}=(0,a().K8)((()=>({canHaveSprints:(0,Yt().cM)(e),canTurnIntoTasks:(0,Yt().Y7)(e,l)})),[e,l]),m=(0,a().K8)((()=>(0,Yt().YQ)(Yt().YX,e)),[e]),S=(0,a().K8)((()=>{var t;if(!p)return!1;const o=null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.getOwnedCollectionStores().some((e=>e.isTypedCollection()));return!(!m&&o)}),[e,p,m]),y=(0,a().K8)((()=>{var t;return null===(t=e.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.subitem_property}),[e]),f=(0,a().K8)((()=>(0,oo().jx)({collectionContextStore:e})),[e]),h=(0,qt().hw)(e,t),v=so({collectionContextStore:e,from:"customize_database_button_in_more_settings_menu"}),x=(0,n.useCallback)((()=>{L().a2({collectionSettingsStore:t,item:{type:"sprintSettings",from:"more_settings"}})}),[t]),b=(0,n.useMemo)((()=>m?(0,Yt().tQ)({environment:r,collectionContextStore:e}):()=>(0,Yt().$M)({environment:r,collectionContextStore:e})),[m,r,e]),C=(0,n.useCallback)((t=>(0,qt().Dj)({collectionContextStore:e,feature:t,appConfig:l})?(0,w.jsx)(M().sA,{defaultMessage:"On",id:"database.viewSettings.mainTab.featureStatusLabel.on"}):null),[e,l]),j=(0,n.useMemo)((()=>({key:"sprints",render:e=>(0,w.jsx)(z().A,{icon:Lt().H,title:Yt().RH.name,right:C(Yt().RH),showChevron:!0,menuListItemProps:e}),action:x})),[x,C]),A=(0,n.useMemo)((()=>({key:"tasks",render:e=>(0,w.jsx)(z().A,{icon:Ot().arrowSquarePathUpDownIcon,title:m?(0,w.jsx)(M().sA,{defaultMessage:"Undo Task database",id:"database.viewSettings.mainTab.undoTaskDatabaseButton.title"}):(0,w.jsx)(M().sA,{defaultMessage:"Turn into Tasks",id:"database.viewSettings.mainTab.turnIntoTasksButton.title"}),showChevron:!0,menuListItemProps:e}),action:()=>{b(),o()}})),[b,m,o]),_=(0,n.useMemo)((()=>({key:"subItems",render:t=>(0,w.jsx)(Ye,{collectionContextStore:e,right:C(c),onClick:()=>h(c),menuListItemProps:t}),action:()=>h(c)})),[e,C,h,c]),I=(0,n.useMemo)((()=>({key:"dependencies",render:e=>(0,w.jsx)(z().A,{icon:Kt().o,title:d.name,right:C(d),showChevron:!0,menuListItemProps:e}),action:()=>h(d)})),[d,C,h]),k=(0,n.useMemo)((()=>({key:"connections",render:o=>(0,w.jsx)(lo,{collectionContextStore:e,collectionSettingsStore:t,menuListItemProps:o}),action:()=>L().a2({collectionSettingsStore:t,item:{type:"connectionFeatures"}})})),[e,t]),T=(0,n.useMemo)((()=>({key:"customizeLayout",render:t=>(0,w.jsx)(ro,{collectionContextStore:e,menuListItemProps:t}),action:v})),[e,v]),P=(0,n.useMemo)((()=>{const e=[I];return!y&&(0,g().B)(f)&&e.unshift(_),u&&e.push(j),i||(e.push(k),e.push(T),S&&e.push(A)),e}),[u,S,k,T,I,i,j,_,y,A,f]);return P}({collectionContextStore:t,collectionSettingsStore:o,onClose:i,isConfiguringViewsMainModule:r}),d=(0,n.useMemo)((()=>[{key:"moreSettings",render:e=>(0,w.jsx)(W().A,{...e}),items:c}]),[c]),u=(0,n.useMemo)((()=>l?{title:e,menuType:Jt().gu.Modal,right:(0,w.jsx)(Qt().DoneMenuText,{}),onClickRight:i}:{menuType:Jt().gu.Popup,width:250}),[l,e,i]);return(0,w.jsx)($t().A,{...u,children:(0,w.jsx)(he().Ay,{type:he().Oh.Vertical,sections:d,initialFocus:void 0,resetFocusOnMouseOut:!0})})}function ro({collectionContextStore:e,menuListItemProps:t}){const o=(0,s().v3)(),n=(0,a().K8)((()=>e.collectionViewBlockStore()),[e]),i=so({collectionContextStore:e,from:"customize_database_button_in_customize_menu"}),r=(0,eo().X)({environment:o,blockStore:n,from:"collectionSettingsMenu"});return n&&r?(0,w.jsx)(z().A,{icon:Ut()._,onClick:i,showChevron:!0,title:(0,w.jsx)(M().sA,{defaultMessage:"Customize page layout",id:"database.viewSettings.customizeMenu.customizeLayout"}),menuListItemProps:t}):null}function lo(e){const{collectionContextStore:t,collectionSettingsStore:o,menuListItemProps:n}=e,i=(0,Yt().ph)(),{addedFeatures:r}=(0,qt().Ro)(t,i),l=r.length;return(0,w.jsx)(z().A,{icon:zt().c,onClick:()=>L().a2({collectionSettingsStore:o,item:{type:"connectionFeatures"}}),right:l>0?l:void 0,showChevron:!0,title:(0,w.jsx)(M().sA,{defaultMessage:"Connections",id:"database.viewSettings.customizeMenu.connections.title"}),menuListItemProps:n})}function so({collectionContextStore:e,from:t}){const o=(0,s().v3)();return(0,n.useCallback)((()=>{const n=e.collectionStore(),i=e.collectionViewBlockStore();i&&n&&(0,Zt().nh)({environment:o,blockStore:i,collectionStore:n,collectionViewStore:e.collectionViewStore(),from:t})}),[e,o,t])}const ao=u().Store.createClass(!1,{name:"ShowViewDescriptionStore"});function co(e){const{collectionContextStore:t,collectionViewStore:o,selectViewNameInitial:r,collectionSettingsStore:l,handleAddItemClick:c}=e,{isMobile:d}=(0,s().Y0)(),u=(0,s().v3)(),p=(0,a().uB)(void 0,ao),g=(0,a().O$)(t.isInHomeWidgetStore),m=(0,ee().lU)(),S="PersonalHome"===m||"TeamHome"===m,y=(0,a().K8)((()=>{var e;const o=null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id;return!!o&&(0,te().s)(o)}),[t]),f=(0,n.useCallback)((e=>function(e,t,o,n){const i=null==n?void 0:n.getFormat().description;if(!n||e===i)return;D().createAndCommit({userAction:"CollectionSettingsViewMain.handleDescriptionChange",environment:t,canUndo:!0,perform:t=>{(0,$().F)({collectionViewStore:n,update:{format:{...n.getFormat(),description:e}},transaction:t})}}),(0,B().X)({environment:t,collectionContextStore:o,action:"set_description"})}(e,u,t,o)),[u,t,o]),h=(0,a().K8)((()=>t.collectionViewBlockStore()),[t]),v=(0,a().K8)((()=>o.isDefined()),[o]),x=(0,a().K8)((()=>o.getFormat().description),[o]),b=(0,a().K8)((()=>o.getType()),[o]),C=(0,a().O$)(p),j=(0,a().K8)((()=>"viewsMain"===t.viewsModuleContextStore.getViewModuleType()),[t]),A=(0,a().K8)((()=>t.collectionViewBlockStore()),[t]),_=(0,a().K8)((()=>{const e=l.state.showAddItemButton;return!!(c&&e&&A)}),[c,l,A]),I=(0,a().K8)((()=>t.isMultiSourceView),[t]),k=(0,i().X)("db_page_view"),T=(0,se().X5)(t);if(!v||!h)return null;const P=(0,w.jsx)(et().A,{collectionViewStore:o,collectionContextStore:t,showViewDescriptionStore:p,selectViewNameInitial:r,topBorder:_,sectionStyle:{marginTop:_&&!I?5:void 0}});if("page"===b)return!k||j?(0,w.jsxs)(He().Ay,{...e,title:(0,w.jsx)(M().sA,{...Bo.viewSettings}),children:[P,C?(0,w.jsx)(We().y,{initialDescription:x,handleSaveDescription:f}):void 0]}):(0,w.jsxs)(He().Ay,{...e,title:(0,w.jsx)(M().sA,{...Bo.viewSettings}),children:[P,C?(0,w.jsx)(We().y,{initialDescription:x,handleSaveDescription:f}):void 0,(0,w.jsx)(W().A,{style:{paddingBottom:12},children:(0,w.jsx)(Ge().f,{collectionContextStore:t,collectionSettingsStore:l})})]});let F;if("chart"===b)F=(0,w.jsx)(Ue().X,{collectionSettingsStore:l});else if("map"===b)F=(0,w.jsx)(Dt,{collectionSettingsStore:l});else if("dashboard"===b)F=(0,w.jsx)(O,{collectionContextStore:t,collectionSettingsStore:l});else if("form_editor"===b)F=(0,w.jsx)(bt,{collectionContextStore:t,collectionSettingsStore:l});else{if(S)return(0,w.jsx)(Mo,{collectionContextStore:t,collectionSettingsStore:l});if(g)return(0,w.jsx)(ko,{collectionContextStore:t,collectionSettingsStore:l,viewNameInput:P,addItemSection:_&&c&&A?(0,w.jsx)(G,{handleAddItemClick:c,store:A,disableTemplatesDropdown:I}):void 0});F=y?(0,w.jsx)(Ao,{collectionContextStore:t,collectionSettingsStore:l}):T?(0,w.jsx)(_o,{collectionContextStore:t,collectionSettingsStore:l}):(0,w.jsx)(Io,{collectionContextStore:t,collectionSettingsStore:l,isConfiguringViewsMainModule:j})}let V=Bo.viewSettings;return"form_editor"===b?V=Bo.formSettings:d&&(V=Bo.mobileSettings),(0,w.jsxs)(He().Ay,{...e,title:(0,w.jsx)(M().sA,{...V}),hideDesktopHeader:_,desktopTitleType:y||"chart"===b||"map"===b||"form_editor"===b?"mainTitle":"sectionHeader",children:[(0,w.jsx)(po,{collectionContextStore:t}),_&&c&&A?(0,w.jsx)(G,{handleAddItemClick:c,store:A,disableTemplatesDropdown:I}):void 0,P,C?(0,w.jsx)(We().y,{initialDescription:x,handleSaveDescription:f}):void 0,F]})}function uo(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}function po({collectionContextStore:e}){return(0,a().K8)((()=>{const t=e.collectionViewBlockStore();return t&&"content_only_editor"!==t.getRole()}),[e])?null:(0,w.jsx)(X,{})}function go({collectionContextStore:e,collectionSettingsStore:t}){const o=(0,s().v3)(),n=(0,a().K8)((()=>(0,ne().aS)(e)),[e]),i=(0,a().O$)(e.aliveAutomationCountStore),r=(0,a().K8)((()=>e.collectionStore()),[e]),[{value:l}]=(0,S().Yb)((async()=>await(0,ne().rc)({collectionStore:r})),[r]),c=!(0,a().O$)(d().e),u=0===i&&c;return n?(0,w.jsx)(z().A,{icon:b().m,onClick:()=>{const n=P().H(t);!l||i>0?L().a2({collectionSettingsStore:t,item:{source:"collection_view_settings",type:"automationSettings",from:n}}):E().h({environment:o,mode:"create_automation",collectionContextStore:e,collectionSettingsStore:t,from:n})},right:i>0?i:void 0,showChevron:!0,title:(0,w.jsx)(M().sA,{defaultMessage:"Automations",id:"database.viewSettings.mainTab.automations.title"}),disabled:u}):null}function mo(e){const{collectionContextStore:t,collectionSettingsStore:o,disabled:n=!1}=e,i=(0,s().v3)(),r=(0,a().K8)((()=>uo(t)),[t]),l="board"===r?{groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}:{groupByKey:"collection_group_by",groupsFormatKey:"collection_groups"},c=(0,a().O$)(t.normalizedSchemaStore),d=(0,a().O$)(t.normalizedFormatStore)[l.groupByKey],u=(0,a().O$)(t.permissionScopesStore);return!("calendar"===r||"feed"===r)?(0,w.jsx)(z().A,{icon:"board"===r?k().q:I().p,title:(0,w.jsx)(M().sA,{defaultMessage:"Group",id:"database.viewSettings.mainTab.groupButton.title"}),showChevron:!0,right:(0,w.jsx)(qe().dU,{groupByPropertySchema:d?c[d.property]:void 0}),onClick:()=>{var e;(0,B().X)({environment:i,collectionContextStore:t,action:"click_group",original_view_type:r,property_type:d?null===(e=c[d.property])||void 0===e?void 0:e.type:void 0}),t.isLoadingStore.state||t.loadingDetailsStore.setState({type:"load_groups_menu"}),L().a2({collectionSettingsStore:o,item:d?{type:"group",...l}:{type:"groupByProperty",...l}})},disabled:n||!d&&!u.canConfigureBlock}):null}function So(e){const{collectionContextStore:t,collectionSettingsStore:o,disabled:n=!1}=e,i=(0,s().v3)(),r=(0,a().K8)((()=>uo(t)),[t]),l=(0,a().O$)(t.normalizedSchemaStore),c=(0,a().O$)(t.normalizedFormatStore).collection_group_by,d={groupByKey:"collection_group_by",groupsFormatKey:"collection_groups"},u=(0,a().O$)(t.permissionScopesStore);return"board"===r?(0,w.jsx)(z().A,{icon:I().p,title:(0,w.jsx)(M().sA,{defaultMessage:"Sub-group",id:"database.viewSettings.mainTab.subGroupButton.title"}),showChevron:!0,right:(0,w.jsx)(qe().dU,{groupByPropertySchema:c?l[c.property]:void 0}),onClick:()=>{var e;(0,B().X)({environment:i,collectionContextStore:t,action:"click_subgroup",original_view_type:r,property_type:c?null===(e=l[c.property])||void 0===e?void 0:e.type:void 0}),t.isLoadingStore.state||t.loadingDetailsStore.setState({type:"load_groups_menu"}),L().a2({collectionSettingsStore:o,item:c?{type:"group",...d}:{type:"groupByProperty",...d}})},disabled:n||!c&&!u.canConfigureBlock}):null}const yo="layout";function fo(e){const{collectionContextStore:t,collectionSettingsStore:o,disabled:n=!1}=e,i=(0,s().v3)(),{collectionViewStore:r,collectionViewType:l}=(0,a().K8)((()=>{const e=t.collectionViewStore();return{collectionViewStore:e,collectionViewType:null==e?void 0:e.getType()}}),[t]);return r&&l?(0,w.jsx)(z().A,{disabled:n,icon:oe().ZU[l],title:(0,w.jsx)(M().sA,{defaultMessage:"Layout",id:"database.viewSettings.mainTab.layoutButton.title"}),showChevron:!0,right:oe().to[l],onClick:()=>{(0,B().X)({environment:i,collectionContextStore:t,action:"click_layout"}),L().a2({collectionSettingsStore:o,item:{type:yo}})}}):null}function ho(e){const{collectionContextStore:t,collectionSettingsStore:o,disabled:n=!1}=e,i=(0,s().v3)(),r=(0,a().O$)(t.normalizedFormatStore),l=(0,a().K8)((()=>uo(t)),[t]),c=(0,a().K8)((()=>(0,m().u9)(l)),[l]);if("chart"===l||"map"===l||"form_editor"===l)return(0,w.jsx)(w.Fragment,{});const d=((c?r[c]:void 0)||[]).filter((e=>Boolean(e.visible))).length;return(0,w.jsx)(z().A,{icon:h().n,disabled:n,title:(0,w.jsx)(M().sA,{defaultMessage:"Properties",id:"database.viewSettings.mainTab.propertiesButton.title"}),showChevron:!0,right:(0,w.jsx)(M().sA,{defaultMessage:"{propertiesShown} shown",id:"database.viewSettings.mainTab.propertiesButton.propertiesShown.title",values:{propertiesShown:d}}),onClick:()=>{(0,B().X)({environment:i,collectionContextStore:t,action:"click_properties"}),L().a2({collectionSettingsStore:o,item:{type:"properties",timelineViewTab:"timeline"}})}})}function vo(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,n=(0,s().v3)(),i=(0,a().O$)(t.normalizedFormatStore),r=(0,a().K8)((()=>uo(t)),[t]),l=(0,a().K8)((()=>(0,m().u9)(r)),[r]);if("chart"===r||"map"===r||"form_editor"===r)return null;const c=((l?i[l]:void 0)??[]).filter((e=>Boolean(e.visible))).length;return(0,w.jsx)(z().A,{icon:v().eyeIcon,title:(0,w.jsx)(M().sA,{defaultMessage:"Property visibility",id:"database.viewSettings.mainTab.propertyVisibilityButton.title"}),showChevron:!0,right:c,onClick:()=>{(0,B().X)({environment:n,collectionContextStore:t,action:"click_show_hide_properties"}),L().a2({collectionSettingsStore:o,item:{type:"propertyVisibility",timelineViewTab:"timeline"}})}})}function xo(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,n=(0,s().v3)(),i=(0,a().K8)((()=>{const e=t.permissionScopesStore.state;return!(0,Le().K)({collectionContextStore:t,permissionScopes:e})}),[t]);return(0,w.jsx)(z().A,{icon:h().n,title:(0,w.jsx)(M().sA,{defaultMessage:"Edit properties",id:"database.viewSettings.mainTab.editPropertiesButton.title"}),disabled:i,showChevron:!i,onClick:()=>{(0,B().X)({environment:n,collectionContextStore:t,action:"click_edit_properties"}),L().a2({collectionSettingsStore:o,item:{type:"editProperties",timelineViewTab:"timeline"}})}})}function bo({collectionContextStore:e}){return(0,a().K8)((()=>"on"===r().default.getEligibleGroup({experimentId:"my_tasks_limit_experiment",defaultGroup:"control"})),[])?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(z().A,{icon:A,title:(0,w.jsx)(M().sA,{defaultMessage:"Sources",id:"database.viewSettings.mainTab.sourcesButton.title"}),showChevron:!0,onClick:()=>{_e.setState({type:"open",collectionContextStore:e})}}),(0,w.jsx)(Te,{})]}):null}function Co({collectionContextStore:e,collectionSettingsStore:t}){const o=(0,s().v3)(),i=(0,a().O$)(e.normalizedSchemaStore),r=(0,a().O$)(e.currentSortsStore),l=(0,n.useCallback)((()=>{(0,B().X)({environment:o,collectionContextStore:e,action:"click_sort"}),0===r.length?L().a2({collectionSettingsStore:t,item:{type:"createSort"}}):L().a2({collectionSettingsStore:t,item:{type:"sort"}})}),[e,o,t,r.length]);return(0,w.jsx)(z().A,{icon:f().arrowUpDownIcon,title:(0,w.jsx)(M().sA,{...ze().D.sortTitle}),showChevron:!0,right:(0,w.jsx)(Q().v,{currentSorts:r,schema:i}),onClick:l})}function wo(e){const t=(0,s().v3)(),o=(0,a().K8)((()=>{const e=Oe().default.state.mainEditorCurrentBlockStore;return Boolean(e&&(0,te().s)(e.id))}),[]),n=(0,a().K8)((()=>{if(!(0,le().$H)())return!1;const t=e.collectionContextStore.collectionViewBlockStore();return!(!t||!(0,te().s)(t.id))}),[e.collectionContextStore]),i=(0,c().IS)((e=>({icon:jo(e).iconStyles,title:jo(e).menuItemStyles})),[]);if(!n)return null;const r=o?"home_tasks":"home_tile_tasks";return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(Z().CollectionTasksEmptyStateModal,{from:r}),(0,w.jsx)(z().A,{showChevron:!1,icon:_().questionMarkCircleIcon,iconStyle:i.icon,title:(0,w.jsx)(M().sA,{defaultMessage:"Don’t see your tasks?",id:"tasksEmptyState.noDatabases.title"}),textWrapperStyle:i.title,onClick:()=>{Re().A.setState(!0),(0,de().bS)({environment:t,from:r})}})]})}function jo(e){const t=(0,Ee().EI)(e);return{menuItemStyles:{color:t.text},iconStyles:{fill:t.icon}}}function Ao({collectionContextStore:e,collectionSettingsStore:t}){const o=(0,a().K8)((()=>{var t;return null===(t=e.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.subitem_property}),[e]),n=(0,a().K8)((()=>uo(e)),[e]);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(W().A,{extraPadding:!0,style:{paddingTop:0},children:(0,w.jsx)(fo,{collectionContextStore:e,collectionSettingsStore:t})}),(0,w.jsxs)(W().A,{extraPadding:!0,topBorder:!0,children:[(0,w.jsx)(Ze().A,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(Co,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(mo,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(So,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(at,{collectionContextStore:e,collectionSettingsStore:t}),o&&(0,g().B)(n)?(0,w.jsx)(Ye,{collectionContextStore:e,onClick:()=>L().a2({collectionSettingsStore:t,item:{type:"subitemV2",from:"view_settings"}})}):null]}),(0,w.jsxs)(W().A,{extraPadding:!0,topBorder:!0,children:[(0,w.jsx)(It().z,{collectionContextStore:e}),(0,w.jsx)(Je().A,{collectionContextStore:e}),(0,w.jsx)(wo,{collectionContextStore:e})]})]})}function _o({collectionContextStore:e,collectionSettingsStore:t}){return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(W().A,{extraPadding:!0,style:{paddingTop:0},children:[(0,w.jsx)(vo,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(Ze().A,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(Co,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(mo,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(So,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(at,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(Je().A,{collectionContextStore:e})]}),(0,w.jsx)(Po,{collectionContextStore:e,collectionSettingsStore:t})]})}function Io({collectionContextStore:e,collectionSettingsStore:t,isConfiguringViewsMainModule:o}){const n=function(e){const t=(0,a().K8)((()=>{var t;return null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.isCollectionViewPageWithContent()}),[e]),o=(0,a().K8)((()=>{var t;return null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.hasAnySyncedCollection()}),[e]),n=(0,a().K8)((()=>Boolean(e.isDashboardWidget())),[e]);if(!(t||o||n))return(0,w.jsx)(Pt,{collectionContextStore:e})}(e),r=(0,It().R)({collectionContextStore:e}),l=function(e){const t=(0,ce().K)({collectionContextStore:e}),o=(0,i().X)("notion_calendar_db_integration_non_time_views"),n=(0,i().X)("notion_calendar_db_integration_view_settings_entrypoint");return t&&o&&n?(0,w.jsx)(ae().A,{collectionContextStore:e,entrypoint:"view_settings"},"openInCalendarAction"):null}(e),s=(0,T().oE)([n,r,l]),c=(0,a().K8)((()=>e.isPeopleCollection()),[e]),d=!c,u=!o&&s.length>0&&!c,p=(0,a().K8)((()=>{var t;return null===(t=e.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.subitem_property}),[e]),S=(0,a().K8)((()=>uo(e)),[e]),y=(0,a().K8)((()=>{const t=e.collectionStore();if(!t)return!0;const o=t.getFormat();return!((null==o?void 0:o.external_collection_type)===m().uO.Jira&&!(0,re().qU)())}),[e]);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(W().A,{extraPadding:!0,style:{paddingTop:0},children:[(0,w.jsx)(fo,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(vo,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(Ze().A,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(Co,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(mo,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(So,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(at,{collectionContextStore:e,collectionSettingsStore:t}),p&&(0,g().B)(S)?(0,w.jsx)(Ye,{collectionContextStore:e,onClick:()=>L().a2({collectionSettingsStore:t,item:{type:"subitemV2",from:"view_settings"}})}):null,(0,w.jsx)(Je().A,{collectionContextStore:e})]}),(0,w.jsxs)(w.Fragment,{children:[d?(0,w.jsxs)(W().A,{title:(0,w.jsx)(M().sA,{...Bo.dataSourceSettings}),topBorder:!0,extraPadding:!0,style:{marginTop:4},desktopTitleStyle:{paddingTop:4},children:[(0,w.jsx)(tt().Q,{collectionContextStore:e,collectionSettingsStore:t,disabled:o}),(0,w.jsx)(xo,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(go,{collectionContextStore:e,collectionSettingsStore:t}),y?(0,w.jsx)(no,{collectionContextStore:e,collectionSettingsStore:t,isConfiguringViewsMainModule:o}):null]}):void 0,(0,w.jsx)(Po,{collectionContextStore:e,collectionSettingsStore:t}),u?(0,w.jsx)(W().A,{topBorder:!0,extraPadding:!0,style:{marginTop:4},children:s}):void 0,c?(0,w.jsx)(R().Y,{collectionContextStore:e,collectionSettingsStore:t}):void 0]})]})}function ko({collectionContextStore:e,collectionSettingsStore:t,viewNameInput:o,addItemSection:n}){const i=(0,c().IS)((()=>({container:{minWidth:He().vE},nameInput:{paddingBottom:0}})),[]);return(0,w.jsxs)("div",{style:i.container,children:[n,(0,w.jsx)(W().A,{style:i.nameInput,children:o}),(0,w.jsx)(W().A,{children:(0,w.jsx)(fo,{collectionContextStore:e,collectionSettingsStore:t})}),(0,w.jsxs)(W().A,{topBorder:!0,children:[(0,w.jsx)(ho,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(Ze().A,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(Co,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(mo,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(So,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(at,{collectionContextStore:e,collectionSettingsStore:t})]}),(0,w.jsxs)(W().A,{topBorder:!0,children:[(0,w.jsx)(tt().Q,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(bo,{collectionContextStore:e}),(0,w.jsx)(Xe().A,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(To,{collectionContextStore:e}),(0,w.jsx)(wo,{collectionContextStore:e})]})]})}function Mo({collectionContextStore:e,collectionSettingsStore:t}){const o=(0,c().IS)((()=>({container:{minWidth:He().vE}})),[]);return(0,w.jsx)("div",{style:o.container,children:(0,w.jsxs)(W().A,{topBorder:!0,children:[(0,w.jsx)(Ze().A,{collectionContextStore:e,collectionSettingsStore:t}),(0,w.jsx)(Co,{collectionContextStore:e,collectionSettingsStore:t})]})})}function To({collectionContextStore:e}){const t=(0,M().tz)(),o=(0,s().v3)(),n=(0,a().K8)((()=>{var t;const o=null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.id;return!!o&&(0,te().s)(o)}),[e]);return(0,w.jsx)(z().A,{icon:x().e,title:t.formatMessage(De().u.hide),showChevron:!1,onClick:()=>{Oe().default.state.sidebarSpaceViewStore&&V().WO({environment:o,currentSpaceViewStore:Oe().default.state.sidebarSpaceViewStore,...n?{feature:"tasks",from:"tasks_more_menu"}:{feature:"custom_db",from:"custom_db_more_menu"}})}})}function Po({collectionContextStore:e,collectionSettingsStore:t}){const{navigate:o}=(0,n.useContext)(l().E),{isPhone:i}=(0,s().Y0)(),r=(0,s().v3)(),c=(0,a().K8)((()=>uo(e)),[e]),d=(0,a().K8)((()=>e.collectionViewBlockStore()),[e]),u=(0,n.useCallback)((()=>{var n,i;if(!d)return;const l=(0,ie().Ay)({store:d,fullyQualified:!1,pageVisitSource:p().y8.Expand,demoSettingsStore:Ke().A});(0,F().p)(r,{view_type:c,collection_id:null===(n=e.collectionStore())||void 0===n?void 0:n.id,collection_view_id:null===(i=e.collectionViewStore())||void 0===i?void 0:i.id,collection_view_block_id:d.id}),L().os({collectionSettingsStore:t}),o({environment:r,url:l})}),[d,r,c,t,e,o]),g=(0,a().O$)(e.isFullScreenStore),m=(0,a().K8)((()=>d&&"view"===Ne().A.getMode(r,d).permission),[r,d]);return g||m||!i?null:(0,w.jsx)(W().A,{children:(0,w.jsx)(z().A,{icon:y().arrowExpandDiagonalBottomLeftToTopRightIcon,title:(0,w.jsx)(M().sA,{...ze().D.openFullscreenButton}),onClick:u})})}const Bo=(0,M().YK)({dataSourceSettings:{defaultMessage:"Data source settings",id:"database.viewSettings.mainTab.dataSourceSectionTitle"},formSettings:{defaultMessage:"Form settings",id:"database.viewSettings.formTab.title"},viewSettings:{defaultMessage:"View settings",id:"database.viewSettings.mainTab.viewSectionTitle"},mobileSettings:{defaultMessage:"Settings",id:"database.viewSettings.mainTab.mobileTitle"}})},216596:(e,t,o)=>{o.r(t),o.d(t,{toggleTwoWaySyncOnCollection:()=>P,updateSyncedData:()=>B});o(16280),o(898992),o(672577),o(803949);var n=()=>o(165358),i=()=>o(282883),r=()=>o(179034),l=()=>o(343666),s=()=>o(201980),a=()=>o(229833),c=()=>o(312296),d=()=>o(789557),u=()=>o(135552),p=()=>o(972435),g=()=>o(747100),m=()=>o(252833),S=()=>o(765957),y=()=>o(150193),f=()=>o(548821),h=()=>o(612587),v=()=>o(148832),x=()=>o(477752),b=()=>o(559926),C=()=>o(559506),w=()=>o(934839),j=()=>o(896628),A=(o(296540),()=>o(104012)),_=()=>o(471995),I=o(474848);function k(e){const{item:t}=e;_().D6({...t,right:(0,I.jsx)(A().J$,{})})}var M=()=>o(231297),T=()=>o(755199);function P(e){var t;const{environment:o,taskCollectionStore:l,projectCollectionStore:s,openedFrom:a}=e,d=!(null===(t=l.getFormat().sync_state)||void 0===t?void 0:t.enable_two_way_sync);d?(!function(e){const{environment:t,taskCollectionStore:o}=e,r=o.getSchema(),l={};for(const n of i().En){const e=r[n];e&&"read_write"!==e.synced_permissions&&("notion://tasks/assign_property"===n&&"person"===e.type?l[n]={...e,synced_permissions:"read_write",limit:1}:l[n]={...e,synced_permissions:"read_write"})}Object.keys(l).length>0&&(M().createAndCommit({userAction:"updateSyncedCollectionActions.addSyncedPermissionsToSchema",environment:t,canUndo:!0,perform:e=>{(0,c().F)({environment:t,collectionStore:o,update:l,transaction:e})}}),n().log({level:"info",from:"updateSyncedCollectionActions",type:"addSyncedPermissionsToSchemaCompletedSuccessfully",data:{miscDataToConvertToString:{taskCollectionId:o.id,taskUpdate:l}}}))}({environment:o,taskCollectionStore:l}),a&&b().RR(o,{from:a,tier:void 0,step:"enable_jira_two_way_sync_toggle",project_collection_id:s.id,task_collection_id:l.id})):a&&b().RR(o,{from:a,tier:void 0,step:"disable_jira_two_way_sync_toggle",project_collection_id:s.id,task_collection_id:l.id});const p=l.getFormat().sync_state||{syncing:!1};M().createAndCommit({userAction:"updateSyncedCollectionActions.toggleTwoWaySyncOnCollection",environment:o,canUndo:!0,perform:e=>{j().zA({stores:[l,s],update:{sync_state:{...p,enable_two_way_sync:d}},transaction:e})}});const x=S().default.state.currentUserSettingsStore;x&&M().createAndCommit({userAction:"JiraTwoWaySyncInfoBanner.EnableClick",environment:o,canUndo:!1,perform:e=>{T().mJ({transaction:e,userSettingsStore:x,data:{seen_jira_two_way_sync_info_banner:!0}})}});const C=(0,g().cq)(l)?h().A:y().A;if(w().zA({bannerStore:C,id:"JiraTwoWaySyncInfoBanner"}),d){[l,s].forEach((e=>{var t,n;const i=null===(t=e.getParentPointer())||void 0===t?void 0:t.id;if((0,m().fo)({collectionStore:e})&&(0,m().z9)({collectionStore:e})&&i&&(null==x||null===(n=x.getSettings())||void 0===n||!n.seen_auth_missing_for_jira_synced_collection_view_banner)){const e={id:i,table:r().ev};w().HQ({bannerStore:C,id:"AuthMissingForJiraSyncedCollectionPageBanner",contentKey:"auth_missing_for_jira_user",styleKey:u().q.LightBlue,blockStore:new(v().B)(o,e),context:f().Rr.CollectionViewBlockFullScreen})}}))}else w().zA({bannerStore:C,id:"AuthMissingForJiraSyncedCollectionPageBanner"});n().log({level:"info",from:"updateSyncedCollectionActions",type:"toggleTwoWaySyncOnCollectionCompletedSuccessfully",data:{miscDataToConvertToString:{taskCollectionId:l.id,projectCollectionId:s.id,enable_two_way_sync:d}}})}async function B(e){const{transaction:t,environment:o}=e,c=t.operations.find((e=>(0,m().C0)(e)&&2===e.path.length&&"properties"===e.path[0]&&i().En.includes(e.path[1].toString())));if(c){const e=(0,m().sP)({transaction:t,updateOperation:c,environment:o});if(!e)return;return n().log({level:"info",from:"updateSyncedCollectionActions",type:"propertyUpdateTriggered",data:{message:"Property update triggered",spaceId:t.spaceId,miscDataToConvertToString:{updatePagePropertyOperation:c,transactionId:t.id}}}),await async function(e){const{transaction:t,environment:o,updateOperation:i,syncedCollectionStore:r}=e,l=()=>{try{return(0,m().jg)({updateOperation:i,transaction:t,collectionStore:r})}catch(e){throw F({}),n().log({level:"error",from:"updateSyncedCollectionActions",type:"handlePagePropertyUpdates",error:(0,a().convertErrorToLog)(e),data:{message:"Error extracting page property update payload",miscDataToConvertToString:{updateOperation:i,transactionId:t.id}}}),e}},s=l();if("UPDATE_PROPERTY"===s.syncCollectionUpdates[0].updateType){const e=s.syncCollectionUpdates[0].propertyId,t=m().vT({pageId:s.syncCollectionUpdates[0].collectionPagePointer.id,propertyId:e});m().Jv({uniquePropertyId:t});const n=await C().callApi({eventName:"updateSyncedCollectionData",environment:o,data:s});m().NW(t);const i=r.getSchema()[e];var c,d,u;if("success"!==n.type)throw F({syncCollectionType:r.getFormat().external_collection_type}),b().j2(o,{property_id:e,property_type:null==i?void 0:i.type,action:"sync_update_failure",integration:s.syncType,sync_status:"failure",error_code:(null===(c=n.error)||void 0===c||null===(c=c.name)||void 0===c?void 0:c.toString())??"Unknown error",collection_id:r.id}),new Error((null===(d=n.error)||void 0===d||null===(d=d.name)||void 0===d?void 0:d.toString())??"Unknown error");if(!n.data.success)throw F({errorCode:n.data.errorCode,syncCollectionType:r.getFormat().external_collection_type,propertyName:1===s.syncCollectionUpdates.length?null===(u=r.getSchema()[s.syncCollectionUpdates[0].propertyId])||void 0===u?void 0:u.name:void 0}),b().j2(o,{property_id:e,property_type:null==i?void 0:i.type,action:"sync_update_failure",integration:s.syncType,sync_status:"failure",error_code:n.data.errorCode,collection_id:r.id}),new Error(n.data.message);b().j2(o,{property_id:e,property_type:null==i?void 0:i.type,action:"sync_update_success",integration:s.syncType,collection_id:r.id})}}({transaction:t,environment:o,updateOperation:c,syncedCollectionStore:e}),void n().log({level:"info",from:"updateSyncedCollectionActions",type:"propertyUpdateCompleted",data:{message:"Property update completed",spaceId:t.spaceId,miscDataToConvertToString:{updatePagePropertyOperation:c,transactionId:t.id}}})}const u=t.operations.find((e=>"set"===e.command&&1===e.path.length&&"text"===e.path[0]));if(u&&u.pointer.table===l().SN){const e=(0,m().cb)({transaction:t,commentPointer:u.pointer,environment:o});if(!e)return;n().log({level:"info",from:"updateSyncedCollectionActions",type:"commentsUpdateTriggered",data:{message:"Comments update triggered",spaceId:t.spaceId,miscDataToConvertToString:{updatePageCommentOperation:u,transactionId:t.id}}});const{collectionStore:i,collectionPagePointer:r}=e;return await async function(e){const{transaction:t,environment:o,updateOperation:n,syncedCollectionStore:i,collectionPagePointer:r}=e,l=()=>{try{return(0,m().mE)({updateOperation:n,transaction:t,collectionStore:i,collectionPagePointer:r})}catch(e){throw F({}),e}},s=l();m().L$({commentId:n.pointer.id});const a=await C().callApi({eventName:"updateSyncedCollectionData",environment:o,data:s});var c;if(m().Rw(n.pointer.id),"success"!==(null==a?void 0:a.type))throw F({syncCollectionType:i.getFormat().external_collection_type}),new Error((null===(c=a.error)||void 0===c||null===(c=c.name)||void 0===c?void 0:c.toString())??"Unknown error");if(!a.data.success)throw F({errorCode:a.data.errorCode,syncCollectionType:i.getFormat().external_collection_type}),new Error(a.data.message)}({transaction:t,environment:o,updateOperation:u,syncedCollectionStore:i,collectionPagePointer:r}),void n().log({level:"info",from:"updateSyncedCollectionActions",type:"commentsUpdateCompleted",data:{message:"Comments update completed",spaceId:t.spaceId,miscDataToConvertToString:{updatePageCommentOperation:u,transactionId:t.id}}})}const p=t.operations.find((e=>{var t;return"update"===e.command&&1===e.path.length&&"properties"===e.path[0]&&(null===(t=e.args)||void 0===t?void 0:t.source)}));if(p){const e=(0,m().m0)({transaction:t,updateOperation:p,environment:o});if(!e)return;n().log({level:"info",from:"updateSyncedCollectionActions",type:"commentAttachmentUpdateTriggered",data:{message:"Comment attachment update triggered",spaceId:t.spaceId,miscDataToConvertToString:{updatePageCommentAttachmentOperation:p,pageCommentAttachmentUploadMetaInfo:e,transactionId:t.id}}});try{await async function(e){var t;const{transaction:o,environment:i,updateOperation:r,syncedCollectionStore:l,collectionPagePointer:a,commentPointer:c}=e,d=s().q4_(null===(t=r.args)||void 0===t?void 0:t.source);if(!d)return;const u=d.split(":").pop();if(!u)return;const p=Date.now(),g=u.includes(".")?u.substring(u.lastIndexOf(".")):"",m=`${u.includes(".")?u.substring(0,u.lastIndexOf(".")):u}_${p}${g}`;n().log({level:"info",from:"updateSyncedCollectionActions",type:"attachmentFilenameTransformed",data:{message:"Transformed attachment filename to avoid collisions",spaceId:o.spaceId,miscDataToConvertToString:{originalFileName:u,transformedFileName:m,timestamp:p,transactionId:o.id}}});const S=l.getFormat().external_collection_type;if(!S)throw F({}),new Error("Collection is not an external synced collection");const y={spaceId:o.spaceId,syncType:S,syncCollectionUpdates:[{collectionPagePointer:a,notionCommentId:c.id,attachment:{fileName:m,s3Data:{path:d}},updateType:"APPEND_ATTACHMENT"}]},f=await C().callApi({eventName:"updateSyncedCollectionData",environment:i,data:y});var h;if("success"!==(null==f?void 0:f.type))throw F({syncCollectionType:l.getFormat().external_collection_type}),new Error((null===(h=f.error)||void 0===h||null===(h=h.name)||void 0===h?void 0:h.toString())??"Unknown error");if(!f.data.success)throw F({errorCode:f.data.errorCode,syncCollectionType:l.getFormat().external_collection_type}),new Error(f.data.message)}({transaction:t,environment:o,updateOperation:p,syncedCollectionStore:e.collectionStore,collectionPagePointer:e.collectionPagePointer,commentPointer:e.commentPointer}),n().log({level:"info",from:"updateSyncedCollectionActions",type:"commentAttachmentUpdateCompleted",data:{message:"Comment attachment update completed",spaceId:t.spaceId,miscDataToConvertToString:{updatePageCommentAttachmentOperation:p,pageCommentAttachmentUploadMetaInfo:e,transactionId:t.id}}})}catch(g){const i=new(x().j)(o,e.commentPointer),l=new(v().B)(o,{id:p.pointer.id,table:r().ev,spaceId:t.spaceId});throw i&&l&&M().createAndCommit({userAction:"Comment.handleRemoveFileFromActionsDueToSyncFailure",environment:o,canUndo:!0,perform:e=>{d().L6({commentStore:i,fileBlocks:[l],transaction:e})}}),n().log({level:"error",from:"updateSyncedCollectionActions",type:"commentAttachmentUpdateFailed",data:{message:"Comment attachment update failed",spaceId:t.spaceId,miscDataToConvertToString:{updatePageCommentAttachmentOperation:p,pageCommentAttachmentUploadMetaInfo:e,transactionId:t.id}}}),g}}}function F(e){const{errorCode:t,syncCollectionType:o,propertyName:n}=e,i=p().A.getIntl();if(!o)return void k({item:{label:i.formatMessage({id:"syncedCollectionUpdateError.syncCollectionTypeMissing",defaultMessage:"Failed to update: incorrect sync collection setup"})}});if(!t)return void k({item:{label:`Failed to update ${n??o}, please try again in some time`}});k({item:{label:m().LA({syncCollectionType:o,errorCode:t,intl:i})}})}},234675:(e,t,o)=>{o.d(t,{R:()=>n,l:()=>i});const n="custom_component";function i(e){return!("dependencies"in e)&&e.collectionUri===n}},248064:(e,t,o)=>{o.d(t,{h:()=>a});var n=o(296540),i=()=>o(484714),r=()=>o(56366),l=()=>o(978846),s=()=>o(937199);function a(){const{layoutStore:e,currentModuleSelection:t,setModuleSelection:o,sessionId:a}=(0,s().LH)(),c=(0,i().v3)(),d=(0,r().K8)((()=>{var t;return null===(t=e.getModel())||void 0===t?void 0:t.getLayoutType()}),[e]),u="form"===d?"form_layout_schema":"new_module"===(null==t?void 0:t.type)?t.area:void 0;return(0,n.useCallback)((n=>{const{layoutModule:i,transaction:r}=n;if(!e.getModel()||!u||"form_conditional_modules"===u)return;let s;if("form"===d)s=n.position??{type:"area_relative",area:"form_layout_schema",location:"end_moveable"};else{if("new_module"!==(null==t?void 0:t.type))return;if("form_conditional_modules"===t.area)return;s="views_main_tab_modules"===t.area?{type:"area_relative",area:t.area,viewId:t.viewsMainTabId,location:"end_moveable"}:{type:"area_relative",area:t.area,location:"end_moveable"}}(0,l().UQ)({environment:c,sessionId:a,layoutStore:e,position:s,module:i,transaction:r,isPropertyCreation:!1}),o({type:"existing_module",moduleId:i.id,isDragging:!1})}),[u,t,c,e,d,a,o])}},267654:(e,t,o)=>{o.d(t,{g:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 13.75 13.75",svg:(0,o(474848).jsx)("path",{d:"M3.75 3.125c.345 0 .625.28.625.625v6.595l3.017-2.64.097-.07a.626.626 0 0 1 .756.098l3.035 3.037 4.442-4.442.098-.08a.626.626 0 0 1 .866.866l-.08.099-4.883 4.883a.626.626 0 0 1-.884 0L7.774 9.03l-3.399 2.975v2.745c0 .483.392.875.875.875h11l.126.013a.625.625 0 0 1 0 1.224l-.126.013h-11a2.125 2.125 0 0 1-2.125-2.125v-11c0-.345.28-.625.625-.625"})},i=(0,o(340498).wt)("chartLine",n)},299961:(e,t,o)=>{o.d(t,{v:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"4.12 2.37 11.75 15.25",svg:(0,o(474848).jsx)("path",{d:"M15.875 4.5a2.125 2.125 0 0 0-2.125-2.125h-7.5A2.125 2.125 0 0 0 4.125 4.5v11c0 1.174.951 2.125 2.125 2.125h7.5a2.125 2.125 0 0 0 2.125-2.125zm-2.125-.875c.483 0 .875.392.875.875v4.875h-9.25V4.5c0-.483.392-.875.875-.875zm-8.375 7h9.25V15.5a.875.875 0 0 1-.875.875h-7.5a.875.875 0 0 1-.875-.875z"})},i=(0,o(340498).wt)("rectangleSplit2Vertical",n)},301524:(e,t,o)=>{o.d(t,{A:()=>A,B:()=>M});o(898992),o(354520),o(672577),o(581454),o(737550),o(296540);var n=()=>o(484714),i=()=>o(252291),r=()=>o(236262),l=()=>o(995847),s=()=>o(340498),a=()=>o(69708),c=()=>o(100622),d=()=>o(496603),u=()=>o(436696),p=()=>o(497222),g=()=>o(519200),m=()=>o(722872),S=()=>o(541558),y=()=>o(760217),f=()=>o(439264),h=()=>o(285790),v=()=>o(678553),x=()=>o(417392),b=()=>o(89924),C=()=>o(859428),w=o(474848);const j=(0,a().YK)({inputPlaceholder:{defaultMessage:"Search for a property…",id:"database.viewSettings.collectionSortMenu.inputPlaceholder"},deleteButtonTooltip:{defaultMessage:"Remove sort rule",id:"database.sortMenu.deleteButtonTooltip"}});const A=function({schema:e,format:t,sorts:i,showDeleteAll:l,disabled:s,parentStore:c,collectionContextStore:d,onChange:g,onDeleteAll:S}){const y=(0,n().v3)(),{device:f}=y,h=!!Object.keys(e).some((e=>!i.find((t=>t.property===e)))),v=l&&i.length>0;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(P,{sorts:i,schema:e,disabled:s,parentStore:c,collectionContextStore:d,onChange:g}),h||v?(0,w.jsxs)(b().A,{children:[h?(0,w.jsx)(o(406699).A,{popupType:f.isMobile?x().nl.SlideUp:x().nl.Popup,renderOrigin:e=>(0,w.jsx)(p().A,{icon:o(617668).plusIcon,isGray:!0,title:(0,w.jsx)(a().sA,{id:"database.viewSettings.sortTab.newSort",defaultMessage:"Add sort"}),...e}),render:n=>{let r;return r=f.isMobile?{menuType:m().gu.ActionSheet}:{menuType:m().gu.Popup,width:280,height:287},(0,w.jsx)(o(404277).A,{...r,children:(0,w.jsx)(o(380468).A,{schema:e,format:t,getProperties:()=>Object.entries(e).filter((([e,t])=>!i.find((t=>t.property===e))&&(0,o(835195).oH)(t))).map((([e])=>e)),onAccept:t=>{!function(e,t,o,n,i,r){var l;if(!e)return;const s=null===(l=o[e])||void 0===l?void 0:l.type,a=[...n,{property:e,direction:"ascending"}];i(a),(0,u().X)({environment:t,action:"create_sort_accept",collectionContextStore:r,property_type:s})}(t,y,e,i,g,d),n.close()},inputPlaceholder:o(972435).A.formatMessage(j.inputPlaceholder)})})}}):void 0,v?(0,w.jsx)(p().A,{icon:r().trashIcon,isRed:!0,isGray:!0,title:(0,w.jsx)(a().sA,{id:"database.viewSettings.sortTab.deleteAllSorts",defaultMessage:"Delete sort"}),onClick:()=>function(e,t,o,n){t([]),null==n||n(),(0,u().X)({environment:e,action:"delete_all_sorts",collectionContextStore:o})}(y,g,d,S)}):void 0]}):void 0]})};function _(e,t,o,n,i,r){n(i.map(((o,n)=>n===e?t:o))),(0,u().X)({environment:o,collectionContextStore:r,action:"update_sort"})}function I(e,t,o,n,i){o(n.filter(((t,o)=>o!==e))),(0,u().X)({environment:t,action:"delete_sort",collectionContextStore:i})}function k({index:e,onChange:t,sorts:o,collectionContextStore:l}){const s=(0,n().v3)();return(0,w.jsx)(y().A,{title:(0,w.jsx)("div",{style:{color:c().Tj.red},children:(0,w.jsx)(a().sA,{defaultMessage:"Delete",id:"database.viewSettings.sortTab.mobileDeleteButtonTitle"})}),icon:(0,w.jsx)(i().I,{icon:r().trashIcon,colorPalette:"red",colorVariant:"accentPrimary"}),onClick:()=>I(e,s,t,o,l),focused:!1})}function M({onDeleteClick:e}){const t=(0,a().tz)();return(0,w.jsx)(C().A,{render:o=>(0,w.jsx)(h().A,{ariaLabel:t.formatMessage(j.deleteButtonTooltip),icon:l().xMarkSmallIcon,iconStyle:{width:s().Ev.sm,height:s().Ev.sm},onClick:e,style:{marginInlineEnd:-6},...o}),renderTooltip:()=>t.formatMessage(j.deleteButtonTooltip)})}function T({sort:e,index:t,schema:o,disabled:i,parentStore:r,collectionContextStore:l,onChange:s,sorts:a}){const c=(0,n().v3)(),{device:d}=c;return d.isMobile?(0,w.jsxs)(b().A,{children:[(0,w.jsx)(S().Ay,{index:t,sort:e,schema:o,parentStore:r,collectionContextStore:l,onChange:(e,t)=>_(e,t,c,s,a,l)}),i?void 0:(0,w.jsx)(k,{onChange:s,sorts:a,collectionContextStore:l,index:t})]}):(0,w.jsx)(b().A,{extraTopPadding:!0,desktopStyle:{paddingTop:8,paddingInlineEnd:0,paddingBottom:0,paddingInlineStart:8,width:"100%"},children:(0,w.jsx)(v().Ay,{showDragHandle:!d.isMobile&&!i,title:(0,w.jsx)("div",{style:{display:"flex",alignItems:"center",flexGrow:1,whiteSpace:"nowrap"},onMouseDown:g().t,children:(0,w.jsx)(S().Ay,{index:t,sort:e,schema:o,parentStore:r,collectionContextStore:l,onChange:(e,t)=>_(e,t,c,s,a,l)})}),right:!i&&(0,w.jsx)(M,{onDeleteClick:()=>I(t,c,s,a,l)}),rightStyle:{marginInlineEnd:19}})})}function P({sorts:e,schema:t,disabled:o,parentStore:i,collectionContextStore:r,onChange:l}){const s=(0,n().v3)(),{device:a}=s;if(a.isMobile)return(0,w.jsx)(w.Fragment,{children:e.map(((n,s)=>(0,w.jsx)(T,{schema:t,disabled:o,parentStore:i,collectionContextStore:r,onChange:l,sorts:e,sort:n,index:s},s)))});{const n=e.map(((e,t)=>t.toString()));return n.length>0?(0,w.jsx)("div",{style:{marginBottom:2},children:(0,w.jsx)(f().Ay,{direction:"vertical",keys:n,renderKey:n=>(0,w.jsx)(T,{schema:t,disabled:o,parentStore:i,collectionContextStore:r,onChange:l,sorts:e,sort:e[parseInt(n)],index:parseInt(n)}),onDrop:t=>function(e,t,o,n,i){o(d().oE(e.map((e=>n[parseInt(e)])))),(0,u().X)({environment:t,action:"reorder_sorts",collectionContextStore:i})}(t,s,l,e,r)})}):null}}},334955:(e,t,o)=>{o.d(t,{Me:()=>h,QZ:()=>x,Tv:()=>v,lk:()=>b});var n=o(296540),i=()=>o(484714),r=()=>o(56366),l=()=>o(69708),s=()=>o(534177),a=()=>o(436696),c=()=>o(908447),d=()=>o(581928),u=()=>o(899164),p=()=>o(60867),g=()=>o(896628),m=()=>o(231297),S=()=>o(317406),y=()=>o(685889),f=()=>o(926203);function h(e){const{collectionContextStore:t,feature:o}=e,n=(0,l().tz)();return{initialPropertyName:(0,r().K8)((()=>{const e=t.collectionStore();if(null!=e&&e.isDefined()){const i=t.normalizedSchemaStore.state;return y().$H(n,{targetCollectionStore:e,isSelfRelation:!0,sourceSchema:i,createUnique:!0,from:o})}return n.formatMessage({id:"database.viewSettings.relationsPropertyTab.initialPropertyName.placeholder",defaultMessage:"Related to target"})}),[t,n,o])}}function v(e){const{feature:t,collectionContextStore:o,onPropertySelect:v}=e,x=(0,i().v3)(),b=(0,l().tz)(),{initialPropertyName:C}=h({collectionContextStore:o,feature:t}),w=(0,n.useCallback)((e=>{const{collectionViewStore:o,newProperty:n,transaction:i}=e;"timeline_arrows_by"===t&&S().Tq({collectionViewStore:o,newProperty:n,transaction:i})}),[t]),j=(0,r().O$)(o.normalizedSchemaStore),A=(0,n.useCallback)((()=>y().qw(o,j)),[o,j]),_=(0,n.useCallback)((e=>{const{relationPropertyId:n,transaction:i}=e;"subitem"===t?p().zt({environment:x,collectionContextStore:o,relationPropertyId:n,transaction:i}):"timeline_arrows_by"===t?S().L_({collectionContextStore:o,relationPropertyId:n,transaction:i}):(0,s().HB)(t)}),[o,x,t]),I=(0,n.useCallback)((e=>{const{featureType:t,from:n}=e,i=o.collectionStore(),r=i,l=o.collectionViewStore();if(!i||!r)return;const{performResult:a}=m().createAndCommit({userAction:"CollectionSettingsSetupRelation.handleAddRelation",environment:x,canUndo:!0,perform:n=>{const s=(0,d().createProperty)({environment:x,collectionStore:i,collectionViewArgs:l?{collectionViewStore:l,format:l.getFormat(),formatKey:"collection_page_properties"}:void 0,propertyType:"relation",transaction:n});return u().cT({environment:x,collectionContextStore:o,collectionStore:i,property:s,propertyName:C,targetCollectionStore:r,hasInverseRelation:!0,inverseName:void 0,autoRelate:{enabled:!1},propertyLimit:"no_limit",intl:b,transaction:n,from:t}),l&&(w({collectionViewStore:l,newProperty:s,transaction:n}),_({relationPropertyId:s,transaction:n})),"timeline_arrows_by"===t&&(0,f().Wf)({environment:x,intl:b,collectionStore:i,transaction:n,newConfig:e.dateShiftingConfig}),s}});let p;"subitem"===t?p="notion://tasks/sub_task_feature":"timeline_arrows_by"===t?p="notion://tasks/task_dependencies_feature":(0,s().HB)(t),(0,c().Z)({environment:x,collectionContextStore:o,from:t,property_type:"relation",property_id:a,feature:{id:a,from:n,type:p}})}),[o,x,C,b,_,w]),k=(0,n.useCallback)((e=>{const n=o.collectionViewStore();if(!n)return;let i;m().createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handleDefaultPropertySelect",environment:x,canUndo:!0,perform:t=>{w({collectionViewStore:n,newProperty:e,transaction:t}),_({relationPropertyId:e,transaction:t})}}),v(e),"subitem"===t?i="update_default_subitem":"timeline_arrows_by"===t?i="update_default_timeline_arrows_by":(0,s().HB)(t),(0,a().X)({action:i,original_view_type:void 0,property_type:e?"relation":void 0,environment:x,collectionContextStore:o})}),[o,x,v,t,w,_]),M=(0,n.useCallback)((e=>{const n=o.collectionViewStore();if(!n)return;let i;m().createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handlePropertySelect",environment:x,canUndo:!0,perform:t=>{w({collectionViewStore:n,newProperty:e,transaction:t})}}),v(e),"subitem"===t?i="update_subitem":"timeline_arrows_by"===t?i="update_timeline_arrows_by":(0,s().HB)(t),(0,a().X)({action:i,original_view_type:void 0,property_type:e?"relation":void 0,environment:x,collectionContextStore:o})}),[o,x,v,t,w]),T=(0,n.useCallback)((()=>{const e=o.collectionViewStore();e&&m().createAndCommit({userAction:"actionRegistry.clearCollectionViewSubitemConfig",environment:x,canUndo:!0,perform:t=>{g().zA({stores:[e],update:{subitem_display_mode:void 0,subitem_filter_scope:void 0},transaction:t})}})}),[o,x]),P=(0,n.useCallback)((e=>{const{subitemFilterScope:t}=e,n=o.collectionViewStore();n&&m().createAndCommit({userAction:"actionRegistry.setSubitemFilterScopeOnSubitemEnable",environment:x,canUndo:!0,perform:e=>{g().zA({stores:[n],update:{subitem_filter_scope:t},transaction:e})}})}),[o,x]);return{handlePropertySelect:M,handleDefaultPropertySelect:k,handleAddRelation:I,getProperties:A,clearCollectionViewSubitemConfig:T,setSubitemFilterScope:P}}function x(e){const{feature:t,collectionContextStore:o}=e;let n,i;var r,l;if("subitem"===t)i=null===(r=o.collectionStore())||void 0===r?void 0:r.getFormatStore().getKeyStore("subitem_property").getValue(),n="flattened"===(null===(l=o.collectionViewStore())||void 0===l?void 0:l.getFormat().subitem_display_mode)?void 0:i;else if("timeline_arrows_by"===t){var a;n=o.currentArrowsByFormatStore.state,i=null===(a=o.collectionStore())||void 0===a?void 0:a.getFormatStore().getKeyStore("collection_default_arrows_by").getValue()}else(0,s().HB)(t);const c=o.normalizedSchemaStore.state,d=y().uu(o,c);(0,s().O9)(n)&&!d.includes(n)&&(n=void 0),(0,s().O9)(i)&&!d.includes(i)&&(i=void 0);const u=n??i;if(u){var p;const e=Boolean(n),r="hidden"!==(null===(p=o.collectionViewStore())||void 0===p?void 0:p.getFormat().subitem_display_mode),l="subitem"===t?r:e;return{property:u,isDefault:u===i,enabledOnView:e,enabledOnCollection:Boolean(i),supportedInView:(0,f().v9)({feature:t,viewType:o.getViewType()}),isVisibleInView:l}}}function b(e){const{feature:t,collectionContextStore:o}=e;return(0,r().K8)((()=>x({feature:t,collectionContextStore:o})),[o,t])}},343630:(e,t,o)=>{o.d(t,{k:()=>l});o(296540);var n=()=>o(69708),i=()=>o(534177),r=o(474848);function l({canAddCollectionResult:e}){if(!e||e.canAddView)return null;switch(e.reason){case"tooManyViews":return(0,r.jsx)(n().sA,{defaultMessage:"You are at the maximum number of views for this database.",id:"collectionTabBar.newDataSource.tooltip.tooManyViews"});case"tooManyCollections":return(0,r.jsx)(n().sA,{defaultMessage:"You are at the maximum number of data sources for this database.",id:"collectionTabBar.newDataSource.tooltip.tooManyDataSources"});default:throw(0,i().HB)(e.reason)}}},346705:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().Store{getInitialState(){return{isModalOpen:!1,collectionContextStore:void 0}}}const i=new n},364871:(e,t,o)=>{o.d(t,{A:()=>d});o(296540);var n=()=>o(56366),i=()=>o(69708),r=()=>o(436696),l=()=>o(231297),s=()=>o(899725),a=()=>o(147503),c=o(474848);const d=function({collectionContextStore:e,collectionSettingsStore:t}){const d=(0,i().tz)(),u=(0,o(484714).v3)(),{collectionViewBlockStore:p,permissionScopes:g,viewType:m,viewName:S}=(0,n().K8)((()=>{var t,o;return{collectionViewBlockStore:e.collectionViewBlockStore(),permissionScopes:e.permissionScopesStore.state,viewType:null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType(),viewName:null===(o=e.collectionViewStore())||void 0===o?void 0:o.getName()}}),[e]),y=(0,n().K8)((()=>{if(e.dashboardWidgetStore.state)return!g.canConfigureBlock;const t=1===(null==p?void 0:p.getCollectionViewIds().length),o=e.isEditableHomeCollectionStore.state;return!g.canConfigureBlock||"collectionTypedView"===e.contextType||t&&!o}),[e,p,g.canConfigureBlock]);if(!p||y||!m)return null;let f=(0,c.jsx)(i().sA,{defaultMessage:"Delete view",id:"database.viewSettings.mainTab.deleteTheOnlyViewButton.title"});return"chart"===m?f=(0,c.jsx)(i().sA,{defaultMessage:"Delete chart",id:"database.viewSettings.mainTab.deleteButton.title.chart"}):S&&(f=(0,c.jsx)(i().sA,{defaultMessage:"Delete {viewName}",id:"database.viewSettings.mainTab.deleteButton.title.viewName",values:{viewName:S}})),(0,c.jsx)(o(497222).A,{icon:o(236262).trashIcon,title:f,isRed:!0,onClick:()=>function(e,t,o,n){const i=o.collectionViewStore();i&&(o.isDashboardWidget()?(l().createAndCommit({environment:t,userAction:"dashboard.deleteWidget",canUndo:!0,perform:e=>{(0,s().T)({transaction:e,collectionContextStore:o,viewId:i.id})}}),a().os({collectionSettingsStore:n})):a().nl({intl:e,environment:t,collectionContextStore:o,collectionViewStore:i,collectionSettingsStore:n,from:"view_settings"}),(0,r().X)({environment:t,collectionContextStore:o,action:"click_delete",original_view_type:i.getType()}))}(d,u,e,t)})}},370493:(e,t,o)=>{o.d(t,{$Y:()=>m,JO:()=>S,V_:()=>y,bP:()=>p,jc:()=>f});o(898992),o(823215),o(354520);var n=()=>o(726637),i=()=>o(148307),r=()=>o(214388),l=()=>o(748580),s=()=>o(898244),a=()=>o(206267),c=()=>o(534177),d=()=>o(649746),u=()=>o(476492);function p(e){const{propertyId:t,schema:o,getRecordModel:n,spaceIdCreator:i}=e,s=(0,d().SN)({property:t,schema:o,getRecordModel:n,spaceIdCreator:i}),c=o[t],u=c&&function(e){if(!(0,l().ry)(e))return!1;const t=(0,l().IS)(e),o=(0,r().U6)({filterValueType:t});return r().wh.every((e=>o.includes(e)))}(c.type)?{operator:"is_not_empty",value:void 0}:s,p=c&&g(c);return{id:(0,a().JW)(),conditional_filter:{property:t,filter:u},properties_to_color:{type:"all"},background:p?{type:"match_property_value"}:{type:"custom",color:"teal_background"}}}function g(e){return s().DD(e)||s().P8(e)||s().Ou(e)}function m(e,t){return!(!e||!t)&&(!!g(e)&&"is_empty"!==t.operator)}function S({collectionContextStore:e,conditionalColorRule:t}){var o,n,i,r,l;const s=(0,u().sl)(e),a=e.normalizedFormatStore.state.conditional_color_rules,c=null==a?void 0:a.length,d=null==t?void 0:t.conditional_filter,p=null==d?void 0:d.property;if(!t||!p)return{total_rules:c,...s??{}};const g=null===(o=e.normalizedSchemaStore.state[p])||void 0===o?void 0:o.type;return{rule_id:null==t?void 0:t.id,property_id:p,property_type:g,filter_operator:null===(n=d.filter)||void 0===n?void 0:n.operator,background_type:null==t||null===(i=t.background)||void 0===i?void 0:i.type,background_color:"custom"===(null==t||null===(r=t.background)||void 0===r?void 0:r.type)?null==t||null===(l=t.background)||void 0===l?void 0:l.color:void 0,total_rules:c,...s??{}}}function y({collectionViewType:e,isDarkMode:t}){switch(e){case"calendar":return t?i().A.images.tooltips.collectionSettings.conditionalColorCalendarDarkPreviewSvg:i().A.images.tooltips.collectionSettings.conditionalColorCalendarLightPreviewSvg;case"board":return t?i().A.images.tooltips.collectionSettings.conditionalColorBoardDarkPreviewSvg:i().A.images.tooltips.collectionSettings.conditionalColorBoardLightPreviewSvg;case"gallery":return t?i().A.images.tooltips.collectionSettings.conditionalColorGalleryDarkPreviewSvg:i().A.images.tooltips.collectionSettings.conditionalColorGalleryLightPreviewSvg;case"list":return t?i().A.images.tooltips.collectionSettings.conditionalColorListDarkPreviewSvg:i().A.images.tooltips.collectionSettings.conditionalColorListLightPreviewSvg;case"table":return t?i().A.images.tooltips.collectionSettings.conditionalColorTableDarkPreviewSvg:i().A.images.tooltips.collectionSettings.conditionalColorTableLightPreviewSvg;case"timeline":return t?i().A.images.tooltips.collectionSettings.conditionalColorTimelineDarkPreviewSvg:i().A.images.tooltips.collectionSettings.conditionalColorTimelineLightPreviewSvg;case"feed":return t?i().A.images.tooltips.collectionSettings.conditionalColorFeedDarkPreviewSvg:i().A.images.tooltips.collectionSettings.conditionalColorFeedLightPreviewSvg;case"map":return t?i().A.images.tooltips.collectionSettings.conditionalColorMapDarkPreviewSvg:i().A.images.tooltips.collectionSettings.conditionalColorMapLightPreviewSvg;case"page":case"chart":case"form_editor":case"chat":case"custom":case"dashboard":return;default:(0,c().HB)(e)}}function f(e){return n().A.isMobile&&e?"Body/Medium":"Body/Regular"}},384130:(e,t,o)=>{o.d(t,{J:()=>d});var n=o(296540),i=()=>o(484714),r=()=>o(56366),l=()=>o(231297),s=()=>o(755199),a=()=>o(381678),c=()=>o(765957);function d(){return function({userSettingsDismissibleKey:e}){const t=(0,i().v3)(),o=(0,r().O$)(c().AppStoreCurrentUserSettingsStore),d=(0,r().K8)((()=>{const t=null==o?void 0:o.getSettings();return!t||Boolean(t[e])}),[e,o]),u=(0,r().K8)((()=>{const e=(0,a()._)(t),n=null==o?void 0:o.getSettings();return Boolean(e)&&Boolean(n)&&!t.device.isMobile&&!d}),[t,o,d]),p=n.useCallback((()=>{o&&!d&&u&&l().createAndCommit({environment:t,userAction:"LayoutInfoPanelButtonEducationTooltip.dismiss",canUndo:!1,perform:t=>{s().mJ({userSettingsStore:o,transaction:t,data:{[e]:Date.now()}})}})}),[t,u,e,o,d]);return{shouldShowTooltip:u,dismissTooltip:p}}({userSettingsDismissibleKey:"layout_builder_add_module_button_education_tooltip_dismissed_at"})}},390518:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);var n=()=>o(98126),i=o(474848);function r(){return(0,i.jsx)("div",{style:{alignItems:"center",display:"flex",justifyContent:"center",minHeight:200,overflow:"hidden"},children:(0,i.jsx)(n().k,{})})}},395859:(e,t,o)=>{o.d(t,{A:()=>h,X:()=>y});o(296540);var n=()=>o(56366),i=()=>o(148307),r=()=>o(201980),l=()=>o(69708),s=()=>o(436696),a=()=>o(896628),c=()=>o(319975),d=()=>o(231297),u=()=>o(654062),p=()=>o(943919),g=()=>o(403905),m=()=>o(635462),S=o(474848);const y=(0,l().YK)({viewNamePlaceholderMessage:{defaultMessage:"View name",id:"database.viewSettings.mainTab.viewNamePlaceholder.title"},formNamePlaceholderMessage:{defaultMessage:"Form name",id:"database.viewSettings.mainTab.formNamePlaceholder.title"},addDescriptionTooltip:{defaultMessage:"Add view description",id:"database.viewSettings.mainTab.addDescriptionTooltip.title"},editDescriptionTooltip:{defaultMessage:"Edit view description",id:"database.viewSettings.mainTab.editDescriptionTooltip.title"}});function f(e,t,o,n){const i=n.collectionViewBlockStore(),l=n.collectionViewStore();if(!i||!l||!l.isDefined())return;const a=(0,m().s)(i.id),p=(0,g().V)(e,l.getType(),o);l.getName()!==p&&d().createAndCommit({userAction:"CollectionSettingsViewMain.handleViewNameSubmit",environment:t,canUndo:!0,perform:t=>{if((0,u().F)({collectionViewStore:l,update:{name:p},transaction:t}),a){const o=(0,r().x9d)(e);c().R9({environment:i.environment,store:i.getBlockTitleStore(),value:o,transaction:t})}}}),(0,s().X)({environment:t,collectionContextStore:n,action:"rename",original_view_type:l.getType()})}const h=function(e){const{collectionViewStore:t,collectionContextStore:r,selectViewNameInitial:c,showViewDescriptionStore:u,topBorder:g,sectionStyle:h}=e,v=(0,o(484714).v3)(),x=(0,l().tz)(),b=(0,o(401497).eP)(),C=(0,n().K8)((()=>t.getType()),[t]),w=(0,n().K8)((()=>{var e;return null===(e=t.getCollectionSource())||void 0===e?void 0:e.type}),[t]),j=(0,n().K8)((()=>t.getName()),[t]),{description:A,collection_view_icon:_}=(0,n().K8)((()=>t.getFormat()),[t]),I=(0,n().O$)(u),k=(0,n().O$)(r.canConfigureBlockStore),M=(0,n().O$)(r.isEditableHomeCollectionStore),T=(0,n().K8)((()=>t.getAppConfigUri()),[t]),P=!T||(0,o(80659).$)(T);return(0,S.jsx)(o(89924).A,{topBorder:g,style:h,children:(0,S.jsx)("div",{style:{marginTop:g?5:void 0},children:(0,S.jsx)(o(755735).B,{initialValue:j||"",placeholder:x.formatMessage("form_editor"===C?y.formNamePlaceholderMessage:y.viewNamePlaceholderMessage),onBlur:e=>f(e,v,x,r),onSubmit:e=>f(e,v,x,r),focusInitial:c,selectAll:c,disabled:!k||!P,iconButton:{icon:e=>(0,S.jsx)(o(745266).h,{color:"gray",viewIcon:_,viewType:C}),iconStyle:{fill:o(278238).l8[b].gray},enforceIconColor:"gray",onSubmit:e=>function(e,t,o){const n=t.collectionViewStore(),r=t.collectionViewBlockStore();if(!r||!n||!n.isDefined())return;const l=(0,m().s)(r.id);d().createAndCommit({userAction:"CollectionSettingsViewMain.handleViewIconSubmit",environment:e,canUndo:!0,perform:e=>{if(l){const t=o||i().A.images.appPackages.taskDbIconSvg;(0,p().o)({collectionViewStore:n,icon:t,transaction:e}),a().zA({stores:[r],update:{page_icon:t},transaction:e})}else(0,p().o)({collectionViewStore:n,icon:o,transaction:e})}}),(0,s().X)({environment:e,collectionContextStore:t,action:"change_icon",icon:o})}(v,r,e)},inputRightButton:M||"form_editor"===C||"myMeetings"===w?null:(0,S.jsx)(o(539148).S,{description:A,showTooltip:!I,onClick:()=>u.setState(!I),addDescriptionText:x.formatMessage(y.addDescriptionTooltip),editDescriptionText:x.formatMessage(y.editDescriptionTooltip),disabled:!k})})})})}},401634:(e,t,o)=>{o.d(t,{i:()=>h});o(296540);var n=()=>o(484714),i=()=>o(401497),r=()=>o(252291),l=()=>o(998531),s=()=>o(526278),a=()=>o(69708),c=()=>o(534177),d=()=>o(404277),u=()=>o(45552),p=()=>o(107683),g=()=>o(38337),m=()=>o(722872),S=o(474848);const y=(0,a().YK)({createTitle:{id:"automations.builderModal.createTitle",defaultMessage:"Create automation"},updateTitle:{id:"automations.builderModal.updateTitle",defaultMessage:"Edit automation"},saveButton:{id:"automations.builderModal.saveButton",defaultMessage:"Save"}}),f=88;function h(e){const{children:t,handleOnDismiss:o,canSave:h,handleOnSave:v,mode:x}=e,b=(0,a().tz)(),{isMobile:C}=(0,n().Y0)(),w=(0,i().IS)((()=>({container:{padding:C?0:"12px 16px",display:"flex",flexDirection:"column",overflow:"hidden",...C?{}:{flexGrow:1}}})),[C]);if(C){let e;return"create"===x?e=b.formatMessage(y.createTitle):"update"===x||"button_property"===x?e=b.formatMessage(y.updateTitle):"loading"===x?e=null:(0,c().HB)(x),(0,S.jsx)(d().A,{menuType:m().gu.Modal,whiteBackground:!0,title:e,left:(0,S.jsx)(r().I,{icon:s().w,colorVariant:"secondary"}),onClickLeft:o,rightDisabled:!h,right:"button_property"===x?(0,S.jsx)(u().DoneMenuText,{}):(0,S.jsx)(a().sA,{...y.saveButton}),onClickRight:v,children:(0,S.jsx)("div",{style:w.container,className:g().sux,children:t})})}return(0,S.jsx)(p().s,{anchor:"top",minimumOutsideSpacing:{type:"axes",vertical:f},areaConstraint:{width:{type:"fixed",length:500},height:{type:"min",length:600,scroll:"disallow"}},allowDismissByEscape:!1,isOpen:!0,render:()=>(0,S.jsxs)("div",{style:w.container,className:g().sux,children:[t,(0,S.jsx)(l().N,{debugName:"AutomationBuilderModal",capture:!0,onEsc:e=>{o()}})]})})}},409198:(e,t,o)=>{o.r(t),o.d(t,{ChartSettingsMain:()=>j().X,CollectionEditButtonAutomationOption:()=>q,CollectionSettings:()=>n()._,CollectionSettingsButtonOptions:()=>C,CollectionSettingsPropertyTypeMenuItem:()=>$});var n=()=>o(434267),i=o(296540),r=()=>o(56366),l=()=>o(912720),s=()=>o(69708),a=()=>o(384944),c=()=>o(813297),d=()=>o(390518),u=()=>o(546461),p=()=>o(911724),g=()=>o(840094),m=()=>o(845715),S=()=>o(633904),y=()=>o(419357),f=()=>o(89924),h=()=>o(972435),v=()=>o(735695),x=o(474848);const b=(0,s().YK)({inputPlaceholder:{defaultMessage:"Type a name for this button...",id:"database.buttonProperty.label.inputPlaceholder"}});function C(e){const{collectionContextStore:t,propertySchema:o}=e,n=(0,r().K8)((()=>t.collectionStore()),[t]),s=(0,r().K8)((()=>null==n?void 0:n.getSpaceId()),[n]),a=(0,i.useMemo)((()=>{const e=o.automation_id;if(e&&s)return{id:e,spaceId:s,table:l().yB}}),[o.automation_id,s]);return(0,m().K)(n,a)?(0,x.jsx)(w,{...e}):(0,x.jsx)(d().A,{})}function w(e){const{collectionContextStore:t,propertySchema:o,property:n}=e,[l,d]=(0,i.useState)([]),m=(0,r().K8)((()=>t.permissionScopesStore.state.canConfigureCollection),[t.permissionScopesStore]),C=(0,r().K8)((()=>t.collectionStore()),[t]),w=(0,r().K8)((()=>null==C?void 0:C.getSpaceId()),[C]),{maybePersistedAutomationStore:j,maybePersistedTransactionActions:A}=(0,S().t)({automationId:o.automation_id,spaceId:w,defaultValue:void 0,persist:!0}),_=(0,r().K8)((()=>null==j?void 0:j.getTrigger()),[j]),I=(0,g().Qj)({automationStore:j,property:n,propertySchema:o,collectionContextStore:t}),k=(0,r().K8)((()=>{var e;return"sufficient"===(null==I||null===(e=I.state)||void 0===e?void 0:e.executionPermissionStatus)}),[I]),M=(0,r().K8)((()=>(null==j?void 0:j.getNameStore().getValue())??""),[j]),T=(0,i.useCallback)((e=>{if(!j)return;const t=e.currentTarget.value;A.createAndCommit({userAction:"CollectionSettingsButtonOptions.setName",perform:e=>{a().KY({store:j.getNameStore(),transaction:e,value:t})}})}),[j,A]),P=(0,i.useCallback)((e=>{d((t=>[...t,e.id]))}),[]);return C&&j&&_&&"button"===_.type?(0,x.jsx)(u().u,{automationStore:j,contextType:"button_property",children:(0,x.jsxs)(p().v,{value:{collectionStore:C,disabled:!k,editorPlacement:{type:"inline"},editorWidth:v().vE,maybePersistedTransactionActions:A,onActionAdded:P,suppressActionErrors:l,hideDragHandle:!1},children:[(0,x.jsx)(f().A,{topBorder:!0,title:(0,x.jsx)(s().sA,{id:"database.buttonProperty.label",defaultMessage:"Label"}),children:(0,x.jsx)(y().Ay,{disabled:!m,placeholder:h().A.formatMessage(b.inputPlaceholder),value:M,onChange:T})}),(0,x.jsx)(f().A,{style:{paddingInline:12},children:(0,x.jsx)(c().U3,{areActionsEditable:!0,areTriggersEditable:!1})})]})}):null}var j=()=>o(720088),A=()=>o(484714),_=()=>o(401497),I=()=>o(252291),k=()=>o(898244),M=()=>o(713998),T=()=>o(3284),P=()=>o(338862),B=()=>o(284371),F=()=>o(901952),V=()=>o(362441),D=()=>o(36629),E=()=>o(181922),R=()=>o(231297),O=()=>o(895876),K=()=>o(187820),N=()=>o(16006),L=()=>o(132389),z=()=>o(859428),U=()=>o(852353),W=()=>o(147503),H=()=>o(527438),G=()=>o(497222);function $(e){const{collectionContextStore:t,collectionUri:o,disabled:n,formatKey:l,isTypedProperty:a,property:c,propertyTypeButtonPopupStore:d}=e,u=(0,A().v3)(),p=(0,r().K8)((()=>t.collectionViewBlockStore()),[t]),g=(0,r().K8)((()=>(0,H().Jq)({property:c,collectionContextStore:t})),[t,c]),m=(0,r().K8)((()=>(0,H().k7)(p,g)),[p,g]),S=(0,r().K8)((()=>null==m?void 0:m.getIcon()),[m]),y=t.settingsStore,f=(0,i.useCallback)((e=>{const o=t.collectionStore();o&&((0,F().V)({environment:u,collectionContextStore:t,property:c,new_property_type:(0,k().v2)(e),from:"view_settings",action:"change_type"}),"relation"===e?W().a2({collectionSettingsStore:y,item:{type:"selectRelationSource",property:c,formatKey:l}}):(R().createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyTypeAccept",environment:u,canUndo:!0,perform:t=>{(0,V().H)({environment:u,collectionStore:o,property:c,type:e,transaction:t})}}),W().yl({collectionSettingsStore:y}),(0,k().hN)(e)&&D().pG({propertyType:e,propertyId:c,collectionContextStore:t}),d.reset()))}),[t,y,u,l,c,d]),h=(0,i.useCallback)((e=>{const{propertyType:o}=e;E().g({environment:u,collectionContextStore:t,propertyId:c,propertySchema:g,handlePropertyTypeChange:()=>f(o)})}),[u,c,g,f,t]),v=(0,i.useCallback)((()=>{if(!g)return;t.collectionStore()&&W().a2({collectionSettingsStore:y,item:{type:"propertyType",propertySchema:g,onAccept:h}})}),[t,y,h,g]),b=(0,M().H6)(g)||(0,M().KF)(g),C=(0,_().IS)((e=>({container:{color:n?e.darkTextColor:void 0,display:"flex",alignItems:"center"},title:{display:"inline",wordBreak:"break-word",...B().RC},typeText:{color:n?e.darkTextColor:void 0}})),[n]),w=(0,i.useCallback)((e=>g?a&&o?(0,x.jsx)(s().sA,{...e,defaultMessage:"{type} type is required for this property in {databaseType}.",id:"database.viewSettings.propertyTab.restrictedProperty",description:"A tooltip to educate the users on why they can't change the type of this property.",values:{type:U().dC[g.type],databaseType:(0,O()._V)(o)}}):(0,x.jsx)(s().sA,{...e,defaultMessage:"This property’s type cannot be changed.",id:"database.viewSettings.propertyTab.untypedRestrictedProperty",description:"A tooltip to educate the users on why they can't change the type of this property."}):null),[o,a,g]);return g?(0,x.jsx)(z().A,{placement:"left",disableTooltip:!n,renderTooltip:w,render:e=>(0,x.jsx)(G().A,{...e,disabled:n,rotateChevron:d.state.open,icon:T().arrowSquarePathUpDownIcon,title:(0,x.jsx)(s().sA,{defaultMessage:"Type",id:"database.viewSettings.propertyTab.propertyType"}),showChevron:!0,right:(0,x.jsxs)(x.Fragment,{children:[n?(0,x.jsx)("div",{...e,children:(0,x.jsx)(I().I,{icon:P().N,size:"sm",colorVariant:"secondary"})}):void 0,(0,x.jsx)(L().A,{size:4}),b?(0,x.jsxs)("div",{style:C.container,children:[(0,x.jsx)(K().B6,{icon:S,iconRecordCategory:"collection",isEmptyPage:!1,size:20,disabled:!0}),(0,x.jsx)(N().A,{store:m,style:C.title})]}):(0,x.jsx)("span",{style:C.typeText,children:U().dC[g.type]})]}),onClick:v})}):null}var Q=()=>o(105819),Y=()=>o(837570);function q(e){const{menuListProps:t,collectionSettingsStore:o,collectionContextStore:n,property:i,source:l}=e,a=(0,A().v3)(),c=(0,r().K8)((()=>(0,H().Jq)({collectionContextStore:n,property:i})),[n,i]);return(0,x.jsx)(G().A,{title:(0,x.jsx)("div",{style:{display:"flex",justifyContent:"space-between"},children:(0,x.jsx)(s().sA,{id:"database.collectionsettings.button.editAutomationLabel",defaultMessage:"Edit automation"})}),disabled:!1,source:l,showChevron:!0,icon:Q().pencilLineIcon,...t,onClick:()=>{c&&"button"===c.type&&Y().h({environment:a,mode:"edit_button_property",collectionSettingsStore:o,collectionContextStore:n,property:i,propertySchema:c})}})}},434267:(e,t,o)=>{o.d(t,{_:()=>yS});var n=o(296540),i=()=>o(402014),r=()=>o(484714),l=()=>o(121924),s=()=>o(56366),a=()=>o(611648),c=()=>o(998531),d=()=>o(498212),u=()=>o(314529),p=()=>o(242422);function g(e,t){(0,u().DO_NOT_USE_trackLegacy)(e,"view_settings",t),p().default.logEvent("view_settings",t.menu,t)}var m=()=>o(896628),S=()=>o(231297),y=()=>o(546754),f=(o(898992),o(354520),o(672577),o(581454),()=>o(564884)),h=()=>o(726637),v=()=>o(401497),x=()=>o(69708),b=()=>o(534177),C=()=>o(735695),w=()=>o(439264),j=()=>o(44935),A=()=>o(89924),_=()=>o(370493),I=()=>o(59226),k=()=>o(406094),M=()=>o(160432),T=()=>o(493552),P=()=>o(785285),B=()=>o(863330),F=()=>o(340498),V=()=>o(992437),D=()=>o(147503),E=()=>o(380468),R=()=>o(406699),O=()=>o(404277),K=()=>o(722872);function N(e){var t,o,n,i;const{conditionalColorRule:r,collectionContextStore:l,transaction:s,newColorRule:a,environment:c}=e,d=l.collectionViewStore(),u=l.normalizedFormatStore.state.conditional_color_rules;if(!d||!u)return;const p=[...u],g=p.findIndex((e=>e.id===r.id));-1!==g&&(p[g]={...p[g],...a},m().zA({stores:[d],update:{conditional_color_rules:p},transaction:s}),(0,f().u)({environment:c,event:{eventName:"conditional_color_rule_updated",eventProperties:{...(0,_().JO)({collectionContextStore:l,conditionalColorRule:r}),new_filter_operator:null===(t=a.conditional_filter)||void 0===t||null===(t=t.filter)||void 0===t?void 0:t.operator,new_background_type:null===(o=a.background)||void 0===o?void 0:o.type,new_background_color:"custom"===(null===(n=a.background)||void 0===n?void 0:n.type)?null===(i=a.background)||void 0===i?void 0:i.color:void 0}}}))}var L=o(474848);function z({collectionContextStore:e,collectionSettingsStore:t}){const o=(0,s().O$)(e.normalizedSchemaStore),i=(0,s().O$)(e.normalizedFormatStore),l=(0,r().v3)(),a=(0,s().K8)((()=>!i.conditional_color_rules||0===i.conditional_color_rules.length),[i]),c=(0,I().X)("collection_view_conditional_colors_m2"),d=(0,s().K8)((()=>e.collectionViewStore()?(0,P().Mz)({schema:o,isConditionalColorM2Enabled:c}):[]),[e,o,c]),u=(0,n.useCallback)((n=>{var i,r;if(!n)return;const s=(null===(i=e.collectionViewBlockStore())||void 0===i?void 0:i.getRecordModel)??V().b.constant(void 0),c=(0,_().bP)({propertyId:n,schema:o,getRecordModel:s,spaceIdCreator:l.idCreator.getSpaceIdCreatorSync((null===(r=e.collectionStore())||void 0===r?void 0:r.getSpaceId())??"")});c&&(a&&function(e){D().dP({collectionSettingsStore:e,item:{type:"conditionalColors"}})}(t),S().createAndCommit({userAction:"AddConditionalColorRuleButton.handlePropertyAccept",environment:l,canUndo:!0,perform:t=>{!function(e){const{collectionContextStore:t,conditionalColorRule:o,transaction:n,environment:i}=e,r=t.collectionViewStore();if(!r)return;const l=[...t.normalizedFormatStore.state.conditional_color_rules??[],o];m().zA({stores:[r],update:{conditional_color_rules:l},transaction:n}),(0,f().u)({environment:i,event:{eventName:"conditional_color_rule_created",eventProperties:(0,_().JO)({collectionContextStore:t,conditionalColorRule:o})}})}({collectionContextStore:e,conditionalColorRule:c,transaction:t,environment:l})}}))}),[e,t,l,a,o]),p=(0,v().IS)((e=>({button:{width:"100%",justifyContent:"center",padding:"6px 12px",...!a&&{borderColor:e.border.secondary},...h().A.isMobile&&{height:"48px",borderRadius:12},...h().A.isMobile&&!a&&{backgroundColor:e.background.primary,border:"none"}}})),[a]),g=a?(0,L.jsx)(x().sA,{defaultMessage:"New color setting",id:"database.viewSettings.createConditionalColorTab.newColorSetting"}):(0,L.jsx)(x().sA,{defaultMessage:"Add another",id:"database.viewSettings.conditionalColorsTab.addAnother"}),y=(0,n.useCallback)((e=>(0,L.jsx)(E().A,{schema:o,format:i,getProperties:()=>d,onAccept:t=>{u(t),e.close()}})),[o,i,d,u]);return(0,L.jsx)(R().A,{popupType:h().A.isMobile?R().z.BottomSheet:R().z.Popup,bottomSheetInitialState:"half",sameWidthAsOrigin:!0,originGap:4,renderOrigin:e=>{const t={...e,iconLeading:h().A.isMobile&&a?void 0:{icon:B().plusSmallIcon,size:h().A.isMobile?F().lD.default:F().Ev.sm},style:p.button};return a?(0,L.jsx)(M().A,{...t,colorPalette:"blue",children:(0,L.jsx)(T().D,{styleKey:(0,_().jc)(a),colorVariant:"inversePrimary",children:g})}):(0,L.jsx)(k().A,{...t,children:(0,L.jsx)(T().D,{styleKey:(0,_().jc)(a),colorVariant:"primary",children:g})})},render:e=>h().A.isMobile?(0,L.jsx)(O().A,{menuType:K().gu.Modal,title:(0,L.jsx)(x().sA,{defaultMessage:"Select property",id:"createConditionalColorTab.addConditionalColorRule.selectProperty"}),children:y(e)}):(0,L.jsx)(O().A,{menuType:K().gu.Popup,children:y(e)})})}var U=()=>o(395361),W=()=>o(252291),H=()=>o(656214),G=()=>o(236262),$=()=>o(360843),Q=()=>o(760217),Y=()=>o(554283),q=()=>o(854705),J=()=>o(463830);function X({conditionalColorRule:e,handleChangeForApplyTo:t}){const o=(0,s().uB)(void 0,J().A),n=e.properties_to_color.type;return(0,L.jsx)(R().A,{popupType:R().z.Popup,buttonPopupStore:o,bottomSheetInitialState:"half",renderOrigin:e=>(0,L.jsx)(ee,{...e,applyTo:n,buttonPopupStore:o}),render:e=>(0,L.jsx)(te,{applyTo:n,handleChangeForApplyTo:t,parent:e})})}function Z({applyTo:e}){return"all"===e?(0,L.jsx)(x().sA,{defaultMessage:"Entire row",id:"CollectionSettingsViewConditionalColorRule.ApplyToMenu.applyToAll"}):(0,L.jsx)(x().sA,{defaultMessage:"This property",id:"CollectionSettingsViewConditionalColorRule.ApplyToMenu.applyToProperty"})}function ee({applyTo:e,buttonPopupStore:t,...o}){const n=(0,s().K8)((()=>t.state.open),[t]),i=(0,v().IS)((e=>({applyToMenuButton:{display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",gap:4,height:24,marginInlineStart:"auto"},chevronIcon:{width:16,height:16,fill:e.icon.tertiary,transform:n?void 0:"rotate(-90deg)",transition:"transform 0.2s ease"}})),[n]);return(0,L.jsxs)("div",{...o,style:i.applyToMenuButton,children:[(0,L.jsx)(T().D,{styleKey:"Body/Regular",colorVariant:"secondary",children:(0,L.jsx)(Z,{applyTo:e})}),(0,q().arrowChevronSingleDownFillSmallIcon)(i.chevronIcon)]})}function te({applyTo:e,handleChangeForApplyTo:t,parent:o}){return(0,L.jsx)(A().A,{children:["all","filtered_property_only"].map((n=>(0,L.jsx)(Q().A,{title:(0,L.jsx)(Z,{applyTo:n}),isChecked:e===n,onClick:()=>t(n,o),focused:!1},n)))})}o(944114);var oe=()=>o(898244),ne=()=>o(906380),ie=()=>o(933152),re=()=>o(100622),le=()=>o(491073),se=()=>o(802790),ae=()=>o(678553),ce=()=>o(939740),de=()=>o(581369),ue=()=>o(27178);function pe({conditionalColorRule:e,onColorChange:t,propertySchema:o}){const n=(0,s().uB)(void 0,J().A),i=e.background,r="match_property_value"===(null==i?void 0:i.type),l="custom"===(null==i?void 0:i.type)?i.color:"default_background",a=!!o&&oe().Ou(o);return(0,L.jsx)(R().A,{popupType:h().A.isMobile?R().z.BottomSheet:R().z.Popup,buttonPopupStore:n,bottomSheetInitialState:"half",renderOrigin:e=>h().A.isMobile?(0,L.jsx)(Se,{...e,isMultiSelectProperty:a,isMatchPropertyValue:r,backgroundCustomColor:l}):(0,L.jsx)(me,{...e,isMultiSelectProperty:a,isMatchPropertyValue:r,backgroundCustomColor:l,buttonPopupStore:n}),render:n=>h().A.isMobile?(0,L.jsx)(fe,{isMultiSelectProperty:a,conditionalColorRule:e,propertySchema:o,onColorChange:e=>{t(e,n)},backgroundCustomColor:l,isMatchPropertyValue:r}):(0,L.jsx)(ye,{isMultiSelectProperty:a,conditionalColorRule:e,propertySchema:o,onColorChange:e=>{t(e,n)},backgroundCustomColor:l,isMatchPropertyValue:r})})}function ge({isMultiSelectProperty:e}){return e?(0,L.jsx)(x().sA,{defaultMessage:"Match first option",id:"CollectionSettingsViewConditionalColorRule.matchFirstOption"}):(0,L.jsx)(x().sA,{defaultMessage:"Match option",id:"CollectionSettingsViewConditionalColorRule.matchOption"})}function me({isMultiSelectProperty:e,isMatchPropertyValue:t,backgroundCustomColor:o,buttonPopupStore:n,...i}){const r=(0,s().K8)((()=>n.state.open),[n]),l=(0,v().IS)((e=>({colorMenuButton:{display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",gap:4,height:24,marginInlineStart:"auto"},colorDisplayContainer:{display:"flex",alignItems:"center",gap:8},chevronIcon:{width:16,height:16,fill:e.icon.tertiary,transform:r?void 0:"rotate(-90deg)",transition:"transform 0.2s ease"}})),[r]);return(0,L.jsxs)("div",{...i,style:l.colorMenuButton,children:[t?(0,L.jsx)(T().D,{styleKey:"Body/Regular",colorVariant:"secondary",children:(0,L.jsx)(ge,{isMultiSelectProperty:e})}):(0,L.jsxs)("div",{style:l.colorDisplayContainer,children:[(0,L.jsx)(le().Kc,{color:o,isHovered:!1,selected:!1,overrideStyles:{width:16,height:16,borderRadius:4}}),(0,L.jsx)(T().D,{styleKey:"Body/Regular",colorVariant:"secondary",children:(0,ue().ZN)(o)})]}),(0,q().arrowChevronSingleDownFillSmallIcon)(l.chevronIcon)]})}function Se({isMultiSelectProperty:e,isMatchPropertyValue:t,backgroundCustomColor:o,...n}){return(0,L.jsx)(Q().A,{...n,focused:!1,icon:t?(0,L.jsx)(W().I,{icon:ie().M}):(0,L.jsx)(le().Kc,{color:o,isHovered:!1,selected:!1,overrideStyles:{width:22,height:22,borderRadius:6,margin:0}}),title:t?(0,L.jsx)(ge,{isMultiSelectProperty:e}):(0,L.jsx)(x().sA,{...(0,ue().qo)(o)}),right:(0,L.jsx)(W().I,{icon:ne().arrowChevronSingleRightSmallIcon,size:"sm",colorVariant:"secondary"})})}function ye({isMultiSelectProperty:e,conditionalColorRule:t,onColorChange:o,propertySchema:n,backgroundCustomColor:i,isMatchPropertyValue:r}){const l=(0,v().IS)((()=>({container:{padding:4},matchOptionContainer:{display:"flex",alignItems:"center",alignSelf:"stretch",gap:8,padding:"4px 8px"},matchOptionToggle:{marginInlineStart:"auto"},colorGrid:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",columnGap:4,rowGap:8,padding:"8px"},divider:{padding:"4px 8px"}})),[]);return(0,L.jsxs)("div",{style:l.container,children:[(0,_().$Y)(n,t.conditional_filter.filter)?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{style:l.matchOptionContainer,children:[(0,L.jsx)(T().D,{styleKey:"Body/Regular",colorVariant:"primary",children:(0,L.jsx)(ge,{isMultiSelectProperty:e})}),(0,L.jsx)("div",{style:l.matchOptionToggle,children:(0,L.jsx)(de().A,{on:r,onClick:()=>{o(r?"default_background":"match_property_value")}})})]}),(0,L.jsx)(se().A,{size:1,colorVariant:"secondary",type:"horizontal",style:l.divider})]}):null,(0,L.jsx)("div",{style:l.colorGrid,children:re().AQ.map((e=>{const t=e===i&&!r;return(0,L.jsx)(le().Ay,{color:e,style:{width:"100%"},iconStyle:{opacity:r?.4:1},onClick:()=>{o(e)},focused:t,selected:t,shouldShowUpdatedColorPicker:!0},e)}))})]})}function fe({isMultiSelectProperty:e,conditionalColorRule:t,onColorChange:o,propertySchema:n,backgroundCustomColor:i,isMatchPropertyValue:r}){const l=[];return(0,_().$Y)(n,t.conditional_filter.filter)&&l.push({key:"match-option",render:e=>(0,L.jsx)(A().A,{...e}),items:[{key:"match-property-toggle",render:t=>(0,L.jsx)(ae().Ay,{...t,icon:(0,L.jsx)(W().I,{icon:ie().M,size:"lg"}),title:(0,L.jsx)(ge,{isMultiSelectProperty:e}),right:(0,L.jsx)(de().A,{on:r})}),action:()=>{o(r?"default_background":"match_property_value")}}]}),l.push({key:"background-colors",render:e=>(0,L.jsx)(A().A,{...e,children:e.children}),items:re().AQ.map((e=>({key:e,action:()=>{o(e)},render:t=>{const o=e===i&&!r;return(0,L.jsx)(le().Ay,{...t,color:e,selected:o,focused:o,shouldShowUpdatedColorPicker:!1,iconStyle:{opacity:r?.4:1,width:22,height:22}})}})))}),(0,L.jsx)(O().A,{menuType:K().gu.Modal,title:(0,L.jsx)(x().sA,{defaultMessage:"Select color",id:"ConditionalColorRuleColorMenu.selectColorTitle"}),children:(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,initialFocus:0,sections:l})})}var he=()=>o(631524),ve=()=>o(335452),xe=()=>o(478367),be=()=>o(214388),Ce=()=>o(249947),we=()=>o(856952),je=()=>o(713998),Ae=()=>o(784892),_e=()=>o(704452),Ie=()=>o(308631),ke=()=>o(132389),Me=()=>o(990736),Te=()=>o(399762);function Pe({propertyFilter:e,schema:t,parentStore:o,onDelete:i,onChange:r,onChangeDebounced:l}){const s=t[e.property],a=(0,x().tz)(),c=(0,v().IS)((e=>({container:{display:"flex",flexDirection:"column",gap:1,width:"100%",padding:4},chevron:{fill:e.icon.tertiary,width:16,height:16},plainButton:{height:"100%",paddingInlineStart:4,paddingInlineEnd:4,transition:"none",paddingBottom:4},plainButtonHovered:{background:"none"},plainButtonPressed:{background:"none"},tokenWrap:{paddingTop:2},tokenRight:{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20},tokenInput:{pointerEvents:"none",minHeight:30}})),[]),d=(0,n.useMemo)((()=>{if(!(0,b().O9)(s))return!1;const t=e.filter;return((0,be().v0)(t)||(0,be().as)(t)||(0,be().H$)(t)||(0,ve().n)(t)||(0,xe().I)(t)||(0,be().Ui)(t)||(0,be().Pq)(t))&&(0,be().gc)(t)}),[e.filter,s]),u=(0,n.useCallback)((n=>{const i=function({propertyFilter:e,schema:t,parentStore:o,relatedCollectionAppConfigUri:n}){const{filter:i}=e,r=t[e.property];if(!(0,b().O9)(r)||!(0,be().gc)(i)||(0,be().t_)(e))return[];if((0,be().v0)(i)||(0,be().as)(i)){if("select"!==r.type&&"multi_select"!==r.type)return[];const e=((0,be().v0)(i)?(0,be().Zl)(i):(0,be().SM)(i)).map((({value:e})=>{var t;return null===(t=r.options)||void 0===t?void 0:t.find((t=>t.value===e))})).filter(b().O9);return e.map((t=>(0,L.jsx)(Te().O,{value:t.value,color:t.color,format:Ae().NY.Small,showRemoveButton:!1,isSingle:1===e.length,hideTooltip:!1,description:t.description},t.id)))}if((0,be().H$)(i)){if("status"!==r.type)return[];const e=(0,be().V6)(i),t=r.options??[],o=r.groups??[];return e.map((({value:n,type:i})=>{if(n&&i){if("is_group"===i){const t=o.find((e=>e.name===n));return t?(0,L.jsx)("div",{style:{margin:1===e.length?0:"0 6px 6px 0",height:"20px",lineHeight:"20px"},children:(0,L.jsx)(Ie().RS,{group:t,showIcon:!0,showColor:!0})},t.id):void 0}if("is_option"===i){const i=(0,je().jy)(t,n);if(!i)return;const r=o.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(i.id)}));return(0,L.jsx)(Te().q,{format:Ae().NY.Medium,isSingle:1===e.length,value:i.value,color:i.color,showRemoveButton:!1,groupColor:null==r?void 0:r.color},i.id)}(0,b().HB)(i)}})).filter(b().O9)}if((0,be().Pq)(i)){if("relation"!==r.type)return[];const e=(0,be().Rh)(i);return e.map(((t,i)=>{if(!t.value)return null;const r={format:h().A.isMobile?Ae().NY.Large:Ae().NY.Small,shouldWrap:!1,showRemoveButton:!1,isSingle:1===e.length,shouldShrink:!0};return(0,L.jsx)(Me().g,{value:t,tokenProps:r,parentStore:o,relatedCollectionAppConfigUri:n},i)}))}const l=(0,L.jsx)(_e().C3,{propertyFilter:e,schema:t,parentStore:o,relatedCollectionAppConfigUri:n}),s=(0,be().Cw)(i)?(0,L.jsx)(_e().tl,{propertyFilter:e}):null;return[s,s?(0,L.jsx)(ke().A,{size:4},"spacer"):void 0,l]}({propertyFilter:e,schema:t,parentStore:o});return(0,L.jsx)(he().p,{onClick:()=>n.onClick(),style:c.plainButton,hoveredStyle:c.plainButtonHovered,pressedStyle:c.plainButtonPressed,children:(0,L.jsx)(we().Ay,{format:we().le.FilterValue,tokens:i,placeholder:a.formatMessage({id:"collectionConditionalColor.filterDropdown.placeholder",defaultMessage:"Select..."}),onChange:()=>{},value:"",onRemoveLastToken:()=>{},hideInput:i.length>0,showBorder:!0,tokenWrapStyle:c.tokenWrap,style:c.tokenInput,right:(0,q().arrowChevronSingleDownFillSmallIcon)(c.chevron),rightWrapStyle:c.tokenRight})})}),[c,e,t,o,a]),p=(0,n.useCallback)((n=>(0,L.jsx)(Ce().td,{propertyFilter:e,schema:t,parentStore:o,userCanConfigureFilters:!0,allowRelativeDateFilter:!0,allowRelativePersonFilter:!0,context:Ce().mL.ConditionalColorRule,hideTopActions:!0,onChange:r,onChangeDebounced:l,onClose:n.close})),[e,t,o,r,l]);return d?(0,L.jsxs)("div",{style:c.container,children:[(0,L.jsx)(Ce().Ti,{propertyFilter:e,onChange:r,schema:t,parentStore:o,userCanConfigureFilters:!0,onDelete:i,context:Ce().mL.ConditionalColorRule}),(0,L.jsx)(A().A,{children:(0,L.jsx)(R().A,{popupType:R().z.Popup,placementToOrigin:"bottom",sameWidthAsOrigin:!0,originGap:4,borderRadius:8,disabled:!1,renderOrigin:u,render:p})})]}):(0,L.jsx)(Ce().td,{propertyFilter:e,schema:t,parentStore:o,userCanConfigureFilters:!0,allowRelativeDateFilter:!0,allowRelativePersonFilter:!0,context:Ce().mL.ConditionalColorRule,onDelete:i,onChange:r,onChangeDebounced:l})}function Be(e){const{collectionContextStore:t,conditionalColorRule:o}=e,[i,l]=(0,Y().B)(),[a,c]=(0,Y().B)(),d=(0,s().O$)(t.normalizedSchemaStore),u=(0,s().K8)((()=>t.collectionViewStore()),[t]),p=(0,r().v3)(),g=(0,s().K8)((()=>t.getViewType()),[t]),y=(0,I().X)("collection_view_conditional_colors_property_level"),b=(0,n.useCallback)((()=>{S().createAndCommit({userAction:"CollectionSettingsViewConditionalColorRule.handleDeleteConditionalColorRule",environment:p,canUndo:!0,perform:e=>{!function(e){const{conditionalColorRule:t,collectionContextStore:o,transaction:n,environment:i}=e,r=o.collectionViewStore(),l=o.normalizedFormatStore.state.conditional_color_rules;if(!r||!l)return;const s=l.filter((e=>e.id!==t.id));m().zA({stores:[r],update:{conditional_color_rules:s},transaction:n}),(0,f().u)({environment:i,event:{eventName:"conditional_color_rule_deleted",eventProperties:(0,_().JO)({collectionContextStore:o,conditionalColorRule:t})}})}({collectionContextStore:t,conditionalColorRule:o,transaction:e,environment:p})}})}),[t,p,o]),C=(0,n.useCallback)((e=>{var n;const i={conditional_filter:{property:o.conditional_filter.property,filter:e}},r="match_property_value"===(null===(n=o.background)||void 0===n?void 0:n.type),l="is_empty"===e.operator;r&&l&&(i.background={type:"custom",color:"default_background"}),S().createAndCommit({userAction:"CollectionSettingsViewConditionalColorRule.handleFilterValueChange",environment:p,canUndo:!0,perform:e=>{N({collectionContextStore:t,conditionalColorRule:o,transaction:e,newColorRule:i,environment:p})}})}),[t,p,o]),w=(0,U().Y)(C,250),j=(0,n.useCallback)(((e,n)=>{n.close();const i={background:"match_property_value"===e?{type:"match_property_value"}:{type:"custom",color:e}};S().createAndCommit({userAction:"CollectionSettingsViewConditionalColorRule.handleColorChange",environment:p,canUndo:!0,perform:e=>{N({collectionContextStore:t,conditionalColorRule:o,transaction:e,newColorRule:i,environment:p})}})}),[t,p,o]),A=(0,n.useCallback)(((e,n)=>{n.close();const i={properties_to_color:{type:e}};S().createAndCommit({userAction:"CollectionSettingsViewConditionalColorRule.handleColorChange",environment:p,canUndo:!0,perform:e=>{N({collectionContextStore:t,conditionalColorRule:o,transaction:e,newColorRule:i,environment:p})}})}),[t,p,o]),k="board"===g||"gallery"===g?(0,L.jsx)(x().sA,{defaultMessage:"Card background",id:"CollectionSettingsViewConditionalColorRule.cardBackground"}):(0,L.jsx)(x().sA,{defaultMessage:"Page background",id:"CollectionSettingsViewConditionalColorRule.pageBackground"}),M=(0,v().IS)((e=>({container:{background:e.background.secondary,display:"flex",flexDirection:"column",alignItems:"stretch",borderRadius:10,border:`1px solid ${e.background.secondary}`,width:"100%",position:"relative"},row:{display:"flex",alignItems:"center",paddingTop:0,paddingInlineEnd:12,paddingBottom:8,paddingInlineStart:12},dragHandle:{position:"absolute",insetInlineStart:-11,top:4,justifyContent:"center",alignItems:"center",padding:2,opacity:l?1:0,transition:"opacity 0.2s ease",zIndex:1,background:e.background.secondary,borderRadius:6,cursor:"grab"},dragHandleIconContainer:{display:"flex",width:12,padding:4,justifyContent:"center",alignItems:"center",borderRadius:4,background:c?e.background.tertiary:void 0},dragHandleIcon:{fill:e.icon.secondary}})),[l,c]);return d&&u?h().A.isMobile?(0,L.jsx)(Fe,{conditionalColorRule:o,schema:d,collectionContextStore:t,collectionViewStore:u,viewType:g,onColorChange:j,onFilterChange:C,onDelete:b}):(0,L.jsxs)("div",{style:M.container,ref:i,children:[(0,L.jsx)("div",{style:M.dragHandle,ref:a,children:(0,L.jsx)("div",{style:M.dragHandleIconContainer,children:(0,H().N)({width:14,height:14,fill:M.dragHandleIcon.fill})})}),(0,L.jsx)(Pe,{propertyFilter:o.conditional_filter,schema:d,parentStore:u,onDelete:b,onChange:C,onChangeDebounced:w}),(0,L.jsxs)("div",{style:M.row,children:[(0,L.jsx)(T().D,{styleKey:"Body/Regular",colorVariant:"primary",style:{flex:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:k}),(0,L.jsx)(pe,{conditionalColorRule:o,onColorChange:j,propertySchema:d[o.conditional_filter.property]})]}),"table"===g&&y?(0,L.jsxs)("div",{style:M.row,children:[(0,L.jsx)(T().D,{styleKey:"Body/Regular",colorVariant:"primary",children:(0,L.jsx)(x().sA,{defaultMessage:"Apply to",id:"CollectionSettingsViewConditionalColorRule.applyTo"})}),(0,L.jsx)(X,{conditionalColorRule:o,handleChangeForApplyTo:A})]}):void 0]}):null}function Fe(e){const{conditionalColorRule:t,schema:o,collectionContextStore:i,collectionViewStore:r,viewType:l,onFilterChange:a,onDelete:c,onColorChange:d}=e,{propertySchema:u,ruleIndex:p}=(0,s().K8)((()=>{const e=(i.normalizedFormatStore.state.conditional_color_rules||[]).findIndex((e=>e.id===t.id));return{propertySchema:null==o?void 0:o[t.conditional_filter.property],ruleIndex:e}}),[o,t,i]),g=(0,n.useCallback)(((e,t)=>{a(t.filter)}),[a]);return o&&l&&r&&u?(0,L.jsxs)(A().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"Color setting {index}",id:"database.conditionalColorMenu.ruleIndex",values:{index:p+1}}),mobileStyle:{marginBottom:8},children:[(0,L.jsx)($().A,{index:p,propertyFilter:t.conditional_filter,schema:o,filterOperator:null,parentStore:r,onChange:g,collectionContextStore:i,collectionViewType:l,collectionViewId:r.id,disablePropertyChange:!0},p),(0,L.jsx)(pe,{conditionalColorRule:t,onColorChange:d,propertySchema:u}),(0,L.jsx)(Q().A,{focused:!1,icon:(0,L.jsx)(W().I,{icon:G().trashIcon}),onClick:c,title:(0,L.jsx)(x().sA,{defaultMessage:"Delete color setting",id:"conditionalColorMenu.deleteColorSetting.title"}),isRedOnHover:!0})]}):null}function Ve(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,i=(0,r().v3)(),l=(0,s().K8)((()=>t.normalizedFormatStore.state.conditional_color_rules),[t.normalizedFormatStore]),a=(0,v().IS)((()=>({container:{padding:"12px 16px",display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",gap:12},draggableList:{display:"flex",flexDirection:"column",gap:12,width:"100%"}})),[]),c=(0,n.useCallback)((e=>{const o=t.collectionViewStore();o&&(S().createAndCommit({userAction:"CollectionSettingsViewConditionalColors.handleColorRuleDrop",environment:i,canUndo:!0,perform:t=>{m().zA({stores:[o],update:{conditional_color_rules:e.map((e=>null==l?void 0:l.find((t=>t.id===e)))).filter(b().O9)},transaction:t})}}),(0,f().u)({environment:i,event:{eventName:"conditional_color_rules_reordered",eventProperties:(0,_().JO)({collectionContextStore:t})}}))}),[i,t,l]);return(0,L.jsx)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Conditional color",id:"database.viewSettings.conditionalColorsTab.title"}),children:h().A.isMobile?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(j().i,{children:l&&l.length>0?l.map((e=>(0,L.jsx)(Be,{conditionalColorRule:e,collectionContextStore:t},e.id))):null}),(0,L.jsx)(A().A,{topBorder:!0,children:(0,L.jsx)(z,{collectionContextStore:t,collectionSettingsStore:o})})]}):(0,L.jsxs)("div",{style:a.container,children:[l&&l.length>0?(0,L.jsx)(w().Ay,{direction:"vertical",keys:l.map((e=>e.id)),style:a.draggableList,renderKey:(e,o)=>(0,L.jsx)(Be,{collectionContextStore:t,conditionalColorRule:l[o]},e),onDrop:c}):null,(0,L.jsx)(z,{collectionContextStore:t,collectionSettingsStore:o})]})})}function De(e){const{collectionSettingsStore:t,collectionContextStore:o}=e,n=(0,s().K8)((()=>o.getViewType()),[o]),i="dark"===(0,v().eP)(),r=(0,v().IS)((e=>({descriptionContainer:{margin:h().A.isMobile?"24px 0":"16px 0"},container:{display:"flex",flexDirection:"column",margin:"12px 16px"},previewImage:{maxWidth:"100%",height:"128px",borderRadius:10,...!h().A.isMobile&&{border:`1px solid ${e.border.secondary}`}}})),[]);return n?(0,L.jsx)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Conditional color",id:"database.viewSettings.createConditionalColorTab.title"}),children:(0,L.jsxs)("div",{style:r.container,children:[(0,L.jsx)("img",{src:(0,_().V_)({collectionViewType:n,isDarkMode:i}),style:r.previewImage,alt:"Conditional color preview image for the collection view type "}),(0,L.jsx)("div",{style:r.descriptionContainer,children:(0,L.jsx)(T().D,{styleKey:"Caption/Regular",colorVariant:"secondary",children:(0,L.jsx)(x().sA,{defaultMessage:"Customize page colors to easily distinguish categories, highlight overdue events, and bring clarity to your work.",id:"database.viewSettings.createConditionalColorTab.description"})})}),(0,L.jsx)(z,{collectionContextStore:o,collectionSettingsStore:t})]})}):null}var Ee=()=>o(623580),Re=()=>o(645873);const Oe=new(Re().O2)("database-automations",(()=>Promise.all([o.e(75134),o.e(9773),o.e(36556),o.e(40537),o.e(96346),o.e(62475),o.e(3151),o.e(98629),o.e(87249),o.e(71621),o.e(88924),o.e(92845),o.e(56369),o.e(5834),o.e(48486),o.e(2411),o.e(4422),o.e(4330),o.e(71003),o.e(55753),o.e(28866),o.e(84166),o.e(58636),o.e(74562),o.e(3259),o.e(76677),o.e(43223),o.e(65741),o.e(22542),o.e(15517),o.e(1966),o.e(31276),o.e(55776),o.e(51444),o.e(13297),o.e(4802),o.e(81768),o.e(75422),o.e(24267),o.e(12507),o.e(27911),o.e(79665)]).then(o.bind(o,110368)))),Ke=(0,Re()._h)(Oe,(e=>e.CollectionSettingsAutomationsView)),Ne=new(Re().O2)("ConnectionsSettings",(()=>o.e(10049).then(o.bind(o,738745)))),Le=(0,Re()._h)(Ne,(e=>e.ConnectionsSettings));var ze=()=>o(388693),Ue=()=>o(769145),We=()=>o(284371),He=()=>o(765957),Ge=()=>o(994641),$e=(o(16280),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(823215),o(908872),o(737550),()=>o(729108)),Qe=()=>o(852424),Ye=()=>o(165358),qe=()=>o(187174),Je=()=>o(940563),Xe=()=>o(361173),Ze=()=>o(778078),et=()=>o(973647),tt=()=>o(183558),ot=()=>o(312296),nt=()=>o(53137);var it=()=>o(873039),rt=()=>o(803074),lt=()=>o(718827),st=()=>o(98126),at=()=>o(859428),ct=()=>o(673730);function dt(e){const{title:t,items:o,handleSelect:i,isSelectAll:l,sectionCallout:s,selectAllTooltipContent:a,isSectionItemsLoading:c,disableSelectAll:d}=e,[u,p]=n.useState(!0),{isMobile:g}=(0,r().Y0)(),m=e.disableCollapse??!1,S=(0,v().IS)((e=>({sectionMargin:{paddingTop:4,paddingInlineEnd:6,paddingBottom:4,paddingInlineStart:6},sectionTitleContainer:{display:"flex",padding:"4px",borderRadius:6,gap:4,alignItems:"center"},sectionMenuDesktopTitleStyle:{padding:0,margin:0,alignItems:"center"},arrow:{width:g?14:12,height:g?14:12,transition:"transform 200ms ease-out",transform:`rotateZ(${u?0:-90}deg)`,fill:"inherit",opacity:1,marginTop:2},menuList:{paddingTop:0,paddingBottom:0}})),[g,u]);return o.length?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(A().A,{style:{...S.sectionMargin},desktopTitleStyle:S.sectionMenuDesktopTitleStyle,title:(0,L.jsxs)(lt().Ay,{style:S.sectionTitleContainer,onClick:()=>p(!u),disabled:m,children:[t,m?void 0:(0,q().arrowChevronSingleDownFillSmallIcon)(S.arrow),c?(0,L.jsx)(st().A,{style:{alignSelf:"right"}}):void 0]}),right:!d&&o.length&&u&&!c&&(0,L.jsx)(at().A,{renderTooltip:e=>(0,L.jsx)("div",{...e,style:ct().Q$,children:a}),render:e=>(0,L.jsx)("div",{...e,children:(0,L.jsx)(ut,{onClick:i,isSelectAll:l})}),disableTooltip:!a})}),u?(0,L.jsxs)(L.Fragment,{children:[s,(0,L.jsx)(ce().Ay,{style:S.menuList,type:ce().Oh.Vertical,initialFocus:0,sections:[{key:"collapsableSectionMenuList",render:e=>(0,L.jsx)(A().A,{topBorder:!1,...e}),items:o}]})]}):void 0]}):null}function ut(e){return(0,L.jsx)(he().p,{size:"sm",shouldShrink:!0,colorPalette:"blue",style:{fontSize:We().J.UISmall.desktop,height:"fit-content",padding:"4px"},onClick:e.onClick,children:e.isSelectAll?(0,L.jsx)(x().sA,{id:"database.viewSettings.collapsableSection.selectAll",defaultMessage:"Select all"}):(0,L.jsx)(x().sA,{id:"database.viewSettings.collapsableSection.unselectAll",defaultMessage:"Unselect all"})})}var pt=()=>o(419357),gt=()=>o(710149),mt=()=>o(125565),St=()=>o(757695),yt=()=>o(206267);class ft extends St().Store{getInitialState(){return{flowId:void 0,type:"connected_properties_setup",collectionsProperties:{}}}createNewFlowId(){const e=(0,yt().JW)();return this.setState({...this.state,flowId:e}),e}getFlowId(){return this.state.flowId?this.state.flowId:this.createNewFlowId()}addCollectionProperties(e,t){const o=this.state.collectionsProperties[e],n=o?{...o,...t}:t;this.setState({...this.state,collectionsProperties:{...this.state.collectionsProperties,[e]:n}})}removeCollectionProperties(e,t){const o=this.state.collectionsProperties[e];if(!o)return;const n=Object.fromEntries(Object.entries(o).filter((([e])=>!t.has(e))));if(0===Object.keys(n).length){const{[e]:t,...o}=this.state.collectionsProperties;this.setState({...this.state,collectionsProperties:o})}else this.setState({...this.state,collectionsProperties:{...this.state.collectionsProperties,[e]:n}})}}const ht=new ft;(0,o(852832).exposeDebugValue)("ConnectedPropertiesSyncStore",ht);var vt=()=>o(617871),xt=(o(803949),()=>o(638681)),bt=()=>o(527328);const Ct={name:"User",regex:"^(https?:\\/\\/)?(?<instanceUrl>[a-z0-9-]+\\.[\\w.]+\\.force\\.com)\\/lightning\\/r\\/User\\/(?<recordId>[a-zA-Z0-9]+)\\/(?<action>[a-zA-Z0-9_]+)?(\\?(?<queryParams>[^\\s#]*))?$",sample_urls:["https://notion.lightning.force.com/lightning/r/User/0055b00000MWTaJAAX/view","https://notion.lightning.force.com/lightning/r/user/0055b00000MWTaJAAX/view"],additional_types:{connectedRelation:!0},attributes:bt().eV.attributes,connected_relation_properties:{title:{name:"Name",type:"title"},Id:{name:"Id",type:"text"},CreatedDate:{name:"Created Date",type:"date"},LastModifiedDate:{name:"Last Modified Date",type:"date"},Email:{name:"Email",type:"email"},SmallPhotoUrl:{name:"Avatar URL",type:"url"},NotionUser:{name:"Notion User",type:"relation",uri:"notion://user-defined-collection/salesforce:User"}},connected_relation_sub_schemas:{"notion://user-defined-collection/salesforce:User":{title:{name:"Name",type:"title"}}}},wt={name:"Report",regex:"^(https?:\\/\\/)?(?<instanceUrl>[a-z0-9-]+\\.[\\w.]+\\.force\\.com)\\/lightning\\/r\\/Report\\/(?<recordId>[a-zA-Z0-9]+)\\/(?<action>[a-zA-Z0-9_]+)?(\\?(?<queryParams>[^\\s#]*))?$",sample_urls:["https://notionlabs-dev-ed.develop.lightning.force.com/lightning/r/Report/00O5b000000Xr5jEAC/view","https://notionlabs-abc-dev-ed.develop.lightning.force.com/lightning/r/Report/00O5b000000Xr5jEAC/view?queryParamsAny=test"],attributes:bt().eV.attributes},jt=[{name:"Account",regex:"^(https?:\\/\\/)?(?<instanceUrl>[a-z0-9-]+\\.[\\w.]+\\.force\\.com)\\/lightning\\/r\\/Account\\/(?<recordId>[a-zA-Z0-9]+)\\/(?<action>[a-zA-Z0-9_]+)",sample_urls:["https://notionlabs-dev-ed.develop.lightning.force.com/lightning/r/Account/001bm000004etjTAAQ/view","https://notionlabs-dev-ed.develop.lightning.force.com/lightning/r/Account/001bm000004euUDAAY/view"],attributes:bt().eV.attributes,additional_types:{connectedRelation:!0},connected_relation_properties:{...bt().eV.connected_relation_properties,Type:{name:"Type",type:"text"},AccountNumber:{name:"Account Number",type:"text"},AnnualRevenue:{name:"Annual Revenue",type:"number"},Website:{name:"Website",type:"url"},Phone:{name:"Phone",type:"phone_number"},Description:{name:"Description",type:"text"},ParentId:{uri:"notion://user-defined-collection/salesforce:Account",name:"Parent Account",type:"relation"},OwnerId:{uri:"notion://user-defined-collection/salesforce:User",name:"Account Owner",type:"relation"},mapped_OwnerId:{name:"Mapped Account Owner",uri:"notion://user-defined-collection/salesforce:User",type:"person",source_property_id:"Email"}},connected_relation_sub_schemas:bt().eV.connected_relation_sub_schemas},{name:"Contact",regex:"^(https?:\\/\\/)?(?<instanceUrl>[a-z0-9-]+\\.[\\w.]+\\.force\\.com)\\/lightning\\/r\\/Contact\\/(?<recordId>[a-zA-Z0-9]+)\\/(?<action>[a-zA-Z0-9_]+)",sample_urls:["https://notionlabs-dev-ed.develop.lightning.force.com/lightning/r/Contact/003bm000004etjTAAQ/view","https://notionlabs-dev-ed.develop.lightning.force.com/lightning/r/Contact/003bm000004euUDAAY/view"],attributes:bt().eV.attributes,additional_types:{connectedRelation:!0},connected_relation_properties:{...bt().eV.connected_relation_properties,Phone:{name:"Phone",type:"phone_number"},Email:{name:"Email",type:"email"},AccountId:{uri:"notion://user-defined-collection/salesforce:Account",name:"Account",type:"relation"}},connected_relation_sub_schemas:bt().eV.connected_relation_sub_schemas},{name:"Opportunity",regex:"^(https?:\\/\\/)?(?<instanceUrl>[a-z0-9-]+\\.[\\w.]+\\.force\\.com)\\/lightning\\/r\\/Opportunity\\/(?<recordId>[a-zA-Z0-9]+)\\/(?<action>[a-zA-Z0-9_]+)",sample_urls:["https://notionlabs-dev-ed.develop.lightning.force.com/lightning/r/Opportunity/006bm000004etjTAAQ/view","https://notionlabs-dev-ed.develop.lightning.force.com/lightning/r/Opportunity/006bm000004euUDAAY/view"],attributes:bt().eV.attributes,additional_types:{connectedRelation:!0},connected_relation_properties:{...bt().eV.connected_relation_properties,Amount:{name:"Amount",type:"number"},CloseDate:{name:"Close Date",type:"date"},StageName:{name:"Stage",type:"text"},AccountId:{uri:"notion://user-defined-collection/salesforce:Account",name:"Account",type:"relation"},OwnerId:{name:"Owner",uri:"notion://user-defined-collection/salesforce:User",type:"relation"},mapped_OwnerId:{name:"Mapped Opportunity Owner",uri:"notion://user-defined-collection/salesforce:User",type:"person",source_property_id:"Email"}},connected_relation_sub_schemas:bt().eV.connected_relation_sub_schemas},Ct],At=(bt().eV,jt.map((e=>({name:e.name,additional_types:e.additional_types,connected_relation_properties:e.connected_relation_properties,connected_relation_sub_schemas:e.connected_relation_sub_schemas}))),xt().string());xt().object({required:{Name:xt().string(),Id:At,CreatedById:At},optional:{UserName:xt().string(),SmallPhotoUrl:xt().nullable(xt().string()),Alias:xt().nullable(xt().string()),Email:xt().nullable(xt().string()),IsActive:xt().boolean(),ProfileId:xt().nullable(At),UserType:xt().nullable(xt().string())}}),xt().union([xt().object({required:{scope:xt().string(),signature:xt().string(),access_token:xt().string(),instance_url:xt().string(),id:xt().string(),token_type:xt().string(),issued_at:xt().string()},optional:{id_token:xt().string(),refresh_token:xt().nullable(xt().string()),state:xt().string()}})]),xt().object({required:{sub:xt().string(),user_id:xt().string(),organization_id:xt().string(),preferred_username:xt().string(),name:xt().string(),email:xt().string()},optional:{nickname:xt().string(),email_verified:xt().boolean(),given_name:xt().string(),family_name:xt().string(),zoneinfo:xt().string(),photos:xt().object({optional:{},required:{picture:xt().string(),thumbnail:xt().string()}}),profile:xt().string(),picture:xt().string(),address:xt().object({optional:{country:xt().string()},required:{}}),urls:xt().record(xt().string(),xt().string()),active:xt().boolean(),user_type:xt().string(),language:xt().string(),locale:xt().string(),utcOffset:xt().number(),updated_at:xt().string()}});var _t=()=>o(583835);const It=(0,_t().Dv)("resyncExternalCollection");var kt=()=>o(559506),Mt=()=>o(36629),Tt=()=>o(357625),Pt=()=>o(543665);async function Bt(e){const{environment:t,objectName:o,objectLabel:n,collectionContextStore:i,intl:r}=e,l=nt().A.state;if(!l.loaded)return et().Q.fail("Integration state not loaded");const s=null==i?void 0:i.collectionStore(),a=null==s?void 0:s.getSpaceId();if(!a)return et().Q.fail("Space ID not found");const c=null==s?void 0:s.getSpacePointer();Ye().log({level:"info",from:"salesforceConnectedRelationActions",type:"createSalesforceConnectedRelationProperty",data:{message:"Received request to create Salesforce connected relation property",miscDataToConvertToString:{objectName:o,objectLabel:n,spaceId:a,collectionPointer:c}}});const d=l.integrations.find((e=>e.id===vt().mn));if(!d)return et().Q.fail("Integration not found");const u=nt().A.bots.state.find((e=>e.integration_id===vt().mn));if(!u)return et().Q.fail("Bot not found");const g=u.id;let m;if(p().default.checkGate({gateName:"salesforce_use_minimal_schema"}))m=function(e){const{objectName:t}=e;return{value:{name:t,regex:(0,bt().fh)(t),attributes:bt().eV.attributes,additional_types:{connectedRelation:!0},connected_relation_properties:bt().eV.connected_relation_properties,connected_relation_sub_schemas:bt().eV.connected_relation_sub_schemas}}}({objectName:o});else{var S;const e=await kt().callApi({eventName:"describeSalesforceObject",environment:t,data:{spaceId:a,objectName:o,botId:g}});if("success"!==(null==e?void 0:e.type))return Ye().log({level:"error",from:"salesforceConnectedRelationActions",type:"createSalesforceConnectedRelationProperty",data:{message:"Describe Salesforce object failed while creating Salesforce connected relation property",miscDataToConvertToString:{objectName:o,objectLabel:n,spaceId:a,collectionPointer:c,error:e.error}}}),(0,f().u)({environment:t,event:{eventName:"salesforce_actions",eventProperties:{integrationId:vt().mn,actionType:"create_connected_relation_property",status:"failed",collectionId:null==s?void 0:s.id,flowId:Ge().A.getFlowId()}}}),et().Q.fail(e.error.name);if((null===(S=e.data)||void 0===S?void 0:S.responseStatus)===ze().qh.NOT_FOUND)return Ye().log({level:"info",from:"salesforceConnectedRelationActions",type:"createSalesforceConnectedRelationProperty",data:{message:"Describe Salesforce object failed while creating Salesforce connected relation property, admin service account does not have access to the object",miscDataToConvertToString:{objectName:o,objectLabel:n,spaceId:a,collectionPointer:c,error:ze().qh.NOT_FOUND}}}),(0,f().u)({environment:t,event:{eventName:"salesforce_actions",eventProperties:{integrationId:vt().mn,actionType:"create_connected_relation_property",status:"failed",collectionId:null==s?void 0:s.id,details:{error:ze().qh.NOT_FOUND,objectName:o}}}}),et().Q.fail(ze().qh.NOT_FOUND);m=function(e){const{describeObjectResponse:t,objectName:o}=e;let n={},i={};return t.forEach((e=>{if("Name"!==e.name){if("created_by"!==e.type&&"last_edited_by"!==e.type&&"created_time"!==e.type&&"last_edited_time"!==e.type&&"rollup"!==e.type&&"formula"!==e.type)if("relation"===e.type){if(e.referenceTo){var t;const o=e.referenceTo,r=e.custom?e.label:e.relationshipName||e.label;n[e.name]={name:r,type:e.type,uri:`notion://user-defined-collection/salesforce:${o}`},"User"!==o&&"Group"!==o||(n[`mapped_${e.name}`]={name:`${r} (Notion User)`,type:"person",uri:"notion://user-defined-collection/salesforce:User",source_property_id:"Email"}),null!==(t=bt().eV.connected_relation_sub_schemas)&&void 0!==t&&t[`notion://user-defined-collection/salesforce:${o}`]||(i[`notion://user-defined-collection/salesforce:${o}`]={title:{name:"Name",type:"title"}})}}else if("select"===e.type||"multi_select"===e.type){var o;n[e.name]={name:e.label,type:e.type,options:null===(o=e.picklistValues)||void 0===o?void 0:o.map((e=>({id:e.label,value:e.value})))}}else"person"===e.type?n[e.name]={name:e.label,type:e.type,uri:"notion://user-defined-collection/salesforce:User",source_property_id:"Email"}:n[e.name]={name:e.label,type:e.type}}else n.title={name:e.label,type:"title"}})),n={...bt().eV.connected_relation_properties,...n},i={...bt().eV.connected_relation_sub_schemas,...i},{value:{name:o,regex:(0,bt().fh)(o),attributes:bt().eV.attributes,additional_types:{connectedRelation:!0},connected_relation_properties:n,connected_relation_sub_schemas:i}}}({describeObjectResponse:e.data.properties,objectName:o})}if(et().Q.isFail(m))return Ye().log({level:"error",from:"salesforceConnectedRelationActions",type:"createSalesforceConnectedRelationProperty",data:{message:"Failed to get connected relation pattern while creating Salesforce connected relation property",miscDataToConvertToString:{objectName:o,objectLabel:n,spaceId:a,collectionPointer:c,error:m.error}}}),(0,f().u)({environment:t,event:{eventName:"salesforce_actions",eventProperties:{integrationId:vt().mn,actionType:"create_connected_relation_property",status:"failed",collectionId:null==s?void 0:s.id,flowId:Ge().A.getFlowId()}}}),et().Q.fail(m.error);const y={name:`${d.id===vt().mn?vt().Aj:d.name} ${n}`,pattern:m.value,integration:d};return await Mt().XO({environment:t,connectedRelationProperty:y,collectionContextStore:i,intl:r,from:"new_property",propertyGroupId:void 0,propertyLimit:"no_limit",skipDatabaseActions:!0}),Ye().log({level:"info",from:"salesforceConnectedRelationActions",type:"createSalesforceConnectedRelationProperty",data:{message:"Successfully created Salesforce connected relation property",miscDataToConvertToString:{objectName:o,objectLabel:n,spaceId:a,collectionPointer:c}}}),(0,f().u)({environment:t,event:{eventName:"salesforce_actions",eventProperties:{integrationId:vt().mn,actionType:"create_connected_relation_property",details:{objectName:o},status:"success",collectionId:null==s?void 0:s.id,flowId:Ge().A.getFlowId()}}}),et().Q.success(!0)}async function Ft(e){const{environment:t,collectionStore:o,propertiesToBeAdded:n,propertiesToBeDeleted:i,collectionViewId:r,integrationId:l,rootPropertyId:s,rootPropertySchema:a,skipResyncCollection:c}=e,d=(0,oe().Nv)(a);if(d&&l===vt().mn&&(n.length||i.length)){var u;const e=nt().A.bots.state.find((e=>e.integration_id===l));if(!e)return;const a=new(Pt().m)(t,d);await a.load();const p=null===(u=a.getFormat())||void 0===u?void 0:u.pattern_name;if(!p)return;const g={};for(const t of n)g[t.metadata.name]=t.metadata;const m=(0,Tt().UT)(t,It,{spaceId:o.getSpaceId(),botId:e.id,integrationId:l,key:null==p?void 0:p.toLowerCase(),metadata:g,externalCollectionId:a.id,skipMetadataUpdate:!1,skipResyncCollection:c,source:"add_properties",propertiesToBeAdded:n,propertiesToBeDeleted:i,collectionViewId:r,rootPropertyId:s},{spaceIds:[]});for await(const t of m)break}}var Vt=()=>o(254526),Dt=()=>o(534239),Et=()=>o(532940),Rt=()=>o(21140),Ot=()=>o(673099);const Kt=(0,x().YK)({genericErrorTitle:{defaultMessage:"Failed to load",id:"GenericErrorComponentForConnectedRelation.errorLoading"}});function Nt(e){const{collectionSettingsStore:t,title:o,children:n}=e;return(0,L.jsx)(C().Ay,{...e,title:o,handleClose:()=>{D().os({collectionSettingsStore:t})},menuScrollerStyle:{paddingBottom:6},footer:(0,L.jsxs)(A().A,{extraPadding:!0,topBorder:!0,children:[(0,L.jsx)(Ot().p,{}),(0,L.jsx)(Ot().b,{})]}),children:n})}function Lt(){const e=(0,v().IS)((()=>({button:{marginTop:6,paddingTop:"var(--spacing-small, 4px)",paddingBottom:"var(--spacing-small, 4px)",paddingInlineStart:"var(--spacing-large, 12px)",paddingInlineEnd:"var(--spacing-small, 12px)",gap:4,borderRadius:6,borderWidth:1,border:"1px solid var(--stroke-primary, #54483126)",textAlign:"center"}})),[]);return(0,L.jsx)(Rt().Ye,{justifyContent:"center",children:(0,L.jsx)(lt().Ay,{style:e.button,onClick:()=>{},children:(0,L.jsx)(T().D,{styleKey:"Body/Regular",children:(0,L.jsx)(x().sA,{defaultMessage:"Try again",id:"GenericErrorComponentForConnectedRelation.tryAgain"})})})})}function zt(e){const{title:t,description:o,showTryAgain:n=!1}=e,i=(0,x().tz)(),r=(0,v().IS)((e=>({wrapper:{borderRadius:6,borderStyle:"solid",borderWidth:1,borderColor:e.border.secondary,paddingTop:16,paddingInlineEnd:12,paddingBottom:16,paddingInlineStart:12,gap:6,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},header:{fontWeight:We().Wy.medium,color:e.text.primary,fontSize:We().J.UIRegular.desktop,textAlign:"center"},description:{fontSize:We().J.UISmall.desktop,color:e.text.secondary,fontWeight:We().Wy.regular,textAlign:"center"},iconGroup:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gridColumnGap:10,height:36,width:36},icon:{height:29,width:30,color:e.icon.secondary}})),[]);return(0,L.jsxs)("div",{style:r.wrapper,children:[(0,L.jsx)("div",{style:r.iconGroup,children:(0,Et().exclamationMarkTriangleIcon)(r.icon)}),(0,L.jsx)("div",{style:r.header,children:t||i.formatMessage(Kt.genericErrorTitle)}),(0,L.jsx)("div",{style:r.description,children:o}),n?(0,L.jsx)(Lt,{}):void 0]})}var Ut=()=>o(988536);function Wt(e){const{from:t,bot:o,spaceStore:n,isAdminReAuth:i}=e,r=h().A.isMobile,l=(0,v().IS)((e=>({authStatus:{paddingTop:0,paddingInlineEnd:16,paddingBottom:12,paddingInlineStart:16},headline:{marginInlineStart:12,fontSize:r?We().J.UISmall.mobile:We().J.UISmall.desktop,color:e.text.secondary}})),[r]);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(A().A,{disableMobileBorders:!0,children:(0,L.jsx)("p",{style:l.headline,children:i?(0,L.jsx)(x().sA,{defaultMessage:"To add Salesforce objects or properties, please contact your admin to re-authenticate their account",id:"database.viewSettings.salesforceConnectedRelationAdminReAuth.description"}):(0,L.jsx)(x().sA,{defaultMessage:"To add Salesforce objects or properties, authenticate with your Salesforce account",id:"database.viewSettings.salesforceConnectedRelationReAuth.description"})})}),(0,L.jsx)(A().A,{disableMobileBorders:!0,style:l.authStatus,children:(0,L.jsx)(Ut().C,{captionText:i?(0,L.jsx)(x().sA,{defaultMessage:"Please contact your admin to re-authenticate their Salesforce (Workspace) integration",id:"database.viewSettings.salesforceConnectedRelationAdminReAuth.captionText"}):(0,L.jsx)(x().sA,{defaultMessage:"Link your Salesforce account to add Salesforce objects and properties to your database",id:"database.viewSettings.salesforceConnectedRelationReAuth.captionText"}),integrationIcon:(0,Ue().salesforceIcon)({width:48,height:48}),spaceStore:n,forceReauthForBot:o,from:t})})]})}const Ht=(0,x().YK)({inputPlaceholder:{defaultMessage:"Search property",id:"database.viewSettings.ConnectedRelationActionsAddProperties.inputPlaceholder"},addColumn:{defaultMessage:"Add properties",id:"database.viewSettings.ConnectedRelationActionsAddProperties.addColumn"},Next:{defaultMessage:"Next",id:"database.viewSettings.ConnectedRelationActionsAddProperties.Next"},addProperties:{defaultMessage:"Add properties",id:"ConnectedRelationActionsAddProperties.addProperties"},genericErrorDescription:{defaultMessage:"Unable to connect to Salesforce. Please try again.",id:"ConnectedRelationActionsAddProperties.genericErrorDescription"},noUserAPIAccessDescription:{defaultMessage:"Looks like you don’t have API access. Please reach out to your Salesforce admin.",id:"ConnectedRelationActionsAddProperties.noUserAPIAccessDescription"},spaceBotNoAPIAccessDescription:{defaultMessage:"Looks like your Admin Service Account doesn’t have API access. Please reach out to your Salesforce admin.",id:"ConnectedRelationActionsAddProperties.spaceBotNoAPIAccessDescription"},spaceBotNoFieldAccessTooltip:{defaultMessage:"This field can’t be accessed with the Service Account. Please contact your Salesforce admin.",id:"ConnectedRelationActionsAddProperties.spaceBotNoFieldAccessTooltip"}}),Gt=[64,51,73,95,45,67,45,91,52];function $t(e){const{collectionSettingsStore:t,collectionContextStore:o,rootPropertySchema:i,rootPropertyId:l,integrationId:a,skipDatabaseActions:c,eventSource:d}=e,[u,g]=n.useState(""),[y,h]=n.useState([]),b=(0,s().K8)((()=>{var e;return null==o||null===(e=o.collectionStore())||void 0===e?void 0:e.getSpaceId()}),[o]),w=(0,s().K8)((()=>{const e=nt().A.state;if(e.loaded)return(0,Vt().OB)(e,a)}),[a]),j=(0,s().K8)((()=>{var e;return null==o||null===(e=o.collectionStore())||void 0===e?void 0:e.getSpacePointer()}),[o]),_=(0,v().DP)(),I=(0,r().v3)(),k=(0,x().tz)(),M=(0,v().IS)((()=>({shimmerRow:{display:"flex",cursor:"pointer",alignItems:"center",gap:6,height:24,marginTop:4,marginInlineStart:16,borderRadius:4},leftShimmer:{height:14,width:14,borderRadius:6},rightShimmer:{height:14,borderRadius:6}})),[]),T=(0,s().O$)(He().AppStoreSidebarSpaceStore),P=(0,s().K8)((()=>{if(i&&(0,oe().UU)(i))return i.collection_pointer}),[i]),B=(0,s().K8)((()=>{var e;const t=null==o||null===(e=o.collectionStore())||void 0===e?void 0:e.getSchema();return t&&Object.values(t).some((e=>e&&"url"===e.type))}),[o]),{format:V,loading:E}=(0,Dt().e8)(P,{debugName:"ConnectedRelationActionsAddProperties"}),R=(0,s().K8)((()=>null==V?void 0:V.pattern_name),[V]),[{status:O,value:K,error:N}]=(0,qe().Yb)((async()=>{var e;if(!(b&&R&&w&&w.bot))return null;const t=R,n=await rt().Nf({environment:I,objectName:t,spaceId:b,bot:null==w?void 0:w.bot,connected_relation_properties:null==w||null===(e=w.integration.info.original_url_patterns)||void 0===e||null===(e=e.find((e=>e.name===R)))||void 0===e?void 0:e.connected_relation_properties});if(et().Q.isFail(n))throw new Error(n.error);const i=n.value,r=o.collectionStore();if(r&&i){const e=Qt({collectionStore:r,rootPropertyId:l}).map((e=>e.attributeName));return{properties:i.map((t=>({...t,isSelected:!!e.includes(t.id)}))),patternName:R}}}),[I,b,R,o,l,w]);(0,n.useEffect)((()=>{"resolved"===O&&K&&h(K.properties)}),[O,K]);const z=(0,s().K8)((()=>(0,Vt().Rg)({experimentStore:p().default,integrationId:a})),[a]),U=(0,n.useMemo)((()=>y.filter((e=>e.isAlreadySynced||e.isSelected)).reduce(((e,t)=>{var o,n;return e+=1,"relation"!==t.type||"User"!==(null===(o=t.metadata)||void 0===o?void 0:o.referenceTo)&&"Group"!==(null===(n=t.metadata)||void 0===n?void 0:n.referenceTo)||(e+=1),e}),0)+1),[y]),W=y.length?(0,Ze().Ay)(u,y,(e=>e.name)):[],H=(0,n.useCallback)(((e,t="toggle")=>{h((o=>o.map((o=>e.includes(o.id)?{...o,isSelected:"toggle"===t?!o.isSelected:"selectAll"===t}:o))))}),[]),G=(0,n.useCallback)((e=>({key:e.id,render:t=>(0,L.jsx)(at().A,{placement:"left",textWrap:!0,style:{maxWidth:240},disableTooltip:!e.isAdminNotAccessible,renderTooltip:e=>(0,L.jsx)("div",{...e,children:(0,L.jsx)(x().sA,{...Ht.spaceBotNoFieldAccessTooltip})}),render:o=>(0,L.jsx)("div",{...o,children:(0,L.jsx)(Q().A,{...t,focused:t.focused,disabled:e.isAdminNotAccessible,disabledFeedback:e.isAdminNotAccessible,onClick:()=>{e.isAdminNotAccessible||H([e.id])},title:(0,L.jsx)("div",{style:{textTransform:"capitalize"},children:e.name}),left:(0,L.jsx)("div",{children:(0,L.jsx)($e().S,{size:14,checked:e.isSelected,onClick:()=>{e.isAdminNotAccessible||H([e.id])},style:{borderRadius:2}})}),icon:(0,L.jsx)(Qe().zB,{type:e.type??"text",icon:void 0,size:F().Ev.sm,theme:_})})})}),action:()=>{}})),[H,_]),$=W.filter((e=>e.isAlreadySynced)).slice(0,50),Y=W.filter((e=>!e.metadata.custom)),q=W.filter((e=>e.metadata.custom)),J=y.filter((e=>e.isSelected)).length,X=(0,s().K8)((()=>{const e=null==o?void 0:o.collectionStore();if(!e)return J;const t=Qt({collectionStore:e,rootPropertyId:l}).map((e=>e.attributeName));return y.filter((e=>e.isSelected&&!t.includes(e.id))).length}),[y,o,l,J]),Z=(0,n.useCallback)((async e=>{if(e.stopPropagation(),!i||!(0,oe().UU)(i))return;const n=o.collectionStore(),r=o.collectionViewStore(),s=null==r?void 0:r.id;if(!n)return;const u=function(e){const{environment:t,collectionContextStore:o,allProperties:n,rootPropertyId:i,patternName:r,integrationId:l,eventSource:s,selectedPropertiesCount:a,selectedPlusSyncedPropertiesCount:c}=e,d=o.collectionStore();if(!d)return;const u=o.collectionViewStore(),g=o.getPropertyFormatKey();if(!g)return;const y=n.filter((e=>e.isSelected)),h=Qt({collectionStore:d,rootPropertyId:i}),v=h.map((e=>e.attributeName)),x=y.filter((e=>!v.includes(e.id))),b=h.filter((e=>!y.some((t=>t.id===e.attributeName))));!x.length&&!b.length||p().default.checkGate({gateName:"salesforce_use_minimal_schema"})||S().createAndCommit({userAction:"CollectionSettingsConnectedRelationActionsAddProperties",environment:t,canUndo:!0,perform:e=>{if(x.length&&function(e){const{environment:t,collectionStore:o,transaction:n,propertiesToBeAdded:i,collectionViewArgs:r,rootPropertyId:l,integrationId:s}=e,a={},c=[],d=nt().A.state;if(!d.loaded)return;const u=d.integrations.find((e=>e.id===s));if(u){for(const e of i){const t={name:e.name,type:"rollup",relation_property:l,target_property:` ${e.id}`,target_property_type:e.type,icon:u.info.icon},o=(0,tt().Ay)();a[o]=t,c.push(o)}if(r){const{format:e,formatKey:t,collectionViewStore:o}=r,i=[...e[t]||[],...c.map((e=>({property:e,visible:!0})))];m().zA({stores:[o],update:{[t]:i},transaction:n})}(0,ot().F)({environment:t,collectionStore:o,update:a,transaction:n})}}({environment:t,collectionStore:d,transaction:e,propertiesToBeAdded:x,collectionViewArgs:u?{collectionViewStore:u,format:u.getFormat(),formatKey:g}:void 0,rootPropertyId:i,integrationId:l}),b.length){const o=d.getSchema();for(const n of b)(0,it().B)({environment:t,transaction:e,collectionStore:d,schema:o,property:n.id})}}});return Ye().log({level:"info",from:"ConnectedRelationActionsAddProperties",type:"updateCollectionSchema",data:{miscDataToConvertToString:{propertiesToBeAddedCount:x.length,propertiesToBeDeletedCount:b.length,collectionPointer:d.getSpacePointer(),rootPropertyId:i,totalProperties:n.length}}}),(0,f().u)({environment:t,event:{eventName:"salesforce_actions",eventProperties:{integrationId:l,actionType:"added_properties_for_connected_relation",flowId:Ge().A.getFlowId(),details:{patternName:r,properties:x.map((e=>({fieldName:e.name,propertyType:e.type})))},source:s,collectionId:d.id,dbPropertiesCount:a,workspacePropertiesCount:c}}}),{propertiesToBeAdded:x,propertiesToBeDeleted:b}}({environment:I,collectionContextStore:o,patternName:R??void 0,allProperties:y,rootPropertyId:l,integrationId:a,eventSource:d,selectedPropertiesCount:J,selectedPlusSyncedPropertiesCount:U});if(function(e){const{environment:t,collectionStore:o,patternName:n,integrationId:i,propertyCountLimits:r,selectedPropertiesCount:l,selectedPlusSyncedPropertiesCount:s}=e;l+1>=r.singleDatabaseLimit&&(0,f().u)({environment:t,event:{eventName:"salesforce_actions",eventProperties:{integrationId:i,actionType:"add_properties_single_database_limit_reached",flowId:Ge().A.getFlowId(),details:{limit:r.singleDatabaseLimit,patternName:n},collectionId:o.id}}});s+1>=r.workspaceLimit&&(0,f().u)({environment:t,event:{eventName:"salesforce_actions",eventProperties:{integrationId:i,actionType:"add_properties_workspace_limit_reached",flowId:Ge().A.getFlowId(),details:{limit:r.workspaceLimit,patternName:n},collectionId:o.id}}})}({environment:I,collectionStore:n,patternName:R??void 0,integrationId:a,propertyCountLimits:z,selectedPropertiesCount:J,selectedPlusSyncedPropertiesCount:U}),c)u&&(u.propertiesToBeAdded.length||u.propertiesToBeDeleted.length)&&await Ft({environment:I,collectionStore:n,propertiesToBeAdded:u.propertiesToBeAdded,propertiesToBeDeleted:u.propertiesToBeDeleted,rootPropertyId:l,collectionViewId:s,integrationId:a,skipResyncCollection:!0,rootPropertySchema:i}),D().a2({collectionSettingsStore:t,item:{type:"connectedRelationDatabaseActions",source:"connectedRelationCopyUrl",rootPropertyId:l,integrationId:a,rootPropertySchema:i}}),(0,f().u)({environment:I,event:{eventName:"salesforce_actions",eventProperties:{actionType:"navigate_to_copy_url",collectionId:null==n?void 0:n.id,integrationId:a,flowId:Ge().A.getFlowId(),details:{source:"first_time_setup",isCopyUrlDisabled:!B}}}});else if(D().os({collectionSettingsStore:t}),u&&(u.propertiesToBeAdded.length||u.propertiesToBeDeleted.length)){const e=Qt({collectionStore:n,rootPropertyId:l}),t=[l,...e.map((e=>e.id))],o=Object.fromEntries(t.map((e=>[e,"Loading"])));ht.addCollectionProperties(n.id,o);try{await Ft({environment:I,collectionStore:n,propertiesToBeAdded:u.propertiesToBeAdded,propertiesToBeDeleted:u.propertiesToBeDeleted,collectionViewId:s,rootPropertyId:l,integrationId:a,rootPropertySchema:i,skipResyncCollection:!1})}catch(g){Ye().log({level:"error",from:"ConnectedRelationActionsAddProperties",type:"updateConnectedRelationFieldSelectionFailed",data:{miscDataToConvertToString:{error:g,rootPropertyId:l,integrationId:a,collectionPointer:j,syncProperties:t}}})}finally{ht.removeCollectionProperties(n.id,new Set(t))}}}),[y,o,j,t,I,a,R,l,i,c,U,z,J,d,B]);if(!T)return null;const ee=Jt(N,ze().oA.USER),te=Jt(N,ze().oA.ADMIN);if(ee||te){const t=ee&&te||ee?null==w?void 0:w.bot:null==w?void 0:w.spaceBot;return(0,L.jsx)(Nt,{...e,title:k.formatMessage(Ht.addProperties),children:(0,L.jsx)(Wt,{spaceStore:T,from:"collection_settings_property_type",bot:t,isAdminReAuth:te})})}return qt(N,ze().oA.USER)||qt(N,ze().oA.ADMIN)?(0,L.jsx)(Nt,{...e,title:k.formatMessage(Ht.addProperties),children:(0,L.jsx)(A().A,{extraPadding:!0,disableMobileBorders:!0,children:(0,L.jsx)("div",{style:{padding:"0px 4px"},children:(0,L.jsx)(zt,{description:qt(N,ze().oA.USER)?k.formatMessage(Ht.noUserAPIAccessDescription):k.formatMessage(Ht.spaceBotNoAPIAccessDescription),showTryAgain:!1})})})}):N?(0,L.jsx)(Nt,{...e,title:k.formatMessage(Ht.addProperties),children:(0,L.jsx)(A().A,{extraPadding:!0,disableMobileBorders:!0,children:(0,L.jsx)("div",{style:{padding:"0px 4px"},children:(0,L.jsx)(zt,{description:k.formatMessage(Ht.genericErrorDescription)})})})}):(0,L.jsx)(C().Ay,{...e,title:k.formatMessage(Ht.addProperties),header:(0,L.jsx)(Yt,{inputValue:u,integrationName:"Salesforce",onChange:g}),footer:"resolved"===O&&K&&(0,L.jsx)(Xt,{colorPalette:"blue",selectedPropertiesCount:J,totalPropertiesCount:U,newPropertiesCount:X,patternName:R,propertyCountLimits:z,onClick:Z,iconTrailing:c?Je().arrowStraightRightIcon:void 0,children:c?(0,L.jsx)(x().sA,{...Ht.Next}):(0,L.jsx)(x().sA,{...Ht.addColumn})}),handleClose:()=>{D().os({collectionSettingsStore:t})},menuScrollerStyle:{paddingBottom:6,flexGrow:1},fullHeight:e.fullHeight,children:(0,L.jsxs)("div",{style:{height:"100%",flexGrow:1},children:[E||"pending"===O?(0,L.jsx)("div",{children:(0,L.jsx)("div",{children:Gt.map(((e,t)=>(0,L.jsxs)("div",{style:{...M.shimmerRow},children:[(0,L.jsx)(gt().A,{style:{...M.leftShimmer}}),(0,L.jsx)(gt().A,{style:{...M.rightShimmer,width:e}})]},t)))})}):void 0,"resolved"===O?(0,L.jsxs)(L.Fragment,{children:[$.length>5?(0,L.jsx)(dt,{title:(0,L.jsx)(x().sA,{defaultMessage:"Suggested properties",id:"database.viewSettings.ConnectedRelationActionsAddProperties.suggestedPropertiesTitle"}),disableSelectAll:!1,isSelectAll:$.every((e=>e.isSelected)),handleSelect:()=>{$.every((e=>e.isSelected))?H($.map((e=>e.id)),"deselectAll"):H($.map((e=>e.id)),"selectAll")},items:$.map(G)},"Suggested Properties"):void 0,(0,L.jsx)(dt,{title:(0,L.jsx)(x().sA,{defaultMessage:"{propertyCount, plural, one {{propertyCount} standard property} other {{propertyCount} standard properties}}",id:"database.viewSettings.ConnectedRelationActionsAddProperties.standardPropertiesTitle",values:{propertyCount:Y.length}}),disableSelectAll:!0,items:Y.map(G)},"Standard Properties"),(0,L.jsx)(dt,{title:(0,L.jsx)(x().sA,{defaultMessage:"{propertyCount, plural, one {{propertyCount} custom property} other {{propertyCount} custom properties}}",id:"database.viewSettings.ConnectedRelationActionsAddProperties.OptionalPropertiesTitle",values:{propertyCount:q.length}}),disableSelectAll:!0,items:q.map(G)},"Custom Properties")]}):void 0]})})}function Qt(e){const{collectionStore:t,rootPropertyId:o}=e,n=t.getSchema(),i=[];for(const c in n){var r;if("rollup"===(null===(r=n[c])||void 0===r?void 0:r.type)){var l,s;if((null===(l=n[c])||void 0===l?void 0:l.relation_property)===o)i.push({id:c,attributeName:null===(s=n[c])||void 0===s||null===(s=s.target_property)||void 0===s?void 0:s.trim()})}else{var a;const e=null===(a=n[c])||void 0===a?void 0:a.derived_property_record_metadata;(null==e?void 0:e.pointer_property_uri)===o&&i.push({id:c,attributeName:null==e?void 0:e.external_object_attribute})}}return i}function Yt(e){const t=h().A.isMobile,o=(0,x().tz)();return(0,L.jsxs)(A().A,{children:[(0,L.jsx)(mt().A,{isSecondaryColor:!0,isMultiline:!0,style:{marginInlineStart:12,marginBottom:12,fontSize:t?We().J.UISmall.mobile:We().J.UISmall.desktop},children:(0,L.jsx)(x().sA,{defaultMessage:"Add {integrationName} properties as a column directly to this database",id:"database.viewSettings.ConnectedRelationActionsAddProperties.description",values:{integrationName:e.integrationName}})}),(0,L.jsx)(pt().Ay,{focusInitial:!0,value:e.inputValue,onChange:t=>{e.onChange(t.target.value)},placeholder:o.formatMessage(Ht.inputPlaceholder)})]})}function qt(e,t){return(null==e?void 0:e.message)===`${ze().qh.NO_USER_API_ACCESS}:${t}`}function Jt(e,t){return(null==e?void 0:e.message)===`${ze().qh.REAUTHENTICATION_REQUIRED}:${t}`}function Xt({totalPropertiesCount:e,newPropertiesCount:t,selectedPropertiesCount:o,patternName:n,propertyCountLimits:i,children:r,...l}){const s=(0,v().IS)((e=>({buttonWrapper:{borderColor:"none",borderTop:"1px solid var(--Stroke-Deemphasized, #E3E2E080)",background:e.background.primary,borderTopWidth:1,paddingTop:12,paddingInlineEnd:14,paddingBottom:12,paddingInlineStart:14,gap:8,boxShadow:"inset 0px 1px 0px -1px rgba(15, 15, 15, 0.05)"},button:{width:"100%",border:"none",height:32,fontWeight:We().Wy.medium,paddingInlineEnd:12,paddingInlineStart:12,gap:4},limitExceededErrorMessage:{marginTop:4,fontSize:We().J.UISmall.desktop,color:e.yellow.text.secondary,textAlign:"center",fontWeight:We().Wy.regular},selectedPropertiesCountMessage:{fontSize:We().J.UIRegular.desktop,color:e.text.secondary,textAlign:"center",fontWeight:We().Wy.regular,marginBottom:8},selectedPropertiesCountWarning:{display:"inline-flex",alignItems:"start",gap:4,fontSize:We().J.UISmall.desktop,color:e.text.secondary,textAlign:"start",fontWeight:We().Wy.regular,backgroundColor:e.background.secondary,borderRadius:6,padding:8,marginBottom:4},infoIconStyle:{color:e.text.secondary,marginTop:2}})),[]),a=e>=i.workspaceLimit,c=o>=i.singleDatabaseLimit;return(0,L.jsxs)("div",{style:s.buttonWrapper,children:[t>0&&!a&&!c?(0,L.jsx)("div",{style:s.selectedPropertiesCountMessage,children:(0,L.jsx)("div",{children:(0,L.jsx)(x().sA,{defaultMessage:"{newPropertiesCount, plural, one {{newPropertiesCount} new property will be added} other {{newPropertiesCount} new properties will be added}}",id:"ConnectedRelationActionsAddProperties.newPropertiesCountMessage",values:{newPropertiesCount:t}})})}):void 0,!a&&!c&&o>i.warningThreshold?(0,L.jsxs)("div",{style:s.selectedPropertiesCountWarning,children:[(0,L.jsx)(W().I,{icon:Xe().infoCircleFillSmallIcon,size:14,style:s.infoIconStyle}),(0,L.jsx)(x().sA,{defaultMessage:"Choose fewer than {limit} properties for the best performance",id:"ConnectedRelationActionsAddProperties.tooManyPropertiesWarning",values:{limit:i.warningThreshold}})]}):void 0,(0,L.jsx)(M().A,{style:s.button,disabled:a||c,...l,children:r}),c&&n?(0,L.jsx)("div",{style:s.limitExceededErrorMessage,children:(0,L.jsx)("div",{children:(0,L.jsx)(x().sA,{defaultMessage:"This database has reached the <bold>maximum of {limit}</bold> synced properties",id:"ConnectedRelationActionsAddProperties.salesforceDbMaxPropertiesReached",values:{limit:i.singleDatabaseLimit,bold:e=>(0,L.jsx)("strong",{children:e})}})})}):void 0,a&&n?(0,L.jsx)("div",{style:s.limitExceededErrorMessage,children:(0,L.jsx)("div",{children:(0,L.jsx)(x().sA,{defaultMessage:"Your workspace has reached the <bold>maximum of {limit}</bold> synced properties for {object}",id:"ConnectedRelationActionsAddProperties.workspaceMaxPropertiesReached",values:{limit:ze().rM,bold:e=>(0,L.jsx)("strong",{children:e}),object:n}})})}):void 0]})}var Zt=()=>o(148307);const eo=(0,_t().Dv)("bulkCreateConnectedProperty");var to=()=>o(828973),oo=()=>o(972435);const no=(0,x().YK)({copyColumn:{defaultMessage:"Populate property",id:"ConnectedRelationActionsCopyUrl.populateProperty"},skipStep:{defaultMessage:"Skip step",id:"ConnectedRelationActionsCopyUrl.skipStep"}});function io(e){const{collectionSettingsStore:t,collectionContextStore:o,integrationId:i,property:l}=e,[a,c]=(0,n.useState)(null),d=(0,r().v3)(),u=(0,x().tz)(),{urlProperties:p,allProperties:g,propertyName:m}=(0,s().K8)((()=>{var e,t;const n=null==o||null===(e=o.collectionStore())||void 0===e?void 0:e.getSchema();if(!n)return{urlProperties:[],allProperties:[],propertyName:void 0};const i=null===(t=n[l])||void 0===t?void 0:t.name,r=[];for(const[o,l]of Object.entries(n)){l&&"url"===l.type&&r.push({id:o,...l})}const s=Object.entries(n).filter((([,e])=>"text"===(null==e?void 0:e.type)||"title"===(null==e?void 0:e.type))).map((([e,t])=>({id:e,...t})));return{urlProperties:r,allProperties:[...r,...s],propertyName:i}}),[o,l]);(0,n.useEffect)((()=>{var e;c((null===(e=p[0])||void 0===e?void 0:e.id)||null)}),[p]);const S=(0,v().IS)((e=>({buttonWrapper:{borderColor:"none",borderTop:"1px solid var(--Stroke-Deemphasized, #E3E2E080)",background:e.background.primary,borderTopWidth:1,paddingTop:12,paddingInlineEnd:16,paddingBottom:12,paddingInlineStart:16,gap:8,boxShadow:"inset 0px 1px 0px -1px rgba(15, 15, 15, 0.05)",display:"flex",flexDirection:"column"},button:{width:"100%",height:32,border:"none",fontWeight:We().Wy.medium,paddingInlineStart:12,gap:4,paddingInlineEnd:12},skipStepButton:{width:"100%",height:32,fontWeight:We().Wy.medium,backgroundColor:"transparent",borderColor:e.lightGrayButtonBackground,borderWidth:1,borderStyle:"solid",color:e.text.secondary,background:"transparent",border:"1px solid var(--stroke-primary, #54483126)",gap:6}})),[]);return(0,L.jsxs)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Populate property",id:"ConnectedRelationActionsCopyUrl.titleForCopyUrlTab"}),header:(0,L.jsx)(lo,{propertyName:m}),handleClose:()=>{D().os({collectionSettingsStore:t})},menuScrollerStyle:{paddingBottom:6,flexGrow:1},fullHeight:e.fullHeight,footer:(0,L.jsxs)("div",{style:S.buttonWrapper,children:[(0,L.jsx)(M().A,{colorPalette:"blue",style:S.skipStepButton,hoveredStyle:S.skipStepButton,onClick:e=>{e.stopPropagation(),D().os({collectionSettingsStore:t})},children:oo().A.formatMessage(no.skipStep)}),(0,L.jsx)(M().A,{colorPalette:"blue",style:S.button,disabled:null===a,onClick:async n=>{n.stopPropagation(),D().os({collectionSettingsStore:t});const r=o.collectionStore();if(!r)return;(0,f().u)({environment:d,event:{eventName:"salesforce_actions",eventProperties:{actionType:"copy_url_clicked",collectionId:null==r?void 0:r.id,integrationId:i,flowId:Ge().A.getFlowId()}}});const l=nt().A.bots.state.find((e=>e.integration_id===i));if(!l)return;const s=l.id,c=(0,Vt().K6)({collectionStore:r,rootPropertyId:e.property}),u=[e.property,...c.map((e=>e.id))],p=Object.fromEntries(u.map((e=>[e,"Loading"])));ht.addCollectionProperties(r.id,p);try{const t=a&&r?(0,Tt().UT)(d,eo,{spaceId:r.getSpaceId(),botId:s,collectionId:r.id,integrationId:e.integrationId,sourceColumnId:a,destinationColumnId:e.property},{spaceIds:[]}):null;if(t)for await(const o of t)"in_progress"!==o.taskStatus&&"success"!==o.taskStatus&&("failure"!==o.taskStatus&&"dead"!==o.taskStatus&&"timeout_before_execution"!==o.taskStatus&&"retryable_failure"!==o.taskStatus||o.error&&Ye().log({level:"error",from:"ConnectedRelationActionsCopyUrl",type:"bulkCreateConnectedPropertyFailed",data:{miscDataToConvertToString:{error:o.error,spaceId:r.getSpaceId(),botId:s,collectionId:r.id,integrationId:e.integrationId,sourceColumnId:a,destinationColumnId:e.property,taskStatus:o.taskStatus}}}))}catch(g){Ye().log({level:"error",from:"ConnectedRelationActionsCopyUrl",type:"bulkCreateConnectedPropertyFailed",data:{miscDataToConvertToString:{error:g,spaceId:r.getSpaceId(),botId:s,collectionId:r.id,integrationId:e.integrationId,sourceColumnId:a,destinationColumnId:e.property,syncProperties:u}}})}finally{ht.removeCollectionProperties(r.id,new Set(u))}},children:u.formatMessage(no.copyColumn)})]}),children:[(0,L.jsx)(A().A,{extraPadding:!0,children:(0,L.jsx)(to().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"Select property",id:"ConnectedRelationActionsCopyUrl.selectProperty"}),selectedKey:a??"select",popupStyle:{minWidth:190},options:g.map((e=>({key:e.id,type:"button",title:e.name}))),onChange:c})}),(0,L.jsx)(ro,{})]})}function ro(){const e=(0,v().IS)((e=>({previewContentContainer:{display:"flex",alignSelf:"center",flexDirection:"column",width:"100%",cursor:"default",paddingInlineStart:8,paddingInlineEnd:8},previewContentImage:{display:"flex",alignSelf:"center",flexDirection:"column",width:"100%",cursor:"default"}})),[]);return(0,L.jsx)(A().A,{extraPadding:!0,disableMobileBorders:!0,title:"Preview",children:(0,L.jsx)("div",{style:e.previewContentContainer,children:(0,L.jsx)("img",{src:Zt().A.images.externalIntegrations.salesforceCopyUrlPng,style:e.previewContentImage,alt:"Salesforce Copy URL"})})})}function lo(e){const{isMobile:t}=(0,r().Y0)(),o=e.propertyName;return(0,L.jsx)(A().A,{extraPadding:!0,children:(0,L.jsx)(mt().A,{isSecondaryColor:!0,isMultiline:!0,style:{paddingInlineStart:8,paddingInlineEnd:8,fontSize:t?We().J.UISmall.mobile:We().J.UISmall.desktop},children:(0,L.jsx)(x().sA,{defaultMessage:"Select the Notion property to auto-fill <bold>{property_name}</bold> in this database. With one click, all existing URLs will populate the Salesforce fields you chose.",id:"database.viewSettings.ConnectedRelationActionsCopyUrl.description.selectUrl",values:{bold:e=>(0,L.jsx)("strong",{children:e}),property_name:o}})})})}var so=()=>o(497222),ao=()=>o(553965);const co=(0,x().YK)({inputPlaceholder:{defaultMessage:"Search object",id:"database.viewSettings.ConnectedRelationActionsObjectSelection.inputPlaceholder"},filterSalesforceObjects:{defaultMessage:"Salesforce",id:"ConnectedRelationActionsObjectSelection.filterObjects"},genericErrorDescription:{defaultMessage:"Unable to connect to Salesforce. Please try again.",id:"ConnectedRelationActionsObjectSelection.genericErrorDescription"},noUserAPIAccessDescription:{defaultMessage:"Looks like you don’t have API access. Please reach out to your Salesforce admin.",id:"ConnectedRelationActionsObjectSelection.noUserAPIAccessDescription"},spaceBotNoUserAPIAccessDescription:{defaultMessage:"Looks like your Salesforce admin doesn’t have API access. Please reach out to your Salesforce admin.",id:"ConnectedRelationActionsObjectSelection.spaceBotNoUserAPIAccessDescription"}});function uo(e){const{collectionSettingsStore:t,collectionContextStore:o}=e,[i,l]=n.useState(""),a=(0,r().v3)(),c=(0,x().tz)(),d=(0,v().DP)(),u=(0,s().K8)((()=>{var e;return null===(e=o.collectionStore())||void 0===e?void 0:e.getSpaceId()}),[o]),p=(0,s().K8)((()=>{const e=nt().A.state;if(!e.loaded)return;const t=e.integrations.find((e=>e.id===vt().mn));return t?t.info.icon:void 0}),[]),g=(0,s().K8)((()=>{const e=nt().A.state;if(e.loaded)return(0,Vt().OB)(e,vt().mn)}),[]),m=null==g?void 0:g.bot,S=null==g?void 0:g.spaceBot,y=(0,v().IS)((e=>({shimmerRow:{display:"flex",cursor:"pointer",alignItems:"center",gap:6,height:24,marginTop:4,marginInlineStart:16,borderRadius:4},leftShimmer:{height:14,width:14,borderRadius:6},rightShimmer:{height:14,borderRadius:6}})),[]),[{status:h,value:b,error:w}]=(0,qe().Yb)((async()=>{if(!u||!m)throw new Error("Not loaded");const e=await async function(e){const{environment:t,spaceId:o,botId:n}=e,i=await kt().callApi({eventName:"listSalesforceObjects",environment:t,data:{spaceId:o,botId:n}});return i&&"success"===(null==i?void 0:i.type)?{value:null==i?void 0:i.data}:{error:null==i?void 0:i.error}}({environment:a,spaceId:u,botId:m.id});if(et().Q.isFail(e))throw e.error;const t=e.value;if(t.responseStatus===ze().qh.REAUTHENTICATION_REQUIRED||t.responseStatus===ze().qh.NO_USER_API_ACCESS)throw new Error(`${t.responseStatus}:${t.userType}`);if(t.sObjects.length>0)return t.sObjects.map((e=>({name:e.name,label:e.label,isAdminNotAccessible:Boolean(e.isAdminNotAccessible)})))}),[u,a,m]),[{status:j,value:_}]=(0,qe().Yb)((async()=>{var e;const t=null===(e=o.collectionStore())||void 0===e?void 0:e.getSchema(),n=new Map;if(t)for(const[o,l]of Object.entries(t)){var i;if(l&&(0,oe().UU)(l)&&(null===(i=l.connectedRelation)||void 0===i?void 0:i.integration_id)===vt().mn){var r;const e=(0,oe().Nv)(l);if(!e)continue;const t=new(Pt().m)(a,e);await t.load();const i=null==t||null===(r=t.getFormat())||void 0===r?void 0:r.pattern_name;i&&n.set(i,{property:l,id:o})}}return n}),[a,o]),I=(0,s().O$)(He().AppStoreSidebarSpaceStore);if(!I)return null;const k=Jt(w,ze().oA.USER),M=Jt(w,ze().oA.ADMIN);if(k||M)return(0,L.jsx)(Nt,{...e,title:c.formatMessage(co.filterSalesforceObjects),children:(0,L.jsx)(Wt,{spaceStore:I,from:"collection_settings_property_type",bot:k?m:S,isAdminReAuth:M})});const T=qt(w,ze().oA.USER),P=qt(w,ze().oA.ADMIN);return T||P?(0,L.jsx)(Nt,{...e,title:c.formatMessage(co.filterSalesforceObjects),children:(0,L.jsx)(A().A,{extraPadding:!0,disableMobileBorders:!0,children:(0,L.jsx)("div",{style:{padding:"0px 4px"},children:(0,L.jsx)(zt,{description:T?c.formatMessage(co.noUserAPIAccessDescription):c.formatMessage(co.spaceBotNoUserAPIAccessDescription),showTryAgain:!1})})})}):"rejected"===h||"rejected"===j?(0,L.jsx)(Nt,{...e,title:oo().A.formatMessage(co.filterSalesforceObjects),children:(0,L.jsx)(A().A,{extraPadding:!0,disableMobileBorders:!0,children:(0,L.jsx)("div",{style:{padding:"0px 4px"},children:(0,L.jsx)(zt,{description:c.formatMessage(co.genericErrorDescription)})})})}):(0,L.jsxs)(C().Ay,{...e,title:c.formatMessage(co.filterSalesforceObjects),header:(0,L.jsx)(po,{inputValue:i,integrationName:"Salesforce",onChange:l}),handleClose:()=>{D().os({collectionSettingsStore:t})},menuScrollerStyle:{paddingBottom:6},children:["pending"===h||"pending"===j||"Not loaded"===(null==w?void 0:w.message)?[64,51,73,95,45,67,45,91,52].map(((e,t)=>(0,L.jsxs)("div",{style:{...y.shimmerRow},children:[(0,L.jsx)(gt().A,{style:{...y.leftShimmer}}),(0,L.jsx)(gt().A,{style:{...y.rightShimmer,width:e}})]},t))):void 0,"resolved"===h&&"resolved"===j&&b?(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,initialFocus:0,sections:[{key:"objects",render:e=>(0,L.jsx)(A().A,{...e,title:"Salesforce objects"}),items:b.filter((e=>e.label.toLowerCase().includes(i.toLowerCase()))).sort(((e,t)=>_.has(e.name)&&!_.has(t.name)?-1:!_.has(e.name)&&_.has(t.name)?1:0)).map((e=>({key:e.name,render:t=>(0,L.jsx)(at().A,{placement:"left",textWrap:!0,style:{maxWidth:240},disableTooltip:!(_.has(e.name)||e.isAdminNotAccessible),renderTooltip:()=>_.has(e.name)?(0,L.jsx)(x().sA,{defaultMessage:"This object is already connected to a property in this collection.",id:"ConnectedRelationActionsObjectSelection.alreadyConnected"}):(0,L.jsx)(x().sA,{defaultMessage:"This object can’t be accessed with the Service Account. Please contact your Salesforce admin.",id:"ConnectedRelationActionsObjectSelection.notConnected"}),render:o=>(0,L.jsx)(so().A,{...(0,ao().A)(t,o),showChevron:!0,title:e.label,disabled:e.isAdminNotAccessible,icon:()=>(0,L.jsx)(Qe().zB,{type:"text",icon:p,size:F().Ev.sm,theme:d})})}),action:async()=>{if(_.has(e.name)){var t;const n=o.collectionStore(),i=null==n?void 0:n.getSchema(),r=_.get(e.name),l=null==r||null===(t=r.property)||void 0===t||null===(t=t.connectedRelation)||void 0===t?void 0:t.integration_id,s=null==r?void 0:r.id;if(!s)return;const c=null==i?void 0:i[s];D().a2({collectionSettingsStore:o.settingsStore,item:{type:"connectedRelationDatabaseActions",source:"connectedRelationAddProperties",rootPropertyId:s,integrationId:vt().mn,rootPropertySchema:c,skipDatabaseActions:!1,eventSource:"existing_object_selection_click"}}),(0,f().u)({environment:a,event:{eventName:"salesforce_actions",eventProperties:{actionType:"add_properties_clicked",details:{source:"existing_object_selection_click"},integrationId:l,flowId:Ge().A.getFlowId(),collectionId:null==n?void 0:n.id}}})}else{const t=await Bt({environment:a,objectName:e.name,objectLabel:e.label,collectionContextStore:o,intl:c});et().Q.isFail(t)&&D().a2({collectionSettingsStore:o.settingsStore,item:{type:"connectedRelationDatabaseActions",source:"connectedRelationActionsFailure",integrationId:vt().mn,error:t.error}})}}})))}]}):void 0]})}function po(e){return(0,L.jsx)(A().A,{children:(0,L.jsx)(pt().Ay,{focusInitial:!0,value:e.inputValue,onChange:t=>{e.onChange(t.target.value)},placeholder:oo().A.formatMessage(co.inputPlaceholder)})})}function go(e){const{collectionSettingsStore:t,collectionContextStore:o,tabSettings:{source:n,rootPropertyId:i,rootPropertySchema:l,integrationId:a,skipDatabaseActions:c,error:d,eventSource:u}}=e,p=(0,s().O$)(He().AppStoreSidebarSpaceStore),g=(0,Ut().j)({spaceStore:p}),m=(0,s().K8)((()=>null==o?void 0:o.collectionStore()),[o]),S=(0,r().v3)();if("connected"!==g.status)return p&&m?(0,L.jsx)(So,{collectionSettingsStore:t,integrationId:a,spaceStore:p,collectionStore:m,environment:S}):null;if("connectedRelationAddProperties"===n&&i&&l)return(0,L.jsx)($t,{...e,rootPropertyId:i,integrationId:a,rootPropertySchema:l,skipDatabaseActions:c,eventSource:u});if("ConnectedRelationObjectSelection"===n)return(0,L.jsx)(uo,{...e,integrationId:a});if("connectedRelationCopyUrl"===n&&i)return(0,L.jsx)(io,{...e,integrationId:a,property:i});if("connectedRelationActionsFailure"===n){const t=function(e){return e===ze().qh.NOT_FOUND}(d)?(0,L.jsx)(x().sA,{...mo.NoSpaceBotAccess}):(0,L.jsx)(x().sA,{...mo.CreateConnectedRelationPropertyFailure});return(0,L.jsx)(Nt,{...e,title:(0,L.jsx)(x().sA,{...mo.Salesforce}),children:(0,L.jsx)(A().A,{disableMobileBorders:!0,children:(0,L.jsx)(zt,{description:t,showTryAgain:!1,title:(0,L.jsx)(x().sA,{...mo.somethingWentWrong})})})})}return null}const mo=(0,x().YK)({Salesforce:{defaultMessage:"Salesforce",id:"ConnectedRelationActionsFailure.salesforce"},NoSpaceBotAccess:{defaultMessage:"The selected object isn’t accessible with the Admin service account. Please contact your Salesforce admin to request access.",id:"ConnectedRelationActionsFailure.NoSpaceBotAccess"},CreateConnectedRelationPropertyFailure:{defaultMessage:"Unable to create Salesforce connected relation.",id:"ConnectedRelationActionsFailure.CreateConnectedRelationPropertyFailure"},somethingWentWrong:{defaultMessage:"Something went wrong",id:"ConnectedRelationActionsFailure.somethingWentWrong"}});function So(e){const{spaceStore:t,collectionSettingsStore:o}=e,n=(0,s().K8)((()=>Ge().A.getFlowId()),[]),{isMobile:i}=(0,r().Y0)(),l=(0,v().IS)((e=>({headline:{fontSize:i?We().J.UISmall.mobile:We().J.UISmall.desktop,color:e.text.secondary}})),[i]);return(0,L.jsx)(C().Ay,{...e,collectionSettingsStore:o,title:(0,L.jsx)(x().sA,{defaultMessage:"Salesforce Authentication",id:"database.viewSettings.salesforceAuth.title"}),handleClose:()=>{D().os({collectionSettingsStore:o})},menuScrollerStyle:{paddingBottom:6},footer:(0,L.jsxs)(A().A,{topBorder:!0,children:[(0,L.jsx)(Ot().b,{}),(0,L.jsx)(Ot().p,{})]}),children:(0,L.jsxs)("div",{style:{padding:"0px 12px"},children:[(0,L.jsx)(A().A,{disableMobileBorders:!0,children:(0,L.jsx)("div",{style:l.headline,children:(0,L.jsx)(x().sA,{defaultMessage:"To add Salesforce objects or properties, authenticate with your Salesforce account",id:"database.viewSettings.salesforceAuth.description"})})}),(0,L.jsx)(se().A,{size:4,isHidden:!0}),(0,L.jsx)(A().A,{disableMobileBorders:!0,children:(0,L.jsx)(Ut().C,{captionText:(0,L.jsx)(x().sA,{defaultMessage:"Link your Salesforce account to add Salesforce objects and properties to your database",id:"database.viewSettings.salesforceAuth.captionText"}),integrationIcon:(0,Ue().salesforceIcon)({width:48,height:48}),spaceStore:t,flowId:n,from:"collection_settings_property_type"})})]})})}var yo=()=>o(30537),fo=()=>o(94701),ho=()=>o(668725),vo=()=>o(282883),xo=()=>o(471995),bo=()=>o(527438),Co=()=>o(267584),wo=()=>o(666803);function jo(e){return[30,90,180,270,365,vo().$O].includes(e)}function Ao(e){const{collectionSettingsStore:t,collectionContextStore:o,action:i,selectedProjectKeys:l,selectedProperties:a}=e,c=(0,r().v3)(),d=(0,r().Y0)(),u=(0,s().K8)((()=>{var e;return null===(e=o.collectionStore())||void 0===e?void 0:e.getFormat()}),[o]),{isSetupComplete:p,botId:g,spaceId:m,collectionStore:S,syncWindow:y}=(0,s().K8)((()=>{var e,t;const n=o.collectionStore(),i=(null==n||null===(e=n.getFormat())||void 0===e||null===(e=e.sync_state)||void 0===e||null===(e=e.filter_config)||void 0===e?void 0:e.sync_window)??365;return{isSetupComplete:Boolean(null==n||null===(t=n.getFormat())||void 0===t||null===(t=t.sync_state)||void 0===t?void 0:t.last_synced_at),botId:null==n?void 0:n.getFormat().bot_id,spaceId:null==n?void 0:n.getSpaceId(),collectionStore:n,syncWindow:jo(i)?i:365}}),[o]),[h,b]=(0,n.useState)(y),w=(0,I().X)("jira_sync_any_time_filter"),j=(0,n.useMemo)((()=>{var e;return h!==y||!(null!=u&&null!==(e=u.sync_state)&&void 0!==e&&null!==(e=e.filter_config)&&void 0!==e&&e.sync_window)}),[h,y,u]),_=!p,k=(0,s().K8)((()=>{var e;const t=null==S?void 0:S.getFormat(),n=null==S?void 0:S.getSchema(),i=o.collectionViewBlockStore();return"notion://projects_collection"===(null==t?void 0:t.app_config_uri)?null===(e=(0,bo().k7)(i,null==n?void 0:n["notion://projects/project_to_task_relation"]))||void 0===e?void 0:e.id:null==S?void 0:S.id}),[o,S]),M=(0,s().K8)((()=>{var e;return null==S||null===(e=S.getFormat())||void 0===e?void 0:e.synced_collection_external_url}),[S]),T=(0,s().O$)(wo().Ay),P=(0,s().K8)((()=>{const e=T.flowId||yt().JW();return T.flowId||wo().Ay.setState({...T,flowId:e}),e}),[T]),B=(0,s().K8)((()=>Boolean(nt().A.externalAuthentications.state.find((e=>e.id===g&&e.user_id===c.currentUser.id)))),[g,c]),{isMobile:F}=(0,r().Y0)(),V=(0,v().IS)((e=>({snackbarCta:{color:e.text.inversePrimary,marginInlineStart:16},titleContainer:{display:"flex",flexDirection:"row",gap:"8px"},stepText:{color:e.text.secondary},filterContainer:{padding:12,marginBottom:12},dropdownLabel:{color:e.text.secondary,fontSize:We().J.UISmall.desktop,fontWeight:We().Wy.medium,marginBottom:8},dropdownButton:{width:"100%",padding:"6px 8px",color:e.text.primary,fontSize:We().J.UIRegular.desktop,display:"inline-flex",justifyContent:"space-between",alignItems:"center",borderRadius:4,border:`1px solid ${e.border.secondary}`},dropdownIcon:{width:10,marginInlineStart:4,fill:e.icon.tertiary},checkIcon:{width:14},infoLabel:{color:e.text.tertiary,marginTop:8,marginBottom:12,fontSize:F?We().J.UISmall.mobile:We().J.UISmall.desktop}})),[F]),E=(0,n.useMemo)((()=>{const e=[{key:30,name:"In the last month"},{key:90,name:"In the last 3 months"},{key:180,name:"In the last 6 months"},{key:270,name:"In the last 9 months"},{key:365,name:"In the last year"}];return w?[...e,{key:vo().$O,name:"Any time"}]:e}),[w]);return(0,L.jsx)(C().Ay,{...e,title:(0,L.jsxs)("div",{style:V.titleContainer,children:[_?(0,L.jsx)("div",{style:V.stepText,children:(0,L.jsx)(x().sA,{defaultMessage:"Step 3",id:"database.viewSettings.collectionSettingsExternalListFilters.step3Title"})}):void 0,(0,L.jsx)(x().sA,{defaultMessage:"Filter issues",id:"database.viewSettings.collectionSettingsExternalListFilters.title"})]}),header:(0,L.jsx)(_o,{}),handleClose:()=>{D().os({collectionSettingsStore:t})},footer:(0,L.jsx)(Io,{onSubmit:async()=>{if(!(S&&g&&m))return;const{projectCollectionPointer:e,taskCollectionPointer:o}=(0,Co().Be)(S);if(!e||!o)return;const n=t.state.stack.find((e=>"externalProjectsSyncSettings"===e.type&&"external_list_projects"===e.source));xo().D6({label:(0,L.jsx)(x().sA,{defaultMessage:"Started syncing from Jira. You’ll be notified when the sync is complete",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.snackbar.title"}),right:(0,L.jsx)(he().p,{onClick:xo().N2,style:V.snackbarCta,children:(0,L.jsx)(x().sA,{defaultMessage:"Close",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.snackbar.close"})}),position:"bottom"}),await kt().callApi({eventName:"syncJiraProjects",environment:c,data:{botId:g,projectKeys:l,spaceId:m,properties:a,projectCollectionPointer:e,taskCollectionPointer:o,onlyUpdateProperties:!n,flowId:P,filterConfig:{syncWindow:h}}}),n?(0,f().u)({environment:c,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:"jira",actionType:"sync_projects_and_properties",flowId:P,identifier:M,botId:g,collectionId:k,isSyncOwner:B}}}):(0,f().u)({environment:c,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:"jira",actionType:"sync_properties",flowId:P,identifier:M,botId:g,collectionId:k,isSyncOwner:B}}}),wo().Ay.setState({...wo().Ay.state,flowId:void 0}),D().os({collectionSettingsStore:t})},action:i,isSetupComplete:p,hasTimeFilterChanged:j}),fullHeight:!0,desktopWidth:320,menuScrollerStyle:{paddingBottom:6},children:(0,L.jsxs)("div",{style:V.filterContainer,children:[(0,L.jsx)(mt().A,{style:V.dropdownLabel,children:(0,L.jsx)(x().sA,{defaultMessage:"Issues created or modified",id:"database.viewSettings.collectionSettingsExternalListFilters.timeWindowLabel"})}),(0,L.jsx)(R().A,{popupType:d.isMobile?yo().n.BottomSheet:yo().n.Popup,renderOrigin:e=>{var t;return(0,L.jsxs)(he().p,{...e,style:V.dropdownButton,children:[null===(t=E.find((e=>e.key===h)))||void 0===t?void 0:t.name,(0,ho().b)(V.dropdownIcon)]})},render:e=>{const t=[{key:"time-window-section",render:e=>(0,L.jsx)(A().A,{...e}),items:E.map((t=>({key:t.key,action:()=>{jo(t.key)&&b(t.key),e.close()},render:e=>(0,L.jsx)(Q().A,{...e,title:t.name,right:h===t.key?(0,L.jsx)("div",{style:V.checkIcon,children:(0,fo().checkmarkFillIcon)()}):void 0})})))}];return(0,L.jsx)(O().A,{menuType:K().gu.Popup,width:200,children:(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,sections:t,initialFocus:void 0})})}}),(0,L.jsx)(mt().A,{isMultiline:!0,style:V.infoLabel,children:(0,L.jsx)(x().sA,{defaultMessage:"If an issue in this timeframe has a parent outside it, we’ll still sync the parent.",id:"database.viewSettings.collectionSettingsExternalListFilters.infoLabel"})})]})})}function _o(){const{isMobile:e}=(0,r().Y0)(),t=(0,v().IS)((t=>({description:{marginInlineStart:8,fontSize:e?We().J.UISmall.mobile:We().J.UISmall.desktop,marginBottom:-4}})),[e]);return(0,L.jsx)(A().A,{children:(0,L.jsx)(mt().A,{isSecondaryColor:!0,isMultiline:!0,style:t.description,children:(0,L.jsx)(x().sA,{defaultMessage:"Select a timeframe to sync issues that were created or modified during that period.",id:"database.viewSettings.collectionSettingsExternalListFilters.description"})})})}function Io(e){const t=(0,v().IS)((e=>({wrapper:{padding:12},button:{width:"100%",border:"none",fontWeight:We().Wy.medium,padding:16},buttonWrapper:{width:"100%"},insetDividerContainer:{marginBottom:8,marginInlineStart:12,marginInlineEnd:12}})),[]),o=e.action===oe().Sh.SyncProjects?(0,L.jsx)("div",{style:t.buttonWrapper,children:(0,L.jsx)(M().A,{colorPalette:"blue",style:t.button,onClick:e.onSubmit,children:e.isSetupComplete?(0,L.jsx)(x().sA,{defaultMessage:"Sync projects",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.syncProjectsButton"}):(0,L.jsx)(x().sA,{defaultMessage:"Start Jira sync",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.startJiraSyncButton"})})}):(0,L.jsx)("div",{style:t.buttonWrapper,children:(0,L.jsx)(M().A,{colorPalette:"blue",style:t.button,onClick:e.onSubmit,disabled:!e.hasTimeFilterChanged,children:(0,L.jsx)("div",{style:{textOverflow:"ellipsis",overflow:"hidden"},children:(0,L.jsx)(x().sA,{defaultMessage:"Sync filtered issues",id:"database.viewSettings.collectionSettingsExternalListFilters.syncFilteredIssues"})})})});return(0,L.jsxs)("div",{style:t.wrapper,children:[(0,L.jsx)("div",{style:t.insetDividerContainer,children:(0,L.jsx)(se().A,{size:1})}),o]})}var ko=()=>o(97294),Mo=()=>o(484392),To=()=>o(278238),Po=()=>o(569397),Bo=()=>o(207207),Fo=()=>o(721479),Vo=()=>o(824862),Do=()=>o(496603),Eo=()=>o(763824),Ro=()=>o(901389),Oo=()=>o(510683),Ko=()=>o(635676),No=()=>o(232930),Lo=()=>o(258836),zo=()=>o(404141),Uo=()=>o(10984);const Wo=(0,x().YK)({inputPlaceholder:{defaultMessage:"Search for a project",id:"database.viewSettings.collectionSettingsExternalListProjects.inputPlaceholder"},fetchingProjects:{defaultMessage:"Loading projects from Jira...",id:"database.viewSettings.collectionSettingsExternalListProjects.fetchingProjects"},fetchingProjectsFailed:{defaultMessage:"We’re experiencing temporary issues with Jira’s APIs. Please try again in a sometime.",id:"database.viewSettings.collectionSettingsExternalListProjects.fetchingProjectsFailed"},defaultLoadingMessage:{defaultMessage:"Loading...",id:"database.viewSettings.collectionSettingsExternalListProjects.loading"},somethingWentWrong:{defaultMessage:"Something went wrong. Please try again!",id:"database.viewSettings.collectionSettingsExternalListProjects.somethingWentWrong"},authInProgress:{defaultMessage:"Authenticating with Jira...",id:"database.viewSettings.collectionSettingsExternalListProjects.authInProgress"},authFailed:{defaultMessage:"Authentication failed, try again!",id:"database.viewSettings.collectionSettingsExternalListProjects.authFailed"},noAccessToSite:{defaultMessage:"If you have multiple Jira sites, make sure you’re authenticating into {site}",id:"database.viewSettings.collectionSettingsExternalListProjects.noAccessToSite"}});function Ho(e){switch(e){case"fetchingProjects":return Wo.fetchingProjects;case"somethingWentWrong":return Wo.somethingWentWrong;case"fetchingProjectsFailed":return Wo.fetchingProjectsFailed;case"authFailed":return Wo.authFailed;case"authInProgress":return Wo.authInProgress;case"noAccessToSite":return Wo.noAccessToSite;default:return Wo.defaultLoadingMessage}}function Go(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,[i,l]=n.useState(""),[a,c]=n.useState(!1),[d,u]=n.useState([]),[p,g]=n.useState(!1),[m,S]=n.useState(0),[y,h]=n.useState(!1),[b,w]=n.useState([]),[j,A]=n.useState([]),[_,I]=n.useState([]),[M,T]=n.useState({show:!1}),[P,B]=n.useState(!1),[F,V]=n.useState({show:!1}),[E,R]=n.useState(""),O=(0,r().v3)(),K=(0,s().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getSpaceId()}),[t]),N=(0,s().O$)(He().AppStoreSidebarSpaceStore),z=(0,s().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getFormat().bot_id}),[t]),[{value:U}]=(0,qe().Yb)((async()=>{if(z&&K)return kt().callApi({eventName:"getExternalConnectionMetaInfo",environment:O,data:{botId:z,spaceId:K}})}),[O,z,K]);(0,n.useEffect)((()=>{"success"===(null==U?void 0:U.type)&&"data"in U&&R(U.data.email)}),[U]);const H=(0,s().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getFormat().synced_collection_external_url}),[t]),G=(0,s().K8)((()=>{var e;return(null===(e=t.collectionStore())||void 0===e||null===(e=e.getFormat())||void 0===e?void 0:e.synced_collection_instance_type)??"Cloud"}),[t]),$="DataCenter"===G?"jira-dc":"jira",Y=(0,s().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e||null===(e=e.getFormat())||void 0===e?void 0:e.external_collection_type}),[t]),q=(0,s().K8)((()=>{var e,o;const n=null===(e=t.collectionStore())||void 0===e?void 0:e.getFormat();return Boolean(null==n||null===(o=n.sync_state)||void 0===o?void 0:o.last_synced_at)}),[t]),J=(0,s().O$)(wo().Ay),{projectCollectionPointer:X,taskCollectionPointer:Z}=(0,s().K8)((()=>(0,Co().Be)(t.collectionStore())),[t]),ee=(0,s().K8)((()=>{if(z&&N){return Lo().v.createChildStore(N,{table:Vo().GP,id:z,spaceId:N.id}).getLastEditedById()}return null}),[z,N]),te=(0,s().K8)((()=>(null==N?void 0:N.userId)===ee),[ee,N]),ne=(0,s().K8)((()=>{const e=wo().Ay.state.flowId||yt().JW();return wo().Ay.setState({...wo().Ay.state,flowId:e}),e}),[]),ie=(0,s().K8)((()=>J.projectKeys),[J]),[{value:le}]=(0,qe().Yb)((async()=>K&&z&&X?(T({show:!0,type:"fetchingProjects"}),"DataCenter"===G&&(0,Co().ru)()?kt().callStreamApi({eventName:"streamProjectsForJiraSite",environment:O,data:{botId:z,spaceId:K,projectCollectionPointer:X}}):kt().callApi({eventName:"getProjectsForJiraSite",environment:O,data:{botId:z,spaceId:K,projectCollectionPointer:X}})):null),[O,X,K,z,G]),ae=(0,s().K8)((()=>Uo().dL()),[]);(0,n.useEffect)((()=>{ae&&m>100?(g(!0),(0,f().u)({environment:O,event:{eventName:"external_sync_setup_action",eventProperties:{integration:$,actionType:"issues_free_limit_exceeded",flowId:ne,issueCount:m,isSyncOwner:te}}})):g(!1)}),[O,ne,ae,m,te,$]);const ce=(0,n.useCallback)((e=>{const{jiraProjects:t,permittedProjects:o,existingImportedProjectKeys:n}=e;I(n);const i=o.map((e=>e.key));w(i);const r=[...t.filter((({isPrivate:e})=>!e)).sort(((e,t)=>{var o,n;return t.insight&&e.insight?null!==(o=t.insight)&&void 0!==o&&o.lastIssueUpdateTime&&null!==(n=e.insight)&&void 0!==n&&n.lastIssueUpdateTime?new Date(t.insight.lastIssueUpdateTime).getTime()-new Date(e.insight.lastIssueUpdateTime).getTime():t.insight.totalIssueCount-e.insight.totalIssueCount:1})),...t.filter((({isPrivate:e})=>e)).sort(((e,t)=>{const o=i.includes(e.key),n=i.includes(t.key);return o&&n?0:o?-1:1}))];let l=0;r.forEach((e=>{var t;n.includes(e.key)&&(l+=(null===(t=e.insight)||void 0===t?void 0:t.totalIssueCount)??0)})),A(r),S(l);const s=Do().sb([...n,...ie||[]]);n.length&&c(!0),s&&u(s)}),[ie]),de=(0,n.useCallback)((async e=>{const{response:t}=e;let n=!1;try{for await(const e of t){if("error"===e.type){if(T({show:!1}),B(!1),"code"in e){if(!("SITE_NOT_FOUND"!==e.code&&"NO_USER_BOT_FOUND"!==e.code&&"INVALID_BOT"!==e.code||te))return void h(!0);if("TOKEN_EXPIRED"===e.code)return void D().yl({collectionSettingsStore:o})}return void V({show:!0,type:"fetchingProjectsFailed"})}if(!n){c(!0),I(e.existingImportedProjectKeys);const t=Do().sb([...e.existingImportedProjectKeys,...ie||[]]);u(t),n=!0,T({show:!1})}A((t=>Do().Mp([...t,...e.permittedProjects],((e,t)=>e.key===t.key)))),w((t=>Do().sb([...t,...e.permittedProjects.map((e=>e.key))])))}}finally{B(!1)}}),[ie,te,o]);(0,n.useEffect)((()=>{if("success"!==(null==le?void 0:le.type)&&"failed"!==(null==le?void 0:le.type)||("Cloud"!==G&&(0,Co().ru)()||T({show:!1}),"failed"===(null==le?void 0:le.type)&&V({show:!0,type:"fetchingProjectsFailed"})),"success"===(null==le?void 0:le.type)&&"data"in le&&"object"==typeof le.data)if("code"in le.data){if("TOKEN_EXPIRED"===le.data.code)D().yl({collectionSettingsStore:o});else if(!te){const{code:e}=le.data;"SITE_NOT_FOUND"===e?(h(!0),V({show:!0,type:"noAccessToSite"})):"NO_USER_BOT_FOUND"!==e&&"INVALID_BOT"!==e||h(!0),(0,f().u)({environment:O,event:{eventName:"external_sync_auth",eventProperties:{integration:$,actionType:"member_auth_render",flowId:ne}}})}}else{const e=le.data;Symbol.asyncIterator in e?(B(!0),de({response:e})):ce(e)}}),[le,te,ce,de,O,ne,G,$,o]);const ue=Y?Ko().l[Y]:"",pe=(0,s().K8)((()=>{const e=wo().Ay.state;return e.isMemberAuthSuccessForDataCenter&&!e.open&&"DataCenter"===e.instanceValue&&e.site&&"dc-auth"===e.type}),[]);(0,qe().Yb)((async()=>{if(!te&&X&&K&&z&&pe&&(0,Co().Zf)()&&(0,Co().ru)()){h(!1),T({show:!0,type:"fetchingProjects"}),A([]),B(!0);try{const e=await kt().callStreamApi({eventName:"streamProjectsForJiraSite",environment:O,data:{botId:z,spaceId:K,projectCollectionPointer:X}});"success"===e.type&&"data"in e&&"object"==typeof e.data&&await de({response:e.data})}catch(e){B(!1),V({show:!0,type:"fetchingProjectsFailed"})}}}),[z,K,X,O,de,pe,te]);const ge=(0,v().IS)((e=>({fetchingProjects:{width:"100%",paddingInlineStart:12,paddingInlineEnd:12,paddingTop:6,paddingBottom:12,display:"flex",flexDirection:"column",gap:12,color:e.text.secondary},loadingLabel:{fontSize:14},skeletonRow:{display:"flex",flexDirection:"row",alignItems:"center",gap:10,marginInlineStart:2,marginInlineEnd:2},skeletonCircle:{width:20,height:20,borderRadius:10},skeletonLine:{height:14,borderRadius:6,width:"70%"},projectIcon:{width:20,height:20,borderRadius:4},connectAccountWrapper:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",margin:12,padding:12,flexDirection:"column",gap:8},connectAccountCTA:{borderRadius:6},connectAccountDescription:{fontSize:We().J.UIRegular.desktop,textAlign:"center",color:e.text.secondary},errorMessage:{display:"flex",justifyContent:"center",alignItems:"center",textAlign:"center",height:"100%",color:re().Tj.red,paddingInlineStart:8,paddingInlineEnd:8,fontSize:We().J.UIRegular.desktop},authErrorMessage:{fontSize:We().J.UIRegular.desktop,color:e.text.secondary,marginBottom:12,textAlign:"center"},permittedProjectItemTitle:{fontSize:We().J.UISmall.desktop,fontWeight:We().Wy.medium},permittedProjectItemCaption:{fontSize:We().J.UISmall.desktop,color:To().l8.dark.gray,fontWeight:We().Wy.regular},disabledItem:{color:e.text.secondary,fill:e.icon.secondary,opacity:.4},privateProjectCallout:{width:"-webkit-fill-available",padding:"0px 16px",color:e.text.secondary,marginInlineStart:4,marginInlineEnd:4},helpIcon:{display:"inline-block"},menuListItem:{paddingTop:"0px",paddingBottom:"0px"},insetDividerContainer:{marginTop:8,marginBottom:8,marginInlineStart:12,marginInlineEnd:12},leftCheckboxWrapper:{display:"flex",alignItems:"center",marginTop:4},checkBox:{borderRadius:2,alignSelf:"center"},deskTopIcon:{alignSelf:"flex-start",marginTop:4},stepText:{color:e.text.secondary},titleContainer:{display:"flex",flexDirection:"row",gap:"8px"}})),[]);if(!z||!K)return null;const me=j.length?(0,Ze().Ay)(i,j,(e=>e.name)):[],Se=e=>{const t=e.key;var o,n;d.includes(t)?(u(d.filter((e=>e!==t))),S(m-((null===(o=e.insight)||void 0===o?void 0:o.totalIssueCount)??0))):(u([...d,t]),S(m+((null===(n=e.insight)||void 0===n?void 0:n.totalIssueCount)??0)))},ye=()=>{const e=j.filter((e=>xe(e.key)));if(d.length===e.length)u([]),S(0);else{let e=0;u(j.filter((e=>xe(e.key))).map((t=>{var o;return e+=(null===(o=t.insight)||void 0===o?void 0:o.totalIssueCount)??0,t.key}))),S(e)}},fe=()=>{let e=0;const t=j.filter((e=>!_.includes(e.key)&&xe(e.key))).map((t=>{var o;return e+=(null===(o=t.insight)||void 0===o?void 0:o.totalIssueCount)??0,t.key})),o=d.filter((e=>!t.includes(e)));if(t.every((e=>d.includes(e))))u(o),S(m-e);else{u([...o,...t]);let e=0;for(const t of d){const o=j.find((e=>e.key===t));var n;if(o)e+=(null===(n=o.insight)||void 0===n?void 0:n.totalIssueCount)??0}S(e)}},ve=()=>{const e=d.filter((e=>!_.includes(e)));_.every((e=>d.includes(e)))?u(e):u([...e,..._]);let t=0;for(const n of d){const e=j.find((e=>e.key===n));var o;if(e)t+=(null===(o=e.insight)||void 0===o?void 0:o.totalIssueCount)??0}S(t)},xe=e=>b.includes(e),be=H&&(0,Mo().A)((0,Co().ay)(H)),Ce=me.map((e=>({key:e.id,render:()=>(0,L.jsx)(at().A,{disableTooltip:xe(e.key),renderTooltip:e=>(0,L.jsx)("div",{...e,style:ct().Q$,children:Ie}),render:t=>(0,L.jsx)(Q().A,{...t,style:ge.menuListItem,focused:!1,buttonStyle:xe(e.key)?{}:ge.disabledItem,disabled:!xe(e.key),onClick:()=>{Se(e)},title:(0,L.jsx)("div",{style:{textTransform:"capitalize"},children:e.name}),left:(0,L.jsx)("div",{style:ge.leftCheckboxWrapper,children:(0,L.jsx)($e().S,{size:14,disabled:!xe(e.key),checked:d.includes(e.key),onClick:()=>{Se(e)},style:ge.checkBox})}),icon:(0,L.jsx)("img",{src:e.avatarUrls["48x48"],style:ge.projectIcon,alt:e.name}),desktopIconStyle:ge.deskTopIcon,caption:e.insight&&(0,L.jsx)("div",{children:e.isPrivate?(0,L.jsx)(x().sA,{defaultMessage:"{issues, plural, one {{issues} issue} other {{issues} issues}} (Private)",id:"database.viewSettings.collectionSettingsExternalListProjects.allProjectsIssueCountPrivate",values:{issues:e.insight.totalIssueCount}}):(0,L.jsx)(x().sA,{defaultMessage:"{issues, plural, one {{issues} issue} other {{issues} issues}}",id:"database.viewSettings.collectionSettingsExternalListProjects.allProjectsIssueCountNotPrivate",values:{issues:e.insight.totalIssueCount}})})})}),action:()=>{}}))),we=me.filter((e=>_.includes(e.key))).map((e=>({key:e.id,render:()=>(0,L.jsx)(at().A,{disableTooltip:xe(e.key),renderTooltip:e=>(0,L.jsx)("div",{...e,style:ct().Q$,children:Ie}),render:t=>(0,L.jsx)(Q().A,{...t,style:ge.menuListItem,focused:!1,buttonStyle:xe(e.key)?{}:ge.disabledItem,disabled:!xe(e.key),onClick:()=>{Se(e)},title:(0,L.jsx)("div",{style:{textTransform:"capitalize"},children:e.name}),left:(0,L.jsx)("div",{style:ge.leftCheckboxWrapper,children:(0,L.jsx)($e().S,{size:14,disabled:!xe(e.key),checked:d.includes(e.key),onClick:()=>{Se(e)},style:ge.checkBox})}),icon:(0,L.jsx)("img",{src:e.avatarUrls["48x48"],style:ge.projectIcon,alt:e.name}),desktopIconStyle:ge.deskTopIcon,caption:e.insight&&(0,L.jsx)("div",{children:e.isPrivate?(0,L.jsx)(x().sA,{defaultMessage:"{issues, plural, one {{issues} issue} other {{issues} issues}} (Private)",id:"database.viewSettings.collectionSettingsExternalListProjects.syncedProjectsIssueCountPrivate",values:{issues:e.insight.totalIssueCount}}):(0,L.jsx)(x().sA,{defaultMessage:"{issues, plural, one {{issues} issue} other {{issues} issues}}",id:"database.viewSettings.collectionSettingsExternalListProjects.syncedProjectsIssueCountNotPrivate",values:{issues:e.insight.totalIssueCount}})})})}),action:()=>{}}))),je=me.filter((e=>!_.includes(e.key))).map((e=>({key:e.id,render:()=>(0,L.jsx)(at().A,{disableTooltip:xe(e.key),renderTooltip:e=>(0,L.jsx)("div",{...e,style:ct().Q$,children:Ie}),render:t=>(0,L.jsx)(Q().A,{...t,style:ge.menuListItem,focused:!1,buttonStyle:xe(e.key)?{}:ge.disabledItem,disabled:!xe(e.key),onClick:()=>{Se(e)},title:(0,L.jsx)("div",{style:{textTransform:"capitalize"},children:e.name}),left:(0,L.jsx)("div",{style:ge.leftCheckboxWrapper,children:(0,L.jsx)($e().S,{size:14,disabled:!xe(e.key),checked:d.includes(e.key),onClick:()=>{Se(e)},style:ge.checkBox})}),desktopIconStyle:ge.deskTopIcon,icon:(0,L.jsx)("img",{src:e.avatarUrls["48x48"],style:ge.projectIcon,alt:e.name}),caption:e.insight&&(0,L.jsx)("div",{children:e.isPrivate?(0,L.jsx)(x().sA,{defaultMessage:"{issues, plural, one {{issues} issue} other {{issues} issues}} (Private)",id:"database.viewSettings.collectionSettingsExternalListProjects.unsyncedProjectsIssueCountPrivate",values:{issues:e.insight.totalIssueCount}}):(0,L.jsx)(x().sA,{defaultMessage:"{issues, plural, one {{issues} issue} other {{issues} issues}}",id:"database.viewSettings.collectionSettingsExternalListProjects.unsyncedProjectsIssueCountNotPrivate",values:{issues:e.insight.totalIssueCount}})})})}),action:()=>{}}))),Ae=(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{style:ge.permittedProjectItemTitle,children:(0,L.jsx)(x().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects.userTooltipTitleForPrivatePages",defaultMessage:"Only some private projects can be synced to Notion"})}),(0,L.jsx)("div",{style:ge.permittedProjectItemCaption,children:te?(0,L.jsx)(x().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects.owner.userTooltipCaptionForPrivatePages",defaultMessage:"{site} sync was set up with the Jira account {email}. You can only sync projects they have access to. Click to view the help center",values:{email:E,site:be||"This"}}):(0,L.jsx)(x().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects.member.userTooltipCaptionForPrivatePages",defaultMessage:"{site} sync was set up with the Jira account {email}. You can only sync projects that both have access to. Click to view the help center",values:{email:E,site:be||"This"}})})]}),_e=()=>(0,L.jsx)(at().A,{renderTooltip:e=>(0,L.jsx)("div",{...e,style:ct().Q$,children:Ae}),render:e=>(0,L.jsx)(he().p,{...e,style:ge.privateProjectCallout,children:(0,L.jsxs)(ko().N,{className:"notion-print-ignore",href:(0,No().x)("guides.externalImportAndSync"),external:!0,children:[(0,L.jsx)("span",{style:{...ge.helpIcon,marginInlineEnd:6},children:(0,L.jsx)(W().I,{icon:Fo().questionMarkCircleSmallIcon,size:"xs"})}),(0,L.jsx)(x().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects..privateProjectNotFound",defaultMessage:"Can’t find a private project?"})]})})}),Ie=te?(0,L.jsx)(x().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects.tooltipMessageForPrivatePages",defaultMessage:"You don’t have access to this project in Jira"}):Ae;async function ke(){V({show:!1});const e="DataCenter"===G?vt().Fv:vt().me,t=nt().A.integrations.state.find((({id:t})=>t===e));if(!t||!K)return;(0,f().u)({environment:O,event:{eventName:"external_sync_auth",eventProperties:{integration:$,actionType:"member_auth_initiated",flowId:ne}}}),e===vt().Fv&&wo().Ay.setState({...wo().Ay.state,site:H});const n=O.device.isElectron?await async function(e,t){const o=await Oo().Jq({environment:O,integration:e,spaceId:t,from:"connected_apps_settings"});T({show:!0,type:"authInProgress"});const n=nt().A.externalAuthentications.state,i=performance.now()+6e4,r=Eo().yX(),l=setInterval((()=>{const e=performance.now();i<e?r.resolve(void 0):nt().A.externalAuthentications.state.length>n.length&&r.resolve("success")}),1e3);return await r.promise,clearInterval(l),T({show:!1}),o}(t,K):await Oo().Jq({environment:O,integration:t,spaceId:K,from:"connected_apps_settings"});if("DataCenter"!==G||te)if(h(!1),n&&et().Q.isSuccess(n)){if(!z||!X)return;if((0,f().u)({environment:O,event:{eventName:"external_sync_auth",eventProperties:{integration:$,flowId:ne,status:"success",actionType:"member_auth_status"}}}),T({show:!0,type:"fetchingProjects"}),"DataCenter"===G&&(0,Co().ru)()&&te){A([]);try{const e=await kt().callStreamApi({eventName:"streamProjectsForJiraSite",environment:O,data:{botId:z,spaceId:K,projectCollectionPointer:X}});"success"===e.type&&"data"in e&&"object"==typeof e.data&&(B(!0),de({response:e.data}))}catch(r){V({show:!0,type:"fetchingProjectsFailed"})}}else{var i;const e=await kt().callApi({eventName:"getProjectsForJiraSite",environment:O,data:{botId:z,spaceId:K,projectCollectionPointer:X,userBotId:null===(i=n.value)||void 0===i||null===(i=i.externalAuthentication)||void 0===i?void 0:i.id}});T({show:!1}),"success"===e.type?"code"in e.data?"SITE_NOT_FOUND"===e.data.code?(h(!0),Ro().ui({message:(0,L.jsx)(Yo,{site:H,integrationIconUrl:ue,connectAccount:ke}),showCancel:!1,keepFocus:!0,innerStyle:{width:320,padding:18},items:[]}),(0,f().u)({environment:O,event:{eventName:"external_sync_auth",eventProperties:{integration:$,actionType:"member_auth_render",flowId:ne}}})):"NO_USER_BOT_FOUND"===e.data.code?(h(!0),V({type:"somethingWentWrong",show:!0}),(0,f().u)({environment:O,event:{eventName:"external_sync_auth",eventProperties:{integration:$,actionType:"member_auth_render",flowId:ne}}})):"TOKEN_EXPIRED"===e.data.code?D().yl({collectionSettingsStore:o}):V({type:"fetchingProjectsFailed",show:!0}):ce(e.data):V({type:"fetchingProjectsFailed",show:!0})}}else h(!0),V({type:"authFailed",show:!0}),(0,f().u)({environment:O,event:{eventName:"external_sync_auth",eventProperties:{integration:$,flowId:ne,status:"failed",actionType:"member_auth_status"}}})}return(0,L.jsx)(C().Ay,{...e,title:(0,L.jsxs)("div",{style:ge.titleContainer,children:[q?void 0:(0,L.jsx)("div",{style:ge.stepText,children:(0,L.jsx)(x().sA,{defaultMessage:"Step 1",id:"database.viewSettings.collectionSettingsExternalListProjects.step1Title"})}),(0,L.jsx)(x().sA,{defaultMessage:"{title}",id:"database.viewSettings.collectionSettingsExternalListProjects.title",values:{title:q?"Synced projects":"Select projects"}})]}),header:!y&&!F.show&&(0,L.jsx)($o,{inputValue:i,onChange:l}),handleClose:()=>{wo().Ay.setState({...J,projectKeys:[],site:void 0,isMemberAuthSuccessForDataCenter:!1}),D().os({collectionSettingsStore:o})},footer:!M.show&&!y&&!F.show&&(0,L.jsx)(Qo,{onActionButtonClick:()=>{const e={};j.forEach((t=>{var o;t.insight&&(d.includes(t.key)&&(e[t.key]=(null===(o=t.insight)||void 0===o?void 0:o.totalIssueCount)??0))})),D().a2({collectionSettingsStore:o,item:{type:"externalProjectsSyncSettings",source:"external_list_task_properties",action:oe().Sh.SyncProjects,selectedProjectKeys:d,projectIssueCounts:e}}),wo().Ay.setState({...wo().Ay.state,projectKeys:[]}),(0,f().u)({environment:O,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:$,actionType:"select_properties_cta_click",flowId:ne,identifier:H,botId:z,collectionId:null==Z?void 0:Z.id,isSyncOwner:te}}})},disabled:!a&&0===d.length,selectedProjectKeysLength:d.length,isSetupComplete:q,shouldShowUpgradePlan:p,flowId:ne,isSyncOwner:te,integrationType:$}),fullHeight:!1,menuScrollerStyle:{paddingBottom:6,...y||F.show?{height:"100%"}:{}},desktopWidth:320,children:function(){if(M.show){const e=(0,Co().pu)();return(0,L.jsxs)("div",{style:ge.fetchingProjects,children:[(0,L.jsx)("div",{style:ge.loadingLabel,children:oo().A.formatMessage(Ho(M.type))}),Array.from({length:Co().O1}).map(((t,o)=>(0,L.jsxs)("div",{style:ge.skeletonRow,children:[(0,L.jsx)(gt().A,{style:ge.skeletonCircle}),(0,L.jsx)(gt().A,{style:{...ge.skeletonLine,width:e[o%e.length]}})]},o)))]})}return y?(0,L.jsxs)("div",{style:ge.connectAccountWrapper,children:[F.show?(0,L.jsx)("div",{style:ge.authErrorMessage,children:oo().A.formatMessage(Ho(F.type),{site:(0,vo().nH)(H||"")})}):void 0,(0,L.jsxs)(k().A,{size:"lg",onClick:ke,style:ge.connectAccountCTA,children:[(0,L.jsx)("img",{style:{width:14,height:15,marginInlineEnd:8},src:ue,alt:$}),(0,L.jsx)(x().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects.connectAccountCTA",defaultMessage:"Authenticate your access"})]}),(0,L.jsx)("div",{style:ge.connectAccountDescription,children:(0,L.jsx)(x().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects.connectAccountDescription",defaultMessage:"Connect your Jira account to view and sync projects"})})]}):F.show?(0,L.jsx)("div",{style:ge.errorMessage,children:oo().A.formatMessage(Ho(F.type))}):a?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(dt,{title:(0,L.jsx)(x().sA,{defaultMessage:"Synced projects ({existingSyncedProjectsCount})",id:"database.viewSettings.collectionSettingsExternalListProjects.syncedProjectsTitle",values:{existingSyncedProjectsCount:_.length}}),isSectionItemsLoading:P,isSelectAll:!_.every((e=>d.includes(e))),items:we,handleSelect:ve},"syncedProjects"),(0,L.jsx)("div",{style:ge.insetDividerContainer,children:(0,L.jsx)(se().A,{size:1})}),(0,L.jsx)(dt,{title:(0,L.jsx)(x().sA,{defaultMessage:"All projects ({unsyncedProjectsCount})",id:"database.viewSettings.collectionSettingsExternalListProjects.unsyncedProjectsTitle",values:{unsyncedProjectsCount:j.length-_.length}}),isSectionItemsLoading:P,isSelectAll:!j.filter((e=>!_.includes(e.key))).map((e=>e.key)).every((e=>d.includes(e))),items:je,handleSelect:fe},"unsyncedProjects"),_e()]}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(dt,{title:(0,L.jsx)(x().sA,{defaultMessage:"{buttonText}",id:"database.viewSettings.collectionSettingsExternalListProjects.selectedProjectsTitleForInitialSync",values:{buttonText:d.length===j.length?`All ${j.length} Projects`:`${d.length.toString()} of ${j.length.toString()} projects`}}),isSectionItemsLoading:P,handleSelect:ye,items:Ce,isSelectAll:d.length!==j.length,disableCollapse:!0},"allProjects"),_e()]})}()})}function $o(e){const{isMobile:t}=(0,r().Y0)();return(0,L.jsxs)(A().A,{children:[(0,L.jsx)(mt().A,{isSecondaryColor:!0,isMultiline:!0,style:{marginInlineStart:8,marginInlineEnd:8,marginBottom:12,fontSize:t?We().J.UISmall.mobile:We().J.UISmall.desktop,lineHeight:"16px",fontWeight:We().Wy.medium},children:(0,L.jsx)(x().sA,{defaultMessage:"Synced projects are visible to anyone with database access. For privacy, create a new Jira sync database and set Share permissions.",id:"database.viewSettings.collectionSettingsExternalListProjects.description"})}),(0,L.jsx)(pt().Ay,{focusInitial:!0,value:e.inputValue,onChange:t=>{e.onChange(t.target.value)},placeholder:oo().A.formatMessage(Wo.inputPlaceholder),inputLeft:(0,L.jsx)(pt().Zf,{icon:Bo().J})})]})}function Qo(e){const t=(0,r().v3)(),o=(0,v().IS)((e=>({wrapper:{padding:12},wrapperInner:{borderColor:"none"},button:{width:"100%",border:"none",fontWeight:We().Wy.medium,padding:16},syncDescription:{fontSize:We().J.UISmall.desktop,color:e.text.secondary,marginBottom:8,textAlign:"center"},error:{color:"#D44C47"},insetDividerContainer:{marginBottom:8,marginInlineStart:12,marginInlineEnd:12}})),[]);return(0,L.jsxs)("div",{style:o.wrapper,children:[(0,L.jsx)("div",{style:o.insetDividerContainer,children:(0,L.jsx)(se().A,{size:1})}),(0,L.jsx)("div",{style:o.wrapperInner,children:e.shouldShowUpgradePlan?(0,L.jsxs)("div",{children:[(0,L.jsx)("div",{style:{...o.syncDescription,...o.error},children:(0,L.jsx)(x().sA,{defaultMessage:"Your Free Notion plan allows up to 100 synced issues. Choose fewer projects or upgrade to sync unlimited issues.",id:"database.viewSettings.collectionSettingsExternalListProjects.upgradePlanContext"})}),(0,L.jsx)(M().A,{colorPalette:"blue",style:o.button,onClick:()=>{zo().A.setState({open:!0,openedFrom:"jira_sync_2",currentTab:"plans",defaultSubtab:void 0,highlightedSetting:void 0}),(0,f().u)({environment:t,event:{eventName:"external_sync_setup_action",eventProperties:{integration:e.integrationType,actionType:"plan_upgrade_cta_click",flowId:e.flowId,isSyncOwner:e.isSyncOwner}}})},disabled:e.disabled,children:(0,L.jsx)(x().sA,{defaultMessage:"Upgrade",id:"database.viewSettings.collectionSettingsExternalListProjects.Upgrade"})})]}):(0,L.jsxs)(L.Fragment,{children:[e.isSetupComplete?void 0:(0,L.jsx)("div",{style:o.syncDescription,children:(0,L.jsx)(x().sA,{defaultMessage:"{projects, plural, one {{projects} project will be synced} other {{projects} projects will be synced}}",id:"database.viewSettings.collectionSettingsExternalListProjects.projectsToBeSynced",values:{projects:e.selectedProjectKeysLength}})}),(0,L.jsxs)(M().A,{colorPalette:"blue",style:o.button,onClick:e.onActionButtonClick,disabled:e.disabled,children:[(0,L.jsx)("div",{style:{textOverflow:"ellipsis",overflow:"hidden",marginInlineEnd:6},children:(0,L.jsx)(x().sA,{defaultMessage:"Select properties",id:"database.viewSettings.collectionSettingsExternalListProjects.selectProperties"})}),(0,L.jsx)(W().I,{icon:Po().arrowStraightRightSmallIcon,size:"sm"})]})]})})]})}function Yo(e){const{isMobile:t}=(0,r().Y0)(),o=(0,v().IS)((e=>({title:{fontWeight:We().Wy.medium,marginInlineEnd:4,marginBottom:6},caption:{marginBottom:24},siteButtonContainer:{gap:2,borderRadius:6,borderStyle:"solid",borderWidth:1,borderColor:e.border.secondary,marginBottom:24},siteButton:{paddingTop:4,paddingInlineEnd:30,paddingBottom:4,paddingInlineStart:8,borderRadius:6,gap:8,display:"flex"},siteButtonTextContainer:{gap:8,display:"flex"},siteNameText:{fontSize:t?We().J.UIRegular.mobile:We().J.UIRegular.desktop,fontWeight:We().Wy.regular,lineHeight:"18px",letterSpacing:"0.15px",color:e.text.primary},siteNameSecondaryText:{fontSize:t?We().J.UISmall.mobile:We().J.UISmall.desktop,color:e.text.secondary,fontWeight:We().Wy.regular,textAlign:"start",lineHeight:t?We().K_.UISmall.mobile:We().K_.UISmall.desktop},logo:{width:20,height:20,marginTop:6},siteWrapper:{display:"flex",flexFlow:"column",gap:1,alignItems:"flex-start"}})),[t]);return(0,L.jsxs)("div",{children:[(0,L.jsx)("div",{style:o.title,children:(0,L.jsx)(x().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects.siteMismatchPopup.title",defaultMessage:"Authentication Failed"})}),(0,L.jsx)(mt().A,{isSecondaryColor:!0,isMultiline:!0,style:o.caption,children:(0,L.jsx)(x().sA,{id:"database.viewSettings.collectionSettingsExternalListProjects.siteMismatchPopup.description",defaultMessage:"If you have multiple Jira sites, make sure you’re authenticating into this one:"})}),(0,L.jsx)("div",{style:o.siteButtonContainer,children:(0,L.jsx)(lt().Ay,{style:o.siteButton,disallowTabbing:!0,disabled:!0,children:(0,L.jsxs)("div",{style:o.siteButtonTextContainer,children:[(0,L.jsx)("img",{style:o.logo,src:e.integrationIconUrl,alt:e.site}),(0,L.jsxs)("div",{style:o.siteWrapper,children:[(0,L.jsx)("span",{style:o.siteNameText,children:(0,Mo().A)((0,Co().ay)(e.site||""))}),(0,L.jsx)("span",{style:o.siteNameSecondaryText,children:e.site})]})]})})}),(0,L.jsx)(M().A,{colorPalette:"blue",style:{width:"100%",marginBottom:8},onClick:()=>{e.connectAccount(),Ro().zw()},children:(0,L.jsx)(x().sA,{defaultMessage:"Try again",id:"database.viewSettings.collectionSettingsExternalListProjects.siteMismatchPopup.tryAgainCTA"})}),(0,L.jsx)(he().p,{onClick:()=>{Ro().zw()},style:{width:"100%",justifyContent:"center"},children:(0,L.jsx)(mt().A,{isSecondaryColor:!0,children:(0,L.jsx)(x().sA,{defaultMessage:"Cancel",id:"database.viewSettings.collectionSettingsExternalListProjects.siteMismatchPopup.cancenCTA"})})})]})}var qo=()=>o(488173),Jo=()=>o(123423),Xo=()=>o(940071);const Zo=(0,x().YK)({inputPlaceholder:{defaultMessage:"Search for a property...",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.inputPlaceholder"},fetchingProperties:{defaultMessage:"Loading properties from Jira...",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.fetchingProperties"}}),en=qo().UY,tn=["attachment","issuetype"],on=["description","comment"],nn=["updated","labels","issuelinks","creator","subtasks","reporter","watches","created"],rn=new Map([["user","person"],["attachment","file"],["array","multi_select"],["option","select"],["option-with-child","select"],["number","number"],["datetime","date"],["date","date"],["priority","select"],["issuetype","select"],["string","text"],["default","text"]]),ln=100;function sn(e){const{collectionSettingsStore:t,collectionContextStore:o,action:i,selectedProjectKeys:l}=e,[a,c]=n.useState(""),[u,p]=n.useState([]),g=(0,v().DP)(),[m,S]=n.useState(!1),y=(0,r().v3)(),h=(0,s().K8)((()=>o.collectionStore()),[o]),b=(0,s().K8)((()=>null==h?void 0:h.getFormat()),[h]),w=(0,s().K8)((()=>null==h?void 0:h.getSchema()),[h]),j=(0,s().K8)((()=>{const e=o.collectionViewBlockStore();return"notion://projects_collection"===(null==b?void 0:b.app_config_uri)?(0,bo().k7)(e,null==w?void 0:w["notion://projects/project_to_task_relation"]):h}),[o,w,b,h]),A=(0,s().K8)((()=>null==j?void 0:j.getSchema()),[j]),_=(0,s().K8)((()=>null==j?void 0:j.id),[j]),I=(0,s().K8)((()=>null==h?void 0:h.getSpaceId()),[h]),k=(0,s().K8)((()=>{var e;return null==h||null===(e=h.getFormat())||void 0===e?void 0:e.synced_collection_external_url}),[h]),M=(0,s().K8)((()=>null==h?void 0:h.getFormat().bot_id),[h]),T=(0,s().K8)((()=>u.filter((e=>e.isSelected)).length),[u]),P=(0,s().K8)((()=>{var e;const t=null==h?void 0:h.getFormat();return Boolean(null==t||null===(e=t.sync_state)||void 0===e?void 0:e.last_synced_at)}),[h]),B=(0,s().O$)(wo().Ay),V=(0,s().K8)((()=>{const e=B.flowId||yt().JW();return B.flowId||wo().Ay.setState({...B,flowId:e}),e}),[B]),E=(0,s().K8)((()=>Boolean(nt().A.externalAuthentications.state.find((e=>e.id===M&&e.user_id===y.currentUser.id)))),[M,y]),R=(0,n.useCallback)((e=>{const t=u.map((t=>{const o=e.find((e=>e.id===t.id));var n;return o&&!on.includes(o.id)?{...t,isProjectLevel:"PROJECT"===(null===(n=o.scope)||void 0===n?void 0:n.type)}:t})),o=e.filter((e=>!t.find((t=>t.id===e.id))&&!on.includes(e.id))).filter((({schema:e})=>Boolean(e))).map((e=>{var t;const o=tn.includes(e.id),n=(0,d().gB)(`${_}:${e.id}`),i=Boolean(null==A?void 0:A[n]);return{id:e.id,name:e.name,isSelected:o||i,isRequired:o,currentlySyncing:o||i,type:(r=null==e?void 0:e.schema,r?"watches"===r.type||"array"===r.type&&"user"===r.items?"person":"array"===r.type&&"attachment"===r.items?"file":rn.get((null==r?void 0:r.type)??"default"):"text"),isProjectLevel:"PROJECT"===(null===(t=e.scope)||void 0===t?void 0:t.type),isPopular:nn.includes(e.id)};var r}));return[...t,...o]}),[u,_,A]),O=(0,n.useCallback)((e=>{p(e);e.filter((e=>e.isSelected)).length>100&&(0,f().u)({environment:y,event:{eventName:"external_sync_setup_action",eventProperties:{integration:"jira",actionType:"properties_limit_exceeded",flowId:V,identifier:k,botId:M,collectionId:_,isSyncOwner:E}}})}),[y,k,M,_,V,E]),[{value:K}]=(0,qe().Yb)((async()=>I&&k&&M?await kt().callApi({eventName:"getFieldsForJiraIssues",environment:y,data:{spaceId:I,site:k,botId:M}}):null),[y,I,k,M]);(0,n.useEffect)((()=>{if(!m&&"success"===(null==K?void 0:K.type)&&"data"in K)if("code"in K.data)"TOKEN_EXPIRED"===K.data.code&&D().yl({collectionSettingsStore:t});else{const e=R(K.data.fields.sort(((e,t)=>{var o,n,i,r,l;return tn.includes(e.id)&&!tn.includes(t.id)?-1:!tn.includes(e.id)&&tn.includes(t.id)?1:tn.includes(e.id)&&tn.includes(t.id)||null!==(o=e.schema)&&void 0!==o&&o.customId&&null!==(n=t.schema)&&void 0!==n&&n.customId||!(null!==(i=e.schema)&&void 0!==i&&i.customId||null!==(r=t.schema)&&void 0!==r&&r.customId)?e.name.toLocaleLowerCase()>t.name.toLocaleLowerCase()?1:-1:null!==(l=e.schema)&&void 0!==l&&l.customId?1:-1})));S(!0),O(e)}}),[K,m,O,R,t]),(0,n.useEffect)((()=>{const e=[];A&&Object.entries(A).forEach((([t,o])=>{if(("relation"!==(null==o?void 0:o.type)||null==o||!o.connectedRelation)&&(null!=o&&o.derived_property_record_metadata||en.has(t))){var n;const i="title"===t?"Task Name (Summary)":(null==o?void 0:o.name)??en.get(t)??"",r=(null==o||null===(n=o.derived_property_record_metadata)||void 0===n?void 0:n.external_object_attribute)??en.get(t)??"";e.push({id:r,name:i,isSelected:!0,currentlySyncing:!0,isRequired:en.has(t)||tn.includes(r),type:null==o?void 0:o.type})}})),p((t=>Do().hS([...t,...e],"id")))}),[A]);const N=(0,v().IS)((e=>({disabledItem:{color:e.text.secondary,fill:e.icon.secondary,opacity:.4},snackbarCta:{color:e.text.inversePrimary,marginInlineStart:16},titleContainer:{display:"flex",flexDirection:"row",gap:"8px"},stepText:{color:e.text.secondary},fetchingProperties:{width:"100%",paddingInlineStart:12,paddingInlineEnd:12,paddingTop:6,paddingBottom:12,display:"flex",flexDirection:"column",gap:12,color:e.text.secondary},loadingLabel:{fontSize:14},skeletonRow:{display:"flex",flexDirection:"row",alignItems:"center",gap:10,marginInlineStart:2,marginInlineEnd:2},skeletonCircle:{width:20,height:20,borderRadius:10},skeletonLine:{height:14,borderRadius:6,width:"70%"},insetDividerContainer:{marginTop:8,marginBottom:8,marginInlineStart:12,marginInlineEnd:12}})),[]),z=u.length?(0,Ze().Ay)(a,u,(e=>e.name)):[],U=e=>{O(u.map((t=>t.id===e.id?{id:e.id,name:e.name,isRequired:e.isRequired,isSelected:!e.isSelected,currentlySyncing:e.currentlySyncing,type:e.type,isPopular:e.isPopular,isProjectLevel:e.isProjectLevel}:t)))},W=z.filter((e=>e.isRequired||e.isPopular)).map((e=>({key:e.id,render:()=>(0,L.jsx)(Q().A,{focused:!1,style:e.isRequired?N.disabledItem:{},onClick:()=>{U(e)},disabled:e.isRequired,title:(0,L.jsx)("div",{style:{textTransform:"capitalize"},children:e.name}),left:(0,L.jsx)("div",{children:(0,L.jsx)($e().S,{size:14,checked:e.isSelected,disabled:e.isRequired,onClick:()=>{U(e)},style:{borderRadius:2}})}),icon:(0,L.jsx)(Xo().B,{type:e.type??"text",icon:void 0,size:F().Ev.sm,theme:g,propertyId:e.id})}),action:()=>{}}))),H=z.filter((e=>!(e.isRequired||e.isPopular))).map((e=>({key:e.id,render:()=>(0,L.jsx)(Q().A,{focused:!1,onClick:()=>{U(e)},title:(0,L.jsx)("div",{style:{textTransform:"capitalize"},children:e.name}),left:(0,L.jsx)("div",{children:(0,L.jsx)($e().S,{size:14,checked:e.isSelected,disabled:e.isRequired,onClick:()=>{U(e)},style:{borderRadius:2}})}),icon:(0,L.jsx)(Xo().B,{type:e.type??"text",icon:void 0,size:F().Ev.sm,theme:g,propertyId:e.id})}),action:()=>{}})));return(0,L.jsx)(C().Ay,{...e,title:(0,L.jsx)("div",{style:N.titleContainer,children:P?(0,L.jsx)(x().sA,{defaultMessage:"Synced properties",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.titleForSyncedPropertiesTab"}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{style:N.stepText,children:(0,L.jsx)(x().sA,{defaultMessage:"Step 2",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.step2Title"})}),(0,L.jsx)(x().sA,{defaultMessage:"Select properties",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.titleForSelectPropertiesTab"})]})}),header:(0,L.jsx)(an,{inputValue:a,onChange:c}),handleClose:()=>{D().os({collectionSettingsStore:t})},footer:(0,L.jsx)(cn,{action:i,onSubmit:async()=>{if(!(h&&M&&I))return;const{projectCollectionPointer:o,taskCollectionPointer:n}=(0,Co().Be)(h);if(!o||!n)return;const i=t.state.stack.find((e=>"externalProjectsSyncSettings"===e.type&&"external_list_projects"===e.source)),r=u.filter((e=>e.isSelected)).map((e=>e.id));if(tn.forEach((e=>{r.includes(e)||r.push(e)})),!P)return D().a2({collectionSettingsStore:t,item:{type:"externalProjectsSyncSettings",source:"external_list_filters",action:oe().Sh.SyncProjects,selectedProjectKeys:l,selectedProperties:r}}),void(0,f().u)({environment:y,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:"jira",actionType:"select_filters_cta_click",flowId:V,botId:M,collectionId:_,isSyncOwner:E}}});xo().D6({label:(0,L.jsx)(x().sA,{defaultMessage:"Started syncing from Jira. You’ll be notified when the sync is complete",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.snackbar.title"}),right:(0,L.jsx)(he().p,{onClick:xo().N2,style:N.snackbarCta,children:(0,L.jsx)(x().sA,{defaultMessage:"Close",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.snackbar.close"})}),position:"bottom"}),await kt().callApi({eventName:"syncJiraProjects",environment:y,data:{botId:M,projectKeys:l,projectIssueCounts:e.projectIssueCounts,spaceId:I,properties:r,projectCollectionPointer:o,taskCollectionPointer:n,onlyUpdateProperties:!i,flowId:V}}),i?(0,f().u)({environment:y,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:"jira",actionType:"sync_projects_and_properties",flowId:V,identifier:k,botId:M,collectionId:_,isSyncOwner:E}}}):(0,f().u)({environment:y,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:"jira",actionType:"sync_properties",flowId:V,identifier:k,botId:M,collectionId:_,isSyncOwner:E}}}),wo().Ay.setState({...wo().Ay.state,flowId:void 0}),D().os({collectionSettingsStore:t})},isSetupComplete:P,selectedPropertiesCount:T}),fullHeight:!1,menuScrollerStyle:{paddingBottom:6},desktopWidth:320,children:m?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(dt,{title:(0,L.jsx)(x().sA,{defaultMessage:"Standard properties ({standardPropertyCount})",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.standardPropertiesTitle",values:{standardPropertyCount:u.filter((e=>e.isRequired||e.isPopular)).length}}),isSelectAll:!u.filter((e=>e.isPopular||e.isRequired)).every((e=>e.isSelected)),items:W,handleSelect:()=>{u.filter((e=>e.isPopular||e.isRequired)).every((e=>e.isSelected))?O(u.map((e=>e.isPopular&&!e.isRequired?{...e,isSelected:!1}:e))):O(u.map((e=>e.isPopular&&!e.isRequired?{...e,isSelected:!0}:e)))},isSectionItemsLoading:!m},"requiredProperties"),(0,L.jsx)("div",{style:N.insetDividerContainer,children:(0,L.jsx)(se().A,{size:1})}),(0,L.jsx)(dt,{title:(0,L.jsx)(x().sA,{defaultMessage:"All properties ({siteLevelPropertiesCount})",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.siteLevelPropertiesTitle",values:{siteLevelPropertiesCount:u.filter((e=>!(e.isRequired||e.isPopular))).length}}),items:H,handleSelect:()=>{u.filter((e=>!(e.isPopular||e.isRequired))).every((e=>e.isSelected))?O(u.map((e=>e.isPopular||e.isRequired?e:{...e,isSelected:!1}))):O(u.map((e=>e.isPopular||e.isRequired?e:{...e,isSelected:!0})))},isSelectAll:!u.filter((e=>!(e.isRequired||e.isPopular))).every((e=>e.isSelected)),selectAllTooltipContent:(0,L.jsx)(x().sA,{defaultMessage:"Syncing all properties may lead to worse performance. Try syncing only properties that are in use",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.warningMessageForProjectLevelProperties"}),isSectionItemsLoading:!m},"allOptionalProperties")]}):(()=>{const e=(0,Co().pu)();return(0,L.jsxs)("div",{style:N.fetchingProperties,children:[(0,L.jsx)("div",{style:N.loadingLabel,children:(0,L.jsx)(x().sA,{...Zo.fetchingProperties})}),Array.from({length:Co().O1}).map(((t,o)=>(0,L.jsxs)("div",{style:N.skeletonRow,children:[(0,L.jsx)(gt().A,{style:N.skeletonCircle}),(0,L.jsx)(gt().A,{style:{...N.skeletonLine,width:e[o%e.length]}})]},o)))]})})()})}function an(e){const{isMobile:t}=(0,r().Y0)(),o=(0,x().tz)();return(0,L.jsxs)(A().A,{children:[(0,L.jsx)(mt().A,{isSecondaryColor:!0,isMultiline:!0,style:{marginInlineStart:12,marginBottom:12,fontSize:t?We().J.UISmall.mobile:We().J.UISmall.desktop},children:(0,L.jsx)(x().sA,{defaultMessage:"Select which Jira properties will be synced as Notion properties in the issues database",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.description"})}),(0,L.jsx)(pt().Ay,{focusInitial:!0,value:e.inputValue,onChange:t=>{e.onChange(t.target.value)},placeholder:o.formatMessage(Zo.inputPlaceholder),inputLeft:(0,L.jsx)(pt().Zf,{icon:Bo().J})})]})}function cn(e){const t=(0,v().IS)((e=>({wrapper:{padding:12},buttonWrapper:{borderColor:"none"},button:{width:"100%",border:"none",fontWeight:We().Wy.medium,padding:16},syncDescription:{paddingTop:8,fontSize:We().J.UISmall.desktop,color:e.text.secondary,marginBottom:8,textAlign:"center"},error:{color:"#D44C47"},insetDividerContainer:{marginBottom:8,marginInlineStart:12,marginInlineEnd:12}})),[]),o=e.selectedPropertiesCount>ln,n=e.action===oe().Sh.SyncProjects?(0,L.jsx)("div",{style:t.buttonWrapper,children:(0,L.jsx)(M().A,{colorPalette:"blue",style:t.button,onClick:e.onSubmit,disabled:o,children:e.isSetupComplete?(0,L.jsx)(x().sA,{defaultMessage:"Sync projects",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.syncProjectsButton"}):(0,L.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,L.jsx)(x().sA,{defaultMessage:"Select issue filters",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.selectIssueFiltersButton"}),(0,Jo().arrowStraightRightFillIcon)({width:16,height:16,marginInlineStart:6})]})})}):(0,L.jsx)("div",{style:t.buttonWrapper,children:(0,L.jsx)(M().A,{colorPalette:"blue",style:t.button,onClick:e.onSubmit,disabled:o,children:(0,L.jsx)("div",{style:{textOverflow:"ellipsis",overflow:"hidden"},children:(0,L.jsx)(x().sA,{defaultMessage:"Sync additional properties",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.syncAdditionalProperties"})})})});return(0,L.jsxs)("div",{style:t.wrapper,children:[(0,L.jsx)("div",{style:t.insetDividerContainer,children:(0,L.jsx)(se().A,{size:1})}),e.isSetupComplete||o?void 0:(0,L.jsx)("div",{style:t.syncDescription,children:(0,L.jsx)(x().sA,{defaultMessage:"{propertiesCount, plural, one {{propertiesCount} property will be synced} other {{propertiesCount} properties will be synced}}",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.selectProperties",values:{propertiesCount:e.selectedPropertiesCount}})}),o?(0,L.jsx)("div",{style:{...t.syncDescription,...t.error},children:(0,L.jsx)(x().sA,{defaultMessage:"You selected {selectedProperties} properties. The maximum allowed is 100",id:"database.viewSettings.collectionSettingsExternalListTaskProperties.propertiesLimit",values:{selectedProperties:e.selectedPropertiesCount}})}):void 0,n]})}var dn=()=>o(662303),un=()=>o(373009),pn=()=>o(66689),gn=()=>o(869190),mn=()=>o(519143),Sn=()=>o(663640),yn=()=>o(202017),fn=()=>o(396350),hn=()=>o(170350),vn=()=>o(508485),xn=()=>o(485444),bn=()=>o(611520),Cn=()=>o(16006),wn=()=>o(216596),jn=()=>o(574036);function An({taskCollectionStore:e,projectCollectionStore:t,externalSyncStore:o,spaceStore:n,isActiveSync:i,isSyncing:l,openedFrom:a="external_source_settings"}){var c;const d="enterprise"===(0,s().K8)((()=>{if(n)return n.getSubscriptionTier()}),[n]),u=(0,s().K8)((()=>null==e?void 0:e.getFormat()),[e]),p=Boolean(null==u||null===(c=u.sync_state)||void 0===c?void 0:c.enable_two_way_sync),g=Boolean(null==u?void 0:u.error),m=function(e){const{isSyncing:t,isActiveSync:o,isFailedSync:n}=e;if(!o)return(0,L.jsx)(x().sA,{id:"database.viewSettings.collectionSettingsExternalSource.twoWaySync.tooltip.inactive",defaultMessage:"Cannot be edited for inactive sync"});if(t)return(0,L.jsx)(x().sA,{id:"database.viewSettings.collectionSettingsExternalSource.twoWaySync.tooltip.syncing",defaultMessage:"Cannot be edited while sync is in progress"});if(n)return(0,L.jsx)(x().sA,{id:"database.viewSettings.collectionSettingsExternalSource.twoWaySync.tooltip.failed",defaultMessage:"Cannot be edited for failed sync"});return(0,L.jsx)(x().sA,{id:"database.viewSettings.collectionSettingsExternalSource.twoWaySync.tooltip.generic",defaultMessage:"Allows 2-way editing and syncing"})}({isSyncing:l,isActiveSync:i,isFailedSync:g}),S=(0,r().v3)(),y=(0,v().IS)((()=>({textWrapper:{fontFamily:We().vc(dn().locale).sans,opacity:1}})),[]),f=()=>{wn().toggleTwoWaySyncOnCollection({environment:S,taskCollectionStore:e,projectCollectionStore:t,openedFrom:a})};return d?(0,L.jsx)(at().A,{renderTooltip:e=>(0,L.jsx)("div",{...e,style:ct().Q$,children:m}),render:e=>(0,L.jsx)(jn().A,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"2-way sync",id:"database.viewSettings.collectionSettingsExternalSource.twoWaySync.switchName"}),caption:(0,L.jsx)(x().sA,{id:"database.viewSettings.collectionSettingsExternalSource.twoWaySync.caption",defaultMessage:"Allows 2-way editing and syncing"}),on:p,focused:!1,onClick:f,disabled:l||!i||g,textWrapperStyle:y.textWrapper})}):null}var _n=()=>o(991249);function In({integrationIconUrl:e,currentSpaceStore:t}){const{isMobile:o}=(0,r().Y0)(),n=(0,r().v3)(),i=(0,v().IS)((e=>({upgradeToEnterpriseContainer:{margin:"6px 8px",padding:"12px",borderRadius:6,backgroundColor:e.background.secondary},upgradeToEnterpriseButton:{width:"100%",marginTop:6,padding:"3px 0px",backgroundColor:e.whiteButtonBackground,color:e.text.primary,borderRadius:6,textAlign:"center",border:`1px solid ${e.border.primary}`,fontWeight:We().Wy.medium,fontSize:o?We().J.UIRegular.mobile:We().J.UIRegular.desktop},upgradeToEnterpriseTextContainer:{display:"flex",alignItems:"center",margin:"0px 12px",gap:6},upgradeToEnterpriseIcon:{width:14,height:14},upgradeToEnterpriseText:{fontSize:o?We().J.UISmall.mobile:We().J.UISmall.desktop,color:e.text.primary,fontWeight:We().Wy.regular},hoveredStyle:{backgroundColor:e.whiteButtonHoveredBackground}})),[o]);return"enterprise"===(0,s().K8)((()=>{if(t)return t.getSubscriptionTier()}),[t])?null:(0,L.jsxs)("div",{style:i.upgradeToEnterpriseContainer,children:[(0,L.jsxs)("div",{style:i.upgradeToEnterpriseTextContainer,children:[(0,L.jsx)("img",{style:i.upgradeToEnterpriseIcon,src:e}),(0,L.jsx)("div",{style:i.upgradeToEnterpriseText,children:(0,L.jsx)(x().sA,{defaultMessage:"Jira 2-way sync is now available",id:"database.viewSettings.collectionSettingsExternalSource.twoWaySyncAvailable"})})]}),(0,L.jsx)(lt().Ay,{style:i.upgradeToEnterpriseButton,hoveredStyle:i.hoveredStyle,onClick:()=>{(0,_n().K)(n,{from:"workspace_connections",upsell:{type:"product",product:"enterprise",limit:{type:"none"},trialability:"none"}})},children:(0,L.jsx)(x().sA,{defaultMessage:"Upgrade to Enterprise",id:"database.viewSettings.collectionSettingsExternalSource.upgradeToEnterprise"})})]})}var kn=()=>o(62368),Mn=()=>o(252833),Tn=()=>o(817126),Pn=()=>o(329304),Bn=()=>o(859004);const Fn=(0,x().YK)({invalidReportError:{defaultMessage:"Sync failed",id:"database.viewSettings.collectionSettingsExternalSource.invalidReportError"},noPermissionToRunReports:{defaultMessage:"Can’t fetch report",id:"database.viewSettings.collectionSettingsExternalSource.noPermissionToRunReports"},noPermissionToRunReportsDescription:{defaultMessage:"No permission to run reports. Contact your Salesforce Admin",id:"database.viewSettings.collectionSettingsExternalSource.noPermissionToRunReportsDescription"},groupingsAcrossNotSupported:{defaultMessage:"Report format not supported",id:"database.viewSettings.collectionSettingsExternalSource.groupingsAcrossNotSupported"},groupingsAcrossNotSupportedDescription:{defaultMessage:"Reports with grouped columns aren’t supported. Sync a report without groupings across columns.",id:"database.viewSettings.collectionSettingsExternalSource.groupingsAcrossNotSupportedDescription"},authFailed:{defaultMessage:"Re-authentication required",id:"database.viewSettings.collectionSettingsExternalSource.authFailed"},authFailedAdminDescription:{defaultMessage:"Please re-authenticate your Salesforce (Workspace) and try again",id:"database.viewSettings.collectionSettingsExternalSource.authFailedDescription"},authFailedMemberDescription:{defaultMessage:"Please ask your Salesforce admin to re-authenticate Salesforce (Workspace) and try again",id:"database.viewSettings.collectionSettingsExternalSource.authFailedMemberDescription"},invalidReportErrorDescription:{defaultMessage:"The report you selected could not be processed. Please try again.",id:"database.viewSettings.collectionSettingsExternalSource.invalidReportErrorDescription"},reportNotFoundOrAccessError:{defaultMessage:"Not found",id:"database.viewSettings.collectionSettingsExternalSource.reportNotFoundOrAccessError"},reportNotFoundOrAccessErrorDescription:{defaultMessage:"We couldn’t find this report or you don’t have access.",id:"database.viewSettings.collectionSettingsExternalSource.reportNotFoundOrAccessErrorDescription"},somethingWentWrongError:{defaultMessage:"Something went wrong",id:"database.viewSettings.collectionSettingsExternalSource.somethingWentWrongError"},somethingWentWrongErrorDescription:{defaultMessage:"Something went wrong. Please try again.",id:"database.viewSettings.collectionSettingsExternalSource.somethingWentWrongErrorDescription"},SourceHeading:{defaultMessage:"Source",id:"database.viewSettings.collectionSettingsExternalSource.sourceHeading"},CollectionSettingsExternalSourceTitle:{defaultMessage:"Jira sync",id:"database.viewSettings.collectionSettingsExternalSource.tabTitle"},JiraSyncExternalSourceDescription:{id:"database.viewSettings.collectionSettingsExternalSource.description",defaultMessage:"To set up a Jira synced database, you’ll need to choose projects and properties to sync"},SalesforceReportExternalSourceDescription:{id:"database.viewSettings.collectionSettingsExternalSource.salesforceReportDescription",defaultMessage:"To add a Salesforce report, you’ll need to authenticate with your Salesforce account"},importInProgressToolTip:{id:"database.viewSettings.collectionSettingsExternalSource.tooltipForInProgressImport",defaultMessage:"Cannot be edited while sync is in progress"},accountDisconnectedTooltip:{id:"database.viewSettings.collectionSettingsExternalSource.accountDisconnectedTooltip",defaultMessage:"Account has been disconnected"},jiraSyncSourceDisabledTooltip:{id:"database.viewSettings.collectionSettingsExternalSource.sourceDisabledTooltip",defaultMessage:"Workspace owner has disabled edits for this Jira site"},featureUnavailableTooltip:{defaultMessage:"{upsellTier, select, plus {Plus} business {Business} enterprise {Enterprise} other {}} plan is required to access this feature",id:"database.viewSettings.collectionSettingsExternalSource.featureUnavailableTooltip"},collectionSettingsExternalSourceLastSynced:{defaultMessage:"Last synced {lastSyncedAt}",id:"database.viewSettings.collectionSettingsExternalSource.lastSynced"},collectionSettingsSyncFailed:{defaultMessage:"Sync has failed please re-authenticate",id:"database.viewSettings.collectionSettingsExternalSource.syncFailed"},collectionSettingsSyncInProgress:{defaultMessage:"{integration} sync in progress...",id:"database.viewSettings.collectionSettingsExternalSource.syncInProgress"},collectionSettingsSyncFailedNoPermissionToGetUser:{defaultMessage:"The connected Jira account {jiraAccountName} doesn’t have permission to load users. Please update the token permissions and try again",id:"database.viewSettings.collectionSettingsExternalSource.syncFailedNoPermissionToGetUser"},collectionSettingsSyncFailedNoPermissionToGetProjects:{defaultMessage:"The connected Jira account {jiraAccountName} doesn’t have permission to load some projects. Please update the token permissions and try again",id:"database.viewSettings.collectionSettingsExternalSource.syncFailedNoPermissionToGetProjects"},collectionSettingsSyncFailedNoPermissionToRegisterWebhook:{defaultMessage:"The connected Jira account {jiraAccountName} doesn’t have permission to register a webhook. Please update the token permissions and try again",id:"database.viewSettings.collectionSettingsExternalSource.syncFailedNoPermissionToRegisterWebhook"},collectionSettingsSyncFailedJiraCloudSubscriptionExpired:{defaultMessage:"The Jira Cloud subscription for {jiraAccountName} has expired. Please renew your subscription and try again",id:"database.viewSettings.collectionSettingsExternalSource.syncFailedJiraCloudSubscriptionExpired"},collectionSettingsJiraSyncHelpLink:{id:"jiraSync.helpCenter",defaultMessage:"Learn about Jira sync"},reconnectButtonText:{id:"database.viewSettings.collectionSettingsExternalSource.reconnectButtonText",defaultMessage:"Re-authenticate Jira"},propertyLimitWarning:{defaultMessage:"{propertyNames} hit the 1,000-option limit. New options won’t sync. Reduce options or unsync the {fieldFields} to resolve",id:"database.viewSettings.collectionSettingsExternalSource.propertyLimitWarning"},collectionSettingsSyncFailedNoTimeFilter:{defaultMessage:"To ensure accurate data syncing, please set a time filter for your Jira sync. If no time filter is configured by <bold>{deadline}</bold>, a <bold>{timeFilter}</bold> will automatically be applied.",id:"database.viewSettings.collectionSettingsExternalSource.syncFailedNoTimeFilter"}}),Vn={[qo().f5.NO_PERMISSION_TO_RUN_REPORTS]:{title:Fn.noPermissionToRunReports,description:Fn.noPermissionToRunReportsDescription},[qo().f5.GROUPINGS_ACROSS_NOT_SUPPORTED]:{title:Fn.groupingsAcrossNotSupported,description:Fn.groupingsAcrossNotSupportedDescription},[qo().f5.NOT_FOUND]:{title:Fn.reportNotFoundOrAccessError,description:Fn.reportNotFoundOrAccessErrorDescription}},Dn=12;function En(e){const{collectionContextStore:t,openedFrom:o}=e,{collectionFormat:i,propertySchema:r,externalCollectionType:l,currentCollectionStore:a}=(0,s().K8)((()=>{var e;const o=t.collectionStore();return{collectionFormat:null==o?void 0:o.getFormat(),propertySchema:null==o?void 0:o.getSchema(),externalCollectionType:null==o||null===(e=o.getFormat())||void 0===e?void 0:e.external_collection_type,currentCollectionStore:o}}),[t]),c=(0,s().O$)(t.externalSyncStore),d=(0,n.useMemo)((()=>"Salesforce"===l?Rn:On),[l]);return i&&r&&l&&a&&c&&function(e){return void 0!==(null==e?void 0:e.external_collection_type)}(i)?(0,L.jsx)(d,{...e,externalCollectionFormat:i,propertySchema:r,externalCollectionType:l,currentCollectionStore:a,externalSyncStore:c,openedFrom:o}):null}function Rn(e){var t;const o=(0,x().tz)(),i=(0,r().v3)(),{collectionSettingsStore:l,externalCollectionFormat:a,currentCollectionStore:c,externalCollectionType:d}=e,u=Wn(),p=(0,s().O$)(He().AppStoreSidebarSpaceStore),g=(0,s().K8)((()=>(0,kn().p)(p)),[p]),{flowId:m,report_sync_state:S}=(0,s().K8)((()=>({flowId:Ge().A.getFlowId(),report_sync_state:"report"===Ge().A.state.type?Ge().A.state:void 0})),[]),y=(0,Pn()._X)({name:"collection_synced_database_salesforce_workspace",spaceId:null==p?void 0:p.id,userId:i.currentUser.id}),h=(0,n.useMemo)((()=>y&&!(0,Pn().e2)(y)),[y]),v=d?Ko().l[d]:"",b=(0,s().K8)((()=>{var e;const t=null==a?void 0:a.error;if(!t)return;const n=null===(e=t.metadata)||void 0===e?void 0:e.reason;if(n&&(0,qo().Fk)(n)){const e=Vn[n];if(e)return{title:o.formatMessage(e.title),description:o.formatMessage(e.description)}}return 400===t.status_code?{title:o.formatMessage(Fn.invalidReportError),description:o.formatMessage(Fn.invalidReportErrorDescription)}:401===t.status_code?{title:o.formatMessage(Fn.authFailed),description:g?o.formatMessage(Fn.authFailedAdminDescription):o.formatMessage(Fn.authFailedMemberDescription)}:404===t.status_code?{title:o.formatMessage(Fn.reportNotFoundOrAccessError),description:o.formatMessage(Fn.reportNotFoundOrAccessErrorDescription)}:500===t.status_code?{title:o.formatMessage(Fn.somethingWentWrongError),description:o.formatMessage(Fn.somethingWentWrongErrorDescription)}:void 0}),[a,o,g]);return(0,L.jsxs)(C().Ay,{...e,title:d,fullHeight:!0,handleClose:()=>{D().os({collectionSettingsStore:l})},children:[h?(0,L.jsx)("div",{style:{padding:"0px 4px"},children:(0,L.jsx)(bn().G2,{featureName:"collection_synced_database_salesforce_workspace",source:"collection_synced_database"})}):null,(0,L.jsxs)("div",{style:{paddingTop:0,paddingInlineEnd:12,paddingBottom:4,paddingInlineStart:12},children:[(0,L.jsx)(A().A,{disableMobileBorders:!0,children:(0,L.jsx)("div",{style:{...u.collectionSettingsExternalSourceTitle},children:(0,L.jsx)(x().sA,{...Fn.SalesforceReportExternalSourceDescription})})}),b?(0,L.jsx)(A().A,{disableMobileBorders:!0,children:(0,L.jsx)(zt,{...b})}):void 0,(0,L.jsxs)(A().A,{title:(0,L.jsx)(x().sA,{...Fn.SourceHeading}),children:[(0,L.jsx)(Ut().C,{integrationIconUrl:v,spaceStore:p,flowId:m,captionText:(0,L.jsx)(x().sA,{defaultMessage:"Link your Salesforce account to sync a Salesforce Report",id:"database.viewSettings.collectionSettingsExternalSource.connectToSalesforce.description"}),renderActions:e=>{var t;if("connected"===e)return(0,L.jsx)(M().A,{colorPalette:"blue",style:{marginTop:8,marginInlineEnd:0,marginBottom:8,marginInlineStart:0},onClick:()=>{D().os({collectionSettingsStore:l}),(0,f().u)({environment:i,event:{eventName:"salesforce_actions",eventProperties:{integrationId:vt().mn,actionType:"salesforce_manual_report_sync",collectionId:null==c?void 0:c.id,flowId:m}}}),Bn().X9({environment:i,collectionStore:c,from:"collection_settings_external_source"})},disabled:!(null!=a&&a.synced_collection_external_url)||!0===(null==a||null===(t=a.sync_state)||void 0===t?void 0:t.syncing)||"in_progress"===(null==S?void 0:S.status)||h,children:(0,L.jsx)(x().sA,{defaultMessage:"Sync now",id:"database.viewSettings.collectionSettingsExternalSource.syncNow"})})},from:"collection_settings_external_source"}),null!=a&&null!==(t=a.sync_state)&&void 0!==t&&t.last_synced_at?(0,L.jsx)("div",{style:{...u.lastSyncText,marginTop:4},children:(0,L.jsx)(x().sA,{...Fn.collectionSettingsExternalSourceLastSynced,values:{lastSyncedAt:`${(0,gn().jE)(a.sync_state.last_synced_at,dn().locale,o)}`}})}):void 0]})]}),(0,L.jsxs)(A().A,{topBorder:!0,extraPadding:!0,children:[(0,L.jsx)(Ot().p,{}),(0,L.jsx)(Ot().b,{})]})]})}function On(e){var t,o,n,i,l,a,c,d;const{collectionSettingsStore:u,collectionContextStore:g,externalCollectionFormat:m,propertySchema:S,externalCollectionType:y,currentCollectionStore:h,externalSyncStore:b,openedFrom:w}=e,{bot_id:j}=m,_=(0,x().tz)(),k=Wn(),M=(0,v().DP)(),T=(0,r().v3)(),P=(0,s().O$)(He().AppStoreSidebarSpaceStore),B="DataCenter"===(0,s().K8)((()=>(null==m?void 0:m.synced_collection_instance_type)??"Cloud"),[m])?"jira-dc":"jira",F="jira-dc"===B?"collection_synced_database_jira_datacenter":"collection_synced_database_jira",V=(0,Tn().uF)({featureName:F}),E=(0,s().K8)((()=>h.getSchema()),[h]),R=y?Ko().l[y]:"",O=(0,s().K8)((()=>{const e=g.collectionViewBlockStore();return(0,bo().k7)(e,(0,Co().UJ)(null==m?void 0:m.app_config_uri)?null==S?void 0:S[pn().K4.ProjectToTaskRelation]:null==S?void 0:S[pn().yx.TaskToProjectRelation])}),[g,S,m]),K=(0,s().K8)((()=>wo().Ay.getFlowId()),[]),N=(0,s().K8)((()=>Boolean(nt().A.externalAuthentications.state.find((e=>e.id===(null==m?void 0:m.bot_id)&&e.user_id===T.currentUser.id)))),[m,T]),z=(0,s().K8)((()=>{const e=nt().A.externalAuthentications.state.find((e=>e.id===j));return null==e?void 0:e.account_name}),[j]),U=(0,s().K8)((()=>(0,Mn().fo)({collectionStore:h})),[h]),W=(0,s().K8)((()=>{if(j&&P){const e=Lo().v.createChildStore(P,{table:Vo().GP,id:j,spaceId:P.id});return!e.isDefined()||Boolean(e.getAlive())}return!0}),[j,P]),H=(0,s().K8)((()=>{var e;return W&&(null==m||null===(e=m.error)||void 0===e||null===(e=e.metadata)||void 0===e?void 0:e.reason)}),[W,m]),G=(0,s().K8)((()=>{var e;switch(null==m||null===(e=m.error)||void 0===e||null===(e=e.metadata)||void 0===e?void 0:e.reason){case"NO_PERMISSION_TO_GET_USER":return(0,L.jsx)(x().sA,{...Fn.collectionSettingsSyncFailedNoPermissionToGetUser,values:{jiraAccountName:z}});case"NO_PERMISSION_TO_GET_ISSUES":case"NO_PERMISSION_TO_GET_PROJECTS":return(0,L.jsx)(x().sA,{...Fn.collectionSettingsSyncFailedNoPermissionToGetProjects,values:{jiraAccountName:z}});case"NO_PERMISSION_TO_REGISTER_SYSTEM_WEBHOOK":return(0,L.jsx)(x().sA,{...Fn.collectionSettingsSyncFailedNoPermissionToRegisterWebhook,values:{jiraAccountName:z}});case"JIRA_CLOUD_SUBSCRIPTION_EXPIRED":return(0,L.jsx)(x().sA,{...Fn.collectionSettingsSyncFailedJiraCloudSubscriptionExpired,values:{jiraAccountName:z}});default:return null}}),[m,z]),$=(0,s().K8)((()=>{var e;if(null==m||null===(e=m.sync_state)||void 0===e||!e.last_synced_at)return null;const t=function(e){var t;const o={},n=(null===(t=p().default.getConfig({configName:"jira_properties_options_limit"}))||void 0===t?void 0:t.optionsLimit)??1e3;for(const[r,l]of Object.entries(e))if(l&&("select"===l.type||"multi_select"===l.type)){var i;((null===(i=l.options)||void 0===i?void 0:i.length)??0)>=n&&(o[r]=l.name??r)}return o}(E);if(0===Object.keys(t).length)return null;const o=Object.values(t);return(0,L.jsx)(Hn,{propertyNames:o,styles:k.syncFailedText})}),[null==m||null===(t=m.sync_state)||void 0===t?void 0:t.last_synced_at,E,k.syncFailedText]),{site:Q,associatedBotId:Y}=(0,s().K8)((()=>({site:null==m?void 0:m.synced_collection_external_url,associatedBotId:null==m?void 0:m.bot_id})),[m]),q=(0,s().K8)((()=>{var e;return(null===(e=p().default.getConfig({configName:"jira_sync_time_filter_warning_deadline"}))||void 0===e?void 0:e.deadline)??"September 30, 2025"}),[]),J=(0,I().X)("jira_sync_show_filter_warning"),X=(0,s().K8)((()=>{var e;return!J||null!=m&&null!==(e=m.sync_state)&&void 0!==e&&e.filter_config?null:(0,L.jsxs)("div",{style:k.syncFailedText,children:[(0,L.jsx)(x().sA,{...Fn.collectionSettingsSyncFailedNoTimeFilter,values:{deadline:q,timeFilter:"default one-year time filter",bold:e=>(0,L.jsx)("span",{style:{fontWeight:We().Wy.semibold},children:e})}}),(0,L.jsx)(un().E,{colorPalette:"blue",onClick:()=>{D().a2({collectionSettingsStore:u,item:{type:"externalProjectsSyncSettings",source:"external_list_filters",action:oe().Sh.SyncAdditionalProperties,selectedProjectKeys:[],selectedProperties:[]}}),(0,f().u)({environment:T,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:B,actionType:"select_filters_cta_click",flowId:K,identifier:Q,botId:Y,collectionId:h.id,isSyncOwner:N}}})},style:k.addFilterButton,iconLeading:hn().filterIcon,children:(0,L.jsx)(x().sA,{defaultMessage:"Add Filter",id:"database.viewSettings.collectionSettingsExternalSource.addFilters"})})]})}),[J,null==m||null===(o=m.sync_state)||void 0===o?void 0:o.filter_config,k.syncFailedText,Q,Y,h.id,N,u,K,T,B,k.addFilterButton,q]);if(!O)return null;const Z=(0,Co().UJ)(null==m?void 0:m.app_config_uri),ee=Boolean((null==m?void 0:m.sync_state)&&(null==m||null===(n=m.sync_state)||void 0===n?void 0:n.last_synced_at));return(0,L.jsxs)(C().Ay,{...e,title:_.formatMessage(Fn.CollectionSettingsExternalSourceTitle),desktopWidth:320,fullHeight:!0,handleClose:()=>{wo().Ay.setState({...wo().Ay.state,projectKeys:[]}),D().os({collectionSettingsStore:u})},children:[(0,L.jsxs)("div",{style:{padding:"0px 4px"},children:[(0,L.jsx)(bn().G2,{featureName:F,source:"collection_synced_database"}),U?(0,L.jsxs)(L.Fragment,{children:[null!=V&&V.isAvailable&&!V.expirationDate?(0,L.jsx)(In,{integrationIconUrl:R,currentSpaceStore:P}):null,(0,L.jsx)(An,{taskCollectionStore:Z?O:h,projectCollectionStore:Z?h:O,externalSyncStore:b,spaceStore:P,isActiveSync:W,isSyncing:Boolean(null==m||null===(i=m.sync_state)||void 0===i?void 0:i.syncing),openedFrom:w})]}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(A().A,{disableMobileBorders:!0,children:(0,L.jsx)("div",{style:k.collectionSettingsExternalSourceTitle,children:(0,L.jsx)(x().sA,{...Fn.JiraSyncExternalSourceDescription})})}),(0,L.jsx)("div",{style:k.preview,children:Kn({projectCollectionStore:Z?h:O,taskCollectionStore:Z?O:h,integrationIconUrl:R})})]})]}),(0,L.jsx)("div",{style:k.insetDividerContainer,children:(0,L.jsx)(se().A,{size:1})}),(0,L.jsxs)(A().A,{title:(0,L.jsx)(x().sA,{...Fn.SourceHeading}),children:[(0,L.jsx)("div",{style:k.siteButtonContainer,children:(0,L.jsx)(lt().Ay,{style:k.siteButton,disallowTabbing:!0,disabled:!0,children:(0,L.jsxs)("div",{style:k.siteButtonTextContainer,children:[(0,L.jsx)("img",{style:k.siteIcon,src:R,alt:""}),(0,L.jsxs)("div",{style:k.siteTextColumn,children:[(0,L.jsx)("span",{style:k.siteNameText,children:(0,Mo().A)((0,Co().ay)((null==m?void 0:m.synced_collection_external_url)||""))}),(0,L.jsx)("span",{style:k.siteNameSecondaryText,children:null==m?void 0:m.synced_collection_external_url})]})]})})}),!(W&&null!=V&&V.isAvailable&&null!=m&&null!==(l=m.sync_state)&&void 0!==l&&l.last_synced_at)||null!=m&&null!==(a=m.sync_state)&&void 0!==a&&a.syncing||null!=m&&null!==(c=m.error)&&void 0!==c&&null!==(c=c.metadata)&&void 0!==c&&c.reason?void 0:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{style:{...k.lastSyncText,marginInlineStart:8},children:(0,L.jsx)(x().sA,{...Fn.collectionSettingsExternalSourceLastSynced,values:{lastSyncedAt:`${(0,gn().jE)(m.sync_state.last_synced_at,dn().locale,_)}`}})}),$,X]}),W&&null!=m&&null!==(d=m.sync_state)&&void 0!==d&&d.syncing?(0,L.jsx)("div",{style:k.lastSyncText,children:(0,L.jsx)(x().sA,{...Fn.collectionSettingsSyncInProgress,values:{integration:(0,Mo().A)(null==m?void 0:m.external_collection_type)}})}):void 0,H?(0,L.jsxs)("div",{style:k.syncFailedRow,children:[(0,L.jsx)(Ln,{hasSyncFailed:!0,isSyncing:!1,integrationIconSrcUrl:R}),(0,L.jsx)("div",{style:k.syncFailedTextInRow,children:G})]}):void 0,W?void 0:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{style:k.syncFailedRow,children:[(0,Sn().i)({width:20,height:20,color:M.yellow.icon.accentPrimary}),(0,L.jsx)("div",{style:k.reauthSyncFailedText,children:(0,L.jsx)(x().sA,{...Fn.collectionSettingsSyncFailed})})]}),(0,L.jsx)(un().E,{colorPalette:"blue",onClick:()=>{xn().j({environment:T,from:"sync_header",action:"add_account"})},style:k.reconnectButton,children:(0,L.jsx)(x().sA,{...Fn.reconnectButtonText})})]})]}),(0,L.jsx)("div",{style:k.insetDividerContainer,children:(0,L.jsx)(se().A,{size:1})}),(0,L.jsx)(zn,{taskCollectionStore:Z?O:h,collectionSettingsStore:u,isSetupComplete:ee,flowId:K,isSyncOwner:N,isActiveSync:W,upsellInfo:V}),(0,L.jsx)("div",{style:{marginTop:12,marginInlineStart:12,marginInlineEnd:12},children:(0,L.jsx)(se().A,{size:1})}),(0,L.jsx)(ko().N,{style:{display:"flex",marginInlineStart:4,marginInlineEnd:4},className:"notion-print-ignore",href:(0,No().x)("guides.externalImportAndSync"),external:!0,onClick:()=>{(0,f().u)({environment:T,event:{eventName:"external_sync_setup_action",eventProperties:{integration:B,actionType:"learn_more_cta_click",flowId:K,collectionId:Z?O.id:h.id,botId:null==m?void 0:m.bot_id,identifier:null==m?void 0:m.synced_collection_external_url,isSyncOwner:N}}})},children:(0,L.jsx)(he().p,{iconLeading:{icon:Fo().questionMarkCircleSmallIcon,size:"sm"},colorPalette:"gray",style:k.learnMoreText,children:(0,L.jsx)(x().sA,{...Fn.collectionSettingsJiraSyncHelpLink})})})]})}function Kn(e){const{projectCollectionStore:t,taskCollectionStore:o,integrationIconUrl:n}=e,i=(0,v().IS)((e=>({iconContainer:{display:"flex",alignItems:"center"},sourceIcon:{width:26,height:26,padding:5,borderRadius:6,gap:10,borderColor:e.border.primary,borderStyle:"solid",borderWidth:1,boxShadow:"0px 2px 4px 0px #161D1B05",..."dark"!==e.mode&&{background:`linear-gradient(0deg, ${e.text.inversePrimary}, ${e.text.inversePrimary})`}},taskArrow:{width:87,height:26,top:26},projectArrow:{width:87,height:26,top:2,border:1},arrowContainer:{display:"flex",flexFlow:"column",justifyContent:"center"},collectionIconContainer:{display:"flex",flexFlow:"column",justifyContent:"space-around",gap:12},collectionIcon:{width:88,paddingTop:4,paddingInlineEnd:6,paddingBottom:6,paddingInlineStart:6,borderRadius:6,gap:6,display:"flex",alignItems:"center",borderColor:e.border.primary,borderWidth:1,borderStyle:"solid",..."dark"!==e.mode&&{background:`linear-gradient(0deg, ${e.text.inversePrimary}, ${e.text.inversePrimary})`}},title:{fontSize:Dn,fontWeight:We().Wy.medium,lineHeight:"16px",letterSpacing:0,color:e.text.primary}})),[]);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{style:i.iconContainer,children:Nn({iconStyle:i.sourceIcon,srcUrl:n})}),(0,L.jsxs)("div",{style:i.arrowContainer,children:[Nn({iconStyle:i.projectArrow,srcUrl:Zt().A.images.externalIntegrations.externalAppToProjectsArrowPng}),Nn({iconStyle:i.taskArrow,srcUrl:Zt().A.images.externalIntegrations.externalAppToTasksArrowPng})]}),(0,L.jsxs)("div",{style:i.collectionIconContainer,children:[(0,L.jsxs)("div",{style:i.collectionIcon,children:[Un(vn().R,n),(0,L.jsx)(Cn().A,{store:t,style:i.title})]}),(0,L.jsxs)("div",{style:i.collectionIcon,children:[Un(fn().i,n),(0,L.jsx)(Cn().A,{store:o,style:i.title})]})]})]})}function Nn(e){const{iconStyle:t,srcUrl:o,altString:n}=e;return(0,L.jsx)("img",{style:t,src:o,alt:n})}function Ln(e){const{hasSyncFailed:t,isSyncing:o,integrationIconSrcUrl:n,altString:i}=e,r=(0,v().IS)((e=>({syncIcon:{width:20,height:20,display:"block",position:"relative",alignSelf:"flex-start",color:t?e.yellow.icon.accentPrimary:e.blue.icon.accentPrimary}})),[t]);return t?(0,Sn().i)(r.syncIcon):o?(0,mn().D)(r.syncIcon):(0,L.jsx)("img",{style:r.syncIcon,src:n,alt:i})}function zn({taskCollectionStore:e,collectionSettingsStore:t,isSetupComplete:o,flowId:n,isSyncOwner:i,isActiveSync:l,upsellInfo:a}){const c=(0,r().v3)(),d=(0,x().tz)(),u=(0,s().K8)((()=>e.getSchema()),[e]),p=(0,s().K8)((()=>{var t;return null===(t=e.getFormat().sync_state)||void 0===t?void 0:t.syncing}),[e]),g=(0,s().O$)(He().AppStoreSidebarSpaceStore),m=(0,s().K8)((()=>e.getFormat().bot_id),[e]),S=(0,s().K8)((()=>e.getFormat().synced_collection_external_url),[e]),y=(0,s().K8)((()=>(0,kn().p)(g)),[g]),h=(0,s().K8)((()=>(0,Co().Zf)()),[]),v=(0,s().K8)((()=>(0,Co().X7)()),[]),b=(0,s().K8)((()=>e.getFormat().synced_collection_instance_type),[e]),C="DataCenter"===b?"jira-dc":"jira",w=!(null!=a&&a.isAvailable),j=(0,s().K8)((()=>{var t;return null===(t=e.getFormat().sync_state)||void 0===t?void 0:t.filter_config}),[e]),_=(0,s().K8)((()=>(0,Co().yX)()),[])&&!y&&"Cloud"===b||"DataCenter"===b&&(!v||!y&&!h);let I=0;for(const r in u){var k;null!==(k=u[r])&&void 0!==k&&k.derived_property_record_metadata&&I++}let T=d.formatMessage(Fn.accountDisconnectedTooltip);return Boolean(p)?T=d.formatMessage(Fn.importInProgressToolTip):_?T=d.formatMessage(Fn.jiraSyncSourceDisabledTooltip):w&&null!=a&&a.upsellTier&&(T=d.formatMessage(Fn.featureUnavailableTooltip,{upsellTier:a.upsellTier})),o?(0,L.jsx)(A().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"Data synced from Jira",id:"database.viewSettings.collectionSettingsExternalSource.titleStringForSyncedData"}),children:(0,L.jsx)(at().A,{disableTooltip:!Boolean(p)&&l&&!_&&!w,renderTooltip:e=>(0,L.jsx)("div",{...e,style:ct().Q$,children:T}),render:o=>(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(so().A,{...o,icon:vn().R,disabled:Boolean(p)||!l||_||w,onClick:()=>{D().a2({collectionSettingsStore:t,item:{type:"externalProjectsSyncSettings",source:"external_list_projects"}}),(0,f().u)({environment:c,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:C,actionType:"select_projects_cta_click",flowId:n,identifier:S,botId:m,collectionId:e.id,isSyncOwner:i}}})},showChevron:!0,title:(0,L.jsx)(x().sA,{defaultMessage:"Projects",id:"database.viewSettings.collectionSettingsExternalSource.projects"})}),(0,L.jsx)(so().A,{...o,icon:yn().n,disabled:Boolean(p)||!l||_||w,onClick:()=>{D().a2({collectionSettingsStore:t,item:{type:"externalProjectsSyncSettings",source:"external_list_task_properties",action:oe().Sh.SyncAdditionalProperties,selectedProjectKeys:[],projectIssueCounts:{}}}),(0,f().u)({environment:c,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:C,actionType:"select_properties_cta_click",flowId:n,identifier:S,botId:m,collectionId:e.id,isSyncOwner:i}}})},right:(0,L.jsx)(x().sA,{id:"database.viewSettings.collectionSettingsExternalSource.syncedPropertiesCount",defaultMessage:"{syncedPropertiesCountString}",values:{syncedPropertiesCountString:I.toString()}}),showChevron:!0,title:(0,L.jsx)(x().sA,{defaultMessage:"Task Properties",id:"database.viewSettings.collectionSettingsExternalSource.taskProperties"})}),j?(0,L.jsx)(so().A,{...o,icon:hn().filterIcon,disabled:Boolean(p)||!l||_||w,onClick:()=>{D().a2({collectionSettingsStore:t,item:{type:"externalProjectsSyncSettings",source:"external_list_filters",action:oe().Sh.SyncAdditionalProperties,selectedProjectKeys:[],selectedProperties:[]}}),(0,f().u)({environment:c,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:C,actionType:"select_filters_cta_click",flowId:n,identifier:S,botId:m,collectionId:e.id,isSyncOwner:i}}})},showChevron:!0,title:(0,L.jsx)(x().sA,{defaultMessage:"Filters",id:"database.viewSettings.collectionSettingsExternalSource.filters"})}):void 0]})})}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(A().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"Step 1",id:"database.viewSettings.collectionSettingsExternalSource.setupProjects"}),children:(0,L.jsx)("div",{style:{margin:"6px 14px 0px"},children:(0,L.jsx)(M().A,{colorPalette:"blue",style:{width:"100%"},onClick:()=>{D().a2({collectionSettingsStore:t,item:{type:"externalProjectsSyncSettings",source:"external_list_projects"}}),(0,f().u)({environment:c,event:{eventName:"external_sync_sidebar_config",eventProperties:{integration:C,actionType:"select_projects_cta_click",flowId:n,identifier:S,botId:m,collectionId:e.id,isSyncOwner:i}}})},disabled:_,children:(0,L.jsx)(x().sA,{defaultMessage:"Select projects to sync",id:"database.viewSettings.collectionSettingsExternalSource.syncProjectsButton"})})})}),(0,L.jsx)(A().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"Step 2",id:"database.viewSettings.collectionSettingsExternalSource.setupProperties"}),children:(0,L.jsx)("div",{style:{margin:"6px 14px 0px"},children:(0,L.jsx)(M().A,{colorPalette:"blue",style:{width:"100%"},disabled:!0,children:(0,L.jsx)(x().sA,{defaultMessage:"Select properties to sync",id:"database.viewSettings.collectionSettingsExternalSource.syncPropertiesButton"})})})})]})}function Un(e,t){const o=(0,v().IS)((e=>({sourceIcon:{width:10,height:10,padding:2,borderRadius:3,gap:10,position:"absolute",borderColor:e.border.primary,borderStyle:"solid",borderWidth:1,insetInlineEnd:-3,bottom:-3,boxShadow:"0px 2px 4px 0px #161D1B05",..."light"===e.mode&&{background:`linear-gradient(0deg, ${e.text.inversePrimary}, ${e.text.inversePrimary})`},display:"flex",alignItems:"center",justifyContent:"center"},baseIcon:{height:F().Ev.sm,width:F().Ev.sm,color:e.icon.secondary},overlayIntegrationIcon:{height:5,width:5}})),[]);return(0,L.jsxs)("div",{style:{position:"relative"},children:[e(o.baseIcon,void 0,void 0,"all"),(0,L.jsx)("div",{style:o.sourceIcon,children:Nn({iconStyle:o.overlayIntegrationIcon,srcUrl:t})})]})}function Wn(){const{isMobile:e}=(0,r().Y0)();return(0,v().IS)((t=>({collectionSettingsExternalSourceTitle:{fontSize:e?14:12,color:t.text.secondary},preview:{paddingTop:12,paddingInlineEnd:36,paddingBottom:12,paddingInlineStart:30,background:t.background.secondary,display:"flex",justifyContent:"flex-start",marginInlineStart:14,marginInlineEnd:14,borderRadius:6,marginBottom:24},container:{marginInlineStart:12,marginInlineEnd:12},insetDividerContainer:{marginTop:12,marginBottom:12,marginInlineStart:12,marginInlineEnd:12},lastSyncText:{fontSize:e?14:12,color:t.text.secondary,fontWeight:We().Wy.regular,textAlign:"start",lineHeight:"16px",marginTop:6},syncFailedRow:{display:"flex",alignItems:"center",gap:8,marginInlineStart:8},syncFailedText:{fontSize:e?14:12,fontWeight:We().Wy.regular,textAlign:"start",marginInlineStart:8,lineHeight:"16px",marginBottom:6,marginTop:6,color:t.yellow.icon.accentPrimary},syncFailedTextInRow:{fontSize:e?14:12,fontWeight:We().Wy.regular,textAlign:"start",marginInlineStart:0,lineHeight:"16px",marginBottom:6,marginTop:6,color:t.yellow.icon.accentPrimary},reauthSyncFailedText:{fontSize:e?14:12,fontWeight:We().Wy.regular,textAlign:"start",marginInlineStart:0,lineHeight:"16px",marginBottom:6,marginTop:6,color:t.yellow.icon.accentPrimary},reconnectButton:{width:"-webkit-fill-available",marginInlineStart:8,marginInlineEnd:8,marginTop:8,gap:4,fontWeight:We().Wy.medium,padding:16},addFilterButton:{width:"-webkit-fill-available",marginTop:8,gap:4},captionText:{fontSize:e?14:12,color:t.text.secondary,fontWeight:We().Wy.regular,textAlign:"start"},sourceSectionTitle:{textAlign:"start",color:t.text.secondary,paddingTop:0,paddingInlineStart:4,paddingInlineEnd:4},siteButtonContainer:{margin:"0px 8px",gap:2,borderRadius:6,borderStyle:"solid",borderWidth:1,borderColor:t.border.secondary},siteButton:{padding:"8px",borderRadius:6,display:"flex",width:"100%"},siteButtonTextContainer:{gap:8,display:"flex",alignItems:"flex-start"},siteTextColumn:{display:"flex",flexFlow:"column",gap:1,flex:1,minWidth:0},siteIcon:{width:20,height:20,display:"block",alignSelf:"flex-start",padding:2},siteNameText:{fontSize:e?16:14,fontWeight:We().Wy.medium,lineHeight:"20px",letterSpacing:"0.15px",color:t.text.primary,paddingTop:1},siteNameSecondaryText:{fontSize:e?14:12,color:t.text.secondary,fontWeight:We().Wy.regular,textAlign:"start",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",lineHeight:e?"20px":"16px"},lockedIcon:{width:14,height:14,color:t.icon.secondary},emptyViewWrap:{paddingBlockEnd:42,paddingInline:12},wrap:{display:"flex",flexDirection:"column"},showMoreButtonContainer:{marginInlineStart:12,marginBottom:12,marginInlineEnd:"auto"},showMoreButtonContent:{fontSize:12},noResultsTitle:{color:t.text.secondary,fontSize:12,margin:0},learnMoreText:{width:"100%",paddingInlineStart:8,paddingInlineEnd:8,color:t.text.secondary,paddingTop:16,paddingBottom:16,marginTop:4,marginBottom:4}})),[e])}function Hn({propertyNames:e,styles:t}){let o="";return o=1===e.length?e[0]:`${e[0]} and ${e.length-1} other`,(0,L.jsx)("div",{style:t,children:(0,L.jsx)(x().sA,{...Fn.propertyLimitWarning,values:{propertyNames:o,fieldFields:1===e.length?"field":"fields"}})})}function Gn(e){const{collectionSettingsStore:t,collectionContextStore:o,tabSettings:n}=e;if("external_source"===n.source)return(0,L.jsx)(En,{...e,collectionSettingsStore:t,collectionContextStore:o,openedFrom:n.openedFrom});if("external_list_projects"===n.source)return(0,L.jsx)(Go,{collectionSettingsStore:t,collectionContextStore:o});if("external_list_task_properties"===n.source){const{action:e,selectedProjectKeys:i,projectIssueCounts:r}=n;return(0,L.jsx)(sn,{collectionSettingsStore:t,collectionContextStore:o,action:e,selectedProjectKeys:i,projectIssueCounts:r})}if("external_list_filters"===n.source){const{action:e,selectedProjectKeys:i,selectedProperties:r}=n;return(0,L.jsx)(Ao,{collectionSettingsStore:t,collectionContextStore:o,action:e,selectedProjectKeys:i,selectedProperties:r})}return null}var $n=()=>o(906745),Qn=()=>o(443191),Yn=()=>o(274570),qn=()=>o(62616),Jn=()=>o(675326),Xn=()=>o(18953),Zn=()=>o(406533);const ei={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 13.76 13.75",svg:(0,L.jsx)("path",{d:"M3.75 13.136c.345 0 .625.28.625.625v.989c0 .483.392.875.875.875h.99a.625.625 0 1 1 0 1.25h-.99a2.125 2.125 0 0 1-2.125-2.125v-.99c0-.344.28-.624.625-.624m7.24 2.489a.625.625 0 0 1 0 1.25H9.01a.625.625 0 1 1 0-1.25zm5.26-2.489c.345 0 .625.28.625.625v.989a2.125 2.125 0 0 1-2.125 2.125h-.99a.625.625 0 0 1 0-1.25h.99a.875.875 0 0 0 .875-.875v-.99c0-.344.28-.624.625-.624m-4.446-5.797a.625.625 0 0 1 1.072.642l-3 5a.626.626 0 0 1-1.01.085l-2-2.333a.625.625 0 0 1 .948-.813l1.436 1.675zM3.75 8.386c.345 0 .625.28.625.625v1.978a.625.625 0 0 1-1.25 0V9.011c0-.345.28-.625.625-.625m12.5 0c.345 0 .625.28.625.625v1.978a.625.625 0 0 1-1.25 0V9.011c0-.345.28-.625.625-.625M6.24 3.125a.625.625 0 1 1 0 1.25h-.99a.875.875 0 0 0-.875.875v.99a.625.625 0 1 1-1.25 0v-.99c0-1.174.951-2.125 2.125-2.125zm8.51 0c1.174 0 2.125.951 2.125 2.125v.99a.625.625 0 1 1-1.25 0v-.99a.875.875 0 0 0-.875-.875h-.99a.625.625 0 0 1 0-1.25zm-3.76 0a.625.625 0 0 1 0 1.25H9.01a.625.625 0 1 1 0-1.25z"})},ti=(0,F().wt)("squareDashedCheck",ei);var oi=()=>o(42583),ni=()=>o(781697),ii=()=>o(916727),ri=()=>o(417392),li=()=>o(799829),si=()=>o(179034),ai=()=>o(950914),ci=()=>o(201980),di=()=>o(450859),ui=()=>o(148832),pi=()=>o(778708);var gi=()=>o(96689),mi=()=>o(854150),Si=()=>o(235059),yi=()=>o(601734);const fi="https://www.notion.so/help/sprints",hi=[1,2,3,4,5,6,7,8],vi={1:{key:"one_week",value:1},2:{key:"two_weeks",value:2},3:{key:"three_weeks",value:3},4:{key:"four_weeks",value:4},5:{key:"five_weeks",value:5},6:{key:"six_weeks",value:6},7:{key:"seven_weeks",value:7},8:{key:"eight_weeks",value:8}},xi={MO:"Monday",TU:"Tuesday",WE:"Wednesday",TH:"Thursday",FR:"Friday",SA:"Saturday",SU:"Sunday"},bi=(0,x().YK)({sprintsMenuTitle:{id:"sprintSettingsMenu.label",defaultMessage:"Sprints"},setupSprintsTitle:{id:"sprintSettingsMenu.setupSprints.label",defaultMessage:"Set up sprints"},setupSprintsCaption:{id:"sprintSettingsMenu.setupSprints.caption",defaultMessage:"Use sprints to regularly tackle a group of tasks in a recurring, set amount of time."},setupSprintsTeamspaceStatement:{id:"sprintSettingsMenu.setupSprintsTeamspaceStatement.caption",defaultMessage:"We’ll also add to your teamspace:"},setupSprintsSprintBoardPageStatement:{id:"sprintSettingsMenu.setupSprintsSprintBoardPageStatement.caption",defaultMessage:"<bold>Sprint board</bold>: To manage tasks and plan your work"},setupSprintsSprintsDatabaseStatement:{id:"sprintSettingsMenu.setupSprintsSprintsDatabaseStatement.caption",defaultMessage:"<bold>Sprints database</bold>: To keep a historical record of what you accomplished"},manual:{id:"sprintSettingsMenu.manual.label",defaultMessage:"Manual"},automatic:{id:"sprintSettingsMenu.automatic.label",defaultMessage:"Auto"},off:{id:"sprintSettingsMenu.off.label",defaultMessage:"Off"},completeSprintNextSprintActionMenuOptionText:{id:"sprintSettingsMenu.remainingTasks.moveToNextSprintOption.label",defaultMessage:"Move to next sprint"},completeSprintNextSprintActionSelectedText:{id:"sprintSettingsMenu.remainingTasks.moveToNextSprintOption.selected.label",defaultMessage:"Next sprint"},completeSprintBacklogActionMenuOptionText:{id:"sprintSettingsMenu.remainingTasks.moveToBacklogOption.label",defaultMessage:"Move to backlog"},completeSprintBacklogActionSelectedText:{id:"sprintSettingsMenu.remainingTasks.moveToBacklogOption.selected.label",defaultMessage:"Backlog"},completeSprintKeepInCurrentSprintActionMenuOptionText:{id:"sprintSettingsMenu.remainingTasks.keepInCurrentSprint.label",defaultMessage:"Keep in current sprint"},completeSprintKeepInCurrentSprintActionSelectedText:{id:"sprintSettingsMenu.remainingTasks.keepInCurrentSprint.selected.label",defaultMessage:"Current sprint"},automatedSprintsToggleTitle:{id:"sprintSettingsMenu.automatedSprintsToggle.label",defaultMessage:"Automated sprints"},automatedSprintsToggleCaption:{id:"sprintSettingsMenu.automatedSprintsToggle.caption",defaultMessage:"Sprints complete automatically before the start of the next sprint."},duration:{id:"sprintSettingsMenu.duration.label",defaultMessage:"Duration"},durationMenuOptionText:{id:"sprintSettingsMenu.duration.option.label",defaultMessage:"{durationValue, plural, one {1 week} other {{durationValue} weeks}}"},startOn:{id:"sprintSettingsMenu.startOn.label",defaultMessage:"Start on"},weekdayOption:{id:"sprintSettings.weekdayOption.label",defaultMessage:"{weekdayName}s"},incompleteTasks:{id:"sprintSettingsMenu.incompleteTasks.label",defaultMessage:"Incomplete tasks"},turnOnSprints:{id:"sprintSettingsMenu.turnOnSprints.button.label",defaultMessage:"Turn on sprints"},turnOffSprints:{id:"sprintSettingsMenu.turnOffSprints.button.label",defaultMessage:"Turn off sprints"},turnOffSprintsModalTitle:{id:"sprintSettingsMenu.turnOffSprints.modal.title.label",defaultMessage:"Turn off sprints?"},turnOffSprintsModalNoSprintBoardsDescription:{id:"sprintSettingsMenu.turnOffSprints.modal.default.description",defaultMessage:"This will delete your sprints database and its linked views."},turnOffSprintsModalWithSprintBoardsDescription:{id:"sprintSettingsMenu.turnOffSprints.modal.withSprintBoards.description",defaultMessage:"This will delete your sprint board(s), sprints database and its linked views."},turnOffAndDeleteModalButton:{id:"sprintSettingsMenu.turnOffAndDeleteModal.button.label",defaultMessage:"Turn off and delete"},learnSprintsTitle:{id:"sprintSettingsMenu.learnSprints.button.label",defaultMessage:"Learn about sprints"},manageSprintFromThisView:{id:"sprintSettingsMenu.manageSprintFromThisView.label",defaultMessage:"Manage sprint from this view"},manageSprintFromThisViewModalTitle:{id:"sprintSettingsMenu.manageSprintFromThisView.modal.title.label",defaultMessage:"Manage sprint from this view?"},manageSprintFromThisViewModalButton:{id:"sprintSettingsMenu.manageSprintFromThisView.button.label",defaultMessage:"Update view"},manageSprintFromThisViewModalAutomaticSprintCompletionDescription:{id:"sprintSettingsMenu.manageSprintFromThisView.modal.automaticSprintCompletion.description",defaultMessage:"The view will be updated with filters for the current sprint."},manageSprintFromThisViewModalManualSprintCompletionDescription:{id:"sprintSettingsMenu.manageSprintFromThisView.modal.manualSprintCompletion.description",defaultMessage:"The view will be updated with filters for the current sprint and a button to complete sprints will be displayed."},sprintStartDateToday:{id:"sprintSettingsMenu.sprintStartDateToday",defaultMessage:"Next sprint starts <time>today</time>}"},sprintStartDateFuture:{id:"sprintSettingsMenu.sprintStartDateFuture",defaultMessage:"Next sprint starts in {days} {days, plural, one {day} other {days}} <time>({formattedDate}</time>)"},sprintStartDateShouldStartPast:{id:"sprintSettingsMenu.sprintStartDateShouldStartPast",defaultMessage:"Next sprint should have started {days} {days, plural, one {day} other {days}} ago <time>({formattedDate})</time>"},sprintStartDateShouldStartToday:{id:"sprintSettingsMenu.sprintStartDateShouldStartToday",defaultMessage:"Next sprint should start <time>today</time>"},sprintStartDateShouldStartFuture:{id:"sprintSettingsMenu.sprintStartDateShouldStartFuture",defaultMessage:"Next sprint should start in {days} {days, plural, one {day} other {days}} <time>({formattedDate})</time>"}}),Ci={complete_sprint_and_move_incomplete_tasks_to_next_sprint:{menuOptionText:bi.completeSprintNextSprintActionMenuOptionText,selectedText:bi.completeSprintNextSprintActionSelectedText},complete_sprint_and_move_incomplete_tasks_to_backlog:{menuOptionText:bi.completeSprintBacklogActionMenuOptionText,selectedText:bi.completeSprintBacklogActionSelectedText},complete_sprint:{menuOptionText:bi.completeSprintKeepInCurrentSprintActionMenuOptionText,selectedText:bi.completeSprintKeepInCurrentSprintActionSelectedText}};function wi(e){return(0,L.jsx)(x().sA,{...Ci[e.completeSprintAction].menuOptionText})}function ji(e){return(0,L.jsx)(x().sA,{...Ci[e.completeSprintAction].selectedText})}function Ai(e){const{weekday:t}=e;return(0,L.jsx)(x().sA,{...bi.weekdayOption,values:{weekdayName:xi[t]}})}function _i(e){return vi[e]}function Ii(e){const{sprintDurationValue:t}=e;return(0,L.jsx)(x().sA,{...bi.durationMenuOptionText,values:{durationValue:vi[t].value}})}function ki(e){const{numOfSprintBoards:t}=e;return t>0?(0,L.jsx)(x().sA,{...bi.turnOffSprintsModalWithSprintBoardsDescription}):(0,L.jsx)(x().sA,{...bi.turnOffSprintsModalNoSprintBoardsDescription})}function Mi(e){const{automaticSprintCompletionEnabled:t}=e;return t?(0,L.jsx)(x().sA,{...bi.manageSprintFromThisViewModalAutomaticSprintCompletionDescription}):(0,L.jsx)(x().sA,{...bi.manageSprintFromThisViewModalManualSprintCompletionDescription})}function Ti(e){const{collectionContextStore:t,collectionSettingsStore:o,from:i}=e,{sprintSettingsConfig:l,currentSprintDateRange:a,sprintSettingsPermissionsContext:c,sprintSettingsConfigUpdater:d,turnOffSprints:u,turnOnSprints:p,automaticSprintCompletionEnabled:g,canManageSprintFromThisView:m,manageSprintFromThisView:y}=function(e){var t;const{collectionContextStore:o,from:i}=e,l=(0,r().v3)(),a=(0,s().K8)((()=>o.sprintSettingsContextStore.state),[o.sprintSettingsContextStore]),c=(0,s().K8)((()=>null==a?void 0:a.permissionsContext),[a]),d=(0,s().K8)((()=>{var e;return Boolean(null==a||null===(e=a.automationContext)||void 0===e?void 0:e.automationStore.isActive())}),[null==a||null===(t=a.automationContext)||void 0===t?void 0:t.automationStore]),u=(0,s().K8)((()=>{var e;return o.collectionStore()===(null==a?void 0:a.taskCollectionStore)&&(null===(e=o.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri)!==pn().Lu}),[o,null==a?void 0:a.taskCollectionStore]),[p,g]=(0,n.useState)(void 0);(0,n.useEffect)((()=>{!async function(){if(g(void 0),!a)return;const{sprintCollectionViewBlockStore:e,sprintCollectionStore:t}=a;if(!e||!t)return;const o=t.getSchema(),n=li().n$[pn().av].current.reducer,i=await di().mA(l,{source:"automation",parentRecordStore:e,collectionPointer:t.getSpaceShardedPointer(),filter:n.getCombinatorFilter(o),limit:1});et().Q.isFail(i)||g(i.value.blockIds[0])}()}),[l,a]);const m=(0,s().K8)((()=>{const e=null==a?void 0:a.sprintCollectionViewBlockStore;if(e&&p)return ui().B.createChildStore(e,{id:p,table:si().ev,spaceId:e.getSpaceId()})}),[p,null==a?void 0:a.sprintCollectionViewBlockStore]),y=(0,s().K8)((()=>{if(!m)return;const e=m.getPropertyValue(pn().Hx.Dates);if(!e)return;const t=(0,ci().Cok)(e)[0];return t&&"daterange"===t.type?t:void 0}),[m]),f=(0,s().K8)((()=>{var e,t,o;if(!a)return;const n=(null===(e=a.automationContext)||void 0===e||null===(e=e.automationActionStore.getConfig())||void 0===e?void 0:e.complete_sprint_action)??ai().AL.actionConfig.complete_sprint_action,i=Boolean(null===(t=a.automationContext)||void 0===t?void 0:t.automationStore.isActive()),r=null===(o=a.automationContext)||void 0===o?void 0:o.automationStore.getRecurrence();return{autoCompleteSprints:i,actionConfig:{complete_sprint_action:n},recurrenceConfig:{interval:(null==r?void 0:r.interval)??ai().AL.recurrenceConfig.interval,weekdays:(null==r?void 0:r.weekdays)??ai().AL.recurrenceConfig.weekdays}}}),[a]),h=(0,s().K8)((()=>(0,b().O9)(m)&&(0,b().O9)(f)),[m,f]),v=n.useCallback((e=>{h&&S().createAndCommit({userAction:"useSprintSettings.updateSprintSettingsConfig",environment:l,canUndo:!0,perform:t=>{a&&a.sprintCollectionStore&&a.automationContext&&m&&pi().e_({environment:l,transaction:t,automationStore:a.automationContext.automationStore,currentSprintBlockStore:m,newDuration:e})}})}),[h,m,l,a]),x=n.useCallback((e=>{h&&S().createAndCommit({userAction:"useSprintSettings.updateSprintSettingsConfig",environment:l,canUndo:!0,perform:t=>{a&&a.sprintCollectionStore&&a.automationContext&&m&&pi().g4({environment:l,transaction:t,automationStore:a.automationContext.automationStore,currentSprintBlockStore:m,newWeekday:e})}})}),[h,m,l,a]),C=n.useCallback((e=>{h&&S().createAndCommit({userAction:"useSprintSettings.updateSprintSettingsConfig",environment:l,canUndo:!0,perform:t=>{a&&a.sprintCollectionStore&&a.automationContext&&m&&pi().U2({environment:l,transaction:t,automationStore:a.automationContext.automationStore,actionStore:a.automationContext.automationActionStore,currentSprintBlockStore:m,newAutocompleteStatus:e})}})}),[h,m,l,a]),w=n.useCallback((e=>{h&&S().createAndCommit({userAction:"useSprintSettings.updateSprintSettingsConfig",environment:l,canUndo:!0,perform:t=>{a&&a.sprintCollectionStore&&a.automationContext&&pi().qy({transaction:t,actionStore:a.automationContext.automationActionStore,newRemainingTasksBehavior:e})}})}),[h,l,a]),j=n.useCallback((async()=>{await pi().c({environment:l,collectionContextStore:o,from:i})}),[l,o,i]),A=n.useCallback((async e=>{a&&await pi().eN({environment:l,collectionContextStore:o,sprintSettingsContext:a,sprintBoardViewBlockIds:e})}),[o,l,a]),_=n.useCallback((()=>{a&&pi().Zk({environment:l,collectionContextStore:o,currentViewBlockStore:a.currentCollectionViewBlockStore,taskCollectionViewBlockStore:a.taskCollectionViewBlockStore})}),[o,l,a]);return{sprintSettingsConfig:f,sprintSettingsPermissionsContext:c,turnOnSprints:j,turnOffSprints:A,automaticSprintCompletionEnabled:d,canManageSprintFromThisView:u,currentSprintDateRange:y,manageSprintFromThisView:_,sprintSettingsConfigUpdater:{canUpdateSprintSettingsConfig:h,handleSprintDurationChange:v,handleSprintStartWeekdayChange:x,handleSprintAutoCompleteChange:C,handleSprintRemainingTasksBehaviorChange:w}}}({collectionContextStore:t,collectionSettingsStore:o,from:i});if(!c||!c.canEdit||!l)return null;let f;return f=c.sprintsEnabled?(0,L.jsx)(Pi,{...e,updateSprintSettingsConfig:d,onTurnOffSprints:u,automaticSprintCompletionEnabled:g,currentSprintDateRange:a,canManageSprintFromThisView:m,onManageSprintFromThisView:y,sprintSettingsConfig:l}):(0,L.jsx)(Bi,{...e,onTurnOnSprints:p}),f}function Pi(e){const{sprintSettingsConfig:t,automaticSprintCompletionEnabled:o,currentSprintDateRange:n,canManageSprintFromThisView:i,updateSprintSettingsConfig:r,collectionContextStore:l,onTurnOffSprints:s,onManageSprintFromThisView:a}=e,c=[];return c.push((0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)(A().A,{topBorder:!0,disableMobileBorders:!0,children:[i?(0,L.jsx)(Ki,{automaticSprintCompletionEnabled:o,manageSprintFromThisView:a}):void 0,(0,L.jsx)(Oi,{turnOffSprints:s,collectionContextStore:l})]},"turn-off-sprints-section"),(0,L.jsx)(A().A,{topBorder:!0,children:(0,L.jsx)(ko().N,{href:fi,external:!0,children:(0,L.jsx)(so().A,{icon:Zn().questionMarkCircleIcon,title:(0,L.jsx)(x().sA,{...bi.learnSprintsTitle}),isGray:!0})})})]})),(0,L.jsxs)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{...bi.sprintsMenuTitle}),footer:c,children:[(0,L.jsx)(Fi,{automaticSprintCompletionEnabled:o,currentSprintDateRange:n}),(0,L.jsxs)(A().A,{children:[(0,L.jsx)(Li,{onChange:r.handleSprintDurationChange,disabled:!r.canUpdateSprintSettingsConfig,sprintSettingsConfig:t}),(0,L.jsx)(zi,{onChange:r.handleSprintStartWeekdayChange,disabled:!r.canUpdateSprintSettingsConfig,sprintSettingsConfig:t}),(0,L.jsx)(Ui,{onChange:r.handleSprintRemainingTasksBehaviorChange,disabled:!r.canUpdateSprintSettingsConfig,sprintSettingsConfig:t})]}),(0,L.jsx)(A().A,{topBorder:!0,children:(0,L.jsx)(Ni,{onChange:r.handleSprintAutoCompleteChange,sprintSettingsConfig:t})})]})}function Bi(e){const{onTurnOnSprints:t}=e,o=Gi(),n=[];return n.push((0,L.jsx)(A().A,{disableMobileBorders:!0,children:(0,L.jsx)("div",{style:o.buttonWrap,children:(0,L.jsx)(M().A,{colorPalette:"blue",style:o.button,onClick:async()=>{await t()},size:"lg",children:(0,L.jsx)(x().sA,{...bi.turnOnSprints})})})},"turn-on-sprints-section")),(0,L.jsx)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{...bi.setupSprintsTitle}),footer:n,children:(0,L.jsxs)(A().A,{disableMobileBorders:!0,children:[(0,L.jsx)(Vi,{}),(0,L.jsx)(Di,{}),(0,L.jsx)(Ei,{})]})})}function Fi(e){const{automaticSprintCompletionEnabled:t,currentSprintDateRange:o}=e,n=Gi();if(!o)return null;const i=$n().c9.fromISO(o.end_date).plus({days:1});return(0,L.jsx)(ii().F,{style:n.sprintStartDateHeader,children:(0,L.jsx)(Hi,{nextSprintStartDate:i,automaticSprintCompletionEnabled:t})})}function Vi(){const e=Gi();return(0,L.jsx)("div",{style:{...e.menuDescriptionContainer,...e.menuDescriptionText},children:(0,L.jsx)(x().sA,{...bi.setupSprintsCaption})})}function Di(){const e=Gi();return(0,L.jsx)("div",{style:e.mediaWrap,children:(0,L.jsx)("img",{src:Zt().A.images.appPackages.sprintsTurnOnPreviewPng,style:e.media})})}function Ei(){const e=Gi(),t=t=>(0,L.jsx)("span",{style:e.boldText,children:t});return(0,L.jsxs)("div",{style:e.disclaimerWrap,children:[(0,L.jsx)("div",{children:(0,L.jsx)(x().sA,{...bi.setupSprintsTeamspaceStatement})}),(0,L.jsx)(Ri,{text:(0,L.jsx)(x().sA,{...bi.setupSprintsSprintBoardPageStatement,values:{bold:t}}),icon:Xn().H}),(0,L.jsx)(Ri,{text:(0,L.jsx)(x().sA,{...bi.setupSprintsSprintsDatabaseStatement,values:{bold:t}}),icon:qn().c})]})}function Ri(e){const{text:t,icon:o}=e,n=Gi();return(0,L.jsxs)("div",{style:n.disclaimerSubitem,children:[(0,L.jsx)("div",{children:o(n.disclaimerSubitemIcon)}),(0,L.jsx)("div",{children:t})]})}function Oi(e){const{collectionContextStore:t,turnOffSprints:o}=e,n=(0,r().v3)(),i=(0,s().K8)((()=>t.sprintSettingsContextStore.state),[t.sprintSettingsContextStore]),[{value:l}]=(0,qe().Yb)((async()=>{if(null==i||!i.taskCollectionStore||null==i||!i.taskCollectionViewBlockStore)return;const e=await async function(e){var t;const{environment:o,collectionStore:n,collectionViewBlockStore:i}=e,{appConfigs:r}=await yi().Aw.load(),l=i.getSpaceId(),s=i.getParentStore(),a=null===(t=n.getFormat())||void 0===t?void 0:t.app_config_uri,c=a&&(0,Si().l)(r(),a);if(!s||s.table!==gi().NX&&s.table!==si().ev&&s.table!==mi().yK||!c)return;const d=await kt().callApi({eventName:"getSprintBoardViewBlocks",environment:o,data:{spaceId:l,taskCollectionId:n.id,parentId:s.id,parentTable:s.table}});return"success"===(null==d?void 0:d.type)?d.data.result:[]}({environment:n,collectionStore:i.taskCollectionStore,collectionViewBlockStore:i.taskCollectionViewBlockStore});return e}),[n,null==i?void 0:i.taskCollectionStore,null==i?void 0:i.taskCollectionViewBlockStore]),a=Gi();return(0,L.jsx)(so().A,{icon:G().trashIcon,title:(0,L.jsx)(x().sA,{...bi.turnOffSprints}),isRed:!0,onClick:()=>{Ro().ui({description:(0,L.jsx)(ki,{numOfSprintBoards:l?l.length:0}),message:(0,L.jsx)("div",{style:a.modalTitle,children:(0,L.jsx)(x().sA,{...bi.turnOffSprintsModalTitle})}),innerStyle:a.modalInnerStyle,showCancel:!0,keepFocus:!0,items:[{label:(0,L.jsx)(x().sA,{...bi.turnOffAndDeleteModalButton}),color:"red",onAccept:async()=>{await o(l??[])}}]})}})}function Ki(e){const{automaticSprintCompletionEnabled:t,manageSprintFromThisView:o}=e,n=Gi();return(0,L.jsx)(so().A,{icon:Jn().S,title:(0,L.jsx)(x().sA,{...bi.manageSprintFromThisView}),onClick:()=>{Ro().ui({description:(0,L.jsx)(Mi,{automaticSprintCompletionEnabled:t}),message:(0,L.jsx)("div",{style:n.modalTitle,children:(0,L.jsx)(x().sA,{...bi.manageSprintFromThisViewModalTitle})}),innerStyle:n.modalInnerStyle,showCancel:!0,keepFocus:!0,items:[{label:(0,L.jsx)(x().sA,{...bi.manageSprintFromThisViewModalButton}),color:"blue",onAccept:o}]})}})}function Ni(e){const{onChange:t,sprintSettingsConfig:o}=e;return(0,L.jsx)(jn().A,{title:(0,L.jsx)(x().sA,{...bi.automatedSprintsToggleTitle}),caption:(0,L.jsx)(x().sA,{...bi.automatedSprintsToggleCaption}),focused:!1,on:o.autoCompleteSprints,onClick:()=>{t(!o.autoCompleteSprints)},style:{alignItems:void 0},icon:(0,L.jsx)(W().I,{icon:Qn().J}),shouldWrapCaption:!0})}function Li(e){const{onChange:t,sprintSettingsConfig:o,disabled:n}=e,i=_i(o.recurrenceConfig.interval),r=hi.map((e=>_i(e)));return(0,L.jsx)(Wi,{title:(0,L.jsx)(x().sA,{...bi.duration}),right:(0,L.jsx)(Ii,{sprintDurationValue:i.value}),icon:Yn().clockIcon,getMenuItems:e=>r.map((o=>{const r={key:o.key,render:e=>(0,L.jsx)(Q().A,{...e,disabled:n,title:(0,L.jsx)(Ii,{sprintDurationValue:o.value}),isChecked:o.key===i.key}),action:()=>{t(o.value),e.close()}};return r})),showChevron:!0})}function zi(e){const{onChange:t,sprintSettingsConfig:o,disabled:n}=e,i=o.recurrenceConfig.weekdays[0],r=["SU","MO","TU","WE","TH","FR","SA"];return(0,L.jsx)(Wi,{title:(0,L.jsx)(x().sA,{...bi.startOn}),icon:oi().D,right:(0,L.jsx)(Ai,{weekday:i}),getMenuItems:e=>r.map((o=>{const r={key:o,render:e=>(0,L.jsx)(Q().A,{...e,disabled:n,title:(0,L.jsx)(Ai,{weekday:o}),isChecked:o===i}),action:()=>{t(o),e.close()}};return r})),showChevron:!0})}function Ui(e){const{onChange:t,sprintSettingsConfig:o,disabled:n}=e,i=o.actionConfig.complete_sprint_action,r=["complete_sprint_and_move_incomplete_tasks_to_next_sprint","complete_sprint_and_move_incomplete_tasks_to_backlog","complete_sprint"];return(0,L.jsx)(Wi,{title:(0,L.jsx)(x().sA,{...bi.incompleteTasks}),right:(0,L.jsx)(ji,{completeSprintAction:i}),icon:ti,getMenuItems:e=>r.map((o=>{const r={key:o,render:e=>(0,L.jsx)(Q().A,{...e,disabled:n,title:(0,L.jsx)(wi,{completeSprintAction:o}),isChecked:o===i}),action:()=>{t(o),e.close()}};return r})),showChevron:!0})}function Wi(e){const{getMenuItems:t}=e,o=(0,ni().e)({width:250});return(0,L.jsx)(R().A,{popupType:h().A.isMobile?ri().nl.SlideUp:ri().nl.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",renderOrigin:t=>(0,L.jsx)(so().A,{...e,...t}),render:e=>(0,L.jsx)(O().A,{...o,children:(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,sections:[{key:0,render:e=>(0,L.jsx)(A().A,{enableActionSheetTitle:!0,...e}),items:t(e)}],initialFocus:0})})})}function Hi(e){const{nextSprintStartDate:t,automaticSprintCompletionEnabled:o}=e,n=$n().c9.local().startOf("day"),i=t.diff(n,"days").days,r=t.toLocaleString({weekday:"short",month:"short",day:"numeric"}),l=e=>(0,L.jsx)("time",{dateTime:t.toISODate(),children:e});return o?0===i?(0,L.jsx)("div",{children:(0,L.jsx)(x().sA,{...bi.sprintStartDateToday,values:{time:l}})}):(0,L.jsx)("div",{children:(0,L.jsx)(x().sA,{...bi.sprintStartDateFuture,values:{time:l,days:i,formattedDate:r}})}):i<0?(0,L.jsx)("div",{children:(0,L.jsx)(x().sA,{...bi.sprintStartDateShouldStartPast,values:{time:l,days:Math.abs(i),formattedDate:r}})}):0===i?(0,L.jsx)("div",{children:(0,L.jsx)(x().sA,{...bi.sprintStartDateShouldStartToday,values:{time:l}})}):(0,L.jsx)("div",{children:(0,L.jsx)(x().sA,{...bi.sprintStartDateShouldStartFuture,values:{time:l,days:i,formattedDate:r}})})}function Gi(){return(0,v().IS)((e=>({menuDescriptionContainer:{margin:"0px 12px"},menuDescriptionText:{fontSize:h().A.isMobile?We().J.UISmall.mobile:We().J.UISmall.desktop,color:e.text.secondary,fontWeight:We().Wy.regular,marginInlineStart:14},button:{width:"100%"},buttonWrap:{margin:"0px 12px"},disclaimerWrap:{margin:"0px 12px",fontSize:h().A.isMobile?We().J.UIRegular.mobile:We().J.UIRegular.desktop,color:e.text.secondary,fontWeight:We().Wy.regular},disclaimerSubitem:{display:"flex",margin:"8px 0px",gap:8},disclaimerSubitemIcon:{color:e.icon.tertiary,width:20,height:20,marginTop:h().A.isMobile?3:1},boldText:{color:e.text.primary,fontWeight:We().Wy.semibold},mediaWrap:{margin:"0px 12px"},media:{marginTop:15,marginInlineEnd:0,marginBottom:10,marginInlineStart:0,width:"100%",border:`1px solid ${e.border.secondaryTranslucent}`,borderRadius:"5px"},mediaIcon:{width:40,height:40,color:e.icon.tertiary},modalTitle:{fontWeight:We().Wy.semibold,fontSize:18},modalInnerStyle:{textAlign:"center"},modalReferencedPageName:{color:e.darkTextColor,fontWeight:We().Wy.semibold},sprintStartDateHeader:{color:e.text.secondary,background:e.background.secondary}})),[])}class $i extends St().Store{getInitialState(){return{pageId:void 0}}}const Qi=new $i;var Yi=()=>o(541801),qi=(o(18107),o(967357),()=>o(908006)),Ji=()=>o(851979),Xi=()=>o(987555),Zi=()=>o(738418),er=()=>o(708830),tr=()=>o(60867),or=()=>o(177618);var nr=()=>o(405417),ir=()=>o(989219),rr=()=>o(539297),lr=()=>o(564787),sr=()=>o(743472),ar=()=>o(436696),cr=()=>o(949658),dr=()=>o(908201),ur=()=>o(932704),pr=()=>o(685889),gr=()=>o(251846),mr=()=>o(989184),Sr=()=>o(585930),yr=()=>o(177148),fr=()=>o(253673),hr=()=>o(56394),vr=()=>o(606273);function xr(){const e=(0,I().X)("collection_subitem_filters");return(0,v().IS)((t=>({togglePreviewOutsideBorder:e?{margin:h().A.isMobile?0:"0 12px",border:`1px solid ${t.gray.border.secondary}`,borderRadius:4,alignItems:"center",fontWeight:We().Wy.medium,backgroundColor:t.background.primary,padding:"9px 0"}:{margin:"0px 12px",border:`1px solid ${t.regularDividerColor}`,borderRadius:4,alignItems:"center",fontWeight:We().Wy.medium,backgroundColor:t.palette.gray[30],padding:"9px 0"},card:{border:`1px solid ${t.gray.border.secondary}`,margin:"8px 16px",borderRadius:4,padding:"8px 2px"},cardFilterPill:{marginInlineStart:8},cardSubitemsContainer:{display:"flex",margin:"0px 8px",padding:2,gap:6},description:{margin:h().A.isMobile?"8px 0":"8px 12px",fontSize:h().A.isMobile?We().J.UISmall.mobile:We().J.UISmall.desktop,fontWeight:We().Wy.regular,color:t.text.secondary}})),[e])}function br(e){const{propertyName:t,subitemsDisplayMode:o,inversePropertyName:n,collectionViewType:i}=e,r=(0,I().X)("collection_subitem_filters"),l=xr(),s=(0,x().tz)();return(0,L.jsxs)(A().A,{disableMobileBorders:!0,children:[(0,L.jsx)("div",{style:l.togglePreviewOutsideBorder,children:(e=>{if("disabled"===e){if(!r)return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Tr,{itemEmoji:Rr,title:n}),(0,L.jsx)(Tr,{itemEmoji:Or,title:t}),(0,L.jsx)(Tr,{itemEmoji:Or,title:t,isLast:!0})]});switch(i){case"board":case"calendar":case"gallery":return(0,L.jsx)(Cr,{propertyName:t,inversePropertyName:n,displayMode:e});default:return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Tr,{itemEmoji:Rr,title:n}),(0,L.jsx)(Tr,{itemEmoji:Or,title:t}),(0,L.jsx)(Tr,{itemEmoji:Or,title:t,isLast:!0})]})}}if("flattened"===e){const o=r?void 0:(0,L.jsx)(Vr,{parentPropertyName:n});if(!r)return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Tr,{itemEmoji:Rr,title:n}),(0,L.jsx)(Tr,{itemEmoji:Or,title:t,right:o}),(0,L.jsx)(Tr,{itemEmoji:Or,title:t,right:o,isLast:!0})]});switch(i){case"board":case"calendar":case"gallery":return(0,L.jsx)(Cr,{propertyName:t,inversePropertyName:n,displayMode:e});default:return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Tr,{itemEmoji:Rr,title:n}),(0,L.jsx)(Tr,{itemEmoji:Or,title:t,right:o}),(0,L.jsx)(Tr,{itemEmoji:Or,title:t,right:o,isLast:!0})]})}}if("hidden"===e)return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Tr,{itemEmoji:Rr,title:n,right:(0,L.jsx)(Fr,{count:2})}),(0,L.jsx)(Tr,{itemEmoji:Kr,title:n}),(0,L.jsx)(Tr,{itemEmoji:Nr,title:n,right:(0,L.jsx)(Fr,{count:1}),isLast:!0})]});if("show"===e){if(!r)return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Tr,{itemEmoji:Rr,title:n,left:(0,L.jsx)(Pr,{isIndented:!1,isOpen:!0})}),(0,L.jsx)(Tr,{itemEmoji:Or,title:t,left:(0,L.jsx)(Pr,{isIndented:!0,isOpen:!1})}),(0,L.jsx)(Tr,{itemEmoji:Or,title:t,left:(0,L.jsx)(Pr,{isIndented:!0,isOpen:!1}),isLast:!0})]});switch(i){case"board":case"calendar":case"gallery":return(0,L.jsx)(Cr,{propertyName:t,displayMode:e,inversePropertyName:n});default:return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Tr,{itemEmoji:Rr,title:n,left:(0,L.jsx)(Pr,{isIndented:!1,isOpen:!0})}),(0,L.jsx)(Tr,{itemEmoji:Or,title:t,left:(0,L.jsx)(Pr,{isIndented:!0,isOpen:!1})}),(0,L.jsx)(Tr,{itemEmoji:Or,title:t,left:(0,L.jsx)(Pr,{isIndented:!0,isOpen:!1}),isLast:!0})]})}}})(o)}),r&&"disabled"===o?(0,L.jsx)("div",{style:l.description,children:s.formatMessage(Dr.disabled)}):void 0]})}function Cr({propertyName:e,inversePropertyName:t,displayMode:o}){const n=(0,x().tz)(),i=xr();return"flattened"===o||"disabled"===o?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(jr,{children:(0,L.jsx)(Tr,{itemEmoji:Rr,title:t})}),(0,L.jsx)(jr,{children:(0,L.jsx)(Tr,{itemEmoji:Or,title:e})}),(0,L.jsx)(jr,{children:(0,L.jsx)(Tr,{itemEmoji:Or,title:e})})]}):(0,L.jsx)(jr,{children:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Tr,{itemEmoji:Rr,title:t}),(0,L.jsxs)("div",{style:i.cardSubitemsContainer,children:[(0,L.jsx)(wr,{title:`${e} 1`,left:(0,L.jsx)(Ar,{iconFn:yr().Y}),isFiltered:!0}),(0,L.jsx)(wr,{title:`${e} 2`,left:(0,L.jsx)(Ar,{iconFn:yr().Y}),isFiltered:!0})]}),(0,L.jsx)(Tr,{title:n.formatMessage(Dr.peopleProperty),left:(0,L.jsx)(Ar,{iconFn:fr().personIcon}),isFiltered:!0}),(0,L.jsx)(Tr,{title:n.formatMessage(Dr.statusProperty),left:(0,L.jsx)(Ar,{iconFn:Sr().a}),isFiltered:!0})]})})}function wr({title:e,left:t,isFiltered:o}){const n=(0,v().IS)((e=>({cardSubitemPreview:{display:"flex",alignItems:"center",gap:4,fontSize:We().J.UISmall.desktop,fontWeight:We().Wy.medium,color:e.text.secondary,opacity:o?.5:1}})),[o]);return(0,L.jsxs)("div",{style:n.cardSubitemPreview,children:[t,e]})}function jr({children:e}){const t=xr();return(0,L.jsx)("div",{style:t.card,children:e})}function Ar({iconFn:e,size:t=14}){const{iconStyle:o}=(0,v().IS)((()=>({iconStyle:{marginInlineEnd:2}})),[]);return(0,L.jsx)("div",{style:o,children:e({width:t,height:t})})}function _r(e){const{subitemFilterScope:t,propertyName:o}=e,n=(0,x().tz)();return"parents"===t||void 0===t?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Br,{}),(0,L.jsx)(Tr,{itemEmoji:Rr,title:n.formatMessage(Dr.notionOneProperty),left:(0,L.jsx)(Pr,{isIndented:!1,isOpen:!0})}),(0,L.jsx)(Tr,{itemEmoji:Or,title:o,left:(0,L.jsx)(Pr,{isIndented:!0,isOpen:!1}),isFiltered:!0}),(0,L.jsx)(Tr,{itemEmoji:Or,title:o,left:(0,L.jsx)(Pr,{isIndented:!0,isOpen:!1}),isFiltered:!0}),(0,L.jsx)(Tr,{itemEmoji:Rr,title:n.formatMessage(Dr.notionTwoProperty),left:(0,L.jsx)(Pr,{isIndented:!1,isOpen:!1})}),(0,L.jsx)(Tr,{itemEmoji:Rr,title:n.formatMessage(Dr.notionThreeProperty),left:(0,L.jsx)(Pr,{isIndented:!1,isOpen:!1})})]}):"parents_and_subitems"===t?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Br,{}),(0,L.jsx)(Tr,{itemEmoji:Rr,title:n.formatMessage(Dr.notionOneProperty),left:(0,L.jsx)(Pr,{isIndented:!1,isOpen:!0})}),(0,L.jsx)(Tr,{itemEmoji:Rr,title:n.formatMessage(Dr.springProperty),left:(0,L.jsx)(Pr,{isIndented:!1,isOpen:!1}),isFiltered:!0}),(0,L.jsx)(Tr,{itemEmoji:Or,title:n.formatMessage(Dr.notionCalendarProperty),left:(0,L.jsx)(Pr,{isIndented:!0,isOpen:!1})}),(0,L.jsx)(Tr,{itemEmoji:Rr,title:n.formatMessage(Dr.notionThreeProperty),left:(0,L.jsx)(Pr,{isIndented:!1,isOpen:!1})})]}):"subitems"===t?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Br,{}),(0,L.jsx)(Tr,{itemEmoji:Rr,title:n.formatMessage(Dr.springProperty),isFiltered:!0,left:(0,L.jsx)(Pr,{isIndented:!1,isOpen:!1})}),(0,L.jsx)(Tr,{itemEmoji:Or,title:n.formatMessage(Dr.notionCalendarProperty),left:(0,L.jsx)(Pr,{isIndented:!0,isOpen:!1})}),(0,L.jsx)(Tr,{itemEmoji:Rr,title:n.formatMessage(Dr.summerProperty),isFiltered:!0,left:(0,L.jsx)(Pr,{isIndented:!1,isOpen:!1})}),(0,L.jsx)(Tr,{itemEmoji:Or,title:n.formatMessage(Dr.notionMailProperty),left:(0,L.jsx)(Pr,{isIndented:!0,isOpen:!1})})]}):void(0,b().HB)(t)}function Ir(e){const{subitemFilterScope:t,inversePropertyName:o}=e,n=(0,x().tz)();return"parents"===t||void 0===t?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Br,{}),(0,L.jsx)(Tr,{itemEmoji:Rr,title:n.formatMessage(Dr.notionOneProperty),right:(0,L.jsx)(Fr,{count:5})}),(0,L.jsx)(Tr,{itemEmoji:Rr,title:n.formatMessage(Dr.notionTwoProperty),right:(0,L.jsx)(Fr,{count:12})}),(0,L.jsx)(Tr,{itemEmoji:Rr,title:n.formatMessage(Dr.notionThreeProperty),right:(0,L.jsx)(Fr,{count:8})})]}):"parents_and_subitems"===t?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Br,{}),(0,L.jsx)(Tr,{itemEmoji:Rr,title:n.formatMessage(Dr.notionOneProperty)}),(0,L.jsx)(Tr,{itemEmoji:Rr,title:n.formatMessage(Dr.springProperty),isFiltered:!0}),(0,L.jsx)(Tr,{itemEmoji:Or,title:n.formatMessage(Dr.notionCalendarProperty),right:(0,L.jsx)(Vr,{parentPropertyName:o})}),(0,L.jsx)(Tr,{itemEmoji:Rr,title:n.formatMessage(Dr.notionThreeProperty)})]}):"subitems"===t?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Br,{}),(0,L.jsx)(Tr,{itemEmoji:Rr,title:"Spring",isFiltered:!0}),(0,L.jsx)(Tr,{itemEmoji:Or,title:"Notion Calendar",right:(0,L.jsx)(Vr,{parentPropertyName:o})}),(0,L.jsx)(Tr,{itemEmoji:Rr,title:"Summer",isFiltered:!0}),(0,L.jsx)(Tr,{itemEmoji:Or,title:"Notion Mail",right:(0,L.jsx)(Vr,{parentPropertyName:o})})]}):void(0,b().HB)(t)}function kr(e){const{subitemFilterScope:t,inversePropertyName:o}=e,n=xr(),i=(0,x().tz)();return"parents"===t||void 0===t?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{style:n.cardFilterPill,children:(0,L.jsx)(Br,{})}),(0,L.jsx)(jr,{children:(0,L.jsx)(Tr,{itemEmoji:Rr,title:i.formatMessage(Dr.notionOneProperty),bottom:(0,L.jsx)(Fr,{count:5})})}),(0,L.jsx)(jr,{children:(0,L.jsx)(Tr,{itemEmoji:Rr,title:i.formatMessage(Dr.notionTwoProperty),bottom:(0,L.jsx)(Fr,{count:12})})})]}):"parents_and_subitems"===t?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{style:n.cardFilterPill,children:(0,L.jsx)(Br,{})}),(0,L.jsx)(jr,{children:(0,L.jsx)(Tr,{itemEmoji:Rr,title:i.formatMessage(Dr.notionOneProperty)})}),(0,L.jsx)(jr,{children:(0,L.jsx)(Tr,{itemEmoji:Or,title:i.formatMessage(Dr.notionCalendarProperty),top:(0,L.jsx)(Vr,{parentPropertyName:o})})}),(0,L.jsx)(jr,{children:(0,L.jsx)(Tr,{itemEmoji:Or,title:i.formatMessage(Dr.notionMailProperty),top:(0,L.jsx)(Vr,{parentPropertyName:o})})})]}):"subitems"===t?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{style:n.cardFilterPill,children:(0,L.jsx)(Br,{})}),(0,L.jsx)(jr,{children:(0,L.jsx)(Tr,{itemEmoji:Or,title:i.formatMessage(Dr.notionCalendarProperty),top:(0,L.jsx)(Vr,{parentPropertyName:o})})}),(0,L.jsx)(jr,{children:(0,L.jsx)(Tr,{itemEmoji:Or,title:i.formatMessage(Dr.notionMailProperty),top:(0,L.jsx)(Vr,{parentPropertyName:o})})})]}):void(0,b().HB)(t)}function Mr(e){const{propertyName:t,inversePropertyName:o,subitemFilterScope:n,displayMode:i,collectionViewType:r}=e,l=xr(),s=function(e){const{displayMode:t,subitemFilterScope:o,collectionViewType:n}=e,i=(0,x().tz)();if(!o||"disabled"===t)return;if("flattened"===t)return i.formatMessage(Er.flattened[o]);const r="show"===t&&(0,lr().qS)(n);if(r)return i.formatMessage(Er.nested[o]);const l="show"===t&&(0,rr().x)(n);if(l&&"parents"===o)return i.formatMessage(Er.card.parents)}({displayMode:i,subitemFilterScope:n,collectionViewType:r}),a=((e,n,i)=>{if("show"===e)switch(i){case"board":case"calendar":case"gallery":return;default:return(0,L.jsx)(_r,{subitemFilterScope:n,propertyName:t})}if("flattened"===e)switch(i){case"board":case"calendar":case"gallery":return(0,L.jsx)(kr,{subitemFilterScope:n,inversePropertyName:o});default:return(0,L.jsx)(Ir,{subitemFilterScope:n,inversePropertyName:o})}})(i,n,r);return(0,L.jsxs)(A().A,{disableMobileBorders:!0,children:[a?(0,L.jsx)("div",{style:l.togglePreviewOutsideBorder,children:a}):void 0,s?(0,L.jsx)("div",{style:l.description,children:s}):void 0]})}function Tr({itemEmoji:e,title:t,left:o,right:n,top:i,bottom:r,isLast:l,isFiltered:s}){const a=function(e){const{isLast:t,isFiltered:o}=e,n=(0,I().X)("collection_subitem_filters");return(0,v().IS)((e=>({previewItem:n?{padding:2,margin:"0px 8px",display:"flex",fontSize:h().A.isMobile?We().J.UISmall.mobile:We().J.UISmall.desktop,fontWeight:We().Wy.medium,alignItems:"center",color:e.text.secondary,opacity:o?.5:1}:{padding:4,margin:"0px 12px",display:"flex",fontSize:14,alignItems:"center",borderBottom:t?void 0:`1px solid ${e.regularDividerColor}`}})),[t,n,o])}({isLast:l,isFiltered:s});return(0,L.jsxs)(L.Fragment,{children:[i,(0,L.jsxs)("div",{style:a.previewItem,children:[o,e?(0,L.jsx)("span",{style:{marginInlineEnd:"5px"},children:e}):void 0,(0,L.jsx)("span",{style:We().RC,children:t}),n]}),r]})}function Pr({isIndented:e,isOpen:t,isFilterScopeSupported:o}){const n=(0,v().DP)();return o?(0,L.jsx)(vr().f,{isSidebar:!1,open:t,fill:!0,onClick:()=>{},style:{color:n.icon.secondary,marginInlineStart:e?"12px":void 0,height:20},disabled:!0}):(0,L.jsx)(vr().f,{isSidebar:!1,open:!1,fill:!0,onClick:()=>{},style:{color:n.icon.primary,marginInlineStart:e?"24px":void 0,height:20},disabled:!0})}function Br(){const e=(0,x().tz)(),t=(0,v().IS)((()=>({wrapStyle:{marginInlineStart:0,transform:"scale(0.9)",marginBottom:4,pointerEvents:"none"},innerStyle:{fontSize:We().J.UISmall.desktop,gap:4}})),[]);return(0,L.jsx)(hr().A,{icon:(0,hn().filterIcon)({width:12,height:12}),title:e.formatMessage(Dr.previewFilterName),on:!0,hideChevron:!1,wrapStyle:t.wrapStyle,innerStyle:t.innerStyle})}function Fr({count:e}){const t=(0,v().IS)((e=>({subitemCountIndicator:{display:"inline-flex",alignItems:"center",gap:4,paddingInlineStart:8,paddingInlineEnd:4,verticalAlign:"text-top"},innerText:{color:e.text.tertiary,fontWeight:We().Wy.medium,fontSize:We().J.UISmall.desktop}})),[]);return(0,L.jsxs)("span",{style:t.subitemCountIndicator,children:[(0,L.jsx)(W().I,{icon:gr().F,size:"sm",colorVariant:"secondary"}),(0,L.jsx)("span",{style:t.innerText,children:e})]})}function Vr({parentPropertyName:e}){const t=(0,v().IS)((e=>({parentWrapper:{paddingInlineStart:8,display:"inline-flex",alignItems:"center",gap:4},parentTitle:{textOverflow:"ellipsis",overflow:"hidden",color:e.text.tertiary,fontWeight:We().Wy.medium,fontSize:We().J.UISmall.desktop,whiteSpace:"nowrap"}})),[]);return(0,L.jsxs)("span",{style:t.parentWrapper,children:[(0,L.jsx)(W().I,{icon:mr().Z,size:"sm",colorVariant:"secondary"}),(0,L.jsx)("span",{style:t.parentTitle,children:e})]})}const Dr=(0,x().YK)({previewFilterName:{id:"collectionSettings.subitemsPreviews.previewFilterName",defaultMessage:"Name: Contains Notion"},peopleProperty:{id:"collectionSettings.subitemsPreviews.peopleProperty",defaultMessage:"People"},statusProperty:{id:"collectionSettings.subitemsPreviews.statusProperty",defaultMessage:"Status"},notionOneProperty:{id:"collectionSettings.subitemsPreviews.notionOneProperty",defaultMessage:"Notion 1"},notionTwoProperty:{id:"collectionSettings.subitemsPreviews.notionTwoProperty",defaultMessage:"Notion 2"},notionThreeProperty:{id:"collectionSettings.subitemsPreviews.notionThreeProperty",defaultMessage:"Notion 3"},notionCalendarProperty:{id:"collectionSettings.subitemsPreviews.notionCalendarProperty",defaultMessage:"Notion Calendar"},notionMailProperty:{id:"collectionSettings.subitemsPreviews.notionMailProperty",defaultMessage:"Notion Mail"},springProperty:{id:"collectionSettings.subitemsPreviews.springProperty",defaultMessage:"Spring"},summerProperty:{id:"collectionSettings.subitemsPreviews.summerProperty",defaultMessage:"Summer"},showParentsNested:{id:"collectionSettings.subitemsPreview.show.nested.parents",defaultMessage:"Any parents that match the filters will show up, with their sub-items nested."},showParentsAndSubitemsNested:{id:"collectionSettings.subitemsPreview.show.nested.parentsAndSubitems",defaultMessage:"All parents and sub-items that match the filters will show up."},showSubitemsNested:{id:"collectionSettings.subitemsPreview.show.nested.subitems",defaultMessage:"Only parents with sub-items that match the filter will show up."},showParentsCard:{id:"collectionSettings.subitemsPreview.show.card.parents",defaultMessage:"Parents that match the filter will show up, with their sub-items listed on each card."},flattenedParents:{id:"collectionSettings.subitemsPreview.flattened.parents",defaultMessage:"Any parents that match the filters will show up, with an indicator of how many sub-items each parent has."},flattenedParentsAndSubitems:{id:"collectionSettings.subitemsPreview.flattened.parentsAndSubitems",defaultMessage:"Any parents and sub-items that match the filters will show up."},flattenedSubitems:{id:"collectionSettings.subitemsPreview.flattened.subitems",defaultMessage:"Only sub-items that match the filters will show up."},disabled:{id:"collectionSettings.subitemsPreview.disabled",defaultMessage:"All items will be treated as top-level items."}}),Er={nested:{parents:Dr.showParentsNested,parents_and_subitems:Dr.showParentsAndSubitemsNested,subitems:Dr.showSubitemsNested},card:{parents:Dr.showParentsCard},flattened:{parents:Dr.flattenedParents,parents_and_subitems:Dr.flattenedParentsAndSubitems,subitems:Dr.flattenedSubitems}};const Rr="🐔",Or="🐣",Kr="🐮",Nr="🐷";var Lr=()=>o(926203),zr=()=>o(334955);function Ur(e){const{feature:t,databaseType:o}=e,n=(0,v().IS)((e=>({description:{marginInlineEnd:12,fontSize:h().A.isMobile?We().J.UISmall.mobile:We().J.UISmall.desktop,color:e.text.secondary,fontWeight:We().Wy.regular,marginInlineStart:14}})),[]),i=(0,ir().I_)({feature:t,databaseType:o});return(0,L.jsx)(A().A,{disableMobileBorders:!0,children:(0,L.jsx)("div",{style:{...n.description},children:(0,L.jsx)(x().sA,{...i})})})}const Wr="subitem";function Hr(e){const{collectionSettingsStore:t,collectionContextStore:o,onTurnOnSubitems:i}=e,l=(0,x().tz)(),a=(0,r().v3)(),{collectionStore:c,collectionViewStore:d,databaseType:u}=(0,s().K8)((()=>({collectionStore:o.collectionStore(),collectionViewStore:o.collectionViewStore(),databaseType:o.databaseType})),[o]),p=(0,s().K8)((()=>(null==d?void 0:d.getType())??"table"),[d]),g=(0,zr().lk)({collectionContextStore:o,feature:Wr}),y=null==g?void 0:g.property,f=(0,s().O$)(o.permissionScopesStore),h=(0,s().O$)(o.normalizedSchemaStore),b=(0,s().K8)((()=>{var e;return y&&(null===(e=h[y])||void 0===e?void 0:e.name)}),[h,y]),C=(0,s().K8)((()=>null==d?void 0:d.getFormat()),[d]),w=(null==C?void 0:C.subitem_display_mode)??"show",j=(0,s().K8)((()=>(0,nr().g0)(o)),[o]),_=(0,s().K8)((()=>{const e=y&&h[y];if(e&&"relation"===e.type){var t;const o=e.property;return o?null===(t=h[o])||void 0===t?void 0:t.name:void 0}}),[y,h]),I=(0,s().K8)((()=>{const e=o.collectionStore();return null!=e&&e.isDefined()?pr().zF(l,{sourceCollection:e.getModel(),isSelfRelation:!0,targetCollectionStore:e,createUnique:!0,from:Wr}):l.formatMessage({id:"database.viewSettings.relationsPropertyTab.inverseName.placeholder",defaultMessage:"Related to this database"})}),[o,l]),k=(0,s().uB)(void 0,J().A),M=(0,n.useCallback)((e=>{e&&k.setState({open:!1})}),[k]),{initialPropertyName:T}=(0,zr().Me)({collectionContextStore:o,feature:Wr}),P=(0,zr().Tv)({collectionContextStore:o,onPropertySelect:M,feature:Wr}),{handleDefaultPropertySelect:B,clearCollectionViewSubitemConfig:F}=P,V=void 0!==j&&"hidden"===w;(0,n.useEffect)((()=>{V&&d&&S().createAndCommit({userAction:"actionRegistry.updateCollectionViewSubitemFilterScope",environment:a,canUndo:!0,perform:e=>{m().zA({stores:[d],update:{subitem_display_mode:"flattened",subitem_filter_scope:"parents"},transaction:e})}})}),[V,d,a]);const D=(0,v().IS)((()=>({subitemsPreviewContainer:{marginBottom:6,marginInlineStart:2}})),[]);if(!c)return null;const E=void 0!==j;return g?(0,L.jsxs)(L.Fragment,{children:[E?void 0:(0,L.jsx)(Ur,{feature:Wr,databaseType:u}),(0,L.jsxs)(A().A,{disableMobileBorders:!0,extraPadding:E,children:[E?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Jr,{permissionScopes:f}),(0,L.jsx)("div",{style:D.subitemsPreviewContainer,children:(0,L.jsx)(br,{propertyName:b||T,inversePropertyName:_||I,subitemsDisplayMode:w,collectionViewType:p})})]}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{style:D.subitemsPreviewContainer,children:(0,L.jsx)(br,{propertyName:b||T,inversePropertyName:_||I,subitemsDisplayMode:w,collectionViewType:p})}),(0,L.jsx)(Jr,{permissionScopes:f})]}),E&&"disabled"!==w?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Xr,{permissionScopes:f}),(0,L.jsx)(Mr,{propertyName:b||T,inversePropertyName:_||I,displayMode:w,subitemFilterScope:j,collectionViewType:p})]}):void 0,(0,L.jsx)(se().A,{size:12,style:{marginTop:4,marginBottom:4}}),(0,L.jsx)(Lr().Eg,{collectionSettingsStore:t,feature:Wr,permissionScopes:f}),(0,L.jsx)(Lr().Xm,{feature:Wr,databaseType:u,permissionScopes:f,propertyName:b,relationPropertyId:y,collectionContextStore:o,collectionSettingsStore:t,handleDefaultPropertySelect:B,inversePropertyName:_,clearCollectionViewSubitemConfig:F})]})]}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Ur,{feature:Wr,databaseType:u}),(0,L.jsx)(br,{propertyName:b||T,inversePropertyName:_||I,subitemsDisplayMode:w,collectionViewType:p}),(0,L.jsx)(Lr().pz,{feature:Wr,permissionScopes:f,databaseType:u,handleAddRelation:i})]})}function Gr(e){const{subitemDisplayMode:t,collectionViewType:o,intl:n}=e;if("show"===t||void 0===t)switch(o){case"board":case"calendar":case"gallery":return n.formatMessage({id:"getTitleForSubitemDisplayModeMenuItem.onCard",defaultMessage:"Card property"});case"table":case"list":case"timeline":case"page":return n.formatMessage({id:"getTitleForSubitemDisplayModeMenuItem.nestedInToggle",defaultMessage:"Nested in toggle"});default:return n.formatMessage({id:"getTitleForSubitemDisplayModeMenuItem.default",defaultMessage:"Default view"})}else{if("hidden"===t)return n.formatMessage({id:"subitemDisplayModeMenuItemTitle.hideSubitems",defaultMessage:"Parents only"});if("flattened"===t)return n.formatMessage({id:"subitemDisplayModeMenuItemTitle.flattenedList",defaultMessage:"Flattened list"});if("disabled"===t)return n.formatMessage({id:"subitemDisplayModeMenuItemTitle.disabled",defaultMessage:"Disabled"});(0,b().HB)(t)}}const $r=["show","hidden","flattened","disabled"];function Qr(e){const{intl:t,collectionViewType:o,isFilterScopeSupported:n}=e;return $r.map((e=>({key:e,hideOption:n&&"hidden"===e,type:"button",title:Gr({intl:t,collectionViewType:o,subitemDisplayMode:e})})))}const Yr=["parents","parents_and_subitems","subitems"];function qr(e){const{subitemFilterScope:t,intl:o}=e;switch(t){case"parents":return o.formatMessage({id:"subitemFilterScopeMenuItemTitle.parents",defaultMessage:"Parents only"});case"parents_and_subitems":return o.formatMessage({id:"subitemFilterScopeMenuItemTitle.parentsAndSubitems",defaultMessage:"Parents and sub-items"});case"subitems":return o.formatMessage({id:"subitemFilterScopeMenuItemTitle.subitems",defaultMessage:"Sub-items only"});default:(0,b().HB)(t)}}function Jr(e){const{permissionScopes:t}=e,o=(0,x().tz)(),i=(0,dr().ET)(),l=(0,r().v3)(),a=(0,s().K8)((()=>i.collectionViewStore()),[i]),c=(0,s().K8)((()=>null==a?void 0:a.getFormat()),[a]),d=(null==c?void 0:c.subitem_display_mode)??"show",p="show"===d,g=(0,s().K8)((()=>(null==a?void 0:a.getType())??"table"),[a]),y=(0,s().K8)((()=>(0,nr().g0)(i)),[i]),f=n.useCallback((e=>{const t=i.getPropertyFormatKey(),o=(0,nr().r6)(i),n=null==o?void 0:o.property,r=null==o?void 0:o.inverse;if(!(a&&t&&n&&r&&e!==d))return;const s=(null==c?void 0:c.property_filters)||[];let u;u="disabled"===d?null==c?void 0:c.subitem_filter_scope:y;const p=(0,lr().Hl)({subitemDisplayMode:e,subitemFilterScope:u,collectionViewType:g}),f=(0,lr().OB)({subitemDisplayMode:e,subitemFilterScope:u}),h=(0,rr().x)(g);S().createAndCommit({userAction:"actionRegistry.updateCollectionViewSubitemDisplayMode",environment:l,canUndo:!0,perform:o=>{h&&(0,cr().a)({formatStore:a,formatKey:t,property:n,update:{visible:"show"===e},transaction:o});const i=Zr({propertyFilters:s,subitemInverseProperty:r,shouldShowParentsOnly:p,shouldShowSubitemsOnly:f});"show"===e&&h&&m().zA({stores:[a],update:{subitem_filter_scope:"parents"},transaction:o}),m().zA({stores:[a],update:{subitem_display_mode:e,property_filters:i},transaction:o})}}),(0,ar().X)({environment:l,collectionContextStore:i,action:"set_subitem_display_mode",new_subitem_display_mode:e,old_subitem_display_mode:d})}),[i,a,l,c,d,y,g]);if((0,n.useEffect)((()=>{(0,u().DO_NOT_USE_trackLegacy)(l,"configure_subitem_display_mode",{userAction:p?"CollectionSettingsViewRelationFeatures.configureSubitemDisplayMode.flattened":"CollectionSettingsViewRelationFeatures.configureSubitemDisplayMode.show"})}),[p,l]),!(0,sr().B)(g))return null;const h=void 0!==y;return(0,L.jsx)(to().A,{title:h?(0,L.jsx)(x().sA,{defaultMessage:"Display options",id:"SubitemDisplayModeMenuItem.menuItemTitleV2"}):(0,L.jsx)(x().sA,{defaultMessage:"Show as",id:"SubitemDisplayModeMenuItem.menuItemTitle"}),collectionContextStore:i,selectedKey:d,options:Qr({collectionViewType:g,intl:o,isFilterScopeSupported:h}),onChange:e=>f(e),disabled:!t.canConfigureBlock,variant:h?"fullWidth":"default"})}function Xr(e){const{permissionScopes:t}=e,o=(0,x().tz)(),i=(0,r().v3)(),l=(0,dr().ET)(),a=(0,s().K8)((()=>(0,nr().g0)(l)),[l]),{subitemDisplayMode:c,availableFilterScopeOptions:d}=(0,s().K8)((()=>{const e=l.collectionViewStore(),t=(null==e?void 0:e.getType())??"table",n=(null==e?void 0:e.getFormat().subitem_display_mode)??"show",i=function(e){const{intl:t,collectionViewType:o,subitemDisplayMode:n}=e,i="show"===n&&(0,rr().x)(o);return Yr.map((e=>({key:e,hideOption:i&&"parents"!==e,type:"button",title:qr({intl:t,subitemFilterScope:e})})))}({intl:o,collectionViewType:t,subitemDisplayMode:n});return{subitemDisplayMode:n,availableFilterScopeOptions:i.filter((e=>!e.hideOption))}}),[l,o]),u=(0,n.useCallback)((e=>{const t=l.collectionViewStore(),o=(0,nr().r6)(l),n=null==o?void 0:o.inverse;if(!t||!n||e===a)return;const r=t.getFormat(),s=(null==r?void 0:r.property_filters)||[],d=(0,lr().Hl)({subitemDisplayMode:c,subitemFilterScope:e,collectionViewType:t.getType()??"table"}),u=(0,lr().OB)({subitemDisplayMode:c,subitemFilterScope:e});S().createAndCommit({userAction:"actionRegistry.updateCollectionViewSubitemFilterScope",environment:i,canUndo:!0,perform:o=>{const i=Zr({propertyFilters:s,subitemInverseProperty:n,shouldShowParentsOnly:d,shouldShowSubitemsOnly:u});m().zA({stores:[t],update:{property_filters:i,subitem_filter_scope:e},transaction:o})}}),(0,ar().X)({environment:i,collectionContextStore:l,action:"set_subitem_filter_scope",new_subitem_filter_scope:e,old_subitem_filter_scope:a})}),[l,i,a,c]);return void 0===a||d.length<=1?null:(0,L.jsx)(to().A,{title:"flattened"===c?(0,L.jsx)(x().sA,{defaultMessage:"Include",id:"SubitemFilterScopeMenuItem.menuItemTitle.flattened"}):(0,L.jsx)(x().sA,{defaultMessage:"Filter options",id:"SubitemFilterScopeMenuItem.menuItemTitle.default"}),collectionContextStore:l,selectedKey:a,options:d,onChange:u,disabled:!t.canConfigureBlock,variant:"fullWidth"})}function Zr(e){const{propertyFilters:t,subitemInverseProperty:o,shouldShowParentsOnly:n,shouldShowSubitemsOnly:i}=e,r=t.filter((e=>e.id!==ur().O&&e.id!==ur().j));return n&&r.push({id:ur().O,filter:{property:o,filter:{operator:"is_empty"}}}),i&&r.push({id:ur().j,filter:{property:o,filter:{operator:"is_not_empty"}}}),r}var el=()=>o(147361);function tl(e){const{collectionContextStore:t,collectionSettingsStore:o,feature:i,from:r}=e,l=(0,s().O$)(t.normalizedSchemaStore),a=(0,s().K8)((()=>t.databaseType),[t]),c=(0,s().K8)((()=>t.collectionStore()),[t]),d=(0,zr().lk)({collectionContextStore:t,feature:i}),u=null==d?void 0:d.property,g=(0,n.useMemo)((()=>or().HG(l)),[l]),m=(0,s().O$)(t.permissionScopesStore),S=(0,s().K8)((()=>{var e;return u&&(null===(e=l[u])||void 0===e?void 0:e.name)}),[l,u]),y=(0,s().K8)((()=>{const e=u&&l[u];if(e&&"relation"===e.type){var t;const o=e.property;return o?null===(t=l[o])||void 0===t?void 0:t.name:void 0}}),[u,l]),f=(0,s().K8)((()=>Boolean(c&&function(e){const{collectionContextStore:t,collectionStore:o}=e,n=o.getFormat().collection_default_arrows_by,i=t.currentArrowsByFormatStore.state;return!(0,b().O9)(i)||i===n}({collectionContextStore:t,collectionStore:c}))),[t,c]),h=(0,s().uB)(void 0,J().A),v=(0,n.useCallback)((e=>{e&&h.setState({open:!1})}),[h]),w=(0,zr().Tv)({collectionContextStore:t,onPropertySelect:v,feature:i}),{handleAddRelation:j,handleDefaultPropertySelect:_,setSubitemFilterScope:I}=w;if(!c)return null;let k;if("subitem"===i){const e=()=>{j({featureType:"subitem",from:r}),p().default.checkGate({gateName:"collection_subitem_filters"})&&I({subitemFilterScope:"parents"}),D().yl({collectionSettingsStore:o}),qi().default.afterNextFlush((()=>{const e=t.subitemTreeStore.getState(),o=t.resultsInViewOrder(1).at(0),n=(0,er().Qe)(e.children,(e=>e.value.store===o));if(n){const e=n.map((e=>e.value.store.pointer)),o=(0,nr().kY)(e);tr().QK({collectionContextStore:t,pathKey:o})}}))};k=(0,L.jsx)(Hr,{collectionSettingsStore:o,collectionContextStore:t,onTurnOnSubitems:e})}else"timeline_arrows_by"===i?k=d?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Ur,{feature:i,databaseType:a}),f?(0,L.jsx)(nl,{collectionContextStore:t,firstDatePropertyId:g,permissionScopes:m}):(0,L.jsx)(ol,{collectionContextStore:t,databaseType:a}),(0,L.jsxs)(A().A,{topBorder:!0,children:[(0,L.jsx)(Lr().Eg,{collectionSettingsStore:o,feature:i,permissionScopes:m}),(0,L.jsx)(rl,{feature:i,databaseType:a,featuredRelationProperty:d,actions:w,permissionScopes:m}),(0,L.jsx)(Lr().Xm,{feature:i,databaseType:a,permissionScopes:m,relationPropertyId:u,propertyName:S,inversePropertyName:y,collectionContextStore:t,collectionSettingsStore:o,handleDefaultPropertySelect:_})]})]}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Ur,{feature:i,databaseType:a}),(0,L.jsx)(il,{databaseType:a,collectionContextStore:t,firstDatePropertyId:g,handleAddRelation:j,permissionScopes:m,from:r})]}):(0,b().HB)(i);const M=(0,ir().mv)({feature:i,databaseType:a});return(0,L.jsx)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{...M}),children:k})}function ol(e){const{collectionContextStore:t,databaseType:o}=e,n=(0,r().WS)(),i=(0,v().IS)((e=>({wrap:{boxShadow:e.shadow2XS,...n?{backgroundColor:e.background.secondary,margin:void 0,borderRadius:void 0}:{background:"rgba(196, 196, 196, 0.13)",marginTop:14,marginBottom:20}},iconWithMessage:{display:"flex",gap:8},icon:{width:14,height:14,position:"relative",top:1,color:e.text.secondary}})),[n]),l=(0,s().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getNormalizedDependencyDateShiftingConfig()}),[t]),a=(0,ir().qC)({currentDateShiftConfig:l,databaseType:o});return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(A().A,{title:(0,L.jsx)(x().sA,{...ir().Ic.dateShiftingSectionCaption}),children:(0,L.jsx)(el().r,{mode:null==l?void 0:l.mode})}),(0,L.jsx)(ii().F,{style:i.wrap,showCloseButton:!1,children:(0,L.jsxs)("div",{style:i.iconWithMessage,children:[(0,Zi().G)(i.icon),(0,L.jsx)(mt().A,{isSmall:!0,isMultiline:!0,children:(0,L.jsx)(x().sA,{...a})})]})})]})}function nl(e){const{collectionContextStore:t,firstDatePropertyId:o,permissionScopes:i}=e,l=(0,r().v3)(),a=(0,x().tz)(),c=(0,s().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getNormalizedDependencyDateShiftingConfig()}),[t]),d=(0,n.useCallback)((e=>{const o=t.collectionStore();o&&S().createAndCommit({userAction:"FeatureEnabledDependenciesSection.handleConfigChange",environment:l,canUndo:!0,perform:t=>{(0,Lr().Wf)({collectionStore:o,environment:l,intl:a,newConfig:e,transaction:t})}})}),[t,l,a]),u=(0,n.useMemo)((()=>({configWithoutDates:c,...c?{datePropertyId:c.date_property,endDatePropertyId:c.end_date_property}:{datePropertyId:o}})),[c,o]);return(0,L.jsx)(Lr().aH,{collectionContextStore:t,currentConfig:u,disabled:!i.canConfigureBlock||!i.canConfigureCollection,onConfigChange:d})}function il(e){const{collectionContextStore:t,handleAddRelation:o,firstDatePropertyId:i,permissionScopes:r,databaseType:l,from:a}=e,[c,d]=(0,n.useState)({datePropertyId:i,configWithoutDates:{mode:Lr().qd,avoid_weekends:Lr().$g}}),u=(0,s().K8)((()=>t.settingsStore),[t]);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Lr().aH,{collectionContextStore:t,currentConfig:c,disabled:!r.canConfigureBlock||!r.canConfigureCollection,onConfigChange:d}),(0,L.jsx)(Lr().pz,{feature:"timeline_arrows_by",permissionScopes:r,databaseType:l,handleAddRelation:()=>{o({featureType:"timeline_arrows_by",dateShiftingConfig:c,from:a}),D().yl({collectionSettingsStore:u})}})]})}function rl(e){const{feature:t,featuredRelationProperty:o,actions:n,permissionScopes:i,databaseType:l}=e,s=(0,r().Y0)(),a=(0,v().IS)((()=>({eyeHideIcon:{width:20,height:s.isMobile?24:12,marginInlineStart:3}})),[s]);if(!o.supportedInView)return null;const c=o.enabledOnView,d=o.isVisibleInView,u=d?{icon:Xi().T,iconStyle:a.eyeHideIcon}:{icon:Ji().h};return(0,L.jsx)(so().A,{...u,onClick:()=>{n.handlePropertySelect(c?void 0:o.property)},title:(0,L.jsx)(x().sA,{...(0,ir().WI)({feature:t,isOn:d,databaseType:l})}),disabled:!i.canConfigureBlock})}var ll=()=>o(762631),sl=()=>o(4319),al=()=>o(878665);const cl="box1-filter",dl="box2-filter";function ul(e){const{propertyName:t,inversePropertyName:o}=e,n=(0,v().DP)(),i=(0,v().IS)((e=>({svgWrap:{margin:"0px 12px",border:`1px solid ${e.regularDividerColor}`,borderRadius:6,alignItems:"center",position:"relative",height:112,backgroundColor:e.palette.gray[30],display:"flex",justifyContent:"center"}})),[]);return(0,L.jsx)(A().A,{disableMobileBorders:!0,children:(0,L.jsx)("div",{style:i.svgWrap,children:(0,L.jsxs)("svg",{width:"266",height:"116",fill:"none",children:[(0,L.jsx)("path",{stroke:"#DFAF49",strokeWidth:"2",d:"M124 20h.426c7.703 0 17.307-.002 25.029 1.93 3.979.994 8.078 2.638 11.248 5.575C164.082 30.635 166 34.868 166 40c0 8.001-6.095 12.917-11.524 15.932-5.553 3.086-12.74 5.481-19.23 7.644l-.349.116c-6.919 2.307-13.074 4.381-17.546 6.866C112.655 73.166 112 75 112 76c0 1.868.582 2.885 1.453 3.692 1.08 1.001 2.981 1.982 6.002 2.737C125.59 83.963 132.773 84 141 84"}),(0,L.jsx)("path",{stroke:"#E3E2E0",strokeWidth:"2",d:"M125 32c8.227 0 15.41.037 21.545 1.57 3.021.756 4.922 1.737 6.002 2.738.871.807 1.453 1.824 1.453 3.692 0 .999-.655 2.834-5.351 5.443-4.472 2.484-10.627 4.558-17.546 6.865l-.349.116c-6.49 2.163-13.677 4.558-19.23 7.644C106.095 63.084 100 67.998 100 76c0 5.132 1.918 9.365 5.297 12.495 3.17 2.937 7.269 4.581 11.248 5.576C124.267 96 133.871 96 141.574 96H142"}),(0,L.jsx)("path",{fill:n.palette.gray[30],d:"M157 27h16v18h-16zM92 70h16v18H92z"}),(0,L.jsx)("path",{stroke:"#DFAF49",strokeWidth:"2",d:"M136 88l5-4-5-4"}),(0,L.jsx)("path",{stroke:"#E3E2E0",strokeWidth:"2",d:"M130 36l-5-4 5-4"}),(0,L.jsxs)("g",{filter:`url(#${cl})`,children:[(0,L.jsx)("rect",{width:"100",height:"28",x:"24",y:"12",fill:n.background.elevated,rx:"3"}),(0,L.jsx)("text",{x:"67",y:"31",fill:"#000",children:"🌱"})]}),(0,L.jsxs)("g",{filter:`url(#${dl})`,children:[(0,L.jsx)("rect",{width:"100",height:"28",x:"142",y:"76",fill:n.background.elevated,rx:"3"}),(0,L.jsx)("text",{x:"185",y:"95",fill:"#000",children:"🌳"})]}),(0,L.jsx)(pl,{x:"161",y:"26",width:"100",height:"16",textStyles:{fontSize:12,fontWeight:590,color:n.text.primary},children:t}),(0,L.jsx)(pl,{x:"15",y:"69",width:"90",height:"16",textStyles:{color:n.text.tertiary,fontSize:12,fontWeight:500,textAlign:"end"},children:o}),(0,L.jsxs)("defs",{children:[(0,L.jsxs)("filter",{id:cl,width:"108",height:"36",x:"20",y:"10",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,L.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,L.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,L.jsx)("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_1034_52436"}),(0,L.jsx)("feOffset",{}),(0,L.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,L.jsx)("feColorMatrix",{values:"0 0 0 0 0.0707 0 0 0 0 0.0693 0 0 0 0 0.0693 0 0 0 0.1 0"}),(0,L.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_1034_52436"}),(0,L.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,L.jsx)("feOffset",{dy:"2"}),(0,L.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,L.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,L.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),(0,L.jsx)("feBlend",{in2:"effect1_dropShadow_1034_52436",result:"effect2_dropShadow_1034_52436"}),(0,L.jsx)("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_1034_52436",result:"shape"})]}),(0,L.jsxs)("filter",{id:dl,width:"108",height:"36",x:"138",y:"74",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,L.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,L.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,L.jsx)("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_1034_52436"}),(0,L.jsx)("feOffset",{}),(0,L.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,L.jsx)("feColorMatrix",{values:"0 0 0 0 0.0707 0 0 0 0 0.0693 0 0 0 0 0.0693 0 0 0 0.1 0"}),(0,L.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_1034_52436"}),(0,L.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,L.jsx)("feOffset",{dy:"2"}),(0,L.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,L.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,L.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),(0,L.jsx)("feBlend",{in2:"effect1_dropShadow_1034_52436",result:"effect2_dropShadow_1034_52436"}),(0,L.jsx)("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_1034_52436",result:"shape"})]})]})]})})})}function pl(e){const{children:t,textStyles:o,...n}=e;return(0,L.jsx)("foreignObject",{...n,children:(0,L.jsx)("div",{style:{...We().RC,...n.width?{width:Number(n.width)}:{},...o},children:t})})}var gl=()=>o(554840);function ml(e){var t;const{collectionContextStore:o,feature:i}=e,r=(0,x().tz)(),l=(0,s().K8)((()=>o.collectionStore()),[o]),a=(0,s().O$)(o.normalizedSchemaStore),c=(0,s().O$)(o.permissionScopesStore),d=null===(t=(0,zr().lk)({collectionContextStore:o,feature:i}))||void 0===t?void 0:t.property,u=(0,s().K8)((()=>{var e;return d&&(null===(e=a[d])||void 0===e?void 0:e.name)}),[d,a]),p=(0,s().K8)((()=>{var e;return"table"===(null===(e=o.collectionViewStore())||void 0===e?void 0:e.getType())}),[o]),g=(0,s().K8)((()=>{const e=d&&a[d];if(e&&"relation"===e.type){var t;const o=e.property;return o?null===(t=a[o])||void 0===t?void 0:t.name:void 0}}),[d,a]),m=(0,s().K8)((()=>{const e=o.collectionStore();return null!=e&&e.isDefined()?pr().zF(r,{sourceCollection:e.getModel(),isSelfRelation:!0,targetCollectionStore:e,createUnique:!0,from:i}):r.formatMessage({id:"database.viewSettings.relationsPropertyTab.inverseName.placeholder",defaultMessage:"Related to this database"})}),[o,r,i]),S=(0,s().uB)(void 0,J().A),{initialPropertyName:y}=(0,zr().Me)({collectionContextStore:o,feature:i}),f=(0,n.useCallback)((e=>{e&&S.setState({open:!1})}),[S]),h=(0,v().IS)((()=>({previewContainer:{marginInlineStart:2}})),[]);if(!l)return null;let w;return"subitem"===i?w=(0,L.jsx)(br,{propertyName:u||y,inversePropertyName:g||m,subitemsDisplayMode:"show"}):"timeline_arrows_by"===i?w=(0,L.jsx)(ul,{propertyName:u||y,inversePropertyName:g||m}):(0,b().HB)(i),(0,L.jsxs)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{...ir().Ic.advancedSettings}),children:[(0,L.jsx)("div",{style:h.previewContainer,children:w}),(0,L.jsxs)(A().A,{disableMobileBorders:!0,children:[(0,L.jsx)(gl().a,{currentPropertyId:d,feature:i,onPropertySelect:f,buttonPopupStore:S,collectionContextStore:o,permissionScopes:c,disabled:!c.canConfigureCollection}),"subitem"===i&&p?(0,L.jsx)(Sl,{collectionContextStore:o,permissionScopes:c}):void 0]})]})}function Sl(e){const{collectionContextStore:t,permissionScopes:o}=e,i=(0,x().tz)(),l=(0,r().v3)(),a=(0,s().K8)((()=>"title"===t.normalizedFormatStore.state.table_subitem_toggle_column),[t]),c=!o.canConfigureBlock,d=(0,n.useCallback)((()=>{const e=t.collectionViewStore();e&&(sl().jP({environment:l,collectionViewStore:e,currentValue:t.normalizedFormatStore.state.table_subitem_toggle_column}),(0,ar().X)({environment:l,collectionContextStore:t,action:"toggle_table_subitem_toggle_on_title"}))}),[t,l]);return(0,L.jsx)(al().d,{showImage:o.canConfigureBlock,caption:i.formatMessage(ir().Ic.toggleNestingOnTitleMenuItemTooltip),tooltipImage:Zt().A.images.tooltips.collectionSettings.subitemsToggleOnTitlePng,tooltipImageScale:.3,render:e=>(0,L.jsx)(so().A,{...e,icon:()=>(0,ll().U)({width:F().Ev.sm,height:F().Ev.sm,marginInlineStart:4,marginInlineEnd:2}),onClick:d,title:(0,L.jsx)(x().sA,{defaultMessage:"Show nesting toggle on title",id:"database.viewSettings.layoutTab.tableSubitemToggleOnTitle"}),right:(0,L.jsx)(de().A,{disallowTabbing:!0,on:a,disabled:c,onClick:d}),disabled:c})})}var yl=()=>o(261503),fl=()=>o(689094);function hl(e){const{integration:t,collectionSettingsStore:o,collectionContextStore:n,onAccountSelect:i}=e,l=(0,v().IS)((()=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",paddingTop:8,paddingInlineEnd:16,paddingBottom:16,paddingInlineStart:8}})),[]),a=(0,r().v3)(),c=(0,s().K8)((()=>{var e;return null===(e=n.collectionStore())||void 0===e?void 0:e.getSpaceId()}),[n]),d=(0,s().K8)((()=>{const e=nt().A.state;return e.loaded?e.externalAuthentications.filter((e=>e.integration_id===t.id)):[]}),[t]);return t&&c?(0,L.jsx)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Choose an account",id:"collectionSettingsAccountPicker.title"}),footer:vl({environment:a,integration:t,spaceId:c}),children:(0,L.jsx)("div",{style:l.settingsMenu,children:(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,initialFocus:0,sections:[{key:"externalAuthentications",items:d.map((e=>{const n={key:e.id,render:o=>(0,L.jsx)(at().A,{renderTooltip:()=>(0,L.jsx)("span",{children:e.account_name}),placement:"left",textWrap:!0,render:n=>(0,L.jsx)(Q().A,{...(0,ao().A)(n||{},o),title:e.account_name,icon:(0,L.jsx)("img",{style:{width:18},src:t.info.icon}),focused:o.focused})}),action:()=>{D().yl({collectionSettingsStore:o}),i(e)}};return n})),render:e=>(0,L.jsx)(A().A,{...e})}]})})}):null}function vl(e){const t=e.environment.device.isMobileBrowser;return(0,L.jsx)(A().A,{topBorder:!0,children:t?void 0:xl(e)})}function xl(e){return(0,L.jsx)(so().A,{...e,icon:fl().W,title:(0,L.jsx)(x().sA,{id:"collectionSettingsAccountPicker.addAccount",defaultMessage:"Connect another account"}),isGray:!0,onClick:async()=>{await Oo().Jq({...e,from:"source_picker_connect_another_account"})}})}var bl=()=>o(444091),Cl=o.n(o(844751)),wl=()=>o(617668),jl=()=>o(430171),Al=()=>o(95441);const _l=(0,x().YK)({searchPlaceholder:{defaultMessage:"Search for a property...",id:"database.viewSettings.databaseProperties.searchPlaceholder"}}),Il=St().Store.createClass("",{name:"InputStore"});function kl(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,i=(0,r().v3)(),l=(0,v().DP)(),a=(0,s().O$)(t.normalizedSchemaStore),c=(0,s().O$)(t.permissionScopesStore),d=(0,s().uB)(void 0,Il),u=(0,s().O$)(d),p=(0,n.useMemo)((()=>{const e=u.toLowerCase();return e?Object.entries(a).filter((([t,o])=>!!o&&Cl().test(e,o.name.toLowerCase()))):Object.entries(a)}),[a,u]),g=(0,I().X)("jira_notion_only_properties"),m=c.canConfigureCollection&&(!c.isExternallyImportedAndSyncedCollection||g),S=(0,n.useCallback)((()=>{(0,jl().c)({environment:i,collectionContextStore:t})}),[i,t]),y=(0,n.useCallback)((e=>{D().a2({collectionSettingsStore:o,item:{type:"property",property:e,formatKey:void 0}})}),[o]),f=(0,v().IS)((e=>({title:{display:"flex",alignItems:"center"},propertiesContainer:{paddingTop:8,paddingBottom:8},propertyIcon:{fill:e.icon.primary}})),[]);return(0,L.jsx)(C().Ay,{...e,title:(0,L.jsx)("div",{style:f.title,children:(0,L.jsx)(x().sA,{defaultMessage:"Properties",id:"database.viewSettings.databaseProperties.title"})}),header:(0,L.jsx)(A().A,{children:(0,L.jsx)(pt().Ay,{placeholder:oo().A.formatMessage(_l.searchPlaceholder),value:u,onChange:e=>d.setState(e.target.value)})}),footer:(0,L.jsxs)(A().A,{topBorder:!0,children:[m?(0,L.jsx)(so().A,{icon:wl().plusIcon,title:(0,L.jsx)(x().sA,{defaultMessage:"New property",id:"database.viewSettings.databaseProperties.newProperty"}),isGray:!0,onClick:S}):void 0,(0,L.jsx)(Al().A,{href:(0,No().x)("guides.databaseProperties"),title:(0,L.jsx)(x().sA,{defaultMessage:"Learn about properties",id:"database.viewSettings.databaseProperties.learnMoreButton.title"}),analyticsFrom:"database_settings_properties"})]}),children:(0,L.jsx)("div",{style:f.propertiesContainer,children:p.map((([e,t])=>t?(0,L.jsx)(so().A,{icon:e=>(0,L.jsx)(Qe().zB,{type:t.type,icon:t.icon,size:F().Ev.sm,style:{...e,...f.propertyIcon},theme:l}),title:t.name,onClick:()=>y(e),showChevron:!0},e):null))})})}var Ml=()=>o(589407),Tl=()=>o(745266),Pl=()=>o(31902),Bl=()=>o(285790);function Fl(e){return(0,L.jsx)(Vl,{...e})}function Vl(e){const t=(0,s().K8)((()=>{const t=e.collectionContextStore.collectionViewBlockStore();if(!t)return;const o=e.collectionContextStore.collectionStore();if(!o)return;const n=o.getSchemaStore().getValue(),i=t.getCollectionViewStores().filter((e=>{var t;return(null===(t=e.getCollectionStore())||void 0===t?void 0:t.id)===o.id})),r=o.getAutomationStores(),l=o.getParentId()===t.id;return{collectionViewBlockStore:t,collectionStore:o,schema:n,views:i,automations:r,isSourceDatabase:l}}),[e.collectionContextStore]);return t?(0,L.jsxs)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Settings",id:"databaseSettingsV2.title"}),children:[(0,L.jsx)(A().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"Views",id:"databaseSettingsV2.viewSection.title"}),children:t.views.map((e=>(0,L.jsx)(Dl,{collectionViewStore:e},e.id)))}),(0,L.jsx)(El,{collectionStore:t.collectionStore,collectionContextStore:e.collectionContextStore})]}):null}function Dl({collectionViewStore:e}){const{viewName:t,viewType:o,viewIcon:n}=(0,s().K8)((()=>({viewName:e.getName(),viewType:e.getType(),viewIcon:e.getFormat().collection_view_icon})),[e]);if(!o)throw new Error(`View type not found for ${e.id}`);return(0,L.jsx)(so().A,{title:(0,L.jsx)(Pl().A,{collectionViewType:o,collectionViewName:t}),icon:()=>(0,L.jsx)(Tl().h,{color:"regular",viewType:o,viewIcon:n}),onClick:()=>{const{mainEditorCurrentBlockStore:e}=He().default.state;if(!e||!e.isCollectionView())throw new Error("Main editor current block store is not a collection view")}})}function El(e){const t=(0,x().tz)(),{collectionStore:o,collectionContextStore:i}=e,l=(0,r().v3)(),a=(0,s().K8)((()=>{var e;const t=(null===(e=o.getModel())||void 0===e?void 0:e.getNormalizedSchema())??{};return Object.entries(t).filter((e=>void 0!==e[1]))}),[o]),c=(0,v().DP)(),d=(0,v().IS)((e=>({sectionTitleContainer:{display:"flex",alignItems:"center",gap:4},propertyItem:{height:36,paddingTop:8,paddingBottom:8,paddingInlineStart:12,display:"flex",alignItems:"center",justifyContent:"flex-start",gap:8},expandButtonIcon:{minWidth:18,minHeight:18,width:18,height:18,color:e.icon.secondary},expandButtonText:{color:e.text.secondary}})),[]),u=(0,n.useCallback)((()=>{D().a2({collectionSettingsStore:i.settingsStore,item:{type:"propertyType",onAccept:e=>{const{propertyType:t,isSuggestedProperty:o,propertyName:n,propertyIcon:r,selectOptions:s}=e;Mt().nZ({environment:l,collectionContextStore:i,propertyType:t,isSuggestedProperty:o,propertyName:n,propertyIcon:r,selectOptions:s,from:"database_settings"})}}})}),[i,l]),p=(0,n.useCallback)((e=>{D().a2({collectionSettingsStore:i.settingsStore,item:{type:"property",property:e,formatKey:void 0}})}),[i]),[g,m]=(0,n.useState)(!1),S=g?a:a.slice(0,5),y=g||S.length===a.length?null:(0,L.jsx)(Q().A,{title:(0,L.jsx)(x().sA,{id:"WorkflowEditorDatabase.DatabaseProperties.expand",defaultMessage:"{count, plural, one {# more property} other {# more properties}}",values:{count:a.length-5}}),icon:(0,L.jsx)(W().I,{icon:Ml().ellipsisIcon}),focused:!1,onClick:()=>m(!0),style:d.propertyItem,desktopIconStyle:d.expandButtonIcon,desktopTitleStyle:d.expandButtonText});return(0,L.jsx)(A().A,{title:(0,L.jsxs)("div",{style:d.sectionTitleContainer,children:[(0,L.jsx)(x().sA,{id:"WorkflowEditorDatabase.DatabaseDetails.properties",defaultMessage:"Properties"}),(0,L.jsx)(Bl().A,{icon:B().plusSmallIcon,ariaLabel:t.formatMessage({id:"WorkflowEditorDatabase.DatabaseDetails.access.add",defaultMessage:"Add"}),onClick:u,style:{width:20,height:20}})]}),children:(0,L.jsxs)("div",{children:[S.map((([e,t],o)=>(0,L.jsx)(so().A,{icon:e=>(0,L.jsx)(Qe().zB,{type:t.type,icon:t.icon,size:18,theme:c,style:{fill:c.icon.primary}}),title:t.name,onClick:()=>p(e)},e))),y]})})}var Rl=()=>o(594013),Ol=()=>o(901610),Kl=()=>o(519831),Nl=()=>o(720665),Ll=()=>o(384944),zl=()=>o(186091);function Ul(e){var t,o,n;const{collectionContextStore:i,collectionStore:r,transaction:l}=e,s=i.collectionViewStore();if(!s||!r.isDefined())return;const a=or().e2(r),c=null===(t=r.getFormat())||void 0===t?void 0:t.collection_default_arrows_by,d=i.collectionStore(),u=(null==d?void 0:d.pointer.id)!==r.pointer.id,p=r.getSchema();let g=s.getChartConfig();u&&"chart"===s.getType()&&g&&"placeholder"!==g.type&&(g=function({chartConfig:e,collectionSchema:t}){return(0,Ol().m)(e)?(0,Rl().EZ)({collectionSchema:t,axisChartType:e.type}):"donut"===e.type?(0,Rl().ZS)({collectionSchema:t}):(0,Rl().EZ)({collectionSchema:t,axisChartType:"column"})}({chartConfig:g,collectionSchema:p}));const m={table_properties:null==a||null===(o=a.getFormat())||void 0===o?void 0:o.table_properties,collection_pointer:{table:Kl().Vl,id:r.id,spaceId:r.getSpaceId()},chart_config:g,timeline_arrows_by:c?{property:c}:void 0,table_subitem_toggle_column:"title"},S=null==i?void 0:i.normalizedSchemaStore.state;Ll().zv({store:s,data:(0,Nl().g_)({format:m,query2:{sort:a?null===(n=(0,zl().$)({collectionViewStore:a,schema:S}))||void 0===n?void 0:n.sort:void 0}}),transaction:l})}function Wl(e){const{environment:t,collectionContextStore:o,transaction:n,source:i}=e,r=o.collectionViewStore(),l=o.collectionViewBlockStore();if(r&&l&&(m().zA({stores:[r],update:{collection_view_source:i},transaction:n}),"collection"===i.type)){const e=Pt().m.createChildStore(r,{table:Kl().Vl,id:i.id,spaceId:i.spaceId});if(!e.isDefined())return;Ul({collectionContextStore:o,collectionStore:e,transaction:n}),(0,f().u)({environment:t,event:{eventName:"add_linked_source",eventProperties:{source_collection_id:i.id,source_has_row_based_permissions:e.getPropertyPermissionItems().validItems.length>0,collection_view_id:r.id,collection_view_block_id:l.id}}})}}var Hl=()=>o(821062),Gl=()=>o(228927),$l=()=>o(768627),Ql=()=>o(970585),Yl=()=>o(166292),ql=()=>o(835607),Jl=()=>o(858141),Xl=()=>o(323086),Zl=()=>o(314660);function es(e){const t=(0,r().v3)(),o=(0,I().X)("sidebar_library"),i=(0,n.useCallback)((o=>{const n=e.collectionViewStore();n&&S().createAndCommit({userAction:"CreateViewSourceMenuBody.allPagesOption",environment:t,canUndo:!0,perform:i=>{Wl({environment:t,collectionContextStore:e,source:{type:o,spaceId:n.getSpaceId()},transaction:i}),(0,Zl().f)({collectionViewStore:n,update:{filter:void 0,sort:[],aggregations:void 0},transaction:i});const r=e.settingsStore;D().os({collectionSettingsStore:r})}})}),[e,t]);return(0,n.useMemo)((()=>{if(!o)return;return{key:"browse",items:[{key:"created-by-me",render:e=>(0,L.jsx)(Q().A,{...e,title:oo().A.formatMessage(Xl().WB.messages.createdByMe),icon:(0,L.jsx)(W().I,{icon:Yl().S,colorVariant:"secondary"})}),action:()=>{i("createdByMe")}},{key:"recents",render:e=>(0,L.jsx)(Q().A,{...e,title:oo().A.formatMessage(Xl().WB.messages.recents),icon:(0,L.jsx)(W().I,{icon:Yn().clockIcon,colorVariant:"secondary"})}),action:()=>{i("recents")}},{key:"mentioned-me",render:e=>(0,L.jsx)(Q().A,{...e,title:oo().A.formatMessage(Xl().WB.messages.mentionsMe),icon:(0,L.jsx)(W().I,{icon:Yn().clockIcon,colorVariant:"secondary"})}),action:()=>{i("mentionsMe")}},{key:"shared-with-me",render:e=>(0,L.jsx)(Q().A,{...e,title:oo().A.formatMessage(Xl().WB.messages.sharedWithMe),icon:(0,L.jsx)(W().I,{icon:ql().F,colorVariant:"secondary"})}),action:()=>{i("sharedWithMe")}},{key:"my-pages",render:e=>(0,L.jsx)(Q().A,{...e,title:oo().A.formatMessage(Xl().WB.messages.myPages),icon:(0,L.jsx)(W().I,{icon:Jl().squareGrid2X2Icon,colorVariant:"secondary"})}),action:()=>{i("myPages")}}],render:e=>(0,L.jsx)(A().A,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Browse",id:"database.collectionSettings.useBrowseCollections.browse"}),...e})}}),[i,o])}o(430670);var ts=()=>o(591779),os=()=>o(30626),ns=()=>o(245241),is=()=>o(736767),rs=()=>o(305390),ls=()=>o(135599),ss=()=>o(106628),as=()=>o(361330);function cs({numShimmers:e=5}){const t=(0,v().IS)((e=>({container:{maxHeight:253},shimmerContainer:{height:45,marginTop:0,marginInlineEnd:14,marginBottom:0,marginInlineStart:18,display:"flex",alignItems:"center"},circleContainer:{display:"flex",alignItems:"center",justifyContent:"center",marginInlineEnd:5,marginTop:5,alignSelf:"flex-start"},circle:{width:16,height:16,borderRadius:12,backgroundColor:e.lightDividerColor},sourceContainer:{flex:"1 1 auto",marginTop:6,marginInlineStart:8,alignSelf:"flex-start"},title:{height:9,width:"40%",borderRadius:8,backgroundColor:e.lightDividerColor},location:{marginTop:9,height:9,width:"60%",borderRadius:8,backgroundColor:e.lightDividerColor},showMoreContainer:{marginTop:-2,marginInlineEnd:14,marginBottom:0,marginInlineStart:18,display:"flex",alignItems:"center"},showMore:{marginTop:3,height:9,width:"40%",borderRadius:8,backgroundColor:e.lightDividerColor}})),[]),o=Do().Hn(e,(e=>(0,L.jsxs)("div",{style:t.shimmerContainer,children:[(0,L.jsx)("div",{style:t.circleContainer,children:(0,L.jsx)(gt().A,{style:t.circle})}),(0,L.jsxs)("div",{style:t.sourceContainer,children:[(0,L.jsx)(gt().A,{style:t.title}),(0,L.jsx)(gt().A,{style:t.location})]})]},e))),n=(0,L.jsxs)("div",{style:t.showMoreContainer,children:[(0,L.jsx)("div",{style:t.circleContainer,children:(0,L.jsx)(gt().A,{style:t.circle})}),(0,L.jsx)("div",{style:t.sourceContainer,children:(0,L.jsx)(gt().A,{style:t.showMore})})]});return(0,L.jsxs)("div",{style:t.container,children:[o,n]})}var ds=()=>o(697650);function us({collectionContextStore:e,suggestionConfig:t,inputValue:o}){const n=(0,x().tz)(),i=(0,s().K8)((()=>function({collectionContextStore:e,suggestionConfig:t}){if("noSuggestions"===t.type)return[];const o="viewModuleTab"===t.type?t.collectionParentCollectionViewBlockStore:null==e?void 0:e.collectionViewBlockStore();if(!o)return[];if(o.getCollectionPointerIfSingleSource())return[];return o.getOwnedAndLinkedCollectionStores()}({collectionContextStore:e,suggestionConfig:t})),[e,t]),r=(0,s().K8)((()=>function({suggestedCollections:e,inputValue:t,suggestionConfig:o,intl:n}){const i=e.filter((e=>e.id!==function(e){switch(e.type){case"sourceView":case"relation":return e.currentValue;case"viewModuleTab":case"newView":case"noSuggestions":return;default:(0,b().HB)(e)}}(o))).filter((e=>e.canRead()));return(0,Ze().Ay)(t,i,(e=>(0,ds().getCollectionNameOrDefault)({collectionStore:e,intl:n})),{minThreshold:Ze().qR})}({suggestedCollections:i,inputValue:o,suggestionConfig:t,intl:n})),[i,o,t,n]);return r}const ps=5,gs=20,ms=20;function Ss(e){const{input:t,handleAcceptExistingCollection:o,hideSearchTitle:i,collectionContextStore:l,collectionStore:a,parentStore:c,context:d,peopleBlocksToInclude:u,suggestionConfig:p,searchResultsItemsLimit:g=gs,isSearchSurfacesHookEnabled:m=!1,showLoadMoreResultsButton:S=!1,requireEditPermissions:y=!1}=e,h=us({collectionContextStore:l,suggestionConfig:p,inputValue:t}),x=(0,r().v3)(),[b,C]=(0,n.useState)(ps),w=(0,n.useRef)(!1);(0,ts().ZC)(t)!==t&&(w.current=!1),(0,n.useEffect)((()=>{m||(t.length>0&&b===ps?C(gs):0===t.length&&b===gs&&C(ps))}),[t.length,m,b]);const{results:j,isResultsLoading:_,searchSessionId:I,fetchAdditionalServerResultsOnChange:k,hasMoreResults:M,searchSessionFlowNumber:T}=(0,ls().W)({query:t,limit:g,source:"collection_settings_source",type:ns().Vz.CollectionsInSpace,options:{disable:!m},peopleBlocksToInclude:"all"}),P=(0,n.useRef)(0),B=T+P.current,[F]=(0,qe().Yb)((async()=>{if(m)return;const e=await hs({query:t,limit:b,parentStore:c,environment:x,searchSessionId:I,peopleBlocksToInclude:u,collectionContextStore:l,requireEditPermissions:y});return P.current+=1,e}),[m,t,b,c,x,I,l,y,u],{debounce:as().tu}),V=(0,v().IS)((e=>({showMoreButton:{color:e.text.secondary,fill:e.icon.secondary}})),[]),D=(0,s().K8)((()=>F&&"pending"===F.status||_),[_,F]),{resultsSectionItems:E,hasResults:R}=(0,s().K8)((()=>{if("rejected"===F.status)return{resultsSectionItems:[],hasResults:!1};const{results:e,showMore:n}=F.value??{results:[],showMore:0},i=m?j.flatMap((e=>e.store.getOwnedCollectionStores())):e.map((e=>Pt().m.createChildStore(c,{table:Kl().Vl,id:e}))),r=new Set(h.map((e=>e.id))),s=(0,Do().oE)(i).filter((e=>{if(r.has(e.id))return!1;if(d===xs.Source){if(e.id===(null==a?void 0:a.id))return!1;const t=e.getParentBlockStore();return(null==t?void 0:t.id)!==c.id}return!y||e.canEditCollection()})),u=s.map(((e,n)=>({key:e.id,render:t=>(0,L.jsx)(ys,{...t,itemCollectionStore:e,selfCollectionStore:a,collectionContextStore:l,context:d}),action:i=>{o(e),(0,f().u)({environment:x,event:{eventName:"source_collection_search_item_click",eventProperties:{index:h.length+n,search_session_id:I,source:"source",using_secondary_search_surfaces_hook:m,query_length:t.length,reciprocal_rank:1/(n+1),search_session_flow_number:B,total_results:h.length+s.length}}})}})));if(D&&u.push({key:"loading",render:e=>(0,L.jsx)("div",{style:{paddingTop:x.device.isMobile?10:0},children:(0,L.jsx)(cs,{numShimmers:Math.min(g,5)})}),action:()=>{}}),!m&&n>0&&!D){const e={key:"showMore",render:e=>(0,L.jsx)(Q().A,{...e,buttonStyle:V.showMoreButton,icon:(0,os()._)({width:16,height:16}),title:oo().A.formatMessage(vs.showMore,{showMore:n})}),action:()=>C((e=>e+ms))};u.push(e)}else if(m&&(0===t.length||S)&&!D&&!w.current&&M&&k){const e={key:"showMore",render:e=>(0,L.jsx)(Q().A,{...e,buttonStyle:V.showMoreButton,icon:(0,os()._)({width:16,height:16}),title:oo().A.formatMessage(vs.showMoreWithoutCount)}),action:()=>{k(g),w.current=!0}};u.push(e)}return u.length>0?{resultsSectionItems:u,hasResults:!0}:{resultsSectionItems:[{key:"noResults",render:e=>(0,L.jsx)(is().A,{caption:oo().A.formatMessage(vs.noResults),style:{marginInlineStart:1},...e}),action:()=>{}}],hasResults:!1}}),[F.status,F.value,m,j,h,D,t.length,S,M,k,c,d,y,a,l,o,x,I,B,g,V.showMoreButton]),O=h.map(((e,n)=>({key:`suggested-${e.id}`,render:t=>(0,L.jsx)(ys,{...t,itemCollectionStore:e,selfCollectionStore:a,collectionContextStore:l,context:d}),action:()=>{o(e),(0,f().u)({environment:x,event:{eventName:"source_collection_search_item_click",eventProperties:{index:n,search_session_id:I,source:"source",using_secondary_search_surfaces_hook:m,query_length:t.length,reciprocal_rank:1/(n+1),search_session_flow_number:B,total_results:h.length+E.length}}})}}))),K=(0,n.useMemo)((()=>O.length>0?{key:"suggested",items:O,render:e=>(0,L.jsx)(A().A,{title:oo().A.formatMessage(vs.suggestedDatabases),...e})}:void 0),[O]),N=(0,n.useMemo)((()=>({key:"results",items:E,render:e=>(0,L.jsx)(A().A,{title:!i&&oo().A.formatMessage(vs.existingDataSources),...e})})),[i,E]);return{suggestedSection:K,resultsSection:N,fetchMoreResults:!D&&k?k:void 0,searchSessionFlowNumber:B,searchSessionId:I,hasResults:R}}const ys=n.forwardRef((function(e,t){const{itemCollectionStore:o,selfCollectionStore:n,collectionContextStore:i,context:r,...l}=e,a=(0,s().K8)((()=>{var e;if(r===xs.Relation)return(null==n?void 0:n.id)??(null==i||null===(e=i.collectionViewStore())||void 0===e||null===(e=e.getCollectionStore())||void 0===e?void 0:e.id)}),[r,n,i]);return(0,L.jsx)(rs().A,{...l,store:o,right:a===o.id?(0,L.jsx)(fs,{}):void 0})}));function fs(){const e=(0,x().tz)();return(0,L.jsx)(at().A,{renderTooltip:()=>e.formatMessage(vs.thisDatabase),render:e=>(0,L.jsx)("div",{...e,children:(0,Zi().G)({width:14,height:14})})})}async function hs(e){const{query:t,limit:o,environment:n,parentStore:i,searchSessionId:r,peopleBlocksToInclude:l,collectionContextStore:s,requireEditPermissions:a}=e,{sidebarSpaceStore:c}=He().default.state,d=null==s?void 0:s.collectionViewBlockStore(),u=await ss().T.searchActions.load(),p=await u.searchCollectionsWithRecents({environment:n,collectionViewBlockStore:d,parentStore:i,spaceStore:c,query:t,limit:o,requireEditPermissions:a,searchSessionId:r,peopleBlocksToInclude:l});return{results:p.results,showMore:Math.max(0,p.total-p.results.length)}}const vs=(0,x().YK)({showMore:{defaultMessage:"Show {showMore} more",id:"database.viewSettings.searchCollections.showMore.title"},noResults:{defaultMessage:"No results",id:"database.viewSettings.searchCollections.noResults.title"},existingDataSources:{defaultMessage:"Existing data sources",id:"database.viewSettings.createViewTab.existingDataSources"},suggestedDatabases:{defaultMessage:"Suggested",id:"database.viewSettings.searchCollections.suggestedDatabases"},showMoreWithoutCount:{defaultMessage:"Show more",id:"database.viewSettings.searchCollections.showMore.titleWithoutCount"},thisDatabase:{defaultMessage:"This database",id:"database.viewSettings.searchCollections.thisDatabase.tooltip"}});let xs=function(e){return e[e.Source=0]="Source",e[e.Relation=1]="Relation",e}({});const bs=(0,x().YK)({linkedInputPlaceholder:{defaultMessage:"Link to a data source…",id:"database.viewSettings.searchCollections.linkedInputPlaceholder"},linkedOrSourceInputPlaceholder:{defaultMessage:"Link or create a data source…",id:"database.viewSettings.searchCollections.linkedOrSourceInputPlaceholder"}}),Cs=St().Store.createClass("",{name:"InputStore"}),ws=n.memo((function(e){const{collectionContextStore:t,context:o,parentStore:i,onAccept:l,inputStore:a,requireEditPermissions:c,collectionStore:d,suggestionConfig:u}=e,g=(0,r().v3)(),m=(0,r().Y0)(),S=(0,x().tz)(),y=(0,s().uB)(a,Cs),h=(0,s().uB)(void 0,Ql().A),v=(0,n.useRef)(0),C=(0,s().O$)(y),{suggestedSection:w,resultsSection:j,fetchMoreResults:_,searchSessionId:I,searchSessionFlowNumber:k}=Ss({input:C,handleAcceptExistingCollection:l,collectionContextStore:t,parentStore:i,context:o,requireEditPermissions:c,collectionStore:d,suggestionConfig:u,peopleBlocksToInclude:"none"}),M=es(t);(0,n.useEffect)((()=>{v.current=k}),[k]);const T=(0,s().K8)((()=>"on"===p().default.getEligibleGroup({experimentId:"search_surfaces_collection_search",defaultGroup:"unassigned"})),[]);(0,n.useEffect)((()=>((0,f().u)({environment:g,event:{eventName:"source_collection_search_open",eventProperties:{search_session_id:I,using_secondary_search_surfaces_hook:T,source:"relation"}}}),()=>{(0,f().u)({environment:g,event:{eventName:"source_collection_search_close",eventProperties:{search_session_id:I,source:"relation",using_secondary_search_surfaces_hook:T,search_session_flow_number:v.current}}})})),[g,T,I]);const P="uninitialized"===(0,s().K8)((()=>null==t?void 0:t.getCollectionViewBlockSourceState()),[t])?bs.linkedOrSourceInputPlaceholder:bs.linkedInputPlaceholder;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(A().A,{isInput:!0,children:(0,L.jsx)(pt().Ay,{focusInitial:!m.isMobile||void 0,value:C,onChange:e=>{y.setState(e.target.value),h.setState({focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})},placeholder:S.formatMessage(P),showClearButton:!0})}),(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,initialFocus:0,sections:[w,j,M].filter(b().O9),store:h}),T?(0,L.jsx)(Gl().A,{onChange:(e,t)=>{_&&e<$l().A.incrementScrollOffset&&_()}}):null]})}),Hl().A);var js=()=>o(884107),As=()=>o(187820);const _s=2e4,Is=100;var ks=()=>o(792071),Ms=()=>o(979340);var Ts=()=>o(693954),Ps=()=>o(72135);const Bs={type:"aggregation",filter:void 0,aggregation:{aggregator:"count",property:"title"}};function Fs({collectionContextStore:e}){const t=(0,x().tz)(),{isMobile:i}=(0,r().Y0)(),l=(0,v().IS)((e=>({menuItem:{color:e.text.secondary,paddingInlineStart:i?4:8},warningIcon:{fill:(0,re().k5)("orange",e).fill,marginInlineEnd:14,width:12,alignSelf:"center"}})),[i]),a=(0,s().K8)((()=>{var t;return"row_limit_exceeded"===(null===(t=e.collectionStore())||void 0===t||null===(t=t.getFormatStore())||void 0===t?void 0:t.getKeyStore("sync_state").getKeyStore("syncing").getValue())}),[e]),c=(0,s().O$)(He().AppStoreSidebarSpaceStore),d=(0,s().K8)((()=>function(e){if(!e)return _s;const t=ks().Bj6.fromSpace(e),o=t.getSetting("database_sync_row_limit");return void 0!==o?o:(0,Ms().dL)(t.getSubscriptionTier())?Is:_s}(null==c?void 0:c.getModel())),[c]),u=(0,s().K8)((()=>(0,Ms().dL)(null==c?void 0:c.getSubscriptionTier())),[c]),p=(0,n.useMemo)((()=>(0,L.jsx)(o(101981).A,{id:"table:uncategorized:title:count",collectionContextStore:e,reducer:Bs,render:e=>{const o=e.state;if(!o||"aggregation"!==o.type)return;if("number"!==o.aggregationResult.type)return;const n={...o.aggregationResult,value:o.aggregationResult.value&&Math.min(d,o.aggregationResult.value)};return(0,Ps().ZV)(n.value,"number_with_commas",t)}})),[e,t,d]);return(0,L.jsx)(ae().Ay,{title:(0,L.jsxs)("span",{style:{display:"inline-flex",alignItems:"center"},children:[a&&c&&u?(0,L.jsx)(at().A,{placement:"left",alignment:"center",renderTooltip:()=>(0,L.jsx)(x().sA,{id:"database.viewSettings.syncedSourceTab.limitFree.toolTip",defaultMessage:"Free Plans are limited to 1 synced database with up to 100 rows."}),render:e=>(0,L.jsx)("div",{...e,children:(0,Ts().Q)(l.warningIcon)})}):void 0,(0,L.jsx)(x().sA,{defaultMessage:"Limit",id:"database.viewSettings.syncedSourceTab.limit"})]}),right:(0,L.jsx)(x().sA,{defaultMessage:"{value}/{limit} rows",id:"database.viewSettings.syncedSourceTab.limitRows",values:{value:p,limit:(0,Ps().ZV)(d,"number_with_commas",t)}}),style:l.menuItem})}const Vs=n.memo(Fs,Hl().A);var Ds=()=>o(929219),Es=()=>o(763884),Rs=()=>o(907514),Os=()=>o(198491);function Ks({collectionContextStore:e}){const t=(0,s().K8)((()=>e.collectionStore()),[e]),[n,i]=(0,s().K8)((()=>{const e=null==t?void 0:t.getFormatStore();return[null==e?void 0:e.getKeyStore("uri").getValue(),null==e?void 0:e.getKeyStore("bot_id").getValue()]}),[t]),r=(0,s().O$)(He().AppStoreSidebarSpaceStore),l=(0,s().K8)((()=>{var e;if(!n||!r)return;const t=null===(e=(0,Mn().cl)(n,r.getSpaceId()))||void 0===e?void 0:e.id;if(!t)return;const i=(0,o(462853).l)(t);return i||void 0}),[n,r]);return l?(0,L.jsx)(Ns,{collectionContextStore:e,uri:n,botId:i,featureName:l}):(0,L.jsx)(Ls,{collectionContextStore:e,uri:n,botId:i,upsellInfo:void 0})}function Ns({collectionContextStore:e,uri:t,botId:o,featureName:n}){const i=(0,Tn().uF)({featureName:n});return(0,L.jsx)(Ls,{collectionContextStore:e,uri:t,botId:o,upsellInfo:i})}function Ls({collectionContextStore:e,uri:t,botId:o,upsellInfo:i}){const l=(0,r().v3)(),a=(0,v().IS)((e=>({menuItem:{color:e.text.secondary,paddingInlineStart:h().A.isMobile?4:8}})),[]),c=!(0,s().O$)(Ds().e),d=c||i&&!i.isAvailable,u=(0,s().K8)((()=>e.collectionStore()),[e]),p=(0,s().O$)(He().AppStoreSidebarSpaceStore),g=(0,s().K8)((()=>{var t;const o=e.numberChildrenUnfurledStore.state,n=e.numberChildrenReceivedStore.state,i=o/n,r=!0===(null===(t=e.collectionStore())||void 0===t||null===(t=t.getFormat().sync_state)||void 0===t?void 0:t.syncing),l=o&&n&&i<1&&!h().A.isMobile,s=r&&h().A.isMobile;return l||s}),[e]),m=(0,s().K8)((()=>{const e=p&&(0,Ms().dL)(p.getSubscriptionTier());return{defaultMessage:e?"Clear and sync database":"Sync database",description:e?"Clears and refreshes the database ":"Refreshes the synced database."}}),[p]),[S,y]=(0,n.useState)(void 0);(0,n.useEffect)((()=>{if(t&&o){const e=`${o}:${t}`,n=Es().K.get({userId:l.currentUser.id,key:e});y(n)}}),[o,l,t]);const f=!S||S<Date.now();return t&&o?g?(0,L.jsx)(ae().Ay,{title:(0,L.jsx)(x().sA,{defaultMessage:"Syncing",id:"database.viewSettings.syncedSourceTab.isSyncing"}),icon:(0,L.jsx)(W().I,{icon:mn().D,className:"sync-spinner"}),style:a.menuItem}):f?(0,L.jsx)(at().A,{renderTooltip:()=>c?(0,L.jsx)(x().sA,{defaultMessage:"Unavailable offline",id:"database.viewSettings.syncedSourceTab.syncNow.offlineTooltip"}):null!=i&&i.upsellTier?(0,L.jsx)(Os().A,{upsellTier:i.upsellTier,expirationDate:i.expirationDate}):null,placement:"left",disableTooltip:!d,render:e=>(0,L.jsx)(so().A,{isGray:!0,title:(0,L.jsx)(x().sA,{defaultMessage:"{message}",id:"database.viewSettings.syncedSourceTab.syncNow",values:{message:m.defaultMessage,description:m.description}}),icon:mn().D,onClick:async()=>{const e=null==u?void 0:u.id,n=!0===(null==u?void 0:u.getFormat().stale);e&&await D().cJ({environment:l,uri:t,botId:o,collectionId:e,nextSync:S,setNextSync:y,isStale:n})},disabled:d,...e})}):(0,L.jsx)(ae().Ay,{title:(0,L.jsx)(x().sA,{defaultMessage:"Sync available in {timeToNextSync}",id:"database.viewSettings.syncedSourceTab.syncNow.disabled",values:{timeToNextSync:(0,Rs().OH)(Date.now(),S)}}),icon:(0,L.jsx)(W().I,{icon:Sn().i}),style:a.menuItem}):null}const zs=n.memo(Ks,Hl().A);function Us({collectionContextStore:e}){var t;const n=(0,r().v3)(),{isMobile:i}=n.device,l=(0,v().IS)((()=>({menuItemTitle:{paddingInlineStart:i?4:8},menuItemIcon:{height:16,width:16,marginInlineEnd:2}})),[i]),a=(0,s().K8)((()=>e.collectionStore()),[e]),[c,d,u]=(0,s().K8)((()=>{const e=null==a?void 0:a.getFormatStore();return[null==e?void 0:e.getKeyStore("uri").getValue(),null==e?void 0:e.getKeyStore("bot_id").getValue(),null==e?void 0:e.getKeyStore("original_url").getValue()]}),[a]),p=null==a||null===(t=a.pointer)||void 0===t?void 0:t.spaceId,g=(0,s().K8)((()=>(0,Mn().fH)(u,p)),[p,u]),m=(0,s().K8)((()=>e.collectionViewBlockStore()),[e]);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(A().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"Source database",id:"database.viewSettings.syncedSourceTab.sourceDatabase"}),children:(0,L.jsx)(at().A,{placement:"left",alignment:"center",renderTooltip:()=>m&&(0,L.jsx)(o(706965).A,{store:m,compactFormat:!0}),render:e=>(0,L.jsx)(ae().Ay,{...e,title:g,icon:(0,L.jsx)(As().B6,{disabled:!0,icon:null==a?void 0:a.getIcon(),iconRecordCategory:"collection",isEmptyPage:!1,size:20,style:l.menuItemIcon}),style:l.menuItemTitle})}),style:{paddingBottom:0}}),(0,L.jsx)(A().A,{children:(0,L.jsx)(Vs,{collectionContextStore:e})}),(0,L.jsxs)(A().A,{topBorder:!0,children:[(0,L.jsx)(zs,{collectionContextStore:e}),(0,L.jsx)(so().A,{isGray:!0,title:(0,L.jsx)(x().sA,{defaultMessage:"Copy debugging information",id:"database.viewSettings.syncedSourceTab.copyDebugging"}),icon:o(536583).d,onClick:async()=>{const e=await js().R.clipboardActions.load(),t={uri:c,botId:d,spaceId:p};e.copyString({environment:n,stringValue:JSON.stringify(t,null,2),copiedMessage:e.clipboardMessages.copiedToClipboard})}}),(0,L.jsx)(ko().N,{href:`${h().A.domainBaseUrl}?target=connected_apps`,children:(0,L.jsx)(so().A,{icon:o(212473).arrowUpRightSquareIcon,title:(0,L.jsx)(x().sA,{defaultMessage:"Manage my connections",id:"database.viewSettings.syncedSourceTab.manageConnections"}),isGray:!0})}),(0,L.jsx)(Al().A,{href:(0,No().x)("guides.syncedDatabases"),title:(0,L.jsx)(x().sA,{defaultMessage:"Learn about synced databases",id:"database.viewSettings.syncedSourceTab.learnMoreButton.title."}),analyticsFrom:"view_settings_source"})]})]})}const Ws=n.memo(Us,Hl().A);function Hs(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,i=(0,r().v3)(),{collectionViewBlockStore:l,collectionStore:a,shouldRenderSyncedSourceTab:c}=(0,s().K8)((()=>{const e=t.collectionViewBlockStore(),o=t.collectionStore(),n=(null==o?void 0:o.getParentId())===(null==e?void 0:e.id),i=(null==o?void 0:o.isSyncedCollection())||(null==o?void 0:o.isExternalSyncedCollection());return{collectionViewBlockStore:e,collectionStore:o,shouldRenderSyncedSourceTab:n&&i}}),[t]),d=(0,n.useMemo)((()=>St().Store.createValue("")),[]),u=(0,s().K8)((()=>{var e;return{type:"sourceView",currentValue:null===(e=t.collectionStore())||void 0===e?void 0:e.id}}),[t]);return l?(0,L.jsx)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Source",id:"database.viewSettings.sourceTab.title"}),handleClose:()=>D().os({collectionSettingsStore:o}),children:c?(0,L.jsx)(Ws,{collectionContextStore:t}):(0,L.jsx)(ws,{collectionContextStore:t,parentStore:l,onAccept:e=>function(e,t,o,n){S().createAndCommit({userAction:"CollectionSettingsViewSource.handleSourcePickerAccept",environment:t,canUndo:!0,perform:n=>{Wl({environment:t,collectionContextStore:o,source:{type:"collection",id:e.id,spaceId:e.getSpaceId()},transaction:n})}}),D().yl({collectionSettingsStore:n})}(e,i,t,o),collectionStore:a,context:bo().U9.Source,inputStore:d,suggestionConfig:u})}):null}const Gs=n.memo(Hs);var $s=()=>o(259476),Qs=()=>o(912720),Ys=()=>o(813297),qs=()=>o(254497),Js=()=>o(447934),Xs=()=>o(790392);const Zs=(0,x().YK)({delete:{defaultMessage:"Delete",id:"database.deletedProperties.delete"},undo:{defaultMessage:"Undo",id:"database.deletedProperties.undo"},permanentlyDeleteAll:{defaultMessage:"Permanently delete all",id:"database.deletedProperties.permanentlyDeleteAll"}});function ea({collectionSettingsStore:e,collectionContextStore:t,timelineViewTab:i}){const l=(0,r().v3)(),a=(0,v().DP)(),c=(0,s().O$)(t.normalizedDeletedSchemaStore),d=(0,x().tz)(),u=(0,v().IS)((e=>({permanentlyDeleteDescription:{color:e.text.secondary,fontSize:14,fontWeight:We().Wy.regular,marginTop:7,marginBottom:16}})),[]),p=(0,o(7667).A)(),g=(0,n.useCallback)((o=>{p(o);const n=(0,bo().ZI)({timelineViewTab:i,collectionContextStore:t});D().yl({collectionSettingsStore:e}),D().a2({collectionSettingsStore:e,item:{type:"property",property:o,formatKey:n}})}),[t,e,p,i]),m=(0,n.useMemo)((()=>Object.entries(c).map((([e,t])=>{if(t)return{propertyId:e,propertySchema:t}})).filter(b().O9)),[c]),y=(0,n.useCallback)((()=>0===m.length?(0,L.jsx)(A().A,{children:(0,L.jsx)(ae().Ay,{title:(0,L.jsx)(x().sA,{defaultMessage:"No results",id:"database.viewSettings.deletedPropertiesTab.noResults"})})}):(0,L.jsx)(A().A,{extraPadding:!0,children:m.map((({propertyId:e,propertySchema:n})=>(0,L.jsx)(ae().Ay,{title:(0,L.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,L.jsx)(Qe().zB,{type:n.type,icon:n.icon,size:F().Ev.sm,theme:a,style:{fill:a.icon.primary}}),(0,L.jsx)("span",{style:{marginInlineStart:6,maxWidth:200,...We().RC},children:n.name})]}),right:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Bl().A,{icon:o(613601).arrowUTurnUpLeftSmallIcon,iconStyle:{width:F().Ev.sm,height:F().Ev.sm},ariaLabel:d.formatMessage(Zs.undo),onClick:()=>g(e)}),(0,L.jsx)(Bl().A,{icon:$s().trashSmallIcon,iconStyle:{width:F().Ev.sm,height:F().Ev.sm},ariaLabel:d.formatMessage(Zs.delete),onClick:()=>{!async function(e,t,o){const{automationActions:n}=await Ys().QV.automations.load();Ro().ui({message:(0,L.jsx)(x().sA,{id:"database.viewSettings.deletedPropertiesTab.permanentlyDeleteProperty.modal.prompt",defaultMessage:"Are you sure you want to delete this property?"}),showCancel:!0,keepFocus:!0,items:[{label:(0,L.jsx)(x().sA,{id:"database.viewSettings.propertyTab.deleteProperty.modal.confirmButton",defaultMessage:"Delete"}),color:"red",onAccept:async()=>{const i=t.collectionStore();if(i){const t=i.getLayoutStore();await(null==t?void 0:t.load()),S().createAndCommit({userAction:"CollectionSettingsDeletedProperties.handlePermanentlyDeleteDeletedPropertyClick",environment:o,canUndo:!0,perform:r=>{oa(e,o,i,r,n.deleteAutomation,t),(0,qs().E)({collectionStore:i,update:{[e]:null},transaction:r})}})}}}]})}(e,t,l)}})]})},e)))})),[t,m,l,g,a,d]),f=(0,n.useCallback)((()=>0===m.length?null:(0,L.jsx)(A().A,{topBorder:!0,extraPadding:!0,children:(0,L.jsx)(so().A,{title:d.formatMessage(Zs.permanentlyDeleteAll),icon:$s().trashSmallIcon,isGray:!0,onClick:()=>{!async function(e,t,o,n){const{automationActions:i}=await Ys().QV.automations.load();Ro().ui({message:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(x().sA,{id:"database.viewSettings.deletedPropertiesTab.permanentlyDeleteAll.modal.prompt",defaultMessage:"Permanently delete all properties?"}),(0,L.jsx)("div",{style:n.permanentlyDeleteDescription,children:(0,L.jsx)(x().sA,{id:"database.viewSettings.deletedPropertiesTab.permanentlyDeleteAll.modal.description",defaultMessage:"This action cannot be undone."})})]}),showCancel:!0,keepFocus:!0,items:[{label:(0,L.jsx)(x().sA,{id:"database.viewSettings.propertyTab.deleteAllProperties.modal.confirmButton",defaultMessage:"Permanently Delete"}),color:"red",onAccept:async()=>{const n=t.collectionStore();if(!n)return;const r=n.getLayoutStore();await(null==r?void 0:r.load()),Ye().log({level:"info",type:"collectionPermanentlyDeleteAllProperties",from:"CollectionSettingsDeletedProperties",data:{miscDataToConvertToString:{collectionId:n.id,spaceId:n.getSpaceId(),deletedPropertyCount:e.length}}}),S().createAndCommit({userAction:"CollectionSettingsDeletedProperties.handlePermanentlyDeleteAllPropertiesClick",environment:o,canUndo:!0,perform:t=>{const l={};e.forEach((e=>{const{propertyId:s}=e;oa(s,o,n,t,i.deleteAutomation,r),l[s]=null})),(0,qs().E)({collectionStore:n,update:l,transaction:t})}})}}]})}(m,t,l,u)}})})),[m,t,l,d,u]);return(0,L.jsx)(C().Ay,{collectionSettingsStore:e,title:(0,L.jsx)(x().sA,{defaultMessage:"Deleted properties",id:"database.viewSettings.propertyTab.deletedTitle"}),footer:f(),children:y()})}const ta=n.memo(ea,Hl().A);function oa(e,t,o,n,i,r){r&&(0,Js().HD)({environment:t,layoutStore:r,property:e,transaction:n});const l=function(e,t){const o=e.getDeletedSchema(),n=o[t];if((0,b().O9)(n)&&(0,oe().nu)(n)&&n.automation_id)return Xs().d.createChildStore(e,{id:n.automation_id,spaceId:e.getSpaceId(),table:Qs().yB})}(o,e);l&&i({automationStore:l,environment:t,transaction:n})}var na=()=>o(221844),ia=()=>o(852507),ra=()=>o(118884),la=()=>o(760077),sa=()=>o(852353),aa=()=>o(493260);const ca=(0,x().YK)({inputPlaceholder:{defaultMessage:"Search for a view…",id:"database.viewSettings.duplicateExistingViewTab.inputPlaceholder"}}),da=7;function ua(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,i=(0,r().v3)(),l=(0,r().Y0)(),a=(0,x().tz)(),c=(0,v().DP)(),d=(0,n.useMemo)((()=>new(na().A)({name:"CollectionSettingsDuplicateExistingView"})),[]),u=(0,s().uB)(void 0,Ql().A),[p,g]=(0,n.useState)(""),[m,S]=(0,n.useState)(!0),y=(0,n.useRef)({lastDuplicatedViewId:void 0,didAccept:!1,wentBack:!1,initialViewType:void 0,preselectedViewPointer:void 0}),f=(0,s().O$)(t.collectionSettingsDuplicateExistingViewLimitStore),h=(0,I().X)("duplicate_existing_view_store"),b=(0,n.useMemo)((()=>h?f:m),[h,f,m]),C=(0,n.useCallback)((e=>{h?t.collectionSettingsDuplicateExistingViewLimitStore.setState(e):S(e)}),[t.collectionSettingsDuplicateExistingViewLimitStore,h]),w=(0,n.useCallback)(((e,o)=>{if(e.id===y.current.lastDuplicatedViewId&&o)return;y.current.lastDuplicatedViewId=e.id;const n=t.collectionViewStore();if(!n)return;let r=n;o&&(r=n.clone(d)),(0,la().U)({viewToDuplicateStore:e,collectionContextStore:t,collectionViewStore:n,environment:i,temporaryStore:r})}),[t,i,d]);(0,ia().w)((()=>{const e=t.collectionViewStore();if(!e)return;const o=(0,aa().v)(e.id);y.current.preselectedViewPointer=null==o?void 0:o.viewPointer,i.defaultRecordCache.inMemoryRecordCache.addCacheOverride(d),y.current.initialViewType=e.getType()})),(0,ra().X)((()=>{const e=y.current;if(i.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(d),!e.didAccept&&!e.wentBack){const{viewStores:o}=ga(t,p,b),n=o.find((t=>t.id===e.lastDuplicatedViewId));if(!n)return;w(n,!1)}}));const j=(0,n.useCallback)((e=>{if(void 0===e)return y.current.lastDuplicatedViewId=void 0,void d.clearCache();w(e,!0)}),[w,d]),A=(0,U().Y)(j,500);(0,s().K8)((()=>{const e=u.state;if(l.isMobile||void 0===e.focus.indexLocal)return;const o=p.length>0;if(!o&&0===e.focus.section||o&&1===e.focus.section)return void A(void 0);const n=ga(t,p,b).viewStores,i=e.focus.indexLocal;if(i<0||i>=n.length)return;const r=n[i];A(r)}),[t,l.isMobile,A,p,b,u]);const _=(0,n.useCallback)((e=>{i.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(d),(0,ar().X)({environment:i,collectionContextStore:t,action:"click_duplicate_view"}),w(e,!1),D().R8({collectionSettingsStore:o,item:{type:"main",selectViewNameInitial:!0}}),y.current.didAccept=!0,C(!0)}),[t,o,w,i,C,d]),k=(0,n.useCallback)((()=>{(0,ar().X)({environment:i,collectionContextStore:t,action:"click_new_empty_view"}),D().os({collectionSettingsStore:o}),D().a2({collectionSettingsStore:o,item:{type:"createView",analytics:void 0}}),y.current.didAccept=!0,C(!0)}),[t,o,i,C]),{viewStores:M,showMore:T}=(0,s().K8)((()=>ga(t,p,b)),[t,p,b]),P=(0,s().K8)((()=>t.isDashboardWidget()),[t]),B=(0,s().K8)((()=>{var e;return function(e){const{theme:t,viewStores:o,showMore:n,preselectedViewPointerId:i,onDuplicateViewAccept:r,onShowMore:l,isDashboardWidget:s}=e,a=Do().oE(o.map((e=>{const t=e.getType(),o=e.getFormat().collection_view_icon;if(!t||"page"===t||s&&"dashboard"===t)return;const n=e.getName(),l=e.id,a={key:l,render:e=>(0,L.jsx)(Q().A,{...e,title:(0,L.jsx)(Pl().A,{collectionViewType:t,collectionViewName:n}),icon:(0,L.jsx)(Tl().h,{color:"regular",viewIcon:o,viewType:t,style:{marginInlineEnd:4,marginInlineStart:2}}),isChecked:i===l}),action:()=>{r(e)}};return a})));if(n>0){const e={key:"showMore",render:e=>(0,L.jsx)(Q().A,{...e,icon:(0,L.jsx)(W().I,{icon:Ml().ellipsisIcon,colorVariant:"secondary"}),style:{color:t.text.secondary},title:(0,L.jsx)(x().sA,{defaultMessage:"Show {showMore} more",id:"database.viewSettings.duplicateExistingViewTab.showMore.title",values:{showMore:n}})}),action:()=>{l()}};a.push(e)}return a}({viewStores:M,showMore:T,preselectedViewPointerId:null===(e=y.current.preselectedViewPointer)||void 0===e?void 0:e.id,onDuplicateViewAccept:_,onShowMore:()=>{C(!1)},theme:c,isDashboardWidget:P})}),[_,C,T,c,M,P]),F=(0,s().K8)((()=>(0,ds().getCollectionNameOrDefault)({intl:a,collectionStore:t.collectionStore()})),[t,a]),V=(0,n.useCallback)((e=>{g(e),u.setState({focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}}),C(!0)}),[u,C]),E=(0,n.useCallback)((()=>{y.current.wentBack=!0,D().yl({collectionSettingsStore:o})}),[o]);return(0,L.jsx)(pa,{collectionSettingsStore:o,collectionName:F,inputValue:p,onInputValueChange:V,menuListItems:B,showMore:T,initialViewType:y.current.initialViewType,menuListStore:u,onNewEmptyViewClick:k,onBackArrowClick:E})}function pa(e){const{collectionSettingsStore:t,collectionName:o,inputValue:i,menuListItems:l,showMore:s,initialViewType:a,menuListStore:c,onNewEmptyViewClick:d,onBackArrowClick:u,onInputValueChange:p}=e,g=(0,r().Y0)(),m=(0,v().IS)((e=>({plusIconStyle:{color:e.icon.secondary}})),[]),S=(0,n.useMemo)((()=>{const e=a?sa().to[a].toLocaleLowerCase():void 0;return e?(0,L.jsx)(x().sA,{defaultMessage:"New {viewType} view",id:"database.viewSettings.createViewTab.newView1",values:{viewType:e}}):(0,L.jsx)(x().sA,{defaultMessage:"New view",id:"database.viewSettings.createViewTab.newView2"})}),[a]),y=(0,n.useMemo)((()=>({key:"emptyViewSection",items:[{key:"emptyViewMenuItem",render:e=>(0,L.jsx)(so().A,{...e,icon:wl().plusIcon,iconStyle:m.plusIconStyle,title:S}),action:d}],render:e=>(0,L.jsx)(A().A,{topBorder:i.length>0,...e})})),[S,i.length,d,m.plusIconStyle]);return(0,L.jsxs)(C().Ay,{collectionSettingsStore:t,title:(0,L.jsx)(x().sA,{defaultMessage:"New view",id:"database.viewSettings.createViewTab.newView"}),handleBackArrowClick:u,children:[s>0||i?(0,L.jsx)(A().A,{children:(0,L.jsx)(pt().Ay,{focusInitial:!g.isMobile||void 0,value:i,onChange:e=>{p(e.target.value)},placeholder:oo().A.formatMessage(ca.inputPlaceholder),showClearButton:!0})}):null,(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,initialFocus:0,sections:Do().oE([i.length?void 0:y,{key:"results",render:e=>0===l.length?(0,L.jsx)(is().A,{caption:(0,L.jsx)(x().sA,{defaultMessage:"No results",id:"database.viewSettings.duplicateExistingViewTab.noResultsTitle"})}):(0,L.jsx)(A().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"Views on {collectionName}",id:"database.viewSettings.duplicateExistingViewTab.viewsTitle",values:{collectionName:o}}),...e}),items:l},i.length?y:void 0]),store:c})]})}function ga(e,t,o){const n=e.collectionViewBlockStore(),i=e.collectionStore(),r=e.collectionViewStore();if(!n||!i||!r)return{viewStores:[],showMore:0};const l=i.getParentBlockStore();if(!n||!l)return{viewStores:[],showMore:0};let s=(0,or().Mf)({collectionStore:i,sourceCollectionViewBlockStore:l,currentCollectionViewBlockStore:n,currentCollectionViewStore:r,constraints:(0,aa().v)(r.id)}),a=0;return t?s=s.filter((e=>(0,or().As)(e,t))):o&&(a=s.length-da,s=s.slice(0,da)),{viewStores:s,showMore:a}}var ma=()=>o(663807),Sa=()=>o(936802),ya=()=>o(229833),fa=()=>o(797535);async function ha(e){const{collectionContextStore:t,environment:o,selectedPropertyIds:n}=e,i=t.collectionStore();i&&(!function(e){const{collectionStore:t,environment:o,selectedPropertyIds:n}=e;S().createAndCommit({environment:o,userAction:"updatePeopleCollectionScimPropertiesTransaction",perform:e=>{const i=t.getSchema(),r=(0,Sa().up)({shouldSyncAllScimProperties:!0}),l=new Map(r.map((e=>[e.id,e])));let s={},a={};for(const t of Object.keys(i)){const e=l.has(t),o=n.has(t);e&&!o?a={...a,[t]:i[t]}:s={...s,[t]:i[t]}}for(const t of n)if(!(t in i)){const e=l.get(t);e&&(s={...s,[t]:{name:e.name,type:e.type,synced_permissions:"read_only"}})}(0,fa().I)({environment:o,collectionStore:t,update:{schema:s,deleted_schema:a},transaction:e})},canUndo:!1})}({collectionStore:i,environment:o,selectedPropertyIds:n}),await async function(e){const{collectionStore:t,environment:o,from:n}=e,i=t.getSpaceId();try{const e=await kt().callApi({eventName:"scheduleReconcilePeopleCollection",environment:o,data:{spaceId:i}});"failed"===e.type&&Ye().log({level:"error",from:n,type:"scheduleReconcilePeopleCollectionFailed",error:(0,ya().convertErrorToLog)(e.error),spaceId:i})}catch(r){Ye().log({level:"error",from:n,type:"scheduleReconcilePeopleCollectionError",error:(0,ya().convertErrorToLog)(r),spaceId:i})}}({collectionStore:i,environment:o,from:"updatePeopleCollectionScimPropertiesTransaction"}))}var va=()=>o(65402);function xa(e){const{checkedProperties:t,collectionContextStore:o,intl:n,theme:i}=e,l=(0,r().v3)();return(0,L.jsxs)("div",{style:{display:"flex",flexDirection:"column",padding:8,textAlign:"center"},children:[(0,L.jsx)(ae().Ay,{caption:(0,L.jsx)(x().sA,{defaultMessage:"{propertiesCount, plural, one {{propertiesCount} property selected} other {{propertiesCount} properties selected}}",id:"database.viewSettings.scimPropertiesTab.propertiesSelected",values:{propertiesCount:t.length}}),shouldWrapCaption:!0}),(0,L.jsx)(M().A,{colorPalette:"blue",onClick:()=>{!function(e){const{checkedProperties:t,collectionContextStore:o,environment:n,intl:i,theme:r}=e;Ro().ui({icon:(0,ma().j)({height:32,width:32}),message:t.length>0?(0,L.jsx)(x().sA,{defaultMessage:"Everyone in {workspaceName} will see the following information",id:"database.viewSettings.scimPropertiesTab.dialogMessage",values:{workspaceName:"your workspace"}}):(0,L.jsx)(x().sA,{defaultMessage:"No SCIM properties will be visible to members in {workspaceName}",id:"database.viewSettings.scimPropertiesTab.noVisibleScimProperties",values:{workspaceName:"your workspace"}}),showCancel:!0,description:t.length>0?(0,L.jsxs)("div",{style:{display:"flex",flexDirection:"column",padding:12,background:r.background.secondaryTranslucent,borderRadius:8,gap:4},children:[(0,L.jsx)(T().D,{styleKey:"Body/Semibold",colorVariant:"primary",children:i.formatMessage(va().D.visibleToAllWorkspaceMembers)}),(0,L.jsx)("ul",{style:{textAlign:"start",margin:0,paddingInlineStart:20},children:t.map((e=>(0,L.jsx)("li",{children:(0,L.jsx)(T().D,{styleKey:"Body/Regular",children:e.name})},e.name)))})]}):null,items:[{label:(0,L.jsx)(x().sA,{defaultMessage:"Continue",id:"database.viewSettings.scimPropertiesTab.continue"}),color:"blue",buttonType:"solid",onAccept:async()=>{const e=new Set(t.map((e=>e.id)));await ha({collectionContextStore:o,environment:n,selectedPropertyIds:e})}}],keepFocus:!0})}({checkedProperties:t,collectionContextStore:o,environment:l,intl:n,theme:i})},children:(0,L.jsx)(x().sA,{defaultMessage:"Update properties",id:"database.viewSettings.scimPropertiesTab.updatePropertiesButton"})})]})}function ba(e,t){return{id:e.id,name:e.name,type:e.type,isSelected:t.has(e.id)}}function Ca(e){const[t,o]=(0,n.useState)(""),i=(0,v().DP)(),r=(0,x().tz)(),l=(0,Sa().up)({shouldSyncAllScimProperties:!0}),a=(0,s().K8)((()=>{const t=e.collectionContextStore.collectionStore();if(!t)throw new Error("Collection store not found");const o=t.getSchema(),n=Object.keys(o).filter((e=>l.some((t=>t.id===e))));return new Set(n)}),[e.collectionContextStore,l]),[c,d]=(0,n.useState)(a),u=(0,n.useMemo)((()=>l.filter((e=>!!e.name&&e.name.toLowerCase().includes(t.toLowerCase())))),[l,t]),p=(0,n.useCallback)((e=>{d((t=>{const o=new Set(t);return o.has(e)?o.delete(e):o.add(e),o}))}),[]),g=(0,n.useCallback)((e=>({key:e.id,render:t=>(0,L.jsx)(Q().A,{...t,focused:t.focused,onClick:()=>{p(e.id)},title:(0,L.jsx)("div",{children:e.name}),left:(0,L.jsx)("div",{children:(0,L.jsx)($e().S,{size:14,checked:e.isSelected,onClick:()=>{p(e.id)},style:{borderRadius:2}})}),icon:(0,L.jsx)(Qe().zB,{type:e.type,icon:void 0,size:F().Ev.sm,theme:i})}),action:()=>{}})),[p,i]);return(0,L.jsxs)(C().Ay,{collectionSettingsStore:e.collectionSettingsStore,title:(0,L.jsx)(x().sA,{defaultMessage:"SCIM Properties",id:"database.viewSettings.scimPropertiesTab.title"}),footer:(0,L.jsx)(xa,{checkedProperties:l.filter((e=>c.has(e.id))).map((e=>ba(e,c))),collectionContextStore:e.collectionContextStore,intl:r,theme:i}),children:[(0,L.jsx)(ae().Ay,{caption:(0,L.jsx)(x().sA,{defaultMessage:"Select which SCIM properties are visible on people’s profiles",id:"database.viewSettings.scimPropertiesTab.caption"}),shouldWrapCaption:!0}),(0,L.jsx)(pt().Ay,{placeholder:r.formatMessage(va().D.propertyInputPlaceholder),value:t,onChange:e=>o(e.target.value),style:{marginBottom:12}}),(0,L.jsx)(dt,{title:(0,L.jsx)(x().sA,{defaultMessage:"{checked, plural, one {1} other {#}} of {total} optional properties",id:"database.viewSettings.scimPropertiesTab.subtitle",values:{checked:c.size,total:l.length}}),disableCollapse:!0,disableSelectAll:!0,items:u.map((e=>ba(e,c))).map(g)},"SCIM Properties")]})}var wa=()=>o(158797),ja=()=>o(584262),Aa=()=>o(343630),_a=()=>o(985156),Ia=()=>o(180762),ka=()=>o(239529),Ma=()=>o(297175),Ta=()=>o(414360);var Pa=()=>o(334003),Ba=()=>o(764781),Fa=()=>o(10521),Va=()=>o(962910),Da=()=>o(496592),Ea=()=>o(733539),Ra=()=>o(810521),Oa=()=>o(961606),Ka=()=>o(223393),Na=()=>o(345913);const La=(0,x().YK)({deletedDataSource:{id:"collectionSettingsActions.dataSourceDeleted",defaultMessage:"Deleted {dataSourceName}"},deleteConfirmationTitle:{id:"collectionSettingsActions.deleteDataSourceConfirmation",defaultMessage:"Delete {dataSourceName}?"},deleteConfirmationDescriptionWithViews:{id:"collectionSettingsActions.deleteDataSourceConfirmationDescription",defaultMessage:"This will delete the data source and {numberOfViewsToDelete, plural, one {# view} other {# views}}."},deleteConfirmationDescriptionWithViewsAndDescription:{id:"collectionSettingsActions.deleteConfirmationDescriptionWithViewsAndDescription",defaultMessage:"This will delete the data source and {numberOfViewsToDelete, plural, one {# view} other {# views}}. Deleting it will also remove the database description."},deleteConfirmationButton:{id:"collectionSettingsActions.deleteDataSourceConfirmationButton",defaultMessage:"Delete data source"}});function za({collectionStore:e,parentBlockStore:t,relationPropertyUri:o,expectedType:n}){const i=e.getFormatStore().getKeyStore("app_uri_map").getValue();if(!i)return;const r=i[o];if(!r)return;const l=e.getSchemaStore().getKeyStore(r).getValue();if(!l||!oe().nC(l))return;const s=oe().Nv(l);if(!s)return;const a=Pt().m.createChildStore(t,s);return a.getDatabaseType()===n?a:void 0}async function Ua({intl:e,environment:t,store:o,showToast:n=!0,showConfirmationDialog:i=!0,analytics:r}){var l,s;const a=(0,ds().getCollectionNameOrDefault)({collectionStore:o,intl:e}),c=o.getParentBlockStore();if(!c)return{result:"error"};const d=1===(null===(l=c.getCollectionStores())||void 0===l?void 0:l.length)&&!(0,ci().w9s)(o.getDescription()),u=(null===(s=c.getCollectionViewStores())||void 0===s?void 0:s.filter((e=>{var t;return(null===(t=e.getCollectionStore())||void 0===t?void 0:t.id)===o.id})))??[];if(i){let t;u.length>0&&(t=d?e.formatMessage(La.deleteConfirmationDescriptionWithViewsAndDescription,{numberOfViewsToDelete:u.length}):e.formatMessage(La.deleteConfirmationDescriptionWithViews,{numberOfViewsToDelete:u.length}));if(!(await Ro().Gh({message:e.formatMessage(La.deleteConfirmationTitle,{dataSourceName:a}),description:t,acceptLabel:e.formatMessage(La.deleteConfirmationButton)})).accept)return{result:"cancelled"}}const{sprintsCollectionStore:p,tasksCollectionStore:g}=function(e,t){const o=e.getDatabaseType();if(o===pn().av){const o=za({collectionStore:e,parentBlockStore:t,relationPropertyUri:pn().Hx.SprintToTaskRelation,expectedType:pn().dC});if(o)return{sprintsCollectionStore:e,tasksCollectionStore:o}}if(o===pn().dC){const o=za({collectionStore:e,parentBlockStore:t,relationPropertyUri:pn().yx.TaskToSprintRelation,expectedType:pn().av});if(o)return{sprintsCollectionStore:o,tasksCollectionStore:e}}return{sprintsCollectionStore:void 0,tasksCollectionStore:void 0}}(o,c);if(p&&g){const i=(0,ds().getCollectionNameOrDefault)({collectionStore:p,intl:e}),l=(0,ds().getCollectionNameOrDefault)({collectionStore:g,intl:e}),s=new Intl.ListFormat(e.locale,{style:"long",type:"conjunction"}).format([l,i]),d=await(0,Va().h4)((0,Va().kB)("delete",a,s),"delete");switch(d){case"cancel":return{result:"cancelled"};case"all":return function({environment:e,sprintsCollectionStore:t,tasksCollectionStore:o,parentBlockStore:n,analytics:i,toastMessage:r,showToast:l}){const s=n.getOwnedCollectionStores(),a=n.getLinkedCollectionStores(),c=new Set(s.map((e=>e.id))),d=2===s.length&&0===a.length&&c.has(t.id)&&c.has(o.id);S().createAndCommit({userAction:"dataSourceDeletionActions.deleteBothSprintsAndTasks",environment:e,canUndo:!0,perform:c=>{if(d)Na().oD({environment:e,blocks:[n],transaction:c,permanentlyDelete:!1}),c.postSubmitCallbacks.push((async t=>{if(!t){await(0,Oa().V)({environment:e,blocks:[n]});const t=Ea().default.state.undoStack.at(-1),o=Ea().default.state.invertedTextOperationIdMapper;setTimeout((()=>{t&&Ea().default.setState({undoStack:[t],redoStack:[],invertedTextOperationIdMapper:o}),l&&(0,Ka().r)({item:{label:r},undoFunc:()=>{}})}),200)}}));else{for(const r of[t,o])(0,Da().removeCollectionFromCollectionViewBlock)({collectionViewBlockStore:n,collectionStore:r,transaction:c}),(0,Ra().trackDeleteDataSource)(e,{collection_view_block_id:n.id,collection_id:r.id,owned_collection_count:s.length,linked_collection_count:a.length,data_source_session_id:i.dataSourceSessionId});l&&(0,Ka().r)({item:{label:r},undoFunc:()=>{}})}}})}({environment:t,sprintsCollectionStore:p,tasksCollectionStore:g,parentBlockStore:c,showToast:n,toastMessage:e.formatMessage(La.deletedDataSource,{dataSourceName:s}),analytics:r}),{result:"accepted"};case"one":return Wa({environment:t,store:o,parentBlockStore:c,showToast:n,toastMessage:e.formatMessage(La.deletedDataSource,{dataSourceName:a}),analytics:r}),{result:"accepted"};default:(0,b().HB)(d)}}return Wa({environment:t,store:o,parentBlockStore:c,showToast:n,toastMessage:e.formatMessage(La.deletedDataSource,{dataSourceName:a}),analytics:r}),{result:"accepted"}}function Wa({environment:e,store:t,parentBlockStore:o,showToast:n,toastMessage:i,analytics:r}){var l,s;S().createAndCommit({userAction:"collectionSettingsActions.deleteDataSource",environment:e,canUndo:!0,perform:e=>{(0,Da().removeCollectionFromCollectionViewBlock)({collectionViewBlockStore:o,collectionStore:t,transaction:e})}}),n&&(0,Ka().r)({item:{label:i},undoFunc:()=>{}}),(0,Ra().trackDeleteDataSource)(e,{collection_view_block_id:o.id,collection_id:t.id,owned_collection_count:null===(l=o.getOwnedCollectionStores())||void 0===l?void 0:l.length,linked_collection_count:null===(s=o.getLinkedCollectionStores())||void 0===s?void 0:s.length,data_source_session_id:r.dataSourceSessionId})}var Ha=()=>o(333334),Ga=()=>o(799832),$a=()=>o(811979),Qa=()=>o(45552);const Ya=(0,x().YK)({dataSourceCopied:{id:"manageDataSourcesMenu.uuidCopied",defaultMessage:"{dataSourceName} ID copied"},copyDataSourceID:{id:"manageDataSourcesMenu.copyDataSourceID",defaultMessage:"Copy data source ID"},moveTo:{id:"manageDataSourcesMenu.moveTo",defaultMessage:"Move to"}});function qa({collectionStore:e,collectionViewBlockStore:t,analytics:o,orderedActions:i,buttonIconFill:l}){const a=(0,r().v3)(),c=(0,x().tz)(),d=(0,n.useRef)(null),u=(0,s().uB)(void 0,J().A),p=(0,s().K8)((()=>(0,ds().getCollectionNameOrDefault)({collectionStore:e,intl:c})),[e,c]),g=(0,v().IS)((()=>({buttonIcon:{width:20,height:20,fill:l},subMenuIcon:{width:20,height:20,fill:"inherit"}})),[l]);if(0===i.length)return null;const m={copyDataSourceId:{action:async()=>{const t=await js().R.clipboardActions.load();await t.copyString({environment:a,stringValue:e.id,copiedMessage:Ya.dataSourceCopied,copiedMessageValues:{dataSourceName:(0,ds().getCollectionNameOrDefault)({collectionStore:e,intl:c})}}),u.setState({open:!1})},render:e=>(0,L.jsx)(Q().A,{title:(0,L.jsx)(x().sA,{...Ya.copyDataSourceID}),icon:(0,Ba().V)(g.subMenuIcon),...e})},moveTo:{action:()=>{var n;return Ha().L1({environment:a,collectionStore:e,collectionViewBlockStore:t,originRect:null===(n=d.current)||void 0===n?void 0:n.getBoundingClientRect(),moveToContext:"manage_data_sources",placementToOrigin:"left",onAccept:()=>{if(!h().A.isMobile)return;const e=(0,Ga().U)(t);e&&D().os({collectionSettingsStore:e.settingsStore})},analytics:o})},render:e=>(0,L.jsx)(Q().A,{title:(0,L.jsx)(x().sA,{...Ya.moveTo}),icon:(0,Pa().F)(g.subMenuIcon),...e,ref:d})},delete:{action:async()=>{const{result:t}=await Ua({intl:c,environment:a,store:e,showConfirmationDialog:!0,showToast:!0,analytics:o});"accepted"===t&&u.setState({open:!1})},render:e=>(0,L.jsx)(Q().A,{title:(0,L.jsx)(x().sA,{...Fa().AY.moveToTrashName}),icon:(0,G().trashIcon)(g.subMenuIcon),isRedOnHover:!0,...e})}};return(0,L.jsx)($a().A,{focused:!1,buttonPopupStore:u,alignmentToOrigin:"end",placementToOrigin:"bottom",bottomSheetInitialState:"half",popupType:h().A.isMobile?R().z.BottomSheet:R().z.Popup,renderOrigin:e=>(0,L.jsx)(Bl().A,{...e,icon:Ml().ellipsisIcon,iconStyle:g.buttonIcon,ariaLabel:c.formatMessage({id:"manageDataSourcesMenu.moreOptionsAriaLabel",defaultMessage:"Data source actions"})}),render:e=>(0,L.jsx)(Ja,{collectionName:p,menuItems:i.map((e=>({key:e,...m[e]}))),onClose:e.close})})}function Ja({collectionName:e,menuItems:t,onClose:o}){const i=(0,n.useMemo)((()=>h().A.isMobile?{title:e,menuType:K().gu.Modal,right:(0,L.jsx)(Qa().DoneMenuText,{}),onClickRight:o}:{menuType:K().gu.Popup,width:200}),[e,o]);return(0,L.jsx)(O().A,{...i,children:(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,initialFocus:void 0,sections:[{key:"dataSourceOptions",items:t,render:e=>(0,L.jsx)(A().A,{...e})}]})})}function Xa({collectionContextStore:e,collectionStore:t,onCloseParentMenu:i,analytics:l,...a},c){const d=(0,x().tz)(),u=(0,r().v3)(),p=(0,s().K8)((()=>{var o;return(null===(o=e.collectionViewBlockStore())||void 0===o?void 0:o.id)===t.getParentId()}),[e,t]),g=(0,s().K8)((()=>e.collectionViewBlockStore()),[e]),m=(0,s().K8)((()=>null==g?void 0:g.isNonEditableState()),[g]),y=(0,s().K8)((()=>(0,Ma().h0)({collectionViewBlockStore:g,collectionStore:t})),[g,t]),f=(0,s().K8)((()=>{var e;return((null==g||null===(e=g.getCollectionViewStores())||void 0===e?void 0:e.length)??0)===y.length}),[g,y]),h=(0,s().K8)((()=>(0,Ma().h0)({collectionViewBlockStore:g,collectionStore:t})),[g,t]),b=(0,s().K8)((()=>({canAdmin:null==t?void 0:t.canAdmin(),canConfigureCollection:(0,o(33791).v)({collectionStore:t,collectionViewBlockStore:g,checkNavigableAncestorLocked:!1}),canConfigureBlock:e.permissionScopesStore.state.canConfigureBlock,canViewCollection:void 0!==t.getModel()})),[t,g,e]),C=(0,s().K8)((()=>{const e=(0,L.jsx)(As().B6,{icon:t.getIcon(),iconRecordCategory:"collection",disabled:!0,isEmptyPage:!1,size:20});return p?e:(0,L.jsx)(o(168953).C,{icon:e})}),[t,p]),w=(0,s().K8)((()=>b.canViewCollection?(0,ds().getCollectionNameOrDefault)({collectionStore:t,intl:d}):d.formatMessage({id:"manageDataSourcesMenu.noAccess",defaultMessage:"No access"})),[t,d,b.canViewCollection]),j=p&&b.canAdmin&&!m,A=p&&b.canConfigureCollection&&!f,_=p,I=!p&&b.canConfigureBlock&&!f&&y.length>0,k=j||A||I||_,M=(0,n.useCallback)((()=>{const o=e.collectionViewBlockStore();o&&function({environment:e,collectionContextStore:t,collectionViewBlockStore:o,collectionStore:n}){var i;const r=(0,Ma().h0)({collectionViewBlockStore:o,collectionStore:n}),l=new Set(r.map((e=>e.id))),s=o.getCollectionViewStores().find((e=>!l.has(e.id)));if(!s)return;const a=null===(i=t.collectionViewStore())||void 0===i?void 0:i.id,c=a&&l.has(a);S().createAndCommit({userAction:"collectionSettingsActions.handleDeleteCollectionViews",environment:e,canUndo:!0,perform:e=>{for(const t of r)(0,Ta().T)({collectionViewBlockStore:o,collectionViewStore:t,transaction:e})}}),c&&(0,Ia().t)({environment:e,collectionContextStore:t,collectionViewId:s.id,isFullScreen:t.isFullScreenStore.state,isInPeekRenderer:t.isInPeekRendererStore.state,isRootChild:t.isRootChildStore.state})}({environment:u,collectionContextStore:e,collectionViewBlockStore:o,collectionStore:t})}),[u,e,t]),P=(0,v().IS)((e=>({wrapper:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",...k?{paddingInlineEnd:2}:{}},titleAndIcon:{display:"flex",flexDirection:"row",alignItems:"center",gap:8,marginInlineEnd:8,...!b.canViewCollection&&{color:e.icon.secondary,fill:e.icon.secondary}},title:{...We().RC},trashAndNumViews:{display:"flex",flexDirection:"row",alignItems:"center",gap:8},rightIcon:{fill:e.icon.secondary,width:20,height:20},viewsTooltipContent:{maxWidth:150,display:"flex",flexDirection:"column",gap:2}})),[k,b.canViewCollection]);return(0,L.jsx)(Q().A,{ref:c,style:P.wrapper,...a,titleStyle:P.titleAndIcon,title:(0,L.jsxs)(L.Fragment,{children:[C,(0,L.jsx)(o(265665).j,{children:(0,L.jsx)("span",{style:P.title,children:w})})]}),rightStyle:P.trashAndNumViews,right:(0,L.jsxs)(L.Fragment,{children:[0===h.length?null:(0,L.jsx)(at().A,{delayThreshold:400,render:e=>(0,L.jsx)("div",{...e,children:(0,L.jsx)(T().D,{colorVariant:"tertiary",children:(0,L.jsx)(x().sA,{id:"manageDataSourcesMenu.nViews",defaultMessage:"{numViews, select, 1 {1 view} other {{numViews} views}}",values:{numViews:h.length<100?h.length:"99+"}})})}),renderTooltip:e=>(0,L.jsxs)("div",{style:P.viewsTooltipContent,...e,children:[h.slice(0,20).map((e=>(0,L.jsx)(Za,{viewStore:e},e.id))),h.length<=20?null:(0,L.jsx)(T().D,{children:(0,L.jsx)(x().sA,{id:"manageDataSourcesMenu.plusMoreViews",defaultMessage:"{numViews, plural, one {+1 more} other {+{numViews} more}}",values:{numViews:h.length-20}})})]})}),(0,L.jsx)(qa,{collectionStore:t,collectionViewBlockStore:g,analytics:l,orderedActions:(0,Do().oE)([_?"copyDataSourceId":void 0,j?"moveTo":void 0,A?"delete":void 0]),buttonIconFill:P.rightIcon.fill}),I?(0,L.jsx)(at().A,{delayThreshold:400,renderTooltip:()=>(0,L.jsx)(x().sA,{id:"manageDataSourcesMenu.deleteViewsTooltip",defaultMessage:"Delete {numViews, select, 1 {linked view} other {{numViews} linked views}}",values:{numViews:y.length}}),render:e=>(0,L.jsx)(Bl().A,{...e,icon:o(599813).xMarkIcon,iconStyle:P.rightIcon,ariaLabel:d.formatMessage({id:"manageDataSourcesMenu.deleteViewsAriaLabel",defaultMessage:"Delete linked views"}),onClick:M})}):null]})})}function Za({viewStore:e}){const{viewType:t,icon:o,name:n}=(0,s().K8)((()=>{const t=e.getType();return{viewType:t,icon:e.getFormat().collection_view_icon,name:(0,or().OO)({collectionViewName:e.getName(),collectionViewType:t})}}),[e]),i=(0,v().IS)((()=>({viewsTooltipRow:{display:"flex",flexDirection:"row",alignItems:"center",gap:8},name:{...We().RC}})),[]);return(0,L.jsxs)("div",{style:i.viewsTooltipRow,children:[(0,L.jsx)(Tl().h,{color:"lightGray",viewType:t,viewIcon:o,size:16}),(0,L.jsx)("div",{style:i.name,children:n})]})}const ec=n.forwardRef(Xa);function tc({collectionStore:e,collectionContextStore:t}){var o;return(null===(o=t.collectionViewBlockStore())||void 0===o?void 0:o.id)===e.getParentId()}function oc(e){const{collectionContextStore:t,analytics:o}=e,i=(0,r().v3)(),l=(0,x().tz)(),a=(0,s().K8)((()=>{var e;return(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getOwnedCollectionStores())??[]}),[t]),c=(0,s().K8)((()=>{var e;return(0,Do().hS)((null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[],(e=>{var t;return null===(t=e.getCollectionStore())||void 0===t?void 0:t.id})).flatMap((e=>{const o=e.getCollectionStore();if(!o)return[];return!tc({collectionStore:o,collectionContextStore:t})?[o]:[]}))}),[t]),d=(0,s().O$)(t.canConfigureBlockStore),u=(0,n.useCallback)((e=>(0,Ma().h0)({collectionViewBlockStore:t.collectionViewBlockStore(),collectionStore:e})[0]),[t]),[p,g]=(0,qe().V$)((async(e,o)=>{var n;if(h().A.isMobile&&D().os({collectionSettingsStore:t.settingsStore}),!tc({collectionStore:e,collectionContextStore:t})){if(!e.getModel())return;return void(0,ka().S)({environment:i,collectionStore:e,event:o,pageVisitSource:ja().y8.ManageDataSourcesMenu})}if(e.id===(null===(n=t.collectionStore())||void 0===n?void 0:n.id))return;const r=u(e);r?(0,Ia().t)({environment:i,collectionContextStore:t,collectionViewId:r.id,isFullScreen:t.isFullScreenStore.state,isInPeekRenderer:t.isInPeekRendererStore.state,isRootChild:t.isRootChildStore.state}):await async function(e){const{environment:t,collectionContextStore:o,collectionStore:n,intl:i}=e,r=(0,ds().getCollectionNameOrDefault)({intl:i,collectionStore:n});if(!(await Ro().Gh({message:(0,L.jsx)(x().sA,{id:"manageDataSourcesMenu.createNewView.title",defaultMessage:"Create a view for {dataSourceName}?",values:{dataSourceName:r}}),description:(0,L.jsx)(x().sA,{id:"manageDataSourcesMenu.createNewView.description",defaultMessage:"{dataSourceName} has no views",values:{dataSourceName:r}}),acceptLabel:(0,L.jsx)(x().sA,{id:"manageDataSourcesMenu.createNewView.acceptLabel",defaultMessage:"Create a view"}),cancelLabel:(0,L.jsx)(x().sA,{id:"manageDataSourcesMenu.createNewView.cancelLabel",defaultMessage:"Cancel"}),acceptColor:"blue"})).accept)return;S().createAndCommit({environment:t,userAction:"createNewViewFromEmptyDataSource",canUndo:!0,perform:e=>(0,_a().Z)({environment:t,collectionContextStore:o,collectionStore:n,newViewType:"table",transaction:e,settingsDestination:"skip"})})}({environment:i,collectionContextStore:t,collectionStore:e,intl:l})}),[t,i,l,u]),m=(0,v().IS)((e=>({textOverflow:We().RC,learnMoreSection:h().A.isMobile?{}:{marginTop:6}})),[]),y=(0,s().K8)((()=>{var e;return null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.canAddCollection()}),[t]),f=!(null!=y&&y.canAddView),b=(0,s().K8)((()=>{var e;return!(null!==(e=t.collectionViewBlockStore())&&void 0!==e&&e.canAddCollectionView())}),[t]),w=(0,s().K8)((()=>{const e=d?{key:"AddDatabase",render:e=>(0,L.jsx)(at().A,{render:t=>(0,L.jsx)(Q().A,{title:(0,L.jsx)(T().D,{colorPalette:"gray",colorVariant:"secondary",children:(0,L.jsx)(x().sA,{defaultMessage:"Add data source",id:"manageDataSourcesMenu.addDatabase.title"})}),icon:(0,L.jsx)(W().I,{icon:wl().plusIcon,colorPalette:"gray",colorVariant:"secondary"}),titleStyle:m.textOverflow,disabled:f,disabledFeedback:f,...e,...t}),renderTooltip:()=>(0,L.jsx)(Aa().k,{canAddCollectionResult:y}),placement:"right",disableTooltip:!f}),action:()=>{S().createAndCommit({environment:i,userAction:"createAndFocusNewDataSource",canUndo:!0,perform:e=>{(0,_a().n)({environment:i,collectionContextStore:t,transaction:e,analytics:{from:"addNewDatabaseButtonInManageDataSourcesMenu",dataSourceFrom:"manage_data_sources",dataSourceSessionId:o.dataSourceSessionId}})}})}}:void 0,n=d?{key:"LinkExisting",render:e=>(0,L.jsx)(at().A,{render:t=>(0,L.jsx)(Q().A,{title:(0,L.jsx)(T().D,{colorPalette:"gray",colorVariant:"secondary",children:(0,L.jsx)(x().sA,{defaultMessage:"Link existing data source",id:"manageDataSourcesMenu.linkExisting.title"})}),titleStyle:m.textOverflow,icon:(0,L.jsx)(W().I,{icon:wl().plusIcon,colorVariant:"secondary"}),disabled:b,disabledFeedback:b,...e,...t}),renderTooltip:()=>(0,L.jsx)(Aa().k,{canAddCollectionResult:{canAddView:!1,reason:"tooManyViews"}}),placement:"right",disableTooltip:!b}),action:()=>S().createAndCommit({environment:i,userAction:"createNewViewFromManageDataSourcesMenu",canUndo:!0,perform:e=>(0,_a().Z)({environment:i,collectionContextStore:t,newViewType:"table",transaction:e,settingsDestination:"linkToDatabase",analytics:{dataSourceFrom:"manage_data_sources",dataSourceSessionId:o.dataSourceSessionId}})})}:void 0,r=(0,Do().oE)([...a.map((e=>{const n=Boolean(u(e))||d;return{key:e.id,render:i=>(0,L.jsx)(ec,{collectionContextStore:t,collectionStore:e,onCloseParentMenu:()=>{D().os({collectionSettingsStore:t.settingsStore})},analytics:o,disabled:!n,...i}),action:({event:t})=>g(e,t)}})),e]),l=r.length>0?{key:"manageDataSources",render:e=>(0,L.jsx)(A().A,{topBorder:!1,disableMobileBorders:!0,title:(0,L.jsx)(x().sA,{defaultMessage:"Source",id:"manageDataSourcesMenu.manageDataSources.sources.title"}),...e}),items:r}:void 0,s=(0,Do().oE)([...c.map((e=>({key:e.id,render:n=>(0,L.jsx)(ec,{collectionContextStore:t,collectionStore:e,onCloseParentMenu:()=>{D().os({collectionSettingsStore:t.settingsStore})},analytics:o,disabled:!e.getModel(),...n}),action:({event:t})=>g(e,t)}))),n]),p=s.length>0?{key:"linkedDatabases",render:e=>(0,L.jsx)(A().A,{topBorder:void 0!==l,disableMobileBorders:!0,title:(0,L.jsx)(x().sA,{defaultMessage:"Linked",id:"manageDataSourcesMenu.manageDataSources.linked.title"}),...e}),items:s}:void 0,h=(0,No().x)("guides.dataSources"),v={key:"learnMore",render:e=>(0,L.jsx)(A().A,{...e,topBorder:!0,disableMobileBorders:!0,desktopStyle:m.learnMoreSection}),items:[{key:"learnMore",render:e=>(0,L.jsx)(Q().A,{...e,href:h,icon:(0,L.jsx)(W().I,{icon:Zn().questionMarkCircleIcon,colorVariant:"secondary"}),titleStyle:m.textOverflow,title:(0,L.jsx)(T().D,{colorPalette:"gray",colorVariant:"secondary",children:(0,L.jsx)(x().sA,{id:"manageDataSourcesMenu.learnMore.title",defaultMessage:"Learn about data sources"})})}),action:({event:e})=>{var t;window.open(h,"_blank"),null==e||null===(t=e.preventDefault)||void 0===t||t.call(e)}}]};return(0,Do().oE)([l,p,v])}),[d,a,c,f,m.textOverflow,m.learnMoreSection,y,i,t,o,b,u,g]);return(0,L.jsx)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{id:"database.viewSettings.manageDataSources.title",defaultMessage:"Manage data sources"}),handleClose:()=>D().os({collectionSettingsStore:t.settingsStore}),children:(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,initialFocus:void 0,sections:w})})}const nc=(0,x().YK)({inputPlaceholder:{defaultMessage:"Search for a page…",id:"database.viewSettings.searchPages.inputPlaceholder"},searchResultsTitle:{defaultMessage:"Search results",id:"database.viewSettings.searchPages.searchResultsTitle"},recentPagesTitle:{defaultMessage:"Recent pages",id:"database.viewSettings.searchPages.recentPagesTitle"}}),ic=St().Store.createClass("",{name:"InputStore"}),rc=n.memo((function(e){const{parentStore:t,onAccept:i,inputStore:r,currentPageId:l}=e,a=(0,x().tz)(),c=(0,s().uB)(r,ic),d=(0,s().uB)(void 0,Ql().A),u=(0,s().O$)(c),{results:p,isResultsLoading:g}=(0,ls().W)({query:u,limit:20,source:"page_view_selector",type:ns().Vz.BlocksInSpace,filters:{blockTypes:["page"]},options:{disable:0===u.length},peopleBlocksToInclude:"all"}),m=(0,s().K8)((()=>u.length>0?[]:(o(825972).wI.state||[]).filter((e=>{var t;return"page"===(null===(t=e.store)||void 0===t?void 0:t.getType())})).slice(0,10)),[u]),S=(0,n.useMemo)((()=>{const e=[],o=(u.length>0?p:m).map((e=>{const o="id"in e?e.id:e.pageId,n="store"in e&&e.store?e.store:ui().B.createChildStore(t,{table:"block",id:o,spaceId:t.getSpaceId()});return{key:o,action:()=>{i(n)},render:e=>{const t=n.id===l;return(0,L.jsx)(rs().A,{...e,store:n,style:t?{backgroundColor:"var(--bg-hover)"}:void 0})}}}));return e.push({key:"results",render:e=>(0,L.jsx)(A().A,{title:u.length>0?(0,L.jsx)(x().sA,{...nc.searchResultsTitle}):o.length>0?(0,L.jsx)(x().sA,{...nc.recentPagesTitle}):void 0,children:e.children}),items:o,showNoResultMessage:!g&&0===o.length&&u.length>0}),e}),[p,m,g,u,i,t,l]);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(A().A,{isInput:!0,children:(0,L.jsx)(pt().Ay,{focusInitial:!0,value:u,onChange:e=>{c.setState(e.target.value),d.setState({focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})},placeholder:a.formatMessage(nc.inputPlaceholder),showClearButton:!0})}),(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,initialFocus:0,sections:S.filter(b().O9),store:d})]})}),Hl().A);function lc(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,i=(0,r().v3)(),{collectionViewStore:l,collectionViewBlockStore:a,pagePointer:c}=(0,s().K8)((()=>{const e=t.collectionViewStore(),o=t.collectionViewBlockStore(),n=null==e?void 0:e.getFormat();return{collectionViewStore:e,collectionViewBlockStore:o,pagePointer:null==n?void 0:n.page_pointer}}),[t]),d=(0,n.useMemo)((()=>St().Store.createValue("")),[]),u=n.useCallback((e=>{l&&(S().createAndCommit({environment:i,userAction:"CollectionSettingsPageViewSource.handlePageAccept",canUndo:!0,perform:t=>{m().zA({stores:[l],update:{page_pointer:{id:e.id,table:"block",spaceId:e.getSpaceId()}},transaction:t})}}),D().yl({collectionSettingsStore:o}))}),[l,i,o]);return a?(0,L.jsx)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Source",id:"database.viewSettings.sourceTab.title"}),handleClose:()=>D().os({collectionSettingsStore:o}),children:(0,L.jsx)(rc,{parentStore:a,onAccept:u,inputStore:d,currentPageId:null!=c&&c.id?c.id:void 0})}):null}const sc=n.memo(lc);var ac=()=>o(750294),cc=()=>o(526278),dc=()=>o(128011),uc=()=>o(608997),pc=()=>o(503264),gc=()=>o(402560);const mc=(0,x().YK)({noConfigurationFound:{defaultMessage:"No agent configuration found for this property.",id:"collectionSettings.propertyAgentAutofill.noConfigForProperty"},configurationTitle:{defaultMessage:"Agent Autofill Configuration",id:"collectionSettings.propertyAgentAutofill.title"},back:{defaultMessage:"Back",id:"propertyAgentAutofill.back"}});function Sc(e){const{collectionContextStore:t,workflowId:o,collectionSettingsStore:i}=e,r=(0,x().tz)(),[l,a]=(0,Y().B)(),c=(0,v().IS)((e=>({loadingText:{color:e.text.secondary,fontSize:14},arrowButton:{marginInlineEnd:8,marginInlineStart:-2,height:22},arrowIcon:{width:16,height:16},debugButtonWrapper:{opacity:a?1:0,transition:"opacity 0.2s ease-in-out",pointerEvents:a?"auto":"none"}})),[a]),d=(0,s().K8)((()=>null==t?void 0:t.collectionStore()),[t]),u=t.databaseAgentsListSettingsStore,p=(0,s().K8)((()=>null==d?void 0:d.getSpaceId()),[d]),g=(0,s().K8)((()=>{if(!p||!d)return;const e=d.getParentCollectionViewBlockStore();return e?(0,gc().R5)({workflowId:o,collectionViewBlockStore:e,spaceId:p}):null}),[d,o,p]),m=(0,s().K8)((()=>{if(!g)return;const e=g.getDraftData();if(e)return e.name;const t=g.getData();return t?t.name:(0,L.jsx)(x().sA,{...mc.configurationTitle})}),[g]),S=(0,n.useCallback)((()=>{D().os({collectionSettingsStore:i}),u.setState({open:!0})}),[i,u]),y=(0,n.useCallback)((()=>{D().os({collectionSettingsStore:i})}),[i]);return d&&p?(0,L.jsx)("div",{ref:l,children:(0,L.jsx)(C().Ay,{...e,title:m,backArrowButton:(0,L.jsx)(Bl().A,{icon:cc().w,style:c.arrowButton,iconStyle:c.arrowIcon,onClick:S,ariaLabel:r.formatMessage(mc.back)}),topRightButton:g?(0,L.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:[(0,L.jsx)("div",{style:c.debugButtonWrapper,children:(0,L.jsx)(dc().S,{spaceId:p,workflowStore:g})}),(0,L.jsx)(uc().g,{collectionContextStore:t,collectionSettingsStore:i,collectionStore:d,spaceId:p,workflowStore:g})]}):void 0,children:(0,L.jsx)(pc().e,{collectionContextStore:t,collectionStore:d,handleCloseParent:y,spaceId:p,workflowId:o})})}):(0,L.jsx)("div",{style:c.loadingText,children:(0,L.jsx)(x().sA,{...mc.noConfigurationFound})})}var yc=()=>o(396896),fc=()=>o(362750),hc=()=>o(992214),vc=()=>o(116089),xc=()=>o(583289),bc=()=>o(495262),Cc=()=>o(272200),wc=()=>o(312540),jc=()=>o(419167),Ac=()=>o(135221),_c=()=>o(486674),Ic=()=>o(68465),kc=()=>o(71304),Mc=()=>o(937199),Tc=()=>o(411671);var Pc=()=>o(363631),Bc=()=>o(84262),Fc=()=>o(204330),Vc=()=>o(908375),Dc=()=>o(35091);const Ec=(0,x().YK)({autoUpdateExplanationMessage:{defaultMessage:"Keep values updated with the latest edits to pages",id:"database.CollectionSettingsPropertyAiAutofill.autoUpdateExplanationMessage"},onlyWithAiUpgradeMessage:{defaultMessage:"Only with upgraded Notion AI",id:"database.CollectionSettingsPropertyAiAutofill.onlyWithAiUpgradeMessage"},updateOnPageEdits:{defaultMessage:"Auto-update on page edits",id:"database.viewSettings.propertyTab.aiAutofill.updateOnPageEdits"}});function Rc({collectionContextStore:e,environment:t,setAiInference:o,aiInference:i,autofillFeatureAvailability:r}){const l=(0,n.useRef)(yt().JW()),s=(0,I().X)("upgrade_system_ai"),a=(0,n.useRef)(null),c=(0,x().tz)(),d=!((0,Pn().e2)(r)||null!=i&&i.auto_update_on_edit),u=(0,n.useCallback)((()=>{if(!e.collectionStore())return;if(!i)return;if(d&&!s)return void wc().triggerAiAutofillUpsell({environment:t,from:"ai_autofill_on_page_edit",upsell:r.upsell});const n={...i,auto_update_on_edit:!i.auto_update_on_edit};o(n)}),[e,i,d,s,o,t,r.upsell]);return i?d&&s?(0,L.jsx)(Vc().c,{featureName:"collection_property_autofill",upsell:r.upsell,source:"ai_autofill_on_page_edit",showTooltip:!0,tooltipProps:{description:c.formatMessage(Ec.autoUpdateExplanationMessage),placement:"top"},children:({handleClick:e,isDisabled:t})=>(0,L.jsx)("div",{ref:a,children:(0,L.jsx)(so().A,{title:(0,L.jsx)(x().sA,{...Ec.updateOnPageEdits}),onClick:e,disabled:t,textWrapperStyle:{minWidth:"auto"},right:(0,L.jsx)(Fc().R,{display:"icon",showPlanName:!0,iconAlignment:"right",hoverRef:a,featureName:"collection_property_autofill",upsell:r.upsell,source:"ai_autofill_on_page_edit"})})})}):(0,L.jsx)(at().A,{renderTooltip:()=>(0,L.jsxs)("div",{style:{width:169},children:[(0,L.jsx)("div",{style:{color:"white",fontWeight:500,wordWrap:"break-word",whiteSpace:"pre-wrap"},children:(0,L.jsx)(x().sA,{...Ec.autoUpdateExplanationMessage})}),(0,Bc().Vi)(r,(()=>(0,L.jsx)("div",{style:{color:"#ACABA9",fontWeight:500},children:(0,L.jsx)(x().sA,{...Ec.onlyWithAiUpgradeMessage})})))]}),render:e=>(0,L.jsx)(Dc().A,{title:(0,L.jsx)(x().sA,{...Ec.updateOnPageEdits}),showChevron:!1,switcherProps:{inputId:l.current,on:Boolean(i.auto_update_on_edit),noColor:!1},onClick:u,disabled:!1,textWrapperStyle:{minWidth:"auto"},...e})}):null}var Oc=()=>o(805751),Kc=()=>o(255824);const Nc=(0,x().YK)({extractPromptSectionTitle:{defaultMessage:"What key info to extract?",id:"database.viewSettings.propertyTab.aiAutofill.extractPromptSectionTitle"},customPromptSectionTitle:{defaultMessage:"What to generate?",id:"database.viewSettings.propertyTab.aiAutofill.customPromptSectionTitle"},extractPromptInputPlaceholder:{defaultMessage:"e.g. “Key topics in bullets” or “People mentioned on the page”",id:"database.viewSettings.propertyTab.aiAutofill.extractPromptInputPlaceholder"},customPromptInputPlaceholder:{defaultMessage:"Tell AI what to generate from page content and properties…",id:"database.viewSettings.propertyTab.aiAutofill.customPromptInputPlaceholder"}});function Lc({environment:e,aiInference:t,setAiInference:o,collectionContextStore:i,isAutofillSetupEnabled:r,shouldShowUserPromptIsInvalidError:l,setShouldShowUserPromptIsInvalidError:a}){var c;const d=function(e){if(!e)return;switch(e.type){case"summarize":case"translate":return;case"extract":return{aiInferenceType:e.type,sectionTitle:Nc.extractPromptSectionTitle,inputPlaceholder:Nc.extractPromptInputPlaceholder,value:e.prompt};case"custom":case"select":case"multi_select":return{aiInferenceType:e.type,sectionTitle:Nc.customPromptSectionTitle,inputPlaceholder:Nc.customPromptInputPlaceholder,value:e.prompt};default:(0,b().HB)(e)}}(t),u=(0,s().K8)((()=>{var t;return(0,sa().hn)({environment:e,spaceId:null===(t=i.collectionStore())||void 0===t?void 0:t.getSpaceId(),userId:e.currentUser.id})}),[e,i]),p=(0,n.useCallback)((e=>{if(i.collectionStore()&&d)switch(e.target.value&&e.target.value.length<=fc().oV?a(!1):e.target.value.length>fc().oV&&a(!0),d.aiInferenceType){case"extract":case"custom":o({type:d.aiInferenceType,prompt:e.target.value,auto_update_on_edit:(null==t?void 0:t.auto_update_on_edit)??u});break;case"select":case"multi_select":o({type:d.aiInferenceType,prompt:e.target.value,auto_update_on_edit:(null==t?void 0:t.auto_update_on_edit)??u,add_options:((null==t?void 0:t.type)===d.aiInferenceType&&(null==t?void 0:t.add_options))??!1});break;case"summarize":case"translate":return;default:(0,b().HB)(d.aiInferenceType)}}),[t,i,u,d,o,a]),g=(0,Kc().a)(),m=(0,v().IS)((t=>({inputOuterStyle:{margin:e.device.isMobile?"8px 0":0,border:l?"1px solid red":void 0,backgroundColor:g?t.white:void 0}})),[e.device.isMobile,g,l]);return d?(0,L.jsxs)(A().A,{title:oo().A.formatMessage(d.sectionTitle),isInput:!0,style:{marginTop:-4},children:[(0,L.jsx)(Oc().A,{debugName:"CollectionSettingsAiAutofillPromptInput",capture:!0,allowEsc:!0,children:(0,L.jsx)(pt().Ay,{inputOuterStyle:m.inputOuterStyle,type:"text",value:d.value||"",onChange:p,placeholder:oo().A.formatMessage(d.inputPlaceholder),textarea:!0,disabled:!r,autosize:!0,autosizeMinHeight:100,autosizeMaxHeight:600},d.aiInferenceType)}),l?(0,L.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingInlineStart:12,fontSize:12},children:[(0,Ts().Q)({width:12,height:12,fill:"#D34F43"}),(0,L.jsx)("div",{style:{color:"#D34F43",paddingInlineStart:4},children:((null===(c=d.value)||void 0===c?void 0:c.length)??0)>fc().oV?(0,L.jsx)(x().sA,{defaultMessage:"Instruction is too long",id:"CollectionSettings.propertyTab.aiAutofill.promptInput.exceedsMaxLength"}):(0,L.jsx)(x().sA,{defaultMessage:"Required",id:"CollectionSettings.propertyTab.aiAutofill.promptInput.required"})})]}):void 0]}):null}function zc(e){const{collectionContextStore:t,isAutofillSetupEnabled:o,draftAiInference:n,setDraftAiInference:i,environment:r,shouldShowUserPromptIsInvalidError:l,setShouldShowUserPromptIsInvalidError:s,autofillFeatureAvailability:a}=e;return n?"select"!==n.type&&"multi_select"!==n.type?null:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)(A().A,{style:{marginBottom:10},children:[(0,L.jsx)(Rc,{collectionContextStore:t,environment:r,setAiInference:i,aiInference:n,autofillFeatureAvailability:a}),(0,L.jsx)(Pc().A,{setAiInference:i,aiInference:n})]}),n?(0,L.jsx)(A().A,{topBorder:!0,children:(0,L.jsx)(Lc,{environment:r,aiInference:n,setAiInference:i,collectionContextStore:t,isAutofillSetupEnabled:o,shouldShowUserPromptIsInvalidError:l,setShouldShowUserPromptIsInvalidError:s})}):void 0]}):null}var Uc=()=>o(794198),Wc=()=>o(474587),Hc=()=>o(158115),Gc=()=>o(831310),$c=()=>o(64e3),Qc=()=>o(495159);const Yc=new(J().A),qc=(0,x().YK)({optionsSectionTitle:{defaultMessage:"Options",id:"database.viewSettings.propertyTab.aiAutofill.optionsSectionTitle"},whatToTranslate:{defaultMessage:"What to translate?",id:"CollectionSettingsPropertyAiAutofill.translateProperty.propertySelector"},translateTo:{defaultMessage:"Translate to",id:"CollectionSettingsPropertyAiAutofill.translateProperty.languageSelector"},selectorSearchPlaceholder:{defaultMessage:"Search",id:"CollectionSettingsPropertyAiAutofill.selectorOption.searchbar.placeholder"},allProperties:{defaultMessage:"All properties",id:"CollectionSettingsPropertyAiAutofill.selectorOption.allProperties.checkbox"},noAiAutofillSelected:{defaultMessage:"Select an option",id:"database.CollectionSettingsPropertyAiAutofill.noAiAutofillSelected"}});function Jc(e){const{collectionContextStore:t,propertySchema:o,previousPromptByAiInferenceType:i,isAutofillSetupEnabled:r,draftAiInference:l,setDraftAiInference:a,environment:c,propertyId:d,collectionSchema:u,shouldShowUserPromptIsInvalidError:p,setShouldShowUserPromptIsInvalidError:g,autofillFeatureAvailability:m}=e,S=(0,v().DP)(),y=(0,n.useMemo)((()=>[new(J().A),new(J().A)]),[]),f=(0,n.useMemo)((()=>function({environment:e,aiInference:t,collectionSchema:o,setAiInference:n,property:i,theme:r,optionsButtonPopupStores:l}){var s;if(!t||!(0,oe().UH)(t.type))return[];switch(t.type){case"summarize":case"extract":case"custom":return[];case"translate":const e=Do().oE((0,b().uv)(o).map((e=>{if(e===i)return;const t=o[e];if(t&&(0,Wc().jm)(t)){var n;if("text"===t.type&&"translate"===(null===(n=t.ai_inference)||void 0===n?void 0:n.type))return;return{id:e,option:t.name,icon:(0,L.jsx)(Qe().zB,{icon:t.icon,type:t.type,theme:r,size:F().Ev.sm})}}}))),a=e.findIndex((e=>"title"===e.id));if(a&&a>0){const t=e[a];e.splice(a,1),e.unshift(t)}for(;l.length<2;)l.push(new(J().A));return[{type:"multi",options:e,selectedIds:(null===(s=t.targetProperties)||void 0===s?void 0:s.length)>0?t.targetProperties:["title"],setSelectedIds:e=>{n({...t,targetProperties:e})},selectorTitle:qc.whatToTranslate,selectAllTitle:qc.allProperties,buttonPopupStore:l[0]},{type:"single",options:Wc().nP.map((({key:e,name:t})=>({id:e,option:oo().A.formatMessage(t)}))),selectedId:t.toLanguage,onSelect:e=>{n({...t,toLanguage:e})},selectorTitle:qc.translateTo,buttonPopupStore:l[1]}];default:(0,b().HB)(t)}}({environment:c,aiInference:l,collectionSchema:u,setAiInference:a,property:d,theme:S,optionsButtonPopupStores:y})),[c,l,u,a,d,S,y]),h=(0,s().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getSpaceId()}),[t]);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)(A().A,{style:{marginBottom:10,display:"flex",gap:8},children:[(0,L.jsx)(Xc,{spaceId:h,propertySchema:o,previousPromptByAiInferenceType:i,draftAiInference:l,setDraftAiInference:a,environment:c}),(0,oe().bB)(l,"text")?(0,L.jsx)(Rc,{collectionContextStore:t,environment:c,setAiInference:a,aiInference:l,autofillFeatureAvailability:m}):void 0]}),(0,oe().bB)(l,"text")?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(A().A,{topBorder:!0,children:(0,L.jsx)(Lc,{environment:c,aiInference:l,setAiInference:a,collectionContextStore:t,isAutofillSetupEnabled:r,shouldShowUserPromptIsInvalidError:p,setShouldShowUserPromptIsInvalidError:g})}),(0,L.jsx)(ed,{environment:c,optionProps:f})]}):void 0]})}function Xc({spaceId:e,propertySchema:t,previousPromptByAiInferenceType:o,draftAiInference:i,setDraftAiInference:l,environment:a}){const c=(0,s().K8)((()=>(0,sa().hn)({environment:a,userId:a.currentUser.id,spaceId:e})),[a,e]),d=(0,n.useCallback)((e=>{var n,i,r,s,a,d,u,p;if(!t||!(0,oe().$M)(t)||!e)return;let g;switch(e){case"summarize":g={type:e,auto_update_on_edit:c};break;case"translate":g={type:e,auto_update_on_edit:c,targetProperties:(null===(n=t.ai_inference)||void 0===n?void 0:n.type)===e?null===(i=t.ai_inference)||void 0===i?void 0:i.targetProperties:["title"],toLanguage:(null===(r=t.ai_inference)||void 0===r?void 0:r.type)===e?null===(s=t.ai_inference)||void 0===s?void 0:s.toLanguage:"english"};break;case"extract":g={type:e,prompt:(null===(a=t.ai_inference)||void 0===a?void 0:a.type)===e?null===(d=t.ai_inference)||void 0===d?void 0:d.prompt:o[e]??"",auto_update_on_edit:c};break;case"custom":g={type:e,prompt:(null===(u=t.ai_inference)||void 0===u?void 0:u.type)===e?null===(p=t.ai_inference)||void 0===p?void 0:p.prompt:o[e]??"",auto_update_on_edit:c};break;default:(0,b().HB)(e)}l(g)}),[c,o,t,l]),u=(0,v().DP)(),{isMobile:p}=(0,r().Y0)(),g=(0,v().IS)((e=>({checkedIcon:{fill:e.icon.primary,height:p?16:12,width:p?16:12},buttonOutlineStyle:{borderTop:`1px solid ${e.outlineButtonBorder}`,borderRadius:4,paddingTop:12,paddingBottom:12}})),[p]);return t&&(0,oe().$M)(t)?(0,L.jsx)(so().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"Fill with",id:"CollectionSettingsPropertyAiAutofill.ClosedSelector.Title"}),right:(0,L.jsx)(R().A,{originGap:8,popupType:a.device.isMobile?R().z.BottomSheet:R().z.Popup,buttonPopupStore:Yc,render:e=>{const t={key:"section",render:e=>(0,L.jsx)(A().A,{...e}),items:Do().oE(Object.keys(Qc().vr.text).map(((t,o,n)=>{if((0,oe().UH)(t))return{key:t,render:e=>{const r=Qc().vr.text[t];return(0,L.jsx)(so().A,{focused:!1,buttonStyle:p?{...g.buttonOutlineStyle,borderBottom:o===n.length-1?`1px solid ${u.outlineButtonBorder}`:void 0}:void 0,onClick:e.onClick,title:(0,L.jsxs)("div",{style:{display:"flex",alignItems:"center",fontSize:p?18:void 0},children:[r.svg({height:p?20:16,width:p?24:16,fill:u.aiPurpleColor,marginInlineEnd:6}),oo().A.formatMessage(r.name)]}),right:(null==i?void 0:i.type)===t&&(0,Gc().o)(g.checkedIcon)})},action:()=>{e.close(),d(t)}}})))};return(0,L.jsx)(O().A,{menuType:K().gu.Popup,minWidth:260,maxWidth:"100vw",children:(0,L.jsx)(ce().Ay,{style:{marginTop:p?8:void 0},type:ce().Oh.Vertical,initialFocus:0,sections:[t]})})},renderOrigin:e=>(0,L.jsx)("div",{...e,style:{userSelect:"none"},children:(0,L.jsx)(Zc,{aiActionType:null==i?void 0:i.type})})})}):null}function Zc({aiActionType:e}){const t=e&&(0,oe().UH)(e)?Qc().vr.text[e]:{name:qc.noAiAutofillSelected,svg:()=>null},{isMobile:o}=(0,r().Y0)(),n=(0,v().IS)((e=>({wrapper:{display:"flex",alignItems:"center",cursor:"pointer",fontSize:o?18:14,paddingInlineStart:15,paddingBottom:0},selectedOptionWrapper:{color:e.icon.tertiary},selectedOptionSvg:{height:16,width:16,marginInlineEnd:2},selectedOptionText:{color:e.text.tertiary,paddingInlineStart:4},selectedOptionChevron:{color:e.icon.tertiary,paddingInlineStart:4}})),[o]);return(0,L.jsxs)("div",{style:n.wrapper,children:[(0,L.jsx)("div",{style:n.selectedOptionWrapper,children:t.svg(n.selectedOptionSvg)}),(0,L.jsx)("div",{style:n.selectedOptionText,children:(0,L.jsx)(x().sA,{...t.name})}),(0,L.jsx)("div",{style:n.selectedOptionChevron,children:(0,L.jsx)(Uc().I,{icon:Hc().arrowChevronSingleRightFillSmallIcon,size:"xs"})})]})}function ed({environment:e,optionProps:t}){return t&&t.length>0?(0,L.jsx)(A().A,{title:oo().A.formatMessage(qc.optionsSectionTitle),isInput:!0,style:{marginTop:-4},children:t.map(((t,o)=>"multi"===t.type?(0,L.jsx)(td,{environment:e,options:t.options,selectedIds:t.selectedIds,setSelectedIds:t.setSelectedIds,selectorTitle:t.selectorTitle,selectAllTitle:t.selectAllTitle,buttonPopupStore:t.buttonPopupStore},o):(0,L.jsx)(od,{environment:e,options:t.options,selectedId:t.selectedId,onSelect:t.onSelect,selectorTitle:t.selectorTitle,buttonPopupStore:t.buttonPopupStore},o)))}):null}function td({environment:e,options:t,selectedIds:o,setSelectedIds:i,selectorTitle:r,selectAllTitle:l,buttonPopupStore:a}){const[c,d]=(0,n.useState)(""),u=(0,v().DP)(),p=t.filter((e=>o.includes(e.id))),g=(0,s().K8)((()=>Do().sb(Do().Ul(t.map((e=>e.id)))).join(",")===Do().sb(Do().Ul(o)).join(",")),[t,o]),m=e=>{o.includes(e)?i(o.filter((t=>t!==e))):i(Do().sb([...o,e]))},S=()=>{o.length<t.length?i(t.map((e=>e.id))):i(["title"])},y=(0,L.jsx)(A().A,{desktopStyle:{paddingTop:12,paddingBottom:4},children:(0,L.jsx)(pt().Ay,{focusInitial:!e.device.isMobile||void 0,focus:!e.device.isMobile||void 0,value:c,onChange:e=>{d(e.target.value)},placeholder:oo().A.formatMessage(qc.selectorSearchPlaceholder)})});return(0,L.jsx)(R().A,{popupType:e.device.isMobile?R().z.SlideUp:R().z.Popup,buttonPopupStore:a,render:e=>{const n=t.filter((e=>{var t;const o=null===(t=e.option)||void 0===t?void 0:t.toLowerCase();return-1!==(null==o?void 0:o.indexOf(c.toLowerCase()))})).map((({id:e,option:t,icon:n})=>({key:e,render:i=>(0,L.jsx)(Q().A,{focused:!1,onClick:i.onClick,left:(0,L.jsx)($e().S,{checked:o.includes(e),size:14,onClick:t=>{m(e)}}),icon:n,title:t}),action:()=>{m(e)}}))),i={key:"section",render:e=>(0,L.jsx)(A().A,{...e,topBorder:!0}),items:n},r={key:"all-items",render:e=>(0,L.jsx)(A().A,{...e}),items:[{key:"all-items",render:e=>(0,L.jsx)(Q().A,{focused:!1,onClick:()=>{S()},left:(0,L.jsx)($e().S,{checked:g,size:14,onClick:()=>{S()}}),title:oo().A.formatMessage(l)}),action:()=>{S()}}]};return(0,L.jsxs)(O().A,{menuType:K().gu.Popup,minWidth:260,maxWidth:"100vw",children:[y,0===n.length?(0,L.jsx)(A().A,{children:(0,L.jsx)($c().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"No results",id:"CollectionSettingsPropertyAiAutofill.searchBar.noResults.label"})})}):(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,initialFocus:void 0,sections:[r,i]})]})},renderOrigin:e=>(0,L.jsx)(so().A,{title:oo().A.formatMessage(r),showChevron:!0,right:(0,L.jsx)("div",{style:{color:u.text.tertiary,paddingInlineStart:4,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"90%"},children:Do().oE(p.map((({id:e,option:t,icon:o})=>t))).join(", ")}),rightStyle:{flexShrink:1},rotateChevron:a.state.open,disabled:!1,textWrapperStyle:{minWidth:"auto"},...e})})}function od({environment:e,options:t,selectedId:o,onSelect:i,selectorTitle:r,buttonPopupStore:l}){const[s,a]=(0,n.useState)(""),c=t.find((e=>e.id===o)),d=(0,v().DP)(),u=(0,L.jsx)(A().A,{desktopStyle:{paddingTop:12,paddingBottom:4},children:(0,L.jsx)(pt().Ay,{focusInitial:!e.device.isMobile||void 0,focus:!e.device.isMobile||void 0,value:s,onChange:e=>{a(e.target.value)},placeholder:oo().A.formatMessage(qc.selectorSearchPlaceholder)})});return(0,L.jsx)(R().A,{popupType:e.device.isMobile?R().z.SlideUp:R().z.Popup,buttonPopupStore:l,render:e=>{const n=t.filter((e=>{var t;return-1!==(null===(t=e.option)||void 0===t?void 0:t.toLowerCase().indexOf(s.toLowerCase()))})).map((({id:t,option:n,icon:r})=>({key:t,render:e=>(0,L.jsx)(Q().A,{focused:!1,onClick:e.onClick,icon:r,title:n,isChecked:t===o}),action:()=>{e.close(),i(t)}}))),r={key:"section",render:e=>(0,L.jsx)(A().A,{...e}),items:n};return(0,L.jsxs)(O().A,{menuType:K().gu.Popup,minWidth:260,maxWidth:"100vw",children:[u,0===n.length?(0,L.jsx)(A().A,{children:(0,L.jsx)($c().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"No results",id:"CollectionSettingsPropertyAiAutofill.searchBar.noResults.label"})})}):(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,initialFocus:void 0,sections:[r]})]})},renderOrigin:e=>(0,L.jsx)(so().A,{title:oo().A.formatMessage(r),showChevron:!0,right:c&&(0,L.jsxs)(L.Fragment,{children:[c.icon,(0,L.jsx)("div",{style:{color:d.text.tertiary,paddingInlineStart:4,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"90%"},children:c.option})]}),rightStyle:{flexShrink:1},rotateChevron:l.state.open,disabled:!1,textWrapperStyle:{minWidth:"auto"},...e})})}const nd=(0,x().YK)({removeAutofillButton:{defaultMessage:"Turn off AI autofill",id:"database.viewSettings.propertyTab.aiAutofill.removeAutofillButton"},toggleFillWithAiSectionLabel:{defaultMessage:"Actions",id:"database.viewSettings.propertyTab.aiAutofill.actionsSectionLabel"}});function id(e){const{property:t,collectionContextStore:o,collectionSettingsStore:i}=e,l=(0,s().K8)((()=>o.normalizedSchemaStore.state[t]),[t,o.normalizedSchemaStore]),a=(0,s().K8)((()=>o.collectionStore()),[o]),d=(0,s().K8)((()=>o.normalizedSchemaStore.getState()),[o]),u=l&&(0,oe().$M)(l)?(0,oe().om)(l):void 0,p=(0,r().v3)(),g=(0,x().tz)(),m=ld(),y=(0,s().K8)((()=>{const e=o.collectionStore();return e&&(0,Ic().jq)(Tc().A.getMode(p,e),e)}),[p,o]),f=St().Store.createValue({stage:"not_started"},{name:"tryAutofillStore"});(0,n.useEffect)((()=>{var e,n;if("page"===o.getViewType())return;if(!1!==(null===(e=o.getPropertyFormat(t))||void 0===e?void 0:e.visible))return;const i=new(na().A)({name:"CollectionSettingsPropertyAiAutofill"});p.defaultRecordCache.inMemoryRecordCache.addCacheOverride(i);const r=null===(n=o.formatStore())||void 0===n?void 0:n.clone(i),l=o.getPropertyFormatKey();return r&&l&&S().createAndCommit({userAction:"CollectionSettingsPropertyAiAutofill.open",environment:p,canUndo:!0,perform:e=>{(0,cr().a)({formatStore:r,formatKey:l,property:t,update:{visible:!0},transaction:e})}}),()=>{p.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(i)}}),[o,p,t]);const h=(0,n.useRef)({}),v=(0,s().K8)((()=>{var e;return(0,sa().hn)({environment:p,spaceId:null===(e=o.collectionStore())||void 0===e?void 0:e.getSpaceId(),userId:p.currentUser.id})}),[p,o]),[w,j]=(0,n.useState)(l&&wc().getDefaultAiInference(l,v)),[_,I]=(0,n.useState)(!1),k=(0,n.useCallback)((()=>{const e=o.collectionStore();if(!e||!l||!(0,oe().$M)(l))return;const n=(0,oe().om)(l);n&&"prompt"in n&&(h.current={...h.current,[n.type]:n.prompt}),wc().saveOrRemovePropertyAiInference({environment:p,propertySchema:l,collectionStore:e,property:t,draftAiInference:w})}),[o,l,w,t,p]),T=(0,s().K8)((()=>{const e=o.collectionStore();return e?(0,kc().tS)({environment:p,intl:g,store:e}):(0,hc().L)(g)}),[o,p,g]),P=(0,s().K8)((()=>"page"===o.getViewType()),[o]),B=(0,n.useCallback)((async()=>{if(l&&(0,oe().$M)(l)&&Do().n4(w,(0,oe().om)(l)))D().os({collectionSettingsStore:i});else if(w){var e;if("prompt"in w)if((0,oe().qD)(w)&&0===(null===(e=w.prompt)||void 0===e?void 0:e.length)||(0,b().O9)(w.prompt)&&w.prompt.length>fc().oV)return void I(!0);(null==u||!u.auto_update_on_edit)&&null!=w&&w.auto_update_on_edit&&v&&l?await xc().U({sourceAction:"auto_update",propertyName:l.name,collectionName:T})&&k():k()}}),[T,i,u,w,k,v,l]),F=(0,n.useCallback)((()=>{const e=o.collectionStore();e&&u&&l&&(wc().saveOrRemovePropertyAiInference({environment:p,propertySchema:l,collectionStore:e,property:t,draftAiInference:null}),D().yl({collectionSettingsStore:i}))}),[o,u,p,l,t,i]),V=l&&(0,oe().$M)(l)&&Do().n4(w,(0,oe().om)(l)),E=(0,n.useCallback)((async()=>new Promise((e=>{Ro().ui({showCancel:!1,keepFocus:!1,message:(0,L.jsxs)(yc().VP,{alignItems:"center",gap:8,children:[(0,vc().x)(m.confirmDiscardChangesDialogIconStyle),(0,L.jsx)("div",{style:m.confirmDiscardChangesDialogMessageStyle,children:(0,L.jsx)(x().sA,{defaultMessage:"Do you want to discard changes for AI autofill?",id:"database.viewSettings.propertyTab.aiAutofill.confirmDiscordChangesDialog.message"})})]}),items:[{label:(0,L.jsx)(x().sA,{defaultMessage:"Discard",id:"database.viewSettings.propertyTab.aiAutofill.confirmDiscordChangesDialog.acceptLabel"}),color:"red",onAccept:()=>e(!0)},{label:(0,L.jsx)(x().sA,{defaultMessage:"Continue editing",id:"database.viewSettings.propertyTab.aiAutofill.confirmDiscordChangesDialog.cancelLabel"}),onAccept:()=>e(!1)}]})}))),[m]),R=(0,n.useCallback)((async()=>{(V||await E())&&D().yl({collectionSettingsStore:i})}),[V,i,E]),O=(0,n.useCallback)((async()=>{(V||await E())&&D().os({collectionSettingsStore:i})}),[V,i,E]),{spaceId:K,userId:N}=(0,s().K8)((()=>{var e;return{spaceId:null==a?void 0:a.getSpaceId(),userId:null===(e=He().default.state.currentUserStore)||void 0===e?void 0:e.id}}),[a]),z=(0,Pn()._X)({name:"collection_property_autofill",spaceId:K,userId:N,amount:"unknown"}),U=(0,n.useCallback)((async()=>{if(V)return!1;return!(await E())}),[V,E]);return function(e,t){(0,n.useEffect)((()=>{const o=`abort-dismiss-settings-callback-${(0,yt().JW)()}`;return e.abortDismissSettingsCallbackStore.setState([o,t]),()=>{const t=e.abortDismissSettingsCallbackStore.state;t&&t[0]===o&&e.abortDismissSettingsCallbackStore.setState(void 0)}}),[e,t])}(o,U),l&&(0,oe().$M)(l)&&a?(0,L.jsx)(c().N,{debugName:"CollectionSettingsPropertyAiAutofill",capture:!0,onEsc:O,children:(0,L.jsxs)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Fill “{propertyName}” with AI",id:"database.viewSettings.propertyTab.aiAutofill.title",values:{propertyName:l.name}}),handleBackArrowClick:R,handleClose:O,children:[y?void 0:(0,L.jsx)(A().A,{style:m.menuItemStyle,children:(0,L.jsx)(x().sA,{defaultMessage:"You don’t have permission to set up AI autofill on this database.",id:"database.viewSettings.propertyTab.aiAutofill.noSetupPermission"})}),z&&"text"===l.type?(0,L.jsx)(Jc,{collectionContextStore:o,propertySchema:l,previousPromptByAiInferenceType:h.current,isAutofillSetupEnabled:Boolean(y),draftAiInference:w,setDraftAiInference:j,environment:p,propertyId:t,collectionSchema:d,shouldShowUserPromptIsInvalidError:_,setShouldShowUserPromptIsInvalidError:I,autofillFeatureAvailability:z}):void 0,z&&(0,oe().lx)(l)?(0,L.jsx)(zc,{collectionContextStore:o,isAutofillSetupEnabled:Boolean(y),draftAiInference:w,setDraftAiInference:j,environment:p,shouldShowUserPromptIsInvalidError:_,setShouldShowUserPromptIsInvalidError:I,autofillFeatureAvailability:z}):void 0,(0,oe().bB)(w,l.type)?(0,L.jsxs)(A().A,{children:[(0,L.jsx)(rd,{environment:p,isAutofillSetupEnabled:y,collectionContextStore:o,tryAutofillStore:f,propertySchema:l,property:t,aiInference:w}),(0,L.jsx)(M().A,{colorPalette:"blue",style:{...m.buttonStyle,marginTop:8,marginInlineEnd:12,marginBottom:12,marginInlineStart:12,display:V?"none":"flex"},onClick:B,disabled:!y,children:V?(0,L.jsx)(x().sA,{defaultMessage:"Done",id:"database.viewSettings.propertyTab.aiAutofill.saveButtonAllSaved"}):(0,L.jsx)(x().sA,{defaultMessage:"Save changes",id:"database.viewSettings.propertyTab.aiAutofill.saveButtonWithChanges"})})]}):void 0,(0,L.jsxs)(A().A,{topBorder:!0,title:p.device.isMobile&&oo().A.formatMessage(nd.toggleFillWithAiSectionLabel),children:[z&&(0,oe().bB)(u,l.type)?(0,L.jsxs)(L.Fragment,{children:[P?void 0:(0,L.jsx)(jc().Ve,{environment:p,collectionContextStore:o,collectionStore:a,property:t,propertySchema:l,autofillFeatureAvailability:z,isAutofillSetupEnabled:Boolean(y)}),(0,L.jsx)(so().A,{icon:G().trashIcon,isRed:!0,focused:!1,title:oo().A.formatMessage(nd.removeAutofillButton),onClick:F,disabled:!y})]}):void 0,(0,L.jsx)(Al().A,{href:(0,No().x)("guides.aiAutofill"),title:(0,L.jsx)(x().sA,{defaultMessage:"Learn about AI autofill",id:"database.viewSettings.propertyTab.aiAutofill.learnMoreLink"}),analyticsFrom:"collection_ai_autofill_menu"})]})]})}):null}function rd({environment:e,isAutofillSetupEnabled:t,collectionContextStore:o,tryAutofillStore:i,propertySchema:r,property:l,aiInference:a}){const[c,d]=(0,n.useState)(yt().JW()),u=(0,n.useRef)(yt().JW()),p=(0,s().K8)((()=>i.state.stage),[i]),g=(0,s().K8)((()=>{const e=o.contextType;if("collectionPage"===e)return{type:"page",candidateBlockStores:Do().oE([(0,_c().a)()])};if("collectionTypedView"===e||"collectionView"===e)return{type:"collection",candidateBlockStores:o.resultsInViewOrder(5)};throw new Error(`Unexpected context type: ${e}`)}),[o]),m=(0,n.useCallback)((()=>{var t;Cc().trackAiAutofillAction(e,{ai_inference_type:a.type,type:"undo_from_collection_settings",inference_id:c,collection_id:null===(t=o.collectionStore())||void 0===t?void 0:t.id,session_id:u.current}),"not_started"!==p&&(bc().tN({environment:e}),i.setState({stage:"not_started"}))}),[e,a,c,o,p,i]),S=!(0,s().O$)(Ds().e),{spaceId:y,userId:f}=(0,s().K8)((()=>{var e;return{spaceId:null===(e=o.collectionStore())||void 0===e?void 0:e.getSpaceId(),userId:o.getCurrentUserId()}}),[o]),h=(0,Pn()._X)({name:"collection_property_autofill",spaceId:y,userId:f,amount:5}),v=(0,b().EI)(g.candidateBlockStores),C=ld({isTryAutofillEnabled:t&&v}),w=Boolean((0,n.useContext)(Mc().sf));if(e.device.isMobile||w)return null;let j;return j=(0,Pn().e2)(h)?v?"collection"===g.type?(0,L.jsx)(x().sA,{defaultMessage:"Updates the first {maxPages} pages. You can undo changes anytime.",id:"database.viewSettings.propertyTab.aiAutofill.tryOnCollectionDescription",values:{maxPages:5}}):(0,L.jsx)(x().sA,{defaultMessage:"Updates “{propertyName}” on this page. You can undo changes anytime.",id:"database.viewSettings.propertyTab.aiAutofill.tryOnPageDescription",values:{propertyName:r.name}}):(0,L.jsx)(x().sA,{defaultMessage:"Add more pages or remove filters to try AI on this view.",id:"database.viewSettings.propertyTab.tryAutofillDisabledDescription"}):(0,L.jsx)(x().sA,{defaultMessage:"Upgrade Notion AI to try AI on this view",id:"database.viewSettings.propertyTab.aiAutofill.tryAutofillDisableAIUpsellDescription"}),(0,L.jsx)("div",{style:{margin:"8px 12px"},children:(0,L.jsxs)(yc().fI,{gap:8,children:[(0,L.jsx)(he().p,{disabled:!t||!v,style:{...C.buttonStyle,...C.undoButtonStyle,..."not_started"===p&&{display:"none"}},onClick:m,children:(0,L.jsx)(x().sA,{defaultMessage:"Undo",id:"database.viewSettings.propertyTab.aiAutofill.undoButton"})}),(0,L.jsx)(at().A,{renderTooltip:()=>S?(0,L.jsx)("div",{children:(0,L.jsx)(x().sA,{...Fa().AY.aiUnavailableOfflineTooltip})}):(0,L.jsx)("div",{children:j}),render:n=>(0,L.jsx)(he().p,{...n,disabled:!t||!v||S||!(0,Pn().e2)(h),style:{...C.buttonStyle,...C.tryButtonStyle},hoveredStyle:C.tryButtonHoveredStyle,pressedStyle:C.tryButtonPressedStyle,onClick:async()=>{if(!h||(0,Pn().e2)(h)){if((0,b().EI)(g.candidateBlockStores)){const t=yt().JW();d(t),i.setState({stage:"in_progress"}),await wc().autofillPropertyForBlocks({environment:e,stores:g.candidateBlockStores,property:l,propertySchema:r,aiInferenceOverride:a,userEventForAnalytics:"generate_from_try_on_view_button",sessionIdForAnalytics:u.current,collectionContextStore:o,from:"ai_autofill_settings"}),i.setState({stage:"complete"})}}else wc().triggerAiAutofillUpsell({environment:e,from:"ai_autofill_try_on_view",upsell:h.upsell})},children:"in_progress"===p?(0,L.jsx)(Ac().A,{}):(0,L.jsxs)(L.Fragment,{children:[(0,vc().x)({width:16,..."not_started"!==p&&{display:"none"}}),"not_started"!==p?(0,L.jsx)(x().sA,{defaultMessage:"Try again",id:"database.viewSettings.propertyTab.aiAutofill.tryAgain"}):"collection"===g.type?(0,L.jsx)(x().sA,{defaultMessage:"Try on this view",id:"database.viewSettings.propertyTab.aiAutofill.tryOnCollection"}):(0,L.jsx)(x().sA,{defaultMessage:"Try on this page",id:"database.viewSettings.propertyTab.aiAutofill.tryOnPage"})]})})})]})})}function ld(e){return(0,v().IS)((t=>({buttonStyle:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",gap:8},menuItemStyle:{fontSize:13,borderRadius:6,background:t.palette.purple[50],color:t.palette.purple[500],margin:"8px 12px",padding:"8px 12px"},undoButtonStyle:{border:`1px solid ${t.palette.gray[100]}`,flex:1},tryButtonStyle:{fontWeight:500,flex:1,background:null!=e&&e.isTryAutofillEnabled?"light"===t.mode?t.palette.purple[50]:t.palette.purple[200]:t.palette.gray[75],color:null!=e&&e.isTryAutofillEnabled?t.aiPurpleColor:t.palette.gray[400]},fillAllPagesWandIconStyle:{fill:t.aiPurpleColor},tryButtonHoveredStyle:{background:t.palette.purple[100]},tryButtonPressedStyle:{background:t.palette.purple[200]},confirmDiscardChangesDialogIconStyle:{width:32,height:32,fill:t.aiPurpleColor,paddingTop:8},confirmDiscardChangesDialogMessageStyle:{textAlign:"center",fontWeight:500}})),[null==e?void 0:e.isTryAutofillEnabled])}var sd=()=>o(806080),ad=()=>o(413955),cd=()=>o(921855),dd=()=>o(938946),ud=()=>o(208698),pd=()=>o(858901);function gd(e){const{collectionContextStore:t,collectionSettingsStore:o,onAccept:i,propertySchema:l,disableSuggestions:a,propertyGroupId:d}=e,{isDesktop:u}=(0,r().Y0)(),p=(0,x().tz)(),g=(0,v().DP)(),[m,S]=(0,n.useState)(""),[y,f]=(0,n.useState)(null==l?void 0:l.icon),[w,j]=(0,n.useState)(!1),_=(0,n.useCallback)((e=>{const{propertyType:t,isSuggestedProperty:o,propertyName:n}=e;i({propertyType:t,isSuggestedProperty:o,propertyName:m.length>0?m:n,propertyIcon:y})}),[i,m,y]),{suggestedAndSearchSections:k,propertyTypeSections:M,setShowSearchInput:T,setSearchInput:P,searchInput:B}=function(e){const{collectionContextStore:t,propertySchema:o,onAccept:i,userInput:l,disableSuggestions:a,propertyGroupId:c}=e,d=(0,r().v3)(),u=(0,x().tz)(),[p,g]=(0,n.useState)(""),[m,S]=(0,n.useState)(!1),y=(0,n.useCallback)((e=>{g(e.target.value)}),[g]),f=(0,n.useCallback)((()=>{S((e=>!e))}),[S]),h=(0,s().K8)((()=>{var e;if(!t)return;const o=null===(e=t.collectionStore())||void 0===e||null===(e=e.getFormat())||void 0===e?void 0:e.app_config_uri;return o?(0,Si().l)((0,ad().appConfigs)(),o):void 0}),[t]),{hasAiEnabled:C,showAiSuggestions:w}=(0,dd().xv)({environment:d,collectionContextStore:t,appConfig:h}),j=(0,dd().Re)({environment:d,propertySchema:o,onAccept:i,collectionContextStore:t,section:"all"}),A=(0,dd().p1)({}),_=(0,n.useMemo)((()=>({...j,...A})),[j,A]),I=(0,dd().D1)({collectionContextStore:t,propertySchema:o,propertyGroupId:c,propertyName:l}),[k,M]=(0,dd().b9)({collectionContextStore:t}),T=p.length>0,P=(0,n.useCallback)((e=>e.splice(0,dd().il)),[]),B=(0,n.useCallback)((e=>{let t;return t=T?e:P(e),Cl().filter(p,t).filter((e=>!(T&&(_.hasOwnProperty(e.original)||null!=I&&I.hasOwnProperty(e.original)||null!=M&&M.hasOwnProperty(e.original))))).map((e=>e.original.toString()))}),[T,p,_,I,M,P]),F=(0,dd().ds)({hasAiEnabled:C,showAiSuggestions:w,collectionContextStore:t,propertySchema:o,onAccept:i,disableSuggestions:a,getFilteredSuggestedItemKeys:B}),V=(0,n.useMemo)((()=>{if("loading"===F)return[];const e=Object.values(F);return e.length>4?e.slice(0,4):e}),[F]),D=(0,n.useMemo)((()=>{const e=e=>void 0!==_[e.original]?[_[e.original]]:Object.values(_).find((t=>t.searchKeys.includes(e.original)))??[],t=Object.values(_).flatMap((e=>e.searchKeys));return(0,sd().sb)(Cl().filter(p,t).flatMap(e))}),[p,_]),E=(0,n.useMemo)((()=>I?Cl().filter(p,(0,b().uv)(I)).flatMap((e=>I[e.original])):[]),[I,p]),R=(0,n.useMemo)((()=>{if(!k)return{};const e={};return(0,b().uv)(k).forEach((t=>{const o=Cl().filter(p,(0,b().uv)(k[t])).flatMap((e=>k[t][e.original]));o.length>0&&(e[t]=o)})),e}),[k,p]),O=(0,v().IS)((e=>({titleContainer:{display:"flex",alignItems:"center"},desktopTitleStyle:{marginBottom:0,paddingBottom:0,marginTop:2},searchInputSectionStyle:{paddingBottom:0,marginBottom:4},standardSectionStyle:{paddingTop:0}})),[]),K=(0,L.jsx)("span",{style:O.titleContainer,children:(0,L.jsx)("span",{children:u.formatMessage(dd().DZ.suggestedSectionTitle)})}),N=(0,dd().D9)({filteredSuggestedPropertyItems:V,hasSearchInput:T,showAiSuggestions:w,disableSuggestions:Boolean(a||o),isLoading:"loading"===F,title:K,from:"collectionSettings"}),z=(0,dd().bi)({searchProperties:{searchInput:p,showSearchInput:m,handleSearchInputChange:y,handleToggleSearchInput:f},titleText:u.formatMessage(dd().DZ.typesSectionTitle),desktopTitleStyle:O.desktopTitleStyle,desktopStyle:O.searchInputSectionStyle,topBorder:N.items.length>0}),U=(0,dd().Dm)({filteredStandardPropertyItems:D,key:"standard",desktopStyle:O.standardSectionStyle}),W=(0,dd().bj)({filteredConnectedPropertyItems:E}),H=(0,dd().f1)({filteredConnectedPropertyItemsPerIntegration:R}),G=(0,n.useMemo)((()=>[N,z]),[N,z]),$=(0,n.useMemo)((()=>[U,...H,W]),[U,H,W]);return{suggestedAndSearchSections:G,propertyTypeSections:$,setShowSearchInput:S,setSearchInput:g,searchInput:p}}({collectionContextStore:t,collectionSettingsStore:o,propertySchema:l,onAccept:_,disableSuggestions:a,userInput:m,propertyGroupId:d}),V=(0,n.useMemo)((()=>[...k,...M]),[k,M]),D=(0,s().K8)((()=>{const e=null==t?void 0:t.collectionStore();if(e)return(0,cd().r4)(e.getName(),e)}),[t]),E=(0,s().K8)((()=>t.permissionScopesStore.state.isExternallyImportedAndSyncedCollection),[t.permissionScopesStore]),R=(0,Kc().a)(),O=(0,n.useCallback)((e=>{S(e.target.value)}),[S]),K=(0,n.useCallback)((()=>{_({propertyType:"text",isSuggestedProperty:!1,propertyName:m})}),[_,m]),N=(0,n.useCallback)((()=>{j(!0)}),[]),z=(0,n.useCallback)((()=>{j(!1)}),[]),U=(0,n.useCallback)((e=>{e.key&&1===e.key.length&&/[a-zA-Z]/.test(e.key)&&(e.preventDefault(),P(e.key.toLowerCase()),T(!0))}),[P,T]),W=(0,n.useMemo)((()=>(0,pd().rs)(M)),[M]),H=(0,pd().zx)(W),G=(0,n.useMemo)((()=>k.reduce(((e,t)=>e+t.items.length),0)),[k]),$=(0,n.useMemo)((()=>{if(B.trim())return G;if(!m.trim())return;const e=H(m);return void 0!==e?e+G:void 0}),[H,m,B,G]),Q=(0,n.useMemo)((()=>({enforceIconColor:"gray",backgroundColor:R?g.white:void 0,iconStyle:{fill:To().l8[g.mode].gray},icon:e=>(0,L.jsx)(Qe().zB,{type:"text",icon:y,size:F().Ev.sm,theme:g,style:e}),onSubmit:e=>{f(e)}})),[y,g,R]),Y=(0,ud().$)({iconButton:Q,onDelete:()=>{f(void 0)}}),q=(0,v().IS)((e=>({inputOuterStyle:R?{backgroundColor:e.white}:{},inputContainer:{padding:"0px 8px"}})),[R]),J=(0,I().X)("jira_notion_only_properties");return E&&!J?null:(0,L.jsxs)(C().Ay,{...e,title:l?p.formatMessage(dd().DZ.changePropertyType):u&&D?p.formatMessage(dd().DZ.newPropertyWithDatabaseName,{databaseName:D}):p.formatMessage(dd().DZ.newProperty),children:[l?null:(0,L.jsx)(A().A,{isInput:!0,children:(0,L.jsx)(pt().Ay,{focusInitial:!h().A.isMobile||void 0,focus:!h().A.isMobile||void 0,autoFocus:!h().A.isMobile||void 0,value:m,onChange:O,onFocus:N,onBlur:z,inputOuterStyle:q.inputOuterStyle,style:q.inputContainer,placeholder:p.formatMessage(dd().DZ.propertyNameInputPlaceholder),left:(0,L.jsx)(pt().KF,{icon:Q.icon,iconStyle:Q.iconStyle,onClick:Y})})}),(0,L.jsx)(c().N,{debugName:"CollectionSettingsPropertyTypeTypeAhead",capture:!w,onKeypress:U,children:(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,sections:V,disableInitialScroll:!0,initialFocus:$,resetInitialFocusOnSectionChange:!1,onEmptyEnter:K})})]})}function md(e){const{collectionContextStore:t,collectionSettingsStore:o,property:i,initialPropertyName:l,formatKey:a,propertyGroupId:c,newPropertyFormat:d}=e,u=(0,r().v3)(),p=(0,n.useMemo)((()=>St().Store.createValue("")),[]),g=(0,s().K8)((()=>t.collectionViewBlockStore()),[t]),m=(0,s().K8)((()=>{var e;const t=(0,yl().S)(o);if("setupRelation"===(null==t?void 0:t.type))return null===(e=t.targetCollectionPointer)||void 0===e?void 0:e.id}),[o]),S=(0,n.useMemo)((()=>({type:"relation",currentValue:m})),[m]),y=(0,n.useCallback)((e=>{if(!t.collectionStore())return;(0,ar().X)({environment:u,collectionContextStore:t,action:"select_relation_source"});const{stack:n}=o.state,r=n.length<2?void 0:n[n.length-2];r&&"setupRelation"===r.type&&D().yl({collectionSettingsStore:o}),D().dP({collectionSettingsStore:o,item:{type:"setupRelation",property:i,initialPropertyName:l,formatKey:a,propertyGroupId:c,targetCollectionPointer:e.pointer,newPropertyFormat:d}})}),[t,u,o,i,l,a,c,d]),f=(0,n.useCallback)((()=>{D().os({collectionSettingsStore:o})}),[o]);return g?(0,L.jsx)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Related to",id:"database.viewSettings.selectNewRelationSourceTab.title"}),handleClose:f,children:(0,L.jsx)(ws,{collectionContextStore:t,onAccept:y,parentStore:g,context:bo().U9.Relation,inputStore:p,suggestionConfig:S})}):null}function Sd(e){const{collectionContextStore:t,collectionSettingsStore:o,module:i,onClose:r}=e,l=(0,n.useMemo)((()=>St().Store.createValue("")),[]),{collectionStore:a}=(0,Mc().bi)(),c=(0,s().K8)((()=>t.collectionViewBlockStore()),[t]),d=(0,n.useCallback)((e=>{D().dP({collectionSettingsStore:o,item:{type:"setupViewsModule",targetCollectionPointer:e.pointer,module:i,onClose:r}})}),[o,i,r]),u=(0,s().K8)((()=>{var e;return{type:"viewModuleTab",currentValue:null===(e=t.collectionStore())||void 0===e?void 0:e.id,collectionParentCollectionViewBlockStore:null==a?void 0:a.getParentCollectionViewBlockStore()}}),[t,a]);return c?(0,L.jsx)(C().Ay,{...e,handleClose:()=>D().os({collectionSettingsStore:o}),children:(0,L.jsx)(ws,{collectionContextStore:t,onAccept:d,parentStore:c,context:bo().U9.Relation,inputStore:l,collectionStore:a,suggestionConfig:u})}):null}var yd=()=>o(908447),fd=()=>o(581928),hd=()=>o(899164),vd=()=>o(317406),xd=()=>o(775584),bd=()=>o(395963),Cd=()=>o(896427),wd=()=>o(992307),jd=()=>o(860037);function Ad(e){const{collectionContextStore:t,collectionSettingsStore:o,formatKey:i,property:l,initialPropertyName:a,propertyGroupId:c,targetCollectionPointer:d,from:u,newPropertyFormat:p}=e,g=(0,r().v3)(),y=(0,x().tz)(),f=(0,s().K8)((()=>t.collectionStore()),[t]),h=(0,s().K8)((()=>{const e=t.collectionViewBlockStore();return function(e){const{targetCollectionPointer:t,collectionStore:o,collectionViewBlockStore:n}=e;if(!t)return;if(o&&o.pointer===t)return o;return n?Pt().m.createChildStore(n,t):void 0}({targetCollectionPointer:d,collectionStore:f,collectionViewBlockStore:e})}),[t,f,d]),b=(0,s().K8)((()=>l?pr().Jq(t,l):void 0),[t,l]),w=Boolean(f&&h&&f.id===h.id),j=Boolean("relation"===(null==b?void 0:b.type)&&b.connectedRelation),_=Boolean("subitem"===u),I=Boolean("timeline_arrows_by"===u),k=_||I,M=(0,s().K8)((()=>t.contextType),[t]),T=(0,s().K8)((()=>{if(void 0!==a&&""!==a&&a!==sa().dC.relation)return a;const e=null==f?void 0:f.getSchema();return void 0===(null==b?void 0:b.name)&&h&&e?pr().$H(y,{targetCollectionStore:h,isSelfRelation:w,sourceSchema:e,createUnique:!0,from:u}):(null==b?void 0:b.name)||""}),[a,f,null==b?void 0:b.name,h,y,w,u]),[P,B]=(0,n.useState)(T),[F,V]=(0,n.useState)("no_limit"),[E,R]=(0,n.useState)({hasInverseRelation:k,inverseName:void 0,autoRelate:{enabled:!1}}),O=(0,v().IS)((()=>({relationOptions:{marginTop:10}})),[]),K=(0,n.useCallback)((()=>{D().a2({collectionSettingsStore:o,item:{type:"selectRelationSource",property:l,formatKey:i}})}),[o,l,i]),N=(0,n.useCallback)((()=>{if(!E)return;const{hasInverseRelation:e,inverseName:n,autoRelate:r}=E,s=t.collectionStore(),a=t.collectionViewStore(),d=t.normalizedFormatStore.state;if(!s||!h)return;const f=p&&i?{...d,[i]:p}:d,{performResult:v}=S().createAndCommit({userAction:"CollectionSettingsSetupRelation.handleAddRelation",environment:g,canUndo:!0,perform:o=>{const d=l??(0,fd().createProperty)({environment:g,collectionStore:s,collectionViewArgs:a&&i?{collectionViewStore:a,format:f,formatKey:i}:void 0,propertyType:"relation",transaction:o});if(hd().cT({environment:g,collectionContextStore:t,collectionStore:s,property:d,propertyName:P,targetCollectionStore:h,hasInverseRelation:e,inverseName:n,autoRelate:r,propertyLimit:F,intl:y,transaction:o,from:u}),c&&d&&(0,bd().En)({collectionStore:s,groupId:c,propertyId:d,transaction:o}),a){var p;const e=(null===(p=a.getFormat().table_properties)||void 0===p?void 0:p.find((e=>e.property===d)))??{property:d,visible:!0};m().zA({stores:[a],update:{table_properties:[...a.getFormat().table_properties??[],e]},transaction:o})}return"subitem"===u&&a?tr().zt({environment:g,collectionContextStore:t,relationPropertyId:d,transaction:o}):"timeline_arrows_by"===u&&a&&(vd().Tq({collectionViewStore:a,newProperty:d,transaction:o}),vd().L_({collectionContextStore:t,relationPropertyId:d,transaction:o})),d}});"subitem"===u||"timeline_arrows_by"===u?(D().yl({collectionSettingsStore:o}),D().a2({collectionSettingsStore:o,item:{type:"main"}})):D().n1({collectionSettingsStore:o,property:v,formatKey:i}),(0,yd().Z)({environment:g,collectionContextStore:t,from:"collectionPage"===M?"page_properties":"view_settings",property_type:"relation",property_id:v}),(0,xd().F)()&&D().os({collectionSettingsStore:t.settingsStore})}),[E,t,h,g,u,M,l,i,c,P,F,y,o,p]),z=(0,n.useCallback)((e=>{B(e.target.value)}),[B]),U=(0,n.useCallback)((e=>{V(e)}),[V]);return(0,L.jsxs)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"New relation",id:"database.viewSettings.setupRelationTab.title"}),children:[(0,L.jsxs)(A().A,{isInput:!0,children:[(0,L.jsx)(pt().Ay,{value:P,placeholder:y.formatMessage({defaultMessage:"Property name",id:"database.viewSettings.setupRelationTab.propertyNamePlaceholder"}),onChange:z,onBlur:Do().lQ,onSubmit:Do().lQ,focusInitial:!0,selectAll:!1}),(0,L.jsxs)("div",{style:O.relationOptions,children:[(0,L.jsx)(jd().A,{isSelfRelation:w,collectionStore:h,showAs:"chevron",onClick:K,disabled:_}),u?null:(0,L.jsx)(wd().o,{selectedKey:F,propertyType:"relation",onChange:U}),h&&!j?(0,L.jsx)(Cd().Ay,{collectionContextStore:t,targetCollectionStore:h,property:l,mode:"create",temporaryInverseState:E,setTemporaryInverseState:R,onSubmit:N,shouldEnforceTwoWayRelation:k}):null]})]}),(0,L.jsx)(A().A,{children:(0,L.jsx)(Al().A,{href:(0,No().x)("guides.relations"),title:(0,L.jsx)(x().sA,{id:"database.viewSettings.propertyTab.relations.learnMoreButton.title",defaultMessage:"Learn about relations"}),analyticsFrom:"view_settings_property_relation"})})]})}var _d=()=>o(416504),Id=()=>o(154017),kd=()=>o(626318),Md=()=>o(447453);function Td(e){const{collectionContextStore:t,collectionSettingsStore:o,targetCollectionPointer:i,module:l,onClose:a}=e,c=(0,x().tz)(),{isMobile:d}=(0,r().Y0)(),{layoutStore:u,setModuleSelection:p}=(0,Mc().LH)(),{collectionStore:g}=(0,Mc().bi)(),m=(0,r().v3)(),y=(0,s().K8)((()=>u.inMemoryRecordCache),[u]),f=(0,s().K8)((()=>{if(!i)return;if(g&&g.pointer===i)return g;const e=t.collectionViewBlockStore();return e?Pt().m.createChildStore(e,i):void 0}),[t,g,i]),h=(0,s().K8)((()=>null==f?void 0:f.canEditCollection()),[f]),b=Boolean(g&&f&&g.id===f.id),w=(0,s().K8)((()=>{var e;return null==f||null===(e=f.getModel())||void 0===e?void 0:e.getRenderTitle({getRecordModel:null==g?void 0:g.getRecordModel,intl:c,userTimeZone:(0,_d().P)()})}),[f,g,c]),j=(null==f?void 0:f.id)!==(null==g?void 0:g.id),[_,I]=(0,n.useState)(w??""),[k,T]=(0,n.useState)({hasInverseRelation:j,inverseName:void 0,autoRelate:{enabled:!1}}),[P,B]=(0,n.useState)(!1),F=(0,n.useCallback)((()=>{D().a2({collectionSettingsStore:o,item:{type:"selectViewsModuleSource",module:l}})}),[o,l]),V=(0,n.useCallback)((()=>{B((e=>!e))}),[]),E=(0,n.useCallback)((()=>{T((e=>({...e,hasInverseRelation:!1})))}),[]),R=(0,n.useCallback)((()=>{T((e=>({...e,hasInverseRelation:!0})))}),[]),O=(0,n.useCallback)((e=>{var t;const o=null!=k&&null!==(t=k.autoRelate)&&void 0!==t&&t.enabled?{enabled:!1}:{enabled:!0,bot_id:e};T((t=>({...t,autoRelate:{enabled:Boolean(o),bot_id:e}})))}),[k]),K=(0,n.useCallback)((e=>{T((t=>({...t,inverseName:e.target.value})))}),[]),N=(0,n.useCallback)((()=>{const e=null==t?void 0:t.collectionViewBlockStore();if(!e)throw new Error("Views module block not found");const{performResult:n}=S().createAndCommit({userAction:"CollectionSettingsSetupViewsModule.handleAddView",environment:m,canUndo:!0,perform:o=>{let n;if(P&&g){const e=(0,fd().createProperty)({environment:m,collectionStore:g,collectionViewArgs:void 0,propertyType:"relation",transaction:o}),{inverseRelationPropertyId:i}=hd().cT({environment:m,collectionContextStore:t,collectionStore:g,property:e,propertyName:_,targetCollectionStore:f??g,hasInverseRelation:k.hasInverseRelation,inverseName:k.inverseName,autoRelate:k.autoRelate,intl:c,transaction:o,propertyLimit:"no_limit"})??{};n=i??e}const i=(0,kd().Bj)({environment:m,transaction:o,collectionViewBlockStore:e,targetCollectionPointer:null==f?void 0:f.pointer,viewName:_,relationPropertyId:n,inMemoryRecordCache:y});return p({type:"existing_module",moduleId:l.id,isDragging:!1}),{collectionViewPointer:i}}});null==a||a(),D().os({collectionSettingsStore:o});const{collectionViewPointer:i}=n??{};i&&(qi().default.afterNextFlush((()=>{t&&((0,Ia().t)({environment:m,collectionContextStore:t,collectionViewId:i.id,isFullScreen:!1,isRootChild:!1,isInPeekRenderer:!1}),(0,Md().O)({collectionContextStore:t,collectionSettingsStore:t.settingsStore,closeOnEscape:!1}))})),t&&(0,Id().b)({environment:m,collectionContextStore:t,view_type:"table",from:"viewsMain",is_in_page_builder:!0})),D().os({collectionSettingsStore:o})}),[t,m,o,P,g,_,f,k,c,y,p,l.id,a]),z=(0,s().K8)((()=>null==f?void 0:f.getIcon()),[f]),U=(0,v().IS)((e=>({chevronTitle:{marginInlineStart:4,display:"inline",wordBreak:"break-word",alignSelf:"center",...We().RC},relationMenuTitle:{display:"flex",alignItems:"center",whiteSpace:"pre"},helpIcon:{marginInlineStart:6},tooltip:{maxWidth:285,width:"max-content",overflowWrap:"break-word",textWrap:"wrap",whiteSpace:"pre-line"},tooltipSecondary:{color:e.text.inverseSecondary}})),[]),H=P&&f&&h;return(0,L.jsxs)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"New view",id:"database.viewSettings.setupViewTab.title"}),children:[(0,L.jsx)(A().A,{isInput:!0,children:(0,L.jsx)(pt().Ay,{value:_||"",placeholder:P?c.formatMessage({defaultMessage:"View & relation name",id:"database.viewSettings.mainTab.viewNameAndRelationNameSection.title"}):c.formatMessage({defaultMessage:"View name",id:"database.viewSettings.mainTab.viewNameSection.title"}),onChange:e=>I(e.target.value),onBlur:Do().lQ,onSubmit:Do().lQ,focusInitial:!0,selectAll:!1})}),(0,L.jsxs)(A().A,{children:[(0,L.jsx)(so().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"View of",id:"database.viewSettings.setupViewsModule.viewOf.title"}),showChevron:!0,onClick:F,disabled:!1,right:b?(0,L.jsx)(x().sA,{defaultMessage:"This database",id:"database.viewSettings.editRelation.selfRelationTarget.title"}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(As().B6,{icon:z,iconRecordCategory:"collection",isEmptyPage:!1,size:20,disabled:!0}),(0,L.jsx)(Cn().A,{store:f,style:U.chevronTitle})]}),rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0}}),(0,L.jsx)(jn().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"Add new relation",id:"database.viewSettings.addRelationToggle"}),on:P,onClick:V,focused:!1,disabled:!h})]}),H?(0,L.jsx)(A().A,{topBorder:!0,children:(0,L.jsx)(Cd().EB,{currentInverseState:Boolean(null==k?void 0:k.hasInverseRelation),disableInverseRelation:E,enableInverseRelation:R,handleAutoRelateToggle:O,temporaryInverseState:k,collectionStore:g,targetCollectionStore:f,isTwoWayToggleDisabled:!b,isNameDisabled:!1,menuTitle:(0,L.jsxs)("div",{style:U.relationMenuTitle,children:[c.formatMessage(Cd().DZ.generic.title),d?void 0:(0,L.jsx)(at().A,{placement:"bottom",textWrap:!0,style:U.tooltip,render:e=>(0,L.jsx)("div",{...e,style:U.helpIcon,children:(0,L.jsx)(W().I,{icon:Fo().questionMarkCircleSmallIcon,size:"sm",colorVariant:"tertiary"})}),renderTooltip:()=>(0,L.jsxs)(L.Fragment,{children:[b?c.formatMessage(Pd.selfTwoWayRelationTooltip):c.formatMessage(Pd.nonSelfTwoWayRelationTooltip),b?void 0:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("br",{}),(0,L.jsx)("span",{style:U.tooltipSecondary,children:(0,L.jsx)(x().sA,{...Pd.nonSelfTwoWayRelationTooltipSecondary})})]})]})})]}),autoRelate:null==k?void 0:k.autoRelate,isSelfRelation:b,inverseRelationName:(null==k?void 0:k.inverseName)??"",handleInverseNameChange:K})}):void 0,(0,L.jsx)(A().A,{children:(0,L.jsx)(M().A,{colorPalette:"blue",style:{display:"flex",marginTop:0,marginInlineEnd:8,marginBottom:8,marginInlineStart:8},onClick:N,disabled:0===_.length,children:P?(0,L.jsx)(x().sA,{...Pd.addViewAndRelationButton}):(0,L.jsx)(x().sA,{...Pd.addViewButton})})})]})}const Pd=(0,x().YK)({addViewButton:{defaultMessage:"Add view",id:"database.viewSettings.addViewButton"},addViewAndRelationButton:{defaultMessage:"Add view & relation",id:"database.viewSettings.addViewAndRelationButton"},selfTwoWayRelationTooltip:{defaultMessage:"Manage separate properties for each direction of a two-way relation.",id:"database.viewSettings.selfTwoWayRelationTooltip"},nonSelfTwoWayRelationTooltip:{defaultMessage:"Manage separate properties for each direction of a two-way relation.",id:"database.viewSettings.nonSelfTwoWayRelationTooltip"},nonSelfTwoWayRelationTooltipSecondary:{defaultMessage:"This setting is required for relations of linked databases in tabbed views.",id:"database.viewSettings.nonSelfTwoWayRelationTooltipSecondary"}});var Bd=()=>o(68263),Fd=()=>o(848538);var Vd=()=>o(579627),Dd=()=>o(484595);function Ed({collectionSettingsStore:e,collectionContextStore:t,integrationName:i,integrationIcon:l,fullHeight:a}){const c=(0,r().v3)(),d=(0,v().IS)((e=>({promptTitle:Od(e)})),[]),[p,g]=(0,n.useState)(!1),m=(0,s().K8)((()=>t.collectionViewBlockStore()),[t]),y=(0,s().K8)((()=>null==m?void 0:m.getSpaceStore()),[m]),[{value:f}]=(0,qe().Yb)((async()=>{if(!m||!y)return{numberOfGuests:void 0,numberOfUsers:void 0,isPublic:void 0};const e=(0,o(329443).i0)(m).map((e=>e.permissionItem));let t=!1,n=!1;for(const o of e)Bd().FP(o)?t=!0:Bd().Lg(o)&&!Bd().$I(o.role)&&(n=!0);const i=Do().oE(await(0,Eo().lX)(e,10,(async e=>{if("user_permission"===e.type){const t=(0,o(646736).dp)(y,e.user_id);return await t.load(),t}})));let r;if(n){r=await(0,o(237118).P)({environment:c,spaceId:y.id})??1}else r=i.filter((e=>{const t=e.getMembershipType();return t&&(0,Fd().MN)(t)})).length;const l=i.filter((e=>{const t=e.getMembershipType();return t&&(0,Fd().P)(t)})).length;return{numberOfGuests:l,numberOfUsers:r+l,isPublic:t}}),[m,c,y]),{numberOfGuests:h,numberOfUsers:b,isPublic:w}=(0,n.useMemo)((()=>f??{numberOfGuests:void 0,numberOfUsers:void 0,isPublic:void 0}),[f]);(0,n.useEffect)((()=>{w||1!==b||D().os({collectionSettingsStore:e})}),[e,w,b]);const j=(0,n.useCallback)((()=>{m&&(p&&function(e){const{environment:t,store:o}=e,n=t.currentUser.id;if(!n)return;S().createAndCommit({userAction:"CollectionSettingsSyncedContentShare.restrictAccessToSyncedContent",environment:t,canUndo:!0,perform:e=>{Vd().wW({environment:t,store:o,shouldInherit:!1,transaction:e,permissionItem:{type:"user_permission",user_id:n,role:"editor"}})}})}({environment:c,store:m}),function(e,t){(0,u().DO_NOT_USE_trackLegacy)(e,"set_database_sync_permissions",t)}(c,{type:p?"restrict":"share"}),D().os({collectionSettingsStore:e}))}),[e,m,c,p]);if(!m)return null;const _=(0,L.jsx)("div",{style:d.promptTitle,children:(0,L.jsx)(x().sA,{id:"CollectionSettingsSyncedContentShare.header",defaultMessage:"Share synced content with"})}),I=(0,L.jsxs)(L.Fragment,{children:[0!==h?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(x().sA,{id:"CollectionSettingsSyncedContentShare.option.share.caption.usersWithGuests",defaultMessage:"{numberOfUsers} people (including you {numberOfGuests, plural, one {and {numberOfGuests} guest} other {and {numberOfGuests} guests}})",values:{numberOfUsers:b,numberOfGuests:h}})," "]}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(x().sA,{id:"CollectionSettingsSyncedContentShare.option.share.caption.usersWithoutGuests",defaultMessage:"{numberOfUsers} people (including you)",values:{numberOfUsers:b}})," "]}),w?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(x().sA,{id:"CollectionSettingsSyncedContentShare.option.share.caption.sharedWithPublic",defaultMessage:"and those with the link"})," "]}):void 0,(0,L.jsx)(x().sA,{id:"CollectionSettingsSyncedContentShare.option.share.caption.accessToIntegration",defaultMessage:"will get access to content synced from {integrationName}",values:{integrationName:i}})]}),k=(0,L.jsx)(Rt().Ye,{style:{marginTop:10},children:(0,L.jsx)(M().A,{colorPalette:"blue",style:{flex:"0 0 100%"},size:"lg",onClick:j,children:(0,L.jsx)(x().sA,{id:"CollectionSettingsSyncedContentShare.continueButton",defaultMessage:"Continue"})})}),T=(0,L.jsx)(Rt().Ye,{style:{paddingBottom:24},alignItems:"center",justifyContent:"center",children:(0,L.jsx)("img",{style:{width:40},src:l})}),P=(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,initialFocus:void 0,sections:[{key:"grant_permissions",items:[{key:"allow",action:()=>null,render:e=>(0,L.jsx)(Q().A,{...e,textWrapperStyle:{textAlign:"start"},title:(0,L.jsx)(x().sA,{id:"CollectionSettingsSyncedContentShare.option.share.title",defaultMessage:"Anyone on this page"}),shouldWrapCaption:!0,caption:I,icon:(0,L.jsx)(Dd().A,{isSelected:!p}),onClick:()=>{g(!1)}})},{key:"restrict",action:()=>null,render:e=>(0,L.jsx)(Q().A,{...e,textWrapperStyle:{textAlign:"start"},title:(0,L.jsx)(x().sA,{id:"CollectionSettingsSyncedContentShare.option.restrict.title",defaultMessage:"Only you"}),shouldWrapCaption:!0,caption:(0,L.jsx)(x().sA,{id:"CollectionSettingsSyncedContentShare.option.restrict.caption",defaultMessage:"You’ll need to share with others using the share menu"}),icon:(0,L.jsx)(Dd().A,{isSelected:p}),onClick:()=>{g(!0)}})}],render:e=>(0,L.jsx)(A().A,{...e})}]});return(0,L.jsx)(C().Ay,{collectionSettingsStore:e,fullHeight:a,children:(0,L.jsxs)(Rt().Ye,{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:0,paddingInlineEnd:16,paddingBottom:16,paddingInlineStart:16},flexDirection:"column",children:[T,(0,L.jsxs)("div",{children:[_,P]}),k]})})}const Rd=n.memo(Ed,Hl().A);function Od(e){return{color:e.text.primary,fontWeight:We().Wy.semibold,fontSize:14}}var Kd=()=>o(712257),Nd=()=>o(790515);function Ld(e){const{context:t,collectionSettingsStore:o,collectionContextStore:i}=e,l=(0,r().v3)(),a=(0,s().O$)(i.normalizedSchemaStore),c=(0,s().O$)(i.normalizedFormatStore),d=(0,s().O$)(i.canConfigureBlockStore),u=(0,s().K8)((()=>(0,Nd().S2)(i)),[i]),p=(0,s().K8)((()=>{var e;const t=i.collectionViewStore();return t?(0,Nd().LQ)({schema:a,filters:Hd(i),getRecordModel:t.getRecordModel,spaceIdCreator:l.idCreator.getSpaceIdCreatorSync((null===(e=t.pointer)||void 0===e?void 0:e.spaceId)??""),collectionSource:t.getCollectionSource()}):[]}),[i,a,l.idCreator]),g=(0,s().K8)((()=>i.contextType),[i]),m=(0,n.useCallback)((e=>{if(!e)return;const n=Kd().m({property:e,collectionContextStore:i,environment:l,schema:a});n&&function(e,t,o,n,i){if((0,ar().X)({environment:i,collectionContextStore:t,action:"create_property_filter"}),o===bo().Bd.FilterBar||o===bo().Bd.TopbarFilterPopup){Ud(t,n);const o=t.getFilterBarItemSettingsStore(e);D().R8({collectionSettingsStore:o,item:{type:"filter"}})}else if(o===bo().Bd.ViewSettings){Wd(n);const o=t.getFilterOptionsItemSettingsStore(e);D().R8({collectionSettingsStore:o,item:{type:"filter"}})}}(n,i,t,o,l)}),[i,o,t,l,a]),S=(0,n.useCallback)((()=>{Kd().x1({collectionContextStore:i,environment:l}),function(e,t,o,n){(0,ar().X)({environment:n,collectionContextStore:e,action:"create_combinator_filter"}),t===bo().Bd.FilterBar||t===bo().Bd.TopbarFilterPopup?(Ud(e,o),D().R8({collectionSettingsStore:e.filterBarCombinatorFilterSettingsStore,item:{type:"filter"}})):t===bo().Bd.ViewSettings&&(Wd(o),D().R8({collectionSettingsStore:e.filterOptionsCombinatorFilterSettingsStore,item:{type:"filter"}}))}(i,t,o,l)}),[i,o,t,l]);return(0,L.jsx)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Add filter",id:"database.viewSettings.createFilterTab.title"}),footer:d&&"collectionSettings"!==g&&(0,L.jsx)(A().A,{topBorder:!0,children:(0,L.jsx)(so().A,{icon:u>0?hn().filterIcon:wl().plusIcon,isGray:!0,title:u>0?(0,L.jsx)(x().sA,{...va().D.advancedFilterTitle}):(0,L.jsx)(x().sA,{...va().D.addAdvancedFilterTitle}),right:u>0&&(0,L.jsx)(x().sA,{...va().D.advancedFilterRulesCount,values:{ruleCount:u}}),onClick:S})}),children:(0,L.jsx)(E().A,{schema:a,format:c,getProperties:()=>p.map((e=>e.property)),onAccept:m,inputPlaceholder:oo().A.formatMessage(va().D.inputPlaceholder)})})}const zd=n.memo(Ld,Hl().A);function Ud(e,t){e.filtersBarOpenStore.setState(!0),D().yl({collectionSettingsStore:t})}function Wd(e){D().R8({collectionSettingsStore:e,item:{type:"main"}}),D().a2({collectionSettingsStore:e,item:{type:"filters"}})}function Hd(e){return e.currentPropertyFiltersStore.state}const Gd=(0,x().YK)({inputPlaceholder:{defaultMessage:"Sort by…",id:"database.viewSettings.createSortTab.inputPlaceholder"}});const $d=function(e){const{context:t,collectionContextStore:n,collectionSettingsStore:i}=e,l=(0,r().v3)(),a=(0,x().tz)(),c=(0,s().O$)(n.normalizedSchemaStore),d=(0,s().O$)(n.normalizedFormatStore),u=(0,s().K8)((()=>Qd(n)),[n]);return(0,L.jsx)(C().Ay,{...e,collectionSettingsStore:i,title:(0,L.jsx)(x().sA,{defaultMessage:"New sort",id:"database.viewSettings.createSortTab.title"}),children:(0,L.jsx)(E().A,{schema:c,format:d,getProperties:()=>Object.entries(c).filter((([e,t])=>!u.find((t=>t.property===e))&&(0,o(835195).oH)(t))).map((([e])=>e)),onAccept:e=>function(e,t,o,n,i){var r;if(!e)return;const l=o.collectionViewStore(),s=o.normalizedSchemaStore.state;if(!l||!s)return;const a=null===(r=s[e])||void 0===r?void 0:r.type;(0,ar().X)({environment:t,collectionContextStore:o,action:"create_sort_accept",original_view_type:l.getType(),property_type:a});const c={property:e,direction:"ascending"},d=[...Qd(o),c];if(Kd().IU({environment:t,collectionContextStore:o,temporaryState:{...o.temporaryStateStore.state,sorts:{value:d}}}),n===bo().Bd.TopbarSortPopup||n===bo().Bd.FilterBar){o.filtersBarOpenStore.setState(!0),D().yl({collectionSettingsStore:i});const{filterBarSortSettingsStore:e}=o;D().R8({collectionSettingsStore:e,item:{type:"sort"}})}else n===bo().Bd.ViewSettings?(D().R8({collectionSettingsStore:i,item:{type:"main"}}),D().a2({collectionSettingsStore:i,item:{type:"sort"}})):n===bo().Bd.MobileSheet&&D().a2({collectionSettingsStore:i,item:{type:"sort"}})}(e,l,n,t,i),inputPlaceholder:a.formatMessage(Gd.inputPlaceholder)})})};function Qd(e){return e.currentSortsStore.state}var Yd=()=>o(476492),qd=()=>o(406792);const Jd=function(e){const{collectionContextStore:t,context:n,collectionSettingsStore:i}=e,l=(0,r().v3)(),a=(0,s().K8)((()=>t.collectionViewStore()),[t]),c=(0,s().O$)(t.normalizedSchemaStore),d=(0,s().K8)((()=>function(e){return e.currentCombinatorFilterStore.state}(t)),[t]),u=(0,s().K8)((()=>null==a?void 0:a.getType()),[a]);return a&&d&&u?(0,L.jsxs)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Advanced filter",id:"database.viewSettings.filterTab.title"}),unconstrainedWidth:!0,children:[(0,L.jsx)(j().i,{children:(0,L.jsx)(o(184979).tY,{index:0,level:0,combinatorFilter:d,schema:c,onChange:(e,o)=>function(e,t,o,n,i,r){var l,s;const a=null===(l=n.remoteResultStore.state)||void 0===l?void 0:l.sizeHint,c=qd().default.DO_NOT_USE_markLegacy("collections.update_filter_lag");qd().default.DO_NOT_USE_measureAfterNextFlushLegacy(c,{environment:o,getData:()=>Yd().K6({from:"combinator_filter",collectionContextStore:n,sizeHintAtStart:a})}),Kd().IU({environment:o,collectionContextStore:n,temporaryState:{...n.temporaryStateStore.state,combinatorFilter:{value:t}}}),0===(null===(s=t.filters)||void 0===s?void 0:s.length)&&r===bo().Bd.MobileSheet&&D().yl({collectionSettingsStore:i});(0,ar().X)({environment:o,collectionContextStore:n,action:"update_combinator_filter"})}(0,o,l,t,i,n),collectionContextStore:t,collectionViewType:u,collectionViewId:a.id,parentStore:a})}),(0,L.jsx)(A().A,{topBorder:!0,children:(0,L.jsx)(so().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"Delete filter",id:"database.viewSettings.filterTab.deleteFilterButton.title"}),isRed:!0,icon:G().trashIcon,onClick:()=>function(e,t,o,n){Kd().IU({environment:e,collectionContextStore:t,temporaryState:{...t.temporaryStateStore.state,combinatorFilter:{value:void 0}}}),o===bo().Bd.FilterBar?D().os({collectionSettingsStore:n}):o===bo().Bd.MobileSheet&&D().yl({collectionSettingsStore:n});(0,ar().X)({environment:e,collectionContextStore:t,action:"delete_combinator_filter"})}(l,t,n,i)})})]}):null};var Xd=()=>o(392459),Zd=()=>o(57232),eu=()=>o(942125),tu=()=>o(59400),ou=()=>o(222334),nu=()=>o(582684),iu=()=>o(212727),ru=()=>o(866913),lu=()=>o(637558),su=()=>o(700251),au=()=>o(838364);function cu(e){const{collectionSettingsStore:t,collectionContextStore:o,viewType:n}=e,i=(0,s().K8)((()=>{var e;return null===(e=o.collectionViewStore())||void 0===e?void 0:e.getType()}),[o]),r=(0,s().K8)((()=>(0,Nd().tG)(o)),[o]),l=(0,s().K8)((()=>(0,Nd().S2)(o)),[o]),a=(0,s().K8)((()=>{switch(n){case"filterAndSort":return(0,eu().ye)(o)||(0,eu().gv)(o);case"filter":return(0,eu().ye)(o);default:(0,b().HB)(n)}}),[o,n]),c=(0,L.jsx)(uu,{collectionSettingsStore:t,collectionContextStore:o,activeFilterCount:l}),d=(0,L.jsx)(pu,{collectionContextStore:o}),u=(0,v().IS)((()=>({menuScroller:{paddingBottom:au().Hc}})),[]);return(0,L.jsx)(C().Ay,{collectionSettingsStore:t,title:r>0?(0,L.jsx)(x().sA,{...va().D.numberOfFiltersTitle,values:{numberOfFilters:r}}):(0,L.jsx)(x().sA,{...va().D.noFiltersTitle}),menuScrollerStyle:u.menuScroller,children:(0,L.jsxs)("div",{children:[a?(0,L.jsx)(tu()._Q,{context:Su(n),collectionContextStore:o}):null,"filterAndSort"===n&&"map"!==i?(0,L.jsx)(du,{collectionContextStore:o,collectionSettingsStore:t}):void 0,l>0?(0,L.jsxs)(L.Fragment,{children:[c,d]}):(0,L.jsxs)(L.Fragment,{children:[d,c]})]})})}function du({collectionSettingsStore:e,collectionContextStore:t}){const o=(0,r().v3)(),i=(0,s().O$)(t.normalizedSchemaStore),l=(0,s().O$)(t.currentSortsStore),a=l.length>0,c=(0,s().K8)((()=>Boolean((0,eu().Ml)(t,"normalized").sorts)),[t]),d=mu({isActive:a}),u=(0,n.useCallback)((()=>{(0,ar().X)({environment:o,collectionContextStore:t,action:"click_sort"}),D().a2({collectionSettingsStore:e,item:{type:a?"sort":"createSort"}})}),[a,t,o,e]);return(0,L.jsx)(A().A,{children:(0,L.jsx)(Q().A,{title:(0,L.jsx)(x().sA,{...va().D.sortTitle}),titleStyle:d.title,icon:(0,L.jsxs)("div",{style:d.iconContainer,children:[(0,nu().arrowUpDownIcon)(d.icon),c?(0,L.jsx)("div",{style:d.diffDot}):void 0]}),rightStyle:d.right,right:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{style:d.filterValue,children:(0,L.jsx)(lu().v,{currentSorts:l,schema:i})}),(0,ou().arrowChevronSingleRightIcon)(d.chevronIcon)]}),onClick:u,focused:!1})})}function uu({collectionSettingsStore:e,collectionContextStore:t,activeFilterCount:o}){const i=(0,r().v3)(),l=o>0,a=(0,s().K8)((()=>Boolean((0,eu().Ml)(t,"normalized").combinatorFilter)),[t]),c=mu({isActive:l}),d=(0,n.useCallback)((()=>{(0,ar().X)({environment:i,collectionContextStore:t,action:"click_combinator_filter"}),Kd().x1({collectionContextStore:t,environment:i}),D().a2({collectionSettingsStore:e,item:{type:"filter"}})}),[t,i,e]);return(0,L.jsx)(A().A,{children:(0,L.jsx)(Q().A,{title:(0,L.jsx)(x().sA,{...va().D.advancedFilterTitle}),titleStyle:c.title,icon:(0,L.jsxs)("div",{style:c.iconContainer,children:[(0,iu().gearIcon)(c.icon),a?(0,L.jsx)("div",{style:c.diffDot}):null]}),rightStyle:c.right,right:(0,L.jsxs)(L.Fragment,{children:[l?(0,L.jsx)("div",{style:c.filterValue,children:(0,L.jsx)(x().sA,{...va().D.advancedFilterRulesCount,values:{ruleCount:o}})}):void 0,(0,ou().arrowChevronSingleRightIcon)(c.chevronIcon)]}),onClick:d,focused:!1})})}function pu({collectionContextStore:e}){const t=(0,r().v3)(),o=(0,x().tz)(),i=(0,s().O$)(e.normalizedSchemaStore),l=(0,s().O$)(e.normalizedFormatStore),a=(0,s().K8)((()=>e.collectionViewStore()),[e]),c=(0,s().K8)((()=>{var o;if(!a)return[];const n=e.currentPropertyFiltersStore.state;return[...new Set([...n.map((e=>e.filter)),...(0,Nd().LQ)({schema:i,filters:n,getRecordModel:a.getRecordModel,spaceIdCreator:t.idCreator.getSpaceIdCreatorSync((null===(o=a.pointer)||void 0===o?void 0:o.spaceId)??""),collectionSource:a.getCollectionSource()})])].map((e=>e.property))}),[a,e,i,t.idCreator]),d=(0,n.useCallback)((o=>{var n;if(!o)return;const r=Kd().m({property:o,collectionContextStore:e,environment:t,schema:i});if(!r)return;(0,ar().X)({environment:t,collectionContextStore:e,action:"click_property_filter",original_view_type:void 0,property_type:null===(n=i[o])||void 0===n?void 0:n.type});const l=e.getFilterOptionsItemSettingsStore(r);D().R8({collectionSettingsStore:l,item:{type:"filter"}})}),[e,t,i]),u=(0,su().y$)(),p=(0,v().IS)((e=>({leftIcon:{fill:e.icon.secondary,marginInlineStart:6,marginInlineEnd:6,width:u,height:u}})),[u]);return(0,L.jsx)(E().A,{schema:i,format:l,getProperties:()=>c,onAccept:d,disableSortByPageFormat:!0,inputPlaceholder:o.formatMessage(va().D.propertyInputPlaceholder),inputLeft:(0,L.jsx)(W().I,{icon:hn().filterIcon,style:p.leftIcon}),renderProperty:(t,o,n,r)=>a?(0,L.jsx)(gu,{schema:i,collectionViewStore:a,collectionContextStore:e,property:o,propertySchema:r,onClick:t.onClick,focused:!1}):null})}function gu(e){const{propertySchema:t,schema:o,collectionViewStore:i,collectionContextStore:l,property:a}=e,c=(0,r().v3)(),{name:d,type:u,icon:p}=t,[g,m,S]=(0,s().K8)((()=>{const e=l.currentPropertyFiltersStore.state.find((e=>e.filter.property===a));return[e,null==e?void 0:e.filter,null==e?void 0:e.id]}),[l,a]),y=Boolean(S&&(0,Nd().vu)(S)),f=m&&!(0,be().t_)(m),h=(0,s().K8)((()=>{if(!S)return!1;const e=(0,eu().Ml)(l,"normalized");return e.filters.updated.includes(S)||e.filters.added.includes(S)&&f}),[l,S,f]),x=Boolean((null==t?void 0:t.icon)&&(0,To().T8)(t.icon)),b=mu({isActive:Boolean(f),isCustomIcon:x}),C=(0,v().DP)(),w=(0,s().K8)((()=>g?l.getFilterOptionsItemSettingsStore(g):null),[l,g]),j=(0,n.useCallback)((()=>{w&&(Kd().H2({environment:c,collectionContextStore:l}),D().os({collectionSettingsStore:w}))}),[w,c,l]),A=(0,s().K8)((()=>!!w&&w.state.open),[w]),_=(0,n.useCallback)((()=>w&&g?(0,L.jsx)(ru().q,{collectionContextStore:l,collectionSettingsStore:w,collectionViewStore:i,context:Xd().aV.SettingsFilters,filter:g,schema:o}):null),[l,w,g,i,o]),I=(0,n.useCallback)((()=>(0,L.jsx)(Q().A,{title:d,titleStyle:b.title,icon:(0,L.jsxs)("div",{style:b.iconContainer,children:[(0,L.jsx)(Qe().zB,{icon:p,type:u,size:F().lD.sm,theme:C,style:b.icon}),h?(0,L.jsx)("div",{style:b.diffDot}):void 0]}),disabled:y,rightStyle:b.right,right:(0,L.jsxs)(L.Fragment,{children:[f?(0,L.jsx)(_e().Ay,{propertyFilter:m,schema:o,valueOnly:!0,parentStore:i,style:b.filterValue}):void 0,y?void 0:(0,ou().arrowChevronSingleRightIcon)(b.chevronIcon)]}),...e})),[i,h,p,f,y,d,m,e,o,b,C,u]);return(0,L.jsx)(ri().Ay,{popupType:yo().n.BottomSheet,open:A,trapFocus:!0,onDismiss:j,render:_,origin:I()})}function mu({isActive:e,isCustomIcon:t}){const o=(0,su().y$)({type:t?"custom":"system"});return(0,v().IS)((t=>({icon:{fill:e?t.blue.icon.accentPrimary:void 0,marginInlineStart:2,marginInlineEnd:2,width:o},iconContainer:{position:"relative"},title:{color:e?t.blue.text.accentPrimary:t.text.primary,marginInlineEnd:4,...We().RC},right:{display:"flex",alignItems:"center",justifyContent:"end",color:t.text.tertiary,fill:t.icon.tertiary,maxWidth:"50%"},filterValue:{...We().RC},chevronIcon:{width:20,fill:t.icon.tertiary,marginInlineStart:4},diffDot:{position:"absolute",top:-1,insetInlineEnd:-1,background:t.orange.icon.accentPrimary,border:`1px solid ${t.background.primary}`,width:8,height:8,borderRadius:8}})),[e,o])}function Su(e){switch(e){case"filterAndSort":return"SettingsFiltersAndSort";case"filter":return"SettingsFilters";default:(0,b().HB)(e)}}function yu(e){return h().A.isMobile?(0,L.jsx)(cu,{collectionContextStore:e.collectionContextStore,collectionSettingsStore:e.collectionSettingsStore,viewType:"filter"}):(0,L.jsx)(fu,{...e})}const fu=n.memo((function(e){const{isMobile:t}=(0,r().Y0)(),{collectionSettingsStore:l,collectionContextStore:a}=e,c=(0,r().v3)(),[d,u,p,g]=(0,s().K8)((()=>[a.currentPropertyFiltersStore.state,a.currentPropertyFiltersStore.state.map((e=>e.id)),a.permissionScopesStore.state,(0,eu().I6)(a)]),[a]),m=(0,o(396182).I)(),S=(0,s().K8)((()=>(0,o(427537).H)(a)?a.currentCombinatorFilterStore.state:void 0),[a]),y=(0,n.useCallback)((e=>{D().os({collectionSettingsStore:a.filterOptionsCombinatorFilterSettingsStore}),d.filter((t=>!e||t.id!==e)).forEach((e=>{const t=a.getFilterOptionsItemSettingsStore(e);D().os({collectionSettingsStore:t})}))}),[a,d]);(0,n.useEffect)((()=>{t||y()}),[t]);const f=(0,v().IS)((e=>({menuItem:{color:e.text.secondary},menuItemIcon:{width:14,marginInlineStart:4,marginInlineEnd:4,fill:e.icon.secondary},mobile:{paddingTop:8,background:e.background.primary}})),[]);return(0,L.jsx)("div",{onClick:e=>{(0,i().SQ)({event:e,context:i().y$.Click,callback:y})},children:(0,L.jsx)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Filters",id:"database.viewSettings.filtersTab.title"}),footer:g&&(0,L.jsx)(A().A,{topBorder:!0,children:(0,L.jsx)(hu,{collectionContextStore:a})}),unconstrainedWidth:!0,children:(0,L.jsxs)(A().A,{children:[u.length>0||S?(0,L.jsxs)("div",{style:c.device.isMobile?f.mobile:void 0,children:[S?(0,L.jsx)(xu,{collectionContextStore:a}):void 0,vu(c)?(0,L.jsx)(w().Ay,{direction:"vertical",keys:u,renderKey:e=>{const t=u.indexOf(e);return(0,L.jsx)(bu,{collectionContextStore:a,filter:d[t],onClick:y})},onDrop:e=>function(e,t,o){const n=o.collectionViewBlockStore();if(!n)return;const i=o.currentPropertyFiltersStore.state,r=Do().oE(e.map((e=>i.find((t=>t.id===e)))));Kd().IU({environment:t,collectionContextStore:o,temporaryState:{...o.temporaryStateStore.state,propertyFilters:{value:r}}}),(0,ar().X)({environment:t,collectionContextStore:o,action:"reorder_filters"})}(e,c,a),onDragEnd:()=>m("CollectionSettingsViewDesktopFilters","CollectionSettingsViewDesktopFilters/onDragEnd"),disabled:!p.canConfigureBlock}):u.map((e=>{const t=u.indexOf(e);return(0,L.jsx)(bu,{collectionContextStore:a,filter:d[t],onClick:y},e)}))]}):void 0,(0,L.jsx)(Q().A,{focused:!1,icon:(0,fl().W)(f.menuItemIcon),style:f.menuItem,title:(0,L.jsx)(x().sA,{defaultMessage:"Add filter",id:"database.viewSettings.filtersTab.newFilter.title"}),onClick:()=>{y(),function(e,t,o){(0,ar().X)({environment:e,collectionContextStore:o,action:"click_new_filter"}),D().a2({collectionSettingsStore:t,item:{type:"createFilter"}}),o.filtersBarOpenStore.setState(!0)}(c,l,a)}})]})})})}));function hu({collectionContextStore:e}){return(0,L.jsx)(tu()._Q,{context:"SettingsFilters",collectionContextStore:e})}function vu(e){return!e.device.isMobile}function xu({collectionContextStore:e}){const t=(0,r().v3)();return(0,L.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"4px 10px"},children:[vu(t)?(0,L.jsx)(Zd().A,{iconSize:12,style:{marginInlineStart:6,marginInlineEnd:6,opacity:.4,cursor:void 0}}):void 0,(0,L.jsx)(o(92423).l,{context:Xd().aV.SettingsFilters,collectionContextStore:e,collectionSettingsStore:e.filterOptionsCombinatorFilterSettingsStore})]})}function bu({filter:e,collectionContextStore:t,onClick:n}){const i=(0,r().v3)(),l=(0,s().K8)((()=>t.getFilterOptionsItemSettingsStore(e)),[t,e]);return(0,L.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"4px 10px"},children:[vu(i)?(0,L.jsx)(Zd().A,{iconSize:12,style:{marginInlineStart:6,marginInlineEnd:6}}):void 0,(0,L.jsx)(o(602141).A,{id:e.id,context:Xd().aV.SettingsFilters,collectionContextStore:t,collectionSettingsStore:l,onClick:n},e.id)]})}var Cu=()=>o(728567),wu=()=>o(152077),ju=()=>o(124749),Au=()=>o(95758),_u=()=>o(457190),Iu=()=>o(518773);var ku=()=>o(131849);function Mu(e){const{collectionSettingsStore:t,collectionContextStore:o,fullHeight:n}=e,i=(0,r().v3)(),l=(0,s().K8)((()=>o.collectionViewBlockStore()),[o]),a=(0,s().O$)(He().AppStoreSidebarSpaceStore),c=function({teamStore:e,collectionViewBlockStore:t}){const o=(0,s().K8)((()=>null==e?void 0:e.isDefined()),[e]),{isExplicitlySubscribedToFeed:n,isExplicitlyUnsubscribedToFeed:i,followDataIsLoaded:r}=(0,s().K8)((()=>{const e=null==t?void 0:t.getFollowStore();return{followDataIsLoaded:null==e?void 0:e.isReady(),isExplicitlySubscribedToFeed:null==e?void 0:e.isExplicitlySubscribedToFeed(),isExplicitlyUnsubscribedToFeed:null==e?void 0:e.isExplicitlyUnsubscribedToFeed()}}),[t]),l=(0,ku().a)(e);if(!r||!o)return;return n||l&&!i}({teamStore:(0,s().K8)((()=>{var e;const t=null===(e=o.collectionStore())||void 0===e?void 0:e.id;if(t&&a)return Au().h.createChildStore(a,{table:"team",id:t,spaceId:a.id})}),[o,a]),collectionViewBlockStore:l}),d=function({collectionViewBlockStore:e}){const{isExplicitlySubscribedToFeed:t,followDataIsLoaded:o}=(0,s().K8)((()=>{const t=null==e?void 0:e.getFollowStore();return{followDataIsLoaded:null==t?void 0:t.isReady(),isExplicitlySubscribedToFeed:null==t?void 0:t.isExplicitlySubscribedToFeed()}}),[e]);if(o)return t}({collectionViewBlockStore:l}),u=(0,wu().Vs)(),p=u?d:c,g=!u&&void 0===p,m=(0,s().K8)((()=>null==l?void 0:l.getModel()),[l]),S=(0,ju().$)();return(0,L.jsx)(C().Ay,{collectionSettingsStore:t,fullHeight:n,title:(0,L.jsx)(x().sA,{defaultMessage:"Your Feed settings",id:"database.viewSettings.followTab.title"}),desktopTitleType:"sectionHeader",children:(0,L.jsx)(A().A,{children:(0,L.jsx)(jn().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"Follow",id:"database.viewSettings.followMenuItem.title"}),icon:(0,Cu().squareOnSquarePlusSmallIcon)({width:F().Ev.sm,height:F().Ev.sm}),on:Boolean(p),focused:!1,disabled:g,onClick:()=>{!function(e,t,o,n,i){if(!t||!o||!n)return;const r=i?"unsubscribed":"subscribed",l=t.getFollowSettingsKey(),{following:s,followSettings:a}=(0,Iu().A)(l,r);_u().v({environment:e,followSettings:a,following:s,navigableBlockId:t.id,userId:o.id,spaceId:t.getSpaceId(),key:l,selectedKey:l,from:"more_menu"})}(i,l,S,m,Boolean(p))}})})})}var Tu=()=>o(812480),Pu=()=>o(62371),Bu=()=>o(330918),Fu=()=>o(673900);const Vu=function({numberGroupBy:e,collectionContextStore:t,schema:o,onChange:n}){const i=(0,v().DP)(),r=o[e.property];return(0,s().K8)((()=>t.collectionStore()),[t])&&r?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(A().A,{topBorder:!1,disableMobileBorders:!0,title:(0,L.jsx)(x().sA,{id:"database.groupMenu.numberGroupRange",defaultMessage:"Group range"}),children:(0,L.jsxs)("div",{style:{display:"flex",paddingInlineStart:14,paddingInlineEnd:14},children:[(0,L.jsx)(Du,{onChange:n,numberGroupBy:e,inputKey:"start"}),(0,L.jsx)("span",{style:{color:i.text.secondary,margin:"0 8px"},children:"–"}),(0,L.jsx)(Du,{onChange:n,numberGroupBy:e,inputKey:"end"})]})}),(0,L.jsx)(A().A,{topBorder:!1,disableMobileBorders:!0,title:(0,L.jsx)(x().sA,{id:"database.groupMenu.numberGroupSize",defaultMessage:"Group every"}),children:(0,L.jsxs)("div",{style:{paddingInlineStart:14,paddingInlineEnd:14},children:[(0,L.jsx)(Du,{onChange:n,numberGroupBy:e,inputKey:"size"}),(0,L.jsxs)("span",{style:{color:i.text.secondary,fontSize:12},children:[(0,L.jsx)(Bu().d,{disabled:!0,groupBy:e,groupFormat:{property:e.property,value:{type:"number",value:{type:"range",start:e.start,end:e.start+e.size}}},schema:o,currentGroups:[],isHiddenGroup:!1,style:{display:"inline",paddingInlineEnd:0,paddingInlineStart:0},collectionContextStore:t,source:"collection_settings"}),", ",(0,L.jsx)(Bu().d,{disabled:!0,groupBy:e,groupFormat:{property:e.property,value:{type:"number",value:{type:"range",start:e.start+e.size,end:e.start+2*e.size}}},schema:o,currentGroups:[],isHiddenGroup:!1,style:{display:"inline",paddingInlineEnd:0,paddingInlineStart:0},collectionContextStore:t,source:"collection_settings"}),", ..."]})]})})]}):null};function Du({numberGroupBy:e,inputKey:t,onChange:o}){return(0,L.jsx)(Fu().v,{value:e[t],onChange:n=>{void 0!==n&&("size"===t&&n<=0&&(n=1),"start"===t&&n>e.end&&(n=e.end),"end"===t&&n<e.start&&(n=e.start),o({newNumberGroupBy:{...e,[t]:n}}))}})}const Eu=function(e){return(0,L.jsx)(C().Ay,{...e,title:(0,L.jsx)(Ru,{collectionSettingsStore:e.collectionSettingsStore,collectionContextStore:e.collectionContextStore}),children:(0,L.jsx)(Ou,{groupByKey:e.groupByKey,groupsFormatKey:e.groupsFormatKey,collectionContextStore:e.collectionContextStore})})};function Ru({collectionSettingsStore:e,collectionContextStore:t}){const o=(0,s().K8)((()=>(0,yl().S)(e)),[e]),n=(0,s().O$)(t.normalizedSchemaStore),i=(0,s().O$)(t.normalizedFormatStore);if(!o||"groupByNumber"!==o.type||"chart_config"===o.groupByKey)return null;const r=i[o.groupByKey];return r?(0,Tu().hC)({groupBy:r,schema:n})??null:null}function Ou({groupByKey:e,groupsFormatKey:t,collectionContextStore:o}){const n=(0,r().v3)(),i=(0,s().K8)((()=>o.collectionViewStore()),[o]),l=(0,s().O$)(o.normalizedSchemaStore),a=(0,s().O$)(o.normalizedFormatStore),c=(0,s().K8)((()=>(0,Pu().H2)(a,e,t)),[a,e,t]);if(!c||!i)return null;const d=(0,Tu().bO)(c);return d?(0,L.jsx)(Vu,{numberGroupBy:d,schema:l,onChange:r=>{if("number"===c.type)S().createAndCommit({userAction:"CollectionSettingsViewGroupByNumber.renderContent",environment:n,canUndo:!0,perform:o=>{m().zA({stores:[i],update:{[e]:r.newNumberGroupBy,[t]:void 0},transaction:o})}});else if("formula"===c.type){const o=Do().cJ(r.newNumberGroupBy,"property"),l={...c,groupBy:o};S().createAndCommit({userAction:"CollectionSettingsViewGroupByNumber.renderContent",environment:n,canUndo:!0,perform:o=>{m().zA({stores:[i],update:{[e]:l,[t]:void 0},transaction:o})}})}(0,ar().X)({environment:n,collectionContextStore:o,action:"group_by_number_update",original_view_type:void 0,property_type:c.type})},collectionContextStore:o}):null}const Ku=n.memo((function(e){const{collectionContextStore:t,collectionSettingsStore:i,groupByKey:l,groupsFormatKey:a}=e,c=(0,r().v3)(),d=(0,s().K8)((()=>(0,yl().S)(i)),[i]),u=(0,s().K8)((()=>t.collectionViewBlockStore()),[t]),p=(0,s().K8)((()=>t.collectionViewStore()),[t]),g=(0,s().K8)((()=>null==p?void 0:p.getType()),[p]),y=(0,s().K8)((()=>{var e;return null===(e=(0,Pu().H2)(t.normalizedFormatStore.state,l,a))||void 0===e?void 0:e.property}),[t,l,a]),f=(0,s().O$)(t.normalizedSchemaStore),h=(0,s().O$)(t.normalizedFormatStore),v=(0,s().K8)((()=>void 0!==g&&(0,o(934201).Qt)({viewType:g,groupByKey:l})),[l,g]),x=(0,n.useCallback)((()=>Object.entries(f).sort(Nu).map((e=>e[0])).filter((e=>{const t=f[e];return t&&(0,Pu().Eg)(t)}))),[f]),b=(0,n.useCallback)((e=>{const o=t.collectionViewStore();if(o){if(e){const n=f[e];if(!n||!(0,Pu().Eg)(n))return;const i=(0,Pu().V0)({property:e,propertySchema:n,isCollectionTypedView:"collectionTypedView"===t.contextType});S().createAndCommit({userAction:"CollectionSettingsViewGroupByProperty.handlePropertyAccept",environment:c,canUndo:!0,perform:e=>{m().zA({stores:[o],update:{[l]:i,[a]:void 0},transaction:e})}}),(0,ar().X)({environment:c,collectionContextStore:t,action:"group_by_property_accept",original_view_type:void 0,property_type:n.type})}else S().createAndCommit({userAction:"CollectionSettingsViewGroupByProperty.handlePropertyAccept",environment:c,canUndo:!0,perform:e=>{m().zA({stores:[o],update:{[l]:void 0,[a]:void 0},transaction:e})}}),(0,ar().X)({environment:c,collectionContextStore:t,action:"group_by_property_accept"});D().R8({collectionSettingsStore:i,item:{type:"main"}}),D().a2({collectionSettingsStore:i,item:{type:"group",groupByKey:l,groupsFormatKey:a}})}}),[t,i,l,a,f,c]),w=(0,n.useMemo)((()=>d&&"groupByProperty"===d.type&&g?(0,Tu().rq)(d.groupByKey,g):null),[d,g]);return u&&p&&d&&g&&"groupByProperty"===d.type?(0,L.jsx)(C().Ay,{...e,collectionSettingsStore:i,title:w,children:(0,L.jsx)(E().A,{schema:f,format:h,currentProperty:y,showNoneOption:v,getProperties:x,onAccept:b})}):null}));function Nu(e,t){var o,n;const i=null==e||null===(o=e[1])||void 0===o?void 0:o.name,r=null==t||null===(n=t[1])||void 0===n?void 0:n.name;return void 0!==i&&void 0!==r?i.localeCompare(r,void 0,{sensitivity:"base"}):void 0!==i?1:void 0!==r?-1:0}var Lu=()=>o(149864);function zu(e){const t=(0,s().K8)((()=>{const t=e.collectionContextStore.collectionViewStore();return"chart"===(null==t?void 0:t.getType())}),[e.collectionContextStore]),o=(0,Kc().a)();return(0,L.jsx)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Layout",id:"database.viewSettings.layoutTab.title"}),desktopWidth:o?280:290,children:(0,L.jsx)(Lu().A,{...e,showDoneButton:t,menuType:"editViewLayout",analytics:void 0})})}var Uu=()=>o(212441);function Wu(e){return(0,L.jsx)(cu,{...e,viewType:"filterAndSort"})}var Hu=()=>o(174638),Gu=()=>o(955363),$u=()=>o(378518),Qu=()=>o(259464);const Yu=110,qu=210,Ju=223,Xu=25,Zu=87;function ep(e){const{propertyName:t}=e,o=(0,v().DP)(),n=(0,v().IS)((e=>({dependenciesPreviewOutsideBorder:{margin:"0px 12px",border:`1px solid ${e.regularDividerColor}`,borderRadius:6,alignItems:"center",position:"relative",height:112,paddingInlineStart:19},svgContainer:{position:"absolute",width:"100%",height:"100%"},svgArrowTheme:{stroke:e.collectionValidDependencyArrow,strokeWidth:$u().cC},dependencyPropertyNamePreview:{fontSize:12,position:"absolute",background:e.background.elevated,top:48,insetInlineStart:96},timelineItemPreview:{padding:4,margin:"0px 12px",display:"flex",fontSize:14,alignItems:"center",borderRadius:5,background:e.cardBackground,boxShadow:e.buttonBoxShadow,width:100,justifyContent:"center"}})),[]);return(0,L.jsx)(A().A,{children:(0,L.jsxs)("div",{style:n.dependenciesPreviewOutsideBorder,children:[(0,L.jsxs)("svg",{style:n.svgContainer,children:[(0,L.jsx)(Qu().A,{startPoint:{x:Yu,y:Xu},endPoint:{x:Yu,y:Zu},style:n.svgArrowTheme,showArrowHead:!0}),(0,L.jsx)(Qu().A,{startPoint:{x:qu,y:Zu},endPoint:{x:Ju,y:Zu},style:n.svgArrowTheme,showArrowHead:!1}),(0,L.jsx)("circle",{cx:Ju,cy:Zu,r:$u().w7,style:n.svgArrowTheme,fill:o.white})]}),(0,L.jsx)("div",{style:n.dependencyPropertyNamePreview,children:t}),(0,L.jsx)("div",{style:{...n.timelineItemPreview,marginTop:10,marginInlineStart:10},children:(0,L.jsx)("span",{children:"🌱"})}),(0,L.jsx)("div",{style:{...n.timelineItemPreview,marginTop:34,marginInlineStart:111},children:(0,L.jsx)("span",{children:"🌳"})})]})})}const tp=(0,x().YK)({subitemInputPlaceholder:{defaultMessage:"Sub-tasks…",id:"database.viewSettings.relationsPropertyTab.subitemInputPlaceholder"},timelineArrowsByInputPlaceholder:{defaultMessage:"Dependencies…",id:"database.viewSettings.relationsPropertyTab.timelineArrowsByInputPlaceholder"}});const op=function(e,t){const{collectionContextStore:i,collectionSettingsStore:l,formatSetting:a}=e,c=(0,r().Y0)(),d=(0,x().tz)(),u=(0,r().v3)(),p="collection_page_properties",[g]=(0,n.useState)("no_limit"),y="subitem"===a,f="timeline_arrows_by"===a,h=(0,s().K8)((()=>i.databaseType),[i]),b=(0,s().O$)(i.normalizedSchemaStore),w=(0,s().K8)((()=>i.collectionStore()),[i]),j=(0,s().K8)((()=>(null==w?void 0:w.getFormat())??{}),[w]),_=(0,s().K8)((()=>i.collectionViewStore()),[i]),I=(0,s().K8)((()=>{var e;return(null==_||null===(e=_.getFormat())||void 0===e?void 0:e.subitem_display_mode)??"show"}),[_]),k=(0,s().K8)((()=>{var e;return y?null===(e=i.currentSubitemFormatStoreForCollectionStore.state)||void 0===e?void 0:e.property:f?i.currentArrowsByFormatStore.state:void 0}),[i,y,f]),M=(0,s().K8)((()=>{var e,t;return y?null===(e=i.collectionStore())||void 0===e||null===(e=e.getFormat())||void 0===e?void 0:e.subitem_property:f?null===(t=i.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.collection_default_arrows_by:void 0}),[i,y,f]),T=(0,s().O$)(i.permissionScopesStore),P=(0,s().K8)((()=>pr().uu(i,b).length),[i,b]),B=(0,s().O$)(i.normalizedSchemaStore),V=(0,s().K8)((()=>{var e;const t=i.currentSubitemFormatStoreForCollectionStore.state,o=i.currentArrowsByFormatStore.state;let n;return y?n=t?b[t.property]:void 0:f&&(n=o?b[o]:void 0),null===(e=n)||void 0===e?void 0:e.name}),[i,b,y,f]),N=(0,s().K8)((()=>{const e=i.collectionStore();return null!=e&&e.isDefined()?pr().$H(d,{targetCollectionStore:e,isSelfRelation:!0,sourceSchema:B,createUnique:!0,from:a}):d.formatMessage({id:"database.viewSettings.relationsPropertyTab.initialPropertyName.placeholder",defaultMessage:"Related to target"})}),[i,B,d,a]),[z,U]=(0,n.useState)(V||N),W=(0,s().K8)((()=>{const e=i.currentSubitemFormatStoreForCollectionStore.state,t=i.currentArrowsByFormatStore.state;let o;if(y?o=e?b[e.property]:void 0:f&&(o=t?b[t]:void 0),o&&"relation"===o.type){var n;const e=o.property;return e?null===(n=b[e])||void 0===n?void 0:n.name:void 0}}),[i,b,y,f]),H=(0,s().K8)((()=>{const e=i.collectionStore();return null!=e&&e.isDefined()?pr().zF(d,{sourceCollection:e.getModel(),isSelfRelation:!0,targetCollectionStore:e,createUnique:!0,from:a}):d.formatMessage({id:"database.viewSettings.relationsPropertyTab.inverseName.placeholder",defaultMessage:"Related to this database"})}),[i,d,a]),$=(0,s().K8)((()=>"title"===i.normalizedFormatStore.state.table_subitem_toggle_column),[i]),[Q,Y]=(0,n.useState)({hasInverseRelation:!0,inverseName:W,autoRelate:{enabled:!1}}),[q,X]=(0,n.useState)(0===P),Z=(0,s().uB)(void 0,J().A),ee=(0,s().O$)(Z).open,te=(0,n.useCallback)((()=>pr().uu(i,b)),[i,b]),oe=(0,n.useCallback)((e=>{if(e){const t=b[e];if(t&&"relation"===t.type){const e=t.property;if(e){const t=b[e];if(t&&Q){const e=t.name;Y({hasInverseRelation:null==Q?void 0:Q.hasInverseRelation,inverseName:e,autoRelate:null==Q?void 0:Q.autoRelate})}}U(t.name)}}}),[b,Q,U]),ne=(0,n.useCallback)((e=>{const{collectionViewStore:t,newProperty:o,transaction:n}=e;y?(0,Do().b0)(t.getFormat().table_subitem_toggle_column)&&m().zA({stores:[t],update:{table_subitem_toggle_column:"title"},transaction:n}):f&&vd().Tq({collectionViewStore:t,newProperty:o,transaction:n})}),[y,f]),ie=(0,n.useCallback)((e=>{const{relationPropertyId:t,transaction:o}=e;y&&tr().zt({environment:u,collectionContextStore:i,relationPropertyId:t,transaction:o}),f&&vd().L_({collectionContextStore:i,relationPropertyId:t,transaction:o})}),[y,f,u,i]),re=(0,n.useCallback)((e=>{const t=i.collectionViewStore();t&&(S().createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handleDefaultPropertySelect",environment:u,canUndo:!0,perform:o=>{ne({collectionViewStore:t,newProperty:e,transaction:o}),ie({relationPropertyId:e,transaction:o})}}),oe(e),X(!1),D().os({collectionSettingsStore:l}),(0,ar().X)({action:y?"update_default_subitem":"update_default_timeline_arrows_by",original_view_type:void 0,property_type:e?"relation":void 0,environment:u,collectionContextStore:i}))}),[i,u,X,oe,l,y,ne,ie]),le=(0,n.useCallback)((e=>{const t=i.collectionViewStore();t&&(S().createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handlePropertySelect",environment:u,canUndo:!0,perform:o=>{ne({collectionViewStore:t,newProperty:e,transaction:o})}}),oe(e),X(!1),D().os({collectionSettingsStore:l}),(0,ar().X)({action:y?"update_subitem":"update_timeline_arrows_by",original_view_type:void 0,property_type:e?"relation":void 0,environment:u,collectionContextStore:i}))}),[i,u,oe,l,y,ne]),se=(0,n.useCallback)((()=>{qi().default.afterNextFlush((()=>{X(!0),Y({hasInverseRelation:!0,inverseName:H,autoRelate:{enabled:!1}}),U(N)}))}),[H,N]),ae=(0,n.useCallback)((()=>{if(!Q)return;const{hasInverseRelation:e,inverseName:t,autoRelate:o}=Q,n=i.collectionStore(),r=n,s=i.collectionViewStore();if(!n||!r)return;const{performResult:c}=S().createAndCommit({userAction:"CollectionSettingsSetupRelation.handleAddRelation",environment:u,canUndo:!0,perform:l=>{const c=(0,fd().createProperty)({environment:u,collectionStore:n,collectionViewArgs:s&&p?{collectionViewStore:s,format:s.getFormat(),formatKey:p}:void 0,propertyType:"relation",transaction:l});return hd().cT({environment:u,collectionContextStore:i,collectionStore:n,property:c,propertyName:z,targetCollectionStore:r,hasInverseRelation:e,inverseName:t,autoRelate:o,propertyLimit:g,intl:d,transaction:l,from:a}),s&&(ne({collectionViewStore:s,newProperty:c,transaction:l}),ie({relationPropertyId:c,transaction:l})),c}});D().yl({collectionSettingsStore:l}),D().a2({collectionSettingsStore:l,item:{type:"main"}}),(0,yd().Z)({environment:u,collectionContextStore:i,from:a,property_type:"relation",property_id:c})}),[i,u,l,p,d,g,z,Q,a,ne,ie]),ce=(0,n.useCallback)((()=>{const e=i.collectionViewStore();e&&(sl().jP({environment:u,collectionViewStore:e,currentValue:i.normalizedFormatStore.state.table_subitem_toggle_column}),(0,ar().X)({environment:u,collectionContextStore:i,action:"toggle_table_subitem_toggle_on_title"}))}),[i,u]),de=!T.canConfigureBlock,ue=(0,v().IS)((e=>({emptyStateText:{color:e.text.secondary,fontSize:14,margin:"0px 12px"},useExistingTitle:{fontSize:12,color:e.text.secondary,marginInlineStart:12,marginTop:12},existingRelationButton:{marginTop:6,marginInlineEnd:12,marginBottom:6,marginInlineStart:12,width:"auto"}})),[]);if(!w)return null;const pe=y&&T.canConfigureBlock&&V,ge=T.canConfigureCollection,me=(e,t,n,r)=>(0,L.jsx)(o(148079).A,{version:"v1",menuProps:e,property:t,defaultProperty:M,isChecked:n,propertySchema:r,collectionContextStore:i,handleDefaultPropertySelect:re,handlePropertySelect:le});return(0,L.jsxs)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{...(0,ir().mv)({feature:a,databaseType:h})}),footer:(0,L.jsxs)(A().A,{topBorder:P>0&&!q,children:[pe&&!q?(0,L.jsx)(al().d,{showImage:!de,caption:oo().A.formatMessage(ir().Ic.toggleNestingOnTitleMenuItemTooltip),tooltipImage:Zt().A.images.tooltips.collectionSettings.subitemsToggleOnTitlePng,tooltipImageScale:.3,render:e=>(0,L.jsx)(Dc().A,{...e,icon:e=>(0,ll().U)({width:F().Ev.sm,height:F().Ev.sm,marginInlineStart:4,marginInlineEnd:2}),title:(0,L.jsx)(x().sA,{defaultMessage:"Show nesting toggle on title",id:"database.viewSettings.layoutTab.tableSubitemToggleOnTitle"}),switcherProps:{disallowTabbing:!0,on:$},disabled:de,onClick:ce,isGray:!0})}):void 0,ge&&P>0&&!q?(0,L.jsx)(so().A,{icon:fl().W,title:(0,L.jsx)(x().sA,{id:"database.viewSettings.subitemTab.newRelation",defaultMessage:"Create new relation"}),isGray:!0,onClick:se}):void 0,q?void 0:(0,L.jsx)(L.Fragment,{children:T.canConfigureBlock&&!T.canConfigureCollection?(0,L.jsx)(so().A,{title:(0,L.jsx)(x().sA,{id:"database.viewSettings.relationsPropertyTab.removeSubitemRelation.removeSubitemButton.title",defaultMessage:"Turn off for this view"}),isRed:!0,onClick:()=>le(void 0)}):T.canConfigureBlock&&(0,L.jsx)(R().A,{popupType:c.isPhone?ri().nl.SlideUp:ri().nl.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",originGap:0,renderOrigin:e=>(0,L.jsx)(L.Fragment,{children:T.canConfigureBlock&&k?(0,L.jsx)(so().A,{isGray:!0,icon:G().trashIcon,title:(0,L.jsx)(x().sA,{...(0,ir().Pf)({feature:a,databaseType:h})}),isRed:!0,...e}):void 0}),render:e=>{let t;return t=c.isPhone?{menuType:K().gu.ActionSheet}:{menuType:K().gu.Popup,width:300},(0,L.jsx)(O().A,{...t,footer:(0,L.jsxs)(A().A,{topBorder:!0,children:[T.canConfigureBlock?(0,L.jsx)(so().A,{title:(0,L.jsx)(x().sA,{id:"database.viewSettings.relationsPropertyTab.removeRelation.removeRelationButton.title",defaultMessage:"Turn off for this view"}),isRed:!0,onClick:()=>le(void 0)}):void 0,T.canConfigureCollection?(0,L.jsx)(so().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"Turn off for all new views",id:"database.viewSettings.relationsPropertyTab.removeRelation.removeAllDefaultButton.title"}),isRed:!0,onClick:()=>{re(void 0)}}):void 0]})})}})})]}),children:[y?(0,L.jsx)(br,{propertyName:z||N,inversePropertyName:(null==Q?void 0:Q.inverseName)||H,subitemsDisplayMode:I}):void 0,f?(0,L.jsx)(ep,{propertyName:z||N}):void 0,q?void 0:(0,L.jsx)("div",{style:ue.useExistingTitle,children:(0,L.jsx)(x().sA,{defaultMessage:"Use an existing relation",id:"database.viewSettings.relationsPropertyTab.useExistingRelation.title"})}),P>0&&!q?(0,L.jsx)("div",{style:{paddingBottom:"6px"},children:(0,L.jsx)(A().A,{children:(0,L.jsx)(R().A,{buttonPopupStore:Z,render:e=>{let t;return t=c.isPhone?{menuType:K().gu.ActionSheet}:{menuType:K().gu.Popup,width:300},(0,L.jsx)(O().A,{...t,footer:(0,L.jsx)(E().A,{schema:b,format:j,getProperties:te,onAccept:T.canConfigureBlock&&!T.canConfigureCollection?le:Do().lQ,inputPlaceholder:oo().A.formatMessage(y?tp.subitemInputPlaceholder:tp.timelineArrowsByInputPlaceholder),currentProperty:k,defaultShowPropertyCount:5,renderProperty:T.canConfigureBlock&&!T.canConfigureCollection?void 0:me})})},renderOrigin:e=>{var t;return(0,L.jsx)(so().A,{title:(0,L.jsx)(x().sA,{id:"database.viewSettings.relationsPropertyTab.existingRelation",defaultMessage:"Property"}),showChevron:!0,right:k?null===(t=b[k])||void 0===t?void 0:t.name:void 0,rotateChevron:ee,disabled:!1,icon:Gu().arrowDiagonalUpRightIcon,...e})},popupType:c.isPhone?ri().nl.SlideUp:ri().nl.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",originGap:0})})}):ge&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(A().A,{children:(0,L.jsx)("div",{style:ue.emptyStateText,children:(0,L.jsx)(x().sA,{defaultMessage:"Rename (optional)",id:"database.viewSettings.relationsPropertyTab.emptyStateDescription"})})}),(0,L.jsx)(A().A,{children:(0,L.jsx)(pt().Ay,{value:z,placeholder:z,onChange:e=>U(e.target.value),onBlur:Do().lQ,onSubmit:Do().lQ,focusInitial:!0,selectAll:!1})}),(0,L.jsx)(Cd().Ay,{collectionContextStore:i,targetCollectionStore:w,property:void 0,temporaryInverseState:Q,setTemporaryInverseState:Y,onSubmit:ae}),P>0?(0,L.jsx)("div",{style:{margin:"auto",textAlign:"center"},children:(0,L.jsx)(he().p,{onClick:()=>{qi().default.afterNextFlush((()=>{X(!1)}))},colorPalette:"gray",style:ue.existingRelationButton,children:(0,L.jsx)(x().sA,{id:"database.viewSettings.relationsPropertyTab.newRelation",defaultMessage:"Use existing relation"})})}):void 0]})]})};var np=()=>o(301524);function ip({context:e,collectionContextStore:t,collectionSettingsStore:o,fullHeight:n,hideDesktopHeader:i}){const l=(0,r().v3)(),[a,c,d,u,p,g]=(0,s().K8)((()=>[t.collectionViewStore(),(0,eu().gv)(t),t.normalizedSchemaStore.state,t.normalizedFormatStore.state,t.permissionScopesStore.state,rp(t)]),[t]),m=(e===bo().Bd.ViewSettings||e===bo().Bd.MobileSheet)&&c;return a?(0,L.jsx)(C().Ay,{collectionSettingsStore:o,fullHeight:n,hideDesktopHeader:i,title:(0,L.jsx)(x().sA,{defaultMessage:"Sort",id:"database.viewSettings.sortTab.title"}),footer:m&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{style:{paddingTop:24}}),(0,L.jsx)(A().A,{topBorder:!0,children:(0,L.jsx)(lp,{collectionContextStore:t})})]}),unconstrainedWidth:!0,children:(0,L.jsx)(np().A,{collectionContextStore:t,schema:d,format:u,sorts:g,disabled:!p.canConfigureBlock,parentStore:a,onChange:e=>function(e,t,o){!function(e,t,o){const n=t.collectionViewStore();if(!n)return;Kd().IU({environment:o,collectionContextStore:t,temporaryState:{...t.temporaryStateStore.state,sorts:{value:e}}})}(e,o,t)}(e,l,t),showDeleteAll:!0,onDeleteAll:()=>function(e,t){t===bo().Bd.FilterBar&&D().os({collectionSettingsStore:e})}(o,e)})}):null}function rp(e){return e.currentSortsStore.state}function lp({collectionContextStore:e}){return(0,L.jsx)(tu()._Q,{context:"SettingsSort",collectionContextStore:e})}var sp=()=>o(338907),ap=()=>o(922952);function cp(e){const t=e.getParentStore();if(t&&(0,ap().u)(t))return t}var dp=()=>o(663247),up=()=>o(736982),pp=()=>o(231314),gp=()=>o(902842),mp=()=>o(3486);const Sp=14,yp=32;function fp(e){const{collectionTemplate:t,theme:o,iconStyle:n,captionStyle:i,onAcceptCollectionTemplate:r,parentStore:l,collectionTemplateParentStore:s,hideIconBackground:a,nameOverride:c,hideCaption:d,aiPrompt:u,origin:p,dataSourceAnalytics:g}=e,{templateId:m,description:S}=t,{name:y}=t.value.targetCollection,f=(0,mp().P)(t.value.targetCollection.icon),h=(0,L.jsx)(gp().z,{template:t,size:Sp,iconStyle:n});return{key:m,render:e=>(0,L.jsx)(Yi().wT,{placement:"left",collectionTemplate:t,render:t=>(0,L.jsx)(up().I,{buttonMenuItemProps:{...(0,ao().A)(e,t),alignIconTop:!0},title:c??y,caption:d?void 0:(0,L.jsx)("div",{style:i,children:S}),icon:(0,L.jsx)(pp().y,{backgroundSize:yp,icon:h,backgroundColor:a?"#00000000":o[f].background.secondary})})}),action:()=>{r({template:t,collectionViewBlockStore:l,collectionViewBlockParentStore:s,flowId:void 0,aiPrompt:u,origin:p,dataSourceAnalytics:g})}}}function hp({collectionStore:e,collectionSettingsStore:t,createdCollectionRecordPointerMap:o,analytics:n}){return{key:"more_settings",render:e=>(0,L.jsx)(A().A,{topBorder:!0,...e}),items:[{key:"link_database",render:e=>(0,L.jsx)(vp,{buttonMenuItemProps:e}),action:()=>{D().dP({collectionSettingsStore:t,item:{type:"createViewSource",existingCollectionStore:e,createdCollectionRecordPointerMap:o,analytics:n}}),D().a2({collectionSettingsStore:t,item:{type:"linkToDatabase",existingCollectionStore:e,analytics:n}})}}]}}function vp({buttonMenuItemProps:e}){const t=(0,v().IS)((e=>({iconWrapper:{width:yp},linkDatabaseIcon:{fill:e.text.secondary,height:16,width:16,margin:"auto"}})),[]);return(0,L.jsx)(up().I,{buttonMenuItemProps:e,title:(0,L.jsx)(x().sA,{id:"createViewSourceMenuBody.linkDataSource",defaultMessage:"Link to existing data source"}),icon:(0,L.jsx)("div",{style:t.iconWrapper,children:(0,dp().arrowDiagonalUpRightFillIcon)(t.linkDatabaseIcon)})})}function xp({input:e,setInput:t,placeholderText:o}){const{isMobile:i}=(0,r().Y0)(),l=(0,s().uB)(void 0,Ql().A);return(0,n.useMemo)((()=>({key:"input",render:e=>(0,L.jsx)(A().A,{shouldShowBottomDivider:!1,...e}),items:[{key:"input",action:()=>{},render:n=>(0,L.jsx)(pt().Ay,{...n,value:e,onChange:e=>{t(e.target.value),l.setState({focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})},focusInitial:!i,autoFocus:!i,placeholder:o,showClearButton:!0})}]})),[e,l,o,t,i])}var bp=()=>o(536095),Cp=()=>o(727722),wp=()=>o(160475),jp=()=>o(913454),Ap=()=>o(820579);function _p(e){const{buttonMenuItemProps:t,isLinkedView:o}=e,n=(0,r().v3)(),i=(0,v().IS)((e=>({importIcon:{width:20,height:33,margin:"auto"},iconWrapper:{width:o?24:yp}})),[o]);return(0,ia().w)((()=>{(0,wp().t)({environment:n,action:"view",from:"database_create_empty_state"})})),(0,L.jsx)(up().I,{buttonMenuItemProps:t,title:(0,L.jsx)(x().sA,{id:"createViewSourceMenuBody.importButton",defaultMessage:"Import CSV"}),icon:(0,L.jsx)("div",{style:i.iconWrapper,children:(0,Ap().arrowLineDownIcon)(i.importIcon)})})}const Ip=(0,x().YK)({setupWithAI:{defaultMessage:"Build with AI",id:"database.viewSettings.searchCollections.setupWithAI"}});function kp(e){const{newButtonMenuItem:t,collectionTemplateParentStore:o,onAcceptCollectionTemplate:n,parentStore:i,showTopBorder:l,hideCaption:a,searchInput:c,settingsSupportsSuggestedTemplates:d,origin:u,isLinkedView:g,dataSourceAnalytics:m}=e,S=(0,x().tz)(),y=(0,r().v3)(),f=(0,v().DP)(),h=(0,dr().ET)(),[b,C]=(0,s().K8)((()=>[h.collectionViewBlockStore(),h.getIsInDashboardBuildMode()]),[h]),w=(0,v().IS)((()=>({icon:{width:20,height:20,...e.iconStyle},caption:e.captionStyle??{},tableWrapperStyle:e.sectionMenuItemStyle??{}})),[e.iconStyle,e.captionStyle,e.sectionMenuItemStyle]);return(0,s().K8)((()=>{if(!t||C)return;const e=[t];if((0,jp().getIsSetupGeneratorEnabled)()&&o&&d&&Ds().A.state.online){const t=jp().globalWorkflowTemplates.fromIdOfType({type:"collection",templateId:bp().MH});e.push(fp({collectionTemplate:t,theme:f,iconStyle:w.icon,captionStyle:w.caption,onAcceptCollectionTemplate:n,parentStore:i,collectionTemplateParentStore:o,nameOverride:S.formatMessage(Ip.setupWithAI),hideIconBackground:!0,hideCaption:a,aiPrompt:(0,ci().x9d)(c),origin:u,dataSourceAnalytics:m}))}if(p().default.checkGate({gateName:"contextualized_import_entrypoints"})&&!g){const t={key:"import_button",render:e=>(0,L.jsx)(_p,{buttonMenuItemProps:e,isLinkedView:g}),action:()=>{(0,wp().t)({environment:y,action:"click",from:"database_create_empty_state"}),b&&(0,Cp().T)({environment:y,store:b,analytics:{from:"database_create_empty_state",...m}})}};e.push(t)}return{key:"newButton",render:e=>(0,L.jsx)(A().A,{...e,topBorder:l,style:w.tableWrapperStyle}),items:e}}),[t,o,d,f,w.icon,w.caption,w.tableWrapperStyle,n,i,S,a,c,l,u,g,b,y,m,C])}var Mp=()=>o(343666),Tp=()=>o(115512),Pp=()=>o(839754);function Bp({icon:e,style:t}){return e({...(0,v().IS)((e=>({icon:{fill:e.icon.primary,width:18,height:18}})),[]).icon,...t})}function Fp({buttonMenuItemProps:e,iconStyle:t,hideButton:o,menuItemStyle:n}){const i=(0,v().IS)((e=>({buttonMenuItem:{display:o?"none":"flex",...n},icon:{fill:e.icon.secondary,...t}})),[o,n,t]);return(0,L.jsx)(Q().A,{style:i.buttonMenuItem,...e,title:(0,L.jsx)(T().D,{styleKey:"Body/Regular",colorVariant:"secondary",children:(0,L.jsx)(x().sA,{id:"addWorkflowTemplateMenu.moreTemplates",defaultMessage:"More templates"})}),icon:(0,L.jsx)(Bp,{icon:os()._,style:i.icon})})}var Vp=()=>o(575154);var Dp=()=>o(349379),Ep=()=>o(317053),Rp=()=>o(466934);const Op=(0,x().YK)({suggested:{defaultMessage:"Suggested",id:"database.viewSettings.createViewTab.suggested"}});function Kp(e){const{input:t,parentStore:o,onAcceptCollectionTemplate:i,collectionContextStore:l,settingsSupportsSuggestedTemplates:a,origin:c,dataSourceAnalytics:u}=e,p=(0,r().v3)(),g=(0,v().DP)(),[m]=(0,n.useState)((0,d().Ay)()),S=(0,v().IS)((()=>({icon:{marginInlineStart:6,marginInlineEnd:6},moreIcon:{width:Sp,height:Sp,margin:(yp-Sp)/2},caption:{fontSize:(0,Tp().ny)(p,"UIRegular"),whiteSpace:"normal"}})),[p]),y=(0,s().K8)((()=>cp(o)),[o]),h=(0,Vp().q)({parentStore:y}),x=(0,Ze().Ay)(t,h,(e=>e.value.targetCollection.name)),b=x.slice(0,jp().TRUNCATE_COLLECTION_TEMPLATE_ITEMS_AT),C=b.length<x.length,w=(0,n.useMemo)((()=>y?b.map(((e,t)=>fp({collectionTemplate:e,theme:g,iconStyle:S.icon,captionStyle:S.caption,hideCaption:!0,onAcceptCollectionTemplate:o=>{i(o),(0,Dp().os)({environment:p,eventProperties:{from_modal_template_picker:!1,selected_index:t,collection_template_ids_shown:b.map((e=>e.templateId)),...(0,Rp().gM)({origin:c,parentStore:y,collectionTemplate:e,flowId:m,dataSourceAnalytics:u,collectionTemplatesSearchQuery:void 0})}})},parentStore:o,collectionTemplateParentStore:y,aiPrompt:void 0,origin:c,dataSourceAnalytics:u}))):[]),[y,i,o,g,S,b,p,m,c,u]),j=(0,n.useMemo)((()=>{const e={key:"see_more_workflow_templates",render:e=>(0,L.jsx)(Fp,{buttonMenuItemProps:e,iconStyle:S.moreIcon,menuItemStyle:(0,up().h)({environment:p})}),action:()=>function({environment:e,parentStore:t,collectionContextStore:o,origin:n,flowId:i,dataSourceAnalytics:r}){const l=t.getParentStore(),s=o.collectionViewBlockStore();if(!l||!s||l.table===Mp().SN||!(0,ap().u)(l))return;const a={collectionStore:o.collectionStore(),collectionViewStore:o.collectionViewStore(),collectionViewBlockStore:s};(0,Ep().openTemplateOnboardingModal)({parentStore:l,template:void 0,version:(0,Ep().getTemplateOnboardingVersion)({template:void 0}),origin:n,existingCollectionInfo:a,navigateToOnFinish:"skip",flowId:i,dataSourceAnalytics:r,onClose:t=>(0,Pp().ZM)({environment:e,userAction:"CreateViewSourceMenuBodyNew.handleClickMoreButton",result:t,existingCollectionViewBlockStore:s,existingCollectionStore:a.collectionStore})})}({parentStore:o,collectionContextStore:l,environment:p,origin:c,flowId:m,dataSourceAnalytics:u})};return{key:"suggestedCollectionTemplates",items:[...w,...C?[e]:[]],render:e=>(0,L.jsx)(A().A,{title:oo().A.formatMessage(Op.suggested),...e})}}),[w,C,S.moreIcon,p,o,l,c,m,u]);if(function({collectionTemplateIds:e,origin:t,flowId:o,blockId:i}){const l=(0,r().v3)(),s=(0,n.useRef)(!1);(0,n.useEffect)((()=>{s.current||((0,f().u)({environment:l,event:{eventName:"suggested_collection_templates_shown",eventProperties:{origin:t,collection_template_ids_shown:e,block_id:i,flow_id:o}}}),s.current=!0)}))}({collectionTemplateIds:b.map((e=>e.templateId)),origin:c,blockId:o.id,flowId:m}),a)return 0===w.length?void 0:j}function Np({environment:e,collectionContextStore:t,template:o,collectionViewBlockStore:n,collectionViewBlockParentStore:i,flowId:r,aiPrompt:l,origin:s,dataSourceAnalytics:a}){var c;if(null!==(c=o.value.onboarding)&&void 0!==c&&c.isMinimal)return void(0,Ep().createMinimalCollectionTemplateWithoutModal)({environment:e,template:o,parentStore:i,existingCollectionInfo:{collectionViewBlockStore:n,collectionStore:t.collectionStore(),collectionViewStore:t.collectionViewStore()},relationInfos:[]});const d={collectionViewBlockStore:n,collectionStore:t.collectionStore(),collectionViewStore:t.collectionViewStore()};(0,Ep().openSelectedTemplateOnboardingModalForInAppFlows)({environment:e,template:o,parentStore:i,existingCollectionInfo:d,origin:s,dataSourceAnalytics:a,navigateToOnFinish:"skip",flowId:r,aiPrompt:l,onClose:t=>(0,Pp().ZM)({environment:e,userAction:"CreateViewSourceMenuBodyNew.onAcceptCollectionTemplate",result:t,existingCollectionViewBlockStore:n,existingCollectionStore:d.collectionStore})})}const Lp=(0,x().YK)({search:{defaultMessage:"Search...",id:"database.viewSettings.searchCollections.search"}});function zp({collectionContextStore:e,parentStore:t,collectionStore:o,input:i,setInput:l,newButtonMenuItem:a,analytics:c}){const d=(0,r().v3)(),u=(0,s().K8)((()=>(0,sp().u)(d)),[d]),p=i.length>0,g=(0,v().IS)((e=>({sectionMenuItem:{...p&&{position:"sticky",bottom:0,backgroundColor:e.popoverBackground}}})),[p]),m=(0,s().K8)((()=>cp(t)),[t]),S=(0,s().O$)(e.isFullScreenStore)?"collection_settings_add_new_database":"collection_settings_add_new_database_inline",y=(0,n.useCallback)((t=>Np({...t,environment:d,collectionContextStore:e,origin:S})),[d,e,S]),f=Kp({input:i,onAcceptCollectionTemplate:y,parentStore:t,collectionContextStore:e,settingsSupportsSuggestedTemplates:u,origin:S,dataSourceAnalytics:c}),h=kp({newButtonMenuItem:a,collectionTemplateParentStore:m,onAcceptCollectionTemplate:y,parentStore:t,showTopBorder:Boolean(f)&&p,sectionMenuItemStyle:g.sectionMenuItem,hideCaption:!0,searchInput:i,settingsSupportsSuggestedTemplates:u,origin:S,isLinkedView:!1,dataSourceAnalytics:c}),x=xp({input:i,setInput:l,placeholderText:oo().A.formatMessage(Lp.search)}),b=hp({collectionStore:o,collectionSettingsStore:e.settingsStore,createdCollectionRecordPointerMap:void 0,analytics:c}),C=(0,n.useMemo)((()=>(0,Do().oE)(p?[x,f,h]:[u?x:void 0,h,f,b])),[p,x,f,h,u,b]);return(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,initialFocus:void 0,resetFocusOnMouseOut:!0,sections:C})}var Up=()=>o(72645),Wp=()=>o(798880),Hp=()=>o(319975),Gp=()=>o(359454),$p=()=>o(594794),Qp=()=>o(272600);const Yp=(0,x().YK)({newEmptyDataSource:{defaultMessage:"New empty data source",id:"database.viewSettings.createViewTab.newEmptyDataSource"},newDataSourceWithName:{defaultMessage:"New “{name}” data source",id:"database.viewSettings.createViewTab.newDataSourceWithName"}});function qp({phase:e,baseViewType:t,onComplete:o,input:n,originalTitle:i,existingCollectionStore:l,analytics:a}){const c=(0,r().v3)(),d=(0,x().tz)(),u=(0,dr().ET)(),p=u.settingsStore,{collectionViewBlockStore:g,collectionStore:m,collectionViewStore:y}=(0,s().K8)((()=>({collectionViewBlockStore:u.collectionViewBlockStore(),collectionStore:u.collectionStore(),collectionViewStore:u.collectionViewStore()})),[u]),f=(0,v().IS)((e=>({newItemIconStyle:{color:e.icon.secondary,marginTop:2},newItemRightStyle:{alignItems:"top"},newDatabaseIconStyle:{fill:e.text.secondary,height:14,width:14}})),[]);return(0,s().K8)((()=>{var t;if("initialized"!==e&&"initialized_source"!==e)return;const o=null===(t=c.currentUser)||void 0===t?void 0:t.id;if(!o)return;const r=n.length>0?d.formatMessage(Yp.newDataSourceWithName,{name:n}):d.formatMessage(Yp.newEmptyDataSource);return{key:"newButton",render:e=>(0,L.jsx)(up().I,{buttonMenuItemProps:e,title:r,icon:(0,L.jsx)(pp().y,{icon:(0,Up().b)(f.newDatabaseIconStyle),backgroundSize:yp})}),action:()=>{var e;if(!g)throw new Error("collectionViewBlockStore is undefined");const t=!m&&"uninitialized"===u.getCollectionViewBlockSourceState(),r=n.length>0&&!i,s=Boolean(l&&l.id!==(null==m?void 0:m.id));(t||s||r)&&S().createAndCommit({userAction:"CollectionSettingsCreateViewSource.createNewEmptyDataSource",environment:c,canUndo:!0,perform:e=>{if(t){const t=(0,$p().Z1)({environment:c,table:Kl().Vl,spaceId:g.getSpaceId()}),i=Ll().vt({environment:c,table:Kl().Vl,args:{id:t,name:(0,ci().x9d)(n),parent:g.pointer,space_id:g.getSpaceId(),alive:!0,schema:{},createdBy:{table:Wp().oo,id:o}},inMemoryRecordCache:g.inMemoryRecordCache,transaction:e});(0,Qp().p)({collectionViewBlockStore:g,collectionPointer:i.pointer,transaction:e})}else if(s){if(!y)throw new Error("collectionViewStore should be defined");(0,Ta().T)({collectionViewBlockStore:g,collectionViewStore:y,transaction:e}),(0,_a().n)({environment:c,collectionContextStore:u,transaction:e,collectionName:n,analytics:{from:"addNewDatabaseButton",dataSourceFrom:(null==a?void 0:a.dataSourceFrom)??"view_creation",dataSourceSessionId:(null==a?void 0:a.dataSourceSessionId)??""}})}else if(r){const t=null==m?void 0:m.getNameStore();t&&Hp().R9({environment:c,store:t,value:(0,ci().x9d)(n),transaction:e})}}}),D().os({collectionSettingsStore:p}),"collection_view_page"!==(null===(e=u.collectionViewBlockStore())||void 0===e?void 0:e.getType())||0!==n.length||i||qi().default.afterNextFlush((()=>{(0,Gp().P)({environment:c,collectionContextStore:u})})),(0,Ra().trackCreateNewEmptyDataSource)(c,{data_source_from:null==a?void 0:a.dataSourceFrom,data_source_session_id:null==a?void 0:a.dataSourceSessionId,collection_view_block_id:null==g?void 0:g.id,collection_id:null==m?void 0:m.id,owned_collection_count:null==g?void 0:g.getOwnedCollectionStores().length,linked_collection_count:null==g?void 0:g.getLinkedCollectionStores().length})}}}),[c,e,n,f,g,d,a,m,p,u,i,y,l])}function Jp(e){const{collectionSettingsStore:t,collectionContextStore:o,collectionStore:i,analytics:r}=e,l=(0,s().K8)((()=>o.collectionViewBlockStore()),[o]),[a,c]=(0,n.useState)(""),d=qp({phase:"initialized",input:a,originalTitle:void 0,baseViewType:"table",existingCollectionStore:void 0,analytics:r}),u=(0,n.useCallback)((()=>D().os({collectionSettingsStore:t})),[t]),p=(0,s().K8)((()=>null!=l&&l.hasMultipleOwnedOrLinkedCollections()?(0,L.jsx)(x().sA,{defaultMessage:"New data source",id:"database.viewSettings.addNewDatabaseTab.newDataSource"}):(0,L.jsx)(x().sA,{defaultMessage:"New database",id:"database.viewSettings.addNewDatabaseTab.newDatabase"})),[l]);return(0,L.jsx)(C().Ay,{...e,title:p,handleClose:u,children:l?(0,L.jsx)(zp,{collectionContextStore:o,parentStore:l,collectionStore:i,input:a,setInput:c,newButtonMenuItem:d,analytics:r}):void 0})}var Xp=()=>o(654062),Zp=()=>o(943919),eg=()=>o(403905),tg=()=>o(755735),og=()=>o(805025),ng=()=>o(635019);function ig({collectionContextStore:e,showDoneButton:t,collectionSettingsStore:o,onDoneClick:n,menuType:i}){const l=(0,r().v3)(),a=(0,s().K8)((()=>e.collectionViewStore()),[e]),c=(0,v().IS)((()=>({doneButtonSection:{paddingTop:0,marginBottom:og().Qm}})),[]),d=(0,s().K8)((()=>"viewsMain"!==e.viewsModuleContextStore.getViewModuleType()),[e]);return a?(0,L.jsxs)(L.Fragment,{children:[d?(0,L.jsx)(A().A,{topBorder:!1,extraPadding:!0,children:(0,L.jsx)(ng().f,{collectionContextStore:e,collectionSettingsStore:o})}):null,t?(0,L.jsx)(A().A,{extraPadding:!0,disableMobileBorders:!0,style:c.doneButtonSection,children:(0,L.jsx)(M().A,{colorPalette:"blue",style:{display:"flex",margin:`0 ${og().Qm}px`},onClick:()=>{"createView"===i&&(0,ar().X)({environment:l,collectionContextStore:e,action:"click_create_view_done"}),n&&n()},children:(0,L.jsx)(x().sA,{defaultMessage:"Done",id:"pageViewSettings.doneButton"})})}):void 0]}):null}const rg=function(e){const{collectionContextStore:t,collectionSettingsStore:i,analytics:l}=e,a=(0,x().tz)(),c=(0,v().eP)(),d=(0,r().v3)(),u=(0,s().K8)((()=>t.collectionViewStore()),[t]),p=(0,s().K8)((()=>null==u?void 0:u.isDefined()),[u]),[g,m]=(0,n.useState)(""),y=(0,s().K8)((()=>null==u?void 0:u.getFormat().collection_view_icon),[u]),f=(0,s().K8)((()=>null==u?void 0:u.getType()),[u]),b="page"===f,w=(0,Kc().a)(),j=(0,n.useCallback)((()=>{sg(g,d,a,i,t)}),[g,d,a,i,t]);return u&&p?(0,L.jsxs)(C().Ay,{...e,collectionSettingsStore:i,title:b?(0,L.jsx)(x().sA,{defaultMessage:"New page view",id:"database.viewSettings.createPageViewTab.title"}):(0,L.jsx)(x().sA,{defaultMessage:"New view",id:"database.viewSettings.createViewTab.title"}),desktopWidth:w?280:290,children:[(0,L.jsx)(A().A,{isInput:!0,children:(0,L.jsx)(tg().B,{initialValue:g,placeholder:a.formatMessage(o(395859).X.viewNamePlaceholderMessage),focusInitial:!h().A.isMobile||void 0,onBlur:e=>lg(e,d,t,a),onChange:e=>m(e),iconButton:{icon:e=>(0,L.jsx)(Tl().h,{color:"gray",viewIcon:y,viewType:f}),iconStyle:{fill:To().l8[c].gray},enforceIconColor:"gray",onSubmit:e=>function(e,t,o){const n=t.collectionViewStore();if(!n||!n.isDefined())return;S().createAndCommit({userAction:"CollectionSettingsCreateView.handleViewIconSubmit",environment:e,canUndo:!0,perform:e=>{(0,Zp().o)({collectionViewStore:n,icon:o,transaction:e})}}),(0,ar().X)({environment:e,collectionContextStore:t,action:"change_icon",icon:o})}(d,t,e)},onSubmit:e=>sg(e,d,a,i,t)})}),b?(0,L.jsx)(ig,{collectionContextStore:t,collectionSettingsStore:i,showDoneButton:!h().A.isMobile,onDoneClick:j,menuType:"createView"}):(0,L.jsx)(Lu().A,{collectionContextStore:t,collectionSettingsStore:i,showDoneButton:!h().A.isMobile,onDoneClick:j,menuType:"createView",analytics:l})]}):null};function lg(e,t,o,n){const i=o.collectionViewStore();if(!i)return;if(!i.isDefined())return;const r=(0,eg().V)(e,i.getType(),n);i.getName()!==r&&S().createAndCommit({userAction:"CollectionSettingsCreateView.handleViewNameBlur",environment:t,canUndo:!0,perform:e=>{(0,Xp().F)({collectionViewStore:i,update:{name:r},transaction:e})}})}function sg(e,t,o,n,i){lg(e,t,i,o),D().R8({collectionSettingsStore:n,item:{type:"main"}}),(0,ar().X)({environment:t,collectionContextStore:i,action:"rename"})}var ag=()=>o(885110),cg=()=>o(369955),dg=()=>o(564037),ug=()=>o(424599);function pg(e){const{collectionContextStore:t,environment:o,collectionStore:n,collectionSettingsStore:i,createdCollectionStore:r,userAction:l,analytics:s}=e,a=t.collectionViewBlockStore();if(!a)return;const c=t.collectionViewStore();if(!c)return;if(S().createAndCommit({userAction:l,environment:o,canUndo:!0,perform:e=>{var l;Wl({environment:o,collectionContextStore:t,source:{type:"collection",id:n.id,spaceId:n.getSpaceId()},transaction:e}),r&&(0,Da().removeCollectionFromCollectionViewBlock)({collectionViewBlockStore:a,collectionStore:r,transaction:e}),t.isInHomeWidgetStore.state&&D().os({collectionSettingsStore:i});const s=a.getBlockTitleStore(),c=null==a||null===(l=a.getTitleStore())||void 0===l?void 0:l.getValue();s&&c&&Hp().R9({environment:o,store:s,value:c,transaction:e})}}),(0,Ra().trackLinkedExistingDataSource)(o,{collection_view_block_id:a.id,collection_view_id:c.id,collection_id:n.id,data_source_from:null==s?void 0:s.dataSourceFrom,data_source_session_id:null==s?void 0:s.dataSourceSessionId}),(0,dg().getIsWorkflowEditorOpen)(o))return void D().os({collectionSettingsStore:i});const d=t.viewsModuleContextStore.isInLayoutBuilder();(0,ug().M)({environment:o,collectionStore:n,collectionContextStore:t,collectionSettingsStore:i,shouldSkipViewSelection:d})}function gg(e){var t;return Boolean((null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.isInlineCollectionView())&&"uninitialized"===e.getCollectionViewBlockSourceState())}const mg=(0,x().YK)({link:{defaultMessage:"Link...",id:"database.viewSettings.searchCollections.link"},search:{defaultMessage:"Search...",id:"database.viewSettings.searchCollections.search"},addOrLinkDataSource:{defaultMessage:"Add or link data source...",id:"database.viewSettings.searchCollections.addOrLinkDataSource"}}),Sg={type:"noSuggestions"};function yg({collectionContextStore:e,collectionSettingsStore:t,parentStore:o,existingCollectionStore:i,createdCollectionRecordPointerMap:l,input:a,setInput:c,newButtonMenuItem:d,context:u,handleAcceptExistingCollection:p,hideSearchTitle:g,analytics:m}){const S=(0,r().v3)(),y=(0,x().tz)(),h=(0,n.useRef)(0),b=(0,s().K8)((()=>function({environment:e,collectionContextStore:t}){var o;return!!(0,sp().u)(e)&&(!gg(t)&&!Boolean("chart"===(null===(o=t.collectionViewStore())||void 0===o?void 0:o.getType())))}({environment:S,collectionContextStore:e})),[S,e]),C=a.length>0,[w,j]=(0,s().K8)((()=>[gg(e),e.getIsInDashboardBuildMode()]),[e]),A=C||!b,{resultsSection:_,searchSessionId:I,searchSessionFlowNumber:k,hasResults:M}=Ss({input:a,collectionContextStore:e,hideSearchTitle:g,parentStore:o,context:u,handleAcceptExistingCollection:p,searchResultsItemsLimit:3,showLoadMoreResultsButton:C,isSearchSurfacesHookEnabled:!0,suggestionConfig:Sg,peopleBlocksToInclude:"none"}),T=(0,n.useMemo)((()=>{if(A&&M)return _}),[_,A,M]),P=es(e);(0,n.useEffect)((()=>{h.current=k}),[k]),(0,n.useEffect)((()=>((0,f().u)({environment:S,event:{eventName:"source_collection_search_open",eventProperties:{search_session_id:I,using_secondary_search_surfaces_hook:!0,source:"source"}}}),()=>{(0,f().u)({environment:S,event:{eventName:"source_collection_search_close",eventProperties:{search_session_id:I,source:"source",using_secondary_search_surfaces_hook:!0,search_session_flow_number:h.current}}})})),[S,I]);const B=(0,v().IS)((e=>({sectionMenuItem:{...C&&{position:"sticky",bottom:0,backgroundColor:e.popoverBackground}}})),[C]),F=(0,s().K8)((()=>cp(o)),[o]),V=(0,s().O$)(e.isFullScreenStore)?"collection_settings_create_view_source":"collection_settings_create_view_source_inline",D=(0,n.useCallback)((t=>Np({...t,environment:S,collectionContextStore:e,origin:V})),[S,e,V]),E=Kp({input:a,onAcceptCollectionTemplate:D,parentStore:o,collectionContextStore:e,settingsSupportsSuggestedTemplates:b,origin:V,dataSourceAnalytics:void 0}),R=w?void 0:E,O=kp({newButtonMenuItem:d,collectionTemplateParentStore:F,onAcceptCollectionTemplate:D,parentStore:o,showTopBorder:!b&&A&&(Boolean(R)||M),sectionMenuItemStyle:B.sectionMenuItem,hideCaption:!0,searchInput:a,settingsSupportsSuggestedTemplates:b,origin:V,isLinkedView:w,dataSourceAnalytics:void 0}),K=A?void 0:hp({collectionStore:i,collectionSettingsStore:t,createdCollectionRecordPointerMap:l,analytics:m}),N=xp({input:a,setInput:c,placeholderText:(0,s().K8)((()=>void 0===d||j?null!=e&&e.isInHomeWidgetStore.state?y.formatMessage(mg.search):y.formatMessage(mg.link):y.formatMessage(mg.addOrLinkDataSource)),[e,d,y,j])}),z=(0,n.useMemo)((()=>(0,Do().oE)(C?[N,T,R,O,K,P]:[N,O,T,R,K,P])),[C,N,T,R,O,K,P]);return(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,initialFocus:0,resetFocusOnMouseOut:!0,sections:z})}function fg(e){const{collectionSettingsStore:t,collectionContextStore:i,existingCollectionStore:l,analytics:a}=e,c=(0,r().v3)(),d=(0,cg().L)(),u=c.currentUser.id,p=null==d?void 0:d.id,[g,m,y,f]=(0,s().K8)((()=>[i.collectionViewBlockStore(),i.collectionViewStore(),i.collectionStore(),i.getCollectionViewBlockSourceState()]),[i]),[h,v]=(0,n.useState)(void 0),[x,b]=(0,n.useState)(void 0),[[w,j],A]=(0,n.useState)([l,void 0]),_=(0,n.useCallback)((e=>{if(A(e),t.state.open){const[o,n]=e;D().dP({collectionSettingsStore:t,item:{type:"createViewSource",existingCollectionStore:o,createdCollectionRecordPointerMap:n,analytics:a}})}}),[t,a]),[I,k]=(0,n.useState)(""),M=(0,s().K8)((()=>y&&i.hasSingleCollection()),[i,y]),T=(0,Pn().P9)({name:"view_chart",spaceId:p,userId:u,amount:"unknown"}),[P,B]=(0,n.useState)("boot");(0,n.useEffect)((()=>{if("boot"===P&&m){var e,o,n;const l=null==m?void 0:m.id,s=l?null===(e=(0,aa().v)(l))||void 0===e?void 0:e.viewType:void 0,a=s||(null==m?void 0:m.getType());v(s??(null==m?void 0:m.getType()));const d=null===(o=i.collectionViewBlockStore())||void 0===o?void 0:o.getTitleValue();var r;if(null!=d&&null!==(n=d[0])&&void 0!==n&&null!==(n=n[0])&&void 0!==n&&n.length)b(null===(r=i.collectionViewBlockStore())||void 0===r?void 0:r.getTitleValue());"chart"===a&&ag().Z({environment:c,collectionContextStore:i,collectionViewId:l,from:"slash_menu"}).then((e=>{if("success"===(null==e?void 0:e.type)){const o=e.data.can_view_chart;T||o||"singleSource"!==i.getCollectionViewBlockSourceState()||D().os({collectionSettingsStore:t})}})),B("initializing")}}),[T,i,t,m,c,P]);const F=(0,n.useCallback)((async e=>{const t=i.collectionViewStore(),n=i.collectionViewBlockStore();if(!t||!n)return;let r;x?r=x:null!=e&&e.length&&(r=(0,ci().x9d)(e)),await async function(e){const{environment:t,collectionName:n,collectionContextStore:i,collectionViewBlockStore:r,collectionViewStore:l,baseViewType:s,createdCollectionRecordPointerMap:a,setCreatedCollection:c}=e,d=l,u=r;(0,ar().X)({environment:t,collectionContextStore:i,action:"select_new_collection"}),"chart"===s&&i.isCreatingNewChartCollectionStore.setState(!0);const{addCollectionViewSourceToNewCollection:p}=await o.e(12071).then(o.bind(o,711996));S().createAndCommit({userAction:"CollectionSettingsCreateViewSourceNew.handleCreateDB",environment:t,canUndo:!0,perform:e=>{var o;Ll().zv({store:d,data:{name:s?sa().to[s]:void 0,query2:void 0,type:s??"table",..."chart"!==s&&{format:void 0}},transaction:e});const{createdCollectionId:r,recordPointerMap:l}=p({environment:t,collectionViewStore:d,collectionViewBlockStore:u,name:n,transaction:e,targetCollectionRecordPointerMap:a})??{},g=null===(o=u.getCollectionStores())||void 0===o?void 0:o.find((e=>e.id===r));i.setContext({type:"collectionView",collectionViewBlockStore:u,collectionStore:g,collectionViewStore:d,pageVisitSourceOverride:void 0}),c([g,l])}})}({environment:c,baseViewType:h,collectionName:r,collectionContextStore:i,collectionViewBlockStore:n,collectionViewStore:t,createdCollectionRecordPointerMap:j,setCreatedCollection:_})}),[i,x,c,h,j,_]);(0,n.useEffect)((()=>{if("initializing"===P){if(l)return _([l,j]),void B("initialized");"singleSource"===f?B("initialized_source"):"linked"===f||i.isEditableHomeCollectionStore.state?B("initialized_linked"):(F(),B("initialized"))}}),[h,i,g,F,l,j,M,P,f,_]);const V=qp({phase:P,baseViewType:h,onComplete:F,input:I,originalTitle:x,existingCollectionStore:w}),E=(0,s().K8)((()=>t.state.hideSettingsHeader),[t]),R=(0,n.useCallback)((e=>{pg({collectionContextStore:i,environment:c,collectionStore:e,collectionSettingsStore:t,createdCollectionStore:w,userAction:"CollectionSettingsCreateViewSource.handleSourcePickerAccept",analytics:a})}),[i,t,w,c,a]);return(0,L.jsx)(C().Ay,{...e,title:oo().A.formatMessage(hg.newDatabase),handleClose:()=>{D().os({collectionSettingsStore:t})},children:g?(0,L.jsx)(yg,{collectionContextStore:i,collectionSettingsStore:t,parentStore:g,existingCollectionStore:w,createdCollectionRecordPointerMap:j,input:I,setInput:k,newButtonMenuItem:V,handleAcceptExistingCollection:R,context:xs.Source,hideSearchTitle:E,analytics:a}):void 0})}const hg=(0,x().YK)({newDatabase:{defaultMessage:"New database",id:"database.viewSettings.collectionSettingsCreateViewSource.newDatabase"}});var vg=()=>o(451306),xg=()=>o(511393),bg=()=>o(118849);function Cg({subscriptionTier:e,analyticsName:t}){const o=(0,r().v3)(),n=(0,s().K8)((()=>(0,xg().h)(o)),[o]),i=(0,v().IS)((e=>({container:{margin:"8px 14px",padding:"8px 12px",borderRadius:8,border:`1px solid ${e.border.secondary}`,color:e.text.primary,fontSize:14,lineHeight:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},nonWorkspaceAdmin:{border:"unset",backgroundColor:e.lightGrayButtonBackground}})),[]);return(0,L.jsx)(lt().Ay,{...(0,vg().AH)(i.container,!n&&i.nonWorkspaceAdmin),onClick:()=>{_n().K(o,{from:t,upsell:{type:"product",product:e,limit:{type:"none"},trialability:"none"}})},disabled:!n,children:n?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(x().sA,{id:"upsellBannerButton.title.workspaceAdmin",defaultMessage:"Upgrade to unlock"}),(0,L.jsx)(bg().A,{subscriptionTier:e,analyticsName:t,desktopStyle:{marginInlineStart:8},disableTooltip:!0})]}):(0,L.jsx)(x().sA,{id:"upsellBannerButton.title.nonWorkspaceAdmin",defaultMessage:"Contact your workspace owner to upgrade to unlock this feature"})})}var wg=()=>o(58488),jg=()=>o(173215),Ag=()=>o(712855),_g=()=>o(792540);function Ig({formBlockStore:e,disabled:t}){return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(kg,{formBlockStore:e,disabled:t}),(0,L.jsx)(Mg,{formBlockStore:e,disabled:t})]})}function kg({formBlockStore:e,disabled:t}){const o=(0,s().K8)((()=>e.getFormConfigStore().getKeyStore("custom_confirmation_screen_title")),[e]);return(0,L.jsx)(A().A,{title:(0,L.jsx)(x().sA,{id:"formCustomizeSettings.customizeConfirmationScreen.title",defaultMessage:"Confirmation title"}),style:{paddingBottom:8},children:(0,L.jsx)(Tg,{formBlockStore:e,disabled:t,textStore:o,settingName:"custom_confirmation_screen_title"})})}function Mg({formBlockStore:e,disabled:t}){const o=(0,s().K8)((()=>e.getFormConfigStore().getKeyStore("custom_confirmation_screen_body")),[e]);return(0,L.jsx)(A().A,{title:(0,L.jsx)(x().sA,{id:"formCustomizeSettings.customizeConfirmationScreen.body",defaultMessage:"Confirmation body"}),style:{paddingBottom:12},children:(0,L.jsx)(Tg,{formBlockStore:e,disabled:t,textStore:o,textarea:!0,settingName:"custom_confirmation_screen_body"})})}function Tg({formBlockStore:e,disabled:t,textStore:o,textarea:i,settingName:l}){const a=(0,r().v3)(),c=(0,v().IS)((e=>({input:{fontSize:14,lineHeight:"20px",borderRadius:6,boxShadow:e.inputBoxShadow,background:e.inputBackground,cursor:"text",padding:"3px 6px",margin:"0 8px",width:"auto",overflow:"hidden",height:i?68:28,textWrap:i?"wrap":"nowrap",opacity:t?.4:1}})),[i,t]),d=(0,s().K8)((()=>e.getSpaceId()),[e]),u=(0,Do().sg)((0,n.useCallback)((()=>{(0,f().u)({environment:a,event:{eventName:"form_settings_changed",eventProperties:{form_id:e.id,form_setting:l}}})}),[e.id,a,l]),1e3),p=(0,jg().x)({textStore:o,parentStore:e,spaceId:d,disabled:!0});return t?(0,L.jsx)("div",{style:c.input,children:p}):(0,L.jsx)(Ag().A,{disabled:t,store:o,pasteBehavior:"inline",inPageFind:_g().Os.none,style:c.input,disabledMentionTypes:{page:!1,date:!1,user:!0,createPage:!0,inviteUserToWorkspace:!0,inviteUserToPage:!0,reminder:!0,bot:!0,heading:!0,group:!0,templateVariable:!0,property:!0},disableSlashCommands:!0,disableEmbedMenu:!0,disableMobileActionBar:!0,disableComment:!0,disableEnter:!0,disableHorizontalEdgeScroll:!0,disableEquationInteraction:!0,disableFilters:!0,disableRightMarginHoverStyling:!0,disableSuggestEdit:!0,disableShiftEnter:!0,onChange:u,onTab:Do().D_,onUntab:Do().D_})}var Pg=()=>o(717895),Bg=()=>o(594952),Fg=()=>o(435644),Vg=()=>o(125840);const Dg=30,Eg=(0,x().YK)({submitButtonTextPlaceholder:{id:"formCustomizeSettings.customizeSubmitButton.text.placeholder",defaultMessage:"Submit"}});function Rg({formBlockStore:e,disabled:t}){return(0,L.jsxs)(A().A,{title:(0,L.jsx)(x().sA,{id:"formCustomizeSettings.customizeSubmitButton.title",defaultMessage:"Submit button"}),children:[(0,L.jsx)(Og,{formBlockStore:e,disabled:t}),(0,L.jsx)(Kg,{formBlockStore:e,disabled:t})]})}function Og({formBlockStore:e,disabled:t}){const o=(0,r().Y0)(),{customSubmitButtonColorStore:i,currentColor:l}=(0,s().K8)((()=>{const t=e.getFormConfigStore().getKeyStore("custom_submit_button_color");return{customSubmitButtonColorStore:t,currentColor:(null==t?void 0:t.getValue())??"gray"}}),[e]),a=(0,L.jsx)(x().sA,{...To().jd[l]}),c=(0,n.useCallback)((({environment:t,color:o})=>{i&&(S().createAndCommit({userAction:"formSettings.setFormConfig.customSubmitButtonColor",environment:t,canUndo:!0,perform:e=>{Ll().KY({store:i,value:o,transaction:e})}}),(0,f().u)({environment:t,event:{eventName:"form_settings_changed",eventProperties:{form_setting:"custom_submit_button_color",form_id:e.id}}}))}),[i,e.id]),d=(0,v().IS)((e=>({colorLabelWrapper:{display:"flex",alignItems:"center",gap:2},selectedCircle:{height:F().Ev.lg,width:F().Ev.lg,stroke:To().l8[e.mode][l],fill:To().l8[e.mode][l]},colorLabel:{fontSize:14,lineHeight:"18px"}})),[l]);return(0,L.jsx)(R().A,{popupType:o.isPhone?yo().n.SlideUp:yo().n.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",disabled:t,originGap:0,renderOrigin:e=>(0,L.jsx)(so().A,{...e,title:(0,L.jsx)(x().sA,{id:"formCustomizeSettings.customizeSubmitButton.color",defaultMessage:"Color"}),disabled:t,icon:Bg().I,right:(0,L.jsxs)("div",{style:d.colorLabelWrapper,children:[(0,Pg().K)(d.selectedCircle),(0,L.jsx)("div",{style:d.colorLabel,children:a})]}),showChevron:!0}),render:e=>(0,L.jsx)(Vg().A,{parent:e,currentColor:l,onColorSelected:c}),style:{padding:"5px 0"}})}function Kg({formBlockStore:e,disabled:t}){const o=(0,r().v3)(),i=(0,x().tz)(),{customSubmitButtonTextStore:l,currentText:a}=(0,s().K8)((()=>{const t=e.getFormConfigStore().getKeyStore("custom_submit_button_text");return{customSubmitButtonTextStore:t,currentText:(null==t?void 0:t.getValue())??""}}),[e]),c=(0,n.useCallback)((t=>{l&&(S().createAndCommit({userAction:"formSettings.setFormConfig.customSubmitButtonText",environment:o,canUndo:!0,perform:e=>{Ll().KY({store:l,value:t,transaction:e})}}),(0,f().u)({environment:o,event:{eventName:"form_settings_changed",eventProperties:{form_setting:"custom_submit_button_text",form_id:e.id}}}))}),[l,o,e.id]),d=(0,Do().sg)(c,500);return(0,L.jsx)(ae().Ay,{title:(0,L.jsx)(x().sA,{id:"formCustomizeSettings.customizeSubmitButton.text",defaultMessage:"Text"}),icon:(0,Fg().a)({width:F().Ev.default,height:F().Ev.default,marginInlineStart:4}),right:(0,L.jsx)(tg().B,{disabled:t,initialValue:a,placeholder:i.formatMessage(Eg.submitButtonTextPlaceholder),onBlur:c,onSubmit:c,onChange:d,inputOuterStyle:{margin:0,width:160},maxLength:Dg,textWrapperStyle:{margin:0}}),style:{paddingTop:2,paddingInlineEnd:0,paddingBottom:2,paddingInlineStart:4,lineHeight:"28px"},disabled:t})}function Ng(e){const{collectionContextStore:t,collectionSettingsStore:o}=e,n=(0,r().Y0)(),i=(0,I().X)("upgrade_system_forms"),l=function(){const e=(0,r().v3)(),t=(0,cg().L)(),o=e.currentUser.id,n=null==t?void 0:t.id;return(0,Pn()._X)({name:"form_customization",spaceId:n,userId:o})}(),a="unavailable"===(null==l?void 0:l.type)&&l.upsell,c=Boolean(a),d=(0,s().K8)((()=>t.collectionViewStore()),[t]),u=(0,s().K8)((()=>{if(!d)throw new Error("No CollectionViewStore found");return d.getFormBlockStore()}),[d]);return d&&u?(0,L.jsx)(wg().I,{children:(0,L.jsx)(C().Ay,{collectionSettingsStore:o,title:(0,L.jsx)(x().sA,{id:"formCustomizeSettings.menuTitle",defaultMessage:"Customize"}),menuScrollerStyle:n.isMobile?void 0:{maxHeight:600},children:(0,L.jsxs)("div",{style:{padding:"0 4px 4px"},children:[a?i?(0,L.jsx)("div",{style:{margin:"8px 14px"},children:(0,L.jsx)(Fc().R,{display:"button",source:"forms_customize_settings",upsell:l.upsell,featureName:"form_customization"})}):(0,L.jsx)(Cg,{subscriptionTier:"plus",analyticsName:"forms_customize_settings"}):null,(0,L.jsx)(Rg,{formBlockStore:u,disabled:c}),(0,L.jsx)(Ig,{formBlockStore:u,disabled:c})]})})}):null}var Lg=()=>o(31503),zg=()=>o(450648),Ug=()=>o(894995),Wg=()=>o(348241),Hg=()=>o(425940),Gg=()=>o(467248);const $g={text:Gg().i,select:Hg().a,title:Gg().i,multi_select:Hg().a,relation:Gu().arrowDiagonalUpRightIcon,date:oi().D,person:ql().F,file:o(609616).o,number:o(965134).i,checkbox:fn().i,email:o(537193).b,url:o(742852).linkIcon,phone_number:o(686832).phoneIcon,place:o(727577).T},Qg=o(299733).questionMarkCircleFillIcon;function Yg(e){const{propertyType:t}=e;return(0,s().K8)((()=>(0,L.jsx)(W().I,{icon:(0,Lg().XO)(t)?$g[t]:Qg,colorVariant:"secondary"})),[t])}var qg=()=>o(98205),Jg=()=>o(630960),Xg=()=>o(465741),Zg=()=>o(38337),em=()=>o(300789),tm=()=>o(978846),om=()=>o(63667),nm=()=>o(478573);function im(e){const{questionStore:t,name:o}=e,{collectionStore:n}=(0,Mc().LH)(),i=(0,s().K8)((()=>{const e=t.getPropertyId();if(!n||!e)return;const o=n.getSchema();return(0,je()._g)({schema:o,property:e})}),[n,t]);if(!i)return null;const r=i.type;return(0,L.jsx)(nm().A,{...e,icon:(0,L.jsx)(Yg,{propertyType:i.type}),name:o,subText:sa().dC[r],disabled:!1})}var rm=()=>o(959733),lm=()=>o(237775);function sm(e){const{area:t,moduleId:o,parentModuleId:n,parentConditionalGroupId:i,collectionContextStore:l}=e,a=(0,r().Y0)(),c=(0,x().tz)(),{layoutStore:d}=(0,Mc().LH)(),u=(0,s().K8)((()=>l.collectionStore()),[l]);return(0,s().K8)((()=>u?(null==d?void 0:d.getNormalizedFormQuestionStoresForFormLayout({collectionSchema:u.getSchema()}))??[]:[]),[d,u]).length>=Xg().eb?(0,L.jsx)(C().Ay,{...e,title:c.formatMessage(Xg().Gi.questionLimitReachedTitle),children:(0,L.jsx)("div",{style:{padding:16,paddingTop:2,fontSize:12},children:c.formatMessage(Xg().Gi.questionLimitReachedSubtitle)})}):(0,L.jsx)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{id:"formQuestionCreateSettings.menuTitle",defaultMessage:"Select type"}),menuScrollerStyle:a.isMobile?void 0:{maxHeight:600},children:(0,L.jsx)(cm,{area:t,moduleId:o,parentModuleId:n,parentConditionalGroupId:i,collectionContextStore:l})})}const am=(0,x().YK)({showMore:{defaultMessage:"Show {numAdditionalProperties} more",id:"formQuestionCreateSettings.showMore"}});function cm(e){const{area:t,moduleId:o,parentModuleId:i,parentConditionalGroupId:l,collectionContextStore:a}=e,[c,d]=(0,n.useState)(!1),u=function(e){const{area:t,collectionContextStore:o,moduleId:n,parentModuleId:i,parentConditionalGroupId:l}=e,a=(0,r().v3)(),{layoutStore:c,collectionStore:d}=(0,Mc().LH)(),u=(0,s().K8)((()=>{var e;return Boolean(null===(e=o.collectionViewStore())||void 0===e||null===(e=e.getFormBlockStore())||void 0===e?void 0:e.hasSitePublicPermission())}),[o]),p=dm({area:t,moduleId:n,parentModuleId:i,parentConditionalGroupId:l,collectionContextStore:o}),g=(0,Jg().in)({layoutStore:c,collectionStore:d});return(0,s().K8)((()=>{if(!d)return[];const e=d.getSchema(),t=g.map((t=>{const o=(0,je()._g)({schema:e,property:t});if(!o)return;const n=(0,Xg().CK)({environment:a,propertyType:o.type,propertySchema:o,isPublicForm:u});let i=null;return"invalid_property_type_for_public_form"===n?i=(0,L.jsx)(x().sA,{...Jg().yh.unsupportedPublicQuestionType}):"related_collection_not_public"===n&&(i=(0,L.jsx)(x().sA,{...Jg().yh.relatedCollectionNotPublic})),{key:t,keywords:[o.name],render:({ref:e,...o})=>(0,L.jsx)("div",{style:{width:"100%"},children:(0,L.jsx)(om().k,{...o,propertyId:t,tooltip:i,disabled:Boolean(n)})}),action:()=>{p({type:"existingProperty",propertyId:t})}}})).filter(b().O9);return t}),[d,g,a,u,p])}({area:t,collectionContextStore:a,moduleId:o,parentModuleId:i,parentConditionalGroupId:l}),p=function(e){const{area:t,moduleId:o,parentModuleId:n,parentConditionalGroupId:i,collectionContextStore:l}=e,a=(0,r().v3)(),c=(0,s().K8)((()=>{var e;return Boolean(null===(e=l.collectionViewStore())||void 0===e||null===(e=e.getFormBlockStore())||void 0===e?void 0:e.hasSitePublicPermission())}),[l]),d=dm({area:t,moduleId:o,parentModuleId:n,parentConditionalGroupId:i,collectionContextStore:l}),u=(0,rm().g)({actionHandler:e=>d({type:"newProperty",propertyType:(0,oe().v2)(e)}),renderIcon:e=>(0,L.jsx)(Yg,{propertyType:(0,oe().v2)(e)}),tooltip:e=>{if("invalid_property_type_for_public_form"===(0,Xg().CK)({environment:a,propertyType:(0,oe().v2)(e),isPublicForm:c}))return{image:void 0,caption:Jg().yh.unsupportedPublicQuestionType}},disabled:e=>{const t=(0,Xg().CK)({environment:a,propertyType:(0,oe().v2)(e),isPublicForm:c});return Boolean(t)}}),p=(0,I().X)("place_property");return(0,s().K8)((()=>Lg().m3.filter((e=>"select"!==e&&!("place"===e&&!p))).map((e=>{if("relation"!==e&&(0,Lg().XO)(e))return"title"!==e?u(e):void 0})).filter(b().O9)),[u,p])}({area:t,moduleId:o,parentModuleId:i,parentConditionalGroupId:l,collectionContextStore:a}),g=function(e,t,o){const i=(0,r().v3)(),{layoutStore:l,collectionStore:a,setModuleSelection:c,sessionId:d}=(0,Mc().LH)(),u=(0,s().K8)((()=>l.getModules()),[l]),p=(0,s().K8)((()=>[...u.form_layout_schema,...Object.values(u.form_conditional_modules??{})].filter((e=>"formQuestion"===e.type))),[u]),g=(0,s().K8)((()=>(0,Lg().Cg)({moduleId:o??e,modulesByArea:u})),[u,e,o]),m=o?g.length-1:g.length,y=(0,n.useCallback)((e=>{const o=e.parentConditionalGroupId===t,n=g.includes(e.id),i=(0,qg().Yg)({currentModule:e,nestedModules:u.form_conditional_modules||{},includePlaceholders:!0}).maxDepth+m>Lg().mh;return!o&&!n&&!i}),[t,g,u,m]),f=(0,n.useCallback)((o=>{void 0!==t&&void 0!==e&&(S().createAndCommit({userAction:"FormQuestionCreateSettings.moveExistingQuestion",canUndo:!0,environment:i,perform:n=>{(0,tm().E)({position:{type:"absolute",area:"form_conditional_modules",parentConditionalGroupId:t,parentModuleId:e},moduleId:o.id,environment:i,layoutStore:l,transaction:n,sessionId:d})}}),c({type:"existing_module",moduleId:o.id,isDragging:!1}))}),[i,t,e,l,c,d]);return(0,s().K8)((()=>{if(!a)return[];const e=p.filter(y).map((e=>{const t=lm().c.createChildStore(l,{table:"form_question",id:e.formQuestionId,spaceId:l.getSpaceId()??""});if(void 0===t)return;const o=(0,zg().r4)({textValue:t.getNameStore().getValue(),getRecordModel:t.getRecordModel,deterministic:!0,userTimeZone:(0,_d().P)(),intl:oo().A.getIntl()});return{key:t.id,keywords:[o],render:({ref:e,...n})=>(0,L.jsx)("div",{style:{width:"100%"},children:(0,L.jsx)(im,{...n,name:o,questionStore:t})}),action:()=>{f(e)}}})).filter(b().O9);return e}),[a,f,p,l,y])}(i,l,o),m=(0,v().IS)((e=>({showMoreIcon:{width:16,height:16,marginInlineStart:4,marginInlineEnd:4,fill:e.icon.tertiary},showMoreButton:{height:42,color:e.text.tertiary,marginInlineStart:0}})),[]),y=function(e){const{key:t,title:o,items:n,limit:i}=e,r={key:"show-more",keywords:[],action:()=>{},render:e=>(0,L.jsx)(Q().A,{...e,id:Zg().v4C,icon:(0,os()._)({...m.showMoreIcon}),title:oo().A.formatMessage(am.showMore,{numAdditionalProperties:i?n.length-i:n.length}),desktopIconStyle:{marginInlineStart:7,marginInlineEnd:5},style:m.showMoreButton,onClick:e=>{d(!0),e.stopPropagation()}})},l=void 0!==i&&n.length>i,s=[...l?n.slice(0,i):n,...l?[r]:[]];return{key:t,render:e=>(0,L.jsx)(A().A,{title:o,...e,style:{display:"flex",flexDirection:"column",alignItems:"center",paddingInlineStart:"8px",paddingInlineEnd:"8px",paddingTop:"new-properties"===t&&u.length>0?8:0,paddingBottom:0},desktopTitleStyle:{alignSelf:"flex-start",paddingInlineStart:"8px"}}),items:s}},f=c?void 0:5,h=y({key:"existing-properties",title:(0,L.jsx)(x().sA,{id:"formQuestionCreateSettings.existingPropertiesSectionTitle",defaultMessage:"Existing properties"}),items:u,limit:f}),C=y({key:"new-properties",title:u.length>0||g.length>0?(0,L.jsx)(x().sA,{id:"formQuestionCreateSettings.newPropertiesSectionTitle",defaultMessage:"New question"}):void 0,items:p}),w=y({key:"existing-questions",title:g.length>0?(0,L.jsx)(x().sA,{id:"formQuestionCreateSettings.existingQuestionsSectionTitle",defaultMessage:"Existing questions"}):void 0,items:g});return(0,L.jsx)(A().A,{children:(0,L.jsx)(ce().Ay,{initialFocus:0,type:ce().Oh.Vertical,sections:[...g.length>0&&void 0!==i&&void 0!==l?[w]:[],...u.length>0?[h]:[],...p.length>0?[C]:[]]})})}function dm(e){const{area:t,moduleId:o,parentModuleId:i,parentConditionalGroupId:l,collectionContextStore:a}=e,c=(0,r().v3)(),{layoutStore:d,collectionStore:u,setModuleSelection:p,sessionId:g}=(0,Mc().LH)(),{autofocusedQuestionTextStore:m,formAddConditionalLogicTooltipStore:y}=(0,Wg().cJ)(),f=(0,s().O$)(He().AppStoreCurrentUserSettingsStore);return(0,n.useCallback)((e=>{S().createAndCommit({userAction:"FormQuestionCreateSettings.createFormQuestion",environment:c,canUndo:!0,undoCheckpoint:`form_layout_new_question_${o}`,perform:n=>{if(!u)throw new Error("Collection store not found");const r=(()=>{if("existingProperty"===e.type)return e.propertyId;const t=e.propertyType;return(0,fd().createProperty)({environment:c,collectionStore:u,collectionViewArgs:void 0,propertyName:sa().dC[t],propertyType:t,transaction:n})})(),s=(()=>{if("existingProperty"===e.type){const e=u.getSchema()[r];return null==e?void 0:e.type}return e.propertyType})();if(!("form_conditional_modules"!==t||i&&l))throw new Error("Parent module ID and parent conditional group ID are required for nested modules");const{updatedModuleId:S,formQuestionId:h}=(0,Ug().createFormQuestionAndUpdateOrCreateModule)({environment:c,transaction:n,layoutStore:d,moduleId:o,propertyId:r,initialQuestionTitle:(()=>{if("existingProperty"===e.type){const e=u.getSchema()[r];return e?e.name:""}{const t=e.propertyType;if((0,Lg().XO)(t)&&"select"!==t)return Xg().mY[t]}})()??"",shouldSyncQuestionNameToPropertyName:"newProperty"===e.type,collectionContextStore:a,autofocusTitle:{shouldAutofocus:!0,autofocusedQuestionTextStore:m},sessionId:g,..."form_conditional_modules"===t&&i&&l?{area:t,parentModuleId:i,parentConditionalGroupId:l}:{area:"form_layout_schema"}});p({type:"existing_module",moduleId:S,isDragging:!1});const v=null==f?void 0:f.getSettingsStore().getKeyStore("seen_forms_add_conditional_logic_tooltip").getValue();"checkbox"!==s||v||y.setState({openTooltip:(0,qg().fY)({formQuestionId:h})})}}),em().HH(c,qg().wG)}),[c,g,u,d,o,a,m,t,i,l,p,y,f])}const um=function(e){return(0,L.jsx)(wg().I,{children:(0,L.jsx)(sm,{...e})})};var pm=()=>o(665589),gm=()=>o(419178),mm=()=>o(566534),Sm=()=>o(655923),ym=()=>o(112282),fm=()=>o(638045);const hm={viewBox:"0 0 20 20",fittedViewBox:"3.9 3.07 12.2 13.86",svg:(0,L.jsx)("path",{d:"M10 3.075c.345 0 .625.28.625.625v5.217l4.518-2.608a.625.625 0 1 1 .625 1.082L11.25 10l4.518 2.609a.625.625 0 0 1-.625 1.082l-4.518-2.609V16.3a.625.625 0 0 1-1.25 0v-5.218l-4.518 2.61a.625.625 0 1 1-.625-1.083l4.518-2.61-4.518-2.608a.625.625 0 1 1 .625-1.082l4.518 2.608V3.7c0-.345.28-.625.625-.625"})},vm=(0,F().wt)("asterisk",hm);var xm=()=>o(222080),bm=()=>o(765974),Cm=()=>o(594088);const wm={viewBox:"0 0 20 20",fittedViewBox:"2.49 2.5 15 15",svg:(0,L.jsx)("path",{d:"M2.5 5a2.5 2.5 0 1 1 3.125 2.421V12.5c0 1.036.84 1.875 1.875 1.875h5.079a2.5 2.5 0 1 1 0 1.25H7.5A3.125 3.125 0 0 1 4.375 12.5V7.421A2.5 2.5 0 0 1 2.5 5M5 3.75a1.25 1.25 0 1 0 0 2.5 1.25 1.25 0 0 0 0-2.5M13.75 15a1.25 1.25 0 1 0 2.5 0 1.25 1.25 0 0 0-2.5 0"})},jm=(0,F().wt)("nodeTopLeftBottomRight",wm);var Am=()=>o(813197),_m=()=>o(688311),Im=()=>o(500993),km=()=>o(475140),Mm=()=>o(251822),Tm=()=>o(901952),Pm=()=>o(362441),Bm=()=>o(181922),Fm=()=>o(832857),Vm=()=>o(802975),Dm=()=>o(37165);function Em(e){const{environment:t,module:o,collectionStore:n,formQuestionStore:i,transaction:r,position:l,layoutStore:s,autofocusTitle:a,duplicateModuleMapping:c,questionModulePropertyUpdateMap:d,propertyIdMapping:u,sessionId:p,collectionContextStore:g}=e;if("formQuestion"===o.type){const e=null==i?void 0:i.getConfig(),m=d.get(o.id);if(!m)return;(0,ot().F)({environment:t,collectionStore:n,update:{[m.newProperty]:m.newPropertySchema},transaction:r}),(0,Ug().createModuleForNewlyDuplicatedProperty)({type:o.type,environment:t,module:o,layoutStore:s,collectionStore:n,propertyId:m.newProperty,position:l,collectionContextStore:g,autofocusTitle:a,shouldLogEvent:!1,existingFormQuestionConfig:e,duplicateModuleMapping:c,sessionId:p,transaction:r,propertyIdMapping:u})}else(0,Ug().createModuleForNewlyDuplicatedProperty)({type:o.type,environment:t,module:o,layoutStore:s,collectionContextStore:g,shouldLogEvent:!1,position:l,duplicateModuleMapping:c,sessionId:p,transaction:r})}function Rm(e){const{environment:t,questionStore:o,autofocusedQuestionTextStore:n,currValue:i}=e;S().createAndCommit({userAction:"formQuestion.toggleShowDescription",environment:t,canUndo:!0,perform:e=>{const t=!i;S().applyOperation({store:o,operation:{pointer:o.pointer,path:["config","showDescription"],command:"set",args:t},transaction:e}),t||function(e){var t;const{questionStore:o,autofocusedQuestionTextStore:n,transaction:i}=e;void 0===(null===(t=o.getConfig())||void 0===t?void 0:t.description)&&S().applyOperation({store:o,operation:{pointer:o.pointer,path:["config","description"],command:"set",args:(0,ci().x9d)("")},transaction:i});n.autofocusQuestionDescription({questionId:o.id})}({questionStore:o,autofocusedQuestionTextStore:n,transaction:e})}})}var Om=()=>o(536308),Km=()=>o(266405),Nm=()=>o(152197);function Lm({children:e}){return(0,L.jsx)(at().A,{renderTooltip:()=>(0,L.jsx)(x().sA,{id:"FormSettingsNameSyncTooltip.tooltip",defaultMessage:"Renaming a question also renames its linked database property. Disable to keep names separate."}),placement:"left",alignment:"center",textWrap:!0,render:t=>(0,L.jsx)("div",{...t,children:e})})}function zm({tooltipState:e,disableTooltip:t,children:o}){const i=(0,n.useMemo)((()=>{if(!e)return null;switch(e){case"deleted_property":return(0,L.jsx)(x().sA,{id:"FormSettingsComingSoonTooltip.deletedProperty",defaultMessage:"The linked property has been deleted."});case"invalid_property_type":return(0,L.jsx)(x().sA,{id:"FormSettingsComingSoonTooltip.invalidProperty",defaultMessage:"The linked property is an unsupported type."});case"invalid_property_type_for_public_form":return(0,L.jsx)(x().sA,{...Jg().yh.unsupportedPublicQuestionType});case"related_collection_not_public":return(0,L.jsx)(x().sA,{...Jg().yh.relatedCollectionNotPublic});case"generic_error":return(0,L.jsx)(x().sA,{id:"FormSettingsErrorTooltip.genericError",defaultMessage:"There is an issue with this linked property."});default:(0,b().HB)(e)}}),[e]);return(0,L.jsx)(at().A,{renderTooltip:()=>i,disableTooltip:t,placement:"left",render:e=>(0,L.jsx)("div",{...e,children:o})})}function Um(e){const{collectionContextStore:t,collectionSettingsStore:o,formQuestionId:n,moduleId:i}=e,l=(0,r().v3)(),{collectionViewStore:a,formBlockStore:c}=(0,s().K8)((()=>{var e;return{collectionViewStore:t.collectionViewStore(),formBlockStore:null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormBlockStore()}}),[t]),d=(0,s().K8)((()=>{if(!a)throw new Error("no collectionViewStore found");const e=a.getSpaceId();if(!e)throw new Error("no spaceId found");return lm().c.createChildStore(a,{table:"form_question",id:n,spaceId:e})}),[a,n]),u=(0,s().K8)((()=>{var e;return null===(e=d.getConfig())||void 0===e?void 0:e.propertyId}),[d]),p=(0,s().K8)((()=>{if(!u)return;return t.normalizedSchemaStore.state[u]}),[t.normalizedSchemaStore,u]),g=(0,s().K8)((()=>{const e=t.normalizedSchemaStore.state;return d?(0,Km().e)(l,d,e,null==c?void 0:c.hasSitePublicPermission()):"generic_error"}),[t.normalizedSchemaStore,l,c,d]),m=(0,s().K8)((()=>{if(p)return p.type}),[p]);return u?(0,L.jsx)(wg().I,{children:(0,L.jsxs)(C().Ay,{...e,title:(0,L.jsx)(x().sA,{id:"formQuestionEditSettings.menuTitle",defaultMessage:"Question options"}),children:[(0,L.jsxs)(A().A,{children:[(0,L.jsx)(Gm,{collectionContextStore:t,formQuestionStore:d}),(0,L.jsx)(tS,{collectionContextStore:t,formQuestionStore:d}),(0,L.jsx)(Hm,{collectionContextStore:t,propertySchema:p,formQuestionStore:d})]}),(0,L.jsxs)(A().A,{topBorder:!0,children:[(0,L.jsx)(Wm,{collectionSettingsStore:o,collectionContextStore:t,formQuestionStore:d,propertyId:u,propertyType:m,questionErrorState:g}),(0,L.jsx)(Zm,{collectionSettingsStore:o,collectionContextStore:t,formQuestionStore:d,questionErrorState:g}),(0,L.jsx)($m,{collectionContextStore:t,formQuestionStore:d})]}),(0,L.jsxs)(A().A,{topBorder:!0,children:[(0,L.jsx)(rS,{collectionSettingsStore:o,moduleId:i}),(0,L.jsx)(nS,{moduleId:i,propertyId:u,propertySchema:p}),(0,L.jsx)(iS,{moduleId:i}),(0,L.jsx)(sS,{collectionSettingsStore:o,collectionContextStore:t,moduleId:i,propertyId:u,propertySchema:p,formQuestionStore:d}),(0,L.jsx)(eS,{collectionSettingsStore:o,collectionContextStore:t,moduleId:i,formQuestionStore:d})]})]})}):null}function Wm({collectionSettingsStore:e,collectionContextStore:t,formQuestionStore:o,propertyId:i,propertyType:l,questionErrorState:a}){const c=(0,r().v3)(),{layoutStore:d}=(0,Mc().LH)(),{isCollectionEmpty:u}=(0,Wg().cJ)(),{collectionStore:p,collectionSchema:g,collectionViewStore:m,formatKey:y}=(0,s().K8)((()=>({collectionStore:t.collectionStore(),collectionSchema:t.normalizedSchemaStore.state,collectionViewStore:t.collectionViewStore(),formatKey:t.getPropertyFormatKey()})),[t]),f=(0,s().K8)((()=>l&&(0,Lg().XO)(l)?"select"===l?"multi_select":l:"not_found"),[l]),h=a?bm().exclamationMarkTriangleFillIcon:xm().s,b=(0,v().IS)((e=>({iconContainer:{background:"light"===e.mode?e.white:e.palette.translucentGray[100],borderWidth:1,borderStyle:"solid",borderColor:"light"===e.mode?e.palette.gray[100]:e.palette.translucentGray[300],minWidth:32,width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,overflow:"hidden"}})),[]),C=(0,Jg().in)({layoutStore:d,collectionStore:p}),w=(0,I().X)("place_property"),j=Lg().m3.filter((e=>"place"!==e||w)),A=(0,s().K8)((()=>{const e=[];return j.forEach((t=>{"select"!==t&&e.push({key:t,type:"button",title:Xg().mY[t],hideOption:"title"===t&&!C.includes(oe().rn)||"relation"===t,icon:(0,L.jsx)("div",{style:b.iconContainer,children:(0,L.jsx)(Yg,{propertyType:t})})})})),e.push({key:"not_found",type:"button",hideOption:!0,title:(0,L.jsx)(x().sA,{id:"formQuestionEditSettings.questionType.propertyNotFound",defaultMessage:"Not Found"})}),e}),[j,C,b.iconContainer]),_=(0,s().K8)((()=>null==p?void 0:p.getDatabaseType()),[p]),k=(0,n.useCallback)((e=>{(0,Tm().V)({environment:c,collectionContextStore:t,property:i,new_property_type:e,from:"form_editor",action:"change_type"}),S().createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyTypeAccept",environment:c,canUndo:!0,perform:n=>{if(p)if(l!==oe().rn)e===oe().rn?(Ll().KY({store:o.getConfigStore().getKeyStore("propertyId"),value:oe().rn,transaction:n}),u&&((0,it().B)({environment:c,collectionStore:p,schema:g,property:i,transaction:n}),n.postSubmitCallbacks.push((e=>{e||Om().formEditorActions.maybeSyncQuestionNameToPropertyName({environment:c,questionStore:o,collectionStore:p,collectionContextStore:t})})))):(0,Pm().H)({environment:c,collectionStore:p,property:i,type:e,transaction:n});else{const t=(0,fd().createProperty)({environment:c,collectionStore:p,propertyType:e,transaction:n,collectionViewArgs:m&&y?{collectionViewStore:m,format:m.getFormat(),formatKey:y}:void 0});Ll().KY({store:o.getConfigStore().getKeyStore("propertyId"),value:t,transaction:n})}}})}),[c,p,l,m,y,o,u,g,i,t]),M=(0,n.useCallback)((e=>{if("not_found"===e||!p)return;const o=g[i];Bm().g({environment:c,collectionContextStore:t,propertyId:i,propertySchema:o,handlePropertyTypeChange:()=>k(e)})}),[c,t,i,p,g,k]);return p?(0,L.jsx)(zm,{tooltipState:a,disableTooltip:void 0===a,children:(0,L.jsx)(to().A,{icon:h,options:A,disabled:"not_found"===f||void 0!==_,title:(0,L.jsx)(x().sA,{defaultMessage:"Question type",id:"formQuestionEditSettings.questionType.menuTitle"}),selectedKey:f,menuItemOptionsStyle:{paddingTop:4,paddingBottom:4},onChange:M})}):null}function Hm(e){const{propertySchema:t,formQuestionStore:o,collectionContextStore:n}=e,i=(0,s().K8)((()=>{const e=null==t?void 0:t.type;if(e&&!(0,Lg().XO)(e)||!e)return null;switch(e){case"title":case"text":return(0,L.jsx)(Xm,{formQuestionStore:o,propertyType:e,collectionContextStore:n});case"select":return(0,L.jsx)(oS,{formQuestionStore:o,collectionContextStore:n,propertySchema:t});case"multi_select":return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(oS,{formQuestionStore:o,collectionContextStore:n,propertySchema:t}),(0,L.jsx)(Jm,{formQuestionStore:o,propertySchema:t,collectionContextStore:n})]});case"relation":case"person":return(0,L.jsx)(Jm,{formQuestionStore:o,propertySchema:t,collectionContextStore:n});case"date":return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Qm,{formQuestionStore:o,collectionContextStore:n}),(0,L.jsx)(Ym,{formQuestionStore:o,collectionContextStore:n})]});case"file":case"number":case"checkbox":case"email":case"url":case"phone_number":case"place":return(0,L.jsx)(L.Fragment,{});default:(0,b().HB)(e)}}),[n,o,t]);return(0,L.jsx)(L.Fragment,{children:i})}function Gm({collectionContextStore:e,formQuestionStore:t}){const o=(0,s().K8)((()=>t.isRequired()),[t]),i=(0,r().v3)(),l=(0,n.useCallback)((()=>{!function(e){const{questionStore:t,environment:o,currValue:n}=e;S().createAndCommit({userAction:"formQuestion.toggleRequired",environment:o,canUndo:!0,perform:e=>{S().applyOperation({store:t,operation:{pointer:t.pointer,path:["config","required"],command:"set",args:!n},transaction:e})}})}({environment:i,questionStore:t,currValue:t.isRequired()})}),[i,t]),a=aS({collectionContextStore:e,formQuestionStore:t});return(0,L.jsx)(Dc().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"Required",id:"formQuestionEditSettings.isRequired.title"}),switcherProps:{on:o},icon:vm,onClick:l,disabled:a})}function $m({collectionContextStore:e,formQuestionStore:t}){const o=(0,s().K8)((()=>t.shouldSyncQuestionNameToPropertyName()),[t]),i=(0,r().v3)(),l=(0,n.useCallback)((()=>{!function(e){const{questionStore:t,environment:o,currValue:n}=e;S().createAndCommit({userAction:"formQuestion.toggleShouldSyncQuestionNameToPropertyName",environment:o,canUndo:!0,perform:e=>{S().applyOperation({store:t,operation:{pointer:t.pointer,path:["config","shouldSyncQuestionNameToPropertyName"],command:"set",args:!n},transaction:e})}})}({environment:i,questionStore:t,currValue:t.shouldSyncQuestionNameToPropertyName()})}),[i,t]),a=aS({collectionContextStore:e,formQuestionStore:t});return(0,L.jsx)(Lm,{children:(0,L.jsx)(Dc().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"Sync with property name",id:"formQuestionEditSettings.shouldSyncQuestionNameToPropertyName.title"}),switcherProps:{on:o},icon:_m().h,onClick:l,disabled:a})})}function Qm({collectionContextStore:e,formQuestionStore:t}){const o=(0,r().v3)(),i=(0,s().K8)((()=>{var e;return(null===(e=t.getPropertyTypeSpecificConfig("date"))||void 0===e?void 0:e.endDate)??!1}),[t]),l=(0,n.useCallback)((()=>{!function(e){const{questionStore:t,environment:o,currValue:n}=e;S().createAndCommit({userAction:"formQuestion.changeEndDateSetting",environment:o,canUndo:!0,perform:e=>{S().applyOperation({store:t,operation:{pointer:t.pointer,path:["config","propertyTypeSpecificConfig","date","endDate"],command:"set",args:!n},transaction:e})}})}({environment:o,questionStore:t,currValue:i})}),[i,o,t]),a=aS({collectionContextStore:e,formQuestionStore:t});return(0,L.jsx)(Dc().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"End date",id:"formQuestionEditSettings.date.endDate.title"}),switcherProps:{on:i},icon:oi().D,onClick:l,disabled:a})}function Ym({collectionContextStore:e,formQuestionStore:t}){const o=(0,r().v3)(),i=(0,s().K8)((()=>{var e;return(null===(e=t.getPropertyTypeSpecificConfig("date"))||void 0===e?void 0:e.includeTime)??!1}),[t]),l=(0,n.useCallback)((()=>{!function(e){const{questionStore:t,environment:o,currValue:n}=e;S().createAndCommit({userAction:"formQuestion.changeIncludeTimeSetting",environment:o,canUndo:!0,perform:e=>{S().applyOperation({store:t,operation:{pointer:t.pointer,path:["config","propertyTypeSpecificConfig","date","includeTime"],command:"set",args:!n},transaction:e})}})}({environment:o,questionStore:t,currValue:i})}),[i,o,t]),a=aS({collectionContextStore:e,formQuestionStore:t});return(0,L.jsx)(Dc().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"Include time",id:"formQuestionEditSettings.date.includeTime.title"}),switcherProps:{on:i},icon:Yn().clockIcon,onClick:l,disabled:a})}const qm=Jg().Jz.map((e=>e.key));function Jm({collectionContextStore:e,formQuestionStore:t,propertySchema:o}){const i=(0,r().v3)(),l=(0,x().tz)(),{selectedKey:a,maxSelection:c}=(0,s().K8)((()=>{const e=(0,Lg().hm)(o,t.getModel()),n=null==e?void 0:e.toString();let i="custom";return void 0===e?i="unlimited":n&&qm.includes(n)&&(i=n),{selectedKey:i,maxSelection:e}}),[t,o]),[d,u]=(0,n.useState)("custom"===a?null==c?void 0:c.toString():""),p=(0,n.useCallback)(((e,n,r)=>{let l;switch(e){case"unlimited":l=void 0;break;case"custom":if(!r)return;l=parseInt(r,10);break;default:l=parseInt(e,10)}void 0!==l&&(isNaN(l)||!Number.isInteger(l)||l<1||l>1e3)?u(""):S().createAndCommit({environment:i,userAction:"MaxSelectionComponent.handleUpdateSelection",canUndo:!0,perform:e=>{Ll().KY({store:t.getKeyStore("config").getKeyStore("propertyTypeSpecificConfig").getKeyStore(o.type).getKeyStore("maxSelectionCount"),value:l,transaction:e})}})}),[i,t,o.type,u]);function g(e){const t=/[^0-9]/g;t.test(e)&&xo().D6({label:(0,L.jsx)(x().sA,{id:"formQuestionEditSettings.maxSelection.nonNumberWarning",defaultMessage:"Please enter a number."})});const o=e.replace(t,"");u(o)}const m=(0,n.useMemo)((()=>{const e={key:"custom",type:"input",inputValue:d,onSubmit:p,onChange:g};return[...Jg().Jz,e]}),[p,d]),y=aS({collectionContextStore:e,formQuestionStore:t});return(0,L.jsx)(at().A,{textWrap:!0,alignment:"center",placement:"left",disableTooltip:!((0,je().bu)(o)&&o.limit),renderTooltip:()=>{if((0,je().bu)(o)&&void 0!==o.limit)return(0,L.jsx)(x().sA,{id:"formQuestionEditSettings.maxSelection.error.tooltip",defaultMessage:"A limit of 1 has been set on the linked property. Please remove the limit on the linked property in order to configure this question’s max selection."})},render:e=>(0,L.jsx)(to().A,{...e,title:(0,L.jsx)(x().sA,{id:"formQuestionEditSettings.maxSelection.title",defaultMessage:"Max selection"}),icon:Am().L,selectedKey:a,options:m,onChange:p,disabled:y||(0,je().bu)(o)&&void 0!==o.limit,inputPlaceholder:l.formatMessage({id:"formQuestionEditSettings.maxSelection.inputPlaceholder",defaultMessage:"Custom"})})})}function Xm({collectionContextStore:e,formQuestionStore:t,propertyType:o}){const i=(0,s().K8)((()=>{var e;return(null===(e=t.getPropertyTypeSpecificConfig(o))||void 0===e?void 0:e.longAnswer)??!1}),[t,o]),l=(0,r().v3)(),a=(0,n.useCallback)((()=>{!function(e){const{questionStore:t,environment:o,currValue:n,propertyType:i}=e;S().createAndCommit({userAction:"formQuestion.changeName",environment:o,canUndo:!0,perform:e=>{S().applyOperation({store:t,operation:{pointer:t.pointer,path:["config","propertyTypeSpecificConfig",i,"longAnswer"],command:"set",args:!n},transaction:e})}})}({environment:l,questionStore:t,currValue:i,propertyType:o})}),[i,l,t,o]),c=aS({collectionContextStore:e,formQuestionStore:t});return(0,L.jsx)(Dc().A,{title:(0,L.jsx)(x().sA,{defaultMessage:"Long answer",id:"formQuestionEditSettings.longAnswer.title"}),switcherProps:{on:i},icon:pm().l,onClick:a,disabled:c})}function Zm({collectionContextStore:e,collectionSettingsStore:t,formQuestionStore:o,questionErrorState:n}){const i=(0,v().DP)(),l=(0,r().v3)(),a=(0,s().K8)((()=>{var e;return null===(e=o.getConfig())||void 0===e?void 0:e.propertyId}),[o]),c=(0,s().K8)((()=>{if(!a)return;const t=e.normalizedSchemaStore.state[a];return t?t.name:void 0}),[e.normalizedSchemaStore,a]),{layoutStore:d,collectionStore:u}=(0,Mc().LH)(),p=(0,Jg().in)({layoutStore:d,collectionStore:u}),g=(0,s().K8)((()=>{const t=[];return p.forEach((o=>{const n=e.normalizedSchemaStore.state[o];n&&(0,Lg().Sg)(n)&&t.push({key:o,type:"button",title:n.name,icon:(0,L.jsx)(Qe().zB,{type:n.type,theme:i,icon:void 0,size:F().Ev.sm,style:{fill:i.icon.primary}})})})),t.push({key:"not_found",type:"button",hideOption:!0,title:(0,L.jsx)(x().sA,{id:"formQuestionEditSettings.linkedProperty.propertyNotFound",defaultMessage:"Not Found"})}),t}),[i,e.normalizedSchemaStore,p]);return(c||n)&&a?"deleted_property"===n?(0,L.jsx)(to().A,{disabled:g.every((e=>!0===e.hideOption)),icon:qn().c,title:(0,L.jsx)(x().sA,{defaultMessage:"Linked property",id:"formQuestionEditSettings.linkedProperty.title"}),selectedKey:"not_found",onChange:e=>Om().formEditorActions.remapQuestionToNewProperty({environment:l,formQuestionStore:o,newPropertyId:e}),options:g}):(0,L.jsx)(so().A,{icon:qn().c,title:(0,L.jsx)(x().sA,{defaultMessage:"View linked property",id:"formQuestionEditSettings.viewLinkedProperty.title"}),showChevron:!0,onClick:()=>{D().a2({collectionSettingsStore:t,item:{type:"property",formatKey:void 0,property:a}})}}):null}function eS({collectionContextStore:e,collectionSettingsStore:t,moduleId:o,formQuestionStore:i}){const{layoutStore:l,sessionId:a}=(0,Mc().LH)(),{isCollectionEmpty:c}=(0,Wg().cJ)(),d=(0,r().v3)(),u=(0,s().K8)((()=>(0,km().Ib)({modulesByArea:l.getModules(),find:e=>o===e.id})),[l,o]),p=(0,n.useCallback)((()=>{void 0!==u&&S().createAndCommit({userAction:"formActions.deleteFormQuestion",environment:d,canUndo:!0,perform:o=>{(0,Vm().B)({environment:d,module:u.module,sessionId:a,layoutStore:l,transaction:o,collectionSettingsStore:t,isCollectionEmpty:c,collectionContextStore:e,area:u.area,updateParentModule:!0})}})}),[e,t,d,c,l,a,u]);return(0,L.jsx)(so().A,{icon:G().trashIcon,title:(0,L.jsx)(x().sA,{id:"formQuestionEditSettings.deleteQuestion.title",defaultMessage:"Delete question"}),onClick:p})}function tS({formQuestionStore:e,collectionContextStore:t}){const o=(0,r().v3)(),{autofocusedQuestionTextStore:i}=(0,Wg().cJ)(),l=(0,s().K8)((()=>{var t;return Boolean(null===(t=e.getConfig())||void 0===t?void 0:t.showDescription)}),[e]),a=(0,n.useCallback)((()=>{Rm({environment:o,questionStore:e,autofocusedQuestionTextStore:i,currValue:l})}),[i,o,e,l]),c=aS({collectionContextStore:t,formQuestionStore:e});return(0,L.jsx)(Dc().A,{icon:Gg().i,title:(0,L.jsx)(x().sA,{id:"formQuestionEditSettings.addDescription.title",defaultMessage:"Description"}),onClick:a,disabled:c,switcherProps:{on:l}})}function oS({collectionContextStore:e,formQuestionStore:t,propertySchema:o}){const i=(0,r().v3)(),l=null==o?void 0:o.type,a=(0,s().K8)((()=>(0,Xg().KU)({formQuestionStore:t,propertySchema:o})),[t,o]),c=(0,n.useCallback)((o=>{l&&S().createAndCommit({environment:i,userAction:"DisplayModeComponent.handleUpdateDisplayMode",canUndo:!0,perform:n=>{var r;Ll().KY({store:t.getKeyStore("config").getKeyStore("propertyTypeSpecificConfig").getKeyStore(l).getKeyStore("displayMode"),value:o,transaction:n});const s=t.getParentStore();s&&(0,f().u)({environment:i,event:{eventName:"form_question_display_mode_changed",eventProperties:{...(0,Xg().YA)({collectionContextStore:e,propertyId:(null===(r=t.getConfig())||void 0===r?void 0:r.propertyId)??"",questionId:t.id,area:"form_layout_schema",layoutStore:s}),new_display_mode:o}}})}})}),[i,t,l,e]),d=(0,n.useMemo)((()=>[{key:"list",type:"button",title:(0,L.jsx)(x().sA,{id:"formQuestionEditSettings.displayMode.list",defaultMessage:"List view"})},{key:"dropdown",type:"button",title:(0,L.jsx)(x().sA,{id:"formQuestionEditSettings.displayMode.dropdown",defaultMessage:"Dropdown"})}]),[]),u=aS({collectionContextStore:e,formQuestionStore:t});return(0,I().X)("forms_select_question_display_mode_setting")?(0,L.jsx)(to().A,{icon:Cm().A,title:(0,L.jsx)(x().sA,{id:"formQuestionEditSettings.displayMode.title",defaultMessage:"Show options as"}),selectedKey:a??"list",options:d,onChange:c,disabled:u}):null}function nS({moduleId:e,propertyId:t,propertySchema:o}){var i;const l=(0,r().v3)(),a=(0,Nm().r)(),{layoutStore:c,sessionId:d,setModuleSelection:u}=(0,Mc().LH)(),p=(0,Pn()._X)({name:"forms_conditional_logic",spaceId:a,userId:null===(i=l.currentUser)||void 0===i?void 0:i.id}),g=null==p?void 0:p.upsell,m=(0,I().X)("upgrade_system_forms")&&"unavailable"===(null==p?void 0:p.type),S=(0,s().K8)((()=>{if(o)return"checkbox"===o.type||"select"===o.type||"multi_select"===o.type?o.type:void 0}),[o]),y=(0,s().K8)((()=>(0,Lg().Cg)({moduleId:e,modulesByArea:c.getModules()}).length>=Lg().mh),[c,e]),f=S&&!y,h=(0,s().K8)((()=>(0,Im().A)(e,c.getModules())),[c,e]),v=(0,n.useCallback)((()=>{"unavailable"!==(null==p?void 0:p.type)||"product"!==(null==g?void 0:g.type)?S&&"available"===(null==p?void 0:p.type)&&Fm().lF({environment:l,layoutStore:c,currentQuestionModule:h.module,area:h.area,property:t,filterValue:{type:S,value:void 0},setModuleSelection:u,sessionId:d}):_n().K(l,{upsell:g,from:"forms_conditional_logic"})}),[null==p?void 0:p.type,g,S,l,c,h.module,h.area,t,u,d]),b=n.useRef(null);return f?m&&g?(0,L.jsx)(Vc().c,{showTooltip:!0,tooltipProps:{placement:"right",showIcon:!1},upsell:g,source:"forms_conditional_logic",children:({handleClick:e})=>(0,L.jsx)("div",{ref:b,children:(0,L.jsx)(so().A,{icon:jm,title:(0,L.jsx)(x().sA,{id:"formQuestionEditSettings.addConditionalLogic.title",defaultMessage:"Add conditional logic"}),right:(0,L.jsx)(Fc().R,{display:"icon",upsell:g,source:"forms_conditional_logic",hoverRef:b}),onClick:e})})}):(0,L.jsx)(so().A,{icon:jm,title:(0,L.jsx)(x().sA,{id:"formQuestionEditSettings.addConditionalLogic.title",defaultMessage:"Add conditional logic"}),onClick:v}):null}function iS({moduleId:e}){const t=(0,r().v3)(),{layoutStore:o,sessionId:i}=(0,Mc().LH)(),l=(0,s().K8)((()=>{var t;if(o)return null===(t=o.getModules().form_conditional_modules)||void 0===t?void 0:t[e]}),[o,e]),a=(0,n.useCallback)((()=>{l&&"formQuestion"===l.type&&Fm().Ix({environment:t,layoutStore:o,formQuestionModule:l,sessionId:i})}),[t,o,l,i]);return l?(0,L.jsx)(so().A,{icon:mm().U,title:(0,L.jsx)(x().sA,{id:"formQuestionEditSettings.removeFromConditionalGroup.title",defaultMessage:"Remove from conditional group"}),onClick:a}):null}function rS({collectionSettingsStore:e,moduleId:t}){const o=(0,s().uB)(void 0,J().A),{layoutStore:n}=(0,Mc().LH)(),i=(0,I().X)("bottom_page_discussions_enabled"),r=(0,s().K8)((()=>(0,km().Ib)({modulesByArea:n.getModules(),find:e=>e.id===t})),[n,t]),{currentModuleIndex:l,numChildrenInGroup:a}=(0,s().K8)((()=>(0,km().y1)({modulesByArea:n.getModules(),moduleId:t,isBottomPageDiscussionsEnabled:i})),[n,t,i]),{numHeaderModules:c,numFooterModules:d}=(0,s().K8)((()=>{if("form_layout_schema"===(null==r?void 0:r.area)){const e=n.getModules(),t=(0,Mm().jS)(r.area,e[r.area],i),o=t.nonMoveableHeaderModules,l=t.nonMoveableFooterModules,s="moveableFooterModules"in t?t.moveableFooterModules:[];return i?{numHeaderModules:o.length,numFooterModules:s.length+l.length}:{numHeaderModules:o.length,numFooterModules:l.length}}return{numHeaderModules:0,numFooterModules:0}}),[null==r?void 0:r.area,i,n]);return void 0===r||void 0===l||void 0===a||a-c-d==1?null:(0,L.jsx)($a().A,{focused:!1,popupType:R().z.Popup,alignmentToOrigin:"center",placementToOrigin:"right",buttonPopupStore:o,renderOrigin:e=>(0,L.jsx)(so().A,{...e,showChevron:!0,title:(0,L.jsx)(x().sA,{defaultMessage:"Move question",id:"formQuestionEditSettings.moveQuestion.title"}),icon:fm().t,disabled:!1}),render:t=>(0,L.jsx)(lS,{collectionSettingsStore:e,parent:t,currentModuleAndArea:r,currentModuleIndex:l,numChildrenInGroup:a,numHeaderModules:c,numFooterModules:d})})}function lS(e){const{collectionSettingsStore:t,parent:o,currentModuleIndex:i,currentModuleAndArea:l,numChildrenInGroup:a,numHeaderModules:c,numFooterModules:d}=e,u=(0,r().v3)(),{layoutStore:p,sessionId:g}=(0,Mc().LH)(),{isFirstInGroup:m,isLastInGroup:S}=(0,n.useMemo)((()=>({isFirstInGroup:0===i-c,isLastInGroup:i===a-d-1})),[i,a,c,d]),y=(0,s().K8)((()=>{if("form_conditional_modules"===l.area){const e=l.module.parentConditionalGroupId,t=l.module.parentModuleId;if(!e||!t)return;return{type:"absolute",area:"form_conditional_modules",parentConditionalGroupId:e,parentModuleId:t,index:0}}return{type:"absolute",area:"form_layout_schema",index:c}}),[l,c]);if(!y)return null;const f=[],h={key:"default",items:[{key:"moveUp",render:(e,t)=>m?null:(0,L.jsx)(so().A,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Move up",id:"formQuestionEditSettings.rearrangeQuestion.moveUp"}),icon:ym().arrowStraightUpIcon,disabled:!1}),action:()=>{(0,tm().E)({environment:u,layoutStore:p,position:{...y,index:i-1},moduleId:l.module.id,sessionId:g}),o.close(),D().os({collectionSettingsStore:t})}},{key:"moveDown",render:(e,t)=>S?null:(0,L.jsx)(so().A,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Move down",id:"formQuestionEditSettings.rearrangeQuestion.moveDown"}),icon:Sm().arrowStraightDownIcon,disabled:!1}),action:()=>{(0,tm().E)({environment:u,layoutStore:p,position:{...y,index:i+1},moduleId:l.module.id,sessionId:g}),o.close(),D().os({collectionSettingsStore:t})}},{key:"moveToTop",render:(e,t)=>m?null:(0,L.jsx)(so().A,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Move to top of group",id:"formQuestionEditSettings.rearrangeQuestion.moveToTop"}),icon:gm().Q,disabled:!1}),action:()=>{(0,tm().E)({environment:u,layoutStore:p,position:y,moduleId:l.module.id,sessionId:g}),o.close(),D().os({collectionSettingsStore:t})}},{key:"moveToBottom",render:(e,t)=>S?null:(0,L.jsx)(so().A,{...e,title:(0,L.jsx)(x().sA,{defaultMessage:"Move to bottom of group",id:"formQuestionEditSettings.rearrangeQuestion.moveToBottom"}),icon:Ap().arrowLineDownIcon,disabled:!1}),action:()=>{(0,tm().E)({environment:u,layoutStore:p,position:{...y,index:a-d-1},moduleId:l.module.id,sessionId:g}),o.close(),D().os({collectionSettingsStore:t})}}],render:e=>(0,L.jsx)(A().A,{...e})};f.push(h);const v={menuType:K().gu.Popup,width:280,maxHeight:400};return(0,L.jsx)(O().A,{...v,children:(0,L.jsx)(ce().Ay,{initialFocus:void 0,type:ce().Oh.Vertical,sections:f,resetFocusOnMouseOut:!0})})}function sS({collectionContextStore:e,moduleId:t,propertyId:o,formQuestionStore:i,propertySchema:l}){const a=(0,r().v3)(),c=(0,x().tz)(),{layoutStore:d,sessionId:u,setModuleSelection:g}=(0,Mc().LH)(),{collectionStore:m,autofocusedQuestionTextStore:y}=(0,Wg().cJ)(),f=(0,s().K8)((()=>d.getSpaceId()),[d]),h=(0,s().K8)((()=>{var e;return m?(null===(e=d.getNormalizedFormQuestionStoresForFormLayout({collectionSchema:m.getSchema()}))||void 0===e?void 0:e.length)??0:0}),[d,m]),v=(0,s().K8)((()=>{const e=d.getModules();return(0,Im().A)(t,e)}),[t,d]),b=(0,n.useCallback)((async()=>{f&&(h>=Xg().eb?xo().D6({label:c.formatMessage(Xg().Gi.questionLimitReachedFullMessage)}):await async function({environment:e,module:t,sessionId:o,layoutStore:n,collectionStore:i,collectionContextStore:r,autofocusedQuestionTextStore:l,area:s,spaceId:a,setModuleSelection:c}){const d=n.getModules().form_conditional_modules??{},u=(0,qg().Yg)({currentModule:t,nestedModules:d,includePlaceholders:!0}),g=new Map,m=new Map,y=new Map,f=i.getSchema(),h=p().default.checkGate({gateName:"bottom_page_discussions_enabled"}),{currentModuleIndex:v}=(0,km().y1)({modulesByArea:n.getModules(),moduleId:t.id,isBottomPageDiscussionsEnabled:h});for(const p of u.formQuestionDescendants){const t=(0,tt().Ay)();if(g.set(p.id,t),"formQuestion"!==p.type)continue;const o=lm().c.createChildStore(n,{table:Dm().lo,id:p.formQuestionId,spaceId:a}).getPropertyId();if(!o)continue;const r=await(0,or().W4)({environment:e,schema:f,property:o,parentStore:i,propertyGroups:void 0,spaceId:a});r&&(m.set(p.id,r),y.set(o,r.newProperty))}S().createAndCommit({userAction:"CollectionSettingsProperty.handleDuplicateClick",environment:e,canUndo:!0,perform:d=>{for(const c of u.formQuestionDescendants){const u=c.id===t.id,p="formQuestion"===c.type?lm().c.createChildStore(n,{table:Dm().lo,id:c.formQuestionId,spaceId:a}):void 0,S={type:"module_relative",direction:"below",area:"form_layout_schema",relativeToModuleId:c.id},f=c.parentConditionalGroupId&&c.parentModuleId?{type:"absolute",area:"form_conditional_modules",parentConditionalGroupId:c.parentConditionalGroupId,parentModuleId:g.get(c.parentModuleId)??c.parentModuleId,index:u&&void 0!==v?v+1:void 0}:void 0,h=u&&"form_layout_schema"===s?S:f;if(!h)return;Em({environment:e,module:c,collectionStore:i,layoutStore:n,formQuestionStore:p,collectionContextStore:r,position:h,sessionId:o,autofocusTitle:u?{shouldAutofocus:!0,autofocusedQuestionTextStore:l}:void 0,duplicateModuleMapping:g,questionModulePropertyUpdateMap:m,propertyIdMapping:y,transaction:d})}const p=g.get(t.id);p&&c({type:"existing_module",moduleId:p,isDragging:!1})}})}({environment:a,module:v.module,sessionId:u,collectionStore:m,layoutStore:d,collectionContextStore:e,autofocusedQuestionTextStore:y,area:v.area,spaceId:f,setModuleSelection:g}))}),[y,e,m,v.area,v.module,h,a,c,d,u,f,g]);return l&&(0,oe().vB)(l)&&f?(0,L.jsx)(so().A,{icon:Ba().V,title:(0,L.jsx)(x().sA,{id:"formQuestionEditSettings.duplicateQuestion.title",defaultMessage:"Duplicate question"}),onClick:b}):null}function aS({collectionContextStore:e,formQuestionStore:t}){const o=(0,r().v3)(),{collectionStore:n,formBlockStore:i}=(0,s().K8)((()=>{var t;return{collectionStore:e.collectionStore(),formBlockStore:null===(t=e.collectionViewStore())||void 0===t?void 0:t.getFormBlockStore()}}),[e]);return void 0!==(0,s().K8)((()=>{if(!n)return"generic_error";const e=n.getSchema();return e&&t?(0,Km().e)(o,t,e,null==i?void 0:i.hasSitePublicPermission()):"generic_error"}),[n,o,i,t])}var cS=()=>o(763996);function dS(e){const{collectionContextStore:t}=e,o=(0,I().X)("forms_apply_template"),n=(0,s().K8)((()=>t.collectionViewStore()),[t]),i=(0,s().K8)((()=>{if(!n)throw new Error("No CollectionViewStore found");return n.getFormBlockStore()}),[n]),r=(0,s().K8)((()=>t.collectionStore()),[t]);return o&&n&&i&&r?(0,L.jsx)(wg().I,{children:(0,L.jsx)(C().Ay,{collectionSettingsStore:e.collectionSettingsStore,title:(0,L.jsx)(x().sA,{id:"formSelectTemplateSettings.menuTitle",defaultMessage:"Select template"}),menuScrollerStyle:h().A.isMobile?void 0:{maxHeight:600},children:(0,L.jsx)("div",{style:{padding:"0 4px 4px"},children:(0,L.jsx)(uS,{collectionStore:r,formBlockStore:i})})})}):null}function uS(e){const{collectionStore:t,formBlockStore:o}=e,i=(0,r().v3)(),l=(0,s().K8)((()=>t.getTemplatePageStores()),[t]),a=(0,s().K8)((()=>t.getDefaultTemplatePageStore()),[t]),c=(0,s().K8)((()=>o.getFormSubmissionTemplate()),[o]),d=(0,n.useCallback)((e=>{(0,Ug().changeFormSubmissionTemplate)({environment:i,formBlockStore:o,template:e})}),[i,o]),u=l.map((e=>{const o={type:"page",pointer:e.pointer},i=pS(c,a,o),r={key:e.id,render:o=>(0,n.createElement)(cS().K,{...o,key:e.id,isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:e,isMobile:!1,locked:!0,isChecked:i,onCancelClick:Do().lQ,draggable:!1}),action:()=>{d(o)}};return r})),p=pS(c,a,{type:"empty"}),g={key:"empty",render:e=>(0,n.createElement)(cS().K,{...e,key:"empty",isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:void 0,isChecked:p,isMobile:!1,locked:!0,onCancelClick:Do().lQ,draggable:!1}),action:()=>{d({type:"empty"})}};return(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,L.jsx)(A().A,{...e,title:(0,L.jsx)(x().sA,{id:"formSelectTemplateSettings.menuHeader",defaultMessage:"Select template for form submissions"})}),items:[g,...u]}]})}function pS(e,t,o){return e?!!(0,Do().n4)(e,o):(void 0===t||"empty"===t.id)&&"empty"===o.type||!("page"!==o.type||!(0,Do().n4)(null==t?void 0:t.pointer,o.pointer))}const gS={type:"newView"},mS=(0,x().YK)({link:{defaultMessage:"Link...",id:"database.viewSettings.searchCollections.link"},search:{defaultMessage:"Search...",id:"database.viewSettings.searchCollections.search"}});function SS({existingCollectionStore:e,analytics:t}){const o=(0,r().v3)(),[i,l]=(0,n.useState)(""),a=(0,dr().ET)(),[c,d]=(0,s().K8)((()=>[a.settingsStore,a.settingsStore.state.hideSettingsHeader]),[a]),u=(0,s().K8)((()=>{const e=a.collectionViewBlockStore();if(!e)throw new Error("collectionViewBlockStore is required");return e}),[a]),g=(0,s().uB)(void 0,Ql().A),m=(0,n.useCallback)((n=>{pg({collectionContextStore:a,environment:o,collectionStore:n,collectionSettingsStore:c,createdCollectionStore:e,userAction:"LinkToDatabaseMenu.handleAcceptExistingSource",analytics:t})}),[a,c,e,o,t]),{suggestedSection:S,resultsSection:y,fetchMoreResults:h,searchSessionId:v,searchSessionFlowNumber:w}=Ss({input:i,collectionContextStore:a,hideSearchTitle:d,parentStore:u,context:xs.Source,handleAcceptExistingCollection:m,suggestionConfig:gS,peopleBlocksToInclude:"none"}),j=es(a),_=(0,n.useRef)(0);(0,n.useEffect)((()=>{_.current=w}),[w]);const I=(0,s().K8)((()=>"on"===p().default.getEligibleGroup({experimentId:"search_surfaces_collection_search",defaultGroup:"unassigned"})),[]);(0,n.useEffect)((()=>((0,f().u)({environment:o,event:{eventName:"source_collection_search_open",eventProperties:{search_session_id:v,using_secondary_search_surfaces_hook:I,source:"source"}}}),()=>{(0,f().u)({environment:o,event:{eventName:"source_collection_search_close",eventProperties:{search_session_id:v,source:"source",using_secondary_search_surfaces_hook:I,search_session_flow_number:_.current}}})})),[o,I,v]);const k=(0,s().K8)((()=>null!=a&&a.isInHomeWidgetStore.state?mS.search:mS.link),[a]);return(0,L.jsxs)(C().Ay,{collectionSettingsStore:c,title:(0,L.jsx)(x().sA,{defaultMessage:"Link to existing data source",id:"database.viewSettings.createViewTab.linkToExistingDataSource"}),children:[(0,L.jsx)(A().A,{shouldShowBottomDivider:!1,children:(0,L.jsx)(pt().Ay,{value:i,onChange:e=>{l(e.target.value),g.setState({focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})},focusInitial:!0,placeholder:oo().A.formatMessage(k),showClearButton:!0})}),(0,L.jsx)(ce().Ay,{type:ce().Oh.Vertical,initialFocus:void 0,resetFocusOnMouseOut:!0,sections:[S,y,j].filter(b().O9)}),I?(0,L.jsx)(Gl().A,{onChange:(e,t)=>{h&&e<$l().A.incrementScrollOffset&&h()}}):null]})}function yS(e){var t;const{collectionSettingsStore:o,collectionContextStore:d}=e,u=(0,r().v3)(),[p,m]=(0,n.useState)(),S=(0,s().K8)((()=>(0,yl().S)(o)),[o]),y=(0,s().K8)((()=>d.getViewType()),[d]),f=(0,s().K8)((()=>d.allowScrollingWhenCollectionSettingsSidebarOpen()),[d]),h=(0,s().K8)((()=>o.state.closeOnEscape),[o]);(0,l().A)({capture:!f,preventType:a().A.Y});const v=(0,s().K8)((()=>{if("property"===(null==S?void 0:S.type))return(0,bo().Jq)({collectionContextStore:d,property:S.property})}),[d,S]);(0,n.useEffect)((()=>{if(S&&p!==S)if("propertyType"===S.type){var e,t,o,n;g(u,{view_type:y,menu:S.type,is_database_name_empty:!Boolean(null==d||null===(e=d.collectionStore())||void 0===e||null===(e=e.getName())||void 0===e?void 0:e.toString()),collection_id:null===(t=d.collectionStore())||void 0===t?void 0:t.id,collection_view_id:null===(o=d.collectionViewStore())||void 0===o?void 0:o.id,collection_view_block_id:null===(n=d.collectionViewBlockStore())||void 0===n?void 0:n.id,database_visit_id:d.visitSessionId,..."button"===(null==v?void 0:v.type)&&{builder_type:"modal"}})}else{var i,r,l;const e=(0,bo().u7)(S);g(u,{view_type:y,menu:S.type,collection_id:null===(i=d.collectionStore())||void 0===i?void 0:i.id,collection_view_id:null===(r=d.collectionViewStore())||void 0===r?void 0:r.id,collection_view_block_id:null===(l=d.collectionViewBlockStore())||void 0===l?void 0:l.id,database_visit_id:d.visitSessionId,builder_type:"modal",data_source_from:null==e?void 0:e.dataSourceFrom,data_source_session_id:null==e?void 0:e.dataSourceSessionId})}m(S)}),[d,S,u,p,null==v?void 0:v.type,y]);const x=(0,n.useCallback)((e=>{!1!==h&&(0,i().SQ)({event:e,context:i().y$.Click,callback:()=>{D().os({collectionSettingsStore:o})}})}),[h,o]),b=function(e){return{main:t=>(0,L.jsx)(fS,{tab:t,...e}),source:()=>(0,L.jsx)(gy,{...e}),createViewSource:t=>(0,L.jsx)(ay,{tab:t,...e}),addNewDataSource:t=>(0,L.jsx)(sy,{tab:t,...e}),createSyncedViewSource:t=>(0,L.jsx)(vS,{tab:t,...e}),selectAccountForExternalSource:t=>(0,L.jsx)(xS,{tab:t,...e}),shareSyncedView:t=>(0,L.jsx)(bS,{tab:t,...e}),propertyType:t=>(0,L.jsx)(CS,{tab:t,...e}),propertyAiAutofill:t=>(0,L.jsx)(jS,{tab:t,...e}),createView:t=>(0,L.jsx)(wS,{tab:t,...e}),propertyAgentAutofill:t=>(0,L.jsx)(AS,{tab:t,...e}),duplicateExistingView:()=>(0,L.jsx)(ua,{...e}),properties:t=>(0,L.jsx)(_S,{tab:t,...e}),propertyVisibility:t=>(0,L.jsx)(IS,{tab:t,...e}),property:t=>(0,L.jsx)(kS,{tab:t,...e}),deletedProperties:t=>(0,L.jsx)(MS,{tab:t,...e}),selectRelationSource:t=>(0,L.jsx)(TS,{tab:t,...e}),setupRelation:t=>(0,L.jsx)(PS,{tab:t,...e}),selectViewsModuleSource:t=>(0,L.jsx)(BS,{tab:t,...e}),setupViewsModule:t=>(0,L.jsx)(FS,{tab:t,...e}),layout:()=>(0,L.jsx)(zu,{...e}),group:t=>(0,L.jsx)(VS,{tab:t,...e}),groupByProperty:t=>(0,L.jsx)(DS,{tab:t,...e}),subitem:t=>(0,L.jsx)(RS,{tab:t,...e}),arrowsBy:t=>(0,L.jsx)(KS,{tab:t,...e}),githubConfig:t=>(0,L.jsx)(zS,{tab:t,...e}),filters:()=>(0,L.jsx)(yu,{...e}),phoneFilterAndSort:()=>(0,L.jsx)(Wu,{...e}),groupByNumber:t=>(0,L.jsx)(ES,{tab:t,...e}),filter:t=>(0,L.jsx)(US,{tab:t,...e}),createFilter:()=>(0,L.jsx)(zd,{...e}),createSort:()=>(0,L.jsx)($d,{...e}),sort:()=>(0,L.jsx)(ip,{...e}),follow:()=>(0,L.jsx)(Mu,{...e}),page:()=>(0,L.jsx)(hS,{...e}),editProperties:t=>(0,L.jsx)(WS,{tab:t,...e}),editScimProperties:t=>(0,L.jsx)(HS,{tab:t,...e}),automationSettings:t=>(0,L.jsx)(GS,{tab:t,...e}),mobileCreateAutomation:t=>(0,L.jsx)(YS,{tab:t,...e}),mobileEditAutomation:t=>(0,L.jsx)(qS,{tab:t,...e}),mobileEditButtonAutomation:t=>(0,L.jsx)(JS,{tab:t,...e}),externalProjectsSyncSettings:t=>(0,L.jsx)($S,{tab:t,...e}),connectedRelationDatabaseActions:t=>(0,L.jsx)(QS,{tab:t,...e}),dependencies:t=>(0,L.jsx)(NS,{tab:t,...e}),relationFeaturesAdvancedSettings:t=>(0,L.jsx)(LS,{tab:t,...e}),subitemV2:t=>(0,L.jsx)(OS,{tab:t,...e}),sprintSettings:t=>(0,L.jsx)(XS,{tab:t,...e}),confirmAddTemplate:t=>(0,L.jsx)(ny,{tab:t,...e}),views:t=>(0,L.jsx)(iy,{tab:t,...e}),linked_collections:t=>(0,L.jsx)(ry,{tab:t,...e}),connectionFeatures:t=>(0,L.jsx)(ly,{tab:t,...e}),formQuestionEditSettings:t=>(0,L.jsx)(ZS,{tab:t,...e}),formQuestionCreateSettings:t=>(0,L.jsx)(ey,{tab:t,...e}),formCustomizeSettings:t=>(0,L.jsx)(ty,{tab:t,...e}),formSelectTemplate:t=>(0,L.jsx)(oy,{tab:t,...e}),linkToDatabase:t=>(0,L.jsx)(cy,{tab:t,...e}),databaseSettings:t=>(0,L.jsx)(dy,{tab:t,...e}),databaseProperties:t=>(0,L.jsx)(uy,{tab:t,...e}),manageDataSources:t=>(0,L.jsx)(py,{tab:t,...e}),conditionalColors:()=>(0,L.jsx)(Ve,{...e}),createConditionalColor:()=>(0,L.jsx)(De,{...e})}}(e),C=S?null===(t=b[S.type])||void 0===t?void 0:t.call(b,S):null;return C?(0,L.jsx)(c().N,{debugName:"CollectionSettings",capture:!0,onEsc:x,children:C}):null}function fS(e){const{collectionContextStore:t,tab:o}=e,n=(0,s().K8)((()=>{var e;return null===(e=t.collectionViewStore())||void 0===e?void 0:e.id}),[t]),i=(0,s().K8)((()=>t.collectionViewStore()),[t]);return"main"===o.type&&i?(0,L.jsx)(Uu().gt,{selectViewNameInitial:o.selectViewNameInitial,collectionViewStore:i,...e},n):null}function hS(e){const{collectionContextStore:t}=e,o=(0,r().v3)(),n=(0,s().K8)((()=>t.collectionViewStore()),[t]);return n?(0,L.jsx)(C().Ay,{...e,title:"Select page to display",children:(0,L.jsx)("div",{style:{margin:12},children:(0,L.jsx)(Ee().A,{showClearButton:!0,placeholder:"Enter page ID",focusInitial:!0,onChange:e=>{Qi.setState({pageId:e.target.value})},onSubmit:()=>{const e=Qi.state.pageId;if(!e)return null;S().createAndCommit({userAction:"collectionSettings.pageView.selectPage",environment:o,canUndo:!0,perform:t=>{m().zA({stores:[n],update:{page_pointer:{id:(0,d().G2)(e),spaceId:t.spaceId,table:"block"}},transaction:t})}})}})})}):null}function vS(e){const{tab:t}=e;return"createSyncedViewSource"!==t.type?null:(0,L.jsx)(bl().a,{...e,...t})}function xS(e){const{tab:t}=e;return"selectAccountForExternalSource"!==t.type?null:(0,L.jsx)(hl,{...e,...t})}function bS(e){const{tab:t}=e;return"shareSyncedView"!==t.type?null:(0,L.jsx)(Rd,{...e,...t})}function CS(e){const{tab:t}=e;return"propertyType"!==t.type?null:(0,L.jsx)(gd,{...e,...t})}function wS(e){const{tab:t}=e;return"createView"!==t.type?null:(0,L.jsx)(rg,{...e,...t})}function jS(e){const{tab:t}=e;return"propertyAiAutofill"!==t.type?null:(0,L.jsx)(id,{...e,...t})}function AS(e){const{tab:t}=e;return"propertyAgentAutofill"!==t.type?null:(0,L.jsx)(Sc,{...e,...t})}function _S(e){const{tab:t}=e;return"properties"!==t.type?null:(0,L.jsx)(Hu().A,{...e,propertiesMenuType:"editPropertiesAndVisibility",timelineViewTab:t.timelineViewTab})}function IS(e){const{tab:t}=e;return"propertyVisibility"!==t.type?null:(0,L.jsx)(Hu().A,{...e,propertiesMenuType:"propertyVisibilityOnly",timelineViewTab:t.timelineViewTab})}function kS(e){const{tab:t}=e;return"property"!==t.type?null:(0,L.jsx)(ac().t_,{...e,...t,titleOverride:e.collectionSettingsPropertyTitleOverride},t.property)}function MS(e){const{tab:t}=e;return"deletedProperties"!==t.type?null:(0,L.jsx)(ta,{...t,...e})}function TS(e){const{tab:t}=e;return"selectRelationSource"!==t.type?null:(0,L.jsx)(md,{...e,...t})}function PS(e){const{tab:t}=e;return"setupRelation"!==t.type?null:(0,L.jsx)(Ad,{...e,...t})}function BS(e){const{tab:t}=e;return"selectViewsModuleSource"!==t.type?null:(0,L.jsx)(Sd,{...e,...t})}function FS(e){const{tab:t}=e;return"setupViewsModule"!==t.type?null:(0,L.jsx)(Td,{...e,...t})}function VS(e){const{tab:t}=e;return"group"!==t.type?null:(0,L.jsx)(Tu().oz,{...e,...t})}function DS(e){const{tab:t}=e;return"groupByProperty"!==t.type?null:(0,L.jsx)(Ku,{...e,...t})}function ES(e){const{tab:t}=e;return"groupByNumber"!==t.type?null:(0,L.jsx)(Eu,{...e,...t})}function RS(e){const{tab:t}=e;return"subitem"!==t.type?null:(0,L.jsx)(op,{...e,...t,formatSetting:"subitem"})}function OS(e){const{tab:t}=e;return"subitemV2"!==t.type?null:(0,L.jsx)(tl,{...e,feature:"subitem",from:t.from})}function KS(e){const{tab:t}=e;return"arrowsBy"!==t.type?null:(0,L.jsx)(op,{...e,...t,formatSetting:"timeline_arrows_by"})}function NS(e){const{tab:t}=e;return"dependencies"!==t.type?null:(0,L.jsx)(tl,{...e,feature:"timeline_arrows_by",from:t.from})}function LS(e){const{tab:t}=e;return"relationFeaturesAdvancedSettings"!==t.type?null:(0,L.jsx)(ml,{...e,feature:t.feature})}function zS(e){const{tab:t}=e;return"githubConfig"!==t.type?null:(0,L.jsx)(wa().A,{...e,property:t.property})}function US(e){const{tab:t}=e;return"filter"!==t.type?null:(0,L.jsx)(Jd,{...e})}function WS(e){const{tab:t}=e;return"editProperties"!==t.type?null:(0,L.jsx)(Hu().A,{...e,propertiesMenuType:"editPropertiesOnly",timelineViewTab:t.timelineViewTab})}function HS(e){const{tab:t}=e;return"editScimProperties"!==t.type?null:(0,L.jsx)(Ca,{...e})}function GS(e){const{tab:t}=e;return"automationSettings"!==t.type?null:(0,L.jsx)(Ke,{...e,tabSettings:t})}function $S(e){const{tab:t}=e;return"externalProjectsSyncSettings"!==t.type?null:(0,L.jsx)(Gn,{...e,tabSettings:t})}function QS(e){const{tab:t}=e;return"connectedRelationDatabaseActions"!==t.type?null:(0,L.jsx)(go,{...e,tabSettings:t})}function YS(e){const{tab:t,collectionContextStore:o,collectionSettingsStore:n}=e;return"mobileCreateAutomation"!==t.type?null:(0,L.jsx)(y().u,{collectionSettingsStore:n,collectionContextStore:o,mode:"create",from:t.from,source:t.source})}function qS(e){const{tab:t,collectionContextStore:o,collectionSettingsStore:n}=e;if("mobileEditAutomation"!==t.type)return null;const{automationId:i}=t;return(0,L.jsx)(y().u,{collectionSettingsStore:n,collectionContextStore:o,mode:"update",source:t.source,automationId:i})}function JS(e){const{tab:t,collectionContextStore:o,collectionSettingsStore:n}=e;return"mobileEditButtonAutomation"!==t.type?null:(0,L.jsx)(y().N,{collectionSettingsStore:n,collectionContextStore:o,property:t.property,propertySchema:t.propertySchema})}function XS({tab:e,collectionContextStore:t,collectionSettingsStore:o}){return"sprintSettings"!==e.type?null:(0,L.jsx)(Ti,{collectionContextStore:t,collectionSettingsStore:o,from:e.from})}function ZS({tab:e,collectionContextStore:t,collectionSettingsStore:o}){return"formQuestionEditSettings"!==e.type?null:(0,L.jsx)(Um,{collectionContextStore:t,collectionSettingsStore:o,formQuestionId:e.formQuestionId,moduleId:e.moduleId})}function ey({tab:e,collectionContextStore:t,collectionSettingsStore:o}){return"formQuestionCreateSettings"!==e.type?null:(0,L.jsx)(um,{collectionContextStore:t,collectionSettingsStore:o,moduleId:e.moduleId,area:e.area,parentModuleId:e.parentModuleId,parentConditionalGroupId:e.parentConditionalGroupId})}function ty({tab:e,collectionContextStore:t,collectionSettingsStore:o}){return"formCustomizeSettings"!==e.type?null:(0,L.jsx)(Ng,{collectionContextStore:t,collectionSettingsStore:o})}function oy({tab:e,collectionContextStore:t,collectionSettingsStore:o}){return"formSelectTemplate"!==e.type?null:(0,L.jsx)(dS,{collectionContextStore:t,collectionSettingsStore:o})}function ny({tab:e,collectionSettingsStore:t}){return"confirmAddTemplate"!==e.type?null:(0,L.jsx)(Yi().W3,{template:e.template,collectionSettingsStore:t})}function iy({tab:e,collectionSettingsStore:t,collectionContextStore:o}){return"views"!==e.type?null:(0,L.jsx)(Yi().vK,{collectionSettingsStore:t,collectionContextStore:o})}function ry({tab:e}){return"linked_collections"!==e.type?null:(0,L.jsx)(Yi().P6,{})}function ly(e){const{tab:t}=e;return"connectionFeatures"!==t.type?null:(0,L.jsx)(Le,{...e})}function sy(e){const{tab:t}=e;return"addNewDataSource"!==t.type?null:(0,L.jsx)(Jp,{collectionStore:t.collectionStore,analytics:t.analytics,...e})}function ay(e){const{tab:t}=e;return"createViewSource"!==t.type?null:(0,L.jsx)(fg,{existingCollectionStore:t.existingCollectionStore,createdCollectionRecordPointerMap:t.createdCollectionRecordPointerMap,analytics:t.analytics,...e})}function cy(e){const{tab:t}=e;return"linkToDatabase"!==t.type?null:(0,L.jsx)(SS,{existingCollectionStore:t.existingCollectionStore,analytics:t.analytics,...e})}function dy(e){const{tab:t}=e;return"databaseSettings"!==t.type?null:(0,L.jsx)(Fl,{...e})}function uy(e){const{tab:t}=e;return"databaseProperties"!==t.type?null:(0,L.jsx)(kl,{...e})}function py(e){const{tab:t}=e;return"manageDataSources"!==t.type?null:(0,L.jsx)(oc,{...e,analytics:t.analytics})}function gy(e){const{collectionContextStore:t}=e;return"page"===(0,s().K8)((()=>t.getViewType()),[t])?(0,L.jsx)(sc,{...e}):(0,L.jsx)(Gs,{...e})}},444091:(e,t,o)=>{o.d(t,{A:()=>ee,a:()=>Z});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(672577),o(581454);var n=o(296540),i=()=>o(484714),r=()=>o(56366),l=()=>o(401497),s=()=>o(611648),a=()=>o(252291),c=()=>o(98126),d=()=>o(160432),u=()=>o(187174),p=()=>o(513416),g=()=>o(395546),m=()=>o(344417),S=()=>o(84262),y=()=>o(462853),f=()=>o(69708),h=()=>o(100622),v=()=>o(778078),x=()=>o(534177),b=()=>o(939768),C=()=>o(559926),w=()=>o(559506),j=()=>o(884107),A=()=>o(901389),_=()=>o(949237),I=()=>o(56394),k=()=>o(760217),M=()=>o(419357),T=()=>o(939740),P=()=>o(2143),B=()=>o(89924),F=()=>o(859428),V=()=>o(572088),D=()=>o(476492),E=()=>o(972435),R=()=>o(553965),O=()=>o(817126),K=()=>o(53137),N=()=>o(147503),L=()=>o(284371),z=()=>o(125565),U=o(474848);function W(e){const{onClick:t,integration:o,accountName:n}=e,i=(0,l().IS)((e=>({accountSelection:{padding:"8px",borderTop:`1px solid ${e.regularDividerColor}`,cursor:"pointer"},accountSelectionLabel:{fontWeight:L().Wy.medium,paddingInlineStart:4,paddingTop:4}})),[]);return(0,U.jsx)("div",{style:i.accountSelection,children:(0,U.jsxs)("div",{onClick:t,children:[(0,U.jsx)(z().A,{isSecondaryColor:!0,isSmall:!0,style:i.accountSelectionLabel,children:(0,U.jsx)(f().sA,{id:"collectionSettingsCreateExternalViewPicker.currentAccountSection.label",defaultMessage:"Connected to {integration}",values:{integration:o.name}})}),(0,U.jsx)(F().A,{renderTooltip:()=>(0,U.jsx)("span",{children:n}),placement:"left",textWrap:!0,render:t=>(0,U.jsx)(k().A,{showExtensionArrow:!0,focused:!1,...(0,R().A)(t||{},e),title:n,icon:(0,U.jsx)("img",{style:{width:18},src:o.info.icon})})})]})})}var H=()=>o(631524),G=()=>o(14959),$=()=>o(510683),Q=()=>o(187820),Y=()=>o(152197),q=()=>o(444768),J=()=>o(735695);function X(e){const{collectionContextStore:t,integration:o}=e,n=(0,l().eP)(),s=(0,r().K8)((()=>t.collectionStore()),[t]),a=(0,r().K8)((()=>null==s?void 0:s.getIcon()),[s]),c=(0,i().v3)(),d=(0,Y().r)(),u=(0,l().IS)((e=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",paddingTop:8,paddingInlineEnd:16,paddingBottom:16,paddingInlineStart:8},authenticationBody:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",paddingTop:0,paddingInlineEnd:16,paddingBottom:16,paddingInlineStart:16,textAlign:"center"},settingsMenuSubHeading:{display:"inline",fontSize:14,marginTop:4,marginInlineEnd:20,marginBottom:20,marginInlineStart:20,color:e.text.secondary,textAlign:"center"},settingsMenuAuthenticationButton:{fontSize:14,height:32,color:e.text.inversePrimary}})),[]),{background:p,hoveredBackground:g,pressedBackground:m}=(0,G().u)(o,n);return(0,U.jsx)(J().Ay,{...e,title:(0,U.jsx)(f().sA,{defaultMessage:"Connect to {integration}",id:"collectionSettingsCreateExternalViewPicker.authenticateHeader.title",values:{integration:o.name}}),children:(0,U.jsx)("div",{style:u.settingsMenu,children:(0,U.jsxs)("div",{style:u.authenticationBody,children:[(0,U.jsx)(Q().B6,{disabled:!0,bucket:"secure",store:s,icon:a,iconRecordCategory:"collection",size:40,isEmptyPage:!1,style:{marginBottom:6}}),(0,U.jsx)("div",{style:u.settingsMenuSubHeading,children:(0,U.jsx)(f().sA,{defaultMessage:"Link your {integration} account for richer content previews and seamless imports.",id:"collectionSettingsCreateExternalViewPicker.authenticateBody.title",values:{integration:o.name}})}),(0,U.jsx)(H().p,{onClick:()=>{d&&($().Jq({environment:c,integration:o,spaceId:d,from:"placeholder_root_external_collection_view_block"}),q().A.reset())},style:{background:p,...u.settingsMenuAuthenticationButton},hoveredStyle:{background:g},pressedStyle:{background:m},children:(0,U.jsx)(f().sA,{defaultMessage:"Connect to {integration}",id:"collectionSettingsCreateExternalViewPicker.authenticateButton.title",values:{integration:o.name}})})]})})})}function Z(e){const{collectionSettingsStore:t,collectionContextStore:o,externalAuthentication:n}=e,i=(0,r().K8)((()=>o.collectionStore()),[o]),l=(0,r().K8)((()=>{if(!i)return;const e=i.getFormat().integration_id;return K().A.integrations.state.find((t=>t.id===e))}),[i]),s=(0,r().K8)((()=>!!l&&(0,V().jw)(l.id).length>0),[l]),a=(0,r().K8)((()=>{var e;return null==i||null===(e=i.getSpaceStore())||void 0===e?void 0:e.canEdit()}),[i]);if(!l)return null;if(!i)return null;if(!a)return null;const c=s?(0,U.jsx)(ne,{...e,collectionContextStore:o,collectionSettingsStore:t,integration:l,externalAuthentication:n}):(0,U.jsx)(X,{...e,collectionContextStore:o,collectionSettingsStore:t,integration:l}),d=(0,y().l)(null==l?void 0:l.id);return d?(0,U.jsx)(ee,{featureName:d,children:c}):c}function ee(e){const{children:t,featureName:o}=e,n=(0,O().G9)({featureName:o});return(0,S().e2)(n)?t:null}function te(e){var t;return null===(t=e.integration.info)||void 0===t||null===(t=t.original_url_patterns)||void 0===t?void 0:t.filter((e=>{var t;return null===(t=e.additional_types)||void 0===t?void 0:t.collection})).find((({regex:t})=>new RegExp(t).test(e.url)))}const oe=(0,f().YK)({all:{id:"collectionSettingsCreateExternalViewPicker.filters.all",defaultMessage:"All"},issues:{id:"collectionSettingsCreateExternalViewPicker.filters.issues",defaultMessage:"Issues"},pull_requests:{id:"collectionSettingsCreateExternalViewPicker.filters.pullRequests",defaultMessage:"Pull Requests"},board:{id:"collectionSettingsCreateExternalViewPicker.filters.boards",defaultMessage:"Boards"},project:{id:"collectionSettingsCreateExternalViewPicker.filters.projects",defaultMessage:"Projects"},Releases:{id:"collectionSettingsCreateExternalViewPicker.filters.releases",defaultMessage:"Releases"},"Pull Request":{id:"collectionSettingsCreateExternalViewPicker.filters.PullRequests",defaultMessage:"Pull Requests"},Issues:{id:"collectionSettingsCreateExternalViewPicker.filters.Issues",defaultMessage:"Issues"}});function ne(e){const{integration:t,collectionContextStore:o,collectionSettingsStore:S,externalAuthentication:y}=e,[O,L]=(0,n.useState)(""),z=(0,r().K8)((()=>{const e=K().A.state;return e.loaded?e.externalAuthentications.filter((e=>e.integration_id===t.id)):[]}),[t]),H=(0,r().K8)((()=>y||(z.length?z[0]:null)),[z,y]),[G,$]=(0,n.useState)(!1),[Q,Y]=(0,n.useState)(null),q=(0,l().IS)((e=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px"},settingsMenuSearchBox:{background:e.background.primary,marginBottom:10},syncSourceButton:{width:"100%",display:"flex",justifyContent:"center"},noResults:{width:"100%",paddingBottom:10,display:"flex",justifyContent:"center",fontSize:14,color:e.text.secondary},suggestionBox:{display:"flex",alignItems:"center",fontSize:12,color:h().Tj.white,background:h().Tj.blue,borderRadius:6,padding:10,boxShadow:e.shadowMD,alignSelf:"center",maxWidth:"80%",gap:6},errorMessage:{alignSelf:"center",padding:10,fontSize:14,color:e.errorText},syncingData:{width:"100%",paddingBottom:10,display:"flex",justifyContent:"center",fontSize:14,color:e.text.secondary},filterContainer:{position:"relative",flexGrow:0,overflow:"hidden"},filterContainerScroller:{display:"flex",alignItems:"center",padding:"8px 12px"}})),[]),Z=(0,r().K8)((()=>o.collectionStore()),[o]),ee=(0,r().K8)((()=>o.collectionViewBlockStore()),[o]),ne=(0,i().v3)(),[{value:ie,status:re}]=(0,u().Yb)((async()=>{if(!H)return;const e=H.parent_id;return w().callApi({eventName:"listExternalCollections",environment:ne,data:{bot_id:e}})}),[ne,H]),le="success"===(null==ie?void 0:ie.type)&&"data"in ie.data?ie.data.data:[],se="success"===(null==ie?void 0:ie.type)&&"error"in ie.data?ie.data.error:null,ae=le.filter((e=>!Q||e.type===Q)),ce=ae.length?(0,v().Ay)(O,ae,(e=>e.title)):[],de=Array.from(new Set(le.map((e=>e.type)))),ue=te({integration:t,url:O}),pe=async e=>{if($(!0),!Z||!ee)return;const n=e||O,i=te({integration:t,url:n});if(!i)return $(!1),void A().ui({items:[{label:(0,U.jsx)(f().sA,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.copyDebuggingInformation",defaultMessage:"Copy debugging information"}),color:"blue",onAccept:async()=>{const e=await j().R.clipboardActions.load();e.copyString({environment:ne,stringValue:JSON.stringify({botId:null==H?void 0:H.parent_id,url:n},null,2),copiedMessage:e.clipboardMessages.copiedToClipboard})}},{label:(0,U.jsx)(f().sA,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.closeButton",defaultMessage:"Close"}),onAccept:()=>{}}],showCancel:!1,keepFocus:!1,message:(0,U.jsx)(f().sA,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.title",defaultMessage:"This source is currently not supported. Please try a different source."})});const r=(0,V().jw)(t.id);await _().jW({environment:ne,url:n,botIds:r.map((e=>e.id)),externalCollectionStore:Z,externalCollectionViewBlockStore:ee,integrationId:t.id});const{host:l}=(0,b().qg)(n);C().lR(ne,{...(0,D().sl)(o),integrationId:t.id,type:"collection",entity:i.name,domain:l||"",from:"external_picker_settings"}),N().R8({collectionSettingsStore:S,item:{type:"shareSyncedView",integrationName:t.name,integrationIcon:t.info.icon}}),$(!1)};if(!Z||!ee)return null;const ge=de.length>1?(0,U.jsx)("div",{style:q.filterContainer,children:(0,U.jsxs)(P().H,{type:s().A.X,style:q.filterContainerScroller,children:[(0,U.jsx)(I().A,{title:(0,U.jsx)("span",{children:E().A.formatMessage(oe.all)}),on:!(0,x().Pe)(Q),hideChevron:!0,onClick:()=>{Y(null)}},"all"),de.map((e=>(0,U.jsx)(I().A,{title:(0,U.jsx)("span",{children:E().A.formatMessage(oe[e])}),on:Q===e,hideChevron:!0,onClick:()=>{Y((t=>t===e?null:e))}},e)))]})}):null,me=ue?(0,U.jsx)("div",{style:q.syncSourceButton,children:(0,U.jsx)(d().A,{colorPalette:"blue",size:"lg",onClick:()=>{pe()},disabled:!1,children:(0,U.jsx)(f().sA,{id:"collectionSettingsCreateExternalViewPicker.syncSourceButton.label",defaultMessage:"Sync Source"})})}):null,Se=ue||le.length&&ce.length?null:(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)("div",{style:q.noResults,children:(0,U.jsx)(f().sA,{id:"collectionSettingsCreateExternalViewPicker.noResults.text",defaultMessage:"No results"})}),(0,U.jsxs)("div",{style:q.suggestionBox,children:[(0,U.jsx)(a().I,{icon:g().infoCircleSmallIcon,size:"sm"}),(0,U.jsx)(f().sA,{defaultMessage:"Try different search or paste any {integration} URL",id:"collectionSettingsCreateExternalViewPicker.noResults.help",values:{integration:t.name}})]})]}),ye=le.length&&ce.length?(0,U.jsx)(T().Ay,{type:T().Oh.Vertical,initialFocus:0,sections:[{key:"collections",items:ce.map((e=>{const t={key:e.url,render:t=>(0,U.jsx)(F().A,{renderTooltip:()=>(0,U.jsx)("span",{children:e.title}),placement:"left",textWrap:!0,render:o=>(0,U.jsx)(k().A,{...(0,R().A)(o||{},t),title:e.title,icon:(0,U.jsx)("img",{style:{width:18},src:e.icon}),caption:e.parent.title})}),action:t=>{"stopPropagation"in t.event&&t.event.stopPropagation(),pe(e.url)}};return t})),render:e=>(0,U.jsx)(B().A,{...e,disableMobilePadding:!0})}]}):null,fe="pending"===re||"idle"===re||G;if(!H||se&&(se.status===p().nG.UNAUTHORIZED||se.status===p().nG.FORBIDDEN))return(0,U.jsx)(X,{collectionContextStore:o,collectionSettingsStore:S,integration:t});const he="rejected"===re||"failed"===(null==ie?void 0:ie.type)||se,ve=(0,U.jsx)(W,{onClick:()=>{N().a2({collectionSettingsStore:S,item:{type:"selectAccountForExternalSource",integration:t,onAccountSelect:e=>{N().a2({collectionSettingsStore:S,item:{type:"createSyncedViewSource",externalAuthentication:e}})}}})},integration:t,accountName:H.account_name});return(0,U.jsx)(J().Ay,{...e,footer:me||G?null:ve,title:(0,U.jsx)(f().sA,{defaultMessage:"Select from {integration}",id:"collectionSettingsCreateExternalViewPicker.title",values:{integration:t.name}}),header:!fe&&"resolved"===re&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(M().Ay,{inputLeft:(0,U.jsx)(M().Zf,{icon:m().u}),onSubmit:()=>{ue&&pe()},style:q.settingsMenuSearchBox,focusInitial:!0,value:O,onChange:e=>{L(e.target.value)},placeholder:"Search source or paste a link..."}),ue?null:ge]}),children:(0,U.jsxs)("div",{style:q.settingsMenu,children:[he?(0,U.jsx)("div",{style:q.errorMessage,children:(0,U.jsx)(f().sA,{id:"collectionSettingsCreateExternalViewPicker.error.unknown",defaultMessage:"Something went wrong.",values:{integration:t.name}})}):void 0,fe?G?(0,U.jsxs)("div",{style:q.syncingData,children:[(0,U.jsx)("span",{children:(0,U.jsx)(f().sA,{id:"collectionSettingsCreateExternalViewPicker.settingUpSync",defaultMessage:"Setting up sync..."})}),(0,U.jsx)(c().A,{style:{alignSelf:"center"}})]}):(0,U.jsxs)("div",{style:q.syncingData,children:[(0,U.jsx)("span",{children:(0,U.jsx)(f().sA,{id:"collectionSettingsCreateExternalViewPicker.loadingData",defaultMessage:"Loading available sources..."})}),(0,U.jsx)(c().A,{style:{alignSelf:"center"}})]}):void 0,fe||"resolved"!==re?void 0:(0,U.jsxs)(U.Fragment,{children:[me,Se,ye]})]})})}},446966:(e,t,o)=>{o.d(t,{E:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.16 3.72 15.57 12.55",svg:(0,o(474848).jsx)("path",{d:"M9.5 9.374a.625.625 0 1 0 0 1.25h7.6a.625.625 0 1 0 0-1.25zm-2-5a.625.625 0 1 0 0 1.25H17a.625.625 0 1 0 0-1.25zM10.876 15c0-.346.28-.626.625-.626h5.6a.625.625 0 1 1 0 1.25h-5.6a.625.625 0 0 1-.625-.625M2.215 4.263c-.148-.237.035-.535.33-.535h2.287c.294 0 .477.298.33.535L4.016 6.094a.395.395 0 0 1-.658 0zm2.329 4.465c-.294 0-.477.298-.329.535l1.144 1.831a.395.395 0 0 0 .658 0l1.144-1.831c.148-.237-.035-.535-.329-.535zm1.671 5.535c-.148-.237.035-.535.33-.535h2.287c.294 0 .477.298.33.535l-1.145 1.831a.395.395 0 0 1-.658 0z"})},i=(0,o(340498).wt)("listToggleIndent",n)},448701:(e,t,o)=>{o.d(t,{R:()=>S,z:()=>y});var n=o(296540),i=()=>o(484714),r=()=>o(56366),l=()=>o(90907),s=()=>o(701751),a=()=>o(436696),c=()=>o(222299),d=()=>o(859428),u=()=>o(527438),p=()=>o(497222),g=o(474848);function m({collectionContextStore:e}){const t=e.collectionViewBlockStore(),o=void 0!==e.viewsModuleContextStore.state,n=Boolean(e.isDashboardWidget());return!(o||n||!t)&&(null==t?void 0:t.canEditCollection())}function S({collectionContextStore:e}){if((0,r().K8)((()=>m({collectionContextStore:e})),[e]))return(0,g.jsx)(y,{collectionContextStore:e},"lockAction")}function y({collectionContextStore:e}){const t=(0,i().v3)(),o=(0,r().K8)((()=>e.collectionViewBlockStore()),[e]),a=(0,r().K8)((()=>null==o?void 0:o.isLocked()),[o]),c=(0,r().K8)((()=>m({collectionContextStore:e})),[e]),S=(0,r().K8)((()=>null==o?void 0:o.isCollectionViewPageWithContent()),[o]),y=(0,r().K8)((()=>{if(o)return 0===o.getOwnedCollectionStores().length?"linkedOnly":null!=o&&o.hasSingleSourceAndNoLinkedCollections()?"singleSourceAndNoLinked":"multiSourceOrMixedSource"}),[o]),h=(0,n.useMemo)((()=>a?s().p:l().h),[a]);if(!o||!y||!c)return null;const{label:v,tooltip:x}=(0,u().nH)({collectionViewBlockSourceType:y,isCollectionViewPageWithContent:S,locked:a});return x?(0,g.jsx)(d().A,{renderTooltip:()=>x,render:o=>(0,g.jsx)(p().A,{...o,icon:h,title:v,onClick:()=>f(t,e)}),placement:"left"}):(0,g.jsx)(p().A,{icon:h,title:v,onClick:()=>f(t,e)})}function f(e,t){const o=t.collectionViewBlockStore();o&&(c().X6({environment:e,store:o,lock:!o.isLocked()}),(0,a().X)({environment:e,collectionContextStore:t,action:"click_toggle_lock"}))}},455338:(e,t,o)=>{o.d(t,{G:()=>s,t:()=>a});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(581454);var n=o.n(o(844751)),i=(o(296540),()=>o(69708)),r=()=>o(471995),l=o(474848);function s(e,t){const o=new Map,i=t.map((e=>{const t=[e.name,e.description].join(" ");return o.set(e.name,t),t})),r=new Set(n().filter(e,i).map((({original:e})=>e)));return t.filter((e=>{const t=o.get(e.name);return t&&r.has(t)}))}function a(e){const{featureName:t}=e;r().D6({label:(0,l.jsx)(i().sA,{id:"database.viewSettings.customizeMenu.successToastAfterFeatureAddition",defaultMessage:"Added {featureName} to this database.",values:{featureName:t}})})}},478573:(e,t,o)=>{o.d(t,{A:()=>l});var n=o(296540),i=()=>o(21140),r=o(474848);const l=n.forwardRef(((e,t)=>{const{icon:n,name:l,subText:s,disabled:a,...c}=e,d=(0,o(401497).IS)((e=>({iconContainer:{background:"light"===e.mode?e.white:e.palette.translucentGray[100],borderWidth:1,borderStyle:"solid",borderColor:"light"===e.mode?e.palette.gray[100]:e.palette.translucentGray[300],minWidth:32,width:32,height:32,borderRadius:4,overflow:"hidden"},buttonMenuItem:{padding:6},subText:{color:e.text.tertiary,fontSize:12}})),[]);return(0,r.jsx)(o(760217).A,{...c,disabled:a,disabledFeedback:a,buttonStyle:{margin:0,width:"100%"},style:d.buttonMenuItem,itemMarginLeft:0,ref:t,title:(0,r.jsxs)(i().Ye,{gap:8,alignItems:"center",children:[(0,r.jsx)(i().Ye,{style:d.iconContainer,alignItems:"center",justifyContent:"center",children:n}),(0,r.jsxs)(i().wt,{children:[(0,r.jsx)("span",{children:l}),s?(0,r.jsx)("span",{style:d.subText,children:s}):null]})]})})}));l.displayName="AddPageLayoutModuleMenuButton"},536308:(e,t,o)=>{o.r(t),o.d(t,{formEditorActions:()=>n()});var n=()=>o(894995)},541558:(e,t,o)=>{o.d(t,{Ay:()=>f,CL:()=>v,bL:()=>h});var n=o(296540),i=()=>o(484714),r=()=>o(835195),l=()=>o(69708),s=()=>o(436696),a=()=>o(755022),c=()=>o(722872),d=()=>o(760217),u=()=>o(406699),p=()=>o(933117),g=()=>o(150987),m=()=>o(272630),S=()=>o(992510),y=o(474848);const f=function({schema:e,sort:t,disabled:o,onChange:i,index:r,collectionViewType:l,collectionContextStore:s}){const a=e[t.property];return a?(0,y.jsxs)(n.Fragment,{children:[(0,y.jsx)(b,{disabled:o,schema:e,sort:t,onChange:i,index:r,collectionViewType:l,collectionContextStore:s,propertySchema:a}),(0,y.jsx)(x,{sort:t,index:r,onChange:i,collectionViewType:l,collectionContextStore:s,disabled:o})]}):null},h={ascending:(0,y.jsx)(l().sA,{defaultMessage:"Ascending",id:"collectionSortMenuRow.sortDirectionSelectMenu.ascending"}),descending:(0,y.jsx)(l().sA,{defaultMessage:"Descending",id:"collectionSortMenuRow.sortDirectionSelectMenu.descending"})},v=(0,l().YK)({menuTitle:{id:"collectionSortMenuRow.sortDirectionSelectMenu.title",defaultMessage:"Sort"},emptyPlaceholder:{id:"collectionSortMenuRow.sortDirectionSelectMenu.placeholder",defaultMessage:"Empty"}});function x({sort:e,index:t,onChange:o,collectionViewType:n,collectionContextStore:u,disabled:g}){const S=(0,i().v3)(),f=(0,l().tz)(),x=e.direction,b={menuTitle:f.formatMessage(v.menuTitle),items:[...r().FU],getKey:e=>e,selectedItem:x,disabled:g,onSelect:i=>{const r={...e,direction:i};o(t,r),u?(0,s().X)({environment:S,action:"set_sort_direction",sort_direction:i,collectionContextStore:u}):n&&(0,a().D)(S,{view_type:n,action:"set_sort_direction"})},renderItem:e=>(0,y.jsx)(d().A,{title:h[e.value],...e}),renderOrigin:e=>(0,y.jsx)(m().A,{...e,placeholder:f.formatMessage(v.emptyPlaceholder),title:x&&h[x],disabled:g,desktopStyle:{opacity:1}})};return(0,y.jsx)(p().A,{...b,menuTypeOverride:(0,c().PK)()},"direction")}function b({propertySchema:e,disabled:t,schema:o,sort:n,onChange:l,index:c,collectionViewType:d,collectionContextStore:p}){const m=(0,i().v3)(),{device:f}=m;return(0,y.jsx)(u().A,{popupType:f.isMobile?u().z.SlideUp:u().z.Popup,renderOrigin:o=>(0,y.jsx)(S().A,{...o,propertySchema:e,disabled:t,textWrapperStyle:{opacity:1}}),render:e=>(0,y.jsx)(g().A,{isRelationProperty:!1,schema:o,onAccept:e=>function(e,t,o,n,i,r,l){n(i,{...o,property:e}),l?(0,s().X)({environment:t,action:"set_sort_property",collectionContextStore:l}):r&&(0,a().D)(t,{view_type:r,action:"set_sort_property"})}(e,m,n,l,c,d,p),onClose:e.close,allowProperty:r().oH}),disabled:t})}},546754:(e,t,o)=>{o.d(t,{N:()=>a,u:()=>s});o(296540);var n=()=>o(496603),i=()=>o(645873),r=o(474848);const l=new(i().O2)("builder-modals",(()=>Promise.all([o.e(75134),o.e(9773),o.e(36556),o.e(40537),o.e(96346),o.e(62475),o.e(3151),o.e(98629),o.e(87249),o.e(71621),o.e(88924),o.e(92845),o.e(56369),o.e(5834),o.e(48486),o.e(2411),o.e(4422),o.e(4330),o.e(71003),o.e(55753),o.e(28866),o.e(84166),o.e(58636),o.e(74562),o.e(3259),o.e(76677),o.e(43223),o.e(65741),o.e(22542),o.e(15517),o.e(1966),o.e(31276),o.e(55776),o.e(51444),o.e(13297),o.e(4802),o.e(81768),o.e(75422),o.e(24267),o.e(12507),o.e(27911),o.e(79665)]).then(o.bind(o,80524)))),s=(0,i()._h)(l,(e=>e.AutomationBuilderModal),{renderLoading:()=>(0,r.jsx)(c,{})}),a=(0,i()._h)(l,(e=>e.ButtonBuilderModal),{renderLoading:()=>(0,r.jsx)(c,{})});function c(){return(0,r.jsx)(o(401634).i,{handleOnDismiss:n().lQ,canSave:!1,handleOnSave:n().lQ,mode:"loading",children:(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",overflow:"hidden"},children:(0,r.jsx)(o(98126).k,{})})})}},551222:(e,t,o)=>{o.d(t,{q:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 13.75 13.75",svg:(0,o(474848).jsx)("path",{d:"M13.125 4.25c0-.621.504-1.125 1.125-1.125h1.5c.621 0 1.125.504 1.125 1.125v11.5c0 .621-.504 1.125-1.125 1.125h-1.5a1.125 1.125 0 0 1-1.125-1.125zm1.25.125v11.25h1.25V4.375zm-6.25 6.375c0-.621.504-1.125 1.125-1.125h1.5c.621 0 1.125.504 1.125 1.125v5c0 .621-.504 1.125-1.125 1.125h-1.5a1.125 1.125 0 0 1-1.125-1.125zm1.25.125v4.75h1.25v-4.75zM4.25 5.625c-.621 0-1.125.504-1.125 1.125v9c0 .621.504 1.125 1.125 1.125h1.5c.621 0 1.125-.504 1.125-1.125v-9c0-.621-.504-1.125-1.125-1.125zm.125 10v-8.75h1.25v8.75z"})},i=(0,o(340498).wt)("chartBarXAxis",n)},554840:(e,t,o)=>{o.d(t,{e:()=>z,a:()=>L});o(898992),o(354520);var n=o(296540),i=()=>o(484714),r=()=>o(56366),l=()=>o(401497),s=()=>o(955363),a=()=>o(69708),c=()=>o(534177),d=()=>o(284371),u=()=>o(406699),p=()=>o(404277),g=()=>o(417392),m=()=>o(722872),S=()=>o(989219),y=()=>o(463830),f=(o(944114),o(581454),o.n(o(844751))),h=()=>o(651124),v=()=>o(390066),x=()=>o(30626),b=()=>o(496603),C=()=>o(736767),w=()=>o(760217),j=()=>o(419357),A=()=>o(939740),_=()=>o(89924),I=()=>o(250202),k=()=>o(852353),M=()=>o(972435),T=()=>o(970585),P=o(474848);const B=2,F=(0,a().YK)({inputPlaceholder:{defaultMessage:"Search for a property…",id:"database.viewSettings.propertySelect.inputPlaceholder"}});function V(e){const{currentProperty:t,getGroupedProperties:o,onAccept:s,renderProperty:d,inputPlaceholder:u,schema:p,format:g,defaultShowPropertyGroupCount:m}=e,S=(0,i().Y0)(),y=(0,r().uB)(void 0,T().A),A=(0,r().K8)((()=>o()),[o]),[I,V]=(0,n.useState)(!1),[R,O]=(0,n.useState)(""),K=(0,v().L)(g,p,void 0,h().jf.Page).collection_page_properties||[],N=(0,n.useCallback)((e=>{O(e.target.value),y.setState({...y.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}}),V(!1)}),[y]),L=(0,l().IS)((e=>({dotsIcon:{width:16,fill:e.text.secondary,marginInlineStart:4,marginInlineEnd:2},showMoreButton:{color:e.text.secondary}})),[]),z=b().Ul(A,(e=>Math.min(...e.map((e=>K.findIndex((t=>t.property===e))))))),U=[{key:"input",comp:(0,P.jsx)(_().A,{children:(0,P.jsx)(j().Ay,{focusInitial:!S.isMobile||void 0,focus:!S.isMobile||void 0,value:R,onChange:N,placeholder:u||M().A.formatMessage(F.inputPlaceholder)})})}];if(R){const e=z.map((e=>e.filter((e=>{const t=p[e],o=t?`${t.name} ${k().dC[t.type]}`:"";return Boolean(f().match(R,o))})))).filter((e=>e.length>0));if(0===e.length)U.push({key:"noResults",comp:(0,P.jsx)(C().A,{caption:(0,P.jsx)(a().sA,{defaultMessage:"No results",id:"database.viewSettings.propertySelect.noResultsTitle"})})});else{const o=[{key:"results",render:e=>(0,P.jsx)(_().A,{...e}),items:e.flat().map((e=>E({onAccept:s,property:e,schema:p,currentProperty:t,renderProperty:d}))).filter(c().O9)}];U.push(D({sections:o,menuListStore:y}))}}else{const e=m||B;let o,n;if(!I&&z.length>e){o=z.slice(0,e);const t=b().cz(z.slice(e).map((e=>e.length)));n={key:"show_more",render:e=>(0,P.jsx)(w().A,{...e,icon:(0,x()._)(L.dotsIcon),style:L.showMoreButton,title:(0,P.jsx)(a().sA,{defaultMessage:"{moreCount} more",id:"database.viewSettings.propertySelect.showMoreTitle",values:{moreCount:t}})}),action:()=>{V(!0)}}}else o=z;const i=o.map(((e,i)=>({key:e.join("-"),render:e=>(0,P.jsx)(_().A,{...e,topBorder:0!==i}),items:e.map((e=>E({onAccept:s,property:e,schema:p,currentProperty:t,renderProperty:d}))).concat(i===o.length-1?[n]:[]).filter(c().O9)})));U.push(D({sections:i,menuListStore:y}))}return(0,P.jsx)(P.Fragment,{children:U.map((({key:e,comp:t})=>(0,P.jsx)(n.Fragment,{children:t},e)))})}function D(e){const{menuListStore:t,sections:o}=e;return{key:"properties",comp:(0,P.jsx)(A().Ay,{type:A().Oh.Vertical,initialFocus:0,sections:o,store:t})}}function E(e){const{schema:t,currentProperty:o,onAccept:n,renderProperty:i,property:r}=e,l=t[r];if(!l)return;return{key:r,render:e=>{const t=r===o;return i?i(e,r,t,l):(0,P.jsx)(I().G,{...e,propertySchema:l,format:I().e.Name,isChecked:t})},action:()=>{n(r)}}}var R=()=>o(497222),O=()=>o(380468),K=()=>o(148079),N=()=>o(334955);function L(e){const{currentPropertyId:t,feature:o,collectionContextStore:n,permissionScopes:i,onPropertySelect:l,buttonPopupStore:d,disabled:u}=e,p=(0,a().tz)(),g=(0,r().K8)((()=>{var e,t;return"subitem"===o?null===(e=n.collectionStore())||void 0===e||null===(e=e.getFormat())||void 0===e?void 0:e.subitem_property:"timeline_arrows_by"===o?null===(t=n.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.collection_default_arrows_by:void(0,c().HB)(o)}),[o,n]),m=(0,r().K8)((()=>n.databaseType),[n]),{handleDefaultPropertySelect:y,handlePropertySelect:f,getProperties:h}=(0,N().Tv)({collectionContextStore:n,feature:o,onPropertySelect:l}),v=(0,S().uX)({feature:o,databaseType:m});return(0,P.jsx)(U,{intl:p,icon:s().arrowDiagonalUpRightIcon,caption:(0,P.jsx)(a().sA,{...v}),collectionContextStore:n,buttonPopupStore:d,shouldGroupProperties:!0,getGroupedProperties:h,currentProperty:t,disabled:u,onAccept:i.canConfigureBlock&&i.canConfigureCollection?f:()=>{},renderProperty:(e,t,i,r)=>(0,P.jsx)(K().A,{version:"v2",feature:o,menuProps:e,property:t,defaultProperty:g,isChecked:i,propertySchema:r,collectionContextStore:n,handleDefaultPropertySelect:y,handlePropertySelect:f})})}function z(e){const{currentPropertyId:t,collectionContextStore:o,onPropertyChanged:i,disabled:l,title:s}=e,d=(0,a().tz)(),u=(0,r().uB)(void 0,y().A),p=(0,r().O$)(o.normalizedSchemaStore),g=(0,n.useCallback)((()=>Object.keys(p).filter((e=>{const t=p[e];return"date"===(null==t?void 0:t.type)})).filter(c().O9)),[p]);return(0,P.jsx)(U,{intl:d,buttonPopupStore:u,title:s,collectionContextStore:o,shouldGroupProperties:!1,getProperties:g,currentProperty:t,disabled:l,onAccept:e=>{e&&i(e),u.setState({open:!1})}})}function U(e){const{currentProperty:t,icon:o,caption:n,buttonPopupStore:s,collectionContextStore:c,disabled:S,title:y,shouldGroupProperties:f}=e,h=(0,i().Y0)(),v=(0,r().K8)((()=>{var e;return(null===(e=c.collectionStore())||void 0===e?void 0:e.getFormat())??{}}),[c]),x=(0,r().O$)(c.normalizedSchemaStore),b=(0,l().IS)((e=>({caption:{fontSize:h.isMobile?d().J.UISmall.mobile:d().J.UISmall.desktop,color:e.text.secondary,marginTop:0,marginInlineEnd:12,marginBottom:12,marginInlineStart:14}})),[h]),C=(0,r().K8)((()=>s.state.open),[s]),w=(0,r().K8)((()=>h.isPhone?{menuType:m().gu.ActionSheet}:{menuType:m().gu.Popup,width:300}),[h.isPhone]);return(0,P.jsxs)(P.Fragment,{children:[n?(0,P.jsx)("div",{style:b.caption,children:n}):void 0,(0,P.jsx)(u().A,{popupType:h.isPhone?g().nl.SlideUp:g().nl.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",disabled:S,originGap:0,renderOrigin:e=>{var n;return(0,P.jsx)(R().A,{title:y??(0,P.jsx)(a().sA,{id:"database.viewSettings.relationFeatures.propertyPicker.default.title",defaultMessage:"Property"}),showChevron:!0,right:t?(0,P.jsx)("span",{style:d().RC,children:null===(n=x[t])||void 0===n?void 0:n.name}):void 0,rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0},rotateChevron:C,disabled:S,icon:o,...e})},render:t=>(0,P.jsx)(p().A,{...w,children:f?(0,P.jsx)(V,{...e,getGroupedProperties:e.getGroupedProperties,format:v,schema:x}):(0,P.jsx)(O().A,{getProperties:e.getProperties,currentProperty:e.currentProperty,onAccept:e.onAccept,format:v,schema:x})}),buttonPopupStore:s})]})}},555267:(e,t,o)=>{o.d(t,{A:()=>a});var n=o(296540),i=()=>o(401497),r=()=>o(98126),l=()=>o(62856),s=o(474848);function a({loadingMessage:e}){const t=(0,i().DP)(),o=(0,l().A)(!0,400);return(0,s.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:o?(0,s.jsxs)(n.Fragment,{children:[(0,s.jsx)(r().k,{}),e?(0,s.jsx)("div",{style:{marginInlineStart:8,color:t.text.secondary},children:e}):void 0]}):void 0})}},564037:(e,t,o)=>{o.r(t),o.d(t,{getCurrentAgentThreadId:()=>_,getCurrentCustomAgentThreadId:()=>I,getCurrentWorkflowNavigationState:()=>C,getDefaultClosedNavigationState:()=>h,getDefaultOpenNavigationState:()=>f,getIsWorkflowEditorOpen:()=>x,getIsWorkflowEditorStateOpen:()=>v,getIsWorkflowNavigationStateCurrent:()=>b,getMergedWorkflowNavigationState:()=>w,useIsWorkflowEditorOpen:()=>A,useWorkflowNavigationState:()=>j});var n=()=>o(484714),i=()=>o(56366),r=()=>o(743246),l=()=>o(496603),s=()=>o(671593),a=()=>o(638681),c=()=>o(765957),d=()=>o(201718),u=()=>o(990402);const p=a().object({required:{isOpen:a().literal(!0)},optional:{}}),g={agent:a().intersection([p,a().object({required:{type:a().literal("agent")},optional:{}})]),activity:a().intersection([p,a().object({required:{type:a().literal("activity")},optional:{}})])},m=a().union(Object.values(g)),S=a().object({required:{isOpen:a().literal(!1)},optional:{}}),y=a().union([m,S]);function f(){return{isOpen:!0,type:"agent"}}function h(){return{isOpen:!1}}function v(e){return(null==e?void 0:e.isOpen)??!1}function x(e){return v(C(e))}function b(e){const{currentNavigationState:t,navigationState:o}=e,n=w({defaultNavigationState:{isOpen:!1},currentNavigationState:t,newNavigationState:o});return(0,l().n4)(t,n)}function C(e){const{RouterStore:t}=e;if("agent"!==t.state.route.name)return;const o=t.state.route.workflowId,n=c().default.state.sidebarSpaceStore;if(!n)return;const i=d().N.createChildStore(n,{id:o,table:r().C0,spaceId:n.id});return(0,u().m)(i)?function(e){const{workflowViewType:t}=e;switch(t){case"agent":case"activity":return{isOpen:!0,type:t};default:return}}(t.state.route):void 0}function w(e){const{defaultNavigationState:t,currentNavigationState:o,newNavigationState:n}=e,i={...t};if(o)for(const[l,s]of Object.entries(o))i[l]=s;if(n)for(const[l,s]of Object.entries(n))i[l]=s;const r=(0,s().tf)(y,i);if(r)throw r;return i}function j(){const e=(0,n().v3)();return(0,i().K8)((()=>C(e)??{isOpen:!1}),[e])}function A(){const e=(0,n().v3)();return(0,i().K8)((()=>x(e)),[e])}function _(e){const{RouterStore:t}=e,o=t.state.route;if("agent"===o.name||"page"===o.name||"chat"===o.name)return o.chatThreadId}function I(e){const{RouterStore:t}=e,o=t.state.route;if("agent"===o.name)return o.agentChatThreadId}},566534:(e,t,o)=>{o.d(t,{U:()=>r});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"4.12 2.37 14.01 15.25",directional:!0,svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M6.25 2.375A2.125 2.125 0 0 0 4.125 4.5v11c0 1.174.951 2.125 2.125 2.125h7.5a2.125 2.125 0 0 0 2.125-2.125v-1.062h-1.25V15.5a.875.875 0 0 1-.875.875h-7.5a.875.875 0 0 1-.875-.875v-11c0-.483.392-.875.875-.875h7.5c.483 0 .875.392.875.875v1.125h1.25V4.5a2.125 2.125 0 0 0-2.125-2.125z"}),(0,n.jsx)("path",{d:"M17.942 9.558a.625.625 0 0 1 0 .884l-2.5 2.5a.625.625 0 1 1-.884-.884l1.408-1.408H10a.625.625 0 1 1 0-1.25h6.016l-1.458-1.458a.625.625 0 1 1 .884-.884z"})]})},r=(0,o(340498).wt)("arrowRightFromRectangle",i)},567121:(e,t,o)=>{o.d(t,{EG:()=>l,K5:()=>r,RH:()=>i,Yi:()=>s,ls:()=>n});const n=32,i=202,r=1e3,l="Want to add a metric? Look for 'src/client/performanceToolbar/config.ts' in notion-next.",s="To disable the toolbar entirely, go to the 'Experiments' panel and look for the 'performance_debugging_toolbar' flag."},575154:(e,t,o)=>{o.d(t,{q:()=>p});o(898992),o(354520),o(581454);var n=()=>o(56366),i=()=>o(929219),r=()=>o(663077),l=()=>o(496603),s=()=>o(863987),a=()=>o(793863),c=()=>o(200277),d=()=>o(756790),u=()=>o(580101);function p({parentStore:e,returnAllTemplates:t}){const o=(0,n().K8)((()=>{const e=s().A.getState();return((null==e?void 0:e.templatesWithRowIds)??[]).map((e=>e.template)).filter((e=>(0,r().Xq)(e,"collection")))}),[],{useDeepEqual:!0}),p=(0,n().K8)((()=>{u().A.getState();const e=(0,d().p)().function;return e&&(0,r().AU)(e)?e:void 0}),[]),g=(0,n().K8)((()=>(0,c().$)({persona:p,parentStore:e})),[p,e],{useDeepEqual:!0}),m=!(0,n().O$)(i().e);return(0,n().K8)((()=>m?[]:(0,l().hS)([...o,...g,...t?(0,a().oA)():[]],(e=>e.templateId))),[o,g,t,m])}},578194:(e,t,o)=>{o.d(t,{r:()=>n});const n=(0,o(583835).Dv)("importEvernote")},580101:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().Store{getInitialState(){}}const i=new n},614525:(e,t,o)=>{o.d(t,{A:()=>s});o(296540);var n=()=>o(69708),i=()=>o(436696),r=()=>o(147503),l=o(474848);const s=function({collectionContextStore:e}){const t=(0,o(484714).v3)(),{viewType:s,isViewsModule:a,isDashboardWidget:c}=(0,o(56366).K8)((()=>{var t;return{viewType:null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType(),isViewsModule:Boolean(e.viewsModuleContextStore.state),isDashboardWidget:Boolean(e.isDashboardWidget())}}),[e]);if(!s||a||c)return null;let d=(0,l.jsx)(n().sA,{defaultMessage:"Copy link to view",id:"database.viewSettings.mainTab.copyLinkButton.title"});return"chart"===s&&(d=(0,l.jsx)(n().sA,{defaultMessage:"Copy link to chart",id:"database.viewSettings.mainTab.copyLinkButton.title.chart"})),(0,l.jsx)(o(497222).A,{icon:o(742852).linkIcon,title:d,onClick:()=>function(e,t){const o=t.collectionViewStore();o&&(r().GH({environment:e,collectionContextStore:t,collectionViewStore:o}),(0,i().X)({environment:e,collectionContextStore:t,action:"click_copy_link",original_view_type:o.getType()}))}(t,e)})}},626318:(e,t,o)=>{o.d(t,{Bj:()=>x,ZX:()=>v});o(16280);var n=()=>o(278238),i=()=>o(206267),r=()=>o(454984),l=()=>o(688728),s=()=>o(475140),a=()=>o(179034),c=()=>o(869558),d=()=>o(183558),u=()=>o(384944),p=()=>o(231297),g=()=>o(594794),m=()=>o(972435),S=()=>o(148832),y=()=>o(543665),f=()=>o(978846),h=()=>o(38e3);function v(e){var t,o;const{environment:n,layoutStore:a,relationPropertyId:c,targetCollectionPointer:u,viewName:g,viewIcon:m}=e,y=null===(t=a.getModel())||void 0===t?void 0:t.firstRawModuleOfType("editor"),v=null===(o=a.getModel())||void 0===o?void 0:o.firstRawModuleOfType("viewsMain");if(!y&&!v)throw new Error("Invalid state: no editor or viewsMain module");const{performResult:b}=p().createAndCommit({environment:n,canUndo:!0,perform:e=>{const{inMemoryRecordCache:t}=a;let o,b=v;if(b){var C;if("viewsMain"!==(null===(C=b)||void 0===C?void 0:C.type))throw new Error("Invalid state: editor or viewsMain module is not of the expected type");o=S().B.createChildStore(a,b.collection_view_block_pointer)}else{const t=(0,d().Ay)(),{collectionViewBlockStore:c}=(0,h().$)({environment:n,layoutStore:a,transaction:e});o=c,b={id:t,type:"viewsMain",collection_view_block_pointer:{...o.pointer,spaceId:o.getSpaceId()}};const u=(0,s().JO)(a.getModules(),(e=>"editor"===e.type));if(!u||!y||"form_conditional_modules"===u.area)throw new Error("Invalid state: no editor module");if("views_main_tab_modules"===u.area)throw new Error("Cannot add views main module when editor is already in views main module");p().applyOperation({store:a,transaction:e,operation:r().N4.deleteModuleInArea({pointer:a.pointer,area:l().Zm[u.area],moduleId:y.id})}),(0,f().UQ)({position:{type:"absolute",area:u.area,index:u.index},module:b,layoutStore:a,transaction:e,environment:n,sessionId:(0,i().JW)(),isPropertyCreation:!1})}if(!b)throw new Error("Invalid state: no views main module");const w=x({environment:n,transaction:e,targetCollectionPointer:u,collectionViewBlockStore:o,viewName:g,viewIcon:m,relationPropertyId:c,inMemoryRecordCache:t});return{viewsMainModule:b,collectionViewBlockPointer:o.pointer,collectionViewPointer:w}},userAction:"viewsModuleActions.addViewToViewsMainModule"});if(!b)throw new Error("Transaction to add collection view to views main module failed");return{viewsMainModule:b.viewsMainModule,collectionViewPointer:b.collectionViewPointer,collectionViewBlockPointer:b.collectionViewBlockPointer}}function x({environment:e,transaction:t,targetCollectionPointer:o,collectionViewBlockStore:r,viewName:l,viewIcon:s,relationPropertyId:d,inMemoryRecordCache:S}){const f=(0,g().JH)({environment:e,table:c().Gy,spaceId:r.getSpaceId()}).id;let h=s;if(!h&&o){const e=y().m.createChildStore(r,o).getIcon();null!=e&&e.icon&&(0,n().T8)(e.icon)&&(h=e.icon)}const v={id:f,type:"table",parent_id:r.pointer.id,parent_table:a().ev,space_id:r.getSpaceId(),alive:!0,name:l??m().A.formatMessage(b.view),format:{hide_linked_collection_name:!0,collection_pointer:o,collection_view_icon:h,...d?{property_filters:[{id:i().JW(),filter:{property:d,filter:{operator:"relation_contains",value:{type:"relative",value:{type:"current_page_in_related_collection"}}}}}]}:{},subitem_display_mode:d?"disabled":void 0,subitem_filter_scope:d?"parents_and_subitems":void 0}};return p().applyOperation({store:r,operation:{pointer:r.pointer,path:["view_ids"],command:"listAfter",args:{id:f}},transaction:t}),u().eC({environment:e,table:c().Gy,value:v,inMemoryRecordCache:S,transaction:t}),{id:f,table:c().Gy,spaceId:r.getSpaceId()}}const b=(0,o(69708).YK)({view:{defaultMessage:"View",id:"pageLayout.viewsModuleActions.defaultViewName"}})},635019:(e,t,o)=>{o.d(t,{f:()=>l});var n=o(296540),i=()=>o(69708),r=o(474848);const l=n.memo((function({collectionContextStore:e,collectionSettingsStore:t}){const n=(0,o(484714).v3)(),{collectionViewStore:l,targetStore:s,icon:a}=(0,o(56366).K8)((()=>{var t;const n=e.collectionViewStore(),i=e.collectionViewBlockStore(),r=null==n?void 0:n.getFormat(),l=null==r?void 0:r.page_pointer;let s;return l&&i&&(s=o(148832).B.createChildStore(i,{table:l.table,id:l.id,spaceId:l.spaceId})),{collectionViewStore:n,targetStore:s,icon:null===(t=s)||void 0===t?void 0:t.getIcon()}}),[e]);return l?(0,r.jsx)(o(497222).A,{icon:o(688311).h,title:(0,r.jsx)(i().sA,{defaultMessage:"Source",id:"database.viewSettings.mainTab.sourceButton.title"}),showChevron:!0,right:s?(0,r.jsxs)(r.Fragment,{children:[a?(0,r.jsx)(o(187820).B6,{disabled:!0,bucket:"secure",store:s,icon:a,iconRecordCategory:"pageBlock",isEmptyPage:!1,size:20,style:{marginInlineEnd:4,opacity:.6}}):void 0,(0,r.jsx)(o(16006).A,{store:s})]}):(0,r.jsx)("span",{style:{opacity:.5},children:(0,r.jsx)(i().sA,{defaultMessage:"Select a page",id:"pageViewTargetSetting.selectPage"})}),textWrapperStyle:{flexShrink:0},rightStyle:{flexShrink:1},onClick:()=>{(0,o(436696).X)({environment:n,collectionContextStore:e,action:"click_source"}),o(147503).a2({collectionSettingsStore:t,item:{type:"source"}})}}):null}))},637558:(e,t,o)=>{o.d(t,{v:()=>r});var n=o(296540),i=o(474848);const r=n.memo((function({currentSorts:e,schema:t}){const n=(0,o(401497).IS)((()=>({property:{maxWidth:"clamp(100px, 40vw, 150px)"}})),[]),r=e.length;if(0===r)return null;const l=e[0].property;return 1===r&&null!=t&&t[l]?(0,i.jsx)(o(398217).mA,{propertySchema:t[l],showIcon:!1,style:n.property}):(0,i.jsx)("span",{children:r})}))},638045:(e,t,o)=>{o.d(t,{t:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"5.83 0.79 8.33 18.41",svg:(0,o(474848).jsx)("path",{d:"M13.977 5.393a.625.625 0 0 1-.883 0l-2.47-2.469v5.662a.625.625 0 1 1-1.25 0V2.924L6.907 5.393a.625.625 0 0 1-.884-.884L9.558.974a.625.625 0 0 1 .884 0l3.535 3.535a.625.625 0 0 1 0 .884m-3.352 6.026a.625.625 0 1 0-1.25 0v5.648l-2.469-2.469a.625.625 0 1 0-.884.884l3.536 3.535c.244.245.64.245.884 0l3.535-3.535a.625.625 0 0 0-.883-.884l-2.47 2.469z"})},i=(0,o(340498).wt)("arrowUpDownStacked",n)},653002:(e,t,o)=>{o.d(t,{Q:()=>i});var n=()=>o(869558);function i(e){const{collectionViewId:t,spaceId:o}=e;return{id:t,table:n().Gy,spaceId:o}}},663807:(e,t,o)=>{o.d(t,{j:()=>r});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"1.59 1.59 16.81 16.81",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10 12.125a.75.75 0 1 1 0 1.5.75.75 0 0 1 0-1.5m0-5.875c.345 0 .625.28.625.625v3.5a.625.625 0 1 1-1.25 0v-3.5c0-.345.28-.625.625-.625"}),(0,n.jsx)("path",{d:"M8.498 2.222c.83-.83 2.175-.83 3.005 0l6.275 6.276c.83.83.83 2.175 0 3.005l-6.275 6.275c-.83.83-2.175.83-3.005 0l-6.276-6.275a2.125 2.125 0 0 1 0-3.005zm2.121.884a.875.875 0 0 0-1.237 0L3.106 9.382a.875.875 0 0 0 0 1.237l6.276 6.276a.875.875 0 0 0 1.237 0l6.276-6.276a.875.875 0 0 0 0-1.237z"})]})},r=(0,o(340498).wt)("exclamationDiamond",i)},673900:(e,t,o)=>{o.d(t,{v:()=>c});var n=o.n(o(901080)),i=o(296540),r=()=>o(401497),l=()=>o(496603),s=()=>o(623580),a=o(474848);function c({value:e,onChange:t,onBlur:o,onKeyDown:c,inputProps:d}){const[u,p]=(0,i.useState)(""),g=(0,i.useRef)(""),m=(0,i.useRef)(e);(0,i.useEffect)((()=>{const t=void 0===e?"":e.toString();p(t),g.current=t,m.current=e}),[e]);const S=(0,i.useCallback)((e=>l().sg((e=>{null==t||t(e)}),300)(e)),[t]),y=(0,i.useCallback)((e=>{const o=e.target.value;if(p(o),g.current=o,t){const e=n()(o);S(isNaN(e)?void 0:e)}}),[S,t]),f=(0,i.useCallback)((e=>{const t=n()(e.target.value);null==o||o(isNaN(t)?void 0:t)}),[o]),h=(0,i.useRef)(o),v=(0,i.useCallback)((e=>{if("Enter"===e.key){const e=n()(u);null==c||c(isNaN(e)?void 0:e)}}),[u,c]);(0,i.useEffect)((()=>()=>{var e;if((null===(e=m.current)||void 0===e?void 0:e.toString())!==g.current){var t;const e=n()(g.current);null===(t=h.current)||void 0===t||t.call(h,isNaN(e)?void 0:e)}}),[]);const x=(0,r().IS)((e=>({input:{background:e.background.primary}})),[]);return(0,a.jsx)(s().A,{type:"number",value:u,inputClassName:"input-hide-arrows",style:x.input,onChange:y,onBlur:o?f:void 0,onKeyDown:c?v:void 0,...d})}},674582:(e,t,o)=>{o.d(t,{m:()=>a});o(296540);var n=()=>o(401497),i=()=>o(377114),r=()=>o(558687),l=()=>o(284371),s=o(474848);function a(e){const{title:t,description:o,integrationIconUrl:a,integrationIcon:c,children:d,styles:u}=e,p=(0,n().IS)((e=>({header:{fontWeight:l().Wy.bold,fontSize:26,textAlign:"center",marginBottom:4,lineHeight:"32px"},iconGroup:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gridColumnGap:9,marginBottom:12,height:40},arrowRight:{width:20,height:20,opacity:.4,fontWeight:l().Wy.bold,padding:3},notionLogo:{height:40,width:40,color:e.icon.primary},icon:{height:32,width:32},description:{textAlign:"center",color:e.text.secondary,fontWeight:l().Wy.regular,fontSize:14,lineHeight:"20px"}})),[]);return(0,s.jsxs)("div",{style:null==u?void 0:u.wrapper,children:[(0,s.jsxs)("div",{style:{...p.iconGroup,...null==u?void 0:u.iconGroup},children:[(0,r().notionIcon)(p.notionLogo),(0,i().arrowLeftRightIcon)({...p.arrowRight,...null==u?void 0:u.arrowRight}),a?(0,s.jsx)("img",{style:{...p.icon,...null==u?void 0:u.icon},src:a,alt:"Integration Icon"}):c]}),t?(0,s.jsx)("div",{style:{...p.header,...null==u?void 0:u.header},children:t}):void 0,o?(0,s.jsx)("div",{style:{...p.description,...null==u?void 0:u.description},children:o}):void 0,d]})}},686832:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,phoneIcon:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.58 2.77 14.78 14.57",svg:(0,o(474848).jsx)("path",{d:"M4.84 3.093a1.34 1.34 0 0 1 1.881.158l2.52 2.96a1.524 1.524 0 0 1-.083 2.066l-1.22 1.22 2.715 2.717 1.221-1.221a1.525 1.525 0 0 1 2.066-.084l2.962 2.517a1.29 1.29 0 0 1 .16 1.805l-.559.678a3.94 3.94 0 0 1-3.447 1.414l-.16-.016A11.564 11.564 0 0 1 2.614 7.299 3.88 3.88 0 0 1 3.97 3.822zm.93.969a.09.09 0 0 0-.128-.011l-.869.729a2.63 2.63 0 0 0-.919 2.358 10.314 10.314 0 0 0 9.17 8.925l.16.017a2.7 2.7 0 0 0 2.355-.966l.558-.678a.04.04 0 0 0-.005-.057l-2.961-2.517a.275.275 0 0 0-.373.015l-1.663 1.663a.625.625 0 0 1-.884 0l-3.6-3.6a.625.625 0 0 1 0-.884l1.663-1.663a.275.275 0 0 0 .015-.373z"})},i=(0,o(340498).wt)("phone",n)},704640:(e,t,o)=>{o.d(t,{A:()=>s});o(898992),o(354520);var n=o(296540),i=()=>o(56366),r=()=>o(147503),l=o(474848);const s=function({collectionContextStore:e,collectionSettingsStore:t,disabled:s}){const a=(0,o(484714).v3)(),c=(0,i().O$)(e.permissionScopesStore),d=(0,i().K8)((()=>{var t;return null==e||null===(t=e.collectionStore())||void 0===t?void 0:t.getSchema()}),[e]),u=(0,i().K8)((()=>(0,o(790515).tG)(e)),[e]),p=(0,i().K8)((()=>e.currentPropertyFiltersStore.state.filter((e=>!(0,o(214388).t_)(e.filter)))),[e]),g=(0,n.useMemo)((()=>{if(0!==u){if(1===u&&1===p.length&&d){const e=null==d?void 0:d[p[0].filter.property];if(e)return(0,l.jsx)(o(398217).mA,{propertySchema:e,showIcon:!1})}return u}}),[u,d,p]);return(0,l.jsx)(o(497222).A,{disabled:s,icon:o(170350).filterIcon,title:(0,l.jsx)(o(69708).sA,{defaultMessage:"Filter",id:"database.viewSettings.mainTab.filterButton.title"}),showChevron:!0,right:g,onClick:()=>{(0,o(436696).X)({environment:a,collectionContextStore:e,action:"click_filters"}),o(726637).A.isMobile||function(e,t){return Boolean(e.currentPropertyFiltersStore.state.length>0||e.currentCombinatorFilterStore.state&&t.canConfigureBlock)}(e,c)?r().a2({collectionSettingsStore:t,item:{type:"filters"}}):r().a2({collectionSettingsStore:t,item:{type:"createFilter"}})}})}},706965:(e,t,o)=>{o.d(t,{A:()=>f});o(296540);var n=()=>o(56366),i=()=>o(401497),r=()=>o(764880),l=()=>o(310442),s=()=>o(824862),a=()=>o(798880),c=()=>o(69708),d=()=>o(534177),u=()=>o(284371),p=()=>o(43972),g=()=>o(972435),m=()=>o(907514),S=()=>o(646736),y=o(474848);function f(e){const{store:t}=e,o=(0,i().DP)(),f=(0,n().K8)((()=>t.getCreatedTime()),[t]),h=(0,n().K8)((()=>t.getLastEditedTime()),[t]),v=(0,n().K8)((()=>{const e=t.getCreatedByPointer();if(e)return(0,r().xC)({pointer:e,getRecordValue:t.getRecordValue})}),[t]),x=(0,n().K8)((()=>{const e=t.getLastEditedByPointer();if(e)return(0,r().xC)({pointer:e,getRecordValue:t.getRecordValue})}),[t]),b=(0,n().K8)((()=>{const e=t.getSpaceStore();if(!e)return!1;const o=null==v?void 0:v.asActor;if(!o)return!1;const n=o.table;switch(n){case a().oo:return(0,S().dp)(e,o.id).isMember();case s().GP:return(0,S().Ts)(e,o.id).isMember();case l().yj:return!1;default:(0,d().HB)(n)}}),[t,v]),C=f?(0,m().nl)(f,{useCompactFormat:!0,useLowercase:!0}):"",w=h?(0,m().nl)(h,{useLowercase:!0,useCompactFormat:!0}):"";if(!(h?(0,m().nl)(h,{useLowercase:!0,useCompactFormat:!0,roundDownYears:!0}):""))return null;const j={display:"flex",gap:4,color:o.text.inverseSecondary,height:16,fontSize:12},A={size:14,style:{marginInlineEnd:2}},_=g().A.getIntl();return(0,y.jsxs)(y.Fragment,{children:[(e=>{let t;if(null!=x&&x.asActor)t=(0,y.jsx)(c().sA,{defaultMessage:"Edited by {editor} {timestamp}",id:"pagePropertiesHeader.editedBy.label",values:{editor:(0,y.jsx)("span",{style:{fontWeight:u().Wy.medium,color:o.text.inversePrimary},children:(0,y.jsxs)("span",{style:{display:"flex"},children:[e?void 0:(0,p().w)({actor:x,...A}),(0,r().lR)(_,x)]})}),timestamp:w}});else{if(!w)return;n=w,t=(0,y.jsx)(c().sA,{defaultMessage:"Edited {timestamp}",id:"pagePropertiesHeader.edited.label",values:{timestamp:n}})}var n;return(0,y.jsx)("div",{style:{...j,marginTop:3,marginBottom:3},children:t})})(e.compactFormat),(e=>{let t;if(null!=v&&v.asActor&&b)t=(0,y.jsx)(c().sA,{id:"pagePropertiesHeader.createdBy.label",defaultMessage:"Created by {creator} {timestamp}",values:{creator:(0,y.jsx)("span",{style:{fontWeight:u().Wy.medium,color:o.text.inversePrimary},children:(0,y.jsxs)("span",{style:{display:"flex"},children:[e?void 0:(0,p().w)({actor:v,...A}),(0,r().lR)(_,v)]})}),timestamp:C}});else{if(!C)return;t=(0,y.jsx)(c().sA,{id:"pagePropertiesHeader.created.label",defaultMessage:"Created {timestamp}",values:{timestamp:C}})}return(0,y.jsx)("div",{style:{...j,marginBottom:4},children:t})})(e.compactFormat)]})}},711433:(e,t,o)=>{o.d(t,{l:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 13.75 13.75",svg:(0,o(474848).jsx)("path",{d:"M14.375 4.25c0-.621-.504-1.125-1.125-1.125h-9c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125h9c.621 0 1.125-.504 1.125-1.125zm-10 .125h8.75v1.25h-8.75zm4.875 3.75c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125h-5a1.125 1.125 0 0 1-1.125-1.125v-1.5c0-.621.504-1.125 1.125-1.125zm-.125 1.25h-4.75v1.25h4.75zm6.625 3.75c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125H4.25a1.125 1.125 0 0 1-1.125-1.125v-1.5c0-.621.504-1.125 1.125-1.125zm-.125 1.25H4.375v1.25h11.25z"})},i=(0,o(340498).wt)("chartBarYAxis",n)},717895:(e,t,o)=>{o.d(t,{K:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"7 7 6 6",svg:(0,o(474848).jsx)("path",{d:"M10 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6"})},i=(0,o(340498).wt)("dotFill",n)},720088:(e,t,o)=>{o.d(t,{X:()=>Oo});var n=o(296540),i=()=>o(484714),r=()=>o(56366),l=()=>o(401497),s=()=>o(282339),a=()=>o(901610),c=()=>o(566910),d=()=>o(69708),u=()=>o(908201),p=()=>o(89924),g=()=>o(765957),m=()=>o(322638),S=(o(16280),o(581454),()=>o(804773)),y=()=>o(726637),f=()=>o(718827),h=()=>o(252291),v=()=>o(534177),x=()=>o(859428),b=()=>o(805025),C=o(474848);const w={column:o(551222).q,bar:o(711433).l,line:o(267654).g,donut:o(748696).w};function j({chartConfig:e,disabled:t}){const o=(0,l().DP)(),n=(0,r().K8)((()=>{if(!e)return;const t=e.type;if("placeholder"===t)throw new Error("Should not happen");return t}),[e]);return(0,C.jsx)("div",{style:{display:"flex",gap:y().A.isMobile?b().X1:b().Qm,...y().A.isMobile?{marginTop:0,padding:b().X1,background:o.background.elevated}:{marginInlineStart:b().Qm,marginInlineEnd:b().Qm,paddingBlockEnd:b().Lh}},children:(0,v().uv)(w).map((e=>(0,C.jsx)(A,{chartType:e,currentlySelectedChartType:n,disabled:t},e)))})}function A({chartType:e,currentlySelectedChartType:t,disabled:o}){const s=(0,u().ET)(),a=(0,i().v3)(),c=(0,d().tz)(),{itemRef:p,isTabbable:g,onKeyDown:v}=(0,S().e)(),b=(0,l().IS)((e=>{const t=y().A.isMobile?50:40;return{button:{display:"flex",alignItems:"center",justifyContent:"center",flexGrow:1,borderRadius:8,padding:6,boxShadow:y().A.isMobile?`0 0 0 1.5px ${e.border.primary} inset`:`0 0 0 1px ${e.border.primary} inset`,position:"relative",width:"100%",height:t,...y().A.isMobile?{background:e.background.elevated}:{}},selectedButton:{...y().A.isMobile?{background:e.background.elevated}:{},boxShadow:`0 0 0 2px ${e.blue.icon.accentPrimary} inset`}}}),[]),j=(0,r().O$)(s.normalizedSchemaStore),A=(0,n.useCallback)((e=>{const t=s.collectionViewStore(),o=null==t?void 0:t.getChartConfig();t&&o&&(0,m().QJ)(e,o,a,t,s,j)}),[s,a,j]);return(0,C.jsx)(x().A,{placement:"top",alignment:"center",renderTooltip:t=>c.formatMessage(m().FZ[e]),render:i=>(0,n.createElement)(f().Ay,{...i,ref:p,key:e,style:{...b.button,...e===t&&b.selectedButton},onClick:()=>{A(e)},onKeyDown:v,disallowTabbing:!g,disabled:o||e===t,disabledFeedback:o,ariaLabel:c.formatMessage(m().FZ[e])},(0,C.jsx)(h().I,{icon:w[e],size:"lg",colorPalette:e===t?"blue":void 0,colorVariant:e===t?"accentPrimary":"secondary"}))})}o(944114),o(898992),o(672577),o(803949);var _=()=>o(594013),I=()=>o(100594),k=()=>o(499755),M=()=>o(67657),T=()=>o(62371),P=()=>o(713998),B=()=>o(340498);const F={viewBox:"0 0 20 20",fittedViewBox:"2.37 0.12 17.5 17.51",svg:(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("path",{d:"M12.25.125a.625.625 0 0 0-.625.625v7a.625.625 0 0 0 .625.625h7c.345 0 .625-.28.625-.625A7.625 7.625 0 0 0 12.25.125m.625 7v-5.72a6.38 6.38 0 0 1 5.72 5.72z"}),(0,C.jsx)("path",{d:"M10 2.375A7.625 7.625 0 1 0 17.625 10 .625.625 0 0 0 17 9.375h-6.375V3A.625.625 0 0 0 10 2.375M3.625 10c0-3.31 2.523-6.03 5.75-6.345V10a.625.625 0 0 0 .625.625h6.345A6.376 6.376 0 0 1 3.625 10"})]})},V=(0,B().wt)("chartPieCutout",F);var D=()=>o(765974),E=()=>o(979251),R=()=>o(496603),O=()=>o(284371),K=()=>o(436696),N=()=>o(384944),L=()=>o(231297),z=()=>o(476492),U=()=>o(656881),W=(o(354520),o(737550),o.n(o(844751))),H=()=>o(852424),G=()=>o(965134),$=()=>o(760217),Q=()=>o(406699),Y=()=>o(811979),q=()=>o(419357),J=()=>o(404277),X=()=>o(939740),Z=()=>o(64e3),ee=()=>o(662971),te=()=>o(722372),oe=()=>o(722872),ne=()=>o(553965),ie=()=>o(463830),re=()=>o(527438),le=()=>o(497222);const se="search-item",ae="default",ce="aggregate",de="distinct",ue={main_property:[ae],aggregation_property:[ae,ce,de],y_axis_stacked_groups:[ae]},pe=["sum","average","min","max","median"];function ge(e){return"unique"===e||"sum"===e||"average"===e||"min"===e||"max"===e||"median"===e}function me(e){switch(e.type){case"none":case"record_count":return e.type;case"property_group":{const t=e.groupByOption??"undefined";return`group:${e.property}-${t}`}case"aggregation":return`aggregation:${e.property}-${e.aggregation??"undefined"}`;default:(0,v().HB)(e)}}function Se(e){const{collectionContextStore:t,selectedProperty:o,properties:s,callsite:a,handlePropertySelect:c,originProps:u,disabled:g,rightStyle:S,...y}=e,f=(0,i().v3)(),x=(0,i().Y0)(),b=(0,d().tz)(),[w,j]=n.useState(""),A=(0,r().uB)(void 0,ie().A),_=(0,r().O$)(A).open,I=(0,r().O$)(t.normalizedSchemaStore),k=s.length>re().R8,M=(0,r().K8)((()=>{const e=R().$z(s,(e=>e.sectionName));return ue[a].map((t=>{const o=e[t]??[];return[...o.filter((e=>"none"===e.key.type)),...o.filter((e=>"none"!==e.key.type)).sort(((e,t)=>e.name<t.name?-1:e.name>t.name?1:0))]}))}),[s,a]),T=(0,r().K8)((()=>{if(w.length>0){return M.map((e=>W().filter(w,e,{extract:e=>e.name}).map((({original:e})=>e))))}return M}),[w,M]),F=(0,l().IS)((e=>({propertyIcon:{theme:e,fill:e.icon.primary}})),[]);function V(){if(!o)return(0,C.jsx)(d().sA,{...m().G_.none});const e=e=>{for(let t=0;t<e.length;t++){const n=e[t];if(me(n.key)===me(o))return n}},t=e(s);if(t)return"property_group"===t.key.type&&t.sectionName===de?(0,C.jsx)("span",{style:O().RC,children:`${t.name} (${(0,m().TQ)({aggregation:{property:t.key.property,aggregator:"unique"},databaseType:void 0,intl:b})})`}):(0,C.jsx)("span",{style:O().RC,children:t.name});const n=(t=>{for(let o=0;o<t.length;o++){const n=t[o];if(n.subMenuItems){const t=e(n.subMenuItems);if(t)return{subMenuItem:t,menuItem:n}}}})(s);return n?(0,C.jsx)("span",{style:O().RC,children:`${n.menuItem.name} (${n.subMenuItem.name})`}):(0,C.jsx)(d().sA,{...m().G_.none})}function D(e){const{key:t,name:n,subMenuItems:i}=e;let r;if("record_count"===t.type)r=(0,C.jsx)(h().I,{icon:G().i});else if("property_group"===t.type){const e=(0,P()._g)({schema:I,property:t.property});r=e?(0,C.jsx)(H().zB,{type:e.type,icon:e.icon,size:B().Ev.sm,theme:F.propertyIcon.theme,style:{fill:F.propertyIcon.fill}}):void 0}if(i&&i.length>0){return{key:n,render:(e,t)=>(0,C.jsx)(ee().A,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,C.jsx)($().A,{...e,ref:t,title:n,icon:r}),renderExtension:(e,o)=>{let n;return n=x.isMobile?{menuType:oe().gu.ActionSheet}:{menuType:oe().gu.Popup,width:200},(0,C.jsx)(J().A,{...n,...e,children:(0,C.jsx)(X().Ay,{type:X().Oh.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,C.jsx)(p().A,{...e}),items:R().oE(null==i?void 0:i.map(D))}],onAccept:t.onAccept})})}}),action:()=>null}}const l=o&&me(o)===me(t);let s=n;"aggregation"===t.type&&(s="value"===t.aggregation?b.formatMessage(m().bg.chartAggregateByValues):"unique"===t.aggregation?b.formatMessage(ye.distinctValues):te().zY[t.aggregation]);const a={key:n,render:e=>(0,C.jsx)($().A,{...e,title:s,icon:r,isChecked:l}),action:t=>{c(e)}};return a}return(0,C.jsx)(Y().A,{focused:!1,buttonPopupStore:A,alignmentToOrigin:"end",placementToOrigin:"bottom",popupType:x.isMobile?Q().z.SlideUp:Q().z.Popup,onClose:()=>{j((()=>""))},renderOrigin:e=>(0,C.jsx)(le().A,{...(0,ne().A)(e,y),showChevron:!0,rotateChevron:_,icon:u.icon,title:u.title,right:V(),disabled:g,rightStyle:S}),render:e=>{const t=f.device.isMobile?{menuType:oe().gu.ActionSheet}:{menuType:oe().gu.Popup,width:250,maxHeight:400},o=[];if(k){const e={key:se,items:[{key:se,render:(e,t)=>(0,C.jsx)(q().Ay,{...e,value:w,onChange:e=>{j((()=>e.target.value))},focusInitial:!0,placeholder:b.formatMessage({id:"database.viewSettings.ChartSettingsPropertySearchMenuItem.searchPlaceholder",defaultMessage:"Search properties..."})}),action:e=>{}}],showNoResultMessage:!0,render:e=>(0,C.jsx)(p().A,{isInput:!0,...e})};o.push(e)}if(T.some((e=>e.length>0)))T.forEach((e=>{if(0===e.length)return;const t=e[0].sectionName,n={key:t,items:e.map(D).filter(v().O9),render:e=>(0,C.jsx)(p().A,{...e,topBorder:t!==ae})};o.push(n)}));else{const e=b.formatMessage(m().bg.noResultsMenuItem),t={key:e,items:[{key:`${e}-item`,action:()=>{},render:e=>(0,C.jsx)(Z().A,{title:(0,C.jsx)(d().sA,{...m().bg.noResultsMenuItem})})}],render:e=>(0,C.jsx)(p().A,{...e})};o.push(t)}return(0,C.jsx)(J().A,{...t,children:(0,C.jsx)(X().Ay,{initialFocus:0,type:X().Oh.Vertical,sections:o,onAccept:t=>{t.key!==se&&e.close()}})})}})}const ye=(0,d().YK)({distinctValues:{id:"database.viewSettings.ChartSettingsPropertySearchMenuItem.distinctValues",defaultMessage:"Distinct values"}});function fe(e){var t;const{environment:o,menuItem:n,chartConfig:i,collectionSchema:r,collectionViewStore:l,collectionContextStore:s,mainPropertyId:c}=e,{key:d,sectionName:u}=n,p=(0,_().o_)({property:c,collectionSchema:r,hideEmptyGroups:"donut"===i.type||Boolean(null===(t=i.chartFormat)||void 0===t?void 0:t.axisHideEmptyGroups)});if(!p)return;let g=(0,R().mg)(i);const m="groups_reducer"===g.dataConfig.type?g.dataConfig.groupBy:p;if(m){if("property_group"===d.type){if(u!==de)return;"donut"===g.type?g.dataConfig={type:"groups_reducer",groupBy:m,aggregationConfig:{aggregation:{aggregator:"unique",property:d.property}}}:g=(0,I().CN)({chartConfig:g,xAxisPropertyId:c,newDataConfigType:"groups_reducer",groupBy:m,aggregation:{aggregator:"unique",property:d.property}})}"donut"===g.type?"record_count"===d.type?g.dataConfig={type:"groups_reducer",groupBy:m,aggregationConfig:{aggregation:{aggregator:"count"}}}:"aggregation"===d.type&&("value"===d.aggregation?g.dataConfig={type:"results_reducer",nameProperty:c,valueProperty:d.property}:g.dataConfig={type:"groups_reducer",groupBy:m,aggregationConfig:{aggregation:{aggregator:d.aggregation,property:d.property}}}):"record_count"===d.type?g=(0,I().CN)({chartConfig:g,xAxisPropertyId:c,newDataConfigType:"groups_reducer",groupBy:m,aggregation:{aggregator:"count"}}):"aggregation"===d.type&&(g="value"===d.aggregation?(0,I().CN)({chartConfig:g,xAxisPropertyId:c,newDataConfigType:"results_reducer",groupBy:m,valueProperty:d.property}):(0,I().CN)({chartConfig:g,xAxisPropertyId:c,newDataConfigType:"groups_reducer",groupBy:m,aggregation:{aggregator:d.aggregation,property:d.property}})),L().createAndCommit({userAction:(0,a().m)(g)?"chartSettings.setYAxis":"chartSettings.setDonutSlice",environment:o,canUndo:!0,perform:e=>{N().zv({store:l.getFormatStore().getKeyStore("chart_config"),data:g,transaction:e})}}),(0,K().X)({environment:o,collectionContextStore:s,action:(0,a().m)(g)?"charts_y_axis_what_to_show":"charts_donut_slice_value",charts_analytics_context:(0,z().nL)(s)})}}var he=()=>o(812480);function ve({chartConfig:e,chartError:t,disabled:o}){const a=(0,i().v3)(),c=(0,u().ET)(),p=(0,d().tz)(),g=(0,l().IS)((e=>({errorIcon:{...(0,m().FE)(e),width:B().Ev.default,height:B().Ev.default}})),[]),S=(0,m().k1)(),y=(0,r().K8)((()=>c.collectionViewStore()),[c]),f=(0,r().O$)(c.normalizedSchemaStore),h=(0,r().K8)((()=>null==e?void 0:e.dataConfig),[e]),b=(0,r().K8)((()=>{if("groups_reducer"===(null==h?void 0:h.type)){const e=h.groupBy;return(0,T().sj)(e)||(0,T().Ik)(e)?{type:"property_group",property:e.property,groupByOption:e.groupBy}:{type:"property_group",property:h.groupBy.property}}if("results_reducer"===(null==h?void 0:h.type))return{type:"property_group",property:h.nameProperty}}),[h]),w=t&&(0,s().lc)(t)?()=>(0,D().exclamationMarkTriangleFillIcon)(g.errorIcon):E().j,j=(0,r().K8)((()=>{const e=(0,v().WP)(f),t=[];return e.forEach((([e,o])=>{o&&((0,T().iF)(o.type)?t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ae,subMenuItems:T().PC.map((t=>({key:{type:"property_group",property:e,groupByOption:t},name:p.formatMessage(he().eD[t]),sectionName:ae})))}):(0,I().zn)(o)?t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ae,subMenuItems:T().BI.map((t=>({key:{type:"property_group",property:e,groupByOption:t},name:p.formatMessage(he().WK[t]),sectionName:ae})))}):(0,T().Eg)(o)&&t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ae}))})),t}),[f,p]),A=n.useCallback((t=>{var o;const{key:n}=t,{property:i,groupByOption:r}=n;if(!e||!y)return;const l=f[i],s=(0,_().o_)({property:i,collectionSchema:f,hideEmptyGroups:!0});if(!l||!s)return;const d=Object.keys(f),u="results_reducer"===e.dataConfig.type?e.dataConfig.valueProperty:d.find((e=>{const t=f[e];return Boolean(t&&(0,_().Iw)(t))})),p={aggregator:"count"},g=R().mg(e);if(l&&(0,_().tH)(l)&&u)g.dataConfig={type:"results_reducer",nameProperty:i,valueProperty:u};else if(r){const e=(0,I().xS)({property:i,propertySchema:l,groupByOption:r,hideEmptyGroups:!0});e&&(g.dataConfig={type:"groups_reducer",groupBy:e,aggregationConfig:{aggregation:p}})}else if(s){const t="groups_reducer"===e.dataConfig.type?e.dataConfig.aggregationConfig.aggregation:p;g.dataConfig={type:"groups_reducer",groupBy:s,aggregationConfig:{aggregation:t}};const o="formula"===s.type?s.groupBy.sort:s.sort;g.chartFormat={...e.chartFormat,mainSort:l&&(0,k().e0)(l)?k().S0.yDescending:(0,k().gN)(o)}}(0,m().Qn)({environment:a,collectionContextStore:c,chartConfig:g,sort:null===(o=g.chartFormat)||void 0===o?void 0:o.mainSort}),L().createAndCommit({userAction:"chartSettings.setDonutGroupBy",environment:a,canUndo:!0,perform:e=>{N().zv({store:y.getFormatStore().getKeyStore("chart_config"),data:g,transaction:e})}}),(0,K().X)({environment:a,collectionContextStore:c,action:"charts_donut_property",charts_analytics_context:(0,z().nL)(c)})}),[f,y,a,e,c]);return(0,C.jsx)(x().A,{textWrap:!0,placement:"left",disableTooltip:!t||!(0,s().lc)(t),renderTooltip:e=>t?(0,C.jsx)("span",{...e,children:(0,U().y)(t)}):null,render:e=>(0,C.jsx)(Se,{...e,collectionContextStore:c,selectedProperty:b,properties:j,handlePropertySelect:A,originProps:{title:(0,C.jsx)("span",{children:(0,C.jsx)(d().sA,{...m().bg.chartWhatToShow})}),icon:w},callsite:"main_property",disabled:o,rightStyle:S.whatToShowRightText})})}function xe({chartConfig:e,chartError:t,disabled:o}){const a=(0,d().tz)(),c=(0,i().v3)(),p=(0,u().ET)(),g=(0,l().IS)((e=>({errorIcon:{...(0,m().FE)(e),width:B().Ev.default,height:B().Ev.default,marginInlineStart:4}})),[]),S=(0,m().k1)(),y=(0,r().K8)((()=>p.collectionViewStore()),[p]),f=(0,r().K8)((()=>p.databaseType),[p]),h=(0,r().O$)(p.normalizedSchemaStore),b=(0,r().K8)((()=>null==e?void 0:e.dataConfig),[e]),w=(0,r().K8)((()=>{if(b)return"groups_reducer"===b.type?b.groupBy.property:b.nameProperty}),[b]),j=(0,r().K8)((()=>w?h[w]:void 0),[w,h]),A=(0,r().K8)((()=>{if(b)if("groups_reducer"===b.type){const e=null==b?void 0:b.aggregationConfig.aggregation;if((0,M().Iq)(e))return{type:"record_count"};if(ge(e.aggregator)){const t=(0,P()._g)({schema:h,property:e.property});if(!t)return;return(0,I().JW)(t)||"unique"!==e.aggregator?{type:"aggregation",property:e.property,aggregation:e.aggregator}:{type:"property_group",property:e.property}}}else if("results_reducer"===b.type&&b.valueProperty)return{type:"aggregation",property:b.valueProperty,aggregation:"value"}}),[h,b]),k=(0,r().K8)((()=>{if(!b||!j)return[];const e=[];(0,v().WP)(h).forEach((([t,o])=>{if(!o||t===w||!(0,T().Eg)(o))return;const n=[];(0,_().Iw)(o)&&(0,_().tH)(j)&&n.push({key:{type:"aggregation",property:t,aggregation:"value"},name:a.formatMessage(m().bg.chartAggregateByValues),sectionName:ce});const i=(0,I().JW)(o);if(i){pe.forEach((e=>{const o={aggregator:e,property:t},i={key:{type:"aggregation",property:t,aggregation:e},name:(0,m().TQ)({aggregation:o,databaseType:f,intl:a})||"",sectionName:ce};n.push(i)}));const e={key:{type:"aggregation",property:t,aggregation:"unique"},name:(0,m().TQ)({aggregation:{aggregator:"unique",property:t},databaseType:f,intl:a})||"",sectionName:ce};n.push(e)}const r={key:{type:"property_group",property:t},name:o.name,sectionName:i?ce:de,subMenuItems:n};e.push(r)}));return[{key:{type:"record_count"},name:(0,m().TQ)({aggregation:{aggregator:"count"},databaseType:f,intl:a})||"",sectionName:"default"},...e]}),[b,j,h,f,a,w]),F=(0,r().K8)((()=>t&&(0,s().dG)(t)?()=>(0,D().exclamationMarkTriangleFillIcon)(g.errorIcon):V),[t,g.errorIcon]),E=n.useCallback((t=>{y&&e&&w&&fe({environment:c,menuItem:t,chartConfig:e,collectionSchema:h,collectionViewStore:y,collectionContextStore:p,mainPropertyId:w})}),[e,h,y,c,w,p]);return(0,C.jsx)(x().A,{textWrap:!0,placement:"left",disableTooltip:!t||!(0,s().dG)(t),renderTooltip:e=>t?(0,C.jsx)("span",{...e,children:(0,U().y)(t)}):null,render:e=>(0,C.jsx)(Se,{...e,collectionContextStore:p,selectedProperty:t?void 0:A,properties:k,handlePropertySelect:E,originProps:{title:(0,C.jsx)("span",{style:O().RC,children:(0,C.jsx)(d().sA,{...m().bg.chartSliceDonutAggregation})}),icon:F},callsite:"aggregation_property",disabled:o,rightStyle:S.donutSliceValueRightText})})}var be=()=>o(496506),Ce=()=>o(98126),we=()=>o(406094),je=()=>o(160432),Ae=()=>o(100622),_e=(o(964979),o(814603),o(147566),o(198721),()=>o(148307)),Ie=()=>o(620586),ke=()=>o(252051),Me=()=>o(972435),Te=()=>o(884107),Pe=()=>o(901389),Be=()=>o(471995);function Fe(e){return{width:ke().o0+ke().eq+ke().PB,height:ke().p0+ke().jQ+ke().PB}}async function Ve(e){const{environment:t,previewCanvas:o,chartStore:n}=e,{chart:i,responsiveChartOptions:r,exportBackgroundColor:l}=n.state;if(o)if("png"===e.format){const c=o.toDataURL("image/png");if("copy"===e.type){const d=await Te().R.clipboardActions.load();async function u(){const e=await fetch(c);return await e.blob()}const p=new ClipboardItem({"image/png":u()});try{await navigator.clipboard.write([p]),Be().D6({label:Me().A.formatMessage(d.clipboardMessages.copiedImageToClipboard)})}catch(a){Pe().f1(Me().A.formatMessage(d.clipboardMessages.copyImageError))}}else if(t.device.isMobileNative){var s;null===(s=t.mobileNative)||void 0===s||s.showLightBoxV2({url:c,downloadName:`${Me().A.formatMessage(ke().jV.chart)}.png`,type:"image",from:"chart",state:"url_ready"})}else{const g=document.createElement("a");g.href=c,g.download=`${Me().A.formatMessage(ke().jV.chart)}.png`,g.click()}}else if("svg"===e.format){if("copy"===e.type)return;null==i||i.exportChartLocal({type:"image/svg+xml",filename:Me().A.formatMessage(ke().jV.chart)},{...(0,ke().j2)(l),...r??{}})}else(0,v().HB)(e.format)}var De=()=>o(45552),Ee=()=>o(532564),Re=()=>o(658512),Oe=()=>o(152197),Ke=()=>o(62856),Ne=()=>o(329304);const Le=290,ze=8,Ue=14;const We=function(e){const t=(0,d().tz)(),n=(0,i().Y0)();return n.isMobile&&n.isAndroid?null:(0,C.jsx)(Y().A,{focused:!1,popupType:n.isMobile?Q().z.SlideUp:Q().z.Popup,placementToOrigin:"top",alignmentToOrigin:"center",render:e=>(0,C.jsx)(He,{menuParent:e}),renderOrigin:n=>(0,C.jsx)(le().A,{...n,showChevron:!0,disabled:e.disabled,title:t.formatMessage(ke().jV.exportChart),icon:o(820579).arrowLineDownIcon})})};function He(e){var t;const o=(0,i().v3)(),s=(0,d().tz)(),a=(0,Ee().V)(),c=(0,u().ET)(),g=(0,Oe().r)(),m=(0,Ne().P9)({name:"watermarkless_chart_export",spaceId:g,userId:null===(t=o.currentUser)||void 0===t?void 0:t.id}),S=n.useRef(null),{isLoading:y,hasError:f,exportDisabled:h}=(0,r().K8)((()=>({isLoading:"loading"===a.state.previewCanvasState,hasError:"error"===a.state.previewCanvasState,exportDisabled:"loading"===a.state.previewCanvasState||"error"===a.state.previewCanvasState})),[a]),v=(0,r().K8)((()=>Ie().Q1.filter((e=>!(!m&&"none"===e)))),[m]),x=(0,l().IS)((e=>{const t=o.device.isMobile;return{copyButton:{height:t?36:32,fontSize:t?16:14},downloadButton:{height:t?36:32,fontSize:t?16:14,display:"flex",justifyContent:"center",marginTop:8,background:e.background.primary}}}),[o]),b=o.device.isMobile?{menuType:oe().gu.Modal,title:s.formatMessage(ke().jV.exportChart),right:(0,C.jsx)(De().DoneMenuText,{}),onClickRight:e.menuParent.close}:{menuType:oe().gu.Popup,width:Le},w=[{key:"preview",render:e=>(0,C.jsx)(Ge,{...e,previewCanvasRef:S,isLoading:y,hasError:f}),items:[]},{key:"background",render:e=>(0,C.jsx)(p().A,{...e,title:s.formatMessage(ke().jV.exportChartBackground),mobileTitleStyle:{lineHeight:void 0},disableMobileBorders:!0,children:(0,C.jsx)("div",{style:{display:"flex",justifyContent:"space-between",paddingInlineStart:Ue+3,paddingInlineEnd:Ue+3,paddingTop:ze,paddingBottom:ze},children:e.children})}),items:v.map((e=>({key:e,render:t=>(0,C.jsx)(Qe,{menuListItemProps:t,disabled:h,colors:v,color:e}),action:()=>{a.setState({...a.state,exportBackgroundColor:e})}})))},{key:"export",render:e=>(0,C.jsx)(p().A,{...e,topBorder:!0,disableMobileBorders:!0,children:(0,C.jsx)("div",{style:{display:"flex",flexDirection:"column",padding:"8px 14px",paddingTop:8},children:e.children})}),items:[{key:"copyPng",render:e=>(0,C.jsx)(je().A,{colorPalette:"blue",...e,style:x.copyButton,disabled:h,children:s.formatMessage(ke().jV.copyPng)}),action:async()=>{await Ve({environment:o,previewCanvas:S.current,chartStore:a,type:"copy",format:"png"}),(0,K().X)({environment:o,collectionContextStore:c,action:"charts_export_copy_png",charts_analytics_context:(0,z().nL)(c)})}},{key:"downloadPng",render:e=>(0,C.jsx)(we().A,{...e,size:"lg",style:x.downloadButton,disabled:h,disabledFeedback:h,children:s.formatMessage(ke().jV.downloadPng)}),action:async()=>{await Ve({environment:o,previewCanvas:S.current,chartStore:a,type:"download",format:"png"}),(0,K().X)({environment:o,collectionContextStore:c,action:"charts_export_download_png",charts_analytics_context:(0,z().nL)(c)})}},{key:"downloadSvg",render:e=>o.device.isMobile?null:(0,C.jsx)(we().A,{...e,size:"lg",style:x.downloadButton,disabled:h,disabledFeedback:h,children:s.formatMessage(ke().jV.downloadSvg)}),action:async()=>{await Ve({environment:o,previewCanvas:S.current,chartStore:a,type:"download",format:"svg"})}}]}];return(0,C.jsx)(J().A,{...b,children:(0,C.jsx)(X().Ay,{initialFocus:0,type:X().Oh.Vertical,sections:w})})}function Ge(e){const t=(0,d().tz)(),o=(0,l().eP)(),i=(0,Ae().O4)({theme:o}),s=(0,Ee().V)(),a=(0,r().K8)((()=>s.state.exportBackgroundColor),[s]),c=(0,Ke().A)(!0,ke().Yp,0,!1);n.useEffect((()=>{const t=new(be().ComputedStore)((()=>({chart:s.state.chart,exportBackgroundColor:s.state.exportBackgroundColor,responsiveChartOptions:s.state.responsiveChartOptions})),{debugName:"chartDrawingStateStore"});function o(){const o=e.previewCanvasRef.current;o&&function(e,t,o,n){const{chart:i,responsiveChartOptions:r,exportBackgroundColor:l}=t;o((()=>{}));const s=e.getContext("2d");if(!i||!s)return;let a;setTimeout((()=>{o((e=>void 0===e?"loading":e))}),ke().Yp);try{a=i.getSVG({...(0,ke().j2)(l),...r??{}})}catch(f){return console.error(f),void o((()=>"error"))}const c=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),d=URL.createObjectURL(c),u=new Image,p=new Image,g=new Image,m=new Promise(((e,t)=>{"gradient"===l?(u.onload=()=>e(u),u.onerror=()=>t(new Error("Failed to load gradient image")),u.src="light"===n.mode?_e().A.images.charts.chartsExportGradientLightPng:_e().A.images.charts.chartsExportGradientDarkPng):e(u)})),S=new Promise(((e,t)=>{p.onload=()=>e(p),p.onerror=()=>t(new Error("Failed to load chart image")),p.src=`data:image/svg+xml;charset=utf-8;base64,${btoa(unescape(encodeURIComponent(a)))}`})),y=new Promise(((e,t)=>{g.onload=()=>e(g),g.onerror=()=>t(new Error("Failed to load chart image")),g.src="light"===n.mode?_e().A.images.charts.chartsExportLogoLightPng:_e().A.images.charts.chartsExportLogoDarkPng}));Promise.all([m,S,y]).then((([t,i,r])=>{URL.revokeObjectURL(d);const a=Fe();if(e.width=a.width*ke().Zz,e.height=a.height*ke().Zz,s.scale(ke().Zz,ke().Zz),"gradient"===l?s.drawImage(t,0,0,e.width,e.height):"none"===l?(s.fillStyle=n.background.primary,s.fillRect(0,0,e.width,e.height)):(s.fillStyle=(0,Ie().NF)(n,l,!1),s.fillRect(0,0,e.width,e.height)),"none"!==l&&(s.strokeStyle=n.regularDividerColor,s.fillStyle=n.background.primary,s.shadowColor="dark"===n.mode?"rgba(0, 0, 0, 0.25)":"rgba(0, 0, 0, 0.07)",s.shadowBlur=24,s.shadowOffsetY=8,s.beginPath(),s.roundRect(ke().iq,ke().XC,e.width/ke().Zz-ke().eq,e.height/ke().Zz-ke().jQ,12),s.stroke(),s.fill(),s.shadowColor="transparent"),"none"!==l){const e=Me().A.formatMessage(ke().jV.madeWithNotion);s.font=`14px ${O().Tf.sans}`;const t=a.width/2+ke().ev+ke().kC,o=a.height-ke().XC/2;s.textAlign="center",s.textBaseline="middle",s.fillStyle=n.text.tertiary,s.fillText(e,t,o);const i=s.measureText(e),l=a.width/2-i.width/2,c=o-ke().kC/2;s.drawImage(r,0,0,r.width,r.height,l,c,ke().kC,ke().kC)}"none"===l?s.drawImage(i,ke().AI,ke().AI):s.drawImage(i,ke().iq+ke().AI,ke().XC+ke().AI),o((()=>"success"))})).catch((()=>{o((()=>"error"))}))}(o,t.state,s.updatePreviewState,i)}return o(),t.addListener(o),()=>{t.removeListener(o)}}),[e.previewCanvasRef,s,i]);const u=(0,l().IS)((t=>{const o=Le-2*Ue,n=Fe(),i=o*(n.height/n.width);return{container:{width:`calc(100% - ${2*Ue})`,height:e.isLoading||e.hasError?i:void 0,display:"flex",alignItems:"center",justifyContent:"center",marginTop:ze,marginInlineStart:Ue,marginInlineEnd:Ue,border:`1px solid ${t.regularDividerColor}`,borderRadius:6,fontSize:12,color:t.text.tertiary},canvas:{width:"100%",borderRadius:6,display:e.isLoading||e.hasError?"none":"block"}}}),[e.hasError,e.isLoading,a]);return(0,C.jsx)(p().A,{title:t.formatMessage(ke().jV.exportChartPreview),disableMobileBorders:!0,mobileTitleStyle:{lineHeight:void 0},children:(0,C.jsxs)("div",{style:u.container,children:[(0,C.jsx)("canvas",{style:u.canvas,ref:e.previewCanvasRef}),c&&e.isLoading?(0,C.jsx)(Ce().k,{}):void 0,e.hasError?(0,C.jsx)("span",{children:t.formatMessage(Re().k.generic_error)}):void 0]})})}const $e=10;function Qe(e){const t=(0,d().tz)(),o=(0,Ee().V)(),n=(0,i().Y0)(),s=(0,r().K8)((()=>e.color===o.state.exportBackgroundColor),[o,e.color]),a=(0,l().IS)((t=>({button:{position:"relative",width:`calc((100%  / ${e.colors.length}) - ${$e}px)`,height:n.isMobile?36:28,borderRadius:4,boxShadow:`0 0 0 2px ${t.popoverBackground}, 0 0 0 3px ${t.regularDividerColor}`,background:(0,Ie().NF)(t,e.color,!1)},selectedButton:{boxShadow:`0 0 0 2px ${t.popoverBackground}, 0 0 0 4px ${t.blue.border.accentPrimary}`},hoveredStyle:{background:(0,Ie().NF)(t,e.color,!0)},pressedStyle:{background:(0,Ie().NF)(t,e.color,!1)}})),[n.isMobile,e.color,e.colors.length]);return(0,C.jsx)(f().Ay,{...e.menuListItemProps,style:{...a.button,...s?a.selectedButton:{}},hoveredStyle:a.hoveredStyle,pressedStyle:a.pressedStyle,ariaLabel:t.formatMessage((0,Ie().nH)(e.color)),disabled:e.disabled,disabledFeedback:e.disabled})}const Ye={viewBox:"0 0 20 20",fittedViewBox:"3.75 9 12.5 2.01",svg:(0,C.jsx)("path",{d:"M4.75 9a1 1 0 1 1 0 2 1 1 0 0 1 0-2m3.5 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2m3.5 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2m3.5 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2"})},qe=(0,B().wt)("dottedLineHorizontal",Ye);var Je=()=>o(606476),Xe=()=>o(617668),Ze=()=>o(236262),et=()=>o(285790),tt=()=>o(206267);function ot(e,t,o,n,i,r){var l;const s=n.getChartFormatStore();if(!s||!o.chartFormat)return;const a=(null===(l=o.chartFormat)||void 0===l?void 0:l.referenceLines)??[];if(!a.some((t=>t.id===e)))return;const c=a.map((o=>o.id===e?{...o,...t}:o));L().createAndCommit({userAction:"chartSettings.updateReferenceLine",environment:i,canUndo:!0,perform:e=>{N().KY({store:s.getKeyStore("referenceLines"),value:c,transaction:e})}}),(0,K().X)({environment:i,collectionContextStore:r,action:"charts_style_reference_line_update"})}function nt(e,t,o,n,i){var r;const l=o.getChartFormatStore();if(!l||!t.chartFormat)return;const s=(null===(r=t.chartFormat)||void 0===r?void 0:r.referenceLines)??[];if(!s.some((t=>t.id===e)))return;const a=s.filter((t=>t.id!==e));L().createAndCommit({userAction:"chartSettings.removeReferenceLine",environment:n,canUndo:!0,perform:e=>{N().KY({store:l.getKeyStore("referenceLines"),value:a,transaction:e})}}),(0,K().X)({environment:n,collectionContextStore:i,action:"charts_style_reference_line_remove"})}var it=o.n(o(901080)),rt=()=>o(623580);function lt(e){const{title:t,value:o,inputType:i,placeholder:r,disabled:s=!1,maxLength:a,onChange:c,onBlur:d,onSubmit:u,rightIconButton:p}=e,g=(0,l().IS)((e=>({container:{display:"flex",flexDirection:"column",paddingInlineStart:8,paddingInlineEnd:8,marginBottom:2,...y().A.isMobile&&{backgroundColor:e.background.primary,paddingBottom:6,paddingTop:6,gap:4}},header:{display:"flex",justifyContent:"space-between",alignItems:"center"},title:y().A.isMobile?{color:e.text.secondary,lineHeight:1.1,fontSize:15}:{color:e.text.secondary,fontSize:12,lineHeight:"120%",minHeight:24,display:"flex",alignItems:"center",justifyContent:"center"},input:{flexGrow:1,backgroundColor:e.background.secondary},inputContainer:{flexGrow:1}})),[]),[m,S]=(0,n.useState)(""),f=(0,n.useRef)(""),h=(0,n.useRef)(o);(0,n.useEffect)((()=>{const e=void 0===o?"":o.toString();S(e),f.current=e,h.current=o}),[o]);const v=(0,n.useCallback)((e=>{if("number"===i){if(""===e.trim())return;const t=it()(e);return isNaN(t)?void 0:t}return""===e.trim()?void 0:e}),[i]),x=(0,n.useCallback)((e=>{const t=e.target.value;S(t),f.current=t;const o=v(t);c(o)}),[c,v]),b=(0,n.useCallback)((()=>{const e=v(f.current);d&&d(e)}),[d,v]),w=(0,n.useCallback)((e=>{if("Enter"===e.key){const e=v(f.current);u&&u(e)}}),[u,v]);return(0,C.jsxs)("div",{style:g.container,children:[(0,C.jsxs)("div",{style:g.header,children:[(0,C.jsx)("div",{style:g.title,children:t}),p||null]}),(0,C.jsx)("div",{style:g.inputContainer,children:(0,C.jsx)(rt().A,{type:"number"===i?"number":"text",value:m,placeholder:r||t,inputClassName:"number"===i?"input-hide-arrows":void 0,maxlength:a,disabled:s,onChange:x,onBlur:b,onKeyDown:w,style:g.input})})]})}const st=50;function at(e){var t,o;const{collectionViewStore:i,chartConfig:r,disabled:s}=e,a=(0,l().DP)(),c=y().A.isMobile,[u,g]=(0,n.useState)({value:void 0,label:void 0,color:"gray",dashStyle:"Solid"}),m=(0,n.useMemo)((()=>({onValueChange:e=>{g((t=>({...t,value:"number"==typeof e?e:void 0})))},onLabelChange:e=>{g((t=>({...t,label:null==e?void 0:e.toString()})))},onColorChange:e=>{g((t=>({...t,color:e})))},onDashStyleChange:e=>{g((t=>({...t,dashStyle:e})))}})),[]),S=(0,n.useCallback)(((e,t)=>{const o=[{key:`chartReferenceLineValue-${e}`,render:(o,n)=>(0,C.jsx)(pt,{menuListItemProps:o,parent:n,collectionViewStore:i,chartConfig:r,disabled:s,referenceLineId:e,isPreview:t,previewValue:t?u.value:void 0,onPreviewChange:t?m.onValueChange:void 0}),action:()=>{}},{key:`chartReferenceLineLabel-${e}`,render:(o,n)=>(0,C.jsx)(ut,{menuListItemProps:o,parent:n,collectionViewStore:i,chartConfig:r,disabled:s,referenceLineId:e,previewValue:t?u.label:void 0,onPreviewChange:t?m.onLabelChange:void 0}),action:()=>{}},{key:`chartReferenceLineStrokeStyle-${e}`,render:(o,n)=>(0,C.jsx)(ct,{menuListItemProps:o,parent:n,collectionViewStore:i,chartConfig:r,disabled:s,referenceLineId:e,previewValue:t?u.dashStyle:void 0,onPreviewChange:t?m.onDashStyleChange:void 0}),action:()=>{}},{key:`chartReferenceLineColor-${e}`,render:(o,n)=>(0,C.jsx)(dt,{menuListItemProps:o,parent:n,collectionViewStore:i,chartConfig:r,disabled:s,referenceLineId:e,previewValue:t?u.color:void 0,onPreviewChange:t?m.onColorChange:void 0}),action:()=>{}}];return c&&!t&&o.push({key:`chartReferenceLineDelete-${e}`,render:t=>(0,C.jsx)(mt,{menuListItemProps:t,collectionViewStore:i,chartConfig:r,disabled:s,referenceLineId:e}),action:()=>{}}),o}),[r,i,s,u,m,c]),f=(0,n.useMemo)((()=>{var e;const t=(null===(e=r.chartFormat)||void 0===e?void 0:e.referenceLines)??[];return 0===t.length?[{referenceLineId:"preview-reference-line",items:S("preview-reference-line",!0)}]:t.map((e=>({referenceLineId:e.id,items:S(e.id,!1)})))}),[r,S]),h=c?{menuType:oe().gu.ActionSheet}:{menuType:oe().gu.Popup,minWidth:280,maxHeight:400},v=void 0===(null===(t=r.chartFormat)||void 0===t?void 0:t.referenceLines)||0===(null===(o=r.chartFormat)||void 0===o||null===(o=o.referenceLines)||void 0===o?void 0:o.length);return(0,C.jsx)(J().A,{...h,children:(0,C.jsxs)("div",{style:{padding:12,gap:12,display:"flex",flexDirection:"column",...c&&{backgroundColor:a.background.secondary}},children:[f.map(((e,t)=>{const o="preview-reference-line"===e.referenceLineId,n=(0,C.jsx)(X().Ay,{initialFocus:void 0,type:X().Oh.Vertical,sections:[{key:`default-${e.referenceLineId}`,items:e.items,render:e=>(0,C.jsx)(p().A,{...e})}],resetFocusOnMouseOut:!0},`menu-list-${e.referenceLineId}`);return c&&!o?(0,C.jsx)(p().A,{title:(0,C.jsx)(d().sA,{defaultMessage:"Reference line {index}",id:"chartSettings.referenceLine.index",values:{index:t+1}}),mobileStyle:{marginBottom:8},children:n},`menu-wrapper-${e.referenceLineId}`):(0,C.jsx)("div",{style:{...!v&&{background:a.background.secondary,borderRadius:8}},children:n},`menu-wrapper-${e.referenceLineId}`)})),(0,C.jsx)(X().Ay,{type:X().Oh.Vertical,sections:[{key:"add-reference-line",render:e=>(0,C.jsx)(p().A,{...e,disableDesktopPadding:!0}),items:[{key:"add-reference-line",render:e=>(0,C.jsx)(gt,{...e,collectionViewStore:i,chartConfig:r,disabled:s,onAddComplete:()=>{g({value:void 0,label:void 0,color:"gray",dashStyle:"Solid"})},previewData:u,isReferenceLineEmpty:v}),action:()=>{}}]}],initialFocus:void 0})]})})}function ct(e){const{collectionViewStore:t,chartConfig:o,disabled:l,referenceLineId:s,menuListItemProps:a,previewValue:c,onPreviewChange:g}=e,S=(0,d().tz)(),f=(0,i().v3)(),h=(0,u().ET)(),x=(0,r().uB)(void 0,ie().A),b=void 0!==c||void 0!==g,w=(0,n.useMemo)((()=>{var e;if(b)return c??"Solid";const t=null===(e=o.chartFormat)||void 0===e||null===(e=e.referenceLines)||void 0===e||null===(e=e.find((e=>e.id===s)))||void 0===e?void 0:e.dashStyle;return t||"Solid"}),[o,s,b,c]),j=()=>{const e=(0,v().WP)(m().b$).map((([e,n])=>{const i=w===e,r={key:e,render:e=>(0,C.jsx)($().A,{...e,title:(0,C.jsx)(d().sA,{...n}),isChecked:i}),action:()=>{b&&g?g(e):ot(s,{dashStyle:e},o,t,f,h)}};return r}));return e};return(0,C.jsx)(Y().A,{...a,popupType:y().A.isMobile?Q().z.BottomSheet:Q().z.Popup,disabled:l,focused:!1,buttonPopupStore:x,renderOrigin:t=>(0,C.jsx)(le().A,{...t,icon:void 0,showChevron:!0,rotateChevron:x.state.open,title:S.formatMessage(m().v5.strokeStyle),right:w?S.formatMessage(m().b$[w]):null,disabled:e.disabled}),render:t=>(0,C.jsx)(J().A,{menuType:oe().gu.Popup,children:(0,C.jsx)(X().Ay,{type:X().Oh.Vertical,initialFocus:0,onAccept:e.parent.onAccept,sections:[{key:"gridStyles",render:e=>(0,C.jsx)(p().A,{...e}),items:j()}]})})})}function dt(e){const{collectionViewStore:t,chartConfig:o,disabled:l,referenceLineId:s,menuListItemProps:a,previewValue:c,onPreviewChange:g}=e,S=(0,d().tz)(),f=(0,i().v3)(),h=(0,u().ET)(),v=(0,r().uB)(void 0,ie().A),x=void 0!==c||void 0!==g,b=(0,n.useMemo)((()=>{var e;if(x)return c??"gray";const t=null===(e=o.chartFormat)||void 0===e||null===(e=e.referenceLines)||void 0===e||null===(e=e.find((e=>e.id===s)))||void 0===e?void 0:e.color;return t||"gray"}),[o,s,x,c]),w=()=>{const e=I().VY.map((e=>{const n=m().pP[e],i=b===e,r={key:e,render:e=>(0,C.jsx)($().A,{...e,title:(0,C.jsx)(d().sA,{...n}),isChecked:i}),action:()=>{x&&g?g(e):ot(s,{color:e},o,t,f,h)}};return r}));return e};return(0,C.jsx)(Y().A,{...a,popupType:y().A.isMobile?Q().z.BottomSheet:Q().z.Popup,focused:!1,disabled:l,buttonPopupStore:v,renderOrigin:t=>(0,C.jsx)(le().A,{...t,icon:void 0,showChevron:!0,rotateChevron:v.state.open,title:S.formatMessage(m().v5.color),right:b?S.formatMessage(m().pP[b]):null,disabled:e.disabled}),render:t=>(0,C.jsx)(J().A,{menuType:oe().gu.Popup,children:(0,C.jsx)(X().Ay,{type:X().Oh.Vertical,initialFocus:0,onAccept:e.parent.onAccept,sections:[{key:"colors",render:e=>(0,C.jsx)(p().A,{...e}),items:w()}]})})})}function ut(e){const{collectionViewStore:t,chartConfig:o,disabled:r,referenceLineId:l,previewValue:s,onPreviewChange:a}=e,c=(0,d().tz)(),p=(0,i().v3)(),g=(0,u().ET)(),S=void 0!==s||void 0!==a,y=(0,n.useMemo)((()=>{var e;if(S)return s??"";const t=null===(e=o.chartFormat)||void 0===e||null===(e=e.referenceLines)||void 0===e?void 0:e.find((e=>e.id===l));return(null==t?void 0:t.label)??""}),[o,l,S,s]),f=e=>{S&&a?a(e):ot(l,{label:null==e?void 0:e.toString()},o,t,p,g)};return(0,C.jsx)(lt,{title:c.formatMessage(m().v5.label),value:y,inputType:"text",placeholder:c.formatMessage(m().v5.label),disabled:r,maxLength:st,onChange:f,onBlur:f,onSubmit:f})}function pt(e){var t;const{collectionViewStore:o,chartConfig:r,disabled:l,referenceLineId:s,isPreview:a,previewValue:c,onPreviewChange:p}=e,g=(0,d().tz)(),S=(0,i().v3)(),f=(0,u().ET)(),h=(0,n.useMemo)((()=>{var e;return a?c:null===(e=r.chartFormat)||void 0===e||null===(e=e.referenceLines)||void 0===e||null===(e=e.find((e=>e.id===s)))||void 0===e?void 0:e.value}),[null===(t=r.chartFormat)||void 0===t?void 0:t.referenceLines,s,a,c]),v=e=>{a&&p?p(e):"number"==typeof e&&ot(s,{value:e},r,o,S,f)};return(0,C.jsx)(lt,{title:g.formatMessage(m().v5.value),value:h,inputType:"number",placeholder:g.formatMessage(m().v5.value),disabled:l,onChange:v,onBlur:v,onSubmit:v,rightIconButton:a||y().A.isMobile?null:(0,C.jsx)(et().A,{icon:Ze().trashIcon,ariaLabel:g.formatMessage(m().v5.deleteReferenceLine),onClick:()=>{nt(s,r,o,S,f)}})})}function gt(e){const{collectionViewStore:t,chartConfig:o,disabled:r,previewData:s,onAddComplete:a,isReferenceLineEmpty:c}=e,p=(0,i().v3)(),g=(0,u().ET)(),S=(0,n.useCallback)((()=>{!function(e,t,o,n,i){var r;const l=t.getChartFormatStore();if(!l||!e.chartFormat)return;const s=[...(null===(r=e.chartFormat)||void 0===r?void 0:r.referenceLines)??[],{id:tt().JW(),value:(null==i?void 0:i.value)??0,label:(null==i?void 0:i.label)??"",color:(null==i?void 0:i.color)??"gray",dashStyle:(null==i?void 0:i.dashStyle)??"Dash"}];L().createAndCommit({userAction:"chartSettings.addReferenceLine",environment:o,canUndo:!0,perform:e=>{N().KY({store:l.getKeyStore("referenceLines"),value:s,transaction:e})}}),(0,K().X)({environment:o,collectionContextStore:n,action:"charts_style_reference_line_add"})}(o,t,p,g,s),a()}),[o,t,p,g,s,a]),f={style:(0,l().IS)((e=>({button:{width:"100%",justifyContent:"center",...!c&&{borderColor:e.border.secondary},...y().A.isMobile&&{height:"48px",borderRadius:12},...y().A.isMobile&&!c&&{backgroundColor:e.background.primary,border:"none"}}})),[c]).button,disabled:r,onClick:S};return c?(0,C.jsxs)(je().A,{...f,colorPalette:"blue",children:[(0,C.jsx)(h().I,{icon:Xe().plusIcon}),(0,C.jsx)(d().sA,{...m().v5.addReferenceLine})]}):(0,C.jsxs)(Je().A,{...f,children:[(0,C.jsx)(h().I,{icon:Xe().plusIcon}),(0,C.jsx)(d().sA,{...m().v5.addReferenceLine})]})}function mt(e){const{menuListItemProps:t,collectionViewStore:o,chartConfig:r,disabled:l,referenceLineId:s}=e,a=(0,i().v3)(),c=(0,u().ET)(),p=(0,n.useCallback)((()=>{nt(s,r,o,a,c)}),[s,r,o,a,c]);return(0,C.jsx)($().A,{...t,focused:!1,icon:(0,C.jsx)(h().I,{icon:Ze().trashIcon}),onClick:p,title:(0,C.jsx)(d().sA,{...m().v5.deleteReferenceLine}),isRedOnHover:!0,disabled:l})}function St(e){var t;const{collectionViewStore:o,chartConfig:n,disabled:i}=e,l=(0,r().uB)(void 0,ie().A),s=(null===(t=n.chartFormat)||void 0===t||null===(t=t.referenceLines)||void 0===t?void 0:t.length)??0;return(0,C.jsx)(Y().A,{focused:!1,popupType:y().A.isMobile?Q().z.BottomSheet:Q().z.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",buttonPopupStore:l,renderOrigin:e=>(0,C.jsx)(le().A,{...e,showChevron:!0,title:(0,C.jsx)(d().sA,{...m().v5.referenceLine}),right:(0,C.jsx)(d().sA,{defaultMessage:"{numberOfReferenceLines, plural, one {1 line} other {{numberOfReferenceLines} lines}}",id:"database.viewSettings.chartStyleTab.referenceLine.referenceLinePreview",values:{numberOfReferenceLines:s}}),rotateChevron:l.state.open,icon:qe,disabled:i}),render:e=>(0,C.jsx)(at,{parent:e,collectionViewStore:o,chartConfig:n,disabled:i})})}var yt=()=>o(622317),ft=()=>o(708685),ht=()=>o(582684),vt=()=>o(75544),xt=()=>o(818367);const bt=(0,d().YK)({alphabetical:{defaultMessage:"{propertyName} A → Z",id:"charts.settings.sort.alphabetical"},reverseAlphabetical:{defaultMessage:"{propertyName} Z → A",id:"charts.settings.sort.reverseAlphabetical"},chronological:{defaultMessage:"Old → New",id:"charts.settings.sort.chronological"},reverseChronological:{defaultMessage:"New → Old",id:"charts.settings.sort.reverseChronological"},lowHigh:{defaultMessage:"{propertyName} Low → High",id:"charts.settings.sort.lowHigh"},highLow:{defaultMessage:"{propertyName} High → Low",id:"charts.settings.sort.highLow"},ascending:{defaultMessage:"{propertyName} Ascending",id:"charts.settings.sort.ascending"},descending:{defaultMessage:"{propertyName} Descending",id:"charts.settings.sort.descending"},manual:{defaultMessage:"Manual",id:"charts.settings.sort.manual"},advanced:{defaultMessage:"Advanced",id:"charts.settings.sort.advanced"}});function Ct(e,t){const o=null==e?void 0:e.type;if(!o)return t?bt.ascending:bt.descending;if(t)switch(o){case"formula":switch((0,ft().getFormulaPropertySchemaResultType)(e)){case"date":return bt.chronological;case"text":return bt.alphabetical;case"number":return bt.lowHigh;default:return bt.ascending}case"title":case"text":case"url":case"email":case"phone_number":case"relation":case"created_by":case"last_edited_by":return bt.alphabetical;case"date":case"created_time":case"last_edited_time":case"last_visited_time":return bt.chronological;case"number":return bt.lowHigh;default:return bt.ascending}switch(o){case"formula":switch((0,ft().getFormulaPropertySchemaResultType)(e)){case"date":return bt.reverseChronological;case"text":return bt.reverseAlphabetical;case"number":return bt.highLow;default:return bt.descending}case"title":case"text":case"url":case"email":case"phone_number":case"relation":case"created_by":case"last_edited_by":return bt.reverseAlphabetical;case"date":case"created_time":case"last_edited_time":case"last_visited_time":return bt.reverseChronological;case"number":return bt.highLow;default:return bt.descending}}var wt=()=>o(247788),jt=()=>o(396671),At=()=>o(147503),_t=()=>o(352377),It=()=>o(828973);function kt({chartConfig:e,chartError:t,disabled:o,sortType:l}){const s=(0,i().v3)(),c=(0,u().ET)(),p=(0,d().tz)(),g=(0,wt().x)({chartConfig:e,chartError:t,collectionContextStore:c}),{collectionViewStore:S,databaseType:y,collectionSettingsStore:f,numberOfSorts:h}=(0,r().K8)((()=>({collectionViewStore:c.collectionViewStore(),databaseType:c.databaseType,collectionSettingsStore:c.settingsStore,numberOfSorts:c.currentSortsStore.state.length})),[c]),v=(0,r().O$)(c.normalizedSchemaStore),x=(0,m().uB)(e,v),{stackedPropertySchema:b,stackedGroupBy:w}=(0,r().K8)((()=>{var t;if("results_reducer"===(null==e?void 0:e.dataConfig.type)||"donut"===(null==e?void 0:e.type))return{stackedPropertySchema:void 0,stackedGroupBy:void 0};const o=null==e||null===(t=e.dataConfig.aggregationConfig.stackOptions)||void 0===t?void 0:t.groupBy,n=null==o?void 0:o.property;return n?{stackedPropertySchema:(0,P()._g)({schema:v,property:n}),stackedGroupBy:o}:{stackedPropertySchema:void 0,stackedGroupBy:void 0}}),[e,v]),j="stacked"===l?b:x,A=(0,r().K8)((()=>!j||"formula"!==j.type||(0,I().Yp)(j)),[j]),_=(0,r().K8)((()=>{var t,o;if(null!=e&&null!==(t=e.chartFormat)&&void 0!==t&&t.mainSort&&"main"===l)return e.chartFormat.mainSort;if("groups_reducer"===(null==e||null===(o=e.dataConfig)||void 0===o?void 0:o.type)){var n;const t="stacked"===l&&w?w:null==e||null===(n=e.dataConfig)||void 0===n?void 0:n.groupBy,o=(0,T().Kq)(t);return"formula"===t.type&&"formula"===(null==x?void 0:x.type)?(0,I().Yp)(x)||(0,I().Yp)(x)?(0,k().gN)(o):I().Rb[l]:(0,k().gN)(o)}return I().Rb[l]}),[e,x,l,w]),M=(0,m().Zv)(e,v),B=(0,r().K8)((()=>{var t;if("groups_reducer"===(null==e||null===(t=e.dataConfig)||void 0===t?void 0:t.type)){const t=null==e?void 0:e.dataConfig.aggregationConfig.aggregation;return(0,m().TQ)({aggregation:t,databaseType:y,intl:p})}return null==M?void 0:M.name}),[e,y,p,M]),F=(0,m().k1)(),V=n.useCallback(((t,o)=>{if(!(S&&e&&x&&A))return;const n=R().mg(e);if("stacked"===l&&"groups_reducer"===n.dataConfig.type&&(0,a().m)(n)){var i;const e=null===(i=n.dataConfig.aggregationConfig.stackOptions)||void 0===i?void 0:i.groupBy;e&&("formula"===e.type?e.groupBy.sort=Tt(t,e.groupBy.type):e.sort=Tt(t,e.type))}if("main"===l&&(n.chartFormat={...n.chartFormat,mainSort:t},"groups_reducer"===n.dataConfig.type&&n.dataConfig.groupBy)){const e=n.dataConfig.groupBy;"formula"===e.type?e.groupBy.sort=Tt(t,e.groupBy.type):e.sort=Tt(t,e.type)}(0,m().Qn)({environment:s,collectionContextStore:c,chartConfig:n,sort:t}),L().createAndCommit({userAction:"chartSettings.setMainSort",environment:s,canUndo:!0,perform:e=>{N().zv({store:S.getFormatStore().getKeyStore("chart_config"),data:n,transaction:e})}}),(0,K().X)({environment:s,collectionContextStore:c,action:"charts_x_axis_sort",charts_analytics_context:(0,z().nL)(c)}),t!==k().S0.manual&&o&&o.close(),t===k().S0.resultsAdvanced&&(0===h?At().a2({collectionSettingsStore:f,item:{type:"createSort"}}):At().a2({collectionSettingsStore:f,item:{type:"sort"}}))}),[S,e,x,A,l,s,c,h,f]);if(!A||!j)return null;const D=[];D.push({key:k().S0.xAscending,type:"button",title:p.formatMessage(Ct(j,!0),{propertyName:j.name})}),D.push({key:k().S0.xDescending,type:"button",title:p.formatMessage(Ct(j,!1),{propertyName:j.name})});const E=[];E.push({key:k().S0.yAscending,type:"button",title:p.formatMessage(bt.lowHigh,{propertyName:B})}),E.push({key:k().S0.yDescending,type:"button",title:p.formatMessage(bt.highLow,{propertyName:B})});const O=[];"groups_reducer"===(null==e?void 0:e.dataConfig.type)&&null!=j&&j.type&&(0,m().Iq)(j)&&O.push({key:k().S0.manual,type:"button",title:p.formatMessage(bt.manual)});return!("checkbox"===(null==j?void 0:j.type)||"person"===(null==j?void 0:j.type)||"formula"===(null==j?void 0:j.type)&&("checkbox"===(0,ft().getFormulaPropertySchemaResultType)(j)||"person"===(0,ft().getFormulaPropertySchemaResultType)(j)))&&O.push(...D),"stacked"!==l&&(0,k().e0)(j)&&O.push(...E),"results_reducer"===(null==e?void 0:e.dataConfig.type)&&O.push({key:k().S0.resultsAdvanced,type:"button",title:p.formatMessage(bt.advanced)}),(0,C.jsx)(It().A,{title:(0,C.jsx)(d().sA,{...m().bg.chartSortBy}),selectedKey:_,options:O,icon:ht().arrowUpDownIcon,iconStyle:{transform:"main"===l?"rotate(-90deg)":void 0},onChange:V,disabled:o,disableParentClose:!0,rightStyle:F.sortByRightText,children:g&&e?(0,C.jsx)(Mt,{groupedChartReducer:g,sortType:l,chartConfig:e}):void 0})}function Mt({groupedChartReducer:e,sortType:t,chartConfig:o}){const n=(0,u().ET)(),i={...e,returnHiddenGroups:!0},l="stacked"===t?"chart_subgroups":"collection_groups",s=(0,r().K8)((()=>{var e;return null===(e=o.chartFormat)||void 0===e?void 0:e.mainSort}),[o]),a=(0,r().K8)((()=>{const e=n.normalizedFormatStore.state,o=(0,T().H2)(e,"chart_config",l);return"stacked"===t?(0,T().H2)(e,"chart_config","chart_subgroups"):o}),[n.normalizedFormatStore,l,t]),c=(0,r().K8)((()=>(0,xt().x)()),[]),d=(0,vt().A)({id:"chart_subgroups"===l?yt().VQ:yt().Ri,reducer:i,collectionContextStore:n,debounceWait:c}),p=(0,jt().d)("stacked"===t?{subGroupBy:a,reducerResult:d}:{groupBy:a,reducerResult:d}),g=(0,r().K8)((()=>{const e=a?(0,T().Kq)(a):void 0;return"manual"!==(null==e?void 0:e.type)||"main"===t&&("y-ascending"===s||"y-descending"===s)}),[s,a,t]);return a?(0,C.jsx)(_t().L,{collectionContextStore:n,groupBy:a,groupByKey:"chart_config",groupsFormatKey:"stacked"===t?"chart_subgroups":"collection_groups",groupsDisplayState:p,disableReorder:g}):null}function Tt(e,t){switch(e){case k().S0.manual:return{type:"manual"};case k().S0.xAscending:return{type:"ascending"};case k().S0.xDescending:return{type:"descending"};case k().S0.yAscending:case k().S0.yDescending:default:return(0,T()._o)(t)||"number"===t?{type:"ascending"}:{type:"manual"}}}var Pt=()=>o(638045),Bt=()=>o(202017);const Ft={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.69 15.25 11.18",svg:(0,C.jsx)("path",{d:"M14.424 5.248c1.181-1.18 3.201-.344 3.201 1.326V14c0 1.036-.84 1.875-1.875 1.875H4.25A1.875 1.875 0 0 1 2.375 14v-1.959c0-.497.198-.974.55-1.326l2.54-2.54a1.875 1.875 0 0 1 2.65 0l1.25 1.25c.244.243.64.243.884 0zm1.951 1.326a.625.625 0 0 0-1.067-.442l-4.175 4.176a1.875 1.875 0 0 1-2.652 0L7.232 9.059a.625.625 0 0 0-.884 0l-2.54 2.54a.63.63 0 0 0-.183.442V14c0 .345.28.625.625.625h11.5c.345 0 .625-.28.625-.625z"})},Vt=(0,B().wt)("graphArea",Ft),Dt={viewBox:"0 0 20 20",fittedViewBox:"2.51 3.18 14.97 13.63",svg:(0,C.jsx)("path",{d:"M8.455 16.066c-.367.422-.855.747-1.473.747-.838 0-1.426-.584-1.83-1.227-.414-.658-.743-1.54-1.028-2.484-.28-.925-.53-1.957-.777-2.968l-.02-.084c-.255-1.046-.505-2.066-.782-2.962a.625.625 0 1 1 1.194-.37c.29.94.55 1.998.802 3.036l.017.067c.249 1.024.493 2.028.763 2.92.277.92.568 1.67.889 2.18.329.523.59.642.772.642.136 0 .308-.063.53-.318q.344-.394.683-1.226c.45-1.109.817-2.605 1.198-4.167l.008-.035c.371-1.52.757-3.103 1.246-4.306.246-.606.537-1.163.898-1.577.367-.422.855-.747 1.473-.747.837 0 1.422.586 1.824 1.228.412.657.74 1.54 1.024 2.482.276.913.526 1.93.77 2.929l.03.123c.256 1.046.508 2.066.788 2.961a.625.625 0 1 1-1.193.373c-.294-.94-.555-1.998-.81-3.037l-.026-.109c-.247-1.01-.489-1.998-.755-2.878-.278-.92-.568-1.67-.887-2.18-.33-.526-.587-.641-.765-.641-.136 0-.309.062-.53.317q-.345.394-.683 1.226c-.45 1.109-.817 2.605-1.198 4.167l-.008.035c-.371 1.52-.757 3.103-1.246 4.306-.247.606-.537 1.163-.898 1.577"})},Et=(0,B().wt)("lineCurve",Dt);var Rt=()=>o(813197),Ot=()=>o(594952);const Kt={viewBox:"0 0 20 20",fittedViewBox:"2.55 2.37 15.08 15.06",svg:(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("path",{d:"M11 5.938a1 1 0 1 1-2 0 1 1 0 0 1 2 0m1.166 1.896A1 1 0 1 0 13.58 6.42a1 1 0 0 0-1.415 1.414M14.063 11a1 1 0 1 1 0-2 1 1 0 0 1 0 2M7.834 7.835A1 1 0 1 0 6.42 6.42a1 1 0 0 0 1.414 1.415"}),(0,C.jsx)("path",{d:"M2.988 7a7.627 7.627 0 1 1 8.853 10.4l-.042.01-.042.005c-1.061.115-2.019-.829-1.804-1.962l.262-1.38a1.188 1.188 0 0 0-1.282-1.402l-2.025.199c-2.848.28-5.044-2.462-4.148-5.18l.185-.563.015-.05.012-.04zm1.164.457-.02.062-.185.562c-.613 1.86.89 3.737 2.84 3.546l2.023-.2a2.437 2.437 0 0 1 2.633 2.881l-.261 1.38c-.05.262.16.493.408.487a6.375 6.375 0 1 0-7.438-8.718"})]})},Nt=(0,B().wt)("paintPalette",Kt);var Lt=()=>o(922189),zt=()=>o(299961),Ut=()=>o(467248);const Wt={viewBox:"0 0 20 20",fittedViewBox:"1.62 4.12 16.75 11.76",svg:(0,C.jsx)("path",{d:"M11.72 4.403a.625.625 0 1 0-1.04.694l2.804 4.205v3.223a.625.625 0 0 0 1.25 0V9.21l2.742-4.113a.625.625 0 0 0-1.04-.694L14.078 7.94zm-7.543.037a.625.625 0 1 0-1.016.729l2.504 3.496-2.504 3.496a.625.625 0 1 0 1.016.728l2.257-3.151 2.257 3.15a.625.625 0 1 0 1.016-.727L7.203 8.665l2.504-3.496a.625.625 0 1 0-1.016-.728L6.434 7.59zM2.25 14.625a.625.625 0 1 0 0 1.25h.005a.625.625 0 0 0 0-1.25zm1.933 0a.625.625 0 1 0 0 1.25h.01a.625.625 0 0 0 0-1.25zm1.937 0a.625.625 0 1 0 0 1.25h.01a.625.625 0 0 0 0-1.25zm1.938 0a.625.625 0 1 0 0 1.25h.01a.625.625 0 0 0 0-1.25zm1.937 0a.625.625 0 1 0 0 1.25h.01a.625.625 0 0 0 0-1.25zm1.938 0a.625.625 0 1 0 0 1.25h.01a.625.625 0 0 0 0-1.25zm1.937 0a.625.625 0 1 0 0 1.25h.01a.625.625 0 0 0 0-1.25zm1.938 0a.625.625 0 1 0 0 1.25h.01a.625.625 0 0 0 0-1.25zm1.937 0a.625.625 0 1 0 0 1.25h.005a.625.625 0 0 0 0-1.25z"})},Ht=(0,B().wt)("textXYunderline",Wt);var Gt=()=>o(581369),$t=()=>o(622281),Qt=()=>o(755735),Yt=()=>o(35091);const qt=1e3;function Jt({collectionViewStore:e,chartConfig:t,disabled:o}){var r;const s=(0,i().v3)(),a=(0,u().ET)(),c=(0,l().eP)(),p=(0,n.useCallback)((e=>{var t;const o=null===(t=(0,Ie().BV)(e,c))||void 0===t?void 0:t.slice(0,5);return{key:e,type:"button",title:(0,C.jsx)(d().sA,{...m().pP[e]}),caption:o?(0,C.jsx)("div",{style:{display:"flex"},children:null==o?void 0:o.map((e=>(0,C.jsx)("div",{style:{background:e,borderRadius:2,width:12,height:12,marginInlineEnd:3,marginTop:1}},e)))}):null,captionInline:!0,captionStyle:{marginInlineStart:"auto"},inlineSpacerStyle:{display:"none"}}}),[c]),g=(0,n.useMemo)((()=>[I().kq.map(p),I().VY.map(p)]),[p]),S=(null===(r=t.chartFormat)||void 0===r?void 0:r.colorTheme)||"auto",y=(0,l().IS)((()=>({icon:{width:20,height:20,marginInlineStart:2}})),[]);return(0,C.jsx)(It().A,{disabled:o,title:(0,C.jsx)(d().sA,{...m().Zr.chartColor}),selectedKey:S,sections:g,icon:Nt,iconStyle:y.icon,hideCheck:!0,onChange:o=>{if(!o)return;const n=(0,R().mg)(t);n.chartFormat||(n.chartFormat={}),n.chartFormat.colorTheme=o,(0,Ie().Pi)(o)||(n.chartFormat.weightColorValue=!1),L().createAndCommit({userAction:"chartSettings.setChartConfig",environment:s,canUndo:!0,perform:t=>{N().zv({store:e.getFormatStore().getKeyStore("chart_config"),data:n,transaction:t})}}),(0,K().X)({environment:s,collectionContextStore:a,action:"charts_style_color"})}})}function Xt(e){const t=(0,i().Y0)(),o=(0,r().uB)(void 0,ie().A);return(0,C.jsx)(Y().A,{focused:!1,popupType:t.isMobile?Q().z.SlideUp:Q().z.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",buttonPopupStore:o,renderOrigin:t=>(0,C.jsx)(le().A,{...t,showChevron:!0,title:(0,C.jsx)(d().sA,{...m().bg.chartMoreStyle}),rotateChevron:o.state.open,icon:Ot().I,disabled:e.disabled}),render:t=>(0,C.jsx)(Zt,{parent:t,collectionViewStore:e.collectionViewStore,chartConfig:e.chartConfig,disabled:e.disabled})})}function Zt(e){const{collectionViewStore:t,chartConfig:o,disabled:n}=e,{isMobile:s}=(0,i().Y0)(),c=(0,u().ET)(),d=(0,r().O$)(c.normalizedSchemaStore),g=(0,r().K8)((()=>{var e;if((0,a().m)(o))return"groups_reducer"===(null==o||null===(e=o.dataConfig)||void 0===e?void 0:e.type)?(0,P()._g)({schema:d,property:o.dataConfig.groupBy.property}):void 0}),[o,d]),m=[],S={key:"default",items:[{key:"chartHeight",render:(e,i)=>(0,C.jsx)(eo,{menuListItemProps:e,parent:i,collectionViewStore:t,chartConfig:o,disabled:n}),action:()=>{}},{key:"groupStyle",render:(e,i)=>(0,a().m)(o)&&"groups_reducer"===o.dataConfig.type&&o.dataConfig.aggregationConfig.stackOptions?(0,C.jsx)(to,{menuListItemProps:e,parent:i,collectionViewStore:t,chartConfig:o,disabled:n}):null,action:()=>{}},{key:"gridLine",render:(e,i)=>(0,a().m)(o)?(0,C.jsx)(oo,{menuListItemProps:e,parent:i,collectionViewStore:t,chartConfig:o,disabled:n}):null,action:()=>{}},{key:"axisLabel",render:(e,i)=>(0,a().m)(o)?(0,C.jsx)(io,{menuListItemProps:e,parent:i,collectionViewStore:t,chartConfig:o,disabled:n}):null,action:()=>{}},{key:"axisAvatarStyle",render:(e,i)=>(0,a().m)(o)&&g&&(0,I().fn)(g)?(0,C.jsx)(no,{menuListItemProps:e,parent:i,collectionViewStore:t,chartConfig:o,disabled:n}):null,action:()=>{}},{key:"donutValue",render:e=>"donut"!==o.type?null:(0,C.jsx)(ao,{menuListItemProps:e,collectionViewStore:t,chartConfig:o,disabled:n}),action:()=>{}},{key:"colorByValue",render:e=>{var i;const r=null===(i=o.chartFormat)||void 0===i?void 0:i.colorTheme;return"line"===o.type||!r||r&&!(0,Ie().Pi)(r)?null:(0,C.jsx)(uo,{menuListItemProps:e,collectionViewStore:t,chartConfig:o,disabled:n})},action:()=>{}},{key:"smoothLine",render:e=>"line"!==o.type?null:(0,C.jsx)(lo,{menuListItemProps:e,collectionViewStore:t,chartConfig:o,disabled:n}),action:()=>{}},{key:"areaFill",render:e=>"line"!==o.type?null:(0,C.jsx)(so,{menuListItemProps:e,collectionViewStore:t,chartConfig:o,disabled:n}),action:()=>{}},{key:"legend",render:e=>(0,C.jsx)(po,{menuListItemProps:e,collectionViewStore:t,chartConfig:o,disabled:n}),action:()=>{}},{key:"dataLabels",render:e=>(0,a().m)(o)&&(0,I().D5)(o)?(0,C.jsx)(mo,{...e,collectionViewStore:t,chartConfig:o,disabled:n}):null,action:()=>{}},{key:"donutDataLabels",render:(e,i)=>"donut"!==o.type?null:(0,C.jsx)(So,{menuListItemProps:e,parent:i,collectionViewStore:t,chartConfig:o,disabled:n}),action:()=>{}},{key:"valueLabel",render:e=>{var i;return"donut"!==o.type||null!==(i=o.chartFormat)&&void 0!==i&&i.donutHideValue?null:(0,C.jsx)(co,{menuListItemProps:e,collectionViewStore:t,chartConfig:o,disabled:n})},action:()=>{}},{key:"caption",render:e=>(0,C.jsx)(go,{...e,collectionViewStore:t,chartConfig:o,disabled:n}),action:()=>{}}],render:e=>(0,C.jsx)(p().A,{...e})};m.push(S);const y=s?{menuType:oe().gu.ActionSheet}:{menuType:oe().gu.Popup,width:280,maxHeight:400},f=(0,l().IS)((()=>({menuList:{paddingTop:8,paddingBottom:8}})),[]);return(0,C.jsx)(J().A,{...y,children:(0,C.jsx)(X().Ay,{initialFocus:void 0,type:X().Oh.Vertical,sections:m,resetFocusOnMouseOut:!0,style:f.menuList})})}function eo(e){const{chartConfig:t,collectionViewStore:o}=e,l=(0,i().v3)(),s=(0,i().Y0)(),a=(0,r().K8)((()=>{var e;const o=null==t||null===(e=t.chartFormat)||void 0===e?void 0:e.height;return o||I().bg.medium}),[t]),c=(0,n.useCallback)((e=>{const n=(0,R().mg)(t);n.chartFormat||(n.chartFormat={}),n.chartFormat.height=e,L().createAndCommit({userAction:"chartSettings.setChartConfig",environment:l,canUndo:!0,perform:e=>{N().zv({store:o.getFormatStore(),data:{chart_config:n},transaction:e})}})}),[t,o,l]),u=(0,n.useMemo)((()=>(0,v().WP)(m().WG).map((([e,t])=>{const o=a===e;return{key:e,render:e=>(0,C.jsx)($().A,{...e,title:(0,C.jsx)(d().sA,{...t}),isChecked:o}),action:()=>{c(e)}}}))),[a,c]);return(0,C.jsx)(ee().A,{...e.menuListItemProps,openOnFocus:!0,onFocus:e.parent.onFocus,renderOrigin:e=>(0,C.jsx)(le().A,{...e,showChevron:!0,title:(0,C.jsx)(d().sA,{...m().Zr.chartHeight}),icon:Pt().t,right:a?(0,C.jsx)(d().sA,{...m().WG[a]}):null}),renderExtension:(t,o)=>{const n=ro({title:(0,C.jsx)(d().sA,{...m().Zr.chartHeight}),device:s,onClickRight:o.close,popupEvents:t});return(0,C.jsx)(J().A,{...n,children:(0,C.jsx)(X().Ay,{type:X().Oh.Vertical,initialFocus:0,onAccept:e.parent.onAccept,sections:[{key:"chartHeight",render:e=>(0,C.jsx)(p().A,{...e}),items:u}]})})}})}function to(e){const{chartConfig:t,collectionViewStore:o}=e,l=(0,i().v3)(),s=(0,i().Y0)(),a=(0,r().K8)((()=>{var e;const o=null==t||null===(e=t.chartFormat)||void 0===e?void 0:e.axisGroupStyle;return o||I().PC.normal}),[t]),c=(0,n.useCallback)((e=>{const n=(0,R().mg)(t);n.chartFormat||(n.chartFormat={axisGroupStyle:I().PC.normal}),n.chartFormat.axisGroupStyle=e,L().createAndCommit({userAction:"chartSettings.setChartConfig",environment:l,canUndo:!0,perform:e=>{N().zv({store:o.getFormatStore(),data:{chart_config:n},transaction:e})}})}),[t,o,l]),u=(0,n.useMemo)((()=>(0,v().WP)(m().TP).map((([e,t])=>{const o=a===e;return{key:e,render:e=>(0,C.jsx)($().A,{...e,title:(0,C.jsx)(d().sA,{...t}),isChecked:o}),action:()=>{c(e)}}}))),[a,c]);return(0,C.jsx)(ee().A,{...e.menuListItemProps,openOnFocus:!0,onFocus:e.parent.onFocus,renderOrigin:e=>(0,C.jsx)(le().A,{...e,showChevron:!0,title:(0,C.jsx)(d().sA,{...m().Zr.chartGroupStyle}),icon:zt().v,right:a?(0,C.jsx)(d().sA,{...m().TP[a]}):null}),renderExtension:(t,o)=>{const n=ro({title:(0,C.jsx)(d().sA,{...m().Zr.chartGroupStyle}),device:s,onClickRight:o.close,popupEvents:t});return(0,C.jsx)(J().A,{...n,children:(0,C.jsx)(X().Ay,{type:X().Oh.Vertical,initialFocus:0,onAccept:e.parent.onAccept,sections:[{key:"groupStyles",render:e=>(0,C.jsx)(p().A,{...e}),items:u}]})})}})}function oo(e){const t=(0,i().v3)(),o=(0,u().ET)(),l=(0,i().Y0)(),s=(0,r().K8)((()=>{var t;const o=null===(t=e.chartConfig.chartFormat)||void 0===t?void 0:t.axisGridLine;return o||"horizontal"}),[e.chartConfig]),a=(0,n.useCallback)((n=>{const i=(0,R().mg)(e.chartConfig);i.chartFormat||(i.chartFormat={axisGridLine:I().JQ.horizontal}),i.chartFormat.axisGridLine=n,L().createAndCommit({userAction:"chartSettings.setChartConfig",environment:t,canUndo:!0,perform:t=>{N().zv({store:e.collectionViewStore.getFormatStore().getKeyStore("chart_config"),data:i,transaction:t})}}),(0,K().X)({environment:t,collectionContextStore:o,action:"charts_style_grid_line"})}),[e.chartConfig,t,e.collectionViewStore,o]),c=(0,n.useMemo)((()=>(0,v().WP)(m().G_).map((([e,t])=>{const o=s===e;return{key:e,render:e=>(0,C.jsx)($().A,{...e,title:(0,C.jsx)(d().sA,{...t}),isChecked:o}),action:()=>{a(e)}}}))),[s,a]);return(0,C.jsx)(ee().A,{...e.menuListItemProps,openOnFocus:!0,onFocus:e.parent.onFocus,renderOrigin:t=>(0,C.jsx)(le().A,{...t,showChevron:!0,title:(0,C.jsx)(d().sA,{...m().Zr.chartGridLine}),right:s?(0,C.jsx)(d().sA,{...m().G_[s]}):null,icon:qe,disabled:e.disabled}),renderExtension:(t,o)=>{const n=ro({title:(0,C.jsx)(d().sA,{...m().Zr.chartGridLine}),device:l,onClickRight:o.close,popupEvents:t});return(0,C.jsx)(J().A,{...n,children:(0,C.jsx)(X().Ay,{type:X().Oh.Vertical,initialFocus:0,onAccept:e.parent.onAccept,sections:[{key:"gridStyles",render:e=>(0,C.jsx)(p().A,{...e}),items:c}]})})}})}function no(e){const t=(0,i().v3)(),o=(0,i().Y0)(),l=(0,m().k1)(),s=(0,r().K8)((()=>{var t;return(null===(t=e.chartConfig.chartFormat)||void 0===t?void 0:t.axisAvatar)||I().GL.avatar}),[e.chartConfig]),a=(0,n.useCallback)((o=>{const n=(0,R().mg)(e.chartConfig);n.chartFormat||(n.chartFormat={axisAvatar:I().GL.avatar}),n.chartFormat.axisAvatar=o,L().createAndCommit({userAction:"chartSettings.updateAxisAvatarFormat",environment:t,canUndo:!0,perform:t=>{N().zv({store:e.collectionViewStore.getFormatStore().getKeyStore("chart_config"),data:n,transaction:t})}})}),[e.chartConfig,e.collectionViewStore,t]),c=(0,n.useMemo)((()=>(0,v().WP)(m().RO).map((([e,t])=>{const o=s===e;return{key:e,render:e=>(0,C.jsx)($().A,{...e,title:(0,C.jsx)(d().sA,{...t}),isChecked:o}),action:()=>{a(e)}}}))),[s,a]);return(0,C.jsx)(ee().A,{...e.menuListItemProps,openOnFocus:!0,onFocus:e.parent.onFocus,renderOrigin:t=>(0,C.jsx)(le().A,{...t,showChevron:!0,title:(0,C.jsx)(d().sA,{...m().Zr.chartAxisAvatarFormat}),right:s?(0,C.jsx)("span",{style:O().RC,children:(0,C.jsx)(d().sA,{...m().RO[s]})}):null,rightStyle:l.avatarStyle,icon:Lt().personCircleFillIcon,disabled:e.disabled}),renderExtension:(t,n)=>{const i=ro({title:(0,C.jsx)(d().sA,{...m().Zr.chartAxisName}),device:o,onClickRight:n.close,popupEvents:t});return(0,C.jsx)(J().A,{...i,children:(0,C.jsx)(X().Ay,{type:X().Oh.Vertical,initialFocus:0,onAccept:e.parent.onAccept,sections:[{key:"avatarStyles",render:e=>(0,C.jsx)(p().A,{...e}),items:c}]})})}})}function io(e){const t=(0,i().v3)(),o=(0,u().ET)(),l=(0,i().Y0)(),s=(0,r().K8)((()=>{var t;const o=null===(t=e.chartConfig.chartFormat)||void 0===t?void 0:t.axisLabel;return o||I().tG.none}),[e.chartConfig]),a=(0,r().K8)((()=>"bar"===e.chartConfig.type),[e.chartConfig]),c=(0,n.useMemo)((()=>a?s===I().tG.x_axis?m().Le.y_axis:s===I().tG.y_axis?m().Le.x_axis:m().Le[s]:m().Le[s]),[a,s]),g=(0,n.useCallback)((n=>{const i=(0,R().mg)(e.chartConfig);i.chartFormat||(i.chartFormat={axisLabel:I().tG.none}),i.chartFormat.axisLabel=n,L().createAndCommit({userAction:"chartSettings.updateAxisLabel",environment:t,canUndo:!0,perform:t=>{N().zv({store:e.collectionViewStore.getFormatStore().getKeyStore("chart_config"),data:i,transaction:t})}}),(0,K().X)({environment:t,collectionContextStore:o,action:"charts_style_axis_label"})}),[e.chartConfig,e.collectionViewStore,t,o]),S=(0,n.useMemo)((()=>{let e=(0,v().WP)(m().Le);if(a){const t=[];for(const[o,n]of e)o===I().tG.x_axis?t.push([I().tG.y_axis,n]):o===I().tG.y_axis?t.push([I().tG.x_axis,n]):t.push([o,n]);e=t}return e.map((([e,t])=>{const o=s===e;return{key:e,render:e=>(0,C.jsx)($().A,{...e,title:(0,C.jsx)(d().sA,{...t}),isChecked:o}),action:()=>{g(e)}}}))}),[a,s,g]);return(0,C.jsx)(ee().A,{...e.menuListItemProps,openOnFocus:!0,onFocus:e.parent.onFocus,renderOrigin:t=>(0,C.jsx)(le().A,{...t,showChevron:!0,title:(0,C.jsx)(d().sA,{...m().Zr.chartAxisName}),right:c?(0,C.jsx)(d().sA,{...c}):null,icon:Ht,disabled:e.disabled}),renderExtension:(t,o)=>{const n=ro({title:(0,C.jsx)(d().sA,{...m().Zr.chartAxisName}),device:l,onClickRight:o.close,popupEvents:t});return(0,C.jsx)(J().A,{...n,children:(0,C.jsx)(X().Ay,{type:X().Oh.Vertical,initialFocus:0,onAccept:e.parent.onAccept,sections:[{key:"gridStyles",render:e=>(0,C.jsx)(p().A,{...e}),items:S}]})})}})}function ro(e){return e.device.isMobile?{menuType:oe().gu.ActionSheet,...e.popupEvents}:{menuType:oe().gu.Popup,width:200,...e.popupEvents}}function lo(e){const t=(0,i().v3)(),o=(0,u().ET)(),r=(0,n.useMemo)((()=>{var t;return Boolean(null===(t=e.chartConfig)||void 0===t||null===(t=t.chartFormat)||void 0===t?void 0:t.smoothLine)}),[e.chartConfig]),l=(0,n.useCallback)((()=>{var n;const i=(0,R().mg)(e.chartConfig);i.chartFormat||(i.chartFormat={smoothLine:!1}),i.chartFormat.smoothLine=!(null!==(n=e.chartConfig.chartFormat)&&void 0!==n&&n.smoothLine),L().createAndCommit({userAction:"chartSettings.setChartConfig",environment:t,canUndo:!0,perform:t=>{N().zv({store:e.collectionViewStore.getFormatStore().getKeyStore("chart_config"),data:i,transaction:t})}}),(0,K().X)({environment:t,collectionContextStore:o,action:"charts_style_smooth_line"})}),[t,e.chartConfig,e.collectionViewStore,o]);return(0,C.jsx)(Yt().A,{...e.menuListItemProps,title:(0,C.jsx)(d().sA,{...m().Zr.chartSmoothLine}),showChevron:!1,switcherProps:{on:r},icon:Et,onClick:l,disabled:e.disabled})}function so(e){const t=(0,i().v3)(),o=(0,u().ET)(),r=(0,n.useMemo)((()=>{var t;return!(null!==(t=e.chartConfig)&&void 0!==t&&null!==(t=t.chartFormat)&&void 0!==t&&t.hideLineFillArea)}),[e.chartConfig]),l=(0,n.useCallback)((()=>{var n;const i=(0,R().mg)(e.chartConfig);i.chartFormat||(i.chartFormat={hideLineFillArea:!1}),i.chartFormat.hideLineFillArea=!(null!==(n=e.chartConfig.chartFormat)&&void 0!==n&&n.hideLineFillArea),L().createAndCommit({userAction:"chartSettings.setChartConfig",environment:t,canUndo:!0,perform:t=>{N().zv({store:e.collectionViewStore.getFormatStore().getKeyStore("chart_config"),data:i,transaction:t})}}),(0,K().X)({environment:t,collectionContextStore:o,action:"charts_style_area_fill"})}),[t,e.chartConfig,e.collectionViewStore,o]);return(0,C.jsx)(Yt().A,{...e.menuListItemProps,title:(0,C.jsx)(d().sA,{...m().Zr.chartLineFillArea}),showChevron:!1,switcherProps:{on:r},icon:Vt,onClick:l,disabled:e.disabled})}function ao(e){var t;const o=(0,i().v3)(),r=(0,u().ET)(),{collectionViewStore:l,chartConfig:s,disabled:a}=e,c=(0,n.useMemo)((()=>{var e;return!(null!=s&&null!==(e=s.chartFormat)&&void 0!==e&&e.donutHideValue)}),[null==s||null===(t=s.chartFormat)||void 0===t?void 0:t.donutHideValue]),p=(0,n.useCallback)((()=>{var e;const t=(0,R().mg)(s);t.chartFormat||(t.chartFormat={donutHideValue:!1}),t.chartFormat.donutHideValue=!(null!==(e=s.chartFormat)&&void 0!==e&&e.donutHideValue),L().createAndCommit({userAction:"chartSettings.setChartConfig",environment:o,canUndo:!0,perform:e=>{N().zv({store:l.getFormatStore().getKeyStore("chart_config"),data:t,transaction:e})}}),(0,K().X)({environment:o,collectionContextStore:r,action:"charts_style_donut_value"})}),[s,l,o,r]);return(0,C.jsx)(Yt().A,{...e.menuListItemProps,title:(0,C.jsx)(d().sA,{...m().Zr.chartShowDonutValue}),showChevron:!1,switcherProps:{on:c},icon:G().i,onClick:p,disabled:a})}function co(e){var t;const o=(0,i().v3)(),r=(0,d().tz)(),s=(0,u().ET)(),{collectionViewStore:a,chartConfig:c,disabled:p}=e,g=(0,n.useMemo)((()=>{var e;return null==c||null===(e=c.chartFormat)||void 0===e?void 0:e.valueLabel}),[null==c||null===(t=c.chartFormat)||void 0===t?void 0:t.valueLabel]),S=(0,n.useCallback)((e=>{const t=(0,R().mg)(c);t.chartFormat||(t.chartFormat={valueLabel:void 0}),t.chartFormat.valueLabel=e,L().createAndCommit({userAction:"chartSettings.setChartConfig",environment:o,canUndo:!0,perform:e=>{N().zv({store:a.getFormatStore().getKeyStore("chart_config"),data:t,transaction:e})}}),(0,K().X)({environment:o,collectionContextStore:s,action:"charts_style_value_label"})}),[c,a,o,s]),y=(0,l().IS)((()=>({inputContainer:{padding:"4px 0",marginInlineStart:34,marginInlineEnd:4}})),[]);return(0,C.jsx)("div",{style:y.inputContainer,children:(0,C.jsx)(Qt().B,{initialValue:g||"",placeholder:r.formatMessage(m().Zr.chartValueLabelPlaceholder),onBlur:S,onChange:S,onSubmit:S,disabled:p})})}function uo(e){const t=(0,i().v3)(),o=(0,u().ET)(),l=(0,r().K8)((()=>{var t;return(null===(t=e.chartConfig.chartFormat)||void 0===t?void 0:t.weightColorValue)??!1}),[e.chartConfig]),s=(0,n.useCallback)((()=>{var n;const i=(0,R().mg)(e.chartConfig);i.chartFormat||(i.chartFormat={weightColorValue:!1}),i.chartFormat.weightColorValue=!(null!==(n=e.chartConfig.chartFormat)&&void 0!==n&&n.weightColorValue),L().createAndCommit({userAction:"chartSettings.setChartConfig",environment:t,canUndo:!0,perform:t=>{N().zv({store:e.collectionViewStore.getFormatStore().getKeyStore("chart_config"),data:i,transaction:t})}}),(0,K().X)({environment:t,collectionContextStore:o,action:"charts_style_weight_color_value"})}),[t,e.chartConfig,e.collectionViewStore,o]);return(0,C.jsx)(Yt().A,{...e.menuListItemProps,title:(0,C.jsx)(d().sA,{...m().Zr.chartWeightColorValue}),showChevron:!1,switcherProps:{on:l},icon:Rt().L,onClick:s,disabled:e.disabled})}function po(e){const t=(0,i().v3)(),o=(0,u().ET)(),l=(0,$t().hu)(e.chartConfig),s=(0,r().K8)((()=>{var t;return!(null!==(t=e.chartConfig.chartFormat)&&void 0!==t&&t.hideLegend||l)}),[e.chartConfig,l]),a=(0,n.useCallback)((()=>{var n;const i=(0,R().mg)(e.chartConfig);i.chartFormat||(i.chartFormat={hideLegend:!1}),i.chartFormat.hideLegend=!(null!==(n=e.chartConfig.chartFormat)&&void 0!==n&&n.hideLegend),L().createAndCommit({userAction:"chartSettings.setChartConfig",environment:t,canUndo:!0,perform:t=>{N().zv({store:e.collectionViewStore.getFormatStore().getKeyStore("chart_config"),data:i,transaction:t})}}),(0,K().X)({environment:t,collectionContextStore:o,action:"charts_style_legend_toggle"})}),[t,e.chartConfig,e.collectionViewStore,o]);return l?null:(0,C.jsx)(Yt().A,{...e.menuListItemProps,title:(0,C.jsx)(d().sA,{...m().Zr.chartLegend}),showChevron:!1,switcherProps:{on:s},icon:Bt().n,onClick:a,disabled:e.disabled})}function go({collectionViewStore:e,chartConfig:t,disabled:o}){const s=(0,d().tz)(),a=(0,i().v3)(),c=(0,u().ET)(),{showCaption:p,caption:g}=(0,r().K8)((()=>{var e,o;return"placeholder"===t.type?{showCaption:!1,caption:""}:{showCaption:(null===(e=t.chartFormat)||void 0===e?void 0:e.showCaption)??!1,caption:(null===(o=t.chartFormat)||void 0===o?void 0:o.caption)??""}}),[t]),S=(0,n.useCallback)((()=>{const t=e.getChartFormatStore();t&&(L().createAndCommit({userAction:"chartSettings.setChartFormat.showCaption",environment:a,canUndo:!0,perform:e=>{N().zv({store:t,data:{showCaption:!p},transaction:e})}}),(0,K().X)({environment:a,collectionContextStore:c,action:"charts_style_show_caption"}))}),[e,a,c,p]),y=(0,n.useCallback)((t=>{const o=e.getChartFormatStore();o&&(L().createAndCommit({userAction:"chartSettings.setChartFormat.updateCaption",environment:a,canUndo:!0,perform:e=>{N().zv({store:o,data:{caption:t},transaction:e})}}),(0,K().X)({environment:a,collectionContextStore:c,action:"charts_style_update_caption"}))}),[c,e,a]),f=(0,l().IS)((()=>({captionInputContainer:{padding:"4px 0",marginInlineStart:34,marginInlineEnd:4}})),[]);return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(le().A,{title:(0,C.jsx)(d().sA,{...m().Zr.chartCaption}),showChevron:!1,right:(0,C.jsx)(Gt().A,{on:p,onClick:S,disabled:o}),icon:Ut().i,onClick:S,disabled:o}),(0,C.jsx)("div",{style:f.captionInputContainer,children:(0,C.jsx)(Qt().B,{initialValue:g,placeholder:s.formatMessage(m().Zr.chartCaptionPlaceholder),onBlur:y,onChange:y,onSubmit:y,disabled:o,textarea:!0,maxLength:qt})})]})}function mo({collectionViewStore:e,chartConfig:t,disabled:o}){const l=(0,i().v3)(),s=(0,u().ET)(),a=(0,r().K8)((()=>(0,I().q_)(t)),[t]),c=(0,n.useCallback)((()=>{const o=(0,R().mg)(t);o.chartFormat||(o.chartFormat={axisShowDataLabels:!0}),o.chartFormat.axisShowDataLabels=!a,L().createAndCommit({userAction:"chartSettings.setChartFormat.dataLabels",environment:l,canUndo:!0,perform:t=>{N().zv({store:e.getFormatStore().getKeyStore("chart_config"),data:o,transaction:t})}}),(0,K().X)({environment:l,collectionContextStore:s,action:"charts_style_data_labels"})}),[t,e,l,a,s]);return(0,C.jsx)(le().A,{title:(0,C.jsx)(d().sA,{...m().Zr.chartDataLabels}),showChevron:!1,right:(0,C.jsx)(Gt().A,{on:a,onClick:c,disabled:o}),icon:G().i,onClick:c,disabled:o})}function So(e){const t=(0,i().v3)(),o=(0,u().ET)(),l=(0,i().Y0)(),s=(0,m().k1)(),a=(0,r().K8)((()=>{var t;const o=null===(t=e.chartConfig.chartFormat)||void 0===t?void 0:t.donutDataLabels;return o||I().D0.none}),[e.chartConfig]),c=(0,n.useCallback)((n=>{const i=(0,R().mg)(e.chartConfig);i.chartFormat||(i.chartFormat={donutDataLabels:I().D0.none}),i.chartFormat.donutDataLabels=n,L().createAndCommit({userAction:"chartSettings.setChartConfig",environment:t,canUndo:!0,perform:t=>{N().zv({store:e.collectionViewStore.getFormatStore().getKeyStore("chart_config"),data:i,transaction:t})}}),(0,K().X)({environment:t,collectionContextStore:o,action:"charts_style_donut_data_labels"})}),[e.chartConfig,t,e.collectionViewStore,o]),g=(0,n.useMemo)((()=>(0,v().WP)(m().zH).map((([e,t])=>{const o=a===e;return{key:e,render:e=>(0,C.jsx)($().A,{...e,title:(0,C.jsx)(d().sA,{...t}),isChecked:o}),action:()=>{c(e)}}}))),[a,c]);return(0,C.jsx)(ee().A,{...e.menuListItemProps,openOnFocus:!0,onFocus:e.parent.onFocus,renderOrigin:t=>(0,C.jsx)(le().A,{...t,showChevron:!0,title:(0,C.jsx)(d().sA,{...m().Zr.chartDataLabels}),right:a?(0,C.jsx)("div",{style:{...s.donutDataLabelsRightText,...O().RC},children:(0,C.jsx)(d().sA,{...m().zH[a]})}):null,icon:G().i,disabled:e.disabled}),renderExtension:(t,o)=>{const n=ro({title:(0,C.jsx)(d().sA,{...m().Zr.chartDataLabels}),device:l,onClickRight:o.close,popupEvents:t});return(0,C.jsx)(J().A,{...n,children:(0,C.jsx)(X().Ay,{type:X().Oh.Vertical,initialFocus:0,onAccept:e.parent.onAccept,sections:[{key:"donutDataLabelsStyle",render:e=>(0,C.jsx)(p().A,{...e}),items:g}]})})}})}var yo=()=>o(457056),fo=()=>o(896628);function ho({chartConfig:e,chartError:t,disabled:o}){const a=(0,i().v3)(),c=(0,u().ET)(),p=(0,d().tz)(),g=(0,l().IS)((e=>({errorIcon:{...(0,m().FE)(e),width:B().Ev.default,height:B().Ev.default}})),[]),S=(0,m().k1)(),y=(0,r().K8)((()=>c.collectionViewStore()),[c]),f=(0,r().O$)(c.normalizedSchemaStore),h=(0,r().K8)((()=>null==e?void 0:e.dataConfig),[e]),b=(0,r().K8)((()=>{if("groups_reducer"===(null==h?void 0:h.type)){const e="formula"===h.groupBy.type?h.groupBy.groupBy:h.groupBy;return(0,T().sj)(e)||(0,T().Ik)(e)?{type:"property_group",property:h.groupBy.property,groupByOption:e.groupBy}:{type:"property_group",property:h.groupBy.property}}if("results_reducer"===(null==h?void 0:h.type))return{type:"property_group",property:h.nameProperty}}),[h]),w=t&&(0,s().lc)(t)?()=>(0,D().exclamationMarkTriangleFillIcon)(g.errorIcon):yo().o,j=(0,r().K8)((()=>{const e=(0,v().WP)(f),t=[];return e.forEach((([e,o])=>{o&&((0,T().iF)(o.type)?t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ae,subMenuItems:T().PC.map((t=>({key:{type:"property_group",property:e,groupByOption:t},name:p.formatMessage(he().eD[t]),sectionName:ae})))}):(0,I().zn)(o)?t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ae,subMenuItems:T().BI.map((t=>({key:{type:"property_group",property:e,groupByOption:t},name:p.formatMessage(he().WK[t]),sectionName:ae})))}):(0,T().Eg)(o)&&t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ae}))})),t}),[f,p]),A=n.useCallback((t=>{var o,n;const{key:i}=t,{property:r,groupByOption:l}=i;if(!e||!y)return;const s=(0,P()._g)({schema:f,property:r}),d=(0,_().o_)({property:r,collectionSchema:f,hideEmptyGroups:Boolean(null===(o=e.chartFormat)||void 0===o?void 0:o.axisHideEmptyGroups)});if(!s||!d)return;const u=Object.keys(f),p="results_reducer"===e.dataConfig.type?e.dataConfig.valueProperty:u.find((e=>{const t=f[e];return Boolean(t&&(0,_().Iw)(t))})),g={aggregator:"count"};let S=R().mg(e);if((0,_().tH)(s)&&p)S=(0,I().CN)({chartConfig:S,xAxisPropertyId:r,newDataConfigType:"results_reducer",valueProperty:p,groupBy:d});else if(l){var h;const e=(0,I().xS)({property:r,propertySchema:s,groupByOption:l,hideEmptyGroups:Boolean(null===(h=S.chartFormat)||void 0===h?void 0:h.axisHideEmptyGroups)});e&&(S=(0,I().CN)({chartConfig:S,xAxisPropertyId:r,newDataConfigType:"groups_reducer",groupBy:e,aggregation:g}))}else if(d){const e={aggregator:"count"};S=(0,I().CN)({chartConfig:S,xAxisPropertyId:r,newDataConfigType:"groups_reducer",groupBy:d,aggregation:e})}(0,m().Qn)({environment:a,collectionContextStore:c,chartConfig:S,sort:null===(n=S.chartFormat)||void 0===n?void 0:n.mainSort}),L().createAndCommit({userAction:"chartSettings.setXAxis",environment:a,canUndo:!0,perform:e=>{N().zv({store:y.getFormatStore().getKeyStore("chart_config"),data:S,transaction:e}),"week"===t.key.groupByOption&&fo().Jo(y,e)}}),(0,K().X)({environment:a,collectionContextStore:c,action:"charts_x_axis_what_to_show",charts_analytics_context:(0,z().nL)(c)})}),[e,y,f,a,c]);return(0,C.jsx)(x().A,{textWrap:!0,placement:"left",disableTooltip:!t||!(0,s().lc)(t),renderTooltip:e=>t?(0,C.jsx)("span",{...e,children:(0,U().y)(t)}):null,render:e=>(0,C.jsx)(Se,{...e,collectionContextStore:c,selectedProperty:b,properties:j,handlePropertySelect:A,originProps:{title:(0,C.jsx)("span",{children:(0,C.jsx)(d().sA,{...m().bg.chartWhatToShow})}),icon:w},callsite:"main_property",disabled:o,rightStyle:S.whatToShowRightText})})}function vo({collectionViewStore:e,chartConfig:t,disabled:o}){const l=(0,i().v3)(),s=(0,u().ET)(),a=(0,r().K8)((()=>{var e;return Boolean(null==t||null===(e=t.chartFormat)||void 0===e?void 0:e.axisHideEmptyGroups)}),[t]),p=n.useCallback((()=>{if(!t)return;const o=R().mg(t);o.chartFormat={...o.chartFormat,axisHideEmptyGroups:!a},"groups_reducer"===o.dataConfig.type&&(o.dataConfig.groupBy.hideEmptyGroups=!a),L().createAndCommit({userAction:"chartSettings.setChartConfig",environment:l,canUndo:!0,perform:t=>{N().zv({store:e.getFormatStore().getKeyStore("chart_config"),data:o,transaction:t})}}),(0,K().X)({environment:l,collectionContextStore:s,action:"charts_x_axis_hide_empty_groups",charts_analytics_context:(0,z().nL)(s)})}),[t,e,l,a,s]);return(0,C.jsx)(Yt().A,{title:(0,C.jsx)(d().sA,{...m().Zr.chartHideEmptyGroups}),switcherProps:{on:a},onClick:p,icon:c().e,disabled:o})}const xo={viewBox:"0 0 20 20",fittedViewBox:"3.72 2.12 12.16 14.76",directional:!0,svg:(0,C.jsx)("path",{d:"M15.25 15.625a.625.625 0 1 1 0 1.25h-5a2.125 2.125 0 0 1-2.125-2.125V4.259L4.792 7.592a.625.625 0 1 1-.884-.884l4.4-4.4a.625.625 0 0 1 .884 0l4.4 4.4a.625.625 0 1 1-.884.884L9.375 4.259V14.75c0 .483.392.875.875.875z"})},bo=(0,B().wt)("arrowTurnLeftUp",xo),Co={viewBox:"0 0 20 20",fittedViewBox:"3.12 3.12 13.75 13.75",svg:(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("path",{d:"M13.125 4.25c0-.621.504-1.125 1.125-1.125h1.5c.621 0 1.125.504 1.125 1.125v11.5c0 .621-.504 1.125-1.125 1.125h-1.5a1.125 1.125 0 0 1-1.125-1.125zm1.25.125v11.25h1.25V4.375zM3.125 10.75c0-.621.504-1.125 1.125-1.125h1.5c.621 0 1.125.504 1.125 1.125v5c0 .621-.504 1.125-1.125 1.125h-1.5a1.125 1.125 0 0 1-1.125-1.125zm1.25.125v4.75h1.25v-4.75z"}),(0,C.jsx)("path",{d:"M13.125 4.25c0-.621.504-1.125 1.125-1.125h1.5c.621 0 1.125.504 1.125 1.125v11.5c0 .621-.504 1.125-1.125 1.125h-1.5a1.125 1.125 0 0 1-1.125-1.125zm1.25.125v11.25h1.25V4.375zM9.25 6.398c-.621 0-1.125.504-1.125 1.125v8.227c0 .621.504 1.125 1.125 1.125h1.5c.621 0 1.125-.504 1.125-1.125V7.523c0-.62-.504-1.125-1.125-1.125zm.125 9.227V7.648h1.25v7.977z"})]})},wo=(0,B().wt)("chartBarXAxisCumulative",Co),jo={viewBox:"0 0 20 20",fittedViewBox:"0.25 5.12 19.38 9.76",svg:(0,C.jsx)("path",{d:"M6.625 5.125c2.327 0 4 2.211 4 4.877s-1.673 4.873-4 4.873-4-2.207-4-4.873 1.673-4.877 4-4.877m0 1.25c-1.4 0-2.75 1.389-2.75 3.627s1.349 3.623 2.75 3.623 2.75-1.386 2.75-3.623-1.35-3.627-2.75-3.627m9-1.25c2.327 0 4 2.211 4 4.877s-1.673 4.873-4 4.873-4-2.207-4-4.873 1.673-4.877 4-4.877m0 1.25c-1.4 0-2.75 1.389-2.75 3.627s1.349 3.623 2.75 3.623 2.75-1.386 2.75-3.623-1.35-3.627-2.75-3.627M1.25 12.79a1 1 0 1 1 0 2 1 1 0 0 1 0-2"})},Ao=(0,B().wt)("decimal",jo);var _o=()=>o(446966),Io=()=>o(72135),ko=()=>o(673900),Mo=()=>o(831030),To=()=>o(66486);function Po({chartConfig:e,chartError:t,disabled:o}){const a=(0,d().tz)(),c=(0,i().v3)(),p=(0,u().ET)(),g=(0,l().IS)((e=>({errorIcon:{...(0,m().FE)(e),width:18,height:18,marginInlineStart:4}})),[]),S=(0,m().k1)(),y=(0,r().K8)((()=>p.collectionViewStore()),[p]),f=(0,r().K8)((()=>p.databaseType),[p]),h=(0,r().O$)(p.normalizedSchemaStore),b=(0,r().K8)((()=>null==e?void 0:e.dataConfig),[e]),w=(0,r().K8)((()=>{if(b)return"groups_reducer"===b.type?b.groupBy.property:b.nameProperty}),[b]),j=(0,r().K8)((()=>w?(0,P()._g)({schema:h,property:w}):void 0),[w,h]),A=(0,r().K8)((()=>{if(b)if("groups_reducer"===b.type){const e=b.aggregationConfig.aggregation;if((0,M().Iq)(e))return{type:"record_count"};if(ge(e.aggregator)){const t=(0,P()._g)({schema:h,property:e.property});if(!t)return;return(0,I().JW)(t)||"unique"!==e.aggregator?{type:"aggregation",property:e.property,aggregation:e.aggregator}:{type:"property_group",property:e.property}}}else if("results_reducer"===b.type&&b.valueProperty)return{type:"aggregation",property:b.valueProperty,aggregation:"value"}}),[h,b]),k=(0,r().K8)((()=>{if(!b||!j)return[];const e=[];(0,v().WP)(h).forEach((([t,o])=>{if(!o||t===w||!(0,T().Eg)(o))return;const n=[];(0,_().Iw)(o)&&(0,_().tH)(j)&&n.push({key:{type:"aggregation",property:t,aggregation:"value"},name:a.formatMessage(m().bg.chartAggregateByValues),sectionName:ce});const i=(0,I().JW)(o);if(i){pe.forEach((e=>{const o={aggregator:e,property:t},i={key:{type:"aggregation",property:t,aggregation:e},name:(0,m().TQ)({aggregation:o,databaseType:f,intl:a})||"",sectionName:ce};n.push(i)}));const e={key:{type:"aggregation",property:t,aggregation:"unique"},name:(0,m().TQ)({aggregation:{aggregator:"unique",property:t},databaseType:f,intl:a})||"",sectionName:ce};n.push(e)}const r={key:{type:"property_group",property:t},name:o.name,sectionName:i?ce:de,subMenuItems:n};e.push(r)}));return[{key:{type:"record_count"},name:(0,m().TQ)({aggregation:{aggregator:"count"},databaseType:f,intl:a})||"",sectionName:ae},...e]}),[b,j,h,f,a,w]),B=(0,r().K8)((()=>t&&(0,s().dG)(t)?()=>(0,D().exclamationMarkTriangleFillIcon)(g.errorIcon):bo),[t,g.errorIcon]),F=n.useCallback((t=>{y&&e&&w&&fe({environment:c,menuItem:t,chartConfig:e,collectionSchema:h,collectionViewStore:y,collectionContextStore:p,mainPropertyId:w})}),[e,p,h,y,c,w]);return(0,C.jsx)(x().A,{textWrap:!0,placement:"left",disableTooltip:!t||!(0,s().dG)(t),renderTooltip:e=>t?(0,C.jsx)("span",{...e,children:(0,U().y)(t)}):null,render:e=>(0,C.jsx)(Se,{...e,collectionContextStore:p,selectedProperty:t&&!(0,s().xG)(t)?void 0:A,properties:k,handlePropertySelect:F,originProps:{title:(0,C.jsx)("span",{children:(0,C.jsx)(d().sA,{...m().bg.chartWhatToShow})}),icon:B},callsite:"aggregation_property",disabled:o,rightStyle:S.whatToShowRightText})})}function Bo({chartConfig:e,chartError:t,disabled:o}){const a=(0,d().tz)(),c=(0,i().v3)(),p=(0,u().ET)(),g=(0,l().IS)((e=>({errorIcon:{...(0,m().FE)(e),width:B().Ev.default,height:B().Ev.default}})),[]),S=(0,m().k1)(),y=(0,r().O$)(p.normalizedSchemaStore),f=(0,r().K8)((()=>p.collectionViewStore()),[p]),h=(0,r().K8)((()=>{var t,o,n,i,r;if(!e||"groups_reducer"!==(null===(t=e.dataConfig)||void 0===t?void 0:t.type))return;const l=e.dataConfig.aggregationConfig,s="formula"===(null===(o=l.stackOptions)||void 0===o?void 0:o.groupBy.type)?null===(n=l.stackOptions)||void 0===n?void 0:n.groupBy.groupBy:null===(i=l.stackOptions)||void 0===i?void 0:i.groupBy,a=null===(r=l.stackOptions)||void 0===r?void 0:r.groupBy.property;return s&&a?(0,T().sj)(s)||(0,T().Ik)(s)?{type:"property_group",property:a,groupByOption:s.groupBy}:{type:"property_group",property:a}:{type:"none"}}),[e]),b=(0,r().K8)((()=>{const e=(0,v().WP)(y),t=[],o={key:{type:"none"},name:Me().A.formatMessage(m().bg.noneMenuItem),sectionName:ae};return t.push(o),e.forEach((([e,o])=>{o&&((0,T().iF)(o.type)?t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ae,subMenuItems:T().PC.map((t=>({key:{type:"property_group",property:e,groupByOption:t},name:a.formatMessage(he().eD[t]),sectionName:ae})))}):(0,I().zn)(o)?t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ae,subMenuItems:T().BI.map((t=>({key:{type:"property_group",property:e,groupByOption:t},name:a.formatMessage(he().WK[t]),sectionName:ae})))}):(0,T().Eg)(o)&&t.push({key:{type:"property_group",property:e},name:o.name,sectionName:ae}))})),t}),[y,a]),w=(0,r().K8)((()=>t&&(0,s().ic)(t)?()=>(0,D().exclamationMarkTriangleFillIcon)(g.errorIcon):zt().v),[t,g.errorIcon]),j=n.useCallback(((t,o)=>{var n,i;const r=(0,P()._g)({schema:y,property:t});if(!f||!r||!e||"groups_reducer"!==(null===(n=e.dataConfig)||void 0===n?void 0:n.type))return;const l=(0,I().xS)({property:t,propertySchema:r,groupByOption:o,hideEmptyGroups:!0});if(!l||!(0,T().rj)(l.type))return;const s=R().mg(e);if("groups_reducer"!==s.dataConfig.type)return;const a=e.dataConfig.aggregationConfig;let d;if(s.dataConfig.aggregationConfig={...a,stackOptions:{groupBy:l}},"bar"===e.type||"column"===e.type)d=I().PC.normal;else if("line"===e.type){var u;d=null!==(u=e.chartFormat)&&void 0!==u&&u.axisCumulative?I().PC.normal:I().PC.side_by_side}const g=null===(i=e.chartFormat)||void 0===i?void 0:i.axisGroupStyle;s.chartFormat={...s.chartFormat,axisGroupStyle:g||d},L().createAndCommit({userAction:"chartSettings.setYAxisStackBy",environment:c,canUndo:!0,perform:e=>{N().zv({store:f.getFormatStore().getKeyStore("chart_config"),data:s,transaction:e}),"week"===o&&fo().Jo(f,e)}}),(0,K().X)({environment:c,collectionContextStore:p,action:"charts_y_axis_group_by",charts_analytics_context:(0,z().nL)(p)})}),[y,e,f,c,p]),A=n.useCallback((()=>{var t;if(!e||"groups_reducer"!==(null===(t=e.dataConfig)||void 0===t?void 0:t.type))return;const o=e.dataConfig.aggregationConfig;f&&L().createAndCommit({userAction:"chartSettings.clearYAxisStackBy",environment:c,canUndo:!0,perform:t=>{if(o){const n=R().mg(e);if("groups_reducer"!==n.dataConfig.type)return;n.dataConfig.aggregationConfig={...o,stackOptions:void 0},N().zv({store:f.getFormatStore().getKeyStore("chart_config"),data:n,transaction:t})}}})}),[f,e,c]),_=n.useCallback((e=>{const{key:t}=e;if("none"===t.type)A();else{const{property:e,groupByOption:o}=t;j(e,o)}}),[A,j]);return(0,C.jsx)(x().A,{textWrap:!0,placement:"left",disableTooltip:!t||!(0,s().ic)(t),renderTooltip:e=>t?(0,C.jsx)("span",{...e,children:(0,U().y)(t)}):null,render:e=>(0,C.jsx)(Se,{...e,collectionContextStore:p,selectedProperty:h,properties:b,handlePropertySelect:_,originProps:{title:(0,C.jsx)("span",{style:O().RC,children:(0,C.jsx)(d().sA,{...m().bg.chartGroupBy})}),icon:w},callsite:"y_axis_stacked_groups",disabled:o,rightStyle:S.groupByRightText})})}function Fo({chartConfig:e,disabled:t}){const o=(0,i().v3)(),l=(0,u().ET)(),s=(0,r().K8)((()=>l.collectionViewStore()),[l]),a=(0,r().K8)((()=>{var t;return Boolean(null==e||null===(t=e.chartFormat)||void 0===t?void 0:t.axisCumulative)}),[e]),c=(0,n.useCallback)((()=>{var t,n;if(!s||!e)return;const i=R().mg(e),r=!(null!==(t=i.chartFormat)&&void 0!==t&&t.axisCumulative);i.chartFormat={...i.chartFormat,axisCumulative:r};const a=Boolean("groups_reducer"===i.dataConfig.type&&(null===(n=i.dataConfig)||void 0===n||null===(n=n.aggregationConfig)||void 0===n||null===(n=n.stackOptions)||void 0===n?void 0:n.groupBy));"line"===e.type&&a&&r&&(i.chartFormat={...i.chartFormat,axisGroupStyle:I().PC.normal}),L().createAndCommit({userAction:"chartSettings.setCumulative",environment:o,canUndo:!0,perform:e=>{N().zv({store:s.getFormatStore().getKeyStore("chart_config"),data:i,transaction:e})}}),(0,K().X)({environment:o,collectionContextStore:l,action:"charts_y_axis_cumulative",charts_analytics_context:(0,z().nL)(l)})}),[e,s,o,l]);return e&&!(0,$t().CS)(e)?null:(0,C.jsx)(Yt().A,{title:(0,C.jsx)(d().sA,{...m().bg.chartCumulative}),switcherProps:{on:a},onClick:c,icon:wo,disabled:t})}function Vo(e){const{chartConfig:t,disabled:o}=e,s=null==t?void 0:t.chartFormat,a=(0,i().v3)(),c=(0,i().Y0)(),g=(0,d().tz)(),S=(0,r().uB)(void 0,ie().A),y=(0,u().ET)(),h=(0,r().K8)((()=>y.collectionViewStore()),[y]),v=void 0!==(null==s?void 0:s.yAxisMin)||void 0!==(null==s?void 0:s.yAxisMax),[x,b]=(0,n.useState)(void 0!==(null==s?void 0:s.yAxisMin)&&void 0!==(null==s?void 0:s.yAxisMax)&&s.yAxisMin>s.yAxisMax),[w,j]=(0,n.useState)(void 0!==(null==s?void 0:s.yAxisMin)&&void 0!==(null==s?void 0:s.yAxisMax)&&s.yAxisMin>s.yAxisMax),A=(0,n.useCallback)((e=>{if(!h||!t)return;var o,n;if("yAxisMin"in e&&"yAxisMax"in e){if(e.yAxisMin===(null===(o=t.chartFormat)||void 0===o?void 0:o.yAxisMin)&&e.yAxisMax===(null===(n=t.chartFormat)||void 0===n?void 0:n.yAxisMax))return}else if("yAxisMin"in e){var i;if(e.yAxisMin===(null===(i=t.chartFormat)||void 0===i?void 0:i.yAxisMin))return}else if("yAxisMax"in e){var r;if(e.yAxisMax===(null===(r=t.chartFormat)||void 0===r?void 0:r.yAxisMax))return}if("yAxisMin"in e){const t=void 0!==e.yAxisMin&&void 0!==(null==s?void 0:s.yAxisMax)&&e.yAxisMin>s.yAxisMax;if(b(t),t)return;void 0===e.yAxisMin&&b(!1)}if("yAxisMax"in e){const t=void 0!==e.yAxisMax&&void 0!==(null==s?void 0:s.yAxisMin)&&e.yAxisMax<s.yAxisMin;if(j(t),t)return;void 0===e.yAxisMax&&j(!1)}const l=h.getAxisChartFormatStore();l&&(L().createAndCommit({userAction:"chartSettings.setYAxisRange",environment:a,canUndo:!0,perform:t=>{N().zv({store:l,data:R().LG(e,(e=>void 0===e?null:e)),transaction:t})}}),(0,K().X)({environment:a,collectionContextStore:y,action:"charts_y_axis_range",charts_analytics_context:(0,z().nL)(y)}))}),[t,null==s?void 0:s.yAxisMax,null==s?void 0:s.yAxisMin,y,h,a]),_=(0,n.useCallback)((e=>A({yAxisMin:e})),[A]),I=(0,n.useCallback)((e=>A({yAxisMax:e})),[A]),k=(0,n.useCallback)((()=>A({yAxisMin:void 0,yAxisMax:void 0})),[A]),M=(0,l().IS)((e=>({container:{paddingBottom:16},icon:{transform:"bar"===(null==t?void 0:t.type)?"rotate(90deg)":void 0},title:{display:"flex",justifyContent:"space-between",width:"100%"},resetButton:{float:"inline-end",color:e.blue.text.accentPrimary,cursor:"pointer"},inputContainer:{display:"flex",paddingInlineStart:14,paddingInlineEnd:14},separator:{color:e.text.secondary,margin:"0 8px"}})),[null==t?void 0:t.type]);return(0,C.jsx)(Y().A,{focused:!1,popupType:c.isMobile?Q().z.SlideUp:Q().z.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",buttonPopupStore:S,renderOrigin:e=>(0,C.jsx)(le().A,{...e,showChevron:!0,title:(0,C.jsx)(d().sA,{...m().bg.chartYAxisRange}),rotateChevron:S.state.open,icon:Pt().t,iconStyle:M.icon,disabled:o,right:(0,C.jsx)(d().sA,{...v?m().bg.chartYAxisRangeCustom:m().bg.chartYAxisRangeAuto})}),render:()=>(0,C.jsx)(p().A,{topBorder:!1,disableMobileBorders:!0,title:(0,C.jsx)("div",{style:M.title,children:(0,C.jsx)(d().sA,{...m().bg.chartYAxisRangeMenu})}),right:v?(0,C.jsx)(f().Ay,{style:M.resetButton,onClick:k,children:(0,C.jsx)(d().sA,{...m().bg.chartYAxisRangeReset})}):void 0,style:M.container,children:(0,C.jsxs)("div",{style:M.inputContainer,children:[(0,C.jsx)(ko().v,{value:null==s?void 0:s.yAxisMin,onBlur:_,onKeyDown:_,inputProps:{placeholder:g.formatMessage(m().bg.chartYAxisRangeMinPlaceholder),errorOutline:x}}),(0,C.jsx)("span",{style:M.separator,children:"-"}),(0,C.jsx)(ko().v,{value:null==s?void 0:s.yAxisMax,onBlur:I,onKeyDown:I,inputProps:{placeholder:g.formatMessage(m().bg.chartYAxisRangeMaxPlaceholder),errorOutline:w}})]})})})}function Do(e){const{chartConfig:t,disabled:o}=e,l=null==t?void 0:t.chartFormat,s=(0,i().v3)(),a=(0,d().tz)(),c=(0,u().ET)(),p=(0,r().K8)((()=>c.collectionViewStore()),[c]),g=(0,r().O$)(c.normalizedSchemaStore),m=(0,r().K8)((()=>null==t?void 0:t.dataConfig),[t]),S=(0,r().K8)((()=>{if(m&&"results_reducer"===m.type)return m.valueProperty}),[m]),y=(0,r().K8)((()=>{if(S)return(0,P()._g)({schema:g,property:S})}),[S,g]),f=(0,r().K8)((()=>y?(0,Mo().i5)(y):void 0),[y]),h=(0,n.useMemo)((()=>{const e=Io().iv.map((e=>({key:e,type:"button",title:(0,To().D)(a,e)})));return f&&"precision_uncapped"!==f?[...e,{key:"precision_from_number_property",type:"button",title:a.formatMessage({id:"collection.chartYAxisSettings.fromNumberProperty",defaultMessage:"Use property value ({value})"},{value:Io().Qq[f]})}]:e}),[a,f]),v=(0,n.useCallback)((e=>{if(!p||!t)return;const o=p.getAxisChartFormatStore();o&&(L().createAndCommit({userAction:"chartSettings.setYAxisPrecision",environment:s,canUndo:!0,perform:t=>{N().zv({store:o,data:{numberPrecisionOverride:e},transaction:t})}}),(0,K().X)({environment:s,collectionContextStore:c,action:"charts_y_axis_precision",charts_analytics_context:(0,z().nL)(c)}))}),[t,c,p,s]);return(0,C.jsx)(x().A,{placement:"right",textWrap:!0,renderTooltip:()=>(0,C.jsx)(d().sA,{defaultMessage:"Rounding defaults to 2 decimal places. Use this setting to override.",id:"database.chartSettings.numberOptions.numberPrecision.tooltip"}),render:e=>(0,C.jsx)(It().A,{...e,icon:Ao,title:(0,C.jsx)(d().sA,{defaultMessage:"Decimal places",id:"database.chartSettings.numberOptions.numberPrecision"}),selectedKey:(null==l?void 0:l.numberPrecisionOverride)??Io().pS,options:h,onChange:v,disabled:o})})}function Eo({disabled:e}){const t=(0,i().v3)(),o=(0,u().ET)(),l=(0,r().K8)((()=>o.collectionStore()),[o]),s=(0,r().K8)((()=>{var e;return Boolean(null==l||null===(e=l.getFormat())||void 0===e?void 0:e.subitem_property)}),[l]),a=(0,r().K8)((()=>o.collectionViewStore()),[o]),c=(0,r().K8)((()=>null==a?void 0:a.getFormat()),[a]),p=(0,r().K8)((()=>"flattened"===(null==c?void 0:c.subitem_display_mode)),[c]),g=(0,n.useCallback)((()=>{const e=null==a?void 0:a.getFormatStore();if(!e)return;const n="flattened"===(null==c?void 0:c.subitem_display_mode)?void 0:"flattened";L().createAndCommit({userAction:"chartSettings.setCountSubitems",environment:t,canUndo:!0,perform:t=>{N().KY({store:e.getKeyStore("subitem_display_mode"),transaction:t,value:n})}}),(0,K().X)({environment:t,collectionContextStore:o,action:"charts_set_subitems",charts_analytics_context:(0,z().nL)(o)})}),[a,t,o,c]);return s?(0,C.jsx)(Yt().A,{title:(0,C.jsx)(d().sA,{...m().bg.chartIncludeSubitems}),switcherProps:{on:p},onClick:g,icon:_o().E,iconStyle:{height:18},disabled:e}):null}var Ro=()=>o(34423);const Oo=n.memo((function({collectionSettingsStore:e}){const t=(0,i().v3)(),l=(0,d().tz)(),S=(0,u().ET)(),y=(0,r().O$)(S.normalizedSchemaStore),f=(0,r().K8)((()=>S.collectionViewStore()),[S]),h=(0,r().K8)((()=>S.normalizedFormatStore.state.chart_config),[S.normalizedFormatStore]),{canViewChart:v}=(0,o(714185).f)({collectionContextStore:S}),x=!v,b=(0,r().K8)((()=>{const e=(0,s().ye)({chartConfig:h,collectionSchema:y});if(void 0!==e)return e;return f?S.chartErrorStore.getState().get(f.id):void 0}),[h,S.chartErrorStore,y,f]),w=(0,r().O$)(S.isInHomeWidgetStore),A=(0,r().K8)((()=>{var e;const t=null===(e=S.collectionViewBlockStore())||void 0===e?void 0:e.id;return!!t&&(0,o(635462).s)(t)}),[S]),_=(0,n.useMemo)((()=>A?{feature:"tasks",from:"tasks_more_menu"}:{feature:"custom_db",from:"custom_db_more_menu"}),[A]),I=!(0,r().O$)(S.canConfigureBlockStore)||x,k=Wo(I),M=(0,r().K8)((()=>S.isPeopleCollection()),[S]),T=!M;return f&&y&&h&&"placeholder"!==h.type?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(p().A,{extraPadding:!0,style:{paddingTop:0,paddingBottom:4},children:(0,C.jsx)(o(212441).Ct,{collectionContextStore:S,collectionSettingsStore:e})}),(0,C.jsx)(p().A,{extraPadding:!0,topBorder:!0,style:{paddingBottom:4},title:l.formatMessage(m().bg.chartType),mobileStyle:{boxShadow:"none"},desktopTitleStyle:k.disabled,mobileTitleStyle:k.disabled,children:(0,C.jsx)(j,{chartConfig:h,disabled:I})}),"donut"===h.type?(0,C.jsx)(No,{chartConfig:h,chartError:b,disabled:I}):null,(0,a().m)(h)?"bar"===h.type?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(zo,{collectionViewStore:f,chartConfig:h,chartError:b,disabled:I,useXAxisLabel:!0}),(0,C.jsx)(Lo,{collectionViewStore:f,chartConfig:h,chartError:b,disabled:I,useYAxisLabel:!0})]}):(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(Lo,{collectionViewStore:f,chartConfig:h,chartError:b,disabled:I}),(0,C.jsx)(zo,{collectionViewStore:f,chartConfig:h,chartError:b,disabled:I})]}):null,(0,C.jsx)(Uo,{collectionContextStore:S,chartConfig:h,paywallDisabled:Boolean(x)}),T?(0,C.jsx)(Ko,{collectionContextStore:S,collectionSettingsStore:e,paywallDisabled:Boolean(x)}):void 0,(0,C.jsxs)(p().A,{extraPadding:!0,topBorder:!0,children:[(0,C.jsx)(We,{chartConfig:h,disabled:I}),(0,C.jsx)(o(48382).z,{collectionContextStore:S,collectionSettingsStore:e}),w?(0,C.jsx)(le().A,{icon:c().e,title:l.formatMessage(o(885749).u.hide),showChevron:!1,onClick:()=>{g().default.state.sidebarSpaceViewStore&&o(980151).WO({environment:t,currentSpaceViewStore:g().default.state.sidebarSpaceViewStore,..._})}}):void 0]}),M?(0,C.jsx)(o(83486).Y,{collectionContextStore:S,collectionSettingsStore:e}):void 0,(0,C.jsx)(p().A,{extraPadding:!0,topBorder:!0,children:(0,C.jsx)(o(95441).A,{href:(0,o(232930).x)("guides.charts"),title:(0,C.jsx)(d().sA,{...m().bg.chartHelp}),analyticsFrom:"view_settings_charts_help"})})]}):null}));function Ko(e){const{collectionContextStore:t,collectionSettingsStore:n,paywallDisabled:i}=e;return(0,C.jsxs)(p().A,{extraPadding:!0,topBorder:!0,children:[(0,C.jsx)(o(542984).Q,{collectionContextStore:t,collectionSettingsStore:n,disabled:i}),(0,C.jsx)(o(704640).A,{collectionContextStore:t,collectionSettingsStore:n,disabled:i})]})}function No(e){const t=Wo(e.disabled);return(0,C.jsxs)(p().A,{extraPadding:!0,style:{paddingTop:4,paddingBottom:4},title:(0,C.jsx)(d().sA,{...m().bg.chartData}),desktopTitleStyle:t.disabled,mobileTitleStyle:t.disabled,children:[(0,C.jsx)(ve,{...e}),(0,C.jsx)(xe,{...e}),(0,C.jsx)(kt,{...e,sortType:"main"}),(0,C.jsx)(Eo,{disabled:e.disabled})]})}function Lo(e){const{collectionViewStore:t,useYAxisLabel:o,...n}=e,i=Wo(e.disabled),l=(0,r().K8)((()=>{if("groups_reducer"===e.chartConfig.dataConfig.type)return e.chartConfig.dataConfig.groupBy}),[e.chartConfig.dataConfig]);return(0,C.jsxs)(p().A,{extraPadding:!0,title:o?(0,C.jsx)(d().sA,{...m().bg.chartYAxis}):(0,C.jsx)(d().sA,{...m().bg.chartXAxis}),style:{paddingTop:4,paddingBottom:4},desktopTitleStyle:i.disabled,mobileTitleStyle:i.disabled,children:[(0,C.jsx)(ho,{...n}),l?(0,C.jsx)(Ro().T,{groupBy:l}):null,(0,C.jsx)(kt,{...n,sortType:"main"}),(0,C.jsx)(vo,{...e})]})}function zo(e){var t,n;const{useXAxisLabel:i,disabled:l,collectionViewStore:s}=e,a=Wo(l),c=(0,o(59226).X)("chart_view_reference_line"),u=(0,r().K8)((()=>{var t;if("results_reducer"===e.chartConfig.dataConfig.type)return;return null===(t=e.chartConfig.dataConfig.aggregationConfig.stackOptions)||void 0===t?void 0:t.groupBy}),[e.chartConfig.dataConfig]),g=(0,r().K8)((()=>{var t;const o=null===(t=e.chartConfig)||void 0===t?void 0:t.dataConfig;return"results_reducer"===(null==o?void 0:o.type)||"groups_reducer"===(null==o?void 0:o.type)&&("max"===o.aggregationConfig.aggregation.aggregator||"min"===o.aggregationConfig.aggregation.aggregator||"median"===o.aggregationConfig.aggregation.aggregator||"average"===o.aggregationConfig.aggregation.aggregator||"sum"===o.aggregationConfig.aggregation.aggregator)}),[null===(t=e.chartConfig)||void 0===t?void 0:t.dataConfig]);return(0,C.jsxs)(p().A,{extraPadding:!0,title:i?(0,C.jsx)(d().sA,{...m().bg.chartXAxis}):(0,C.jsx)(d().sA,{...m().bg.chartYAxis}),style:{paddingTop:4,paddingBottom:4},desktopTitleStyle:a.disabled,mobileTitleStyle:a.disabled,children:[(0,C.jsx)(Po,{...e}),g?(0,C.jsx)(Do,{...e}):void 0,"groups_reducer"!==(null===(n=e.chartConfig)||void 0===n||null===(n=n.dataConfig)||void 0===n?void 0:n.type)?null:(0,C.jsx)(Bo,{...e}),u?(0,C.jsx)(Ro().T,{groupBy:u}):null,u?(0,C.jsx)(kt,{...e,sortType:"stacked"}):null,(0,C.jsx)(Fo,{...e}),(0,C.jsx)(Vo,{...e}),(0,C.jsx)(Eo,{disabled:e.disabled}),c&&s?(0,C.jsx)(St,{collectionViewStore:s,chartConfig:e.chartConfig,disabled:e.disabled}):null]})}function Uo({collectionContextStore:e,chartConfig:t,paywallDisabled:o}){const n=(0,r().K8)((()=>e.collectionViewStore()),[e]),i=(0,r().O$)(e.canConfigureBlockStore),l=!t||!i||o,s=Wo(l);return n&&t&&"placeholder"!==t.type?(0,C.jsxs)(p().A,{extraPadding:!0,style:{paddingTop:4},title:(0,C.jsx)(d().sA,{...m().bg.chartStyle}),desktopTitleStyle:s.disabled,mobileTitleStyle:s.disabled,children:[(0,C.jsx)(Jt,{collectionViewStore:n,chartConfig:t,disabled:l}),(0,C.jsx)(Xt,{collectionViewStore:n,chartConfig:t,disabled:l})]}):null}function Wo(e){return(0,l().IS)((()=>({disabled:{opacity:e?.4:void 0}})),[e])}},727577:(e,t,o)=>{o.d(t,{T:()=>r});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"3.8 2.12 12.39 16.07",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10 5.702a2.775 2.775 0 1 0 0 5.55 2.775 2.775 0 0 0 0-5.55M8.475 8.477a1.525 1.525 0 1 1 3.05 0 1.525 1.525 0 0 1-3.05 0"}),(0,n.jsx)("path",{d:"M10 2.125a6.19 6.19 0 0 0-6.19 6.19v.129c0 1.403.467 2.767 1.327 3.876l4.37 5.626a.625.625 0 0 0 .986 0l4.37-5.626a6.32 6.32 0 0 0 1.328-3.876v-.128A6.19 6.19 0 0 0 10 2.125m-4.94 6.19a4.94 4.94 0 1 1 9.88 0v.129c0 1.126-.374 2.22-1.065 3.109L10 16.543l-3.875-4.99a5.07 5.07 0 0 1-1.066-3.109z"})]})},r=(0,o(340498).wt)("mapPin",i)},728567:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>i,squareOnSquarePlusSmallIcon:()=>r});o(296540);var n=o(474848);const i={viewBox:"0 0 16 16",fittedViewBox:"1.37 1.37 13.25 13.25",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M9.75 7.125a.625.625 0 0 0-.625.625v1.375H7.75a.625.625 0 1 0 0 1.25h1.375v1.375a.625.625 0 1 0 1.25 0v-1.375h1.375a.625.625 0 1 0 0-1.25h-1.375V7.75a.625.625 0 0 0-.625-.625"}),(0,n.jsx)("path",{d:"M3.25 1.375c-1.036 0-1.875.84-1.875 1.875v6c0 1.036.84 1.875 1.875 1.875h1.625v1.625c0 1.036.84 1.875 1.875 1.875h6c1.036 0 1.875-.84 1.875-1.875v-6c0-1.036-.84-1.875-1.875-1.875h-1.625V3.25c0-1.036-.84-1.875-1.875-1.875zM2.625 3.25c0-.345.28-.625.625-.625h6c.345 0 .625.28.625.625v1.625H6.75c-1.036 0-1.875.84-1.875 1.875v3.125H3.25a.625.625 0 0 1-.625-.625zm3.5 3.5c0-.345.28-.625.625-.625h6c.345 0 .625.28.625.625v6c0 .345-.28.625-.625.625h-6a.625.625 0 0 1-.625-.625z"})]})},r=(0,o(340498).wt)("squareOnSquarePlusSmall",i)},739222:(e,t,o)=>{o.d(t,{$M:()=>F,RH:()=>O,Y7:()=>P,YQ:()=>B,YX:()=>T,cM:()=>K,ph:()=>G,sM:()=>$,tQ:()=>E,yF:()=>Q});o(898992),o(354520),o(672577),o(581454),o(296540);var n=()=>o(314529),i=()=>o(56366),r=()=>o(401497),l=()=>o(66689),s=()=>o(148307),a=()=>o(898244),c=()=>o(617871),d=()=>o(69708),u=()=>o(534177),p=()=>o(36629),g=()=>o(901389),m=()=>o(231297),S=()=>o(962910),y=()=>o(374562),f=()=>o(476492),h=()=>o(23815),v=()=>o(972435),x=()=>o(685889),b=()=>o(252833),C=()=>o(37433),w=()=>o(765957),j=()=>o(53137),A=()=>o(346705),_=()=>o(455338),I=()=>o(234675),k=o(474848);const M=(0,d().YK)({taskName:{id:"feature.turnIntoTasks.name",defaultMessage:"Tasks"},taskDescription:{id:"feature.turnIntoTasks.description",defaultMessage:"See your tasks in Home, manage tasks in sprints, and more"}}),T={uri:"notion://feature/turn_into_tasks_feature",name:v().A.formatMessage(M.taskName),description:v().A.formatMessage(M.taskDescription),tooltipImage:{img:s().A.images.tooltips.collectionSettings.turnIntoTasksPng,scale:.5},icon:"",collectionUri:I().R,isFeatureAdded:B};function P(e,t){const o=(0,C().$H)(),n=e.collectionStore(),i=null==n?void 0:n.getDatabaseType(),r=void 0===t||i===l().dC,s=i===l().pW,a=null==n?void 0:n.isExternalSyncedCollection();return o&&r&&!s&&!a}function B(e,t){var o;if(e.uri!==T.uri)return!1;return(null===(o=t.collectionStore())||void 0===o?void 0:o.getDatabaseType())===l().dC}function F(e){const{collectionContextStore:t,environment:o}=e;A().A.setState({isModalOpen:!0,databaseType:l().dC,collectionContextStore:t});const i=(0,f().sl)(t)||{};(0,n().DO_NOT_USE_trackLegacy)(o,"convert_db_start",{...i,database_type:l().dC})}function V(){const e=(0,r().IS)((e=>({confirmationModalDescription:{fontSize:12,display:"flex",textAlign:"center"}})),[]);return(0,k.jsx)("span",{style:e.confirmationModalDescription,children:(0,k.jsx)(d().sA,{id:"CollectionTaskTypeBadge.MoreMenu.RemoveFromHome.description",defaultMessage:"Tasks from this database will no longer appear in Home or work with Sprints."})})}function D(){const e=(0,r().IS)((e=>({confirmationModalTitle:{fontWeight:500},wrapper:{textAlign:"center"}})),[]);return(0,k.jsx)("div",{style:e.wrapper,children:(0,k.jsx)("span",{style:e.confirmationModalTitle,children:(0,k.jsx)(d().sA,{id:"CollectionTaskTypeBadge.UntypeDatabase.modal.title",defaultMessage:"Undo Task Database?"})})})}function E(e){const{environment:t,collectionContextStore:o}=e,n=[{label:(0,k.jsx)(d().sA,{id:"CollectionTaskTypeBadge.UntypeDatabase.modal.confirm",defaultMessage:"Remove"}),color:"red",onAccept:()=>{m().createAndCommit({environment:t,userAction:"CollectionTaskTypeBadge.untypeDatabase",canUndo:!0,perform:e=>{S().Fr({environment:t,collectionContextStore:o,transaction:e})}})}}];return()=>{g().ui({message:(0,k.jsx)(D,{}),description:(0,k.jsx)(V,{}),showCancel:!0,keepFocus:!0,items:n})}}const R=(0,d().YK)({featureName:{id:"feature.sprints.name",defaultMessage:"Sprints"},featureDescription:{id:"feature.sprints.description",defaultMessage:"Plan tasks in cycles with sprints"}}),O={uri:"notion://feature/sprints_feature",name:v().A.formatMessage(R.featureName),description:v().A.formatMessage(R.featureDescription),tooltipImage:{img:s().A.images.tooltips.properties.sprintsPng,scale:.5},icon:"/icons/run_gray.svg",collectionUri:I().R,isFeatureAdded:function(e,t){var o;if(e.uri!==O.uri)return!1;const n=null===(o=t.sprintSettingsContextStore.state)||void 0===o?void 0:o.permissionsContext;if(!n)return!1;return n.canEdit&&n.sprintsEnabled}};function K(e){if(!e.sprintSettingsContextStore.state)return!1;const t=e.databaseType;if(t===l().av){const t=e.collectionStore();return Boolean(t&&(0,h().$6)(t))}return t===l().dC&&function(e){const t=e.collectionStore();if(!t)return!1;const o=t.getMappedProperty(l().yx.TaskToSprintRelation),n=t.getSchema()[o];if(!n)return!0;const i=(0,x().pg)(e,n);return Boolean(i&&(0,h().$6)(i))}(e)}const N=(0,d().YK)({githubFeatureDescription:{id:"customizeMenu.github.featureDescription",defaultMessage:"Link PRs and set up automated task status updates based on PR changes"},googleDriveFeatureDescription:{id:"customizeMenu.googleDrive.featureDescription",defaultMessage:"Link Google Drive files"},figmaFeatureDescription:{id:"customizeMenu.figma.featureDescription",defaultMessage:"Link Figma pages"},zendeskFeatureDescription:{id:"customizeMenu.zendesk.featureDescription",defaultMessage:"Link Zendesk tickets"}}),L=[c().Hd,c().ob,c().e1,c().k0],z="notion://feature/connection_",U={[c().ob]:`${z}property_${c().ob}`,[c().Hd]:`${z}property_${c().Hd}`,[c().e1]:`${z}property_${c().e1}`,[c().k0]:`${z}property_${c().k0}`},W={[c().ob]:N.githubFeatureDescription,[c().Hd]:N.googleDriveFeatureDescription,[c().e1]:N.figmaFeatureDescription,[c().k0]:N.zendeskFeatureDescription},H={[c().ob]:s().A.images.tooltips.properties.githubSyncPullStatusPng,[c().Hd]:s().A.images.tooltips.properties.googleDrivePng,[c().e1]:s().A.images.tooltips.properties.figmaPng,[c().k0]:s().A.images.tooltips.properties.zendeskPng};function G(){const e=(0,i().K8)((()=>{var e;return null===(e=w().default.state.sidebarSpaceStore)||void 0===e?void 0:e.canEdit()}),[]),t=(0,i().K8)((()=>j().A.integrations.state),[]);return(0,i().K8)((()=>e?L.map((e=>{const o=t.find((t=>t.id===e));if(!o)return;const n=o.id===c().ob?(0,y().Jb)().name:o.name;return{uri:`${z}${e}`,name:n,description:v().A.formatMessage(W[e]),icon:o.info.icon,tooltipImage:{img:H[e],scale:.5},collectionUri:I().R,integrationId:e,isFeatureAdded:(e,t)=>Boolean(Q(t,e.integrationId))}})).filter(u().O9):[]),[e,t])}async function $(e){var t;const{environment:o,collectionContextStore:n,feature:i,intl:r}=e,l=j().A.integrations.state.find((e=>e.id===i.integrationId)),s=null==l||null===(t=l.info.original_url_patterns)||void 0===t?void 0:t.find((e=>{var t;return null===(t=e.additional_types)||void 0===t?void 0:t.connectedRelation}));if(!l||!s||!i.integrationId)return;const a={name:l.id===c().ob?(0,y().Jb)().name:(0,b().Fe)({pattern:s,integration:l}),pattern:s,integration:l};await p().XO({environment:o,collectionContextStore:n,connectedRelationProperty:a,intl:r,from:"customize_menu",untypedFeatureArgs:{propertyId:U[i.integrationId]},propertyGroupId:void 0}),(0,_().t)({featureName:i.name})}function Q(e,t){var o;const n=null===(o=e.collectionStore())||void 0===o?void 0:o.getSchema();if(n&&t)for(const[i,r]of Object.entries(n))if(r&&(0,a().UU)(r)&&r.connectedRelation.integration_id===t)return i}},743472:(e,t,o)=>{o.d(t,{B:()=>n});function n(e){return"chart"!==e&&"form_editor"!==e&&"feed"!==e&&"map"!==e&&"chat"!==e}},748696:(e,t,o)=>{o.d(t,{w:()=>r});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.25 15.25",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M7.99 2.644a.624.624 0 0 1 .327 1.205 6.375 6.375 0 1 0 7.807 7.928.626.626 0 0 1 1.201.347 7.625 7.625 0 1 1-9.336-9.48"}),(0,n.jsx)("path",{d:"M7.857 6.475a.625.625 0 0 1 .65 1.068 2.875 2.875 0 1 0 3.905 4.022l.08-.1a.625.625 0 0 1 .969.78l-.144.207a4.125 4.125 0 1 1-5.46-5.977M10 2.375A7.625 7.625 0 0 1 17.625 10c0 .345-.28.625-.625.625h-3.5a.625.625 0 0 1-.625-.625A2.875 2.875 0 0 0 10 7.125a.625.625 0 0 1-.625-.625V3l.013-.126A.625.625 0 0 1 10 2.375m.625 3.547a4.13 4.13 0 0 1 3.452 3.453h2.267a6.376 6.376 0 0 0-5.719-5.72z"})]})},r=(0,o(340498).wt)("donutChart",i)},756114:(e,t,o)=>{o.d(t,{D:()=>n});function n(e,t){t.route.name;return!1}},762631:(e,t,o)=>{o.d(t,{U:()=>i});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"3.25 2.03 10.46 11.93",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M3.25 13.165a.8.8 0 0 0 1.203.69l8.854-5.164a.8.8 0 0 0 0-1.382L4.453 2.144a.8.8 0 0 0-1.203.691z"})},i=(0,o(340498).wt)("arrowCaretRightFillSmall",n)},768627:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().Store{getInitialState(){return{searchQuery:"",searchLimit:n.limitIncrement,searchPopupOpen:!1,addingPage:!1}}}n.limitIncrement=20,n.resultsCacheTTL=2*o(720665).Xb,n.incrementScrollOffset=200;const i=n},793863:(e,t,o)=>{o.d(t,{H:()=>P,Mq:()=>F,oA:()=>B});o(581454);var n=o(296540),i=()=>o(484714),r=()=>o(56366),l=()=>o(401497),s=()=>o(493552),a=()=>o(536095),c=()=>o(177148),d=()=>o(421559),u=()=>o(340498),p=()=>o(826693),g=()=>o(201980),m=()=>o(69708),S=()=>o(778078),y=()=>o(496603),f=()=>o(939740),h=()=>o(89924),v=()=>o(310526),x=()=>o(765957),b=()=>o(902842),C=()=>o(913454),w=()=>o(317053),j=()=>o(458097),A=()=>o(699143),_=()=>o(115512),I=o(474848);const k=n.forwardRef(((e,t)=>{const{icon:n,label:r,description:a,...c}=e,{isPhone:d}=(0,i().Y0)(),u=(0,l().IS)((e=>({button:{width:"100%",borderRadius:12,margin:0,...(0,_().nl)({width:1,color:e.border.strong})},hovered:d?{}:{background:e.background.elevated,...(0,_().nl)({width:2,color:e.blue.border.strong})},pressed:{background:e.background.elevated,...(0,_().nl)({width:2,color:e.blue.border.accentPrimary})},templateIcon:{marginTop:a?2:0},enterIcon:{justifySelf:"end"}})),[a,d]);return(0,I.jsx)(o(760217).A,{...c,buttonStyle:u.button,hoveredStyle:u.hovered,pressedStyle:u.pressed,itemMarginLeft:0,itemMarginRight:8,ref:t,title:(0,I.jsxs)(A().Y1,{direction:"horizontal",align:a?"top-left":"center-left",gap:12,padding:"12px 14px",children:[(0,I.jsx)("div",{style:u.templateIcon,children:n}),(0,I.jsxs)(A().Y1,{gap:4,children:[(0,I.jsx)(s().D,{styleKey:"Body/Medium",children:r}),a?(0,I.jsx)(s().D,{styleKey:"Body/Regular",colorVariant:"secondary",children:a}):void 0]}),c.focused?(0,I.jsx)("span",{style:u.enterIcon,children:(0,I.jsx)(o(252291).I,{icon:o(412975).arrowTurnDownLeftIcon,colorVariant:"tertiary"})}):void 0]})})}));k.displayName="SearchResultButton";var M=()=>o(992032);function T(e){const{template:t,label:o,description:n}=e;return(0,I.jsx)(k,{icon:(0,I.jsx)(b().z,{template:t,size:18}),label:o??t.value.targetCollection.name,description:n??t.description,...e})}function P({query:e,onSelectTemplate:t,onAddEmptyPage:o,onAddEmptyDatabase:S,onMarketplaceClick:b,showEmptyPageButton:A}){const _=(0,r().K8)((()=>(0,C().getIsSetupGeneratorEnabled)()),[]),{isPhone:P}=(0,i().Y0)(),V=(0,l().IS)((e=>({optionIcon:{height:u().Ev.default,width:"auto",color:e.icon.secondary},section:{gap:8,paddingTop:0,paddingInlineEnd:0,paddingBottom:8,paddingInlineStart:0},sectionTitle:{paddingTop:16,paddingInlineEnd:0,paddingBottom:0,paddingInlineStart:0,marginTop:0,marginBottom:4}})),[]),D=function(e){const t=(0,r().K8)((()=>B()),[]);return(0,n.useMemo)((()=>F(e,t)),[e,t])}(e),E=(0,r().K8)((()=>C().globalWorkflowTemplates.fromIdOfType({templateId:a().MH,type:"collection"})),[]),R=D.map((e=>({key:e.templateId,render:({ref:t,...o})=>(0,I.jsx)(T,{template:e,...o}),action:()=>t(e,{type:"suggested_template",allOrderedTemplateIds:D.map((e=>e.templateId))})}))),O=(0,n.useMemo)((()=>_?{key:a().MH,render:({ref:t,...o})=>(0,I.jsx)(T,{template:E,label:(0,I.jsx)(m().sA,{id:"workflowTemplatesOnboardingModal.searchResults.buildWithAiLabel",defaultMessage:"Build “{searchQuery}” with AI",values:{searchQuery:e}}),description:(0,I.jsx)(m().sA,{id:"workflowTemplatesOnboardingModal.searchResults.buildWithAiDescription",defaultMessage:"Use AI to generate a tailored setup"}),...o}),action:async()=>{t(E,{type:"ai_generated_template"});const o=j().default.state;if(!o.open||!o.setupGenerator)return;o.setupGenerator.store.setState({...o.setupGenerator.store.state,prompt:(0,g().x9d)(e)}),(0,w().moveToNextOnboardingStep)(P);await o.setupGenerator.submitPrompt({from:"initial-input"})&&(0,w().moveToNextOnboardingStep)(P)}}:void 0),[_,E,e,t,P]),K=(0,r().K8)((()=>{const e=x().default.state.sidebarSpaceViewStore;return(0,v().U)(e)}),[]),N=(0,n.useMemo)((()=>(0,y().oE)([A?{key:"new-page",render:t=>(0,I.jsx)(k,{icon:(0,c().Y)(V.optionIcon),label:(0,I.jsx)(m().sA,{id:"workflowTemplatesOnboardingModal.searchResults.newPage",defaultMessage:"New “{searchQuery}” page",values:{searchQuery:e}}),...t}),action:()=>o({title:e})}:void 0,{key:"new-database",render:t=>(0,I.jsx)(k,{icon:(0,d().T)(V.optionIcon),label:(0,I.jsx)(m().sA,{id:"workflowTemplatesOnboardingModal.searchResults.newDatabase",defaultMessage:"New “{searchQuery}” database",values:{searchQuery:e}}),...t}),action:()=>S({title:e})},{key:"marketplace",render:e=>K?null:(0,I.jsx)(k,{icon:(0,p().notionTemplateIcon)(V.optionIcon),label:M().Ac,...e}),action:e=>b(e.event)}])),[A,V.optionIcon,e,o,S,b,K]),L=(0,n.useMemo)((()=>[{key:"collection-templates",items:(0,y().oE)([...R,O]),render:e=>(0,I.jsx)(h().A,{title:(0,I.jsx)(s().D,{styleKey:"Body/Medium",colorVariant:"secondary",children:(0,I.jsx)(m().sA,{id:"workflowTemplatesOnboardingModal.searchResults.topResults",defaultMessage:"Top results"})}),style:V.section,desktopTitleStyle:V.sectionTitle,mobileTitleStyle:V.sectionTitle,...e})},{key:"more-options",items:N,render:e=>(0,I.jsx)(h().A,{title:(0,I.jsx)(s().D,{styleKey:"Body/Medium",colorVariant:"secondary",children:(0,I.jsx)(m().sA,{id:"workflowTemplatesOnboardingModal.searchResults.moreOptions",defaultMessage:"More options"})}),style:V.section,desktopTitleStyle:V.sectionTitle,mobileTitleStyle:V.sectionTitle,...e})}]),[R,O,N,V]);return(0,I.jsx)(f().Ay,{initialFocus:0,type:f().Oh.Vertical,sections:L})}function B(){const e=y().sb([...(0,a().dj)(),...(0,a().Lh)()]);return C().globalWorkflowTemplates.allOfType({templateIds:e,type:"collection"})}function F(e,t){return(0,S().Ay)(e,t,(e=>`${e.value.targetCollection.name} ${e.description}`),{minThreshold:S().qR,normalizeFuzzyScore:!0})}},810521:(e,t,o)=>{o.r(t),o.d(t,{trackCreateNewEmptyDataSource:()=>r,trackDeleteDataSource:()=>s,trackLinkedExistingDataSource:()=>l,trackManageDataSources:()=>i});var n=()=>o(564884);function i(e,t){(0,n().u)({environment:e,event:{eventName:"manage_data_sources",eventProperties:t}})}function r(e,t){(0,n().u)({environment:e,event:{eventName:"create_new_empty_data_source",eventProperties:t}})}function l(e,t){(0,n().u)({environment:e,event:{eventName:"linked_existing_data_source",eventProperties:t}})}function s(e,t){(0,n().u)({environment:e,event:{eventName:"delete_data_source",eventProperties:t}})}},858901:(e,t,o)=>{o.d(t,{rs:()=>i,zx:()=>r});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520);var n=o(296540);function i(e){const t=[];let o=0;for(const n of e)for(const e of n.items){if("searchKeys"in e&&Array.isArray(e.searchKeys)&&e.searchKeys.length>0)for(const n of e.searchKeys)t.push({key:n,globalIndex:o});else t.push({key:String(e.key),globalIndex:o});o+=1}return t}function r(e){const t=(0,n.useMemo)((()=>{const t=new Map;for(const o of e){const e=o.key.toLowerCase().trim().split(/\s+/).filter((e=>e.length>0));for(const n of e)t.has(n)||t.set(n,new Set),t.get(n).add(o)}return t}),[e]);return(0,n.useCallback)((e=>{var o;if(!e.trim())return;const n=e.toLowerCase().trim().split(/\s+/).filter((e=>e.length>0));if(0===n.length)return;const i=new Map;for(const s of n){const e=t.get(s);if(e)for(const t of e){const e=i.get(t)||0;i.set(t,e+1)}}let r,l=0;for(const[t,s]of i){const e=1e3*s-t.globalIndex;e>l&&(l=e,r=t)}return null===(o=r)||void 0===o?void 0:o.globalIndex}),[t])}},885749:(e,t,o)=>{o.d(t,{A:()=>d,u:()=>a});o(898992),o(803949),o(581454);var n=o(296540),i=()=>o(69708),r=()=>o(406699),l=()=>o(939740),s=o(474848);const a=(0,i().YK)({hide:{id:"PersonalHomePanel.moreDropdown.hide.title",defaultMessage:"Hide from Home"}});function c({actions:e}){const t=(0,i().tz)(),c=(0,n.useMemo)((()=>{const t={};return e.forEach((e=>{"custom"===e.type&&(t[e.item.key]=e.closeOnAccept)})),t}),[e]),d=[{key:"all",render:e=>(0,s.jsx)(o(89924).A,{...e}),items:e.map((e=>{switch(e.type){case"hide":return{key:"hide",render:e=>(0,s.jsx)(o(760217).A,{...e,icon:(0,s.jsx)(o(252291).I,{icon:o(566910).e}),title:t.formatMessage(a.hide),style:{borderRadius:o(665579)._g}}),action:e.hide};case"custom":return e.item;default:(0,o(534177).HB)(e)}}))}];return(0,s.jsx)(r().A,{popupType:r().z.Popup,alignmentToOrigin:"center",originGap:2,renderOrigin:e=>(0,s.jsx)(o(167068).A,{...e}),render:e=>(0,s.jsx)(o(404277).A,{menuType:o(722872).gu.Popup,children:(0,s.jsx)(l().Ay,{onAccept:t=>((e,t)=>{c[e.key]&&t.close()})(t,e),type:l().Oh.Vertical,sections:d,initialFocus:void 0})})})}const d=n.memo(c)},899725:(e,t,o)=>{o.d(t,{T:()=>s});o(944114),o(898992),o(354520);var n=()=>o(653002),i=()=>o(384944),r=()=>o(913530),l=()=>o(808655);function s(e){const{transaction:t,collectionContextStore:o,viewId:s}=e,a=o.dashboardWidgetStore.state,c=null==a?void 0:a.dashboardCollectionViewBlockStore,d=null==a?void 0:a.dashboardViewStore,u=c||o.collectionViewBlockStore();if(!u)return;const p=u.getSpaceId();if(!p)return;const g=(0,n().Q)({collectionViewId:s,spaceId:p}),m=r().p.createChildStore(u,g);i().zv({store:m,data:{alive:!1},transaction:t});let S=d,y=null;if(S){const e=S.getFormat();y=null==e?void 0:e.dashboard_layout_pointer}else{const e=u.getCollectionViewStores();for(const t of e)if("dashboard"===t.getType()){const e=t.getFormat();if(null!=e&&e.dashboard_layout_pointer){S=t,y=e.dashboard_layout_pointer;break}}}if(y&&S){const e=l().K.createChildStore(S,y),o=e.getRawModules(),n=(null==o?void 0:o.dashboard_layout_schema)??[],r=[];for(const t of n)if("row"===t.type){const e=t.modules.filter((e=>e.collection_view_id!==s));e.length>0&&r.push({...t,modules:e})}i().zv({store:e,data:{modules:{page_layout_schema:(null==o?void 0:o.page_layout_schema)??void 0,page_info_layout_schema:(null==o?void 0:o.page_info_layout_schema)??void 0,form_layout_schema:(null==o?void 0:o.form_layout_schema)??void 0,person_profile_page_main:(null==o?void 0:o.person_profile_page_main)??void 0,person_profile_page_details:(null==o?void 0:o.person_profile_page_details)??void 0,dashboard_layout_schema:r}},transaction:t})}}},908375:(e,t,o)=>{o.d(t,{c:()=>w});var n=o(296540),i=()=>o(699143),r=()=>o(252291),l=()=>o(493552),s=()=>o(69708),a=()=>o(859428),c=()=>o(553965),d=()=>o(465570),u=()=>o(208603),p=()=>o(407823),g=()=>o(153861),m=()=>o(484714),S=()=>o(56366),y=()=>o(369955),f=()=>o(324561),h=()=>o(523036),v=()=>o(803025),x=()=>o(341233),b=()=>o(414236);var C=o(474848);function w(e){const{upsell:t,source:o,showTooltip:w,children:j}=e,{customTitleMessages:A,description:_,content:I,showIcon:k=!0,showTitle:M=!0,maxWidth:T=240,placement:P="bottom"}=e.tooltipProps??{},B=(0,s().tz)(),{upgradeEligibility:F,handleClick:V}=function({upsell:e,source:t}){var o;const i=(0,y().L)(),r=(0,m().v3)(),l=(0,v().q)(),s=(0,f()._3)({spaceId:null==i?void 0:i.id}),a=(0,h().R)(t),c=null===(o=r.currentUser)||void 0===o?void 0:o.id,[d,u]=(0,b().h)({upsell:e}),p=(0,S().K8)((()=>(0,g().ap)({environment:r,upsell:e,spaceStore:i,salesStatus:l,offer:a,requestState:d,billingData:s,source:t})),[i,r,e,l,a,d,s,t]),C=n.useCallback((async()=>{const o="product"===e.type?e.product:void 0,{getUpgradeSystemAction:n}=await x().H.upgradeSystemActions.load(),l=n(p);await l({setRequestState:u,userId:c,source:t,spaceStore:i,product:o,billingData:s,environment:r})}),[u,p,c,t,i,e,s,r]);return{upgradeEligibility:p,handleClick:C}}({upsell:t,source:o}),D=F.status,E=(0,p().e)(D),R=(0,g().T)({upsell:t,intl:B}),O=w?null!=A&&A[D]?B.formatMessage(A[D]):E.label.text({intl:B,productDisplayName:R}):null,K=!(k||_||I||M);if(E.disabledTooltip){const e=w?null!=A&&A[D]?B.formatMessage(A[D]):E.disabledTooltip({intl:B,productDisplayName:R}):null;return(0,C.jsx)(d().T,{placement:w?P:void 0,tooltipMessage:e,children:j({upgradeStatus:D,handleClick:V,isDisabled:!0})})}return w?(0,C.jsx)(a().A,{placement:P,style:{maxWidth:T,width:"fit-content",padding:K?"4px 8px":M?"6px 8px":"0px 10px"},renderTooltip:()=>(0,C.jsxs)(i().Y1,{direction:"vertical",gap:8,width:"hug",children:[(0,C.jsxs)(i().Y1,{direction:"horizontal",gap:I?6:4,align:"top-left",children:[k?(0,C.jsx)(r().I,{...(0,u().e4)({icon:E.icon,animationState:"initial"}),size:"xs"}):null,M?(0,C.jsx)(l().D,{styleKey:"Caption/Medium",colorVariant:"inversePrimary",children:O}):null]}),_?(0,C.jsx)(l().D,{styleKey:"Caption/Regular",colorVariant:"inverseSecondary",children:_}):null,I??null]}),render:e=>n.cloneElement(j({upgradeStatus:D,handleClick:V,isDisabled:!1}),(0,c().A)(e,j({upgradeStatus:D,handleClick:V,isDisabled:!1}).props)),textWrap:!0}):j({upgradeStatus:D,handleClick:V,isDisabled:!1})}},916727:(e,t,o)=>{o.d(t,{F:()=>a});o(296540);var n=()=>o(401497),i=()=>o(718827),r=()=>o(66913),l=()=>o(284371),s=o(474848);function a(e){const{title:t,icon:o,style:a,children:c,right:d,showCloseButton:u,onClose:p}=e,g=(0,n().DP)(),m=(0,s.jsx)(i().Ay,{onClick:p,style:{display:"flex",alignItems:"center",justifyContent:"center",background:void 0,borderRadius:6,width:16,height:16},children:(0,r().V)({width:14,fill:g.text.secondary})});return(0,s.jsxs)("div",{style:{padding:"12px 16px",margin:"4px 12px",fontSize:12,background:g.palette.orange[50],borderRadius:6,...a},children:[t?(0,s.jsxs)("div",{style:{display:"flex",marginBottom:2,alignItems:"center"},children:[o,(0,s.jsx)("div",{style:{fontWeight:l().Wy.medium,flexGrow:1,...l().RC},children:t}),u?m:d]}):void 0,c]})}},926203:(e,t,o)=>{o.d(t,{$g:()=>F,Eg:()=>E,Wf:()=>z,Xm:()=>O,aH:()=>V,pz:()=>R,qd:()=>B,v9:()=>U});o(898992),o(354520),o(672577),o(581454);var n=o(296540),i=()=>o(484714),r=()=>o(56366),l=()=>o(401497),s=()=>o(718827),a=()=>o(160432),c=()=>o(862e3),d=()=>o(726275),u=()=>o(212727),p=()=>o(236262),g=()=>o(69708),m=()=>o(183558),S=()=>o(534177),y=()=>o(284371),f=()=>o(436696),h=()=>o(966759),v=()=>o(390787),x=()=>o(901389),b=()=>o(384944),C=()=>o(231297),w=()=>o(312296),j=()=>o(89924),A=()=>o(574036),_=()=>o(989219),I=()=>o(147503),k=()=>o(497222),M=()=>o(147361),T=()=>o(554840),P=o(474848);const B="consume_gap",F=!0;function V(e){var t;const{currentConfig:o,onConfigChange:s,disabled:a,collectionContextStore:c}=e,d=(0,r().K8)((()=>c.databaseType),[c]),u=(0,i().v3)(),p=null===(t=o.configWithoutDates)||void 0===t?void 0:t.mode,[m,y]=(0,n.useState)((0,S().O9)(o.configWithoutDates)?Boolean(o.configWithoutDates.avoid_weekends):F),h=(0,S().O9)(o.configWithoutDates)?Boolean(o.configWithoutDates.avoid_weekends):m;(0,n.useEffect)((()=>{if((0,S().O9)(o.configWithoutDates)){const e=Boolean(o.configWithoutDates.avoid_weekends);e!==m&&y(e)}}),[o,m]);const v=(0,l().IS)((()=>({dateShiftContainer:{marginInlineStart:4},previewContainer:{marginInlineStart:4},previewTitle:{paddingInlineStart:10}})),[]),x=(0,n.useCallback)((e=>{(0,S().O9)(o.configWithoutDates)&&(s({...o,configWithoutDates:{...o.configWithoutDates,avoid_weekends:e}}),(0,f().X)({environment:u,collectionContextStore:c,action:"update_dependency_date_shift_avoid_weekends",new_avoid_weekends:e}))}),[c,o,u,s]),b=(0,n.useCallback)((e=>{(0,S().O9)(e)?s({...o,configWithoutDates:{...o.configWithoutDates,mode:e,avoid_weekends:m}}):s({...o,configWithoutDates:void 0}),(0,f().X)({environment:u,collectionContextStore:c,action:"update_dependency_date_shift_mode",new_date_shift_mode:e??"none"})}),[c,o,u,m,s]);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(j().A,{title:(0,P.jsx)(g().sA,{..._().Ic.dateShiftingSectionCaption}),disableMobileBorders:!0,style:v.previewContainer,desktopTitleStyle:v.previewTitle,children:(0,P.jsx)(M().r,{mode:p})}),(0,P.jsx)(j().A,{disableMobileBorders:!0,style:v.dateShiftContainer,children:(0,P.jsx)(N,{currentMode:p,onModeChange:b,databaseType:d,disabled:a})}),(0,P.jsxs)(j().A,{children:[(0,P.jsx)(K,{currentValue:h,databaseType:d,onChange:x,disabled:a||!(0,S().O9)(o.configWithoutDates)}),(0,P.jsx)(D,{...e})]})]})}function D(e){const{collectionContextStore:t,currentConfig:o,onConfigChange:i,disabled:l}=e,s=(0,r().K8)((()=>{const e=t.normalizedSchemaStore.state;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,c().$)(o)}))}),[t]),a=s.length,d=o.datePropertyId?s.find((e=>e!==o.datePropertyId)):void 0,u="string"==typeof o.datePropertyId&&(0,S().O9)(o.endDatePropertyId),p=(0,n.useCallback)(((e,t)=>{const n={[e]:t};if(u&&(0,S().O9)(o.datePropertyId)){const i="datePropertyId"===e?"endDatePropertyId":"datePropertyId";o[i]===t&&(n[i]=s.find((e=>e!==t)))}i({...o,...n})}),[o,s,i,u]);return!(0,S().O9)(o.configWithoutDates)||a<=1?null:(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(T().e,{collectionContextStore:t,currentPropertyId:o.datePropertyId,title:u?(0,P.jsx)(g().sA,{..._().Ic.startDate}):(0,P.jsx)(g().sA,{..._().Ic.datePropertyPickerTitle}),onPropertyChanged:e=>p("datePropertyId",e),disabled:l}),(0,S().O9)(d)&&"string"==typeof o.datePropertyId?(0,P.jsxs)(P.Fragment,{children:[(0,S().O9)(o.endDatePropertyId)?(0,P.jsx)(T().e,{collectionContextStore:t,currentPropertyId:o.endDatePropertyId,title:(0,P.jsx)(g().sA,{..._().Ic.endDate}),onPropertyChanged:e=>p("endDatePropertyId",e),disabled:l}):void 0,(0,P.jsx)(A().A,{title:(0,P.jsx)(g().sA,{id:"database.viewSettings.relationFeatures.datePropertyPicker.separateStartEnd",defaultMessage:"Separate start and end dates"}),focused:!1,on:u,disabled:l,disabledFeedback:!0,onClick:()=>{i({...o,endDatePropertyId:u?void 0:d})}})]}):void 0]})}function E(e){const{collectionSettingsStore:t,feature:o,permissionScopes:n}=e,i=!n.canConfigureCollection&&!n.canConfigureBlock;return(0,P.jsx)(k().A,{icon:u().gearIcon,showChevron:!0,disabled:i,title:(0,P.jsx)(g().sA,{..._().Ic.advancedSettings}),onClick:()=>{I().a2({collectionSettingsStore:t,item:{type:"relationFeaturesAdvancedSettings",feature:o}})}})}function R(e){const{feature:t,handleAddRelation:o,databaseType:n,permissionScopes:i}=e,r=(0,l().IS)((e=>({button:{width:"100%"},buttonWrap:{marginTop:0,marginInlineEnd:12,marginBottom:4,marginInlineStart:12}})),[]);if(!i.canConfigureBlock||!i.canConfigureCollection)return null;const s=(0,_().vP)({feature:t,databaseType:n});return(0,P.jsx)(j().A,{disableMobileBorders:!0,children:(0,P.jsx)("div",{style:r.buttonWrap,children:(0,P.jsx)(a().A,{colorPalette:"blue",style:r.button,onClick:o,size:"lg",children:(0,P.jsx)(g().sA,{...s})})})})}function O(e){const{feature:t,permissionScopes:o,propertyName:n,relationPropertyId:r,inversePropertyName:s,collectionContextStore:a,collectionSettingsStore:c,handleDefaultPropertySelect:d,databaseType:u,clearCollectionViewSubitemConfig:m}=e,S=(0,i().v3)(),f=(0,l().IS)((e=>({modalPropertyName:{color:e.darkTextColor,fontWeight:y().Wy.semibold}})),[]);if(!(o.canConfigureCollection&&o.canConfigureBlock&&n&&s))return null;const b=(0,_().Pf)({feature:t,databaseType:u}),w=(0,_().Ew)({feature:t,databaseType:u}),j={label:(0,P.jsx)(g().sA,{..._().Ic.turnOff}),color:"red",onAccept:async e=>{r&&(null!=e&&e.delete&&await async function(e){const{environment:t,collectionContextStore:o,propertyId:n,feature:i}=e,r=o.normalizedSchemaStore.state,l=o.collectionStore();if(!l)return;await C().createAndCommitAsync({environment:t,userAction:"CollectionSettingsViewRelationFeatures.handleTurnOffFeatureAndDeleteAccept",waitForServerCommit:!1,perform:e=>(0,v().P)({environment:t,collectionStore:l,schema:r,property:n,transaction:e})});const s=r[n];s&&(0,h().i)({environment:t,collectionContextStore:o,property_type:s.type,from:i,property:n})}({environment:S,propertyId:r,collectionContextStore:a,feature:t}),d(void 0),null==m||m(),I().R8({collectionSettingsStore:c,item:{type:"main"}}))}};return(0,P.jsx)(k().A,{icon:p().trashIcon,title:(0,P.jsx)(g().sA,{...b}),isRed:!0,onClick:()=>{x().ui({selectionItems:[{key:"delete",text:(0,P.jsx)(g().sA,{..._().Ic.removePropertiesTitle}),description:(0,P.jsx)(g().sA,{..._().Ic.removePropertiesDescription,values:{span:e=>(0,P.jsx)("span",{style:f.modalPropertyName,children:e}),property:n,inverseProperty:s}}),preSelected:!0},{key:"keep",text:(0,P.jsx)(g().sA,{..._().Ic.keepPropertiesTitle})}],selectType:"radio",selectAlignXAxis:"right",message:(0,P.jsx)(g().sA,{...w}),showCancel:!0,keepFocus:!0,items:[j]})}})}function K(e){const{currentValue:t,onChange:o,disabled:n,databaseType:i}=e;return(0,P.jsx)(A().A,{title:(0,P.jsx)(g().sA,{..._().Ic.avoidWeekendsSwitcherTitle}),caption:(0,P.jsx)(g().sA,{...(0,_().nV)(i)}),shouldWrapCaption:!0,shouldWrapTitle:!0,focused:!1,on:t,disabled:n,disabledFeedback:!0,onClick:()=>o(!t)})}function N(e){const{currentMode:t,onModeChange:o,disabled:n,databaseType:i}=e,r=(0,l().IS)((e=>({wrap:{display:"flex",flexDirection:"column",rowGap:8,marginInlineStart:12,marginInlineEnd:12}})),[]);return(0,P.jsx)("div",{style:r.wrap,children:[...d().OY,void 0].map((e=>(0,P.jsx)(L,{dateShiftingMode:e,databaseType:i,onClick:()=>o(e),active:e===t,disabled:n},e??"none")))})}function L(e){const{dateShiftingMode:t,onClick:o,active:n,disabled:r,databaseType:a}=e,c=(0,i().Y0)(),d=(0,l().IS)((e=>({buttonStyles:{fontSize:c.isMobile?y().J.UISmall.mobile:y().J.UISmall.desktop,fontWeight:y().Wy.medium,borderRadius:6,width:"100%",padding:"8px 10px",boxShadow:`0 0 0 1px ${e.regularDividerColor}`,color:e.darkTextColor,fill:e.text.secondary,...n&&{boxShadow:`0 0 0 2px ${e.blue.border.accentPrimary}`,color:e.blue.text.accentPrimary,fill:e.blue.icon.accentPrimary},...r&&{opacity:.65}}})),[n,c,r]),u=(0,_().Zt)({dateShiftingMode:t,databaseType:a});return(0,P.jsx)(s().Ay,{style:d.buttonStyles,onClick:o,disabled:r,children:(0,P.jsx)(g().sA,{...u})})}function z(e){const{environment:t,newConfig:o,collectionStore:n,transaction:i,intl:r}=e;let l;if((0,S().O9)(o.configWithoutDates))if(o.datePropertyId)l={...o.configWithoutDates,date_property:o.datePropertyId,end_date_property:o.endDatePropertyId};else{const e=(0,m().Ay)(),s={name:r.formatMessage(_().Ic.newDateProperty),type:"date"};(0,w().F)({environment:t,collectionStore:n,update:{[e]:s},transaction:i}),l={...o.configWithoutDates,date_property:e,end_date_property:void 0}}b().zv({store:n.getFormatStore(),data:{dependency_date_shifting_config:l??null},transaction:i})}function U(e){const{viewType:t,feature:o}=e;return"timeline_arrows_by"===o?"timeline"===t:"subitem"===o||void(0,S().HB)(o)}},943919:(e,t,o)=>{o.d(t,{o:()=>i});var n=()=>o(896628);function i(e){const{icon:t,collectionViewStore:o,transaction:i}=e;n().zA({stores:[o],update:{collection_view_icon:t},transaction:i})}},959733:(e,t,o)=>{o.d(t,{g:()=>_});var n=o(296540),i=()=>o(56366),r=()=>o(31503),l=()=>o(898244),s=()=>o(465741),a=()=>o(852353),c=()=>o(937199),d=()=>o(69708),u=()=>o(908201),p=()=>o(859428),g=()=>o(103448),m=()=>o(478573),S=()=>o(484714),y=()=>o(543906),f=()=>o(581928),h=()=>o(495262),v=()=>o(231297),x=()=>o(409198),b=()=>o(527438),C=()=>o(417392),w=o(474848);function j(e){var t;const{open:o,originRef:r,settingsViewToOpen:l,propertyType:s,isPropertyEditComplete:d,onPropertyEditComplete:u,onDismiss:p,rollbackIfEditIncomplete:g,collectionContextStore:m,collectionSettingsStore:j}=e,A=null===(t=r.current)||void 0===t?void 0:t.getBoundingClientRect(),_=(0,S().v3)(),{collectionStore:I}=(0,c().bi)(),[k,M]=(0,n.useState)(null),[T,P]=(0,n.useState)(!1),[B,F]=(0,n.useState)(null);(0,y().A)((()=>{const e=`CollectionPropertySettingsPopup.createNewProperty.${s}.${Date.now()}`,{performResult:t}=v().createAndCommit({userAction:"CollectionPropertySettingsPopup.createNewProperty",environment:_,canUndo:!0,undoCheckpoint:e,perform:e=>(0,f().createProperty)({environment:_,collectionStore:I,collectionViewArgs:void 0,propertyName:a().dC[s],propertyType:s,transaction:e})});j.update((e=>({...e,stack:[{...l,property:t}],open:!0}))),M(t),F(e)}),o);const V=(0,i().K8)((()=>{if(!k)return!1;const e=I.getSchema()[k];return!!e&&d(e)}),[I,d,k]);(0,n.useEffect)((()=>{V&&k&&!T&&(u(k),P(!0))}),[V,u,k,T]);const{setModuleSelection:D}=(0,c().LH)();return k?(0,w.jsx)(C().Ay,{open:o,popupType:C().nl.Popup,render:()=>(0,w.jsx)(x().CollectionSettings,{context:b().Bd.TopbarFilterPopup,collectionContextStore:m,collectionSettingsStore:j,hideDesktopHeader:!0}),originRect:A,alignmentToOrigin:"center",placementToOrigin:"bottom",originGap:4,onDismiss:()=>{!V&&g&&(B&&h().JM({environment:_,namedRevisionId:B}),D(void 0)),p()}}):null}function A(e){const{icon:t,name:o,disabled:i,tooltip:r,propertySettingsPopup:s,propertyType:a,...c}=e,{image:S,caption:y}=r||{},f=(0,u().ET)(),h=n.useRef(null),v=n.useCallback((e=>(0,w.jsx)("div",{style:{width:"100%"},...e,children:(0,w.jsx)(m().A,{icon:t,name:o,disabled:i,...c,ref:h})})),[i,t,o,c]);let x;return!S&&y?x=(0,w.jsx)(p().A,{textWrap:!0,placement:"left",render:v,renderTooltip:()=>(0,w.jsx)(d().sA,{...y})}):S&&y&&(x=(0,w.jsx)(p().A,{placement:"left",render:v,renderTooltip:()=>(0,w.jsx)(g().A,{caption:(0,w.jsx)(d().sA,{...y}),imageURL:S,imageWidth:140,imageHeight:100,imageContainerStyle:{backgroundColor:"white"}})})),(0,w.jsxs)(w.Fragment,{children:[x||(0,w.jsx)(v,{}),s&&s.open?(0,w.jsx)(j,{originRef:h,propertyType:(0,l().v2)(a),collectionContextStore:f,collectionSettingsStore:f.settingsStore,...s}):void 0]})}function _({actionHandler:e,renderIcon:t,tooltip:o,disabled:d,propertySettingsPopupProps:u}){const[p,g]=n.useState(null),{layoutStore:m}=(0,c().LH)(),S=(0,i().K8)((()=>m.getLayoutType()),[m]);return(0,n.useCallback)((n=>({key:n,keywords:[a().dC[n]],render:({ref:e,...i})=>{const c=null==u?void 0:u(n);let m=a().dC[n];const y=(0,l().v2)(n);return"form"===S&&(0,r().XO)(y)&&"select"!==y&&(m=s().mY[y]),(0,w.jsx)(A,{icon:t(n),name:m,disabled:null==d?void 0:d(n),propertyType:n,propertySettingsPopup:c?{...c,open:p===n,onDismiss:()=>{g(null)}}:void 0,tooltip:null==o?void 0:o(n),ref:e,...i})},action:()=>{null!=u&&u(n)?g(n):e(n)}})),[e,d,S,p,u,t,o])}},988536:(e,t,o)=>{o.d(t,{C:()=>x,j:()=>b});o(898992),o(354520);var n=o(296540),i=()=>o(484714),r=()=>o(56366),l=()=>o(401497),s=()=>o(493552),a=()=>o(373009),c=()=>o(484392),d=()=>o(617871),u=()=>o(824862),p=()=>o(69708),g=()=>o(284371),m=()=>o(674582),S=()=>o(859004),y=()=>o(53137),f=()=>o(258836),h=()=>o(254526),v=o(474848);function x({integrationIconUrl:e,integrationIcon:t,spaceStore:o,flowId:r,renderActions:u,captionText:y,forceReauthForBot:f=!1,from:h}){const x=(0,i().v3)(),w=(0,l().IS)((e=>({borderedContainer:{borderRadius:6,borderStyle:"solid",borderWidth:1,borderColor:e.border.secondary,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:6},header:{fontWeight:g().Wy.medium,color:e.text.primary,fontSize:g().J.UIRegular.desktop,marginTop:0},captionText:{fontSize:g().J.UISmall.desktop,color:e.text.secondary,fontWeight:g().Wy.regular,textAlign:"center"},siteButton:{padding:"4px",borderRadius:6,display:"flex",justifyContent:"space-between",overflow:"hidden",width:"100%"},siteButtonTextContainer:{gap:8,display:"flex",minWidth:0,overflow:"hidden"},siteNameText:{fontSize:g().J.UIRegular.desktop,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},siteNameSecondaryText:{fontSize:g().J.UISmall.desktop,color:e.text.secondary,fontWeight:g().Wy.regular,textAlign:"start",whiteSpace:"nowrap"}})),[]),{status:j,externalAuthentication:A}=b({spaceStore:o}),_=(0,n.useCallback)((()=>{let e="admin";e="no_user_access"===j?"user":"admin","connected"===j&&!1!==f&&(e=f.integration_id===d().mn?"admin":"user"),S().rT({environment:x,from:h,flowId:r,authType:e,isReAuth:Boolean("connected"===j&&f)})}),[x,h,r,j,f]),I=(0,n.useMemo)((()=>"not_connected"===j||"no_user_access"===j||"connected"===j&&f?(0,v.jsx)(m().m,{integrationIconUrl:e,integrationIcon:t,styles:{wrapper:{...w.borderedContainer,padding:20},header:w.header,arrowRight:{height:24,width:24},icon:{height:36,width:36}},title:(0,v.jsx)(p().sA,{defaultMessage:"Authenticate Salesforce",id:"database.viewSettings.collectionSettingsExternalSource.connectToSalesforce.headline"}),description:(0,v.jsx)("div",{style:w.captionText,children:y}),children:(0,v.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:(0,v.jsx)(a().E,{colorPalette:"blue",style:{marginInlineEnd:"auto",marginBottom:0,marginInlineStart:"auto"},onClick:_,children:(0,v.jsx)(s().D,{styleKey:"Body/Regular",children:f?(0,v.jsx)(p().sA,{defaultMessage:"Re-authenticate Salesforce",id:"database.viewSettings.collectionSettingsExternalSource.reAuthToSalesforce"}):(0,v.jsx)(p().sA,{defaultMessage:"Connect to Salesforce",id:"database.viewSettings.collectionSettingsExternalSource.connectToSalesforce"})})})})}):"connected"===j?(0,v.jsx)("div",{style:w.captionText,children:(0,v.jsx)("div",{style:{...w.borderedContainer,padding:4},children:(0,v.jsx)("div",{style:w.siteButton,children:(0,v.jsxs)("div",{style:w.siteButtonTextContainer,children:[e?C({iconStyle:{width:18,height:18},srcUrl:e}):t,(0,v.jsxs)("div",{style:{display:"flex",flexFlow:"column",alignItems:"flex-start",gap:1,minWidth:0,flex:1},children:[(0,v.jsx)("span",{style:w.siteNameText,children:(0,c().A)(null==A?void 0:A.account_name)}),(0,v.jsx)("span",{style:w.siteNameSecondaryText,children:(0,c().A)(null==A?void 0:A.account_key)})]})]})})})}):null),[j,e,t,w,y,_,f,A]);return(0,v.jsxs)(v.Fragment,{children:[I,null==u?void 0:u(j)]})}function b(e){const{spaceStore:t}=e;return(0,r().K8)((()=>{if(!t)return{status:"not_connected",spaceBotId:void 0,externalAuthentication:void 0};const e=y().A.state;if(!e.loaded)return{status:"not_connected",spaceBotId:void 0,externalAuthentication:void 0};const o=e.bots.filter((({integration_id:e})=>e===d().mn));if(0===o.length)return{status:"not_connected",spaceBotId:void 0,externalAuthentication:void 0};const n=f().v.createChildStore(t,{table:u().GP,id:o[0].id,spaceId:t.id}),{status:i,externalAuthentication:r}=(0,h().i_)(n);return{status:i,spaceBotId:n.id,externalAuthentication:r}}),[t])}function C(e){const{iconStyle:t,srcUrl:o,altString:n}=e;return(0,v.jsx)("img",{style:t,src:o,alt:n})}},990402:(e,t,o)=>{o.d(t,{G:()=>r,m:()=>i});var n=()=>o(46986);function i(e){return e.canEdit()&&(0,n().re)()}function r(e){return e.canEdit()&&!e.isSystemBlock()&&(0,n().re)()}},992032:(e,t,o)=>{o.d(t,{VJ:()=>B,oI:()=>K,Ac:()=>O});o(581454);var n=o(296540),i=()=>o(564884),r=()=>o(484714),l=()=>o(56366),s=()=>o(401497),a=()=>o(929219),c=()=>o(718827),d=()=>o(252291),u=()=>o(631524),p=()=>o(493552),g=()=>o(536095),m=()=>o(529099),S=()=>o(569397),y=()=>o(177148),f=()=>o(421559),h=()=>o(826693),v=()=>o(69708),x=()=>o(496603),b=()=>o(310526),C=()=>o(765957),w=()=>o(913454),j=()=>o(575154),A=()=>o(349379),_=()=>o(466934),I=()=>o(458097),k=()=>o(606712),M=o(474848);function T({template:e,onSelect:t,index:i}){const r=(0,n.useCallback)((()=>t(e)),[t,e]),l=(0,o(3486).P)(e.value.targetCollection.icon),a=(0,s().IS)((e=>({button:{borderRadius:B,border:`1px solid ${e[l].border.primary}`,overflow:"hidden",transition:"background 0.2s ease",background:e[l].background.primaryTranslucent},buttonInner:{borderRadius:B},buttonHovered:{background:(0,k().R)({color:e[l].background.primaryTranslucent,mode:e.mode,adjustmentFactor:2})},buttonPressed:{background:(0,k().y)({color:e[l].background.primaryTranslucent,mode:e.mode,adjustmentFactor:4})},textContainer:{padding:"20px 20px 10px",color:e[l].text.primary},description:{marginTop:2,color:e[l].text.primary,opacity:.6,textWrap:"balance"},outerImageContainer:{overflow:"visible",position:"relative",height:108,width:"calc(100% - 22px)",marginInlineStart:22,marginTop:-4},imageContainer:{position:"absolute",top:0,transition:"top 0.2s ease",width:"100%",height:"100%",marginTop:4,lineHeight:0,borderRadius:"6px 0",overflow:"hidden",background:e[l].background.elevated,boxShadow:"dark"===e.mode?`0 0 0 1px ${e[l].border.primary}`:`0px 0px 0px 1px ${e[l].border.primary}, 0px 2px 4px -1px rgba(0, 0, 0, 0.06), 0px 12px 32px -6px rgba(0, 0, 0, 0.12)`}})),[l]);return(0,M.jsx)(c().Ay,{style:a.button,hoveredStyle:a.buttonHovered,pressedStyle:a.buttonPressed,ariaLabel:e.value.targetCollection.name,onClick:r,children:(0,M.jsx)("div",{style:a.buttonInner,children:(0,M.jsxs)(o(699143).Y1,{gap:"auto",height:"fill",children:[(0,M.jsxs)("div",{style:a.textContainer,children:[(0,M.jsx)(p().D,{styleKey:"Body/Medium",children:e.value.targetCollection.name}),(0,M.jsx)(p().D,{styleKey:"Caption/Regular",style:a.description,children:e.description})]}),(0,M.jsx)("div",{style:a.outerImageContainer,children:(0,M.jsx)("div",{style:a.imageContainer,children:(0,M.jsx)(o(92924).i,{template:e,templateColor:l,index:i})})})]})})})}const P=n.memo(T),B=12,F={};function V({iconFn:e,iconColorName:t,label:o,onClick:n}){const i=(0,s().IS)((e=>({button:{padding:"16px 18px",borderRadius:B,borderWidth:1,borderStyle:"solid",borderColor:"dark"===e.mode?e.border.secondary:e.border.primary},hovered:{background:e.buttonHoveredBackground,borderColor:e.palette.translucentGray[100]},icon:{height:19,width:"auto",color:t?e.icon[t]:void 0,marginBottom:8}})),[t]);return(0,M.jsxs)(c().Ay,{style:i.button,hoveredStyle:i.hovered,onClick:n,children:[(0,M.jsx)("div",{children:e(i.icon)}),(0,M.jsx)(p().D,{styleKey:"Body/Medium",children:o})]})}function D({iconFn:e,iconColorName:t,label:o,onClick:n}){const i=(0,s().IS)((e=>({button:{padding:"5px 12px",display:"flex",gap:8,justifyContent:"center",alignItems:"center",borderRadius:20,color:e.text.secondary},icon:{height:19,width:"auto",color:t?e.icon[t]:void 0,marginBottom:0}})),[t]);return(0,M.jsxs)(c().Ay,{style:i.button,onClick:n,children:[(0,M.jsx)("div",{children:e(i.icon)}),(0,M.jsx)(p().D,{styleKey:"Body/Regular",children:o})]})}const E=16,R=4,O=(0,M.jsx)(v().sA,{id:"workflowTemplatesOnboardingModal.button.marketplace",defaultMessage:"More in Marketplace"});function K({parentStore:e,onAddEmptyPage:t,onAddEmptyDatabase:o,onSelectTemplate:c,onMarketplaceClick:d,showEmptyPageButton:S,onPromptSubmit:h}){const b=(0,r().v3)(),{isPhone:C}=(0,r().Y0)(),k=(0,l().K8)((()=>I().default.getShouldShowExpandedTemplateList()),[]),T=(0,j().q)({parentStore:e,returnAllTemplates:k}),B=(0,l().K8)((()=>I().default.state.open&&"new_user_onboarding"===I().default.state.origin),[]),O=(0,l().K8)((()=>I().default.state.open&&("land_on_app_from_new_user_onboarding"===I().default.state.origin||B)),[B]),K=(0,n.useMemo)((()=>B?T.slice(0,R):k?T:function({arr:e,min:t}){if(e.length<=t)return[...e];return e.slice(0,2*Math.floor(e.length/2))}({arr:T,min:1})),[T,k,B]),L=(0,l().K8)((()=>(0,w().getIsSetupGeneratorEnabled)()&&!O&&a().A.state.online),[O]),z=B,U=!k,W=(0,n.useCallback)((()=>{I().default.setShouldShowExpandedTemplateList(!0),I().default.state.open&&(0,i().u)({environment:b,event:{eventName:"template_picker_show_more_templates_clicked",eventProperties:(0,_().gM)(I().default.state)}})}),[b]),H=(0,s().IS)((e=>({container:{width:"100%",maxWidth:560+E,alignSelf:"center",alignItems:"center"},basicButtonGrid:{display:"grid",gridTemplateColumns:`repeat(auto-fit, minmax(calc((100% - ${2*E}px) / 3), 1fr))`,maxWidth:"100%",gap:E,marginTop:E,marginBottom:C?26:2*E},newUserOnboardingButtons:{display:"flex",gap:4,margin:`${E}px auto 40px auto`,justifyContent:"center"},templateButtonGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:E,marginTop:C?13:B?36:18},showMoreButton:{marginTop:E,height:32,paddingInlineStart:12,paddingInlineEnd:12}})),[B,C]);(0,n.useEffect)((()=>{const{state:e}=I().default;e.open&&void 0!==e.flowId&&!F[e.flowId]&&((0,A().DF)({environment:b,eventProperties:{collection_template_ids_shown:K.map((e=>e.templateId)),...(0,_().gM)(e)}}),F[e.flowId]=!0)}),[K,b]);const G=(0,n.useCallback)((()=>{c(w().globalWorkflowTemplates.fromIdOfType({templateId:g().MH,type:"collection"}),{type:"ai_generated_template"})}),[c]),$=(0,n.useCallback)((e=>{c(e,{type:"suggested_template",allOrderedTemplateIds:K.map((e=>e.templateId))})}),[c,K]),Q=O?D:V,Y=(0,x().oE)([S?(0,M.jsx)(Q,{iconFn:y().Y,iconColorName:"secondary",label:(0,M.jsx)(v().sA,{id:"workflowTemplatesOnboardingModal.button.emptyPage",defaultMessage:"Empty page"}),onClick:t},"emptyPage"):void 0,(0,M.jsx)(Q,{iconFn:f().T,iconColorName:"secondary",label:(0,M.jsx)(v().sA,{id:"workflowTemplatesOnboardingModal.button.emptyDatabase",defaultMessage:"Empty database"}),onClick:o},"emptyDatabase"),L?(0,M.jsx)(Q,{iconFn:m().aiFaceIcon,iconColorName:"secondary",label:(0,M.jsx)(v().sA,{id:"workflowTemplatesOnboardingModal.button.buildWithAi",defaultMessage:"Build with AI"}),onClick:G},"buildWithAi"):void 0]);return(0,M.jsxs)("div",{style:H.container,children:[B?void 0:(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("div",{style:O?H.newUserOnboardingButtons:H.basicButtonGrid,children:Y}),(0,M.jsx)(p().D,{styleKey:"Body/Medium",colorVariant:"secondary",children:(0,M.jsx)(v().sA,{defaultMessage:"Suggested",id:"workflowTemplatesOnboardingModal.templateSelection.heading"})})]}),(0,M.jsx)("div",{style:H.templateButtonGrid,children:K.map(((e,t)=>(0,M.jsx)(P,{template:e,onSelect:$,index:t},e.templateId)))}),z?null:U?(0,M.jsx)(u().p,{style:H.showMoreButton,onClick:W,children:(0,M.jsx)(p().D,{styleKey:"Body/Medium",colorVariant:"secondary",children:(0,M.jsx)(v().sA,{id:"workflowTemplatesOnboardingModalSelectionLanding.seeMore",defaultMessage:"More templates"})})}):(0,M.jsx)(N,{onClick:d})]})}function N(e){const{onClick:t}=e,o=(0,l().K8)((()=>{const e=C().default.state.sidebarSpaceViewStore;return(0,b().U)(e)}),[]),n=(0,s().IS)((e=>({marketplaceButton:{marginTop:E,gap:6},marketplaceIcon:{height:19,width:"auto",color:e.icon.secondary}})),[]);return o?null:(0,M.jsxs)(u().p,{size:"lg",style:n.marketplaceButton,onClick:t,children:[(0,h().notionTemplateIcon)(n.marketplaceIcon),(0,M.jsx)(p().D,{styleKey:"Body/Medium",colorVariant:"secondary",children:O}),(0,M.jsx)(d().I,{icon:S().arrowStraightRightSmallIcon,size:"sm",colorVariant:"secondary"})]})}}}]);