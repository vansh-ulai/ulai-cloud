"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[49175],{37546:(e,t,a)=>{a.d(t,{l:()=>we});var n=()=>a(624119),i=a(296540),o=()=>a(484714),r=()=>a(56366),s=()=>a(401497),l=()=>a(493552),d=()=>a(187174),c=()=>a(69708),u=()=>a(498212),p=()=>a(465039),m=()=>a(152197),y=()=>a(765957),g=()=>a(462842),f=()=>a(345737),h=()=>a(59226),v=()=>a(242422),A=()=>a(726637),x=()=>a(251111),C=()=>a(165358),k=()=>a(76489),b=()=>a(278238),S=()=>a(402390),I=()=>a(179034),T=()=>a(529745),M=()=>a(496603),w=()=>a(252105),P=()=>a(559506),_=()=>a(901389),j=()=>a(219348),D=()=>a(661461),L=()=>a(714818),B=()=>a(148832),K=()=>a(936015),R=()=>a(370441),E=()=>a(71268),q=()=>a(935774),V=()=>a(570882),N=()=>a(146423),W=()=>a(78219),U=()=>a(42905),z=()=>a(212782),F=(a(581454),()=>a(395361)),O=()=>a(202106),H=()=>a(623580),$=a(474848);const Y="marketplace-checkout-email";function G(){const e=(0,s().IS)((e=>({inputLabel:{position:"absolute",marginTop:"7px",marginInlineStart:"9px"},inputStyle:{paddingTop:"17px",cursor:"not-allowed",color:e.text.tertiary}})),[]),t=(0,r().K8)((()=>{var e;return(null===(e=y().default.state.currentUserStore)||void 0===e?void 0:e.getEmail())||""}),[]);return(0,$.jsxs)("div",{children:[(0,$.jsx)(l().D,{as:"label",id:Y,styleKey:"Caption-sm/Semibold",style:e.inputLabel,children:(0,$.jsx)(c().sA,{id:"inApp.marketplace.checkout.email",defaultMessage:"Email"})}),(0,$.jsx)(H().A,{disabled:!0,value:t,inputStyle:e.inputStyle,"aria-labelledby":Y})]})}const Z=(0,c().YK)({paymentDetails:{id:"inApp.marketplace.checkout.payment.secondaryText",defaultMessage:"Payment details"},billedTo:{id:"inApp.marketplace.checkout.payment.billedTo",defaultMessage:"Billed to"}});function X(e){const{onAddressChange:t,contacts:a,setIsPaymentElementComplete:i,isPaying:o}=e,r=(0,s().IS)((()=>({formContainer:{minWidth:A().A.isMobile?"100%":390,display:"flex",flexDirection:"column",gap:24},filler:{width:"100%",display:"flex",flexDirection:"column",gap:8},isolation:{isolation:"auto"},addressContainer:{zIndex:1}})),[]),d=(0,n().useStripe)(),u=(0,n().useElements)(),p=(0,c().tz)(),m={mode:"billing",contacts:a.length>0?a.map((e=>({name:e.name,address:e.address}))):void 0},y=(0,F().Y)(t,1e3),g={business:{name:"Notion Labs, Inc"},readOnly:o};return(0,$.jsxs)("div",{style:r.formContainer,children:[(0,$.jsxs)("div",{style:{...r.filler,...r.isolation},children:[(0,$.jsx)(l().D,{styleKey:"Caption/Semibold",colorVariant:"secondary",children:p.formatMessage(Z.billedTo)}),(0,$.jsx)("div",{style:r.addressContainer,children:(0,$.jsx)(n().AddressElement,{options:m,onChange:y})}),(0,$.jsx)(G,{})]}),(0,$.jsxs)("div",{style:r.filler,children:[(0,$.jsx)(l().D,{styleKey:"Caption/Semibold",colorVariant:"secondary",children:p.formatMessage(Z.paymentDetails)}),(0,$.jsx)(n().PaymentElement,{options:g,onChange:e=>{d&&u&&(e.value.type&&(0,O().t6)(e.value.type)&&N().A.setState({...N().A.state,paymentType:e.value.type}),e.complete&&i(!0))}})]})]})}var J=()=>a(559273),Q=()=>a(453697);function ee(e){const{productInformation:t}=e,{name:a,imageSource:n,mobileImageSource:i,creatorIconImage:o,creatorName:r}=t,d=(0,s().IS)((e=>({container:{display:"flex",gap:20,alignItems:"center",justifyContent:"space-between",padding:A().A.isMobile?"16px 16px 0px 16px":"16px",borderRadius:6,border:`1px solid ${e.border.primary}`,maxHeight:A().A.isMobile?"120px":"initial",overflow:A().A.isMobile?"hidden":"initial"},mobileProductImage:{width:"87px",minHeight:"100px",height:"auto",border:A().A.isMobile?"none":`1px solid ${e.border.primary}`,boxShadow:A().A.isMobile?"rgba(0, 0, 0, 0.02) -10px 12px 32px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px":"unset",borderRadius:6},productImageContainer:{alignSelf:A().A.isMobile?"start":"initial"},productImage:{width:118,height:74,borderRadius:6,border:`1px solid ${e.border.primary}`},productNameAndCreator:{display:"flex",flexDirection:"column",gap:10,paddingBottom:A().A.isMobile?16:0},productCreator:{display:"flex",alignItems:"center",gap:6},productName:{display:"flex",flexWrap:"wrap",maxWidth:181}})),[]);return(0,$.jsxs)("div",{style:d.container,children:[(0,$.jsxs)("div",{style:d.productNameAndCreator,children:[(0,$.jsx)(l().D,{styleKey:"Title-sm/Semibold",colorVariant:"primary",style:d.productName,children:a}),(0,$.jsxs)("div",{style:d.productCreator,children:[(0,$.jsx)(Q().A,{size:20,avatar:{name:r,avatarUrl:o}}),(0,$.jsx)(l().D,{styleKey:"Caption/Medium",colorVariant:"secondary",children:r})]})]}),(0,$.jsx)("div",{style:d.productImageContainer,children:(0,$.jsx)(J().A,{src:A().A.isMobile?i:n,alt:a,style:A().A.isMobile?d.mobileProductImage:d.productImage})})]})}var te=()=>a(98126),ae=()=>a(160432),ne=()=>a(292119),ie=()=>a(802790),oe=()=>a(564884);function re({children:e,source:t,styles:a={}}){const n=(0,o().v3)(),i=(0,s().IS)((()=>({link:{cursor:"pointer"}})),[]),l=(0,r().K8)((()=>v().default.getConfigKey("mwn_refund_policy_link","link")),[]);return l?(0,$.jsx)("a",{style:{...i.link,...a},href:l,target:"_blank",onClick:()=>{(0,oe().u)({environment:n,event:{eventName:"marketplace_refund_policy_click",eventProperties:{source:t}}}),v().default.logEvent("marketplace_refund_policy_click",t,{source:t})},children:e}):(0,$.jsx)($.Fragment,{children:e})}var se=()=>a(718827);function le(e){const{couponCode:t,onApplyClick:a,onCouponChange:n,isApplyingCoupon:i,isCouponApplied:o,onRemoveClick:r,invalidCouponReason:d,disabled:u}=e,p=(0,c().tz)(),m=u||i||""===t,y=function(e){const{disabled:t,applyButtonDisabled:a}=e;return(0,s().IS)((e=>({container:{display:"flex",flexDirection:"column",gap:8,position:"relative"},inputOuter:{height:34,paddingTop:10,paddingInlineEnd:6,paddingBottom:10,paddingInlineStart:10,display:"flex",alignItems:"center",borderRadius:6,border:e.border.primary,background:e.background.secondary},input:{position:"relative"},inputInner:{cursor:t?"not-allowed":void 0},button:{background:"transparent",height:28,paddingTop:0,paddingInlineEnd:8,paddingBottom:0,paddingInlineStart:8,display:"flex",justifyContent:"center",alignItems:"center",borderRadius:6,isolation:"auto",cursor:a?"not-allowed":void 0,width:"max-content"},buttonContainer:{cursor:"pointer"},buttonHovered:{background:t?void 0:e.buttonHoveredBackground},buttonPressed:{background:t?void 0:e.buttonPressedBackground},invalidBoxShadow:{position:"absolute",pointerEvents:"none",isolation:"auto",borderRadius:6,inset:0,zIndex:1,boxShadow:"0px 0px 0px 1px #D44C47 inset, 0px 0px 0px 2px rgba(225, 111, 100, 0.35)"}})),[t,a])}({disabled:u||i,applyButtonDisabled:m}),g=Boolean(d);return(0,$.jsxs)("div",{style:y.container,children:[(0,$.jsx)(l().D,{styleKey:"Caption/Medium",colorVariant:"secondary",children:(0,$.jsx)("label",{htmlFor:"couponInput",children:(0,$.jsx)(c().sA,{id:"inApp.marketplace.checkout.coupon.label",defaultMessage:"Coupon"})})}),(0,$.jsxs)("div",{style:y.input,children:[(0,$.jsx)(H().A,{id:"couponInput",ignoreKeyboardMode:!0,value:t,disabled:u||i,onChange:n,placeholder:p.formatMessage({id:"inApp.marketplace.checkout.coupon.input.placeholder",defaultMessage:"Code"}),style:y.inputOuter,inputStyle:y.inputInner,rightStyle:y.buttonContainer,right:i?(0,$.jsx)(te().k,{}):o?(0,$.jsx)(se().Ay,{style:y.button,onClick:()=>{r()},hoveredStyle:y.buttonHovered,pressedStyle:y.buttonPressed,disabled:u,children:(0,$.jsx)(l().D,{styleKey:"Body/Regular",colorVariant:"primary",children:(0,$.jsx)(c().sA,{id:"inApp.marketplace.checkout.coupon.remove",defaultMessage:"Remove"})})}):(0,$.jsx)(se().Ay,{style:y.button,onClick:async()=>{await a(t)},hoveredStyle:y.buttonHovered,pressedStyle:y.buttonPressed,disabled:m,children:(0,$.jsx)(l().D,{styleKey:"Body/Regular",colorVariant:m?"secondary":"primary",children:(0,$.jsx)(c().sA,{id:"inApp.marketplace.checkout.coupon.apply",defaultMessage:"Apply"})})})}),g?(0,$.jsx)("div",{style:y.invalidBoxShadow}):void 0]}),g?(0,$.jsx)(l().D,{styleKey:"Caption/Regular",colorPalette:"red",colorVariant:"accentPrimary","aria-invalid":"true","aria-errormessage":p.formatMessage({id:"inApp.marketplace.checkout.coupon.invalid.label",defaultMessage:"Invalid coupon code"}),children:d}):void 0]})}var de=()=>a(729108);function ce(e){const{checkboxProps:t,label:a,error:n,containerStyles:i={}}=e,o=(0,s().IS)((()=>({container:{display:"flex",gap:8,pointer:"cursor"},checkbox:{marginTop:"1px"},text:{display:"flex",flexDirection:"column",gap:2}})),[]);return(0,$.jsxs)("label",{style:{...o.container,...i},children:[(0,$.jsx)(de().S,{size:14,...t,style:{...t.style,...o.checkbox}}),(0,$.jsxs)("div",{style:o.text,children:[(0,$.jsx)(l().D,{styleKey:"Caption/Regular",colorVariant:"primary",children:a}),n?(0,$.jsx)(l().D,{styleKey:"Caption/Regular",colorPalette:"red",colorVariant:"accentPrimary",children:n}):void 0]})]})}function ue({displayInformation:{emailRequirement:e}}){const t=(0,s().IS)((e=>({container:{display:"flex",flexDirection:"column",gap:"8px"}})),[]),{isChecked:a,isError:n}=(0,r().K8)((()=>({isChecked:N().A.state.allowCreatorToAddToMailingList,isError:N().A.state.allowCreatorToAddToMailingListError})),[]);(0,i.useEffect)((()=>{a&&n&&N().A.setState({...N().A.state,allowCreatorToAddToMailingListError:!1})}),[a,n]);const o="required"===e;return o||"optional"===e?(0,$.jsx)("div",{style:t.container,children:(0,$.jsx)(ce,{label:(0,$.jsx)(c().sA,{id:"inApp.marketplace.checkout.saveEmail",defaultMessage:"Allow the creator to add me to their mailing list for updates, promotions, and helpful tips."}),checkboxProps:{onClick:()=>{N().A.setState({...N().A.state,allowCreatorToAddToMailingList:!N().A.state.allowCreatorToAddToMailingList})},checked:a,"aria-required":o},error:o&&n&&(0,$.jsx)(c().sA,{id:"inApp.marketplace.checkout.emailRequired",defaultMessage:"You must opt-in to emails to continue"})})}):null}function pe(e){const{price:t,taxAmount:a,discount:n,isCalculatingNewPrice:i,discountedPrice:o,taxAmountWithDiscount:r}=e,d=(0,O().$D)({price:t,taxAmount:a,currencyCode:"USD"}),u=(0,c().tz)(),p=(0,s().IS)((e=>({orderSummaryContainer:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},priceSummaryContainer:{display:"flex",gap:4,alignItems:"center"},fullPriceStrikethrough:{textDecoration:"line-through",color:e.text.tertiary}})),[]);return(0,$.jsxs)("div",{style:p.orderSummaryContainer,children:[(0,$.jsxs)("div",{style:p.priceSummaryContainer,children:[(0,$.jsx)(l().D,{styleKey:"Title-xl/Bold",colorVariant:"primary",children:void 0!==n&&void 0!==o?(0,$.jsx)(c().sA,{id:"inApp.marketplace.checkout.totalPrice.withDiscount",defaultMessage:"<strikethrough><fullPriceMoney></fullPriceMoney></strikethrough> <priceWithDiscountMoney></priceWithDiscountMoney>",values:{strikethrough:e=>(0,$.jsx)("span",{style:p.fullPriceStrikethrough,children:e}),fullPriceMoney:()=>(0,$.jsx)(ne().v,{cost:{amount:d.amount,currencyCode:"USD"},intl:u,trailingZeroDisplay:"auto"}),priceWithDiscountMoney:()=>{const e=(0,O().$D)({price:o,taxAmount:r,currencyCode:"USD"});return(0,$.jsx)(ne().v,{cost:{amount:e.amount,currencyCode:"USD"},intl:u,trailingZeroDisplay:"auto"})}}}):(0,$.jsx)(ne().v,{cost:{amount:d.amount,currencyCode:"USD"},intl:u,trailingZeroDisplay:"auto"})}),(0,$.jsx)(l().D,{styleKey:"Caption/Regular",colorVariant:"secondary",children:(0,$.jsx)(c().sA,{id:"inApp.marketplace.checkout.taxIfApplicable",defaultMessage:"(includes tax if applicable)"})})]}),i?(0,$.jsx)(te().k,{}):void 0]})}function me(e){const{listingId:t}=e,a=(0,r().K8)((()=>v().default.getConfigKey("marketplace_transactional_email_config","listingIds")),[]),n=(0,r().K8)((()=>N().A.state.agreedToTermsAndConditions),[]),i=(0,r().K8)((()=>N().A.state.showTermsAndConditionsError),[]),o=(0,c().tz)(),l=(0,s().IS)((e=>({termsAndConditionsContainer:{display:"flex",flexDirection:"column",gap:2},link:{cursor:"pointer",color:e.text.primary}})),[]);return(0,$.jsx)("div",{style:l.termsAndConditionsContainer,children:(0,$.jsx)(ce,{checkboxProps:{onClick:()=>{N().A.setState({...N().A.state,agreedToTermsAndConditions:!n,showTermsAndConditionsError:!1})},"aria-required":!0,checked:n},label:o.formatMessage(a.includes(t)?ye.termsAndConditionsTransactionalEmail:ye.termsAndConditions,{a:e=>(0,$.jsx)("a",{style:l.link,href:"https://www.notion.so/notion/Terms-and-Privacy-28ffdd083dc3473e9c2da6ec011b58ac",target:"_blank",children:e}),refundLink:e=>(0,$.jsx)(re,{source:"checkout_modal",styles:l.link,children:e})}),error:i?o.formatMessage(ye.termsAndConditionsError):void 0})})}const ye=(0,c().YK)({termsAndConditionsTransactionalEmail:{id:"inApp.marketplace.payment.termsAndConditions.transactionalEmail",defaultMessage:"I agree to <a>Notion’s terms & conditions</a> and the Marketplace’s <refundLink>14-day refund policy</refundLink>. I also agree that the above email address may be shared with the template creator for transactional purposes"},termsAndConditions:{id:"inApp.marketplace.payment.termsAndConditions",defaultMessage:"I agree to <a>Notion’s terms & conditions</a> and the Marketplace’s <refundLink>14-day refund policy</refundLink>"},termsAndConditionsError:{id:"inApp.marketplace.payment.termsAndConditions.error",defaultMessage:"You must accept the Marketplace terms to continue"}});async function ge({setIsApplyingCoupon:e,environment:t,coupon:a,productListingId:n,address:i,elements:o,acquisitionId:r}){const s=a.trim().toUpperCase();if(0===s.length)return;e(!0);const l=await g().Ks({environment:t,coupon:s,productListingId:n});if(l){let e=0;if((0,x().Z)(i)){const n=await P().callApi({eventName:"calculateMarketplaceTax",environment:t,data:{address:i,acquisitionId:r,couponCode:a}});if("success"===n.type&&n.data.valid){e=n.data.taxAmountWithCoupon??0;const t=n.data.totalAmountWithCoupon;o&&0!==t&&o.update({amount:t})}}N().A.setState({...N().A.state,discount:l.discount,discountedPrice:l.discountedPrice,isCouponApplied:!0,taxAmountWithDiscount:e}),g().H4({environment:t,coupon:a})}e(!1)}function fe(e){const{displayInformation:t,price:a,isPaying:n,onSubmit:i,productListingId:o,acquisitionId:r,isTCCheckboxEnabled:s}=e,d=Ce();return(0,$.jsxs)("div",{style:d.sidebarContainer,children:[(0,$.jsxs)("div",{style:d.productCardContainer,children:[(0,$.jsx)(l().D,{styleKey:"Caption/Medium",colorVariant:"secondary",children:(0,$.jsx)(c().sA,{id:"inApp.marketplace.checkout.product.label",defaultMessage:"Notion template"})}),(0,$.jsx)(ee,{productInformation:t})]}),(0,$.jsxs)("div",{style:d.priceAndPaymentContainer,children:[(0,$.jsx)(he,{productListingId:o,acquisitionId:r,price:a,isPaying:n}),(0,$.jsx)("div",{style:d.requiredCheckboxesContainer,children:(0,$.jsx)(ve,{listingId:o,displayInformation:t,isTCCheckboxEnabled:s})}),(0,$.jsx)(ie().A,{size:1}),(0,$.jsx)(xe,{onSubmit:i,price:a,isPaying:n}),s?null:(0,$.jsx)(Ae,{listingId:o})]})]})}function he(e){const{productListingId:t,acquisitionId:a,price:s,isPaying:l}=e,d=(0,o().v3)(),c=(0,V().I)(),u=(0,n().useElements)(),p=(0,i.useRef)(!1),[m,y]=(0,i.useState)(!1),g=(0,r().K8)((()=>N().A.state.coupon),[]),f=(0,r().K8)((()=>N().A.state.isCouponApplied),[]),h=(0,r().K8)((()=>N().A.state.invalidCouponReason),[]),v=(0,r().K8)((()=>N().A.state.taxAmount),[]),A=(0,r().K8)((()=>N().A.state.address),[]),x=(0,i.useCallback)((async e=>{await ge({environment:d,productListingId:t,acquisitionId:a,address:A,elements:u,setIsApplyingCoupon:y,coupon:e})}),[d,t,a,A,u]);(0,i.useEffect)((()=>{(async()=>{if(!c.coupon||!t||!a||!u||p.current)return;const e=c.coupon.trim().toUpperCase();N().A.setState({...N().A.state,coupon:e}),await ge({environment:d,productListingId:t,acquisitionId:a,address:A,elements:u,setIsApplyingCoupon:y,coupon:e}),p.current=!0})()}),[c.coupon,d,t,a,A,u]);return(0,$.jsx)(le,{couponCode:g,onCouponChange:e=>{const t=e.target.value.trim().toUpperCase();e.target.value=t,N().A.setState({...N().A.state,coupon:t})},onApplyClick:x,onRemoveClick:()=>{N().A.setState({...N().A.state,coupon:"",discount:void 0,isCouponApplied:!1,discountedPrice:void 0}),u&&u.update({amount:v+s})},isCouponApplied:f,isApplyingCoupon:m,invalidCouponReason:h,disabled:l})}function ve(e){const{displayInformation:t,listingId:a,isTCCheckboxEnabled:n}=e;return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(ue,{displayInformation:t}),n?(0,$.jsx)(me,{listingId:a}):void 0]})}function Ae(e){const{listingId:t}=e,a=(0,r().K8)((()=>v().default.getConfigKey("marketplace_transactional_email_config","listingIds")),[]),n=(0,s().IS)((e=>({link:{color:e.text.secondary}})),[]);return(0,$.jsx)(l().D,{styleKey:"Caption/Regular",colorVariant:"secondary",children:a.includes(t)?(0,$.jsx)(c().sA,{id:"inApp.marketplace.payment.termsAndConditionsBuyLabel.transactionalEmail",defaultMessage:"By purchasing this template, I agree to <a>Notion’s terms & conditions</a> and the Marketplace’s <refundLink>14-day refund policy</refundLink>. I also agree that the above email address may be shared with the template creator for transactional purposes",values:{a:e=>(0,$.jsx)("a",{style:n.link,href:"https://www.notion.so/notion/Terms-and-Privacy-28ffdd083dc3473e9c2da6ec011b58ac",target:"_blank",children:e}),refundLink:e=>(0,$.jsx)(re,{source:"checkout_modal",styles:n.link,children:e})}}):(0,$.jsx)(c().sA,{id:"inApp.marketplace.payment.termsAndConditionsBuyLabel",defaultMessage:"By purchasing this template, I agree to <a>Notion’s terms & conditions</a> and the Marketplace’s <refundLink>14-day refund policy</refundLink>",values:{a:e=>(0,$.jsx)("a",{style:n.link,href:"https://www.notion.so/notion/Terms-and-Privacy-28ffdd083dc3473e9c2da6ec011b58ac",target:"_blank",children:e}),refundLink:e=>(0,$.jsx)(re,{source:"checkout_modal",styles:n.link,children:e})}})})}function xe(e){const{onSubmit:t,price:a,isPaying:n}=e,i=Ce(),o=(0,c().tz)(),s=(0,r().K8)((()=>N().A.state.discountedPrice),[]),l=(0,r().K8)((()=>N().A.state.taxAmount),[]),d=(0,r().K8)((()=>N().A.state.discount),[]),u=(0,r().K8)((()=>N().A.state.isCalculatingTax),[]),p=(0,r().K8)((()=>N().A.state.taxAmountWithDiscount),[]),m=(0,O().$D)({taxAmount:void 0!==s?p:l,price:void 0!==s?s:a,currencyCode:"USD"});return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(pe,{price:a,discountedPrice:s,taxAmount:l,taxAmountWithDiscount:p,discount:d,isCalculatingNewPrice:u}),(0,$.jsx)(ae().A,{colorPalette:"blue",onClick:t,style:i.singleButton,disabled:n,children:n?(0,$.jsx)(te().k,{}):(0,$.jsx)("div",{style:i.buyButtonText,children:0===m.amount?o.formatMessage(ke.purchaseFreeTemplate):o.formatMessage(ke.purchaseTemplate,{money:()=>(0,$.jsx)(ne().v,{cost:{amount:m.amount,currencyCode:"USD"},intl:o,trailingZeroDisplay:"auto"})})})})]})}function Ce(){return(0,s().IS)((e=>({sidebarContainer:{display:"flex",flexDirection:"column",gap:30},priceAndPaymentContainer:{display:"flex",flexDirection:"column",gap:20},productCardContainer:{display:"flex",flexDirection:"column",gap:8},doubleButton:{width:"250px"},alreadyOwnedCtas:{display:"flex",alignItems:"center",gap:20},requiredCheckboxesContainer:{display:"flex",flexDirection:"column",gap:16},singleButton:{width:"100%",height:36,borderRadius:8},buyButtonText:{fontSize:16,color:e.text.inversePrimary,fontWeight:590}})),[])}const ke=(0,c().YK)({purchaseTemplate:{id:"inApp.marketplace.checkout.payment.buy",defaultMessage:"Buy for <money></money>"},purchaseFreeTemplate:{id:"inApp.marketplace.checkout.payment.buy.free",defaultMessage:"Add"}}),be=(0,c().YK)({paymentError:{id:"marketplace.payment.error",defaultMessage:"An error occurred while processing your payment. {error}"},duplicationError:{id:"marketplace.payment.error.duplicationError",defaultMessage:"A error occurred duplication the template after your payment. Please refresh the page."}});function Se(e){const t=(0,o().v3)(),{displayInformation:a,alreadyOwned:s,price:l,acquisitionId:d,listingId:u,contacts:p}=e,k=(0,r().K8)((()=>"on"!==v().default.getEligibleGroup({experimentId:"marketplace_checkout_move_tc_checkbox",defaultGroup:"off"})),[]),F=(0,h().X)("enable_ai_personalization_marketplace"),O=(0,r().K8)((()=>{var e;const{sidebarSpaceViewStore:t}=y().default.state;return null==t||null===(e=t.getSettings())||void 0===e?void 0:e.agent_personalization_settings}),[]),H=(0,r().K8)((()=>v().default.getConfigKey("marketplace_redirect_url_after_purchase_config",u)),[u]),Y=(0,r().K8)((()=>N().A.state.address),[]),G=(0,r().K8)((()=>N().A.state.discountedPrice),[]),Z=(0,r().K8)((()=>N().A.state.coupon),[]),J=(0,r().K8)((()=>N().A.state.allowCreatorToAddToMailingList),[]),Q=(0,r().K8)((()=>N().A.state.agreedToTermsAndConditions),[]),ee=(0,r().K8)((()=>N().A.state.isTaxValid),[]),te=(0,r().K8)((()=>N().A.state.isCalculatingTax),[]),ae=(0,r().K8)((()=>f().A.state.teamStore),[]),ne=(0,r().K8)((()=>N().A.state.paymentType),[]),ie=(0,n().useStripe)(),oe=(0,n().useElements)(),re=(0,c().tz)(),[se,le]=(0,i.useState)(!1),[de,ce]=(0,i.useState)(!1),[ue,pe]=(0,i.useState)(!1),me=Ie(),ye=(0,m().r)(),ge=(0,V().I)(),he=(0,r().K8)((()=>{if(!d)return;return new(K().y)(t,{table:T().Ht,id:d}).getStatus()}),[d,t]),ve=(0,r().K8)((()=>{const e=ge.slug;if(!e)return{isValid:!1};if(void 0!==z().K.state[e])return z().K.state[e];const a=(0,E().kz)({environment:t,sidebarSpaceId:ye,slug:ge.slug,intl:re});return z().K.setState({...z().K.state,[e]:a}),a}),[ge.slug,t,re,ye]);(0,i.useEffect)((()=>{se&&"succeeded"===he&&(async()=>{if(!ge.slug)return _().f1(re.formatMessage(be.duplicationError)),void le(!1);H&&window.open(H,"_blank");const e=await E().xL({environment:t,slug:ge.slug,locale:(0,S().H)(re),acquisitionDestinationId:ye,sidebarSpaceId:ye,includeCategories:!0});if(e&&e.block_id){const r=new(B().B)(t,{table:I().ev,id:e.block_id}),s=f().A.state.from;if(g().zi(t),f().A.setState({...f().A.state,hasSuccessfullyPurchasedProduct:!0}),W().A.setState({...W().A.state,duplicationStatus:"duplicating"}),A().A.isMobile)return(0,E().uy)({environment:t,template:e,templateBlockStore:r,teamStore:ae,from:s,isMobile:!0}).then((()=>{W().A.setState({...W().A.state,duplicationStatus:"success"})})),void(L().A.state.open&&L().A.setState({...L().A.state,isCheckout:!1,item:{...L().A.state.item,marketplaceTemplateMetadata:{...L().A.state.item.marketplaceTemplateMetadata,userHasAcquiredTemplate:!0}}}));const l=(0,q().VT)(e)&&F;l&&U().L.setState({...U().L.state,isDuplicating:!0});const d=await(0,E().uy)({environment:t,template:e,templateBlockStore:r,teamStore:ae,from:s,isValidated:de,duplicationStartedToastProps:Me(re),...l?{showDuplicationFinishedToast:!1,showDuplicationStartedToast:!1,duplicationStartedToastProps:{},durationMsBeforeShowingFinishedToast:2e3}:{}});if(W().A.setState({...W().A.state,duplicationStatus:"success"}),l&&d){var a;j().Mu({environment:t,newPageIdToAdd:d.id,contextPageId:d.id,agentName:null==O?void 0:O.name,customizationItems:null==O?void 0:O.customization_items});let r="";var n,i,o;null!==(a=e.attributes)&&void 0!==a&&a.icon&&(r=(0,b().T8)(null===(n=e.attributes)||void 0===n?void 0:n.icon)?null===(i=e.attributes)||void 0===i?void 0:i.icon:(null===(o=e.attributes)||void 0===o?void 0:o.emoji)??""),U().L.setState({...U().L.state,templateName:e.name,templateIcon:r,isDuplicating:!1,isDuplicatingFinished:!0,newPageBlockStore:d})}}le(!1)})()}),[he,se,ge.slug,ae,ye,re,t,H,F,O,de]);const Ae=(0,i.useMemo)((()=>!se&&ee&&ue&&!te),[se,ee,ue,te]),xe=(0,i.useCallback)((async e=>{var n;let i;e.preventDefault();const o=!Q&&k,r="required"===a.emailRequirement&&!J,l={listingId:u,acquisitionId:d,sidebarSpaceId:ye};if(o||r)return C().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Terms and conditions or mailing list error",data:{miscDataToConvertToString:{...l,showTermsAndConditionsError:o,allowCreatorToAddToMailingListError:r}}}),void N().A.setState({...N().A.state,showTermsAndConditionsError:o,allowCreatorToAddToMailingListError:r});if(!oe)return void C().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"No Stripe elements found.",data:{miscDataToConvertToString:{...l}}});if(!ie)return void C().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"No stripe instance found.",data:{miscDataToConvertToString:{...l}}});if(!ye)return void C().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"No spaceId found.",data:{miscDataToConvertToString:{...l}}});if(!Y)return void C().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"No Stripe address found or invalid input.",data:{miscDataToConvertToString:{...l}}});if(s)return void C().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Customer already owns this product for the workspace.",data:{miscDataToConvertToString:{...l}}});if(!Ae&&0!==G)return void C().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Attempted payment without enabled payment.",data:{miscDataToConvertToString:{...l,isTaxValid:ee,isPaymentElementComplete:ue,isCalculatingTax:te,isPaying:se}}});if("card"!==ne){const e=oe.getElement("address");if(e){const t=await e.getValue();if(!t.complete)return void C().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Google/Apply Pay attempt with incomplete address",data:{miscDataToConvertToString:{...l,addressValue:t}}})}}if("card"===ne){const e=0!==G?await oe.submit():{};if(e.error)return void C().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Element submit error",data:{miscDataToConvertToString:{...l,elementSubmitResponse:e}}})}N().A.setState({...N().A.state,showTermsAndConditionsError:!1}),le(!0);try{if(!(await ve).isValid)return le(!1),C().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Template content validation failed",data:{miscDataToConvertToString:{...l}}}),void _().f1(re.formatMessage({id:"marketplace.payment.error.templateValidationFailed",defaultMessage:"Unable to purchase template."}))}catch(i){return le(!1),C().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Template content validation error",data:{miscDataToConvertToString:{...l}}}),void _().f1(re.formatMessage({id:"marketplace.payment.error.templateValidationFailed",defaultMessage:"Unable to purchase template."}))}ce(!0),g().mM({environment:t,emailRequirement:a.emailRequirement});const c=await P().callApi({eventName:"confirmProductPurchase",environment:t,data:{productId:u,listingId:u,address:Y,spaceId:ye,allowCreatorToAddToMailingList:J,couponCode:Z}});if("failed"===c.type)return le(!1),C().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Confirm product purchase failed.",data:{miscDataToConvertToString:{...l,address:Y,coupon:Z,result:c}}}),void _().f1((0,D().H)(re,c));let p,m;if(c.data.intentClientSecret){if(await oe.submit(),p=await ie.confirmPayment({elements:oe,clientSecret:c.data.intentClientSecret,confirmParams:{return_url:window.location.href,expand:["amount"]},redirect:"if_required"}),void 0!==p.error)i=p.error,m="Stripe confirm payment error";else if("requires_action"===p.paymentIntent.status){const e=await ie.handleNextAction({clientSecret:p.paymentIntent.client_secret??""});void 0!==e.error&&(i=e.error,m="Stripe handle next action error")}void 0!==i&&void 0!==m&&(C().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:m,data:{miscDataToConvertToString:{...l,error:i}}}),w().cr(t,{error:i.code,stripe_decline_code:i.decline_code}),_().f1(re.formatMessage(be.paymentError,{error:(0,R().translateStripeError)(re,i)})),le(!1))}g().Il({environment:t,success:void 0===i,emailRequirement:a.emailRequirement,transactionValue:null===(n=p)||void 0===n||null===(n=n.paymentIntent)||void 0===n?void 0:n.amount,error:i})}),[ie,oe,s,Y,ye,G,a.emailRequirement,J,t,u,Ae,Q,re,Z,ne,k,d,te,se,ue,ee,ve]),Ce=(0,i.useMemo)((()=>(0,M().sg)(xe,2e3,{leading:!0,trailing:!1})),[xe]),ke=async e=>{if(!oe||s)return;const a=function(e){return{zipCode:e.postal_code??"",country:e.country??"",addressLine1:e.line1??"",city:e.city??"",state:e.state??""}}(e.value.address);M().n4(a,Y)||((0,x().Z)(a)&&l?await g().wx({environment:t,acquisitionId:d,address:a,elements:oe}):N().A.setState({...N().A.state,address:a,isTaxValid:!1,isCalculatingTax:!1}))};return A().A.isMobile?(0,$.jsx)(Te,{displayInformation:a,alreadyOwned:s,onAddressChange:ke,contacts:p??[],setIsPaymentElementComplete:pe,isPaying:se,listingId:u,acquisitionId:d,price:l??0,onSubmit:Ce,isTCCheckboxEnabled:k}):(0,$.jsxs)("div",{style:me.contentContainer,children:[s?null:(0,$.jsx)(X,{onAddressChange:ke,contacts:p??[],setIsPaymentElementComplete:pe,isPaying:se}),(0,$.jsx)(fe,{acquisitionId:d,displayInformation:a,alreadyOwned:s,price:l??0,isPaying:se,onSubmit:Ce,productListingId:u,isTCCheckboxEnabled:k})]})}function Ie(){const{isMobileWidth:e,isTabletWidth:t,isLowResolutionTabletWidth:a}=(0,p().LS)(),n=A().A.isMobile?e||t:e||a;return(0,s().IS)((e=>({contentContainer:{display:"flex",gap:32,flexDirection:n?"column":"row"},mobileContentContainer:{position:"sticky",bottom:-40,display:"flex",flexDirection:"column",gap:8,background:e.popoverBackground,borderTop:"1px solid lightgray",paddingTop:16,minHeight:124}})),[n])}function Te(e){const{displayInformation:t,alreadyOwned:a,onAddressChange:n,contacts:i,setIsPaymentElementComplete:o,isPaying:r,listingId:s,acquisitionId:l,price:d,onSubmit:c,isTCCheckboxEnabled:u}=e,p=Ie();return(0,$.jsxs)("div",{style:p.contentContainer,children:[(0,$.jsx)(ee,{productInformation:t}),a?null:(0,$.jsx)(X,{onAddressChange:n,contacts:i??[],setIsPaymentElementComplete:o,isPaying:r}),(0,$.jsx)(he,{productListingId:s,acquisitionId:l,price:d??0,isPaying:r}),(0,$.jsx)(ve,{displayInformation:t,listingId:s,isTCCheckboxEnabled:u}),(0,$.jsx)("div",{style:p.mobileContentContainer,children:(0,$.jsx)(xe,{onSubmit:c,price:d??0,isPaying:r})})]})}function Me(e){return{iconGroup:k().z,iconGroupColorPalette:"green",iconGroupColorVariant:"accentPrimary",iconGroupVariant:"default",title:e.formatMessage({id:"inApp.marketplace.checkout.payment.success.duplication.started.title",defaultMessage:"Purchase successful"}),message:e.formatMessage({id:"inApp.marketplace.checkout.payment.success.duplication.started.message",defaultMessage:"The template is being added to your workspace. We will let you know when it’s ready to use."})}}function we(){const e=(0,o().v3)(),t=(0,c().tz)(),a=(0,s().IS)((()=>({modalContentContainer:{minHeight:400,maxHeight:850,display:"flex",padding:"32px",flexDirection:"column",gap:24,borderRadius:12,position:"relative",overflow:"auto"},headingContainer:{display:"flex",flexDirection:"column",gap:2}})),[]),i=(0,n().useElements)(),h=(0,o().Y0)().isMobile,v=(0,r().K8)((()=>{var e;return null===(e=y().default.state.sidebarSpaceStore)||void 0===e?void 0:e.getName()}),[]),A=(0,m().r)(),x=(0,r().K8)((()=>f().A.state.marketplaceListingId),[]),[C]=(0,d().Yb)((async()=>{if(!A||!i)return;if(!x||!(0,u().uj)(x))return;const a=await g().y$({environment:e,listingId:x,spaceId:A,intl:t});if(a&&(f().A.setState({...f().A.state,creatorId:a.creatorId,customerId:a.customerId}),g().Ix({environment:e,emailRequirement:a.displayInformation.emailRequirement})),a&&!a.alreadyOwned&&0!==a.contacts.length&&a.acquisitionId){const t=a.contacts[0],n={zipCode:t.address.postal_code??"",country:t.address.country??"",addressLine1:t.address.line1??"",city:t.address.city??"",state:t.address.state??""};await g().wx({environment:e,elements:i,address:n,acquisitionId:a.acquisitionId})}return a}),[A,e,x,t,i]),k=C.value;if(!x||!(0,u().uj)(x))return null;if(!k)return null;const{displayInformation:b,alreadyOwned:S,acquisitionId:I}=k,T=k.alreadyOwned?void 0:k.price,M=k.alreadyOwned?void 0:k.contacts;return(0,$.jsxs)("div",{style:a.modalContentContainer,children:[(0,$.jsxs)("div",{style:a.headingContainer,children:[(0,$.jsx)(l().D,{styleKey:"Title-xl/Bold",colorVariant:"primary",children:(0,$.jsx)(c().sA,{id:"inApp.marketplace.checkout.modal.header",defaultMessage:"Checkout"})}),void 0!==v?(0,$.jsx)(l().D,{styleKey:"Title-sm/Regular",colorVariant:"secondary",children:h?(0,$.jsx)(c().sA,{id:"inApp.marketplace.checkout.modal.mobile.subheader",defaultMessage:"This template will be added to your Private space within {spaceName}",values:{spaceName:v}}):(0,$.jsx)(c().sA,{id:"inApp.marketplace.checkout.modal.subheader",defaultMessage:"This template is being added to {spaceName}",values:{spaceName:v}})}):void 0]}),(0,$.jsx)(p().KF,{throttle:100,lowResolutionTabletUpperBound:760,children:(0,$.jsx)(Se,{listingId:x,displayInformation:b,acquisitionId:I,alreadyOwned:S,price:T,contacts:M})})]})}},42905:(e,t,a)=>{a.d(t,{L:()=>i});class n extends(()=>a(757695))().Store{getInitialState(){return{templateName:"",templateIcon:"",newPageBlockStore:void 0,isDuplicating:!1,isDuplicatingFinished:!1}}clearState(){this.setState({...this.getInitialState()})}}const i=new n},76489:(e,t,a)=>{a.d(t,{z:()=>n});const n=(0,a(340498).xh)("checkStack",{default:{loader:()=>a.e(81328).then(a.bind(a,781328))},small:{loader:()=>a.e(70854).then(a.bind(a,270854))},mini:{loader:()=>a.e(15662).then(a.bind(a,715662))},large:{loader:()=>a.e(72126).then(a.bind(a,472126))}})},78219:(e,t,a)=>{a.d(t,{A:()=>i});class n extends(()=>a(757695))().Store{getInitialState(){return{duplicationStatus:null}}}const i=new n},146423:(e,t,a)=>{a.d(t,{A:()=>i});class n extends(()=>a(757695))().Store{getInitialState(){return{address:{addressLine1:"",city:"",state:"",country:"",zipCode:""},allowCreatorToAddToMailingList:!1,allowCreatorToAddToMailingListError:!1,taxAmount:0,taxAmountWithDiscount:0,discountedPrice:void 0,discount:void 0,coupon:"",agreedToTermsAndConditions:!1,showTermsAndConditionsError:!1,isCouponInvalid:!1,isCouponApplied:!1,isCalculatingTax:!1,isTaxValid:!1,invalidCouponReason:"",paymentType:"card"}}}const i=new n},202106:(e,t,a)=>{a.d(t,{$D:()=>o,IT:()=>r,t6:()=>s});var n=()=>a(643819),i=()=>a(370441);function o(e){const{taxAmount:t,price:a,currencyCode:i}=e,o=new(n().W)(i,t);return new(n().W)(i,a).plus(o)}function r(e,t){return{appearance:(0,i().getLegacyStripeAppearance)(e),mode:"payment",currency:"usd",amount:1e3,paymentMethodTypes:["card"],setupFutureUsage:"on_session",locale:(0,i().stripeElementLocaleGivenNotionLocale)(t)}}function s(e){return"card"===e||"google_pay"===e||"apple_pay"===e}},212782:(e,t,a)=>{a.d(t,{K:()=>i});class n extends(()=>a(757695))().Store{getInitialState(){return{}}clearState(){this.setState({})}}const i=new n},345737:(e,t,a)=>{a.d(t,{A:()=>i});class n extends(()=>a(757695))().Store{getInitialState(){return{isModalOpen:!1,marketplaceListingId:"",teamStore:void 0,hasSuccessfullyPurchasedProduct:!1,templateId:"",creatorId:"",customerId:""}}}const i=new n},387292:(e,t,a)=>{a.d(t,{Sf:()=>r,UY:()=>d,ft:()=>s,mm:()=>o,vU:()=>c,wg:()=>l});var n=()=>a(972435);const i=(0,a(69708).YK)({selectPriceFilterAll:{id:"inApp.marketplace.template.filter.price.all",defaultMessage:"Free + Paid"},selectPriceFilterPaid:{defaultMessage:"Paid",id:"inApp.marketplace.template.filter.price.paid"},selectPriceFilterFree:{defaultMessage:"Free",id:"inApp.marketplace.template.filter.price.free"},selectMadeByAll:{id:"inApp.marketplace.template.filter.madeBy.all",defaultMessage:"Notion + Creators"},selectMadeByNotion:{id:"inApp.marketplace.template.filter.madeBy.notion",defaultMessage:"Notion"},selectMadeByCreators:{id:"inApp.marketplace.template.filter.madeBy.creators",defaultMessage:"Creators"},selectSortValueRecent:{defaultMessage:"Most Recent",id:"inApp.marketplace.template.sort.recent"},selectSortValueDuplication:{defaultMessage:"Duplications",id:"inApp.marketplace.template.sort.duplication"},selectSortValuePopular:{defaultMessage:"Popular",id:"inApp.marketplace.template.sort.popular"},qualificationValueAllCreators:{defaultMessage:"All creators",id:"inApp.marketplace.creator.qualification.allCreators"},qualificationValueNotionRecommended:{defaultMessage:"Notion recommended",id:"inApp.marketplace.creator.qualification.notionRecommended"},qualificationValueCertifiedConsultants:{defaultMessage:"Certified consultants",id:"inApp.marketplace.creator.qualification.certifiedConsultants"},creatorSelectSortValueMostDuplicated:{defaultMessage:"Most duplicated",id:"inApp.marketplace.creator.sort.mostDuplicated"},creatorSelectSortValueMostTemplates:{defaultMessage:"Most templates",id:"inApp.marketplace.creator.sort.mostTemplates"},creatorSelectSortValueAlphabetical:{defaultMessage:"Alphabetical",id:"inApp.marketplace.creator.sort.alphabetical"},selectAllLocales:{defaultMessage:"English + {userLocale}",id:"inApp.marketplace.template.filter.locale.all"},selectUserLocale:{defaultMessage:"{userLocale}",id:"inApp.marketplace.template.filter.locale.user"}}),o=[{value:n().A.formatMessage(i.selectPriceFilterAll),key:"all"},{value:n().A.formatMessage(i.selectPriceFilterPaid),key:"paid"},{value:n().A.formatMessage(i.selectPriceFilterFree),key:"free"}],r=[{value:n().A.formatMessage(i.selectMadeByAll),key:"all"},{value:n().A.formatMessage(i.selectMadeByNotion),key:"notion"},{value:n().A.formatMessage(i.selectMadeByCreators),key:"community"}],s=[{value:n().A.formatMessage(i.selectSortValuePopular),key:"popular"},{value:n().A.formatMessage(i.selectSortValueRecent),key:"recent"},{value:i.selectSortValueDuplication.defaultMessage,key:"duplications"}],l=[{value:n().A.formatMessage(i.qualificationValueAllCreators),key:"all"},{value:n().A.formatMessage(i.qualificationValueNotionRecommended),key:"notion_recommended"},{value:n().A.formatMessage(i.qualificationValueCertifiedConsultants),key:"certified"}],d=[{value:n().A.formatMessage(i.creatorSelectSortValueMostDuplicated),key:"number_of_duplicates"},{value:n().A.formatMessage(i.creatorSelectSortValueMostTemplates),key:"number_of_templates"},{value:n().A.formatMessage(i.creatorSelectSortValueAlphabetical),key:"alphabetical"}];function c(e){return[{value:n().A.formatMessage(i.selectAllLocales,{userLocale:e}),key:"english_and_user_locale"},{value:n().A.formatMessage(i.selectUserLocale,{userLocale:e}),key:"user_locale"}]}},396990:(e,t,a)=>{a.d(t,{A:()=>i});class n extends(()=>a(757695))().Store{getInitialState(){return{isOpen:!1}}open(e){this.setState({isOpen:!0,...e})}submit(){var e,t;null===(e=(t=this.state).onSubmit)||void 0===e||e.call(t,!0),this.setState({isOpen:!1})}skip(){var e,t;null===(e=(t=this.state).onSubmit)||void 0===e||e.call(t,!1),this.setState({isOpen:!1})}cancel(){this.setState({isOpen:!1})}}const i=new n},462842:(e,t,a)=>{a.d(t,{H4:()=>A,Il:()=>C,Ix:()=>v,Ks:()=>f,Rv:()=>y,mM:()=>x,wx:()=>h,y$:()=>g,zi:()=>m});a(814603),a(147566),a(198721);var n=()=>a(564884),i=()=>a(242422),o=()=>a(165358),r=()=>a(559506),s=()=>a(901389),l=()=>a(577142),d=()=>a(661461),c=()=>a(972435),u=()=>a(146423),p=()=>a(345737);function m(e){p().A.setState({...p().A.state,isModalOpen:!1,marketplaceListingId:void 0,from:void 0});const t=new URL(window.location.href);t.searchParams.delete("checkout"),t.searchParams.delete("coupon"),t.searchParams.delete("from"),(0,l().navigate)({environment:e,url:t.toString()})}function y(e){const t=new URL(window.location.href);t.searchParams.append("checkout","true"),(0,l().navigate)({environment:e,url:t.toString()})}async function g(e){const{environment:t,listingId:a,spaceId:n,intl:i}=e,o=await r().callApi({eventName:"initiateProductPurchase",environment:t,data:{productId:a,listingId:a,spaceId:n}});if("success"===o.type)return o.data;m(t),s().f1((0,d().H)(i,o))}async function f(e){const{coupon:t,productListingId:a,environment:n}=e,i=c().A.getIntl();try{u().A.setState({...u().A.state,invalidCouponReason:""});const e=await r().callApi({eventName:"calculatePriceWithMarketplaceCoupon",environment:n,data:{productListingId:a,couponCode:t}});if("success"===e.type)return{discount:e.data.discount,discountedPrice:e.data.discountedPrice};{const t=(0,d().H)(i,e);u().A.setState({...u().A.state,invalidCouponReason:t})}}catch(o){u().A.setState({...u().A.state,invalidCouponReason:i.formatMessage({id:"inApp.marketplace.checkout.coupon.invalid",defaultMessage:"Something went wrong, please try again."})})}}async function h(e){const{address:t,acquisitionId:a,elements:n,environment:i}=e,o=u().A.state.discountedPrice,s=u().A.state.coupon;let l=0,d=0;u().A.setState({...u().A.state,isTaxValid:!1,isCalculatingTax:!0});const c=await r().callApi({eventName:"calculateMarketplaceTax",environment:i,data:{address:t,acquisitionId:a,couponCode:s}});if("success"===c.type&&c.data.valid){l=c.data.taxAmount,d=c.data.taxAmountWithCoupon??0;0!==(void 0!==o?c.data.totalAmountWithCoupon:c.data.totalAmount)&&n.update({amount:void 0!==o?c.data.totalAmountWithCoupon:c.data.totalAmount}),u().A.setState({...u().A.state,address:t,taxAmount:l,taxAmountWithDiscount:d,isTaxValid:!0,isCalculatingTax:!1})}}function v(e){const{environment:t,emailRequirement:a}=e,o=p().A.state;if(o.creatorId&&o.customerId&&o.marketplaceListingId&&o.templateId){const e={creator_id:o.creatorId,template_id:o.templateId,listing_id:o.marketplaceListingId,customer_id:o.customerId,email_requirement:a};(0,n().u)({environment:t,event:{eventName:"marketplace_checkout_open",eventProperties:e}}),i().default.logEvent("marketplace_checkout_open",1,e)}}function A(e){const{environment:t,coupon:a}=e,o=p().A.state;if(o.creatorId&&o.customerId&&o.marketplaceListingId&&o.templateId){const e={creator_id:o.creatorId,template_id:o.templateId,listing_id:o.marketplaceListingId,customer_id:o.customerId,coupon:a};(0,n().u)({environment:t,event:{eventName:"marketplace_coupon_apply",eventProperties:e}}),i().default.logEvent("marketplace_coupon_apply",1,e)}}function x(e){const{environment:t,emailRequirement:a}=e,r=p().A.state,s=u().A.state;if(r.creatorId&&r.customerId&&r.marketplaceListingId&&r.templateId&&s.paymentType){const e={creator_id:r.creatorId,template_id:r.templateId,listing_id:r.marketplaceListingId,customer_id:r.customerId,payment_method:s.paymentType,email_requirement:a};(0,n().u)({environment:t,event:{eventName:"marketplace_payment_initiated",eventProperties:e}}),i().default.logEvent("marketplace_payment_initiated",1,e),o().log({level:"info",from:"marketplaceCheckoutActions",type:"marketplacePaymentInitiated",data:{miscDataToConvertToString:{...e}}})}}function C(e){const{environment:t,success:a,emailRequirement:r,transactionValue:s,error:l}=e,d=p().A.state,c=u().A.state;if(d.creatorId&&d.customerId&&d.marketplaceListingId&&d.templateId&&c.paymentType){const e={creator_id:d.creatorId,template_id:d.templateId,listing_id:d.marketplaceListingId,customer_id:d.customerId,payment_method:c.paymentType,email_requirement:r,transaction_value:s,success:a};(0,n().u)({environment:t,event:{eventName:"marketplace_payment_completed",eventProperties:e}}),i().default.logEvent("marketplace_payment_completed",1,e)}a?o().log({level:"info",from:"marketplaceCheckoutActions",type:"marketplacePaymentCompletedSuccess",data:{miscDataToConvertToString:{creator_id:d.creatorId,template_id:d.templateId,listing_id:d.marketplaceListingId,customer_id:d.customerId,payment_method:c.paymentType,email_requirement:r,success:a}}}):o().log({level:"error",from:"marketplaceCheckoutActions",type:"marketplacePaymentCompletedFailure",data:{miscDataToConvertToString:{error:l,creator_id:d.creatorId,template_id:d.templateId,listing_id:d.marketplaceListingId,customer_id:d.customerId,payment_method:c.paymentType,email_requirement:r,success:a}}})}},465039:(e,t,a)=>{a.d(t,{KF:()=>d,LS:()=>l});a(16280);var n=a(296540),i=()=>a(401497),o=()=>a(981305),r=a(474848);const s=(0,n.createContext)({screenWidthType:"desktop",isMobileWidth:!1,isLowResolutionTabletWidth:!1,isDesktopWidth:!1,isTabletWidth:!1});function l(){const e=(0,n.useContext)(s);if(!e)throw new Error("ScreenWidthContext not found. Please make sure this is used within a ScreenWidthContext.Provider.");return e}function d(e){const{children:t,mobileUpperBound:a=550,lowResolutionTabletUpperBound:l=720,tabletUpperBound:d=1024,throttle:c=0}=e,u=(0,n.useRef)(null),p=(0,i().IS)((()=>({sizeObserverContainer:{width:"100%",height:0,position:"absolute"}})),[]),[m,y]=(0,n.useState)("desktop"),g=(0,n.useCallback)((e=>{e.state.width<=a?y("mobile"):e.state.width>a&&e.state.width<=l?y("lowResolutionTablet"):e.state.width>l&&e.state.width<=d?y("tablet"):y("desktop")}),[a,l,d]);(0,o().B)(u,g,c);const f="mobile"===m,h="desktop"===m,v="tablet"===m,A="lowResolutionTablet"===m,x=n.useMemo((()=>({screenWidthType:m,isMobileWidth:f,isLowResolutionTabletWidth:A,isDesktopWidth:h,isTabletWidth:v})),[m,f,A,h,v]);return(0,r.jsxs)(s.Provider,{value:x,children:[(0,r.jsx)("div",{ref:u,style:p.sizeObserverContainer}),t]})}s.displayName="ScreenWidthContext"},570882:(e,t,a)=>{a.d(t,{I:()=>o});var n=()=>a(484714),i=()=>a(56366);function o(){const e=(0,n().v3)();return(0,i().K8)((()=>{const{RouterStore:t}=e;return t.state.route}),[e])}},935774:(e,t,a)=>{a.d(t,{$H:()=>u,BZ:()=>x,Bf:()=>p,CX:()=>b,FN:()=>C,H6:()=>S,P9:()=>m,TM:()=>y,VT:()=>I,dc:()=>d,zG:()=>k,zn:()=>c});a(944114),a(517642),a(658004),a(733853),a(845876),a(432475),a(515024),a(731698),a(898992),a(354520),a(581454),a(737550),a(814603),a(147566),a(198721);var n=()=>a(726637),i=()=>a(427704),o=()=>a(679927),r=()=>a(496603),s=()=>a(534177),l=()=>a(387292);const d={madeBy:["notion","community"],paid:["paid","free"],orderBy:"popular",locales:"english_and_user_locale"};function c(e){const{madeBy:t,paid:a,orderBy:n,locales:i}=e;return{madeBy:A("madeBy",t)?[t]:["notion","community"],paid:A("paid",a)?[a]:["paid","free"],orderBy:A("orderBy",n)?n:"popular",locales:A("locales",i)?i:"english_and_user_locale"}}function u(e){const{madeBy:t,paid:a,orderBy:n,locales:i}=e;return{madeBy:(null==t?void 0:t.split("+"))??[],paid:(null==a?void 0:a.split("+"))??[],orderBy:A("orderBy",n)?n:"popular",locales:A("locales",i)?i:"english_and_user_locale"}}function p(e){return(null==e?void 0:e.split(","))??[]}function m(e){return(null==e?void 0:e.split(","))??[]}function y(e){const{slug:t,filters:a,allowMultiple:o}=e,r=new URL(`${n().A.domainBaseUrl}${i().JZ.marketplace}/categories/${encodeURIComponent(t)}`);if(a){const{selectedCategorySlugs:e,templateCategoryFilters:t,selectedGroupedCategorySlugs:n}=a;0!==e.length&&r.searchParams.append("tags",e.toString()),0!==n.length&&r.searchParams.append("groupedTags",n.toString()),"popular"!==t.orderBy&&r.searchParams.append("orderBy",encodeURIComponent(t.orderBy)),"english_and_user_locale"!==t.locales&&r.searchParams.append("locales",encodeURIComponent(t.locales)),o?(t.madeBy.length>0&&r.searchParams.append("madeBy",encodeURIComponent(t.madeBy.join("+").toString())),t.paid.length>0&&r.searchParams.append("paid",encodeURIComponent(t.paid.join("+").toString()))):(1===t.madeBy.length&&r.searchParams.append("madeBy",encodeURIComponent(t.madeBy[0].toString())),1===t.paid.length&&r.searchParams.append("paid",encodeURIComponent(t.paid[0].toString())))}return r.toString()}const g=["notion","community"],f=["paid","free"],h=["duplications","recent"],v=["english_and_user_locale","user_locale"];function A(e,t){if(void 0===t)return!1;switch(e){case"madeBy":return"all"!==t&&g.includes(t);case"orderBy":return h.includes(t);case"paid":return"all"!==t&&f.includes(t);case"locales":return v.includes(t);default:(0,s().HB)(e)}}function x(e,t,a){const n=r().qI(t.map((e=>e.categories))).map((e=>e.slug)),i=e.filter((e=>!n.includes(e.slug))),o=new Set,s=e=>{const t=[];for(const n of e)if(!o.has(n.slug))if(o.add(n.slug),a.includes(n.slug)){const e=i.filter((e=>{var t;return null===(t=n.subcategory_contentful_ids_v2)||void 0===t?void 0:t.includes(e.contentful_id)}));t.push({...n,subcategories:s(e)})}else t.push(n);return t};return s(i)}Date.now(),Date.now(),Date.now();const C="white";function k(e){if(e){for(const t of e)if(t.attributes.color)return t.attributes.color;return C}}const b=l().mm.filter((e=>"all"!==e.key)),S=l().Sf.filter((e=>"all"!==e.key));function I(e){var t;return Boolean(null===(t=e.categories)||void 0===t?void 0:t.some((e=>e.contentful_id===o().pm)))}}}]);